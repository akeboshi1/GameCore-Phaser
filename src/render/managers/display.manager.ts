import { Export, RPCEmitter, RPCExecutor, RPCParam } from "webworker-rpc";
import { RunningAnimation } from "../../structureinterface/animation";
import { IFramesModel } from "../../structureinterface/frame";
import { Logger } from "../../utils/log";
import { DisplayField, DisplayObject } from "../display/display.object";
import { DragonbonesDisplay } from "../display/dragonbones/dragonbones.display";
import { IDragonbonesModel } from "../../structureinterface/dragonbones";
import { SceneManager } from "./scene.manager";

export class DisplayManager {
    private displays: Map<number, DisplayObject>;

    constructor(private game: Phaser.Game, private sceneManager: SceneManager) {
        this.displays = new Map();
    }

    public addDisplay(data: IFramesModel | IDragonbonesModel): void {
        // const scene = this.sceneManager.currentScene;
        // if (!scene) return;
        // let display: DisplayObject;
        // switch (type) {
        //     case DisplayType.Dragonbones:
        //         display = new DragonbonesDisplay(scene, data);
        //         break;
        //     case DisplayType.Element:
        //         // display = new ElementDisplay(scene, data);
        //         break;
        //     case DisplayType.Frame:
        //         // display = new FramesDisplay(scene, data);
        //         break;
        //     case DisplayType.Terrain:
        //         // display = new TerrainDisplay(scene, data);
        //         break;
        //     default:
        //         Logger.getInstance().error("undefined display type: ", type);
        //         return;
        // }

        // this.displays.set(displayID, display);
    }
    public removeDisplay(displayID: number): void {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.removeFromParent();
        display.destroy();
        this.displays.delete(displayID);
    }

    public load(displayID: number, data: any, field?: DisplayField) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.load(data, field);
    }

    public changeAlpha(displayID: number, val?: number) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.changeAlpha(val);
    }

    public fadeIn(displayID: number) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.fadeIn();
    }

    public fadeOut(displayID: number) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.fadeOut();
    }

    public play(displayID: number, animation: RunningAnimation, field?: DisplayField, times?: number) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.play(animation, field, times);
    }

    public mount(displayID: number, ele: Phaser.GameObjects.Container, targetIndex?: number) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.mount(ele, targetIndex);
    }

    public unmount(displayID: number, ele: Phaser.GameObjects.Container) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.unmount(ele);
    }

    public removeEffect(displayID: number, field: DisplayField) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.removeEffect(field);
    }

    public removeDisplayField(displayID: number, field: DisplayField) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.removeDisplay(field);
    }

    public setDisplayBadges(displayID: number, cards: []) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.setDisplayBadges(cards);
    }

    public showRefernceArea(displayID: number) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.showRefernceArea();
    }

    public hideRefernceArea(displayID: number) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.hideRefernceArea();
    }

    public scaleTween(displayID: number): void {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        display.scaleTween();
    }

    public showEffect(displayID: number) {
        if (!this.displays.has(displayID)) {
            Logger.getInstance().error("DisplayObject not found: ", displayID);
            return;
        }
        const display = this.displays.get(displayID);
        // display.showEffect();
    }
}
