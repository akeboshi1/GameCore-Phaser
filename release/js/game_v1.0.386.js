(this.webpackJsonpTooqingCore=this.webpackJsonpTooqingCore||[]).push([[0],Array(111).concat([function(t,e,i){"use strict";i.d(e,"i",(function(){return s})),i.d(e,"g",(function(){return a})),i.d(e,"b",(function(){return h})),i.d(e,"c",(function(){return c})),i.d(e,"j",(function(){return l})),i.d(e,"e",(function(){return p})),i.d(e,"a",(function(){return d})),i.d(e,"d",(function(){return m})),i.d(e,"h",(function(){return u})),i.d(e,"f",(function(){return f}));var n=/^(http|https):/i,o=i(2),r=i(114),s=function(){function Url(){}return Url.getRes=function(t){return Object({debug:!0,api_root:"https://api-dev.tooqing.com/",osd:"https://osd-alpha.tooqing.com/",gateway:Object({host:"gdev.tooqing.com",port:11100,secure:!0}),game_id:"5cd8cf04cbcbf91a0afc3f96.5e410ba50681ad5557b4d6e9",virtual_world_id:"0"}).BUNDLE_RESOURCES_ROOT?Object({debug:!0,api_root:"https://api-dev.tooqing.com/",osd:"https://osd-alpha.tooqing.com/",gateway:Object({host:"gdev.tooqing.com",port:11100,secure:!0}),game_id:"5cd8cf04cbcbf91a0afc3f96.5e410ba50681ad5557b4d6e9",virtual_world_id:"0"}).BUNDLE_RESOURCES_ROOT+t:Url.RES_PATH+t},Url.getUIRes=function(t,e){return Object({debug:!0,api_root:"https://api-dev.tooqing.com/",osd:"https://osd-alpha.tooqing.com/",gateway:Object({host:"gdev.tooqing.com",port:11100,secure:!0}),game_id:"5cd8cf04cbcbf91a0afc3f96.5e410ba50681ad5557b4d6e9",virtual_world_id:"0"}).BUNDLE_RESOURCES_ROOT?Object({debug:!0,api_root:"https://api-dev.tooqing.com/",osd:"https://osd-alpha.tooqing.com/",gateway:Object({host:"gdev.tooqing.com",port:11100,secure:!0}),game_id:"5cd8cf04cbcbf91a0afc3f96.5e410ba50681ad5557b4d6e9",virtual_world_id:"0"}).BUNDLE_RESOURCES_ROOT+t+"x"+e:Url.RESUI_PATH+(t+"x/")+e},Url.getOsdRes=function(t){return Url.OSD_PATH?n.test(Url.OSD_PATH)?Url.OSD_PATH+t:"https://osd-alpha.tooqing.com/"+t:t},Url.OSD_PATH="",Url.RES_PATH="",Url.RESUI_PATH="",Url}(),a=function(){function ResUtils(){}return ResUtils.getPartName=function(t){return t+"_png"},ResUtils.getPartUrl=function(t){return n.test(s.OSD_PATH)?s.OSD_PATH+"avatar/part/"+t+".png":"https://osd-alpha.tooqing.com/avatar/part/"+t+".png"},ResUtils.getGameConfig=function(t){return n.test(t)?t:s.OSD_PATH+t},ResUtils}(),h=function(){function BlackButton(){}return BlackButton.getName=function(){return"black_button"},BlackButton.getPNG=function(){return s.getRes("ui/common/button.png")},BlackButton.getColumns=function(){return[4,2,4]},BlackButton.getRows=function(){return[4,2,4]},BlackButton.getConfig=function(){return{top:4,left:4,right:4,bottom:4}},BlackButton}(),c=function(){function BlueButton(){}return BlueButton.getName=function(){return"button_blue"},BlueButton.getPNG=function(){return s.getRes("ui/common/button_blue.png")},BlueButton.getJSON=function(){return s.getRes("ui/common/button_blue.json")},BlueButton.getColumns=function(){return[7,1,7]},BlueButton.getRows=function(){return[7,1,7]},BlueButton.getConfig=function(){return{left:7,top:7,right:7,bottom:7}},BlueButton}(),l=function(){function WhiteButton(){}return WhiteButton.getName=function(){return"button_white"},WhiteButton.getPNG=function(){return s.getRes("ui/common/button_white.png")},WhiteButton.getJSON=function(){return s.getRes("ui/common/button_white.json")},WhiteButton.getColumns=function(){return[7,1,7]},WhiteButton.getRows=function(){return[7,1,7]},WhiteButton.getConfig=function(){return{left:7,top:7,right:7,bottom:7}},WhiteButton}(),p=function(){function CloseButton(){}return CloseButton.getName=function(){return"common_clsBtn"},CloseButton.getPNG=function(){return s.getRes("ui/common/common_clsBtn.png")},CloseButton.getJSON=function(){return s.getRes("ui/common/common_clsBtn.json")},CloseButton.getFrameConfig=function(){return{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}},CloseButton}(),d=function(){function Background(){}return Background.getName=function(){return"common_background"},Background.getPNG=function(){return s.getRes("ui/common/common_panelBg.png")},Background.getColumns=function(){return[11,9,11]},Background.getRows=function(){return[14,13,14]},Background.getConfig=function(){return{left:10,top:15,right:10,bottom:15}},Background}(),m=function(){function Border(){}return Border.getName=function(){return"common_border"},Border.getPNG=function(){return s.getRes("ui/common/common_border.png")},Border.getColumns=function(){return[4,2,4]},Border.getRows=function(){return[4,2,4]},Border.getConfig=function(){return{left:4,top:4,right:4,bottom:4}},Border}(),u=function(){function TransparentButton(){}return TransparentButton.getName=function(){return"button_transparent"},TransparentButton.getPNG=function(){return s.getRes("ui/common/button_transparent.png")},TransparentButton.getJSON=function(){return s.getRes("ui/common/button_transparent.json")},TransparentButton.getConfig=function(){return{left:4,top:4,right:4,bottom:4}},TransparentButton}(),f=function(){function Coin(){}return Coin.getIcon=function(t){var e="tuding_icon",i=t;return i===o.op_def.CoinType.COIN?e="iv_coin":i===o.op_def.CoinType.DIAMOND?e="iv_diamond":i===o.op_def.CoinType.GOLD_COIN||i===o.op_def.CoinType.QING_SONG_TANG||o.op_def.CoinType.TU_DING_COIN,e},Coin.getName=function(t){var e="银币",i=t;return i===o.op_def.CoinType.COIN?e=r.a.t("coin.coin"):i===o.op_def.CoinType.DIAMOND?e=r.a.t("coin.diamond"):i===o.op_def.CoinType.GOLD_COIN?e=r.a.t("coin.gold_coin"):i===o.op_def.CoinType.QING_SONG_TANG||o.op_def.CoinType.TU_DING_COIN,e},Coin}()},function(t,e,i){"use strict";i.r(e),i.d(e,"BasePanel",(function(){return a}));var n,o=i(111),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function BasePanel(e,i){var n=t.call(this,e,i)||this;return n.mTweening=!1,n.mWidth=0,n.mHeight=0,n.mReloadTimes=0,n.mScene=e,n.mWorld=i,n.mInitialized=!1,i&&(n.dpr=Math.round(i.uiRatio||1),n.scale=n.mWorld.uiScale),n}return s(BasePanel,t),BasePanel.prototype.addResources=function(e,i){t.prototype.addResources.call(this,e,i),i.type&&this.scene.load[i.type]&&this.scene.load[i.type](e,o.i.getUIRes(i.dpr,i.texture),o.i.getUIRes(i.dpr,i.data))},Object.defineProperty(BasePanel.prototype,"scaleWidth",{get:function(){return this.scene.cameras.main.width/this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(BasePanel.prototype,"scaleHeight",{get:function(){return this.scene.cameras.main.height/this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(BasePanel.prototype,"cameraWidth",{get:function(){return this.scene.cameras.main.width},enumerable:!1,configurable:!0}),Object.defineProperty(BasePanel.prototype,"cameraHeight",{get:function(){return this.scene.cameras.main.height},enumerable:!1,configurable:!0}),BasePanel}(r.Panel)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(114),o=function(){function Font(){}return Object.defineProperty(Font,"DEFULT_FONT",{get:function(){return"en"===n.a.language?this.EN_MAINT:this.ZH_MAIN},enumerable:!1,configurable:!0}),Object.defineProperty(Font,"BOLD_FONT",{get:function(){return"en"===n.a.language?this.EN_BOLD:this.ZH_MAIN},enumerable:!1,configurable:!0}),Font.YAHEI_14_BOLD="bold 14px YaHei",Font.YAHEI_16_BOLD="bold 16px YaHei",Font.YAHEI_18_BOLD="bold 18px YaHei",Font.YAHEI_20_BOLD="bold 20px YaHei",Font.ZH_MAIN="Source Han Sans",Font.EN_MAINT="tt0503m_",Font.EN_BOLD="tt0173m_",Font.NUMBER="t04B25",Font}()},function(t,e,i){"use strict";i.d(e,"b",(function(){return initLocales})),i.d(e,"a",(function(){return s}));var n=i(426),o=i(405),r=i(406);function initLocales(t){return n.a.use(o.a).use(r.a).init({fallbackLng:"en",backend:{loadPath:t,crossDomain:!0}})}var s=n.a},function(t,e,i){"use strict";i.r(e),i.d(e,"UIAtlasName",(function(){return n})),i.d(e,"UIAtlasKey",(function(){return o}));var n=function(){function UIAtlasName(){}return UIAtlasName.commonUrl="common/ui_base",UIAtlasName.common2Url="ui_base2/ui_base2",UIAtlasName}(),o=function(){function UIAtlasKey(){}return UIAtlasKey.commonKey="common_key",UIAtlasKey.common2Key="common2_key",UIAtlasKey}()},function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicImage",(function(){return s}));var n,o=i(0),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function DynamicImage(e,i,n){return t.call(this,e,i,n,void 0)||this}return r(DynamicImage,t),DynamicImage.prototype.load=function(t,e,i,n){this.mLoadCompleteCallbak=i,this.mLoadErrorCallback=n,this.mLoadContext=e,this.scene?(this.mUrl=t,this.scene.textures.exists(t)?this.onLoadComplete(t):(this.scene.load.image(t,t),this.scene.load.on(Phaser.Loader.Events.FILE_COMPLETE,this.onLoadComplete,this),this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())):o.a.getInstance().fatal(DynamicImage.name+" Create failed does not exist")},DynamicImage.prototype.destroy=function(e){void 0===e&&(e=!1),this.mLoadCompleteCallbak=null,this.mLoadContext=null,this.mLoadErrorCallback=null,this.mUrl="",this.scene&&(this.scene.load.off(Phaser.Loader.Events.FILE_COMPLETE,this.onLoadComplete,this),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this)),t.prototype.destroy.call(this,e)},DynamicImage.prototype.onLoadComplete=function(t){if(t===this.mUrl&&(this.scene.load.off(Phaser.Loader.Events.FILE_COMPLETE,this.onLoadComplete,this),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.setTexture(this.mUrl),this.mLoadCompleteCallbak)){var e=this.mLoadCompleteCallbak;this.mLoadCompleteCallbak=null,e.call(this.mLoadContext),this.mLoadContext=null}},DynamicImage.prototype.onLoadError=function(t){if(this.mUrl===t.url&&this.mLoadErrorCallback){var e=this.mLoadErrorCallback;this.mLoadErrorCallback=null,e.call(this.mLoadContext),this.mLoadContext=null}},DynamicImage}(Phaser.GameObjects.Image)},function(t,e,i){"use strict";i.r(e),i.d(e,"NinePatch",(function(){return s}));var n,o=i(185),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function NinePatch(e,i,n,r,s,a,h,c){var l=t.call(this,e,i,n)||this;return l.config=c||l.scene.cache.custom.ninePatch.get(h?""+h:a),l.patchKey=1e3*Math.random()+"",l.config.top=Math.round(l.config.top),l.config.right&&(l.config.right=Math.round(l.config.right)),l.config.bottom&&(l.config.bottom=Math.round(l.config.bottom)),l.config.left&&(l.config.left=Math.round(l.config.left)),Object(o.normalizePatchesConfig)(l.config),l.setSize(r,s),l.setTexture(a,h),l}return r(NinePatch,t),NinePatch.prototype.resize=function(t,e){return t=Math.round(t),e=Math.round(e),this.config?this.width===t&&this.height===e?this:(t=Math.max(t,this.config.left+this.config.right+1),e=Math.max(e,this.config.top+this.config.bottom+1),this.setSize(t,e),void this.drawPatches()):this},NinePatch.prototype.setTexture=function(t,e){return this.originTexture=this.scene.textures.get(t),this.setFrame(e),this.originTexture.setFilter(Phaser.Textures.FilterMode.LINEAR),this},NinePatch.prototype.setFrame=function(t){return this.originFrame=this.originTexture.frames[t]||this.originTexture.frames[NinePatch.__BASE],this.createPatches(),this.drawPatches(),this},NinePatch.prototype.setSize=function(e,i){return t.prototype.setSize.call(this,e,i),this.finalXs=[0,this.config.left,this.width-this.config.right,this.width],this.finalYs=[0,this.config.top,this.height-this.config.bottom,this.height],this},NinePatch.prototype.setTint=function(t){return this.tint=t,this},NinePatch.prototype.setTintFill=function(t){return this.tint=t,this.tintFill=!0,this},Object.defineProperty(NinePatch.prototype,"tintFill",{get:function(){return this.first&&this.first.tintFill},set:function(t){this.each((function(e){return e.tintFill=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(NinePatch.prototype,"tint",{set:function(t){this.each((function(e){return e.setTintFill(t)})),this.internalTint=t},enumerable:!1,configurable:!0}),Object.defineProperty(NinePatch.prototype,"isTinted",{get:function(){return this.first&&this.first.isTinted},enumerable:!1,configurable:!0}),NinePatch.prototype.clearTint=function(){this.each((function(t){return t.clearTint()})),this.internalTint=void 0,this.tintFill=!1},NinePatch.prototype.destroy=function(){if(this.originTexture)for(var e=0,i=0;i<3;i++)for(var n=0;n<3;n++){var o=this.getPatchNameByIndex(e);this.originTexture.frames.hasOwnProperty(o)&&this.originTexture.remove(o),++e}t.prototype.destroy.call(this)},NinePatch.prototype.getPatchNameByIndex=function(t){return this.originFrame.name+NinePatch.patches[t]+this.patchKey},NinePatch.prototype.createPatches=function(){for(var t=[0,this.config.left,this.originFrame.width-this.config.right,this.originFrame.width],e=[0,this.config.top,this.originFrame.height-this.config.bottom,this.originFrame.height],i=0,n=0;n<3;n++)for(var o=0;o<3;o++)this.createPatchFrame(this.getPatchNameByIndex(i),t[o],e[n],t[o+1]-t[o],e[n+1]-e[n]),++i},NinePatch.prototype.drawPatches=function(){var t=this.tintFill;this.removeAll(!0);for(var e=0,i=0;i<3;i++)for(var n=0;n<3;n++){var o=this.originTexture.frames[this.getPatchNameByIndex(e)],r=new Phaser.GameObjects.Image(this.scene,0,0,o.texture.key,o.name);r.setOrigin(0),r.setPosition((1e3*this.finalXs[n]-this.width*this.originX*1e3)/1e3,(1e3*this.finalYs[i]-this.height*this.originY*1e3)/1e3),r.displayWidth=this.finalXs[n+1]-this.finalXs[n],r.displayHeight=this.finalYs[i+1]-this.finalYs[i],this.add(r),this.internalTint&&r.setTint(this.internalTint),r.tintFill=t,r.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),++e}},NinePatch.prototype.createPatchFrame=function(t,e,i,n,o){this.originTexture.frames.hasOwnProperty(t)||this.originTexture.add(t,this.originFrame.sourceIndex,this.originFrame.cutX+e,this.originFrame.cutY+i,n,o)},NinePatch.__BASE="__BASE",NinePatch.patches=["[0][0]","[1][0]","[2][0]","[0][1]","[1][1]","[2][1]","[0][2]","[1][2]","[2][2]"],NinePatch}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function Pos(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.depth=0|n}return Pos.prototype.add=function(t,e,i){return this.x+=t,this.x+=e,this.z+=i||0,this},Pos.prototype.equal=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.depth===this.depth},Pos.prototype.toString=function(){return"Pos >> x: "+this.x+", y: "+this.y+", z: "+this.z+", depth: "+this.depth},Pos.prototype.toPoint=function(){return new Phaser.Geom.Point(this.x,this.y)},Pos}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function MessageType(){}return MessageType.CREATE_ROLE="create_role",MessageType.APP_START="app_start",MessageType.EDITOR_CHANGE_MODE="editor_change_mode",MessageType.CLIENT_RESIZE="app_client_resize",MessageType.SCENE_INITIALIZED="SCENE_INITIALIZED",MessageType.SCENE_CLEARED="SCENE_CLEARED",MessageType.SCENE_CHANGE_TO="SCENE_CHANGE_TO",MessageType.SCENE_MOVE_TO="scene_move_to",MessageType.SCENE_MOVE_STOP="scene_move_stop",MessageType.CHANGE_ELEMENT_ANIMATION="change_element_animation",MessageType.CHANGE_CHARACTER_ANIMATION="change_character_animation",MessageType.CHAT_TO="chat_to",MessageType.SHOW_CHAT_BUBBLE="show_chat_bubble",MessageType.REMOVE_CHAT_BUBBLE="remove_chat_bubble",MessageType.PROMPT_ALERT="prompt_alert",MessageType.CHARACTER_TALING="characterTaling",MessageType.CHARACTER_SHUT_UP="characterShutUp",MessageType.QCLOUD_AUTH="qcloud_auth",MessageType.ENTER_SCENE="enter_scene",MessageType.SCENE_ADD_PLAYER="scene_add_player",MessageType.SCENE_REMOVE_PLAYER="scene_remove_player",MessageType.SCENE_UPDATE_PLAYER="scene_update_player",MessageType.SCENE_ADD_ELEMENT="scene_add_element",MessageType.SCENE_ADD_TERRAIN="scene_add_terrain",MessageType.SCENE_ADD_TERRAIN_END="scene_add_terrain_end",MessageType.SCENE_ADD_ALL_TERRAIN="scene_add_all_terrain",MessageType.SCENE_REMOVE_ELEMENT="scene_remove_element",MessageType.SCENE_REMOVE_TERRAIN="scene_remove_terrain",MessageType.SCENE_REMOVE_ALL_TERRAIN="scene_remove_all_terrain",MessageType.SCENE_MOUSE_FOLLOW="scene_mouse_follow",MessageType.SCENE_SELECT_ELEMENT="scene_select_element",MessageType.SCENE_FIXED_TO_ELEMENT="scene_fixed_to_element",MessageType.SCENE_UPDATE_ELEMENT="sceneUpdateElement",MessageType.SCENE_SYNCHRO_PACKAGE="sceneSynchroPackage",MessageType.SCENE_VISIBLE_GRID="sceneVisibleGrid",MessageType.PLAYER_SELECT_CHARACTER="player_select_character",MessageType.PLAYER_DATA_INITIALIZE="player_data_initialize",MessageType.SCENE_DATA_INITIALIZE="scene_data_initialize",MessageType.PACKAGE_ITEM_ADD="package_item_add",MessageType.PACKAGE_ITEM_REMOVE="package_item_remove",MessageType.PACKAGE_EXCHANGE_ITEM_POS="package_exchange_item_pos",MessageType.SCENE_BACKGROUND_CLICK="SCENE_BACKGROUND_CLICK",MessageType.CHANGE_SELF_AVATAR="CHANGE_SELF_AVATAR",MessageType.DRAG_TO_DROP="DRAG_TO_DROP",MessageType.DRAG_OVER_DROP="DRAG_OVER_DROP",MessageType.QUERY_PACKAGE="query_package",MessageType.SYNC_USER_BALANCE="syncUserBalance",MessageType.UPDATED_CHARACTER_PACKAGE="updatedCharacterPackage",MessageType.SHOW_EFFECT="showEffect",MessageType.EDIT_MODE_QUERY_PACKAGE="editModeQueryPackage",MessageType.PRESS_ELEMENT="PRESS_ELEMENT",MessageType.TURN_ELEMENT="turnElement",MessageType.RECYCLE_ELEMENT="recycleElement",MessageType.PUT_ELEMENT="putElement",MessageType.CANCEL_PUT="cancelPut",MessageType.EDIT_PACKAGE_EXPANED="editPackageExpaned",MessageType.EDIT_PACKAGE_COLLAPSE="editPackageCollapse",MessageType.SELECTED_DECORATE_ELEMENT="selectedDecorateElement",MessageType.CANCEL_DECORATE_ELEMENT="cancelDecorateElement",MessageType.ADD_ICON_TO_TOP="addIconToTop",MessageType.REMOVE_ICON_FROM_TOP="removeIconFromTop",MessageType.SHOW_UI="showUI",MessageType.SHOW_NOTICE="showNotice",MessageType}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function Handler(t,e,i,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=!1),this.once=!1,this._id=0,this.setTo(t,e,i,n)}return Handler.create=function(t,e,i,n){return void 0===i&&(i=null),void 0===n&&(n=!0),Handler._pool.length?Handler._pool.pop().setTo(t,e,i,n):new Handler(t,e,i,n)},Handler.prototype.setTo=function(t,e,i,n){return this._id=Handler._gid++,this.caller=t,this.method=e,this.args=i,this.once=n,this},Handler.prototype.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},Handler.prototype.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t instanceof Array?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},Handler.prototype.clear=function(){return this.caller=null,this.method=null,this.args=null,this},Handler.prototype.recover=function(){this._id>0&&(this._id=0,Handler._pool.push(this.clear()))},Handler._pool=[],Handler._gid=1,Handler}()},function(t,e,i){"use strict";i.r(e),i.d(e,"NinePatchButton",(function(){return s}));var n,o=i(117),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function NinePatchButton(e,i,n,r,s,a,h,c,l,p){var d=t.call(this,e,i,n)||this;return d.mScene=e,d.mKey=a,d.mFrame=h||"__BASE",d.initFrame(),d.setSize(r,s),d.mNingBg=new o.NinePatch(d.scene,0,0,r,s,a,d.mFrame_nrmal,l),d.add(d.mNingBg),p&&(d.btnData=p),d.mLabel=d.scene.make.text(void 0,!1).setOrigin(.5,.5).setSize(d.width,d.height).setAlign("center").setText(c),d.add(d.mLabel),d.setInteractive(new Phaser.Geom.Rectangle(0,0,r,s),Phaser.Geom.Rectangle.Contains),d.on("pointerdown",d.onPointerDown,d),d.on("pointerup",d.onPointerUp,d),d}return r(NinePatchButton,t),Object.defineProperty(NinePatchButton.prototype,"enable",{set:function(t){t?(this.mNingBg.clearTint(),this.mLabel.clearTint(),this.setInteractive()):(this.mNingBg.setTintFill(6710886),this.mLabel.setTintFill(7829367),this.removeInteractive())},enumerable:!1,configurable:!0}),NinePatchButton.prototype.getBtnData=function(){return this.btnData},NinePatchButton.prototype.setText=function(t){this.mLabel.setText(t)},NinePatchButton.prototype.getText=function(){return this.mLabel.text},NinePatchButton.prototype.setTextStyle=function(t){this.mLabel.setStyle(t)},NinePatchButton.prototype.setFontStyle=function(t){this.mLabel.setFontStyle(t)},NinePatchButton.prototype.setTextOffset=function(t,e){this.mLabel.setPosition(t,e)},NinePatchButton.prototype.setFrame=function(t){return this.mNingBg.setFrame(t),this},NinePatchButton.prototype.destroy=function(e){this.mLabel&&this.mLabel.destroy(),t.prototype.destroy.call(this,e)},NinePatchButton.prototype.setFrameNormal=function(t,e,i){return this.mFrame_nrmal=t,this.mFrame_down=e||t,this.mFrame_over=i||t,this.changeNormal(),this},NinePatchButton.prototype.changeNormal=function(){this.setFrame(this.mFrame_nrmal)},NinePatchButton.prototype.changeDown=function(){this.setFrame(this.mFrame_down)},NinePatchButton.prototype.changeOver=function(){this.setFrame(this.mFrame_over)},NinePatchButton.prototype.isExists=function(t){var e=this.scene.textures.get(this.mKey);return!(!e||!e.has(t))},NinePatchButton.prototype.onPointerDown=function(t){this.changeDown()},NinePatchButton.prototype.onPointerUp=function(t){this.changeNormal(),this.emit("click",t,this)},Object.defineProperty(NinePatchButton.prototype,"label",{get:function(){return this.mLabel},enumerable:!1,configurable:!0}),NinePatchButton.prototype.scaleHandler=function(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1},NinePatchButton.prototype.initFrame=function(){var t=this.mFrame?this.mFrame:this.mKey;this.mFrame_nrmal=t+"_normal";var e=t+"_down";this.isExists(e)||(e=t+"_normal"),this.mFrame_down=e;var i=t+"_over";this.isExists(i)||(i=t+"_normal"),this.mFrame_over=i},NinePatchButton}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.d(e,"d",(function(){return o})),i.d(e,"a",(function(){return r})),i.d(e,"c",(function(){return s})),i.d(e,"b",(function(){return A}));var n,o,r,s,a=i(153),h=i(141),c=i(2),l=i(0),p=i(118),d=i(175),m=i(176),u=i(111),f=i(113),y=i(109),g=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),_=function(t){function Bubble(e,i){var n=t.call(this,e)||this;return n.mMinWidth=0,n.mMinHeight=0,n.mScale=i,n.x=-40*i,n}return g(Bubble,t),Bubble.prototype.show=function(t,e){this.mChatContent=new y.BBCodeText(this.scene,0,4*this.mScale,t,{fontFamily:f.a.DEFULT_FONT,fontSize:14*this.mScale,color:"#000000",origin:{x:0,y:0},wrap:{width:200*this.mScale,mode:"character"}}),this.add(this.mChatContent);var i=36*this.mScale,n=60*this.mScale;this.mMinHeight=this.mChatContent.height+18*this.mScale,this.mMinHeight=this.mMinHeight<i?i:this.mMinHeight,this.mMinWidth=this.mChatContent.width+20*this.mScale,this.mMinWidth=this.mMinWidth<n?n:this.mMinWidth,this.mBubbleBg=new m.DynamicNinepatch(this.scene,this);var o=u.i.getOsdRes(e.bubbleResource||"platformitem/thumbnail/bubble_01.png");this.mBubbleBg.load(o,{width:this.mMinWidth,height:this.mMinHeight,key:o,columns:[34,2,32],rows:[42,2,9]},this.onComplete,this)},Bubble.prototype.tweenTo=function(t){this.mToY=t,this.scene.tweens.add({targets:this,y:t,alpha:1,duration:200})},Bubble.prototype.durationRemove=function(t,e,i){var n=this;this.mTweenCompleteCallback=e,this.mTweenCallContext=i,this.mRemoveDelay=setTimeout((function(){n.removeTween()}),t)},Bubble.prototype.removeTween=function(){var t=this,e=this.mToY-30;this.scene.tweens.add({targets:this,y:e,alpha:0,duration:200,onComplete:function(){t.mTweenCompleteCallback&&t.mTweenCompleteCallback.call(t.mTweenCallContext,t)}})},Bubble.prototype.destroy=function(){this.mChatContent&&this.mChatContent.destroy(!0),this.mChatContent=null,this.mMinWidth=0,this.mMinHeight=0,this.mToY=0,this.mTweenCompleteCallback=null,this.mTweenCallContext=null,this.mRemoveDelay&&clearTimeout(this.mRemoveDelay),t.prototype.destroy.call(this,!0)},Bubble.prototype.onComplete=function(t){if(t){t.setOrigin(0,0),this.addAt(t,0);this.getBounds();this.mChatContent.x=this.mMinWidth-this.mChatContent.width>>1,this.mChatContent.y=6+(this.mMinHeight-this.mChatContent.height>>1)}},Object.defineProperty(Bubble.prototype,"minWidth",{get:function(){return this.mMinWidth},enumerable:!1,configurable:!0}),Object.defineProperty(Bubble.prototype,"minHeight",{get:function(){return this.mMinHeight},enumerable:!1,configurable:!0}),Bubble}(Phaser.GameObjects.Container),P=i(116),v=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),w=function(t){function BubbleContainer(e,i){var n=t.call(this,e)||this;return n.mBubbles=[],n.mScale=i,n.mArrow=new P.DynamicImage(n.scene,0,0),n.mArrow.scale=i,n.mArrow.load(u.i.getRes("ui/chat/bubble_arrow.png")),n.add(n.mArrow),n}return v(BubbleContainer,t),BubbleContainer.prototype.addBubble=function(t,e){var i=this.createBubble(e),n=this.mBubbles.length,o=null,r=0;i.show(t,e);for(var s=n-1;s>=0;s--)r+=(o=this.mBubbles[s]).minHeight+5*this.mScale,o.tweenTo(-r);this.add(i),this.mArrow.y=4*this.mScale},BubbleContainer.prototype.follow=function(t){if(0!==this.mBubbles.length){var e=t.getPosition();e&&this.updatePos(e.x,e.y-110)}},BubbleContainer.prototype.updatePos=function(t,e){this.x=t*this.mScale,this.y=e*this.mScale},BubbleContainer.prototype.destroy=function(e){if(this.mBubbles){for(var i=null,n=this.mBubbles.length-1;n>=0;n--)(i=this.mBubbles[n])&&i.destroy();this.mBubbles=null,this.removeFormParent(),t.prototype.destroy.call(this,e)}},BubbleContainer.prototype.removeFormParent=function(){this.parentContainer&&this.parentContainer.remove(this)},BubbleContainer.prototype.createBubble=function(t){if(t){var e=new _(this.scene,this.mScale);this.mBubbles.push(e);var i=t.duration?t.duration:5e3;return e.durationRemove(i,this.onRemoveBubble,this),e}},BubbleContainer.prototype.onRemoveBubble=function(t){t&&(this.mBubbles=this.mBubbles.filter((function(e){return t!==e})),this.remove(t),t.destroy(),0===this.mBubbles.length&&this.removeFormParent())},BubbleContainer}(Phaser.GameObjects.Container),S=i(110),b=function b(){},C=i(119),T=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),I=function(t){function ShopEntity(e){var i=t.call(this)||this;return i.mWorld=e,i.mInitialize=!1,i.mConnect=i.mWorld.connection,i.addHandlerFun(c.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QUERY_PACKAGE,i.handlerQueryPackage),i.mShopModel=new b,i}return T(ShopEntity,t),ShopEntity.prototype.initialize=function(){return this.mInitialize},ShopEntity.prototype.register=function(){this.mConnect.addPacketListener(this)},ShopEntity.prototype.unRegister=function(){this.mConnect.removePacketListener(this)},ShopEntity.prototype.destroy=function(){this.unRegister(),this.mShopModel=null,this.mInitialize=!1,this.mConnect=null},ShopEntity.prototype.handlerQueryPackage=function(t){var e=t.content;this.mWorld.emitter.emit(C.a.QUERY_PACKAGE,e)},ShopEntity.NAME="ShopModel",ShopEntity}(S.PacketHandler),M=i(137),E=function(){function AIAction(){this.isBreak=!0,this.isEnd=!1}return AIAction.prototype.nextAction=function(){this.isEnd=!0,this.group&&this.group.nextAction()},AIAction.prototype.destroy=function(){this.owner=null,this.group=null},AIAction}(),k=function(){function ActionGroup(){}return ActionGroup.prototype.addAction=function(t){this.list||(this.list=[]),this.list.push(t)},ActionGroup.prototype.nextAction=function(){this.current&&(this.current.destroy(),this.current=null),this.list&&this.list.length>0&&(this.current=this.list.splice(0,1)[0],this.current.isEnd=!1,this.current.execute())},ActionGroup.prototype.setComplHandler=function(t){this.compHandler=t},ActionGroup.prototype.clear=function(){if(this.list){for(var t=0,e=this.list;t<e.length;t++){e[t].destroy()}this.list.length=0}this.current&&(this.current.destroy(),this.current=null)},ActionGroup.prototype.stopCurrentAction=function(){this.current&&(this.current.destroy(),this.current=null)},ActionGroup.prototype.isExecuting=function(){return!(!this.current||this.current.isEnd)},ActionGroup.prototype.hasLast=function(){return!(!this.list||0===this.list.length)},ActionGroup.prototype.breakAction=function(){for(var t=0,e=this.list;t<e.length;t++){e[t].destroy()}this.list.length=0,this.current&&this.current.isBreak&&(this.current.destroy(),this.current=null)},ActionGroup.prototype.destroy=function(){this.clear(),this.list=null,this.sleepAction&&(this.sleepAction.destroy(),this.sleepAction=null),this.compHandler&&(this.compHandler.clear(),this.compHandler=null)},ActionGroup}(),B=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),O=function(t){function AI(e){var i=t.call(this)||this;return i.owner=e,i.group=new k,i}return B(AI,t),AI.prototype.execute=function(){this.group.nextAction()},AI.prototype.nextAction=function(){this.group.nextAction()},AI.prototype.addAction=function(t,e){void 0===e&&(e=!1),t.group=this.group,t.owner=this.owner,e&&this.group.current&&this.group.current.isBreak&&this.group.stopCurrentAction(),this.group.addAction(t),this.group.isExecuting()||this.group.nextAction()},AI.prototype.breakAction=function(){this.group.breakAction()},AI.prototype.destroy=function(){this.group.destroy(),this.owner=null},AI}(E),D=i(44),R=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t.IDLE="idle",t.WALK="walk",t.RUN="run",t.ATTACK="attack",t.JUMP="jump",t.INJURED="injured",t.FAILED="failed",t.DANCE01="dance01",t.DANCE02="dance02",t.FISHING="fishing",t.GREET01="greet01",t.SIT="sit",t.LIE="lit",t.EMOTION01="emotion01"}(o||(o={})),function(t){t[t.north=0]="north",t[t.north_west=1]="north_west",t[t.west=2]="west",t[t.west_south=3]="west_south",t[t.south=4]="south",t[t.south_east=5]="south_east",t[t.east=6]="east",t[t.east_north=7]="east_north"}(r||(r={})),function(t){t[t.Diasble=0]="Diasble",t[t.Enable=1]="Enable",t[t.Interactive=2]="Interactive"}(s||(s={}));var x,A=function(t){function Element(e,i){var n=t.call(this,i?i.roomService:void 0)||this;return n.mElementManager=i,n.mAnimationName="",n.mMoveData={},n.mCurState=o.IDLE,n.mOffsetY=void 0,n.mMoving=!1,n.mDirty=!1,n.mAi=new O(n),e?(n.mId=e.id,n.model=e,n):n}return R(Element,t),Object.defineProperty(Element.prototype,"dir",{get:function(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"roomService",{get:function(){if(this.mElementManager)return this.mElementManager.roomService},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"id",{get:function(){return this.mId},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"model",{get:function(){return this.mModel},set:function(t){this.setModel(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"scene",{get:function(){if(this.mElementManager)return this.mElementManager.scene},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"ai",{get:function(){return this.mAi},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"eleMgr",{get:function(){if(this.mElementManager)return this.mElementManager},enumerable:!1,configurable:!0}),Element.prototype.load=function(t){this.mDisplayInfo=t,this.loadDisplayInfo()},Element.prototype.setModel=function(t){if(this.mModel=t,t&&(this.mQueueAnimations=void 0,this.load(this.mModel.displayInfo),this.mDisplay)){this.mModel.pos&&this.setPosition(this.mModel.pos),this.mDisplay.changeAlpha(this.mModel.alpha),this.getFollowObject(x.Nickname)&&this.showNickname(),this.setDirection(this.mModel.direction);var e=this.mDisplayInfo;this.mInputEnable===s.Interactive&&this.setInputEnable(this.mInputEnable),e&&e.shops&&(this.mShopEntity=new I(this.mElementManager.roomService.world),this.mShopEntity.register()),t.mountSprites&&t.mountSprites.length>0&&this.updateMounth(t.mountSprites),this.update()}},Element.prototype.updateModel=function(t){if(this.mModel.id===t.id){if(t.hasOwnProperty("avatar")&&(this.mModel.updateAvatar(t.avatar),this.load(this.mModel.displayInfo)),t.display&&t.animations&&(this.mModel.updateDisplay(t.display,t.animations),this.load(this.mModel.displayInfo)),t.hasOwnProperty("currentAnimationName")&&(this.play(t.currentAnimationName),this.setInputEnable(this.mInputEnable),this.mModel.setAnimationQueue(void 0)),t.hasOwnProperty("direction")&&this.setDirection(t.direction),t.hasOwnProperty("mountSprites")){var e=t.mountSprites;this.mergeMounth(e),this.updateMounth(e)}if(t.hasOwnProperty("point3f")){var i=t.point3f;this.setPosition(new p.a(i.x,i.y,i.z))}this.update()}},Element.prototype.scaleTween=function(){this.mDisplay&&this.mDisplay.scaleTween()},Element.prototype.play=function(t,e){if(this.mModel){if(this.mModel.currentAnimationName!==t&&(this.mModel.currentAnimationName=t),!this.mDisplay)return l.a.getInstance().warn("display can't initlized");void 0!==e&&(e=e>0?e-1:-1),this.mDisplay.play(this.model.currentAnimation,void 0,e)}else l.a.getInstance().error(Element.name+": sprite is empty")},Element.prototype.setQueue=function(t){var e=this;if(this.mModel){for(var i=[],n=0,r=t;n<r.length;n++){var s=r[n],a={name:s.animationName,playTimes:s.times};s.times>0&&(a.complete=function(){var t=e.model.animationQueue;t.shift();var i,n=o.IDLE;t.length>0&&(n=t[0].name,i=t[0].playTimes),e.play(n,i)}),i.push(a)}this.mModel.setAnimationQueue(i),i.length>0&&this.play(t[0].animationName,t[0].times)}},Element.prototype.setDirection=function(t){this.mDisplayInfo&&(this.mDisplayInfo.avatarDir=t),this.mDisplay&&this.model&&(this.model.direction=t,this.mDisplay.play(this.model.currentAnimation))},Element.prototype.getDirection=function(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},Element.prototype.changeState=function(t){this.mCurState!==t&&(this.mCurState=t,this.mDisplay&&(t||(t=o.IDLE),this.play(this.mCurState)))},Element.prototype.getState=function(){return this.mCurState},Element.prototype.getRenderable=function(){return this.mRenderable},Element.prototype.getDisplay=function(){return this.mDisplay},Element.prototype.update=function(){!1!==this.mDirty&&(this.mDirty=!1,this.mBubble&&this.mBubble.follow(this),this.mBlockable&&this.roomService.updateBlockObject(this),this.mFollowObjects&&this.mFollowObjects.forEach((function(t){return t.update()})))},Element.prototype.move=function(t){this.mElementManager&&this.mDisplay&&(this.mMoveData.arrivalTime=t.timestemp,this.mMoveData.posPath=[{x:t.destinationPoint3f.x,y:t.destinationPoint3f.y}],this._doMove())},Element.prototype.movePosition=function(t,e){if(this.mElementManager&&this.mDisplay){this.startMove(),t.depth||(t.depth=this.getDepth()),this.setPosition(t);var i=this.calculateDirectionByAngle(e);-1!==i&&i!==this.model.direction&&this.setDirection(i)}},Element.prototype.movePath=function(t){var e=this;if(this.mElementManager&&(this.mDisplay&&t.path)){this.mMoveData.arrivalTime=t.timestemp;for(var i=new p.a(this.mDisplay.x,this.mDisplay.y-this.offsetY),n=[],o=null,r=null,s=this.mElementManager.roomService.now(),a=0,h=0,c=t.path;h<c.length;h++){var l=c[h];(r=l.point3f).y===i.y&&r.x===i.x||(o=Math.atan2(r.y-i.y,r.x-i.x)*(180/Math.PI)),s+=a,a=l.timestemp-s,n.push({x:r.x,y:r.y,duration:a,onStartParams:o,onStart:function(t,i,n){e.onCheckDirection(n)}}),i=new p.a(r.x,r.y)}this.mMoveData.posPath=n,this._doMove()}},Element.prototype.startMove=function(){this.changeState(o.WALK)},Element.prototype.stopMove=function(){this.mMoving=!1,this.mDisplay&&(this.mMoveData&&this.mMoveData.posPath&&(this.mModel.setPosition(this.mDisplay.x,this.mDisplay.y),delete this.mMoveData.posPath,this.mMoveData.arrivalTime&&(this.mMoveData.arrivalTime=0),this.mMoveData.tweenLineAnim&&(this.mMoveData.tweenLineAnim.stop(),this.mMoveData.tweenLineAnim.destroy())),this.changeState(o.IDLE))},Element.prototype.getPosition=function(){var t;return this.mDisplay?(this.mRootMount?((t=this.mRootMount.getPosition()).x+=this.mDisplay.x,t.y+=this.mDisplay.y,t.z+=this.mDisplay.z):t=new p.a(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z),t):new p.a(0,0)},Element.prototype.setPosition=function(t){if(this.mMoving&&this.stopMove(),this.mDisplay&&t){if(this.mModel.setPosition(t.x,t.y),this.mRootMount)return;this.mDisplay.setPosition(t.x,t.y,t.z);var e=t.depth?t.depth:0;this.setDepth(e)}this.updateBlock(),this.update()},Element.prototype.getRootPosition=function(){return new p.a(this.mDisplay.x,this.mDisplay.y,0)},Element.prototype.showBubble=function(t,e){var i=this.mElementManager.scene;i&&(this.mBubble||(this.mBubble=new w(i,this.roomService.world.scaleRatio)),this.mBubble.addBubble(t,e),this.mBubble.follow(this),this.roomService.addToSceneUI(this.mBubble))},Element.prototype.clearBubble=function(){this.mBubble&&(this.mBubble.destroy(),this.mBubble=null)},Element.prototype.showNickname=function(){if(this.mDisplay&&this.model&&this.mDisplay.topPoint){var t=this.mRoomService.world.scaleRatio,e=this.getFollowObject(x.Nickname),i=null;e&&e.object?i=e.object:(i=this.scene.make.text({style:{fontSize:12*t,fontFamily:f.a.DEFULT_FONT}}).setOrigin(.5).setStroke("0x0",2*t),e=new L(i,this,t),this.addFollowObject(x.Nickname,e)),i.text=this.mModel.nickname,e.setOffset(0,this.mDisplay.topPoint.y),this.mDisplay.parentContainer&&this.roomService.addToSceneUI(i)}},Element.prototype.hideNickname=function(){this.removeFollowObject(x.Nickname)},Element.prototype.showEffected=function(t,e){if(t&&this.mDisplay){t.gene;this.mDisplay.load(t,M.a.Effect)}},Element.prototype.turn=function(){this.mModel&&(this.mModel.turn(),this.mDisplay&&this.mDisplay.play(this.mModel.currentAnimation))},Element.prototype.setAlpha=function(t){this.mDisplay&&this.mDisplay.setAlpha(t)},Element.prototype.mount=function(t){return this.mRootMount=t,this.mMoving&&this.stopMove(),this.disableBlock(),this.mDirty=!0,this},Element.prototype.unmount=function(){if(this.mRootMount&&this.mDisplay){var t=this.mRootMount.getPosition();t.x+=this.mDisplay.x,t.y+=this.mDisplay.y,this.mRootMount=null,this.setPosition(t),this.enableBlock(),this.mDirty=!0}return this},Element.prototype.addMount=function(t,e){return this.mMounts||(this.mMounts=[]),t.mount(this),this.mDisplay&&this.mDisplay.mount(t.getDisplay(),e),-1===this.mMounts.indexOf(t)&&this.mMounts.push(t),this},Element.prototype.removeMount=function(t){if(t.unmount(),!this.mMounts)return this;this.mDisplay&&this.mDisplay.unmount(t.getDisplay());var e=this.mMounts.indexOf(t);return e>-1&&this.mMounts.splice(e,1),this},Element.prototype.setState=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];switch(n.execCode){case c.op_def.ExecCode.EXEC_CODE_ADD:case c.op_def.ExecCode.EXEC_CODE_UPDATE:this.updateStateHandler(n);break;case c.op_def.ExecCode.EXEC_CODE_DELETE:this.removeStateHandler(n)}}},Element.prototype.getDepth=function(){var t=0;return this.model&&this.model.pos&&(t=this.model.pos.depth?this.model.pos.depth:0),t},Element.prototype.destroy=function(){this.mMoveData&&this.mMoveData.tweenAnim&&(this.mMoveData.tweenAnim.stop(),this.mMoveData.tweenAnim.remove(),this.mMoveData.tweenAnim=null,this.mMoveData=null),this.mDisplay&&(this.mBlockable&&this.roomService.removeBlockObject(this),this.mDisplay.destroy(),this.mDisplay=null),this.mBubble&&(this.mBubble.destroy(),this.mBubble=void 0),this.mShopEntity&&(this.mShopEntity.destroy(),this.mShopEntity=null),this.mAi&&(this.mAi.destroy(),this.mAi=null),this.mFollowObjects&&(this.mFollowObjects.forEach((function(t){return t.destroy()})),this.mFollowObjects.clear(),this.mFollowObjects=void 0),t.prototype.destroy.call(this)},Element.prototype._doMove=function(){var t=this;if(this.mMoveData.posPath){var e=this.mMoveData.tweenLineAnim;e&&(e.stop(),e.destroy());var i=this.mMoveData.posPath;this.mMoveData.tweenLineAnim=this.mElementManager.scene.tweens.timeline({targets:this.mDisplay,ease:"Linear",tweens:i,onStart:function(){t.onMoveStart()},onComplete:function(){t.onMoveComplete()},onUpdate:function(){t.onMoving()},onCompleteParams:[this]})}},Element.prototype.createDisplay=function(){if(this.mDisplayInfo){if(this.mDisplay)return this.mDisplay;var t=this.mElementManager.scene;if(t){"DragonbonesModel"===this.mDisplayInfo.discriminator?this.mDisplay=new a.a(t,this.mElementManager.roomService,this):this.mDisplay=new h.a(t,this.mElementManager.roomService,this);var e=this.mModel.pos;e&&this.mDisplay.setPosition(e.x,e.y,e.z),this.addToBlock()}return this.mDisplay}l.a.getInstance().error("displayinfo does not exist, Create "+this.model.nickname+" failed")},Element.prototype.loadDisplayInfo=function(){this.mDisplayInfo&&(this.mDisplay||this.createDisplay(),this.mDisplay.once("initialized",this.onDisplayReady,this),this.mDisplay.on("updateAnimation",this.onUpdateAnimationHandler,this),this.mDisplay.load(this.mDisplayInfo))},Element.prototype.addDisplay=function(){this.createDisplay();var t=this.roomService;if(t&&this.mDisplay){t.addToSurface(this.mDisplay);var e=0;this.model&&this.model.pos&&(e=this.model.pos.depth?this.model.pos.depth:0),this.mFollowObjects&&this.mFollowObjects.forEach((function(e){e.object&&t.addToSceneUI(e.object)})),this.setDepth(e)}},Element.prototype.removeDisplay=function(){t.prototype.removeDisplay.call(this),this.mFollowObjects&&this.mFollowObjects.forEach((function(t){return t.remove()}))},Element.prototype.setDepth=function(t){if(this.mDisplay){if(!this.roomService)throw new Error("roomService is undefined");var e=this.roomService.layerManager;if(!e)throw new Error("layerManager is undefined");e.depthSurfaceDirty=!0}},Element.prototype.onDisplayReady=function(t){if(this.mDisplay){this.mDisplay.play(this.model.currentAnimation),this.mModel.mountSprites&&this.mModel.mountSprites.length>0&&this.updateMounth(this.mModel.mountSprites);var e=0;this.model&&this.model.pos&&(e=this.model.pos.depth?this.model.pos.depth:0),this.setDepth(e)}},Element.prototype.onUpdateAnimationHandler=function(){this.mDisplay&&this.setInputEnable(this.mInputEnable)},Element.prototype.onMoveStart=function(){this.mMoving=!0},Element.prototype.onMoveComplete=function(){this.stopMove()},Element.prototype.onMoving=function(){var t=this.roomService.now();t-(this.mMoveData.tweenLastUpdate||0)>=50&&(this.setDepth(0),this.mMoveData.tweenLastUpdate=t),this.mDirty=!0},Object.defineProperty(Element.prototype,"offsetY",{get:function(){if(void 0===this.mOffsetY){if(!this.mElementManager||!this.mElementManager.roomService||!this.mElementManager.roomService.roomSize)return 0;this.mOffsetY=this.mElementManager.roomService.roomSize.tileHeight>>2}return 0},enumerable:!1,configurable:!0}),Element.prototype.onCheckDirection=function(t){if("number"==typeof t){var e=this.calculateDirectionByAngle(t);-1!==e&&this.setDirection(e)}},Element.prototype.calculateDirectionByAngle=function(t){return t>90?3:t>=0?5:t>=-90?7:1},Element.prototype.mergeMounth=function(t){for(var e=this.mModel.mountSprites||[],i=this.mRoomService,n=0,o=e;n<o.length;n++){var r=o[n];if(-1===t.indexOf(r)){var s=i.getElement(r);s&&this.removeMount(s)}}},Element.prototype.updateMounth=function(t){var e=this.mRoomService;if(t.length>0)for(var i=0;i<t.length;i++){var n=e.getElement(t[i]);n&&this.addMount(n,i)}this.mModel.mountSprites=t},Element.prototype.updateStateHandler=function(t){switch(t.name){case"effect":var e=D.Buffer.from(t.packet).readDoubleBE(0),i=this.roomService.effectManager.get(e);i.displayInfo?this.showEffected(i.displayInfo):i.once("updateDisplayInfo",this.showEffected,this)}},Element.prototype.removeStateHandler=function(t){switch(t.name){case"effect":this.mDisplay&&this.mDisplay.removeEffect(M.a.Effect)}},Element.prototype.addFollowObject=function(t,e){this.mFollowObjects||(this.mFollowObjects=new Map),this.mFollowObjects.set(t,e)},Element.prototype.removeFollowObject=function(t){if(this.mFollowObjects){var e=this.mFollowObjects.get(t);e&&(e.destroy(),this.mFollowObjects.delete(t))}},Element.prototype.getFollowObject=function(t){if(this.mFollowObjects)return this.mFollowObjects.get(t)},Element}(d.a),L=function(){function FollowObject(t,e,i){void 0===i&&(i=1),this.mDpr=i,this.mOffset=new Phaser.Geom.Point,this.mObject=t,this.mTarget=e}return FollowObject.prototype.setOffset=function(t,e){this.mOffset.setTo(t,e),this.update()},FollowObject.prototype.update=function(){if(this.mTarget&&this.mObject){var t=this.mTarget.getPosition();this.mObject.x=Math.round((t.x+this.mOffset.x)*this.mDpr),this.mObject.y=Math.round((t.y+this.mOffset.y)*this.mDpr)}},FollowObject.prototype.remove=function(){if(this.mObject){var t=this.mObject;t.parentContainer&&t.parentContainer.remove(t)}},FollowObject.prototype.destroy=function(){this.mObject&&this.mObject.destroy(),this.mObject=void 0},Object.defineProperty(FollowObject.prototype,"object",{get:function(){return this.mObject},enumerable:!1,configurable:!0}),FollowObject.prototype.linear=function(t,e,i){return(e-t)*i+t},FollowObject}();!function(t){t[t.Nickname=0]="Nickname"}(x||(x={}))},,function(t,e,i){"use strict";i.r(e),i.d(e,"IconBtn",(function(){return a}));var n,o=i(118),r=i(111),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function IconBtn(e,i,n){var o=t.call(this,e)||this;return o.mScene=e,o.mWorld=i,o.mBtnBg=e.make.image(void 0,!1),o.mBgResKey=n.bgResKey,o.mBgTexture=n.bgTextures,o.mData=n,!o.mScene.textures.exists(o.mBgResKey)&&n.pngUrl&&n.jsonUrl?(o.mScene.load.atlas(n.key,r.i.getRes(n.pngUrl),r.i.getRes(n.jsonUrl)),o.mScene.load.once(Phaser.Loader.Events.COMPLETE,o.loadComplete,o),o.mScene.load.start(),o):(o.loadComplete(),o)}return s(IconBtn,t),IconBtn.prototype.getKey=function(){return this.mData.key},IconBtn.prototype.setPos=function(t,e){this.mBasePos||(this.mBasePos=new o.a),this.mBasePos.x=t,this.mBasePos.y=e},IconBtn.prototype.getPos=function(){return this.mBasePos},IconBtn.prototype.setBtnData=function(t){this.mBtnData=t},IconBtn.prototype.getBtnData=function(){return this.mBtnData},IconBtn.prototype.setClick=function(t){this.monClick=t},IconBtn.prototype.destroy=function(){this.mBtnBg&&this.mBtnBg.destroy(!0),this.mBtnIcon&&this.mBtnIcon.destroy(!0),this.monClick=null,this.mBtnBg=null,this.mBtnIcon=null,this.mBtnData=null,this.mScene=null,t.prototype.destroy.call(this)},IconBtn.prototype.loadComplete=function(){this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[0]),this.mBtnBg.scaleX=this.mBtnBg.scaleY=this.mData.scale,this.addAt(this.mBtnBg,0),this.mData.iconResKey&&this.mData.iconTexture&&this.mData.iconTexture.length>0&&(this.mBtnIcon=this.mScene.make.image(void 0,!1),this.mBtnIcon.setTexture(this.mData.iconResKey,this.mData.iconTexture),this.add(this.mBtnIcon)),this.setSize(this.mBtnBg.width,this.mBtnBg.height),this.setInteractive(),this.on("pointerup",this.upHandler,this),this.on("pointerdown",this.downHandler,this),this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this)},IconBtn.prototype.overHandler=function(t){this.mBgTexture.length<2||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[1])},IconBtn.prototype.outHandler=function(t){this.mBgTexture.length<2||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[0])},IconBtn.prototype.upHandler=function(){this.monClick&&this.monClick(),this.mData&&this.mData.callBack&&this.mData.callBack.apply(this),this.emit("click",this),this.mBgTexture.length<3||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[2])},IconBtn.prototype.downHandler=function(){this.mBgTexture.length<4||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[3])},IconBtn.prototype.scaleHandler=function(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1},IconBtn}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"UIMediatorType",(function(){return n}));var n=function(){function UIMediatorType(){}return UIMediatorType.BagMediator="BagMediator",UIMediatorType.ChatMediator="ChatMediator",UIMediatorType.NOTICE="Notice",UIMediatorType.DIALOGO="DIALOGO",UIMediatorType.Turn_Btn_Top="Turn_Btn_Top",UIMediatorType.Turn_Btn_Bottom="Turn_Btn_Bottom",UIMediatorType.App_Back="App_Back",UIMediatorType.Editor_Save="Editor_Save",UIMediatorType.Editor_Cancel="Editor_Cancel",UIMediatorType.Close_Btn="Close_Btn",UIMediatorType.ControlF="ControlF",UIMediatorType.Storage="Storage",UIMediatorType.UserInfo="UserInfo",UIMediatorType.UserMenu="UserMenu",UIMediatorType.MessageBox="MessageBox",UIMediatorType.ComponentRank="ComponentRank",UIMediatorType.Rank="Rank",UIMediatorType.VoteResult="VoteResult",UIMediatorType.Shop="Shop",UIMediatorType.MineSettle="MineSettle",UIMediatorType.EquipUpgrade="EquipUpgrade",UIMediatorType}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var n=i(118),o=i(154),r=i(2),s=i(142),a=i(143),h=i(155),c=i(0),l=i(122),p=function(){function Sprite(t,e){if(this.mID=t.id,t.point3f){var i=t.point3f;this.mPos=new n.a(i.x,i.y,i.z)}this.mAttrs=t.attrs,t.avatar&&this.updateAvatar(t.avatar),t.display&&this.updateDisplay(t.display,t.animations,t.currentAnimationName),t.sn&&(this.mSn=t.sn),this.tryRegisterAnimation(t.animationRegistrationMap),this.mCurrentAnimationName=t.currentAnimationName,this.direction=t.direction||3,this.mNickname=t.nickname,this.mBindID=t.bindId,this.mAlpha=void 0===t.opacity?1:t.opacity/100,this.mDisplayBadgeCards=t.displayBadgeCards,this.mNodeType=e,t.version&&(this.mVersion=t.version),void 0!==t.isMoss&&(this.isMoss=t.isMoss),this.mMountSprites=t.mountSprites}return Sprite.prototype.toSprite=function(){var t=r.op_client.Sprite.create();if(t.id=this.id,t.nickname=this.mNickname,this.mDisplayInfo instanceof s.a){t.display=this.mDisplayInfo.display,t.currentAnimationName=this.currentAnimationName;var e=r.op_def.PBPoint3f.create();e.x=this.pos.x,e.y=this.pos.y,e.z=this.pos.z,t.point3f=e,t.animations=this.displayInfo.createProtocolObject()}return t.direction=this.direction,t.bindId=this.bindID,t.sn=this.sn,t.version=this.mVersion,t},Sprite.prototype.newID=function(){this.mID=h.a.genId()},Sprite.prototype.setPosition=function(t,e){this.mPos||(this.mPos=new n.a),this.mPos.x=t,this.mPos.y=e},Sprite.prototype.turn=function(){if(this.mDisplayInfo){var t=this.dirable(this.mCurrentAnimationName),e=t.indexOf(this.mDirection);return e>-1?this.direction=t[(e+1)%t.length]:c.a.getInstance().error(Sprite.name+": error dir "+this.mDirection),this}},Sprite.prototype.updateAvatar=function(t){this.mDisplayInfo&&this.mDisplayInfo.destroy(),this.mAvatar={id:t.id},this.mAvatar=Object.assign(this.mAvatar,t),this.mDisplayInfo=new o.a(this)},Sprite.prototype.updateDisplay=function(t,e,i){if(t&&e&&(this.mDisplayInfo&&this.mDisplayInfo.destroy(),t)){for(var n=[],o=0,r=e;o<r.length;o++){var h=r[o];n.push(new a.a(h))}i=i||this.mCurrentAnimationName||"",this.mDisplayInfo=new s.a({animations:{defaultAnimationName:i,display:t,animationData:n},id:this.id}),i&&(this.currentAnimationName=i)}},Sprite.prototype.setAnimationQueue=function(t){this.mAnimationQueue=t},Sprite.prototype.setMountSprites=function(t){this.mMountSprites=t},Sprite.prototype.updateAttr=function(t){this.mAttrs=t},Sprite.prototype.setAnimationName=function(t){return this.mDisplayInfo&&(this.mDisplayInfo.animationName=t),this.mCurrentAnimationName=t,this.setAnimationData(t,this.direction)},Object.defineProperty(Sprite.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"pos",{get:function(){return this.mPos},set:function(t){this.mPos=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"avatar",{get:function(){return this.mAvatar},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentAnimationName",{get:function(){return this.mCurrentAnimationName},set:function(t){this.mDisplayInfo&&(this.mDisplayInfo.animationName=t),this.mCurrentAnimationName=t,this.setAnimationData(t,this.direction)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"direction",{get:function(){return this.mDirection},set:function(t){this.mDirection=t||3,this.mDisplayInfo&&this.setAnimationData(this.mCurrentAnimationName,this.mDirection)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"nickname",{get:function(){return this.mNickname},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"bindID",{get:function(){return this.mBindID},set:function(t){this.mBindID=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"sn",{get:function(){return this.mSn},set:function(t){this.mSn=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"alpha",{get:function(){return this.mAlpha},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"package",{get:function(){return this.mPackage},set:function(t){this.mPackage=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"sceneId",{get:function(){return this.mSceneId},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"uuid",{get:function(){return this.mUuid},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"displayBadgeCards",{get:function(){return this.mDisplayBadgeCards},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"platformId",{get:function(){return this.mPlatformId},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"displayInfo",{get:function(){return this.mDisplayInfo},set:function(t){this.mDisplayInfo=t,this.currentAnimationName?(this.mDisplayInfo.animationName=this.currentAnimationName,this.setAnimationData(this.currentAnimationName,this.direction)):t.animationName&&(this.currentAnimationName=t.animationName)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"isMoss",{get:function(){return this.mIsMoss},set:function(t){this.mIsMoss=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"animationQueue",{get:function(){return this.mAnimationQueue},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"nodeType",{get:function(){return this.mNodeType},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentAnimation",{get:function(){return this.mCurrentAnimation},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentCollisionArea",{get:function(){return this.mCurrentCollisionArea||(this.mCurrentCollisionArea=this.getCollisionArea()),this.mCurrentCollisionArea},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentWalkableArea",{get:function(){return this.mCurrentWalkableArea||(this.mCurrentWalkableArea=this.getWalkableArea()),this.mCurrentWalkableArea},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentCollisionPoint",{get:function(){return this.mCurrentCollisionPoint||(this.mCurrentCollisionPoint=this.getOriginPoint()),this.mCurrentCollisionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"hasInteractive",{get:function(){if(!this.mDisplayInfo||!this.mCurrentAnimation)return!1;var t=this.mCurrentAnimation.name,e=this.mDisplayInfo.getInteractiveArea(t);return!!(e&&e.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"mountSprites",{get:function(){return this.mMountSprites},set:function(t){this.mMountSprites=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"animationMap",{get:function(){return this.mRegisterAnimation||(this.mRegisterAnimation=new Map),this.mRegisterAnimation},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"originCollisionPoint",{get:function(){return this._originCollisionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"originWalkPoint",{get:function(){return this._originWalkPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"attrs",{get:function(){return this.mAttrs},enumerable:!1,configurable:!0}),Sprite.prototype.setOriginCollisionPoint=function(t){void 0===this._originCollisionPoint&&(this._originCollisionPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originCollisionPoint.x=t[0],this._originCollisionPoint.y=t[1])},Sprite.prototype.setOriginWalkPoint=function(t){void 0===this._originWalkPoint&&(this._originWalkPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originWalkPoint.x=t[0],this._originWalkPoint.y=t[1])},Sprite.prototype.getInteracviveArea=function(){if(this.mDisplayInfo&&this.mCurrentAnimation){var t=this.mCurrentAnimation.name;return this.mDisplayInfo.getInteractiveArea(t)}},Sprite.prototype.setAnimationData=function(t,e){if(this.displayInfo&&t){var i=t.split("_")[0];return this.mRegisterAnimation&&this.mRegisterAnimation.has(i)&&(i=this.mRegisterAnimation.get(i)),this.mCurrentAnimation=this.displayInfo.findAnimation(i,e),this.mAnimationQueue&&this.mAnimationQueue.length>0&&(this.mCurrentAnimation.playingQueue=this.mAnimationQueue[0]),this.mCurrentCollisionArea&&this.setArea(),this.mCurrentAnimation}},Sprite.prototype.checkDirectionAnimation=function(t,e){var i=t+"_"+e;return this.mDisplayInfo.existAnimation(i)?i:null},Sprite.prototype.setArea=function(){this.mCurrentCollisionArea=this.getCollisionArea(),this.mCurrentWalkableArea=this.getWalkableArea(),this.mCurrentCollisionPoint=this.getOriginPoint()},Sprite.prototype.getCollisionArea=function(){if(this.mDisplayInfo&&this.mCurrentAnimation){var t=this.mCurrentAnimation,e=t.name,i=t.flip;return this.mDisplayInfo.getCollisionArea(e,i)}},Sprite.prototype.getWalkableArea=function(){if(this.mDisplayInfo&&this.mCurrentAnimation){var t=this.mCurrentAnimation,e=t.name,i=t.flip;return this.mDisplayInfo.getWalkableArea(e,i)}},Sprite.prototype.getOriginPoint=function(){if(this.mDisplayInfo&&this.mCurrentAnimation){var t=this.mCurrentAnimation,e=t.name,i=t.flip;return this.mDisplayInfo.getOriginPoint(e,i)}},Sprite.prototype.dirable=function(t){var e=t.split("_")[0],i=[3,5];return this.checkDirectionAnimation(e,l.a.east_north)&&i.push(7,1),i},Sprite.prototype.tryRegisterAnimation=function(t){if(t&&!(t.length<1)){this.mRegisterAnimation=new Map;for(var e=0,i=t;e<i.length;e++){var n=i[e];this.mRegisterAnimation.set(n.key,n.value)}}},Sprite}()},function(t,e,i){"use strict";i.r(e),i.d(e,"CheckboxGroup",(function(){return s}));var n,o=i(109),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function CheckboxGroup(){var e=t.call(this)||this;return e.mList=[],e}return r(CheckboxGroup,t),CheckboxGroup.prototype.appendItem=function(t){return this.mList.push(t),t.on(o.ClickEvent.Tap,this.onGameObjectUpHandler,this),this},CheckboxGroup.prototype.appendItemAll=function(t){this.mList=this.mList.concat(t);for(var e=0,i=t;e<i.length;e++){i[e].on(o.ClickEvent.Tap,this.onGameObjectUpHandler,this)}return this},CheckboxGroup.prototype.removeItem=function(t){return this.mList=this.mList.filter((function(e){return e!==t})),t.removeAllListeners(),this},CheckboxGroup.prototype.selectIndex=function(t){return t<0&&(t=0),t>=this.mList.length&&(t=this.mList.length-1),this.mList.length>0&&this.select(this.mList[t]),this},CheckboxGroup.prototype.select=function(t){this.mSelectedButton!==t&&(this.mSelectedButton&&this.mSelectedButton.changeNormal(),t.changeDown(),this.mSelectedButton=t,this.emit(o.ClickEvent.Selected,t))},CheckboxGroup.prototype.reset=function(){var t=this;this.mList&&this.mList.forEach((function(e){t.removeItem(e)}))},CheckboxGroup.prototype.destroy=function(){var e=this;this.mList&&this.mList.forEach((function(t){e.removeItem(t),t.destroy()})),t.prototype.destroy.call(this)},CheckboxGroup.prototype.onGameObjectUpHandler=function(t,e){this.select(e)},Object.defineProperty(CheckboxGroup.prototype,"selectedIndex",{get:function(){return this.mList.indexOf(this.mSelectedButton)},enumerable:!1,configurable:!0}),CheckboxGroup}(Phaser.Events.EventEmitter)},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),r=function(t){function BasicScene(e){var i=t.call(this,e)||this;return i.mInitialize=!1,i.mShow=!1,i}return o(BasicScene,t),BasicScene.prototype.create=function(){this.mInitialize=!0},BasicScene.prototype.sceneInitialize=function(){return this.mInitialize},BasicScene.prototype.getShow=function(){return this.mShow},BasicScene.prototype.setViewPort=function(t,e,i,n){this.cameras.main.setViewport(t,e,i,n)},BasicScene}(Phaser.Scene)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemInfoTips",(function(){return h}));var n,o=i(113),r=i(109),s=i(114),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ItemInfoTips(e,i,n,o,r,s,a){var h=t.call(this,e)||this;return h.setSize(i,n),h.key=o,h.dpr=s,h.config=a||{left:15*h.dpr,top:15*h.dpr,right:15*h.dpr,bottom:15*h.dpr},h.create(r),h}return a(ItemInfoTips,t),ItemInfoTips.prototype.setText=function(t){this.tipsText.text=t;var e=this.tipsText.height+20*this.dpr,i=this.tipsbg.width;this.setSize(i,e),this.tipsbg.resize(i,e),this.tipsbg.y=.5*-this.tipsbg.height,this.tipsText.y=-e+10*this.dpr},ItemInfoTips.prototype.setItemData=function(t){var e=this.getDesText(t);this.setText(e)},ItemInfoTips.prototype.create=function(t){var e=this.width,i=this.height,n=new r.NineSlicePatch(this.scene,0,0,e,i,this.key,t,this.config,void 0,void 0,0);n.setPosition(0,.5*-i),this.tipsbg=n;var s=new r.BBCodeText(this.scene,.5*-this.width+10*this.dpr,-i+60*this.dpr,"",{color:"#333333",fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,wrap:{width:this.width-15*this.dpr,mode:"string"}}).setOrigin(0);this.tipsText=s,this.add([n,s])},ItemInfoTips.prototype.getDesText=function(t){t||(t={sellingPrice:!0,tradable:!1});var e="[stroke=#2640CA][color=#2640CA][b]"+t.name+"[/b][/color][/stroke]\n",i="[stroke=#2640CA][color=#2640CA]"+s.a.t("common.source")+"[/color][/stroke]：";e+=(i+=t.source)+"\n";var n="[stroke=#2640CA][color=#2640CA]"+s.a.t("common.description")+"[/color][/stroke]：";return e+=n+=t.des},ItemInfoTips}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"DetailDisplay",(function(){return f}));var n,o=i(111),r=i(153),s=i(154),a=i(120),h=i(344),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function FrameAnimation(e){var i=t.call(this,e)||this;return i.loaded=!1,i.isPlaying=!1,i.loop=!1,i}return c(FrameAnimation,t),FrameAnimation.prototype.load=function(t,e,i,n){this.resName=t||e,this.resUrl=e,this.complHandler=n,this.animUrlData=new h.a,t?this.animUrlData.setData(this.resName,this.resUrl):this.animUrlData.setDisplayData(e,i),this.scene.load.atlas(this.resName,this.animUrlData.pngUrl,this.animUrlData.jsonUrl,this.animUrlData.textureXhrSettings,this.animUrlData.atlasXhrSettings),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.start()},FrameAnimation.prototype.play=function(t){this.curAniName=t||this.resName,this.isPlaying=!0,this.frameAnim&&this.frameAnim.play(this.curAniName)},FrameAnimation.prototype.destroy=function(){this.frameAnim&&this.frameAnim.destroy(),this.animUrlData&&this.animUrlData.dispose(),this.frameAnim=null,this.animUrlData=null,this.complHandler=void 0,this.isPlaying=!1},FrameAnimation.prototype.onLoadComplete=function(t,e,i){this.loaded=!0,this.scene.anims.exists(this.resName)||this.scene.anims.create({key:this.resName,frames:this.scene.anims.generateFrameNames(this.resName),repeat:-1}),this.frameAnim||(this.frameAnim=this.scene.add.sprite(0,0,this.resName),this.add(this.frameAnim)),0===this.width?(this.setSize(this.frameAnim.width,this.frameAnim.height),this.scale=1):this.scale=this.width/this.frameAnim.displayWidth,this.isPlaying||this.play(this.curAniName),this.complHandler&&this.complHandler.run()},FrameAnimation}(Phaser.GameObjects.Container),p=i(141),d=i(142),m=i(143),u=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),f=function(t){function DetailDisplay(e,i){void 0===i&&(i=!1);var n=t.call(this,e)||this;return n.mKeepScale=!1,n.mKeepScale=i,n}return u(DetailDisplay,t),DetailDisplay.prototype.loadDisplay=function(t){var e=t.display;e&&(""!==e.texturePath&&""!==e.dataPath?t.animations.length>0?this.loadElement(t):this.loadUrl(o.i.getOsdRes(e.texturePath),o.i.getOsdRes(e.dataPath)):this.loadUrl(e.texturePath,e.dataPath))},DetailDisplay.prototype.loadElement=function(t){var e=this;this.clearDisplay(),this.mDisplay=t;var i=t.animations;this.mFramesDisplay||(this.mFramesDisplay=new p.a(this.scene,void 0,void 0)),this.add(this.mFramesDisplay);var n=t.display;if(n&&i.length>0){for(var o=[],r=i[0].node.name,s=0,a=i;s<a.length;s++){var h=a[s];h.baseLoc="0,0";for(var c=0,l=h.layer;c<l.length;c++){l[c].offsetLoc={x:0,y:0}}o.push(new m.a(h))}this.mFramesDisplay.once("initialized",(function(){e.mFramesDisplay.play({name:r,flip:!1});var t=e.mFramesDisplay,i=t.spriteWidth,n=t.spriteHeight;if(e.mFramesDisplay.x=.5*-i,e.mFramesDisplay.y=.5*-n,e.mKeepScale){var o=e.width/i,s=e.height/n;e.mFramesDisplay.scale=o>s?s:o}else e.mFramesDisplay.scale=1})),this.mFramesDisplay.load(new d.a({animations:{display:n,defaultAnimationName:r,animationData:o},id:t.id}))}},DetailDisplay.prototype.loadAvatar=function(t,e,i){var n=this;void 0===e&&(e=1),this.clearDisplay(),this.mDragonboneDisplay||(this.mDragonboneDisplay=new r.a(this.scene,void 0,void 0,!0),i&&(this.mDragonboneDisplay.x+=i.x,this.mDragonboneDisplay.y+=i.y)),this.mDragonboneDisplay.once("initialized",(function(){n.mDragonboneDisplay.play({name:"idle",flip:!1})})),this.mDragonboneDisplay.load(new s.a({id:0,avatar:t.avatar})),this.mDragonboneDisplay.scale=e,this.add(this.mDragonboneDisplay)},DetailDisplay.prototype.loadUrl=function(t,e){this.mUrl=t,this.clearDisplay(),this.mImage||(this.mImage=this.scene.make.image(void 0,!1)),this.add(this.mImage),this.scene.textures.exists(t)?this.onCompleteHandler():(e?this.scene.load.atlas(t,o.i.getOsdRes(t),o.i.getOsdRes(e)):this.scene.load.image(t,o.i.getOsdRes(t)),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onCompleteHandler,this),this.scene.load.start())},DetailDisplay.prototype.loadSprite=function(t,e,i,n){var o=this;void 0===n&&(n=!1),this.clearDisplay(),this.frameAni||(this.frameAni=new l(this.scene)),this.mImage&&this.remove(this.mImage),this.scale=1,this.frameAni.load(t,e,i,new a.a(this,(function(){if(n){var t=o.width/o.frameAni.width,e=o.height/o.frameAni.height;o.frameAni.scale=t>e?e:t}else o.frameAni.scale=1}))),this.add(this.frameAni)},DetailDisplay.prototype.setTexture=function(t,e){if(this.clearDisplay(),this.mImage?this.mImage.setTexture(t,e):this.mImage=this.scene.make.image({key:t,frame:e},!1),this.add(this.mImage),this.emit("show",this.mImage),this.mKeepScale){this.mImage.scale=1;var i=this.width/this.mImage.displayWidth,n=this.height/this.mImage.displayHeight;this.mImage.scale=i>n?n:i}else this.mImage.scale=1,this.setSize(this.mImage.width*this.scale,this.mImage.height*this.scale)},DetailDisplay.prototype.setNearest=function(){this.mImage&&this.mImage.texture.setFilter(Phaser.Textures.FilterMode.NEAREST)},DetailDisplay.prototype.setComplHandler=function(t){this.complHandler=t},Object.defineProperty(DetailDisplay.prototype,"display",{get:function(){return this.mDisplay},enumerable:!1,configurable:!0}),DetailDisplay.prototype.onCompleteHandler=function(){if(this.scene){if(this.mDisplay){this.mDisplay.display;var t=this.mDisplay.animations;if(!t||t.length<=0)return;this.mImage.setTexture(this.mDisplay.display.texturePath,t[0].frameName[0])}else this.mImage.setTexture(this.mUrl);if(this.mKeepScale){this.mImage.scale=1;var e=this.width/this.mImage.displayWidth,i=this.height/this.mImage.displayHeight;this.mImage.scale=e>i?i:e}else this.setSize(this.mImage.width*this.scale,this.mImage.height*this.scale);this.emit("show",this.mImage),this.complHandler&&this.complHandler.run()}},DetailDisplay.prototype.clearDisplay=function(){this.mImage&&this.remove(this.mImage),this.mDragonboneDisplay&&(this.mDragonboneDisplay.destroy(),this.mDragonboneDisplay=void 0),this.mFramesDisplay&&(this.mFramesDisplay.destroy(),this.mFramesDisplay=void 0),this.mDisplay=void 0,this.frameAni&&(this.remove(this.frameAni),this.frameAni.destroy()),this.scene.load.off(Phaser.Loader.Events.COMPLETE,this.onCompleteHandler,this)},DetailDisplay}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n,o=i(179),r=i(111),s=i(0),a=i(128),h=i(113),c=i(24),l=i.n(c),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),__awaiter=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function fulfilled(t){try{step(n.next(t))}catch(t){r(t)}}function rejected(t){try{step(n.throw(t))}catch(t){r(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())}))},__generator=function(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function verb(r){return function(a){return function step(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},d=function(t){function LoadingScene(){var e=t.call(this,{key:LoadingScene.name})||this;return e.mRequestCom=!1,e}return p(LoadingScene,t),LoadingScene.prototype.preload=function(){var t=2;this.mWorld&&(t=this.mWorld.uiRatio||2),this.load.image("avatar_placeholder",r.i.getRes("dragonbones/avatar.png")),this.load.atlas("curtain",r.i.getUIRes(t,"loading/curtain.png"),r.i.getUIRes(t,"loading/curtain.json")),this.load.atlas("loading",r.i.getRes("ui/loading/loading.png"),r.i.getRes("ui/loading/loading.json")),this.load.script("webfont","./resources/scripts/webfont/1.6.26/webfont.js")},LoadingScene.prototype.init=function(t){this.createFont(),this.mWorld=t.world,this.mRoom=t.room,this.mRequestCom=!1,this.mCallback=t.callBack,this.tipsText=t.text},LoadingScene.prototype.create=function(){try{WebFont.load({custom:{families:["Source Han Sans","tt0173m_","tt0503m_","t04B25"]}})}catch(t){s.a.getInstance().warn("webfont failed to load")}var t=this.scale.gameSize.width,e=this.scale.gameSize.height;this.anims.create({key:"loading_anis",frames:this.anims.generateFrameNames("loading",{prefix:"loading_",start:1,end:3,zeroPad:1,suffix:".png"}),frameRate:5,repeat:-1});var i=this.mWorld.uiRatio;this.bg=this.add.sprite(.5*t,.5*e,"loading").setScale(this.mWorld.uiScale*i*2),this.bg.play("loading_anis"),this.curtain=new m(this,this.mWorld),this.progressText=this.add.text(this.bg.x,this.bg.y+.5*this.bg.displayHeight,this.tipsText,{fontSize:12*i,fontFamily:h.a.DEFULT_FONT}).setOrigin(.5);this.add.text(t-4*i,e-4*i,"v"+l.a+" "+this.getDebug(),{fontSize:12*i,fontFamily:h.a.DEFULT_FONT}).setOrigin(1);this.checkSize(new o.a(t,e)),this.mCallback&&(this.mCallback.call(this,this),this.mCallback=void 0),this.scale.on("resize",this.checkSize,this)},LoadingScene.prototype.show=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.awake(),this.curtain?(this.bg&&(this.bg.visible=!1),[2,this.curtain.open()]):[2,Promise.resolve()]}))}))},LoadingScene.prototype.close=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.mShow=!1,this.curtain?(this.bg&&(this.bg.visible=!1),[2,this.curtain.close()]):[2]}))}))},LoadingScene.prototype.awake=function(t){this.mShow=!0,this.scale.on("resize",this.checkSize,this),this.scene.wake(),t&&(this.tipsText=t.text,t.text&&this.progressText&&this.progressText.active&&this.progressText.setText(t.text))},LoadingScene.prototype.sleep=function(){var t=this;this.progressText&&this.progressText.active&&this.progressText.setText(""),this.curtain?(this.bg&&(this.bg.visible=!1),this.curtain.close().then((function(){t.scale.off("resize",t.checkSize,t),t.scene.sleep()}))):(this.scale.off("resize",this.checkSize,this),this.scene.sleep())},LoadingScene.prototype.appendProgress=function(t){this.progressText&&this.progressText.setText(t)},LoadingScene.prototype.getKey=function(){return this.sys.config.key},LoadingScene.prototype.getDebug=function(){var t="WebGL",e=this.game.config;e.renderType===Phaser.CANVAS?t="Canvas":e.renderType===Phaser.HEADLESS&&(t="Headless");var i=e.audio,n=this.game.device.audio;return"("+t+" | "+(!n.webAudio||i&&i.disableWebAudio?i&&i.noAudio||!n.webAudio&&!n.audioData?"No Audio":"HTML5 Audio":"Web Audio")+")"},LoadingScene.prototype.checkSize=function(t){},LoadingScene.prototype.createFont=function(){var t=document.createElement("style");document.head.appendChild(t);var e=t.sheet;e.insertRule("@font-face { font-family: 'tt0173m_'; src: url('./resources/fonts/en/tt0173m_.ttf') format('truetype');font-display:swap }\n",0),e.insertRule("@font-face { font-family: 'tt0503m_'; src: url('./resources/fonts/en/tt0503m_.ttf') format('truetype'); font-display:swap}\n",0),e.insertRule("@font-face { font-family: 't04B25'; src: url('./resources/fonts/04B.ttf') format('truetype'); font-display:swap}",0)},LoadingScene}(a.a),m=function(){function Curtain(t,e){this.scene=t,this.key="curtain",this.upDisplay=this.scene.add.image(0,0,this.key,"up.png").setOrigin(0).setVisible(!1).setScale(e.uiScale),this.downDisplay=this.scene.add.image(0,0,this.key,"down.png").setOrigin(0,1).setVisible(!1).setScale(e.uiScale)}return Curtain.prototype.open=function(){var t=this;return this.upDisplay.visible=!0,this.downDisplay.visible=!0,new Promise((function(e,i){if(t.scene.cameras.main){var n=t.scene.cameras.main.height;t.upDisplay.y=-t.upDisplay.displayHeight,t.downDisplay.y=n+t.downDisplay.displayHeight,t.upTween=t.scene.add.tween({targets:t.upDisplay,props:{y:0},duration:1e3}),t.downTween=t.scene.add.tween({targets:t.downDisplay,props:{y:n},duration:1e3,onComplete:function(){t.upDisplay.visible=!1,t.downDisplay.visible=!1,t.clearTween(),e()}})}else e()}))},Curtain.prototype.close=function(){var t=this;return this.downDisplay.visible=!0,this.upDisplay.visible=!0,new Promise((function(e,i){if(t.scene.cameras.main){var n=t.scene.cameras.main.height;t.upDisplay.y=0,t.downDisplay.y=n,t.upTween=t.scene.add.tween({targets:t.upDisplay,props:{y:-t.upDisplay.displayHeight},duration:1e3}),t.downTween=t.scene.add.tween({targets:t.downDisplay,props:{y:n+t.downDisplay.displayHeight},duration:1e3,onComplete:function(){t.downDisplay.visible=!1,t.upDisplay.visible=!1,t.clearTween(),e()}})}else e()}))},Curtain.prototype.destroy=function(){this.destroy()},Curtain.prototype.clearTween=function(){this.upTween&&(this.upTween.stop(),this.upTween=null),this.downTween&&(this.downTween.stop(),this.downTween=null)},Curtain}()},function(t,e,i){"use strict";i.r(e),i.d(e,"DragType",(function(){return o})),i.d(e,"DropType",(function(){return r})),i.d(e,"BagMediator",(function(){return p}));var n,o,r,s=i(119),a=i(0),h=i(192),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.DRAG_TYPE_SHORTCUT=1]="DRAG_TYPE_SHORTCUT",t[t.DRAG_TYPE_BAG=2]="DRAG_TYPE_BAG"}(o||(o={})),function(t){t[t.DROP_TYPE_SHORTCUT=1]="DROP_TYPE_SHORTCUT",t[t.DROP_TYPE_BAG=2]="DROP_TYPE_BAG"}(r||(r={}));var p=function(t){function BagMediator(e,i,n){var o=t.call(this)||this;return o.mPageNum=0,o.mLayerManager=e,o.world=i,o.mScene=n,o.mUIType=c.UIType.Normal,o}return l(BagMediator,t),BagMediator.prototype.resize=function(t,e){this.mView&&this.mView.resize(t,e)},BagMediator.prototype.isSceneUI=function(){return!1},BagMediator.prototype.isShow=function(){if(this.mView)return this.mView.isShow()},BagMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView||(this.mView=new h.BagPanel(this.mScene,this.world)),this.world.emitter.on(s.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.emitter.on(s.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.emitter.on(s.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mScene.input.on("gameobjectdown",this.onBtnHandler,this),e?this.world.roomManager.currentRoom.playerManager.actor.getBag().requestVirtualWorldQueryPackage(e[0].id,1,h.BagPanel.PageMaxCount):this.world.roomManager.currentRoom.playerManager.actor.getBag().requestVirtualWorldQueryPackage(this.world.roomManager.currentRoom.playerManager.actor.package.id,1,h.BagPanel.PageMaxCount),this.mView.show(e),this.mLayerManager.addToUILayer(this.mView),this.world.uiManager.checkUIState(BagMediator.NAME,!1),this.refrehView(),t.prototype.show.call(this,e))},BagMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},BagMediator.prototype.hide=function(){this.world.emitter.off(s.a.DRAG_TO_DROP,this.handleDrop,this),this.world.emitter.off(s.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.emitter.off(s.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.emitter.off(s.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),this.mView&&(this.mView.hide(),this.mView=null,this.world.uiManager.checkUIState(BagMediator.NAME,!0))},BagMediator.prototype.destroy=function(){this.world.emitter.off(s.a.DRAG_TO_DROP,this.handleDrop,this),this.world.emitter.off(s.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.emitter.off(s.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.emitter.off(s.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),this.mView&&(this.mView.destroy(),this.mView=null),this.mPageNum=0,this.mScene=null,this.world=null},BagMediator.prototype.handleDrop=function(t){var e=t[0];t[1].getDropType()===r.DROP_TYPE_BAG&&e.getDragType()===o.DRAG_TYPE_SHORTCUT&&a.a.getInstance().debug("背包拖到快捷栏了！！！")},BagMediator.prototype.refrehView=function(t){var e;if(t)e=t;else{var i=this.world.roomManager.currentRoom.playerManager.actor.package;if(null==i)return;e=i.items}this.setListData(e)},BagMediator.prototype.onBtnHandler=function(t,e){e instanceof c.InputText||this.mView&&this.mView.setBlur()},BagMediator.prototype.setListData=function(t){this.mView.setDataList()},BagMediator.prototype.handleSynchroPackage=function(){var t=this.world.roomManager.currentRoom.playerManager.actor.package.items;this.refrehView(t)},BagMediator.prototype.onUpdatePackageHandler=function(){var t=this.world.roomManager.currentRoom.playerManager.actor.package.items;this.refrehView(t)},BagMediator.NAME="BagMediator",BagMediator}(c.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemSlot",(function(){return h}));var n=i(2),o=i(145),r=i(110),s=i(111),a=i(158),h=function(){function ItemSlot(t,e,i,n,o,r,s,a,h,c,l){this.minitialize=!1,this.mWid=0,this.mHei=0,this.isTipBoo=!0,this.mScene=t,this.mWorld=e,this.toolTipCon=t.make.container(void 0,!1),this.toolTipCon.x=n,this.toolTipCon.y=o,i.add(this.toolTipCon),this.mResStr=r,this.mResPng=s,this.mResJson=a,this.mResSlot=h,this.mSubScriptRes=l,this.mSelectRes=c}return Object.defineProperty(ItemSlot.prototype,"hasTip",{get:function(){return this.isTipBoo},set:function(t){this.isTipBoo=t},enumerable:!1,configurable:!0}),ItemSlot.prototype.createUI=function(){this.onLoadCompleteHandler()},ItemSlot.prototype.getView=function(){return this.toolTipCon},ItemSlot.prototype.getBg=function(){return this.itemBG},ItemSlot.prototype.getIcon=function(){return this.mIcon},ItemSlot.prototype.dataChange=function(t){var e=this;if(this.minitialize)if(this.mData=t,this.mIcon){var i=void 0;if(this.mData&&this.mData.display){i=this.mData.display.texturePath;this.mData.des&&this.mData.des;this.setToolTipData(this.mData.name+this.mData.des)}else this.mIcon.icon.visible=!1;if(!i)return;this.mScene.textures.exists(s.i.getOsdRes(i))?this.mData&&(this.mIcon.icon.setTexture(s.i.getOsdRes(i)),this.mIcon.icon.visible=!0):this.mIcon.load(i,this,(function(){e.mData&&(e.mIcon.icon.visible=!0)}))}else this.mIcon.icon.visible=!1},ItemSlot.prototype.destroy=function(){this.mSubScriptSprite&&(this.mSubScriptSprite.destroy(!0),this.mSubScriptSprite=null),this.mSelectSprite&&(this.mSelectSprite.destroy(!0),this.mSelectSprite=null),this.mIcon&&this.mIcon.destroy(),this.toolTipCon&&(this.toolTipCon.destroy(),this.toolTipCon=null),this.toolTip&&(this.toolTip.destroy(),this.toolTip=null),this.mAnimationCon&&(this.mAnimationCon.destroy(!0),this.mAnimationCon=null),this.itemBG&&(this.itemBG.destroy(!0),this.itemBG=null),this.index=0,this.mData=null,this.mScene=null,this.mWorld=null,this.mResStr=null,this.mResPng=null,this.mResSlot=null,this.mResJson=null,this.mSubScriptRes=null,this.mSelectRes=null,this.mWorld=null,this.minitialize=!1,this.mWid=0,this.mHei=0,this.mData=null,this.isTipBoo=!0},ItemSlot.prototype.setToolTipData=function(t){this.toolTip&&this.toolTip.setToolTipData(t)},ItemSlot.prototype.onLoadCompleteHandler=function(){this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.toolTipCon.addAt(this.itemBG,0),this.toolTipCon.setSize(this.itemBG.width,this.itemBG.height),this.mIcon=new o.DragDropIcon(this.mScene,0,0),this.toolTipCon.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1),this.isTipBoo&&(this.toolTip=new a.ToolTip(this.mScene,"itemSlotTip",s.i.getRes("ui/toolTip/toolTip.json"),s.i.getRes("ui/toolTip/toolTip.png"),this.mWorld.uiScale)),this.toolTipCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.toolTipCon.on("pointerover",this.overHandler,this),this.toolTipCon.on("pointerout",this.outHandler,this),this.toolTipCon.on("pointerdown",this.downHandler,this),this.toolTipCon.on("pointerup",this.outHandler,this),this.minitialize=!0,this.mData&&this.dataChange(this.mData),this.mWid+=this.itemBG.width,this.mHei+=this.itemBG.height},ItemSlot.prototype.downHandler=function(t){if(this.mData&&this.mWorld.roomManager.currentRoom.playerManager.actor&&this.mWorld.roomManager.currentRoom&&this.mWorld.roomManager.currentRoom.playerManager){var e=this.mWorld.roomManager.currentRoom.playerManager.actor.package,i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),o=i.content;o.uiId=e.id,o.componentId=this.mData.id,this.mWorld.connection.send(i)}},ItemSlot.prototype.overHandler=function(t){this.toolTip&&this.mData&&(this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this.toolTip),this.toolTip.setToolTipData(this.mData.name+this.mData.des),this.toolTip.x=t.x,this.toolTip.y=t.y),this.mSelectRes&&this.mSelectRes.length>0&&(this.mSelectSprite=this.mScene.make.sprite(void 0,!1),this.mSelectSprite.play(this.mSelectRes),this.toolTipCon.add(this.mSelectSprite))},ItemSlot.prototype.outHandler=function(t){this.toolTip&&this.toolTip.parentContainer&&this.toolTip.parentContainer.remove(this.toolTip),this.mSelectSprite&&this.mSelectSprite.parentContainer&&(this.mSelectSprite.parentContainer.remove(this.mSelectSprite),this.mSelectSprite.destroy(!0),this.mSelectSprite=null)},ItemSlot}()},function(t,e,i){"use strict";i.r(e),i.d(e,"BaseFaceMediator",(function(){return s}));var n,o=i(109),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function BaseFaceMediator(e,i){var n=t.call(this)||this;return n.mScene=i,n.world=e,n.mUIType=o.UIType.Scene,n}return r(BaseFaceMediator,t),BaseFaceMediator.prototype.getView=function(){return this.mView},BaseFaceMediator.prototype.isSceneUI=function(){return!0},BaseFaceMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},BaseFaceMediator.prototype.resize=function(){var t=this.world.getSize(),e=this.getView();if(this.mView&&e.isShow())return this.mView.resize(t.width,t.height)},BaseFaceMediator.prototype.hide=function(){this.mShow=!1,this.mView&&this.mView.hide()},BaseFaceMediator.prototype.destroy=function(){t.prototype.destroy.call(this)},BaseFaceMediator}(o.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"AlertView",(function(){return l})),i.d(e,"Buttons",(function(){return o}));var n,o,r=i(112),s=i(113),a=i(114),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function AlertView(e,i){var n=t.call(this,e,i)||this;return n.key="pica_alert",n.disInteractive(),n}return c(AlertView,t),AlertView.prototype.show=function(e){if(this.mShowData=e,t.prototype.show.call(this,e),this.mInitialized){this.mWorld.uiManager.getUILayerManager().addToDialogLayer(this);var i=e.ox,n=e.oy;this.x=i||this.scene.cameras.main.width/2,this.y=n||this.scene.cameras.main.height/2,this.mContent.setText(e.text),e.title&&this.mTitleLabel.setText(e.title);var r=e.btns;r===o.Cancel?(this.remove(this.mOkBtn),this.mCancelBtn.x=0):r===o.Ok&&(this.remove(this.mCancelBtn),this.mOkBtn.x=0)}},AlertView.prototype.preload=function(){this.addAtlas(this.key,"pica_alert/pica_alert.png","pica_alert/pica_alert.json"),t.prototype.preload.call(this)},AlertView.prototype.setOKText=function(t){return this.mOkText=t,this.mOkBtn&&this.mOkBtn.setText(t),this},AlertView.prototype.init=function(){var e=this.mWorld.uiScale||1,i=this.scene.make.image({key:this.key,frame:"bg.png"},!1),n=this.scene.make.image({key:this.key,frame:"title.png"},!1);n.y=-i.height/2,this.mTitleLabel=this.scene.make.text({text:a.a.t("common.tips"),style:{fontFamily:s.a.DEFULT_FONT,fontSize:12*this.dpr*e,color:"#905B06"}},!1).setOrigin(.5),this.mTitleLabel.y=n.y,this.mContent=new h.BBCodeText(this.scene,0,-11*this.dpr,"",{fontSize:12*this.dpr*e+"px",fontFamily:s.a.DEFULT_FONT,color:"#0",wrap:{mode:"char",width:218*this.dpr}}),this.mContent.setOrigin(.5,.5),this.mOkBtn=new h.Button(this.scene,this.key,"yellow_btn.png",void 0,this.mOkText||a.a.t("common.confirm")),this.mOkBtn.setTextStyle({color:"#905B06",fontFamily:s.a.DEFULT_FONT,fontSize:13*this.dpr*e}),this.mOkBtn.x=(i.width-this.mOkBtn.displayWidth)/2-38*this.dpr,this.mOkBtn.y=(i.height-this.mOkBtn.displayHeight)/2-16*this.dpr,this.mOkBtn.on(h.ClickEvent.Tap,this.onOkHandler,this),this.mCancelBtn=new h.Button(this.scene,this.key,"red_btn.png",void 0,a.a.t("common.cancel")),this.mCancelBtn.setTextStyle({fontFamily:s.a.DEFULT_FONT,fontSize:13*this.dpr*e}),this.mCancelBtn.x=-(i.width-this.mCancelBtn.displayWidth)/2+38*this.dpr,this.mCancelBtn.y=this.mOkBtn.y,this.mCancelBtn.on(h.ClickEvent.Tap,this.onCancelHandler,this),this.add([i,n,this.mTitleLabel,this.mTitleLabel,this.mContent,this.mOkBtn,this.mCancelBtn]),t.prototype.init.call(this)},AlertView.prototype.onOkHandler=function(){if(this.mShowData){var t=this.mShowData.callback;t&&t.call(this.mShowData.content),this.onCancelHandler()}},AlertView.prototype.onCancelHandler=function(){this.parentContainer&&this.parentContainer.remove(this)},AlertView}(r.BasePanel);!function(t){t[t.Ok=0]="Ok",t[t.Cancel=1]="Cancel",t[t.OKAndCancel=2]="OKAndCancel"}(o||(o={}))},,function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return l}));var n,o,r=i(174),s=i(116),a=i(111),h=i(338),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.BACKEND=0]="BACKEND",t[t.STAGE=1]="STAGE",t[t.FRONTEND=2]="FRONTEND",t[t.FLAG=3]="FLAG",t[t.Effect=4]="Effect"}(o||(o={}));var l=function(t){function DisplayObject(e,i,n,o){void 0===o&&(o=!1);var r=t.call(this,e)||this;return r.mAlpha=1,r.mDirection=3,r.mAntial=!1,r.mElement=n,r.mRoomService=i,r.mAntial=o,r}return c(DisplayObject,t),DisplayObject.prototype.changeAlpha=function(t){this.mAlpha!==t&&(this.alpha=t,this.mAlpha=t)},DisplayObject.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this)},DisplayObject.prototype.fadeIn=function(t){},DisplayObject.prototype.fadeOut=function(t){},DisplayObject.prototype.load=function(t,e){},DisplayObject.prototype.play=function(t,e,i){},DisplayObject.prototype.mount=function(t,e){},DisplayObject.prototype.unmount=function(t){},DisplayObject.prototype.removeEffect=function(t){},DisplayObject.prototype.removeDisplay=function(t){},DisplayObject.prototype.destroy=function(e){this.mFlagContainer&&(this.mNickname&&(this.mNickname.destroy(),this.mNickname=void 0),this.mBackEffect&&(this.mBackEffect.destroy(),this.mBackEffect=void 0),this.mFrontEffect&&(this.mFrontEffect.destroy(),this.mFrontEffect=void 0),this.clearBadges(),this.mFlagContainer.destroy(),this.mFlagContainer=void 0),this.mReferenceArea&&(this.mReferenceArea.destroy(),this.mReferenceArea=void 0),this.mChildMap&&(this.mChildMap.clear(),this.mChildMap=null),t.prototype.destroy.call(this,e)},DisplayObject.prototype.setDisplayBadges=function(t){this.mBadges?this.clearBadges():this.mBadges=[];for(var e=0,i=t;e<i.length;e++){var n=i[e],o=new s.DynamicImage(this.scene,0,0);o.load(a.i.getOsdRes(n.thumbnail),this,this.layouFlag),this.flagContainer.add(o),this.mBadges.push(o)}},DisplayObject.prototype.showRefernceArea=function(){this.mReferenceArea||(this.mReferenceArea=new h.a(this.scene,this.mRoomService),this.addChildMap("reference",this.mReferenceArea)),!this.mCollisionArea||this.mCollisionArea.length<=0||(this.mReferenceArea.draw(this.mCollisionArea,this.mOriginPoint),this.addAt(this.mReferenceArea,0))},DisplayObject.prototype.hideRefernceArea=function(){this.mReferenceArea&&(this.mReferenceArea.destroy(),this.mReferenceArea=void 0)},DisplayObject.prototype.scaleTween=function(){},DisplayObject.prototype.showEffect=function(){this.addEffect(this.mBackEffect,a.i.getRes("ui/vip/vip_effect_back.png"),a.i.getRes("ui/vip/vip_effect_back.json"),!0,15,!1,!0),this.addEffect(this.mFrontEffect,a.i.getRes("ui/vip/vip_effect_front.png"),a.i.getRes("ui/vip/vip_effect_front.json"),!0,15,!1,!0)},DisplayObject.prototype.getElement=function(t){if(this.mChildMap)return this.mChildMap.get(t)},DisplayObject.prototype.addEffect=function(t,e,i,n,s,a,h){t||(t=new r.DynamicSprite(this.scene,0,0)),t.load(e,i),t.y=-20,n?this.addAt(t,o.BACKEND):this.addAt(t,o.FRONTEND),t.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,(function(){t.destroy()}))},DisplayObject.prototype.layouFlag=function(t){if(void 0===t&&(t=4),this.mFlagContainer){this.mFlagContainer.y=-96,this.bringToTop(this.mNickname);for(var e=0,i=0,n=this.mFlagContainer.list;i<n.length;i++){var o=n[i];o.x=e,o.width&&(e=o.width)}}},DisplayObject.prototype.clearBadges=function(){if(this.mBadges){for(var t=0,e=this.mBadges;t<e.length;t++){e[t].destroy()}this.mBadges.length=0}},Object.defineProperty(DisplayObject.prototype,"flagContainer",{get:function(){return this.mFlagContainer||(this.mFlagContainer=this.scene.make.container(void 0,!1),this.addAt(this.mFlagContainer,o.FLAG)),this.mFlagContainer},enumerable:!1,configurable:!0}),DisplayObject.prototype.addChildMap=function(t,e){this.mChildMap||(this.mChildMap=new Map),this.mChildMap.set(t,e)},DisplayObject.prototype.removeChildMap=function(t){this.mChildMap&&this.mChildMap.delete(t)},Object.defineProperty(DisplayObject.prototype,"topPoint",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"sortX",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"sortY",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"sortZ",{get:function(){return this.z||0},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"element",{get:function(){return this.mElement},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"collisionArea",{get:function(){return this.mCollisionArea},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"originPoint",{get:function(){return this.mOriginPoint},enumerable:!1,configurable:!0}),DisplayObject}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(118),o=function(){function Position45(){}return Position45.transformTo90=function(t,e){var i=e.rows*(e.tileWidth/2);return new n.a((t.x-t.y)*(e.tileWidth/2)+i,(t.x+t.y)*(e.tileHeight/2))},Position45.transformTo45=function(t,e){var i=e.rows*(e.tileWidth/2);return new n.a(Math.floor((t.y+t.z)/e.tileHeight+(t.x-i)/e.tileWidth),Math.floor((t.y+t.z)/e.tileHeight-(t.x-i)/e.tileWidth))},Position45}()},function(t,e,i){"use strict";i.r(e),i.d(e,"PicFriendRelation",(function(){return o})),i.d(e,"FriendRelationEnum",(function(){return n}));var n,o=function(){function PicFriendRelation(){}return PicFriendRelation.check=function(t,e,i){var o=n.Null;if(i.length>0){if(i[0].ban)return{id:e,relation:n.Blacklist};i[0].followed_user===e?o=n.Followed:i[0].followed_user===t&&(o=n.Fans),i.length>=2&&i[0].user===i[1].followed_user&&i[1].followed_user===i[0].user&&(o=n.Friend)}return{id:e,relation:o}},PicFriendRelation}();!function(t){t.Null="null",t.Friend="friend",t.Fans="fans",t.Followed="followed",t.Blacklist="blacklist"}(n||(n={}))},,function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n,o=i(0),r=i(137),s=i(111),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function FramesDisplay(){var e=null!==t&&t.apply(this,arguments)||this;return e.mDisplayDatas=new Map,e.mSprites=new Map,e.mDisplays=[],e}return a(FramesDisplay,t),FramesDisplay.prototype.load=function(t,e){var i=this;e=e||r.a.STAGE;var n=t;if(n&&n.gene){var a=this.mDisplayDatas.get(e);if(!a||a.gene!==t.gene)if(this.mDisplayDatas.set(e,n),this.setData("id",n.id),this.scene.textures.exists(n.gene))this.onLoadCompleted(e);else{var h=n.display;if(h||o.a.getInstance().error("display is undefined"),""===h.texturePath&&""===h.dataPath)o.a.getInstance().error("动画资源报错：",n);else{this.scene.load.atlas(n.gene,s.i.OSD_PATH+h.texturePath,s.i.OSD_PATH+h.dataPath);var cb_1=function(t){i.onAddTextureHandler(t,e,cb_1)};this.scene.textures.on(Phaser.Textures.Events.ADD,cb_1,this),this.scene.load.start()}}}},FramesDisplay.prototype.play=function(t,e,i){if(t){e=e||r.a.STAGE;var n=this.mDisplayDatas.get(e);if(!1!==this.scene.textures.exists(n.gene)&&(this.mCurAnimation=n.getAnimations(t.name),this.mCurAnimation)){this.clear();var o=this.mCurAnimation.layer,s=this.mSprites.get(r.a.STAGE);s||((s=this.scene.make.container(void 0,!1)).setData("id",n.id),this.addAt(s,r.a.STAGE),this.mSprites.set(r.a.STAGE,s));for(var a=0;a<o.length;a++){var h=void 0,c=o[a],l=c.frameName,p=c.offsetLoc;if(l.length>1){var d=n.gene+"_"+t.name+"_"+a;this.makeAnimation(n.gene,d,o[a].frameName,o[a].frameVisible,this.mCurAnimation);var m=(h=this.scene.make.sprite(void 0,!1)).anims;m.play(d),"number"==typeof i&&m.setRepeat(i),this.mMainSprite||(this.mMainSprite=h)}else h=this.scene.make.image(void 0,!1).setTexture(n.gene,l[0]);this.mDisplays.push(h),h.scaleX=t.flip?-1:1;var u=p.x,f=p.y;t.flip&&(u=0-(h.width+u)),h.x=u+.5*h.width,h.y=f+.5*h.height,s.add(h)}if(this.initBaseLoc(r.a.STAGE,t),this.emit("updateAnimation"),this.mMainSprite&&this.mMainSprite.on(Phaser.Animations.Events.ANIMATION_REPEAT,this.onAnimationRepeatHander,this),this.mMountContainer&&this.mCurAnimation.mountLayer){var y=this.mSprites.get(r.a.STAGE);y&&y.addAt(this.mMountContainer,this.mCurAnimation.mountLayer.index)}this.mActionName=t}}},FramesDisplay.prototype.playEffect=function(){var t=this.mDisplayDatas.get(r.a.Effect);if(t){var e=t.getAnimations("idle");if(e){for(var i=e.layer,n=[],o=0;o<i.length;o++){var s=void 0,a=i[o],h=a.frameName,c=a.offsetLoc;if(h.length>1){var l=t.gene+"_idle_"+o;this.makeAnimation(t.gene,l,i[o].frameName,i[o].frameVisible,e),s=this.scene.make.sprite(void 0,!1).play(l)}else s=this.scene.make.image(void 0,!1).setTexture(t.gene,h[0]);s.x=c.x+.5*s.width,s.y=c.y+.5*s.height,n.push(s)}n.length>1&&(this.addAt(n[1],r.a.BACKEND),this.mSprites.set(r.a.BACKEND,n[1])),this.addAt(n[0],r.a.FRONTEND),this.mSprites.set(r.a.FRONTEND,n[0])}}},FramesDisplay.prototype.mount=function(t,e){if(t&&!(this.mDisplays.length<=0)&&this.mCurAnimation)if(this.mCurAnimation.mountLayer){var i=this.mCurAnimation.mountLayer,n=i.index,s=i.mountPoint;if(void 0===e&&(e=0),e>=s.length)o.a.getInstance().error("mount index does not exist");else{var a=s[e].x;if(this.mActionName.flip&&(a=0-a),t.x=a,t.y=s[e].y,this.mMountContainer||(this.mMountContainer=this.scene.make.container(void 0,!1)),!this.mMountContainer.parentContainer){var h=this.mSprites.get(r.a.STAGE);h&&h.addAt(this.mMountContainer,n)}this.mMountContainer.addAt(t,e),this.mMountList[e]=t,this.mMainSprite&&(this.mMainSprite.off("animationupdate",this.onAnimationUpdateHandler,this),this.mMainSprite.on("animationupdate",this.onAnimationUpdateHandler,this))}}else o.a.getInstance().error("mountLyaer does not exist "+(this.element?this.element.id:0))},FramesDisplay.prototype.unmount=function(t){if(this.mMountContainer){this.mMountContainer.remove(t);var e=this.mMountList.indexOf(t);t.visible=!0,e>-1&&this.mMountList.splice(e,1),this.mMountContainer.list.length<=0&&this.mDisplays.length>0&&this.mDisplays[0].off("animationupdate",this.onAnimationUpdateHandler,this)}},FramesDisplay.prototype.fadeIn=function(t){0!==this.mAlpha&&(this.alpha=0,this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:this.mAlpha,duration:1200,onComplete:function(){t&&t()}}))},FramesDisplay.prototype.fadeOut=function(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:function(){t&&t()}})},FramesDisplay.prototype.scaleTween=function(){var t=this;if(!(this.mMountContainer&&this.mMountContainer.list.length>0||this.mScaleTween)){var e=this.scale;this.mScaleTween=this.scene.tweens.add({targets:this,duration:100,scale:1.25*e,yoyo:!0,repeat:0,onComplete:function(){t.scale=1,t.mScaleTween&&(t.mScaleTween=void 0)}})}},FramesDisplay.prototype.setInteractive=function(t,e,i){return this.mDisplays.forEach((function(t){t.setInteractive({pixelPerfect:!0})})),this},FramesDisplay.prototype.disableInteractive=function(){return this.mDisplays.forEach((function(t){t.disableInteractive()})),this},FramesDisplay.prototype.removeEffect=function(){this.mDisplayDatas.get(r.a.Effect)&&(this.mDisplayDatas.delete(r.a.Effect),this.removeDisplay(r.a.BACKEND),this.removeDisplay(r.a.FRONTEND))},FramesDisplay.prototype.removeDisplay=function(t){var e=this.mSprites.get(t);e&&(this.mDisplayDatas.delete(t),e.destroy())},FramesDisplay.prototype.destroy=function(){this.mSprites.forEach((function(t){return t.destroy()})),this.mSprites.clear(),this.clear(),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=void 0),this.mScaleTween&&(this.mScaleTween.stop(),this.mScaleTween=void 0),this.mDisplayDatas.clear(),t.prototype.destroy.call(this)},FramesDisplay.prototype.createDisplay=function(t,e){for(var i,n=e.layer,o=0;o<n.length;o++){if(n[o].frameName.length>1){i=this.scene.make.sprite(void 0,!1);e.name;this.makeAnimation(t,t,n[o].frameName,n[o].frameVisible,this.mCurAnimation),i=this.scene.make.sprite(void 0,!1)}else i=this.scene.make.image(void 0,!1);this.mDisplays.push(i)}},FramesDisplay.prototype.clearFadeTween=function(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())},FramesDisplay.prototype.clear=function(){for(var t=0,e=this.mDisplays;t<e.length;t++){e[t].destroy()}this.mMountContainer&&this.mMountContainer.parentContainer&&this.mMountContainer.parentContainer.remove(this.mMountContainer),this.mMountList=[],this.mDisplays=[],this.mMainSprite=null},FramesDisplay.prototype.onAddTextureHandler=function(t,e,i){void 0===e&&(e=r.a.STAGE);var n=this.mDisplayDatas.get(e);n&&n.gene===t&&(this.scene.textures.off(Phaser.Textures.Events.ADD,i,this),this.onLoadCompleted(e))},FramesDisplay.prototype.onLoadCompleted=function(t){var e=this.mDisplayDatas.get(t);e&&this.scene.textures.exists(e.gene)&&(t===r.a.STAGE?this.emit("initialized",this):this.playEffect())},FramesDisplay.prototype.makeAnimation=function(t,e,i,n,o){var r=o.loop;if(!(n&&i.length!==n.length||this.scene.anims.exists(e))){for(var s=[],a=0;a<i.length;a++){var h=i[a],c=!n||n[a];s.push({key:t,frame:h,visible:c})}var l=r?-1:0,p={key:e,frames:s,frameRate:o.frameRate,repeat:l};this.scene.anims.create(p)}},FramesDisplay.prototype.initBaseLoc=function(t,e){var i=this.mDisplayDatas.get(t);if(!(this.mDisplays.length<1)&&i&&i.animations){var n=e.name,o=e.flip;this.mCollisionArea=i.getCollisionArea(n,o),this.mOriginPoint=i.getOriginPoint(n,o),this.mReferenceArea&&this.showRefernceArea()}},FramesDisplay.prototype.onAnimationRepeatHander=function(){var t=this.mActionName.playingQueue;void 0===t.playedTimes?t.playedTimes=1:t.playedTimes++,t.playedTimes>=t.playTimes&&(this.mMainSprite&&this.mMainSprite.off(Phaser.Animations.Events.ANIMATION_REPEAT,this.onAnimationRepeatHander,this),t.complete&&(t.complete.call(this),delete t.complete))},FramesDisplay.prototype.onAnimationUpdateHandler=function(t,e){if(this.mMountContainer&&this.mCurAnimation){var i=this.mCurAnimation.mountLayer.frameVisible;if(i){var n=e.index-1;if(!(n>i.length))for(var o=0;o<this.mMountList.length;o++)this.mMountList[o].visible=this.getMaskValue(i[n],o)}}},FramesDisplay.prototype.getMaskValue=function(t,e){return(t>>e)%2==1},Object.defineProperty(FramesDisplay.prototype,"spriteWidth",{get:function(){var t=0;if(this.mDisplays)for(var e=0,i=this.mDisplays;e<i.length;e++){var n=i[e];n.width>t&&(t=n.width)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(FramesDisplay.prototype,"spriteHeight",{get:function(){var t=0;if(this.mDisplays)for(var e=0,i=this.mDisplays;e<i.length;e++){var n=i[e];n.height>t&&(t=n.height)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(FramesDisplay.prototype,"topPoint",{get:function(){return new Phaser.Geom.Point(0,-this.spriteHeight)},enumerable:!1,configurable:!0}),FramesDisplay}(r.b)},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(2),o=i(0),r=i(407),s=i(155),a=i(126),h=i(122),c=function(){function FramesModel(t){this.discriminator="FramesModel",this.id=t.id||0,this.type=t.sn||"";var e=t.animations;e&&(this.animationName=e.defaultAnimationName,this.setDisplay(e.display),this.setAnimationData(e.animationData))}return FramesModel.prototype.setInfo=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},FramesModel.prototype.getAnimationData=function(){return this.animations},FramesModel.prototype.existAnimation=function(t){return!!this.animations&&this.animations.has(t)},FramesModel.prototype.getAnimations=function(t){if(this.animations)return this.animations.get(t)},FramesModel.prototype.destroy=function(){this.animations&&this.animations.clear()},Object.defineProperty(FramesModel.prototype,"gene",{get:function(){return this.mGen},enumerable:!1,configurable:!0}),FramesModel.prototype.createProtocolObject=function(){var t=[];return this.animations.forEach((function(e){t.push(e.createProtocolObject())}),this),t},FramesModel.prototype.getCollisionArea=function(t,e){void 0===e&&(e=!1);var i=this.getAnimations(t);if(i)return e?s.a.flipArray(i.collisionArea):i.collisionArea},FramesModel.prototype.getWalkableArea=function(t,e){void 0===e&&(e=!1);var i=this.getAnimations(t);return e?s.a.flipArray(i.walkableArea):i.walkableArea},FramesModel.prototype.getInteractiveArea=function(t){var e=this.getAnimations(t);return e?e.interactiveArea:void 0},FramesModel.prototype.getOriginPoint=function(t,e){void 0===e&&(e=!1);var i=this.getAnimations(t);if(i){var n=i.originPoint;return e?new Phaser.Geom.Point(n.y,n.x):n}},FramesModel.prototype.getDirable=function(){},FramesModel.prototype.createSprite=function(t){var e=t.nodeType,i=t.x,o=t.y,r=t.z,h=t.id,c=t.dir,l=t.isMoss,p=n.op_client.Sprite.create();p.id=h||s.a.genId(),p.display=this.display,p.currentAnimationName=this.animationName;var d=n.op_def.PBPoint3f.create();return d.x=i,d.y=o,r&&(d.z=r),p.point3f=d,p.animations=this.createProtocolObject(),c&&(p.direction=c),void 0!==l&&(p.isMoss=l),new a.a(p,e)},FramesModel.prototype.findAnimation=function(t,e){var i=this.checkDirectionAnimation(t,e),n=!1;if(i)return{name:i,flip:n};switch(e){case h.a.west_south:case h.a.east_north:i=this.getDefaultAnimation(t);break;case h.a.south_east:i=this.getDefaultAnimation(t),n=!0;break;case h.a.north_west:null===(i=this.checkDirectionAnimation(t,h.a.east_north))&&(i=this.getDefaultAnimation(t)),n=!0}return{name:i,flip:n}},FramesModel.prototype.setDisplay=function(t){t?(this.display={dataPath:t.dataPath,texturePath:t.texturePath},this.mGen=r.sync(t.dataPath+t.texturePath)):o.a.getInstance().error(this.type+" display does not exist")},FramesModel.prototype.setAnimationData=function(t){if(t){this.animations=new Map;for(var e=0,i=t;e<i.length;e++){var n=i[e];this.animations.set(n.name,n)}}else o.a.getInstance().error(this.id+" animationData does not exist")},FramesModel.prototype.checkDirectionAnimation=function(t,e){var i=t+"_"+e;return this.existAnimation(i)?i:null},FramesModel.prototype.getDefaultAnimation=function(t){var e=this.checkDirectionAnimation(t,h.a.west_south);return null===e&&(this.existAnimation(t)?e=t:(o.a.getInstance().warn(FramesModel.name+": can't find animation "+t),e="idle")),e},FramesModel}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(2),o=function(){function Animation(t){var e=t.baseLoc.split(",");this.mNode=t.node,this.mID=t.node.id,this.mName=t.node.name,this.mFrameName=t.frameName,!t.frameName||this.mFrameName.length,this.mLoop=t.loop,t.loop,t.frameRate,t.originPoint,t.baseLoc,this.mFrameRate=t.frameRate,this.mBaseLoc=new Phaser.Geom.Point(parseInt(e[0],10),parseInt(e[1],10));var i=t.originPoint;this.mOriginPoint=new Phaser.Geom.Point(i[0],i[1]),"string"==typeof t.collisionArea?this.mCollisionArea=this.stringToArray(t.collisionArea,",","&")||[[0]]:this.mCollisionArea=t.collisionArea||[[0]],"string"==typeof t.walkableArea?this.mWalkableArea=this.stringToArray(t.walkableArea,",","&")||[[0]]:this.mWalkableArea=t.walkableArea||[[0]],this.mInteractiveArea=t.interactiveArea,this.mLayer=t.layer,this.mMountLayer=t.mountLayer}return Animation.prototype.createProtocolObject=function(){var t=n.op_gameconfig_01.AnimationData.create();t.node=this.mNode,t.baseLoc=this.baseLoc.x+","+this.baseLoc.y,t.node.name=this.name,t.loop=this.loop,t.frameRate=this.frameRate,t.frameName=this.frameName,t.originPoint=[this.originPoint.x,this.originPoint.y],t.walkOriginPoint=[this.originPoint.x,this.originPoint.y],t.walkableArea=this.arrayToString(this.mWalkableArea,",","&"),t.collisionArea=this.arrayToString(this.mCollisionArea,",","&"),t.interactiveArea=this.mInteractiveArea;for(var e=[],i=0,o=this.mLayer;i<o.length;i++){var r=o[i];e.push(n.op_gameconfig_01.AnimationLayer.create(r))}return t.layer=e,t.mountLayer=this.mMountLayer,t},Animation.prototype.stringToArray=function(t,e,i){if(t){for(var n=[],o=0,r=t.split(i);o<r.length;o++){var s=r[o].split(e);n.push(s.map((function(t){return parseInt(t,10)})))}return n}},Animation.prototype.arrayToString=function(t,e,i){if(!t)return"";for(var n=[],o=0,r=t;o<r.length;o++){var s=r[o];n.push(s.join(e))}return n.join(i)},Object.defineProperty(Animation.prototype,"baseLoc",{get:function(){return this.mBaseLoc},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"frameName",{get:function(){return this.mFrameName},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"frameRate",{get:function(){return this.mFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"loop",{get:function(){return this.mLoop},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"name",{get:function(){return this.mName},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"collisionArea",{get:function(){return this.mCollisionArea},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"walkableArea",{get:function(){return this.mWalkableArea},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"originPoint",{get:function(){return this.mOriginPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"interactiveArea",{get:function(){return this.mInteractiveArea},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"layer",{get:function(){return this.mLayer.length>0?this.mLayer:[{frameName:this.mFrameName,offsetLoc:this.mBaseLoc}]},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"mountLayer",{get:function(){return this.mMountLayer},enumerable:!1,configurable:!0}),Animation}()},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatMediator",(function(){return d}));var n,o=i(110),r=i(2),s=i(0),a=i(184),h=i(186),c=i(187),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function ChatMediator(e,i){var n=t.call(this)||this;return n.mInRoom=!1,n.mAllMessage=[],n.mMaxMessageNum=50,n.world=e,n.mScene=i,n.chat=new c.Chat(e),n.mUIType=n.world.game.device.os.desktop?l.UIType.Scene:l.UIType.Normal,n}return p(ChatMediator,t),ChatMediator.prototype.getUIType=function(){return this.mUIType},ChatMediator.prototype.enterRoom=function(){if(this.room&&this.room.playerManager.actor&&this.mGMEApi){this.room.playerManager.actor.id;var t=this.room.id;this.mGMEApi.EnterRoom(t.toString(),1,this.mQCLoudAuth),this.mInRoom=!0,this.sendVoiceRoomStatus(r.op_def.ChatChannel.CurrentScene,t,r.op_def.VoiceRoomStatus.InVoiceRoom)}},ChatMediator.prototype.exitRoom=function(){this.mGMEApi&&(this.mGMEApi.EnableMic(!1),this.mGMEApi.ExitRoom(),this.mInRoom=!1,this.room&&this.sendVoiceRoomStatus(r.op_def.ChatChannel.CurrentScene,this.room.id,r.op_def.VoiceRoomStatus.OutsideVoiceRoom))},ChatMediator.prototype.isSceneUI=function(){return!0},ChatMediator.prototype.tweenView=function(t){this.mView&&this.mView.tweenExpand(t)},ChatMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ChatMediator.prototype.showing=function(){return!0},ChatMediator.prototype.resize=function(){var t=this.world.getSize();this.mView&&this.mView.resize(t.width,t.height)},ChatMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||(this.world.game.device.os.desktop?this.mView=new a.ChatPanelPC(this.mScene,this.world):(this.mView=new h.ChatPanelMobile(this.mScene,this.world),this.world.uiManager.checkUIState(ChatMediator.NAME,!1)),this.world.uiManager.getUILayerManager().addToUILayer(this.mView),this.addListen(),this.mView.show(),this.mView.scale=this.world.uiScale)},ChatMediator.prototype.update=function(t){this.mView.update(t),this.mParam=t},ChatMediator.prototype.hide=function(){this.removeListen(),this.mView.hide(),this.world.game.device.os.desktop||this.world.uiManager.checkUIState(ChatMediator.NAME,!0)},ChatMediator.prototype.setParam=function(t){this.mParam=t},ChatMediator.prototype.getParam=function(){return this.mParam},ChatMediator.prototype.destroy=function(){this.removeListen(),this.chat&&(this.chat.unregister(),this.chat=null),this.mGMEApi&&(this.mGMEApi=null),this.mScene=null,this.world=null,this.mInRoom=!1,this.mQCLoudAuth=null,this.mAllMessage.forEach((function(t){t&&(t=null)})),this.mAllMessage=null,t.prototype.destroy.call(this)},ChatMediator.prototype.addListen=function(){this.chat.on("characterChat",this.handleCharacterChat,this),this.chat.on("QCLoundGME",this.handleQCLoudGME,this),this.mView.on("sendChat",this.onSendChatHandler,this),this.mView.on("selectedVoice",this.onSelectedVoiceHandler,this),this.mView.on("selectedMic",this.onSelectedMicHandler,this),this.chat.register()},ChatMediator.prototype.removeListen=function(){this.chat.off("characterChat",this.handleCharacterChat,this),this.chat.off("QCLoundGME",this.handleQCLoudGME,this),this.mView.off("sendChat",this.onSendChatHandler,this),this.mView.off("selectedVoice",this.onSelectedVoiceHandler,this),this.mView.off("selectedMic",this.onSelectedMicHandler,this),this.chat.unregister()},ChatMediator.prototype.initGME=function(){var t=this;if(this.room.playerManager.actor){var e=this.room.playerManager.actor.id;this.mGMEApi=new WebGMEAPI,this.mGMEApi.Init(document,"1400209172",e.toString()),this.mGMEApi.SetTMGDelegate((function(e,i){switch(e){case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ENTER_ROOM:s.a.getInstance().log("[GME]: EnterRoom: "+i);break;case t.mGMEApi.event.ITMG_MAIN_EVNET_TYPE_USER_UPDATE:break;case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_EXIT_ROOM:s.a.getInstance().log("[GME]: ExitRoom");break;case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ROOM_DISCONNECT:s.a.getInstance().log("[GME]: Room Disconnect!!!");break;default:s.a.getInstance().log("[GME]: Sth wrong...")}}))}},ChatMediator.prototype.appendMessage=function(t,e){t.push(e),t.length>this.mMaxMessageNum&&t.shift()},ChatMediator.prototype.changeMessageChannel=function(){var t=this;if(this.mView)for(var e=this.mAllMessage.filter((function(e){return e.channel===t.mView.outChannel||e.channel===r.op_def.ChatChannel.System||null===t.mView.outChannel})),i=e.length,n=null,o="\n",s=0;s<i;s++)n=e[s],s===i-1&&(o=""),this.mView.appendChat(n.chat+o)},ChatMediator.prototype.handleCharacterChat=function(t){var e=t.content;if(this.world&&this.world.emitter&&this.room&&this.mView){var i=this.world.roomManager.currentRoom.playerManager;if(i){var n=i.get(e.chatSenderid),o=n?n.model.nickname+":":"",r=e.chatSetting&&e.chatSetting.textColor?e.chatSetting.textColor:"#FFFFFF";this.appendMessage(this.mAllMessage,{chat:"[color="+r+"]"+o+":"+e.chatContext+"[/color]",channel:e.chatChannel}),this.mView.appendChat("[b][color="+r+"]"+o+e.chatContext+"[/color][/b]\n")}}},ChatMediator.prototype.onSendChatHandler=function(t){if(this.world.connection){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_GATEWAY_REQ_VIRTUAL_WORLD_CHAT),i=e.content;i.chatChannel=0,i.chatContext=t,this.world.connection.send(e)}},ChatMediator.prototype.sendVoiceRoomStatus=function(t,e,i){if(this.room.connection){var n=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS),s=n.content;s.voiceChannel=t,s.voiceRoomId=e,s.voiceRoomStatus=i,this.room.connection.send(n)}},ChatMediator.prototype.handleQCLoudGME=function(t){var e=t.content;this.mQCLoudAuth=e.signature,this.initGME()},ChatMediator.prototype.onSelectedVoiceHandler=function(t){t?this.enterRoom():this.exitRoom()},ChatMediator.prototype.onSelectedMicHandler=function(t){if(this.mGMEApi&&(this.mInRoom&&this.mGMEApi.EnableMic(t),this.world.connection)){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS);this.world.connection.send(e)}},Object.defineProperty(ChatMediator.prototype,"room",{get:function(){if(this.world&&this.world.roomManager)return this.world.roomManager.currentRoom},enumerable:!1,configurable:!0}),ChatMediator.NAME="ChatMediator",ChatMediator}(l.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"DragDropIcon",(function(){return a}));var n,o=i(111),r=i(116),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function DragDropIcon(e,i,n,o){var s=t.call(this,e,i,n)||this;return s.mScene=e,s.mIcon=new r.DynamicImage(s.mScene,0,0),s.add(s.mIcon),s}return s(DragDropIcon,t),DragDropIcon.prototype.load=function(t,e,i){var n=this;this.mUrl=t;this.resKey;this.mIcon.load(o.i.getOsdRes(this.mUrl),(function(){n.mCallBack&&n.mCallBack()})),this.mCallBack=i},DragDropIcon.prototype.dragStart=function(){},DragDropIcon.prototype.dragStop=function(t){},DragDropIcon.prototype.dragDrop=function(t){},DragDropIcon.prototype.dragOver=function(t){},DragDropIcon.prototype.getDragData=function(){},DragDropIcon.prototype.getDropData=function(){},DragDropIcon.prototype.getDragImage=function(){return this.mIcon},DragDropIcon.prototype.getVisualDisplay=function(){},DragDropIcon.prototype.getBound=function(){var t=this.getBounds();return new Phaser.Geom.Rectangle(t.x,t.y,t.width,t.height)},Object.defineProperty(DragDropIcon.prototype,"resKey",{get:function(){return void 0===this.mUrl?"":o.i.getOsdRes(this.mUrl)},enumerable:!1,configurable:!0}),DragDropIcon.prototype.destroy=function(){this.mCallBack=null,t.prototype.destroy.call(this,!0)},Object.defineProperty(DragDropIcon.prototype,"icon",{get:function(){return this.mIcon},enumerable:!1,configurable:!0}),DragDropIcon.prototype.setDragType=function(t){this.mDragType=t},DragDropIcon.prototype.setDropType=function(t){this.mDropType=t},DragDropIcon.prototype.getDropType=function(){return this.mDropType},DragDropIcon.prototype.getDragType=function(){return this.mDragType},DragDropIcon}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(118),o=function(){function Tool(){}return Tool.getPosByScenes=function(t,e){var i=t.cameras.main,o=e.x-i.scrollX,r=e.y-i.scrollY;return new n.a(o,r)},Tool.twoPointDistance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},Tool.twoPointRadin=function(t,e){var i=t.x-e.x,n=t.y-e.y,o=Math.sqrt(Math.pow(i,2)+Math.pow(n,2)),r=Math.acos(i/o);return e.y<t.y&&(r=-r),r},Tool.formatChineseString=function(t,e,i){"string"==typeof e&&(e=parseInt(e,10));var n=Math.floor(i/e);return this.chunk(t,n).join(" ")},Tool.checkChinese=function(t){for(var e=/[\u4e00-\u9fa5]+/,i=t.split(""),n=0,o=i.length;n<o;n++)if(e.test(i[n]))return!0;return!1},Tool.checkItemName=function(t,e){var i=e.split("")||[],n=!1;return i.forEach((function(e){if(e)for(var i=new RegExp(e),o=t.split(""),r=0,s=o.length;r<s;r++)if(i.test(o[r])){n=!0;break}})),n},Tool.checkPointerContains=function(t,e){if(!t)return!1;var i=-t.width/2,n=t.width/2,o=-t.height/2,r=t.height/2;if(e){var s=t.getWorldTransformMatrix(),a=e.x-s.tx-t.x,h=e.y-s.ty-t.y;return i<=a&&n>=a&&o<=h&&r>=h}return!1},Tool.baseName=function(t){var e=new String(t).substring(t.lastIndexOf("/")+1);return-1!==e.lastIndexOf(".")&&(e=e.substring(0,e.lastIndexOf("."))),e},Tool.chunk=function(t,e){for(var i=[],n=0;n<t.length;n+=e)i.push(t.substr(n,e));return i},Tool}()},function(t,e,i){"use strict";i.r(e),i.d(e,"RankMediator",(function(){return a}));var n,o=i(194),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function RankMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mScene=i,o.mlayerManager=e,o.mUIType=o.world.game.device.os.desktop?r.UIType.Scene:r.UIType.Normal,o}return s(RankMediator,t),RankMediator.prototype.tweenView=function(t){this.mView&&this.world.game.device.os.desktop&&this.mView.tweenView(t)},RankMediator.prototype.getName=function(){return""},RankMediator.prototype.getView=function(){return this.mView},RankMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView.hide(),this.mView=null,this.world.game.device.os.desktop||this.world.uiManager.checkUIState(RankMediator.NAME,!0))},RankMediator.prototype.isSceneUI=function(){return!1},RankMediator.prototype.isShow=function(){return!1},RankMediator.prototype.resize=function(){this.mView&&this.mView.resize()},RankMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView=new o.RankPanel(this.mScene,this.world),this.mlayerManager.addToUILayer(this.mView),e&&e.length>0&&this.mView.addItem(e[0]),this.mView.show(),this.world.game.device.os.desktop||this.world.uiManager.checkUIState(RankMediator.NAME,!1),t.prototype.show.call(this,e))},RankMediator.prototype.update=function(t){this.mView&&t&&t.length>0&&this.mView.update(t[0])},RankMediator.prototype.destroy=function(){this.mView&&(this.mView.parentContainer&&this.mView.parentContainer.remove(this.mView),this.mView.destroy(),this.mView=null),this.mScene=null},RankMediator.NAME="RankMediator",RankMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaChatMediator",(function(){return l}));var n,o=i(212),r=i(215),s=i(2),a=i(114),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicaChatMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return c(PicaChatMediator,t),PicaChatMediator.prototype.show=function(){if(this.mView)return this.mView.show(),void this.layerManager.addToUILayer(this.mView);this.mChat||(this.mChat=new r.PicaChat(this.world),this.mChat.on("chat",this.onChatHandler,this),this.mChat.register()),this.mView||(this.mView=new o.PicaChatPanel(this.scene,this.world),this.mView.on("showNavigate",this.onShowNavigateHandler,this),this.mView.on("chat",this.onSendChatHandler,this)),this.mView.show(),this.layerManager.addToUILayer(this.mView)},PicaChatMediator.prototype.isSceneUI=function(){return!0},PicaChatMediator.prototype.destroy=function(){this.mChat&&(this.mChat.destroy(),this.mChat=void 0),t.prototype.destroy.call(this)},PicaChatMediator.prototype.hide=function(){t.prototype.hide.call(this),this.mView.removeListen(),this.layerManager.removeToUILayer(this.mView)},PicaChatMediator.prototype.onShowNavigateHandler=function(){if(this.world){var t=this.world.uiManager;t.showMed("PicaNavigate"),t.hideMed("PicHandheld"),this.hide()}},PicaChatMediator.prototype.onChatHandler=function(t){if(this.mView){var e=this.getSpeaker(t.chatSenderid),i="";e?i=""+e.model.nickname:t.chatSenderid&&(i=a.a.t("chat.mystery"));var n="#ffffff";t.chatSetting&&(n=t.chatSetting.textColor),this.appendChat("[color="+n+"]["+this.getChannel(t.chatChannel)+"]"+i+": "+t.chatContext+"[/color]\n")}},PicaChatMediator.prototype.appendChat=function(t){this.mView&&this.mView.appendChat(t)},PicaChatMediator.prototype.onSendChatHandler=function(t){this.mChat&&("whosyourdaddy"===t&&this.world.uiManager.showMed("DebugLogger"),this.mChat.sendMessage(t))},PicaChatMediator.prototype.getChannel=function(t){switch(t){case s.op_def.ChatChannel.CurrentScene:return a.a.t("chat.current");case s.op_def.ChatChannel.World:return a.a.t("chat.world");default:return a.a.t("chat.system")}},PicaChatMediator.prototype.getSpeaker=function(t){if(t){if(!this.world||!this.world.roomManager||!this.world.roomManager.currentRoom)return;return this.world.roomManager.currentRoom.getElement(t)}},PicaChatMediator.NAME="PicaChatMediator",PicaChatMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"LabelInput",(function(){return a}));var n,o=i(113),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function LabelInput(e,i){var n=t.call(this,e)||this,r={fontFamily:o.a.DEFULT_FONT},s=i.width||100,a=i.height||100;return n.mLabel=n.scene.make.text({text:i.placeholder,style:Object.assign(r,i)},!1).setInteractive(new Phaser.Geom.Rectangle(.5*-s,.5*-a,s,a),Phaser.Geom.Rectangle.Contains),n.mOriginX=n.mLabel.originX,n.mOriginY=n.mLabel.originY,n.mLabel.on("pointerup",n.onShowInputHandler,n),n.add(n.mLabel),n.setSize(s,a),n.mInputConfig=i,n}return s(LabelInput,t),LabelInput.prototype.setText=function(t){return this.mLabel.setText(t),this.mInputText&&(this.mInputText.text=t),this},LabelInput.prototype.setOrigin=function(t,e){return void 0===e&&(e=t),this.mLabel.setOrigin(t,e),this.mOriginX=t,this.mOriginY=e,this.mInputText&&this.mInputText.setOrigin(t,e),this.mLabel.input.hitArea=new Phaser.Geom.Rectangle(-this.width*t,-this.height*e,this.width,this.height),this},LabelInput.prototype.createBackground=function(t,e){this.mBackground||(this.mBackground=this.scene.make.graphics(void 0,!1)),this.mBackground.clear(),this.mBackground.fillStyle(16777215),this.mBackground.fillRoundedRect(-t+this.width*this.mLabel.originX,-t+this.height*this.mLabel.originY,this.width+2*t,this.height+2*t,e),this.addAt(this.mBackground,0)},LabelInput.prototype.setBlur=function(){this.onShowLabel()},LabelInput.prototype.destroy=function(){this.mLabel.destroy(),this.destroyInput(),t.prototype.destroy.call(this)},LabelInput.prototype.createInputText=function(){var t=this;this.mInputText&&this.mInputText.destroy(),this.mInputText=new r.InputText(this.scene,Object.assign({},this.mInputConfig)).setOrigin(this.mOriginX,this.mOriginY),this.mInputText.on("textchange",this.onTextChangeHandler,this),this.mInputText.on("blur",this.onTextBlurHandler,this),this.mInputText.on("focus",this.onTextFocusHandler,this),this.mInputText.node.addEventListener("keypress",(function(e){13===(e.keyCode||e.which)&&t.onShowLabel()}))},LabelInput.prototype.onShowInputHandler=function(){this.createInputText(),this.remove(this.mLabel),this.add(this.mInputText),this.mInputConfig.placeholder!==this.mLabel.text&&this.mInputText.setText(this.mLabel.text),this.mInputText.setFocus()},LabelInput.prototype.onShowLabel=function(){this.mInputText&&(!this.mInputText.text&&this.mInputConfig.placeholder?this.mLabel.setText(this.mInputConfig.placeholder):this.mLabel.setText(this.mInputText.text),this.destroyInput()),this.add(this.mLabel)},LabelInput.prototype.destroyInput=function(){this.mInputText&&(this.mInputText.destroy(),this.mInputText=void 0)},LabelInput.prototype.onTextChangeHandler=function(t,e){this.emit("textchange")},LabelInput.prototype.onTextBlurHandler=function(){this.emit("blur")},LabelInput.prototype.onTextFocusHandler=function(){this.emit("focus")},Object.defineProperty(LabelInput.prototype,"object",{get:function(){return this.mInputText||this.mLabel},enumerable:!1,configurable:!0}),Object.defineProperty(LabelInput.prototype,"text",{get:function(){return this.mInputText?this.mInputText.text:this.mLabel.text},enumerable:!1,configurable:!0}),LabelInput}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"TextButton",(function(){return s}));var n,o=i(113),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function TextButton(e,i,n,r,s,a){void 0===n&&(n=1);var h=t.call(this,e,s,a)||this;return h.normalColor="#FFFFFF",h.changeColor="#0099cc",h.mText=h.scene.make.text({text:r,style:{fontSize:15*window.devicePixelRatio,fontFamily:o.a.DEFULT_FONT}},!1).setOrigin(.5,.5),h.add(h.mText),h}return r(TextButton,t),TextButton.prototype.setText=function(t){this.mText.text=t},TextButton.prototype.setFontSize=function(t){this.mText.setFontSize(t)},TextButton.prototype.setFontStyle=function(t){this.mText.setFontStyle(t)},TextButton.prototype.setStyle=function(t){this.mText.setStyle(t)},TextButton.prototype.setNormalColor=function(t){this.normalColor=t},TextButton.prototype.setChangeColor=function(t){this.changeColor=t},TextButton.prototype.changeDown=function(){this.mText.setFill(this.changeColor)},TextButton.prototype.changeNormal=function(){this.mText.setFill(this.normalColor)},TextButton.prototype.onPointerUpHandler=function(t){this.emit("click",t,this)},Object.defineProperty(TextButton.prototype,"text",{get:function(){return this.mText},enumerable:!1,configurable:!0}),TextButton}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";var n;i.r(e),i.d(e,"PicFriendEvent",(function(){return n})),function(t){t.FETCH_FRIEND="fetchFriend",t.FOLLOW="follow",t.UNFOLLOW="unfollow",t.REMOVE_BAN_USER="removeBanUser",t.REQ_BLACKLIST="ReqBlacklist",t.REQ_FRIEND_ATTRIBUTES="reqFriendAttributes",t.REQ_FRIEND_GAME_DATA="reqFriendGameData",t.REMOVE_FROM_BLACKLIST="removeFromBlacklist",t.RENDERER_EVENT="rendererEvent",t.REQ_PLAYER_LIST="reqPlayerList",t.PLAYER_LIST="playerList",t.SEARCH_FRIEND="searchFriend",t.SEARCH_RESULT="searchResult",t.REQ_FRIEND_RELATION="reqFriendRelation",t.REQ_RELATION="reqRelation"}(n||(n={}))},function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n,o=i(110),r=i(2),s=i(122),a=i(0),h=i(118),c=i(126),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=r.op_def.NodeType,d=function(t){function ElementManager(e){var i=t.call(this)||this;i.mRoom=e,i.hasAddComplete=!1,i.mElements=new Map,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,i.onAdd),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE_END,i.addComplete),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,i.onRemove),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MOVE_SPRITE,i.onMove),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,i.onAdjust),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SYNC_SPRITE,i.onSync),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE,i.onShowBubble),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE_CLEAN,i.onClearBubbleHandler),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_CHANGE_SPRITE_ANIMATION,i.onChangeAnimation),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SET_SPRITE_POSITION,i.onSetPosition)),i.mRoom&&i.mRoom.world&&(i.mGameConfig=i.mRoom.world.elementStorage);var n=i.mRoom.miniSize;i.mMap=new Array(n.rows);for(var o=0;o<i.mMap.length;o++)i.mMap[o]=new Array(n.cols).fill(-1);return i}return l(ElementManager,t),ElementManager.prototype.init=function(){},ElementManager.prototype.get=function(t){var e=this.mElements.get(t);if(e)return e},ElementManager.prototype.remove=function(t){var e=this.mElements.get(t);return e&&(this.mElements.delete(t),e.destroy(),this.removeMap(e.model)),e},ElementManager.prototype.getElements=function(){return Array.from(this.mElements.values())},ElementManager.prototype.add=function(t,e){for(var i=0,n=t;i<n.length;i++){var o=n[i];this._add(o,e)}},ElementManager.prototype.setState=function(t){if(t){var e=t.owner;if(e&&e.type===r.op_def.NodeType.ElementNodeType){var i=this.get(e.id);i&&i.setState(t.state)}}},ElementManager.prototype.destroy=function(){var t=this;this.connection&&this.connection.removePacketListener(this),this.mElements&&(this.mElements.forEach((function(e){return t.remove(e.id)})),this.mElements.clear())},ElementManager.prototype.update=function(t,e){},ElementManager.prototype.addMap=function(t){},ElementManager.prototype.removeMap=function(t){},Object.defineProperty(ElementManager.prototype,"camera",{get:function(){return this.mRoom.cameraService.camera},enumerable:!1,configurable:!0}),Object.defineProperty(ElementManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;a.a.getInstance().log("roomManager is undefined")},enumerable:!1,configurable:!0}),ElementManager.prototype.onAdjust=function(t){var e=t.content,i=e.spritePositions;if(e.nodeType===p.ElementNodeType)for(var n,o,r=0,s=i;r<s.length;r++){var a=s[r];(n=this.mElements.get(a.id))&&(o=a.point3f,n.setPosition(new h.a(o.x||0,o.y||0,o.z||0)))}},ElementManager.prototype.onAdd=function(t){if(this.mRoom.layerManager)if(this.mGameConfig){var e=t.content,i=e.sprites;if(i)if(e.nodeType===p.ElementNodeType){for(var n=null,o=[],r=0,s=i;r<s.length;r++){var h=s[r];h.point3f&&((n=new c.a(h,e.nodeType)).displayInfo||this.checkDisplay(n)||o.push(n.id),this._add(n))}this.fetchDisplay(o)}}else a.a.getInstance().error("gameConfig does not exist");else a.a.getInstance().error("layer manager does not exist")},ElementManager.prototype._add=function(t,e){void 0===e&&(e=!0);var i=this.mElements.get(t.id);return i?i.model=t:(i=new s.b(t,this)).setInputEnable(s.c.Interactive),e&&this.addMap(t),this.mElements.set(i.id||0,i),i},ElementManager.prototype.addComplete=function(t){this.hasAddComplete=!0},ElementManager.prototype.checkDisplay=function(t){if(!t.displayInfo){var e=this.roomService.world.elementStorage.getDisplayModel(t.bindID||t.id);if(e)return t.displayInfo=e,e}},ElementManager.prototype.fetchDisplay=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_REQ_VIRTUAL_WORLD_QUERY_SPRITE_RESOURCE);e.content.ids=t,this.connection.send(e)},Object.defineProperty(ElementManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),Object.defineProperty(ElementManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!1,configurable:!0}),Object.defineProperty(ElementManager.prototype,"map",{get:function(){return this.mMap},enumerable:!1,configurable:!0}),ElementManager.prototype.onSetPosition=function(t){var e=t.content,i=e.nodeType,n=e.id;i===p.ElementNodeType&&this.get(n).setPosition(new h.a(e.position.x,e.position.y,e.position.z))},ElementManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,n=e.ids;if(i===p.ElementNodeType)for(var o=0,r=n;o<r.length;o++){var s=r[o];this.remove(s)}},ElementManager.prototype.onSync=function(t){var e=t.content;if(e.nodeType===p.ElementNodeType)for(var i=null,n=e.sprites,o=e.command,s=0,a=n;s<a.length;s++){var h=a[s];(i=this.get(h.id))&&(o===r.op_def.OpCommand.OP_COMMAND_UPDATE?i.model=new c.a(h):o===r.op_def.OpCommand.OP_COMMAND_PATCH&&i.updateModel(h))}},ElementManager.prototype.onMove=function(t){var e=t.content;if(e.moveData)for(var i=e.moveData,n=i.length,o=(e.nodeType,void 0),r=void 0,s=void 0,a=0;a<n;a++)r=(o=i[a]).moveObjectId,(s=this.get(r))&&s.move(o)},ElementManager.prototype.onShowBubble=function(t){var e=t.content,i=this.get(e.receiverid);i&&i.showBubble(e.context,e.chatsetting)},ElementManager.prototype.onClearBubbleHandler=function(t){var e=t.content,i=this.get(e.receiverid);i&&i.clearBubble()},ElementManager.prototype.onChangeAnimation=function(t){var e=t.content;if(e.nodeType===p.ElementNodeType)for(var i=null,n=0,o=e.ids;n<o.length;n++){var r=o[n];(i=this.get(r))&&i.setQueue(e.changeAnimation)}},ElementManager}(o.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n,o,r,s=i(111),a=i(137),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t.BodyCostDres="body_cost_$_dres",t.BodyCost="body_cost_$",t.BodyTail="body_tail_$",t.BodyWing="body_wing_$",t.BodyBase="body_base_$",t.BodySpec="body_spec_$",t.FlegSpec="fleg_spec_$",t.FlegBase="fleg_base_$",t.FlegCost="fleg_cost_$",t.BarmSpec="barm_spec_$",t.BarmBase="barm_base_$",t.BarmCost="barm_cost_$",t.WeapBarm="weap_barm_$",t.ShldBarm="shld_barm_$",t.BlegSpec="bleg_spec_$",t.BlegBase="bleg_base_$",t.BlegCost="bleg_cost_$",t.FarmSpec="farm_spec_$",t.FarmBase="farm_base_$",t.FarmCost="farm_cost_$",t.ShldFarm="shld_farm_$",t.WeapFarm="weap_farm_$",t.HeadSpec="head_spec_$",t.HeadMask="head_mask_$",t.HeadEyes="head_eyes_$",t.HeadBase="head_base_$",t.HeadHairBack="head_hair_$_back",t.HeadMous="head_mous_$",t.HeadHair="head_hair_$",t.HeadHats="head_hats_$"}(o||(o={})),function(t){t.BarmBase="barm_base_#_$",t.BarmCost="barm_cost_#_$",t.BarmSpec="barm_spec_#_$",t.BlegBase="bleg_base_#_$",t.BlegCost="bleg_cost_#_$",t.BlegSpec="bleg_spec_#_$",t.BodyBase="body_base_#_$",t.BodyCost="body_cost_#_$",t.BodyCostDres="body_cost_#_$_dres",t.BodySpec="body_spec_#_$",t.BodyTail="body_tail_#_$",t.BodyWing="body_wing_#_$",t.FarmBase="farm_base_#_$",t.FarmCost="farm_cost_#_$",t.FarmSpec="farm_spec_#_$",t.FlegBase="fleg_base_#_$",t.FlegCost="fleg_cost_#_$",t.FlegSpec="fleg_spec_#_$",t.HeadBase="head_base_#_$",t.HeadEyes="head_eyes_#_$",t.HeadHair="head_hair_#_$",t.HeadHairBack="head_hair_#_$_back",t.HeadHats="head_hats_#_$",t.HeadMask="head_mask_#_$",t.HeadMous="head_mous_#_$",t.HeadSpec="head_spec_#_$",t.ShldFarm="shld_farm_#_$",t.WeapFarm="weap_farm_#_$",t.ShldBarm="shld_barm_#_$",t.WeapBarm="weap_barm_#_$"}(r||(r={}));var l=function(t){function DragonbonesDisplay(e,i,n,r){void 0===r&&(r=!1);var s=t.call(this,e,i,n,r)||this;return s.mAnimationName="Armature",s.mDragonbonesName="",s.replaceArr=[],s.mHasLoadMap=new Map,s.mLoadMap=new Map,s.mErrorLoadMap=new Map,s.mNeedReplaceTexture=!1,s.UNPACKSLOTS=[o.WeapFarm,o.WeapBarm],s.UNCHECKAVATARPROPERTY=["id","dirable","farmWeapId","barmWeapId"],s}return c(DragonbonesDisplay,t),Object.defineProperty(DragonbonesDisplay.prototype,"displayInfo",{get:function(){return this.mDisplayInfo},set:function(t){!1===this.mNeedReplaceTexture&&(this.mNeedReplaceTexture=this.checkNeedReplaceTexture(this.mDisplayInfo,t)),this.mDisplayInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"spriteWidth",{get:function(){return this.mArmatureDisplay?this.mArmatureDisplay.width:0},enumerable:!1,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"spriteHeight",{get:function(){return this.mArmatureDisplay?this.mArmatureDisplay.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"topPoint",{get:function(){return this.mBoardPoint},enumerable:!1,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"GameObject",{get:function(){return this},enumerable:!1,configurable:!0}),DragonbonesDisplay.prototype.changeAlpha=function(t){},DragonbonesDisplay.prototype.load=function(t,e){if((e=e||a.a.STAGE)===a.a.STAGE){if(this.displayInfo=t,this.mCollisionArea=[[1,1],[1,1]],this.mOriginPoint=new Phaser.Geom.Point(1,1),!this.displayInfo)return;this.dragonBonesName="bones_human01"}},DragonbonesDisplay.prototype.getDisplay=function(){return this.mArmatureDisplay},DragonbonesDisplay.prototype.play=function(t){if(this.mActionName=t,this.mArmatureDisplay){if(this.mArmatureDisplay.hasDBEventListener(dragonBones.EventObject.LOOP_COMPLETE)&&this.mArmatureDisplay.removeDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onArmatureLoopComplete,this),t.playingQueue&&t.playingQueue.complete&&this.mArmatureDisplay.addDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onArmatureLoopComplete,this),this.mArmatureDisplay.animation.play(t.name),this.mArmatureDisplay.scaleX=t.flip?-1:1,this.mArmatureDisplay&&this.mArmatureDisplay.armature){var e=this.mArmatureDisplay.armature.getBone("board");if(e)return void(this.mBoardPoint=new Phaser.Geom.Point(e.global.x,e.global.y))}this.mBoardPoint=new Phaser.Geom.Point}},DragonbonesDisplay.prototype.fadeIn=function(t){this.clearFadeTween(),this.alpha=0,this.mFadeTween=this.scene.tweens.add({targets:this,alpha:1,duration:1200,onComplete:function(){t&&t()}})},DragonbonesDisplay.prototype.fadeOut=function(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:function(){t&&t()}})},DragonbonesDisplay.prototype.destroy=function(){this.mDisplayInfo=null,this.mNeedReplaceTexture=!1,this.mArmatureDisplay&&(this.mArmatureDisplay.dispose(!0),this.mArmatureDisplay=null),this.mClickCon&&(this.mClickCon.destroy(!0),this.mClickCon=null),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=null),t.prototype.destroy.call(this)},DragonbonesDisplay.prototype.buildDragbones=function(){if(this.scene.cache.custom.dragonbone.get(this.mDragonbonesName))this.onLoadCompleteHandler();else{var t="./resources/dragonbones",e=t+"/"+this.mDragonbonesName+"_tex.png",i=t+"/"+this.mDragonbonesName+"_tex.json",n=t+"/"+this.mDragonbonesName+"_ske.dbbin";this.loadDragonBones(t,e,i,n)}},DragonbonesDisplay.prototype.onLoadCompleteHandler=function(t,e,i){if(this.scene){this.mArmatureDisplay||(this.mArmatureDisplay=this.scene.add.armature(this.mAnimationName,this.dragonBonesName),this.mArmatureDisplay.visible=!1,this.showPlaceholder(),this.add(this.mArmatureDisplay)),this.mArmatureDisplay.removeDBEventListener(dragonBones.EventObject.SOUND_EVENT,this.onSoundEventHandler,this),this.mArmatureDisplay.addDBEventListener(dragonBones.EventObject.SOUND_EVENT,this.onSoundEventHandler,this),this.clearArmatureSlot(),this.getReplaceArr(),this.showReplaceArmatrue();var n=new Phaser.Geom.Rectangle(0,0,50,70);this.mClickCon||(this.mClickCon=this.scene.make.container(void 0,!1),this.mClickCon.setInteractive(n,Phaser.Geom.Rectangle.Contains),this.mClickCon.x=-n.width>>1,this.mClickCon.y=-n.height),this.setData("id",this.displayInfo.id),this.add(this.mClickCon),this.emit("initialized")}},DragonbonesDisplay.prototype.loadDragonBones=function(t,e,i,n){this.scene.load.dragonbone(this.mDragonbonesName,e,i,n,null,null,{responseType:"arraybuffer"}),this.scene.load.on(Phaser.Loader.Events.FILE_COMPLETE,this.onFileLoadHandler,this),this.scene.load.start()},DragonbonesDisplay.prototype.clearArmatureSlot=function(){this.mArmatureDisplay.armature.getSlots().forEach((function(t){t&&(t.display.visible=!1)}))},DragonbonesDisplay.prototype.clearReplaceArmature=function(){if(this.mArmatureDisplay.armature.animation.stop(),this.replaceArr&&0!==this.replaceArr.length)for(var t=this.replaceArr.length,e=0;e<t;e++){var i=this.replaceArr[e].slot.replace("$",this.replaceArr[e].dir.toString());this.mArmatureDisplay.armature.getSlot(i).replaceDisplay(null)}},DragonbonesDisplay.prototype.showReplaceArmatrue=function(){for(var t=0,e=this.replaceArr;t<e.length;t++){var i=e[t];this.replacePartDisplay(i.slot,i.part,i.dir,i.skin)}this.mLoadMap&&this.mLoadMap.size>0?this.startLoad():this.refreshAvatar()},DragonbonesDisplay.prototype.getReplaceArr=function(){this.replaceArr.length=0;var t=this.displayInfo.avatar;t.bodyBaseId&&(this.replaceArr.push({slot:o.BodyBase,part:r.BodyBase,dir:3,skin:t.bodyBaseId}),this.replaceArr.push({slot:o.BodyBase,part:r.BodyBase,dir:1,skin:t.bodyBaseId})),t.bodySpecId&&(this.replaceArr.push({slot:o.BodySpec,part:r.BodySpec,dir:3,skin:t.bodySpecId}),this.replaceArr.push({slot:o.BodySpec,part:r.BodySpec,dir:1,skin:t.bodySpecId})),t.bodyWingId&&(this.replaceArr.push({slot:o.BodyWing,part:r.BodyWing,dir:3,skin:t.bodyWingId}),this.replaceArr.push({slot:o.BodyWing,part:r.BodyWing,dir:1,skin:t.bodyWingId})),t.bodyTailId&&(this.replaceArr.push({slot:o.BodyTail,part:r.BodyTail,dir:3,skin:t.bodyTailId}),this.replaceArr.push({slot:o.BodyTail,part:r.BodyTail,dir:1,skin:t.bodyTailId})),t.bodyCostId&&(this.replaceArr.push({slot:o.BodyCost,part:r.BodyCost,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:o.BodyCost,part:r.BodyCost,dir:1,skin:t.bodyCostId}),this.replaceArr.push({slot:o.BodyCostDres,part:r.BodyCostDres,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:o.BodyCostDres,part:r.BodyCostDres,dir:1,skin:t.bodyCostId})),t.farmBaseId&&(this.replaceArr.push({slot:o.FarmBase,part:r.FarmBase,dir:3,skin:t.farmBaseId}),this.replaceArr.push({slot:o.FarmBase,part:r.FarmBase,dir:1,skin:t.farmBaseId})),t.farmSpecId&&(this.replaceArr.push({slot:o.FarmSpec,part:r.FarmSpec,dir:3,skin:t.farmSpecId}),this.replaceArr.push({slot:o.FarmSpec,part:r.FarmSpec,dir:1,skin:t.farmSpecId})),t.farmCostId&&(this.replaceArr.push({slot:o.FarmCost,part:r.FarmCost,dir:3,skin:t.farmCostId}),this.replaceArr.push({slot:o.FarmCost,part:r.FarmCost,dir:1,skin:t.farmCostId})),t.barmBaseId&&(this.replaceArr.push({slot:o.BarmBase,part:r.BarmBase,dir:3,skin:t.barmBaseId}),this.replaceArr.push({slot:o.BarmBase,part:r.BarmBase,dir:1,skin:t.barmBaseId})),t.barmSpecId&&(this.replaceArr.push({slot:o.BarmSpec,part:r.BarmSpec,dir:3,skin:t.barmSpecId}),this.replaceArr.push({slot:o.BarmSpec,part:r.BarmSpec,dir:1,skin:t.barmSpecId})),t.barmCostId&&(this.replaceArr.push({slot:o.BarmCost,part:r.BarmCost,dir:3,skin:t.barmCostId}),this.replaceArr.push({slot:o.BarmCost,part:r.BarmCost,dir:1,skin:t.barmCostId})),t.blegBaseId&&(this.replaceArr.push({slot:o.BlegBase,part:r.BlegBase,dir:3,skin:t.blegBaseId}),this.replaceArr.push({slot:o.BlegBase,part:r.BlegBase,dir:1,skin:t.blegBaseId})),t.blegSpecId&&(this.replaceArr.push({slot:o.BlegSpec,part:r.BlegSpec,dir:3,skin:t.blegSpecId}),this.replaceArr.push({slot:o.BlegSpec,part:r.BlegSpec,dir:1,skin:t.blegSpecId})),t.blegCostId&&(this.replaceArr.push({slot:o.BlegCost,part:r.BlegCost,dir:3,skin:t.blegCostId}),this.replaceArr.push({slot:o.BlegCost,part:r.BlegCost,dir:1,skin:t.blegCostId})),t.flegBaseId&&(this.replaceArr.push({slot:o.FlegBase,part:r.FlegBase,dir:3,skin:t.flegBaseId}),this.replaceArr.push({slot:o.FlegBase,part:r.FlegBase,dir:1,skin:t.flegBaseId})),t.flegSpecId&&(this.replaceArr.push({slot:o.FlegSpec,part:r.FlegSpec,dir:3,skin:t.flegSpecId}),this.replaceArr.push({slot:o.FlegSpec,part:r.FlegSpec,dir:1,skin:t.flegSpecId})),t.flegCostId&&(this.replaceArr.push({slot:o.FlegCost,part:r.FlegCost,dir:3,skin:t.flegCostId}),this.replaceArr.push({slot:o.FlegCost,part:r.FlegCost,dir:1,skin:t.flegCostId})),t.headBaseId&&(this.replaceArr.push({slot:o.HeadBase,part:r.HeadBase,dir:3,skin:t.headBaseId}),this.replaceArr.push({slot:o.HeadBase,part:r.HeadBase,dir:1,skin:t.headBaseId})),t.barmWeapId&&(this.replaceArr.push({slot:o.WeapBarm,part:r.WeapBarm,dir:3,skin:t.barmWeapId}),this.replaceArr.push({slot:o.WeapBarm,part:r.WeapBarm,dir:1,skin:t.barmWeapId})),t.headHairId&&(this.replaceArr.push({slot:o.HeadHair,part:r.HeadHair,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:o.HeadHair,part:r.HeadHair,dir:1,skin:t.headHairId}),this.replaceArr.push({slot:o.HeadHairBack,part:r.HeadHairBack,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:o.HeadHairBack,part:r.HeadHairBack,dir:1,skin:t.headHairId})),t.headHatsId&&(this.replaceArr.push({slot:o.HeadHats,part:r.HeadHats,dir:3,skin:t.headHatsId}),this.replaceArr.push({slot:o.HeadHats,part:r.HeadHats,dir:1,skin:t.headHatsId})),t.headSpecId&&(this.replaceArr.push({slot:o.HeadSpec,part:r.HeadSpec,dir:3,skin:t.headSpecId}),this.replaceArr.push({slot:o.HeadSpec,part:r.HeadSpec,dir:1,skin:t.headSpecId})),t.headEyesId&&this.replaceArr.push({slot:o.HeadEyes,part:r.HeadEyes,dir:3,skin:t.headEyesId}),t.headMousId&&this.replaceArr.push({slot:o.HeadMous,part:r.HeadMous,dir:3,skin:t.headMousId}),t.headMaskId&&this.replaceArr.push({slot:o.HeadMask,part:r.HeadMask,dir:3,skin:t.headMaskId}),t.farmShldId&&(this.replaceArr.push({slot:o.ShldFarm,part:r.ShldFarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:o.ShldFarm,part:r.ShldFarm,dir:1,skin:t.farmShldId}),this.replaceArr.push({slot:o.ShldBarm,part:r.ShldBarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:o.ShldBarm,part:r.ShldBarm,dir:1,skin:t.farmShldId})),t.farmWeapId&&(this.replaceArr.push({slot:o.WeapFarm,part:r.WeapFarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:o.WeapFarm,part:r.WeapFarm,dir:1,skin:t.farmWeapId}),this.replaceArr.push({slot:o.WeapBarm,part:r.WeapBarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:o.WeapBarm,part:r.WeapBarm,dir:1,skin:t.farmWeapId}))},DragonbonesDisplay.prototype.hideUnreplacedParts=function(){for(var t=[],e=0,i=this.replaceArr;e<i.length;e++){var n=i[e],o=n.slot.replace("$",n.dir.toString()),r=this.mArmatureDisplay.armature.getSlot(o);t.push(r)}for(var s=0,a=this.mArmatureDisplay.armature.getSlots();s<a.length;s++){(r=a[s])&&(r.display.visible=t.includes(r))}},DragonbonesDisplay.prototype.replacePartDisplay=function(t,e,i,n){var o=t.replace("$",i.toString()),r=this.mArmatureDisplay.armature.getSlot(o),a=e.replace("#",n.toString()).replace("$",i.toString()),h=this.scene.game.textures.get(this.mDragonbonesName);if(this.scene.cache.custom.dragonbone.get(this.dragonBonesName)){var c=s.g.getPartName(a),l="test resources/"+a;if(this.mErrorLoadMap.get(c))return;this.scene.textures.exists(c)||(h.frames[l]?this.mHasLoadMap.set(a,this.scene.textures.get(c)):this.mLoadMap.set(r.name,[r.name,a]))}},DragonbonesDisplay.prototype.startLoad=function(){var t=this,e=[];this.scene.load.once(Phaser.Loader.Events.COMPLETE,(function(i,n,o){e&&t.scene&&(t.refreshAvatar(),t.mLoadMap.clear())}),this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,(function(e){t.mLoadMap.delete(e.key),t.mErrorLoadMap.set(e.key,e)}),this),this.mLoadMap.forEach((function(t){var i=t,n=s.g.getPartUrl(i[1]),o=s.g.getPartName(i[1]);e.push({key:o,url:n})})),this.scene.load.image(e),this.scene.load.start()},DragonbonesDisplay.prototype.refreshAvatar=function(){for(var t=this,e=this.scene.game.textures.get(this.mDragonbonesName),i=0,n=this.replaceArr;i<n.length;i++){var o=n[i],r=o.slot.replace("$",o.dir.toString()),a=this.mArmatureDisplay.armature.getSlot(r),h=o.part.replace("#",o.skin.toString()).replace("$",o.dir.toString()),c=s.g.getPartName(h),l="test resources/"+h;if(this.UNPACKSLOTS.includes(o.slot)){if(this.scene.textures.exists(c)){var p=new dragonBones.phaser.display.SlotImage(this.scene,a.display.x,a.display.y,c);a.display=p}}else a.display.visible=this.scene.textures.exists(c)||e.frames[l]}if(this.mNeedReplaceTexture){this.mNeedReplaceTexture=!1;var d=e.getFrameNames(),m="bones_"+this.displayInfo.id;this.scene.textures.get(m);this.mDragonBonesRenderTexture||(this.mDragonBonesRenderTexture=this.scene.make.renderTexture({x:0,y:0,width:e.source[0].width,height:e.source[0].height},!1)),this.mDragonBonesRenderTexture.clear();for(var u=0,f=d.length;u<f;u++){var y=d[u],g=(h=y.split("/")[1].split("_"))[4]?h[0]+"_"+h[1]+"_"+h[3]+"_"+h[4]:h[0]+"_"+h[1]+"_"+h[3],_=(a=this.mArmatureDisplay.armature.getSlot(g),e.get(y)),P=this.mLoadMap.get(g);if(P){var v=P[1]+"_png",w=this.scene.game.textures.get(v);this.mDragonBonesRenderTexture.drawFrame(v,w.firstFrame,_.cutX,_.cutY)}else for(var S=0,b=this.replaceArr;S<b.length;S++){var C=b[S],T=C.part.replace("#",C.skin.toString()).replace("$",C.dir.toString());c=s.g.getPartName(T),l="test resources/"+T;if((r=C.slot.replace("$",C.dir.toString()))===g){var I=this.scene.textures.get(c);if(e.frames[l]){this.mDragonBonesRenderTexture.drawFrame(this.mDragonbonesName,y,_.cutX,_.cutY);break}this.mDragonBonesRenderTexture.drawFrame(c,I.firstFrame,_.cutX,_.cutY);break}}}this.mDragonBonesRenderTexture.snapshotArea(0,0,e.source[0].width,e.source[0].height,(function(i){if(i instanceof HTMLImageElement){t.scene.game.textures.exists(m)&&t.scene.game.textures.removeKey(m);var n=t.scene.game.textures.create(m,i,e.source[0].width,e.source[0].height);t.mArmatureDisplay.armature.replacedTexture=n}}))}this.closePlaceholder(),this.mArmatureDisplay.visible=!0},DragonbonesDisplay.prototype.clearFadeTween=function(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())},DragonbonesDisplay.prototype.onArmatureLoopComplete=function(t){if(this.mArmatureDisplay&&this.mActionName){var e=this.mActionName.playingQueue;void 0===e.playedTimes?e.playedTimes=1:e.playedTimes++,e.playedTimes>=e.playTimes&&(this.mArmatureDisplay.removeDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onArmatureLoopComplete,this),e.complete&&(e.complete.call(this),delete e.complete))}},DragonbonesDisplay.prototype.onSoundEventHandler=function(t){t.name&&this.mRoomService.world.playSound({field:h.SoundField.Element,key:t.name})},Object.defineProperty(DragonbonesDisplay.prototype,"dragonBonesName",{get:function(){return this.mDragonbonesName},set:function(t){this.mDragonbonesName=t,this.buildDragbones()},enumerable:!1,configurable:!0}),DragonbonesDisplay.prototype.checkNeedReplaceTexture=function(t,e){if(!e)return!1;if(!t)return!0;var i=t.avatar,n=e.avatar;for(var o in n)if(n.hasOwnProperty(o)&&!this.UNCHECKAVATARPROPERTY.includes(o)){if(!i.hasOwnProperty(o))return!0;if(i[o]!==n[o])return!0}return!1},DragonbonesDisplay.prototype.showPlaceholder=function(){this.mPlaceholder&&this.mPlaceholder.destroy(),this.mPlaceholder=this.scene.make.image({key:"avatar_placeholder",x:-22,y:-68}).setOrigin(0),this.add(this.mPlaceholder)},DragonbonesDisplay.prototype.closePlaceholder=function(){this.mPlaceholder&&this.mPlaceholder.destroy(),this.mPlaceholder=void 0},DragonbonesDisplay.prototype.onFileLoadHandler=function(t,e){t===this.mDragonbonesName&&"image"===e&&(this.scene.load.off(Phaser.Loader.Events.FILE_COMPLETE,this.onFileLoadHandler,this),this.onLoadCompleteHandler())},DragonbonesDisplay}(a.b)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(122),o=function(){function DragonbonesModel(t){this.discriminator="DragonbonesModel",t&&(this.id=t.id,this.avatar=t.avatar)}return DragonbonesModel.prototype.setInfo=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},DragonbonesModel.prototype.destroy=function(){},DragonbonesModel.prototype.getCollisionArea=function(t){return[[1,1],[1,1]]},DragonbonesModel.prototype.getWalkableArea=function(){return[[1,1],[1,1]]},DragonbonesModel.prototype.getOriginPoint=function(t){return new Phaser.Geom.Point(1,1)},DragonbonesModel.prototype.getInteractiveArea=function(){},DragonbonesModel.prototype.existAnimation=function(t){return!0},DragonbonesModel.prototype.findAnimation=function(t,e){var i=!1;switch(e){case n.a.south_east:i=!0,e=n.a.west_south;break;case n.a.east_north:i=!0,e=n.a.north_west}var o="";return(e>=n.a.north&&e<n.a.west||e>n.a.east&&e<=n.a.east_north)&&(o="_back"),{name:""+t+o,flip:i}},DragonbonesModel}()},function(t,e,i){"use strict";var n=i(26),__spreadArrays=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},o=function(){function Helpers(){}return Helpers.genId=function(){return(new n).natural({min:1e4,max:Helpers.MAX_ID})},Helpers.flipArray=function(t){if(t){var e=__spreadArrays(t),i=[];if(e.length>0)for(var n=e[0].length,o=0;o<n;o++){i[o]=[];for(var r=0,s=e;r<s.length;r++){var a=s[r];i[o].push(a[o])}}return i}},Helpers.openUrl=function(t){var e=window.open("","_blank");e&&(e.location.href=t)},Helpers.MAX_ID=Math.pow(2,31),Helpers}();e.a=o},function(t,e,i){"use strict";i.r(e),i.d(e,"CheckButton",(function(){return r}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),r=function(t){function CheckButton(e,i,n,o,r,s){var a=t.call(this,e,i,n,o,r)||this;return a.mSelected=!1,a.mNormalFrame=r,a.mSelectFrame=s,a.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),a.setInteractive(new Phaser.Geom.Rectangle(0,0,a.width,a.height),Phaser.Geom.Rectangle.Contains),a.on("pointerup",a.onSelected,a),a}return o(CheckButton,t),CheckButton.prototype.onSelected=function(){this.selected=!this.mSelected,this.emit("selected",this.mSelected)},Object.defineProperty(CheckButton.prototype,"selected",{get:function(){return this.mSelected},set:function(t){if(this.mSelected!==t){this.mSelected=t;var e=t?this.mSelectFrame:this.mNormalFrame;this.setFrame(e)}},enumerable:!1,configurable:!0}),CheckButton}(Phaser.GameObjects.Image)},function(t,e,i){"use strict";i.r(e),i.d(e,"BaseChatPanel",(function(){return s}));var n,o=i(112),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function BaseChatPanel(e,i){return t.call(this,e,i)||this}return r(BaseChatPanel,t),BaseChatPanel.prototype.appendChat=function(t){},Object.defineProperty(BaseChatPanel.prototype,"outChannel",{get:function(){return 0},enumerable:!1,configurable:!0}),BaseChatPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ToolTip",(function(){return s}));var n,o=i(146),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function ToolTip(e,i,n,o,r){var s=t.call(this,e)||this;return s.mScene=e,s.resStr=i,s.resJson=n,s.resUrl=o,s.uiScale=r,s.mWidth=0,s.mHeight=0,s.mBaseMidHeight=0,s.preLoad(),s}return r(ToolTip,t),ToolTip.prototype.setToolTipData=function(t){if(this.mText){var e=o.a.formatChineseString(t,this.mText.style.fontSize,this.mWidth-20);this.mText.setText(e),this.refreshTip()}},ToolTip.prototype.destroy=function(){this.topImage&&this.topImage.destroy(!0),this.midImage&&this.midImage.destroy(!0),this.botImage&&this.botImage.destroy(!0),this.mText&&this.mText.destroy(!0),this.mWidth=0,this.mHeight=0,this.removeAllListeners(),this.removeAll(),t.prototype.destroy.call(this,!0)},ToolTip.prototype.preLoad=function(){this.scene.load.atlas(this.resStr,this.resUrl,this.resJson),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.start()},ToolTip.prototype.init=function(){this.topImage=this.scene.make.image(void 0,!1),this.topImage.setOrigin(0,0),this.topImage.setTexture(this.resStr,ToolTip.TOP),this.midImage=this.scene.make.image(void 0,!1),this.midImage.setOrigin(0,0),this.midImage.setTexture(this.resStr,ToolTip.MID),this.botImage=this.scene.make.image(void 0,!1),this.botImage.setOrigin(0,0),this.botImage.setTexture(this.resStr,ToolTip.BOT),this.mText=this.scene.make.text(void 0,!1),this.mText.setFontFamily("YaHei"),this.mText.setFontStyle("bold"),this.mText.setFontSize(14),this.mText.style.align="center",this.mText.lineSpacing=15,this.mWidth=this.topImage.width,this.mBaseMidHeight=this.midImage.height,this.mText.style.fixedWidth=this.mWidth-20,this.mText.style.setWordWrapWidth(this.mWidth-20,!0),this.add(this.topImage),this.add(this.midImage),this.add(this.botImage),this.add(this.mText)},ToolTip.prototype.refreshTip=function(){this.midImage.scaleY=(this.mText.height+20)/this.mBaseMidHeight,this.mHeight=this.topImage.height+this.midImage.height*this.midImage.scaleY+this.botImage.height,this.topImage.y=-this.topImage.height>>1,this.midImage.y=this.topImage.y+this.topImage.height,this.botImage.y=this.midImage.y+this.midImage.height*this.midImage.scaleY,this.mText.x=this.mWidth-this.mText.style.fixedWidth>>1,this.mText.y=this.mHeight-this.mText.height-10>>1,this.setSize(this.mWidth,this.mHeight)},ToolTip.prototype.onLoadComplete=function(){this.init()},ToolTip.TOP="tip_top.png",ToolTip.MID="tip_mid.png",ToolTip.BOT="tip_bot.png",ToolTip}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"FriendMediator",(function(){return a}));var n,o=i(193),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function FriendMediator(e,i){var n=t.call(this)||this;return n.mUIType=r.UIType.Normal,n.mScene=e,n.world=i,n}return s(FriendMediator,t),FriendMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},FriendMediator.prototype.isSceneUI=function(){return!1},FriendMediator.prototype.resize=function(){if(this.mView)return this.mView.resize()},FriendMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new o.FriendPanel(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},FriendMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView=null)},FriendMediator.prototype.destroy=function(){t.prototype.destroy.call(this)},FriendMediator.NAME="FriendMediator",FriendMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"BasicRankPanel",(function(){return c}));var n,o=i(112),r=i(111),s=i(113),a=i(117),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function BasicRankPanel(e,i){var n=t.call(this,e,i)||this;return n.mTexts=[],n.disInteractive(),n}return h(BasicRankPanel,t),BasicRankPanel.prototype.addItem=function(t){if(this.setData("data",t),this.mInitialized){this.clearText();var e=t.text;if(e&&!(e.length<1)){this.mTitleLabel&&(this.mTitleLabel.setText(e[0].text),this.mTitleLabel.setData("node",e[0].node));for(var i=[-this.width/2+15,-this.width/2+63,-this.width/2+241],n=0,o=1;o<4;o++){n=(r=this.scene.make.text({x:i[o-1],y:-this.height/2+22,text:e?e[o].text:"123",style:{font:s.a.YAHEI_16_BOLD}},!1)).y,r.setData("node",e[o].node),r.setStroke("#000000",2),this.mChildContainer.add(r),this.mTexts.push(r)}n+=20;for(o=4;o<e.length;o++){var r,a=e[o],h=(o-4)%3,c=22*Math.floor((o-4)/3);(r=this.scene.make.text({x:i[h],y:n+c,text:a?a.text:"123",style:{font:s.a.YAHEI_14_BOLD}},!1)).setData("node",a.node),r.setStroke("#000000",2),this.mChildContainer.add(r),this.mTexts.push(r)}}}},BasicRankPanel.prototype.tweenView=function(t){},BasicRankPanel.prototype.update=function(t){this.addItem(t)},BasicRankPanel.prototype.destroy=function(){this.mBackground&&this.mBackground.destroy();for(var e=this.mTexts.length,i=0;i<e;i++){var n=this.mTexts[i];n&&(n.destroy(!0),n=null)}this.mTitleLabel&&this.mTitleLabel.destroy(!0),this.mTexts=[],this.mBackground=null,this.mTitleLabel=null,t.prototype.destroy.call(this)},BasicRankPanel.prototype.preload=function(){this.scene.load.image(r.a.getName(),r.a.getPNG()),this.scene.load.image(r.d.getName(),r.d.getPNG()),this.scene.load.atlas("clsBtn",r.i.getRes("ui/common/common_clsBtn.png"),r.i.getRes("ui/common/common_clsBtn.json")),this.scene.load.atlas("rank_atlas",r.i.getRes("ui/rank/rank_atlas.png"),r.i.getRes("ui/rank/rank_atlas.json")),t.prototype.preload.call(this)},BasicRankPanel.prototype.init=function(){if(!this.mInitialized){this.setSize(328,361),this.mBackground=new a.NinePatch(this.scene,0,0,328,361,r.a.getName(),null,r.a.getConfig()),this.add(this.mBackground),this.mChildContainer=this.scene.make.container({},!1),this.add(this.mChildContainer);var e=new a.NinePatch(this.scene,0,0,315,318,r.d.getName(),null,r.d.getConfig());this.mChildContainer.add(e);var i=this.scene.make.image({x:-this.width/2+20,y:-this.height/2-12,key:"rank_atlas",frame:"icon.png"},!1).setOrigin(0,0);this.add(i),this.mTitleLabel=this.scene.make.text({x:-this.width/2+54,y:-this.height/2-10,text:"排行榜",style:{font:s.a.YAHEI_20_BOLD}}).setOrigin(0,0).setStroke("#000000",2),this.add(this.mTitleLabel),t.prototype.init.call(this)}},BasicRankPanel.prototype.clearText=function(){for(var t=0,e=this.mTexts;t<e.length;t++){e[t].destroy()}this.mTexts.length=0},BasicRankPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"RightMediator",(function(){return h}));var n,o=i(134),r=i(195),s=i(119),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function RightMediator(e,i){return t.call(this,e,i)||this}return a(RightMediator,t),RightMediator.prototype.tweenView=function(t){this.mView&&this.mView.tweenView(t)},RightMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new r.RightBtnGroup(this.mScene,this.world),this.mView.show(e),this.world.emitter.on(s.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.on(s.a.PACKAGE_ITEM_ADD,this.heroItemChange,this),t.prototype.show.call(this,e))},RightMediator.prototype.hide=function(){this.mShow=!1,this.world.emitter.off(s.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.off(s.a.PACKAGE_ITEM_ADD,this.heroItemChange,this),this.mView&&(this.mView.hide(),this.mView=null)},RightMediator.prototype.heroItemChange=function(){this.world.roomManager.currentRoom&&this.world.roomManager.currentRoom.playerManager&&this.world.roomManager.currentRoom.playerManager.actor&&this.mView&&this.mView&&this.mView.refreshSlot()},RightMediator.NAME="RightMediator",RightMediator}(o.BaseFaceMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"BottomMediator",(function(){return a}));var n,o=i(134),r=i(196),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function BottomMediator(e,i){return t.call(this,e,i)||this}return s(BottomMediator,t),BottomMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new r.BottomBtnGroup(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},BottomMediator.NAME="BottomMediator",BottomMediator}(o.BaseFaceMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ElementStorageMediator",(function(){return p}));var n,o=i(197),r=i(199),s=i(119),a=i(110),h=i(2),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function ElementStorageMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mStorage=new r.ElementStorage(n),o.mLayerManager=e,o.mScene=i,o.register(),o}return l(ElementStorageMediator,t),ElementStorageMediator.prototype.show=function(t){this.mParam=t,this.mView&&this.mView.isShow()||this.mShow||(this.mView=new o.ElementStoragePanel(this.mScene,this.world),this.mStorage.register(),this.mStorage.on(s.a.EDIT_MODE_QUERY_PACKAGE,this.onEditModeQueryPackageHandler,this),this.mLayerManager.addToUILayer(this.mView),this.mView.on("queryElement",this.onQueryElementHandler,this),this.mView.on("selectedElement",this.onSelectedElement,this),this.mView.show(t))},ElementStorageMediator.prototype.hide=function(){this.mParam=void 0,t.prototype.hide.call(this)},ElementStorageMediator.prototype.isSceneUI=function(){return!0},ElementStorageMediator.prototype.expand=function(){var t=this.getView();t&&t.expand()},ElementStorageMediator.prototype.collapse=function(){var t=this.getView();t&&t.collapse()},ElementStorageMediator.prototype.destroy=function(){this.unregister(),this.mStorage&&(this.mStorage.unregister(),this.mStorage=void 0),t.prototype.destroy.call(this)},ElementStorageMediator.prototype.getView=function(){return this.mView},ElementStorageMediator.prototype.onQueryElementHandler=function(t,e){this.mParam?this.mStorage.queryMarketPackage(t,e):this.mStorage.queryPackage(t,e)},ElementStorageMediator.prototype.register=function(){this.world.emitter.on(s.a.EDIT_PACKAGE_EXPANED,this.onExpanedHandler,this),this.world.emitter.on(s.a.EDIT_PACKAGE_COLLAPSE,this.onCollapseHandler,this)},ElementStorageMediator.prototype.unregister=function(){this.world.emitter.off(s.a.EDIT_PACKAGE_EXPANED,this.onExpanedHandler,this),this.world.emitter.off(s.a.EDIT_PACKAGE_COLLAPSE,this.onCollapseHandler,this)},ElementStorageMediator.prototype.onEditModeQueryPackageHandler=function(t){t&&this.getView().setProps(t)},ElementStorageMediator.prototype.onSelectedElement=function(t){var e=new a.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_SELECTED_SPRITE);e.content.id=t.id,this.world.connection.send(e)},ElementStorageMediator.prototype.onExpanedHandler=function(){this.expand()},ElementStorageMediator.prototype.onCollapseHandler=function(){this.collapse()},ElementStorageMediator.NAME="ElementStorageMediator",ElementStorageMediator}(c.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"Radio",(function(){return h})),i.d(e,"RadioItemRender",(function(){return c}));var n,o=i(117),r=i(111),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Radio(e,i){var n=t.call(this,e)||this;return n.mIsShow=!1,n.mInit=!1,n.mScene=e,n.mConfig=i,n.init(),n}return a(Radio,t),Radio.prototype.setRadioData=function(t){this.clearRadioData(),this.itemList=[];for(var e=t.length,i=0;i<e;i++){var n=new c(this.mScene,this,this.mConfig.wid+10,20,this.mConfig.resKey,this.mConfig.resArrow),o=t[i];n.itemData={index:i,text:o.text,data:o.node.id,selected:!1,enabled:!0},n.x=this.mConfig.wid/2+25,n.y=33*i+23,this.add(n),this.itemList.push(n)}},Radio.prototype.clearRadioData=function(){if(this.itemList){for(var t=this.itemList.length,e=0;e<t;e++){var i=this.itemList[e];i&&(i.destroy(),i=null)}this.itemList.length=0}},Object.defineProperty(Radio.prototype,"isShow",{get:function(){return this.mIsShow},set:function(t){this.mIsShow=t},enumerable:!1,configurable:!0}),Radio.prototype.selectCall=function(t){this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)},Radio.prototype.destroy=function(){if(this.itemList){for(var e=this.itemList.length,i=0;i<e;i++){var n=this.itemList[i];n&&n.destroy()}this.itemList.length=0,this.itemList=null}this.removeAll(),this.removeAllListeners(),this.parentContainer&&this.parentContainer.remove(this),t.prototype.destroy.call(this,!0)},Radio.prototype.init=function(){var t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},Radio.prototype.onLoadCompleteHandler=function(){this.mInit=!0;var t=this.mConfig.resKey;this.mBg=new o.NinePatch(this.scene,0,0,this.mConfig.wid+20,this.mConfig.hei,r.a.getName(),null,r.a.getConfig()),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2-2,this.mBg.y=this.mConfig.hei/2,this.addAt(this.mBg,0),this.setSize(this.mConfig.wid,this.mConfig.hei),this.mConfig.completeBack&&this.mConfig.completeBack()},Radio}(Phaser.GameObjects.Container),c=function(t){function RadioItemRender(e,i,n,o,r,a){var h=t.call(this,e)||this;h.mSelectCallUI=i,h.mText=new s.BBCodeText(e,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:n}});return h.mSelectBG=e.make.graphics(void 0,!1),h.mSelectBG.fillStyle(16763904,.8),h.mSelectBG.fillRect(-n>>1,-o>>1,n-36,o),h.mSelectBG.visible=!1,h.setSize(n,o),h.setInteractive(new Phaser.Geom.Rectangle(0,0,n,o),Phaser.Geom.Rectangle.Contains),h.addListen(),h.mArrow=e.make.image(void 0,!1),h.mArrow.setTexture(r,a),h.mArrow.x=-n/2-10,h.mArrow.y=0,h.mArrow.visible=!1,h.add([h.mSelectBG,h.mText,h.mArrow]),h}return a(RadioItemRender,t),RadioItemRender.prototype.addListen=function(){this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this),this.on("pointerdown",this.selectHandler,this)},RadioItemRender.prototype.removeListen=function(){this.off("pointerover",this.overHandler,this),this.off("pointerout",this.outHandler,this),this.off("pointerdown",this.selectHandler,this)},Object.defineProperty(RadioItemRender.prototype,"itemData",{get:function(){return this.mData},set:function(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width>>1,this.mText.y=-this.height/2+(this.height-this.mText.height>>1)},enumerable:!1,configurable:!0}),RadioItemRender.prototype.destroy=function(){this.removeListen(),this.mText.destroy(!0),this.mSelectBG.destroy(!0),this.mArrow.destroy(!0),this.mText=null,this.mData=null,this.mSelectCallUI=null,this.mArrow=null,t.prototype.destroy.call(this,!0)},RadioItemRender.prototype.setSelected=function(t){this.mSelectBG.visible=t,this.mArrow.visible=t,this.mSelectCallUI&&this.mSelectCallUI.selectCall(this.itemData)},RadioItemRender.prototype.overHandler=function(){this.mSelectBG.visible=!0,this.mArrow.visible=!0},RadioItemRender.prototype.outHandler=function(){this.mSelectBG.visible=!1,this.mArrow.visible=!1},RadioItemRender.prototype.selectHandler=function(){this.overHandler(),this.mSelectCallUI.selectCall(this.itemData)},RadioItemRender}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"InputPanel",(function(){return s}));var n,o=i(109),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function InputPanel(e,i,n){var r=t.call(this)||this;r.scene=e,r.world=i;var s=e.cameras.main.width,a=e.cameras.main.height;return r.mBackground=e.add.graphics(),r.mBackground.fillStyle(0,.6),r.mBackground.fillRect(0,0,s,a).setInteractive(new Phaser.Geom.Rectangle(0,0,s,a),Phaser.Geom.Rectangle.Contains),r.mInput=new o.InputText(e,6*i.uiRatio,6*i.uiRatio,s-12*i.uiRatio,40*i.uiRatio,{fontSize:20*i.uiRatio+"px",color:"#0",text:n,backgroundColor:"#FFFFFF",borderColor:"#FF9900"}).setOrigin(0,0),r.mInput.node.addEventListener("keypress",(function(t){13===(t.keyCode||t.which)&&r.onCloseHandler()})),r.mInput.x=6*i.uiRatio,r.scene.input.on("pointerdown",r.onFoucesHandler,r),r.world.game.device.os.iOS?r.mInput.on("click",r.onFoucesHandler,r):r.mInput.on("focus",r.onFoucesHandler,r),r.mInput.setFocus(),r}return r(InputPanel,t),InputPanel.prototype.onCloseHandler=function(){this.emit("close",this.mInput.text),this.mBackground.destroy(),this.mInput.destroy(),this.destroy(),this.scene.input.off("pointerdown",this.onFoucesHandler,this),this.scene=void 0},InputPanel.prototype.onFoucesHandler=function(){this.mInput.node.focus()},InputPanel}(Phaser.Events.EventEmitter)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicHandheldMediator",(function(){return c}));var n,o=i(245),r=i(246),s=i(148),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicHandheldMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return h(PicHandheldMediator,t),PicHandheldMediator.prototype.show=function(){this.picHand||(this.picHand=new o.PicHandheld(this.world),this.picHand.on("handheldlist",this.onHandheldList,this),this.picHand.register()),this.mView||(this.mView=new r.PicHandheldPanel(this.scene,this.world),this.mView.on("changehandheld",this.onChangeHandheld,this),this.mView.on("clearhandheld",this.onClearHandheld,this),this.mView.on("handheldlist",this.onReqHandheldList,this),this.mView.on("openeqiped",this.openEquipedPanel,this)),this.mView.show(),this.layerManager.addToUILayer(this.mView)},PicHandheldMediator.prototype.hide=function(){t.prototype.hide.call(this),this.layerManager.removeToUILayer(this.mView)},PicHandheldMediator.prototype.getView=function(){return this.mView},PicHandheldMediator.prototype.destroy=function(){this.picHand&&(this.picHand.destroy(),this.picHand=void 0),t.prototype.destroy.call(this)},PicHandheldMediator.prototype.isSceneUI=function(){return!0},PicHandheldMediator.prototype.onHandheldList=function(t){this.mView.setEqipedDatas(t)},PicHandheldMediator.prototype.onChangeHandheld=function(t){this.picHand.queryChangeHandheld(t)},PicHandheldMediator.prototype.onReqHandheldList=function(){this.picHand.queryHandheldList()},PicHandheldMediator.prototype.onClearHandheld=function(){this.picHand.queryClearHandheld()},PicHandheldMediator.prototype.openEquipedPanel=function(t){var e=this.world.uiManager.getMediator(s.PicaChatMediator.name);e&&(t?e.hide():(e.show(),this.layerManager.removeToUILayer(this.mView),this.layerManager.addToUILayer(this.mView)))},PicHandheldMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"DebugLoggerMediator",(function(){return a}));var n,o=i(265),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function DebugLoggerMediator(e,i,n){var o=t.call(this)||this;return o.mUIType=r.UIType.Scene,o.mScene=i,o.world=n,o}return s(DebugLoggerMediator,t),DebugLoggerMediator.prototype.resize=function(){if(this.mView)return this.mView.resize()},DebugLoggerMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},DebugLoggerMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new o.DebugLogger(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},DebugLoggerMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView.hide(),this.mView=null)},DebugLoggerMediator.prototype.destroy=function(){this.mScene=null,t.prototype.destroy.call(this)},DebugLoggerMediator.NAME="DebugLoggerMediator",DebugLoggerMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessContentPanel",(function(){return c}));var n,o=i(113),r=i(115),s=i(114),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicBusinessContentPanel(e,i,n,o,r,s,a,h){var c=t.call(this,e,i,n)||this;return c.setSize(o,r),c.dpr=s,c.key=a,c.key2=h,c.create(),c}return h(PicBusinessContentPanel,t),PicBusinessContentPanel.prototype.create=function(){var t=this.width,e=this.height;this.bg=new a.NineSlicePatch(this.scene,0,0,t,e,r.UIAtlasKey.common2Key,"bg",{left:70*this.dpr,top:30*this.dpr,right:30*this.dpr,bottom:70*this.dpr}),this.add(this.bg);var i=.5*-e;this.topbg=this.scene.make.image({key:this.key,frame:"eaves"}),this.topbg.y=i-2*this.dpr,this.add(this.topbg),this.titlebg=this.scene.make.image({key:this.key,frame:"title"}),this.titlebg.y=i-25*this.dpr,this.add(this.titlebg);var n="bold "+15*this.dpr+"px "+o.a.BOLD_FONT;this.titleText=this.scene.make.text({x:0,y:this.titlebg.y-5*this.dpr,text:s.a.t("business_street.commercial_street"),style:{font:n,bold:!0,color:"#FFD248"}}).setOrigin(.5,0),this.titleText.setStroke("#553100",2*this.dpr),this.titleText.setShadow(2,2,"#553100",4*this.dpr,!0,!0),this.add(this.titleText),this.closeBtn=new a.Button(this.scene,r.UIAtlasKey.commonKey,"close"),this.closeBtn.setDisplaySize(28*this.dpr,28*this.dpr),this.closeBtn.setPosition(.5*this.width-6*this.dpr,i+5*this.dpr),this.closeBtn.on(String(a.ClickEvent.Tap),this.onCloseHandler,this),this.add(this.closeBtn),this.setContentSize(t,e)},PicBusinessContentPanel.prototype.setContentSize=function(t,e){this.setSize(t,e),this.bg.resize(t,e);var i=.5*-e;this.topbg.y=i-2*this.dpr,this.titlebg.y=i-25*this.dpr,this.titleText.y=this.titlebg.y-5*this.dpr,this.closeBtn.setPosition(.5*this.width-6*this.dpr,i+5*this.dpr)},PicBusinessContentPanel.prototype.setTitleText=function(t){this.titleText.text=t},PicBusinessContentPanel.prototype.setCloseHandler=function(t){this.closeHandler=t},PicBusinessContentPanel.prototype.onCloseHandler=function(){this.closeHandler&&this.closeHandler.run()},PicBusinessContentPanel}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n,o=i(113),r=i(128),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function MainUIScene(){var e=t.call(this,{key:MainUIScene.name})||this;return e.timeOutID=0,e.timeOutCancelMap={},e.timeOutCallerList=[],e.timeOutTimeMap={},e}return s(MainUIScene,t),MainUIScene.prototype.preload=function(){},MainUIScene.prototype.init=function(t){this.mRoom=t.room,this.mRoom&&this.mRoom.world.uiManager.setScene(null)},MainUIScene.prototype.create=function(){t.prototype.create.call(this);var e=this.mRoom.world,i=e.getSize().width;this.fps=this.add.text(.5*i,10,"",{style:{color:"#64DD17"}}),this.fps.setStroke("0x0",1),this.fps.setFontFamily(o.a.DEFULT_FONT),this.fps.setFontSize(20*window.devicePixelRatio),this.fps.setDepth(1e3),this.sizeTF=this.add.text(10,50,"",{style:{color:"#64DD17"},wordWrap:{width:800,useAdvancedWrap:!0}}),this.sizeTF.setFontSize(20*window.devicePixelRatio),this.sizeTF.setFontFamily(o.a.DEFULT_FONT),this.sizeTF.setStroke("#0",3),e.game.device.os.desktop||e.inputManager&&e.inputManager.setScene(this),e.uiManager.setScene(this),this.mRoom.initUI()},MainUIScene.prototype.setTimeout=function(t,e){var i=Date.now();return this.timeOutCallerList[++this.timeOutID]=t,this.timeOutTimeMap[this.timeOutID]={now:i,delay:e},this.timeOutID},MainUIScene.prototype.clearTimeout=function(t){this.timeOutCancelMap[t]=!0},MainUIScene.prototype.update=function(t,e){this.fps.setText(this.game.loop.actualFps.toFixed())},MainUIScene.prototype.getKey=function(){return this.sys.config.key},MainUIScene.prototype.checkSize=function(t){t.width,t.height;var e=this.mRoom.world,i=e.getSize();this.sizeTF.text="CSS size: "+e.getConfig().width+" "+e.getConfig().height+"\n    Game size: "+i.width.toFixed(2)+" "+i.height.toFixed(2)+"\n    deviceRatio: "+window.devicePixelRatio+"\n    scene ratio: "+e.scaleRatio+"\n    ui ratio: "+e.uiRatio+"\n    ui scale: "+e.uiScale.toFixed(5)+"\n    "},MainUIScene}(r.a),h=i(342),c=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),l=function(t){function PlayScene(e){return t.call(this,e||{key:PlayScene.name})||this}return c(PlayScene,t),PlayScene.prototype.preload=function(){},PlayScene.prototype.init=function(t){t&&(this.mRoom=t.room)},PlayScene.prototype.create=function(){var t=this.cameras.main;this.cameras.addExisting(new h.a(0,0,this.sys.scale.width,this.sys.scale.height,this.mRoom.world.scaleRatio),!0),this.cameras.remove(t),this.game.scene.getScene(a.name)||this.game.scene.add(a.name,a,!1),this.game.scene.getScene(a.name).scene.isActive()?this.mRoom.initUI():this.scene.launch(a.name,{room:this.mRoom}),this.scene.sendToBack(),this.scale.on("orientationchange",this.checkOriention,this),this.scale.on("resize",this.checkSize,this),this.mRoom&&this.mRoom.startPlay()},PlayScene.prototype.update=function(t,e){this.mRoom&&this.mRoom.update(t,e)},PlayScene.prototype.getKey=function(){return this.sys.config.key},PlayScene.prototype.checkOriention=function(t){t===Phaser.Scale.PORTRAIT||Phaser.Scale.LANDSCAPE},PlayScene.prototype.checkSize=function(t){t.width,t.height},PlayScene}(r.a)},,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicSprite",(function(){return r}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),r=function(t){function DynamicSprite(e,i,n){var o=t.call(this,e,i,n,void 0)||this;return e.sys.updateList.add(o),o}return o(DynamicSprite,t),DynamicSprite.prototype.load=function(t,e,i,n,o){this.mLoadCompleteCallbak=n,this.mLoadErrorCallback=o,this.mLoadContext=i,this.mUrl=t+e,this.scene.cache.obj.get(this.mUrl)?this.onLoadComplete():(this.scene.load.atlas(this.mUrl,t,e),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())},DynamicSprite.prototype.destroy=function(e){this.scene.sys.updateList.remove(this),t.prototype.destroy.call(this,e)},DynamicSprite.prototype.onLoadComplete=function(){if(this.mLoadCompleteCallbak){var t=this.mLoadCompleteCallbak;this.mLoadCompleteCallbak=null,t.call(this.mLoadContext),this.mLoadContext=null}this.scene.anims.create({key:this.mUrl,frames:this.scene.anims.generateFrameNames(this.mUrl),repeat:1}),this.play(this.mUrl)},DynamicSprite.prototype.onLoadError=function(t){if(this.mUrl===t.url&&this.mLoadErrorCallback){var e=this.mLoadErrorCallback;this.mLoadErrorCallback=null,e.call(this.mLoadContext),this.mLoadContext=null}},DynamicSprite}(Phaser.GameObjects.Sprite)},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i(122),o=i(118),r=function(){function BlockObject(t){this.mRoomService=t,this.isUsed=!1,this.mRenderable=!1,this.mBlockable=!0,this.mInputEnable=n.c.Diasble,this.isUsed=!0}return BlockObject.prototype.setRenderable=function(t,e){var i=this;if(void 0===e&&(e=0),this.mRenderable!==t){if(this.mRenderable=t,t)return this.addDisplay(),void(e>0&&this.fadeIn());e>0?this.fadeOut((function(){i.removeDisplay()})):this.removeDisplay()}},BlockObject.prototype.getPosition=function(){return this.mDisplay?new o.a(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z):new o.a},BlockObject.prototype.getPosition45=function(){var t=this.getPosition();return t?this.mRoomService.transformTo45(t):new o.a},BlockObject.prototype.getRenderable=function(){return this.mRenderable},BlockObject.prototype.fadeIn=function(t){this.mDisplay&&this.mDisplay.fadeIn(t)},BlockObject.prototype.fadeOut=function(t){this.mDisplay&&this.mDisplay.fadeOut(t)},BlockObject.prototype.fadeAlpha=function(t){this.mDisplay},BlockObject.prototype.setInputEnable=function(t){if(this.mInputEnable=t,this.mDisplay)switch(t){case n.c.Interactive:this.mModel&&this.mModel.hasInteractive&&this.mDisplay.setInteractive();break;case n.c.Enable:this.mDisplay.setInteractive();break;default:this.mDisplay.disableInteractive()}},BlockObject.prototype.setBlockable=function(t){return this.mBlockable!==t&&(this.mBlockable=t,this.mDisplay&&this.mRoomService&&(t?this.mRoomService.addBlockObject(this):this.mRoomService.removeBlockObject(this))),this},BlockObject.prototype.destroy=function(){this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null)},BlockObject.prototype.clear=function(){this.isUsed=!1},BlockObject.prototype.addDisplay=function(){},BlockObject.prototype.removeDisplay=function(){this.mDisplay&&this.mDisplay.removeFromParent()},BlockObject.prototype.addToBlock=function(){this.mBlockable?this.mRoomService.addBlockObject(this):this.addDisplay()},BlockObject.prototype.removeFromBlock=function(t){this.mBlockable&&(this.mRoomService.removeBlockObject(this),t&&this.setRenderable(!1))},BlockObject.prototype.updateBlock=function(){this.mBlockable&&this.mRoomService.updateBlockObject(this)},BlockObject.prototype.disableBlock=function(){this.removeFromBlock(),this.mBlockable=!1,this.mRenderable=!1},BlockObject.prototype.enableBlock=function(){this.mBlockable=!0,this.addToBlock()},Object.defineProperty(BlockObject.prototype,"id",{get:function(){return-1},enumerable:!1,configurable:!0}),BlockObject}()},function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicNinepatch",(function(){return o}));var n=i(109),o=function(){function DynamicNinepatch(t,e){this.mScene=t,this.mParent=e}return DynamicNinepatch.prototype.load=function(t,e,i,n){this.mLoadCompleteCallBack=i,this.mLoadContext=n,this.mConfig=e,this.mUrl=t,this.mScene.cache.obj.get(t)?this.onLoadCompleteHandler():(this.mScene.load.image(this.mUrl,this.mUrl),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},DynamicNinepatch.prototype.onLoadCompleteHandler=function(){this.mImage=new n.NinePatch(this.mScene,this.mConfig),this.mLoadCompleteCallBack&&(this.mLoadCompleteCallBack.call(this.mLoadContext,this.mImage),this.mLoadCompleteCallBack=null,this.mLoadContext=null)},Object.defineProperty(DynamicNinepatch.prototype,"image",{get:function(){return this.mImage},enumerable:!1,configurable:!0}),DynamicNinepatch}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n,o=i(110),r=i(2),s=i(341),a=i(126),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=r.op_def.NodeType,l=function(t){function TerrainManager(e,i){var n=t.call(this)||this;n.mRoom=e,n.hasAddComplete=!1,n.mTerrains=new Map,n.mPacketFrameCount=0,n.mListener=i,n.connection&&(n.connection.addPacketListener(n),n.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,n.onAdd),n.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE_END,n.addComplete),n.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,n.onRemove),n.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SYNC_SPRITE,n.onSyncSprite),n.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_CHANGE_SPRITE_ANIMATION,n.onChangeAnimation)),n.mRoom&&n.mRoom.world&&(n.mGameConfig=n.mRoom.world.elementStorage);var o=n.roomService.miniSize;n.mMap=new Array(o.cols);for(var s=0;s<o.rows;s++)n.mMap[s]=new Array(o.rows).fill(0);return n}return h(TerrainManager,t),TerrainManager.prototype.init=function(){},TerrainManager.prototype.destroy=function(){var t=this;this.connection&&this.connection.removePacketListener(this),this.mTerrains&&(this.mTerrains.forEach((function(e){return t.remove(e.id)})),this.mTerrains.clear())},TerrainManager.prototype.get=function(t){var e=this.mTerrains.get(t);if(e)return e},TerrainManager.prototype.add=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];this._add(n)}},TerrainManager.prototype.remove=function(t){if(this.mTerrains){var e=this.mTerrains.get(t);return e&&(this.mTerrains.delete(t),e.destroy()),e}},TerrainManager.prototype.getElements=function(){return Array.from(this.mTerrains.values())},TerrainManager.prototype.onAdd=function(t){if(this.mPacketFrameCount++,this.mGameConfig){var e=t.content,i=e.sprites,n=e.nodeType,o=e.packet;if(n===r.op_def.NodeType.TerrainNodeType){for(var s=[],h=0,c=i;h<c.length;h++){var l=c[h];if(l.point3f){var p=new a.a(l,n);p.displayInfo||this.checkTerrainDisplay(p),p.displayInfo||s.push(p.id),this._add(p)}}this.fetchDisplay(s),this.mListener&&this.mPacketFrameCount===o.totalFrame&&this.mListener.onFullPacketReceived(n)}}},TerrainManager.prototype._add=function(t){var e=this.mTerrains.get(t.id);return e?e.model=t:e=new s.a(t,this),this.mTerrains.set(e.id||0,e),e},TerrainManager.prototype.addComplete=function(t){this.hasAddComplete=!0},TerrainManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,n=e.ids;if(i===r.op_def.NodeType.TerrainNodeType)for(var o=0,s=n;o<s.length;o++){var a=s[o];this.remove(a)}},TerrainManager.prototype.onSyncSprite=function(t){var e=t.content;if(e.nodeType===r.op_def.NodeType.TerrainNodeType)for(var i=null,n=0,o=e.sprites;n<o.length;n++){var s=o[n];if(i=this.get(s.id)){var h=new a.a(s,e.nodeType);i.model=h}}},TerrainManager.prototype.checkDisplay=function(t){if(!t.displayInfo){var e=this.roomService.world.elementStorage.getDisplayModel(t.bindID||t.id);if(e)return t.displayInfo=e,e}},TerrainManager.prototype.checkTerrainDisplay=function(t){if(!t.displayInfo){var e=this.roomService.world.elementStorage.getTerrainPaletteByBindId(t.bindID);e&&(t.displayInfo=e)}},TerrainManager.prototype.fetchDisplay=function(t){if(0!==t.length){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_REQ_VIRTUAL_WORLD_QUERY_SPRITE_RESOURCE);e.content.ids=t,this.connection.send(e)}},TerrainManager.prototype.removeMap=function(t){this.setMap(t,1)},TerrainManager.prototype.addMap=function(t){this.setMap(t,0)},TerrainManager.prototype.setMap=function(t,e){var i=t.displayInfo;if(i){var n=t.currentAnimation.name,o=i.getCollisionArea(n,!1),r=(i.getWalkableArea(n,!1),i.getOriginPoint(n,!1),o.length),s=o[0].length;1===r&&1===s&&(r=2,s=2,!1);t.pos;for(var a=0;a<r;a++)for(var h=0;h<s;h++);}},TerrainManager.prototype.onChangeAnimation=function(t){var e=t.content;if(e.nodeType===c.TerrainNodeType){e.changeAnimation;for(var i=0,n=e.ids;i<n.length;i++){var o=n[i];this.get(o)}}},Object.defineProperty(TerrainManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection},enumerable:!1,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!1,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"camera",{get:function(){return this.camera},enumerable:!1,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"map",{get:function(){return this.mMap},enumerable:!1,configurable:!0}),TerrainManager}(o.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n,o=i(141),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function TerrainDisplay(){return null!==t&&t.apply(this,arguments)||this}return r(TerrainDisplay,t),TerrainDisplay.prototype.showRefernceArea=function(){},TerrainDisplay}(o.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),r=function(t){function Size(e,i){return t.call(this,e,i)||this}return o(Size,t),Size}(Phaser.Structs.Size)},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n,o=i(393),r=i(110),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function SkyBoxManager(e){var i=t.call(this)||this;return i.mRoom=e,i.mScenetys=new Map,i}return s(SkyBoxManager,t),SkyBoxManager.prototype.add=function(t){var e=new o.a(t,this.mRoom);this.mScenetys.set(t.id,e)},SkyBoxManager.prototype.update=function(t){var e=this.mScenetys.get(t.id);e&&e.update(t)},SkyBoxManager.prototype.remove=function(t){var e=this.mScenetys.get(t);e&&e.destroy()},SkyBoxManager.prototype.setState=function(t){this.mStateMap||(this.mStateMap=new Map),this.mStateMap.set(t.name,t),this.mScenetys.forEach((function(e){e.setState(t)}))},SkyBoxManager.prototype.resize=function(t,e){this.mScenetys&&this.mScenetys.forEach((function(i){i.resize(t,e)}))},SkyBoxManager.prototype.destroy=function(){if(this.mRoom){var t=this.mRoom.connection;t&&t.removePacketListener(this)}this.mScenetys.forEach((function(t){return t.destroy()})),this.mScenetys.clear()},Object.defineProperty(SkyBoxManager.prototype,"scenery",{get:function(){return Array.from(this.mScenetys.values())},enumerable:!1,configurable:!0}),SkyBoxManager}(r.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"DecorateManager",(function(){return h}));var n,o=i(182),r=i(110),s=i(2),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function DecorateManager(e,i){var n=t.call(this)||this;return n.mPanel=new o.DecoratePanel(e,i),n.mPanel.on("moveElement",n.onMoveElementHandler,n),n.mPanel.on("addSprite",n.onAddSpriteHandler,n),n.mPanel.on("addSingleSprite",n.onAddSingleSprtieHandle,n),n.mRoomService=i,n.mLayerManager=i.layerManager,n}return a(DecorateManager,t),DecorateManager.prototype.setElement=function(t){this.mPanel.setElement(t),this.mLayerManager.addToSceneToUI(this.mPanel),this.mPanel.show()},DecorateManager.prototype.canPut=function(t){this.mPanel&&this.mPanel.canPUt(t)},DecorateManager.prototype.remove=function(){this.mPanel.parentContainer&&this.mPanel.parentContainer.remove(this.mPanel),this.mPanel.removeListen()},DecorateManager.prototype.updatePos=function(t,e){this.mPanel&&this.mPanel.setPos(t,e)},DecorateManager.prototype.destroy=function(){this.mPanel&&this.mPanel.destroy(),t.prototype.destroy.call(this)},DecorateManager.prototype.onMoveElementHandler=function(t){this.emit("moveElement",t)},DecorateManager.prototype.onAddSpriteHandler=function(t,e){this.sendAddSpriteByType(t,e)},DecorateManager.prototype.onAddSingleSprtieHandle=function(t,e){this.sendAddSingleSprite(t,e)},DecorateManager.prototype.sendAddSpriteByType=function(t,e){if(t&&e&&!(e.length<1)){for(var i=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ADD_SPRITE_BY_TYPE),n=i.content,o=[],a=0,h=e;a<h.length;a++){var c=h[a],l=s.op_def.PBPoint3f.create();l.x=c.x,l.y=c.y,o.push(l)}n.nodeType=s.op_def.NodeType.ElementNodeType,n.sprite=t.toSprite(),n.points=o,this.mRoomService.connection.send(i)}},DecorateManager.prototype.sendAddSingleSprite=function(t,e){if(t&&e&&!(e.length<1)){for(var i=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ADD_SINGLE_SPRITE_BY_TYPE),n=i.content,o=[],a=0,h=e;a<h.length;a++){var c=h[a],l=s.op_def.PBPoint3f.create();l.x=c.x,l.y=c.y,o.push(l)}n.nodeType=s.op_def.NodeType.ElementNodeType,n.sprite=t.toSprite(),n.points=o,this.mRoomService.connection.send(i)}},DecorateManager}(Phaser.Events.EventEmitter)},function(t,e,i){"use strict";i.r(e),i.d(e,"DecoratePanel",(function(){return p}));var n,o=i(112),r=i(118),s=i(138),a=i(119),h=i(122),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function DecoratePanel(e,i){var n=t.call(this,e,i.world)||this;return n.mRoomService=i,n.resKey="decorate",n.minGrid=2,n.maxGrid=10,n.key="decorate_edit_menu",n.offset=new r.a,n.mScaleRatio=1,n.setTween(!1),n.mWorld&&(n.mScaleRatio=n.mWorld.scaleRatio),n}return l(DecoratePanel,t),DecoratePanel.prototype.show=function(t){this.mShowData=t,this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0):this.preload()},DecoratePanel.prototype.addListen=function(){this.mCancelBtn&&this.mCancelBtn.on(String(c.ClickEvent.Tap),this.onCancelHandler,this),this.mOkBtn&&this.mOkBtn.on(String(c.ClickEvent.Tap),this.onAddHandler,this),this.mRecycleBtn&&this.mRecycleBtn.on(String(c.ClickEvent.Tap),this.onRecycleHandler,this),this.mTurnBtn&&this.mTurnBtn.on(String(c.ClickEvent.Tap),this.onTurnHandler,this),this.mMoveBtn&&this.mMoveBtn.on(String(c.ClickEvent.Tap),this.onShowMoveMenuHandler,this),this.mRepeatBtn&&this.mRepeatBtn.on(String(c.ClickEvent.Tap),this.onShowRepeatHandler,this),this.mExtendBtn&&this.mExtendBtn.on(String(c.ClickEvent.Tap),this.onShowExtendsHandler,this),this.mMoveMenuContainer&&(this.mMoveMenuContainer.register(),this.mMoveMenuContainer.on(c.ClickEvent.Tap,this.onMoveHandler,this)),this.mRepeatMenuContainer&&(this.mRepeatMenuContainer.register(),this.mRepeatMenuContainer.on(c.ClickEvent.Tap,this.onRepeatHandler,this),this.mRepeatMenuContainer.on(c.ClickEvent.Hold,this.onHoldRepeatHandler,this))},DecoratePanel.prototype.removeListen=function(){this.mCancelBtn&&this.mCancelBtn.off(c.ClickEvent.Tap,this.onCancelHandler,this),this.mOkBtn&&this.mOkBtn.off(String(c.ClickEvent.Tap),this.onAddHandler,this),this.mRecycleBtn&&this.mRecycleBtn.off(String(c.ClickEvent.Tap),this.onRecycleHandler,this),this.mTurnBtn&&this.mTurnBtn.off(String(c.ClickEvent.Tap),this.onTurnHandler,this),this.mMoveBtn&&this.mMoveBtn.off(String(c.ClickEvent.Tap),this.onShowMoveMenuHandler,this),this.mRepeatBtn&&this.mRepeatBtn.off(String(c.ClickEvent.Tap),this.onShowRepeatHandler,this),this.mExtendBtn&&this.mExtendBtn.off(String(c.ClickEvent.Tap),this.onShowExtendsHandler,this),this.mMoveMenuContainer&&(this.mMoveMenuContainer.unRegister(),this.mMoveMenuContainer.off(c.ClickEvent.Tap,this.onMoveHandler,this)),this.mRepeatMenuContainer&&(this.mRepeatMenuContainer.unRegister(),this.mRepeatMenuContainer.off(c.ClickEvent.Tap,this.onRepeatHandler,this),this.mRepeatMenuContainer.off(c.ClickEvent.Hold,this.onHoldRepeatHandler,this))},DecoratePanel.prototype.setElement=function(t){if(this.mDisplayObject=t,this.mSprite=t.model,this.mInitialized){var e=this.mDisplayObject.getPosition();this.x=e.x,this.y=e.y,this.updateArrowPos(t),this.addListen()}},DecoratePanel.prototype.canPUt=function(t){if(t!==this.mCanPut){if(this.mCanPut=t,!this.mOkBtn)return;this.mOkBtn.enable=t}},DecoratePanel.prototype.setPos=function(t,e,i){return this.x=t*this.mScaleRatio,this.y=(e+this.offset.y)*this.mScaleRatio,this.z=i||0,this},DecoratePanel.prototype.destroy=function(){this.mRepeatMenuContainer&&this.mRepeatMenuContainer.destroy(),this.mMoveMenuContainer&&this.mMoveMenuContainer.destroy(),t.prototype.destroy.call(this)},DecoratePanel.prototype.preload=function(){this.addAtlas(this.key,"decorate_edit_menu/decorate_edit_menu.png","decorate_edit_menu/decorate_edit_menu.json"),t.prototype.preload.call(this)},DecoratePanel.prototype.init=function(){var e=this.scene.cameras.main.width/this.scale;this.scene.cameras.main.height,this.scale;this.mMainMenus=[],this.mMenuContainer=this.scene.make.container({x:e>>1},!1),this.mSubMenus=this.scene.make.container({x:e>>1,y:60*this.dpr},!1),this.mOkBtn=new c.Button(this.scene,this.key,"ok_btn.png"),this.mRecycleBtn=new c.Button(this.scene,this.key,"recycly_btn.png"),this.mTurnBtn=new c.Button(this.scene,this.key,"turn_btn.png"),this.mCancelBtn=new c.Button(this.scene,this.key,"cancel_btn.png"),this.mMenuContainer.y=.5*this.mOkBtn.height,this.mSubMenus.y=this.mMenuContainer.y+60*this.dpr,this.mHorizontalBtn=new c.Button(this.scene,this.key,"horizontal_btn.png"),this.mMoveBtn=new c.Button(this.scene,this.key,"move_btn.png"),this.mRepeatBtn=new c.Button(this.scene,this.key,"repeat_btn.png"),this.mExtendBtn=new c.Button(this.scene,this.key,"extend_btn.png"),this.mMoveMenuContainer=new d(this.scene,this.key,this.dpr,this.scale),this.mMoveMenuContainer.y=this.mSubMenus.y+15*this.dpr+this.mMoveMenuContainer.height,this.mRepeatMenuContainer=new d(this.scene,this.key,this.dpr,this.scale),this.mRepeatMenuContainer.y=this.mMoveMenuContainer.y;var i=this.scale;this.add([this.mMenuContainer,this.mSubMenus]),this.mMenuContainer.add([this.mOkBtn,this.mTurnBtn,this.mRecycleBtn,this.mCancelBtn]),this.mSubMenus.add([this.mHorizontalBtn,this.mMoveBtn,this.mRepeatBtn,this.mExtendBtn]);var n=e-55*this.dpr*this.mWorld.uiScale*2;this.mMenuContainer.x=-n>>1;var o=this.mMenuContainer.list;o.map((function(t){return n-=t.width}));for(var r=n/(o.length-1)/i,s=1;s<o.length;s++){var a=o[s-1];o[s].x=a.width+a.x+r}n=e-70*this.dpr*this.mWorld.uiScale*2,this.mSubMenus.x=-n>>1;var h=this.mSubMenus.list;h.map((function(t){return n-=t.width})),r=n/(h.length-1)/i;for(s=1;s<h.length;s++){a=h[s-1];h[s].x=a.width+a.x+r}this.mMoveMenuContainer.x=this.mSubMenus.x+this.mMoveBtn.x+29*this.dpr,this.mRepeatMenuContainer.x=this.mSubMenus.x+this.mRepeatBtn.x+29*this.dpr,this.mOkBtn.enable=this.mCanPut,t.prototype.init.call(this),this.setElement(this.mDisplayObject)},DecoratePanel.prototype.onLeftUpHandler=function(){if(this.mDisplayObject){var t=this.mRoomService.transformToMini45(this.mDisplayObject.getPosition());t.x-=1,this.onMoveElement(t)}},DecoratePanel.prototype.onLeftDownHandler=function(){var t=this.mRoomService.transformToMini45(this.mDisplayObject.getPosition());t.y+=1,this.onMoveElement(t)},DecoratePanel.prototype.onRightUpHandler=function(){var t=this.mRoomService.transformToMini45(this.mDisplayObject.getPosition());t.y-=1,this.onMoveElement(t)},DecoratePanel.prototype.onRightDownHandler=function(){var t=this.mRoomService.transformToMini45(this.mDisplayObject.getPosition());t.x=t.x+1,this.onMoveElement(t)},DecoratePanel.prototype.getNorthWestPoints=function(t){void 0===t&&(t=10);for(var e=this.mSprite.currentCollisionArea,i=this.mSprite.currentCollisionPoint,n=[],o=this.mRoomService.transformToMini45(this.mSprite.pos),r=0;r<t;r++)n[r]=this.mRoomService.transformToMini90(o),o.x-=e[0].length;return this.checkNextPos(n,e,i)},DecoratePanel.prototype.getWestSouthPoints=function(t){void 0===t&&(t=10);for(var e=this.mSprite.currentCollisionArea,i=this.mSprite.currentCollisionPoint,n=[],o=this.mRoomService.transformToMini45(this.mSprite.pos),r=0;r<t;r++)n[r]=this.mRoomService.transformToMini90(o),o.y+=e.length;return this.checkNextPos(n,e,i)},DecoratePanel.prototype.getSouthEastPoints=function(t){void 0===t&&(t=10);for(var e=this.mSprite.currentCollisionArea,i=this.mSprite.currentCollisionPoint,n=[],o=this.mRoomService.transformToMini45(this.mSprite.pos),r=0;r<t;r++)n[r]=this.mRoomService.transformToMini90(o),o.x+=e[0].length;return this.checkNextPos(n,e,i)},DecoratePanel.prototype.getEastNorthPoints=function(t){void 0===t&&(t=10);for(var e=this.mSprite.currentCollisionArea,i=this.mSprite.currentCollisionPoint,n=[],o=this.mRoomService.transformToMini45(this.mSprite.pos),r=0;r<t;r++)n[r]=this.mRoomService.transformToMini90(o),o.y-=e.length;return this.checkNextPos(n,e,i)},DecoratePanel.prototype.checkNextPos=function(t,e,i){for(var n=[],o=0,r=t;o<r.length;o++){var s=r[o],a=this.getNextRepeatPos(s,e,i);if(!a)break;n.push(a)}return n},DecoratePanel.prototype.getNextRepeatPos=function(t,e,i){if(this.mRoomService.canPut(t,e,i))return t},DecoratePanel.prototype.onMoveElement=function(t){if(this.mDisplayObject){var e=this.mRoomService.transformToMini90(t);this.emit("moveElement",e)}},DecoratePanel.prototype.createImage=function(t,e,i,n){return this.scene.make.image({key:t,frame:e,x:i,y:n},!1).setInteractive().setOrigin(0)},DecoratePanel.prototype.validateGrid=function(t){return t>this.maxGrid&&(t=this.maxGrid),t<this.minGrid&&(t=this.minGrid),t},DecoratePanel.prototype.updateArrowPos=function(t){var e;if(t&&t.model&&t.getDisplay()){t.getDisplay();var i=t.model.currentCollisionArea.length,n=t.model.currentCollisionArea[0].length;i=this.validateGrid(i),n=this.validateGrid(n),-1===t.getDisplay().scaleX&&(i=(e=[n,i])[0],n=e[1]);var o=this.mRoomService.roomSize,a={rows:i,cols:n,tileWidth:o.tileWidth/2,tileHeight:o.tileHeight/2},h=t.model,c=s.a.transformTo90(new r.a(n-h.currentCollisionPoint.y,i-h.currentCollisionPoint.x),a);this.offset.y=c.y}},DecoratePanel.prototype.onTurnHandler=function(){this.mWorld.emitter.emit(a.a.TURN_ELEMENT,this.mDisplayObject)},DecoratePanel.prototype.onRecycleHandler=function(){this.mWorld.emitter.emit(a.a.RECYCLE_ELEMENT,this.mDisplayObject)},DecoratePanel.prototype.onCancelHandler=function(){this.mWorld.emitter.emit(a.a.CANCEL_PUT,this.mDisplayObject)},DecoratePanel.prototype.onAddHandler=function(){this.mCanPut&&this.mWorld.emitter.emit(a.a.PUT_ELEMENT,this.mDisplayObject)},DecoratePanel.prototype.onMoveHandler=function(t){if("number"==typeof t)switch(t){case h.a.north_west:this.onLeftUpHandler();break;case h.a.west_south:this.onLeftDownHandler();break;case h.a.south_east:this.onRightDownHandler();break;case h.a.east_north:this.onRightUpHandler()}},DecoratePanel.prototype.onPutHandler=function(){this.mWorld.emitter.emit(a.a.PUT_ELEMENT,this.mDisplayObject)},DecoratePanel.prototype.onRepeatHandler=function(t){var e=null;switch(t){case h.a.north_west:e=this.getNorthWestPoints(2);break;case h.a.west_south:e=this.getWestSouthPoints(2);break;case h.a.south_east:e=this.getSouthEastPoints(2);break;case h.a.east_north:e=this.getEastNorthPoints(2)}this.onSendAddSingleSprite(e)},DecoratePanel.prototype.onHoldRepeatHandler=function(t){var e=null;switch(t){case h.a.north_west:e=this.getNorthWestPoints();break;case h.a.west_south:e=this.getWestSouthPoints();break;case h.a.south_east:e=this.getSouthEastPoints();break;case h.a.east_north:e=this.getEastNorthPoints()}this.onSendAddSprites(e)},DecoratePanel.prototype.onShowMoveMenuHandler=function(){this.add(this.mMoveMenuContainer),this.remove(this.mRepeatMenuContainer)},DecoratePanel.prototype.onShowRepeatHandler=function(){this.add(this.mRepeatMenuContainer),this.remove(this.mMoveMenuContainer)},DecoratePanel.prototype.onShowExtendsHandler=function(){},DecoratePanel.prototype.onSendAddSprites=function(t){t.length>1&&this.emit("addSprite",this.mSprite,t)},DecoratePanel.prototype.onSendAddSingleSprite=function(t){t.length>1&&this.emit("addSingleSprite",this.mSprite,t)},DecoratePanel}(o.BasePanel),d=function(t){function MoveMenu(e,i,n,o){void 0===n&&(n=1),void 0===o&&(o=1);var r=t.call(this,e)||this,s=e.make.image({key:i,frame:"bg.png"},!1);r.setSize(s.displayWidth,s.displayHeight),r.mArrow1=new c.Button(r.scene,i,"arrow_1.png"),r.mArrow1.setData("dir",h.a.north_west),r.mArrow3=new c.Button(r.scene,i,"arrow_3.png"),r.mArrow3.setData("dir",h.a.west_south),r.mArrow5=new c.Button(r.scene,i,"arrow_5.png"),r.mArrow5.setData("dir",h.a.south_east),r.mArrow7=new c.Button(r.scene,i,"arrow_7.png"),r.mArrow7.setData("dir",h.a.east_north),r.mBtns=[r.mArrow1,r.mArrow3,r.mArrow5,r.mArrow7],r.add(s),r.add(r.mBtns);r.width;var a=r.width-20*n;r.mBtns.map((function(t){return a-=t.displayWidth}));for(var l=a/=r.mBtns.length-1,p=3*n,d=0;d<r.mBtns.length;d++)r.mBtns[d].x=0===d?10*n+r.mBtns[d].width/2-r.width/2:l+r.mBtns[d-1].x+r.mBtns[d-1].width,r.mBtns[d].y=p;return r.setInteractive(),r}return l(MoveMenu,t),MoveMenu.prototype.register=function(){this.mArrow1.on(c.ClickEvent.Hold,this.onHoldHandler,this),this.mArrow1.on(c.ClickEvent.Tap,this.onClickHandler,this),this.mArrow3.on(c.ClickEvent.Hold,this.onHoldHandler,this),this.mArrow3.on(c.ClickEvent.Tap,this.onClickHandler,this),this.mArrow5.on(c.ClickEvent.Hold,this.onHoldHandler,this),this.mArrow5.on(c.ClickEvent.Tap,this.onClickHandler,this),this.mArrow7.on(c.ClickEvent.Hold,this.onHoldHandler,this),this.mArrow7.on(c.ClickEvent.Tap,this.onClickHandler,this)},MoveMenu.prototype.unRegister=function(){this.mArrow1.off(c.ClickEvent.Hold,this.onHoldHandler,this),this.mArrow1.off(c.ClickEvent.Tap,this.onClickHandler,this),this.mArrow3.off(c.ClickEvent.Hold,this.onHoldHandler,this),this.mArrow3.off(c.ClickEvent.Tap,this.onClickHandler,this),this.mArrow5.off(c.ClickEvent.Hold,this.onHoldHandler,this),this.mArrow5.off(c.ClickEvent.Tap,this.onClickHandler,this),this.mArrow7.off(c.ClickEvent.Hold,this.onHoldHandler,this),this.mArrow7.off(c.ClickEvent.Tap,this.onClickHandler,this)},MoveMenu.prototype.onHoldHandler=function(t){this.emit(c.ClickEvent.Hold,t.getData("dir"))},MoveMenu.prototype.onClickHandler=function(t,e){this.emit(c.ClickEvent.Tap,e.getData("dir"))},MoveMenu}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"UiManager",(function(){return N}));var n,o=i(110),r=i(2),s=i(144),a=i(188),h=i(189),c=i(132),l=i(159),p=i(147),d=i(161),m=i(200),u=i(162),f=i(203),y=i(205),g=i(119),_=i(207),P=i(208),v=i(210),w=i(148),S=i(216),b=i(125),C=i(219),T=i(222),I=i(225),M=i(228),E=i(232),k=i(238),B=i(242),O=i(166),D=i(247),R=i(251),x=i(135),A=i(114),L=i(109),F=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),N=function(t){function UiManager(e){var i=t.call(this)||this;return i.worldService=e,i.mCache=[],i.mNoneUIMap=new Map,i.mSceneUIMap=new Map,i.mNormalUIMap=new Map,i.mPopUIMap=new Map,i.mTipUIMap=new Map,i.mMonopolyUIMap=new Map,i.mActivityUIMap=new Map,i.mShowuiList=[],i.mStackList=[],i.isShowMainUI=!1,i.mConnect=e.connection,i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_UI,i.handleShowUI),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_UPDATE_UI,i.handleUpdateUI),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CLOSE_UI,i.handleCloseUI),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ENABLE_MARKET,i.onEnableMarket),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_PKT_REFRESH_ACTIVE_UI,i.onUIStateHandler),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_FORCE_OFFLINE,i.onForceOfflineHandler),i.mUILayerManager=new a.LayerManager,i.mInputTextFactory=new _.InputTextFactory(e),i}return F(UiManager,t),UiManager.prototype.getInputTextFactory=function(){return this.mInputTextFactory},UiManager.prototype.addPackListener=function(){this.mConnect&&(this.mConnect.addPacketListener(this),this.worldService.emitter.on(g.a.SHOW_UI,this.handleShowUI,this))},UiManager.prototype.removePackListener=function(){this.mConnect&&(this.mConnect.removePacketListener(this),this.worldService.emitter.off(g.a.SHOW_UI,this.handleShowUI,this))},UiManager.prototype.getUILayerManager=function(){return this.mUILayerManager},UiManager.prototype.getActiveUIData=function(t){if(!this.mAtiveUIData)return null;for(var e=[],i=0,n=this.mAtiveUIData.ui;i<n.length;i++){var o=n[i],r=o.name.split(".")[0];this.getPanelNameByStateTag(r)===t&&e.push(o)}return e},UiManager.prototype.setScene=function(t){this.mScene=t,this.mUILayerManager.setScene(t),t&&this.mCacheUI&&(this.mCacheUI(),this.mCacheUI=void 0)},UiManager.prototype.showMainUI=function(){var t=this;if(this.mScene){var e=this.mScene;if(this.clearMediator(),this.mMedMap||(this.mMedMap=new Map,this.worldService.game.device.os.desktop?this.mMedMap.set(f.BagGroupMediator.NAME,new f.BagGroupMediator(this.worldService,e)):(this.mMedMap.set(v.ActivityMediator.name,new v.ActivityMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(k.PicaMainUIMediator.name,new k.PicaMainUIMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(w.PicaChatMediator.name,new w.PicaChatMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(O.PicHandheldMediator.name,new O.PicHandheldMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(S.MineCarMediator.name,new S.MineCarMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(I.MineSettleMediator.name,new I.MineSettleMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(T.ComposeMediator.name,new T.ComposeMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(M.EquipUpgradeMediator.name,new M.EquipUpgradeMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(E.MarketMediator.name,new E.MarketMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(B.PicFurniFunMediator.name,new B.PicFurniFunMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(D.InteractiveBubbleMediator.name,new D.InteractiveBubbleMediator(this.mUILayerManager,e,this.worldService))),this.mMedMap.set(b.UIMediatorType.BagMediator,new c.BagMediator(this.mUILayerManager,this.worldService,e)),this.worldService.game.device.os.desktop&&this.mMedMap.set(b.UIMediatorType.ChatMediator,new s.ChatMediator(this.worldService,e)),this.mMedMap.set(b.UIMediatorType.NOTICE,new h.NoticeMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(l.FriendMediator.NAME,new l.FriendMediator(e,this.worldService)),this.mMedMap.set(C.ReAwardTipsMediator.name,new C.ReAwardTipsMediator(e,this.worldService)),this.mMedMap.set(R.CharacterInfoMediator.name,new R.CharacterInfoMediator(this.mUILayerManager,e,this.worldService))),this.mMedMap.forEach((function(e,i){var n,o=!!t.worldService.game.device.os.desktop;switch(i){case m.LeftMediator.NAME:case d.RightMediator.NAME:case u.BottomMediator.NAME:n=t.mSceneUIMap;break;case f.BagGroupMediator.NAME:case b.UIMediatorType.ChatMediator:case p.RankMediator.NAME:o&&(n=t.mSceneUIMap)}n&&n.set(i,e),e.isSceneUI()&&e.show()})),this.mAtiveUIData&&this.updateUIState(this.mAtiveUIData),this.mCache){for(var i=0,n=this.mCache;i<n.length;i++){var o=n[i][0];this.showMed(o.name,o)}this.mCache.length=0}}else this.mCacheUI=this.showMainUI},UiManager.prototype.showDecorateUI=function(){this.mScene?(this.clearMediator(),this.mMedMap||(this.mMedMap=new Map),this.mMedMap.set(P.DecorateControlMediator.NAME,new P.DecorateControlMediator(this.mUILayerManager,this.mScene,this.worldService)),this.mMedMap.set(b.UIMediatorType.NOTICE,new h.NoticeMediator(this.mUILayerManager,this.mScene,this.worldService)),this.showAll()):this.mCacheUI=this.showDecorateUI},UiManager.prototype.resize=function(t,e){this.mMedMap&&this.mMedMap.forEach((function(t){t.isShow&&t.resize()}))},UiManager.prototype.setMediator=function(t,e){this.mMedMap.set(t,e)},UiManager.prototype.getMediator=function(t){if(this.mMedMap)return this.mMedMap.get(t)},UiManager.prototype.clearMediator=function(){this.mMedMap&&(this.mMedMap.forEach((function(t){return t.destroy()})),this.mMedMap.clear(),this.mMedMap=null)},UiManager.prototype.destroy=function(){this.removePackListener(),this.clearMediator(),this.mMedMap=void 0,this.clearCache(),this.mScene=void 0},UiManager.prototype.baseFaceResize=function(){var t=this.getMediator(u.BottomMediator.NAME),e=this.getMediator(d.RightMediator.NAME),i=this.getMediator(m.LeftMediator.NAME);e&&e.getView()&&e.getView().resize(0,0),i&&i.getView()&&i.getView().resize(0,0),t&&t.getView()&&t.getView().resize(0,0)},UiManager.prototype.baseFaceTween=function(t){var e=this.getMediator(d.RightMediator.NAME),i=this.getMediator(m.LeftMediator.NAME),n=this.getMediator(u.BottomMediator.NAME);e&&e.getView()&&e.getView().tweenExpand(t),i&&i.getView()&&i.getView().tweenExpand(t),n&&n.getView()&&n.getView().tweenExpand(t)},UiManager.prototype.checkUIState=function(t,e){var i=this.mMedMap.get(t);if(i){var n,o=i.UIType,r=this.worldService.game.device.os.desktop;switch(o){case L.UIType.None:n=this.mNoneUIMap;break;case L.UIType.Scene:n=this.mSceneUIMap;break;case L.UIType.Normal:n=this.mNormalUIMap,r?this.checkNormalUITween(e,t):this.checkBaseUImap(e);break;case L.UIType.Monopoly:n=this.mMonopolyUIMap,this.checkBaseUImap(e),this.checkNormalUImap(e),this.chekcTipUImap(e);break;case L.UIType.Tips:n=this.mTipUIMap;break;case L.UIType.Pop:n=this.mPopUIMap;break;case L.UIType.Activity:n=this.mActivityUIMap}n&&n.set(t,i)}},UiManager.prototype.showMed=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(this.mScene){this.mMedMap||(this.mMedMap=new Map);var o=(t=this.getPanelNameByAlias(t))+"Mediator",r=this.mMedMap.get(o);if(!r){var s=i(414)("./"+t+"/"+o);if(!(r=new s[o](this.mUILayerManager,this.mScene,this.worldService)))return;this.mMedMap.set(t+"Mediator",r)}e&&r.setParam(e),this.checkUIState(o,!1),r.show(e)}else this.mCache.push(e)},UiManager.prototype.hideMed=function(t){if(this.mMedMap){var e=(t=this.getPanelNameByAlias(t))+"Mediator",i=this.mMedMap.get(e);i&&(this.checkUIState(e,!0),i.hide())}},UiManager.prototype.showExistMed=function(t,e){if(void 0===e&&(e="Mediator"),this.mMedMap){var i=(t=this.getPanelNameByAlias(t))+e,n=this.mMedMap.get(i);n&&n.show()}},UiManager.prototype.handleShowUI=function(t){var e=t.content;this.showMed(e.name,e)},UiManager.prototype.handleUpdateUI=function(t){var e=t.content;this.updateMed(e.name,e)},UiManager.prototype.handleCloseUI=function(t){var e=t.content;this.hideMed(e.name)},UiManager.prototype.onEnableEditMode=function(t){var e=this.mMedMap.get(y.TopMenuMediator.NAME);e||(e=new y.TopMenuMediator(this.mScene,this.worldService),this.mMedMap.set(y.TopMenuMediator.NAME,e)),e.addItem({key:"Turn_Btn_Top",name:"EnterDecorate",bgResKey:"baseView",bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:"",iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"})},UiManager.prototype.onEnableMarket=function(){if(this.mMedMap){var t=this.mMedMap.get(y.TopMenuMediator.NAME);t||(t=new y.TopMenuMediator(this.mScene,this.worldService),this.mMedMap.set(y.TopMenuMediator.NAME,t)),t.addItem({key:"Turn_Btn_Top",name:"Market",bgResKey:"baseView",bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:"",iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"})}},UiManager.prototype.checkBaseUImap=function(t){this.mSceneUIMap.forEach((function(e){e&&e.tweenExpand(t)}))},UiManager.prototype.checkNormalUITween=function(t,e){var i,n,o=this.worldService.getSize(),r=this.mShowuiList.length;if(t){var s=void 0;for(h=0;h<r;h++)i=this.mShowuiList[h],n=this.mMedMap.get(i),i!==e?n.resize(0,0):s=h;this.mShowuiList.splice(s,1)}else{-1===this.mShowuiList.indexOf(e)&&this.mShowuiList.push(e);for(var a=(r=this.mShowuiList.length)>1?o.width/3:0,h=0;h<r;h++)i=this.mShowuiList[h],n=this.mMedMap.get(i),r>2&&0===h?n.hide():n.resize((2*h-1)*a,0);r>2&&this.mShowuiList.shift()}},UiManager.prototype.checkNormalUImap=function(t){this.mNormalUIMap.forEach((function(e){e&&(t||e.hide())})),t||this.mNormalUIMap.clear()},UiManager.prototype.chekcTipUImap=function(t){this.mTipUIMap.forEach((function(e){e&&(t||e.hide())})),t||this.mNormalUIMap.clear()},UiManager.prototype.updateMed=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(this.mMedMap){var n=t+"Mediator",o=this.mMedMap.get(n);o&&(e&&o.setParam(e),o.update(e))}},UiManager.prototype.showAll=function(){this.mMedMap&&this.mMedMap.forEach((function(t){t.isSceneUI()&&t.show()}))},UiManager.prototype.clearCache=function(){this.mCacheUI=void 0,this.mCache=[]},UiManager.prototype.closeAll=function(){this.mMedMap&&this.mMedMap.forEach((function(t){return t.hide()}))},UiManager.prototype.onUIStateHandler=function(t){this.mAtiveUIData=t.content,this.mAtiveUIData&&this.mMedMap&&this.updateUIState(this.mAtiveUIData)},UiManager.prototype.updateUIState=function(t){for(var e=0,i=t.ui;e<i.length;e++){var n=i[e],o=n.name.split("."),r=this.getPanelNameByStateTag(o[0]);if(r){var s=this.mMedMap.get(r+"Mediator");if(s)if(1===o.length)n.visible||void 0===n.visible?this.showMed(r):this.hideMed(r);else{var a=s.getView();a&&a.updateUIState(n)}}}},UiManager.prototype.onForceOfflineHandler=function(t){new x.AlertView(this.mScene,this.worldService).show({text:A.a.t("common.offline"),callback:function(){},btns:x.Buttons.Ok})},UiManager.prototype.getPanelNameByStateTag=function(t){switch(t){case"mainui":return"PicaMainUI";case"activity":return"Activity";case"picachat":return"PicaChat";case"picanavigate":return"PicaNavigate";case"PicHandheld":return"PicHandheld"}return t},UiManager.prototype.getPanelNameByAlias=function(t){switch(t){case"MessageBox":return"PicaMessageBox"}return t},UiManager}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatPanelPC",(function(){return p}));var n,o=i(121),r=i(111),s=i(156),a=i(117),h=i(157),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function ChatPanelPC(e,i){var n=t.call(this,e,i)||this;return n.mPreHei=0,n.mPreWid=0,n}return l(ChatPanelPC,t),ChatPanelPC.prototype.appendChat=function(t){this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom())},ChatPanelPC.prototype.tweenExpand=function(t){if(this.scene){var e=!0===t?0:-200,i=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Cubic.Out",props:{x:{value:e},alpha:{value:i}}})}},ChatPanelPC.prototype.setPosition=function(e,i){if(this.mInitialized){var n=this.mWorld.getSize();if(t.prototype.setPosition.call(this,0,n.height-this.mPreHei),this.mTextArea)this.mTextArea.childrenMap.text.y=n.height-this.height+25*this.dpr,this.mTextArea.scrollToBottom();return this}},ChatPanelPC.prototype.addListen=function(){this.mInitialized&&(this.sendMsgBtn&&this.sendMsgBtn.on("pointerdown",this.onSendMsgHandler,this),this.mVoiceBtn&&this.mVoiceBtn.on("selected",this.onSelectedVoiceHandler,this),this.mMicBtn&&this.mMicBtn.on("selected",this.onSelectedMicHandler,this),this.mInputText&&(this.mInputText.on("focus",this.onFocusHandler,this),this.mInputText.on("blur",this.onBlurHandler,this)))},ChatPanelPC.prototype.removeListen=function(){t.prototype.removeListen.call(this),this.mInitialized&&(this.sendMsgBtn&&this.sendMsgBtn.off("pointerdown",this.onSendMsgHandler,this),this.mVoiceBtn&&this.mVoiceBtn.off("selected",this.onSelectedVoiceHandler,this),this.mMicBtn&&this.mMicBtn.off("selected",this.onSelectedMicHandler,this),this.mInputText&&(this.mInputText.off("focus",this.onFocusHandler,this),this.mInputText.off("blur",this.onBlurHandler,this)))},ChatPanelPC.prototype.destroy=function(){t.prototype.destroy.call(this)},ChatPanelPC.prototype.preload=function(){this.scene&&(this.scene.load.image("button",r.i.getRes("ui/common/button.png")),this.scene.load.image("thumbTexture",r.i.getRes("ui/common/common_thumb_texture.png")),this.scene.load.image("track",r.i.getRes("ui/common/common_track.png")),this.scene.load.image("chat_input_bg",r.i.getRes("ui/chat/input_bg.png")),this.scene.load.image(r.d.getName(),r.d.getPNG()),this.scene.load.atlas("chat_atlas",r.i.getRes("ui/chat/chat_atlas.png"),r.i.getRes("ui/chat/chat_atlas.json")),t.prototype.preload.call(this))},ChatPanelPC.prototype.init=function(){if(!this.mInitialized){var e=this.mWorld.getSize();this.mPreHei=e.height,this.mPreWid=e.width,this.setSize(464,281);var i=new a.NinePatch(this.scene,0,0,this.width,this.height,r.d.getName(),null,r.d.getConfig());i.x=4*this.mWorld.uiScale+i.width*i.originX,i.y=e.height-260*this.mWorld.uiScale+i.height*i.originY,this.add(i),this.outPut=this.scene.make.container(void 0,!1),this.add(this.outPut);var n=new c.RoundRectangle(this.scene,0,0,2,2,3,8421504,.5);this.outPut.add(n);var h=new o.NinePatchButton(this.scene,0,0,4,7,"track","","",{left:0,top:2,right:0,bottom:2});h.x=100*this.mWorld.uiScale,h.y=10*this.mWorld.uiScale,this.outPut.add(h);var l=new c.BBCodeText(this.scene,0,0,"",{fontSize:"14px",wrap:{mode:"char",width:400*this.mWorld.uiScale}});this.outPut.add(l);var p=new o.NinePatchButton(this.scene,0,0,20,35,"button","","",{left:4,top:4,right:4,bottom:4});this.outPut.add(p),this.mTextArea=new c.TextArea(this.scene,{x:230*this.mWorld.uiScale,y:e.height-155*this.mWorld.uiScale,textWidth:430,textHeight:200,text:l,slider:{track:h,thumb:p}}).layout(),this.outPut.add(this.mTextArea);this.mTextArea.getElement("child");var d=this.scene.make.container(void 0,!1);this.add(d);var m=new a.NinePatch(this.scene,0,0,370,32,"chat_input_bg",null,{left:4,top:4,right:4,bottom:4});m.x=8*this.mWorld.uiScale+m.width*m.originX,m.y=e.height-46*this.mWorld.uiScale+m.height*m.originY,d.add(m),this.mInputText=new c.InputText(this.scene,0,0,10,10,{type:"input",fontSize:"14px",color:"#808080"}).resize(360,20).setOrigin(0,0).setStyle({font:"bold 16px YaHei"}),this.mInputText.x=12*this.mWorld.uiScale,this.mInputText.y=e.height-40*this.mWorld.uiScale,d.add(this.mInputText),this.sendMsgBtn=new o.NinePatchButton(this.scene,0,0,60,30,"button","","发送",{left:4,top:4,right:4,bottom:4}),this.sendMsgBtn.x=this.width-this.sendMsgBtn.width+10*this.mWorld.uiScale,this.sendMsgBtn.y=e.height-this.sendMsgBtn.height,this.add(this.sendMsgBtn),this.mSendKey=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.mVoiceBtn=new s.CheckButton(this.scene,0,0,"chat_atlas","voice_normal.png","voice_selected.png"),this.mVoiceBtn.x=this.width-60*this.mWorld.uiScale,this.mVoiceBtn.y=e.height-this.height,this.add(this.mVoiceBtn),this.mMicBtn=new s.CheckButton(this.scene,0,0,"chat_atlas","mic_normal.png","mic_selected.png"),this.mMicBtn.x=this.width-20*this.mWorld.uiScale,this.mMicBtn.y=e.height-this.height,this.add(this.mMicBtn),this.setPosition(),t.prototype.init.call(this)}},ChatPanelPC.prototype.onSelectedVoiceHandler=function(t){!1===t&&(this.mMicBtn.selected=!1),this.emit("selectedVoice",t)},ChatPanelPC.prototype.onSelectedMicHandler=function(t){!1!==this.mVoiceBtn.selected?(this.mMicBtn.selected=t,this.emit("selectedMic",t)):this.mMicBtn.selected=!1},ChatPanelPC.prototype.onSendMsgHandler=function(){var t=this.mInputText.text;t.length>0&&(this.emit("sendChat",t),this.mInputText.setText(""),this.mInputText.setBlur())},ChatPanelPC.prototype.onFocusHandler=function(){this.mWorld&&this.mWorld.inputManager&&this.mSendKey&&this.mSendKey.on("down",this.onDownEnter,this)},ChatPanelPC.prototype.onBlurHandler=function(){this.mWorld&&this.mWorld.inputManager&&this.mSendKey&&this.mSendKey.off("down",this.onDownEnter,this)},ChatPanelPC.prototype.onDownEnter=function(){this.onSendMsgHandler()},Object.defineProperty(ChatPanelPC.prototype,"outChannel",{get:function(){return 0},enumerable:!1,configurable:!0}),ChatPanelPC}(h.BaseChatPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"normalizePatchesConfig",(function(){return normalizePatchesConfig}));var normalizePatchesConfig=function(t){return t.bottom=void 0!==t.bottom?t.bottom:t.top,t.left=void 0!==t.left?t.left:t.top,t.right=void 0!==t.right?t.right:t.left,t}},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatPanelMobile",(function(){return l}));var n,o=i(157),r=i(111),s=i(117),a=i(121),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ChatPanelMobile(e,i){var n=t.call(this,e,i)||this;return n.setTween(!1),n}return c(ChatPanelMobile,t),ChatPanelMobile.prototype.addListen=function(){this.mSendBtn.on("pointerdown",this.onSendMsgHandler,this),this.clickContainer.on("pointerdown",this.clickHandler,this),this.mInputText.on("focus",this.onFocusHandler,this),this.mInputText.on("blur",this.onBlurHandler,this)},ChatPanelMobile.prototype.removeListen=function(){this.mSendBtn.off("pointerdown",this.onSendMsgHandler,this),this.clickContainer.off("pointerdown",this.clickHandler,this),this.mInputText.off("focus",this.onFocusHandler,this),this.mInputText.off("blur",this.onBlurHandler,this)},ChatPanelMobile.prototype.appendChat=function(t){this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom())},ChatPanelMobile.prototype.show=function(e){t.prototype.show.call(this,e),this.tweenExpand(!0)},ChatPanelMobile.prototype.setPosition=function(t,e){if(this.mShow){var i,n,o,r=this.mWorld.getSize();if(this.mTextArea&&(this.mTextArea.destroy(),this.mTextArea=null,o=new h.BBCodeText(this.scene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:this.width>>1}}),i=new a.NinePatchButton(this.scene,0,0,4,7,"track","","",{left:0,top:2,right:0,bottom:2}),n=new a.NinePatchButton(this.scene,0,0,20,35,"button","","",{left:4,top:4,right:4,bottom:4}),this.add(o),this.add(i),this.add(n)),this.mInputText&&(this.mInputText.destroy(),this.mInputText=null,this.mInputText=new h.InputText(this.scene,0,0,10,10,{type:"input",fontSize:"20px",color:"#808080"}).resize(328,26).setOrigin(0,0).setStyle({font:"bold 20px YaHei"})),this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE)this.width=r.width>>1,this.height=r.height,this.mBorder.resize(this.width/this.mWorld.uiScale,this.height/this.mWorld.uiScale),this.x=0,this.y=0,this.clickContainer.x=this.width/this.mWorld.uiScale+this.clickContainer.width/2,this.clickContainer.y=this.height/(2*this.mWorld.uiScale),this.clickContainer.rotation=.5*Math.PI,this.arrow.rotation=.5*Math.PI,this.mInputBg.y=this.mBorder.height-this.mInputBg.height/2,this.mTextArea=new h.TextArea(this.scene,{x:.5*this.width/this.mWorld.uiScale,y:this.height/2,textWidth:this.mBorder.width-20*this.mWorld.uiScale,textHeight:this.height,text:o,slider:{track:i,thumb:n},clamplChildOY:!0}),this.mInputText.setPosition(2,this.mInputBg.y-12*this.mWorld.uiScale);else this.width=r.width,this.height=r.height/2,this.mBorder.resize(this.width/this.mWorld.uiScale,this.height/this.mWorld.uiScale),this.x=0,this.y=this.height+20*this.mWorld.uiScale,this.mInputBg.y=this.mBorder.height-this.mInputBg.height,this.mTextArea=new h.TextArea(this.scene,{x:(this.width-15)/this.mWorld.uiScale>>1,y:(r.height/2-this.mSendBtn.height-20)/this.mWorld.uiScale>>1,textWidth:this.mBorder.width-20*this.mWorld.uiScale,textHeight:(r.height/2-this.mSendBtn.height-20)/this.mWorld.uiScale,text:o,slider:{track:i,thumb:n},scroller:{bounds:[0,this.height>>1]},clamplChildOY:!0,backDeceleration:!0}),this.clickContainer.x=r.width/(2*this.mWorld.uiScale),this.clickContainer.y=-this.clickContainer.height>>1,this.mTextArea.getElement("slider").y=this.height>>1,this.clickContainer.rotation=Math.PI,this.arrow.rotation=1.5*Math.PI,this.mInputText.setPosition(2,this.mInputBg.y-6*this.mWorld.uiScale);return this.mTextArea.layout(),this.add(this.mTextArea),this.mTextArea.childrenMap.child.textMask.setPosition(-5,r.height-this.height).resize(this.width+18,this.height-this.mSendBtn.height),this.mBorder.x=this.mBorder.width/2,this.mBorder.y=this.mBorder.height/2,this.setSize(this.width,this.height),this.mInputBg.x=this.mInputBg.width>>1,this.mSendBtn.x=this.mBorder.width-this.mSendBtn.width,this.mSendBtn.y=this.mInputBg.y,this.scale=this.mWorld.uiScale,this.add(this.mInputText),this}},ChatPanelMobile.prototype.destroy=function(){t.prototype.destroy.call(this)},ChatPanelMobile.prototype.tweenExpand=function(t){var e=this,i=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{alpha:{value:i}},onComplete:function(i,n,o){t||e.hide(),e.addListen()}}),t&&this.setPosition()},ChatPanelMobile.prototype.hide=function(){this.removeListen(),t.prototype.hide.call(this)},ChatPanelMobile.prototype.preload=function(){this.scene&&(this.scene.load.image("button",r.i.getRes("ui/common/button.png")),this.scene.load.image("thumbTexture",r.i.getRes("ui/common/common_thumb_texture.png")),this.scene.load.image("track",r.i.getRes("ui/common/common_track.png")),this.scene.load.image("channelSelect",r.i.getRes("ui/common/common_channelSelect.png")),this.scene.load.image("channelUnSelect",r.i.getRes("ui/common/common_channelUnSelect.png")),this.scene.load.image("arrow",r.i.getRes("ui/common/common_arrow.png")),this.scene.load.image("chat_input_bg",r.i.getRes("ui/chat/input_bg.png")),this.scene.load.image(r.d.getName(),r.d.getPNG()),this.scene.load.atlas(r.j.getName(),r.j.getPNG(),r.j.getJSON()),this.scene.load.atlas("chat_atlas",r.i.getRes("ui/chat/chat_atlas.png"),r.i.getRes("ui/chat/chat_atlas.json")),t.prototype.preload.call(this))},ChatPanelMobile.prototype.init=function(){if(!this.mInitialized){var e=this.mWorld.getSize();this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.width=e.width>>1,this.height=e.height):(this.width=e.width,this.height=e.height>>1),this.setSize(this.width,this.height),this.mBorder=new s.NinePatch(this.scene,0,0,this.width/this.mWorld.uiScale,this.height/this.mWorld.uiScale,r.d.getName(),null,r.d.getConfig()),this.mBorder.x=this.mBorder.width/2,this.mBorder.y=this.mBorder.height/2,this.addAt(this.mBorder,0);var i=new h.BBCodeText(this.scene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:this.width>>1}}),n=new a.NinePatchButton(this.scene,0,0,4,7,"track","","",{left:0,top:2,right:0,bottom:2});n.x=this.width/2,n.y=8*this.mWorld.uiScale;var o=new a.NinePatchButton(this.scene,0,0,20,35,"button","","",{left:4,top:4,right:4,bottom:4});this.add(i),this.add(n),this.add(o),this.mTextArea=new h.TextArea(this.scene,{x:this.width>>1,y:this.height+178*this.mWorld.uiScale>>1,textWidth:this.width,textHeight:this.height+150*this.mWorld.uiScale,text:i,slider:{track:n,thumb:o}}).layout(),this.add(this.mTextArea),this.mInputBg=new s.NinePatch(this.scene,0,0,340,30,"chat_input_bg",null,{left:4,top:4,right:4,bottom:4}),this.add(this.mInputBg),this.mInputText=new h.InputText(this.scene,0,0,10,10,{type:"input",fontSize:"20px",color:"#808080"}).resize(328,26).setOrigin(0,0).setStyle({font:"bold 20px YaHei"}).on("focus",this.onFocusHandler,this).on("blur",this.onBlurHandler,this),this.mSendBtn=new a.NinePatchButton(this.scene,0,0,60,30,r.j.getName(),"","发送",r.j.getConfig()),this.add(this.mSendBtn),this.clickContainer=this.scene.make.container(void 0,!1);var c=new s.NinePatch(this.scene,0,0,53/this.mWorld.uiScale,30/this.mWorld.uiScale,r.d.getName(),null,r.d.getConfig());this.arrow=this.scene.make.image(void 0,!1),this.arrow.setTexture("arrow"),this.clickContainer.setSize(c.width+4,c.height+10),this.clickContainer.add(c),this.clickContainer.add(this.arrow),this.clickContainer.setInteractive(),this.add(this.clickContainer),this.add(this.mInputText),this.setPosition(),t.prototype.init.call(this)}},ChatPanelMobile.prototype.clickHandler=function(){this.scene.tweens.add({targets:this.clickContainer,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.clickContainer.scaleX=this.clickContainer.scaleY=1,this.tweenExpand(!1),this.mWorld.uiManager.baseFaceTween(!0)},ChatPanelMobile.prototype.onSendMsgHandler=function(){var t=this.mInputText.text;t.length>0&&(this.emit("sendChat",t),this.mInputText.setText(""),this.mInputText.setBlur())},ChatPanelMobile.prototype.onFocusHandler=function(){this.mWorld&&this.mWorld.inputManager},ChatPanelMobile.prototype.onBlurHandler=function(){this.mWorld&&this.mWorld.inputManager},ChatPanelMobile}(o.BaseChatPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Chat",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Chat(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Chat,t),Chat.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Chat.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Chat.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,this.handleCharacterChat),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QCLOUD_GME_AUTHBUFFER,this.handleQCLoudGME))},Chat.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Object.defineProperty(Chat.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Chat.prototype.handleCharacterChat=function(t){t.content;this.mEvent.emit("characterChat",t)},Chat.prototype.handleQCLoudGME=function(t){t.content;this.mEvent.emit("QCLoundGME",t)},Chat}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"LayerManager",(function(){return n}));var n=function(){function LayerManager(){}return LayerManager.prototype.setScene=function(t){t&&(this.destroy(),this.mScene=t,this.mUILayer=t.add.container(0,0),this.mDialogLayer=t.add.container(0,0),this.mToolTipsLyaer=t.add.container(0,0))},LayerManager.prototype.addToUILayer=function(t,e){void 0===e&&(e=-1),this.mUILayer&&(-1===e||void 0===e?this.mUILayer.add(t):this.mUILayer.addAt(t,e))},LayerManager.prototype.addToDialogLayer=function(t){this.mDialogLayer&&this.mDialogLayer.add(t)},LayerManager.prototype.addToToolTipsLayer=function(t){this.mToolTipsLyaer&&this.mToolTipsLyaer.add(t)},LayerManager.prototype.removeToUILayer=function(t){this.mUILayer.remove(t)},LayerManager.prototype.removeToDialogLayer=function(t){this.mDialogLayer.remove(t)},LayerManager.prototype.removeToToolTipsLayer=function(t){this.mToolTipsLyaer.remove(t)},LayerManager.prototype.destroy=function(){this.mUILayer&&(this.mUILayer.destroy(),this.mUILayer=null),this.mDialogLayer&&(this.mDialogLayer.destroy(),this.mDialogLayer=null),this.mToolTipsLyaer&&(this.mToolTipsLyaer.destroy(),this.mToolTipsLyaer=null)},Object.defineProperty(LayerManager.prototype,"interactive",{get:function(){return this.mInteractive},enumerable:!1,configurable:!0}),Object.defineProperty(LayerManager.prototype,"scene",{get:function(){return this.mScene},enumerable:!1,configurable:!0}),LayerManager}()},function(t,e,i){"use strict";i.r(e),i.d(e,"NoticeMediator",(function(){return c}));var n,o=i(190),r=i(119),s=i(191),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function NoticeMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mLayerManager=e,o.mScene=i,o.notice=new s.Notice(n),o.mUIType=a.UIType.Tips,o.addListen(),o}return h(NoticeMediator,t),NoticeMediator.prototype.setUiScale=function(t){this.mView.scale=t},NoticeMediator.prototype.getView=function(){return void 0!==this.mView?this.mView:void 0},NoticeMediator.prototype.getUIType=function(){return this.mUIType},NoticeMediator.prototype.hide=function(){this.mView&&t.prototype.hide.call(this)},NoticeMediator.prototype.destroy=function(){this.removeListen(),this.notice.unregister(),this.notice=null,t.prototype.destroy.call(this)},NoticeMediator.prototype.isShow=function(){return this.mView.isShow()},NoticeMediator.prototype.resize=function(){this.mView&&this.mView.resize()},NoticeMediator.prototype.show=function(t){this.mView&&this.mView.isShow()?this.mView.showNotice(t):(this.mView=new o.NoticePanel(this.mScene,this.world),this.mView.show(t),this.mView.showNotice(t),this.mLayerManager.addToDialogLayer(this.mView))},NoticeMediator.prototype.update=function(t){this.mParam=t,this.mView},NoticeMediator.prototype.setParam=function(t){this.mParam=t},NoticeMediator.prototype.getParam=function(){return this.mParam},NoticeMediator.prototype.addListen=function(){this.notice.on("showNotice",this.noticeHandler,this),this.world.emitter.on(r.a.SHOW_NOTICE,this.noticeHandler,this),this.notice.register()},NoticeMediator.prototype.removeListen=function(){this.notice.off("showNotice",this.noticeHandler,this),this.world.emitter.off(r.a.SHOW_NOTICE,this.noticeHandler,this)},NoticeMediator.prototype.noticeHandler=function(t){t&&t.content&&this.show(t.content)},NoticeMediator.NAME="NoticeMediator",NoticeMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"NoticePanel",(function(){return h}));var n,o=i(112),r=i(111),s=i(117),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function NoticePanel(e,i){var n=t.call(this,e,i)||this;return n.disInteractive(),n}return a(NoticePanel,t),NoticePanel.prototype.show=function(e){t.prototype.show.call(this,e),this.resize(),this.refreshData()},NoticePanel.prototype.addListen=function(){this.mInitialized},NoticePanel.prototype.removeListen=function(){this.mInitialized},NoticePanel.prototype.destroy=function(){this.mContentText&&(this.mContentText.destroy(),this.mContentText=null),this.mTween&&(this.mTween.stop(),this.mTween.remove(),this.mTween=null),t.prototype.destroy.call(this)},NoticePanel.prototype.resize=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=this.scene.cameras.main.worldView;this.x=i.x+i.width+t>>1,this.y=180+e},NoticePanel.prototype.showNotice=function(t){var e=this;if(this.mInitialized&&t){this.mTween&&(this.mTween.stop(),this.mTween.remove());var i="#FFFFFF",n=5e3,o=t.chatsetting;o&&(o.textColor&&(i=o.textColor),o.duration&&(n=o.duration)),this.mContentText.setText(t.noticeContext),this.mContentText.setFill(i),this.mContentText.x=-(this.mContentText.width>>1),this.mContentText.y=-(this.mContentText.height>>1),this.mTween=this.scene.tweens.add({targets:this,alpha:0,duration:200,delay:n,onComplete:function(){e.removeFromParent()}})}},NoticePanel.prototype.preload=function(){this.scene.load.image(r.d.getName(),r.d.getPNG()),t.prototype.preload.call(this)},NoticePanel.prototype.init=function(){var e=new s.NinePatch(this.scene,0,0,1200,120,r.d.getName(),null,r.d.getConfig());this.add(e),this.mContentText=this.scene.make.text({align:"center",style:{fontFamily:"bold YaHei",fontSize:20*this.dpr*this.mWorld.uiScale,wordWrap:{width:1180,useAdvancedWrap:!0}}},!1).setStroke("#000000",1),this.add(this.mContentText),t.prototype.init.call(this)},NoticePanel.prototype.refreshData=function(){var t=this.mShowData;t&&this.showNotice(t)},NoticePanel.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this),this.mTween&&(this.mTween.stop(),this.mTween.remove(),this.mTween=null),this.mShow=!1},NoticePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Notice",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Notice(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Notice,t),Notice.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Notice.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Notice.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_NOTICE,this.noticeHandler))},Notice.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Object.defineProperty(Notice.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Notice.prototype.noticeHandler=function(t){t&&t.content&&this.mEvent.emit("showNotice",t)},Notice}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"BagPanel",(function(){return f}));var n,o=i(133),r=i(0),s=i(111),a=i(132),h=i(117),c=i(146),l=i(124),p=i(125),d=i(112),m=i(109),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function BagPanel(e,i){var n=t.call(this,e,i)||this;return n.mPageNum=0,n.mPageIndex=1,n.mBaseStr="输入关键字进行搜索",n.bagSlotList=[],n.mCheckList=[],n}return u(BagPanel,t),BagPanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.mWorld.game.device.os.desktop||this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.x=i.width>>1,this.y=i.height>>1):(this.x=i.width>>1,this.y=i.height-this.height/2*this.mWorld.uiScale>>1)},BagPanel.prototype.setDataList=function(){var t=this.mWorld.roomManager.currentRoom.playerManager.actor.package.items;this.mPageNum=Math.ceil(t.length/BagPanel.PageMaxCount),this.mDataList=t,this.mInitialized&&this.checkChinese()},BagPanel.prototype.getPageNum=function(){return this.mPageNum},BagPanel.prototype.destroy=function(){this.bagSlotList&&(this.bagSlotList.forEach((function(t){t&&t.destroy()})),this.bagSlotList.length=0,this.bagSlotList=null),this.mWorld=null,this.mPageNum=0,this.mPageIndex=1,t.prototype.destroy.call(this)},BagPanel.prototype.getCurPageIndex=function(){return this.mPageIndex},BagPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&(this.mPreBtn.play("slipBtn"),this.mNextBtn.play("slipBtn"))},BagPanel.prototype.setBlur=function(){this.mInputText&&this.mInputText.setBlur()},BagPanel.prototype.addListen=function(){this.mInitialized&&(this.mInputText.on("focus",this.onFocusHandler,this),this.mInputText.on("blur",this.onBlurHandler,this),this.mNextBtn.on("pointerup",this.nextHandler,this),this.mPreBtn.on("pointerup",this.preHandler,this),this.mClsBtn.on("pointerup",this.closeHandler,this))},BagPanel.prototype.removeListen=function(){this.mInitialized&&(this.mInputText.off("focus",this.onFocusHandler,this),this.mInputText.off("blur",this.onBlurHandler,this),this.mNextBtn.off("pointerup",this.nextHandler,this),this.mPreBtn.off("pointerup",this.preHandler,this),this.mClsBtn.off("pointerup",this.closeHandler,this))},BagPanel.prototype.init=function(){if(!this.mInitialized){var e,i=this.mWorld.getSize();this.mWorld.game.device.os.desktop||this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.x=i.width>>1,this.y=i.height>>1):(this.x=i.width>>1,this.y=i.height-this.height/2*this.mWorld.uiScale>>1);var n=0,r=0;this.mBg=new h.NinePatch(this.scene,0,0,500,350,s.a.getName(),null,s.a.getConfig()),this.addAt(this.mBg,0),this.setSize(this.mBg.width,this.mBg.height),this.mBorder=new h.NinePatch(this.scene,0,0,this.mBg.width-10,this.mBg.height-30,s.d.getName(),null,s.d.getConfig()),this.mBorder.x=this.mBg.x,this.mBorder.y=this.mBg.y+10,this.addAt(this.mBorder,1);var c=new h.NinePatch(this.scene,this.mBorder.width/4+5,-this.mBg.height/2+65,this.mBorder.width/2-40,35,s.d.getName(),null,s.d.getConfig());this.add(c),this.mInputText=new m.InputText(this.scene,0,0,10,10,{type:"input",fontSize:"14px",color:"#808080"}).resize(c.width,c.height).setOrigin(0,0).setStyle({font:"bold 16px YaHei"}),this.mInputText.x=c.x-c.width/2,this.mInputText.y=c.y-c.height/2,this.mInputText.setText(this.mBaseStr),this.add(this.mInputText),this.bagSlotList=[];for(var d=0;d<BagPanel.PageMaxCount;d++)n=d%8*60-210,r=60*Math.floor(d/8)-this.mBorder.height/2+this.mBorder.y+this.mBorder.height/2-55,(e=new o.ItemSlot(this.scene,this.mWorld,this,n,r,this.mResStr,this.mResPng,this.mResJson,"bagView_slot.png","itemSelectFrame")).createUI(),this.bagSlotList.push(e);this.mPreBtn=this.scene.make.sprite(void 0,!1),this.mPreBtn.x=-this.mBg.width>>1,this.mNextBtn=this.scene.make.sprite(void 0,!1),this.mNextBtn.scaleX=-1,this.mNextBtn.x=this.mBg.width>>1;var u=this.scene.make.sprite(void 0,!1);u.setTexture(this.mResStr,"bagView_titleBtn.png"),u.x=50+(-this.mBg.width>>1),u.y=-this.mBg.height>>1,this.add(u);var f=this.scene.make.text(void 0,!1);f.setFontFamily("Tahoma"),f.setFontStyle("bold"),f.setFontSize(20),f.setText("背包"),f.x=u.x+u.width-10,f.y=u.y-(f.height>>1),this.add(f),this.add(this.mPreBtn),this.add(this.mNextBtn),this.mNextBtn.setInteractive(),this.mPreBtn.setInteractive(),this.width=this.mBg.width,this.height=this.mBg.height,this.mClsBtn=new l.IconBtn(this.scene,this.mWorld,{key:p.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:this.mResPng,jsonUrl:this.mResJson}),this.mClsBtn.x=(this.width>>1)-65,this.mClsBtn.y=-this.height>>1,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn),this.mInitialized=!0,this.mDataList&&this.refreshDataList(this.mDataList),this.setInteractive(),this.mWorld.uiManager.getMediator(a.BagMediator.NAME).resize(this.width,this.height),t.prototype.init.call(this)}},BagPanel.prototype.preload=function(){this.scene&&(this.mResStr="bagView",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.scene.load.atlas("itemChose",s.i.getRes("ui/bag/itemChose.png"),s.i.getRes("ui/bag/itemChose.json")),this.scene.load.atlas("slip",s.i.getRes("ui/bag/slip.png"),s.i.getRes("ui/bag/slip.json")),this.scene.load.image(s.d.getName(),s.d.getPNG()),this.scene.load.image(s.a.getName(),s.a.getPNG()),this.scene.load.atlas("clsBtn",s.i.getRes("ui/common/common_clsBtn.png"),s.i.getRes("ui/common/common_clsBtn.json")),this.scene.load.atlas(this.mResStr,s.i.getRes(this.mResPng),s.i.getRes(this.mResJson)),t.prototype.preload.call(this))},BagPanel.prototype.loadComplete=function(e,i,n){var o=this.scene.textures.get("itemChose").frames,r=[];for(var s in o){if("__BASE"!==s)o[s]&&r.push(s)}this.scene.anims.create({key:"itemSelectFrame",frames:this.scene.anims.generateFrameNumbers("itemChose",{start:0,end:8,frames:r}),frameRate:33,yoyo:!0,repeat:-1});var a=this.scene.textures.get("slip").frames,h=[];for(var s in a){if("__BASE"!==s)a[s]&&h.push(s)}this.scene.anims.create({key:"slipBtn",frames:this.scene.anims.generateFrameNumbers("slip",{start:0,end:14,frames:h}),frameRate:33,yoyo:!0,repeat:-1}),t.prototype.loadComplete.call(this,e,i,n)},BagPanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(a.BagMediator.NAME).resize(this.width,this.height)},BagPanel.prototype.nextHandler=function(t,e){if(this.preNextBtnScaleHandler(this.mNextBtn,-1),!(this.mPageIndex>=this.mPageNum)){this.mPageIndex++;var i=this.mCheckList.length>0?this.mCheckList:this.mDataList;this.refreshDataList(i)}},BagPanel.prototype.preHandler=function(t,e){if(this.preNextBtnScaleHandler(this.mPreBtn),!(this.mPageIndex<=1)){this.mPageIndex--;var i=this.mCheckList.length>0?this.mCheckList:this.mDataList;this.refreshDataList(i)}},BagPanel.prototype.preNextBtnScaleHandler=function(t,e){void 0===e&&(e=1),this.scene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1},BagPanel.prototype.refreshDataList=function(t){if(t)for(var e,i=t.slice((this.mPageIndex-1)*BagPanel.PageMaxCount,this.mPageIndex*BagPanel.PageMaxCount),n=BagPanel.PageMaxCount,o=0;o<n;o++)(e=this.bagSlotList[o])&&e.dataChange(i[o]);else r.a.getInstance().error("checkItemList is undefiend")},BagPanel.prototype.closeHandler=function(){this.mWorld.uiManager.getMediator(a.BagMediator.NAME).hide()},BagPanel.prototype.onFocusHandler=function(){this.mWorld&&this.mWorld.inputManager&&this.mInputText&&(this.mInputText.on("textchange",this.checkChinese,this),this.mInputText.setText(""))},BagPanel.prototype.onBlurHandler=function(){this.mWorld&&this.mWorld.inputManager&&this.mInputText&&(this.mInputText.on("textchange",this.checkChinese,this),this.mInputText.setText(this.mBaseStr))},BagPanel.prototype.checkChinese=function(){var t=this,e=this.mInputText.text;e.length<1||!c.a.checkChinese(e)||e===this.mBaseStr?this.refreshDataList(this.mDataList):(this.mWorld.roomManager.currentRoom.playerManager.actor.package.items.forEach((function(e){e&&c.a.checkItemName(e.name,t.mInputText.text)&&t.mCheckList.push(e)})),this.refreshDataList(this.mCheckList))},BagPanel.PageMaxCount=32,BagPanel}(d.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"FriendPanel",(function(){return u})),i.d(e,"FriendItem",(function(){return f}));var n,o=i(112),r=i(111),s=i(117),a=i(113),h=i(116),c=i(25),l=i(124),p=i(159),d=i(125),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function FriendPanel(e,i){var n=t.call(this,e,i)||this;return n.mIndex=0,n}return m(FriendPanel,t),FriendPanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.mShow&&(this.mWorld.game.device.os.desktop?(this.x=i.width+t>>1,this.y=i.height+e>>1):this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.mBg.resize((.5*i.width-20)/this.mWorld.uiScale,(i.height-20)/this.mWorld.uiScale),this.setSize(this.mBg.width,this.mBg.height),this.x=(this.width/2+10)*this.mWorld.uiScale,this.y=(this.height/2+10)*this.mWorld.uiScale):(this.mBg.resize((i.width-20)/this.mWorld.uiScale,(.5*i.height-20)/this.mWorld.uiScale),this.setSize(this.mBg.width,this.mBg.height),this.x=(this.width/2+15)*this.mWorld.uiScale,this.y=i.height-.5*this.mBg.height*this.mWorld.uiScale-10),this.scale=this.mWorld.uiScale,this.mUpBtn.y=(this.mUpBtn.height/2-this.mBg.height)/2,this.mDownBtn.y=(this.mBg.height-this.mDownBtn.height/2)/2,this.mTitleTxt.x=-this.mBg.width/2+15,this.mTitleTxt.y=-this.mBg.height/2+8,this.mClsBtn&&(this.mClsBtn.x=(this.mBg.width>>1)-65,this.mClsBtn.y=-this.mBg.height>>1),this.initFriendItem(),this.addAt(this.mBg,0),this.add(this.mTitleTxt))},FriendPanel.prototype.addListen=function(){t.prototype.addListen.call(this),this.mDownBtn.on("pointerup",this.downHandler,this),this.mUpBtn.on("pointerup",this.upHandler,this),this.mClsBtn.on("pointerup",this.hide,this)},FriendPanel.prototype.removeListen=function(){t.prototype.removeListen.call(this),this.mDownBtn.off("pointerup",this.downHandler,this),this.mUpBtn.off("pointerup",this.upHandler,this),this.mClsBtn.off("pointerup",this.hide,this)},FriendPanel.prototype.show=function(e){this.mWorld.getSize();this.mShowData=e,this.mInitialized?t.prototype.show.call(this,e):this.preload()},FriendPanel.prototype.destroy=function(){this.mFriendList&&this.mFriendList.forEach((function(t){t&&(t.destory(),t=null)})),t.prototype.destroy.call(this)},FriendPanel.prototype.friendChat=function(t){},FriendPanel.prototype.friendGo=function(t){},FriendPanel.prototype.btnScaleHandler=function(t,e){void 0===e&&(e=1),this.mScene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1},FriendPanel.prototype.hide=function(){this.mWorld.uiManager.baseFaceTween(!0),t.prototype.hide.call(this)},FriendPanel.prototype.preload=function(){this.mScene&&(this.mScene.load.image(r.d.getName(),r.d.getPNG()),this.mScene.load.image(r.a.getName(),r.a.getPNG()),this.mScene.load.atlas("clsBtn",r.i.getRes("ui/common/common_clsBtn.png"),r.i.getRes("ui/common/common_clsBtn.json")),this.scene.load.image("friendChat",r.i.getRes("ui/friend/friend_chat.png")),this.scene.load.image("friendGo",r.i.getRes("ui/friend/friend_go.png")),this.mScene.load.atlas("bagView",r.i.getRes("ui/bag/bagView.png"),r.i.getRes("ui/bag/bagView.json")),t.prototype.preload.call(this))},FriendPanel.prototype.init=function(){this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this);var e=this.mWorld.getSize();this.mBg=new s.NinePatch(this.scene,0,0,600/this.mWorld.uiScale,.5*e.height*this.mWorld.uiScale,r.d.getName(),null,r.d.getConfig()),this.setSize(this.mBg.width,this.mBg.height),this.mTitleTxt=this.mScene.make.text(void 0,!1),this.mTitleTxt.setFontFamily("YaHei"),this.mTitleTxt.setFontStyle("bold"),this.mTitleTxt.setFontSize(14),this.mTitleTxt.style.align="left",this.mTitleTxt.setText("好友列表"),this.mUpBtn=this.mScene.make.sprite(void 0,!1),this.mUpBtn.setTexture("bagView","bagView_tab.png"),this.mUpBtn.rotation=Math.PI/2,this.mDownBtn=this.mScene.make.sprite(void 0,!1),this.mDownBtn.setTexture("bagView","bagView_tab.png"),this.mDownBtn.rotation=-Math.PI/2,this.mDownBtn.setInteractive(),this.mUpBtn.setInteractive();var i=this.scene.make.image(void 0,!1);i.setTexture(this.mWorld.roomManager.currentRoom.playerManager.actor.getDisplay().displayInfo.id+""),this.add(i),this.mBg=new s.NinePatch(this.scene,0,0,500,350,r.a.getName(),null,r.a.getConfig()),this.addAt(this.mBg,0),this.setSize(this.mBg.width,this.mBg.height),this.initFriendItem(),this.mClsBtn=new l.IconBtn(this.mScene,this.mWorld,{key:d.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/common/common_clsBtn.png",jsonUrl:"ui/common/common_clsBtn.json"}),this.mClsBtn.x=(this.mWidth>>1)-65,this.mClsBtn.y=-this.mHeight>>1,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn),t.prototype.init.call(this)},FriendPanel.prototype.tweenComplete=function(e){var i=this;t.prototype.tweenComplete.call(this,e),this.mWorld.roomManager.currentRoom.playerManager.actor.getFriend().requestFriend((function(t){i.setDataList(t)})),e&&this.mWorld.uiManager.getMediator(p.FriendMediator.NAME).resize()},FriendPanel.prototype.downHandler=function(){this.btnScaleHandler(this.mDownBtn);var t=this.mFriendDataList?this.mFriendDataList.length:0,e=Math.floor(t/FriendPanel.count);this.mIndex=this.mIndex+1>e?e:this.mIndex+1,this.refreshDataList()},FriendPanel.prototype.upHandler=function(){this.btnScaleHandler(this.mUpBtn),this.mIndex=this.mIndex-1>0?this.mIndex-1:0,this.refreshDataList()},FriendPanel.prototype.setDataList=function(t){if(this.mFriendList){this.mFriendDataList=t;t.length>FriendPanel.count?FriendPanel.count:t.length;for(var e=0;e<4;e++){var i=this.mFriendList[e],n=t[this.mIndex*FriendPanel.count+e];n?(i.visible=!0,n.index=e):i.visible=!1}this.add(this.mUpBtn),this.add(this.mDownBtn)}},FriendPanel.prototype.refreshDataList=function(){},FriendPanel.prototype.initFriendItem=function(){var t=this.mFriendList?this.mFriendList.length:FriendPanel.count;if(this.mFriendList&&this.mFriendList.length>0)for(var e=0;e<t;e++){(n=this.mFriendList[e]).resize(),n.y=this.mWorld.game.device.os.desktop?(-this.mBg.height/2+this.mTitleTxt.height+e*(n.height+10)+(n.height/2+10))*this.mWorld.uiScale:(e-1.5)*(n.height+10)}else{this.mFriendList=[];var i=[{res:"friendChat",name:"聊天"},{res:"friendGo",name:"跟随"}];for(e=0;e<t;e++){var n;(n=new f(this.mWorld,this.mScene,this,i)).y=this.mWorld.game.device.os.desktop?(-this.mBg.height/2+this.mTitleTxt.height+e*(n.height+10)+(n.height/2+10))*this.mWorld.uiScale:(e-1.5)*(n.height+10),this.mFriendList.push(n)}}},FriendPanel.count=4,FriendPanel}(o.BasePanel),f=function(t){function FriendItem(e,i,n,o){var l=t.call(this,i)||this;l.iconResList=[],l.mPanel=n,l.mWorld=e,l.mScene=i;l.mWorld.getSize();if(l.mBg=new s.NinePatch(l.mScene,0,0,l.mPanel.width,90,r.d.getName(),null,r.d.getConfig()),l.addAt(l.mBg,0),l.setSize(l.mBg.width,l.mBg.height),l.mRoleIcon=new h.DynamicImage(l.mScene,-l.mBg.width/2,0),l.nameTF=l.mScene.make.text({align:"left",style:{font:a.a.YAHEI_20_BOLD,fill:"#FFCC00"}},!1),l.statusTF=l.mScene.make.text({align:"left",style:{font:"14px YaHei"}},!1),o)for(var p=o.length,_loop_1=function(t){var e=d.mScene.make.image(void 0,!1),i=d.mScene.make.container(void 0,!1),n=new s.NinePatch(d.mScene,0,0,60,60,r.d.getName(),null,r.d.getConfig()),a=d.mScene.make.text(void 0,!1),h=o[t];a.setText(h.name),e.setTexture(h.res),e.scaleX=e.scaleY=.8,i.add(e),i.add(a),i.addAt(n,0),i.setSize(60,60),i.setInteractive(new c.Geom.Rectangle(0,0,60,60),Phaser.Geom.Rectangle.Contains),i.on("pointerdown",(function(){l.mPanel.btnScaleHandler(i)}),d),e.y=-n.height/2+e.height/2,a.x=-a.width>>1,a.y=i.height/2-a.height-4,d.add(i),d.iconResList.push(i)},d=this,m=0;m<p;m++)_loop_1(m);return l.add(l.mRoleIcon),l.add(l.nameTF),l.add(l.statusTF),l.refreshUIPos(),l}return m(FriendItem,t),FriendItem.prototype.resize=function(){this.mWorld.game.device.os.desktop||(this.mBg.resize(.95*this.mPanel.width,90),this.setSize(this.mBg.width,this.mBg.height),this.addAt(this.mBg,0),this.refreshUIPos())},FriendItem.prototype.getView=function(){return this},FriendItem.prototype.dataChange=function(t){var e=this,i=(t.level,t.id,t.nickname||"test");this.nameTF.setText(i),this.mRoleIcon.load(r.i.getOsdRes(t.avatar||"1"),this,(function(){e.mRoleIcon.scaleX=e.height/e.mRoleIcon.width,e.mRoleIcon.scaleY=e.height/e.mRoleIcon.height}),(function(){e.mRoleIcon.scaleX=e.mRoleIcon.scaleY=1})),this.mRoleIcon.x=-this.width/2+64,this.nameTF.x=this.mRoleIcon.x+54,this.index=t.index},FriendItem.prototype.destory=function(){this.index=0,this.nameTF&&this.nameTF.destroy(!0),this.statusTF&&this.statusTF.destroy(!0),this.mRoleIcon&&this.mRoleIcon.destroy(!0),this.nameTF=null,this.statusTF=null,this.mPanel=null,this.mWorld=null,t.prototype.destroy.call(this,!0)},FriendItem.prototype.refreshUIPos=function(){if(this.mRoleIcon.x=-this.width/2+64,this.nameTF.x=this.mRoleIcon.x+54,this.mRoleIcon.y=0,this.nameTF.y=10-this.mBg.height/2,this.statusTF.x=this.nameTF.x,this.iconResList)for(var t=this.iconResList.length,e=0;e<t;e++){this.iconResList[e].x=this.width/2-70*(e+1)+20}},FriendItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"RankPanel",(function(){return c}));var n,o=i(160),r=i(124),s=i(147),a=i(125),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function RankPanel(e,i){var n=t.call(this,e,i)||this;return n.mCurrentIndex=0,n}return h(RankPanel,t),RankPanel.prototype.addListen=function(){this.mInitialized&&(this.mWorld.game.device.os.desktop?this.mZoonInBtn.on("pointerup",this.onZoomHandler,this):this.mClsBtn.on("pointerup",this.closeHandler,this))},RankPanel.prototype.removeListen=function(){this.mInitialized&&(this.mWorld.game.device.os.desktop?this.mZoonInBtn.off("pointerup",this.onZoomHandler,this):this.mClsBtn.off("pointerup",this.closeHandler,this))},RankPanel.prototype.resize=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),this.mWorld){var i=this.mWorld.getSize();this.mWorld.game.device.os.desktop?(this.x=i.width-this.width/2,this.y=this.height/2+10):(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.x=i.width+t>>1,this.y=i.height+e>>1),this.scale=this.mWorld.uiScale}},RankPanel.prototype.tweenView=function(t){if(this.scene){var e=this.height/2+10,i=!0===t?e:e-300,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Cubic.Out",props:{y:{value:i},alpha:{value:n}}})}},RankPanel.prototype.destroy=function(){this.mZoonInBtn&&this.mZoonInBtn.destroy(!0),this.mZoonInBtn=null,this.mCurrentIndex=0,t.prototype.destroy.call(this)},RankPanel.prototype.init=function(){t.prototype.init.call(this),this.mWorld.game.device.os.desktop?(this.mZoonInBtn=this.scene.make.image({x:0,y:this.height/2-10,key:"rank_atlas",frame:"arrow.png"},!1),this.add(this.mZoonInBtn),this.mZoonInBtn.setInteractive()):(this.mClsBtn=new r.IconBtn(this.scene,this.mWorld,{key:a.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/common/common_clsBtn.png",jsonUrl:"ui/common/common_clsBtn.json"}),this.mClsBtn.x=this.width/2-35,this.mClsBtn.y=-this.height/2,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn)),this.resize()},RankPanel.prototype.tweenComplete=function(e){if(t.prototype.tweenComplete.call(this,e),e){var i=this.getData("data");i&&this.addItem(i)}},RankPanel.prototype.closeHandler=function(){this.mWorld.uiManager.getMediator(s.RankMediator.NAME).hide()},RankPanel.prototype.onZoomHandler=function(){this.currentSizeIndex=0===this.mCurrentIndex?1:0},Object.defineProperty(RankPanel.prototype,"currentSizeIndex",{set:function(t){if(this.mCurrentIndex!==t){this.mCurrentIndex=t;var e=1===this.mCurrentIndex?30:this.height,i=1===this.mCurrentIndex?-this.height/2+20:this.height/2-10,n=1===this.mCurrentIndex?-this.height/2+15:0;this.mBackground.resize(328,e),this.mZoonInBtn.angle=1===this.mCurrentIndex?180:0,e>300?this.parentContainer&&this.add(this.mChildContainer):this.remove(this.mChildContainer),this.mBackground.y=n,this.mZoonInBtn.y=i}},enumerable:!1,configurable:!0}),RankPanel}(o.BasicRankPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"RightBtnGroup",(function(){return m}));var n,o=i(112),r=i(124),s=i(133),a=i(111),h=i(2),c=i(110),l=i(132),p=i(162),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function RightBtnGroup(e,i){var n=t.call(this,e,i)||this;return n.mBtnY=0,n.mWid=0,n.mHei=0,n.disInteractive(),n}return d(RightBtnGroup,t),RightBtnGroup.prototype.show=function(e){t.prototype.show.call(this,e)},RightBtnGroup.prototype.resize=function(){var t=this.mWorld.getSize();this.refreshSlot();var e=this.mWorld.uiManager.getMediator(p.BottomMediator.NAME),i=e?e.getView().height:this.height/2;if(this.scale=this.mWorld.uiScale,this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){var n=this.mWorld.roomManager.currentRoom.playerManager.actor.package;this.y=t.height-this.height*this.mWorld.uiScale,this.x=t.width-this.width/2*this.mWorld.uiScale,n&&n.items&&n.items.length>0?(this.y=t.height-this.height/2*this.mWorld.uiScale,this.x=t.width-this.width/4*this.mWorld.uiScale):(this.y=t.height-this.height*this.mWorld.uiScale,this.x=t.width-this.width/2*this.mWorld.uiScale)}else this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.PORTRAIT&&(this.y=t.height-(i+this.height/2)*this.mWorld.uiScale,this.x=t.width-this.width/2*this.mWorld.uiScale)},RightBtnGroup.prototype.hide=function(){t.prototype.hide.call(this),this.destroy()},RightBtnGroup.prototype.destroy=function(){this.mBtnY=0,this.mWid=0,this.mHei=0,this.mBagSlotList&&this.mBagSlotList.forEach((function(t){t&&(t.destroy(),t=null)})),this.mResKey="",this.mBagSlotList=null,t.prototype.destroy.call(this)},RightBtnGroup.prototype.tweenView=function(t){var e,i=this.mWorld.getSize();if(this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){var n=this.mWorld.roomManager.currentRoom.playerManager.actor.package;e=n&&n.items&&n.items.length>0?i.width-this.width/4*this.mWorld.uiScale:i.width-this.width/2*this.mWorld.uiScale}else e=i.width-this.width/2*this.mWorld.uiScale;var o=!0===t?e:e+this.width,r=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{x:{value:o},alpha:{value:r}}})},RightBtnGroup.prototype.refreshSlot=function(){if(this.handBtn){if(this.mHei=this.handBtn.height,this.mBagSlotList){this.mBagSlotList.forEach((function(t){t&&(t.getView().visible=!1)}));var t=this.mWorld.roomManager.currentRoom.playerManager.actor.package;if(t&&t.items)for(var e=t.items,i=e.length>RightBtnGroup.SlotMaxCount?RightBtnGroup.SlotMaxCount:e.length,n=0,o=0,r=0;r<i;r++){if(this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){var s=38*(r+2)/-180*Math.PI;n=110*Math.cos(s),o=this.handBtn.y+110*Math.sin(s),r===i-1&&(this.mWid=110+this.handBtn.width+30+28,this.mHei=110+this.handBtn.height+30+28)}else n=0,o=-56*(r+1)-20*r,r===i-1&&(this.mWid=this.handBtn.width,this.mHei=56*(i-1)+5*(i-2)+this.handBtn.height+5);var a=this.mBagSlotList[r];a.getView().visible=!0,a.toolTipCon.x=n,a.toolTipCon.y=o,a.dataChange(e[r])}}this.setSize(this.mWid,this.mHei)}},RightBtnGroup.prototype.tweenComplete=function(e){this.resize(),t.prototype.tweenComplete.call(this,e)},RightBtnGroup.prototype.preload=function(){this.mResKey="baseView",this.scene.load.atlas(this.mResKey,a.i.getRes("ui/baseView/mainui_mobile.png"),a.i.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this)},RightBtnGroup.prototype.init=function(){var e=this;this.mWorld.getSize();this.mWorld.uiManager.getUILayerManager().addToUILayer(this),this.mBtnY=0,this.handBtn=new r.IconBtn(this.scene,this.mWorld,{key:l.BagMediator.NAME,bgResKey:this.mResKey,bgTextures:["btnGroup_bg.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_hand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.handBtn.x=0,this.handBtn.y=this.mBtnY+this.handBtn.height/2,this.handBtn.setClick((function(){var t=new c.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN);t.content.keyCodes=[70],e.mWorld.connection.send(t)})),this.add(this.handBtn),this.mWid=this.handBtn.width,this.mHei=this.handBtn.height,this.initBagSlotData(),t.prototype.init.call(this)},RightBtnGroup.prototype.initBagSlotData=function(){this.mBagSlotList=[];this.mWorld.getSize();for(var t=RightBtnGroup.SlotMaxCount,e=0;e<t;e++){var i=new s.ItemSlot(this.scene,this.mWorld,this,0,0,this.mResKey,a.i.getRes("ui/baseView/mainui_mobile.png"),a.i.getRes("ui/baseView/mainui_mobile.json"),"btnGroup_bg.png");i.createUI(),i.getBg().scaleX=i.getBg().scaleY=.8,i.getIcon().scaleX=i.getIcon().scaleY=1.2,this.mBagSlotList.push(i),this.add(i.toolTipCon),i.getView().visible=!1}this.resize()},RightBtnGroup.SlotMaxCount=4,RightBtnGroup}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"BottomBtnGroup",(function(){return u}));var n,o=i(112),r=i(111),s=i(124),a=i(125),h=i(144),c=i(156),l=i(132),p=i(161),d=i(163),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function BottomBtnGroup(e,i){var n=t.call(this,e,i)||this;return n.mExpandBoo=!1,n.tmpWid=0,n.tmpHei=0,n.disInteractive(),n}return m(BottomBtnGroup,t),BottomBtnGroup.prototype.show=function(e){t.prototype.show.call(this,e)},BottomBtnGroup.prototype.addListen=function(){this.mChatContainer.on("pointerdown",this.chatHandler,this),this.mVoiceBtn.on("selected",this.onSelectedVoiceHandler,this),this.mMicBtn.on("selected",this.onSelectedMicHandler,this)},BottomBtnGroup.prototype.removeListen=function(){this.mChatContainer.off("pointerdown",this.chatHandler,this),this.mVoiceBtn.off("selected",this.onSelectedVoiceHandler,this),this.mMicBtn.off("selected",this.onSelectedMicHandler,this)},BottomBtnGroup.prototype.resize=function(){var t=this.mWorld.getSize();this.scale=this.mWorld.uiScale,this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.x=t.width>>1,this.mVoiceBtn.x=this.mVoiceBtn.width*this.mMicBtn.scaleX-this.mChatContainer.width/2,this.mVoiceBtn.y=-this.mVoiceBtn.height/2*this.mVoiceBtn.scaleY-this.mChatContainer.height/2,this.mMicBtn.x=this.mVoiceBtn.x+this.mVoiceBtn.width*this.mMicBtn.scaleX+20,this.mMicBtn.y=this.mVoiceBtn.y):this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.PORTRAIT&&(this.x=t.width-(this.width/2+40)*this.mWorld.uiScale,this.mVoiceBtn.x=this.mVoiceBtn.width-this.mChatContainer.width/2,this.mVoiceBtn.y=this.mChatContainer.y-this.mChatContainer.height/2-this.mVoiceBtn.height/2*this.mMicBtn.scaleX,this.mMicBtn.x=this.mVoiceBtn.x+this.mMicBtn.width*this.mMicBtn.scaleX+20,this.mMicBtn.y=this.mVoiceBtn.y),this.y=t.height-120*this.mWorld.uiScale;var e,i=this.mWorld.uiManager.getMediator(p.RightMediator.NAME);if(i&&(e=i.getView()),i){if(this.mWorld.inputManager)this.mWorld.inputManager.resize();e&&e.resize()}this.mChatText.setStyle({fontSize:Math.floor(30*this.mWorld.uiScale)})},BottomBtnGroup.prototype.tweenView=function(t){var e=this.mWorld.getSize().height-120*this.mWorld.uiScale,i=!0===t?e:e+50,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{y:{value:i},alpha:{value:n}}})},BottomBtnGroup.prototype.preload=function(){this.scene&&(this.mResKey="baseView",this.scene.load.atlas("chat_atlas",r.i.getRes("ui/chat/chat_atlas.png"),r.i.getRes("ui/chat/chat_atlas.json")),this.scene.load.atlas(this.mResKey,r.i.getRes("ui/baseView/mainui_mobile.png"),r.i.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this))},BottomBtnGroup.prototype.init=function(){var e=this;this.mBtnList=[];var i=this.mWorld.getSize();this.mWorld.uiManager.getUILayerManager().addToUILayer(this);this.mChatContainer=this.scene.make.container(void 0,!1),this.mChatBg=this.scene.make.image(void 0,!1),this.mChatBg.setTexture(this.mResKey,"btnGroup_chatBg.png"),this.mChatContainer.addAt(this.mChatBg,0),this.mChatText=this.scene.make.text({width:430,height:230,style:{font:"bold YaHei",color:"#666666",fontSize:Math.floor(30*this.mWorld.uiScale),wordWrap:{width:430,useAdvancedWrap:!0}}},!1),this.mChatText.setText("点击窗口进入聊天界面"),this.mChatContainer.addAt(this.mChatText,1),this.mChatContainer.setSize(430,230),this.mChatText.x=-this.mChatContainer.width>>1,this.mChatText.y=-this.mChatContainer.height>>1,this.mChatContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,430,230),Phaser.Geom.Rectangle.Contains),this.add(this.mChatContainer),this.tmpWid+=this.mChatContainer.width,this.tmpHei+=this.mChatContainer.height,this.mTurnBtn=new s.IconBtn(this.scene,this.mWorld,{key:a.UIMediatorType.Turn_Btn_Bottom,bgResKey:this.mResKey,bgTextures:["btnGroup_white_normal.png","btnGroup_white_light.png","btnGroup_white_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_bottom_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mTurnBtn.x=30+(this.tmpWid>>1),this.mTurnBtn.y=this.tmpHei-this.mTurnBtn.height>>1,this.mTurnBtn.setPos(this.mTurnBtn.x,this.mTurnBtn.y),this.add(this.mTurnBtn),this.mBagBtn=new s.IconBtn(this.scene,this.mWorld,{key:l.BagMediator.NAME,bgResKey:this.mResKey,bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_bag_icon.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mBagBtn.x=this.mTurnBtn.x,this.mBagBtn.y=this.mTurnBtn.y-this.mTurnBtn.height/2-this.mBagBtn.height/2-10,this.mBagBtn.setPos(this.mBagBtn.x,this.mBagBtn.y),this.tmpWid+=this.mBagBtn.width+30,this.add(this.mBagBtn),this.mBtnList.push(this.mBagBtn),this.mTurnBtn.setClick((function(){e.turnHandler()})),this.mBagBtn.setClick((function(){e.bagHandler()})),this.mMarketBag=new s.IconBtn(this.scene,this.mWorld,{key:l.BagMediator.NAME,bgResKey:this.mResKey,bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_bag_icon.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mMarketBag.x=this.mTurnBtn.x,this.mMarketBag.y=this.mTurnBtn.y-this.mTurnBtn.height/2-this.mBagBtn.height/2-60-this.mMarketBag.height/2,this.mMarketBag.setPos(this.mMarketBag.x,this.mBagBtn.y),this.tmpWid+=this.mMarketBag.width+30,this.add(this.mMarketBag),this.setSize(this.tmpWid,this.tmpHei),this.mBtnList.push(this.mMarketBag),this.mMarketBag.setClick((function(){e.marketBagHandler()})),this.mVoiceBtn=new c.CheckButton(this.scene,0,0,"chat_atlas","voice_normal.png","voice_selected.png"),this.mVoiceBtn.x=this.width-60*this.mWorld.uiScale,this.mVoiceBtn.y=i.height-this.height,this.add(this.mVoiceBtn),this.mMicBtn=new c.CheckButton(this.scene,0,0,"chat_atlas","mic_normal.png","mic_selected.png"),this.mMicBtn.x=this.width-20*this.mWorld.uiScale,this.mMicBtn.y=i.height-this.height,this.add(this.mMicBtn),this.mVoiceBtn.scaleX=this.mVoiceBtn.scaleY=1.5,this.mMicBtn.scaleX=this.mMicBtn.scaleY=1.5,this.setSize(this.tmpWid,this.tmpHei),this.resize(),t.prototype.init.call(this)},BottomBtnGroup.prototype.tweenComplete=function(e){this.resize(),t.prototype.tweenComplete.call(this,e)},BottomBtnGroup.prototype.onSelectedVoiceHandler=function(t){!1===t&&(this.mMicBtn.selected=!1),this.emit("selectedVoice",t)},BottomBtnGroup.prototype.onSelectedMicHandler=function(t){!1!==this.mVoiceBtn.selected?(this.mMicBtn.selected=t,this.emit("selectedMic",t)):this.mMicBtn.selected=!1},BottomBtnGroup.prototype.turnHandler=function(){var t=this;this.mVoiceBtn.visible=this.mExpandBoo,this.mMicBtn.visible=this.mExpandBoo;var e=this.mExpandBoo?"Sine.easeIn":"Sine.easeOut";if(this.mChatContainer&&this.mChatContainer.parentContainer){var i=this.mExpandBoo?1:0,n=this.mExpandBoo?1:0;this.scene.tweens.add({targets:this.mChatContainer,duration:300,ease:e,props:{scaleX:{value:i},scaleY:{value:n}}})}if(!this.mBtnList||this.mBtnList.length<1)this.mExpandBoo=!this.mExpandBoo;else{var o,r=this.mBtnList.length,s=this.mWorld.uiManager.getMediator(p.RightMediator.NAME);s&&(o=s.getView());for(var _loop_1=function(i){var n=a.mBtnList[i],h=a.mExpandBoo?n.getPos().x:a.mChatContainer.width/2-Math.abs(n.getPos().y)-20,c=a.mExpandBoo?n.getPos().y:a.mTurnBtn.y;a.scene.tweens.add({targets:n,duration:300,ease:e,props:{x:{value:h},y:{value:c}},onComplete:function(e,a,h){if(i===r-1&&(t.mExpandBoo=!t.mExpandBoo,t.mExpandBoo?t.setSize(t.tmpWid,2*n.height):t.setSize(t.tmpWid,t.tmpHei),s)){if(t.mWorld.inputManager)t.mWorld.inputManager.resize();o&&o.resize()}},onCompleteParams:[a]})},a=this,h=0;h<r;h++)_loop_1(h)}},BottomBtnGroup.prototype.chatHandler=function(){var t=this.mWorld.uiManager.getMediator(h.ChatMediator.NAME);void 0===t&&(t=new h.ChatMediator(this.mWorld,this.scene),this.mWorld.uiManager.setMediator(h.ChatMediator.NAME,t)),t.isShow()||t.show(),this.mWorld.uiManager.baseFaceTween(!1)},BottomBtnGroup.prototype.bagHandler=function(){this.mWorld.uiManager.getMediator(a.UIMediatorType.BagMediator).show()},BottomBtnGroup.prototype.marketBagHandler=function(){var t=this.mWorld.uiManager.getMediator(d.ElementStorageMediator.name);t||(t=new d.ElementStorageMediator(this.mWorld.uiManager.getUILayerManager(),this.scene,this.mWorld),this.mWorld.uiManager.setMediator(d.ElementStorageMediator.name,t)),t.isShow()?t.hide():t.show(!0)},BottomBtnGroup}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ElementStoragePanel",(function(){return p}));var n,o=i(112),r=i(117),s=i(111),a=i(198),h=i(163),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function ElementStoragePanel(e,i){var n=t.call(this,e,i)||this;return n.mExpaned=!0,n.mItemNum=32,n.setTween(!1),n.dpr/=2,n}return l(ElementStoragePanel,t),ElementStoragePanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&this.setPackageNum(1)},ElementStoragePanel.prototype.resize=function(t){var e=this.mWorld.getSize();if(this.scale=this.dpr,this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){this.setSize(341,450),this.x=e.width-this.width*this.dpr-10,this.y=e.height-this.height*this.dpr>>1,this.mBackground.resize(this.width,this.height),this.mBackground.x=this.mBackground.width>>1,this.mBackground.y=this.mBackground.height>>1,this.mBorder.resize(327,423),this.mBorder.x=7+(this.mBorder.width>>1),this.mBorder.y=19+(this.mBorder.height>>1),this.mSearchInput.x=145,this.mSearchInput.y=40,this.mDragBtn.x=-this.mDragBtn.height,this.mDragBtn.y=this.height>>1;for(var i=this.mProps.length,n=0;n<i;n++)this.mProps[n].x=n%4*60+20,this.mProps[n].y=60*Math.floor(n/4)+80}else{this.setSize(510,329),this.mBackground.resize(this.width,this.height),this.mBackground.x=this.mBackground.width>>1,this.mBackground.y=this.mBackground.height>>1,this.mBorder.resize(496,303),this.mBorder.x=7+(this.mBorder.width>>1),this.mBorder.y=19+(this.mBorder.height>>1),this.mSearchInput.x=270,this.mSearchInput.y=33,this.x=e.width-this.width*this.dpr>>1,this.y=e.height-this.height*this.dpr-10,this.mDragBtn.x=this.width>>1,this.mDragBtn.y=-this.mDragBtn.height>>1;for(i=this.mProps.length,n=0;n<i;n++)this.mProps[n].x=n%8*60+20,this.mProps[n].y=60*Math.floor(n/8)+80}this.mPrePageBtn.y=this.height>>1,this.mNextPageBtn.x=this.width,this.mNextPageBtn.y=this.height>>1,this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,this.width,this.height),Phaser.Geom.Rectangle.Contains)},ElementStoragePanel.prototype.addListen=function(){t.prototype.addListen.call(this),this.mBackground&&this.mBackground.on("pointerout",this.onPointerOutHandler,this),this.mDragBtn&&this.mDragBtn.on("pointerup",this.switchExpand,this),this.mPrePageBtn&&this.mPrePageBtn.on("pointerup",this.onPrePageHandler,this),this.mNextPageBtn&&this.mNextPageBtn.on("pointerup",this.onNextPageHandler,this),this.mCloseBtn&&this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.scene&&(this.scene.input.on("dragstart",this.onDragStartHandler,this),this.scene.input.on("dragend",this.onDragEndHandler,this),this.scene.input.on("drag",this.onDragHandler,this))},ElementStoragePanel.prototype.removeListen=function(){t.prototype.removeListen.call(this),this.mBackground&&this.mBackground.off("pointerout",this.onPointerOutHandler,this),this.mDragBtn&&this.mDragBtn.off("pointerup",this.switchExpand,this),this.mPrePageBtn&&this.mPrePageBtn.off("pointerup",this.onPrePageHandler,this),this.mNextPageBtn&&this.mNextPageBtn.off("pointerup",this.onNextPageHandler,this),this.mCloseBtn&&this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.scene&&(this.scene.input.off("dragstart",this.onDragStartHandler,this),this.scene.input.off("dragend",this.onDragEndHandler,this),this.scene.input.off("drag",this.onDragHandler,this))},ElementStoragePanel.prototype.setProps=function(t){var e=t.items;this.clearItem();for(var i=0;i<e.length;i++){if(i>=this.mProps.length)return;this.mProps[i].setProp(e[i])}},ElementStoragePanel.prototype.expand=function(){if(!this.mExpaned){var t=this.mWorld.getSize(),e=null;e=this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?{x:t.width-this.width*this.dpr-10}:{y:t.height-this.height*this.dpr-10},this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:e}),this.remove(this.mDragBtn),this.add([this.mPrePageBtn,this.mNextPageBtn]),this.mExpaned=!0}},ElementStoragePanel.prototype.collapse=function(){if(this.mExpaned){var t=this.mWorld.getSize(),e=null;e=this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?{x:t.width}:{y:t.height},this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:e}),this.addAt(this.mDragBtn,0),this.remove([this.mPrePageBtn,this.mNextPageBtn]),this.mExpaned=!1}},ElementStoragePanel.prototype.destroy=function(){this.scene&&(this.scene.input.off("dragstart",this.onDragStartHandler,this),this.scene.input.off("dragend",this.onDragEndHandler,this),this.scene.input.off("drag",this.onDragHandler,this)),t.prototype.destroy.call(this)},ElementStoragePanel.prototype.preload=function(){this.scene.load.image(s.d.getName(),s.d.getPNG()),this.scene.load.image("button",s.i.getRes("ui/common/button.png")),this.scene.load.image("prop_background",s.i.getRes("ui/common/prop_background.png")),this.scene.load.atlas("slip",s.i.getRes("ui/bag/slip.png"),s.i.getRes("ui/bag/slip.json")),this.mScene.load.atlas("clsBtn",s.i.getRes("ui/common/common_clsBtn.png"),s.i.getRes("ui/common/common_clsBtn.json")),this.scene.load.image(s.a.getName(),s.a.getPNG()),t.prototype.preload.call(this)},ElementStoragePanel.prototype.init=function(){this.mBackground=new r.NinePatch(this.scene,0,0,this.width,this.height,s.a.getName(),null,s.a.getConfig()),this.mBorder=new r.NinePatch(this.scene,7,19,327,423,s.d.getName(),null,s.d.getConfig()),this.mSearchInput=new c.InputText(this.scene,145,40,210,26,{type:"input",fontSize:"14px",color:"#808080",placeholder:"输入关键词进行搜索"});this.mDragBtn=new c.NineSliceButton(this.scene,0,-20,80,40,"button","","物件容器",this.dpr,this.scale,{left:4,top:4,right:4,bottom:4}),this.mPrePageBtn=this.scene.make.sprite({key:"slip"},!1),this.mPrePageBtn.setInteractive(),this.mNextPageBtn=this.scene.make.sprite({key:"slip"},!1).setFlipX(!0),this.mNextPageBtn.setInteractive(),this.mProps=[],this.add([this.mBackground,this.mBorder,this.mSearchInput]);for(var e=0;e<this.mItemNum;e++){var i=new a.Item(this.scene);this.mProps[e]=i}this.add(this.mProps),this.add([this.mPrePageBtn,this.mNextPageBtn]),this.mCloseBtn=this.scene.make.image({key:"clsBtn",frame:"btn_normal"},!1).setInteractive().setScale(2),this.add(this.mCloseBtn),t.prototype.init.call(this),this.resize(),this.expand()},ElementStoragePanel.prototype.onPrePageHandler=function(){this.setPackageNum(this.mPacgeNum-1)},ElementStoragePanel.prototype.onNextPageHandler=function(){this.setPackageNum(this.mPacgeNum+1)},ElementStoragePanel.prototype.setPackageNum=function(t){this.mPacgeNum=t<1?1:t,this.emit("queryElement",this.mPacgeNum,32)},ElementStoragePanel.prototype.switchExpand=function(){this.mExpaned?this.collapse():this.expand()},ElementStoragePanel.prototype.onSelectedHandler=function(){},ElementStoragePanel.prototype.onClick=function(t){},ElementStoragePanel.prototype.onDragStartHandler=function(t,e,i,n){var o=e.parentContainer;o instanceof a.Item&&(this.mDragData=o.prop),this.mDragImage||(this.mDragImage=this.scene.make.image(void 0,!1),this.add(this.mDragImage)),this.mDragImage.x=o.x,this.mDragImage.y=o.y,this.mDragImage.setTexture(e.texture.key),this.mDragging=!0},ElementStoragePanel.prototype.onDragEndHandler=function(){this.mDragImage&&(this.mDragImage.setTexture(void 0),this.mDragging=!1)},ElementStoragePanel.prototype.onDragHandler=function(t,e,i,n){this.mDragImage&&(this.mDragImage.x+=t.x-t.prevPosition.x,this.mDragImage.y+=t.y-t.prevPosition.y)},ElementStoragePanel.prototype.onPointerOutHandler=function(){this.mDragImage&&this.mDragging&&(this.emit("selectedElement",this.mDragData),this.mDragImage.setTexture(void 0),this.mDragging=!1)},ElementStoragePanel.prototype.clearItem=function(){this.mProps&&this.mProps.map((function(t){return t.clear()}))},ElementStoragePanel.prototype.onCloseHandler=function(){var t=this.mWorld.uiManager.getMediator(h.ElementStorageMediator.name);t&&t.hide()},ElementStoragePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Item",(function(){return a}));var n,o=i(116),r=i(111),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Item(e){var i=t.call(this,e)||this,n=e.make.image({key:"prop_background"}).setOrigin(0,0);return i.setSize(n.width,n.height),i.add(n),i.mImage=new o.DynamicImage(i.scene,0,0).setOrigin(0,0),i.add(i.mImage),i.mCount=e.make.text(void 0,!1),i.mCount.setAlign("right"),i.mCount.y=i.height-20,i.add(i.mCount),i}return s(Item,t),Item.prototype.setProp=function(t){var e=this;this.mProp=t,this.mCount&&t&&(this.mImage.load(r.i.getOsdRes(t.display.texturePath),this,(function(){e.mImage.setInteractive(),e.scene.input.setDraggable(e.mImage);var t=1;e.mImage.width>e.width&&(t=e.width/e.mImage.width),e.mImage.height>e.height&&(t=e.height/e.mImage.height),e.mImage.scale=t})),this.mCount.setText(t.count>1?t.count.toString():""),this.mCount.x=this.width-this.mCount.width)},Item.prototype.clear=function(){this.count&&this.mProp&&(this.mCount.setText(""),this.mImage.setTexture(void 0),this.mImage.off("pointerup",this.onPointerUpHandler,this),this.mProp=void 0)},Item.prototype.destroy=function(){this.clear(),t.prototype.destroy.call(this)},Object.defineProperty(Item.prototype,"prop",{get:function(){return this.mProp},enumerable:!1,configurable:!0}),Item.prototype.onPointerUpHandler=function(){this.emit("click",this.mProp)},Item}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"ElementStorage",(function(){return h}));var n,o=i(110),r=i(2),s=i(119),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ElementStorage(e){var i=t.call(this)||this;return i.world=e,i.event=new Phaser.Events.EventEmitter,i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_QUERY_EDIT_PACKAGE,i.onQueryEditPackageResuleHandler),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE,i.onQueryMarketPacketResuleHandler),i}return a(ElementStorage,t),ElementStorage.prototype.register=function(){this.world&&this.world.connection.addPacketListener(this)},ElementStorage.prototype.unregister=function(){this.world&&(this.world.connection.removePacketListener(this),this.event.removeAllListeners())},ElementStorage.prototype.on=function(t,e,i){this.event.on(t,e,i)},ElementStorage.prototype.off=function(t,e,i){this.event.off(t,e,i)},ElementStorage.prototype.queryPackage=function(t,e,i,n){this.world},ElementStorage.prototype.queryMarketPackage=function(t,e,i,n){this.world},ElementStorage.prototype.destroy=function(){this.unregister()},ElementStorage.prototype.onQueryEditPackageResuleHandler=function(t){this.event.emit(s.a.EDIT_MODE_QUERY_PACKAGE,t.content)},ElementStorage.prototype.onQueryMarketPacketResuleHandler=function(t){this.event.emit(s.a.EDIT_MODE_QUERY_PACKAGE,t.content)},ElementStorage}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"LeftMediator",(function(){return a}));var n,o=i(134),r=i(201),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function LeftMediator(e,i){return t.call(this,e,i)||this}return s(LeftMediator,t),LeftMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new r.LeftBtnGroup(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},LeftMediator.NAME="LeftMediator",LeftMediator}(o.BaseFaceMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"LeftBtnGroup",(function(){return h}));var n,o=i(112),r=i(111),s=i(202),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function LeftBtnGroup(e,i){var n=t.call(this,e,i)||this;return n.mCollapse=!1,n.disInteractive(),n}return a(LeftBtnGroup,t),LeftBtnGroup.prototype.show=function(e){this.scale=this.mWorld.uiScale,t.prototype.show.call(this,e)},LeftBtnGroup.prototype.resize=function(){this.x=this.width+5*this.mWorld.uiScale,this.y=this.height/2+10*this.mWorld.uiScale,this.scale=this.mWorld.uiScale},LeftBtnGroup.prototype.destroy=function(){this.mExpandBtn&&this.mExpandBtn.destroy(),this.mResKey="",this.mExpandBtn=null,this.mCollapse=!1,t.prototype.destroy.call(this)},LeftBtnGroup.prototype.tweenView=function(t){var e=this.width+5*this.mWorld.uiScale,i=!0===t?e:e-50,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{x:{value:i},alpha:{value:n}}})},LeftBtnGroup.prototype.addListen=function(){},LeftBtnGroup.prototype.removeListen=function(){},LeftBtnGroup.prototype.preload=function(){this.scene&&(this.mResKey="baseView",this.scene.load.atlas(this.mResKey,r.i.getRes("ui/baseView/mainui_mobile.png"),r.i.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this))},LeftBtnGroup.prototype.init=function(){var e=this;this.mWorld.uiManager.getUILayerManager().addToUILayer(this);var i=0;"app"!==this.mWorld.getConfig().platform&&(this.mExpandBtn=new s.IconSelectBtn(this.scene,this.mWorld,this.mResKey,["btnGroup_expand.png","btnGroup_collapse.png"],1),this.add(this.mExpandBtn),this.mExpandBtn.setClick((function(){e.mCollapse?e.mWorld.stopFullscreen():e.mWorld.startFullscreen(),e.mExpandBtn.setBgRes(Number(!e.mCollapse)),e.mCollapse=!e.mCollapse})),i+=this.mExpandBtn.height/2+20,this.setSize(this.mExpandBtn.width,i)),this.resize(),t.prototype.init.call(this)},LeftBtnGroup}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"IconSelectBtn",(function(){return s}));var n,o=i(118),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function IconSelectBtn(e,i,n,o,r){void 0===r&&(r=28/43);var s=t.call(this,e)||this;return s.mScene=e,s.mWorld=i,s.mBtnBg=e.make.image(void 0,!1),s.mBgTexture=o,s.mBgResKey=n,s.mBtnBg.setTexture(n,o[0]),s.mBtnBg.scaleX=s.mBtnBg.scaleY=r,s.addAt(s.mBtnBg,0),s.setSize(s.mBtnBg.width,s.mBtnBg.height),s.setInteractive(),s.on("pointerup",s.upHandler,s),s.on("pointerdown",s.downHandler,s),s.on("pointerover",s.overHandler,s),s.on("pointerout",s.outHandler,s),s}return r(IconSelectBtn,t),IconSelectBtn.prototype.setPos=function(t,e){this.mBasePos||(this.mBasePos=new o.a),this.mBasePos.x=t,this.mBasePos.y=e},IconSelectBtn.prototype.getPos=function(){return this.mBasePos},IconSelectBtn.prototype.setBtnData=function(t){this.mBtnData=t},IconSelectBtn.prototype.getBtnData=function(){return this.mBtnData},IconSelectBtn.prototype.setClick=function(t){this.monClick=t},IconSelectBtn.prototype.setBgRes=function(t){this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[t]||0)},IconSelectBtn.prototype.destroy=function(){this.mBtnBg&&this.mBtnBg.destroy(!0),this.mBtnIcon&&this.mBtnIcon.destroy(!0),this.monClick=null,this.mBtnBg=null,this.mBtnIcon=null,this.mBtnData=null,this.mScene=null,t.prototype.destroy.call(this)},IconSelectBtn.prototype.overHandler=function(t){},IconSelectBtn.prototype.outHandler=function(t){},IconSelectBtn.prototype.upHandler=function(){this.monClick&&this.monClick()},IconSelectBtn.prototype.downHandler=function(){this.scaleHandler()},IconSelectBtn.prototype.scaleHandler=function(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1},IconSelectBtn}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"BagGroupMediator",(function(){return c}));var n,o=i(134),r=i(119),s=i(204),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function BagGroupMediator(e,i){var n=t.call(this,e,i)||this;return n.mUIType=a.UIType.Scene,n}return h(BagGroupMediator,t),BagGroupMediator.prototype.isSceneUI=function(){return!0},BagGroupMediator.prototype.isShow=function(){if(this.mView)return this.mView.isShow()},BagGroupMediator.prototype.show=function(e){if(!this.mView||!this.mView.isShow()){var i=this.world.getSize();this.mView=new s.BagGroup(this.mScene,this.world,(i.width>>1)-29,i.height-50),this.mView.show(e),this.addListen(),t.prototype.show.call(this,e)}},BagGroupMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},BagGroupMediator.prototype.hide=function(){this.mShow=!1,this.removeListen(),this.mView&&(this.mView.hide(),this.mView=null)},BagGroupMediator.prototype.addListen=function(){this.world.emitter.on(r.a.QUERY_PACKAGE,this.queryPackAge,this),this.world.emitter.on(r.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.on(r.a.PACKAGE_ITEM_ADD,this.heroItemChange,this)},BagGroupMediator.prototype.removeListen=function(){this.world.emitter.off(r.a.QUERY_PACKAGE,this.queryPackAge,this),this.world.emitter.off(r.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.off(r.a.PACKAGE_ITEM_ADD,this.heroItemChange,this)},BagGroupMediator.prototype.heroItemChange=function(){if(this.world.roomManager.currentRoom&&this.world.roomManager.currentRoom.playerManager&&this.world.roomManager.currentRoom.playerManager.actor){var t=this.world.roomManager.currentRoom.playerManager.actor.package.items;this.mView&&this.mView.setDataList(t)}},BagGroupMediator.prototype.queryPackAge=function(t){this.world.roomManager.currentRoom&&this.world.roomManager.currentRoom.playerManager&&this.world.roomManager.currentRoom.playerManager.actor&&t.id===this.world.roomManager.currentRoom.playerManager.actor.package.id&&this.mView&&this.mView.setDataList(t.items)},BagGroupMediator.NAME="BagGroupMediator",BagGroupMediator}(o.BaseFaceMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"BagGroup",(function(){return p}));var n,o=i(133),r=i(111),s=i(164),a=i(144),h=i(132),c=i(112),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function BagGroup(e,i,n,o){var r=t.call(this,e,i)||this;return r.tmpWid=0,r.x=n,r.y=o,i.uiManager.getUILayerManager().addToToolTipsLayer(r),r.bagSlotList=[],r}return l(BagGroup,t),BagGroup.prototype.show=function(e){t.prototype.show.call(this)},BagGroup.prototype.resize=function(t,e){var i=this.mWorld.getSize(),n=this.mWorld.uiManager.getMediator(a.ChatMediator.NAME);this.x=(i.width-this.tmpWid)/2<n.getView().width?n.getView().width+this.width/2:(i.width-this.tmpWid)/2,this.y=i.height-50},BagGroup.prototype.tweenExpand=function(t){if(this.scene){var e=this.mWorld.getSize().height-50,i=!0===t?e:e+100,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Cubic.Out",props:{y:{value:i},alpha:{value:n}}})}},BagGroup.prototype.destroy=function(){this.bagSlotList&&(this.bagSlotList.forEach((function(t){t&&t.destroy()})),this.bagSlotList.length=0,this.bagSlotList=null),this.tmpWid=0,this.baseBagBgWid=0,this.mResStr=null,this.mResPng=null,this.mResJson=null,t.prototype.destroy.call(this)},BagGroup.prototype.addListen=function(){this.mBagBtnCon&&(this.mBagBtnCon.on("pointerdown",this.bagHandler,this),this.mBagBtnCon.on("pointerover",this.bagBtnOver,this),this.mBagBtnCon.on("pointerout",this.bagBtnOut,this))},BagGroup.prototype.removeListen=function(){this.mBagBtnCon&&(this.mBagBtnCon.off("pointerdown",this.bagHandler,this),this.mBagBtnCon.off("pointerover",this.bagBtnOver,this),this.mBagBtnCon.off("pointerout",this.bagBtnOut,this))},BagGroup.prototype.setDataList=function(t){this.bagSlotList&&this.bagSlotList.forEach((function(t){t&&(t.getView().visible=!1)}));for(var e=[],i=t.length>BagGroup.SlotMaxCount?BagGroup.SlotMaxCount:t.length,n=this.baseBagBgWid+5,o=0;o<i;o++){var r=this.bagSlotList[o];r.getView().visible=!0,e.push(r.toolTipCon),r.dataChange(t[o]),n+=61}this.width!==n&&(this.width=n,this.buttons&&(this.buttons.destroy(!0),this.buttons=null),this.buttons=this.scene.rexUI.add.buttons({x:(n+this.mBagBg.width)/2,y:0,width:56,height:56,orientation:0,buttons:e,groupName:"bagBtn",align:"right",click:{mode:"pointerup",clickInterval:100},space:5,name:"bag"}),this.buttons.layout(),this.setSize(n,65),this.mWorld.uiManager.baseFaceResize())},BagGroup.prototype.preload=function(){this.scene&&(this.mResStr="bag",this.mResPng="ui/bag/bag.png",this.mResJson="ui/bag/bag.json",this.scene.load.atlas(this.mResStr,r.i.getRes(this.mResPng),r.i.getRes(this.mResJson)),t.prototype.preload.call(this))},BagGroup.prototype.init=function(){if(this.mBagBtnCon=this.scene.add.container(0,0),this.mBagBg=this.scene.add.sprite(0,0,this.mResStr,"bag_BtnBg"),this.baseBagBgWid=this.mBagBg.width,this.tmpWid+=this.mBagBg.width+5,this.bagBtn=this.scene.add.sprite(this.mBagBg.x,this.mBagBg.y,this.mResStr,"bag_Btn"),this.mSubScriptSprite=this.scene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,"bag_SubScripta"),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.mBagBg.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.mBagBg.height>>1,this.mBagBtnCon.addAt(this.mBagBg,0),this.mBagBtnCon.addAt(this.bagBtn,1),this.mBagBtnCon.setSize(56,56),this.mBagBtnCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBagBg.width,this.mBagBg.height),Phaser.Geom.Rectangle.Contains),this.initBagSlot(),this.setSize(this.tmpWid,65),this.mWorld.roomManager.currentRoom&&this.mWorld.roomManager.currentRoom.playerManager&&this.mWorld.roomManager.currentRoom.playerManager.actor){var e=this.mWorld.roomManager.currentRoom.playerManager.actor.package;e&&e.items&&this.setDataList(e.items)}this.add(this.mBagBtnCon),t.prototype.init.call(this)},BagGroup.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.baseFaceResize()},BagGroup.prototype.initBagSlot=function(){for(var t,e=["0","b","c"],i=0;i<BagGroup.SlotMaxCount;i++){t=i>=9?"bag_SubScript"+e[i%9]:"bag_SubScript"+(i+1);var n=new o.ItemSlot(this.scene,this.mWorld,this,0,0,this.mResStr,this.mResPng,this.mResJson,"bag_Slot","",t);n.createUI(),n.getView().visible=!1,this.bagSlotList.push(n)}},BagGroup.prototype.bagHandler=function(){var t=this.mWorld.uiManager.getMediator(h.BagMediator.NAME);t.isShow()?t.hide():t.show()},BagGroup.prototype.tmpLoad=function(){var t=this;this.radio?this.radio.isShow||this.radioComplete():this.radio=new s.Radio(this.scene,{wid:328,hei:142,resKey:"juqingRadio",resPng:"./resources/ui/juqing/juqing.png",resJson:"./resources/ui/juqing/juqing.json",resBg:"radio_bg.png",resArrow:"radio_arrow.png",fontStyle:{size:20,color:"#ffcc00",bold:!1},completeBack:function(){t.radioComplete()},clickCallBack:function(){t.radio&&t.radio.parentContainer&&(t.radio.clearRadioData(),t.radio.parentContainer.remove(t.radio))}})},BagGroup.prototype.radioComplete=function(){this.radio.setRadioData(["1111111111","2222222222","333333333333","444444444444"]),this.radio.x=this.bagBtn.x,this.radio.y=this.bagBtn.y-142,this.add(this.radio)},BagGroup.prototype.bagBtnOver=function(t){this.mBagSelect=this.scene.make.sprite(void 0,!1),this.mBagSelect.setTexture(this.mResStr,"bag_BtnSelect"),this.mBagBtnCon.add(this.mBagSelect)},BagGroup.prototype.bagBtnOut=function(t){this.mBagSelect&&this.mBagSelect.parentContainer&&this.mBagSelect.parentContainer.remove(this.mBagSelect)},BagGroup.SlotMaxCount=12,BagGroup}(c.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"TopMenuMediator",(function(){return l}));var n,o=i(119),r=i(206),s=i(110),a=i(2),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function TopMenuMediator(e,i){var n=t.call(this)||this;return n.scene=e,n.world=i,n}return c(TopMenuMediator,t),TopMenuMediator.prototype.show=function(){this.register()},TopMenuMediator.prototype.hide=function(){this.unregister()},TopMenuMediator.prototype.isSceneUI=function(){return!0},TopMenuMediator.prototype.register=function(){this.world.emitter.on(o.a.ADD_ICON_TO_TOP,this.onAddIconHandler,this),this.world.emitter.on(o.a.REMOVE_ICON_FROM_TOP,this.onAddIconHandler,this)},TopMenuMediator.prototype.unregister=function(){this.world.emitter.off(o.a.ADD_ICON_TO_TOP,this.onAddIconHandler,this),this.world.emitter.off(o.a.REMOVE_ICON_FROM_TOP,this.onRemoveIcon,this)},TopMenuMediator.prototype.destroy=function(){this.hide(),t.prototype.destroy.call(this)},TopMenuMediator.prototype.addItem=function(t){this.mView||(this.mView=new r.TopMenuContainer(this.scene,this.world),this.mView.on("saveDecorate",this.onSaveDecorateHandler,this),this.mView.on("enterDecorate",this.onEnterDecorateHandler,this),this.mView.on("showMarket",this.onShowMarketHandler,this)),this.mView.addItem(t)},TopMenuMediator.prototype.removeItem=function(t){this.mView&&this.mView.removeItem(t)},TopMenuMediator.prototype.onAddIconHandler=function(t){this.addItem(t)},TopMenuMediator.prototype.onRemoveIcon=function(t){this.removeItem(t)},TopMenuMediator.prototype.onSaveDecorateHandler=function(){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_LEAVE);t.content.needSaveEditScene=!0,this.world.connection.send(t)},TopMenuMediator.prototype.onEnterDecorateHandler=function(){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER);this.world.connection.send(t)},TopMenuMediator.prototype.onShowMarketHandler=function(){var t=new s.PBpacket(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_UI);t.content.name="Market",this.world.emitter.emit(o.a.SHOW_UI,t)},TopMenuMediator.NAME="TopMenuMediator",TopMenuMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"TopMenuContainer",(function(){return a}));var n,o=i(112),r=i(111),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function TopMenuContainer(e,i){var n=t.call(this,e,i)||this;return n.maxNum=3,n.setTween(!1),n.mButtons=[],n}return s(TopMenuContainer,t),TopMenuContainer.prototype.resize=function(){var t=this.mWorld.getSize();this.x=t.width-50*this.mWorld.uiScale,this.y=this.height/2+120*this.mWorld.uiScale,this.scale=this.dpr},TopMenuContainer.prototype.show=function(){this.mWorld&&this.mWorld.uiManager.getUILayerManager().addToUILayer(this),t.prototype.show.call(this)},TopMenuContainer.prototype.hide=function(){this.parentContainer&&this.parentContainer.remove(this)},TopMenuContainer.prototype.addItem=function(t){},TopMenuContainer.prototype.removeItem=function(t){var e=this.mButtons.findIndex((function(e){return e.name===t}));e>=0&&(this.mButtons[e].destroy(),this.mButtons.splice(e,1)),this.mButtons.length,this.maxNum,0===this.mButtons.length&&this.hide(),this.refresh()},TopMenuContainer.prototype.preload=function(){this.scene.load.atlas("baseView",r.i.getRes("ui/baseView/mainui_mobile.png"),r.i.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this)},TopMenuContainer.prototype.init=function(){this.mInitialized||(t.prototype.init.call(this),this.resize())},TopMenuContainer.prototype.refresh=function(){for(var t=0;t<this.mButtons.length;t++)this.mButtons[t].x=-(60*t+30)},TopMenuContainer.prototype.expand=function(){},TopMenuContainer.prototype.collapse=function(){},TopMenuContainer.prototype.destroy=function(){this.mButtons.map((function(t){return t.destroy()})),this.mButtons.length=0,t.prototype.destroy.call(this)},TopMenuContainer.prototype.onGameObjectUpHandler=function(t){switch(t.name){case"SaveDecorate":this.emit("saveDecorate");break;case"EnterDecorate":this.emit("enterDecorate");break;case"Market":this.emit("showMarket")}},TopMenuContainer}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"InputTextFactory",(function(){return s})),i.d(e,"InputTextFieldEvent",(function(){return a})),i.d(e,"InputTextField",(function(){return h}));var n,o=i(109),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(){function InputTextFactory(t){this.mWorld=t}return InputTextFactory.prototype.getInputText=function(t,e){return new h(t,this.mWorld,e)},InputTextFactory}(),a={textchange:"textchange",textclick:"textclick",textdblclick:"textdblclick",textfocus:"textfocus",textblur:"textblur",textExit:"textExit"},h=function(t){function InputTextField(e,i,n){var o=t.call(this)||this;return o.mDelayTime=300,o.mScene=e,o.mWorld=i,o.textConfig=n,o.mTextField=e.make.text({x:n.x||0,y:n.y||0,stroke:"#000000",strokeThickness:2,align:n.align||"left",style:{color:n.color||"#fff",font:n.font||"16px YaHei",wordWrap:{width:n.textWidt||null}}},!1).setInteractive(new Phaser.Geom.Rectangle(0,0,n.textWidth,n.textHeight),Phaser.Geom.Rectangle.Contains),o.mTextField.setOrigin(.5,.5),o.mTextField.setAlign(n.align),o.mTextField.setText(n.text||""),o.mTextField.on("pointerdown",o.showText,o),o}return r(InputTextField,t),InputTextField.prototype.onBlur=function(){this.mInputText.onBlur()},InputTextField.prototype.onFocus=function(){this.mInputText.onFocus()},InputTextField.prototype.getText=function(){return this.mTextField.text},InputTextField.prototype.getSkin=function(){return this.mTextField},InputTextField.prototype.destroy=function(){this.mInputText&&this.mInputText.destroy(),this.mInputText=null},InputTextField.prototype.showText=function(){var t=this,e=1===this.textConfig.posType?-this.textConfig.textWidth>>1:-this.mWorld.getSize().width>>1,i=this.mTextField.text&&this.mTextField.text.length>0?this.mTextField.text:this.textConfig.minNum;this.mInputText?this.mInputText.setText(i):(this.mInputText=new o.InputText(this.mScene,{id:this.textConfig.id||"input",x:e||0,y:this.textConfig.y||0,width:this.textConfig.textWidth||100,height:this.textConfig.textHeight||100,type:this.textConfig.type||"",fontSize:this.textConfig.font||"16px YaHei",color:this.textConfig.color||"#fff","z-index":999,align:"left",text:i,posType:this.textConfig.posType}),this.mInputText.setOrigin(0,.6)),1===this.textConfig.posType&&(this.mTextField.visible=!1,this.mInputText.parentContainer||this.mTextField.parentContainer.add(this.mInputText)),this.mInputText.visible=!0,this.mInputText.on("textchange",this.onTextchange,this),this.mInputText.on("onclick",this.onTextClick,this),this.mInputText.on("ondblclick",this.onTextDbclick,this),this.mInputText.on("focus",this.onTextFocus,this),this.mInputText.on("blur",this.onTextBlur,this),this.mInputText.node.addEventListener("keypress",(function(e){13===(e.keyCode||e.which)&&(t.emit(a.textExit),t.hideText())})),this.mScene.input.on("gameobjectdown",this.sceneDown,this),this.mWorld.game.device.os.iOS&&!this.mWorld.game.device.os.desktop?this.setInputFocus():this.mInputTimeID=this.mScene.setTimeout((function(){t.setInputFocus()}),this.mDelayTime)},InputTextField.prototype.hideText=function(){if(this.mTextField.visible=!0,this.mInputText){this.mInputText.off("textchange",this.onTextchange,this),this.mInputText.off("onclick",this.onTextClick,this),this.mInputText.off("ondblclick",this.onTextDbclick,this),this.mInputText.off("focus",this.onTextFocus,this),this.mInputText.off("blur",this.onTextBlur,this),this.mScene.input.off("gameobjectdown",this.sceneDown,this);var t=this.mInputText.text;t.length>0&&this.mTextField.setText(t),this.mInputText.setText(""),this.mInputText.setBlur(),this.mInputText.visible=!1,this.mInputTimeID&&this.mScene.clearTimeout(this.mInputTimeID),1===this.textConfig.posType&&(this.mTextField.visible=!0)}},InputTextField.prototype.setInputFocus=function(){var t=document.all.namedItem(this.textConfig.id);t&&t.focus()},InputTextField.prototype.sceneDown=function(t,e){e&&e===this.mTextField||this.onTextBlur()},InputTextField.prototype.onTextchange=function(){if("number"===this.textConfig.type){var t=Number(this.mInputText.text);isNaN(t)&&(t=0),this.textConfig.minNum&&this.textConfig.maxNum&&(t<this.textConfig.minNum?t=this.textConfig.minNum:t>this.textConfig.maxNum&&(t=this.textConfig.maxNum)),this.mInputText.text=t+""}this.emit(a.textchange)},InputTextField.prototype.onTextClick=function(){this.emit(a.textclick)},InputTextField.prototype.onTextDbclick=function(){this.emit(a.textdblclick)},InputTextField.prototype.onTextFocus=function(){this.onFocus(),this.emit(a.textfocus)},InputTextField.prototype.onTextBlur=function(){this.onBlur(),this.hideText(),this.emit(a.textblur)},InputTextField}(Phaser.Events.EventEmitter)},function(t,e,i){"use strict";i.r(e),i.d(e,"DecorateControlMediator",(function(){return l}));var n,o=i(209),r=i(110),s=i(2),a=i(119),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function DecorateControlMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,n&&(n.emitter.on(a.a.SELECTED_DECORATE_ELEMENT,o.onSelectedDecorateHandler,o),n.emitter.on(a.a.CANCEL_DECORATE_ELEMENT,o.onCancelDecorateHandler,o)),o}return c(DecorateControlMediator,t),DecorateControlMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.DecorateControlPanel(this.scene,this.world)),this.addActionListener(),this.mView.show(),this.layerManager.addToUILayer(this.mView))},DecorateControlMediator.prototype.destroy=function(){this.world&&(this.world.emitter.on(a.a.SELECTED_DECORATE_ELEMENT,this.onSelectedDecorateHandler,this),this.world.emitter.on(a.a.CANCEL_DECORATE_ELEMENT,this.onCancelDecorateHandler,this)),t.prototype.destroy.call(this)},DecorateControlMediator.prototype.isSceneUI=function(){return!0},DecorateControlMediator.prototype.onSelectedDecorateHandler=function(){this.mView&&this.mView.parentContainer&&this.mView.parentContainer.remove(this.mView)},DecorateControlMediator.prototype.onCancelDecorateHandler=function(){this.mView&&this.layerManager.addToUILayer(this.mView)},DecorateControlMediator.prototype.addActionListener=function(){this.mView&&(this.mView.on("exit",this.onExitHandler,this),this.mView.on("recycleAll",this.onRecycleAllHandler,this),this.mView.on("redo",this.onRedoHandler,this),this.mView.on("showFurni",this.onShowFurniHandler,this),this.mView.on("save",this.onSaveHandler,this),this.mView.on("getDoor",this.onGetDoorHandler,this))},DecorateControlMediator.prototype.onExitHandler=function(){if(this.connection){var t=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_LEAVE);t.content.needSaveEditScene=!1,this.world.connection.send(t)}},DecorateControlMediator.prototype.onRecycleAllHandler=function(){if(this.connection){var t=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_RECYCLE_ALL);this.world.connection.send(t)}},DecorateControlMediator.prototype.onRedoHandler=function(){if(this.connection){var t=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_RECYCLE_LAST_SPRITE);this.connection.send(t)}},DecorateControlMediator.prototype.onShowFurniHandler=function(){var t=this.world.uiManager;t&&t.showMed("FurniBag")},DecorateControlMediator.prototype.onSaveHandler=function(){if(this.connection){var t=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_LEAVE);t.content.needSaveEditScene=!0,this.connection.send(t)}},DecorateControlMediator.prototype.onGetDoorHandler=function(){if(this.connection){var t=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_SPAWN_POINT);this.connection.send(t)}},Object.defineProperty(DecorateControlMediator.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),DecorateControlMediator.NAME="DecorateControlMediator",DecorateControlMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"DecorateControlPanel",(function(){return s}));var n,o=i(112),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function DecorateControlPanel(e,i){var n=t.call(this,e,i)||this;return n.key="decorateControl",n}return r(DecorateControlPanel,t),DecorateControlPanel.prototype.addListen=function(){this.mInitialized&&(this.mExitBtn.on("pointerup",this.onExitHandler,this),this.mRecycleAllBtn.on("pointerup",this.onRecycleAllHandler,this),this.mRedoBtn.on("pointerup",this.onRedoHandler,this),this.mFurniBtn.on("pointerup",this.onShowFurniHandler,this),this.mSaveBtn.on("pointerup",this.onSaveHandler,this),this.mDoorBtn.on("pointerup",this.onGetDoorHandler,this))},DecorateControlPanel.prototype.removeListen=function(){this.mInitialized&&(this.mExitBtn.off("pointerup",this.onExitHandler,this),this.mRecycleAllBtn.off("pointerup",this.onRecycleAllHandler,this),this.mRedoBtn.off("pointerup",this.onRedoHandler,this),this.mFurniBtn.off("pointerup",this.onShowFurniHandler,this),this.mSaveBtn.off("pointerup",this.onSaveHandler,this),this.mDoorBtn.off("pointerup",this.onGetDoorHandler,this))},DecorateControlPanel.prototype.resize=function(e,i){this.setSize(e,131*this.dpr),this.mBackground.clear(),this.mBackground.fillStyle(0,.6),this.mBackground.fillRect(0,0,this.width,this.height),t.prototype.resize.call(this,e,i)},DecorateControlPanel.prototype.preload=function(){this.addAtlas(this.key,"decorate_control/decorate_control.png","decorate_control/decorate_control.json"),t.prototype.preload.call(this)},DecorateControlPanel.prototype.init=function(){var e=this.scene.cameras.main.width,i=this.scene.cameras.main.height;this.mBackground=this.scene.make.graphics(void 0,!1),this.mTopBtns=[],this.mExitBtn=this.scene.make.image({key:this.key,frame:"exitBtn.png"},!1).setOrigin(0).setInteractive(),this.mRecycleAllBtn=this.scene.make.image({key:this.key,frame:"recycleAllBtn.png"},!1).setOrigin(0).setInteractive(),this.mRedoBtn=this.scene.make.image({key:this.key,frame:"redoBtn.png"},!1).setOrigin(0).setInteractive(),this.mFurniBtn=this.scene.make.image({key:this.key,frame:"furniBtn.png"},!1).setOrigin(0).setInteractive(),this.mSaveBtn=this.scene.make.image({key:this.key,frame:"saveBtn.png"},!1).setOrigin(0).setInteractive(),this.mDoorBtn=this.scene.make.image({x:10*this.dpr,y:83*this.dpr,key:this.key,frame:"doorBtn.png"},!1).setOrigin(0).setInteractive(),this.mStairBtn=this.scene.make.image({x:64*this.dpr,y:83*this.dpr,key:this.key,frame:"stairBtn.png"},!1).setOrigin(0),this.mTopBtns=[this.mExitBtn,this.mRecycleAllBtn,this.mRedoBtn,this.mFurniBtn,this.mSaveBtn],this.add(this.mBackground),this.add(this.mTopBtns),this.add([this.mDoorBtn,this.mStairBtn]);var n=this.mWorld.uiScale,o=e-20*this.dpr*n;this.mTopBtns.map((function(t){return o-=t.width*n}));for(var r=o/(this.mTopBtns.length-1)/n,s=0;s<this.mTopBtns.length;s++)this.mTopBtns[s].x=s>0?r+this.mTopBtns[s-1].width+this.mTopBtns[s-1].x:10*this.dpr,this.mTopBtns[s].y=11*this.dpr;this.resize(e,i),t.prototype.init.call(this)},DecorateControlPanel.prototype.onExitHandler=function(){this.emit("exit")},DecorateControlPanel.prototype.onRecycleAllHandler=function(){this.emit("recycleAll")},DecorateControlPanel.prototype.onRedoHandler=function(){this.emit("redo")},DecorateControlPanel.prototype.onShowFurniHandler=function(){this.emit("showFurni")},DecorateControlPanel.prototype.onSaveHandler=function(){this.emit("save")},DecorateControlPanel.prototype.onGetDoorHandler=function(){this.emit("getDoor")},DecorateControlPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ActivityMediator",(function(){return a}));var n,o=i(211),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function ActivityMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.mUIType=r.UIType.Scene,o.world=n,o}return s(ActivityMediator,t),ActivityMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.ActivityPanel(this.scene,this.world),this.mView.on("showPanel",this.onShowPanelHandler,this)),this.mView.show(),this.layerManager.addToUILayer(this.mView))},ActivityMediator.prototype.isSceneUI=function(){return!0},ActivityMediator.prototype.onShowPanelHandler=function(t,e){if(t&&this.world){var i=this.world.uiManager;e?i.showMed(t,e):i.showMed(t)}},ActivityMediator.NAME="ActivityMediator",ActivityMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ActivityPanel",(function(){return a}));var n,o=i(112),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function ActivityPanel(e,i){var n=t.call(this,e,i)||this;return n.key="activity",n}return s(ActivityPanel,t),ActivityPanel.prototype.resize=function(t,e){var i=this.scaleWidth;this.scaleHeight;this.content.x=i-20*this.dpr,this.content.y=.5*this.content.height+90*this.dpr,this.setSize(t,e),this.mGameScroll.refreshMask()},ActivityPanel.prototype.show=function(e){this.mInitialized&&this.setInteractive(),t.prototype.show.call(this,e),this.checkUpdateActive()},ActivityPanel.prototype.updateUIState=function(t){this.mInitialized&&("activity.taskbtn"===t.name&&(this.mGameScroll.getItemAt(3).visible=t.visible,this.mGameScroll.Sort()))},ActivityPanel.prototype.preload=function(){this.addAtlas(this.key,"activity/activity.png","activity/activity.json"),t.prototype.preload.call(this)},ActivityPanel.prototype.init=function(){var e=this,i=60*this.dpr,n=300*this.dpr;this.content=this.scene.make.container(void 0,!1),this.content.setSize(i,n);var o=this.scene.make.image({key:this.key,frame:"home_more"});this.content.add(o),o.y=.5*-n+.5*o.height,this.add(this.content),this.mGameScroll=new r.GameScroller(this.scene,{x:0,y:0,width:this.content.width,height:this.content.height-50*this.dpr,zoom:this.scale,dpr:this.dpr,align:2,orientation:0,space:10*this.dpr,selfevent:!0,cellupCallBack:function(t){e.onPointerUpHandler(t)}}),this.content.add(this.mGameScroll);for(var s=0;s<4;s++){var a="icon_"+(s+1),h=this.scene.make.image({key:this.key,frame:a});h.name=s+1+"",this.mGameScroll.addItem(h)}this.mGameScroll.Sort(),this.resize(i,n),t.prototype.init.call(this)},ActivityPanel.prototype.onClickHandler=function(t){"4"===t?this.emit("showPanel","Task"):"3"===t&&this.emit("showPanel","PicFriend")},ActivityPanel.prototype.checkUpdateActive=function(){var t=this.mWorld.uiManager.getActiveUIData("Activity");if(t)for(var e=0,i=t;e<i.length;e++){var n=i[e];this.updateUIState(n)}},ActivityPanel.prototype.onPointerUpHandler=function(t){var e=t.name;this.onClickHandler(e)},ActivityPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaChatPanel",(function(){return m}));var n,o=i(112),r=i(113),s=i(165),a=i(213),h=i(115),c=i(114),l=i(109),p=i(214),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function PicaChatPanel(e,i){var n=t.call(this,e,i)||this;return n.key="pica_chat",n.chatCatchArr=[],n.chatMaxLen=100,n.MAX_HEIGHT=460*n.dpr,n.MIN_HEIGHT=100*n.dpr,n.scale=1,n.UIType=l.UIType.Scene,n}return d(PicaChatPanel,t),PicaChatPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen(),this.checkUpdateActive()):this.preload())},PicaChatPanel.prototype.resize=function(e,i){var n=this.scale,o=this.scene.cameras.main.width,r=this.scene.cameras.main.height;e=o,i=i||133*this.dpr,this.setSize(o,i);var s=this.scene.textures.getFrame(this.key,"title_bg"),a=s?o/this.scale/s.width:1;this.mTitleBg.scaleX=a,this.mTitleBg.x=o/this.scale/2,this.y=r-this.height,this.mBackground.clear(),this.mBackground.fillStyle(0,.6),this.mBackground.fillRect(0,0,o/this.scale,i/this.scale),this.mTextArea.childrenMap.child.setMinSize(e,(i-16*this.dpr)*n),this.mTextArea.layout(),this.mTextArea.setPosition(this.width/2+4*this.dpr,this.y+this.mTextArea.height/2+10*this.dpr*n),this.mTextArea.childrenMap.text.y=8*this.dpr,this.mTextArea.scrollToBottom(),this.mNavigateBtn.x=o/this.scale-.5*this.mNavigateBtn.width-5*this.dpr,this.giftPanel&&(this.giftPanel.resize(),this.giftPanel.y=this.height-.5*this.giftPanel.height,this.giftPanel.x=.5*this.width),t.prototype.resize.call(this,e,i)},PicaChatPanel.prototype.appendChat=function(t){this.chatCatchArr.push(t),this.chatCatchArr.length>this.chatMaxLen&&this.chatCatchArr.shift(),this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom()),this.mInputText&&this.mInputText.appendChat(t)},PicaChatPanel.prototype.hide=function(){this.mShow=!1,this.removeInteractive()},PicaChatPanel.prototype.addListen=function(){this.mInitialized&&(this.mChatBtn.setInteractive(),this.mEmojiBtn.setInteractive(),this.mScrollBtn.setInteractive(),this.mNavigateBtn.setInteractive(),this.mGiftBtn.setInteractive(),this.mTextArea.childrenMap.child.setInteractive(),this.mScrollBtn.on("drag",this.onDragHandler,this),this.scene.input.setDraggable(this.mScrollBtn,!0),this.mNavigateBtn.on("pointerup",this.onShowNavigateHandler,this),this.mChatBtn.on("pointerup",this.onShowInputHanldler,this),this.mGiftBtn.on("pointerup",this.onGiftHandler,this))},PicaChatPanel.prototype.removeListen=function(){this.mInitialized&&(this.mChatBtn.disableInteractive(),this.mEmojiBtn.disableInteractive(),this.mScrollBtn.disableInteractive(),this.mNavigateBtn.disableInteractive(),this.mGiftBtn.disableInteractive(),this.mTextArea.childrenMap.child.disableInteractive(),this.mScrollBtn.off("drag",this.onDragHandler,this),this.mNavigateBtn.off("pointerup",this.onShowNavigateHandler,this),this.mChatBtn.off("pointerup",this.onShowInputHanldler,this),this.mGiftBtn.off("pointerup",this.onGiftHandler,this))},PicaChatPanel.prototype.updateUIState=function(t){this.mInitialized&&"picachat.navigatebtn"===t.name&&this.mNavigateBtn.visible!==t.visible&&(this.mNavigateBtn.visible=t.visible)},PicaChatPanel.prototype.destroy=function(){this.mBackground&&this.mBackground.disableInteractive(),t.prototype.destroy.call(this)},PicaChatPanel.prototype.preload=function(){this.addAtlas(this.key,"pica_chat/pica_chat.png","pica_chat/pica_chat.json"),this.addAtlas(h.UIAtlasKey.commonKey,h.UIAtlasName.commonUrl+".png",h.UIAtlasName.commonUrl+".json"),this.addAtlas(h.UIAtlasKey.common2Key,h.UIAtlasName.common2Url+".png",h.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicaChatPanel.prototype.init=function(){var e=this.scene.cameras.main.width;this.scene.cameras.main.height;this.mBackground=this.scene.make.graphics(void 0,!1);var i=this.scale;this.setSize(e,135*this.dpr),this.mTileContainer=this.scene.make.container(void 0,!1),this.mScrollBtn=this.scene.make.image({x:21*this.dpr*i,key:this.key,frame:"scroll_btn"},!1).setScale(i),this.mTitleBg=this.scene.make.image({key:this.key,frame:"title_bg"},!1).setScale(i),this.mChatBtn=this.scene.make.image({x:96*this.dpr*i,key:this.key,frame:"chat_icon"},!1).setScale(i),this.mHornBtn=this.scene.make.image({x:159*this.dpr*i,key:this.key,frame:"horn_icon"},!1).setScale(i),this.mEmojiBtn=this.scene.make.image({x:218*this.dpr*i,key:this.key,frame:"emoji"},!1).setScale(i),this.mGiftBtn=this.scene.make.image({x:218*this.dpr*i,key:this.key,frame:"party_gift_icon"},!1).setScale(i),this.mNavigateBtn=this.scene.make.image({x:281*this.dpr,key:this.key,frame:"more_btn"},!1).setScale(i);var n=20*this.dpr;this.mTitleBg.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.mScrollBtn.x=.5*this.mScrollBtn.width+5*this.dpr,this.mScrollBtn.y=-this.mScrollBtn.height/2+this.mTitleBg.height,this.mChatBtn.x=this.mScrollBtn.x+.5*this.mScrollBtn.width+n+.5*this.mChatBtn.width,this.mChatBtn.y=-this.mChatBtn.height/2+this.mTitleBg.height,this.mChatBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.mHornBtn.x=this.mChatBtn.x+.5*this.mChatBtn.width+n+.5*this.mHornBtn.width,this.mHornBtn.y=-this.mHornBtn.height/2+this.mTitleBg.height,this.mHornBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.mEmojiBtn.x=this.mHornBtn.x+.5*this.mHornBtn.width+n+.5*this.mEmojiBtn.width,this.mEmojiBtn.y=-this.mEmojiBtn.height/2+this.mTitleBg.height,this.mEmojiBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.mGiftBtn.x=this.mEmojiBtn.x+.5*this.mEmojiBtn.width+n+.5*this.mGiftBtn.width,this.mGiftBtn.y=-this.mGiftBtn.height/2+this.mTitleBg.height,this.mGiftBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.mNavigateBtn.y=-this.mNavigateBtn.height/2+this.mTitleBg.height,this.mNavigateBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.mOutputText=new l.BBCodeText(this.mScene,0,0,"",{fontSize:14*this.dpr/i+"px",fontFamily:r.a.DEFULT_FONT,stroke:"#000000",strokeThickness:1*this.dpr*i,textMask:!1,shadow:{offsetX:0,offsetY:0,color:"#000",blur:4,stroke:!0,fill:!0},wrap:{mode:"char",width:e-12*this.dpr*i}}),this.mOutputText.setResolution(this.dpr);var o=this.scene.make.graphics(void 0,!1);this.mTextArea=new l.TextArea(this.mScene,{x:e/2+4*this.dpr*i,y:160*this.dpr*i,textWidth:e-4*this.dpr*i,textHeight:this.MAX_HEIGHT,text:this.mOutputText}).layout(),this.mTileContainer.add([this.mTitleBg,this.mChatBtn,this.mHornBtn,this.mEmojiBtn,this.mGiftBtn,this.mScrollBtn,this.mNavigateBtn]),this.add([this.mBackground,this.mTileContainer,this.mTextArea,this.mOutputText,o]),this.mTextArea.setSliderEnable(!1),this.resize(this.width,133*this.dpr),t.prototype.init.call(this),this.removeInteractive()},PicaChatPanel.prototype.onDragHandler=function(t,e,i){var n=this.height+(t.prevPosition.y-t.position.y);n>this.MAX_HEIGHT||n<this.MIN_HEIGHT||this.resize(this.width,n)},PicaChatPanel.prototype.onShowNavigateHandler=function(){this.emit("showNavigate")},PicaChatPanel.prototype.onGiftHandler=function(){this.giftPanel&&this.giftPanel.visible?(this.giftPanel.hide(),this.showChatTextArea()):(this.hideAllChildPanel(),this.giftPanel||(this.giftPanel=new p.PicGiftPanel(this.scene,0,0,this.width,175*this.dpr,this.key,this.dpr,this.scale),this.giftPanel.y=this.height-.5*this.giftPanel.height,this.giftPanel.x=.5*this.width,this.add(this.giftPanel),this.giftPanel.resize()),this.resize(this.width,185*this.dpr),this.giftPanel.show())},PicaChatPanel.prototype.onShowInputHanldler=function(){var t=this;if(!this.mInputText){var e=window.pktGlobal;if(e&&"Cordova"===e.envPlatform)if(this.scene.cache.json.has("quickchat"))setTimeout((function(){t.openAppInputPanel()}),20);else{var i="../../resources/ui/quickchat/"+c.a.language+".json";this.scene.load.json("quickchat",i),this.scene.load.on(Phaser.Loader.Events.FILE_COMPLETE,this.openAppInputPanel,this),this.scene.load.start()}else this.mInputText=new s.InputPanel(this.scene,this.mWorld),this.mInputText.once("close",this.sendChat,this)}},PicaChatPanel.prototype.sendChat=function(t){this.mInputText=void 0,t&&this.emit("chat",t)},PicaChatPanel.prototype.openAppInputPanel=function(){if(this.scene.cache.json.has("quickchat")){this.mInputText=new a.PicChatInputPanel(this.scene,this.mWorld,this.key,this.chatCatchArr.concat()),this.mInputText.once("close",this.appCloseChat,this),this.mInputText.on("send",this.appSendChat,this);var t=this.scene.cache.json.get("quickchat");this.mInputText.setQuickChatData(t.concat()),this.parentContainer&&(this.parentContainer.visible=!1),this.scene.load.off(Phaser.Loader.Events.FILE_COMPLETE,this.openAppInputPanel,this)}},PicaChatPanel.prototype.appSendChat=function(t){t&&this.emit("chat",t)},PicaChatPanel.prototype.appCloseChat=function(){this.mInputText.off("send",this.appSendChat,this),this.mInputText=void 0,this.parentContainer&&(this.parentContainer.visible=!0)},PicaChatPanel.prototype.checkUpdateActive=function(){var t=this.mWorld.uiManager.getActiveUIData("PicaChat");if(t)for(var e=0,i=t;e<i.length;e++){var n=i[e];this.updateUIState(n)}},PicaChatPanel.prototype.hideAllChildPanel=function(){this.giftPanel&&this.giftPanel.hide(),this.mTextArea&&(this.mTextArea.visible=!1),this.mScrollBtn.disableInteractive(),this.showPanelHandler("PicHandheld",!1)},PicaChatPanel.prototype.showChatTextArea=function(){this.mTextArea.visible=!0,this.mScrollBtn.setInteractive(),this.showPanelHandler("PicHandheld",!0)},PicaChatPanel.prototype.showPanelHandler=function(t,e){if(this.mWorld){var i=this.mWorld.uiManager;e?i.showMed(t):i.hideMed(t)}},PicaChatPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicChatInputPanel",(function(){return c}));var n,o=i(114),r=i(115),s=i(113),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicChatInputPanel(e,i,n,h){var c=t.call(this)||this;c.chatArr=[],c.maxChatLength=100,c.isOpenQuickPanel=!1,c.isSendChat=!1,c.isDispose=!1,c.key=n,c.world=i,c.dpr=window.devicePixelRatio,c.scene=e,c.chatArr=h;var l=e.cameras.main.width,p=e.cameras.main.height;c.mBackground=e.add.graphics(),c.mBackground.clear(),c.mBackground.fillStyle(0,.6),c.mBackground.fillRect(0,0,l,p),c.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,l,p),Phaser.Geom.Rectangle.Contains),c.bottomCon=e.add.container(0,0),c.bottomCon.setPosition(.5*l,.5*p);var d=new a.NineSlicePatch(e,0,0,l,47*c.dpr,c.key,"chat_Input_bg",{left:2*c.dpr,top:0*c.dpr,right:2*c.dpr,bottom:0*c.dpr});c.bottomCon.setSize(l,d.height),c.bottomCon.add(d),c.sendBtn=new a.Button(c.scene,c.key,"chat_quick_2"),c.sendBtn.x=.5*-l+.5*c.sendBtn.width+12*c.dpr,c.sendBtn.on(String(a.ClickEvent.Tap),c.onQuickSendHandler,c),c.bottomCon.add(c.sendBtn),c.cancelBtn=new a.NineSliceButton(c.scene,0,0,63*c.dpr,28*c.dpr,r.UIAtlasKey.commonKey,"red_btn_normal",o.a.t("common.cancel"),c.dpr,1,{left:14*c.dpr,top:0,right:14*c.dpr,bottom:0}),c.cancelBtn.setTextStyle({color:"#ffffff",fontSize:16*c.dpr,fontFamily:s.a.DEFULT_FONT}),c.cancelBtn.x=.5*l-.5*c.cancelBtn.width-12*c.dpr,c.cancelBtn.on(String(a.ClickEvent.Tap),c.onCancelHandler,c),c.bottomCon.add(c.cancelBtn);var m=Math.abs(c.sendBtn.x-c.cancelBtn.x)-.5*c.sendBtn.width-.5*c.cancelBtn.width-16*c.dpr,u=c.sendBtn.x+.5*c.sendBtn.width+8*c.dpr+.5*m,f=new a.NineSlicePatch(c.scene,u,0,m,36*c.dpr,c.key,"chat_Input",{left:12*c.dpr,top:0*c.dpr,right:12*c.dpr,bottom:0*c.dpr});return c.bottomCon.add(f),c.mInput=new a.InputText(c.scene,u-.5*m,0,m,40*c.dpr,{type:"text",placeholder:"",color:"#0",fontSize:20*c.dpr+"px"}),c.mInput.setOrigin(0,.5),c.bottomCon.add(c.mInput),c.contentCon=e.add.container(0,0),c.contentCon.setSize(l,200*c.dpr),c.mOutputText=new a.BBCodeText(e,.5*-l+10*c.dpr,0,"",{fontSize:14*c.dpr+"px",fontFamily:s.a.DEFULT_FONT,stroke:"#000000",strokeThickness:1*c.dpr,textMask:!1,lineSpacing:2*c.dpr,shadow:{offsetX:0,offsetY:0,color:"#000",blur:4,stroke:!0,fill:!0},wrap:{mode:"char",width:l-12*c.dpr}}).setOrigin(0,.5),c.mOutputText.setResolution(c.dpr),c.gamescroll=new a.GameScroller(e,{x:0,y:0,width:l,height:c.contentCon.height,zoom:1,dpr:c.dpr,align:0,orientation:0,selfevent:!0}),c.contentCon.add(c.gamescroll),c.gamescroll.addItem(c.mOutputText),c.quickCon=c.scene.add.container(0,0),c.quickBg=c.scene.make.image({key:c.key,frame:"home_quick chat _bg"}),c.quickCon.add(c.quickBg),c.quickCon.x=.5*l,c.quickChatScroll=new a.GameScroller(e,{x:0,y:0,width:l,height:200*c.dpr,zoom:1,dpr:c.dpr,align:2,orientation:0,cellupCallBack:function(t){c.onQuickChatItemHandler(t)}}),c.quickChatScroll.removeListen(),c.quickCon.add(c.quickChatScroll),c.mInput.on("blur",c.onBlurHandler,c),c.mInput.on("focus",c.onFocusHandler,c),c.mInput.node.addEventListener("keypress",(function(t){13===(t.keyCode||t.which)&&(c.isSendChat=!0,c.onSentChat())})),window.addEventListener("native.keyboardshow",c.onKeyboardHandler.bind(c)),c.bottomCon.visible=!1,c.contentCon.visible=!1,c}return h(PicChatInputPanel,t),PicChatInputPanel.prototype.setKeywordHeight=function(t){var e=this.scene.cameras.main.height,i=this.scene.cameras.main.width,n=e-t-0;this.bottomCon.visible=!0,this.contentCon.visible=!0,this.bottomCon.y=n-.5*this.bottomCon.height,this.contentCon.height=this.bottomCon.y-.5*this.bottomCon.height-20*this.dpr,this.contentCon.y=this.bottomCon.y-.5*this.bottomCon.height-.5*this.contentCon.height-5*this.dpr,this.contentCon.x=.5*i,this.gamescroll.resetSize(i,this.contentCon.height),this.gamescroll.refreshMask();var o=200*this.dpr;this.quickCon.y=this.bottomCon.y-.5*this.bottomCon.height,this.quickBg.y=.5*-o,this.quickBg.displayWidth=i+10*this.dpr,this.quickBg.displayHeight=o,this.quickChatScroll.y=this.quickBg.y,this.quickChatScroll.resetSize(i,o),this.keyboardHeight=t,this.setQuickChatItems()},PicChatInputPanel.prototype.setQuickChatData=function(t){t&&(this.quickChatAtt=t),this.quickChatAtt.unshift(void 0),this.mInput.setFocus(),this.setKeywordHeight(0),this.onQuickSendHandler();for(var e="",i=0,n=this.chatArr;i<n.length;i++){e+=n[i]}this.mOutputText.text=e,this.gamescroll.Sort(),console.log(t)},PicChatInputPanel.prototype.appendChat=function(t){this.chatArr.push(t),this.chatArr.length>this.maxChatLength&&this.chatArr.shift();for(var e="",i=0,n=this.chatArr;i<n.length;i++){e+=n[i]}this.mOutputText.text=e,this.gamescroll.Sort()},PicChatInputPanel.prototype.onKeyboardHandler=function(t){console.log(t.keyboardHeight),this.keyboardHeight>0&&t.keyboardHeight===this.keyboardHeight||window.removeEventListener("native.keyboardshow",this.onKeyboardHandler.bind(this))},PicChatInputPanel.prototype.setQuickChatItems=function(){this.quickChatScroll.clearItems(!0);this.scene.cameras.main.height;for(var t=this.scene.cameras.main.width,e=0;e<this.quickChatAtt.length;e++){var i=this.quickChatAtt[e];if(i){var n=new l(this.scene,t,30*this.dpr,this.key,this.dpr,0===e);this.quickChatScroll.addItem(n),n.setText(i)}}this.quickChatScroll.Sort(),this.quickCon.visible=!1},PicChatInputPanel.prototype.setFirstQuickItem=function(){if(this.quickChatScroll.getItemList().length===this.quickChatAtt.length){var t=this.quickChatScroll.getItemList();t&&t.length>0&&t[0].setText(this.quickChatAtt[0])}else{var e=this.scene.cameras.main.width,i=new l(this.scene,e,40*this.dpr,this.key,this.dpr,!0);this.quickChatScroll.addItemAt(i,0),this.quickChatScroll.Sort(),i.setText(this.quickChatAtt[0])}},PicChatInputPanel.prototype.onBlurHandler=function(){this.isOpenQuickPanel||this.isSendChat||this.onCancelHandler(),this.isSendChat=!1},PicChatInputPanel.prototype.onFocusHandler=function(){this.isOpenQuickPanel&&(this.quickCon.visible=!1,this.quickChatScroll.removeListen(),this.isOpenQuickPanel=!1)},PicChatInputPanel.prototype.onQuickSendHandler=function(){this.isOpenQuickPanel=!0,this.quickCon.visible=!0,this.quickChatScroll.addListen()},PicChatInputPanel.prototype.onSentChat=function(){var t=this.mInput.text;""!==t&&(this.quickChatAtt[0]=t,this.setFirstQuickItem()),this.mInput.text="",this.mInput.setFocus(),this.sendChat(t)},PicChatInputPanel.prototype.sendChat=function(t){this.emit("send",t)},PicChatInputPanel.prototype.onQuickChatItemHandler=function(t){this.mInput.text=t.dataChat,this.mInput.setFocus(),this.quickCon.visible=!1,this.quickChatScroll.removeListen(),this.isOpenQuickPanel=!1},PicChatInputPanel.prototype.onCancelHandler=function(){this.isDispose||(this.isDispose=!0,this.mInput.setBlur(),this.mBackground.destroy(),this.mInput.destroy(),this.bottomCon.destroy(),this.contentCon.destroy(),this.quickCon.destroy(),this.gamescroll.clearItems(!0),this.scene=void 0,this.world=void 0,this.gamescroll=void 0,this.mOutputText=void 0,this.quickChatScroll=void 0,this.emit("close"),this.destroy())},PicChatInputPanel}(Phaser.Events.EventEmitter),l=function(t){function QuickChatItem(e,i,n,o,r,a){void 0===a&&(a=!1);var h,c=t.call(this,e)||this;(c.dataChat="",c.key=o,c.setSize(i,n),c.text=c.scene.make.text({x:0,y:0,text:"",style:{fontSize:13*r,fontFamily:s.a.DEFULT_FONT,color:"#6F6F6F"}}).setOrigin(0,.5),c.text.x=.5*-i+20*r,c.add(c.text),a)?((h=c.scene.make.image({key:o,frame:"home_divider"})).y=.5*n,c.add(h)):((h=c.scene.make.graphics(void 0)).clear(),h.fillStyle(7303023,.3),h.fillRect(.5*-i+20*r,-1,i,2),h.setPosition(0,.5*n),c.add(h));return c}return h(QuickChatItem,t),QuickChatItem.prototype.setText=function(t){this.text.text=t,this.dataChat=t},QuickChatItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicGiftPanel",(function(){return l}));var n,o=i(116),r=i(109),s=i(113),a=i(115),h=i(114),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicGiftPanel(e,i,n,o,r,s,a,h){var c=t.call(this,e,i,n)||this;return c.isExtendsGrid=!1,c.key=s,c.dpr=a,c.zoom=h,c.setSize(o,r),c.init(),c.setGiftDatas(),c}return c(PicGiftPanel,t),PicGiftPanel.prototype.resize=function(){this.mPropGrid&&this.mPropGrid.resetMask()},PicGiftPanel.prototype.destroy=function(){this.mPropGrid&&this.mPropGrid.destroy(),t.prototype.destroy.call(this)},PicGiftPanel.prototype.hide=function(){this.visible=!1},PicGiftPanel.prototype.show=function(){this.visible=!0},PicGiftPanel.prototype.setGiftDatas=function(){this.mPropGrid.setItems(new Array(60)),this.giftName.text="某某某礼物某某某",this.giftPriceImage.x=this.giftName.x+this.giftName.width+5*this.dpr+.5*this.giftPriceImage.width,this.giftValue.text="100",this.giftValue.x=this.giftPriceImage.x+.5*this.giftPriceImage.width+5*this.dpr,this.giftDescr.text="热度值10，赠送666个可以触发世界喇叭！"},PicGiftPanel.prototype.init=function(){var t=this,e=this.scene.make.graphics(void 0,!1);e.fillStyle(3355443,.5),e.fillRect(.5*-this.width,.5*-this.height,this.width,this.height),this.add(e);var i=this.scene.textures.getFrame(a.UIAtlasKey.common2Key,"equp_bg"),n=i.width+10*this.dpr,c=i.height+10*this.dpr,l={x:0,y:.5*-this.height+60*this.dpr,table:{width:this.width-20*this.dpr,height:120*this.dpr,columns:2,cellWidth:n,cellHeight:c,reuseCellContainer:!0,cellOriginX:.5,cellOriginY:.5,zoom:this.zoom,mask:!1},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(e,i){var n=e.scene,o=e.item;return null===i&&(i=new p(n,0,0,t.key,t.dpr)),i.setItemData(o),i}};this.mPropGrid=new r.GameGridTable(this.scene,l),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(e){t.onSelectItemHandler(e)})),this.add(this.mPropGrid),this.giftName=this.scene.make.text({x:.5*-this.width+10*this.dpr,y:this.mPropGrid.y+.5*this.mPropGrid.height+15*this.dpr,text:"",style:{fontSize:16*this.dpr,bold:!0,fontFamily:s.a.DEFULT_FONT,color:"#FFD248"}}).setOrigin(0,.5),this.add(this.giftName),this.giftPriceImage=new o.DynamicImage(this.scene,0,this.giftName.y),this.giftPriceImage.setTexture(a.UIAtlasKey.commonKey,"iv_coin"),this.add(this.giftPriceImage),this.giftValue=this.scene.make.text({x:0,y:this.giftName.y,text:"",style:{fontSize:16*this.dpr,bold:!0,fontFamily:s.a.DEFULT_FONT,color:"#FFD248"}}).setOrigin(0,.5),this.add(this.giftValue),this.sendButton=new r.NineSliceButton(this.scene,0,0,95*this.dpr,36*this.dpr,a.UIAtlasKey.commonKey,"yellow_btn_normal_s",h.a.t("chat.givegift"),this.dpr,this.scale,{left:8*this.dpr,top:8*this.dpr,right:8*this.dpr,bottom:10*this.dpr}),this.add(this.sendButton),this.sendButton.setTextStyle({fontSize:16*this.dpr,color:"#996600"}),this.sendButton.setPosition(.5*this.width-.5*this.sendButton.width-10*this.dpr,.5*this.height-.5*this.sendButton.height-10*this.dpr),this.sendButton.on(String(r.ClickEvent.Tap),this.onSendHandler,this),this.giftDescr=this.scene.make.text({x:this.giftName.x,y:this.giftName.y+.5*this.giftName.height+15*this.dpr,text:"",style:{fontSize:14*this.dpr,bold:!0,fontFamily:s.a.DEFULT_FONT,color:"#999999"}}).setOrigin(0,.5),this.add(this.giftDescr)},PicGiftPanel.prototype.onSelectItemHandler=function(t){var e=t.itemData;e&&(this.curHandheldItem&&(this.curHandheldItem.isSelect=!1),t.isSelect=!0,this.curHandheldItem=t,t.isEmptyHanded?this.emit("clearhandheld"):this.emit("changehandheld",e.id))},PicGiftPanel.prototype.onSendHandler=function(){},PicGiftPanel}(Phaser.GameObjects.Container),p=function(t){function PicGiftItem(e,i,n,r,s){var h=t.call(this,e,i,n)||this;return h.mIsSelect=!1,h.dpr=s,h.key=r,h.bg=h.scene.make.image({key:a.UIAtlasKey.common2Key,frame:"equp_bg"}),h.selectbg=h.scene.make.image({key:a.UIAtlasKey.common2Key,frame:"selected_icon_bg"}),h.icon=new o.DynamicImage(e,0,0),h.add([h.bg,h.selectbg,h.icon]),h.setSize(h.selectbg.width,h.selectbg.height),h.isSelect=!1,h}return c(PicGiftItem,t),PicGiftItem.prototype.setItemData=function(t){},Object.defineProperty(PicGiftItem.prototype,"isSelect",{get:function(){return this.mIsSelect},set:function(t){this.mIsSelect=t,this.selectbg.visible=t},enumerable:!1,configurable:!0}),Object.defineProperty(PicGiftItem.prototype,"isEmptyHanded",{get:function(){return!(!this.itemData||"empty_handed"!==this.itemData.id)},enumerable:!1,configurable:!0}),PicGiftItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaChat",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicaChat(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicaChat,t),PicaChat.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,this.handleCharacterChat))},PicaChat.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicaChat.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicaChat.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicaChat.prototype.sendMessage=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_GATEWAY_REQ_VIRTUAL_WORLD_CHAT),i=e.content;i.chatChannel=0,i.chatContext=t,this.connection.send(e)},PicaChat.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},PicaChat.prototype.handleCharacterChat=function(t){this.mEvent.emit("chat",t.content)},Object.defineProperty(PicaChat.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicaChat}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineCarMediator",(function(){return c}));var n,o=i(217),r=i(218),s=i(2),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function MineCarMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,o}return h(MineCarMediator,t),MineCarMediator.prototype.show=function(e){this.mShow||(t.prototype.show.call(this,e),this.mView||(this.mView=new o.MineCarPanel(this.scene,this.world),this.mView.on("querypackage",this.onQueryPackage,this),this.mView.on("querycategory",this.onQueryCategoryHandler,this)),this.mMineCar||(this.mMineCar=new r.MineCar(this.world),this.mMineCar.register(),this.mMineCar.on("packageCategory",this.onPackageCategoryHandler,this)),this.mView.show(e),this.mView.on("close",this.onCloseHandler,this),this.mView.on("discard",this.onDiscardHandler,this),this.layerManager.addToUILayer(this.mView)),this.addLisenter()},MineCarMediator.prototype.destroy=function(){this.mShow=!1,this.mMineCar&&(this.mMineCar.off("packageCategory",this.onPackageCategoryHandler,this),this.mMineCar.unregister(),this.mMineCar.destroy(),this.mMineCar=null),t.prototype.destroy.call(this),this.removeLisenter()},Object.defineProperty(MineCarMediator.prototype,"playerData",{get:function(){var t=this.bag;return t?t.playerData:null},enumerable:!1,configurable:!0}),Object.defineProperty(MineCarMediator.prototype,"bag",{get:function(){var t=this.world.user;if(t&&t.bag)return t.bag},enumerable:!1,configurable:!0}),MineCarMediator.prototype.addLisenter=function(){if(this.bag){var t=this.bag;t&&(t.on("syncfinish",this.onSyncFinishHandler,this),t.on("update",this.onUpdateHandler,this))}},MineCarMediator.prototype.removeLisenter=function(){if(this.bag){var t=this.bag;t&&(t.off("syncfinish",this.onSyncFinishHandler,this),t.off("update",this.onUpdateHandler,this))}},MineCarMediator.prototype.onSyncFinishHandler=function(){this.mView&&this.mView.queryRefreshPackage()},MineCarMediator.prototype.onUpdateHandler=function(){this.mView&&this.mView.queryRefreshPackage()},MineCarMediator.prototype.onPackageCategoryHandler=function(t){this.mView&&this.mView.setCategoriesData(t)},MineCarMediator.prototype.onQueryCategoryHandler=function(){this.mMineCar.getCategories(s.op_pkt_def.PKT_PackageType.MinePackage)},MineCarMediator.prototype.onQueryPackage=function(t,e){if(this.playerData){var i=this.playerData.mineBag,n=this.playerData.getItemsByCategory(t,e);this.mView.setProp(n,i.limit)}},MineCarMediator.prototype.onDiscardHandler=function(t){this.mMineCar&&this.mMineCar.discard(t)},MineCarMediator.prototype.onCloseHandler=function(){this.mView&&(this.mView.hide(),this.mView=void 0),this.mShow=!1},MineCarMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineCarPanel",(function(){return u}));var n,o,r=i(113),s=i(116),a=i(112),h=i(2),c=i(111),l=i(135),p=i(114),d=i(109),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function MineCarPanel(e,i){var n=t.call(this,e,i)||this;return n.key="mine_car",n.mFilterItem=[],n.disInteractive(),n}return m(MineCarPanel,t),MineCarPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,e,i),this.setSize(n,o),this.mBackGround.clear(),this.mBackGround.fillStyle(7004927,0),this.mBackGround.fillRect(0,0,n,o),this.mBg.x=n/2,this.mBg.y=this.mBg.displayHeight/2+107*this.dpr,this.carIcon.x=this.mBg.x/2-4*this.dpr,this.carIcon.y=this.mBg.y-(this.mBg.displayHeight-this.carIcon.displayHeight)/2+4*this.dpr,this.mCloseBtn.x=this.mBg.x+this.mBg.displayWidth/2,this.mCloseBtn.y=this.mBg.y-(this.mBg.displayHeight-this.mCloseBtn.displayHeight)/2+10*this.dpr,this.mCounter.x=this.mBg.x/2,this.mCounter.y=this.mBg.y+(this.mBg.displayHeight-this.mDiscardBtn.displayHeight)/2-16*this.dpr,this.mCounter.setResolution(this.dpr),this.mTips.x=this.mBg.x+20*this.dpr,this.mTips.y=this.mBg.y-this.mBg.displayHeight/2-15*this.dpr,this.mDiscardBtn.x=this.mBg.x+this.mBg.displayWidth/2-this.mDiscardBtn.displayWidth/2-9*this.dpr,this.mDiscardBtn.y=this.mBg.y+this.mBg.displayHeight/2-this.mDiscardBtn.displayHeight/2-9*this.dpr,this.categoriesBg.x=this.mBg.x,this.categoriesBg.y=this.mBg.y-this.mBg.displayHeight/2+this.categoriesBg.displayHeight/2+38*this.dpr,this.mPropGrid.refreshPos(this.mBg.x+2*this.dpr,this.mBg.y+6*this.dpr),this.mCategoryTable.refreshPos(this.mBg.x,this.mBg.y-this.mBg.displayHeight/2+this.categoriesBg.displayHeight/2+44*this.dpr),this.mPropGrid.resetMask(),this.mCategoryTable.resetMask()},MineCarPanel.prototype.show=function(e){t.prototype.show.call(this,e)},MineCarPanel.prototype.setCategories=function(t){this.mPreSelectedCategorie=void 0,this.mPreSelectedCategorieData=void 0,this.mCategoryTable.setItems(t)},MineCarPanel.prototype.setCategoriesData=function(t){this.mDiscardBtn.changeState(o.Discard),this.setCategories(t)},MineCarPanel.prototype.addListen=function(){this.mInitialized&&(this.removeListen(),this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.mDiscardBtn.on(d.ClickEvent.Tap,this.enterDiscardMode,this))},MineCarPanel.prototype.removeListen=function(){this.mInitialized&&(this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.mDiscardBtn.off(d.ClickEvent.Tap,this.enterDiscardMode,this))},MineCarPanel.prototype.setProp=function(t,e){var i=t||[];this.mLimit=e||0,this.mFilterItem.length=0;for(var n=0,o=i;n<o.length;n++){var r=o[n];this.mFilterItem.push({item:r})}for(var s=this.mLimit-this.mFilterItem.length,a=0;a<s;a++)this.mFilterItem.push({item:null});this.mPropGrid.setItems(this.mFilterItem),this.mCounter.setText(i.length+"/"+this.mLimit)},MineCarPanel.prototype.destroy=function(){this.mPropGrid&&this.mPropGrid.destroy(),this.mCategoryTable&&this.mCategoryTable.destroy(),t.prototype.destroy.call(this)},MineCarPanel.prototype.queryRefreshPackage=function(){this.mPreSelectedCategorieData&&this.emit("querypackage",h.op_pkt_def.PKT_PackageType.MinePackage,this.mPreSelectedCategorieData.key)},MineCarPanel.prototype.preload=function(){this.addAtlas(this.key,"mine_car/mine_car.png","mine_car/mine_car.json"),t.prototype.preload.call(this)},MineCarPanel.prototype.init=function(){var e=this,i=this.scaleWidth,n=this.scaleHeight;this.setSize(i,n),this.mBackGround=this.scene.make.graphics(void 0,!1),this.mBackGround.clear(),this.mBackGround.fillStyle(7004927,0),this.mBackGround.fillRect(0,0,i,n),this.mBackGround.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.mBg=this.scene.make.image({key:this.key,frame:"bg.png"}),this.mBg.x=i/2,this.mBg.y=n/2,this.carIcon=this.scene.make.image({key:this.key,frame:"car_icon.png"},!1),this.carIcon.x=-(this.mBg.width-this.carIcon.width)/2+28*this.dpr,this.carIcon.y=-(this.mBg.height-this.carIcon.height/2)/2+10*this.dpr,this.mCloseBtn=this.scene.make.image({key:this.key,frame:"close_btn.png"},!1),this.mCloseBtn.setInteractive(),this.mCloseBtn.x=this.mBg.width/2,this.mCloseBtn.y=-(this.mBg.height-this.mCloseBtn.height)/2+10*this.dpr,this.mCloseBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.mCounter=this.scene.make.text({text:"25/50",style:{fontFamily:r.a.DEFULT_FONT,color:"#FFFFFF",fontSize:12*this.dpr}},!1),this.mCounter.x=-this.displayWidth/2+17*this.dpr,this.mCounter.y=this.displayHeight/2-18*this.dpr-this.mCounter.height,this.mCounter.setFontStyle("bold"),this.mTips=new y(this.scene,this.key,this.dpr),this.mTips.x=40*this.dpr,this.mTips.y=-(this.mBg.height+this.mTips.height)/2+15*this.dpr,this.mDiscardBtn=new g(this.scene,this.key,"yellow_btn.png",void 0,"丢弃"),this.mDiscardBtn.x=(this.mBg.width-this.mDiscardBtn.displayWidth)/2-17*this.dpr,this.mDiscardBtn.y=(this.mBg.height-this.mDiscardBtn.displayHeight)/2-10*this.dpr,this.mDiscardBtn.setTextStyle({color:"##996600",fontFamily:r.a.DEFULT_FONT,fontSize:10*this.dpr}),this.mDiscardBtn.changeState(o.Discard),this.categoriesBg=this.scene.make.image({key:this.key,frame:"nav_bg.png"}),this.categoriesBg.y=-(this.displayHeight-this.categoriesBg.displayHeight)/2+36*this.dpr;var s=this.scene.textures.getFrame(this.key,"item_border.png"),a=s.width+4*this.dpr,h=s.height+4*this.dpr,c=236*this.dpr,l={x:-7*this.dpr,y:-16*this.dpr,table:{width:c,height:295*this.dpr,columns:4,cellsCount:25,cellWidth:a,cellHeight:h,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0,zoom:this.scale},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new f(n,e.key,e.dpr)),i.setData({item:o}),i.setProp(o),i}};this.mPropGrid=new d.GameGridTable(this.scene,l),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){e.onSelectItemHandler(t)}));var p=this.scene.textures.getFrame(this.key,"nav_btn_normal.png"),m={x:-9*this.dpr,y:-155*this.dpr,table:{width:c,height:this.categoriesBg.displayHeight,cellWidth:p.width+4*this.dpr,cellHeight:p.height,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0,zoom:this.scale},scrollMode:1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&((i=new _(n,e.key,"nav_btn_normal.png","nav_btn_down.png","1")).setTextStyle({color:"#566ddb",fontFamily:r.a.DEFULT_FONT,fontSize:10*e.dpr}),i.setFontStyle("bold")),i.setText(o.value),i.setData("data",o),e.mPreSelectedCategorieData===o?(i.changeDown(),e.mPreSelectedCategorie=i):i.changeNormal(),e.mPreSelectedCategorie||e.onClickCategoryHandler(i),i}};this.mCategoryTable=new d.GameGridTable(this.scene,m),this.mCategoryTable.layout(),this.mCategoryTable.on("cellTap",(function(t){e.onClickCategoryHandler(t)})),this.add([this.mBackGround,this.mBg,this.carIcon,this.mCounter,this.categoriesBg,this.mPropGrid,this.mCategoryTable,this.mCloseBtn,this.mDiscardBtn]),this.resize(this.scene.cameras.main.width,this.scene.cameras.main.height),t.prototype.init.call(this),this.emit("querycategory")},MineCarPanel.prototype.onCloseHandler=function(){this.emit("close")},MineCarPanel.prototype.onSelectItemHandler=function(t){if(this.mDiscardBtn&&this.mDiscardBtn.buttonState!==o.Discard)return t.switchSelect(),void this.checkMode();t&&t.item.item?(this.mTips.parentContainer||this.add(this.mTips),this.mTips.setItem(t.item.item)):this.remove(this.mTips)},MineCarPanel.prototype.onClickCategoryHandler=function(t){var e=t.getData("data");e&&(this.emit("querypackage",h.op_pkt_def.PKT_PackageType.MinePackage,e.key),this.mPreSelectedCategorie&&this.mPreSelectedCategorie.changeNormal(),t.changeDown(),this.mPreSelectedCategorie=t,this.mPreSelectedCategorieData=e)},MineCarPanel.prototype.checkMode=function(){if(this.mFilterItem&&!(this.mFilterItem.length<1)){for(var t=0,e=this.mFilterItem;t<e.length;t++){if(e[t].selected)return void this.mDiscardBtn.changeState(o.Sutmit)}this.mDiscardBtn.changeState(o.Cancel)}},MineCarPanel.prototype.onDiscardSelectedItem=function(){var t=this;if(this.mFilterItem&&!(this.mFilterItem.length<1)){for(var e=[],i=[],n=0,o=this.mFilterItem;n<o.length;n++){var r=o[n];r.item&&r.selected&&(e.push(r.item),i.push(r.item.name+"*"+r.item.count))}new l.AlertView(this.scene,this.mWorld).show({text:p.a.t("minecar.confirmation",{name:""+i.join("、")}),title:p.a.t("minecar.discard"),oy:302*this.dpr*this.mWorld.uiScale,callback:function(){t.emit("discard",e)}})}},MineCarPanel.prototype.enterDiscardMode=function(){if(this.mFilterItem){var t=this.mDiscardBtn.buttonState,e=!1;t===o.Discard?(this.mDiscardBtn.changeState(o.Cancel),e=!0):(t===o.Sutmit&&this.onDiscardSelectedItem(),this.mDiscardBtn.changeState(o.Discard)),this.mFilterItem.length>0&&this.mFilterItem[0].selectVisible!==e&&(this.mFilterItem.map((function(t){t.selectVisible=e,t.selected=!1})),this.mPropGrid.setItems(this.mFilterItem))}},MineCarPanel}(a.BasePanel),f=function(t){function PackageItem(e,i,n){var o=t.call(this,e)||this,a=o.scene.make.image({key:i,frame:"item_border.png"},!1).setOrigin(0);return o.setSize(a.width,a.height),o.mItemImage=new s.DynamicImage(o.scene,0,0),o.mItemImage.setOrigin(0),o.mItemImage.setScale(n),o.mCounter=o.scene.make.text({x:a.displayWidth-2*n,y:a.displayHeight-1*n,style:{fontFamily:r.a.DEFULT_FONT,fontSize:9*n,color:"#566DDB"}}).setOrigin(1),o.mCounter.setFontStyle("bold"),o.mSelectedIcon=o.scene.make.image({key:i,frame:"icon_normal.png"},!1),o.mSelectedIcon.x=a.width-2*n-o.mSelectedIcon.width/2,o.mSelectedIcon.y=2*n+o.mSelectedIcon.height/2,o.add(a),o.add([o.mItemImage,o.mCounter,o.mSelectedIcon]),o}return m(PackageItem,t),PackageItem.prototype.setProp=function(t){this.itemData=t;var e=t.item;if(!t||!e)return this.mItemImage.visible=!1,this.mCounter.visible=!1,void(this.mSelectedIcon.visible=!1);this.itemData&&(this.mItemImage.load(c.i.getOsdRes(e.display.texturePath),this,this.onLoadCompleteHandler),this.mItemImage.visible=!0,e.count>1?(this.mCounter.setText(e.count.toString()),this.mCounter.visible=!0):this.mCounter.visible=!1,this.mSelectedIcon.visible=!!this.itemData.selectVisible,this.setSelected())},PackageItem.prototype.switchSelect=function(){this.itemData.item&&(this.itemData.selected=!this.itemData.selected,this.setSelected())},Object.defineProperty(PackageItem.prototype,"item",{get:function(){return this.itemData},enumerable:!1,configurable:!0}),PackageItem.prototype.onLoadCompleteHandler=function(){this.mItemImage&&(this.mItemImage.x=this.width-this.mItemImage.displayWidth>>1,this.mItemImage.y=this.height-this.mItemImage.displayHeight>>1)},PackageItem.prototype.setSelected=function(){this.itemData.selected?this.mSelectedIcon.setFrame("icon_selected.png"):this.mSelectedIcon.setFrame("icon_normal.png")},PackageItem}(Phaser.GameObjects.Container),y=function(t){function Tips(e,i,n){var o=t.call(this,e)||this;o.mDpr=n;var s=o.scene.make.image({key:i,frame:"tips_bg.png"},!1);return o.mName=o.scene.make.text({x:-s.width/2+12*n,y:-s.height/2+5*n,style:{fontFamily:r.a.DEFULT_FONT,fontSize:10*n,color:"#000000"}},!1),o.mDes=o.scene.make.text({x:o.mName.x,style:{fontFamily:r.a.DEFULT_FONT,fontSize:10*n,color:"#000000"}},!1).setOrigin(0,1),o.add([s,o.mName,o.mDes]),o.setSize(s.width,s.height),o}return m(Tips,t),Tips.prototype.setItem=function(t){if(t){var e=this.y,i=this.alpha;this.y=e+50*this.mDpr,this.alpha=0,this.scene.tweens.add({targets:this,props:{alpha:i,y:e},duration:200,ease:Phaser.Math.Easing.Elastic.Out}),this.mName.setText(t.shortName||t.name),this.mDes.setText(t.des)}},Tips}(Phaser.GameObjects.Container),g=function(t){function DiscardButton(e,i,n,o,r){return t.call(this,e,i,n,o,r)||this}return m(DiscardButton,t),DiscardButton.prototype.changeState=function(t){if(this.mState!==t)switch(this.mState=t,t){case o.Cancel:this.setText("取消"),this.setFrame("gray_btn.png");break;case o.Sutmit:this.setText("提交"),this.setFrame("yellow_btn.png");break;default:this.setText("丢弃"),this.setFrame("yellow_btn.png")}},Object.defineProperty(DiscardButton.prototype,"buttonState",{get:function(){return this.mState},enumerable:!1,configurable:!0}),DiscardButton}(d.Button);!function(t){t[t.Discard=0]="Discard",t[t.Cancel=1]="Cancel",t[t.Sutmit=2]="Sutmit"}(o||(o={}));var _=function(t){function CategorieButton(e,i,n,o,r){var s=t.call(this,e,i,n,o,r)||this;return s.disInteractive(),s.removeListen(),s.mBackground.setOrigin(0,0),s.mText&&s.mText.setPosition(s.mBackground.width/2,s.mBackground.height/2),s}return m(CategorieButton,t),CategorieButton}(d.TabButton)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineCar",(function(){return h}));var n,o=i(110),r=i(2),s=i(114),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function MineCar(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return a(MineCar,t),MineCar.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_GET_PACKAGE_CATEGORIES,this.onPackageCategoriesHandler))},MineCar.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},MineCar.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},MineCar.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},MineCar.prototype.discard=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MINING_MODE_DELETE_MINEPACKAGE_ITEM);e.content.items=t,this.connection.send(e)},MineCar.prototype.getCategories=function(t){if(this.subcategory)this.mEvent.emit("packageCategory",this.subcategory);else{var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_PACKAGE_CATEGORIES);e.content.category=t,this.connection.send(e)}},MineCar.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},MineCar.prototype.onPackageCategoriesHandler=function(t){var e=t.content;if(e.category===r.op_pkt_def.PKT_PackageType.MinePackage){var i=new r.op_def.StrPair;i.key="alltype",i.value=s.a.t("common.all"),e.subcategory.unshift(i),this.subcategory=e.subcategory,this.mEvent.emit("packageCategory",this.subcategory)}},Object.defineProperty(MineCar.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),MineCar}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ReAwardTipsMediator",(function(){return h}));var n,o=i(220),r=i(221),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ReAwardTipsMediator(e,i){var n=t.call(this)||this;return n.scene=e,n.world=i,n.mReAwardTips=new o.ReAwardTips(i),n.mReAwardTips.register(),n.mReAwardTips.on("showAward",n.onShowAwardHandler,n),n}return a(ReAwardTipsMediator,t),ReAwardTipsMediator.prototype.show=function(e){this.mView?this.mView.appendAward(e):(this.mView=new r.ReAwardTipsPanel(this.scene,this.world),this.mView.appendAward(e),t.prototype.show.call(this),this.world.uiManager.getUILayerManager().addToDialogLayer(this.mView))},ReAwardTipsMediator.prototype.destroy=function(){this.mReAwardTips&&this.mReAwardTips.destroy(),t.prototype.destroy.call(this)},ReAwardTipsMediator.prototype.onShowAwardHandler=function(t){this.show(t)},ReAwardTipsMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ReAwardTips",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function ReAwardTips(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(ReAwardTips,t),ReAwardTips.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},ReAwardTips.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},ReAwardTips.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SHOW_REWARD_TIPS,this.onReAwardTipsHandler))},ReAwardTips.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},ReAwardTips.prototype.destroy=function(){this.unregister()},Object.defineProperty(ReAwardTips.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),ReAwardTips.prototype.onReAwardTipsHandler=function(t){this.mEvent.emit("showAward",t.content)},ReAwardTips}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ReAwardTipsPanel",(function(){return c}));var n,o=i(112),r=i(116),s=i(113),a=i(111),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function ReAwardTipsPanel(e,i){var n=t.call(this,e,i)||this;return n.key="reaward_tips",n.mTips=[],n.showingList=[],n}return h(ReAwardTipsPanel,t),ReAwardTipsPanel.prototype.show=function(){t.prototype.show.call(this),this.mInitialized&&0===this.showingList.length&&this.showAward()},ReAwardTipsPanel.prototype.appendAward=function(t){this.mTips.push(t),this.show()},ReAwardTipsPanel.prototype.addAward=function(){},ReAwardTipsPanel.prototype.preload=function(){this.addImage(this.key,"reaward_tips/bg.png"),t.prototype.preload.call(this)},ReAwardTipsPanel.prototype.init=function(){this.setSize(20,20),t.prototype.init.call(this),this.y=250*this.dpr},ReAwardTipsPanel.prototype.showAward=function(){if(!(this.mTips.length<1||this.showingList.length>=3)){for(var t=0,e=this.showingList;t<e.length;t++){e[t].beUp()}var i=new l(this.scene,this.key,this.dpr,this.scale);i.once("destroy",this.onDestroyHanlder,this),i.once("show",this.onAwardItemShowHandler,this),i.setProp(this.mTips.pop()),this.add(i),this.showingList.push(i)}},ReAwardTipsPanel.prototype.onAwardItemShowHandler=function(){this.showAward()},ReAwardTipsPanel.prototype.onDestroyHanlder=function(t){var e=this.showingList.indexOf(t);e>-1&&this.showingList.splice(e,1),this.showAward()},ReAwardTipsPanel}(o.BasePanel),l=function(t){function AwardItem(e,i,n,o){var a=t.call(this,e)||this;return a.mBg=a.scene.make.image({key:i},!1),a.mScaleRatio=n*o,a.mImage=new r.DynamicImage(a.scene,0,0),a.mImage.setScale(n),a.mImage.setOrigin(.5,1),a.mImage.y=a.mBg.height*o/2,a.mLabel=a.scene.make.text({x:a.mBg.width*a.originX-6*a.mScaleRatio,style:{fontFamily:s.a.DEFULT_FONT,fontSize:11*a.mScaleRatio,color:"#00FF00"}},!1).setOrigin(1,.5),a.addAt(a.mBg,0),a.add([a.mImage,a.mLabel]),a.setSize(a.mBg.width*o,a.mBg.height*o),a}return h(AwardItem,t),AwardItem.prototype.setProp=function(t){t&&(t.display&&t.display.texturePath&&this.mImage.load(a.i.getOsdRes(t.display.texturePath)),this.mLabel.setText(t.text),this.showTween())},AwardItem.prototype.showTween=function(){var t=this;this.scene.tweens.add({targets:this,props:{x:"+="+.3*this.width},ease:"Bounce.easeOut",onComplete:function(){t.emit("show"),t.closeDelay=setTimeout((function(){t.closeTween()}),1e3)},duration:300})},AwardItem.prototype.closeTween=function(){var t=this;this.scene&&this.scene.tweens.add({targets:this,props:{y:"-="+50*this.mScaleRatio,alpha:"0"},ease:"Linear",duration:300,onComplete:function(){t.destroy()}})},AwardItem.prototype.beUp=function(){var t=this;clearTimeout(this.closeDelay),this.scene.tweens.add({targets:this,props:{y:"-="+50*this.mScaleRatio},ease:"Linear",duration:300,onComplete:function(){t.closeDelay=setTimeout((function(){t.closeTween()}),1e3)}})},AwardItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"ComposeMediator",(function(){return c}));var n,o=i(223),r=i(2),s=i(224),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function ComposeMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o.compose||(o.compose=new s.Compose(o.world),o.compose.on("formulaDetial",o.onRetFormulaDetial,o),o.compose.on("showopen",o.onShowPanel,o),o.compose.register()),o}return h(ComposeMediator,t),ComposeMediator.prototype.show=function(){this.mView&&this.mView.isShow()||(this.mView||(this.mView=new o.ComposePanel(this.scene,this.world),this.mView.on("hide",this.onHideView,this),this.mView.on("reqformula",this.onReqFormulaDetial,this),this.mView.on("reqUseFormula",this.onReqUseFormula,this)),this.layerMgr.addToUILayer(this.mView),this.mView.show(this.mParam[0]),this.addLisenter())},ComposeMediator.prototype.destroy=function(){this.compose&&this.compose.destroy(),this.compose=void 0,t.prototype.destroy.call(this),this.removeLisenter()},ComposeMediator.prototype.addLisenter=function(){if(this.world.user&&this.world.user.bag){var t=this.world.user.bag;t&&(t.on("syncfinish",this.onSyncFinishHandler,this),t.on("update",this.onUpdateHandler,this))}},ComposeMediator.prototype.removeLisenter=function(){if(this.world.user&&this.world.user.bag){var t=this.world.user.bag;t&&(t.off("syncfinish",this.onSyncFinishHandler,this),t.off("update",this.onUpdateHandler,this))}},ComposeMediator.prototype.onSyncFinishHandler=function(){if(this.mView){var t=this.mParam[0].skills;this.updateSkills(t),this.mView.setComposeData(t)}},ComposeMediator.prototype.onUpdateHandler=function(){if(this.mView){var t=this.mParam[0].skills;this.updateSkills(t),this.mView.setComposeData(t)}},Object.defineProperty(ComposeMediator.prototype,"playerData",{get:function(){return this.bag?this.bag.playerData:null},enumerable:!1,configurable:!0}),ComposeMediator.prototype.onReqFormulaDetial=function(t){this.compose.onReqFormulaDetail(t)},ComposeMediator.prototype.onReqUseFormula=function(t){this.compose.onReqUseFormula(t)},ComposeMediator.prototype.onRetFormulaDetial=function(t){this.mView.setComposeDetialData(t)},ComposeMediator.prototype.onHideView=function(){t.prototype.destroy.call(this)},ComposeMediator.prototype.onShowPanel=function(t){var e=t.skills;this.updateSkills(e),this.setParam([t]),this.show()},ComposeMediator.prototype.updateSkills=function(t){if(this.playerData)for(var e=0,i=t;e<i.length;e++){var n=i[e];n.skill.qualified=this.isQualified(n)}},ComposeMediator.prototype.isQualified=function(t){if(this.playerData){var e=!0,i=t.materials;if(i)for(var n=0,o=i;n<o.length;n++){var s=o[n],a=this.playerData.getItemsCount(r.op_pkt_def.PKT_PackageType.PropPackage,s.id,s.subcategory);s.count=a,a<s.neededCount&&(e=!1)}return e}return!1},Object.defineProperty(ComposeMediator.prototype,"bag",{get:function(){var t=this.world.user;if(t&&t.bag)return t.bag},enumerable:!1,configurable:!0}),ComposeMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ComposePanel",(function(){return y}));var n,o=i(113),r=i(2),s=i(112),a=i(117),h=i(111),c=i(130),l=i(116),p=i(115),d=i(114),m=i(120),u=i(109),f=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),y=function(t){function ComposePanel(e,i){var n=t.call(this,e,i)||this;return n.key="compose",n.world=i,n}return f(ComposePanel,t),ComposePanel.prototype.resize=function(e,i){t.prototype.resize.call(this,e,i),this.content.x=.5*e,this.content.y=.5*i,this.mGrideTable.resetMask(),this.materialGameScroll.refreshMask(),this.setSize(e,i)},ComposePanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},ComposePanel.prototype.addListen=function(){this.mInitialized&&(this.scene.input.on("pointerup",this.onInputPointUp,this),this.makeBtn.on(String(u.ClickEvent.Tap),this.onMakeHandler,this))},ComposePanel.prototype.removeListen=function(){this.mInitialized&&(this.scene.input.off("pointerup",this.onInputPointUp,this),this.makeBtn.off(String(u.ClickEvent.Tap),this.onMakeHandler,this))},ComposePanel.prototype.preload=function(){this.addAtlas(this.key,"compose/compose.png","compose/compose.json"),this.addAtlas(p.UIAtlasKey.commonKey,p.UIAtlasName.commonUrl+".png",p.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},ComposePanel.prototype.init=function(){var e=this,i=this.scaleWidth,n=this.scaleHeight;this.content=this.scene.make.container(void 0,!1),this.content.setSize(i,n),this.add(this.content);var r=this.scene.make.graphics(void 0,!1);r.clear(),r.fillGradientStyle(7365356,7365356,13408757,13408757),r.fillRect(.5*-i,.5*-n,i,n);var s=this.scene.make.image({key:this.key,frame:"main_bg"});s.y=.5*-n+.5*s.height,s.setInteractive(new Phaser.Geom.Rectangle(0,0,this.cameraWidth,this.cameraHeight),Phaser.Geom.Rectangle.Contains),s.displayWidth=i,this.content.add([r,s]);var h="bold "+17*this.dpr+"px Source Han Sans",l=this.scene.make.image({key:this.key,frame:"title_bg"});l.y=.5*-n+23*this.dpr;var m=this.scene.make.text({x:0,y:l.y,text:d.a.t("compose.title"),style:{font:h,bold:!0,color:"#8B5603",fontSize:15*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5);this.content.add([l,m]);var f=new u.Button(this.scene,p.UIAtlasKey.commonKey,"back_arrow","back_arrow");f.setPosition(.5*-i+20*this.dpr,.5*-n+30*this.dpr),f.on(u.ClickEvent.Tap,this.onBackHandler,this),this.content.add(f),this.mDetailDisplay=new c.DetailDisplay(this.scene,!0),this.mDetailDisplay.y=-140*this.dpr,this.mDetailDisplay.setSize(126*this.dpr,126*this.dpr),this.content.add(this.mDetailDisplay),this.mDetailBubble=new g(this.scene,this.dpr),this.mDetailBubble.x=.5*-i,this.mDetailBubble.y=.5*n-360*this.dpr,this.content.add(this.mDetailBubble),this.makeBtn=new u.NineSliceButton(this.scene,Math.ceil(.5*i-60*this.dpr),Math.ceil(.5*n-310*this.dpr),106*this.dpr,40*this.dpr,p.UIAtlasKey.commonKey,"yellow_btn",d.a.t("compose.make"),this.dpr,1,{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr}),this.makeBtn.setTextStyle({fontSize:16*this.dpr,color:"#996600"}),this.content.add(this.makeBtn);var y=360*this.dpr,P=92*this.dpr;this.materialCon=this.scene.make.container(void 0,!1).setSize(y,P),this.content.add(this.materialCon),this.materialCon.setPosition(0,.5*n-230*this.dpr);var v=this.scene.make.image({x:0,y:0,key:this.key,frame:"sourcelist_bg"});v.displayWidth=i;var w=this.scene.make.text({x:0,y:.5*-P+12*this.dpr,text:d.a.t("compose.needMaterials"),style:{color:"#ffffff",fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:90*this.dpr,useAdvancedWrap:!0}}},!1).setOrigin(.5),S=this.scene.make.image({x:-10*this.dpr,y:w.y,key:this.key,frame:"sourcelist_title_1"}),b=this.scene.make.image({x:10*this.dpr,y:w.y,key:this.key,frame:"sourcelist_title_1"}),C=.5*-w.width-.5*S.width-10*this.dpr;S.setPosition(C,w.y),b.setPosition(-C,w.y).rotation=-Math.PI;var T=this.scene.make.image({x:0,y:w.y+12*this.dpr,key:this.key,frame:"separator"});this.materialCon.add([v,w,S,b,T]),this.materialGameScroll=new u.GameScroller(this.scene,{x:0,y:10*this.dpr,width:i,height:70*this.dpr,zoom:this.scale,align:2,orientation:1,dpr:this.dpr,celldownCallBack:function(t){e.materialTipsCon.visible=!0,e.onMaterialItemHandler(t)},cellupCallBack:function(t){e.materialTipsCon.visible=!1}}),this.materialCon.add(this.materialGameScroll),this.materialTipsCon=this.scene.make.container(void 0,!1).setPosition(0,-20*this.dpr),this.materialTipsCon.visible=!1,this.materialCon.add(this.materialTipsCon);var I=109*this.dpr,M=42*this.dpr,E=new a.NinePatch(this.scene,0,0,I,M,this.key,"tips_bg",{left:20*this.dpr,top:20*this.dpr,right:30*this.dpr,bottom:20*this.dpr});E.setPosition(26*this.dpr,.5*-M),this.tipsbg=E;var k=this.scene.make.image({key:this.key,frame:"tips_arrow"}),B=this.scene.make.text({x:0,y:.5*-P+12*this.dpr,text:"",style:{color:"#844ED5",fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:90*this.dpr,useAdvancedWrap:!0}}},!1).setOrigin(0,.5).setPosition(-19*this.dpr,-M+10*this.dpr);this.materialTipsName=B;var O=this.scene.make.text({x:0,y:.5*-P+12*this.dpr,text:"",style:{color:"#333333",fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:100*this.dpr,useAdvancedWrap:!0}}},!1).setOrigin(0).setPosition(-19*this.dpr,-M+20*this.dpr);this.materialTipsDes=O,this.materialTipsCon.add([E,B,O,k]);var D=this.scene.textures.getFrame(this.key,"bprint_bg_2"),R=D.width+10*this.dpr,x=D.height+12*this.dpr,A=190*this.dpr,L={x:0,y:.5*n-.5*A+10*this.dpr,table:{width:i,height:A,columns:2,cellWidth:R,cellHeight:x,reuseCellContainer:!0,zoom:this.scale},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new _(n,e.key,e.dpr)),i.setItemData(o),o&&e.mSelectItemData&&o.skill.id===e.mSelectItemData.skill.id&&(i.select=!0,e.mSelectItem=i),i}};this.mGrideTable=new u.GameGridTable(this.scene,L),this.mGrideTable.layout(),this.mGrideTable.on("cellTap",(function(t){t&&e.onSelectItemHandler(t)})),this.content.add(this.mGrideTable),this.resize(i,n),t.prototype.init.call(this),this.mShowData&&this.setComposeData(this.mShowData.skills)},ComposePanel.prototype.destroy=function(){t.prototype.destroy.call(this)},ComposePanel.prototype.setComposeData=function(t){if(t&&t.length>0){this.mGrideTable.setItems(t);var e=this.mSelectItem?this.mSelectItem:this.mGrideTable.getCell(0).container;this.onSelectItemHandler(e)}},ComposePanel.prototype.setComposeDetialData=function(t){this.mDetailBubble.setDetailData(t.productName,t.productDes),this.setDetailDisplay(t),this.setMaterialItems(t.materials)},ComposePanel.prototype.setDetailDisplay=function(t){this.mDetailDisplay.loadSprite("loading_ui",h.i.getUIRes(this.dpr,"loading_ui"),h.i.getUIRes(this.dpr,"loading_ui"));var e=new r.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE_ITEM_RESOURCE;if(e.animations=t.productAnimations,e.display=t.productDisplay,e.avatar=t.productAvatar,e.display)this.mDetailDisplay.loadDisplay(e);else if(e.avatar){var i=new Phaser.Geom.Point;i.x=0,i.y=20*this.dpr,this.mDetailDisplay.loadAvatar(e,2*this.dpr,i)}},ComposePanel.prototype.onSelectItemHandler=function(t){var e=t.itemData;this.mSelectItemData=t.itemData,this.makeBtn.enable=e.skill.active&&e.skill.qualified,this.mSelectItem&&(this.mSelectItem.select=!1),this.mSelectItem=t,t.select=!0,this.setComposeDetialData(e)},ComposePanel.prototype.setMaterialItems=function(t){var e=t.length,i=[];this.materialGameScroll.clearItems();for(var n=0;n<e;n++){var o=new P(this.scene,this.key,this.dpr);o.y=0,i.push(o),o.setItemData(t[n]),o.setData("itemData",t[n]),this.materialGameScroll.addItem(o)}this.materialGameScroll.Sort()},ComposePanel.prototype.onMaterialItemHandler=function(t){var e=t.getWorldTransformMatrix();this.materialTipsCon.x=e.tx-.5*this.scaleWidth,this.materialTipsName.text=t.itemData.name,this.materialTipsDes.text=t.itemData.source;var i=this.materialTipsName.height+this.materialTipsDes.height+20*this.dpr,n=this.tipsbg.width;this.tipsbg.resize(n,i),this.tipsbg.y=.5*-this.tipsbg.height,this.materialTipsName.y=-i+15*this.dpr,this.materialTipsDes.y=-i+25*this.dpr},ComposePanel.prototype.onMakeHandler=function(){var t=this;if(this.mSelectItemData){var e={text:[{text:d.a.t("compose.confirmation",{name:this.mSelectItemData.productName})}],title:[{text:d.a.t("compose.synthesis")}],button:[{text:d.a.t("common.confirm"),local:!0,clickhandler:new m.a(this,(function(){t.emit("reqUseFormula",t.mSelectItemData.skill.id)}))},{text:d.a.t("common.cancel"),local:!0}]};this.mWorld.uiManager.showMed("MessageBox",e)}},ComposePanel.prototype.onInputPointUp=function(){this.materialTipsCon.visible=!1},ComposePanel.prototype.onBackHandler=function(){this.emit("hide")},ComposePanel}(s.BasePanel),g=function(t){function DetailBubble(e,i){var n=t.call(this,e)||this;n.dpr=i,n.mDetailBubble=n.scene.make.graphics(void 0,!1);var r=198*i,s=96*i;return n.mDetailBubble=n.scene.make.graphics(void 0,!1),n.mDetailBubble.fillStyle(16777215,.1),n.mDetailBubble.fillRoundedRect(0,0,r,s),n.mItemName=n.scene.make.text({x:7*n.dpr,y:9*n.dpr,text:"道具名称道具名称",style:{fontSize:12*n.dpr,fontFamily:o.a.DEFULT_FONT,color:"#8C55E1",align:"center"}}),n.mDesText=n.scene.make.text({x:8*i,y:30*i,style:{color:"#ffffff",fontSize:10*i,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:180*i,useAdvancedWrap:!0}}},!1),n.add([n.mDetailBubble,n.mItemName,n.mDesText]),n.setSize(r,s),n}return f(DetailBubble,t),DetailBubble.prototype.setDetailData=function(t,e){this.mItemName.setText(t),this.mDesText.setText(e),this.resize()},DetailBubble.prototype.resize=function(t,e){void 0===t&&(t=this.width);var i=this.mDesText.height+60*this.dpr;t===this.width&&i===this.height||(this.mDetailBubble.clear(),this.mDetailBubble.fillStyle(16777215,.1),this.mDetailBubble.fillRoundedRect(0,0,t,i),this.setSize(t,i))},DetailBubble}(Phaser.GameObjects.Container),_=function(t){function ComposeItem(e,i,n){var r=t.call(this,e)||this;r.dpr=n,r.key=i,r.bg=r.scene.make.image({key:r.key,frame:"bprint_bg_1"}),r.setSize(r.bg.width,r.bg.height),r.itemIcon=new l.DynamicImage(r.scene,0,0);var s=r.width,a=r.height;return r.newIcon=r.scene.make.image({key:r.key,frame:"tag_new"}),r.newIcon.setPosition(.5*-s+3*n,.5*-a+3*n),r.newText=r.scene.make.text({x:r.newIcon.x,y:r.newIcon.y,text:"N",style:{fontSize:11*r.dpr,fontFamily:o.a.DEFULT_FONT,color:"#ffffff",align:"center"}}).setOrigin(.5),r.qualityIcon=r.scene.make.image({key:r.key,frame:"tag_rank_a"}),r.qualityIcon.setPosition(.5*-s+.5*r.qualityIcon.width-2*n,.5*a-.5*r.qualityIcon.height),r.qualityTex=r.scene.make.text({x:r.qualityIcon.x,y:r.qualityIcon.y,text:"A",style:{fontSize:11*r.dpr,fontFamily:o.a.DEFULT_FONT,color:"#ffffff",align:"center"}}).setOrigin(.5),r.qualifiedIcon=r.scene.make.image({key:r.key,frame:"tag_ready"}),r.qualifiedIcon.setOrigin(1).setPosition(.5*s-3*n,.5*a-3*n),r.lockbg=r.scene.make.image({key:r.key,frame:"bprint_mask"}),r.lockIcon=r.scene.make.image({key:r.key,frame:"lock"}),r.add([r.bg,r.itemIcon,r.newIcon,r.newText,r.qualityIcon,r.qualityTex,r.qualifiedIcon,r.lockbg,r.lockIcon]),r}return f(ComposeItem,t),ComposeItem.prototype.setItemData=function(t){this.itemData=t;var e=t.skill,i=e.active;this.newIcon.visible=i,this.newText.visible=i,this.qualityIcon.visible=i,this.qualityTex.visible=i,this.qualityTex.text=e.quality,this.qualifiedIcon.visible=i&&e.qualified,this.lockbg.visible=!e.active,this.lockIcon.visible=!e.active,this.setQualityTexture(e.quality),e.display&&this.setItemIcon(e.display),this.select=!1},Object.defineProperty(ComposeItem.prototype,"select",{set:function(t){t?this.bg.setFrame("bprint_bg_2"):this.bg.setFrame("bprint_bg_1")},enumerable:!1,configurable:!0}),ComposeItem.prototype.setItemIcon=function(t){var e=this,i=h.i.getOsdRes(t.texturePath);this.itemIcon.load(i,this,(function(){e.itemIcon.scale=e.dpr,e.itemIcon.setPosition(0,0)}))},ComposeItem.prototype.setQualityTexture=function(t){this.qualityIcon.visible=!0,"A"===t?this.qualityIcon.setFrame("tag_rank_a"):"B"===t?this.qualityIcon.setFrame("tag_rank_b"):"C"===t?this.qualityIcon.setFrame("tag_rank_c"):this.qualityIcon.visible=!1},ComposeItem}(Phaser.GameObjects.Container),P=function(t){function ComposeMaterialItem(e,i,n){var r=t.call(this,e)||this;r.dpr=n,r.key=i;var s=r.scene.make.image({key:r.key,frame:"source_bg"});return r.itemIcon=new l.DynamicImage(e,0,0),r.itemCount=new u.BBCodeText(r.scene,0,0,"",{}).setOrigin(.5).setFontSize(11*n).setFontFamily(o.a.DEFULT_FONT),r.add([s,r.itemIcon,r.itemCount]),r.setSize(s.width,s.height),r.itemCount.y=.5*r.height,r}return f(ComposeMaterialItem,t),ComposeMaterialItem.prototype.setItemData=function(t){var e=this;this.itemData=t,this.itemCount.text=this.getCountText(t.count,t.neededCount);var i=h.i.getOsdRes(t.display.texturePath);this.itemIcon.load(i,this,(function(){e.itemIcon.scale=e.dpr,e.itemIcon.setPosition(0,0)}))},ComposeMaterialItem.prototype.getCountText=function(t,e){var i=t>=e?"#ffffff":"#ff0000";return"[stroke="+i+"][color="+i+"]"+t+"[/color][/stroke]/"+e},ComposeMaterialItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"Compose",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Compose(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Compose,t),Compose.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_CRAFT_QUERY_FORMULA,this.onRetFormulaDetial),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_CRAFT_SKILLS,this.openComposePanel))},Compose.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Compose.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Compose.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Compose.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(Compose.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Compose.prototype.onReqFormulaDetail=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_CRAFT_QUERY_FORMULA);e.content.id=t,this.connection.send(e)},Compose.prototype.onReqUseFormula=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_CRAFT_ALCHEMY);e.content.id=t,this.connection.send(e)},Compose.prototype.onRetFormulaDetial=function(t){var e=t.content;this.mEvent.emit("formulaDetial",e)},Compose.prototype.openComposePanel=function(t){var e=t.content;this.mEvent.emit("showopen",e)},Compose}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineSettleMediator",(function(){return h}));var n,o=i(226),r=i(227),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function MineSettleMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o.mineSettle||(o.mineSettle=new r.MineSettle(o.world),o.mineSettle.on("minesettlepacket",o.onMineSettlePacket,o),o.mineSettle.register()),o}return a(MineSettleMediator,t),MineSettleMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.MineSettlePanel(this.scene,this.world),this.mView.on("hide",this.onHideMineSettle,this)),t.prototype.show.call(this,e),this.layerMgr.addToUILayer(this.mView),this.mParam&&this.mParam.length>0&&this.setMIneSettlePanel(this.mParam[0]),this.mView.show())},MineSettleMediator.prototype.destroy=function(){this.mineSettle&&this.mineSettle.destroy(),this.mineSettle=void 0,t.prototype.destroy.call(this)},MineSettleMediator.prototype.onHideMineSettle=function(){this.mineSettle.reqMineSettlePacket(),t.prototype.destroy.call(this)},MineSettleMediator.prototype.onMineSettlePacket=function(t){this.mView&&this.mView.visible?this.setMIneSettlePanel(t):(this.setParam([t]),this.show())},MineSettleMediator.prototype.setMIneSettlePanel=function(t){var e=this.mView;e.setData("settleData",t),e.setMineSettlePacket(t)},MineSettleMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineSettlePanel",(function(){return m}));var n,o=i(113),r=i(116),s=i(112),a=i(117),h=i(111),c=i(114),l=i(115),p=i(109),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function MineSettlePanel(e,i){var n=t.call(this,e,i)||this;return n.key="mine_settle",n}return d(MineSettlePanel,t),MineSettlePanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,n,o),this.bg.x=n/2,this.bg.y=o/2,this.titleimage.x=n/2,this.titleimage.y=this.bg.y-this.bg.displayHeight/2-8*this.dpr,this.confirmBtn.x=n/2,this.confirmBtn.y=this.bg.y+100*this.dpr,this.titleName.x=n/2,this.titleName.y=this.titleimage.y+32*this.dpr,this.blackGraphic.clear(),this.blackGraphic.fillStyle(0,.66),this.blackGraphic.fillRect(0,0,n,o),this.mPropGrid.refreshPos(n/2,this.bg.y-2*this.dpr),this.mPropGrid.resetMask(),this.setSize(n,o)},MineSettlePanel.prototype.show=function(t){this.mShowData=t,this.refreshData(),this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},MineSettlePanel.prototype.addListen=function(){this.mInitialized&&this.confirmBtn.on(String(p.ClickEvent.Tap),this.onConfirmBtnClick,this)},MineSettlePanel.prototype.removeListen=function(){this.mInitialized&&this.confirmBtn.off(String(p.ClickEvent.Tap),this.onConfirmBtnClick,this)},MineSettlePanel.prototype.preload=function(){this.addAtlas(this.key,"minesettle/settlement.png","minesettle/settlement.json"),this.addAtlas(l.UIAtlasKey.commonKey,l.UIAtlasName.commonUrl+".png",l.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},MineSettlePanel.prototype.init=function(){var e=this,i=this.cameraWidth,n=this.cameraHeight;this.bg=new a.NinePatch(this.scene,0,0,293*this.dpr,260*this.dpr,this.key,"bg",{left:10,top:10,right:10,bottom:10}),this.blackGraphic=this.scene.make.graphics(void 0,!1),this.blackGraphic.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains);var r=this.scene.textures.getFrame(this.key,"icon_test"),s=r.width+20*this.dpr,h=r.height+25*this.dpr,d={x:0,y:0,table:{width:280*this.dpr,height:160*this.dpr,columns:5,cellWidth:s,cellHeight:h,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0,cellPadX:18*this.dpr,zoom:this.scale},clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new u(n,e.dpr)),i.setData({item:o}),i.setItemData(o),i}};this.mPropGrid=new p.GameGridTable(this.scene,d),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){var i=t.itemData;i&&e.onSelectItemHandler(i)})),this.titleimage=this.scene.make.image({x:0,y:.5*-this.bg.displayWidth-10*this.dpr,key:this.key,frame:"title"},!1),this.titleimage.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.titleName=this.scene.make.text({x:0,y:this.titleimage.y+32*this.dpr,text:c.a.t("minesettle.settle"),style:{fontSize:15*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5,.5),this.confirmBtn=new p.NineSliceButton(this.scene,0,100*this.dpr,90*this.dpr,40*this.dpr,l.UIAtlasKey.commonKey,"yellow_btn",c.a.t("minesettle.savebag"),this.dpr,this.scale,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr}),this.confirmBtn.setTextStyle({color:"#976400",fontSize:16*this.dpr,fontFamily:o.a.DEFULT_FONT}),this.add([this.blackGraphic,this.bg,this.titleimage,this.titleName,this.confirmBtn]),this.add(this.mPropGrid),this.resize(0,0),t.prototype.init.call(this)},MineSettlePanel.prototype.setMineSettlePacket=function(t){this.mInitialized&&this.mPropGrid.setItems(t.items)},MineSettlePanel.prototype.destroy=function(){this.mPropGrid&&this.mPropGrid.destroy(),this.confirmBtn&&this.confirmBtn.destroy(),this.mPropGrid=null,this.confirmBtn=null,t.prototype.destroy.call(this)},MineSettlePanel.prototype.refreshData=function(){var t=this.getData("settleData");t&&this.setMineSettlePacket(t)},MineSettlePanel.prototype.onSelectItemHandler=function(t){},MineSettlePanel.prototype.onConfirmBtnClick=function(t){this.checkPointerDis(t)&&this.emit("hide")},MineSettlePanel.prototype.checkPointerDis=function(t){return!this.mWorld||Math.abs(t.downX-t.upX)<10*this.mWorld.uiRatio*this.mWorld.uiScale&&Math.abs(t.downY-t.upY)<10*this.mWorld.uiRatio*this.mWorld.uiScale},MineSettlePanel}(s.BasePanel),u=function(t){function MineSettleItem(e,i){var n=t.call(this,e)||this;return n.dpr=i,n.icon=new r.DynamicImage(e,0,0),n.itemCount=n.scene.make.text({text:"600",style:{fontSize:18,fontFamily:o.a.DEFULT_FONT}},!1),n.itemCount.setOrigin(.5,0),n.icon.setOrigin(0,0),n.icon.setScale(n.dpr),n.itemCount.setPosition(0,n.icon.height),n.add(n.icon),n.add(n.itemCount),n}return d(MineSettleItem,t),MineSettleItem.prototype.setItemData=function(t){var e=this;this.itemData=t,this.itemCount.setFontSize(14*this.dpr),this.itemCount.text=t.count+"";var i=h.i.getOsdRes(t.display.texturePath);this.icon.load(i,this,(function(){e.icon.setScale(33*e.dpr/e.icon.width),e.icon.setPosition(0,3*e.dpr),e.itemCount.setPosition(.5*e.icon.displayWidth,e.icon.x+e.icon.displayHeight+3*e.dpr)}))},MineSettleItem.prototype.destroy=function(){t.prototype.destroy.call(this),this.icon&&this.icon.destroy(),this.itemCount&&this.itemCount.destroy(),this.itemData=null,this.icon=null,this.itemCount=null,this.scene=null},MineSettleItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineSettle",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function MineSettle(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(MineSettle,t),MineSettle.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MINING_MODE_SHOW_REWARD_PACKAGE,this.onMineSettlePackageHandler))},MineSettle.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},MineSettle.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},MineSettle.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},MineSettle.prototype.reqMineSettlePacket=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MINING_MODE_STORAGE_REWARD);this.connection.send(t)},MineSettle.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(MineSettle.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),MineSettle.prototype.onMineSettlePackageHandler=function(t){var e=t.content;this.mEvent.emit("minesettlepacket",e)},MineSettle}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"EquipUpgradeMediator",(function(){return h}));var n,o=i(229),r=i(231),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function EquipUpgradeMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o.equipUpgrade||(o.equipUpgrade=new r.EquipUpgrade(o.world),o.equipUpgrade.on("activeEquip",o.onActiveEquipment,o),o.equipUpgrade.on("showopen",o.onShowEquipPanel,o),o.equipUpgrade.register()),o}return a(EquipUpgradeMediator,t),EquipUpgradeMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.default(this.scene,this.world),this.mView.on("hide",this.onHidePanel,this),this.mView.on("reqActive",this.onReqActiveEquipment,this),this.mView.on("reqEquiped",this.onReqEquipedEquipment,this)),this.layerMgr.addToUILayer(this.mView),this.mParam&&this.mParam.length>0&&this.onEquipUpgradePacket(this.mParam[0]),this.mView.show())},EquipUpgradeMediator.prototype.destroy=function(){this.equipUpgrade&&this.equipUpgrade.destroy(),this.equipUpgrade=void 0,t.prototype.destroy.call(this)},EquipUpgradeMediator.prototype.onHidePanel=function(){t.prototype.destroy.call(this)},EquipUpgradeMediator.prototype.onEquipUpgradePacket=function(t){var e=this.mView;e&&(e.setData("upgradeData",t),e.setEquipDatas(t))},EquipUpgradeMediator.prototype.onActiveEquipment=function(t){this.mView&&this.mView.setActiveEquipment(t)},EquipUpgradeMediator.prototype.onReqEquipedEquipment=function(t){this.equipUpgrade&&this.equipUpgrade.reqEquipedEquipment(t)},EquipUpgradeMediator.prototype.onReqActiveEquipment=function(t){this.equipUpgrade&&this.equipUpgrade.reqActiveEquipment(t)},EquipUpgradeMediator.prototype.onShowEquipPanel=function(t){this.setParam([t]),this.show()},EquipUpgradeMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e);var n,o=i(112),r=i(113),s=i(230),a=i(117),h=i(114),c=i(115),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function EquipUpgradePanel(e,i){var n=t.call(this,e,i)||this;return n.key="equip_upgrade",n.commonkey="common_key",n.equipItems=[],n}return l(EquipUpgradePanel,t),EquipUpgradePanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,e,i),this.setSize(n,o),this.bg.x=n/2,this.bg.y=o/2,this.tilteName.x=this.bg.x,this.tilteName.y=this.bg.y-this.bg.height/2,this.titlebg.x=this.bg.x,this.titlebg.y=this.bg.y-this.bg.height/2,this.closeBtn.x=this.bg.x+this.bg.width/2-10*this.dpr,this.closeBtn.y=this.bg.y-this.bg.height/2+10*this.dpr,this.blackBg.clear(),this.blackBg.fillStyle(0,.5),this.blackBg.fillRoundedRect(-this.x,-this.y,n,o),this.add([this.blackBg,this.bg,this.closeBtn,this.titlebg,this.tilteName])},EquipUpgradePanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.refreshData(),this.addListen()):this.preload())},EquipUpgradePanel.prototype.addListen=function(){this.mInitialized&&this.closeBtn.on("pointerup",this.OnClosePanel,this)},EquipUpgradePanel.prototype.removeListen=function(){this.mInitialized&&this.closeBtn.off("pointerup",this.OnClosePanel,this)},EquipUpgradePanel.prototype.preload=function(){this.commonkey=c.UIAtlasKey.commonKey,this.addAtlas(this.key,"equip_upgrade/mine_eqpm.png","equip_upgrade/mine_eqpm.json"),this.addAtlas(c.UIAtlasKey.commonKey,c.UIAtlasName.commonUrl+".png",c.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},EquipUpgradePanel.prototype.init=function(){var e=this.scaleWidth,i=this.scaleHeight;this.setSize(e,i),this.blackBg=this.scene.make.graphics(void 0,!1),this.blackBg.clear(),this.blackBg.fillStyle(0,.5),this.blackBg.fillRoundedRect(0,0,e,i),this.blackBg.setInteractive(new Phaser.Geom.Rectangle(0,0,this.scene.cameras.main.width,this.scene.cameras.main.height),Phaser.Geom.Rectangle.Contains),this.bg=new a.NinePatch(this.scene,0,0,300*this.dpr,300*this.dpr,this.commonkey,"bg",{left:40,top:40,bottom:40,right:40});var n=.5*-this.bg.height;this.titlebg=this.scene.make.image({x:0,y:n,key:this.key,frame:"titlebg"});var o="bold "+15*this.dpr+"px Source Han Sans";this.tilteName=this.scene.make.text({x:0,y:n,text:h.a.t("equipupgrade.title"),style:{font:o,color:"#8F4300",fontSize:15*this.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(.5,0),this.closeBtn=this.scene.make.image({x:.5*this.bg.width-5*this.dpr,y:n+5*this.dpr,key:this.commonkey,frame:"close"}),this.tilteName.setStroke("#8F4300",1),this.closeBtn.setInteractive(),this.add([this.blackBg,this.bg,this.closeBtn,this.titlebg,this.tilteName]),this.resize(this.scene.cameras.main.width,this.scene.cameras.main.height),t.prototype.init.call(this)},EquipUpgradePanel.prototype.setEquipDatas=function(t){if(this.content=t,this.mInitialized){var e=this.scaleWidth,i=this.scaleHeight,n=t.mineEquipments,o=175*this.dpr*n.length-(n.length>=2?40*(n.length-2):0),r=155*this.dpr;this.resetPosition(this.bg.width,o);for(var a=.5*-o+100*this.dpr,h=0,c=0,l=n;c<l.length;c++){var p=l[c];p.isblue=h%2!=0;var d=new s.EquipUpgradeItem(this.scene,this,this.dpr,this.scale,this.key,this.commonkey);d.on("reqActive",this.onReqActiveEquipment,this),d.on("reqEquiped",this.onReqEquipedEquipment,this),d.setEquipItems(p),d.setTransPosition(e/2,a+i/2),this.equipItems.push(d),a+=r,h++}this.resize(e,i)}},EquipUpgradePanel.prototype.setActiveEquipment=function(t){for(var e=0,i=0,n=this.content.mineEquipments;i<n.length;i++){for(var o=n[i],r=this.equipItems[e],s=-1,a=0;a<o.mineEquipments.length;a++){var h=o.mineEquipments[a];h.id===t.id?(o.mineEquipments[a]=t,r.refreshEquipData(t,a),s=a):h.selected&&(h.selected=!1)}s>=0&&r.refreshEquipData(t,s),e++}},EquipUpgradePanel.prototype.destroy=function(){if(this.equipItems){for(var e=0,i=this.equipItems;e<i.length;e++){i[e].destroy()}this.equipItems.length=0}this.equipItems=null,this.content=null,t.prototype.destroy.call(this)},EquipUpgradePanel.prototype.getEuipDatas=function(){for(var t=[],e=0;e<3;e++){var i={};i.name=0===e?"矿镐":"矿车",i.items=[],i.isblue=!(e%2==0);for(var n=0;n<15;n++){var o={};o.name="矿镐"+n,o.penetration=10+n,o.des="describle",o.cost=100*n,o.unlock=!1,i.items.push(o)}t.push(i)}return t},EquipUpgradePanel.prototype.refreshData=function(){var t=this.getData("upgradeData");t&&this.setEquipDatas(t)},EquipUpgradePanel.prototype.resetPosition=function(t,e){this.bg.resize(t,e);var i=.5*-e;this.titlebg.setPosition(0,i),this.tilteName.setPosition(0,i),this.closeBtn.setPosition(.5*t-8*this.dpr,i+8*this.dpr)},EquipUpgradePanel.prototype.OnClosePanel=function(){this.emit("hide")},EquipUpgradePanel.prototype.onReqActiveEquipment=function(t){this.emit("reqActive",t)},EquipUpgradePanel.prototype.onReqEquipedEquipment=function(t){this.emit("reqEquiped",t)},EquipUpgradePanel}(o.BasePanel);e.default=p},function(t,e,i){"use strict";i.r(e),i.d(e,"EquipUpgradeItem",(function(){return l}));var n,o=i(113),r=i(116),s=i(111),a=i(117),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function EquipUpgradeItem(e,i,n,o,r,s){var a=t.call(this)||this;return a.haveEquiped=!1,a.cellWidth=0,a.cellHeight=0,a.dpr=n,a.zoom=o,a.key=r,a.commonKey=s,a.mScene=e,a.mContainer=i,a.create(),a}return c(EquipUpgradeItem,t),EquipUpgradeItem.prototype.setEquipItems=function(t){var e=t.equipmentType,i=t.mineEquipments;this.titleName.text=e;for(var n=0,o=i;n<o.length;n++){if(o[n].selected){this.haveEquiped=!0;break}0}this.gridTable.setItems(i),this.haveEquiped&&this.setBgTexture(t.isblue)},EquipUpgradeItem.prototype.setTransPosition=function(t,e){this.bg.x+=t,this.bg.y+=e,this.titleName.x+=t,this.titleName.y+=e,this.bottombg.x+=t,this.bottombg.y+=e,this.equipName.x+=t,this.equipName.y+=e,this.penetrationText.x+=t,this.penetrationText.y+=e,this.equipDes.x+=t,this.equipDes.y+=e,this.topbg.x+=t,this.topbg.y+=e,this.unlockbtn.x+=t,this.unlockbtn.y+=e,this.gridTable.refreshPos(t,e-10*this.dpr),this.gridTable.resetMask()},Object.defineProperty(EquipUpgradeItem.prototype,"displayList",{get:function(){return[this.bg,this.topbg,this.bottombg,this.titleName,this.equipName,this.penetrationText,this.equipDes]},enumerable:!1,configurable:!0}),EquipUpgradeItem.prototype.refreshEquipData=function(t,e){this.gridTable.items[e]=t;for(var i=0,n=this.gridTable.getCells();i<n.length;i++){var o=n[i];if(o&&o.container){var r=o.container.itemData;r.id===t.id?o.container.setItemData(t):o.container.setItemData(r)}}this.curSelectItemData.id===t.id&&(this.curSelectItemData=t),this.updateEquipItem(this.curSelectItemData)},EquipUpgradeItem.prototype.destroy=function(){this.unlockbtn&&this.unlockbtn.off("pointerup",this.onUnlockEquipHandler,this),t.prototype.destroy.call(this),this.gridTable&&this.gridTable.destroy(),this.bg=null,this.topbg=null,this.bottombg=null,this.gridTable=null,this.titleName=null,this.equipName=null,this.penetrationText=null,this.equipDes=null,this.unlockbtn=null,this.costNum=null,this.diamondIcon=null,this.curEquipItem=null,this.curSelectItemData=null},EquipUpgradeItem.prototype.setBgTexture=function(t){var e=t?"topbg1":"topbg",i=t?"bottombg1":"bottombg",n=t?"#0867AE":"#8F4300";this.topbg.setTexture(this.key,e),this.bottombg.setTexture(this.key,i),this.titleName.setColor(n).setStroke(n,1),this.equipName.setColor(n).setStroke(n,1),this.penetrationText.setColor(n).setStroke(n,1)},EquipUpgradeItem.prototype.create=function(){this.bg=this.mScene.make.image({x:0,y:-21*this.dpr,key:this.key,frame:"bg1"}),this.topbg=this.mScene.make.image({x:0,y:-61*this.dpr,key:this.key,frame:"topbg"}),this.titleName=this.mScene.make.text({x:0,y:this.topbg.y+0*this.dpr,text:"矿镐",style:{blod:!0,color:"#8F4300",fontSize:14*this.dpr,font:this.getBoldFont(14*this.dpr)}}).setOrigin(.5,.5),this.bottombg=this.mScene.make.image({x:0,y:42*this.dpr,key:this.key,frame:"bottombg"}),this.equipName=this.mScene.make.text({x:-120*this.dpr,y:15*this.dpr,text:"精铁镐",style:{color:"#8F4300",fontSize:14*this.dpr,font:this.getBoldFont(14*this.dpr)}}),this.penetrationText=this.mScene.make.text({x:-60*this.dpr,y:16*this.dpr,text:"穿透力:10",style:{color:"#8F4300",fontSize:12*this.dpr,fontFamily:o.a.DEFULT_FONT}}),this.equipDes=this.mScene.make.text({x:-120*this.dpr,y:35*this.dpr,text:"描述文字",style:{color:"#000000",fontSize:10*this.dpr,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:130*this.dpr,useAdvancedWrap:!0}}}),this.equipDes.setStroke("#000000",1),this.mContainer.add([this.bg,this.topbg,this.bottombg,this.titleName,this.equipName,this.penetrationText,this.equipDes]),this.createGridTable(),this.createBtn()},EquipUpgradeItem.prototype.createGridTable=function(){var t=this,e=this.mScene.textures.getFrame(this.key,"equipbg"),i=e.width+10*this.dpr,n=e.height+30*this.dpr;this.cellWidth=i,this.cellHeight=n;var o={x:0,y:0,scrollMode:1,table:{width:259*this.dpr,height:77*this.dpr,columns:1,cellWidth:i,cellHeight:n,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0,zoom:this.zoom},clamplChildOY:!1,createCellContainerCallback:function(e,o){var r=e.scene,s=e.item;e.index;return null===o&&((o=new p(r,t.dpr,t.key)).setSize(i,n),o.setChildPosition()),o.setData({item:s}),o.setItemData(s),t.curSelectItemData===s?(o.setSelect(!0),t.curEquipItem=o):o.setSelect(!1),null==t.curEquipItem&&(t.haveEquiped&&!s.selected||t.onSelectItemHandler(o)),o}};this.gridTable=new h.GameGridTable(this.mScene,o),this.gridTable.layout(),this.gridTable.on("cellTap",(function(e){t.onSelectItemHandler(e)})),this.mContainer.add(this.gridTable)},EquipUpgradeItem.prototype.onSelectItemHandler=function(t){this.curEquipItem&&this.curEquipItem.setSelect(!1);var e=t.itemData;this.curSelectItemData=e,this.updateEquipItem(e),t.setSelect(!0),this.curEquipItem&&this.curEquipItem.setSelect(!1),this.curEquipItem=t,e.owned&&!e.selected&&this.emit("reqEquiped",e.id)},EquipUpgradeItem.prototype.updateEquipItem=function(t){if(this.penetrationText.text=t.buffDisplayNames[0],this.equipDes.text=t.description,this.equipName.text=t.name,t.owned?this.unlockbtn.visible=!1:this.unlockbtn.visible=!0,t.qualified?(this.unlockCondition.visible=!1,this.unlockbtn.setInteractive(),this.unlockBg.clearTint(),this.costNum.setColor("#ffffff")):t.owned||(this.unlockCondition.visible=!0,this.unlockCondition.text=t.conditionDisplayNames[0],this.unlockbtn.disableInteractive(),this.unlockBg.setTintFill(8947848),this.costNum.setColor("#999999")),null===t.price)this.costNum.visible=!1,this.diamondIcon.visible=!1,this.btnName.setPosition(0,0*this.dpr);else{var e=t.price.price,i=Math.pow(10,t.price.displayPrecision);this.costNum.text=Math.floor(e*i)/i+"",this.costNum.visible=!0,this.diamondIcon.visible=!0,this.diamondIcon.setTexture(this.commonKey,s.f.getIcon(t.price.coinType)),this.diamondIcon.setDisplaySize(12*this.dpr,12*this.dpr),this.btnName.setPosition(0,6*this.dpr)}},EquipUpgradeItem.prototype.onUnlockEquipHandler=function(){this.emit("reqActive",this.curEquipItem.itemData.id)},EquipUpgradeItem.prototype.createBtn=function(){this.unlockCondition=new h.BBCodeText(this.mScene,0,-26*this.dpr,"",{}).setOrigin(.5).setFontSize(10*this.dpr).setFontFamily(o.a.DEFULT_FONT),this.unlockbtn=this.mScene.make.container(void 0,!1);var t=new a.NinePatch(this.mScene,0,0,88*this.dpr,31*this.dpr,this.commonKey,"yellow_btn_normal",{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr});this.unlockBg=t,this.diamondIcon=this.mScene.make.image({x:-13*this.dpr,y:-8*this.dpr,key:this.commonKey,frame:"test_diamond"}),this.costNum=this.mScene.make.text({x:-2,y:-8*this.dpr,text:"1000",style:{color:"#ffffff",fontSize:10*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0,.5),this.btnName=this.mScene.make.text({x:0,y:6*this.dpr,text:"立即解锁",style:{color:"#8F4300",fontSize:11*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5,.5),this.costNum.setStroke("#ffffff",1),this.btnName.setStroke("#8F4300",1),this.unlockCondition.setStroke("#000000",1),this.unlockbtn.setPosition(70*this.dpr,48*this.dpr),this.unlockbtn.setSize(t.width,t.height),this.unlockbtn.add([this.unlockCondition,t,this.diamondIcon,this.costNum,this.btnName]),this.unlockbtn.on("pointerup",this.onUnlockEquipHandler,this),this.mContainer.add(this.unlockbtn)},EquipUpgradeItem.prototype.getBoldFont=function(t){return"bold "+t+"px Source Han Sans"},EquipUpgradeItem}(Phaser.Events.EventEmitter),p=function(t){function EquipItemCell(e,i,n){var o=t.call(this,e)||this;return o.isSelect=!1,o.isUnlock=!1,o.dpr=i,o.key=n,o.create(),o}return c(EquipItemCell,t),EquipItemCell.prototype.setItemData=function(t){var e=this;this.itemData=t;var i=s.i.getOsdRes(t.display.texturePath);this.equipIcon.load(i,this,(function(){e.equipIcon.scale=e.dpr})),this.setEquiped(t.selected,t.owned),this.setSelect(this.isSelect)},EquipItemCell.prototype.setSelect=function(t){this.isSelect=t;var e="equipbg";t||(e=this.isUnlock?"equipbg2":"equipbg1"),this.itemData.selected&&(e="equipbg2"),this.bg.setTexture(this.key,e)},EquipItemCell.prototype.setChildPosition=function(){var t=.5*this.bg.width+10*this.dpr,e=this.height-10*this.dpr;this.bg.setPosition(t,e),t+=1*this.dpr,e=.5*this.height+2*this.dpr,this.equipIcon.setPosition(t,e),t+=22*this.dpr,e=8*this.dpr,this.unlock.setPosition(t,e)},EquipItemCell.prototype.setEquiped=function(t,e){this.isUnlock=e,this.unlock.visible=!1,t?(this.isUnlock=!0,this.unlock.visible=!0,this.unlock.setTexture(this.key,"ok")):this.isUnlock||(this.unlock.visible=!0,this.unlock.setTexture(this.key,"lock"))},EquipItemCell.prototype.create=function(){this.bg=this.scene.make.image({x:0,y:-10*this.dpr,key:this.key,frame:"equipbg"}),this.equipIcon=new r.DynamicImage(this.scene,15*this.dpr,0*this.dpr),this.unlock=this.scene.make.image({x:30*this.dpr,y:-10*this.dpr,key:this.key,frame:"lock"}),this.add([this.bg,this.equipIcon,this.unlock])},EquipItemCell}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"EquipUpgrade",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function EquipUpgrade(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(EquipUpgrade,t),EquipUpgrade.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MINING_MODE_ACTIVE_EQUIPMENT,this.onActiveEquipmend),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MINING_MODE_SHOW_SELECT_EQUIPMENT_PANEL,this.openEquipUpgrade))},EquipUpgrade.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},EquipUpgrade.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},EquipUpgrade.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},EquipUpgrade.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(EquipUpgrade.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),EquipUpgrade.prototype.reqEquipedEquipment=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_RES_VIRTUAL_WORLD_MINING_MODE_EQUIP_EQUIPMENT);e.content.equipmentId=t,this.connection.send(e)},EquipUpgrade.prototype.reqActiveEquipment=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_RES_VIRTUAL_WORLD_MINING_MODE_ACTIVE_EQUIPMENT);e.content.equipmentId=t,this.connection.send(e)},EquipUpgrade.prototype.onActiveEquipmend=function(t){var e=t.content;this.mEvent.emit("activeEquip",e.mineEquipment)},EquipUpgrade.prototype.openEquipUpgrade=function(t){var e=t.content;this.mEvent.emit("showopen",e)},EquipUpgrade}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"MarketMediator",(function(){return c}));var n,o=i(233),r=i(237),s=i(119),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function MarketMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.world=n,o.layerManager=e,o.mMarket||(o.mMarket=new r.Market(o.world),o.mMarket.register(),o.mMarket.on("getMarketCategories",o.onCategoriesHandler,o),o.mMarket.on("queryMarket",o.onQueryResuleHandler,o),o.mMarket.on("queryCommodityResource",o.onQueryCommodityResourceHandler,o),o.mMarket.on("showopen",o.onShowOpenPanel,o)),o}return h(MarketMediator,t),MarketMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.MarketPanel(this.scene,this.world),this.mView.on("getCategories",this.onGetCategoriesHandler,this),this.mView.on("queryProp",this.onQueryPropHandler,this),this.mView.on("buyItem",this.onBuyItemHandler,this),this.mView.on("close",this.onCloseHandler,this),this.mView.on("popItemCard",this.onPopItemCardHandler,this),this.mView.on("queryPropResource",this.onQueryPropresouceHandler,this)),t&&t[0]?this.mMarket.setMarketName(t[0].marketName):this.mMarket.setMarketName("shop"),this.mView.show(),this.layerManager.addToUILayer(this.mView))},MarketMediator.prototype.destroy=function(){this.mMarket&&this.mMarket.destroy(),this.mMarket=null,t.prototype.destroy.call(this)},MarketMediator.prototype.onCategoriesHandler=function(t){this.mView.setCategories(t)},MarketMediator.prototype.onQueryResuleHandler=function(t){this.mView.setProp(t)},MarketMediator.prototype.onGetCategoriesHandler=function(){this.mMarket.getMarkCategories()},MarketMediator.prototype.onQueryPropHandler=function(t,e,i){this.mMarket.queryMarket(t,e,i)},MarketMediator.prototype.onBuyItemHandler=function(t){this.mMarket.buyMarketCommodities([t])},MarketMediator.prototype.onQueryPropresouceHandler=function(t){this.mMarket.queryCommodityResource(t.id,t.category)},MarketMediator.prototype.onShowOpenPanel=function(t){this.setParam([t]),this.show([t])},MarketMediator.prototype.onPopItemCardHandler=function(t,e){var i={content:{name:"ItemPopCard",prop:t,display:e}};this.world.emitter.emit(s.a.SHOW_UI,i)},MarketMediator.prototype.onQueryCommodityResourceHandler=function(t){this.mView&&this.mView.setCommodityResource(t)},MarketMediator.prototype.onCloseHandler=function(){t.prototype.destroy.call(this)},MarketMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"MarketPanel",(function(){return y}));var n,o=i(112),r=i(234),s=i(114),a=i(2),h=i(127),c=i(150),l=i(236),p=i(113),d=i(120),m=i(115),u=i(109),f=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),y=function(t){function MarketPanel(e,i){var n=t.call(this,e,i)||this;return n.key="market",n.mSubTabs=[],n.mTabs=[],n}return f(MarketPanel,t),MarketPanel.prototype.addListen=function(){this.mInitialized&&(this.mSelectItem.on("buyItem",this.onBuyItemHandler,this),this.mSelectItem.on("popItemCard",this.onPopItemCardHandler,this),this.mCloseBtn.on("pointerup",this.onCloseHandler,this))},MarketPanel.prototype.removeListen=function(){this.mInitialized&&(this.mSelectItem.off("buyItem",this.onBuyItemHandler,this),this.mSelectItem.off("popItemCard",this.onPopItemCardHandler,this),this.mCloseBtn.off("pointerup",this.onCloseHandler,this))},MarketPanel.prototype.resize=function(t,e){var i=this.scaleWidth,n=this.scaleHeight;this.setSize(i,n),this.mTIle.x=i/2;var o=290*this.dpr;this.mBackgroundColor.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.mShelfContainer.setSize(i,o),this.mShelfContainer.setPosition(0,n-this.mShelfContainer.height),this.mShelfBackground.clear(),this.mShelfBackground.fillStyle(183551),this.mShelfBackground.fillRect(0,0,this.mShelfContainer.width,this.mShelfContainer.height),this.mShelfBackground.y=this.mSubCategeoriesContainer.y+43*this.dpr,this.mSelectItem.resize(i,n),this.mCategoriesBar.clear(),this.mCategoriesBar.fillStyle(4121087),this.mCategoriesBar.fillRect(0,0,i,40*this.dpr),this.mCategoriesBar.fillStyle(308179),this.mCategoriesBar.fillRect(0,40*this.dpr,i,3*this.dpr),this.mSubCategeoriesContainer.setSize(i,43*this.dpr)},MarketPanel.prototype.setCategories=function(t){if(this.mCategoriesContainer){this.mCategoriesContainer.removeAll(!0);var e=t.marketCategory;this.mTabs=[];var i=this.scene.textures.getFrame(this.key,"categories_normal"),n=60;i&&(n=i.width,i.height);for(var o={left:n/2,top:12*this.dpr,right:4*this.dpr,bottom:2*this.dpr},r=new h.CheckboxGroup,s=77*this.dpr,a=38*this.dpr,c=0;c<e.length;c++){var l=new u.NinePatchTabButton(this.scene,s,a,this.key,"categories_normal","categories_down",e[c].category.value,[o],1,1);l.setTextStyle({fontSize:18*this.dpr,fontFamily:p.a.DEFULT_FONT}),this.mTabs[c]=l,l.setData("category",e[c]),l.x=80*c*this.dpr+s/2,l.y=a/2}this.mCategoriesContainer.setSize(this.mTabs.length*s,a),this.mShelfContainer.add(this.mTabs),this.layoutCategories(),r.on("selected",this.onSelectCategoryHandler,this),r.appendItemAll(this.mTabs),r.selectIndex(0)}},MarketPanel.prototype.setProp=function(t){this.clearCategories(this.mItems),this.mItems=[];var e=t.commodities;this.mPropGrid.setItems(e),this.mPropGrid.layout(),this.mPropGrid.setT(0),e.length>0&&this.onSelectItemHandler(e[0])},MarketPanel.prototype.setCommodityResource=function(t){this.mSelectItem&&(this.mSelectItem.setResource(t),this.mSelectItem.setData("display",t))},MarketPanel.prototype.destroy=function(){this.mSubCategorisScroll&&this.mSubCategorisScroll.destroy(),this.mPropGrid&&this.mPropGrid.destroy(),t.prototype.destroy.call(this)},MarketPanel.prototype.layoutCategories=function(){this.mCategoriesBar.y=this.mCategoriesContainer.height+this.mShelfContainer.y,this.mSubCategeoriesContainer.addAt(this.mCategoriesBar,0),this.mPropContainer.y=this.mSubCategeoriesContainer.y+43*this.dpr+this.mSubCategeoriesContainer.height+9*this.dpr,this.mShelfBackground.y=this.mSubCategeoriesContainer.y+43*this.dpr,this.mSubCategorisScroll.y=this.mCategoriesBar.y+25*this.dpr,this.randomCon.y=this.mSubCategorisScroll.y,this.mPropGrid.y=this.mCategoriesBar.y+this.mSubCategeoriesContainer.height+.5*this.mPropGrid.height+5*this.dpr,this.mPropGrid.layout(),this.mSubCategorisScroll.layout(),this.mSubCategorisScroll.resetMask(),this.mPropGrid.resetMask()},MarketPanel.prototype.preload=function(){this.addAtlas(this.key,"market/market.png","market/market.json"),this.addAtlas(m.UIAtlasKey.commonKey,m.UIAtlasName.commonUrl+".png",m.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},MarketPanel.prototype.init=function(){var e=this;if(!this.mInitialized){var i=this.scaleWidth,n=this.scaleHeight;this.mBackgroundColor=this.scene.make.graphics(void 0,!1),this.mBackgroundColor.fillGradientStyle(7304703,7304703,314367,314367),this.mBackgroundColor.fillRect(0,0,i,n),this.add(this.mBackgroundColor),this.mShelfContainer=this.scene.make.container({x:i/2,y:n},!1).setSize(i,290*this.dpr);for(var o=this.scene.textures.getFrame(this.key,"bg"),a=Math.ceil(i/o.width),h=Math.ceil((n-this.mShelfContainer.height+o.height)/o.height),d=0;d<a;d++)for(var f=0;f<h;f++){var y=this.scene.make.image({x:d*o.width,y:f*o.height,key:this.key,frame:"bg"},!1);this.add(y)}this.mShelfBackground=this.scene.make.graphics(void 0,!1),this.mCloseBtn=this.scene.make.image({key:this.key,frame:"back_arrow",x:21*this.dpr,y:30*this.dpr}),this.mCloseBtn.setInteractive(new Phaser.Geom.Rectangle(-28*this.dpr,-20*this.dpr,56*this.dpr,40*this.dpr),Phaser.Geom.Rectangle.Contains),this.mPropContainer=this.scene.make.container(void 0,!1),this.mCategoriesContainer=this.scene.make.container(void 0,!1),this.mSubCategeoriesContainer=this.scene.make.container(void 0,!1),this.mShelfContainer.add([this.mShelfBackground,this.mCategoriesContainer,this.mPropContainer]),this.add([this.mShelfContainer,this.mSubCategeoriesContainer]),this.mSelectItem=new r.ElementDetail(this.scene,this.mWorld,this.key,this.dpr),this.mSelectItem.setSize(i,n-this.mShelfContainer.height),this.mTIle=this.scene.make.text({text:s.a.t("market.title"),y:30*this.dpr,style:{fontSize:36*this.dpr,fontFamily:p.a.DEFULT_FONT}}).setOrigin(.5),this.add([this.mTIle,this.mSelectItem,this.mCloseBtn]),t.prototype.init.call(this),this.mCategoriesBar=this.scene.make.graphics(void 0,!1);var g=56*this.dpr,_=41*this.dpr,P={x:i/2,y:0,table:{width:i,height:50*this.dpr,cellWidth:g,cellHeight:_,reuseCellContainer:!0,zoom:this.scale},scrollMode:1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new c.TextButton(n,e.dpr)),i.getData("item")!==o&&(i.setText(o.value),i.setData({item:o}),o&&e.mPreSubCategoris&&e.mPreSubCategoris.key===o.key?i.changeDown():i.changeNormal()),i}};this.mSubCategorisScroll=new u.GameGridTable(this.scene,P),this.mSubCategorisScroll.on("cellTap",(function(t,i){e.onSelectSubCategoryHandler(t)})),this.add(this.mSubCategorisScroll),this.randomCon=this.scene.make.container(void 0,!1),this.randomCon.x=.5*i,this.randomCon.visible=!1,this.add(this.randomCon),this.randomRefeshTime=this.scene.make.text({x:.5*-i+10*this.dpr,y:-12*this.dpr,text:s.a.t("market.refreshtime"),style:{color:"#007AAE",fontSize:13*this.dpr,fontFamily:p.a.DEFULT_FONT}}).setOrigin(0,.5);var v=80*this.dpr,w=30*this.dpr;this.randomRefreshBtn=new u.NineSliceButton(this.scene,.5*i,this.randomRefeshTime.y,v,w,m.UIAtlasKey.commonKey,"button_g",s.a.t("market.refresh"),this.dpr,this.scale,{left:15*this.dpr,top:15*this.dpr,right:15*this.dpr,bottom:15*this.dpr}),this.randomRefreshBtn.x=.5*i-.5*this.randomRefreshBtn.width-10*this.dpr,this.randomRefreshBtn.setTextOffset(0,5*this.dpr),this.randomRefreshBtn.setTextStyle({color:"#0",fontSize:13*this.dpr,fontFamily:p.a.BOLD_FONT}),this.randomRefreshBtn.setFontStyle("bold"),this.refreshIcon=this.scene.make.image({key:m.UIAtlasKey.commonKey,frame:"iv_coin"}).setScale(.8),this.refreshIcon.setPosition(-10*this.dpr,-8*this.dpr),this.refreshNeedCount=this.scene.make.text({x:0*this.dpr,y:this.refreshIcon.y,text:"100",style:{fontSize:10*this.dpr,fontFamily:p.a.DEFULT_FONT}}).setOrigin(0,.5),this.randomRefreshBtn.add([this.refreshIcon,this.refreshNeedCount]),this.randomCon.add([this.randomRefeshTime,this.randomRefreshBtn]);var S=this.scene.textures.getFrame(this.key,"border"),b=S.width+10*this.dpr,C=S.height+10*this.dpr,T={x:i/2,y:0,table:{width:i,height:224*this.dpr,columns:3,cellWidth:b,cellHeight:C,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0,zoom:this.scale,mask:!1},scroller:{backDeceleration:!1,slidingDeceleration:!1},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new l.MarketItem(n,0,0,e.dpr)),i.setData({item:o}),i.setProp(o),i}};this.mPropGrid=new u.GameGridTable(this.scene,T),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){var i=t.getData("item");i&&e.onSelectItemHandler(i)})),this.add(this.mPropGrid),this.resize(0,0),this.emit("getCategories")}},MarketPanel.prototype.setSelect=function(){},MarketPanel.prototype.clearCategories=function(t){t&&(t.map((function(t){return t.destroy()})),t=void 0)},MarketPanel.prototype.onSelectCategoryHandler=function(t){if(this.mSubCategeoriesContainer){this.mSubCategorisScroll.setT(0),this.mPreSubCategoris=null,this.clearCategories(this.mSubTabs);var e=t.getData("category");if(this.mSelectedCategories=t,e){var i=e.subcategory;if(this.mSubCategorisScroll){this.mSubCategorisScroll.setItems(i),this.mSubCategorisScroll.layout();var n=this.mSubCategorisScroll.getCell(0);this.onSelectSubCategoryHandler(n.container)}}}},MarketPanel.prototype.onSelectSubCategoryHandler=function(t){if(this.mSelectedCategories&&t instanceof c.TextButton){var e=this.mSelectedCategories.getData("category");if(e){var i=t.getData("item");i&&(this.queryProp(e.category.key,i.key),this.mPreSubCategoris=i,this.mPreSubCategorisItem&&this.mPreSubCategorisItem.changeNormal(),t.changeDown(),this.mPreSubCategorisItem=t)}}},MarketPanel.prototype.queryProp=function(t,e){this.emit("queryProp",1,t,e)},MarketPanel.prototype.onSelectItemHandler=function(t){this.mSelectItem.setProp(t),this.mSelectItem.setData("propdata",t),this.emit("queryPropResource",t)},MarketPanel.prototype.onBuyItemHandler=function(t){var e=this,i=this.getBuyPackageData();i.count=t.quantity;var n=i,o=s.a.t("market.payment"),r=this.mSelectItem.getData("display"),a=new d.a(this,(function(){e.emit("buyItem",t)}),[t]);this.showPropFun({confirmHandler:a,data:n,resource:r,slider:!1,title:o})},MarketPanel.prototype.onCloseHandler=function(){this.emit("close")},MarketPanel.prototype.onPopItemCardHandler=function(t,e){t&&this.emit("popItemCard",t,e)},MarketPanel.prototype.getBuyPackageData=function(){var t=this.mSelectItem.getData("propdata"),e=a.op_client.CountablePackageItem.create();return e.id=t.id,e.sellingPrice=t.price[0],e.name=t.name,e.shortName=t.shortName,e},MarketPanel.prototype.showPropFun=function(t){this.mWorld.uiManager.showMed("PicPropFun",t)},MarketPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ElementDetail",(function(){return d}));var n,o=i(235),r=i(2),s=i(114),a=i(130),h=i(113),c=i(111),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function ElementDetail(e,i,n,r){var c=t.call(this,e)||this;c.key=n,c.mWorld=i,c.dpr=r,c.setPosition(0,0),c.mCounter=new o.NumberCounter(c.scene,n,360,700,c.dpr,i.uiScale);var p=c.scene.textures.getFrame(c.key,"yellow_button_normal"),d=60,m=65;p&&(d=p.width,m=p.height),c.mBuyBtn=new l.NineSliceButton(c.scene,440,700,81*c.dpr,41*c.dpr,c.key,"yellow_button",s.a.t("common.buy"),c.dpr,c.scale,{left:14*c.dpr,top:14*c.dpr,right:d-2-14*c.dpr,bottom:m-2-14*c.dpr}),c.mBuyBtn.setTextStyle({color:"#976400",fontSize:16*c.dpr,fontFamily:h.a.DEFULT_FONT}),c.mBuyBtn.setFontStyle("bold"),c.mBuyBtn.on(String(l.ClickEvent.Tap),c.onBuyHandler,c),c.mNickName=c.scene.make.text({x:7*c.dpr,y:9*c.dpr,style:{fontSize:12*c.dpr,fontFamily:h.a.DEFULT_FONT,color:"#FFFF00",align:"center"}}),c.mPriceContainer=c.scene.make.container(void 0,!1),c.mPriceIcon=c.scene.make.image({x:-78,key:c.key,frame:"iv_coin"},!1),c.mPriceText=c.scene.make.text({x:0,style:{fontSize:14*c.dpr,fontFamily:h.a.NUMBER}}).setOrigin(.5);var u=c.scene.make.image({key:c.key,frame:"price_bg"});c.mDetailDisplay=new a.DetailDisplay(c.scene),c.mDetailDisplay.scale=c.dpr,c.mDetailDisplay.y=110*c.dpr;var f=110*c.dpr,y=96*c.dpr;return c.mDetailBubble=c.scene.make.graphics(void 0,!1),c.mDetailBubble.fillStyle(16777215,.1),c.mDetailBubble.fillRoundedRect(0,0,f,y),c.mDetailBubbleContainer=c.scene.make.container(void 0,!1),c.mDetailBubbleContainer.setSize(f,y),c.mDesText=c.scene.make.text({x:8*c.dpr,y:56*c.dpr,style:{color:"#32347b",fontSize:10*c.dpr,fontFamily:h.a.DEFULT_FONT,wordWrap:{width:90*c.dpr,useAdvancedWrap:!0}}},!1),c.mSource=c.scene.make.text({x:8*c.dpr,y:38*c.dpr,style:{fontSize:10*c.dpr,fontFamily:h.a.DEFULT_FONT}},!1),c.add([c.mDetailDisplay,c.mPriceContainer,c.mCounter,c.mBuyBtn,c.mDetailBubbleContainer]),c.mDetailBubbleContainer.add([c.mDetailBubble,c.mNickName,c.mDesText,c.mSource]),c.mPriceContainer.add([u,c.mPriceIcon,c.mPriceText]),c.addActionListener(),c}return p(ElementDetail,t),ElementDetail.prototype.resize=function(t,e){var i=t,n=e/2-150,o=t/2;this.mBuyBtn.x=i-this.mBuyBtn.displayWidth/2-10*this.dpr,this.mBuyBtn.y=this.height-this.y-this.mBuyBtn.displayHeight/2-12*this.dpr;var r=this.mBuyBtn.x-this.mBuyBtn.displayWidth/2-this.mCounter.displayWidth/2-17*this.dpr;this.mCounter.x=r,this.mCounter.y=this.mBuyBtn.y,this.mDetailBubbleContainer.x=10*this.dpr;var s=i-(i-this.mCounter.x)-this.mCounter.width/2;if(this.mDetailBubbleContainer.displayWidth+this.mDetailBubbleContainer.x+10*this.dpr>s){var a=s-16*this.dpr;this.mDesText.setWordWrapWidth(a-10*this.dpr,!0),this.resizeDesBubble(a,this.mDetailBubbleContainer.height)}this.mPriceContainer.x=this.mCounter.x,this.mPriceContainer.y=this.mCounter.y-35*this.dpr,this.mDetailDisplay.x=o,this.mDetailDisplay.y=(this.height-this.y)/2;var h=.8*i,c=.7*n;this.setInteractive(new Phaser.Geom.Rectangle((i>>1)+(i-h>>1),n>>1,h,c),Phaser.Geom.Rectangle.Contains),this.mCounter.resize()},ElementDetail.prototype.addActionListener=function(){this.mCounter&&(this.mCounter.addActionListener(),this.mCounter.on("change",this.onChangeCounterHandler,this),this.on("pointerup",this.onPointerUpHandler,this))},ElementDetail.prototype.removeActionListener=function(){this.mCounter&&(this.mCounter.removeActionListener(),this.mCounter.off("change",this.onChangeCounterHandler,this),this.off("gameobjectup",this.onPointerUpHandler,this))},ElementDetail.prototype.setProp=function(t){this.mSelectedProp=t,this.mNickName.setText(t.shortName||t.name),this.mDesText.setText(t.des),t.price&&t.price.length>0?(this.mPriceIcon.setTexture(this.key,c.f.getIcon(t.price[0].coinType)),this.updatePrice(t.price[0].price.toString())):this.mPriceText.setText(""),t.source?this.mSource.setText("来源： "+t.source):this.mSource.setText(""),this.resizeDesBubble(),this.mCounter.setCounter(1)},ElementDetail.prototype.setResource=function(t){if(t.display)this.mDetailDisplay.loadDisplay(t);else if(t.avatar){var e=this.mWorld.roomManager.currentRoom.playerManager.actor.model.avatar;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n&&!t.avatar[i]&&(t.avatar[i]=n)}var o=new Phaser.Geom.Point(0,70);this.mDetailDisplay.loadAvatar(t,2,o)}else this.mDetailDisplay.loadUrl(this.mSelectedProp.icon)},ElementDetail.prototype.updatePrice=function(t){this.mPriceText.setText(t),this.mPriceIcon.x=this.mPriceText.x-this.mPriceText.width/2-16*this.dpr},ElementDetail.prototype.onBuyHandler=function(){if(this.mSelectedProp){var t=r.op_def.OrderCommodities.create();t.id=this.mSelectedProp.id,t.quantity=this.mCounter.number,t.category=this.mSelectedProp.category,this.emit("buyItem",t)}},ElementDetail.prototype.onChangeCounterHandler=function(t){this.mSelectedProp&&(!this.mSelectedProp.price||this.mSelectedProp.price.length<1||this.updatePrice((this.mSelectedProp.price[0].price*this.mCounter.number).toString()))},ElementDetail.prototype.onPointerUpHandler=function(){this.mCounter.setBlur()},ElementDetail.prototype.resizeDesBubble=function(t,e){void 0===t&&(t=this.mDetailBubbleContainer.width);var i=this.mDesText.height+60*this.dpr;t===this.mDetailBubbleContainer.width&&i===this.mDetailBubbleContainer.height||(this.mDetailBubble.clear(),this.mDetailBubble.fillStyle(16777215,.1),this.mDetailBubble.fillRoundedRect(0,0,t,i),this.mDetailBubbleContainer.setSize(t,i),this.mDetailBubbleContainer.y=this.height-this.y-this.mDetailBubbleContainer.height-6*this.dpr)},ElementDetail}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"NumberCounter",(function(){return s}));var n,o=i(149),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function NumberCounter(e,i,n,r,s,a){void 0===s&&(s=1),void 0===a&&(a=1);var h=t.call(this,e,n,r)||this;return h.pressDelay=500,h.mMinNum=1,h.mMaxNum=99,h.zoom=1,h.zoom=a,h.mBackground=h.scene.make.image({key:i,frame:"input_bg"}),h.mBackground.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),h.mReduceBtn=h.scene.make.image({key:i,frame:"reduce"},!1).setInteractive(),h.mReduceBtn.x=-h.mBackground.displayWidth/2-h.mReduceBtn.displayWidth/2-7*s,h.mReduceBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),h.mIncreaseBtn=h.scene.make.image({key:i,frame:"increase"},!1).setInteractive(),h.mIncreaseBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),h.mIncreaseBtn.x=(h.mBackground.displayWidth+h.mIncreaseBtn.displayWidth)/2+7*s,h.mLabelInput=new o.LabelInput(h.scene,{x:0,y:0,width:h.mBackground.height,height:26*s,fontSize:14*s+"px",color:"#666666",align:"center",type:"number"}),h.mLabelInput.setOrigin(.5),h.mLabelInput.setText("1"),h.mLabelInput.on("textchange",h.onTextChangeHandler,h),h.mLabelInput.on("blur",h.onTextBlurHandler,h),h.mLabelInput.on("focus",h.onFocusHandler,h),h.add([h.mBackground,h.mLabelInput,h.mReduceBtn,h.mIncreaseBtn]),h.setSize(h.mIncreaseBtn.displayWidth+h.mReduceBtn.displayWidth+h.mBackground.displayWidth+14*s,h.mBackground.displayHeight),h}return r(NumberCounter,t),NumberCounter.prototype.resize=function(){},NumberCounter.prototype.setMinNumber=function(t){this.mMinNum=t},NumberCounter.prototype.setMaxNumber=function(t){this.mMaxNum=t},NumberCounter.prototype.addActionListener=function(){this.mIncreaseBtn.on("pointerup",this.onIncreaseHandler,this),this.mIncreaseBtn.on("pointerdown",this.onIncreaseDownHandler,this),this.mReduceBtn.on("pointerup",this.onReduceHandler,this),this.mReduceBtn.on("pointerdown",this.onReduceDownHandler,this)},NumberCounter.prototype.removeActionListener=function(){this.mIncreaseBtn.off("pointerup",this.onIncreaseHandler,this),this.mIncreaseBtn.off("pointerdown",this.onIncreaseDownHandler,this),this.mReduceBtn.off("pointerup",this.onReduceHandler,this),this.mReduceBtn.off("pointerdown",this.onReduceDownHandler,this),this.scene.input.off("pointerdown",this.pointerDownHandler,this)},NumberCounter.prototype.setCounter=function(t){(isNaN(t)||t<0)&&(t=0),t>this.mMaxNum&&(t=this.mMaxNum),this.mLabelInput.setText(t.toString()),this.emit("change",t)},NumberCounter.prototype.setBlur=function(){this.mLabelInput.setBlur()},NumberCounter.prototype.destroy=function(){this.removeActionListener(),t.prototype.destroy.call(this)},Object.defineProperty(NumberCounter.prototype,"number",{get:function(){return parseInt(this.mLabelInput.text,10)},enumerable:!1,configurable:!0}),NumberCounter.prototype.onReduceHandler=function(){var t=parseInt(this.mLabelInput.text,10);--t<this.mMinNum&&(t=this.mMinNum),this.setCounter(t),this.clearTween()},NumberCounter.prototype.onIncreaseHandler=function(){var t=parseInt(this.mLabelInput.text,10);this.setCounter(++t),this.clearTween()},NumberCounter.prototype.onTextChangeHandler=function(){this.setCounter(parseInt(this.mLabelInput.text,10))},NumberCounter.prototype.onTextBlurHandler=function(){var t=parseInt(this.mLabelInput.text,0);t<this.mMinNum?t=this.mMinNum:t>this.mMaxNum&&(t=this.mMaxNum),this.mLabelInput.setText(t.toString()),this.emit("change",t),this.scene.input.off("pointerdown",this.pointerDownHandler,this)},NumberCounter.prototype.onReduceDownHandler=function(){var t=this;this.pressTimeout=setTimeout((function(){t.delayTweenNumber(t.mMinNum)}),this.pressDelay),this.setBlur()},NumberCounter.prototype.onIncreaseDownHandler=function(){var t=this;this.pressTimeout=setTimeout((function(){t.delayTweenNumber(t.mMaxNum)}),this.pressDelay),this.setBlur()},NumberCounter.prototype.delayTweenNumber=function(t){var e=this,i=this.number;this.tween=this.scene.tweens.addCounter({from:i,to:t,onUpdate:function(){e.setCounter(e.tween.getValue()>>0)},duration:50*Math.abs(i-t)})},NumberCounter.prototype.clearTween=function(){clearTimeout(this.pressTimeout),this.tween&&(this.tween.stop(),this.tween=void 0)},NumberCounter.prototype.pointerDownHandler=function(t){this.checkPointerInBounds(this,t)||this.mLabelInput.setBlur()},NumberCounter.prototype.onFocusHandler=function(){this.scene.input.on("pointerdown",this.pointerDownHandler,this)},NumberCounter.prototype.checkPointerInBounds=function(t,e,i){void 0===i&&(i=!1),this.mRectangle||(this.mRectangle=new Phaser.Geom.Rectangle(0,0,0,0));var n=this.zoom?this.zoom:1;if(this.mRectangle.left=-t.width/2,this.mRectangle.right=t.width/2,this.mRectangle.top=-t.height/2,this.mRectangle.bottom=t.height/2,e){var o=t.getWorldTransformMatrix(),r=(e.x-o.tx)/n,s=(e.y-o.ty)/n;return this.mRectangle.left<=r&&this.mRectangle.right>=r&&this.mRectangle.top<=s&&this.mRectangle.bottom>=s}return!1},NumberCounter}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"MarketItem",(function(){return c}));var n,o=i(116),r=i(111),s=i(113),a=i(0),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function MarketItem(e,i,n,r){var a=t.call(this,e,i,n)||this;a.dpr=r,a.mBackground=a.scene.make.image({key:"market",frame:"border"},!1).setOrigin(0),a.mBackground.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),a.mBorder=a.scene.make.image({x:3*r,y:3*r,key:"market",frame:"item_border"},!1).setOrigin(0),a.mBorder.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),a.mPropImage=new o.DynamicImage(e,0,0),a.mPropImage.scale=a.dpr,a.mNickName=a.scene.make.text({x:62*a.dpr,y:6*a.dpr,style:{fontSize:13*a.dpr,fontFamily:s.a.DEFULT_FONT,color:"#3399cc"}},!1),a.mCoinIcon=a.scene.make.image({x:45*a.dpr,y:40*a.dpr,key:"market"},!1).setOrigin(0);var h=a.scene.make.image({x:62*a.dpr,y:39*a.dpr,key:"market",frame:"price_border"},!1).setOrigin(0);return a.mPriceText=a.scene.make.text({x:92*a.dpr,y:49*a.dpr,style:{fontSize:13*a.dpr,fontFamily:s.a.NUMBER,color:"#996600"}}).setOrigin(.5),a.mTagIcon=a.scene.make.image({key:"market",frame:"tip_red",x:-86*a.dpr,y:-34*a.dpr},!1).setOrigin(0),a.add([a.mBackground,a.mBorder,a.mPropImage,a.mNickName,h,a.mCoinIcon,a.mPriceText]),a.setSize(a.mBackground.displayWidth,a.mBackground.displayHeight),a}return h(MarketItem,t),MarketItem.prototype.setProp=function(t){if(this.mProp=t,t.icon){var e=r.i.getOsdRes(t.icon);this.mPropImage.load(e,this,this.onPropLoadComplete)}else a.a.getInstance().error(t.name+" : "+t.id+" icon value is empty");this.mPropImage.x=this.mBorder.x+this.mBorder.displayWidth/2,this.mPropImage.y=this.mBorder.y+this.mBorder.displayHeight/2;var i=t.shortName||t.name;if(i.length>4)for(var n=50*this.dpr,o=4;o<i.length;o++){var s=i.slice(0,o);if(this.mNickName.setText(s).width>n){i=s+="...";break}}this.mNickName.setText(i),this.mPriceText.setText(t.price[0].price.toString());var h=r.f.getIcon(t.price[0].coinType);this.mCoinIcon.setFrame(h)},MarketItem.prototype.onPropLoadComplete=function(){if(this.mPropImage){var t=this.mPropImage.texture;t&&t.setFilter(Phaser.Textures.FilterMode.LINEAR)}},MarketItem.prototype.onPointerUpHandler=function(){this.emit("select",this.mProp)},MarketItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"Market",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Market(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Market,t),Market.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_GET_MARKET_CATEGORIES,this.onGetMarketCategoriesHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY,this.onQueryMarketHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_COMMODITY_RESOURCE,this.onQueryCommodityResultHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MARKET_SHOW_MARKET_BY_NAME,this.openMarketPanel))},Market.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Market.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Market.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Market.prototype.setMarketName=function(t){this.market_name=t},Market.prototype.getMarkCategories=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_GET_CATEGORIES);t.content.marketName=this.market_name,this.connection.send(t)},Market.prototype.queryMarket=function(t,e,i){var n=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_QUERY),s=n.content;s.page=t,s.perPage=1e3,s.category=e,s.subcategory=i,s.marketName=this.market_name,this.connection.send(n)},Market.prototype.buyMarketCommodities=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_BUY_ORDER_COMMODITIES),i=e.content;i.orderCommodities=t,i.marketName=this.market_name,this.connection.send(e)},Market.prototype.queryCommodityResource=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_QUERY_COMMODITY_RESOURCE),n=i.content;n.id=t,n.category=e,n.marketName=this.market_name,this.connection.send(i)},Market.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Market.prototype.onGetMarketCategoriesHandler=function(t){this.mEvent.emit("getMarketCategories",t.content)},Market.prototype.onQueryMarketHandler=function(t){this.mEvent.emit("queryMarket",t.content)},Market.prototype.onQueryCommodityResultHandler=function(t){t.content;t.content.market_name=this.market_name,this.mEvent.emit("queryCommodityResource",t.content)},Market.prototype.openMarketPanel=function(t){var e=t.content;this.mEvent.emit("showopen",e)},Object.defineProperty(Market.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Market}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMainUIMediator",(function(){return h}));var n,o=i(239),r=i(241),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicaMainUIMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,o.mainUI=new r.PicaMainUI(n),o.mainUI.on("updateplayer",o.onUpdatePlayerHandler,o),o.mainUI.on("updateroom",o.onUpdateRoomHandler,o),o}return a(PicaMainUIMediator,t),PicaMainUIMediator.prototype.show=function(t){this.mView?this.update(t):(this.mView||(this.mView=new o.PicaMainUIPanel(this.scene,this.world),this.mView.on("showPanel",this.onShowPanelHandler,this),this.mView.on("openroompanel",this.onOpenRoomHandler,this),this.mView.on("querypraise",this.onQuery_PRAISE_ROOM,this)),this.mView.show(t),this.layerManager.addToUILayer(this.mView),this.onUpdateHandler())},PicaMainUIMediator.prototype.destroy=function(){this.mainUI&&this.mainUI.destroy(),t.prototype.destroy.call(this)},Object.defineProperty(PicaMainUIMediator.prototype,"playerInfo",{get:function(){return this.mPlayerInfo},enumerable:!1,configurable:!0}),Object.defineProperty(PicaMainUIMediator.prototype,"roomInfo",{get:function(){return this.mRoomInfo},enumerable:!1,configurable:!0}),Object.defineProperty(PicaMainUIMediator.prototype,"isSelfRoom",{get:function(){if(!this.playerInfo||!this.roomInfo)return!1;for(var t=this.playerInfo.rooms,e=this.roomInfo.roomId,i=0,n=t;i<n.length;i++){if(n[i].roomId===e)return!0}return!1},enumerable:!1,configurable:!0}),PicaMainUIMediator.prototype.onOpenRoomHandler=function(){!this.roomInfo||"room"!==this.roomInfo.roomType&&"store"!==this.roomInfo.roomType||this.world.uiManager.showMed("PicHouse")},PicaMainUIMediator.prototype.onUpdateHandler=function(){this.mPlayerInfo&&this.mView.updatePlayerInfo(this.mPlayerInfo),this.mRoomInfo&&this.mView.updateRoomInfo(this.mRoomInfo)},PicaMainUIMediator.prototype.onUpdatePlayerHandler=function(t){if(this.mPlayerInfo){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];void 0!==i&&(i instanceof Array?i.length>0&&(this.mPlayerInfo[e]=i):this.mPlayerInfo[e]=i)}}else this.mPlayerInfo=t;this.mView&&this.mView.updatePlayerInfo(t)},PicaMainUIMediator.prototype.onUpdateRoomHandler=function(t){this.mRoomInfo=t,this.mView&&this.mView.updateRoomInfo(t)},PicaMainUIMediator.prototype.onShowPanelHandler=function(t,e){this.mainUI&&this.world&&(this.world.uiManager.showMed(t),"CharacterInfo"===t&&this.mainUI.fetchPlayerInfo())},PicaMainUIMediator.prototype.onQuery_PRAISE_ROOM=function(t){if(this.roomInfo&&("room"===this.roomInfo.roomType||"store"===this.roomInfo.roomType)){var e=this.mRoomInfo.roomId;this.mainUI.query_PRAISE_ROOM(e,t)}},PicaMainUIMediator.NAME="PicaMainUIMediator",PicaMainUIMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMainUIPanel",(function(){return m}));var n,o=i(112),r=i(113),s=i(0),a=i(240),h=i(2),c=i(115),l=i(114),p=i(109),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function PicaMainUIPanel(e,i){var n=t.call(this,e,i)||this;return n.key="main_ui",n.isSceneNameActive=!1,n}return d(PicaMainUIPanel,t),PicaMainUIPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&(this.setInteractive(),this.update(this.mShowData),this.checkUpdateActive())},PicaMainUIPanel.prototype.resize=function(e,i){var n=this.scene.cameras.main.width/this.scale,o=this.scene.cameras.main.height/this.scale;t.prototype.resize.call(this,n,o),this.mCoinValue.x=n-this.mCoinValue.width/2-5*this.dpr,this.mDiamondValue.x=n-this.mDiamondValue.width/2-5*this.dpr},PicaMainUIPanel.prototype.preload=function(){this.addAtlas(this.key,"main_ui/mainui.png","main_ui/mainui.json"),this.addAtlas(c.UIAtlasKey.commonKey,c.UIAtlasName.commonUrl+".png",c.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},PicaMainUIPanel.prototype.addListen=function(){this.mInitialized&&(this.roomCon?this.roomCon.on("pointerup",this.onOpenRoomPanel,this):s.a.getInstance().fatal(PicaMainUIPanel.name+": sceneName does not exist!"))},PicaMainUIPanel.prototype.removeListen=function(){this.mInitialized&&(this.roomCon?this.roomCon.off("pointerup",this.onOpenRoomPanel,this):s.a.getInstance().fatal(PicaMainUIPanel.name+": sceneName does not exist!"))},PicaMainUIPanel.prototype.update=function(e){var i;t.prototype.update.call(this),e&&e.length>0&&(i=e[0]),i&&(i instanceof h.op_client.OP_VIRTUAL_WORLD_REQ_CLIENT_PKT_PLAYER_INFO?this.playerInfo=i:this.roomInfo=i),this.playerInfo&&this.updatePlayerInfo(this.playerInfo),this.roomInfo&&this.updateRoomInfo(this.roomInfo)},PicaMainUIPanel.prototype.updatePlayerInfo=function(t){if(this.playerInfo=t,this.mInitialized){if(t.level){var e=t.level;void 0===e.currentLevelExp||e.currentLevelExp;this.playerLv.text=e.level+""}if(void 0!==t.coin&&this.mCoinValue.setText(t.coin.toString()),void 0!==t.diamond&&this.mDiamondValue.setText(t.diamond.toString()),t.energy){var i=t.energy;i?this.mStrengthValue.setValue(i.currentValue,i.max):this.mStrengthValue.setValue(0,100)}this.mSceneName.rightIcon.visible=this.isSelfRoom}},PicaMainUIPanel.prototype.updateRoomInfo=function(t){this.roomInfo=t,this.mInitialized&&(t.name&&(this.mSceneName.setText(t.name),this.roomCon.setSize(2*this.mSceneName.rightbound,30*this.dpr),this.roomCon.setInteractive(),this.isSceneNameActive=!0),t.playerCount&&(this.mCounter.setText(""+t.playerCount),this.mCounter.x=this.mSceneName.x+this.mSceneName.rightbound+5*this.dpr),this.praiseBtn.visible=!1,t.roomType&&("room"!==t.roomType&&"store"!==t.roomType||(this.praiseBtn.visible=!0),this.praiseBtn.setText(t.praise+""),this.praiseBtn.selected=t.hasPraised,t.hasPraised?(this.praiseBtn.setTextColor("#8E99C1"),this.praiseImg.setFrame("praise_after")):(this.praiseBtn.setTextColor("#ffffff"),this.praiseImg.setFrame("praise_before"))),this.mSceneName.rightIcon.visible=this.isSelfRoom,this.partyBtn.visible=this.isSelfRoom)},Object.defineProperty(PicaMainUIPanel.prototype,"isSelfRoom",{get:function(){if(!this.playerInfo||!this.roomInfo)return!1;for(var t=this.playerInfo.rooms,e=this.roomInfo.roomId,i=0,n=t;i<n.length;i++){if(n[i].roomId===e)return!0}return!1},enumerable:!1,configurable:!0}),PicaMainUIPanel.prototype.updateUIState=function(t){this.mInitialized&&("mainui.playerinfo"===t.name&&(this.playerCon.visible=t.visible),"mainui.roominfo"===t.name&&(this.roomCon.visible=t.visible),"mainui.headbtn"===t.name&&(t.disabled?this.playerIcon.removeInteractive():this.playerIcon.setInteractive()),"mainui.entereditorbtn"===t.name&&(this.mSceneName.visible=t.visible,this.isSceneNameActive&&(t.disabled?this.roomCon.removeInteractive():(this.roomCon.setSize(2*this.mSceneName.rightbound,30*this.dpr),this.roomCon.setInteractive()))))},PicaMainUIPanel.prototype.init=function(){var e=this.scene.cameras.main.width,i=this.scene.cameras.main.height;this.playerCon=this.scene.make.container(void 0,!1),this.playerCon.y=25*this.dpr,this.add(this.playerCon),this.mCoinValue=new u(this.scene,this.key,"coin",this.dpr),this.mDiamondValue=new u(this.scene,this.key,"diamond",this.dpr),this.mDiamondValue.y=35*this.dpr;var n=this.scene.textures.getFrame(this.key,"strength_progress");this.mStrengthValue=new g(this.scene,this.key,"strength_icon",this.dpr),this.mStrengthValue.x=76*this.dpr;var o=new p.NineSlicePatch(this.scene,68*this.dpr/2,this.mStrengthValue.height/2-n.height-1*this.dpr,92*this.dpr,n.height,this.key,"strength_progress",{left:8*this.dpr,top:3*this.dpr,right:n.width-2-8*this.dpr,bottom:n.height-1-3*this.dpr});this.mStrengthValue.setProgress(o,this.scale),this.playerIcon=this.scene.make.image({key:this.key,frame:"head"}),this.playerIcon.x=.5*-this.mStrengthValue.width-8*this.dpr,this.mStrengthValue.add(this.playerIcon),this.playerIcon.on("pointerup",this.onHeadHandler,this),this.playerIcon.setInteractive(),this.mStrengthValue.setValue(1e3,1e3),this.mStrengthValue.setInteractive(),this.mStrengthValue.on("pointerup",this.onStrengthHandler,this);var s=this.playerIcon.x+.5*this.playerIcon.width-2*this.dpr,h=this.playerIcon.y+.5*this.playerIcon.height-10*this.dpr;this.playerLv=this.scene.make.text({text:"0",x:s,y:h,style:{fontSize:11*this.dpr,bold:!0,fontFamily:r.a.DEFULT_FONT,color:"#356EE3"}},!1).setOrigin(1,0),this.playerLv.setShadow(0,0,"#ffffff",2),this.playerLv.setStroke("#356EE3",2),this.playerLv.setShadowStroke(!0),this.mStrengthValue.add(this.playerLv),this.playerCon.add([this.mStrengthValue,this.mCoinValue,this.mDiamondValue]),this.roomCon=this.scene.make.container(void 0,!1),this.roomCon.y=this.playerCon.y+32*this.dpr,this.add(this.roomCon),this.mSceneName=new y(this.scene,this.key,"room_icon","setting_icon",this.dpr),this.mSceneName.setText(""),this.mSceneName.x=18*this.dpr,this.mCounter=new f(this.scene,c.UIAtlasKey.commonKey,"home_persons",this.dpr),this.mCounter.setText(""),this.mCounter.x=this.mSceneName.x+this.mSceneName.rightbound+5*this.dpr,this.mCounter.y=this.mSceneName.y,this.mCounter.setColor("#28D5F5"),this.textToolTip=new a.TextToolTips(this.scene,c.UIAtlasKey.commonKey,"tips_bg",this.dpr,this.scale),this.textToolTip.setSize(160*this.dpr,45).visible=!1,this.praiseBtn=new p.CheckBox(this.scene,this.key,"praise_before_bg","praise_after_bg","1"),this.praiseBtn.y=this.mSceneName.y+this.mSceneName.height+.5*this.praiseBtn.height+20*this.dpr,this.praiseBtn.x=8*this.dpr+.5*this.praiseBtn.width,this.praiseBtn.setTextStyle({fontSize:11*this.dpr,fontFamily:r.a.DEFULT_FONT}),this.praiseBtn.setTextOffset(10*this.dpr,0),this.praiseBtn.on(String(p.ClickEvent.Tap),this.onPraiseHandler,this),this.praiseImg=this.scene.make.image({key:this.key,frame:"praise_before"}),this.praiseImg.x=-10*this.dpr,this.praiseBtn.add(this.praiseImg),this.partyBtn=new p.Button(this.scene,this.key,"home_party_bg","home_party_bg",l.a.t("main_ui.party")),this.partyBtn.x=this.praiseBtn.x+.5*this.praiseBtn.width+.5*this.partyBtn.width+5*this.dpr,this.partyBtn.y=this.praiseBtn.y,this.partyBtn.setTextOffset(8*this.dpr,0),this.partyBtn.setTextStyle({fontSize:11*this.dpr,fontFamily:r.a.DEFULT_FONT}),this.partyBtn.on(String(p.ClickEvent.Tap),this.onPartyHandler,this),this.roomCon.add([this.mSceneName,this.mCounter,this.praiseBtn,this.partyBtn,this.textToolTip]),this.roomCon.setSize(2*this.mSceneName.rightbound,30*this.dpr),this.resize(e,i),t.prototype.init.call(this)},PicaMainUIPanel.prototype.onOpenRoomPanel=function(){this.emit("openroompanel")},PicaMainUIPanel.prototype.onHeadHandler=function(){this.emit("showPanel","CharacterInfo")},PicaMainUIPanel.prototype.onStrengthHandler=function(){if(this.playerInfo){var t=this.playerInfo.energy,e=t.currentValue+"/"+t.max+"\n",i=l.a.t("main_ui.energy_tips",{name:e,interpolation:{escapeValue:!1}});this.textToolTip.setTextData(i,3e3),this.textToolTip.setPosition(120*this.dpr,20*this.dpr)}},PicaMainUIPanel.prototype.checkUpdateActive=function(){var t=this.mWorld.uiManager.getActiveUIData("PicaMainUI");if(t)for(var e=0,i=t;e<i.length;e++){var n=i[e];this.updateUIState(n)}},PicaMainUIPanel.prototype.onPraiseHandler=function(t,e){this.emit("querypraise",e.selected)},PicaMainUIPanel.prototype.onPartyHandler=function(){this.emit("showPanel","PicOpenParty")},PicaMainUIPanel}(o.BasePanel),u=function(t){function ValueContainer(e,i,n,o){void 0===o&&(o=1);var r=t.call(this,e)||this;return r.init(i,n,o),r}return d(ValueContainer,t),ValueContainer.prototype.setText=function(t){this.mText.setText(t)},ValueContainer.prototype.init=function(t,e,i){var n=this.scene.make.image({key:t,frame:"home_progress_bottom"},!1);this.mLeft=this.scene.make.image({key:t,frame:e},!1),this.mText=this.scene.make.text({text:"0",width:n.width,height:n.height,style:{fontSize:14*i,fontFamily:r.a.NUMBER}},!1).setOrigin(.5),this.mText.setStroke("#000000",1*i),this.mAddBtn=this.scene.make.image({key:t,frame:"add_btn"}),this.setSize(n.width,n.height),this.mLeft.x=.5*-n.width,this.mLeft.y=n.y+.5*n.height-.5*this.mLeft.height,this.mAddBtn.x=this.width*this.originX-this.mAddBtn.width*this.originX-5*i,this.mText.x=10*i,this.add([n,this.mLeft,this.mText,this.mAddBtn])},ValueContainer}(Phaser.GameObjects.Container),f=function(t){function IconText(e,i,n,o){void 0===o&&(o=1);var s=t.call(this,e)||this,a=e.make.image({key:i,frame:n},!1);return s.mText=e.make.text({style:{fontSize:14*o,fontFamily:r.a.DEFULT_FONT}},!1).setOrigin(0,.5),s.mText.x=a.width/2+4*o,s.mText.setStroke("#000000",2*o),s.add([a,s.mText]),s}return d(IconText,t),IconText.prototype.setText=function(t){this.mText.setText(t)},IconText.prototype.setStroke=function(t,e){this.mText.setStroke(t,e)},IconText.prototype.setColor=function(t){this.mText.setColor(t)},IconText}(Phaser.GameObjects.Container),y=function(t){function SceneName(e,i,n,o,r){void 0===r&&(r=1);var s=t.call(this,e,i,n,r)||this;return s.mDpr=r,s.mRightIcon=e.make.image({y:2*r,key:i,frame:o},!1),s.add(s.mRightIcon),s.mRightIcon.y=8*r,s.mRightIcon.x=10*r,s}return d(SceneName,t),SceneName.prototype.setText=function(e){t.prototype.setText.call(this,e)},Object.defineProperty(SceneName.prototype,"rightbound",{get:function(){return this.mText.x+this.mText.width+10*this.mDpr},enumerable:!1,configurable:!0}),Object.defineProperty(SceneName.prototype,"rightIcon",{get:function(){return this.mRightIcon},enumerable:!1,configurable:!0}),SceneName}(f),g=(function(t){function ExpProgress(e,i,n,o,s){var a=t.call(this,e)||this,h=s.getSize().width/o,c=a.scene.textures.getFrame(i,"exp_bg");a.setSize(h,c.height);var l=a.width,d=a.height;a.mProgressBar=new _(e,n),a.mProgressBar.setSize(a.width,a.height);var m=new p.NineSlicePatch(a.scene,l/2,d/2,l,d,i,"exp_bg",{left:8*n,top:3*n,right:c.width-2-8*n,bottom:c.height-1-3*n});a.mProgressBar.setBackground(m),c=a.scene.textures.getFrame(i,"exp_progress");var u=new p.NineSlicePatch(a.scene,l/2,d/2,h,c.height,i,"exp_progress",{left:8*n,top:3*n,right:c.width-2-10*n,bottom:c.height-1-5*n});return a.mProgressBar.setProgress(u,o),a.mProgressBar.setRatio(.5),a.mCurrentLv=e.make.text({text:"57",style:{fontSize:10*n,fontFamily:r.a.DEFULT_FONT}},!1),a.mCurrentLv.setStroke("#000000",1*n),a.mNextLv=e.make.text({text:"58",style:{fontSize:10*n,fontFamily:r.a.DEFULT_FONT}},!1).setOrigin(0,0),a.mNextLv.setStroke("#000000",1*n),a.mNextLv.x=a.width-a.mNextLv.width,a.add([a.mProgressBar,a.mCurrentLv,a.mNextLv]),a}d(ExpProgress,t),ExpProgress.prototype.setLv=function(t,e){this.mCurrentLv.setText(t.toString()),this.mNextLv.setText((t+1).toString()),this.mNextLv.x=this.width-this.mNextLv.width,this.mProgressBar.setRatio(e)}}(Phaser.GameObjects.Container),function(t){function ProgressValue(e,i,n,o){return t.call(this,e,i,n,o)||this}return d(ProgressValue,t),ProgressValue.prototype.setProgress=function(t,e){this.mProgress.setProgress(t,e)},ProgressValue.prototype.setValue=function(t,e){this.mText&&(this.mText.text=t+"/"+e,this.mProgress.setRatio(t/e))},ProgressValue.prototype.setInteractive=function(e){return e=e||new Phaser.Geom.Rectangle(0,0,this.width,this.height),t.prototype.setInteractive.call(this,e,Phaser.Geom.Rectangle.Contains),this},ProgressValue.prototype.init=function(t,e,i){var n=this.scene.make.image({key:t,frame:"home_progress_bottom"},!1);this.setSize(n.width,n.height),this.mLeft=this.scene.make.image({key:t,frame:e},!1),this.mProgress=new _(this.scene,i),this.mProgress.x=-this.width/2+10*i,this.mProgress.y=4*i,this.mText=this.scene.make.text({text:"0",width:n.width,height:n.height,style:{fontSize:10*i,fontFamily:r.a.NUMBER}},!1).setOrigin(.5),this.mText.setStroke("#000000",1*i),this.mAddBtn=this.scene.make.image({key:t,frame:"add_btn"}),this.setSize(n.width,n.height),this.mLeft.x=-this.width*this.originX+13*i,this.mAddBtn.x=this.width*this.originX-10*i,this.add([n,this.mProgress,this.mLeft,this.mText,this.mAddBtn])},ProgressValue}(u)),_=function(t){function ProgressBar(e,i){var n=t.call(this,e)||this;return n.dpr=i,n}return d(ProgressBar,t),ProgressBar.prototype.setBackground=function(t){this.addAt(t,0)},ProgressBar.prototype.setProgress=function(t,e){this.mScale=e,this.mProgress=t,this.add(this.mProgress),this.setSize(t.width*this.mScale,t.height*this.mScale);var i=t.getWorldTransformMatrix();this.worldpos=new Phaser.Geom.Point(i.tx,i.ty),this.mMaskGraphics=this.scene.make.graphics(void 0,!1),this.mMaskGraphics.fillStyle(16750848),this.mMaskGraphics.fillRect(0,0,this.width,this.height+8*this.dpr),this.mProgress.mask=new Phaser.Display.Masks.GeometryMask(this.scene,this.mMaskGraphics),this.mMaskGraphics.y=i.ty+this.height+4*this.dpr,this.mMaskGraphics.x=i.tx},ProgressBar.prototype.setRatio=function(t){this.mMaskGraphics&&(this.mMaskGraphics.x=this.worldpos.x+4*this.dpr-.5*this.mProgress.width+(this.width*t-this.width))},ProgressBar}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"TextToolTips",(function(){return h}));var n,o=i(117),r=i(113),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function TextToolTips(e,i,n,a,h){var c=t.call(this,e)||this,l=e.textures.getFrame(i,n),p=l.width,d=l.height;return c.dpr=a,c.bg=new o.NinePatch(c.scene,0,0,p,d,i,n,{left:20*a,top:20*a,right:20*a,bottom:20*a}),c.text=new s.BBCodeText(c.scene,0,0,"蓝矿石",{color:"#333333",fontSize:13*c.dpr,fontFamily:r.a.DEFULT_FONT,wrap:{width:90*c.dpr,mode:"string"}}).setOrigin(0),c.add([c.bg,c.text]),c.setSize(p+20*a,d+20*a),c}return a(TextToolTips,t),TextToolTips.prototype.setSize=function(e,i){t.prototype.setSize.call(this,e,i),this.bg.resize(e,i),this.bg.setPosition(0,0);var n=e-16*this.dpr,o=i-16*this.dpr;return this.text.setSize(n,o),this.text.setWrapWidth(n),this.text.setPosition(.5*-n,.5*-o),this},TextToolTips.prototype.setText=function(t){this.text.text=t,this.text.height>this.height&&this.setSize(this.width,this.text.height+16*this.dpr)},TextToolTips.prototype.setTextData=function(t,e){var i=this;this.visible=!0,this.setText(t),this.timeID&&clearTimeout(this.timeID),this.timeID=setTimeout((function(){i.visible=!1}),e)},TextToolTips}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMainUI",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicaMainUI(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i.register(),i}return s(PicaMainUI,t),PicaMainUI.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicaMainUI.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicaMainUI.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_PKT_PLAYER_INFO,this.onUpdatePlayerInfo),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ROOM_INFO,this.onUpdateModeRoomInfo))},PicaMainUI.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicaMainUI.prototype.destroy=function(){this.unregister()},PicaMainUI.prototype.query_PRAISE_ROOM=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_PRAISE_ROOM),n=i.content;n.roomId=t,n.praise=e,this.connection.send(i)},PicaMainUI.prototype.fetchPlayerInfo=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_SELF_PLAYER_INFO);this.connection.send(t)},PicaMainUI.prototype.onUpdatePlayerInfo=function(t){this.mEvent.emit("updateplayer",t.content)},PicaMainUI.prototype.onUpdateModeRoomInfo=function(t){this.mEvent.emit("updateroom",t.content)},Object.defineProperty(PicaMainUI.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicaMainUI}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicFurniFunMediator",(function(){return c}));var n,o=i(2),r=i(243),s=i(244),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicFurniFunMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o.picFurni||(o.picFurni=new s.PicFurniFun(o.world),o.picFurni.register(),o.picFurni.on("openview",o.onOpenView,o)),o}return h(PicFurniFunMediator,t),PicFurniFunMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new r.PicFurniFunPanel(this.scene,this.world),this.mView.on("close",this.onCloseHandler,this),this.mView.on("queryunlock",this.queryUnlockElement,this)),this.mView.show(this.mParam)),this.layerManager.addToUILayer(this.mView)},PicFurniFunMediator.prototype.getView=function(){return this.mView},PicFurniFunMediator.prototype.destroy=function(){this.picFurni&&this.picFurni.destroy(),t.prototype.destroy.call(this)},Object.defineProperty(PicFurniFunMediator.prototype,"playerData",{get:function(){var t=this.world.user;if(t&&t.bag)return t.bag.playerData},enumerable:!1,configurable:!0}),PicFurniFunMediator.prototype.onCloseHandler=function(){t.prototype.destroy.call(this)},PicFurniFunMediator.prototype.onOpenView=function(t){t.materials&&this.updateMaterials(t.materials),this.setParam(t),this.show()},PicFurniFunMediator.prototype.queryUnlockElement=function(t){this.picFurni.queryUnlockElement(t)},PicFurniFunMediator.prototype.updateMaterials=function(t){if(this.playerData&&t)for(var e=0,i=t;e<i.length;e++){var n=i[e],r=this.playerData.getItemsCount(o.op_pkt_def.PKT_PackageType.PropPackage,n.id,n.subcategory);n.count=r}},PicFurniFunMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicFurniFunPanel",(function(){return f}));var n,o=i(113),r=i(116),s=i(2),a=i(112),h=i(111),c=i(114),l=i(115),p=i(130),d=i(109),m=i(129),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function PicFurniFunPanel(e,i){var n=t.call(this,e,i)||this;return n.key="furni_unlock",n}return u(PicFurniFunPanel,t),PicFurniFunPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,n,o),this.blackGraphic.clear(),this.blackGraphic.fillStyle(0,.66),this.blackGraphic.fillRect(0,0,n,o),this.content.x=Math.floor(n/2),this.content.y=Math.floor(o/2),this.setSize(n*this.scale,o*this.scale),this.materialGameScroll.refreshMask()},PicFurniFunPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen(),this.updateData()):this.preload())},PicFurniFunPanel.prototype.addListen=function(){this.mInitialized&&(this.confirmBtn.on(d.ClickEvent.Tap,this.onConfirmBtnClick,this),this.closeBtn.on("pointerup",this.OnClosePanel,this))},PicFurniFunPanel.prototype.removeListen=function(){this.mInitialized&&(this.confirmBtn.off("click",this.onConfirmBtnClick,this),this.closeBtn.on("pointerup",this.OnClosePanel,this))},PicFurniFunPanel.prototype.preload=function(){this.addAtlas(this.key,"furni_unlock/furni_unlock.png","furni_unlock/furni_unlock.json"),this.addAtlas(l.UIAtlasKey.commonKey,l.UIAtlasName.commonUrl+".png",l.UIAtlasName.commonUrl+".json"),this.addAtlas(l.UIAtlasKey.common2Key,l.UIAtlasName.common2Url+".png",l.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicFurniFunPanel.prototype.init=function(){var e=this,i=this.cameraWidth,n=this.cameraHeight;this.blackGraphic=this.scene.make.graphics(void 0,!1),this.blackGraphic.setInteractive(new Phaser.Geom.Rectangle(0,0,i/this.scale,n/this.scale),Phaser.Geom.Rectangle.Contains),this.add(this.blackGraphic),this.content=this.scene.make.container(void 0,!1);var r=295*this.dpr,s=400*this.dpr;this.content.setSize(r,s),this.add(this.content),this.bg=new d.NineSlicePatch(this.scene,0,0,r,s,l.UIAtlasKey.common2Key,"bg",{left:20*this.dpr,top:20*this.dpr,right:20*this.dpr,bottom:40*this.dpr}),this.content.add(this.bg);var a=.5*-this.bg.height;this.titleimage=this.scene.make.image({x:0,y:a+5*this.dpr,key:l.UIAtlasKey.common2Key,frame:"title"},!1),this.titleName=this.scene.make.text({x:0,y:this.titleimage.y+2*this.dpr,text:c.a.t("furni_unlock.title"),style:{color:"#905B06",fontFamily:o.a.EN_BOLD,bold:!0,fontSize:16*this.dpr}}).setOrigin(.5,.5).setStroke("#905B06",2),this.closeBtn=this.scene.make.image({x:.5*this.bg.width-5*this.dpr,y:a+5*this.dpr,key:l.UIAtlasKey.commonKey,frame:"close"}).setScale(1.3),this.closeBtn.setInteractive(),this.content.add([this.titleimage,this.titleName,this.closeBtn]),this.itemName=this.scene.make.text({x:0,y:this.titleimage.y+.5*this.titleimage.height+13*this.dpr,text:"",style:{color:"#FFC51A",fontFamily:o.a.DEFULT_FONT,bold:!0,fontSize:14*this.dpr}}).setStroke("#FFC51A",4).setShadow(0,0,"#000000",2,!0).setOrigin(.5),this.content.add(this.itemName),this.bgicon=this.scene.make.image({key:this.key,frame:"bg_f"}),this.bgicon.y=this.itemName.y+.5*this.bgicon.height+13*this.dpr,this.content.add([this.bg,this.bgicon]),this.mDetailDisplay=new p.DetailDisplay(this.scene),this.mDetailDisplay.setTexture(this.key,"bg_f"),this.mDetailDisplay.y=this.bgicon.y,this.mDetailDisplay.scale=this.dpr/this.scale,this.mDetailDisplay.setSize(72*this.dpr,72*this.dpr),this.content.add(this.mDetailDisplay);var h=360*this.dpr,u=92*this.dpr;this.materialCon=this.scene.make.container(void 0,!1).setSize(h,u),this.content.add(this.materialCon),this.materialCon.setPosition(0,-a-.5*u-66*this.dpr);var f=this.scene.make.text({x:0,y:.5*-u+12*this.dpr,text:c.a.t("furni_unlock.needMaterials"),style:{color:"#253FCA",fontSize:12*this.dpr,fontFamily:o.a.DEFULT_FONT}},!1).setOrigin(.5),y=this.scene.make.image({key:this.key,frame:"sourcelist_title"}),g=this.scene.make.image({key:this.key,frame:"sourcelist_title"}),_=.5*-f.width-.5*y.width-10*this.dpr;y.setPosition(_,f.y),g.setPosition(-_,f.y).rotation=-Math.PI,this.materialCon.add([f,y,g]),this.materialGameScroll=new d.GameScroller(this.scene,{x:0,y:2*this.dpr,width:240*this.dpr,height:90*this.dpr,zoom:this.scale,dpr:this.dpr,align:2,orientation:1,space:20*this.dpr,valuechangeCallback:void 0,cellupCallBack:function(t){e.onMaterialItemHandler(t)}}),this.materialCon.add(this.materialGameScroll);var P=145*this.dpr,v=55*this.dpr;this.itemtips=new m.ItemInfoTips(this.scene,P,v,l.UIAtlasKey.common2Key,"tips_bg",this.dpr,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr}),this.itemtips.x=.5*-this.width+.5*P+10*this.dpr,this.itemtips.y=.5*-this.height+70*this.dpr,this.itemtips.visible=!1,this.content.add(this.itemtips),this.confirmBtn=new d.NineSliceButton(this.scene,0,-a-35*this.dpr,100*this.dpr,40*this.dpr,l.UIAtlasKey.commonKey,"yellow_btn_over",c.a.t("furni_unlock.unlock"),this.dpr,this.scale,{left:15*this.dpr,top:15*this.dpr,right:15*this.dpr,bottom:15*this.dpr}),this.confirmBtn.setTextStyle({color:"#976400",fontSize:12*this.dpr,fontFamily:o.a.BOLD_FONT,bold:!0,stroke:"#976400",strokeThickness:2}),this.confirmBtn.setTextOffset(10*this.dpr,0);var w=this.scene.make.image({key:this.key,frame:"repair_icon"});w.x=-28*this.dpr,this.confirmBtn.add(w),this.content.add(this.confirmBtn),this.resize(0,0),t.prototype.init.call(this)},PicFurniFunPanel.prototype.destroy=function(){this.confirmBtn&&this.confirmBtn.destroy(),this.confirmBtn=null,t.prototype.destroy.call(this)},PicFurniFunPanel.prototype.updateData=function(){var t=this.mShowData;if(t.ids){var e=this.mWorld.roomManager.currentRoom.elementManager.get(t.ids[0]);if(e){var i=e.model.displayInfo,n=new s.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_COMMODITY_RESOURCE;n.display=i.display;var o=i.createProtocolObject();if(o.length>1){for(var r=[],a=0,h=o;a<h.length;a++){var c=h[a];"lock"!==c.node.name&&(c.frameName=c.layer[0].frameName,r.push(c))}0===r.length&&r.push(o[0]),n.animations=r}else n.animations=o;this.mDetailDisplay.loadDisplay(n),this.itemName.text=e.model.nickname,this.setMaterialItems(t.materials)}}},PicFurniFunPanel.prototype.setMaterialItems=function(t){var e=t.length;this.materialGameScroll.clearItems();for(var i=0;i<e;i++){var n=new y(this.scene,this.key,this.dpr);n.y=0,n.setItemData(t[i]),n.setData("itemData",t[i]),this.materialGameScroll.addItem(n)}this.materialGameScroll.Sort()},PicFurniFunPanel.prototype.onConfirmBtnClick=function(){var t=this.showData;t&&t.ids&&(this.emit("queryunlock",t.ids),this.emit("close"))},PicFurniFunPanel.prototype.OnClosePanel=function(){this.emit("close")},PicFurniFunPanel.prototype.onMaterialItemHandler=function(t){this.itemtips.visible=!1,this.selectMaterial&&this.selectMaterial!==t&&(this.selectMaterial.select=!1),t.select=!t.select,t.select&&(this.itemtips.setItemData(t.itemData),this.itemtips.visible=!0),this.selectMaterial=t,this.setTipsPosition(t)},PicFurniFunPanel.prototype.setTipsPosition=function(t){for(var e=t.x,i=t.y,n=t;n.parentContainer!==this.content;)e+=n.parentContainer.x,i+=n.parentContainer.y,n=n.parentContainer;e-.5*this.itemtips.width<.5*-this.content.width?this.itemtips.x=.5*this.itemtips.width-.5*this.content.width+20*this.dpr:e+.5*this.itemtips.width>.5*this.content.width?this.itemtips.x=.5*this.content.width-.5*this.itemtips.width-20*this.dpr:this.itemtips.x=e,this.itemtips.y=i-.5*this.itemtips.height+5*this.dpr},PicFurniFunPanel}(a.BasePanel),y=function(t){function MaterialItem(e,i,n){var s=t.call(this,e)||this;return s.mselect=!1,s.dpr=n,s.key=i,s.bg=s.scene.make.image({key:s.key,frame:"bg_m"}),s.itemIcon=new r.DynamicImage(e,0,0),s.itemCount=new d.BBCodeText(s.scene,0,15*n,"10/20",{color:"#000000"}).setOrigin(.5).setFontSize(11*n).setFontFamily(o.a.DEFULT_FONT),s.add([s.bg,s.itemIcon,s.itemCount]),s.setSize(s.bg.width,s.bg.height),s.itemCount.y=.5*s.height+8*n,s}return u(MaterialItem,t),MaterialItem.prototype.setItemData=function(t){var e=this;this.itemData=t,this.itemCount.text=this.getCountText(t.count,t.neededCount);var i=h.i.getOsdRes(t.display.texturePath);this.itemIcon.load(i,this,(function(){e.itemIcon.scale=e.dpr,e.itemIcon.setPosition(0,0)}))},Object.defineProperty(MaterialItem.prototype,"select",{get:function(){return this.mselect},set:function(t){this.bg.setFrame(t?"bg_select":"bg_m"),this.mselect=t},enumerable:!1,configurable:!0}),MaterialItem.prototype.getCountText=function(t,e){var i=t>=e?"#000000":"#ff0000";return"[stroke="+i+"][color="+i+"]"+t+"[/color][/stroke]/"+e},MaterialItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicFurniFun",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicFurniFun(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicFurniFun,t),PicFurniFun.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_UNLOCK_ELEMENT_REQUIREMENT,this.onRetOpenPanel))},PicFurniFun.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicFurniFun.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicFurniFun.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicFurniFun.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},PicFurniFun.prototype.queryUnlockElement=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_UNLOCK_ELEMENT);e.content.ids=t,this.connection.send(e)},PicFurniFun.prototype.onRetOpenPanel=function(t){var e=t.content;this.mEvent.emit("openview",e)},Object.defineProperty(PicFurniFun.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicFurniFun}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicHandheld",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicHandheld(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicHandheld,t),PicHandheld.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_HANDHELD,this.onRetHandheldList))},PicHandheld.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicHandheld.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicHandheld.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicHandheld.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicHandheld.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicHandheld.prototype.queryChangeHandheld=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_PICK_HANDHELD);e.content.id=t,this.connection.send(e)},PicHandheld.prototype.queryClearHandheld=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_DROP_HANDHELD);this.connection.send(t)},PicHandheld.prototype.queryHandheldList=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_HANDHELD);this.connection.send(t)},PicHandheld.prototype.onRetHandheldList=function(t){var e=t.content;this.mEvent.emit("handheldlist",e)},PicHandheld}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicHandheldPanel",(function(){return p}));var n,o=i(112),r=i(2),s=i(116),a=i(120),h=i(111),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function PicHandheldPanel(e,i){var n=t.call(this,e,i)||this;return n.key="pichandheldpanel",n.isExtendsGrid=!1,n}return l(PicHandheldPanel,t),PicHandheldPanel.prototype.resize=function(t,e){this.scale;var i=this.scaleWidth,n=this.scaleHeight;this.setSize(i,n),this.updateLayout(),this.isExtendsGrid=!1},PicHandheldPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen(),this.updateData(),this.emit("handheldlist")):this.preload())},PicHandheldPanel.prototype.hide=function(){this.mShow=!1,this.removeListen()},PicHandheldPanel.prototype.addListen=function(){this.mInitialized},PicHandheldPanel.prototype.removeListen=function(){this.mInitialized},PicHandheldPanel.prototype.destroy=function(){this.mPropGrid&&this.mPropGrid.destroy(),t.prototype.destroy.call(this)},PicHandheldPanel.prototype.setEqipedDatas=function(t){var e=t.handheld,i=(e=e.sort((function(t,e){return t.latestUse>=e.latestUse?1:-1}))).splice(0,3);e=e.sort((function(t,e){return t.recommended>=e.recommended?1:-1})),e=i.concat(e);var n,o=r.op_client.CountablePackageItem.create({id:"empty_handed",count:0});if(""!==t.currentHandheldId&&t.currentHandheldId)for(var s=0,a=e;s<a.length;s++){var h=a[s];if(h.id===t.currentHandheldId){n=h;break}}else n=o;if(e.unshift(o),this.handeldEqiped.setItemData(n),this.isExtendsGrid){var c=14-e.length,l=c>0?e.concat(new Array(c)):e;if(this.mPropGrid.setItems(l),n)for(var p=0,d=this.mPropGrid.getCells();p<d.length;p++){var m=d[p];if(m&&m.container){var u=m.container;u.itemData===n?(u.isSelect=!0,this.curHandheldItem=m):u.isSelect=!1}}}},PicHandheldPanel.prototype.preload=function(){this.addAtlas(this.key,"hand_equp/hand_equp.png","hand_equp/hand_equp.json"),t.prototype.preload.call(this)},PicHandheldPanel.prototype.init=function(){var e=this;if(!this.mInitialized){var i=this.scaleWidth,n=this.scaleHeight;this.gridContent=this.scene.make.container(void 0,!1),this.add(this.gridContent),this.gridContent.setSize(i,150*this.dpr),this.gridContent.x=.5*i,this.gridContent.y=n-.5*this.gridContent.height-200*this.dpr;var o=this.scene.make.graphics(void 0,!1);o.fillStyle(3355443,.5),o.fillRect(.5*-i,.5*-this.gridContent.height,i,150*this.dpr),this.gridContent.add(o),this.handeldEqiped=new m(this.scene,0,0,this.key,this.dpr),this.handeldEqiped.setClickHandler(new a.a(this,this.onHandheldEqipedHandler),new a.a(this,this.onShortcutHandler)),this.add(this.handeldEqiped);var r=this.scene.textures.getFrame(this.key,"equp_bg"),s=r.width+10*this.dpr,h=r.height+10*this.dpr,l={x:0,y:0,table:{width:i-20*this.dpr,height:120*this.dpr,columns:2,cellWidth:s,cellHeight:h,reuseCellContainer:!0,cellOriginX:.5,cellOriginY:.5,zoom:this.scale},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new d(n,0,0,e.key,e.dpr)),i.setItemData(o),i}};this.mPropGrid=new c.GameGridTable(this.scene,l),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){e.onSelectItemHandler(t)})),this.gridContent.add(this.mPropGrid),this.resize(0,0),t.prototype.init.call(this)}},PicHandheldPanel.prototype.updateData=function(){this.updateLayout()},PicHandheldPanel.prototype.updateLayout=function(){var t=this.scaleWidth,e=this.scaleHeight,i=t-.5*this.handeldEqiped.width-8*this.dpr,n=0;this.gridContent.y=e-.5*this.gridContent.height,this.isExtendsGrid?(n=e-.5*this.handeldEqiped.height-this.gridContent.height,this.gridContent.visible=!0,this.mPropGrid.resetMask(),this.handeldEqiped.normal(),this.handeldEqiped.hideShortcut()):(n=e-.5*this.handeldEqiped.height-10*this.dpr,this.gridContent.visible=!1,this.handeldEqiped.waiting(),this.handeldEqiped.isEmptyHanded||this.handeldEqiped.showShortcut()),this.handeldEqiped.setPosition(i,n)},PicHandheldPanel.prototype.onSelectItemHandler=function(t){var e=t.itemData;e&&(this.curHandheldItem&&(this.curHandheldItem.isSelect=!1),t.isSelect=!0,this.curHandheldItem=t,t.isEmptyHanded?this.emit("clearhandheld"):this.emit("changehandheld",e.id))},PicHandheldPanel.prototype.onHandheldEqipedHandler=function(t){this.isExtendsGrid=!this.isExtendsGrid,this.isExtendsGrid?(this.gridContent.visible=!0,this.emit("handheldlist"),this.emit("openeqiped",!0)):(this.mPropGrid.setItems([]),this.gridContent.visible=!1,this.emit("openeqiped",!1)),this.updateLayout()},PicHandheldPanel.prototype.onShortcutHandler=function(t){this.emit("clearhandheld")},PicHandheldPanel}(o.BasePanel),d=function(t){function HandheldItem(e,i,n,o,r){var a=t.call(this,e,i,n)||this;return a.mIsSelect=!1,a.dpr=r,a.key=o,a.bg=a.scene.make.image({key:o,frame:"equp_bg"}),a.selectbg=a.scene.make.image({key:o,frame:"click_bg"}),a.icon=new s.DynamicImage(e,0,0),a.add([a.bg,a.selectbg,a.icon]),a.setSize(a.selectbg.width,a.selectbg.height),a.isSelect=!1,a}return l(HandheldItem,t),HandheldItem.prototype.setItemData=function(t){var e=this;if(this.itemData=t,!t)return this.icon.visible=!1,void(this.selectbg.visible=!1);if(this.icon.visible=!0,this.selectbg.visible=this.mIsSelect,this.isEmptyHanded)this.icon.setTexture(this.key,"empty_handed");else{var i=t.display,n=h.i.getOsdRes(i.texturePath);this.icon.load(n,this,(function(){e.icon.scale=1,e.icon.displayWidth=34*e.dpr,e.icon.scaleY=e.icon.scaleX}))}},Object.defineProperty(HandheldItem.prototype,"isSelect",{get:function(){return this.mIsSelect},set:function(t){this.mIsSelect=t,this.selectbg.visible=t},enumerable:!1,configurable:!0}),Object.defineProperty(HandheldItem.prototype,"isEmptyHanded",{get:function(){return!(!this.itemData||"empty_handed"!==this.itemData.id)},enumerable:!1,configurable:!0}),HandheldItem}(Phaser.GameObjects.Container),m=function(t){function HandheldEqiped(e,i,n,o,r){var a=t.call(this,e,i,n)||this;a.isExtendsGrid=!1,a.key=o,a.dpr=r,a.bg=a.scene.make.image({key:o,frame:"button_h"}),a.shortcutCon=a.scene.make.container(void 0,!1),a.shortcutbg=a.scene.make.image({key:o,frame:"superscript_h"}),a.shortcutIcon=a.scene.make.image({key:o,frame:"hand"}),a.shortcutCon.add([a.shortcutbg,a.shortcutIcon]);var h=40*r;return a.shortcutCon.setSize(h,h),a.shortcutbg.x=.5*-a.shortcutCon.width+.5*a.shortcutbg.width-5*r,a.shortcutbg.y=.5*a.shortcutCon.height-.5*a.shortcutbg.height+5*r,a.shortcutIcon.x=a.shortcutbg.x,a.shortcutIcon.y=a.shortcutbg.y,a.icon=new s.DynamicImage(e,0,0),a.icon.setTexture(a.key,"empty_handed"),a.shortcutCon.on("pointerup",a.onShortcutHandler,a),a.add([a.bg,a.icon,a.shortcutCon]),a.setSize(a.bg.width,a.bg.height),a.setInteractive(),a.shortcutCon.setPosition(.5*a.width+.5*h-20*r,.5*-a.height-.5*h+15*r),a.shortcutCon.setInteractive(),a.on("pointerup",a.onClickHandler,a),a.hideShortcut(),a}return l(HandheldEqiped,t),HandheldEqiped.prototype.normal=function(){this.bg.setFrame("button_h"),this.setChildAlpha(1)},HandheldEqiped.prototype.waiting=function(){this.bg.setFrame("button_h"),this.setChildAlpha(.5)},HandheldEqiped.prototype.setItemData=function(t){var e=this;if(this.itemData=t,this.isEmptyHanded)this.icon.setScale(1),this.icon.setTexture(this.key,"empty_handed"),this.hideShortcut();else{var i=t.display,n=h.i.getOsdRes(i.texturePath);this.icon.load(n,this,(function(){e.icon.displayWidth=24*e.dpr,e.icon.scaleY=e.icon.scaleX})),this.isExtendsGrid||this.showShortcut()}},HandheldEqiped.prototype.setClickHandler=function(t,e){this.clickHandler=t,this.shortcutHandler=e},HandheldEqiped.prototype.setChildAlpha=function(t){this.bg.setAlpha(t),this.icon.setAlpha(t),this.shortcutbg.setAlpha(t),this.shortcutIcon.setAlpha(t)},HandheldEqiped.prototype.hideShortcut=function(){this.shortcutCon.visible=!1,this.shortcutCon.disableInteractive()},HandheldEqiped.prototype.showShortcut=function(){this.shortcutCon.visible=!0,this.shortcutCon.setInteractive()},Object.defineProperty(HandheldEqiped.prototype,"isCanShowShortcut",{get:function(){return!this.isEmptyHanded},enumerable:!1,configurable:!0}),Object.defineProperty(HandheldEqiped.prototype,"isEmptyHanded",{get:function(){return!this.itemData||"empty_handed"===this.itemData.id},enumerable:!1,configurable:!0}),HandheldEqiped.prototype.onShortcutHandler=function(){this.shortcutHandler&&this.shortcutHandler.runWith(this.itemData)},HandheldEqiped.prototype.onClickHandler=function(){this.isExtendsGrid=!this.isExtendsGrid,this.clickHandler&&this.clickHandler.runWith(this.itemData)},HandheldEqiped}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractiveBubbleMediator",(function(){return h}));var n,o=i(248),r=i(250),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function InteractiveBubbleMediator(e,i,n){var s=t.call(this)||this;return s.layerMgr=e,s.mworld=n,s.scene=i,s.bubblePacket||(s.bubblePacket=new r.InteractiveBubble(n),s.bubblePacket.on("showbubble",s.onShowInteractiveBubble,s),s.bubblePacket.on("clearbubble",s.onClearInteractiveBubble,s),s.bubblePacket.register()),s.mView||(s.mView=new o.InteractiveBubblePanel(s.scene,s.mworld),s.mView.on("queryinteractive",s.onInteractiveBubbleHandler,s)),s}return a(InteractiveBubbleMediator,t),Object.defineProperty(InteractiveBubbleMediator.prototype,"currentRoom",{get:function(){return this.mworld.roomManager.currentRoom},enumerable:!1,configurable:!0}),InteractiveBubbleMediator.prototype.destroy=function(){this.mCurRoom&&this.mCurRoom.frameManager.remove(this,this.update),this.bubblePacket&&(this.bubblePacket.destroy(),this.bubblePacket=void 0),t.prototype.destroy.call(this),this.mCurRoom=void 0},InteractiveBubbleMediator.prototype.update=function(){this.mView&&this.mView.update()},InteractiveBubbleMediator.prototype.onShowInteractiveBubble=function(t){this.mCurRoom!==this.currentRoom&&(this.mCurRoom&&this.mCurRoom.frameManager.remove(this,this.update),this.mCurRoom=this.currentRoom,this.mCurRoom.frameManager.add(this,this.update));var e=this.currentRoom.elementManager.get(t.receiverId);e||(e=this.currentRoom.playerManager.get(t.receiverId)),e&&this.mView&&this.mView.showInteractionBubble(t,e),this.layerMgr.addToUILayer(this.mView,0)},InteractiveBubbleMediator.prototype.onClearInteractiveBubble=function(t){if(this.mView)for(var e=0,i=t;e<i.length;e++){var n=i[e];this.mView.clearInteractionBubble(n)}},InteractiveBubbleMediator.prototype.onInteractiveBubbleHandler=function(t){this.mView&&("number"!=typeof t?this.bubblePacket.queryInteractiveHandler(t):this.mView.clearInteractionBubble(t))},InteractiveBubbleMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractiveBubblePanel",(function(){return d}));var n,o=i(112),r=i(111),s=i(249),a=i(120),h=i(118),c=i(146),l=i(169),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function InteractiveBubblePanel(e,i){var n=t.call(this,e,i)||this;return n.map=new Map,n.world=i,n}return p(InteractiveBubblePanel,t),InteractiveBubblePanel.prototype.resize=function(e,i){t.prototype.resize.call(this,e,i),this.setSize(e,i)},InteractiveBubblePanel.prototype.init=function(){var e=this.scaleWidth,i=this.scaleHeight;this.scale;this.resize(e,i),t.prototype.init.call(this)},InteractiveBubblePanel.prototype.destroy=function(){if(this.map){for(var e in this.map){var i=this.map.get(Number(e));i&&i.destroy()}this.map.clear()}t.prototype.destroy.call(this)},InteractiveBubblePanel.prototype.clearInteractionBubble=function(t){this.map.has(t)&&(this.map.get(t).destroy(),this.map.delete(t))},InteractiveBubblePanel.prototype.showInteractionBubble=function(t,e){var i=this,n=this.dpr;t.display.resName=null,t.display.texturePath=r.i.getUIRes(n,"bubble/bubblebg.png"),t.display.dataPath=r.i.getUIRes(n,"bubble/tipsicon.png");var o=t.id;this.mBubble&&this.mBubble.hide(),this.map.has(o)?this.mBubble=this.map.get(o):(this.mBubble=new s.InteractionBubbleContainer(this.scene,n),this.map.set(o,this.mBubble)),this.mBubble.setBubble(t,new a.a(this,this.onInteractiveBubbleHandler));var h=this.world.game.scene.getScene(l.a.name);this.updateBubblePos(e,h),this.mBubble.setFollow(e,h,(function(t){i.updateBubblePos(e,t.scene)})),this.mBubble.show=!0,this.add(this.mBubble)},InteractiveBubblePanel.prototype.updateBubblePos=function(t,e){var i=this.dpr,n=this.world.uiScale,o=t.getDisplay();if(o){var r=o.getWorldTransformMatrix();if(r){var s=c.a.getPosByScenes(e,new h.a(r.tx,r.ty-33*i*n));this.mBubble.setPosition(s.x,s.y)}}},InteractiveBubblePanel.prototype.update=function(){this.map&&this.map.forEach((function(t){t&&t.show&&t.updatePos()}))},InteractiveBubblePanel.prototype.onInteractiveBubbleHandler=function(t){this.emit("queryinteractive",t)},InteractiveBubblePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractionBubbleContainer",(function(){return a}));var n,o=i(330),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function InteractionBubbleContainer(e,i){return t.call(this,e)||this}return s(InteractionBubbleContainer,t),Object.defineProperty(InteractionBubbleContainer.prototype,"show",{get:function(){return this.mShow},set:function(t){this.mShow=t},enumerable:!1,configurable:!0}),InteractionBubbleContainer.prototype.hide=function(){this.mShow=!1,this.parentContainer&&this.parentContainer.remove(this)},InteractionBubbleContainer.prototype.setFollow=function(e,i,n){t.prototype.setFollow.call(this,e,i,n)},InteractionBubbleContainer.prototype.setBubble=function(t,e){this.id=t.id;var i=t.display.resName,n=t.display.texturePath,r=t.display.dataPath;return this.mBubble||(this.mBubble=new o.InteractionBubbleCell(this.scene,this.dpr),this.mBubble.load(i,n,r),this.add(this.mBubble)),this.mBubble.setContentData(t,e),this.mBubble.show(),this.mBubble},InteractionBubbleContainer.prototype.destroy=function(){this.hide(),this.mBubble&&this.mBubble.destroy(),this.mBubble=null,t.prototype.destroy.call(this)},InteractionBubbleContainer}(r.BaseUI)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractiveBubble",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function InteractiveBubble(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(InteractiveBubble,t),InteractiveBubble.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SHOW_INTERACTIVE_BUBBLE,this.onShowHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORDL_REQ_CLIENT_REMOVE_INTERACTIVE_BUBBLE,this.onClearHandler))},InteractiveBubble.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},InteractiveBubble.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},InteractiveBubble.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},InteractiveBubble.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},InteractiveBubble.prototype.queryInteractiveHandler=function(t){var e=this.connection,i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_RES_VIRTUAL_WORLD_ACTIVE_BUBBLE);i.content.id=t.id,e.send(i)},Object.defineProperty(InteractiveBubble.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),InteractiveBubble.prototype.onShowHandler=function(t){var e=t.content;this.mEvent.emit("showbubble",e)},InteractiveBubble.prototype.onClearHandler=function(t){var e=t.content;this.mEvent.emit("clearbubble",e.ids)},InteractiveBubble}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterInfoMediator",(function(){return l}));var n,o=i(252),r=i(253),s=i(139),a=i(256),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function CharacterInfoMediator(e,i,n){var r=t.call(this)||this;return r.scene=i,r.layerMgr=e,r.world=n,r.characterInfo=new o.CharacterInfo(r.world),r.characterInfo.on("ownerInfo",r.onOwnerCharacterInfo,r),r.characterInfo.on("otherInfo",r.onOtherCharacterInfo,r),r.characterInfo.register(),r}return c(CharacterInfoMediator,t),CharacterInfoMediator.prototype.show=function(t){this.mView||(this.mView||(this.mView=new a.default(this.scene,this.world),this.mView.on("hide",this.onHidePanel,this),this.mView.on("queryOwnerInfo",this.onQueryOwnerInfo,this),this.mView.on("track",this.onTrackHandler,this),this.mView.on("invite",this.onInviteHandler,this),this.mView.on("follow",this.onFollowHandler,this),this.mView.on("unfollow",this.onUnfollowHandler,this),this.mView.on("addBlack",this.onAddBlackHandler,this),this.mView.on("removeBlack",this.onRemoveBlackHandler,this)),this.layerMgr.addToUILayer(this.mView)),this.mView.show()},CharacterInfoMediator.prototype.isSceneUI=function(){return!1},CharacterInfoMediator.prototype.destroy=function(){this.characterInfo&&(this.characterInfo.destroy(),this.characterInfo=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},CharacterInfoMediator.prototype.onHidePanel=function(){this.mView&&this.mView.hide(),this.mView=void 0,this.hide()},CharacterInfoMediator.prototype.onOwnerCharacterInfo=function(t){this.mView&&this.mView.setPlayerData(t)},CharacterInfoMediator.prototype.onOtherCharacterInfo=function(t){this.mView&&(this.mView.setPlayerData(t),this.checkRelation(t.cid))},CharacterInfoMediator.prototype.onFollowHandler=function(t){var e=this;this.world.httpService.follow(t).then((function(i){var n=i.code;i.data;200!==n&&201!==n||e.mView&&(e.checkRelation(t),e.updateFrind())}))},CharacterInfoMediator.prototype.onUnfollowHandler=function(t){var e=this;this.world.httpService.unfollow(t).then((function(i){var n=i.code;i.data;200!==n&&201!==n||(e.checkRelation(t),e.updateFrind())}))},CharacterInfoMediator.prototype.checkRelation=function(t){var e=this,i=this.world.account.accountData.id;this.world.httpService.post("user/check_relation",{relations:[{userA:i,userB:t}]}).then((function(t){var i=t.code,n=t.data;if(200===i)for(var o in n){var r=o.split("_");e.mView.setFriendRelation(s.PicFriendRelation.check(r[0],r[1],n[o]).relation)}}))},CharacterInfoMediator.prototype.onAddBlackHandler=function(t){var e=this;this.world.httpService.banUser(t).then((function(i){var n=i.code;i.data;200!==n&&201!==n||e.checkRelation(t)}))},CharacterInfoMediator.prototype.onRemoveBlackHandler=function(t){var e=this;this.world.httpService.removeBanUser(t).then((function(i){var n=i.code;i.data;200!==n&&201!==n||e.checkRelation(t)}))},CharacterInfoMediator.prototype.onQueryOwnerInfo=function(){this.characterInfo.queryPlayerInfo()},CharacterInfoMediator.prototype.onTrackHandler=function(t){this.characterInfo.track(t)},CharacterInfoMediator.prototype.onInviteHandler=function(t){this.characterInfo.invite(t)},CharacterInfoMediator.prototype.updateFrind=function(){var t=this.world.uiManager.getMediator(r.PicFriendMediator.name);t&&t.fetchCurrentFriend()},CharacterInfoMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterInfo",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function CharacterInfo(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(CharacterInfo,t),CharacterInfo.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_SELF_PLAYER_INFO,this.onOwnerCharacterInfo),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_ANOTHER_PLAYER_INFO,this.onOtherCharacterInfo))},CharacterInfo.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},CharacterInfo.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},CharacterInfo.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},CharacterInfo.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(CharacterInfo.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),CharacterInfo.prototype.queryPlayerInfo=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_SELF_PLAYER_INFO);this.connection.send(t)},CharacterInfo.prototype.track=function(t){this.playerInteraction(t,r.op_pkt_def.PKT_PlayerInteraction.PKT_tracePlayer)},CharacterInfo.prototype.invite=function(t){this.playerInteraction(t,r.op_pkt_def.PKT_PlayerInteraction.PKT_invitePlayer)},CharacterInfo.prototype.playerInteraction=function(t,e){var i=r.op_def.GeneralParam.create();i.t=r.op_def.GeneralParamType.str,i.valStr=t;var n=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_PLAYER_INTERACTION),s=n.content;s.method=e,s.param=i,this.connection.send(n)},CharacterInfo.prototype.onOwnerCharacterInfo=function(t){var e=t.content;this.mEvent.emit("ownerInfo",e)},CharacterInfo.prototype.onOtherCharacterInfo=function(t){var e=t.content;this.mEvent.emit("otherInfo",e)},CharacterInfo}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicFriendMediator",(function(){return l}));var n,o=i(254),r=i(255),s=i(151),a=i(139),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicFriendMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return c(PicFriendMediator,t),PicFriendMediator.prototype.show=function(){this.mView||(this.mView||(this.mView=new o.default(this.scene,this.world),this.mView.on("hide",this.onHidePanel,this),this.mView.on(s.PicFriendEvent.FETCH_FRIEND,this.onFetchFriendHandler,this),this.mView.on(s.PicFriendEvent.UNFOLLOW,this.onUnfollowHandler,this),this.mView.on(s.PicFriendEvent.FOLLOW,this.onFollowHandler,this),this.mView.on(s.PicFriendEvent.REMOVE_FROM_BLACKLIST,this.onRemoveBanUserHandler,this),this.mView.on(s.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,this.onReqFriendAttributesHandler,this),this.mView.on(s.PicFriendEvent.REQ_BLACKLIST,this.onReqBlacklistHandler,this),this.mView.on(s.PicFriendEvent.REMOVE_FROM_BLACKLIST,this.onRemoveFromBlacklistHandler,this),this.mView.on(s.PicFriendEvent.SEARCH_FRIEND,this.onSearchHandler,this),this.mView.on(s.PicFriendEvent.REQ_PLAYER_LIST,this.onReqPlayerListHanlder,this),this.mView.on(s.PicFriendEvent.REQ_RELATION,this.onReRelationHandler,this)),this.picFriend||(this.picFriend=new r.PicFriend(this.world),this.picFriend.on(s.PicFriendEvent.PLAYER_LIST,this.onPlayerListHandler,this),this.picFriend.on(s.PicFriendEvent.SEARCH_RESULT,this.onSearchResultHandler,this),this.picFriend.register()),this.layerMgr.addToUILayer(this.mView)),this.mView.show()},PicFriendMediator.prototype.destroy=function(){this.picFriend&&(this.picFriend.destroy(),this.picFriend=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},PicFriendMediator.prototype.fetchCurrentFriend=function(){this.mView&&this.mView.fetchCurrentFriend()},PicFriendMediator.prototype.onReRelationHandler=function(t){for(var e=this,i=[],n=this.world.account.accountData.id,o=0,r=t;o<r.length;o++){var s=r[o];i.push({userA:n,userB:s})}this.world.httpService.post("user/check_relation",{relations:i}).then((function(t){var i=t.code,n=t.data;if(200===i){var o=[];for(var r in n){var s=r.split("_");o.push(a.PicFriendRelation.check(s[0],s[1],n[r]))}e.mView.updateRelation(o)}}))},PicFriendMediator.prototype.onFetchFriendHandler=function(t){switch(t){case o.FriendChannel.Friends:this.getFriends();break;case o.FriendChannel.Fans:this.getFans();break;case o.FriendChannel.Followes:this.getFolloweds()}},PicFriendMediator.prototype.getFriends=function(){var t=this;this.picFriend.getFriends().then((function(e){t.mView.setFriend(o.FriendChannel.Friends,e.data)}))},PicFriendMediator.prototype.getFans=function(){var t=this;this.picFriend.getFans().then((function(e){var i=e.data;i&&t.mView.setFriend(o.FriendChannel.Fans,i.filter((function(t){return t.user})))}))},PicFriendMediator.prototype.getFolloweds=function(){var t=this;this.picFriend.getFolloweds().then((function(e){var i=e.data;i&&t.mView.setFriend(o.FriendChannel.Followes,i.filter((function(t){return t.followed_user})))}))},PicFriendMediator.prototype.onFollowHandler=function(t){var e=this;if(t&&!(t.length<0)){var i=t[0];this.world.httpService.follow(i).then((function(t){e.mView.filterById(i)}))}},PicFriendMediator.prototype.onUnfollowHandler=function(t){var e=this;if(t&&!(t.length<0)){var i=t[0];this.world.httpService.unfollow(i).then((function(t){e.mView.filterById(i)}))}},PicFriendMediator.prototype.onRemoveBanUserHandler=function(t){var e=this;!t||t.length<1||this.world.httpService.removeBanUser(t[0]).then((function(i){201===i.code&&e.mView.filterById(t[0])}))},PicFriendMediator.prototype.onReqBlacklistHandler=function(){var t=this;this.picFriend.getBanlist().then((function(e){t.mView.setFriend(o.FriendChannel.Blacklist,e.data)}))},PicFriendMediator.prototype.onRemoveFromBlacklistHandler=function(t){var e=this;!t||t.length<1||this.world.httpService.removeBanUser(t[0]).then((function(i){e.mView.filterById(t[0])}))},PicFriendMediator.prototype.fetchPlayerList=function(t){if(t){var e=t.map((function(t){return t.id}));this.picFriend.fetchFriendList(e)}},PicFriendMediator.prototype.onPlayerListHandler=function(t){this.mView.updateFriend(t)},PicFriendMediator.prototype.onReqFriendAttributesHandler=function(t){this.world.uiManager.showMed("CharacterInfo"),this.picFriend.fetchFriendInfo(t)},PicFriendMediator.prototype.onSearchHandler=function(t){t&&t.length>0&&this.picFriend.searchFriend(t[0])},PicFriendMediator.prototype.onSearchResultHandler=function(t){this.mView.setFriend(o.FriendChannel.Search,t.playerInfos)},PicFriendMediator.prototype.onReqPlayerListHanlder=function(t){this.picFriend.fetchFriendList(t)},PicFriendMediator.prototype.onHidePanel=function(){this.destroy()},PicFriendMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"FriendChannel",(function(){return g}));var n,o=i(112),r=i(113),s=i(114),a=i(120),h=i(127),c=i(151),l=i(149),p=i(139),d=i(109),m=i(115),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=Phaser.GameObjects.Container,y=function(t){function PicFriendPanel(e,i){var n=t.call(this,e,i)||this;return n.key="picfriendpanel",n.mSubContanerMap=new Map,n.mSubContanerMap.set(g.Blacklist,I),n.mSubContanerMap.set(g.Search,T),n.mSubContanerMap.set(g.NewFriend,E),n.mSubContanerMap.set(g.NewFans,M),n}return u(PicFriendPanel,t),PicFriendPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,e,i),this.setSize(n,o),this.mBackGround.clear(),this.mBackGround.fillStyle(0,.66),this.mBackGround.fillRect(0,0,n,o),this.content.setPosition(n/2,o/2),this.friendContainer.parentContainer&&this.friendContainer.resize()},PicFriendPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen(),this.friendContainer.setChannel(g.Friends)):this.preload())},PicFriendPanel.prototype.addListen=function(){this.mInitialized&&(this.closeBtn.on(String(d.ClickEvent.Tap),this.OnClosePanel,this),this.friendContainer.register(),this.friendContainer.on("shwoAddFriend",this.onShowAddFriendHandler,this),this.friendContainer.on(c.PicFriendEvent.FETCH_FRIEND,this.onFetchFriendHandler,this),this.friendContainer.on(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,this.onReqFriendAttributesHandler,this),this.friendContainer.on(c.PicFriendEvent.RENDERER_EVENT,this.onRendererEventHandler,this),this.friendContainer.on(c.PicFriendEvent.REQ_PLAYER_LIST,this.onReqFriendListHandler,this))},PicFriendPanel.prototype.removeListen=function(){this.mInitialized&&(this.closeBtn.off(String(d.ClickEvent.Tap),this.OnClosePanel,this),this.friendContainer.off("shwoAddFriend",this.onShowAddFriendHandler,this),this.friendContainer.off(c.PicFriendEvent.FETCH_FRIEND,this.onFetchFriendHandler,this),this.friendContainer.off(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,this.onReqFriendAttributesHandler,this),this.friendContainer.off(c.PicFriendEvent.RENDERER_EVENT,this.onRendererEventHandler,this),this.friendContainer.off(c.PicFriendEvent.REQ_PLAYER_LIST,this.onReqFriendListHandler,this),this.friendContainer.unregister())},PicFriendPanel.prototype.setFriend=function(t,e){this.mSubContanerMap.get(t)?this.mShowingSubContainer&&this.mShowingSubContainer.setItems(e):this.friendContainer&&this.friendContainer.setFriends(t,e)},PicFriendPanel.prototype.updateFriend=function(t){this.mShowingSubContainer?this.mShowingSubContainer.updateFriends(t):this.friendContainer.updateFriends(t)},PicFriendPanel.prototype.updateRelation=function(t){this.mShowingSubContainer&&this.mShowingSubContainer instanceof T&&this.mShowingSubContainer.updateRelation(t)},PicFriendPanel.prototype.filterById=function(t){this.mShowingSubContainer?this.mShowingSubContainer.filterById(t):this.friendContainer&&this.friendContainer.filterById(t)},PicFriendPanel.prototype.fetchCurrentFriend=function(){this.friendContainer&&this.friendContainer.fetchCurrentFriend()},PicFriendPanel.prototype.preload=function(){this.addAtlas(this.key,"friend_list/friend_list.png","friend_list/friend_list.json"),this.addAtlas(m.UIAtlasKey.commonKey,m.UIAtlasName.commonUrl+".png",m.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},PicFriendPanel.prototype.init=function(){var e=this.scale,i=this.scaleWidth,n=this.scaleHeight;this.mBackGround=this.scene.make.graphics(void 0,!1),this.mBackGround.clear(),this.mBackGround.fillStyle(7004927,.5),this.mBackGround.fillRect(0,0,i*e,n*e),this.mBackGround.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.bg=this.scene.make.image({x:0,y:0,key:this.key,frame:"phone"}),this.content=this.scene.make.container(void 0,!1),this.content.setSize(this.bg.width,this.bg.height),this.content.add(this.bg),this.closeBtn=new d.Button(this.scene,m.UIAtlasKey.commonKey,"close"),this.closeBtn.setPosition(.5*this.content.width-30*this.dpr,.5*(-this.bg.height+this.closeBtn.height)+25*this.dpr),this.friendContainer=new P(this.scene,this.bg.width,this.bg.height,this.key,this.dpr,this.scale),this.content.add([this.friendContainer,this.closeBtn]),this.add([this.mBackGround,this.content]),this.resize(i,n),t.prototype.init.call(this)},PicFriendPanel.prototype.destroy=function(){this.friendContainer&&this.friendContainer.destroy(),this.mShowingSubContainer&&this.mShowingSubContainer.destroy(),t.prototype.destroy.call(this)},PicFriendPanel.prototype.OnClosePanel=function(){this.emit("hide")},PicFriendPanel.prototype.onFetchFriendHandler=function(t){this.emit(c.PicFriendEvent.FETCH_FRIEND,t)},PicFriendPanel.prototype.onReqFriendAttributesHandler=function(t){this.emit(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,t)},PicFriendPanel.prototype.onReqFollowFriendHandler=function(t){this.emit(c.PicFriendEvent.FOLLOW,t)},PicFriendPanel.prototype.onUnfollowFriendHanlder=function(t){this.emit(c.PicFriendEvent.UNFOLLOW,t)},PicFriendPanel.prototype.onShowAddFriendHandler=function(t){this.mShowingSubContainer&&this.mShowingSubContainer.destroy();var e=this.mSubContanerMap.get(t);if(e){this.mShowingSubContainer=new e(this.scene,this.bg.width,this.bg.height,this.key,this.dpr,this.scale),this.mShowingSubContainer.register(),this.mShowingSubContainer.on("hide",this.onHideSearchHandler,this),this.mShowingSubContainer.on(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,this.onReqFriendAttributesHandler,this),this.mShowingSubContainer.on(c.PicFriendEvent.RENDERER_EVENT,this.onRendererEventHandler,this),this.mShowingSubContainer.on(c.PicFriendEvent.REQ_PLAYER_LIST,this.onReqFriendListHandler,this),this.mShowingSubContainer.on(c.PicFriendEvent.REQ_FRIEND_RELATION,this.onReqFriendRelationHandler,this),this.content.remove(this.friendContainer),this.content.add(this.mShowingSubContainer),this.mShowingSubContainer.resize();var i=this.mShowingSubContainer.fetchEventName();i&&this.emit(i)}},PicFriendPanel.prototype.onHideSearchHandler=function(){this.content.add(this.friendContainer),this.mShowingSubContainer&&(this.mShowingSubContainer.unregister(),this.mShowingSubContainer.destroy(),this.mShowingSubContainer=null),this.friendContainer.fetchCurrentFriend()},PicFriendPanel.prototype.onReqFriendListHandler=function(t){this.emit(c.PicFriendEvent.REQ_PLAYER_LIST,t)},PicFriendPanel.prototype.onRendererEventHandler=function(t,e){t&&this.emit(t,e)},PicFriendPanel.prototype.onReqFriendRelationHandler=function(t){if(t){var e=t.map((function(t){return t.id}));e.length>0&&this.emit(c.PicFriendEvent.REQ_RELATION,e)}},PicFriendPanel}(o.BasePanel);e.default=y;var g,_=function(t){function FriendContainer(e,i,n,o,r,s){var a=t.call(this,e,0,0)||this;return a.key=o,a.dpr=r,a.uiScale=s,a.setSize(i,n),a}return u(FriendContainer,t),FriendContainer.prototype.draw=function(){var t=49*this.dpr-.5*this.height,e="bold "+16*this.dpr+"px "+r.a.DEFULT_FONT;this.titleText=this.scene.make.text({x:0,y:t,style:{font:e,bold:!0,color:"#0"}}).setOrigin(.5,0),this.add(this.titleText)},FriendContainer.prototype.createGrideTable=function(t,e,i,n,o,r,s,a,h){var c=this,l={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:r,reuseCellContainer:!0,zoom:this.uiScale},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,e){var i=t.item;return null===e&&(e=s(c.scene,t)),i.type===g.Null?t.setHeight(11*c.dpr):t.height!==r&&t.setHeight(r),e.setSize(t.width,t.height),e.setData({item:i}),e.setItemData(i),h&&h(t,e),e}},p=new d.GameGridTable(this.scene,l);return p.layout(),p.on("cellTap",(function(t){t&&a.runWith(t)})),this.add(p),p},FriendContainer.prototype.sortByName=function(t){return t.sort((function(t,e){return t.nickname.localeCompare(e.nickname,s.a.language)}))},FriendContainer.prototype.sortByOnlien=function(t){return t.sort((function(t,e){var i=t.lv?1:0;return(e.lv?1:0)-i}))},FriendContainer}(f),P=function(t){function MainContainer(e,i,n,o,r,s){var a=t.call(this,e,i,n,o,r,s)||this;return a.friendDatas=new Map,a.draw(),a}return u(MainContainer,t),MainContainer.prototype.register=function(){this.searchInput.on("textchange",this.onTextChangeHandler,this),this.searchBtn.on(String(d.ClickEvent.Tap),this.onSeachHandler,this),this.onlineCheckBox.on(String(d.ClickEvent.Tap),this.onCheckoutOnlineHandler,this),this.addFriendBtn.on(String(d.ClickEvent.Tap),this.onShowAddFriendHandler,this)},MainContainer.prototype.unregister=function(){this.searchInput.off("textchange",this.onTextChangeHandler,this),this.searchBtn.off(String(d.ClickEvent.Tap),this.onSeachHandler,this),this.onlineCheckBox.off(String(d.ClickEvent.Tap),this.onCheckoutOnlineHandler,this),this.addFriendBtn.off(String(d.ClickEvent.Tap),this.onShowAddFriendHandler,this)},MainContainer.prototype.resize=function(){this.friendTabel&&this.friendTabel.resetMask()},MainContainer.prototype.setChannel=function(t){this.channelGroup&&this.channelGroup.selectIndex(t)},MainContainer.prototype.updateFriends=function(t){var e=t.playerInfos,i=null,n=this.friendDatas.get(this.channelGroup.selectedIndex);if(n){for(var _loop_1=function(t){(i=n.find((function(e){return e.id===t.platformId})))&&(i.nickname=t.nickname,t.level&&(i.lv=t.level.level))},o=0,r=e;o<r.length;o++){_loop_1(r[o])}this.showFriend(this.channelGroup.selectedIndex,n)}},MainContainer.prototype.setFriends=function(t,e){for(var i,n=[],o=null,r=[],s=0,a=e;s<a.length;s++){var h=a[s];t===g.Followes?(o=h.followed_user,i=p.FriendRelationEnum.Followed):t===g.Fans?(o=h.user,i=p.FriendRelationEnum.Fans):(o=h,i=p.FriendRelationEnum.Friend),o&&(n.push({type:t,id:o._id,nickname:o.nickname,relation:i}),r.push(o._id))}this.friendDatas.set(t,n),r.length>0&&this.emit(c.PicFriendEvent.REQ_PLAYER_LIST,r),this.showFriend(t,n)},MainContainer.prototype.showFriend=function(t,e){this.sortByName(e),this.sortByOnlien(e);var i="",n="";switch(t){case g.Friends:i=s.a.t("friendlist.title"),n=s.a.t("friendlist.friends"),e=[{type:g.Menu,menuData:{type:g.NewFans}},{type:g.Menu,menuData:{type:g.NewFriend}},{type:g.Menu,menuData:{type:g.Blacklist}},{type:g.Null}].concat(e);break;case g.Fans:i=s.a.t("friendlist.fans"),n=s.a.t("friendlist.fans");break;case g.Followes:i=s.a.t("friendlist.follow"),n=s.a.t("friendlist.fans");break;case g.Blacklist:i=s.a.t("friendlist.blacklist")}this.showingFriends=e,this.friendTabel.setItems(this.showingFriends),i&&this.titleText.setText(i);var o=this.friendDatas.get(this.channelGroup.selectedIndex);o&&this.friendNum.setText(n+": "+o.length),this.friendTabel&&this.friendTabel.setT(0)},MainContainer.prototype.filterById=function(t){if(this.showingFriends){var e=this.friendDatas.get(this.channelGroup.selectedIndex);e&&(e=e.filter((function(e){return e.id!==t}))),this.showingFriends=this.showingFriends.filter((function(e){return e.id!==t})),this.friendTabel.setItems(this.showingFriends)}},MainContainer.prototype.fetchCurrentFriend=function(){!this.channelGroup||this.channelGroup.selectedIndex<0||this.emit(c.PicFriendEvent.FETCH_FRIEND,this.channelGroup.selectedIndex)},MainContainer.prototype.draw=function(){var e=this;t.prototype.draw.call(this);var i=.5*-this.height+17.33*this.dpr;this.friendNum=this.scene.make.text({x:0,y:i,text:"",style:{color:"#ffffff",fontSize:12*this.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(.5,0),this.add(this.friendNum),this.topContent=this.scene.make.container(void 0,!1),this.add(this.topContent);var n=new d.NineSlicePatch(this.scene,0,0,276*this.dpr,33*this.dpr,this.key,"min_pic_bg",{left:5*this.dpr,top:5*this.dpr,right:5*this.dpr,bottom:5*this.dpr});this.topContent.setPosition(0,73.67*this.dpr+.5*(n.height-this.height)),this.onlineCheckBox=new d.CheckBox(this.scene,this.key,"online_unchecked","online_checked"),this.onlineCheckBox.setPosition(12*this.dpr-.5*n.width,0);var o=this.scene.make.text({x:6.67*this.dpr+.5*this.onlineCheckBox.width,y:0,text:s.a.t("friendlist.olinetitle"),style:{fontSize:9.33*this.dpr,bold:!0,fontFamily:r.a.DEFULT_FONT,color:"#0098D8"}}).setOrigin(0,.5);this.onlineCheckBox.add(o),this.searchBtn=new d.Button(this.scene,this.key,"search"),this.searchBtn.x=.5*n.width-39*this.dpr-.5*this.searchBtn.width,this.addFriendBtn=new d.Button(this.scene,this.key,"add"),this.addFriendBtn.x=.5*n.width-7.33*this.dpr-.5*this.addFriendBtn.width,this.searchInput=new k(this.scene,{x:0,y:0,width:80*this.dpr,height:22*this.dpr,placeholder:s.a.t("friendlist.search_friends_notes"),fontSize:12*this.dpr+"px",color:"#666666"},this.key,this.dpr).setOrigin(0,.5),this.topContent.add([n,this.onlineCheckBox,this.searchInput,this.searchBtn,this.addFriendBtn]);var l={fontSize:14*this.dpr,fontFamily:r.a.DEFULT_FONT},p=new d.TabButton(this.scene,this.key,"friend_default","friend_select",s.a.t("friendlist.friends"));p.y=.5*this.height-14*this.dpr-.5*p.height,p.setTextStyle(l);var m=new d.TabButton(this.scene,this.key,"fans_default","fans_select",s.a.t("friendlist.fans"));m.y=p.y,m.setTextStyle(l);var u=new d.TabButton(this.scene,this.key,"follow_default","follow_select",s.a.t("friendlist.follow"));u.y=p.y,u.setTextStyle(l),p.x=.5*(-m.width-p.width)-.67*this.dpr,u.x=.5*(m.width+u.width)+.67*this.dpr,this.add([p,m,u]),this.channelGroup=new h.CheckboxGroup,this.channelGroup.on("selected",this.onSelectChannelHandler,this),this.channelGroup.appendItemAll([p,m,u]),this.friendTabel=this.createGrideTable(0,this.topContent.y+this.topContent.height+380*this.dpr*.5+18*this.dpr,275*this.dpr,380*this.dpr,275*this.dpr,36*this.dpr,(function(t,i){var n=new v(e.scene,0,0,e.key,e.dpr);return n.on(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,e.onFtechPlayerHandler,e),n.on(c.PicFriendEvent.RENDERER_EVENT,e.onRendererEventHandler,e),n}),new a.a(this,this.onSelectItemHandler))},MainContainer.prototype.onRendererEventHandler=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.emit(c.PicFriendEvent.RENDERER_EVENT,t,e)},MainContainer.prototype.onFtechPlayerHandler=function(t){void 0!==t.lv&&this.emit(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,t.id),this.searchInput.setBlur()},MainContainer.prototype.onReqFollowFriendHandler=function(t){this.emit(c.PicFriendEvent.FOLLOW,t.id)},MainContainer.prototype.onReqUnfollowFriendHandler=function(t){this.emit(c.PicFriendEvent.UNFOLLOW,t.id)},MainContainer.prototype.onSelectChannelHandler=function(t){this.fetchCurrentFriend()},MainContainer.prototype.onSelectItemHandler=function(t){var e=t.getData("item");e&&e.menuData&&e.type===g.Menu&&this.emit("shwoAddFriend",e.menuData.type)},MainContainer.prototype.onCheckoutOnlineHandler=function(){var t=this.showingFriends;this.onlineCheckBox.selected&&(t=this.showingFriends.slice(0).filter((function(t){return!0===t.online})));this.friendTabel.setItems(t)},MainContainer.prototype.onShowAddFriendHandler=function(){this.emit("shwoAddFriend",g.Search),this.searchInput.setBlur()},MainContainer.prototype.onSeachHandler=function(){var t=this.searchInput.text;if(t){var e=this.showingFriends.slice(0);e=e.filter((function(e){return!!(e.nickname&&e.nickname.indexOf(t)>-1)})),this.friendTabel.setItems(e)}else this.friendTabel.setItems(this.showingFriends)},MainContainer.prototype.onTextChangeHandler=function(){this.onSeachHandler()},MainContainer}(_),v=function(t){function PicFriendItem(e,i,n,o,r){var s=t.call(this,e,i,n)||this;return s.mDpr=0,s.setSize(275*r,36*r),s.mDpr=r,s.mKey=o,s}return u(PicFriendItem,t),PicFriendItem.prototype.setItemData=function(t){this.itemData=t,this.currnetType!==t.type&&(this.currnetType=t.type,this.currentRender&&(this.currentRender.destroy(),this.currentRender=null),this.currentRender=this.createRenderer(t.type)),this.currentRender&&this.currentRender.setItemData(t)},PicFriendItem.prototype.createAddBtn=function(t){var e=48*this.mDpr,i=24*this.mDpr;return new d.NineSliceButton(this.scene,.5*(this.width-e)-18*this.mDpr,0,e,i,m.UIAtlasKey.commonKey,"yellow_btn_normal_s",s.a.t("common.add"),this.mDpr,this.scale,{left:10*this.mDpr,top:10*this.mDpr,right:10*this.mDpr,bottom:10*this.mDpr})},PicFriendItem.prototype.onHeadhandler=function(){this.emit(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,this.itemData)},PicFriendItem.prototype.createRenderer=function(t){switch(t){case g.Fans:case g.Search:case g.Friends:case g.Followes:case g.NewFriend:case g.Blacklist:return new b(this.scene,this);case g.Null:return new S(this.scene,this);case g.Menu:return new w(this.scene,this)}},Object.defineProperty(PicFriendItem.prototype,"key",{get:function(){return this.mKey},enumerable:!1,configurable:!0}),Object.defineProperty(PicFriendItem.prototype,"dpr",{get:function(){return this.mDpr},enumerable:!1,configurable:!0}),PicFriendItem}(f),w=function(){function MenuRenderer(t,e){this.scene=t,this.owner=e,this.icon=this.scene.make.image({x:7.44*this.owner.dpr-.5*this.owner.width,key:e.key,frame:"black_list"},!1).setOrigin(0,.5),this.text=this.scene.make.text({x:this.icon.x+this.icon.width+9.67*e.dpr,style:{fontSize:9.33*e.dpr,fontFamily:r.a.DEFULT_FONT,color:"#000000"}}).setOrigin(0,.5),this.arrow=this.scene.make.image({x:.5*e.width-20*e.dpr,key:e.key,frame:"arrow"}).setOrigin(1,.5),this.owner.add([this.icon,this.text,this.arrow])}return MenuRenderer.prototype.setItemData=function(t){var e=t.menuData;if(e)switch(e.type){case g.NewFans:this.icon.setFrame("new_fans"),this.text.text=s.a.t("friendlist.new_fans");break;case g.Blacklist:this.icon.setFrame("black_list"),this.text.text=s.a.t("friendlist.blacklist");break;case g.NewFriend:this.icon.setFrame("friend_add"),this.text.text=s.a.t("friendlist.new_friend")}},MenuRenderer.prototype.destroy=function(){this.icon&&this.icon.destroy(),this.text&&this.text.destroy(),this.arrow&&this.arrow.destroy()},MenuRenderer}(),S=function(){function NullRenderer(t,e){this.owner=e,this.graphics=t.make.graphics(void 0,!1),this.graphics.fillStyle(16119285),this.graphics.fillRect(.5*-this.owner.width,-18*e.dpr,this.owner.width,this.owner.height),e.add(this.graphics)}return NullRenderer.prototype.setItemData=function(t){},NullRenderer.prototype.destroy=function(){this.graphics&&this.graphics.destroy()},NullRenderer}(),b=function(){function FriendRenderer(t,e){this.scene=t,this.owner=e,this.icon=t.make.image({x:7.44*e.dpr-.5*e.width,key:e.key,frame:"offline_head"}).setOrigin(0,.5).setInteractive().on("pointerup",this.onHeadhandler,this),this.nameText=t.make.text({x:this.icon.x+this.icon.width+9.67*e.dpr,y:.5*-this.icon.height+1*e.dpr,style:{fontSize:10*e.dpr,fontFamily:r.a.DEFULT_FONT,color:"#6F75FF"}},!1),this.level=t.make.text({x:this.nameText.x,y:this.nameText.y+18*e.dpr,text:"",style:{fontSize:8*e.dpr,fontFamily:r.a.DEFULT_FONT,color:"#6F75FF"}}),this.addBtn=this.createAddBtn(s.a.t("friendlist.follow")),this.addBtn.on(String(d.ClickEvent.Tap),this.onAddHandler,this),this.owner.add(this.addBtn),e.add([this.icon,this.nameText,this.level,this.addBtn])}return FriendRenderer.prototype.setItemData=function(t){this.itemData=t,this.nameText.text=t.nickname;var e=t.lv?s.a.t("friendlist.lv")+"："+t.lv:s.a.t("friendlist.unregistered_game");this.level.setText(e),this.curRelation!==t.relation&&(this.curRelation=t.relation,this.updateRelation())},FriendRenderer.prototype.destroy=function(){if(this.owner)for(var t=this.owner.list;t.length;)t[t.length-1].destroy()},FriendRenderer.prototype.updateRelation=function(){this.curRelation&&this[this.curRelation]?this[this.curRelation]():(this.addBtn.visible=!1,this.friendEvnet=null)},FriendRenderer.prototype.fans=function(){this.addBtn.visible=!0,this.addBtn.setText(s.a.t("friendlist.follow")),this.friendEvnet=c.PicFriendEvent.FOLLOW},FriendRenderer.prototype.followed=function(){this.addBtn.visible=!0,this.addBtn.setText(s.a.t("friendlist.unfollow")),this.friendEvnet=c.PicFriendEvent.UNFOLLOW},FriendRenderer.prototype.blacklist=function(){this.addBtn.visible=!0,this.addBtn.setText(s.a.t("friendlist.remove")),this.friendEvnet=c.PicFriendEvent.REMOVE_FROM_BLACKLIST},FriendRenderer.prototype.null=function(){this.fans()},FriendRenderer.prototype.createAddBtn=function(t){var e=this.owner,i=e.width,n=(e.height,e.key,e.dpr),o=48*n,s=24*n,a=new d.NineSliceButton(this.scene,.5*(i-o)-18*n,0,o,s,m.UIAtlasKey.commonKey,"yellow_btn_normal_s",t,n,1,{left:10*n,top:6*n,right:10*n,bottom:6*n});return a.setTextStyle({fontSize:9*n,fontFamily:r.a.DEFULT_FONT}),a},FriendRenderer.prototype.onHeadhandler=function(){this.owner.emit(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,this.itemData)},FriendRenderer.prototype.onAddHandler=function(){this.friendEvnet&&this.itemData&&this.owner.emit(c.PicFriendEvent.RENDERER_EVENT,this.friendEvnet,this.itemData.id)},FriendRenderer}(),C=(function(t){function FansRenderer(e,i){return t.call(this,e,i)||this}u(FansRenderer,t),FansRenderer.prototype.onAddHandler=function(){this.itemData&&this.owner.emit(c.PicFriendEvent.RENDERER_EVENT,c.PicFriendEvent.FOLLOW,this.itemData.id)}}(b),function(t){function SubFriendContainer(e,i,n,o,r,s){var a=t.call(this,e,i,n,o,r,s)||this;return a.draw(),a}return u(SubFriendContainer,t),SubFriendContainer.prototype.register=function(){this.backBtn.on(String(d.ClickEvent.Tap),this.onBackHandler,this)},SubFriendContainer.prototype.unregister=function(){this.backBtn.off(String(d.ClickEvent.Tap),this.onBackHandler,this)},SubFriendContainer.prototype.resize=function(){this.gridTable&&this.gridTable.resetMask()},SubFriendContainer.prototype.setItems=function(t){this.items=t,this.gridTable&&this.gridTable.setItems(t)},SubFriendContainer.prototype.filterById=function(t){!this.items||this.items.length<1||(this.items&&(this.items=this.items.filter((function(e){return e.id!==t}))),this.gridTable&&this.gridTable.setItems(this.items))},SubFriendContainer.prototype.updateFriends=function(t){},SubFriendContainer.prototype.fetchEventName=function(){return""},SubFriendContainer.prototype.destroy=function(){this.unregister(),this.gridTable&&this.gridTable.destroy(),t.prototype.destroy.call(this)},SubFriendContainer.prototype.draw=function(){var e=this;t.prototype.draw.call(this),this.backBtn=new d.Button(this.scene,this.key,"back"),this.backBtn.setPosition(.5*(-this.width+this.backBtn.width)+21.67*this.dpr,.5*(-this.height+this.backBtn.height)+47*this.dpr),this.gridTable=this.createGrideTable(0,18*this.dpr,275*this.dpr,400*this.dpr,275*this.dpr,36*this.dpr,(function(){var t=new v(e.scene,0,0,e.key,e.dpr);return t.on(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,e.onFtechPlayerHandler,e),t.on(c.PicFriendEvent.RENDERER_EVENT,e.onRendererEventHandler,e),t}),new a.a(this.onItemClickHandler)),this.add([this.backBtn])},SubFriendContainer.prototype.onBackHandler=function(){this.emit("hide")},SubFriendContainer.prototype.onItemClickHandler=function(){},SubFriendContainer.prototype.onFtechPlayerHandler=function(t){this.emit(c.PicFriendEvent.REQ_FRIEND_ATTRIBUTES,t.id)},SubFriendContainer.prototype.onRendererEventHandler=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this.emit(c.PicFriendEvent.RENDERER_EVENT,t,e)},SubFriendContainer}(_)),T=function(t){function SearchContainer(e,i,n,o,r,s){var a=t.call(this,e,i,n,o,r,s)||this;return a.friendType=g.Search,a}return u(SearchContainer,t),SearchContainer.prototype.setItems=function(t){if(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i],r=o.platformId,s=o.nickname,a=o.level;e.push({type:this.friendType,nickname:s,id:r,lv:a.level})}this.emit(c.PicFriendEvent.REQ_FRIEND_RELATION,e),this.items=e}},SearchContainer.prototype.updateRelation=function(t){if(this.items){for(var _loop_2=function(t){e.items.find((function(e){return e.id===t.id})).relation=t.relation},e=this,i=0,n=t;i<n.length;i++){_loop_2(n[i])}this.updateFriends(this.items)}},SearchContainer.prototype.updateFriends=function(t){this.items=t,this.gridTable&&this.gridTable.setItems(t)},SearchContainer.prototype.draw=function(){t.prototype.draw.call(this),this.titleText.setText(s.a.t("friendlist.search"));var e=new d.NineSlicePatch(this.scene,0,0,276*this.dpr,33*this.dpr,this.key,"min_pic_bg",{left:5*this.dpr,top:5*this.dpr,right:5*this.dpr,bottom:5*this.dpr});e.setPosition(0,73.67*this.dpr+.5*(e.height-this.height)),this.searchInput=new k(this.scene,{x:0,y:0,width:80*this.dpr,height:22*this.dpr,placeholder:s.a.t("friendlist.search_friends_notes"),fontSize:12*this.dpr+"px",color:"#666666"},this.key,this.dpr).setOrigin(0,.5),this.searchInput.setPosition(0,e.y),this.searchInput.on("search",this.onSearchHandler,this),this.gridTable.y=e.height,this.gridTable.layout(),this.add([e,this.searchInput])},SearchContainer.prototype.onSearchHandler=function(t){this.emit(c.PicFriendEvent.RENDERER_EVENT,c.PicFriendEvent.SEARCH_FRIEND,t),this.resize()},SearchContainer}(C),I=function(t){function BlackContainer(e,i,n,o,r,s){var a=t.call(this,e,i,n,o,r,s)||this;return a.friendType=g.Blacklist,a}return u(BlackContainer,t),BlackContainer.prototype.draw=function(){t.prototype.draw.call(this),this.titleText.setText(s.a.t("friendlist.blacklist"))},BlackContainer.prototype.setItems=function(e){if(e){for(var i=[],n=[],o=null,r=0,s=e;r<s.length;r++){(o=s[r].ban_user)&&(n.push(o._id),i.push({type:g.Blacklist,id:o._id,nickname:o.nickname,relation:p.FriendRelationEnum.Blacklist}))}t.prototype.setItems.call(this,i),n.length>0&&this.emit(c.PicFriendEvent.REQ_PLAYER_LIST,n)}},BlackContainer.prototype.updateFriends=function(t){for(var e=t.playerInfos,i=null,_loop_3=function(t){(i=n.items.find((function(e){return e.id===t.platformId})))&&(i.nickname=t.nickname,t.level&&(i.lv=t.level.level))},n=this,o=0,r=e;o<r.length;o++){_loop_3(r[o])}this.gridTable&&this.gridTable.setItems(this.items)},BlackContainer.prototype.fetchEventName=function(){return c.PicFriendEvent.REQ_BLACKLIST},BlackContainer}(C),M=function(t){function NewFansContainer(e,i,n,o,r,s){var a=t.call(this,e,i,n,o,r,s)||this;return a.friendType=g.Blacklist,a}return u(NewFansContainer,t),NewFansContainer.prototype.draw=function(){t.prototype.draw.call(this),this.titleText.setText(s.a.t("friendlist.new_fans"))},NewFansContainer}(C),E=function(t){function NewFriendContainer(e,i,n,o,r,s){var a=t.call(this,e,i,n,o,r,s)||this;return a.friendType=g.Blacklist,a}return u(NewFriendContainer,t),NewFriendContainer.prototype.draw=function(){t.prototype.draw.call(this),this.titleText.setText(s.a.t("friendlist.new_friend"))},NewFriendContainer}(C),k=function(t){function SearchInput(e,i,n,o){var r=t.call(this,e,i)||this;r.searchBtn=new d.Button(r.scene,n,"search_blue"),r.searchBtn.x=i.width+4*o+.5*r.searchBtn.width,r.searchBtn.on(String(d.ClickEvent.Tap),r.onSearchHandler,r),r.add(r.searchBtn);var s=e.make.graphics(void 0,!1);return s.fillStyle(16777215),s.fillRoundedRect(-5*o,.5*-i.height,i.width+14*o+r.searchBtn.width,i.height,.5*i.height),r.addAt(s,0),r.setOrigin(0,.5),r}return u(SearchInput,t),SearchInput.prototype.onSearchHandler=function(){this.setBlur(),this.emit("search",this.text)},SearchInput}(l.LabelInput);!function(t){function NavigateContaienr(e,i,n,o,s,a){var h=t.call(this,e,i,n)||this;h.setSize(o,s),h.chars=[];for(var c=0;c<26;c++)h.chars.push(String.fromCharCode(c+65));h.chars.push("#"),h.texts=[];var l=s/h.chars.length,p={color:"#0",fontSize:8*a,fontFamily:r.a.DEFULT_FONT},d=0,m=0;for(c=0;c<h.chars.length;c++){var u=h.scene.make.text({y:c*l-.5*h.height,text:h.chars[c],style:p}).setOrigin(.5);h.texts[c]=u,d||(d=u.width+8*a,m=u.height+2*a)}return h.selected=h.scene.make.graphics(void 0,!1),h.selected.fillStyle(3115002),h.selected.fillRect(.5*-d,.5*-m,d,m),h.add(h.selected),h.selected.x=h.texts[0].x,h.selected.y=h.texts[0].y,h.add(h.texts),h}u(NavigateContaienr,t),NavigateContaienr.prototype.checkSlider=function(t){if(t){this.selected.visible=!0;for(var e=0;e<this.chars.length;e++)if(t.localeCompare(this.chars[e])>-1)return this.selected.x=this.texts[e].x,void(this.selected.y=this.texts[e].y)}else this.selected.visible=!1}}(f);!function(t){t[t.Friends=0]="Friends",t[t.Fans=1]="Fans",t[t.Followes=2]="Followes",t[t.Blacklist=3]="Blacklist",t[t.Search=4]="Search",t[t.NewFriend=5]="NewFriend",t[t.Menu=6]="Menu",t[t.NewFans=7]="NewFans",t[t.Null=8]="Null"}(g||(g={}))},function(t,e,i){"use strict";i.r(e),i.d(e,"PicFriend",(function(){return c}));var n,o=i(110),r=i(2),s=i(0),a=i(151),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicFriend(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i.httpService=e.httpService,e.account&&e.account.accountData&&(i.userId=e.account.accountData.id),i}return h(PicFriend,t),PicFriend.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_PLAYER_LIST,this.onPlayerListHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_SEARCH_PLAYER,this.onSearchHandler))},PicFriend.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicFriend.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicFriend.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicFriend.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},PicFriend.prototype.fetchFriendInfo=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_ANOTHER_PLAYER_INFO);e.content.platformId=t,this.connection.send(e)},PicFriend.prototype.fetchFriendList=function(t){if(t&&!(t.length<1)){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_PLAYER_LIST);e.content.platformIds=t,this.connection.send(e)}},PicFriend.prototype.searchFriend=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_SEARCH_PLAYER);e.content.name=t,this.connection.send(e)},PicFriend.prototype.getFolloweds=function(){if(this.userId)return this.httpService.get("user/"+this.userId+"/followeds");s.a.getInstance().error("fetch follow error, userId does not exist")},PicFriend.prototype.getFans=function(){if(this.userId)return this.httpService.get("user/"+this.userId+"/fans");s.a.getInstance().error("fetch fans error, userId does not exist")},PicFriend.prototype.getBanlist=function(){return this.httpService.get("user/banlist")},PicFriend.prototype.getFriends=function(){return this.httpService.get("user/friends")},Object.defineProperty(PicFriend.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicFriend.prototype.onPlayerListHandler=function(t){this.mEvent.emit(a.PicFriendEvent.PLAYER_LIST,t.content)},PicFriend.prototype.onSearchHandler=function(t){this.mEvent.emit(a.PicFriendEvent.SEARCH_RESULT,t.content)},PicFriend}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e);var n,o,r=i(112),s=i(113),a=i(2),h=i(116),c=i(114),l=i(153),p=i(154),d=i(257),m=i(111),u=i(115),f=i(120),y=i(258),g=i(139),_=i(109),P=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),__spreadArrays=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var r=arguments[e],s=0,a=r.length;s<a;s++,o++)n[o]=r[s];return n},v=Phaser.GameObjects.Container,w=function(t){function CharacterInfoPanel(e,i){var n=t.call(this,e,i)||this;return n.key="player_info",n.commonkey="common_key",n.isOwner=!0,n}return P(CharacterInfoPanel,t),CharacterInfoPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,e,i),this.setSize(n,o),this.mBackGround.clear(),this.mBackGround.fillStyle(0,.66),this.mBackGround.fillRect(0,0,n,o),this.content.setPosition(n/2,o/2),this.mSkillGrideTable.resetMask(),this.content.setInteractive(),this.mCategoryScroll.refreshMask();var r=this.mFirendMenu.getWorldTransformMatrix();this.mFirendMenu.addMask(r.tx-42*this.dpr*this.scale,r.ty,200*this.dpr*this.scale,80*this.dpr*this.scale)},CharacterInfoPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,t&&this.setPlayerData(t),this.setInteractive(),this.addListen()):this.preload())},CharacterInfoPanel.prototype.addListen=function(){this.mInitialized&&(this.closeBtn.on(String(_.ClickEvent.Tap),this.OnClosePanel,this),this.nickEditor.on(String(_.ClickEvent.Tap),this.onEditorHandler,this),this.privaCharBtn.on(String(_.ClickEvent.Tap),this.onPrivateChatHandler,this),this.addFriendBtn.on(String(_.ClickEvent.Tap),this.onAddFriendHandler,this),this.mExitBtn.on(String(_.ClickEvent.Tap),this.onExitHandler,this),this.mFirendMenu.register(),this.mFirendMenu.on("track",this.onTrackHandler,this),this.mFirendMenu.on("invite",this.onIntiveHandler,this),this.mCharacterMenu.register(),this.mCharacterMenu.on("addBlack",this.onAddBlacklistHandler,this),this.mCharacterMenu.on("removeBlack",this.onRemoveBlacklistHandler,this))},CharacterInfoPanel.prototype.removeListen=function(){this.mInitialized&&(this.closeBtn.off(String(_.ClickEvent.Tap),this.OnClosePanel,this),this.nickEditor.off(String(_.ClickEvent.Tap),this.onEditorHandler,this),this.privaCharBtn.off(String(_.ClickEvent.Tap),this.onPrivateChatHandler,this),this.addFriendBtn.off(String(_.ClickEvent.Tap),this.onAddFriendHandler,this),this.mExitBtn.off(String(_.ClickEvent.Tap),this.onExitHandler,this),this.mFirendMenu.unregister(),this.mFirendMenu.off("track",this.onTrackHandler,this),this.mFirendMenu.off("invite",this.onIntiveHandler,this),this.mCharacterMenu.unregister(),this.mCharacterMenu.off("addBlack",this.onAddBlacklistHandler,this),this.mCharacterMenu.off("removeBlack",this.onRemoveBlacklistHandler,this))},CharacterInfoPanel.prototype.preload=function(){this.addAtlas(this.key,"player_info/player_info.png","player_info/player_info.json"),this.commonkey=u.UIAtlasKey.commonKey,this.addAtlas(this.commonkey,u.UIAtlasName.commonUrl+".png",u.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},CharacterInfoPanel.prototype.init=function(){var e=this,i=this.scaleWidth,n=this.scaleHeight;this.mBackGround=this.scene.make.graphics(void 0,!1),this.mBackGround.clear(),this.mBackGround.fillStyle(7004927,0),this.mBackGround.fillRect(0,0,i,n),this.mBackGround.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.add(this.mBackGround),this.bg=this.scene.make.image({x:0,y:0,key:this.key,frame:"bg"}),this.content=this.scene.make.container(void 0,!1),this.content.setSize(this.bg.width,this.bg.height),this.add(this.content),this.content.add(this.bg),this.mainCon=this.scene.make.container(void 0,!1),this.mainCon.setSize(this.bg.width,this.bg.height),this.content.add(this.mainCon);var o=.5*-this.bg.height+43*this.dpr,r="bold "+15*this.dpr+"px Source Han Sans";this.labelText=this.scene.make.text({x:0,y:o,text:c.a.t("player_info.title"),style:{font:r,bold:!0,color:"#ffffff",fontSize:15*this.dpr,fontFamily:s.a.DEFULT_FONT}}).setOrigin(.5,0),this.labelText.setStroke("#8F4300",1),this.closeBtn=new _.Button(this.scene,this.commonkey,"close"),this.closeBtn.setPosition(.5*this.mainCon.width-30*this.dpr,o-10*this.dpr),this.likeBtn=new _.Button(this.scene,this.key,"praise_bef","praise_bef","999"),this.likeBtn.setTextStyle({fontSize:13*this.dpr,fontFamily:s.a.DEFULT_FONT}),this.likeBtn.text.setOrigin(0,.5).x+=10*this.dpr,this.likeBtn.setPosition(.5*this.bg.width-50*this.dpr,o+50*this.dpr),this.likeBtn.visible=!1,this.avatar=new l.a(this.scene,void 0,void 0,!0),this.avatar.scale=2*this.dpr,this.avatar.x=0,this.avatar.y=-70*this.dpr,this.avatar.once("initialized",(function(){e.avatar.play({name:"idle",flip:!1})})),this.mainCon.add([this.labelText,this.closeBtn,this.likeBtn,this.avatar]),this.mFirendMenu=new C(this.scene,this.dpr,this.scale),this.mFirendMenu.x=.5*this.bg.width-this.mFirendMenu.width-14*this.dpr,this.mFirendMenu.y=.5*-this.bg.height+200*this.dpr,this.mCharacterMenu=new T(this.scene,this.dpr,this.scale),this.mCharacterMenu.x=.5*this.bg.width-this.mCharacterMenu.width-14*this.dpr,this.mCharacterMenu.y=.5*-this.bg.height+100*this.dpr,this.mExitBtn=new _.NineSliceButton(this.scene,.5*-this.bg.width+40*this.dpr,this.labelText.y+.5*this.labelText.height,48*this.dpr,26*this.dpr,this.commonkey,"yellow_btn_normal_s","注销",this.dpr,this.scale,{left:8*this.dpr,top:8*this.dpr,right:8*this.dpr,bottom:10*this.dpr}),this.mExitBtn.setTextStyle({fontSize:10*this.dpr,fontFamily:s.a.DEFULT_FONT}),this.mainCon.add([this.mFirendMenu,this.mCharacterMenu,this.mExitBtn]);var a=Math.round(.5*-this.bg.width+25*this.dpr),h=Math.round(.5*this.bg.height-324*this.dpr)+30*this.dpr,p=Math.round(13*this.dpr);this.nickName=new _.BBCodeText(this.scene,a,h,"",{}).setOrigin(0,.5).setFontSize(p).setFontFamily(s.a.DEFULT_FONT),this.nickEditor=new _.Button(this.scene,this.key,"edit","edit"),this.nickEditor.setPosition(.5*this.bg.width-30*this.dpr,h).visible=!1;var d=this.scene.make.image({x:0,y:this.nickName.y+12*this.dpr,key:this.key,frame:"splitters"});d.scaleY=this.dpr,this.idText=new _.BBCodeText(this.scene,a,h).setFontSize(p).setOrigin(0,.5).setFontFamily(s.a.DEFULT_FONT).setColor("#0062BC");var m=this.scene.make.image({x:0,y:this.idText.y+12*this.dpr,key:this.key,frame:"splitters"});m.scaleY=this.dpr,this.titleName=new _.BBCodeText(this.scene,a,h+30*this.dpr).setFontSize(p).setOrigin(0,.5).setFontFamily(s.a.DEFULT_FONT);var u=this.scene.make.image({x:0,y:this.titleName.y+12*this.dpr,key:this.key,frame:"splitters"});u.scaleY=this.dpr;var g=this.scene.make.image({x:0,y:0,key:this.key,frame:"level_bg"});this.lvText=this.scene.make.text({x:0,y:0,text:"lv 98",style:{color:"#996600",fontSize:p,fontFamily:s.a.DEFULT_FONT}}).setOrigin(.5,.5),this.lvCon=this.scene.make.container(void 0,!1),this.lvCon.setSize(g.width,g.height),this.lvCon.setPosition(.5*-this.content.width+.5*this.lvCon.width+20*this.dpr,.5*-this.content.height+90*this.dpr),this.lvCon.add([g,this.lvText]),this.mainCon.add([this.nickName,this.nickEditor,d,m,u,this.titleName,this.lvCon]);var P=260*this.dpr,v=210*this.dpr;this.bottomCon=this.scene.make.container(void 0,!1),this.bottomCon.setSize(P,v),this.bottomCon.setPosition(0,.5*this.bg.height-.5*v-30*this.dpr),this.mainCon.add(this.bottomCon),this.bottombg=this.scene.make.graphics(void 0,!1);var w=32*this.dpr,b=.5*-v+.5*w-3*this.dpr;this.mCategoryScroll=new _.GameScroller(this.scene,{x:0,y:b,width:P,height:w,zoom:this.scale,orientation:1,dpr:this.dpr,space:10*this.dpr,cellupCallBack:function(t){e.onSelectSubCategoryHandler(t)}});var I=this.scene.textures.getFrame(this.key,"skill_bg"),M=I.width+5*this.dpr,E=I.height+8*this.dpr,k=this.bottomCon.width,B=200*this.dpr,O=b+.5*w+.5*B;this.mSkillGrideTable=this.createGrideTable(0,O,k,B,M,E,(function(){return new S(e.scene,0,0,e.key,e.dpr)}),new f.a(this,this.onSelectItemHandler));var D=150*this.dpr;this.mAttrPanel=new y.CharacterAttributePanel(this.scene,0,O,k-30*this.dpr,D,this.key,this.dpr),this.bottomCon.add([this.bottombg,this.mCategoryScroll,this.mSkillGrideTable,this.mAttrPanel]);var R=-60*this.dpr,x=.5*this.bottomCon.height-20*this.dpr;this.addFriendBtn=new _.NineSliceButton(this.scene,0,x,94*this.dpr,37*this.dpr,this.key,"button_g",c.a.t("player_info.add_friend"),this.dpr,this.scale,{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr}),this.addFriendBtn.setFrameNormal("button_g"),this.privaCharBtn=new _.NineSliceButton(this.scene,R,x,94*this.dpr,37*this.dpr,this.commonkey,"yellow_btn",c.a.t("player_info.private_chat"),this.dpr,this.scale,{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr}),this.addFriendBtn.setTextStyle({fontSize:16*this.dpr,color:"#000000"}),this.privaCharBtn.setTextStyle({fontSize:16*this.dpr,color:"#996600"}),this.bottomCon.add([this.addFriendBtn,this.privaCharBtn]),this.content.visible=!1,this.resize(i,n),t.prototype.init.call(this)},CharacterInfoPanel.prototype.reqPlayerInfo=function(){this.emit("queryOwnerInfo")},CharacterInfoPanel.prototype.setPlayerData=function(t){if(this.mInitialized){this.mCharacterData=t,this.content.visible=!0;var e=t.nickname,i=t.currentTitle,n=(t.level.currentLevelExp,t.level.nextLevelExp,t.cid,t.level.level),r=this.getspaceStr(1*this.dpr);this.avatar&&this.avatar.load(new p.a({id:0,avatar:t.currentAvatar.avatar})),this.titleName.setText(this.getRichLabel(c.a.t("player_info.player_title"))+r+i),this.likeBtn.setText(t.like+"");var s=.5*this.bg.width-.5*this.likeBtn.width-this.likeBtn.text.width;this.likeBtn.x=s-20*this.dpr,this.lvText.text="lv "+n,this.idText.setText("(52365404)");var h=new Map;if(h.set(o.Skill,t.lifeSkills),t instanceof a.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_PKT_SELF_PLAYER_INFO){this.nickName.setText(this.getRichLabel(c.a.t("player_info.nick_name"))+r+e),this.likeBtn.setFrame("praise_aft"),h.set(o.Attribute,t.properties),h.set(o.Badge,t.badges),this.addFriendBtn.visible=!1,this.privaCharBtn.visible=!1,this.mFirendMenu.visible=!1,this.mExitBtn.visible=!0,this.bottombg.clear(),this.bottombg.fillStyle(7004927,1),this.bottombg.fillRect(.5*-this.bottomCon.width,.5*-this.bottomCon.height,this.bottomCon.width,this.bottomCon.height);var l=200*this.dpr;this.mSkillGrideTable.setSize(this.mSkillGrideTable.width,l);var d=0,m=this.mCategoryScroll.y+.5*l+0*this.dpr;this.mSkillGrideTable.refreshPos(d,m),this.mSkillGrideTable.setColumnCount(3),this.isOwner=!0,this.mCharacterMenu.visible=!1,this.mAttrPanel.setSize(this.mAttrPanel.width,l),this.mAttrPanel.y=m+15*this.dpr,this.mAttrPanel.space=20*this.dpr}else{t.remark?t.remark:c.a.t("player_info.note_nickname");this.nickName.setText(this.getRichLabel(c.a.t("player_info.nick_name"))+r+e),this.likeBtn.setFrame("praise_bef"),h.set(o.Attribute,t.properties),h.set(o.Badge,t.badges),this.addFriendBtn.visible=!t.friend,this.privaCharBtn.visible=t.friend,this.mExitBtn.visible=!1,this.bottombg.clear(),this.bottombg.fillStyle(7004927,1),this.bottombg.fillRect(.5*-this.bottomCon.width,.5*-this.bottomCon.height,this.bottomCon.width,this.bottomCon.height-55*this.dpr);l=150*this.dpr;this.mSkillGrideTable.setSize(this.mSkillGrideTable.width,l);d=0,m=this.mCategoryScroll.y+.5*l+0*this.dpr;this.mSkillGrideTable.refreshPos(d,m),this.mSkillGrideTable.setColumnCount(2),this.isOwner=!1,this.mCharacterMenu.visible=!0,this.mAttrPanel.setSize(this.mAttrPanel.width,l),this.mAttrPanel.y=m+15*this.dpr,this.mAttrPanel.space=10*this.dpr}this.idText.x=this.nickName.x+this.nickName.width*(1-this.nickName.originX)+8*this.dpr,this.mFirendMenu.visible=!1,this.setSubCategory(h),this.setFriendRelation(g.FriendRelationEnum.Null)}else this.mShowData=t},CharacterInfoPanel.prototype.setFriendRelation=function(t){this.isOwner||(this.mRelation=t,this.mFirendMenu.visible=t===g.FriendRelationEnum.Friend,this.mCharacterMenu.setIsBlack(t===g.FriendRelationEnum.Blacklist),this.addFriendBtn.visible=t!==g.FriendRelationEnum.Blacklist,t===g.FriendRelationEnum.Followed||t===g.FriendRelationEnum.Friend?this.addFriendBtn.setText(c.a.t("friendlist.unfollow")):this.addFriendBtn.setText(c.a.t("friendlist.follow")))},CharacterInfoPanel.prototype.destroy=function(){this.mSkillGrideTable.destroy(),this.mCategoryScroll.destroy(),t.prototype.destroy.call(this)},CharacterInfoPanel.prototype.createGrideTable=function(t,e,i,n,o,r,s,a){var h=this,c={x:t,y:e,table:{width:i,height:n,columns:3,cellWidth:o,cellHeight:r,reuseCellContainer:!0,cellPadX:24*this.dpr,zoom:this.scale},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&(e=s()),e.setData({item:i}),e.setItemData(i,h.isOwner),e}},l=new _.GameGridTable(this.scene,c);return l.layout(),l.on("cellTap",(function(t){t&&a.runWith(t)})),l},CharacterInfoPanel.prototype.OnClosePanel=function(){this.emit("hide")},CharacterInfoPanel.prototype.setSubCategory=function(t){var e=this,i=(c.a.t("player_info.option_live"),c.a.t("player_info.option_attribute"),c.a.t("player_info.option_badge"),this.mScene.textures.getFrame(this.key,"title_select").width),n=this.mCategoryScroll.getItemList().concat();this.mCategoryScroll.clearItems(!1);for(var o=0,r=n;o<r.length;o++){r[o].visible=!1}var a=0;t.forEach((function(t,o){var r,h=e.getOptionName(o);a<n.length?r=n[a]:((r=new _.Button(e.scene,e.key,"title_normal","title_select",h)).width=i,r.height=41*e.dpr,n.push(r),r.setTextStyle({color:"#2B4BB5",fontSize:12*e.dpr,fontFamily:s.a.BOLD_FONT}),r.disInteractive(),r.removeListen()),r.visible=!0,r.setText(h),r.setData("subData",t),r.setData("optiontype",o),e.mCategoryScroll.addItem(r),a++})),n.length<=3?this.mCategoryScroll.setAlign(1):this.mCategoryScroll.setAlign(2),this.onSelectSubCategoryHandler(n[0])},CharacterInfoPanel.prototype.onSelectSubCategoryHandler=function(t){this.curSelectCategeory&&(this.curSelectCategeory.changeNormal(),this.curSelectCategeory.setTextColor("#2B4BB5")),t.changeDown(),t.setTextColor("#996600"),this.curSelectCategeory=t;var e=t.getData("subData"),i=t.getData("optiontype");i===o.Skill?(this.mSkillGrideTable.setItems(e),this.mAttrPanel.visible=!1,this.mSkillGrideTable.visible=!0):i===o.Attribute?(e&&this.mAttrPanel.setAttributeData(e),this.mAttrPanel.visible=!0,this.mSkillGrideTable.setItems([]),this.mSkillGrideTable.visible=!1):i===o.Badge&&(this.mAttrPanel.visible=!1,this.mSkillGrideTable.visible=!1)},CharacterInfoPanel.prototype.onSelectItemHandler=function(t){},CharacterInfoPanel.prototype.onEditorHandler=function(){var t=247*this.dpr,e=this.content.height;this.editorPanel||(this.editorPanel=new d.CharacterEditorPanel(this.scene,0,0,t,e,this.key,this.dpr)),this.content.add(this.editorPanel),this.editorPanel.visible=!0,this.editorPanel.on("editorHide",this.onEditorPanelHideHandler,this),this.setMainUIVisible(!1)},CharacterInfoPanel.prototype.onAddFriendHandler=function(){if(this.mCharacterData)switch(this.mRelation){case g.FriendRelationEnum.Friend:case g.FriendRelationEnum.Followed:this.emit("unfollow",this.mCharacterData.cid);break;case g.FriendRelationEnum.Fans:case g.FriendRelationEnum.Null:this.emit("follow",this.mCharacterData.cid)}},CharacterInfoPanel.prototype.onTradingHandler=function(){},CharacterInfoPanel.prototype.onPrivateChatHandler=function(){},CharacterInfoPanel.prototype.onExitHandler=function(){this.mWorld.exitUser()},CharacterInfoPanel.prototype.onEditorPanelHideHandler=function(){this.mainCon.visible=!0,this.remove(this.editorPanel),this.editorPanel.off("editorHide",this.onEditorPanelHideHandler,this),this.editorPanel.destroy(),this.editorPanel=null,this.setMainUIVisible(!0)},CharacterInfoPanel.prototype.setMainUIVisible=function(t){this.avatar.visible=t,this.mCategoryScroll.visible=t,this.mSkillGrideTable.visible=t,this.mainCon.visible=t},CharacterInfoPanel.prototype.getRichLabel=function(t,e){return void 0===e&&(e="#2B4BB5"),"[stroke="+e+"][color="+e+"]"+t+":[/color][/stroke]"},CharacterInfoPanel.prototype.getspaceStr=function(t){for(var e="",i=0;i<t;i++)e+=" ";return e},CharacterInfoPanel.prototype.getOptionName=function(t){var e="";return t===o.Skill?e=c.a.t("player_info.option_live"):t===o.Attribute?e=c.a.t("player_info.option_attribute"):t===o.Badge?e=c.a.t("player_info.option_badge"):t===o.Title&&(e=c.a.t("player_info.option_title")),e},CharacterInfoPanel.prototype.onTrackHandler=function(){this.mCharacterData&&this.emit("track",this.mCharacterData.cid)},CharacterInfoPanel.prototype.onIntiveHandler=function(){this.mCharacterData&&this.emit("invite",this.mCharacterData.cid)},CharacterInfoPanel.prototype.onAddBlacklistHandler=function(){this.mCharacterData&&this.emit("addBlack",this.mCharacterData.cid)},CharacterInfoPanel.prototype.onRemoveBlacklistHandler=function(){this.mCharacterData&&this.emit("removeBlack",this.mCharacterData.cid)},CharacterInfoPanel}(r.BasePanel);e.default=w,function(t){t[t.Skill=0]="Skill",t[t.Attribute=1]="Attribute",t[t.Badge=2]="Badge",t[t.Title=3]="Title",t[t.Avatar=4]="Avatar"}(o||(o={}));var S=function(t){function CharacterOwnerItem(e,i,n,o,r){var a=t.call(this,e,i,n)||this;a.dpr=0;var c=a.scene.make.image({x:0,y:0,key:o,frame:"skill_bg"});return a.nameText=a.scene.make.text({x:-1*r,y:0,text:"",style:{color:"#996600",fontSize:12*r,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,.5),a.lvText=a.scene.make.text({x:-1*r,y:0,text:"",style:{color:"#996600",fontSize:12*r,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,.5),a.progressBar=new _.ProgressBar(a.scene,{x:48*r/2,y:15*r,width:41*r,height:4*r,background:{x:0,y:0,width:41*r,height:4*r,config:{top:1*r,left:2*r,right:2*r,bottom:1*r},key:o,frame:"slider_bg"},bar:{x:0,y:0,width:41*r,height:4*r,config:{top:1*r,left:2*r,right:2*r,bottom:1*r},key:o,frame:"slider_rate"},dpr:r,textConfig:void 0}),a.icon=new h.DynamicImage(a.scene,.5*-c.width+22*r,0),a.add([c,a.icon,a.nameText,a.lvText,a.progressBar]),a.setSize(c.width,c.height),a.dpr=r,a.key=o,a}return P(CharacterOwnerItem,t),CharacterOwnerItem.prototype.setItemData=function(t,e){var i=this;void 0===e&&(e=!1),this.itemData=t,this.nameText.text=t.name;var n=e?-16*this.dpr:-11*this.dpr,o=e?20*this.dpr:25*this.dpr,r=10*this.dpr;this.nameText.y=n+.5*r,this.icon.setTexture(this.key,"test_skillicon");var s=this.icon.width;t.level?(this.lvText.text=t.level.level,this.lvText.y=n+o,this.progressBar.setProgress(t.level.currentLevelExp,t.level.nextLevelExp),this.progressBar.visible=e):(this.progressBar.visible=!1,this.lvText.visible=!1);var a=m.i.getOsdRes(t.display.texturePath);this.icon.load(a,this,(function(){i.icon.scale=i.dpr;var t=.5*-i.width+.5*s+6*i.dpr;i.icon.setPosition(t,0)}))},CharacterOwnerItem}(v),b=function(t){function Menu(e,i,n,o,r){var s=t.call(this,e)||this;return s.mDpr=i,s.mScale=n,s.setSize(o,r),s.draw(),s}return P(Menu,t),Menu.prototype.register=function(){},Menu.prototype.unregister=function(){},Menu.prototype.addMask=function(t,e,i,n){this.maskGraphic||(this.maskGraphic=this.scene.make.graphics(void 0,!1)),this.maskGraphic.x=t,this.maskGraphic.y=e,this.maskGraphic.fillRect(.5*-i,.5*-n,i,n),this.setMask(this.maskGraphic.createGeometryMask())},Menu.prototype.draw=function(){this.createBackground()},Menu.prototype.createBackground=function(){this.background||(this.background=this.scene.make.graphics(void 0,!1));var t=3*this.mDpr;this.background.fillStyle(7583,.2),this.background.fillRoundedRect(0,0,this.width,this.height,{tl:t,tr:0,br:0,bl:t}),this.addAt(this.background,0)},Menu}(v),C=function(t){function FriendMenu(e,i,n){var o=t.call(this,e,i,n,58*i,40*i)||this;return o.isExpand=!1,o}return P(FriendMenu,t),FriendMenu.prototype.register=function(){this.trackBtn.on(String(_.ClickEvent.Tap),this.onTrackHandler,this),this.inviteBtn.on(String(_.ClickEvent.Tap),this.onInviteHandler,this);var t=this.operation,e=t.width,i=t.height;this.operation.setInteractive(new Phaser.Geom.Rectangle(-e,-i,3*e,3*i),Phaser.Geom.Rectangle.Contains),this.operation.on("pointerup",this.onSwitchOperationHandler,this)},FriendMenu.prototype.unregister=function(){this.trackBtn.off(String(_.ClickEvent.Tap),this.onTrackHandler,this),this.inviteBtn.off(String(_.ClickEvent.Tap),this.onInviteHandler,this),this.operation.disableInteractive(),this.operation.on("pointerup",this.onSwitchOperationHandler,this)},FriendMenu.prototype.destroy=function(){this.operationContaienr&&this.operationContaienr.destroy(),this.operation&&this.operation.destroy(),this.inviteBtn&&this.inviteBtn.destroy(),this.trackBtn&&this.trackBtn.destroy(),this.tween&&this.tween.stop(),this.autoCollapseTime&&clearTimeout(this.autoCollapseTime),this.buttons=[]},FriendMenu.prototype.expand=function(){var t=this;if(!this.tween||!this.tween.isPlaying()){this.operationContaienr.remove(this.operation),this.operationContaienr.remove(this.background),this.operationContaienr.add(this.buttons);var e=this.getBounds();if(this.isExpand=!0,e){var i=e.width+8*this.mDpr;this.setSize(i,this.height),this.createBackground(),this.operationContaienr.addAt(this.background,0),this.operationContaienr.x=.5*e.width,this.tween=this.scene.tweens.add({targets:this.operationContaienr,props:{x:.5*-e.width,alpha:1},duration:100}),this.autoCollapseTime=setTimeout((function(){t.autoCollapseTime=null,t.collapse()}),3e3)}}},FriendMenu.prototype.collapse=function(){var t=this;this.tween&&this.tween.isPlaying()||(this.autoCollapseTime&&clearTimeout(this.autoCollapseTime),this.tween=this.scene.tweens.add({targets:this.operationContaienr,props:{x:.5*this.width},duration:100,onComplete:function(){t.operationContaienr.remove(__spreadArrays(t.buttons),!1),t.operationContaienr.add(t.operation),t.setSize(58*t.mDpr,40*t.mDpr),t.createBackground(),t.operationContaienr.addAt(t.background,0),t.operationContaienr.x=0,t.isExpand=!1}}))},FriendMenu.prototype.draw=function(){this.operationContaienr=this.scene.make.container(void 0,!1),this.add(this.operationContaienr),this.buttons=[],this.inviteBtn=this.createButton(c.a.t("player_info.invite")),this.buttons.push(this.inviteBtn),this.trackBtn=this.createButton(c.a.t("player_info.track")),this.buttons.push(this.trackBtn),this.operation=this.scene.make.text({x:.5*this.width,y:.5*this.height,text:c.a.t("player_info.operation"),style:{color:"#FFD248",fontSize:10*this.mDpr,fontFamily:s.a.DEFULT_FONT}},!1).setOrigin(.5);for(var t=0;t<this.buttons.length;t++)this.buttons[t].x=0===t?.5*this.buttons[t].width+6*this.mDpr:this.buttons[t-1].x+.5*(this.buttons[t-1].width+this.buttons[t].width)+6*this.mDpr,this.buttons[t].y=.5*this.height;this.collapse()},FriendMenu.prototype.createBackground=function(){this.background||(this.background=this.scene.make.graphics(void 0,!1));var t=3*this.mDpr;this.background.clear(),this.background.fillStyle(7583,.2),this.background.fillRoundedRect(0,0,this.width,this.height,{tl:t,tr:0,br:0,bl:t})},FriendMenu.prototype.onTrackHandler=function(){this.emit("track"),this.collapse()},FriendMenu.prototype.onInviteHandler=function(){this.emit("invite"),this.collapse()},FriendMenu.prototype.onSwitchOperationHandler=function(){this.isExpand?this.collapse():this.expand()},FriendMenu.prototype.createButton=function(t){var e=this.mDpr,i=this.mScale,n=new _.NineSliceButton(this.scene,-0,0,48*e,26*e,u.UIAtlasKey.commonKey,"yellow_btn_normal_s",t,e,i,{left:8*e,top:8*e,right:8*e,bottom:10*e});return n.setTextStyle({color:"#996600",fontSize:10*e,fontFamily:s.a.DEFULT_FONT}),n},FriendMenu}(b),T=function(t){function CharacterMenu(e,i,n){return t.call(this,e,i,n,58*i,36*i)||this}return P(CharacterMenu,t),CharacterMenu.prototype.register=function(){this.addBlacklistBtn.on(String(_.ClickEvent.Tap),this.onAddBlackHandler,this)},CharacterMenu.prototype.unregister=function(){this.addBlacklistBtn.off(String(_.ClickEvent.Tap),this.onAddBlackHandler,this)},CharacterMenu.prototype.setIsBlack=function(t){this.isBlack=t,this.addBlacklistBtn.setText(c.a.t(t?"player_info.remove_black":"player_info.add_black"))},CharacterMenu.prototype.draw=function(){t.prototype.draw.call(this),this.addBlacklistBtn=new _.NineSliceButton(this.scene,0,0,55*this.mDpr,24*this.mDpr,u.UIAtlasKey.commonKey,"red_btn_normal",c.a.t("player_info.add_black"),this.mDpr,this.mScale,{left:12*this.mDpr,top:12*this.mDpr,right:12*this.mDpr,bottom:12*this.mDpr}),this.addBlacklistBtn.setTextStyle({color:"#FFFFFF",fontSize:10*this.mDpr,fontFamily:s.a.DEFULT_FONT}),this.addBlacklistBtn.x=.5*this.width,this.addBlacklistBtn.y=6*this.mDpr+.5*this.addBlacklistBtn.height,this.add(this.addBlacklistBtn)},CharacterMenu.prototype.onAddBlackHandler=function(){this.emit(this.isBlack?"removeBlack":"addBlack")},CharacterMenu}(b)},function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterEditorPanel",(function(){return c}));var n,o=i(113),r=i(121),s=i(114),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function CharacterEditorPanel(e,i,n,s,h,c,l){var p=t.call(this,e,i,n)||this;p.dpr=0,p.key="",p.setSize(s,h),p.key=c,p.dpr=l;var d="bold "+15*p.dpr+"px Source Han Sans";p.title=p.scene.make.text({x:0,y:.5*-h+50*l,text:p.geti18n("edit_profile"),style:{font:d,blod:!0,color:"#ffffff",fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5);var m=p.scene.make.graphics(void 0,!1);m.clear(),m.fillStyle(16777215,.5),m.fillRect(0,0,247*l,350*l),m.setPosition(.5*-s,-184*l);var u=.5*-s+9*l,f=-170*l,y=50*l,g=p.scene.make.text({x:u,y:f,style:{blod:!0,color:"#0062BB",fontSize:15*l,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0);g.setText(p.geti18n("user_name")+":"),p.inputText=new a.InputText(p.scene,u+g.width+20*l,f,162*l,27*l,{type:"input",fontSize:18*l+"px",color:"#0062BB",align:"center",placeholder:p.geti18n("input_nickname")}).setOrigin(0);var _=p.createLine(-230*p.dpr*.5,f+32*p.dpr);p.add(m),p.add([p.title,g,p.inputText,_]),p.idText=p.createText("I        D:","",u,f+y),p.constellationText=p.createText(p.geti18n("constellation")+":","",u,f+2*y),p.birthdayText=p.createText(p.geti18n("birthday")+":","",u,f+3*y),p.cityText=p.createText(p.geti18n("city")+":","",u,f+4*y);var P=p.scene.make.text({x:u,y:f+5*y,style:{blod:!0,color:"#0062BB",fontSize:15*l,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0);P.setText(p.geti18n("signature")+":"),p.signInput=new a.InputText(p.scene,u+P.width+20*l,f+5*y,162*l,76*l,{type:"input",fontSize:18*l+"px",color:"#0062BB",align:"center",placeholder:p.geti18n("input_signature")}).setOrigin(0),p.add([P,p.signInput]);var v=new a.Button(p.scene,"common_key","back_arrow","back_arrow"),w=new r.NinePatchButton(p.scene,0,.5*h-40*l,174*p.dpr,37*p.dpr,"common_key","yellow_btn",p.geti18n("save"),{left:12*p.dpr,top:12*p.dpr,right:12*p.dpr,bottom:12*p.dpr});return w.setTextStyle({fontSize:16*p.dpr,color:"#ED7814"}),v.setPosition(u+8*l,.5*-h+50*l),v.on(a.ClickEvent.Tap,p.onBackHandler,p),w.on(a.ClickEvent.Tap,p.onSaveHandler,p),p.add([v,w]),p}return h(CharacterEditorPanel,t),CharacterEditorPanel.prototype.destroy=function(){this.inputText&&this.inputText.destroy(),this.signInput&&this.signInput.destroy(),t.prototype.destroy.call(this)},CharacterEditorPanel.prototype.createText=function(t,e,i,n){var r=this.scene.make.text({x:i,y:n,style:{blod:!0,color:"#0062BB",fontSize:15*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0,0);r.setText(t);var s=this.scene.make.text({x:i+r.width+20*this.dpr,y:n,text:e,style:{blod:!0,color:"#ffffff",fontSize:15*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0,0),a=this.createLine(-230*this.dpr*.5,n+32*this.dpr);return this.add([r,s,a]),s},CharacterEditorPanel.prototype.geti18n=function(t){return s.a.t("player_info."+t)},CharacterEditorPanel.prototype.createLine=function(t,e){var i=this.scene.make.graphics(void 0,!1);return i.clear(),i.fillStyle(25275,.6),i.fillRect(0,0,230*this.dpr,3),i.setPosition(t,e),i},CharacterEditorPanel.prototype.onBackHandler=function(){this.visible=!1,this.emit("editorHide")},CharacterEditorPanel.prototype.onSaveHandler=function(){},CharacterEditorPanel}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterAttributePanel",(function(){return c}));var n,o=i(113),r=i(116),s=i(111),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function CharacterAttributePanel(e,i,n,o,r,s,a){var h=t.call(this,e,i,n)||this;return h.attriItems=[],h.setSize(o,r),h.key=s,h.dpr=a,h.mspace=10*a,h}return h(CharacterAttributePanel,t),Object.defineProperty(CharacterAttributePanel.prototype,"space",{set:function(t){this.mspace=t},enumerable:!1,configurable:!0}),CharacterAttributePanel.prototype.setAttributeData=function(t){for(var e=t.length,i=e>4?2:1,n=this.width,o=this.height,r=20*this.dpr,s=n/2,a=.5*-o+10*this.dpr,h=0,c=this.attriItems;h<c.length;h++){(d=c[h]).visible=!1}for(var p=0;p<e;p++){var d=void 0;p<this.attriItems.length?d=this.attriItems[p]:(d=new l(this.scene,0,0,s,r,this.key,this.dpr),this.add(d),this.attriItems.push(d));var m=.5*(n-n/i)*(p<4?-1:1),u=a+.5*r+(r+this.mspace)*(p%4);d.setPosition(m,u),d.setInfo(t[p]),d.visible=!0}},CharacterAttributePanel}(Phaser.GameObjects.Container),l=function(t){function PlayerAttributeValue(e,i,n,s,h,c,l){var p=t.call(this,e,i,n)||this;return p.dpr=l,p.setSize(s,h),p.icon=new r.DynamicImage(p.scene,0,0),p.icon.x=.5*-s+10*l,p.nameText=p.scene.make.text({x:p.icon.x+13*l,y:0,text:"Attack:",style:{fontFamily:o.a.DEFULT_FONT,fontSize:11*l,color:"#131313"}}).setOrigin(0,.5),p.valueText=new a.BBCodeText(p.scene,0,0,"100",{color:"#131313",fontSize:11*p.dpr,fontFamily:o.a.DEFULT_FONT}).setOrigin(0,.5),p.valueText.x=p.nameText.x+p.nameText.width,p.add([p.icon,p.nameText,p.valueText]),p}return h(PlayerAttributeValue,t),PlayerAttributeValue.prototype.setInfo=function(t){var e=this;if(t.display){var i=s.i.getOsdRes(t.display.texturePath);this.icon.load(i,this,(function(){e.icon.displayWidth=20*e.dpr,e.icon.scaleY=e.icon.scaleX}))}this.nameText.text=t.name+":",this.valueText.text=t.value+(t.tempValue?this.getRichLabel(t.tempValue):""),this.valueText.x=this.nameText.x+this.nameText.width+3*this.dpr},PlayerAttributeValue.prototype.getRichLabel=function(t,e){return void 0===e&&(e="#0B77CD"),"[color="+e+"](+"+t+")[/color]"},PlayerAttributeValue}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"ComponentRankMediator",(function(){return a}));var n,o=i(260),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function ComponentRankMediator(e,i,n){var s=t.call(this)||this;return s.mUIType=r.UIType.Normal,s.mView=new o.ComponentRankPanel(i,n),e.addToUILayer(s.mView),s.mLayerManager=e,s.mScene=i,s.world=n,s}return s(ComponentRankMediator,t),ComponentRankMediator.prototype.getName=function(){return""},ComponentRankMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView.hide(),this.mView=null)},ComponentRankMediator.prototype.isSceneUI=function(){return!1},ComponentRankMediator.prototype.isShow=function(){return!1},ComponentRankMediator.prototype.resize=function(){this.mView.resize()},ComponentRankMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView=new o.ComponentRankPanel(this.mScene,this.world),this.mLayerManager.addToUILayer(this.mView),this.mView.show(),e&&e.length>0&&this.mView.addItem(e[0]),t.prototype.show.call(this,e))},ComponentRankMediator.prototype.destroy=function(){this.mView&&this.mView.parentContainer&&this.mView.parentContainer.remove(this.mView),t.prototype.destroy.call(this)},ComponentRankMediator.prototype.update=function(t){t&&t.length>0&&this.mView.addItem(t[0])},ComponentRankMediator.NAME="ComponentRankMediator",ComponentRankMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ComponentRankPanel",(function(){return h}));var n,o=i(160),r=i(111),s=i(259),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ComponentRankPanel(e,i){return t.call(this,e,i)||this}return a(ComponentRankPanel,t),ComponentRankPanel.prototype.addListen=function(){this.mCloseBtn.on("pointerup",this.onCloseHandler,this)},ComponentRankPanel.prototype.removeListen=function(){this.mCloseBtn.off("pointerup",this.onCloseHandler,this)},ComponentRankPanel.prototype.resize=function(t,e){if(this.scene){var i=this.scene.cameras.main.worldView;this.x=i.width-this.width-t>>1,this.y=i.height-this.height-e>>1}},ComponentRankPanel.prototype.destroy=function(){this.mCloseBtn&&(this.mCloseBtn.destroy(!0),this.mCloseBtn=null),t.prototype.destroy.call(this)},ComponentRankPanel.prototype.preload=function(){this.scene.load.spritesheet(r.e.getName(),r.e.getPNG(),r.e.getFrameConfig()),t.prototype.preload.call(this)},ComponentRankPanel.prototype.init=function(){this.mCloseBtn=this.scene.make.image({x:0,y:0,key:r.e.getName(),frame:"btn_normal"},!1),this.mCloseBtn.setTexture(r.e.getName(),"btn_normal"),this.mCloseBtn.x=(this.width>>1)-65,this.mCloseBtn.y=-this.height>>1,t.prototype.init.call(this),this.add(this.mCloseBtn),this.mCloseBtn.setInteractive(),this.mWorld.uiManager.getMediator(s.ComponentRankMediator.NAME).resize(),this.mCloseBtn.x=this.width-18},ComponentRankPanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(s.ComponentRankMediator.NAME).resize()},ComponentRankPanel.prototype.onCloseHandler=function(){this.hide()},ComponentRankPanel}(o.BasicRankPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ControlFPanel",(function(){return h}));var n,o=i(112),r=i(111),s=i(113),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ControlFPanel(e,i){var n=t.call(this,e,i)||this;return n.setTween(!1),n}return a(ControlFPanel,t),ControlFPanel.prototype.addListen=function(){this.on("pointerdown",this.onMouseDownHandler,this)},ControlFPanel.prototype.removeListen=function(){this.off("pointerdown",this.onMouseDownHandler,this)},ControlFPanel.prototype.resize=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),this.mScene){var i=this.mScene.cameras.main.worldView;this.x=i.x+(i.width>>1),this.y=i.y+(i.height>>1)}},ControlFPanel.prototype.destroy=function(){this.mControlText&&this.mControlText.destroy(!0),t.prototype.destroy.call(this)},ControlFPanel.prototype.preload=function(){this.mScene.load.image("controlF_background",r.i.getRes("ui/controlf/background.png")),t.prototype.preload.call(this)},ControlFPanel.prototype.init=function(){if(this.mScene){var e=this.mScene.make.image({key:"controlF_background"},!1);this.add(e),this.mControlText=this.mScene.make.text({align:"center",text:"F",style:{font:s.a.YAHEI_20_BOLD}},!1),this.mControlText.x=-(this.mControlText.width>>1),this.mControlText.y=-(this.mControlText.height>>1),this.add(this.mControlText),this.setSize(e.width,e.height),this.setInteractive(),t.prototype.init.call(this),this.resize()}},ControlFPanel.prototype.onMouseDownHandler=function(){this.scale=.8},ControlFPanel.prototype.onMouseUpHandler=function(){this.scale=1,this.emit("control")},ControlFPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInPanel",(function(){return h}));var n,o=i(112),r=i(111),s=i(113),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function CutInPanel(e,i){var n=t.call(this,e,i)||this;return n.key="cut_in",n}return a(CutInPanel,t),CutInPanel.prototype.show=function(t){var e=this;if(this.mShowData=t,this.mInitialized){if(t&&t.length>0){var i=t[0].text;this.mName&&this.mName.setText(i[0].text)}else this.mName&&this.mName.setText("???");var n=this.scene.cameras.main.width;this.x=n+this.width/2;var o=this.scene.cameras.main.width/2;this.scene.tweens.timeline({targets:this,duration:300,tweens:[{x:o,alpha:1,ease:"Sine.easeInOut"},{delay:2e3,y:this.y-10*this.dpr,alpha:0}],onComplete:function(){e.emit("close")}})}else this.preload()},CutInPanel.prototype.resize=function(t,e){this.y=140*this.dpr},CutInPanel.prototype.preload=function(){this.scene.load.image(this.key,r.i.getUIRes(this.dpr,"cut_in/cut_in_bg.png")),t.prototype.preload.call(this)},CutInPanel.prototype.init=function(){var e=this.scene.make.image({key:this.key},!1);this.setSize(e.width*this.scale,e.height*this.scale),this.mName=this.scene.make.text({style:{color:"#ffcc33",fontSize:18*this.dpr,fotnFamily:s.a.DEFULT_FONT}},!1).setOrigin(.5),this.mName.setFontStyle("bold"),this.mName.setStroke("#000000",1*this.dpr),this.add([e,this.mName]),t.prototype.init.call(this),this.resize(this.scene.cameras.main.width,this.scene.cameras.main.height),this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this)},CutInPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInMenu",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function CutInMenu(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(CutInMenu,t),CutInMenu.prototype.register=function(){this.connection&&this.connection.addPacketListener(this)},CutInMenu.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},CutInMenu.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},CutInMenu.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},CutInMenu.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},CutInMenu.prototype.reqRightButton=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),n=i.content;n.uiId=t,n.componentId=e,this.connection.send(i)},Object.defineProperty(CutInMenu.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),CutInMenu}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInMenuPanel",(function(){return a}));var n,o=i(112),r=i(120),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function CutInMenuPanel(e,i){var n=t.call(this,e,i)||this;return n.key="cutinmenupanel",n.mapPop=new Map,n.world=i,n}return s(CutInMenuPanel,t),CutInMenuPanel.prototype.resize=function(e,i){t.prototype.resize.call(this,e,i),this.setSize(e,i)},CutInMenuPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen()):this.preload())},CutInMenuPanel.prototype.addListen=function(){this.mInitialized},CutInMenuPanel.prototype.removeListen=function(){this.mInitialized},CutInMenuPanel.prototype.preload=function(){this.addAtlas(this.key,"cutInmenu/cutInmenu.png","cutInmenu/cutInmenu.json"),t.prototype.preload.call(this)},CutInMenuPanel.prototype.init=function(){var e=this.scaleWidth,i=this.scaleHeight;this.rightPopButton=new h(this.scene,e,this.key,this.dpr);var n=e+.5*this.rightPopButton.width-15*this.dpr,o=this.getActivityBounds();o?this.rightPopButton.setPosition(n,o.bottom+this.rightPopButton.height):this.rightPopButton.setPosition(n,.5*i),this.rightPopButton.setClickHandler(new r.a(this,this.onRightClickHandler)),this.add(this.rightPopButton),this.resize(e,i),t.prototype.init.call(this),this.opneButton()},CutInMenuPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},CutInMenuPanel.prototype.opneButton=function(){this.rightPopButton.onTakeBack();var t=this.mShowData[0].button[0];"work"===t.text?this.rightPopButton.setIconFrame("work"):"minecar"===t.text&&this.rightPopButton.setIconFrame("minecar")},CutInMenuPanel.prototype.onRightClickHandler=function(){var t=this.mShowData[0].button[0];"work"===t.text?this.emit("openmed","PicWork"):"minecar"===t.text&&this.emit("openmed","MineCar")},CutInMenuPanel.prototype.getActivityBounds=function(){var t,e=this.world.uiManager.getMediator("ActivityMediator");return e&&(t=e.getView().getBounds()),t},CutInMenuPanel}(o.BasePanel),h=function(t){function RightPopContainer(e,i,n,o){var r=t.call(this,e)||this;r.isPop=!1,r.isPlaying=!1,r.dpr=o,r.key=n,r.scaleWidth=i;var s=r.scene.make.image({key:r.key,frame:"minebag_bg"});r.bgSprite=r.scene.make.image({key:r.key,frame:"minebag_bg_brth"},!1),r.minecar=r.scene.make.image({key:r.key,frame:"minecar"}),r.minecar.setPosition(-12*o,.5*-r.minecar.height),r.teximg=r.scene.make.image({key:r.key,frame:"text_minebag"}),r.teximg.setPosition(r.minecar.x,2*o);var a=r.scene.make.image({key:r.key,frame:"arow"}),h=e.make.container(void 0,!1);return h.setSize(25*o,31*o),h.add(a),h.setPosition(.5*-s.width+10*o,0),r.add([r.bgSprite,s,r.minecar,r.teximg,h]),s.on("pointerup",r.onClickHandler,r),s.setInteractive(),h.on("pointerup",r.onTakeBack,r),h.setInteractive(),r.setSize(s.width,s.height),r.tween=r.scene.tweens.add({targets:r.bgSprite,alpha:{value:0,duration:500,ease:"Power1",yoyo:!0},repeat:-1}),r}return s(RightPopContainer,t),RightPopContainer.prototype.setClickHandler=function(t){this.clickHandler=t},RightPopContainer.prototype.setIconFrame=function(t){this.minecar.setFrame(t)},RightPopContainer.prototype.setPopData=function(t){this.popData=t},RightPopContainer.prototype.play=function(){this.bgSprite.alpha=1,this.tween.resume(),this.isPop=!1},RightPopContainer.prototype.stop=function(){this.tween.pause(),this.bgSprite.alpha=0,this.isPop=!0},RightPopContainer.prototype.onClickHandler=function(){this.clickHandler&&this.clickHandler.runWith(this.popData)},RightPopContainer.prototype.onTakeBack=function(){this.isPlaying||this.isPop?!this.isPlaying&&this.isPop&&this.takeback():this.popAnim()},RightPopContainer.prototype.popAnim=function(){this.isPlaying=!0;var t=this.scaleWidth-15*this.dpr,e=this;this.scene.tweens.add({targets:e,x:{value:t,duration:300,ease:"Bounce.easeOut"},onComplete:function(){e.stop(),e.isPlaying=!1}})},RightPopContainer.prototype.takeback=function(){this.timeID&&(clearTimeout(this.timeID),this.timeID=void 0),this.isPlaying=!0;var t=this.scaleWidth+.5*this.width-15*this.dpr,e=this;this.scene.tweens.add({targets:e,x:{value:t,duration:300,ease:"Bounce.easeOut"},onComplete:function(){e.play(),e.isPlaying=!1}})},RightPopContainer}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"DebugLogger",(function(){return d}));var n,o=i(112),r=i(111),s=i(0),a=i(167),h=i(124),c=i(125),l=i(113),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function DebugLogger(e,i){var n=t.call(this,e,i)||this;return n.mDelay=0,n.setTween(!1),n}return p(DebugLogger,t),DebugLogger.prototype.addListen=function(){this.mClsBtn.on("pointerup",this.closeHandler,this)},DebugLogger.prototype.removeListen=function(){this.mWorld.game.device.os.desktop||this.mClsBtn.off("pointerup",this.closeHandler,this)},DebugLogger.prototype.show=function(t){this.mInitialized?(this.mShow=!0,this.resize()):this.preload()},DebugLogger.prototype.resize=function(t,e){this.mWorld.getSize();this.showDescTxT(),this.update(0)},DebugLogger.prototype.update=function(t){var e=this.mWorld.roomManager.currentRoom.now();this.mDelay-e<3e3&&(this.showDescTxT(),this.mTimeTF.setText("FPS:"+t),this.mDescTF.setText(this.mDescTxt),this.mDelay=e)},DebugLogger.prototype.preload=function(){this.mScene&&(this.mScene.load.atlas("clsBtn",r.i.getRes("ui/common/common_clsBtn.png"),r.i.getRes("ui/common/common_clsBtn.json")),t.prototype.preload.call(this))},DebugLogger.prototype.init=function(){this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this);var e=this.mWorld.getSize();this.mBgWidth=400,this.mBgHeight=e.height>>1;var i=this.scene.cameras.main.width/2,n=this.scene.cameras.main.height;this.mBackground=this.scene.make.graphics(void 0,!1),this.mBackground.fillStyle(0,.6),this.mBackground.fillRect(0,0,i,n),this.setSize(i,n),this.add(this.mBackground),this.mTimeTF=this.mScene.make.text({style:{x:0,y:0,fontFamily:l.a.DEFULT_FONT,fontSize:14*this.dpr,origin:{x:0,y:0},wordWrap:{width:e.width-10,height:20,useAdvancedWrap:!0}}},!1),this.mDescTF=this.mScene.make.text({style:{x:0,y:20*this.dpr,fontFamily:l.a.DEFULT_FONT,fontSize:14*this.dpr,origin:{x:0,y:0},wordWrap:{width:this.width-10*this.dpr,height:this.height-30,useAdvancedWrap:!0}}},!1),this.add(this.mTimeTF),this.add(this.mDescTF),this.mWorld.game.device.os.desktop||(this.mClsBtn=new h.IconBtn(this.mScene,this.mWorld,{key:c.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/common/common_clsBtn.png",jsonUrl:"ui/common/common_clsBtn.json"}),this.mClsBtn.x=this.width,this.mClsBtn.y=10*this.dpr,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn)),t.prototype.init.call(this),this.addListen()},DebugLogger.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(a.DebugLoggerMediator.NAME).resize()},DebugLogger.prototype.showDescTxT=function(){this.mWorld.getSize().width,this.mWorld.getSize().height;var t="WEBGL";this.mWorld.game.config.renderType===Phaser.CANVAS?t="CANVAS":this.mWorld.game.config.renderType===Phaser.HEADLESS&&(t="HEADLESS");var e=this.mWorld.getConfig();this.mDescTxt="\n            rendertype: "+t+"\n            size: "+e.width+" "+e.height+"\n            device size: "+this.mWorld.getSize().width.toFixed(2)+" "+this.mWorld.getSize().height.toFixed(2)+"\n            scene scale: "+this.mWorld.scaleRatio+"\n            devicePixel: "+this.mWorld.uiRatio+"\n            ui scale: "+this.mWorld.uiScale.toFixed(4)},DebugLogger.prototype.closeHandler=function(){this.mWorld.uiManager.getMediator(a.DebugLoggerMediator.NAME).hide()},DebugLogger.prototype.showErrTxt=function(){var t=s.a.getInstance().getErrorList();if(t){var e="";t.forEach((function(t){e+="\n"+t})),this.mDescTxt+=e}},DebugLogger}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Dialog",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Dialog(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Dialog,t),Dialog.prototype.register=function(){this.connection&&this.connection.addPacketListener(this)},Dialog.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Dialog.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Dialog.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Dialog.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Dialog.prototype.queryNextDialog=function(t,e,i){var n=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),s=n.content;s.uiId=t,s.componentId=e,s.data=i,this.connection.send(n)},Object.defineProperty(Dialog.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Dialog}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"DialogPanel",(function(){return d}));var n,o=i(112),r=i(116),s=i(113),a=i(120),h=i(2),c=i(111),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function DialogPanel(e,i){var n=t.call(this,e,i)||this;return n.key="commonkey",n.listItems=[],n}return p(DialogPanel,t),DialogPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight,r=177*this.dpr;t.prototype.resize.call(this,n,o),this.content.setPosition(.5*n,o-r/2),this.setSize(n,o),this.blackBg.clear(),this.blackBg.fillStyle(0,.5),this.blackBg.fillRect(0,0,n,o),this.blackBg.setInteractive(new Phaser.Geom.Rectangle(0,0,n,o),Phaser.Geom.Rectangle.Contains);var s=n/this.scene.textures.getFrame(this.key,"menu_bg_l").width*this.dpr;this.bg.scaleX=1.5*s,this.bg.x=0,this.bg.setInteractive(),this.bg.texture.setFilter(Phaser.Textures.FilterMode.LINEAR)},DialogPanel.prototype.preload=function(){this.addAtlas(this.key,"common/ui_base.png","common/ui_base.json"),t.prototype.preload.call(this)},DialogPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen(),this.setDialogData(this.mShowData[0])):this.preload())},DialogPanel.prototype.init=function(){var e=this.scaleWidth,i=this.scaleHeight,n=177*this.dpr;this.blackBg=this.scene.make.graphics(void 0,!1),this.add(this.blackBg),this.content=this.scene.make.container({x:0*this.dpr,y:(i-n)/2,width:e,height:n},!1),this.content.setSize(e,n),this.bg=this.scene.make.image({x:0,y:0,key:this.key,frame:"menu_bg_l"}),this.bg.scaleY=this.scale,this.bg.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.bg.displayWidth=e,this.bg.displayHeight=n;var o=this.scene.make.graphics(void 0,!1),a=e-30*this.dpr,h=122*this.dpr;o.setPosition(-a>>1,.5*-h+13*this.dpr),o.clear(),o.fillStyle(16777215,1),o.fillRoundedRect(0,0,a,h,8*this.dpr),this.text=this.scene.make.text({x:.5*-a+20*this.dpr,y:.5*-h+30*this.dpr,text:"",style:{color:"#000000",fontSize:15*this.dpr,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0).setWordWrapWidth(a-35*this.dpr,!0);var c=.5*-e+38*this.dpr,p=.5*-n+25*this.dpr;this.npcIcon=new r.DynamicImage(this.scene,c,p-20*this.dpr);var d=this.scene.make.image({x:c+135*this.dpr,y:p,key:this.key,frame:"name_bg"});this.npcName=this.scene.make.text({x:d.x,y:d.y,text:"",style:{fontSize:15*this.dpr,fontFamily:s.a.DEFULT_FONT}}).setOrigin(.5);var m=new l.Button(this.scene,this.key,"close_1","close_1");m.setPosition(.5*e-30*this.dpr,.5*-n+10*this.dpr),m.on(l.ClickEvent.Tap,this.onCloseHandler,this),m.visible=!1,this.content.add([this.bg,this.npcIcon,o,this.text,d,this.npcName,m]),this.bg.setInteractive(),this.bg.on("pointerdown",this.onNextDialogHandler,this),this.add(this.content),this.resize(0,0),t.prototype.init.call(this)},DialogPanel.prototype.setLayoutItems=function(t){var e=t.length,i=e>4?2:1,n=(this.dpr,295*this.dpr),o=27*this.dpr,r=n/i,s=4*this.dpr;2===e?s=15*this.dpr:3===e&&(s=10*this.dpr);for(var h=(124*this.dpr-(s+o)*(e<4?e:4)-s)/2-42*this.dpr,c=0,l=this.listItems;c<l.length;c++){(d=l[c]).visible=!1}for(var p=0;p<e;p++){var d=void 0;p<this.listItems.length?d=this.listItems[p]:(d=new m(this.scene,this.dpr,this.scale,this.key),this.content.add(d),this.listItems.push(d),d.setHandler(new a.a(this,this.onItemHandler)));var u=.5*(n-r)*(p<4?-1:1),f=h+.5*o+(o+s)*(p%4);d.setItemSize(r,o),d.setPosition(u,f),d.setItemData(t[p]),d.visible=!0}},DialogPanel.prototype.setDialogData=function(t){var e=this;if(t.text&&t.text[1]&&(this.npcName.text=t.text[1].text),t.display&&t.display[0]){this.npcIcon.visible=!0;var i=t.display[0],n=c.i.getOsdRes(i.texturePath);this.npcIcon.load(n,this,(function(){var t=e.content.width,n=e.content.height,o=e.npcIcon.width,r=(e.npcIcon.height,e.npcIcon.x),s=.5*-n-50*e.dpr;i.horizontal===h.op_def.HorizontalAlignment.HORIZONTAL_LEFT?r=.5*-t+.5*o:i.horizontal===h.op_def.HorizontalAlignment.HORIZONTAL_CENTER?r=0:i.horizontal===h.op_def.HorizontalAlignment.HORIZONTAL_RIGHT&&(r=.5*t-.5*o-20*e.dpr),e.npcIcon.displayWidth=212*e.dpr,e.npcIcon.scaleY=e.npcIcon.scaleX,e.npcIcon.x=r,e.npcIcon.y=s}))}else this.npcIcon.visible=!1;if(t.button&&t.button.length>0)this.setLayoutItems(t.button),this.text.visible=!1;else{for(var o=0,r=this.listItems;o<r.length;o++){r[o].visible=!1}this.text.text=t.text[0].text,this.text.visible=!0}},DialogPanel.prototype.update=function(t){this.mShowData=t,this.setDialogData(t[0])},DialogPanel.prototype.onItemHandler=function(t){for(var e=0,i=this.listItems;e<i.length;e++){i[e].select=!1}t.select=!0;var n=this.showData[0];this.emit("querydialog",n.id,t.itemData.node.id)},DialogPanel.prototype.onNextDialogHandler=function(){var t=this.showData[0];this.emit("querydialog",t.id,0)},DialogPanel.prototype.onCloseHandler=function(){this.emit("hide")},DialogPanel}(o.BasePanel),m=function(t){function NpcDialogueItem(e,i,n,o){var r=t.call(this,e)||this;return r.dpr=0,r.zoom=0,r.zoom=n,r.dpr=i,r.selectBg=r.scene.make.image({x:0,y:0,key:o,frame:"select_bg"}),r.arrImg=r.scene.make.image({x:.5*-r.selectBg.width,y:0,key:o,frame:"arrow_r"}),r.content=r.scene.make.text({x:0,y:0,text:"",style:{color:"#000000",fontSize:15*i,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,.5),r.add([r.selectBg,r.arrImg,r.content]),r.width=r.selectBg.width,r.height=r.selectBg.height,r.on("pointerdown",r.onClickHandler,r),r}return p(NpcDialogueItem,t),NpcDialogueItem.prototype.setItemData=function(t){this.itemData=t,this.content.text=t.text,this.select=!1},NpcDialogueItem.prototype.setHandler=function(t){this.handler=t},Object.defineProperty(NpcDialogueItem.prototype,"select",{set:function(t){this.selectBg.visible=t},enumerable:!1,configurable:!0}),NpcDialogueItem.prototype.setItemSize=function(e,i){t.prototype.setSize.call(this,e,i),this.selectBg.displayWidth=e,this.arrImg.x=.5*-e*.9,this.content.x=this.arrImg.x+20*this.dpr*this.zoom,this.setInteractive(new Phaser.Geom.Rectangle(0,0,e,i),Phaser.Geom.Rectangle.Contains)},NpcDialogueItem.prototype.onClickHandler=function(){this.handler&&this.handler.runWith(this)},NpcDialogueItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"FriendInvitePanel",(function(){return l}));var n,o=i(112),r=i(115),s=i(114),a=i(113),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function FriendInvitePanel(e,i){return t.call(this,e,i)||this}return c(FriendInvitePanel,t),FriendInvitePanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&this.showInvite()},FriendInvitePanel.prototype.addListen=function(){t.prototype.addListen.call(this),this.refused.on(String(h.ClickEvent.Tap),this.onRefusedHandler,this),this.agree.on(String(h.ClickEvent.Tap),this.onAgreeHandler,this)},FriendInvitePanel.prototype.removeListen=function(){t.prototype.removeListen.call(this),this.refused.off(String(h.ClickEvent.Tap),this.onRefusedHandler,this),this.agree.off(String(h.ClickEvent.Tap),this.onAgreeHandler,this)},FriendInvitePanel.prototype.destroy=function(){this.tween&&this.tween.stop(),t.prototype.destroy.call(this)},FriendInvitePanel.prototype.preload=function(){this.addAtlas(r.UIAtlasKey.commonKey,r.UIAtlasName.commonUrl+".png",r.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},FriendInvitePanel.prototype.init=function(){this.setSize(168*this.dpr,59*this.dpr);var e=5*this.dpr;this.bg=this.scene.make.graphics(void 0,!1),this.bg.fillStyle(0,.6),this.bg.fillRoundedRect(0,0,this.width,this.height,{tl:0,tr:e,br:e,bl:0}),this.text=new h.BBCodeText(this.scene,.5*this.width,7*this.dpr,"",{}).setOrigin(.5,0).setFontSize(10*this.dpr).setFontFamily(a.a.DEFULT_FONT);var i=55*this.dpr,n=24*this.dpr,o={left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr};this.refused=new h.NineSliceButton(this.scene,.5*i+17.67*this.dpr,.5*n+31*this.dpr,i,n,r.UIAtlasKey.commonKey,"red_btn_normal",s.a.t("friend_invite.refused"),this.dpr,this.scale,o),this.agree=new h.NineSliceButton(this.scene,this.width-.5*i-24.33*this.dpr,.5*n+31*this.dpr,i,n,r.UIAtlasKey.commonKey,"button_g",s.a.t("friend_invite.agree"),this.dpr,this.scale,o),this.add([this.bg,this.text,this.refused,this.agree]),t.prototype.init.call(this),this.y=374*this.dpr},FriendInvitePanel.prototype.showInvite=function(){var t=this;if(this.tween&&this.tween.stop(),this.interval&&clearInterval(this.interval),this.showData&&!(this.showData.length<0)){var e=this.showData[0],i=e.button;i.length<2||(this.x=-this.width,this.text.text="[color=#FFFF00]"+e.text[0].text+"[/color]",this.agree.setText(i[1].text),this.agree.setData("data",i[1]),this.refused.setText(i[0].text),this.refused.setData("data",i[0]),this.countdown=10,this.setAgressText(),this.tween=this.scene.tweens.add({targets:this,props:{x:0},duration:200,onComplete:function(){t.interval=setInterval((function(){--t.countdown<0?t.close():t.setAgressText()}),1e3)}}))}},FriendInvitePanel.prototype.onAgreeHandler=function(){if(this.mShowData&&!(this.mShowData.length<1)){var t=this.agree.getData("data");t&&t.node&&(this.emit("targetUI",this.mShowData[0].id,t.node.id),this.close())}},FriendInvitePanel.prototype.onRefusedHandler=function(){this.close()},FriendInvitePanel.prototype.close=function(){var t=this;this.interval&&clearInterval(this.interval),this.tween&&this.tween.stop(),this.tween=this.scene.tweens.add({targets:this,props:{x:-this.width},duration:200,onComplete:function(){var e=t.refused.getData("data");e&&e.node&&t.emit("targetUI",t.mShowData[0].id,e.node.id)}})},FriendInvitePanel.prototype.setAgressText=function(){if(this.agree){var t=this.agree.getData("data");t&&this.agree.setText(t.text+"("+this.countdown+")")}},FriendInvitePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"FurniBag",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function FurniBag(e,i){var n=t.call(this)||this;return n.world=e,n.mSceneType=i,n.mEvent=new Phaser.Events.EventEmitter,n}return s(FurniBag,t),FurniBag.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_GET_PACKAGE_CATEGORIES,this.onPackageCategoriesHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE,this.onQueryMarketPackage),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE_ITEM_RESOURCE,this.onQueryCommodityResultHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_QUERY_EDIT_PACKAGE,this.onQueryEditPackage),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_RESET_AVATAR,this.onQueryResetAvatar),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_CURRENT_DRESS_AVATAR_ITEM_ID,this.onRetDressAvatarItemIDS))},FurniBag.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},FurniBag.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},FurniBag.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},FurniBag.prototype.getCategories=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_PACKAGE_CATEGORIES);e.content.category=t,this.connection.send(e),this.categoryType=t},FurniBag.prototype.queryPackage=function(t,e){this.mSceneType===r.op_def.SceneTypeEnum.NORMAL_SCENE_TYPE?this.queryMarketPackage(t,e):this.queryEditPackage(t,e)},FurniBag.prototype.queryCommodityResource=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_QUERY_PACKAGE_ITEM_RESOURCE);e.content.id=t,this.connection.send(e)},FurniBag.prototype.addFurniToScene=function(t){if(this.mSceneType===r.op_def.SceneTypeEnum.EDIT_SCENE_TYPE){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_SELECTED_SPRITE);e.content.id=t,this.connection.send(e)}},FurniBag.prototype.enterEditAndSelectedSprite=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENABLE_AND_SELECTED_SPRITE);e.content.id=t,this.connection.send(e)},FurniBag.prototype.seachPackage=function(t,e){this.queryPackage(e,t)},FurniBag.prototype.sellProps=function(t,e,i){var n=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_SELL_PACKAGE_ITEM),s=n.content;s.category=i;var a=r.op_client.CountablePackageItem.create(t);a.count=e,s.items=[a],s.totalPrice=a.sellingPrice,s.totalPrice.price*=e,this.connection.send(n)},FurniBag.prototype.useProps=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_USE_ITEM),n=i.content;n.itemId=t,n.count=e,this.connection.send(i)},FurniBag.prototype.querySaveAvatar=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_DRESS_UP_AVATAR);e.content.avatarItemIds=t,this.connection.send(e)},FurniBag.prototype.queryResetAvatar=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_RESET_AVATAR);this.connection.send(e)},FurniBag.prototype.queryDressAvatarItemIDs=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_CURRENT_DRESS_AVATAR_ITEM_ID);this.connection.send(t)},FurniBag.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},FurniBag.prototype.onPackageCategoriesHandler=function(t){var e=t.content;e.category===this.categoryType&&this.mEvent.emit("packageCategory",e.subcategory)},FurniBag.prototype.onQueryMarketPackage=function(t){var e=t.content;e.category===this.categoryType&&this.mEvent.emit("queryPackage",e)},FurniBag.prototype.onQueryEditPackage=function(t){var e=t.content;e.category===this.categoryType&&this.mEvent.emit("queryPackage",e)},FurniBag.prototype.onQueryCommodityResultHandler=function(t){this.mEvent.emit("queryCommodityResource",t.content)},FurniBag.prototype.onQueryResetAvatar=function(t){var e=t.content;this.mEvent.emit("queryResetAvatar",e)},FurniBag.prototype.queryMarketPackage=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_QUERY_PACKAGE),n=i.content;n.category=this.categoryType,n.page=1,n.perPage=1e6,n.subcategory=t,n.queryString=e,this.connection.send(i)},FurniBag.prototype.queryEditPackage=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_QUERY_EDIT_PACKAGE),n=i.content;n.category=this.categoryType,n.page=1,n.perPage=1e6,n.subcategory=t,n.queryString=e,this.connection.send(i)},FurniBag.prototype.onRetDressAvatarItemIDS=function(t){var e=t.content;this.mEvent.emit("avatarIDs",e.avatarItemIds)},Object.defineProperty(FurniBag.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),FurniBag}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"FurniBagPanel",(function(){return _}));var n,o=i(112),r=i(114),s=i(130),a=i(113),h=i(2),c=i(116),l=i(150),p=i(111),d=i(165),m=i(127),u=i(120),f=i(0),y=i(109),g=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),_=function(t){function FurniBagPanel(e,i,n){var o=t.call(this,e,i)||this;return o.key="furni_bag",o.commonkey="common_key",o.seachKey="key.seach",o.topBtns=[],o.mEnableEdit=!1,o.mInputBoo=!1,o.mSelectedItemData=[],o.mSelectedItems=[],o.mSceneType=n,o.setInteractive(),o}return g(FurniBagPanel,t),FurniBagPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,n,o),this.mBackground.clear(),this.mBackground.fillGradientStyle(7304703,7304703,314367,314367),this.mBackground.fillRect(0,0,n,o),this.mShelfContainer.setSize(n,295*this.dpr),this.mShelfContainer.y=o-this.mShelfContainer.height,this.mDetailBubble.y=this.mShelfContainer.y-10*this.dpr-this.mDetailBubble.height,this.mCategoriesBar.clear(),this.mCategoriesBar.fillStyle(3394815),this.mCategoriesBar.fillRect(0,0,n,40*this.dpr),this.mCategoriesBar.fillStyle(52428),this.mCategoriesBar.fillRect(0,40*this.dpr,n,3*this.dpr),this.mBg.x=n/2,this.mBg.y=this.mBg.height/2+10*this.dpr,this.mAdd.x=n-this.mAdd.width/2-10*this.dpr,this.mAdd.y=this.mShelfContainer.y-this.mAdd.height/2-9*this.dpr,this.useBtn.x=this.mAdd.x,this.useBtn.y=this.mAdd.y,this.sellBtn.x=Math.floor(this.mAdd.x-this.sellBtn.width-10*this.dpr),this.sellBtn.y=this.mAdd.y,this.resetBtn.x=this.mAdd.x+25*this.dpr,this.resetBtn.y=this.mAdd.y,this.saveBtn.x=this.resetBtn.x-(this.saveBtn.width+this.resetBtn.width)/2-10*this.dpr,this.saveBtn.y=this.resetBtn.y,this.mDetailDisplay.x=n/2,this.mDetailDisplay.y=this.mBg.y,this.mPropGrid.x=n/2,this.mPropGrid.y=this.mShelfContainer.y+.5*this.mPropGrid.height+50*this.dpr,this.mPropGrid.layout(),this.mPropGrid.resetMask(),this.mCategoryScroll.refreshMask(),this.setSize(n,o)},FurniBagPanel.prototype.setCategories=function(t){this.mPreCategoryBtn=null,this.mSelectedCategeories=null;var e=60*this.dpr,i=41*this.dpr,n=[];this.mSeachInput.parentContainer&&this.closeSeach(null),this.mCategoryScroll.clearItems();var o=new y.Button(this.scene,this.key,"seach_normal","seach_down");o.setData("item",{key:this.seachKey,value:r.a.t("common.search")}),o.y=i-40*this.dpr,this.mCategoryScroll.addItem(o);var s=new h.op_def.StrPair;s.value=r.a.t("common.all"),s.key="alltype",t.unshift(s);for(var a=0;a<t.length;a++){var c=new l.TextButton(this.scene,this.dpr,1,t[a].value,0,0);c.x=a*e,c.y=i-c.text.height-20*this.dpr,c.setData("item",t[a]),c.setSize(e,i),this.mCategoryScroll.addItem(c),n[a]=c,c.setFontSize(17*this.dpr),c.setFontStyle("bold")}n.length>1&&this.onSelectSubCategoryHandler(n[0]),this.updateCategeoriesLoc(!1)},FurniBagPanel.prototype.setProp=function(t,e){void 0===e&&(e=!1),t=t||[],this.mSelectedItems.length=0,e||(this.mSelectedItemData.length=0);var i=t.length;if(i<24&&(t=t.concat(new Array(24-i))),e||this.mPropGrid.setT(0),this.mPropGrid.setItems(t),this.categoryType!==h.op_pkt_def.PKT_PackageType.AvatarPackage){if(0===this.mSelectedItems.length){this.mPropGrid.setT(0),this.mSelectedItemData.length=0;var n=this.mPropGrid.getCell(0);this.onSelectItemHandler(n.container)}}else{this.mSelectedItemData.length=0;for(var o=0,r=t;o<r.length;o++){var s=r[o];s&&s.rightSubscript===h.op_pkt_def.PKT_Subscript.PKT_SUBSCRIPT_CHECKMARK&&this.mSelectedItemData.push(s)}0===this.mSelectedItemData.length?this.displayAvatar():this.updateAvatarItems()}},FurniBagPanel.prototype.setDressAvatarIds=function(t){this.dressAvatarIDS=t,this.updateAvatarItems()},FurniBagPanel.prototype.displayAvatar=function(t){t||((t=new h.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE_ITEM_RESOURCE).avatar=new h.op_gameconfig.Avatar);var e=this.mWorld.roomManager.currentRoom.playerManager.actor.model.avatar;for(var i in e){if(e.hasOwnProperty(i))(s=e[i])&&(t.avatar[i]=s)}for(var n=0,o=this.mSelectedItemData;n<o.length;n++){var r=o[n].avatar;for(var i in r){var s;if(r.hasOwnProperty(i))(s=r[i])&&(t.avatar[i]=s)}}var a=new Phaser.Geom.Point(0,50*this.dpr);this.mDetailDisplay.loadAvatar(t,2*this.dpr,a)},FurniBagPanel.prototype.setSelectedResource=function(t){t.display?this.mDetailDisplay.loadDisplay(t):t.avatar&&this.displayAvatar()},FurniBagPanel.prototype.resetAvatar=function(t){var e=new h.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_COMMODITY_RESOURCE;e.avatar=t.avatar;var i=new Phaser.Geom.Point(0,50*this.dpr);this.mDetailDisplay.loadAvatar(e,2*this.dpr,i),this.mSelectedItemData.length=0},FurniBagPanel.prototype.addListen=function(){this.mInitialized&&(this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.mSeachInput.on("seach",this.onSeachHandler,this),this.mAdd.on("pointerup",this.onAddFurniToSceneHandler,this),this.sellBtn.on("pointerup",this.onSellBtnHandler,this),this.useBtn.on("pointerup",this.onUseBtnHandler,this),this.saveBtn.on("pointerup",this.onSaveBtnHandler,this),this.resetBtn.on("pointerup",this.onResetBtnHandler,this))},FurniBagPanel.prototype.removeListen=function(){this.mInitialized&&(this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.mSeachInput.off("seach",this.onSeachHandler,this),this.mAdd.off("pointerup",this.onAddFurniToSceneHandler,this),this.sellBtn.off("pointerup",this.onSellBtnHandler,this),this.useBtn.off("pointerup",this.onUseBtnHandler,this),this.saveBtn.on("pointerup",this.onSaveBtnHandler,this),this.resetBtn.on("pointerup",this.onResetBtnHandler,this))},FurniBagPanel.prototype.destroy=function(){this.mCategoryScroll&&this.mCategoryScroll.destroy(),this.mPropGrid&&this.mPropGrid.destroy(),t.prototype.destroy.call(this)},FurniBagPanel.prototype.queryRefreshPackage=function(t){void 0===t&&(t=!1),this.queryPackege(t)},FurniBagPanel.prototype.preload=function(){this.addAtlas(this.key,"furni_bag/furni_bag.png","furni_bag/furni_bag.json"),this.addAtlas(this.commonkey,"common/ui_base.png","common/ui_base.json"),t.prototype.preload.call(this)},FurniBagPanel.prototype.init=function(){var e=this,i=this.scaleWidth,n=this.scaleHeight;this.mBackground=this.scene.make.graphics(void 0,!1),this.mBg=this.scene.make.image({key:this.key,frame:"bg"},!1),this.mShelfContainer=this.scene.make.container(void 0,!1),this.mShelfContainer.setSize(i,295*this.dpr),this.mShelfContainer.y=n-this.mShelfContainer.height,this.mCategoriesBar=this.scene.make.graphics(void 0,!1),this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.mCloseBtn=this.scene.make.image({key:this.key,frame:"back_arrow",x:21*this.dpr,y:30*this.dpr}),this.mCloseBtn.setInteractive(new Phaser.Geom.Rectangle(-28*this.dpr,-20*this.dpr,56*this.dpr,40*this.dpr),Phaser.Geom.Rectangle.Contains);var o=90*this.dpr,c=38*this.dpr,l=i-o/2-20*this.dpr,p=this.mShelfContainer.y-25*this.dpr;this.mAdd=this.createNineButton(l+100*this.dpr,p,o,c,this.commonkey,"yellow_btn",r.a.t("furni_bag.add"),"#996600"),this.sellBtn=this.createNineButton(l,p,o,c,this.commonkey,"red_btn",r.a.t("common.sold"),"#FFFFFF"),this.useBtn=this.createNineButton(l+100*this.dpr,p,o,c,this.commonkey,"yellow_btn",r.a.t("common.use"),"#996600"),this.saveBtn=this.createNineButton(l+100*this.dpr,p,o,c,this.commonkey,"yellow_btn",r.a.t("common.save"),"#996600"),this.resetBtn=this.createNineButton(l+100*this.dpr,p-c-5*this.dpr,38*this.dpr,38*this.dpr,this.commonkey,"red_btn");var d=this.scene.make.image({key:this.key,frame:"restore"});this.resetBtn.add(d),this.mDetailDisplay=new s.DetailDisplay(this.scene,!0),this.mDetailDisplay.setSize(110*this.dpr,110*this.dpr),this.mDetailDisplay.setComplHandler(new u.a(this,(function(){e.mDetailDisplay.visible=!0}))),this.mDetailDisplay.setTexture(this.key,"ghost"),this.mDetailDisplay.setNearest(),this.mDetailDisplay.y=this.mBg.y+this.mBg.height/2,this.mDetailBubble=new v(this.scene,this.key,this.dpr),this.mDetailBubble.x=10*this.dpr,this.mSeachInput=new P(this.scene,this.mWorld,this.key,this.dpr);this.mInputBoo&&this.dpr;this.mCategoryScroll=new y.GameScroller(this.scene,{x:.5*i,y:this.mShelfContainer.y+20*this.dpr,width:i,height:41*this.dpr,zoom:this.scale,orientation:1,dpr:this.dpr,cellupCallBack:function(t){e.onSelectSubCategoryHandler(t)}}),this.add([this.mBackground,this.mBg,this.mCloseBtn,this.mDetailDisplay,this.mDetailBubble,this.mShelfContainer,this.mCategoryScroll]),this.add([this.sellBtn,this.useBtn,this.mAdd,this.saveBtn,this.resetBtn]),this.mShelfContainer.add(this.mCategoriesBar),this.mWorld&&this.mWorld.roomManager&&this.mWorld.roomManager.currentRoom&&(this.mEnableEdit=this.mWorld.roomManager.currentRoom.enableEdit);var f=67*this.dpr,g=30*this.dpr,_=30*this.dpr,S={fontFamily:a.a.BOLD_FONT,fontSize:20*this.dpr,color:"#FFFFFF"};this.topCheckBox=new m.CheckboxGroup;var b=[h.op_pkt_def.PKT_PackageType.PropPackage,h.op_pkt_def.PKT_PackageType.FurniturePackage,h.op_pkt_def.PKT_PackageType.AvatarPackage],C=[r.a.t("furni_bag.Props"),r.a.t("furni_bag.furni"),r.a.t("furni_bag.decorate")];this.mSceneType===h.op_def.SceneTypeEnum.EDIT_SCENE_TYPE&&(b=[h.op_pkt_def.PKT_PackageType.EditFurniturePackage],C=[r.a.t("furni_bag.furni")]);var T=.5*i-.5*f*(b.length-1)-20*this.dpr;for(var I in b){var M=b[k=Number(I)],E=new y.TabButton(this.scene,this.key,"tab_normal","tab_down",C[k]);E.setTextStyle(S),E.setData("data",M),E.setSize(f,g),E.setFontStyle("bold"),E.y=_,E.x=T+f*k,this.topBtns.push(E)}if(this.topCheckBox.appendItemAll(this.topBtns),this.topCheckBox.on("selected",this.onTopCategoryHandler,this),this.topBtns.forEach((function(t){e.add(t)})),this.mEnableEdit){var k=b.indexOf(h.op_pkt_def.PKT_PackageType.EditFurniturePackage);this.topCheckBox.selectIndex(k)}else this.topCheckBox.selectIndex(0);var B=this.scene.textures.getFrame(this.key,"grid_choose"),O=B.width,D=B.height,R={x:0,y:0,table:{width:i,height:260*this.dpr,columns:4,cellWidth:O,cellHeight:D,reuseCellContainer:!0,zoom:this.scale,mask:!1},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;if(null===i&&(i=new w(n,0,0,e.key,e.dpr)),i.setData({item:o}),i.setProp(o),o&&e.isSelectedItemData(o))i.isSelect=!0,e.mSelectedItems.push(i);else{var r=e.mSelectedItems.indexOf(i);-1!==r&&e.mSelectedItems.splice(r,1)}return i}};this.mPropGrid=new y.GameGridTable(this.scene,R),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){t&&e.onSelectItemHandler(t)})),this.add(this.mPropGrid),this.resize(0,0),t.prototype.init.call(this)},FurniBagPanel.prototype.createNineButton=function(t,e,i,n,o,r,s,h){var c=new y.NineSliceButton(this.scene,t,e,i,n,o,r,s,this.dpr,1,{left:14*this.dpr,top:14*this.dpr,right:15*this.dpr,bottom:14*this.dpr});return s&&(c.setTextStyle({color:h,fontSize:16*this.dpr,fontFamily:a.a.DEFULT_FONT}),c.setFontStyle("bold")),c},FurniBagPanel.prototype.updateAvatarItems=function(){if(this.dressAvatarIDS&&this.mSelectedItemData.length>0){for(var t=[],e=0,i=this.dressAvatarIDS;e<i.length;e++)for(var n=i[e],o=0,r=this.mSelectedItemData;o<r.length;o++){var s=r[o];s.id===n&&t.push(s)}this.mSelectedItemData.length=0,this.mSelectedItemData=t,this.displayAvatar()}else this.mDetailBubble.setProp(null,this.serviceTimestamp),this.mDetailBubble.y=this.mShelfContainer.y-10*this.dpr-this.mDetailBubble.height},FurniBagPanel.prototype.replaceSelectItem=function(t,e){if(this.categoryType!==h.op_pkt_def.PKT_PackageType.AvatarPackage)this.mSelectedItems.length>0&&(this.mSelectedItems[0].isSelect=!1),this.mSelectedItemData.length=0,this.mSelectedItems.length=0,this.mSelectedItemData.push(t),this.mSelectedItems.push(e),e.isSelect=!0;else{var i=t.avatar;if(!i)return void f.a.getInstance().error("CountablePackageItem avatar does not exist",t);for(var n=[],o=0,r=this.mSelectedItemData;o<r.length;o++){var s=(l=r[o]).avatar;this.isContainProperty(s,i)&&n.push(l)}for(var a=0,c=n;a<c.length;a++){var l=c[a],p=this.mSelectedItemData.indexOf(l);this.mSelectedItemData.splice(p,1);for(var d=0;d<this.mSelectedItems.length;d++){var m=this.mSelectedItems[d];if(m.propData===l){m.isSelect=!1,this.mSelectedItems.splice(d,1);break}}}this.mSelectedItemData.push(t),this.mSelectedItems.push(e),e.isSelect=!0}},FurniBagPanel.prototype.isContainProperty=function(t,e){var i=!0;for(var n in t)if("headBackId"!==n&&"bodyDresId"!==n&&t.hasOwnProperty(n)&&!e.hasOwnProperty(n)){i=!1;break}return i},FurniBagPanel.prototype.isSelectedItemData=function(t){if(this.mSelectedItemData.length>0)for(var e=0,i=this.mSelectedItemData;e<i.length;e++){if(i[e].indexId===t.indexId)return!0}else if(t.rightSubscript===h.op_pkt_def.PKT_Subscript.PKT_SUBSCRIPT_CHECKMARK)return!0;return!1},FurniBagPanel.prototype.setSelectedItem=function(t){this.sellBtn.enable=t.recyclable,this.useBtn.enable=t.executable,this.mAdd.enable=this.mSceneType===h.op_def.SceneTypeEnum.EDIT_SCENE_TYPE||this.mEnableEdit,this.categoryType===h.op_pkt_def.PKT_PackageType.AvatarPackage&&(this.saveBtn.enable=!0,this.resetBtn.enable=!0),this.mDetailDisplay.loadSprite("loading_ui",p.i.getUIRes(this.dpr,"loading_ui"),p.i.getUIRes(this.dpr,"loading_ui"));var e=new h.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE_ITEM_RESOURCE;t.avatar?e.avatar=t.avatar:e.display=t.display,e.animations=t.animations,this.setSelectedResource(e)},FurniBagPanel.prototype.onSelectSubCategoryHandler=function(t){var e=t.getData("type");if(e)"seachBtn"===e?this.onSeachHandler(this.mSeachInput.seachText):"label"===e&&this.mSeachInput.showInputPanel();else{var i=t.getData("item");if(i){this.mPreCategoryBtn&&this.mPreCategoryBtn instanceof l.TextButton&&this.mPreCategoryBtn.changeNormal(),t instanceof l.TextButton&&t.changeDown();var n=i.key;if(n===this.seachKey)this.showSeach(t);else{if(this.mPreCategoryBtn)(n=this.mPreCategoryBtn.getData("item").key)===this.seachKey&&this.closeSeach(t);else this.closeSeach(t);this.mSelectedCategeories=i,this.queryPackege()}this.mPreCategoryBtn=t}this.mPropGrid.setT(0)}},FurniBagPanel.prototype.onCloseHandler=function(){this.emit("close")},FurniBagPanel.prototype.queryPackege=function(t){void 0===t&&(t=!1),this.mSelectedCategeories&&this.emit("queryPackage",this.categoryType,this.mSelectedCategeories.key,t)},FurniBagPanel.prototype.onSelectItemHandler=function(t){var e=t.getData("item");-1===this.mSelectedItemData.indexOf(e)&&(this.mDetailBubble.setProp(e,this.serviceTimestamp),this.mDetailBubble.y=this.mShelfContainer.y-10*this.dpr-this.mDetailBubble.height,e?(this.replaceSelectItem(e,t),this.setSelectedItem(e)):this.categoryType!==h.op_pkt_def.PKT_PackageType.AvatarPackage&&0===this.mSelectedItemData.length&&(this.sellBtn.enable=!1,this.useBtn.enable=!1,this.mAdd.enable=!1,this.saveBtn.enable=!1,this.resetBtn.enable=!1,this.mDetailDisplay.setTexture(this.key,"ghost"),this.mDetailDisplay.setNearest()))},FurniBagPanel.prototype.onSeachHandler=function(t){this.mSelectedCategeories&&t.length>0&&this.emit("seachPackage",t,this.mSelectedCategeories.key)},FurniBagPanel.prototype.onAddFurniToSceneHandler=function(){this.mSelectedItemData&&this.emit("addFurniToScene",this.mSelectedItemData[0].id)},FurniBagPanel.prototype.onTopCategoryHandler=function(t){var e=t.getData("data");this.scaleWidth;this.mSelectedItemData.length=0,e&&(this.onSelectedCategory(e),e===h.op_pkt_def.PKT_PackageType.FurniturePackage||e===h.op_pkt_def.PKT_PackageType.EditFurniturePackage?(this.sellBtn.visible=!0,this.mAdd.visible=!0,this.useBtn.visible=!1,this.saveBtn.visible=!1,this.resetBtn.visible=!1):e===h.op_pkt_def.PKT_PackageType.AvatarPackage?(this.sellBtn.visible=!1,this.saveBtn.visible=!0,this.resetBtn.visible=!0,this.useBtn.visible=!1,this.mAdd.visible=!1):(this.sellBtn.visible=!0,this.useBtn.visible=!0,this.mAdd.visible=!1,this.saveBtn.visible=!1,this.resetBtn.visible=!1)),this.layoutTopBtn(t)},FurniBagPanel.prototype.layoutTopBtn=function(t){for(var e=this.scaleWidth,i=0,n=0,o=this.topBtns;n<o.length;n++){i+=(c=o[n]).width+5*this.dpr}for(var r=.5*e-(i/=2),s=0,h=this.topBtns;s<h.length;s++){var c,l=0;(c=h[s])!==t?(c.setTextStyle({fontFamily:a.a.DEFULT_FONT,fontSize:12*this.dpr,color:"#2B4BB5"}),l=.5*c.height):(c.setTextStyle({fontFamily:a.a.DEFULT_FONT,fontSize:16*this.dpr,color:"#8B5603"}),l=.5*c.height+2*this.dpr);var p=.5*c.width;c.x=r+p,c.y=l,r+=2*p+12*this.dpr}},FurniBagPanel.prototype.onSelectedCategory=function(t){this.categoryType=t,t===h.op_pkt_def.PKT_PackageType.AvatarPackage&&this.emit("queryDressAvatarIDS"),this.emit("getCategories",t)},FurniBagPanel.prototype.onSellBtnHandler=function(){var t=this;if(this.mCategoryScroll.removeListen(),this.mSelectedItemData.length>0){var e=this.mSelectedItemData[0],i=r.a.t("common.sold"),n=new u.a(this,this.onSellPropsHandler,[this.categoryType]),o=new u.a(this,(function(){t.mCategoryScroll.addListen()}));this.showPropFun({confirmHandler:n,data:e,cancelHandler:o,title:i})}},FurniBagPanel.prototype.onUseBtnHandler=function(){var t=this;if(this.mCategoryScroll.removeListen(),this.mSelectedItemData.length>0){var e=this.mSelectedItemData[0],i=r.a.t("common.use"),n=new u.a(this,this.onUsePropsHandler),o=new u.a(this,(function(){t.mCategoryScroll.addListen()}));this.showPropFun({confirmHandler:n,data:e,cancelHandler:o,price:!1,title:i})}},FurniBagPanel.prototype.onSaveBtnHandler=function(){this.dressAvatarIDS.length=0;for(var t=[],e=0,i=this.mSelectedItemData;e<i.length;e++){var n=i[e];t.push(n.id),this.dressAvatarIDS.push(n.id)}this.emit("querySaveAvatar",t)},FurniBagPanel.prototype.onResetBtnHandler=function(){this.emit("queryResetAvatar")},FurniBagPanel.prototype.onSellPropsHandler=function(t,e,i){this.mCategoryScroll.addListen(),this.emit("sellProps",e,i,t)},FurniBagPanel.prototype.onUsePropsHandler=function(t,e){this.mCategoryScroll.addListen(),this.emit("useprops",t.id,e)},FurniBagPanel.prototype.showSeach=function(t){this.mCategoryScroll.addItemAt(this.mSeachInput,1),this.mCategoryScroll.setInteractiveObject(this.mSeachInput.seachBtn),this.mCategoryScroll.setInteractiveObject(this.mSeachInput.label),this.updateCategeoriesLoc(!0)},FurniBagPanel.prototype.closeSeach=function(t){this.mSeachInput.parentContainer&&this.mSeachInput.parentContainer.remove(this.mSeachInput),this.mCategoryScroll.removeInteractiveObject(this.mSeachInput.seachBtn),this.mCategoryScroll.removeInteractiveObject(this.mSeachInput.label),this.updateCategeoriesLoc(!1)},FurniBagPanel.prototype.updateCategeoriesLoc=function(t){for(var e=this.mCategoryScroll.getItemList(),i=(this.dpr,null),n=30*this.dpr,o=(this.mScene.cameras.main.width,n),r=0;r<e.length;r++){var s=e[r];r>0?(i=e[r-1],s.x=i.x+i.width):s.x=o,o+=s.width}this.mCategoryScroll.setAlign()},Object.defineProperty(FurniBagPanel.prototype,"enableEdit",{get:function(){return this.mEnableEdit},enumerable:!1,configurable:!0}),FurniBagPanel.prototype.showPropFun=function(t){this.mWorld.uiManager.showMed("PicPropFun",t)},Object.defineProperty(FurniBagPanel.prototype,"serviceTimestamp",{get:function(){return Math.floor(this.mWorld.clock.unixTime/1e3)},enumerable:!1,configurable:!0}),FurniBagPanel}(o.BasePanel),P=function(t){function SeachInput(e,i,n,o){var r=t.call(this,e)||this;return r.mText="",r.mWorldService=i,r.dpr=o,r.bg=e.make.image({key:n,frame:"seach_bg"},!1).setOrigin(.5,.5),r.mLabelInput=r.scene.make.text({x:0,width:r.bg.width,height:r.bg.height,style:{fontFamily:a.a.DEFULT_FONT,fontSize:14*o}},!1).setOrigin(0,.5),r.mLabelInput.setSize(r.bg.width,r.bg.height),r.mLabelInput.setInteractive(),r.mSeachBtn=e.make.image({key:n,frame:"seach_normal"},!1).setData("type","seachBtn"),r.mLabelInput.x=-r.bg.width/2+6*o*i.uiScale,r.mSeachBtn.x=r.bg.width/2-r.mSeachBtn.width,r.add([r.bg,r.mLabelInput,r.mSeachBtn]),r.disableInteractive(),r.setSize(r.bg.width,r.bg.height),r.setData("type","label"),r}return g(SeachInput,t),SeachInput.prototype.showInputPanel=function(){this.mInputText||(this.mInputText=new d.InputPanel(this.scene,this.mWorldService,this.mText),this.mInputText.once("close",this.sendChat,this))},SeachInput.prototype.sendChat=function(t){if(this.mText=t,this.mInputText.destroy(),this.mInputText=null,t.length>10)for(var e=this.bg.width-20*this.dpr,i=10;i<t.length;i++){var n=t.slice(0,i);if(this.mLabelInput.setText(n).width>e)break}else this.mLabelInput.setText(t);this.mLabelInput.setSize(this.bg.width,this.bg.height)},Object.defineProperty(SeachInput.prototype,"seachBtn",{get:function(){return this.mSeachBtn},enumerable:!1,configurable:!0}),Object.defineProperty(SeachInput.prototype,"label",{get:function(){return this.mLabelInput},enumerable:!1,configurable:!0}),Object.defineProperty(SeachInput.prototype,"seachText",{get:function(){return this.mText},enumerable:!1,configurable:!0}),SeachInput}(Phaser.GameObjects.Container),v=function(t){function DetailBubble(e,i,n,o){void 0===o&&(o=1);var r=t.call(this,e)||this;r.dpr=n,r.mDetailBubble=r.scene.make.graphics(void 0,!1);var s=100*n,h=96*n;return r.mDetailBubble=r.scene.make.graphics(void 0,!1),r.mDetailBubble.fillStyle(16777215,.1),r.mDetailBubble.fillRoundedRect(0,0,s,h),r.mNickName=r.scene.make.text({x:7*r.dpr,y:9*r.dpr,style:{fontSize:12*r.dpr,fontFamily:a.a.DEFULT_FONT,color:"#FFFF00",align:"center"}}),r.mPriceText=r.scene.make.text({x:7*r.dpr,y:28*r.dpr,style:{fontSize:10*r.dpr,fontFamily:a.a.DEFULT_FONT,color:"#DC143C",align:"center"}}),r.mSource=r.scene.make.text({x:8*n,y:47*n,style:{fontSize:10*n,fontFamily:a.a.DEFULT_FONT}},!1),r.mDesText=r.scene.make.text({x:8*n,y:66*n,style:{color:"#32347b",fontSize:10*n,fontFamily:a.a.DEFULT_FONT,wordWrap:{width:90*n,useAdvancedWrap:!0}}},!1),r.mExpires=new y.BBCodeText(e,8*n,85*n,"",{fontSize:10*r.dpr,fontFamily:a.a.DEFULT_FONT}),r.add([r.mDetailBubble,r.mNickName,r.mDesText,r.mSource,r.mPriceText,r.mExpires]),r.setSize(s,h),r}return g(DetailBubble,t),DetailBubble.prototype.setProp=function(t,e){var i=this;if(t){this.mNickName.setText(t.shortName||t.name);var n=9*this.dpr,o=21*this.dpr;t.recyclable?(n+=o,this.mPriceText.y=n,t.sellingPrice&&this.mPriceText.setText(r.a.t("furni_bag.sale_price")+"："+p.f.getName(t.sellingPrice.coinType)+" x "+t.sellingPrice.price)):(n+=o,this.mPriceText.y=n,this.mPriceText.setText(r.a.t("furni_bag.not_sale"))),t.source?(this.mSource.setText(r.a.t("furni_bag.source")+"： "+t.source),n+=o,this.mSource.y=n):this.mSource.setText("");var s=15*this.dpr,a=this.getMaxWidth(s);if(t.des?(n+=o,this.mDesText.setWordWrapWidth(a-s,!0),this.mDesText.setText(t.des),this.mDesText.y=n):this.mDesText.setText(""),t.expiredTime>0){n+=o,this.mExpires.y=n;var h=t.expiredTime-e,timeout_1=function(){i.mExpires.visible=!0,i.mExpires.text=i.getDataFormat(1e3*h),h>0&&(i.timeID=setTimeout((function(){h-=1,timeout_1()}),1e3))};timeout_1()}else this.mExpires.visible=!1;this.resize(a)}else this.mNickName.setText(r.a.t("furni_bag.empty_backpack")),this.mPriceText.text="",this.mSource.text="",this.mDesText.text="",this.resize();return this},DetailBubble.prototype.resize=function(t,e){void 0===t&&(t=this.width);var i=this.mDesText.height+80*this.dpr;t===this.width&&i===this.height||(this.mDetailBubble.clear(),this.mDetailBubble.fillStyle(16777215,.1),this.mDetailBubble.fillRoundedRect(0,0,t,i),this.setSize(t,i))},DetailBubble.prototype.getMaxWidth=function(t){void 0===t&&(t=0);var e=100*this.dpr,i=0;return i<this.mNickName.width&&(i=this.mNickName.width),i<this.mPriceText.width&&(i=this.mPriceText.width),i<this.mSource.width&&(i=this.mSource.width),e-i<t&&(i+=t+(i-e>=0?0:i-e)),i<e&&(i=e),i},DetailBubble.prototype.getDataFormat=function(t){var e=Math.floor(t/864e5),i=Math.floor(t/36e5)%24,n=Math.floor(t/6e4)%60,o=Math.floor(t/1e3)%60,s=r.a.t("furni_bag.timelimit")+":  ";if(e>0)s+="[color=#FF0000]"+(e+"-"+this.stringFormat(i)+":"+this.stringFormat(n)+":"+this.stringFormat(o))+"[/color]";else if(i>0||n>0||o>0){s+="[color=#FF0000]"+(this.stringFormat(i)+":"+this.stringFormat(n)+":"+this.stringFormat(o))+"[/color]"}else{s+="[color=#FF0000]"+(""+r.a.t("furni_bag.expires"))+"[/color]"}return s},DetailBubble.prototype.stringFormat=function(t){var e=t+"";return e.length<=1&&(e="0"+e),e},DetailBubble}(Phaser.GameObjects.Container),w=function(t){function Item(e,i,n,o,r,s){void 0===s&&(s=1);var h=t.call(this,e,i,n)||this;h.dpr=r,h.zoom=s;var l=e.make.image({key:o,frame:"grid_bg"},!1);return h.selectbg=e.make.image({key:o,frame:"grid_choose"},!1),h.setSize(l.displayWidth,l.displayHeight),h.selectIcon=e.make.image({key:o,frame:"selected"},!1).setOrigin(1).setPosition(.5*h.width,.5*h.height),h.mPropImage=new c.DynamicImage(h.scene,0,0),h.mPropImage.scale=r,h.timeIcon=e.make.image({key:o,frame:"time"}),h.timeIcon.setPosition(.5*-h.width+.5*h.timeIcon.width,.5*-h.height+.5*h.timeIcon.height),h.mCounter=e.make.text({x:.5*h.width-2*r,y:.5*h.height,style:{fontSize:12*r,fontFamily:a.a.DEFULT_FONT}},!1).setOrigin(1),h.add([l,h.selectbg,h.selectIcon,h.mPropImage,h.timeIcon,h.mCounter]),h.isSelect=!1,h.isEquip=!1,h}return g(Item,t),Item.prototype.setProp=function(t){if(this.propData=t,this.isSelect=!1,this.isEquip=!1,!t)return this.mCounter.visible=!1,this.mPropImage.visible=!1,void(this.timeIcon.visible=!1);this.mPropImage.load(p.i.getOsdRes(t.display.texturePath),this,this.onPropLoadCompleteHandler),this.mPropImage.visible=!0,this.timeIcon.visible=t.expiredTime>0,t.count>1?(this.mCounter.visible=!0,this.mCounter.setText(t.count.toString())):this.mCounter.visible=!1,t.rightSubscript===h.op_pkt_def.PKT_Subscript.PKT_SUBSCRIPT_CHECKMARK?this.isEquip=!0:this.isEquip=!1},Item.prototype.onPropLoadCompleteHandler=function(){if(this.mPropImage&&this.mPropImage.texture){var t=this.mPropImage.texture;this.mPropImage.displayHeight=45*this.dpr,this.mPropImage.scaleX=this.mPropImage.scaleY,t&&t.setFilter(Phaser.Textures.FilterMode.NEAREST)}},Object.defineProperty(Item.prototype,"isSelect",{set:function(t){this.selectbg.visible=t},enumerable:!1,configurable:!0}),Object.defineProperty(Item.prototype,"isEquip",{set:function(t){this.selectIcon.visible=t},enumerable:!1,configurable:!0}),Item.prototype.onSelectedHandler=function(){this.emit("select",this.propData)},Item}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"GMToolsPanel",(function(){return l}));var n,o=i(112),r=i(115),s=i(149),a=i(0),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function GMToolsPanel(e,i){return t.call(this,e,i)||this}return c(GMToolsPanel,t),GMToolsPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&this.showButtons()},GMToolsPanel.prototype.addListen=function(){this.mInitialized&&(this.closeBtn.on(String(h.ClickEvent.Tap),this.onCloseHandler,this),this.commitBtn.on(String(h.ClickEvent.Tap),this.onCommitCmdHandler,this))},GMToolsPanel.prototype.removeListen=function(){this.mInitialized&&(this.closeBtn.off(String(h.ClickEvent.Tap),this.onCloseHandler,this),this.commitBtn.off(String(h.ClickEvent.Tap),this.onCommitCmdHandler,this))},GMToolsPanel.prototype.resize=function(){var t=this.scaleWidth,e=this.scaleHeight;a.a.getInstance().log("resize: ",this.cameraWidth,this.scaleHeight),this.setSize(this.scaleWidth,this.scaleHeight),this.closeBtn.x=.5*(t-this.closeBtn.width)-16*this.dpr,this.closeBtn.y=.5*-(e-this.closeBtn.height)+16*this.dpr,this.background.clear(),this.background.fillStyle(0,.6),this.background.fillRect(0,0,t,e),this.background.x=.5*-t,this.background.y=.5*-e,this.background.setInteractive(new Phaser.Geom.Rectangle(0,0,t,e),Phaser.Geom.Rectangle.Contains),this.command.x=.5*-this.width+20*this.dpr,this.command.y=.5*-this.height+60*this.dpr,this.x=.5*this.cameraWidth,this.y=.5*this.cameraHeight,this.commitBtn.x=this.command.x+this.command.width+.5*this.commitBtn.width+16*this.dpr,this.commitBtn.y=this.command.y+.5*this.command.height,this.gridtable.setSize(this.width,e-110*this.dpr),this.gridtable.layout(),this.gridtable.resetMask()},GMToolsPanel.prototype.preload=function(){this.addAtlas(r.UIAtlasKey.commonKey,r.UIAtlasName.commonUrl+".png",r.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},GMToolsPanel.prototype.init=function(){var e=this,i=this.scaleWidth,n=this.scaleHeight;this.setSize(i,n),this.background=this.scene.make.graphics(void 0,!1);var o=this.scale,a=i-30*this.dpr,c=46*this.dpr,l=null;this.scene.textures.exists("gmtools_btn")||((l=this.scene.make.graphics(void 0,!1)).fillStyle(36026),l.fillRoundedRect(0,0,a,c),l.generateTexture("gmtools_btn",a,c)),this.command=new s.LabelInput(this.scene,{width:this.width-110*this.dpr,height:16*this.dpr,placeholder:"输入命令",fontSize:14*this.dpr+"px",color:"#666666"}).setOrigin(0,0),this.command.x=.5*-this.width+20*this.dpr,this.command.y=.5*-this.height+60*this.dpr,this.command.createBackground(6*this.dpr,10*this.dpr),this.scene.textures.exists("gmtools_commit")||(l.clear(),l.fillStyle(699050),l.fillRoundedRect(0,0,50*this.dpr,30*this.dpr),l.generateTexture("gmtools_commit",50*this.dpr,30*this.dpr),l.destroy()),this.commitBtn=new h.Button(this.scene,"gmtools_commit","","","提交"),this.commitBtn.setTextStyle({fontSize:12*this.dpr});var d=54*this.dpr,m={x:0,y:60*this.dpr,table:{width:i,height:n-110*this.dpr,columns:1,cellWidth:i,cellHeight:d,reuseCellContainer:!0,zoom:o,cellPadX:0,cellPadY:10*this.dpr},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.item;return null===i&&(i=new p(e.scene,91*e.dpr,46*e.dpr,e.dpr)).on("targetUI",e.onTargetUIHandler,e),i.setSize(t.width,t.height),i.setData({item:n}),i.setItemData(n),i}};this.gridtable=new h.GameGridTable(this.scene,m),this.gridtable.on("cellTap",(function(t){if(t){var i=t.item;i&&i.node&&e.onTargetUIHandler(i.node.id)}})),this.closeBtn=new h.Button(this.scene,r.UIAtlasKey.commonKey,"close"),this.add([this.background,this.gridtable,this.closeBtn,this.command,this.commitBtn]),t.prototype.init.call(this),this.resize()},GMToolsPanel.prototype.showButtons=function(){if(this.mShowData&&!(this.mShowData.length<1)){var t=this.showData[0],e=t.button;e.length>=1&&this.gridtable.setItems(e);var i=t.inputText;i&&i.length>0&&this.command.setData({item:i[0]})}},GMToolsPanel.prototype.onTargetUIHandler=function(t){!this.mShowData||this.mShowData.length<1||(this.emit("targetUI",this.mShowData[0].id,t),this.command.setBlur())},GMToolsPanel.prototype.onCloseHandler=function(){this.emit("close")},GMToolsPanel.prototype.onCommitCmdHandler=function(){if(this.command.setBlur(),this.mShowData&&!(this.mShowData.length<1)){var t=this.command.text;if(t){var e=this.command.getData("item");e&&e.node&&this.emit("targetUI",this.mShowData[0].id,e.node.id,t)}}},GMToolsPanel}(o.BasePanel),p=function(t){function Item(e,i,n,o){var r=t.call(this,e)||this;return r.btn=new h.Button(r.scene,"gmtools_btn","","","1"),r.btn.on(String(h.ClickEvent.Tap),r.onBtnHandler,r),r.btn.setTextStyle({fontSize:12*o}),r.btn.removeInteractive(),r.add(r.btn),r}return c(Item,t),Item.prototype.setItemData=function(t){this.item=t,this.btn.setText(t.text)},Item.prototype.onBtnHandler=function(){this.item&&this.emit("targetUI",this.item.id)},Item}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"InfoPanel",(function(){return m}));var n,o=i(112),r=i(116),s=i(121),a=i(111),h=i(113),c=i(273),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=Phaser.Utils.Objects.GetValue,m=function(t){function InfoPanel(e,i){var n=t.call(this,e,i)||this;return n.mWorld=i,n}return p(InfoPanel,t),InfoPanel.prototype.addListen=function(){this.mInitialized&&this.mCloseBtn&&this.mCloseBtn.on("pointerup",this.closeHandler,this)},InfoPanel.prototype.removeListen=function(){this.mInitialized&&this.mCloseBtn&&this.mCloseBtn.off("pointerup",this.closeHandler,this)},InfoPanel.prototype.resize=function(t,e){if(this.mInitialized){var i=this.mWorld.getSize(),n=this.mWorld.uiScale,o=this.mWorld.uiRatio;this.x=i.width>>1,this.y=i.height>>1,this.mActor.x=-this.width/2+80*n*o,this.mActor.y=-this.height/2+160*n*o,this.mNameTextArea.setMinSize(220*this.dpr*n,222*this.dpr*n),this.mNameTextArea.setPosition(i.width/2+60*this.dpr*n,i.height/2-110*this.dpr*n),this.mNameTextArea.layout();var r=this.mNameTextArea.childrenMap.text;r.x=-10*this.dpr*n,r.y=-200*this.dpr*n,this.mAttributesTextArea.setMinSize(360*this.dpr*n,180*this.dpr*n),this.mAttributesTextArea.setPosition(i.width/2+3*this.dpr*n,i.height/2+95*this.dpr*n),this.mAttributesTextArea.layout();var s=this.mAttributesTextArea.childrenMap.text;s.x=-this.width/2+30*this.dpr*n,s.y=5*this.dpr*n}},InfoPanel.prototype.show=function(e){if(!this.mShow&&(t.prototype.show.call(this,e),this.mInitialized)){var i=this.mWorld.getSize();this.setData("data",e),this.setInfo(e),this.resize(i.width,i.height)}},InfoPanel.prototype.hide=function(){t.prototype.hide.call(this)},InfoPanel.prototype.setInfo=function(t){var e=this;if(this.mInitialized&&t){if(t.actors){if(0===t.actors.length)return;var i=t.actors[0];this.mWorld.httpService.userDetail(i.platformId).then((function(t){if(200===t.code){var i=t.data;i&&e.mActor.load(a.i.getOsdRes("show/"+i.username+".png"),e,void 0,e.loadDefaultAvatar)}}))}var n=t.text;n[0]&&this.mNameTextArea.setText(this.checkValue(n[0])),n[1]&&this.mAttributesTextArea.setText(this.checkValue(n[1]))}},InfoPanel.prototype.destroy=function(){this.mActor&&(this.mActor.destroy(!0),this.mActor=null),this.mNameTextArea&&(this.mNameTextArea.destroy(),this.mNameTextArea=null),this.mAttributesTextArea&&(this.mAttributesTextArea.destroy(),this.mAttributesTextArea=null),this.mWorld=null,t.prototype.destroy.call(this)},InfoPanel.prototype.preload=function(){this.scene.load.image(a.d.getName(),a.d.getPNG()),this.scene.load.image(a.a.getName(),a.a.getPNG()),this.scene.load.atlas(a.c.getName(),a.c.getPNG(),a.c.getJSON()),t.prototype.preload.call(this)},InfoPanel.prototype.init=function(){var e=this.mWorld.getSize(),i=this.mWorld.uiScale;this.setSize(400*this.dpr*i,500*this.dpr*i);var n=new l.NinePatch(this.scene,{width:this.width,height:this.height,key:a.a.getName(),columns:a.a.getColumns(),rows:a.a.getRows()}),o=new l.NinePatch(this.scene,{width:this.width-20*this.dpr*i,height:this.height-20*this.dpr*i,key:a.d.getName(),columns:a.d.getColumns(),rows:a.d.getRows()});this.mNameBBCodeText=new l.BBCodeText(this.scene,0,0,"",{fontSize:14*this.dpr*i+"px",fontFamily:h.a.DEFULT_FONT,textMask:!1,wrap:{mode:"char",width:270*this.dpr*i}}),this.mNameTextArea=new l.TextArea(this.scene,{x:this.width/2-80*i*this.dpr,y:-75*i*this.dpr,textWidth:270*this.dpr*i,textHeight:180*this.dpr*i,textMask:!0,text:this.mNameBBCodeText}).layout(),this.mAttributesBBCodeText=new l.BBCodeText(this.scene,0,0,"",{fontSize:14*this.dpr*i+"px",fontFamily:h.a.DEFULT_FONT,textMask:!1,wrap:{mode:"char",width:this.width-30*this.dpr*i}}),this.mAttributesTextArea=new l.TextArea(this.scene,{x:e.width/2+3*this.dpr*i,y:e.height/2+95*this.dpr*i,textMask:!0,textWidth:this.width-60*this.dpr*i,textHeight:180*this.dpr*i,text:this.mAttributesBBCodeText}).layout(),this.mCloseBtn=new s.NinePatchButton(this.scene,258,145,80,34,a.c.getName(),"","关闭",a.c.getConfig()),this.mCloseBtn.x=0,this.mCloseBtn.y=this.height-100*this.mWorld.uiRatio*i>>1,this.mCloseBtn.setTextStyle({font:h.a.YAHEI_16_BOLD}),this.mActor=new r.DynamicImage(this.scene,300,125).setOrigin(.5,1),this.mActor.scale=2,this.mWorld.uiManager.getMediator(c.InfoPanelMediator.NAME).resize(),this.add([n,o,this.mNameBBCodeText,this.mAttributesBBCodeText,this.mCloseBtn,this.mActor]),this.addListen(),t.prototype.init.call(this),this.setInfo(this.getData("data"))},InfoPanel.prototype.closeHandler=function(t){this.checkPointerDis(t)&&this.hide()},InfoPanel.prototype.checkPointerDis=function(t){return!this.mWorld||(Math.abs(t.downX-t.upX)<10*this.mWorld.uiRatio*this.mWorld.uiScale||Math.abs(t.downY-t.upY)<10*this.mWorld.uiRatio*this.mWorld.uiScale)},InfoPanel.prototype.loadDefaultAvatar=function(){var t=a.i.getOsdRes("show/avatar_default.png");this.scene.textures.exists(t)?this.mActor.setTexture(t):this.mActor.load(t)},InfoPanel.prototype.checkValue=function(t){return d(t,"text","")},InfoPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"InfoPanelMediator",(function(){return c}));var n,o=i(119),r=i(272),s=i(146),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function InfoPanelMediator(e,i,n){var o=t.call(this)||this;return o.mLayerManager=e,o.mScene=i,o.world=n,o}return h(InfoPanelMediator,t),InfoPanelMediator.prototype.hide=function(){this.mShow=!1,this.world.emitter.off(o.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView&&(this.mView.hide(),this.mView=null)},InfoPanelMediator.prototype.isSceneUI=function(){return!1},InfoPanelMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},InfoPanelMediator.prototype.resize=function(){this.mView&&this.mView.resize()},InfoPanelMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||e&&0!==e.length&&(this.mView=new r.InfoPanel(this.mScene,this.world),this.mView.show(e[0]),this.mLayerManager.addToUILayer(this.mView),this.world.emitter.on(o.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),t.prototype.show.call(this,e))},InfoPanelMediator.prototype.destroy=function(){this.mView&&this.mView.destroy()},InfoPanelMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},InfoPanelMediator.prototype.onClosePanel=function(t){s.a.checkPointerContains(this.mView,t)||this.hide()},InfoPanelMediator.NAME="InfoPanelMediator",InfoPanelMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractivePanel",(function(){return d}));var n,o=i(112),r=i(111),s=i(117),a=i(164),h=i(2),c=i(275),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function InteractivePanel(e,i){var n=t.call(this,e,i)||this;return n.mRadioCom=!1,n.mLeftBaseScaleX=1,n.mLeftBaseScaleY=1,n.mMidBaseScaleX=1,n.mMidBaseScaleY=1,n.mRightBaseScaleX=1,n.mRightBaseScaleY=1,n.mDisDelection=10,n.setTween(!1),n}return p(InteractivePanel,t),InteractivePanel.prototype.show=function(e){var i=this;t.prototype.show.call(this,e);this.mWorld.getSize();if(this.mShowData=e,this.mInitialized){this.mShow=!0;var n=this.mWorld.uiManager.getMediator(c.InteractivePanelMediator.NAME),o=this.mShowData[0];if(this.mLeftFaceIcon&&(this.mLeftFaceIcon.visible=!1),this.mRightFaceIcon&&(this.mRightFaceIcon.visible=!1),this.mMidFaceIcon&&(this.mMidFaceIcon.visible=!1),o.display&&o.display.length>0){var s=o.display[0],h=r.i.getOsdRes(s.texturePath);this.scene.cache.obj.get(h)?this.onLoadComplete():(this.scene.load.image(h,h),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())}if(this.mDescTF.text="",this.mNameTF.text="",o.text&&o.text.length>0){var l=o.text[0];if(this.mDescCon.setData("nodeID",l.node.id),this.mTextArea.setText(l.text),this.mDescCon.off("pointerup",this.descConClick,this),this.mDescCon.on("pointerup",this.descConClick,this),o.text[1]){var p=o.text[1];this.mNameCon.setData("nodeID",p.node.id),this.mNameTF.text=p.text,this.mNameTF.x=-this.mNameTF.width>>1,this.mNameCon.off("pointerup",this.nameConClick,this),this.mNameCon.on("pointerup",this.nameConClick,this)}}if(this.mRadio&&(this.mRadio.visible=!1),o.button&&o.button.length>0){var d=33*(o.button.length-1)+46;this.mRadio||(this.mRadio=new a.Radio(this.mScene,{wid:350,hei:d,resKey:"juqing",resPng:"./resources/ui/juqing/juqing.png",resJson:"./resources/ui/juqing/juqing.json",resBg:"radio_bg.png",resArrow:"radio_arrow.png",fontStyle:{size:20,color:"#ffcc00",bold:!1},completeBack:function(){i.radioComplete()},clickCallBack:function(t){t&&n&&n.componentClick(t.data)}}),this.radioComplete()),this.setRadioData(o.button),this.mRadio.visible=!0}this.resize(),this.mShow}else this.preload()},InteractivePanel.prototype.hide=function(){t.prototype.hide.call(this)},InteractivePanel.prototype.update=function(t){this.show(t)},InteractivePanel.prototype.getRadio=function(){return this.mRadio},InteractivePanel.prototype.setRadioData=function(t){this.mRadio.setRadioData(t)},InteractivePanel.prototype.resize=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.scale=this.mWorld.uiScale;var n=this.mWorld.getSize(),o=this.mWorld.getSize().width,r=this.mWorld.getSize().height,s=this.mWorld.uiScale;this.mNameCon.add(this.mNameBg),this.mNameCon.add(this.mNameTF),this.mDescCon.add(this.mBg),this.mDescCon.add(this.mBorder),this.mDescCon.add(this.mDescTF),this.mDescCon.add(this.mTextArea),this.add(this.mNameCon),this.add(this.mDescCon),this.setSize(o,r),this.mWorld.game.device.os.desktop?this.y=n.height/2-250:(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.mBg.resize((n.width-10)/this.mWorld.uiScale,.5*n.height/this.mWorld.uiScale),this.mBorder.resize((n.width-20)/this.mWorld.uiScale,(.5*n.height-20)/this.mWorld.uiScale),this.y=1.5*this.mBg.height*this.mWorld.uiScale),this.x=n.width>>1,this.refreshUIPos(),this.mRadio&&this.add(this.mRadio),this.mTextArea.childrenMap.child.setMinSize(this.mBorder.width-10*this.dpr*s,this.mBorder.height-3*this.dpr*s),this.mTextArea.layout(),this.mTextArea.setPosition(o/2,this.y+this.mDescCon.y);var a=this.mTextArea.childrenMap.text;a.x=-this.mBorder.width>>1,a.y=-this.mBorder.height/2+20*this.dpr,a.resize(this.mBorder.width,this.mDescTF.displayHeight+2e3),this.mTextArea.scrollToBottom(),t.prototype.resize.call(this,e,i)},InteractivePanel.prototype.destroy=function(){this.mInitialized=!1,this.mNameCon&&this.mNameCon.destroy(!0),this.mDescCon&&this.mDescCon.destroy(!0),this.mLeftFaceIcon&&this.mLeftFaceIcon.destroy(!0),this.mMidFaceIcon&&this.mMidFaceIcon.destroy(!0),this.mRightFaceIcon&&this.mRightFaceIcon.destroy(!0),this.mNameTF&&this.mNameTF.destroy(!0),this.mDescTF&&this.mDescTF.destroy(!0),this.mRadio&&this.mRadio.destroy(),this.mNameCon=null,this.mDescCon=null,this.mLeftFaceIcon=null,this.mMidFaceIcon=null,this.mRightFaceIcon=null,this.mNameTF=null,this.mDescTF=null,this.mRadio=null,t.prototype.destroy.call(this)},InteractivePanel.prototype.preload=function(){this.mScene&&(this.scene.load.image(r.a.getName(),r.a.getPNG()),this.scene.load.image(r.d.getName(),r.d.getPNG()),this.mScene.load.atlas("juqing",r.i.getRes("ui/juqing/juqing.png"),r.i.getRes("ui/juqing/juqing.json")),t.prototype.preload.call(this))},InteractivePanel.prototype.init=function(){var e=this.mWorld.getSize().width,i=this.mWorld.getSize().height,n=this.mWorld.uiScale;this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mNameCon=this.mScene.make.container(void 0,!1),this.mDescCon=this.mScene.make.container(void 0,!1),this.mBg=new s.NinePatch(this.scene,0,0,1080,320,r.a.getName(),null,r.a.getConfig()),this.setSize(e,i),this.mBorder=new s.NinePatch(this.scene,0,0,1040,280,r.d.getName(),null,r.d.getConfig()),this.mLeftFaceIcon=this.mScene.make.image(void 0,!1),this.mMidFaceIcon=this.mScene.make.image(void 0,!1),this.mRightFaceIcon=this.mScene.make.image(void 0,!1),this.mNameTF=new l.BBCodeText(this.mScene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:this.mBorder.width}}),this.mNameBg=this.mScene.make.image(void 0,!1),this.mNameBg.setTexture("juqing","juqing_name.png"),this.mDescTF=new l.BBCodeText(this.mScene,0,0,"",{fontSize:"20px",halign:"left",textMask:!1,padding:{top:0,bottom:0,left:8*this.dpr*n,right:3*this.dpr*n},wrap:{mode:"character",width:this.mBorder.width-12*this.dpr*n}}),this.mTextArea=new l.TextArea(this.mScene,{x:e/2,y:this.mBorder.y+this.mBorder.height/2+80*this.dpr*n,width:this.mBorder.width,height:this.mBorder.height-20*this.dpr*n,textWidth:this.mBorder.width-12*this.dpr*n,textHeight:0,text:this.mDescTF}).layout(),this.mDescCon.setSize(this.mBg.width,this.mBg.height),this.mNameCon.setSize(this.mNameBg.width,this.mNameBg.height),this.mDescCon.setInteractive(),this.mNameCon.setInteractive(),t.prototype.init.call(this)},InteractivePanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.resize()},InteractivePanel.prototype.refreshUIPos=function(){var t=this.mWorld.getSize(),e=this.mWorld.uiScale;this.mDescCon.setSize(this.mBg.width,this.mBg.height),this.mNameCon.setSize(this.mNameBg.width,this.mNameBg.height),this.mNameTF.y=-8*this.mWorld.uiScale,this.mDescCon.y=this.mWorld.game.device.os.desktop?t.height/2+80:0,this.mNameCon.x=150-this.mDescCon.width/2,this.mNameCon.y=this.mDescCon.y-this.mDescCon.height/2-this.mNameCon.height/2-10,this.mNameTF.setWrapWidth(this.mBorder.width),this.mDescTF.setWrapWidth(this.mBorder.width-10*this.dpr*e),this.mNameTF.x=-this.mNameTF.width>>1;this.mDescCon.getWorldTransformMatrix().ty;if(!this.mWorld.game.device.os.desktop){var i=this.mLeftFaceIcon.width*this.mWorld.uiScale,n=this.mLeftFaceIcon.height*this.mWorld.uiScale,o=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,i,n);this.mLeftFaceIcon.scaleX=this.mLeftBaseScaleX*o*.7,this.mLeftFaceIcon.scaleY=this.mLeftBaseScaleY*o*.7,this.mLeftFaceIcon.x=this.mNameCon.x,this.mLeftFaceIcon.y=this.mNameTF.y-this.mLeftFaceIcon.height;var r=this.mMidFaceIcon.width*this.mWorld.uiScale,s=this.mMidFaceIcon.height*this.mWorld.uiScale,a=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,r,s);this.mMidFaceIcon.scaleX=this.mMidBaseScaleX*a*.7,this.mMidFaceIcon.scaleY=this.mMidBaseScaleY*a*.7,this.mMidFaceIcon.x=0,this.mMidFaceIcon.y=this.mNameTF.y-this.mMidFaceIcon.height;var h=this.mRightFaceIcon.width*this.mWorld.uiScale,c=this.mRightFaceIcon.height*this.mWorld.uiScale,l=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,h,c);this.mRightFaceIcon.scaleX=this.mRightBaseScaleX*l*.7,this.mRightFaceIcon.scaleY=this.mRightBaseScaleY*l*.7,this.mRightFaceIcon.x=-this.mNameCon.x,this.mRightFaceIcon.y=this.mNameTF.y-this.mRightFaceIcon.height}this.mRadioCom&&(this.mWorld.game.device.os.desktop?(this.mRadio.x=this.mBg.x+this.mBg.width/2-this.mRadio.width,this.mRadio.y=this.mDescCon.y+this.mDescCon.height/2-this.mRadio.height):(this.mRadio.x=this.mBg.width/2-this.mRadio.width,this.mRadio.y=this.mBg.height/2-this.mRadio.height))},InteractivePanel.prototype.getScale=function(t,e,i,n){return t/i>e/n?t/i:e/n},InteractivePanel.prototype.onLoadComplete=function(){this.mWorld.getSize();var t=this.mShowData[0].display[0],e=r.i.getOsdRes(t.texturePath),i=-this.mBorder.width/2,n=(this.mBorder.height,t.scaleX),o=t.scaleY,s=1;this.mWorld.uiManager.getMediator(c.InteractivePanelMediator.NAME);switch(t.horizontal){case h.op_def.HorizontalAlignment.HORIZONTAL_LEFT:this.mLeftFaceIcon.setTexture(e),this.mLeftFaceIcon.setData("nodeID",t.node.id),this.mLeftBaseScaleX=n,this.mLeftBaseScaleY=o,s=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,this.mLeftFaceIcon.width,this.mLeftFaceIcon.height),this.mLeftFaceIcon.scaleX=n*s,this.mLeftFaceIcon.scaleY=o*s,this.mLeftFaceIcon.x=i+200,this.mLeftFaceIcon.setInteractive(),this.addAt(this.mLeftFaceIcon,0),this.mLeftFaceIcon.visible=!0,this.mLeftFaceIcon.off("pointerup",this.leftFaceClick,this),this.mLeftFaceIcon.on("pointerup",this.leftFaceClick,this);break;case h.op_def.HorizontalAlignment.HORIZONTAL_CENTER:this.mMidFaceIcon.setTexture(e),this.mMidFaceIcon.setData("nodeID",t.node.id),this.mMidBaseScaleX=n,this.mMidBaseScaleY=o,s=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,this.mMidFaceIcon.width,this.mMidFaceIcon.height),this.mMidFaceIcon.scaleX=n*s,this.mMidFaceIcon.scaleY=o*s,this.mMidFaceIcon.x=0,this.addAt(this.mMidFaceIcon,0),this.mMidFaceIcon.visible=!0,this.mMidFaceIcon.setInteractive(),this.mLeftFaceIcon.off("pointerup",this.midFaceClick,this),this.mMidFaceIcon.on("pointerup",this.midFaceClick,this);break;case h.op_def.HorizontalAlignment.HORIZONTAL_RIGHT:this.mRightFaceIcon.setTexture(e),this.mRightFaceIcon.setData("nodeID",t.node.id),this.mRightBaseScaleX=n,this.mRightBaseScaleY=o,s=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,this.mRightFaceIcon.width,this.mRightFaceIcon.height),this.mRightFaceIcon.scaleX=n*s,this.mRightFaceIcon.scaleY=o*s,this.mRightFaceIcon.x=200,this.addAt(this.mRightFaceIcon,0),this.mRightFaceIcon.visible=!0,this.mRightFaceIcon.setInteractive(),this.mRightFaceIcon.off("pointerup",this.rightFaceClick,this),this.mRightFaceIcon.on("pointerup",this.rightFaceClick,this)}this.resize()},InteractivePanel.prototype.rightFaceClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(c.InteractivePanelMediator.NAME);e&&e.componentClick(this.mRightFaceIcon.getData("nodeID"))}},InteractivePanel.prototype.midFaceClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(c.InteractivePanelMediator.NAME);e&&e.componentClick(this.mMidFaceIcon.getData("nodeID"))}},InteractivePanel.prototype.leftFaceClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(c.InteractivePanelMediator.NAME);e&&e.componentClick(this.mLeftFaceIcon.getData("nodeID"))}},InteractivePanel.prototype.descConClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(c.InteractivePanelMediator.NAME);this.mDescCon.getData("nodeID")&&e&&e.componentClick(this.mDescCon.getData("nodeID"))}},InteractivePanel.prototype.nameConClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(c.InteractivePanelMediator.NAME);this.mNameCon.getData("nodeID")&&e&&e.componentClick(this.mNameCon.getData("nodeID"))}},InteractivePanel.prototype.checkPointer=function(t){return Math.abs(t.downX-t.upX)<this.mDisDelection&&Math.abs(t.downY-t.upY)<this.mDisDelection},InteractivePanel.prototype.onLoadError=function(t){},InteractivePanel.prototype.radioComplete=function(){this.mRadioCom=!0,this.mRadio&&(this.mRadio.x=220,this.mRadio.y=this.mDescCon.height+200,this.resize())},InteractivePanel.baseWidth=720,InteractivePanel.baseHeight=720,InteractivePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractivePanelMediator",(function(){return c}));var n,o=i(274),r=i(109),s=i(2),a=i(110),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function InteractivePanelMediator(e,i,n){var o=t.call(this)||this;return o.mUIType=r.UIType.Monopoly,o.mScene=i,o.world=n,o}return h(InteractivePanelMediator,t),InteractivePanelMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},InteractivePanelMediator.prototype.isSceneUI=function(){return!1},InteractivePanelMediator.prototype.resize=function(){if(this.mView&&this.mView.isShow)return this.mView.resize()},InteractivePanelMediator.prototype.getView=function(){return this.mView},InteractivePanelMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new o.InteractivePanel(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},InteractivePanelMediator.prototype.update=function(e){this.mView&&this.mView.isShow&&t.prototype.update.call(this,e)},InteractivePanelMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView.hide(),this.mView=null)},InteractivePanelMediator.prototype.destroy=function(){this.world=null,this.mScene=null,this.mParam=null,t.prototype.destroy.call(this)},InteractivePanelMediator.prototype.componentClick=function(t){if(this.mParam&&this.mParam.length>0){var e=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),i=e.content;i.uiId=this.mParam[0].id,i.componentId=t,this.world.connection.send(e)}},InteractivePanelMediator.NAME="InteractivePanelMediator",InteractivePanelMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemDetail",(function(){return c}));var n,o=i(112),r=i(111),s=i(145),a=i(121),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function ItemDetail(e,i){var n=t.call(this,e,i)||this;return n.mBtnWid=100,n.mBtnHei=40,n.mWid=0,n.mHei=0,n}return h(ItemDetail,t),ItemDetail.prototype.getBtnList=function(){return this.mBtnList},ItemDetail.prototype.resize=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=this.mWorld.getSize();this.mWorld.game.device.os.desktop,this.x=i.width-(this.width+this.mBtnWid)/2*this.mWorld.uiScale>>1,this.y=i.height-this.height*this.mWorld.uiScale>>1,this.scale=this.mWorld.uiScale},ItemDetail.prototype.show=function(t){if(this.mShowData=t,this.mInitialized){this.mShow=!0;var e=this.mShowData[0];if(e.display.length>0&&this.loadIcon(e.display[0]),e.text.length>0&&this.setText(e.text[0].text),e.button.length>0){this.mBtnList=[];for(var i=void 0,n=e.button.length,o=20,s=this.mWid+50,h=0;h<n;h++){var c=e.button[h];i=new a.NinePatchButton(this.mScene,0,0,this.mBtnWid,this.mBtnHei,r.c.getName(),r.c.getName(),c.text,r.c.getConfig(),c),this.mBtnList.push(i),i.x=s,i.y=o,o+=i.height+40,this.add(i)}}var l=this.mScene.add.graphics();l.fillStyle(0,.6),l.fillRoundedRect(0,0,this.mWid,this.mHei,6),this.addAt(l,0),this.setSize(this.mWid+120,this.mHei),this.resize(),this.setInteractive()}else this.preload()},ItemDetail.prototype.setText=function(t){this.mDescTF.setText(t),this.mHei+=this.mDescTF.y+this.mDescTF.height+10},ItemDetail.prototype.loadIcon=function(t){var e=this;this.mIcon&&this.mIcon.load(r.i.getOsdRes(t),(function(){e.mHei+=e.mIcon.y+e.mIcon.height}))},ItemDetail.prototype.hide=function(){this.disInteractive(),t.prototype.hide.call(this)},ItemDetail.prototype.destroy=function(){this.mBtnList&&(this.mBtnList.forEach((function(t){t.destroy(!0),t=null})),this.mBtnList=null),this.mResStr="",this.mResPng="",this.mResJson="",this.mNameTF&&this.mNameTF.destroy(!0),this.mDescTF&&this.mDescTF.destroy(!0),this.mIcon&&this.mIcon.destroy(),this.mNameTF=null,this.mDescTF=null,this.mIcon=null,this.mWid=0,this.mHei=0,t.prototype.destroy.call(this)},ItemDetail.prototype.preload=function(){this.mResStr="itemDetail",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.mScene&&(this.mScene.load.atlas(r.c.getName(),r.c.getPNG(),r.c.getJSON()),this.mScene.load.atlas("itemDetail",r.i.getRes("ui/bag/bagView.png"),r.i.getRes("ui/bag/bagView.json")),t.prototype.preload.call(this))},ItemDetail.prototype.init=function(){this.mWorld.getSize();this.mWid=290,this.mHei=0,this.mIcon=new s.DragDropIcon(this.mScene,30,25),this.add(this.mIcon),this.mNameTF=this.scene.make.text({style:{fontFamily:"YaHei",fontSize:20,origin:{x:0,y:0},wordWrap:{width:250,useAdvancedWrap:!0}}},!1),this.mNameTF.setFontStyle("bold"),this.mNameTF.setAlign("left"),this.mNameTF.x=this.mIcon.x+this.mIcon.width,this.mNameTF.y=this.mIcon.y,this.add(this.mNameTF),this.mDescTF=this.scene.make.text({style:{fontFamily:"YaHei",fontSize:25,origin:{x:0,y:0},wordWrap:{width:250,useAdvancedWrap:!0}}},!1),this.mDescTF.setFontStyle("bold"),this.mDescTF.setAlign("left"),this.mDescTF.x=this.mIcon.x-this.mIcon.width/2,this.mDescTF.y=this.mIcon.y+this.mIcon.height+20,this.add(this.mDescTF),this.mInitialized=!0,this.show(this.mShowData)},ItemDetail}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemPopCardPanel",(function(){return p}));var n,o=i(112),r=i(114),s=i(415),a=i(130),h=i(119),c=i(113),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function ItemPopCardPanel(e,i){var n=t.call(this,e,i)||this;return n.key="item_pop_card",n.mPressDelay=1e3,n.setTween(!1),n}return l(ItemPopCardPanel,t),ItemPopCardPanel.prototype.addListen=function(){this.mInitialized&&(this.mDetailDisplay.on("show",this.onShowHandler,this),this.on("pointerup",this.onCloseHandler,this),this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.mNickName.on("pointerup",this.onPointerNickNameHandler,this),this.mNickName.on("pointerdown",this.onPointerNickNameDownHandler,this),this.mDesText.on("pointerdown",this.onPointerDesDownHandler,this),this.mDesText.on("pointerup",this.onPointerNickNameHandler,this))},ItemPopCardPanel.prototype.removeListen=function(){this.mInitialized&&(this.mDetailDisplay.off("show",this.onShowHandler,this),this.off("pointerup",this.onCloseHandler,this),this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.mNickName.off("pointerup",this.onPointerNickNameHandler,this),this.mNickName.off("pointerdown",this.onPointerNickNameDownHandler,this),this.mDesText.off("pointerdown",this.onPointerDesDownHandler,this),this.mDesText.off("pointerup",this.onPointerNickNameHandler,this))},ItemPopCardPanel.prototype.resize=function(e,i){var n=this.mWorld.uiScale,o=this.scene.cameras.main.width/n,r=this.scene.cameras.main.height/n,s=this.scene.cameras.main.centerX/n,a=this.scene.cameras.main.centerY/n;this.setSize(o,r),this.mCardContainer.x=s,this.mCardContainer.y=a,this.mCloseBtn.x=s,this.mCloseBtn.y=a+this.mCardContainer.height/2+48*this.dpr,t.prototype.resize.call(this,e,i)},ItemPopCardPanel.prototype.setProp=function(){if(this.mShowData){var t=this.mShowData[0].prop;if(t){this.mDesText.setText(t.des),this.mNickName.setText(t.name),t.source?this.mSource.setText(r.a.t("item.source")+t.source):this.mSource.setText("");var e=this.mShowData[0].display;e&&(e.display?this.mDetailDisplay.loadDisplay(e):e.avatar?this.mDetailDisplay.loadAvatar(e.avatar):this.mDetailDisplay.loadUrl(t.icon))}}},ItemPopCardPanel.prototype.preload=function(){this.addAtlas(this.key,"item_pop_card/item_pop_card.png","item_pop_card/item_pop_card.json"),t.prototype.preload.call(this)},ItemPopCardPanel.prototype.init=function(){this.mCardContainer=this.scene.make.container({width:325*this.dpr,height:468*this.dpr},!1),this.mCardContainer.setSize(325*this.dpr,468*this.dpr),this.mCardContainer.setInteractive(),this.mBorder=this.scene.make.graphics(void 0,!1),this.mBorder.fillGradientStyle(7304703,7304703,118271,118271),this.mBorder.fillRect(-this.mCardContainer.width/2,-this.mCardContainer.height/2,this.mCardContainer.width,this.mCardContainer.height);var e=this.scene.make.image({key:this.key,frame:"bg.png"},!1);e.y=23*this.dpr-e.height/2;var i=this.scene.make.image({y:42*this.dpr,key:this.key,frame:"name_bg.png"});this.mNickName=this.scene.make.text({y:42*this.dpr,style:{fontSize:18*this.dpr,fontFamily:c.a.DEFULT_FONT}},!1).setOrigin(.5).setInteractive();var n=this.scene.make.image({y:138*this.dpr,key:this.key,frame:"des_bg.png"},!1);this.mDesText=this.scene.make.text({x:n.x-n.width/2+12*this.dpr,y:n.y-n.height/2+10*this.dpr,style:{fontSize:10*this.dpr,fontFamily:c.a.DEFULT_FONT,wordWrap:{width:240*this.dpr,useAdvancedWrap:!0}}},!1).setInteractive(),this.mDetailDisplay=new a.DetailDisplay(this.scene),this.mDetailDisplay.scale=2*this.dpr,this.mCloseBtn=this.scene.make.image({key:this.key,frame:"close.png"},!1).setInteractive(),this.mSource=this.scene.make.text({x:n.x-n.width/2+12*this.dpr,y:n.y+n.height/2-23*this.dpr,style:{fontSize:10*this.dpr,fontFamily:c.a.DEFULT_FONT}},!1),this.add(this.mCardContainer),this.mCardContainer.add([this.mBorder,e,n,this.mDetailDisplay,i,this.mNickName,this.mDesText,this.mSource]),this.add(this.mCloseBtn),this.resize(0,0),t.prototype.init.call(this),this.setInteractive(),this.setProp()},ItemPopCardPanel.prototype.onCloseHandler=function(){this.emit("close"),clearTimeout(this.mPressTime),this.mNickNameDown=!1},ItemPopCardPanel.prototype.onPointerNickNameHandler=function(){clearTimeout(this.mPressTime),this.mNickNameDown=!1},ItemPopCardPanel.prototype.onPointerNickNameDownHandler=function(){var t=this;this.mPressTime=setTimeout((function(){t.copyName()}),this.mPressDelay)},ItemPopCardPanel.prototype.onPointerDesDownHandler=function(){var t=this;this.mPressTime=setTimeout((function(){t.copyDes()}),this.mPressDelay)},ItemPopCardPanel.prototype.copyName=function(){if(this.mNickName){s(this.mNickName.text);var t={noticeContext:r.a.t("item.copy_suc",{name:r.a.t("item.name")})};this.mWorld.emitter.emit(h.a.SHOW_NOTICE,{content:t})}},ItemPopCardPanel.prototype.copyDes=function(){if(this.mDesText){s(this.mDesText.text);var t={noticeContext:r.a.t("item.copy_suc",{name:r.a.t("item.des")})};this.mWorld.emitter.emit(h.a.SHOW_NOTICE,{content:t})}},ItemPopCardPanel.prototype.onShowHandler=function(t){this.mDetailDisplay.y=-this.mCardContainer.height/4},ItemPopCardPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"LoginPanel",(function(){return p}));var n,o=i(112),r=i(131),s=i(113),a=i(115),h=i(155),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function LoginPanel(e,i){var n=t.call(this,e,i)||this;return n.key="login",n.areaCode="86",n.downcount=-1,n}return l(LoginPanel,t),LoginPanel.prototype.show=function(){t.prototype.show.call(this),this.mInitialized&&this.setInputVisible(!0)},LoginPanel.prototype.setInputVisible=function(t){this.mPhoneCodeInput&&(this.mPhoneCodeInput.visible=t,this.mPhoneInput.visible=t)},LoginPanel.prototype.destroy=function(){t.prototype.destroy.call(this),this.fetchTime&&clearTimeout(this.fetchTime)},LoginPanel.prototype.setLoginEnable=function(t){this.loginBtn.enable=t},LoginPanel.prototype.preload=function(){this.addAtlas(this.key,"./login/login.png","./login/login.json"),this.addAtlas(a.UIAtlasKey.commonKey,a.UIAtlasName.commonUrl+".png",a.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},LoginPanel.prototype.init=function(){t.prototype.init.call(this);var e=this.scene.cameras.main.width/this.scale,i=this.scene.cameras.main.height/this.scale,n=(this.scale,this.scene.make.graphics(void 0,!1));n.fillRect(0,0,e,i),n.fillGradientStyle(7304703,7304703,118271,118271);var o=this.scene.make.image({x:0,y:0,key:this.key,frame:"cloud_left"},!1).setOrigin(0);o.texture.setFilter(Phaser.Textures.FilterMode.LINEAR);var l=this.scene.make.image({x:e,y:0,key:this.key,frame:"cloud_right"},!1).setOrigin(1,0);l.texture.setFilter(Phaser.Textures.FilterMode.LINEAR);var p=this.scene.make.image({x:.5*e,y:44*this.dpr,key:this.key,frame:"logo"},!1).setOrigin(.5,0);p.texture.setFilter(Phaser.Textures.FilterMode.LINEAR);var d=this.scene.make.image({key:this.key,frame:"bg"});d.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),d.x=.5*e,d.y=i-.5*d.height,this.mPhoneInput=new c.InputText(this.scene,0,0,256*this.dpr,40*this.dpr,{type:"tel",maxLength:11,placeholder:"请输入手机号",color:"#717171",fontSize:16*this.dpr+"px"});var m=this.createInput(this.mPhoneInput,.5*e,97*this.dpr+p.y+p.height),u=localStorage.getItem("accountphone");if(u)try{this.mPhoneInput.text=JSON.parse(u).account}catch(t){}this.mPhoneCodeInput=new c.InputText(this.scene,0,0,156*this.dpr,40*this.dpr,{type:"tel",maxLength:4,placeholder:"验证码",color:"#717171",text:"",fontSize:16*this.dpr+"px"}).setOrigin(0,.5);var f=this.createInput(this.mPhoneCodeInput,.5*e,172*this.dpr+p.y+p.height,256*this.dpr);this.mPhoneCodeInput.x=-f.width/2+8*this.dpr;var y=this.scene.make.text({x:.5*e,text:"抵制不良游戏，拒绝盗版游戏。注意自我保护，谨防受骗上当。\n适度游戏益脑，沉迷游戏伤身。合理安排时间，享受健康生活。",style:{color:"#FFEC48",align:"center",fontSize:11*this.dpr,fontFamily:s.a.DEFULT_FONT}},!1).setOrigin(.5);y.setResolution(this.dpr),y.y=i-50*this.dpr-.5*y.height;var g=this.scene.make.text({x:.5*e,text:"本网络游戏适合年满16周岁以上的用户，请您确认已如实进行\n实名注册，为了您的健康，请合理控制游戏时间。",style:{color:"#FFFFFF",align:"center",fontSize:9.33*this.dpr,fontFamily:s.a.DEFULT_FONT}}).setOrigin(.5);g.setResolution(this.dpr),g.y=i-16*this.dpr-.5*g.height;var _=this.scene.make.image({x:12*this.dpr,key:this.key,frame:"line"},!1);_.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.fetchCode=this.scene.make.text({text:"获取验证码",style:{fontSize:14*this.dpr,fontFamily:s.a.DEFULT_FONT,color:"#2B5AF3"}},!1).setOrigin(.5).setInteractive(),this.fetchCode.x=.5*(f.width-this.fetchCode.width)-22*this.dpr,this.fetchCode.setResolution(this.dpr),this.fetchCode.on("pointerup",this.onFetchCodeHandler,this),this.fetchCode.on("pointerdown",this.onFetchCodeDownHandler,this),f.add([_,this.fetchCode]),this.loginBtn=new c.NineSliceButton(this.scene,.5*e,f.y+f.height+33*this.dpr,191*this.dpr,50*this.dpr,a.UIAtlasKey.commonKey,"yellow_btn","登 录",this.dpr,1,{left:12*this.dpr,top:12*this.dpr,right:14*this.dpr,bottom:12*this.dpr}),this.loginBtn.setTextStyle({color:"#995E00",fontSize:22*this.dpr,fontFamily:s.a.DEFULT_FONT}),this.loginBtn.setFontStyle("bold"),this.loginBtn.on(String(c.ClickEvent.Down),this.LoginDownHandler,this),this.loginBtn.on(String(c.ClickEvent.Tap),this.tryLogin,this);var P=new c.BBCodeText(this.scene,0,0,"我已阅读并同意皮卡堂的[area=userService][color=#FFEC48]《用户服务协议》[/color][/area]和[area=privacy][color=#FFEC48]《隐私与保护政策》[/color][/area]",{color:"#ffffff",fontSize:11*this.dpr,fontFamily:s.a.DEFULT_FONT}).setOrigin(.5,.5).setInteractive().on("areadown",(function(t){h.a.openUrl("https://picatown.com/con_news/news.php?nid=1201")}));P.setResolution(this.dpr),this.acceptBtn=new c.CheckBox(this.scene,this.key,"accept_unchecked","accept_checked").on(String(c.ClickEvent.Tap),this.onCheckboxHandler,this),P.x=this.loginBtn.x+8*this.dpr,P.y=this.loginBtn.y+.5*this.loginBtn.height+24*this.dpr,this.acceptBtn.x=P.x-.5*P.width-8*this.dpr,this.acceptBtn.y=P.y,this.acceptBtn.selected=!0,this.add([n,d,o,l,p,m,f,y,g,this.loginBtn,this.acceptBtn,P]),this.scene.scene.sleep(r.a.name),t.prototype.init.call(this)},LoginPanel.prototype.createInput=function(t,e,i,n){var o=this.scene.make.container({x:e,y:i},!1),r=this.scene.textures.getFrame(this.key,"input_bg"),s=new c.NineSlicePatch(this.scene,t.x-8*this.dpr,t.y,(n||t.width)+14*this.dpr,r.height,this.key,"input_bg",{left:27*this.dpr,top:0*this.dpr,right:28*this.dpr,bottom:0*this.dpr},this.dpr,1);return o.add([t,s]),o.setSize(s.width,s.height),o},LoginPanel.prototype.onFetchCodeDownHandler=function(){this.mPhoneInput&&(this.mPhoneCodeInput.setBlur(),this.mPhoneInput.setBlur())},LoginPanel.prototype.onFetchCodeHandler=function(){var t=this,e=this.mPhoneInput.text;11===e.length?this.fetchTime||(this.downcount=60,this.fetchTime=setInterval((function(){--t.downcount<=0&&(clearInterval(t.fetchTime),t.fetchTime=void 0),t.downcount>0?t.fetchCode.setText("获取验证码("+t.downcount+")"):t.fetchCode.setText("获取验证码")}),1e3),this.emit("fetchCode",e,this.areaCode)):this.emit("error","手机格式错误")},LoginPanel.prototype.tryLogin=function(){var t=this.mPhoneInput.text,e=this.mPhoneCodeInput.text;11===t.length?e?this.emit("login",t,e,this.areaCode):this.emit("error","验证码格式错误"):this.emit("error","手机格式错误")},LoginPanel.prototype.LoginDownHandler=function(){this.mPhoneInput&&(this.mPhoneCodeInput.setBlur(),this.mPhoneInput.setBlur())},LoginPanel.prototype.onCheckboxHandler=function(){this.tryLogin&&(this.loginBtn.enable=this.acceptBtn.selected)},LoginPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"VerifiedPanel",(function(){return c}));var n,o=i(112),r=i(113),s=i(115),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function VerifiedPanel(e,i){var n=t.call(this,e,i)||this;return n.isIDCard=/^[1-9]\d{5}(19|20|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,n}return h(VerifiedPanel,t),VerifiedPanel.prototype.setVerifiedEnable=function(t){this.mIDCardInput&&(this.mNameInput.visible=t,this.mIDCardInput.visible=t,this.mVerifiedBtn.enable=t)},VerifiedPanel.prototype.preload=function(){this.addAtlas(s.UIAtlasKey.commonKey,s.UIAtlasName.commonUrl+".png",s.UIAtlasName.commonUrl+".json"),this.addAtlas(s.UIAtlasKey.common2Key,s.UIAtlasName.common2Url+".png",s.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},VerifiedPanel.prototype.init=function(){var e=this.scene.cameras.main,i=e.width,n=e.height,o=this.scene.make.graphics(void 0,!1);o.fillStyle(0,.6),o.fillRect(.5*-i,.5*-n,i,n).setInteractive(new Phaser.Geom.Rectangle(.5*-i,.5*-n,i,n),Phaser.Geom.Rectangle.Contains);var h=this.scene.make.container({},!1),c=this.scene.make.image({key:s.UIAtlasKey.common2Key,frame:"bg"},!1);h.setSize(c.width,c.height);var l=this.scene.make.image({y:-16.33*this.dpr-.5*h.height,key:s.UIAtlasKey.common2Key,frame:"title"},!1).setOrigin(.5,0),p=this.scene.make.text({y:l.y+14.67*this.dpr,text:"实名注册",style:{color:"#905B06",fontSize:16*this.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(.5,0);this.mNameInput=new a.InputText(this.scene,0,0,160*this.dpr,36*this.dpr,{type:"text",placeholder:"请输入真实姓名",color:"#838383",fontSize:10*this.dpr+"px"}).setOrigin(0,.5),this.mIDCardInput=new a.InputText(this.scene,0,0,160*this.dpr,36*this.dpr,{type:"tel",maxLength:18,placeholder:"请输入有效身份证号",color:"#838383",fontSize:10*this.dpr+"px"}).setOrigin(0,.5);var d=this.createInput(this.mNameInput,"*真实姓名：",0,0);d.x=.5*-d.width,d.y=95*this.dpr+.5*d.height-.5*h.height;var m=this.createInput(this.mIDCardInput,"*身份证号：",0,d.y+d.height+15*this.dpr);m.x=d.x;var u=this.scene.make.text({y:40*this.dpr-.5*h.height,text:"根据国家新闻出版署发布《关于未成年人沉迷网络\n游戏的通知》规定，网络游戏用户需要使用有效期\n身份证进行实名注册才能体验游戏。",style:{align:"center",fontSize:10*this.dpr,fontFamily:r.a.DEFULT_FONT,color:"#111111"}},!1).setOrigin(.5,0),f=this.scene.make.text({y:.5*h.height-75*this.dpr,text:"请务必保证您的身份信息确实无误，此信息仅作实名认证，我们将严格\n按照有关法律法规妥善保存、保护，不会用做其他用途。",style:{align:"center",fontSize:8*this.dpr,fontFamily:r.a.DEFULT_FONT,color:"#FF0000"}},!1).setOrigin(.5,1);this.add([o,h]),this.mVerifiedBtn=new a.NineSliceButton(this.scene,0,.5*h.height-16*this.dpr,110*this.dpr,34*this.dpr,s.UIAtlasKey.commonKey,"yellow_btn","提交认证",this.dpr,this.scale,{left:12*this.dpr*this.scale,top:12*this.dpr*this.scale,right:12*this.dpr*this.scale,bottom:12*this.dpr*this.scale}),this.mVerifiedBtn.setTextStyle({color:"#996600",fontSize:14*this.dpr,fontFamily:r.a.DEFULT_FONT}),this.mVerifiedBtn.on(String(a.ClickEvent.Down),this.onVerifiedDownHandler,this),this.mVerifiedBtn.on(String(a.ClickEvent.Tap),this.onVerifiedHandler,this),this.mVerifiedBtn.y-=this.mVerifiedBtn.height/2,this.mVerifiedBtn.setFontStyle("bold"),h.add([c,l,p,d,m,u,f,this.mVerifiedBtn]),t.prototype.init.call(this),this.x=i*this.originX,this.y=n*this.originY,h.y=.3*-this.y},VerifiedPanel.prototype.onVerifiedHandler=function(){var t=this.mNameInput.text,e=this.mIDCardInput.text;t?e&&18===e.length?this.checkIdCard()?this.emit("verified",t,e):this.emit("error","[color=#F9361B]实名认证失败，身份证号码有误\n请如实进行实名认证！[/color]"):this.emit("error","[color=#F9361B]证件格式有误[/color]"):this.emit("error","[color=#F9361B]名字不能为空[/color]")},VerifiedPanel.prototype.onVerifiedDownHandler=function(){this.mNameInput&&(this.mNameInput.setBlur(),this.mIDCardInput.setBlur())},VerifiedPanel.prototype.createInput=function(t,e,i,n){var o=this.scene.make.container({x:i,y:n},!1),s=this.scene.make.text({text:e,style:{color:"#ff0000",fontSize:10*this.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(0,.5),a=this.scene.make.graphics(void 0,!1),h=189*this.dpr,c=36.67*this.dpr;return a.fillStyle(14540253),a.lineStyle(2*this.dpr,10592673),a.fillRoundedRect(s.width,.5*-c,h,c,2*this.dpr),t.x=s.width+10*this.dpr,o.add([s,a,t]),o.setSize(h+t.x,c),o},VerifiedPanel.prototype.checkIdCard=function(){var t=this.mIDCardInput.text;if(this.isIDCard.test(t)&&18===t.length){for(var e=t.split(""),i=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],n=0,o=0;o<17;o++)n+=e[o]*i[o];return["1","0","X","9","8","7","6","5","4","3","2"][n%11]===e[17].toLocaleUpperCase()}return!1},Object.defineProperty(VerifiedPanel.prototype,"verifiedBtn",{get:function(){return this.mVerifiedBtn},enumerable:!1,configurable:!0}),VerifiedPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxView",(function(){return l}));var n,o=i(112),r=i(121),s=i(111),a=i(117),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function MessageBoxView(e,i){return t.call(this,e,i)||this}return c(MessageBoxView,t),MessageBoxView.prototype.resize=function(){var t=this.mWorld.getSize();this.mWorld.game.device.os.desktop,this.x=t.width>>1,this.y=t.height>>1},MessageBoxView.prototype.show=function(e){if(t.prototype.show.call(this,e),this.mInitialized){this.mButtons=[],e[0]&&e[0].text&&e[0].text[0]&&this.mTxt.setText(e[0].text[0].text);var i=e[0].button;if(i){var n=this.mWidth/i.length,o=this.mScene.make.container(void 0,!1);o.y=this.mHeight-24-100;for(var a=0;a<i.length;a++){i[a]&&i[a].text;var h=new r.NinePatchButton(this.mScene,0,0,46,24,"button_blue","button_blue",i[a].text,s.c.getConfig(),i[a]);h.x=a*n+23,this.mButtons.push(h),o.add(h)}o.setSize((i.length-1)*n+46,24),o.x=this.width-o.width>>1,this.add(o)}this.resize()}},MessageBoxView.prototype.destroy=function(){this.mTxt&&this.mTxt.destroy(!0),this.mButtons&&this.mButtons.length>0&&(this.mButtons.forEach((function(t){t&&t.destroy(!0)})),this.mButtons.length=0,this.mButtons=[]),this.mTxt=null,this.mButtons=null,t.prototype.destroy.call(this)},Object.defineProperty(MessageBoxView.prototype,"buttons",{get:function(){return this.mButtons},enumerable:!1,configurable:!0}),MessageBoxView.prototype.preload=function(){this.mScene&&(this.mScene.load.atlas(s.c.getName(),s.c.getPNG(),s.c.getJSON()),this.mScene.load.image(s.d.getName(),s.d.getPNG()),t.prototype.preload.call(this))},MessageBoxView.prototype.init=function(){this.mWorld.getSize();this.mWidth=300,this.mHeight=200;var e=new a.NinePatch(this.scene,0,0,this.mWidth,this.mHeight,s.d.getName(),null,s.d.getConfig());e.x=0,e.y=0,this.add(e),this.mTxt=new h.BBCodeText(this.mScene,0,0,"",{fontSize:"16px",wrap:{mode:"char",width:e.width},halign:"center"}),this.mTxt.x=-this.mWidth/2+10,this.mTxt.y=-this.mHeight/2+10,this.add(this.mTxt),t.prototype.init.call(this)},MessageBoxView}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessChoosePlanPanel",(function(){return d}));var n,o=i(113),r=i(115),s=i(114),a=i(111),h=i(116),c=i(129),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function PicBusinessChoosePlanPanel(e,i,n,o,r,s,a,h){var c=t.call(this,e,i,n)||this;return c.dpr=s,c.key=h,c.zoom=a,c.setSize(o,r),c.create(),c}return p(PicBusinessChoosePlanPanel,t),PicBusinessChoosePlanPanel.prototype.setPlanData=function(t){this.gridtable.setItems(t);var e=this.gridtable.getCells();if(e){var i=e[0];i&&i.container&&this.onGridSelectHandler(i.container)}},PicBusinessChoosePlanPanel.prototype.setHandler=function(t,e){this.cancelHandler=t,this.selectHandler=e},PicBusinessChoosePlanPanel.prototype.resetMask=function(){this.gridtable.resetMask(),this.gameScroll.refreshMask()},PicBusinessChoosePlanPanel.prototype.create=function(){var t=this,e=(this.height,this.width-29*this.dpr),i=100*this.dpr,n=.5*-this.height+.5*i+10*this.dpr;this.gridtable=this.createGrideTable(0,n,e,i,90*this.dpr,100*this.dpr),this.describleText=this.scene.make.text({x:.5*-this.width+20*this.dpr,y:n+.5*i+10*this.dpr,text:"This industry has great development potential.",style:{fontSize:11*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#0"}}).setOrigin(0),this.describleText.setWordWrapWidth(this.width-45*this.dpr,!0),this.add(this.describleText),this.effectText=this.scene.make.text({x:this.describleText.x,y:this.describleText.y+this.describleText.height+20*this.dpr,text:"55225sadffqwerqwerqwer",style:{fontSize:10*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#0",wordWrap:{width:244*this.dpr,useAdvancedWrap:!0}}}).setOrigin(0),this.add(this.effectText),this.materialTitle=this.scene.make.text({x:this.describleText.x,y:this.effectText.y+this.effectText.height+5*this.dpr,text:s.a.t("business_street.material_requirements"),style:{fontSize:11*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#0"}}).setOrigin(0),this.add(this.materialTitle),this.gameScroll=new l.GameScroller(this.scene,{x:0,y:this.materialTitle.y+this.materialTitle.height+22*this.dpr,width:this.width-40*this.dpr,height:60*this.dpr,zoom:this.zoom,dpr:this.dpr,align:2,orientation:1,space:10*this.dpr,celldownCallBack:function(e){t.iteminfoTips.visible=!0,t.onMaterialItemHandler(e)},cellupCallBack:function(e){t.iteminfoTips.visible=!1}}),this.add(this.gameScroll);var a=new l.NineSliceButton(this.scene,-60*this.dpr,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,r.UIAtlasKey.commonKey,"red_btn",s.a.t("common.cancel"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(a),a.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#ffffff"}),a.on(String(l.ClickEvent.Tap),this.onCancelHandler,this);var h=new l.NineSliceButton(this.scene,60*this.dpr,a.y,92*this.dpr,34*this.dpr,r.UIAtlasKey.commonKey,"yellow_btn",s.a.t("business_street.select"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(h),h.on(String(l.ClickEvent.Tap),this.onSelectHandler,this),h.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#996600"}),this.iteminfoTips=new c.ItemInfoTips(this.scene,121*this.dpr,46*this.dpr,r.UIAtlasKey.commonKey,"tips_bg",this.dpr),this.iteminfoTips.visible=!1,this.add(this.iteminfoTips)},PicBusinessChoosePlanPanel.prototype.createGrideTable=function(t,e,i,n,o,r){var s=this,a={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:r,reuseCellContainer:!0,tableOY:5*this.dpr,zoom:this.zoom},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&(e=new m(s.scene,0,0,o,r,s.key,s.dpr,s.zoom)),e.setData({item:i}),e.setPlanData(i),s.curSelectData&&i===s.curSelectData?e.select=!0:e.select=!1,e}},h=new l.GameGridTable(this.scene,a);return h.layout(),h.on("cellTap",(function(t){t&&s.onGridSelectHandler(t)})),this.add(h),h},PicBusinessChoosePlanPanel.prototype.onGridSelectHandler=function(t){this.curSelectItem&&(this.curSelectItem.select=!1),t.select=!0;var e=t.palnData;this.gameScroll.clearItems();for(var i=0,n=e.requirements;i<n.length;i++){var o=n[i],r=new u(this.scene,0,0,36*this.dpr,36*this.dpr,this.key,this.dpr,this.zoom);r.setItemData(o),this.gameScroll.addItem(r)}this.gameScroll.Sort(),this.describleText.text=e.des,this.effectText.text=s.a.t("business_street.effect")+":"+e.buffDes,this.curSelectItem=t,this.curSelectData=e},PicBusinessChoosePlanPanel.prototype.onCancelHandler=function(){this.cancelHandler&&this.cancelHandler.run()},PicBusinessChoosePlanPanel.prototype.onSelectHandler=function(){this.selectHandler&&this.selectHandler.runWith(this.curSelectData.id),this.onCancelHandler()},PicBusinessChoosePlanPanel.prototype.onMaterialItemHandler=function(t){var e=t.itemData;this.iteminfoTips.setText(this.getDesText(e));var i=t.getWorldTransformMatrix(),n=this.gameScroll.getWorldTransformMatrix();this.iteminfoTips.x=i.tx-n.tx,this.iteminfoTips.y=this.gameScroll.y-20*this.dpr},PicBusinessChoosePlanPanel.prototype.getDesText=function(t){t||(t={sellingPrice:!0,tradable:!1});var e=t.name+"\n",i=s.a.t("common.source")+":";if(e+=(i="[stroke=#333333][color=#333333]"+(i+=t.source)+"[/color][/stroke]")+"\n",t.sellingPrice){var n=s.a.t("common.sold");e+=(n="[stroke=#333333][color=#333333]"+(n+=a.f.getName(t.sellingPrice.coinType)+" x "+t.sellingPrice.price)+"[/color][/stroke]")+"\n"}if(!t.tradable){var o=s.a.t("furni_unlock.notrading");e+=o="[stroke=#333333][color=#ff0000]*"+o+"[/color][/stroke]"}return e},PicBusinessChoosePlanPanel}(Phaser.GameObjects.Container),m=function(t){function PlanTypeItem(e,i,n,r,s,a,c,l){var p=t.call(this,e,i,n)||this;return p.isSelect=!1,p.dpr=c,p.key=a,p.setSize(r,s),p.bg=p.scene.make.image({key:a,frame:"store_bg"}),p.add(p.bg),p.storeIcon=new h.DynamicImage(p.scene,0,0),p.storeIcon.setTexture(p.key,"restaurant_icon"),p.storeIcon.setPosition(0,-8*c),p.add(p.storeIcon),p.storeName=p.scene.make.text({x:0,y:p.storeIcon.y+.5*p.storeIcon.height+10*c,text:"Restaurant",style:{color:"#0",fontSize:10*c,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5),p.add(p.storeName),p}return p(PlanTypeItem,t),PlanTypeItem.prototype.setPlanData=function(t){var e=this;this.palnData=t;var i=t.icon;""===i&&t.requirements&&t.requirements.length>0&&(i=t.requirements[0].display.texturePath);var n=a.i.getOsdRes(i);this.storeIcon.load(n,this,(function(){e.storeIcon.displayWidth=46*e.dpr,e.storeIcon.scaleY=e.storeIcon.scaleX})),this.storeName.text=t.name},Object.defineProperty(PlanTypeItem.prototype,"select",{get:function(){return this.isSelect},set:function(t){this.isSelect=t;var e=t?"store_bg_click":"store_bg";this.bg.setFrame(e)},enumerable:!1,configurable:!0}),PlanTypeItem}(Phaser.GameObjects.Container),u=function(t){function MaterialItem(e,i,n,r,s,a,c,p){var d=t.call(this,e,i,n)||this;d.dpr=c,d.key=a,d.setSize(r,s);var m=d.scene.make.image({key:d.key,frame:"item_bg"});return d.add(m),d.itemIcon=new h.DynamicImage(d.scene,0,0),d.add(d.itemIcon),d.countText=new l.BBCodeText(d.scene,.5*m.width,.5*m.height).setOrigin(1,.5).setFontSize(12*c).setFontFamily(o.a.DEFULT_FONT),d.add(d.countText),d}return p(MaterialItem,t),MaterialItem.prototype.setItemData=function(t){var e=this;this.itemData=t;var i=a.i.getOsdRes(t.display.texturePath);this.itemIcon.load(i,this,(function(){e.itemIcon.displayWidth=29*e.dpr,e.itemIcon.scaleY=e.itemIcon.scaleX})),this.countText.text=this.getCountText(t.count,t.neededCount)},MaterialItem.prototype.getCountText=function(t,e){var i=t>=e?"#0054FF":"#FF2B2B";return"[stroke="+i+"][color="+i+"]"+t+"[/color][/stroke]"+("[stroke=#2D2D2D][color=#2D2D2D]/"+e+"[/color][/stroke]")},MaterialItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessMarketingPlan",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicBusinessMarketingPlan(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicBusinessMarketingPlan,t),PicBusinessMarketingPlan.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_MARKET_PLAN,this.onEquiped_MARKET_PLAN),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_MARKET_PLAN_MODELS_BY_TYPE,this.onMARKET_PLAN_MODELS_BY_TYPE))},PicBusinessMarketingPlan.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicBusinessMarketingPlan.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicBusinessMarketingPlan.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicBusinessMarketingPlan.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicBusinessMarketingPlan.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicBusinessMarketingPlan.prototype.query_Equiped_MARKET_PLAN=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_MARKET_PLAN);e.content.roomId=t,this.connection.send(e)},PicBusinessMarketingPlan.prototype.query_MARKET_PLAN_MODELS_BY_TYPE=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_MARKET_PLAN_MODELS_BY_TYPE);e.content.marketPlanType=t,this.connection.send(e)},PicBusinessMarketingPlan.prototype.query_SELECT_MARKET_PLAN=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_SELECT_MARKET_PLAN),n=i.content;n.marketPlanId=e,n.roomId=t,this.connection.send(i)},PicBusinessMarketingPlan.prototype.onEquiped_MARKET_PLAN=function(t){var e=t.content;this.mEvent.emit("onequipedplan",e)},PicBusinessMarketingPlan.prototype.onMARKET_PLAN_MODELS_BY_TYPE=function(t){var e=t.content;this.mEvent.emit("onplanmodels",e)},PicBusinessMarketingPlan}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e);var n,o=i(112),r=i(115),s=i(120),a=i(168),h=i(284),c=i(281),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function PicBusinessMarketingPlanPanel(e,i){var n=t.call(this,e,i)||this;return n.key="c_street_1",n.key2="c_street_2",n}return l(PicBusinessMarketingPlanPanel,t),PicBusinessMarketingPlanPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,e,i),this.setSize(n,o),this.mBackGround.clear(),this.mBackGround.fillStyle(0,.66),this.mBackGround.fillRect(0,0,n,o)},PicBusinessMarketingPlanPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},PicBusinessMarketingPlanPanel.prototype.addListen=function(){this.mInitialized},PicBusinessMarketingPlanPanel.prototype.removeListen=function(){this.mInitialized},PicBusinessMarketingPlanPanel.prototype.preload=function(){this.addAtlas(this.key,"c_street_1/c_street_1.png","c_street_1/c_street_1.json"),this.addAtlas(this.key2,"c_street_2/c_street_2.png","c_street_2/c_street_2.json"),this.addAtlas(r.UIAtlasKey.commonKey,r.UIAtlasName.commonUrl+".png",r.UIAtlasName.commonUrl+".json"),this.addAtlas(r.UIAtlasKey.common2Key,r.UIAtlasName.common2Url+".png",r.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicBusinessMarketingPlanPanel.prototype.init=function(){var e=this.scale,i=this.scaleWidth,n=this.scaleHeight;this.mBackGround=this.scene.make.graphics(void 0,!1),this.mBackGround.clear(),this.mBackGround.fillStyle(7004927,0),this.mBackGround.fillRect(0,0,i*e,n*e),this.mBackGround.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.add(this.mBackGround);var o=90*this.dpr,r=74*this.dpr,h=295*this.dpr,c=n-o-r,l=o+.5*c,p=.5*i;this.content=new a.PicBusinessContentPanel(this.scene,p,l,h,c,this.dpr,this.key,this.key2),this.content.setCloseHandler(new s.a(this,this.OnCloseHandler)),this.add(this.content),this.resize(i,n),t.prototype.init.call(this),this.openPlanPanel()},PicBusinessMarketingPlanPanel.prototype.setPlanModels=function(t){this.picChoosePlanPanel.setPlanData(t.marketPlan)},PicBusinessMarketingPlanPanel.prototype.setEquipedPlan=function(t){this.picBusinessPlanPanel.setPlanData(t)},PicBusinessMarketingPlanPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},PicBusinessMarketingPlanPanel.prototype.openPlanPanel=function(){this.showMarketingPlanPanel(),this.picBusinessPlanPanel.setWorld(this.mWorld),this.emit("querymarketplan")},PicBusinessMarketingPlanPanel.prototype.openChoosePlanPanel=function(){this.showChoosePlanPanel(),this.picChoosePlanPanel.resetMask()},PicBusinessMarketingPlanPanel.prototype.showMarketingPlanPanel=function(){var t=this,e=90*this.dpr,i=74*this.dpr;if(this.setContentSize(e,i),!this.picBusinessPlanPanel){var n=this.content.width,o=this.content.height-50*this.dpr;this.picBusinessPlanPanel=new h.PicBusinessPlanPanel(this.scene,0,0,n,o,this.dpr,this.scale,this.key),this.picBusinessPlanPanel.setHandler(new s.a(this,(function(){t.hideMarketingPlanPanel(),t.OnCloseHandler()})),new s.a(this,(function(e){t.hideMarketingPlanPanel(),t.openChoosePlanPanel(),t.emit("queryplanmodels",e)})))}this.content.add(this.picBusinessPlanPanel),this.picBusinessPlanPanel.resetMask()},PicBusinessMarketingPlanPanel.prototype.hideMarketingPlanPanel=function(){this.content.remove(this.picBusinessPlanPanel)},PicBusinessMarketingPlanPanel.prototype.showChoosePlanPanel=function(){var t=this,e=this.scaleWidth,i=this.scaleHeight,n=295*this.dpr,o=320*this.dpr,r=.5*i,a=.5*e;if(this.content.setPosition(a,r),this.content.setContentSize(n,o),!this.picChoosePlanPanel){var h=this.content.width,l=this.content.height-50*this.dpr;this.picChoosePlanPanel=new c.PicBusinessChoosePlanPanel(this.scene,0,0,h,l,this.dpr,this.scale,this.key),this.picChoosePlanPanel.setHandler(new s.a(this,(function(){t.hideChoosePlanPanel(),t.openPlanPanel()})),new s.a(this,(function(e){t.emit("queryselectplan",e)})))}this.content.add(this.picChoosePlanPanel),this.picBusinessPlanPanel.resetMask()},PicBusinessMarketingPlanPanel.prototype.hideChoosePlanPanel=function(){this.content.remove(this.picChoosePlanPanel)},PicBusinessMarketingPlanPanel.prototype.setContentSize=function(t,e){var i=this.scaleWidth,n=this.scaleHeight,o=295*this.dpr,r=n-t-e,s=t+.5*r,a=.5*i;this.content.setPosition(a,s),this.content.setContentSize(o,r)},PicBusinessMarketingPlanPanel.prototype.OnCloseHandler=function(){this.emit("hide")},PicBusinessMarketingPlanPanel}(o.BasePanel);e.default=p},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessPlanPanel",(function(){return d}));var n,o=i(113),r=i(120),s=i(115),a=i(114),h=i(116),c=i(109),l=i(111),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function PicBusinessPlanPanel(e,i,n,o,r,s,a,h){var c=t.call(this,e,i,n)||this;return c.dpr=s,c.key=h,c.zoom=a,c.setSize(o,r),c.create(),c}return p(PicBusinessPlanPanel,t),PicBusinessPlanPanel.prototype.setWorld=function(t){this.world=t},PicBusinessPlanPanel.prototype.setPlanData=function(t){var e=t.marketPlanPairs,i=""!==t.industryBackground?t.industryBackground:"market_b";this.topbg.setFrame(i),this.describleText.text=t.industryDes,this.planBuffText.text=t.industryBuffDes,this.gridtable.setItems(e)},PicBusinessPlanPanel.prototype.setHandler=function(t,e){this.cancelHandler=t,this.addPlanHandler=e},PicBusinessPlanPanel.prototype.resetMask=function(){this.gridtable.resetMask()},PicBusinessPlanPanel.prototype.create=function(){var t=.5*-this.height,e=253*this.dpr,i=73*this.dpr;this.topbg=new c.NineSlicePatch(this.scene,0,0,e,i,this.key,"market_b",{left:6*this.dpr,top:0*this.dpr,right:6*this.dpr,bottom:0*this.dpr}),this.topbg.y=t+.5*i+10*this.dpr,this.add(this.topbg),this.describleText=this.scene.make.text({x:0,y:this.topbg.y-15*this.dpr,text:"Your store is now at a advantage",style:{fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#ffffff"}}).setOrigin(.5),this.describleText.setWordWrapWidth(200*this.dpr),this.add(this.describleText),this.planBuffText=new c.BBCodeText(this.scene,0,this.topbg.y+15*this.dpr,"Store prosperity -10%",{fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#ffffff"}).setOrigin(.5),this.add(this.planBuffText),this.planBuffText.setWrapWidth(200*this.dpr);var n=new c.NineSlicePatch(this.scene,0,0,135*this.dpr,17*this.dpr,this.key,"subtitle",{left:13*this.dpr,top:0*this.dpr,right:13*this.dpr,bottom:0*this.dpr});n.x=0,n.y=this.topbg.y+.5*this.topbg.height+40*this.dpr,this.add(n);var r=this.scene.make.text({x:0,y:n.y,text:a.a.t("business_street.marketing_plan"),style:{fontSize:11*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#0"}}).setOrigin(.5);this.add(r),n.resize(135*this.dpr,17*this.dpr);var h=this.width-24*this.dpr,l=this.height-200*this.dpr,p=n.y+.5*n.height+20*this.dpr+.5*l;this.gridtable=this.createGrideTable(0,p,h,l,253*this.dpr,63*this.dpr);var d=new c.NineSliceButton(this.scene,0,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,s.UIAtlasKey.commonKey,"red_btn",a.a.t("common.cancel"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(d),d.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#ffffff"}),d.on(String(c.ClickEvent.Tap),this.onCancelHandler,this)},PicBusinessPlanPanel.prototype.createGrideTable=function(t,e,i,n,o,s){var a=this,h={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:s,reuseCellContainer:!0,tableOY:5*this.dpr,zoom:this.zoom,cellPadX:8*this.dpr},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&(e=new m(a.scene,0,0,o,s,a.key,a.dpr,a.zoom)).setHandler(new r.a(a,a.onAddPlanHandler)),e.setData({item:i}),e.setPlanData(i,a.world.clock.unixTime),e}},l=new c.GameGridTable(this.scene,h);return l.layout(),l.on("cellTap",(function(t){t&&a.onGridSelectHandler(t)})),this.add(l),l},PicBusinessPlanPanel.prototype.onGridSelectHandler=function(t){},PicBusinessPlanPanel.prototype.onAddPlanHandler=function(t){this.addPlanHandler&&this.addPlanHandler.runWith(t.marketPlanType)},PicBusinessPlanPanel.prototype.onCancelHandler=function(){this.cancelHandler&&this.cancelHandler.run()},PicBusinessPlanPanel}(Phaser.GameObjects.Container),m=function(t){function MarketingPlanItem(e,i,n,r,s,l,p,d){var m=t.call(this,e,i,n)||this;m.dpr=p,m.key=l,m.setSize(r,s),m.bg=new c.NineSlicePatch(m.scene,0,0,r,53*p,m.key,"no_plan_bg",{left:6*m.dpr,top:0*m.dpr,right:6*m.dpr,bottom:0*m.dpr}),m.add(m.bg);var u=m.scene.make.image({key:m.key,frame:"plan_icon_bg"});u.x=.5*-m.width+.5*u.width+5*p,m.add(u),m.planIcon=new h.DynamicImage(m.scene,0,0),m.planIcon.setPosition(u.x,0),m.add(m.planIcon),m.planText=m.scene.make.text({x:u.x+.5*u.width+10*p,y:0,style:{color:"#0",fontSize:10*p,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0,.5),m.planText.text=a.a.t("business_street.plan_title"),m.add(m.planText),m.planName=m.scene.make.text({x:u.x+.5*u.width+10*p,y:.5*-m.bg.height+4*p,text:"Plane Name",style:{color:"#ffffff",fontSize:12*p,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),m.add(m.planName),m.planAtt=new c.BBCodeText(m.scene,m.planName.x,m.planName.y+m.planName.height+4*p,"Competitiveness +10%,  Prosperity +10%",{color:"#0",fontSize:10*m.dpr,fontFamily:o.a.DEFULT_FONT}).setOrigin(0),m.add(m.planAtt);var f=159*p,y=8*p,g={x:0,y:0,color:"#ffffff",fontSize:9*p,fontFamily:o.a.DEFULT_FONT,halign:.5,valign:.5};return m.progress=new c.ProgressBar(m.scene,{x:5*p,y:m.planAtt.y+m.planAtt.height+4*p+.5*y,width:f,height:y,background:{x:0,y:0,width:f,height:y,config:{top:1*p,left:5*p,right:5*p,bottom:1*p},key:l,frame:"progress_bar_bg"},bar:{x:0,y:0,width:f,height:y-p,config:{top:1*p,left:5*p,right:5*p,bottom:1*p},key:l,frame:"progress_bar_g"},dpr:p,textConfig:g}),m.progress.text.setOrigin(.5),m.add(m.progress),m.addBtn=new c.Button(m.scene,m.key,"add_plan","add_plan"),m.addBtn.x=.5*m.width-.5*m.addBtn.width-20*p,m.addBtn.on(String(c.ClickEvent.Tap),m.onAddBtnHandler,m),m.add(m.addBtn),m}return p(MarketingPlanItem,t),MarketingPlanItem.prototype.setPlanData=function(t,e){var i=this;if(t.marketPlan){this.planName.visible=!0,this.planAtt.visible=!0,this.progress.visible=!0,this.planText.visible=!1,this.bg.setFrame("has_plan_bg"),this.remove(this.addBtn);var n="progress_bar_r",o=Math.floor(t.marketPlan.endTime-e/1e3),r=Math.floor(o/t.marketPlan.totalTime*100);r>30&&r<=50?n="progress_bar_y":r>50&&(n="progress_bar_g"),this.progress.bar.setFrame(n),this.progress.setProgress(o,t.marketPlan.totalTime),this.progress.setText(this.getDataFormat(1e3*o)),this.planName.text=t.marketPlan.name,this.planAtt.text=t.marketPlan.buffDes;var s=""!==t.marketPlan.icon?t.marketPlan.icon:t.marketPlan.requirements[0].display.texturePath;(""===s||!s)&&t.marketPlan.requirements&&t.marketPlan.requirements.length>0&&(s=t.marketPlan.requirements[0].display.texturePath);var a=l.i.getOsdRes(s);this.planIcon.load(a,this,(function(){i.planIcon.displayWidth=30*i.dpr,i.planIcon.scaleY=i.planIcon.scaleX}))}else this.planName.visible=!1,this.planAtt.visible=!1,this.progress.visible=!1,this.add(this.addBtn),this.bg.setFrame("no_plan_bg");this.planData=t},MarketingPlanItem.prototype.setHandler=function(t){this.addBtnHandler=t},MarketingPlanItem.prototype.onAddBtnHandler=function(){this.addBtnHandler&&this.addBtnHandler.runWith(this.planData)},MarketingPlanItem.prototype.getDataFormat=function(t){var e=Math.floor(t/864e5),i=Math.floor(t/36e5)%24,n=Math.floor(t/6e4)%60,o=Math.floor(t/1e3)%60,r="";return e>0?(r=e+"  "+a.a.t("business_street.day"),(i>0||n>0)&&(r+=this.stringFormat(i)+":"+this.stringFormat(n))):r=i>0?n>0?this.stringFormat(i)+":"+this.stringFormat(n):this.stringFormat(i)+" "+a.a.t("business_street.hour"):n>0?this.stringFormat(n)+" "+a.a.t("business_street.minute"):this.stringFormat(o)+" "+a.a.t("business_street.second"),r},MarketingPlanItem.prototype.stringFormat=function(t){var e=t+"";return e.length<=1&&(e="0"+e),e},MarketingPlanItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessHistoryPanel",(function(){return l}));var n,o=i(113),r=i(116),s=i(115),a=i(114),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicBusinessHistoryPanel(e,i,n,o,r,s,a,h,c){var l=t.call(this,e,i,n)||this;return l.dpr=s,l.key=h,l.key2=c,l.zoom=a,l.setSize(o,r),l.create(),l}return c(PicBusinessHistoryPanel,t),PicBusinessHistoryPanel.prototype.setHistoryeData=function(t){this.gridtable.setItems(t),this.titleText.text=a.a.t("business_street.history_title",{name:t.length})},PicBusinessHistoryPanel.prototype.setHandler=function(t){this.backHandler=t},PicBusinessHistoryPanel.prototype.resetMask=function(){this.gridtable.resetMask()},PicBusinessHistoryPanel.prototype.create=function(){var t=.5*-this.height,e=.5*-this.width,i="bold "+13*this.dpr+"px "+o.a.BOLD_FONT,n=this.scene.make.text({x:e+30*this.dpr,y:t+6*this.dpr,text:a.a.t("business_street.history_title"),style:{font:i,bold:!0,color:"#FFC51A"}}).setOrigin(0,.5);n.setStroke("#553100",2*this.dpr),this.add(n),this.titleText=n;var r=this.width,c=this.height-80*this.dpr,l=t+33*this.dpr+.5*c;this.gridtable=this.createGrideTable(0,l,r,c,256*this.dpr,50*this.dpr);var p=new h.NineSliceButton(this.scene,0,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,s.UIAtlasKey.commonKey,"red_btn",a.a.t("business_street.back"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(p),p.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#ffffff"}),p.on(String(h.ClickEvent.Tap),this.onBackHandler,this)},PicBusinessHistoryPanel.prototype.createGrideTable=function(t,e,i,n,o,r){var s=this,a={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:r,reuseCellContainer:!0,tableOX:19*this.dpr,zoom:this.zoom},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&(e=new p(s.scene,0,0,o,r,s.key,s.key2,s.dpr,s.zoom),c.add(e)),e.setData({item:i}),e.setStoreData(i),e}},c=new h.GameGridTable(this.scene,a);return c.layout(),this.add(c),c},PicBusinessHistoryPanel.prototype.onBackHandler=function(){this.backHandler&&this.backHandler.run()},PicBusinessHistoryPanel}(Phaser.GameObjects.Container),p=function(t){function PicHistoryItem(e,i,n,s,a,c,l,p,d){var m=t.call(this,e,i,n)||this;m.dpr=p,m.key=c,m.key2=l,m.setSize(s,a);var u=.5*-m.width,f=.5*-m.height;m.bg=new h.NineSlicePatch(m.scene,0,0,s,45*p,m.key,"resturant_bg",{left:4*m.dpr,top:9*m.dpr,right:4*m.dpr,bottom:9*m.dpr}),m.add(m.bg);var y=m.scene.make.image({key:l,frame:"icon_bg_s"});y.setPosition(u+.5*y.width+3*p,0),m.add(y),m.storeIcon=new r.DynamicImage(m.scene,y.x,0),m.add(m.storeIcon);var g=y.x+.5*y.width+10*p;return m.storeName=m.scene.make.text({x:g,y:f+10*p,text:"Restaurant",style:{color:"#FFE11A",fontSize:12*p,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),m.add(m.storeName),m.playerName=m.scene.make.text({x:g,y:m.storeName.y+.5*m.storeName.height+10*p,text:"Savings: 13000",style:{color:"#ffffff",fontSize:11*p,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),m.add(m.playerName),m.industryIcon=m.scene.make.image({key:m.key2,frame:"entertainment_tag_s"}),m.industryIcon.x=.5*m.width-.5*m.industryIcon.width,m.add(m.industryIcon),m}return c(PicHistoryItem,t),PicHistoryItem.prototype.setStoreData=function(t){this.storeData=t,this.bg.setTexture(this.key2,t.industry+"_bg"),this.storeName.text=t.name,this.playerName.text=t.ownerName,this.storeIcon.setTexture(this.key2,t.storeType+"_icon_s"),this.industryIcon.setFrame(t.industry+"_tag_s")},PicHistoryItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessMyStreetPanel",(function(){return p}));var n,o=i(113),r=i(120),s=i(116),a=i(115),h=i(114),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function PicBusinessMyStreetPanel(e,i,n,o,r,s,a,h){var c=t.call(this,e,i,n)||this;return c.isCanNewCreate=!1,c.dpr=s,c.key=h,c.zoom=a,c.setSize(o,r),c.create(),c}return l(PicBusinessMyStreetPanel,t),PicBusinessMyStreetPanel.prototype.setMyStoreData=function(t){var e=t.storeList;this.storelimitText.text=h.a.t("business_street.store_limit")+":"+e.length+"/"+t.storeLimit,this.gridtable.setItems(e),this.isCanNewCreate=e.length<t.storeLimit},PicBusinessMyStreetPanel.prototype.setHandler=function(t,e,i,n){this.takeAllHandler=t,this.goOutHandler=e,this.newStoreHandler=i,this.enterRoomHandler=n},PicBusinessMyStreetPanel.prototype.resetMask=function(){this.gridtable.resetMask()},PicBusinessMyStreetPanel.prototype.create=function(){var t=.5*-this.height,e=.5*-this.width,i=this.scene.make.image({key:this.key,frame:"store_icon"});i.x=e+30*this.dpr,i.y=t+6*this.dpr,this.add(i);var n="bold "+13*this.dpr+"px "+o.a.BOLD_FONT,r=i.x+.5*i.width+10*this.dpr,s=this.scene.make.text({x:r,y:i.y,text:h.a.t("business_street.my_store"),style:{font:n,bold:!0,color:"#FFC51A"}}).setOrigin(0,.5);s.setStroke("#553100",2*this.dpr),this.add(s);var l=this.width,p=this.height-68*this.dpr,d=t+28*this.dpr+.5*p;this.gridtable=this.createGrideTable(0,d,l,p,256*this.dpr,87*this.dpr),this.newStoreBtn=new c.Button(this.scene,this.key,"new_store","new_store");var m=-e-.5*this.newStoreBtn.width-20*this.dpr;this.newStoreBtn.setPosition(m,t+6*this.dpr),this.newStoreBtn.on(String(c.ClickEvent.Tap),this.onNewStoreHandler,this),this.add(this.newStoreBtn),this.storelimitText=this.scene.make.text({x:m-.5*this.newStoreBtn.width-10*this.dpr,y:t+5*this.dpr,text:"store limit",style:{color:"#0",fontSize:12*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(1,.5),this.add(this.storelimitText),this.storeCountText=this.scene.make.text({x:m+.5*this.newStoreBtn.width+20*this.dpr,y:t,text:"",style:{font:n,bold:!0,color:"#FFC51A"}}).setOrigin(1,0),this.add(this.storeCountText);var u=new c.NineSliceButton(this.scene,-60*this.dpr,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,a.UIAtlasKey.commonKey,"red_btn",h.a.t("business_street.takeall"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(u),u.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#ffffff"}),u.on(String(c.ClickEvent.Tap),this.onTalkAllHandler,this);var f=new c.NineSliceButton(this.scene,60*this.dpr,u.y,92*this.dpr,34*this.dpr,a.UIAtlasKey.commonKey,"yellow_btn",h.a.t("business_street.goout"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(f),f.on(String(c.ClickEvent.Tap),this.onGoOutHandler,this),f.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#996600"})},PicBusinessMyStreetPanel.prototype.createGrideTable=function(t,e,i,n,o,s){var a=this,h={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:s,reuseCellContainer:!0,tableOX:19*this.dpr,zoom:this.zoom},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&((e=new d(a.scene,0,0,o,s,a.key,a.dpr,a.zoom)).setHandler(new r.a(a,a.onEnterHandler)),l.add(e)),e.setData({item:i}),e.setStoreData(i),e}},l=new c.GameGridTable(this.scene,h);return l.layout(),this.add(l),l},PicBusinessMyStreetPanel.prototype.onEnterHandler=function(t){this.enterRoomHandler&&this.enterRoomHandler.runWith(t.roomId)},PicBusinessMyStreetPanel.prototype.onTalkAllHandler=function(){this.takeAllHandler&&this.takeAllHandler.run()},PicBusinessMyStreetPanel.prototype.onGoOutHandler=function(){this.goOutHandler&&this.goOutHandler.run()},PicBusinessMyStreetPanel.prototype.onNewStoreHandler=function(){this.isCanNewCreate&&this.newStoreHandler&&this.newStoreHandler.run()},PicBusinessMyStreetPanel}(Phaser.GameObjects.Container),d=function(t){function MyStoreItem(e,i,n,r,l,p,d,m){var u=t.call(this,e,i,n)||this;u.dpr=d,u.key=p,u.setSize(r,l);var f=.5*-u.width,y=.5*-u.height;u.bg=new c.NineSlicePatch(u.scene,0,0,r,80*d,u.key,"resturant_bg",{left:4*u.dpr,top:9*u.dpr,right:4*u.dpr,bottom:9*u.dpr}),u.add(u.bg);var g=u.scene.make.image({key:p,frame:"store_icon_bg"});g.setPosition(f+.5*g.width+10*d,0),u.add(g),u.storeIcon=new s.DynamicImage(u.scene,g.x,0),u.add(u.storeIcon);var _=g.x+.5*g.width+10*d;u.storeName=u.scene.make.text({x:_,y:y+5*d,text:"Restaurant",style:{color:"#FFE11A",fontSize:12*d,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),u.add(u.storeName),u.lvimgCon=u.scene.make.container(void 0,!1),u.lvimgCon.height=14*d,u.lvimgCon.setPosition(_+6*d,u.storeName.y+u.storeName.height+.5*u.lvimgCon.height+2*d),u.add(u.lvimgCon),u.savings=u.scene.make.text({x:_,y:u.lvimgCon.y+.5*u.lvimgCon.height+2*d,text:"Savings: 13000",style:{color:"#ffffff",fontSize:10*d,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),u.add(u.savings),u.competitiveness=u.scene.make.text({x:_,y:u.savings.y+u.savings.height+2*d,text:"Competitiveness: 13000",style:{color:"#ffffff",fontSize:10*d,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),u.add(u.competitiveness),u.turnover=u.scene.make.text({x:_,y:u.competitiveness.y+u.competitiveness.height+2*d,text:"Prosperity: +13000 / Day",style:{color:"#ffffff",fontSize:10*d,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),u.add(u.turnover),u.industryIcon=u.scene.make.image({key:u.key,frame:"entertainment_tag"}),u.industryIcon.x=.5*u.width-.5*u.industryIcon.width,u.add(u.industryIcon);var P=new c.NineSliceButton(e,-f,0,48*d,27*d,a.UIAtlasKey.commonKey,"yellow_btn_normal_s",h.a.t("business_street.enter"),u.dpr,m,{left:10*u.dpr,top:10*u.dpr,right:10*u.dpr,bottom:10*u.dpr});return P.setTextStyle({fontSize:10*d,fontFamily:o.a.BOLD_FONT,color:"#996600"}),P.x=-f-.5*P.width-10*d,P.on(String(c.ClickEvent.Tap),u.onEnterHandler,u),u.add(P),u}return l(MyStoreItem,t),MyStoreItem.prototype.setStoreData=function(t){var e=t.industry,i=t.storeType;this.bg.setFrame(e+"_bg"),this.storeIcon.setTexture(this.key,i+"_icon"),this.storeName.text=t.name,this.lvimgCon.removeAll(!0),this.setImageInfo(a.UIAtlasKey.common2Key,this.getLevelImgs(t.roomLevel.level)),this.savings.text=h.a.t("business_street.savings")+":"+t.savings,this.competitiveness.text=h.a.t("business_street.competitiveness")+":"+t.competitiveness,this.turnover.text=h.a.t("business_street.turnover")+":"+t.turnover,this.industryIcon.setFrame(e+"_tag"),this.storeData=t},MyStoreItem.prototype.setHandler=function(t){this.enterHandler=t},MyStoreItem.prototype.setImageInfo=function(t,e){for(var i=0,n=15*this.dpr,o=0,r=e;o<r.length;o++){var s=r[o],a=this.scene.make.image({key:t,frame:s});a.x=i,i+=.5*a.width+n,this.lvimgCon.add(a)}},MyStoreItem.prototype.onEnterHandler=function(){this.enterHandler&&this.enterHandler.runWith(this.storeData)},MyStoreItem.prototype.getLevelImgs=function(t){t=t||0;for(var e=[],i=Math.floor(t/Math.pow(4,3)),n=t%Math.pow(4,3),o=Math.floor(n/Math.pow(4,2)),r=n%Math.pow(4,2),s=Math.floor(r/Math.pow(4,1)),a=r%Math.pow(4,1),h=0;h<i;h++)e.push("bear");for(h=0;h<o;h++)e.push("sun");for(h=0;h<s;h++)e.push("moon");for(h=0;h<a;h++)e.push("star");return 0===t&&e.push("star"),e},MyStoreItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessRankRewardPanel",(function(){return p}));var n,o=i(113),r=i(116),s=i(115),a=i(114),h=i(111),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function PicBusinessRankRewardPanel(e,i,n,o,r,s,a,h,c){var l=t.call(this,e,i,n)||this;return l.dpr=s,l.key=h,l.key2=c,l.zoom=a,l.setSize(o,r),l.create(),l}return l(PicBusinessRankRewardPanel,t),PicBusinessRankRewardPanel.prototype.setRankRewardData=function(t){this.gridtable.setItems(t)},PicBusinessRankRewardPanel.prototype.setHandler=function(t){this.backHandler=t},PicBusinessRankRewardPanel.prototype.resetMask=function(){this.gridtable.resetMask()},PicBusinessRankRewardPanel.prototype.create=function(){var t=.5*-this.height,e=this.width-20*this.dpr,i=this.height-70*this.dpr,n=t+23*this.dpr+.5*i;this.gridtable=this.createGrideTable(-5*this.dpr,n,e,i,256*this.dpr,80*this.dpr);var r=new c.NineSliceButton(this.scene,0,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,s.UIAtlasKey.commonKey,"red_btn",a.a.t("business_street.back"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(r),r.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#ffffff"}),r.on(String(c.ClickEvent.Tap),this.onBackHandler,this)},PicBusinessRankRewardPanel.prototype.createGrideTable=function(t,e,i,n,o,r){var s=this,a={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:r,reuseCellContainer:!0,tableOX:19*this.dpr,zoom:this.zoom},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&(e=new d(s.scene,0,0,o,r,s.key,s.key2,s.dpr,s.zoom),h.add(e)),e.setData({item:i}),e.setRankRewardData(i),e}},h=new c.GameGridTable(this.scene,a);return h.layout(),this.add(h),h},PicBusinessRankRewardPanel.prototype.onBackHandler=function(){this.backHandler&&this.backHandler.run()},PicBusinessRankRewardPanel}(Phaser.GameObjects.Container),d=function(t){function PicRankRewardItem(e,i,n,r,s,a,h,c,l){var p=t.call(this,e,i,n)||this;p.rewardItems=[],p.dpr=c,p.zoom=l,p.key=a,p.key2=h,p.setSize(r,s);var d=p.scene.make.image({key:p.key2,frame:"reward_bg"});p.add(d),p.rankIcon=p.scene.make.image({key:h,frame:"1"}),p.rankIcon.x=.5*-r+.5*p.rankIcon.width+10*c,p.add(p.rankIcon);var m=p.rankIcon.x;return p.rankText=p.scene.make.text({x:m,y:0,text:"3",style:{color:"#0",bold:!0,fontSize:12*c,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5),p.add(p.rankText),p}return l(PicRankRewardItem,t),PicRankRewardItem.prototype.setRankRewardData=function(t){if(this.rewardData!==t){t.start===t.end?(this.rankIcon.visible=!0,this.rankText.visible=!1,this.rankIcon.setFrame(t.start+"")):(this.rankIcon.visible=!1,this.rankText.visible=!0,this.rankText.text=t.start+"~"+t.end);for(var e=0,i=this.rewardItems;e<i.length;e++){(o=i[e]).visible=!1}for(var n=0;n<t.rewards.length;n++){var o=void 0;n<this.rewardItems.length?o=this.rewardItems[n]:(o=new m(this.scene,0,0,50*this.dpr,50*this.dpr,this.key2,this.dpr,this.zoom),this.add(o),this.rewardItems.push(o)),o.visible=!0,o.setRewardData(t.rewards[n])}this.Sort(),this.rewardData=t}},PicRankRewardItem.prototype.Sort=function(){for(var t=10*this.dpr,e=-50*this.dpr,i=0,n=this.rewardItems;i<n.length;i++){var o=n[i];o.x=o.width*o.originX+e,e+=o.width+t}},PicRankRewardItem}(Phaser.GameObjects.Container),m=function(t){function RewardItem(e,i,n,s,a,h,c,l){var p=t.call(this,e,i,n)||this;p.dpr=c,p.key2=h,p.setSize(s,a);var d=p.scene.make.image({key:p.key2,frame:"icon_bg_m"});return p.add(d),p.itemIcon=new r.DynamicImage(p.scene,0,0),p.add(p.itemIcon),p.countText=p.scene.make.text({x:.5*d.width,y:.5*d.height,text:"4~10",style:{color:"#0",fontSize:12*c,fontFamily:o.a.DEFULT_FONT}}).setOrigin(1,.5),p.add(p.countText),p}return l(RewardItem,t),RewardItem.prototype.setRewardData=function(t){var e=this,i=h.i.getOsdRes(t.display.texturePath);this.itemIcon.load(i,this,(function(){e.itemIcon.displayWidth=43*e.dpr,e.itemIcon.scaleY=e.itemIcon.scaleX})),this.countText.text=t.count+""},RewardItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessRankingDetailPanel",(function(){return l}));var n,o=i(113),r=i(116),s=i(115),a=i(114),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicBusinessRankingDetailPanel(e,i,n,o,r,s,a,h,c){var l=t.call(this,e,i,n)||this;return l.dpr=s,l.key=h,l.key2=c,l.zoom=a,l.setSize(o,r),l.create(),l}return c(PicBusinessRankingDetailPanel,t),PicBusinessRankingDetailPanel.prototype.setRankingDetailData=function(t){this.content=t;var e=t.stores;if(this.gridtable.setItems(e),t.playerStore){this.myRankItem.visible=!0,this.myitembg.visible=!0,this.myRankItem.setDetailData(t.playerStore);var i=.5*-this.height,n=this.width,o=this.height-125*this.dpr,r=i+30*this.dpr+.5*o;this.gridtable.y=r,this.gridtable.setSize(n,o)}else{this.myitembg.visible=!1,this.myRankItem.visible=!1;i=.5*-this.height,n=this.width,o=this.height-100*this.dpr,r=i+30*this.dpr+.5*o;this.gridtable.y=r,this.gridtable.setSize(n,o)}},PicBusinessRankingDetailPanel.prototype.setHandler=function(t,e){this.backHandler=t,this.rankRewardHandler=e},PicBusinessRankingDetailPanel.prototype.resetMask=function(){this.gridtable.resetMask()},PicBusinessRankingDetailPanel.prototype.create=function(){var t=.5*-this.height,e=.5*-this.width,i="bold "+13*this.dpr+"px "+o.a.BOLD_FONT;this.timeText=this.scene.make.text({x:0,y:t+6*this.dpr,text:a.a.t("6 DAY 23:24:16"),style:{font:i,bold:!0,color:"#D9270F"}}).setOrigin(.5),this.timeText.setStroke("#553100",2*this.dpr),this.add(this.timeText),this.timeText.visible=!1;var n=new h.NineSliceButton(this.scene,0,this.timeText.y,60*this.dpr,26*this.dpr,s.UIAtlasKey.commonKey,"yellow_btn_normal_s",a.a.t("business_street.rank_reward"),this.dpr,this.zoom,{left:10*this.dpr,top:6*this.dpr,right:10*this.dpr,bottom:6*this.dpr});n.x=-e-.5*n.width-30*this.dpr,n.setTextStyle({fontSize:10*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#996600"}),n.on(String(h.ClickEvent.Tap),this.onRankRewardHandler,this),this.add(n);var r=this.width,c=this.height-125*this.dpr,l=t+30*this.dpr+.5*c;this.gridtable=this.createGrideTable(0,l,r,c,256*this.dpr,50*this.dpr),this.myitembg=this.scene.make.image({key:this.key2,frame:"my_rank_bg"}),this.myitembg.y=l+.5*c+.5*this.myitembg.height-3*this.dpr,this.add(this.myitembg),this.myRankItem=new p(this.scene,0,this.myitembg.y+5*this.dpr,256*this.dpr,50*this.dpr,this.key,this.key2,this.dpr,this.zoom),this.add(this.myRankItem);var d=new h.NineSliceButton(this.scene,0,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,s.UIAtlasKey.commonKey,"red_btn",a.a.t("business_street.back"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(d),d.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#ffffff"}),d.on(String(h.ClickEvent.Tap),this.onBackHandler,this)},PicBusinessRankingDetailPanel.prototype.createGrideTable=function(t,e,i,n,o,r){var s=this,a={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:r,reuseCellContainer:!0,tableOX:19*this.dpr,zoom:this.zoom},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&(e=new p(s.scene,0,0,o,r,s.key,s.key2,s.dpr,s.zoom),c.add(e)),e.setData({item:i}),e.setDetailData(i),e}},c=new h.GameGridTable(this.scene,a);return c.layout(),this.add(c),c},PicBusinessRankingDetailPanel.prototype.onBackHandler=function(){this.backHandler&&this.backHandler.run(),this.content=void 0},PicBusinessRankingDetailPanel.prototype.onRankRewardHandler=function(){this.rankRewardHandler&&this.content&&this.rankRewardHandler.runWith([this.content.key,this.content.type])},PicBusinessRankingDetailPanel}(Phaser.GameObjects.Container),p=function(t){function PicRankingDetailItem(e,i,n,s,a,c,l,p,d){var m=t.call(this,e,i,n)||this;m.dpr=p,m.key=c,m.key2=l,m.setSize(s,a);var u=.5*-m.width,f=.5*-m.height;m.bg=new h.NineSlicePatch(m.scene,0,0,s,45*p,m.key,"restaurant_bg",{left:4*m.dpr,top:9*m.dpr,right:4*m.dpr,bottom:9*m.dpr}),m.add(m.bg);var y=m.scene.make.image({key:l,frame:"icon_bg_s"});y.setPosition(u+.5*y.width+3*p,0),m.add(y),m.storeIcon=new r.DynamicImage(m.scene,y.x,0),m.add(m.storeIcon);var g=y.x+.5*y.width+10*p;return m.storeName=m.scene.make.text({x:g,y:f+10*p,text:"Restaurant",style:{color:"#FFE11A",fontSize:12*p,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),m.add(m.storeName),m.playerName=m.scene.make.text({x:g,y:m.storeName.y+.5*m.storeName.height+10*p,text:"Savings: 13000",style:{color:"#ffffff",fontSize:11*p,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0),m.add(m.playerName),m.industryIcon=m.scene.make.image({key:m.key2,frame:"restaurant_tag_s"}),m.industryIcon.x=.5*m.width-.5*m.industryIcon.width,m.add(m.industryIcon),m.rankIcon=m.scene.make.image({key:l,frame:"1"}),m.rankIcon.x=-u-80*p,m.add(m.rankIcon),m.rankText=m.scene.make.text({x:g,y:0,text:"Restaurant",style:{color:"#ffffff",bold:!0,fontSize:18*p,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5),m.rankText.x=m.rankIcon.x,m.add(m.rankText),m.praiseCount=m.scene.make.text({x:m.rankIcon.x+.5*m.rankIcon.width+10*p,y:m.rankIcon.y,text:"66666666",style:{color:"#ffffff",fontSize:12*p,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0,.5),m.add(m.praiseCount),m}return c(PicRankingDetailItem,t),PicRankingDetailItem.prototype.setDetailData=function(t){this.detailData=t,this.storeName.text=t.name,this.playerName.text=t.ownerName,t.index<4&&t.index>0?(this.rankIcon.visible=!0,this.rankText.visible=!1,this.rankIcon.setFrame(t.index+"")):(this.rankIcon.visible=!1,this.rankText.visible=!0,t.index<=0?this.rankText.text=a.a.t("business_street.onrank"):this.rankText.text=t.index+""),this.praiseCount.text=t.value+"",this.storeIcon.setTexture(this.key2,t.storeType+"_icon_s"),this.bg.setFrame(t.industryType+"_bg"),this.industryIcon.setFrame(t.industryType+"_tag_s")},PicRankingDetailItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessRankingPanel",(function(){return c}));var n,o=i(113),r=i(115),s=i(114),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicBusinessRankingPanel(e,i,n,o,r,s,a,h,c){var l=t.call(this,e,i,n)||this;return l.boundOffset=85,l.dpr=s,l.key=h,l.key2=c,l.zoom=a,l.setSize(o,r),l.create(),l}return h(PicBusinessRankingPanel,t),PicBusinessRankingPanel.prototype.create=function(){var t=this,e=.5*-this.height,i=(this.width,"bold "+18*this.dpr+"px "+o.a.BOLD_FONT),n=this.scene.make.text({x:0,y:e+20*this.dpr,text:s.a.t("business_street.ranking_list"),style:{font:i,bold:!0,color:"#FFC51A"}}).setOrigin(.5);n.setStroke("#553100",2*this.dpr),this.add(n),this.titleText=n;var h=this.scene.make.image({x:0,y:n.y+.5*n.height+10*this.dpr,key:this.key2,frame:"title"});this.add(h);var c=this.width-28*this.dpr,l=this.height-80*this.dpr;this.dpr;this.gameScroll=new a.GameScroller(this.scene,{x:0,y:0,width:c,height:l,zoom:this.zoom,dpr:this.dpr,align:2,orientation:1,space:20*this.dpr,valuechangeCallback:function(e){t.onScrollValueChange(e)},cellupCallBack:function(e){t.onScrollClickHandler(e)}}),this.add(this.gameScroll);var p=new a.NineSliceButton(this.scene,0,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,r.UIAtlasKey.commonKey,"red_btn",s.a.t("business_street.back"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(p),p.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#ffffff"}),p.on(String(a.ClickEvent.Tap),this.onBackHandler,this)},PicBusinessRankingPanel.prototype.setRankingData=function(t){var e=this.scene.make.container(void 0,!1);this.boundOffset=35*this.dpr,e.setSize(this.boundOffset,185*this.dpr),this.gameScroll.clearItems(),this.gameScroll.addItem(e);for(var i=0,n=t;i<n.length;i++){var o=n[i],r=new l(this.scene,0,0,133*this.dpr,185*this.dpr,this.key,this.key2,this.dpr,this.zoom);r.setRankData(o),this.gameScroll.addItem(r)}var s=this.scene.make.container(void 0,!1);s.setSize(this.boundOffset,185*this.dpr),this.gameScroll.addItem(s),this.gameScroll.Sort(),this.gameScroll.refreshMask(),this.gameScroll.setValue(this.gameScroll.bounds[1])},PicBusinessRankingPanel.prototype.setHandler=function(t,e){this.backHandler=t,this.rankHandler=e},PicBusinessRankingPanel.prototype.resetMask=function(){this.gameScroll.refreshMask()},PicBusinessRankingPanel.prototype.show=function(){this.addListen(),this.visible=!0},PicBusinessRankingPanel.prototype.hide=function(){this.removeListen()},PicBusinessRankingPanel.prototype.onScrollValueChange=function(t){if(this.gameScroll){for(var e=133*this.dpr,i=.25*(this.gameScroll.width-e),n=0,o=this.gameScroll.getItemList();n<o.length;n++){var r=o[n],s=Math.abs(r.getWorldTransformMatrix().tx-this.getWorldTransformMatrix().tx)-.25*e;s<0&&(s=0);var a=1-Math.abs(s)/i;r instanceof l&&r.setRadio(a)}this.gameScroll.Sort(!0,!1)}},PicBusinessRankingPanel.prototype.onScrollUpHandler=function(){var t=this;if(this.gameScroll){var e=this.gameScroll.getValue(),i=this.gameScroll.bounds[1]-e,n=Math.floor((i+66*this.dpr)/(133*this.dpr+20*this.dpr)),o=this.gameScroll.getItemList().length;if(n>=0&&n<o-1){var r=this.gameScroll.getItemAt(n+1).getWorldTransformMatrix().tx-this.getWorldTransformMatrix().tx;if((r*=this.scale)<0){var s=Math.abs(r)+e;this.timerID=setInterval((function(){e+=10*t.dpr,t.gameScroll.setValue(e),e>=s&&(t.gameScroll.setValue(s),clearInterval(t.timerID),t.timerID=void 0)}),20)}else{var a=e-Math.abs(r);this.timerID=setInterval((function(){e-=10*t.dpr,t.gameScroll.setValue(e),e<=a&&(t.gameScroll.setValue(a),clearInterval(t.timerID),t.timerID=void 0)}),20)}}this.gameScroll.Sort(!0,!1)}},PicBusinessRankingPanel.prototype.onScrollClickHandler=function(t){if(this.timerID&&(clearInterval(this.timerID),this.timerID=void 0),this.rankHandler){var e=t.rankData;this.rankHandler.runWith([e.key,e.type])}},PicBusinessRankingPanel.prototype.onBackHandler=function(){this.backHandler&&this.backHandler.run(),this.gameScroll.clearItems()},PicBusinessRankingPanel.prototype.addListen=function(){this.scene&&(this.removeListen(),this.scene.input.on("pointerdown",this.pointerDownHandler,this),this.scene.input.on("pointerup",this.pointerUpHandler,this))},PicBusinessRankingPanel.prototype.removeListen=function(){this.scene&&(this.scene.input.off("pointerdown",this.pointerDownHandler,this),this.scene.input.off("pointerup",this.pointerUpHandler,this))},PicBusinessRankingPanel.prototype.pointerDownHandler=function(t){this.checkPointerInBounds(this.gameScroll,t)&&(this.timerID&&(clearInterval(this.timerID),this.timerID=void 0),this.moveTimerID&&(clearInterval(this.moveTimerID),this.moveTimerID=void 0))},PicBusinessRankingPanel.prototype.pointerUpHandler=function(t){var e=this;this.checkPointerInBounds(this.gameScroll,t)&&setTimeout((function(){e.gameScroll.isSliding?e.moveTimerID=setInterval((function(){e.gameScroll.isSliding||(e.onScrollUpHandler(),clearInterval(e.moveTimerID),e.moveTimerID=void 0)}),20):e.onScrollUpHandler()}),20)},PicBusinessRankingPanel.prototype.checkPointerInBounds=function(t,e){if(this.mRectangle||(this.mRectangle=new Phaser.Geom.Rectangle(0,0,0,0)),this.mRectangle.left=-t.width/2,this.mRectangle.right=t.width/2,this.mRectangle.top=-t.height/2,this.mRectangle.bottom=t.height/2,e){var i=t.getWorldTransformMatrix(),n=e.x-i.tx,o=e.y-i.ty;return this.mRectangle.left<=n&&this.mRectangle.right>=n&&this.mRectangle.top<=o&&this.mRectangle.bottom>=o}return!1},PicBusinessRankingPanel}(Phaser.GameObjects.Container),l=function(t){function PicRankingItem(e,i,n,r,s,h,c,l,p){var d=t.call(this,e,i,n)||this;d.radio=0,d.imgtype=1,d.dpr=l,d.key=h,d.key2=c,d.setSize(r,s);d.width;var m=.5*-d.height;return d.bg=d.scene.make.image({key:d.key2,frame:"restaurant_rank_bg_s"}),d.add(d.bg),d.titleText=d.scene.make.text({x:0,y:m,text:"Restaurant",style:{color:"#0555AF",fontSize:14*l,fontFamily:o.a.BOLD_FONT}}).setOrigin(.5),d.add(d.titleText),d.storebg=new a.NineSlicePatch(d.scene,0,0,72*l,17*l,d.key2,"store_name_bg_s",{left:8*d.dpr,top:0*d.dpr,right:8*d.dpr,bottom:0*d.dpr}),d.storebg.y=d.titleText.y+10*l,d.add(d.storebg),d.storeName=d.scene.make.text({x:0,y:d.storebg.y,text:"Restaurant",style:{color:"#0",fontSize:12*l,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5),d.add(d.storeName),d.storeIcon=d.scene.make.image({key:d.key2,frame:"restaurant_rank_icon_s"}),d.storeIcon.y=-m-.5*d.storeIcon.height-5*l,d.add(d.storeIcon),d}return h(PicRankingItem,t),PicRankingItem.prototype.setRankData=function(t){this.rankData=t,this.titleText.text=t.name,this.storeName.text=t.champion,this.switchImage(1)},PicRankingItem.prototype.setRadio=function(t){var e=1;t>1&&(t=1),t>0&&(e=2),this.imgtype!==e&&(this.switchImage(e),this.imgtype=e),this.scale=2===e?1/this.radio+t*(1-1/this.radio):1,this.width=this.bg.displayWidth*this.scale,this.height=this.bg.displayHeight*this.scale},PicRankingItem.prototype.switchImage=function(t){var e,i,n,o,r,s,a,h,c=this.rankData.type,l=133*this.dpr,p=133*this.dpr;1===t?(e=c+"_rank_bg_s",i=14*this.dpr,n="store_name_bg_s",o=72*this.dpr,r=14*this.dpr,s=10*this.dpr,a=c+"_rank_icon_s",p=133*this.dpr,this.storebg.setConfig({left:8*this.dpr,top:0*this.dpr,right:8*this.dpr,bottom:0*this.dpr})):(e=c+"_rank_bg_m",i=18*this.dpr,n="store_name_bg_m",o=88*this.dpr,r=17*this.dpr,s=12*this.dpr,a=c+"_rank_icon_m",p=163*this.dpr,this.storebg.setConfig({left:11*this.dpr,top:0*this.dpr,right:11*this.dpr,bottom:0*this.dpr})),h=p/l,this.radio=h,this.bg.setFrame(e),this.titleText.setFontSize(i),this.storebg.setFrame(n),this.storebg.resize(o,r),this.storeName.setFontSize(s),this.storeIcon.setFrame(a),this.setSize(this.bg.width,this.bg.height),this.titleText.y=.5*-this.height+.5*this.titleText.height+10*this.dpr*h,this.storebg.y=this.titleText.y+.5*this.titleText.height+10*this.dpr*h,this.storeName.y=this.storebg.y,this.storeIcon.y=.5*this.height-.5*this.storeIcon.height-10*this.dpr*h},PicRankingItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessStoreCreatePanel",(function(){return p}));var n,o=i(113),r=i(115),s=i(114),a=i(111),h=i(2),c=i(109),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function PicBusinessStoreCreatePanel(e,i,n,o,r,s,a,h,c){void 0===c&&(c=!0);var l=t.call(this,e,i,n)||this;return l.isFirst=!0,l.dpr=s,l.key=h,l.zoom=a,l.setSize(o,r),l.isFirst=c,l.create(),l}return l(PicBusinessStoreCreatePanel,t),PicBusinessStoreCreatePanel.prototype.setTypeData=function(t){t instanceof Array?this.gridtable.setItems(t):this.gridtable.setItems(t.roomModels);var e=this.gridtable.getCells()[0];e&&e.container&&this.onGridSelectHandler(e.container),this.gridtable.setT(0)},PicBusinessStoreCreatePanel.prototype.setTypeInfo=function(t){if(this.curSelectData=t,t instanceof h.op_pkt_def.PKT_INDUSTRY)this.recommendedText.text=t.state,this.describleText.text=t.des,this.turnoverText.setText(t.buffDes);else{var e=t;e.price&&(this.coinImg.setFrame(a.f.getIcon(e.price.coinType)),this.coinCount.text=e.price.price+""),this.describleText2.text=e.des}},PicBusinessStoreCreatePanel.prototype.setHandler=function(t,e){this.cancelHandler=t,this.selectHandler=e},PicBusinessStoreCreatePanel.prototype.resetMask=function(){this.gridtable.resetMask()},PicBusinessStoreCreatePanel.prototype.create=function(){var t=.5*-this.height,e=new c.NineSlicePatch(this.scene,0,0,135*this.dpr,17*this.dpr,this.key,"subtitle",{left:13*this.dpr,top:0*this.dpr,right:13*this.dpr,bottom:0*this.dpr});e.x=0,e.y=t+10*this.dpr,this.add(e);var i=this.scene.make.text({x:0,y:e.y,text:s.a.t("business_street.choosetheindustry"),style:{fontSize:11*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#0"}}).setOrigin(.5);this.add(i);var n=this.width-24*this.dpr,a=100*this.dpr,h=-50*this.dpr;if(this.gridtable=this.createGrideTable(0,h,n,a,90*this.dpr,100*this.dpr),this.isFirst){var l="bold "+13*this.dpr+"px "+o.a.BOLD_FONT;this.recommendedText=this.scene.make.text({x:0,y:20*this.dpr,text:"Recommended",style:{font:l,bold:!0,color:"#697AFF"}}).setOrigin(.5,0),this.add(this.recommendedText),this.describleText=this.scene.make.text({x:0,y:this.recommendedText.y+this.recommendedText.height+10*this.dpr,text:"This industry has great development potential.",style:{fontSize:11*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#0"}}).setOrigin(.5,0),this.add(this.describleText),this.turnoverText=new c.BBCodeText(this.scene,0,this.describleText.y+this.describleText.height+10*this.dpr).setOrigin(.5,0).setFontSize(11*this.dpr).setFontFamily(o.a.DEFULT_FONT).setColor("#0"),this.add(this.turnoverText),i.text=s.a.t("business_street.choosetheindustry"),e.resize(135*this.dpr,17*this.dpr)}else this.coinBg=this.scene.make.image({key:r.UIAtlasKey.commonKey,frame:"price_bg"}),this.coinBg.y=30*this.dpr,this.add(this.coinBg),this.coinImg=this.scene.make.image({key:r.UIAtlasKey.commonKey,frame:"iv_coin"}),this.coinImg.setPosition(this.coinBg.x-.5*this.coinImg.width-15*this.dpr,this.coinBg.y),this.add(this.coinImg),this.coinCount=this.scene.make.text({x:this.coinImg.x+.5*this.coinImg.width+10*this.dpr,y:this.coinImg.y,text:"0",style:{fontSize:11*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#0"}}).setOrigin(0,.5),this.add(this.coinCount),this.describleText2=this.scene.make.text({x:0,y:this.coinCount.y+50*this.dpr,text:"55225sadffqwerqwerqwer",style:{fontSize:10*this.dpr,fontFamily:o.a.DEFULT_FONT,color:"#0",wordWrap:{width:244*this.dpr,useAdvancedWrap:!0}}}).setOrigin(.5),this.add(this.describleText2),i.text=s.a.t("business_street.choosestorelike"),e.resize(155*this.dpr,17*this.dpr);var p=new c.NineSliceButton(this.scene,-60*this.dpr,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,r.UIAtlasKey.commonKey,"red_btn",s.a.t("common.cancel"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(p),p.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#ffffff"}),p.on(String(c.ClickEvent.Tap),this.onCancelHandler,this);var d=new c.NineSliceButton(this.scene,60*this.dpr,p.y,92*this.dpr,34*this.dpr,r.UIAtlasKey.commonKey,"yellow_btn",s.a.t("business_street.select"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(d),d.on(String(c.ClickEvent.Tap),this.onSelectHandler,this),d.setTextStyle({fontSize:15*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#996600"})},PicBusinessStoreCreatePanel.prototype.createGrideTable=function(t,e,i,n,o,r){var s=this,a={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:r,reuseCellContainer:!0,tableOY:5*this.dpr,zoom:this.zoom},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&(e=new d(s.scene,0,0,o,r,s.key,s.dpr,s.zoom)),e.setData({item:i}),e.setStoreData(i),s.curSelectData&&i===s.curSelectData?e.select=!0:e.select=!1,e}},h=new c.GameGridTable(this.scene,a);return h.layout(),h.on("cellTap",(function(t){t&&s.onGridSelectHandler(t)})),this.add(h),h},PicBusinessStoreCreatePanel.prototype.onGridSelectHandler=function(t){this.setTypeInfo(t.storeData),this.curSelectItem&&(this.curSelectItem.select=!1),t.select=!0,this.curSelectItem=t},PicBusinessStoreCreatePanel.prototype.onCancelHandler=function(){this.cancelHandler&&this.cancelHandler.run()},PicBusinessStoreCreatePanel.prototype.onSelectHandler=function(){this.selectHandler&&this.selectHandler.runWith(this.curSelectData)},PicBusinessStoreCreatePanel}(Phaser.GameObjects.Container),d=function(t){function StoreTypeItem(e,i,n,r,s,a,h,c){var l=t.call(this,e,i,n)||this;return l.isSelect=!1,l.dpr=h,l.key=a,l.setSize(r,s),l.bg=l.scene.make.image({key:a,frame:"store_bg"}),l.add(l.bg),l.storeIcon=l.scene.make.image({key:a,frame:"restaurant_icon"}),l.storeIcon.setPosition(0,-8*h),l.add(l.storeIcon),l.storeName=l.scene.make.text({x:0,y:l.storeIcon.y+.5*l.storeIcon.height+10*h,text:"Restaurant",style:{color:"#0",fontSize:10*h,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5),l.add(l.storeName),l}return l(StoreTypeItem,t),StoreTypeItem.prototype.setStoreData=function(t){if(this.storeData=t,t instanceof h.op_pkt_def.PKT_INDUSTRY)this.storeIcon.setFrame(t.industryType+"_icon"),this.storeName.text=t.name;else{var e=t;this.storeIcon.setFrame(e.storeType+"_icon"),this.storeName.text=e.name}},Object.defineProperty(StoreTypeItem.prototype,"select",{get:function(){return this.isSelect},set:function(t){this.isSelect=t;var e=t?"store_bg_click":"store_bg";this.bg.setFrame(e)},enumerable:!1,configurable:!0}),StoreTypeItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessStreet",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicBusinessStreet(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicBusinessStreet,t),PicBusinessStreet.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_MY_STORE,this.onMyStoreList),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_COMMERCIAL_STREET,this.onCOMMERCIAL_STREET),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_INDUSTRY_MODELS,this.onINDUSTRY_MODELS),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_QUERY_STORE_RANKING_LIST,this.onSTORE_RANKING_LIST),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_QUERY_STORE_RANKING_DETAIL,this.onSTORE_RANKING_DETAIL),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_QUERY_STORE_RANKING_REWARD,this.onSTORE_RANKING_REWARD),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_QUERY_STORE_ENTER_HISTORY,this.onSTORE_ENTER_HISTORY))},PicBusinessStreet.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicBusinessStreet.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicBusinessStreet.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicBusinessStreet.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicBusinessStreet.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicBusinessStreet.prototype.query_My_STORE=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_MY_STORE);this.connection.send(t)},PicBusinessStreet.prototype.query_TAKE_ALL_STORE_SAVINGS=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_TAKE_ALL_STORE_SAVINGS);this.connection.send(t)},PicBusinessStreet.prototype.query_COMMERCIAL_STREET=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_COMMERCIAL_STREET),n=i.content;n.sortedBy=t,n.storeType=e,this.connection.send(i)},PicBusinessStreet.prototype.query_INDUSTRY_MODELS=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_INDUSTRY_MODELS);this.connection.send(t)},PicBusinessStreet.prototype.query_CREATE_STORE=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_CREATE_STORE);e.content.modelId=t,this.connection.send(e)},PicBusinessStreet.prototype.query_ENTER_ROOM=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER_ROOM),n=i.content;n.roomId=t,n.password=e,this.connection.send(i)},PicBusinessStreet.prototype.query_RANKING_LIST=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_STORE_RANKING_LIST);this.connection.send(t)},PicBusinessStreet.prototype.query_STORE_RANKING_DETAIL=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_STORE_RANKING_DETAIL),n=i.content;n.key=t,n.type=e,this.connection.send(i)},PicBusinessStreet.prototype.query_STORE_RANKING_REWARD=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_STORE_RANKING_REWARD),n=i.content;n.key=t,n.type=e,this.connection.send(i)},PicBusinessStreet.prototype.query_STORE_ENTER_HISTORY=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_STORE_ENTER_HISTORY);this.connection.send(t)},PicBusinessStreet.prototype.onMyStoreList=function(t){var e=t.content;this.mEvent.emit("onmystore",e)},PicBusinessStreet.prototype.onCOMMERCIAL_STREET=function(t){var e=t.content;this.mEvent.emit("onstreet",e)},PicBusinessStreet.prototype.onINDUSTRY_MODELS=function(t){var e=t.content;this.mEvent.emit("onmodels",e)},PicBusinessStreet.prototype.onSTORE_RANKING_LIST=function(t){var e=t.content;this.mEvent.emit("onranklist",e)},PicBusinessStreet.prototype.onSTORE_RANKING_DETAIL=function(t){var e=t.content;this.mEvent.emit("onrankdetail",e)},PicBusinessStreet.prototype.onSTORE_RANKING_REWARD=function(t){var e=t.content;this.mEvent.emit("onrankreward",e)},PicBusinessStreet.prototype.onSTORE_ENTER_HISTORY=function(t){var e=t.content;this.mEvent.emit("onenterhistory",e)},PicBusinessStreet}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessStreetListPanel",(function(){return u}));var n,o,r=i(113),s=i(120),a=i(116),h=i(115),c=i(114),l=i(293),p=i(150),d=i(109),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function PicBusinessStreetListPanel(e,i,n,r,s,a,h,c,l){var p=t.call(this,e,i,n)||this;return p.curCategoryType=o.popularity,p.dpr=a,p.key=c,p.key2=l,p.zoom=h,p.setSize(r,s),p.create(),p}return m(PicBusinessStreetListPanel,t),PicBusinessStreetListPanel.prototype.setIndustryModels=function(t){for(var e=[{text:c.a.t("business_street.popularity"),data:{categoryType:o.popularity}},{text:c.a.t("business_street.praise"),data:{categoryType:o.praise}}],i=[],n=0,s=t.industry;n<s.length;n++)for(var a=0,h=s[n].roomModels;a<h.length;a++){var l=h[a];-1===i.indexOf(l.storeType)&&i.push({type:l.storeType,name:l.name})}this.secondaryPanel.setCategories(d.TabButton,e,{width:88*this.dpr,height:27*this.dpr,key:this.key2,normalFrame:"navigation_bar_click",downFrame:"navigation_bar_click",textStyle:{fontSize:14*this.dpr,fontFamily:r.a.DEFULT_FONT,color:"#ffffff"}}),this.secondaryPanel.setSubItems(i)},PicBusinessStreetListPanel.prototype.setStreetListData=function(t){this.gridtable.setT(0),this.gridtable.setItems(t)},PicBusinessStreetListPanel.prototype.setHandler=function(t,e,i,n,o){this.historyHandler=t,this.rankHandler=e,this.backHandler=i,this.queryHandler=n,this.enterHandler=o},PicBusinessStreetListPanel.prototype.resetMask=function(){this.gridtable.resetMask()},PicBusinessStreetListPanel.prototype.create=function(){var t=this,e=.5*-this.height,i=.5*-this.width,n=this.scene.make.image({key:this.key,frame:"store_icon"});n.x=i+30*this.dpr,n.y=e+6*this.dpr,this.add(n);var o="bold "+13*this.dpr+"px "+r.a.BOLD_FONT,a=n.x+.5*n.width+10*this.dpr,m=this.scene.make.text({x:a,y:n.y,text:c.a.t("business_street.street"),style:{font:o,bold:!0,color:"#FFC51A"}}).setOrigin(0,.5);m.setStroke("#553100",2*this.dpr),this.add(m),this.secondaryPanel=new l.SecondaryMenuPanel(this.scene,0,e+56*this.dpr,this.width,60*this.dpr,this.dpr,this.zoom,{x:0,y:-15*this.dpr,width:this.width-30*this.dpr,height:30*this.dpr,zoom:this.zoom,dpr:this.dpr,orientation:1}),this.add(this.secondaryPanel);var u=this.scene.make.image({key:this.key2,frame:"navigation_bar"});this.secondaryPanel.gameScroll.addAt(u),this.secondaryPanel.createGrideTable(0,13*this.dpr,this.width-30*this.dpr,40*this.dpr,65*this.dpr,40*this.dpr,(function(e,i){var n=e.item;return i||(i=new p.TextButton(t.scene,t.dpr,t.zoom)).setFontSize(13*t.dpr),i.getData("itemData")!==n&&(i.setText(n.name),i.setData("itemData",n),t.subCategory===n.type?i.changeDown():i.changeNormal()),i})),this.secondaryPanel.setHandler(new s.a(this,this.onCategoryHandler),new s.a(this,this.onSubCategoryHandle));var f=this.scene.make.image({key:this.key2,frame:"navigation_bar_2"});this.secondaryPanel.gridTable.addAt(f);var y=this.width,g=this.height-130*this.dpr,_=e+88*this.dpr+.5*g;this.gridtable=this.createGrideTable(0,_,y,g,256*this.dpr,50*this.dpr);var P=new d.Button(this.scene,this.key2,"ranking","ranking"),v=-i-.5*P.width-20*this.dpr;P.setPosition(v,e+6*this.dpr),P.on(String(d.ClickEvent.Tap),this.onRankHandler,this),this.add(P);var w=new d.Button(this.scene,this.key2,"history","history");w.setPosition(v-.5*P.width-.5*w.width-10*this.dpr,e+6*this.dpr),w.on(String(d.ClickEvent.Tap),this.onHistoryHandler,this),this.add(w);var S=new d.NineSliceButton(this.scene,0,.5*this.height-7*this.dpr,92*this.dpr,34*this.dpr,h.UIAtlasKey.commonKey,"red_btn",c.a.t("business_street.back"),this.dpr,this.zoom,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr});this.add(S),S.setTextStyle({fontSize:15*this.dpr,fontFamily:r.a.BOLD_FONT,color:"#ffffff"}),S.on(String(d.ClickEvent.Tap),this.onBackHandler,this)},PicBusinessStreetListPanel.prototype.createGrideTable=function(t,e,i,n,o,r){var s=this,a={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:o,cellHeight:r,reuseCellContainer:!0,tableOX:19*this.dpr,zoom:this.zoom},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,e){t.scene;var i=t.item;return null===e&&(e=new f(s.scene,0,0,o,r,s.key,s.key2,s.dpr,s.zoom),h.add(e)),e.setData({item:i}),e.setStoreData(i,s.curCategoryType),e}},h=new d.GameGridTable(this.scene,a);return h.on("cellTap",(function(t){t&&s.onSelectItemHandler(t)})),h.layout(),this.add(h),h},PicBusinessStreetListPanel.prototype.onCategoryHandler=function(t){if(this.curCategoryType=t.categoryType,void 0!==this.subCategory){var e=this.curCategoryType===o.popularity?"popularity":"praise";this.queryHandler.runWith([e,this.subCategory])}},PicBusinessStreetListPanel.prototype.onSubCategoryHandle=function(t){var e=t.getData("itemData");this.curSubCategoryItem&&this.curSubCategoryItem.changeNormal(),t.changeDown(),this.curSubCategoryItem=t,this.subCategory=e.type;var i=this.curCategoryType===o.popularity?"popularity":"praise";this.queryHandler&&this.queryHandler.runWith([i,this.subCategory])},PicBusinessStreetListPanel.prototype.onSelectItemHandler=function(t){var e=t.storeData;this.enterHandler&&this.enterHandler.runWith(e.roomId)},PicBusinessStreetListPanel.prototype.onHistoryHandler=function(){this.historyHandler&&this.historyHandler.run()},PicBusinessStreetListPanel.prototype.onRankHandler=function(){this.rankHandler&&this.rankHandler.run()},PicBusinessStreetListPanel.prototype.onBackHandler=function(){this.backHandler&&this.backHandler.run()},PicBusinessStreetListPanel}(Phaser.GameObjects.Container),f=function(t){function PicStreetItem(e,i,n,o,s,h,c,l,p){var m=t.call(this,e,i,n)||this;m.dpr=l,m.key=h,m.key2=c,m.setSize(o,s);var u=.5*-m.width,f=.5*-m.height;m.bg=new d.NineSlicePatch(m.scene,0,0,o,45*l,m.key,"restaurant_bg",{left:4*m.dpr,top:9*m.dpr,right:4*m.dpr,bottom:9*m.dpr}),m.add(m.bg);var y=m.scene.make.image({key:c,frame:"icon_bg_s"});y.setPosition(u+.5*y.width+3*l,0),m.add(y),m.storeIcon=new a.DynamicImage(m.scene,y.x,0),m.add(m.storeIcon);var g=y.x+.5*y.width+10*l;return m.storeName=m.scene.make.text({x:g,y:f+10*l,text:"",style:{color:"#FFE11A",fontSize:12*l,fontFamily:r.a.DEFULT_FONT}}).setOrigin(0),m.add(m.storeName),m.playerName=m.scene.make.text({x:g,y:m.storeName.y+.5*m.storeName.height+10*l,text:"",style:{color:"#ffffff",fontSize:11*l,fontFamily:r.a.DEFULT_FONT}}).setOrigin(0),m.add(m.playerName),m.industryIcon=m.scene.make.image({key:m.key2,frame:"entertainment_tag_s"}),m.industryIcon.x=.5*m.width-.5*m.industryIcon.width,m.add(m.industryIcon),m.praiseIcon=m.scene.make.image({key:c,frame:"praise"}),m.praiseIcon.x=-u-80*l,m.add(m.praiseIcon),m.praiseCount=m.scene.make.text({x:m.praiseIcon.x+.5*m.praiseIcon.width+10*l,y:m.praiseIcon.y,text:"",style:{color:"#ffffff",fontSize:12*l,fontFamily:r.a.DEFULT_FONT}}).setOrigin(0,.5),m.add(m.praiseCount),m}return m(PicStreetItem,t),PicStreetItem.prototype.setStoreData=function(t,e){var i=t.industry,n=t.storeType;this.bg.setFrame(i+"_bg"),this.storeIcon.setTexture(this.key2,n+"_icon_s"),this.praiseIcon.setFrame(e===o.praise?"praise":"store_popularity"),this.storeName.text=t.name,this.playerName.text=t.ownerName,this.praiseCount.text=(e===o.praise?t.praise:t.popularity)+"",this.industryIcon.setFrame(i+"_tag_s"),this.storeData=t,this.storeName.removeInteractive(),this.storeName.setInteractive()},PicStreetItem}(Phaser.GameObjects.Container);!function(t){t[t.popularity=1]="popularity",t[t.praise=2]="praise"}(o||(o={}))},function(t,e,i){"use strict";i.r(e),i.d(e,"SecondaryMenuPanel",(function(){return s}));var n,o=i(109),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function SecondaryMenuPanel(e,i,n,r,s,a,h,c){var l=t.call(this,e,i,n)||this;return l.dpr=a,l.zoom=h,l.setSize(r,s),c.cellupCallBack=l.onSelectCategoryHandler.bind(l),l.gameScroll=new o.GameScroller(l.scene,c),l.add(l.gameScroll),l}return r(SecondaryMenuPanel,t),SecondaryMenuPanel.prototype.setHandler=function(t,e){this.categoryHandler=t,this.subCategoryHandler=e},SecondaryMenuPanel.prototype.setCategories=function(t,e,i){this.gameScroll.clearItems();for(var n=i.width,o=i.height,r=i.key,s=i.normalFrame,a=i.downFrame,h=i.patchConfig,c=i.music,l=[],p=0,d=e;p<d.length;p++){var m=d[p],u=m.text,f=new t(this.scene,r,s,a,u,c,this.dpr,this.zoom,h);i.textStyle&&f.setTextStyle(i.textStyle),f.setData("category",m.data),f.disableInteractive(),n&&(f.width=n),o&&(f.height=o),this.gameScroll.addItem(f),l.push(f)}this.gameScroll.setAlign(1),this.gameScroll.Sort(!0),this.gameScroll.refreshMask();for(var y=this.gameScroll.getItemList(),g=0,_=y;g<_.length;g++){_[g].background.visible=!1}this.onSelectCategoryHandler(y[0])},SecondaryMenuPanel.prototype.setSubItems=function(t){if(this.gridTable){this.gridTable.setItems(t),this.gridTable.resetMask();var e=this.gridTable.getCells();if(e){var i=e[0];i&&i.container&&this.onSubCategoryHandler(i.container)}}},SecondaryMenuPanel.prototype.createGrideTable=function(t,e,i,n,r,s,a,h){var c=this;void 0===h&&(h=1);var l={x:t,y:e,table:{width:i,height:n,columns:1,cellWidth:r,cellHeight:s,reuseCellContainer:!0,zoom:this.zoom},scrollMode:h,clamplChildOY:!1,createCellContainerCallback:a};this.gridTable=new o.GameGridTable(this.scene,l),this.gridTable.layout(),this.gridTable.on("cellTap",(function(t){t&&c.onSubCategoryHandler(t)})),this.add(this.gridTable),this.gridTable.resetMask()},SecondaryMenuPanel.prototype.onSelectCategoryHandler=function(t){this.categoryBtn&&(this.categoryBtn.background.visible=!1),t.background.visible=!0,t.changeDown(),this.categoryBtn=t;var e=t.getData("category");this.categoryHandler&&this.categoryHandler.runWith(e)},SecondaryMenuPanel.prototype.onSubCategoryHandler=function(t){this.subCategoryBtn&&this.subCategoryBtn.changeNormal(),t.changeDown(),this.subCategoryHandler&&this.subCategoryHandler.runWith(t)},SecondaryMenuPanel}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e);var n,o=i(112),r=i(115),s=i(120),a=i(168),h=i(286),c=i(290),l=i(292),p=i(285),d=i(289),m=i(288),u=i(287),f=i(114),y=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),g=function(t){function PicBusinessStreetPanel(e,i){var n=t.call(this,e,i)||this;return n.key="c_street_1",n.key2="c_street_2",n}return y(PicBusinessStreetPanel,t),PicBusinessStreetPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,e,i),this.setSize(n,o),this.mBackGround.clear(),this.mBackGround.fillStyle(0,.66),this.mBackGround.fillRect(0,0,n,o)},PicBusinessStreetPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},PicBusinessStreetPanel.prototype.addListen=function(){this.mInitialized},PicBusinessStreetPanel.prototype.removeListen=function(){this.mInitialized},PicBusinessStreetPanel.prototype.preload=function(){this.addAtlas(this.key,"c_street_1/c_street_1.png","c_street_1/c_street_1.json"),this.addAtlas(this.key2,"c_street_2/c_street_2.png","c_street_2/c_street_2.json"),this.addAtlas(r.UIAtlasKey.commonKey,r.UIAtlasName.commonUrl+".png",r.UIAtlasName.commonUrl+".json"),this.addAtlas(r.UIAtlasKey.common2Key,r.UIAtlasName.common2Url+".png",r.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicBusinessStreetPanel.prototype.init=function(){var e=this.scale,i=this.scaleWidth,n=this.scaleHeight;this.mBackGround=this.scene.make.graphics(void 0,!1),this.mBackGround.clear(),this.mBackGround.fillStyle(7004927,0),this.mBackGround.fillRect(0,0,i*e,n*e),this.mBackGround.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.add(this.mBackGround);var o=90*this.dpr,r=74*this.dpr,h=295*this.dpr,c=n-o-r,l=o+.5*c,p=.5*i;this.content=new a.PicBusinessContentPanel(this.scene,p,l,h,c,this.dpr,this.key,this.key2),this.content.setCloseHandler(new s.a(this,this.OnCloseHandler)),this.add(this.content),this.resize(i,n),t.prototype.init.call(this),this.openMyStreet()},PicBusinessStreetPanel.prototype.setMyStore=function(t){this.picMyStreetPanel.setMyStoreData(t)},PicBusinessStreetPanel.prototype.setCommercialStreet=function(t){this.picStreetListPanel&&this.picStreetListPanel.setStreetListData(t.commercialStreet)},PicBusinessStreetPanel.prototype.setIndustryModels=function(t){this.industryModels=t,this.picStoreCreatePanel&&this.picStoreCreatePanel.parentContainer&&this.picStoreCreatePanel.setTypeData(t.industry),this.picStreetListPanel&&this.picStreetListPanel.parentContainer&&this.picStreetListPanel.setIndustryModels(this.industryModels)},PicBusinessStreetPanel.prototype.setStoreRankingList=function(t){this.picStreetRankingPanel.setRankingData(t.rankChampions)},PicBusinessStreetPanel.prototype.setStoreRankingDetial=function(t){this.picRankingDetailPanel.setRankingDetailData(t)},PicBusinessStreetPanel.prototype.setStoreRankingReward=function(t){this.picRankRewardPanel.setRankRewardData(t.rewardStage)},PicBusinessStreetPanel.prototype.setEnterHistory=function(t){this.picStreetHistoryPanel.setHistoryeData(t.history)},PicBusinessStreetPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},PicBusinessStreetPanel.prototype.setSecondStore=function(t){this.picSecondStorePanel.setTypeData(t)},PicBusinessStreetPanel.prototype.openMyStreet=function(){this.emit("querymystore"),this.showMyStreetPanel(),this.content.setTitleText(f.a.t("business_street.commercial_street"))},PicBusinessStreetPanel.prototype.openStoreCreatePanel=function(){this.emit("querymodels"),this.showStoreCreatePanel(),this.content.setTitleText(f.a.t("business_street.newstore"))},PicBusinessStreetPanel.prototype.openSecondStorePanel=function(){this.showSecondStorePanel(),this.content.setTitleText(f.a.t("business_street.newstore"))},PicBusinessStreetPanel.prototype.openStoreStreetPanel=function(){this.showStreetListPanel(),this.industryModels?this.picStreetListPanel.setIndustryModels(this.industryModels):this.emit("querymodels"),this.content.setTitleText(f.a.t("business_street.commercial_street"))},PicBusinessStreetPanel.prototype.openStreetHistoryPanel=function(){this.showStreetHistoryPanel(),this.content.setTitleText(f.a.t("business_street.history"))},PicBusinessStreetPanel.prototype.openStreetRankingPanel=function(){this.showStreetRankingPanel(),this.content.setTitleText(f.a.t("business_street.ranking"))},PicBusinessStreetPanel.prototype.openRankingDetailPanel=function(){this.showRankingDetailPanel(),this.content.setTitleText(f.a.t("business_street.ranking"))},PicBusinessStreetPanel.prototype.openRankRewardPanel=function(){this.showRankRewardPanel(),this.content.setTitleText(f.a.t("business_street.rankreward"))},PicBusinessStreetPanel.prototype.showMyStreetPanel=function(){var t=this,e=90*this.dpr,i=74*this.dpr;if(this.setContentSize(e,i),!this.picMyStreetPanel){var n=this.content.width,o=this.content.height-50*this.dpr;this.picMyStreetPanel=new h.PicBusinessMyStreetPanel(this.scene,0,0,n,o,this.dpr,this.scale,this.key),this.picMyStreetPanel.setHandler(new s.a(this,(function(){t.emit("queryallsaves")})),new s.a(this,(function(){t.openStoreStreetPanel(),t.hideMyStreetPanel()})),new s.a(this,(function(){t.hideMyStreetPanel(),t.openStoreCreatePanel()})),new s.a(this,(function(e,i){t.emit("queryenterroom",e,i)})))}this.content.add(this.picMyStreetPanel),this.picMyStreetPanel.resetMask()},PicBusinessStreetPanel.prototype.hideMyStreetPanel=function(){this.content.remove(this.picMyStreetPanel)},PicBusinessStreetPanel.prototype.showStoreCreatePanel=function(){var t=this,e=this.scaleWidth,i=this.scaleHeight,n=295*this.dpr,o=320*this.dpr,r=.5*i,a=.5*e;if(this.content.setPosition(a,r),this.content.setContentSize(n,o),!this.picStoreCreatePanel){var h=this.content.width,l=this.content.height-50*this.dpr;this.picStoreCreatePanel=new c.PicBusinessStoreCreatePanel(this.scene,0,0,h,l,this.dpr,this.scale,this.key),this.picStoreCreatePanel.setHandler(new s.a(this,(function(){t.openMyStreet(),t.hideStoreCreatePanel()})),new s.a(this,(function(e){t.openSecondStorePanel(),t.hideStoreCreatePanel(),t.setSecondStore(e)})))}this.content.add(this.picStoreCreatePanel),this.picStoreCreatePanel.resetMask()},PicBusinessStreetPanel.prototype.hideStoreCreatePanel=function(){this.content.remove(this.picStoreCreatePanel)},PicBusinessStreetPanel.prototype.showSecondStorePanel=function(){var t=this,e=this.scaleWidth,i=this.scaleHeight,n=295*this.dpr,o=320*this.dpr,r=.5*i,a=.5*e;if(this.content.setPosition(a,r),this.content.setContentSize(n,o),!this.picSecondStorePanel){var h=this.content.width,l=this.content.height-50*this.dpr;this.picSecondStorePanel=new c.PicBusinessStoreCreatePanel(this.scene,0,0,h,l,this.dpr,this.scale,this.key,!1),this.picSecondStorePanel.setHandler(new s.a(this,(function(){t.openStoreCreatePanel(),t.hideSecondStorePanel()})),new s.a(this,(function(e){t.emit("querycreatestore",e.modelId)})))}this.content.add(this.picSecondStorePanel),this.picSecondStorePanel.resetMask()},PicBusinessStreetPanel.prototype.hideSecondStorePanel=function(){this.content.remove(this.picSecondStorePanel)},PicBusinessStreetPanel.prototype.showStreetListPanel=function(){var t=this,e=90*this.dpr,i=74*this.dpr;if(this.setContentSize(e,i),!this.picStreetListPanel){var n=this.content.width,o=this.content.height-50*this.dpr;this.picStreetListPanel=new l.PicBusinessStreetListPanel(this.scene,0,0,n,o,this.dpr,this.scale,this.key,this.key2),this.picStreetListPanel.setHandler(new s.a(this,(function(){t.openStreetHistoryPanel(),t.hideStreetListPanel(),t.emit("queryenterhistory")})),new s.a(this,(function(){t.openStreetRankingPanel(),t.hideStreetListPanel(),t.emit("queryranklist")})),new s.a(this,(function(){t.hideStreetListPanel(),t.openMyStreet()})),new s.a(this,(function(e,i){t.emit("querystreet",e,i)})),new s.a(this,(function(e,i){t.emit("queryenterroom",e,i)})))}this.content.add(this.picStreetListPanel),this.picStreetListPanel.resetMask()},PicBusinessStreetPanel.prototype.hideStreetListPanel=function(){this.content.remove(this.picStreetListPanel)},PicBusinessStreetPanel.prototype.showStreetHistoryPanel=function(){var t=this,e=90*this.dpr,i=74*this.dpr;if(this.setContentSize(e,i),!this.picStreetHistoryPanel){var n=this.content.width,o=this.content.height-50*this.dpr;this.picStreetHistoryPanel=new p.PicBusinessHistoryPanel(this.scene,0,0,n,o,this.dpr,this.scale,this.key,this.key2),this.picStreetHistoryPanel.setHandler(new s.a(this,(function(){t.hideStreetHistoryPanel(),t.openStoreStreetPanel()})))}this.content.add(this.picStreetHistoryPanel),this.picStreetHistoryPanel.resetMask()},PicBusinessStreetPanel.prototype.hideStreetHistoryPanel=function(){this.content.remove(this.picStreetHistoryPanel)},PicBusinessStreetPanel.prototype.showStreetRankingPanel=function(){var t=this,e=110*this.dpr,i=94*this.dpr;if(this.setContentSize(e,i),!this.picStreetRankingPanel){var n=this.content.width,o=this.content.height-50*this.dpr;this.picStreetRankingPanel=new d.PicBusinessRankingPanel(this.scene,0,0,n,o,this.dpr,this.scale,this.key,this.key2),this.picStreetRankingPanel.setHandler(new s.a(this,(function(){t.hideStreetRankingPanel(),t.openStoreStreetPanel()})),new s.a(this,(function(e,i){t.openRankingDetailPanel(),t.hideStreetRankingPanel(),t.emit("queryrankdetail",e,i)})))}this.content.add(this.picStreetRankingPanel),this.picStreetRankingPanel.show(),this.picStreetRankingPanel.resetMask()},PicBusinessStreetPanel.prototype.hideStreetRankingPanel=function(){this.content.remove(this.picStreetRankingPanel),this.picStreetRankingPanel.hide()},PicBusinessStreetPanel.prototype.showRankingDetailPanel=function(){var t=this,e=90*this.dpr,i=74*this.dpr;if(this.setContentSize(e,i),!this.picRankingDetailPanel){var n=this.content.width,o=this.content.height-50*this.dpr;this.picRankingDetailPanel=new m.PicBusinessRankingDetailPanel(this.scene,0,0,n,o,this.dpr,this.scale,this.key,this.key2),this.picRankingDetailPanel.setHandler(new s.a(this,(function(){t.hideRankingDetailPanel(),t.openStreetRankingPanel()})),new s.a(this,(function(e,i){t.hideRankingDetailPanel(),t.openRankRewardPanel(),t.emit("queryrankreward",e,i)})))}this.content.add(this.picRankingDetailPanel),this.picRankingDetailPanel.resetMask()},PicBusinessStreetPanel.prototype.hideRankingDetailPanel=function(){this.content.remove(this.picRankingDetailPanel)},PicBusinessStreetPanel.prototype.showRankRewardPanel=function(){var t=this,e=90*this.dpr,i=74*this.dpr;if(this.setContentSize(e,i),!this.picRankRewardPanel){var n=this.content.width,o=this.content.height-50*this.dpr;this.picRankRewardPanel=new u.PicBusinessRankRewardPanel(this.scene,0,0,n,o,this.dpr,this.scale,this.key,this.key2),this.picRankRewardPanel.setHandler(new s.a(this,(function(){t.hideRankRewardPanel(),t.openRankingDetailPanel()})))}this.content.add(this.picRankRewardPanel),this.picRankRewardPanel.resetMask()},PicBusinessStreetPanel.prototype.hideRankRewardPanel=function(){this.content.remove(this.picRankRewardPanel)},PicBusinessStreetPanel.prototype.setContentSize=function(t,e){var i=this.scaleWidth,n=this.scaleHeight,o=295*this.dpr,r=n-t-e,s=t+.5*r,a=.5*i;this.content.setPosition(a,s),this.content.setContentSize(o,r)},PicBusinessStreetPanel.prototype.OnCloseHandler=function(){this.emit("hide")},PicBusinessStreetPanel.prototype.onSelectItemHandler=function(t){},PicBusinessStreetPanel.prototype.getRichLabel=function(t,e){return void 0===e&&(e="#2B4BB5"),"[stroke="+e+"][color="+e+"]"+t+":[/color][/stroke]"},PicBusinessStreetPanel.prototype.getspaceStr=function(t){for(var e="",i=0;i<t;i++)e+=" ";return e},PicBusinessStreetPanel}(o.BasePanel);e.default=g},function(t,e,i){"use strict";i.r(e),i.d(e,"PicHouse",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicHouse(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicHouse,t),PicHouse.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ROOM_INFO,this.onRetRoomInfoHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_QUERY_ROOM_REFURBISH_REQUIREMENTS,this.on_REFURBISH_REQUIREMENTS))},PicHouse.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicHouse.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicHouse.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicHouse.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicHouse.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicHouse.prototype.sendEnterDecorate=function(){this.connection&&this.connection.send(new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER))},PicHouse.prototype.queryRoomInfo=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_ROOM_INFO);e.content.roomId=t,this.connection.send(e)},PicHouse.prototype.query_REFURBISH_REQUIREMENTS=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_ROOM_REFURBISH_REQUIREMENTS);e.content.id=t,this.connection.send(e)},PicHouse.prototype.query_ROOM_REFURBISH=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_ROOM_REFURBISH);e.content.id=t,this.connection.send(e)},PicHouse.prototype.onRetRoomInfoHandler=function(t){var e=t.content;this.mEvent.emit("roominfo",e)},PicHouse.prototype.on_REFURBISH_REQUIREMENTS=function(t){var e=t.content;this.mEvent.emit("refurbish",e)},PicHouse}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicHouseInfoPanel",(function(){return c}));var n,o=i(113),r=i(114),s=i(115),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicHouseInfoPanel(e,i,n,o,r,s,a){var h=t.call(this,e,i,n)||this;return h.key=s,h.dpr=a,h.setSize(o,r),h.createAttribute(),h}return h(PicHouseInfoPanel,t),PicHouseInfoPanel.prototype.setAttributeData=function(t){this.roomname.setTextInfo(r.a.t("room_info.roomname"),t.name);var e=0,i=0,n=0;t.roomLevel&&(e=t.roomLevel.level,i=t.roomLevel.currentLevelExp?t.roomLevel.currentLevelExp:0,n=t.roomLevel.nextLevelExp?t.roomLevel.nextLevelExp:0),this.roomlevel.setImageInfo(r.a.t("room_info.roomlevel"),s.UIAtlasKey.common2Key,this.getLevelImgs(e));var o="[color=#0D8288]"+i+"[/color]/"+n;if(this.expvalue.setTextInfo(r.a.t("room_info.expvalue"),o),this.popvalue.setTextInfo(r.a.t("room_info.popvalue"),t.popularity+""),this.goodvalue.setTextInfo(r.a.t("room_info.goodvalue"),t.praise+""),"store"===t.roomType){this.compviness.visible=!0,this.turnover.visible=!0,this.deprecia.visible=!0,this.compviness.setTextInfo(r.a.t("room_info.compveness"),t.competitiveness+"");var a="";a=t.turnoverProp.tempValue>0?t.turnoverProp.value+"(+"+t.turnoverProp.tempValue+")":t.turnoverProp.tempValue<0?t.turnoverProp.value+"[color=#ff0000]("+t.turnoverProp.tempValue+")[/color]":""+t.turnoverProp.value,this.turnover.setTextInfo(r.a.t("room_info.turnover"),a),this.deprecia.setTextInfo(r.a.t("room_info.depreciation"),Math.floor(100*t.undepreciated)+"%"),this.add([this.compviness,this.turnover,this.deprecia])}else this.compviness.visible=!1,this.turnover.visible=!1,this.deprecia.visible=!1,this.remove([this.compviness,this.turnover,this.deprecia])},PicHouseInfoPanel.prototype.setHandler=function(t){this.equirementsHandler=t},PicHouseInfoPanel.prototype.createAttribute=function(){var t=.5*-this.height+10*this.dpr,e=20*this.dpr,i=this.width,n=20*this.dpr+e;this.roomname=new l(this.scene,0,t,i,e,this.dpr),t+=n,this.roomlevel=new l(this.scene,0,t,i,e,this.dpr),t+=n,this.expvalue=new l(this.scene,0,t,i,e,this.dpr),t+=n,this.popvalue=new l(this.scene,0,t,i,e,this.dpr),t+=n,this.goodvalue=new l(this.scene,0,t,i,e,this.dpr),t+=n,this.compviness=new l(this.scene,0,t,i,e,this.dpr),t+=n,this.turnover=new l(this.scene,0,t,i,e,this.dpr),t+=n,this.deprecia=new l(this.scene,0,t,i,e,this.dpr),this.renovateBtn=new a.Button(this.scene,s.UIAtlasKey.commonKey,"order_yellow_butt","order_yellow_butt",r.a.t("room_info.renovate")),this.renovateBtn.scale=1.1,this.renovateBtn.setTextStyle({fontSize:12*this.dpr,color:"#ED7814"}),this.renovateBtn.on(String(a.ClickEvent.Tap),this.onRenovateHandler,this),this.renovateBtn.x=.5*this.width-60*this.dpr,this.help=new a.Button(this.scene,s.UIAtlasKey.common2Key,"icon_tips","icon_tips"),this.help.x=.5*this.width-20*this.dpr,this.deprecia.add([this.renovateBtn,this.help]),this.add([this.roomname,this.roomlevel,this.expvalue,this.popvalue,this.goodvalue])},PicHouseInfoPanel.prototype.onRenovateHandler=function(){this.equirementsHandler&&this.equirementsHandler.run()},PicHouseInfoPanel.prototype.getLevelImgs=function(t){t=t||0;for(var e=[],i=Math.floor(t/Math.pow(4,3)),n=t%Math.pow(4,3),o=Math.floor(n/Math.pow(4,2)),r=n%Math.pow(4,2),s=Math.floor(r/Math.pow(4,1)),a=r%Math.pow(4,1),h=0;h<i;h++)e.push("bear");for(h=0;h<o;h++)e.push("sun");for(h=0;h<s;h++)e.push("moon");for(h=0;h<a;h++)e.push("star");return 0===t&&e.push("star"),e},PicHouseInfoPanel.prototype.getpopImgs=function(){return["popularity","popularity","popularity","popularity","popularity"]},PicHouseInfoPanel.prototype.getgoodImgs=function(){return["good","good","good","good1","good1"]},PicHouseInfoPanel}(Phaser.GameObjects.Container),l=function(t){function HouseAttributeValue(e,i,n,r,s,h){var c=t.call(this,e,i,n)||this;return c.dpr=h,c.setSize(r,s),c.nameText=c.scene.make.text({x:.5*-r+15*h,y:0,text:"",style:{fontFamily:o.a.BOLD_FONT,fontSize:14*h,bold:!0,color:"#FFC51A"}}).setOrigin(0,.5).setResolution(h),c.valueText=new a.BBCodeText(c.scene,0,0,"",{color:"#000000",fontSize:13*c.dpr,fontFamily:o.a.DEFULT_FONT}).setOrigin(0,.5).setResolution(h),c.imgCon=c.scene.make.container(void 0,!1),c.imgCon.x=10*h,c.add([c.nameText,c.valueText,c.imgCon]),c}return h(HouseAttributeValue,t),HouseAttributeValue.prototype.setTextInfo=function(t,e){this.nameText.text=t,this.valueText.text=e},HouseAttributeValue.prototype.setImageInfo=function(t,e,i){this.nameText.text=t;for(var n=0,o=10*this.dpr,r=0,s=i;r<s.length;r++){var a=s[r],h=this.scene.make.image({key:e,frame:a});h.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),h.x=n,n+=.5*h.width+o,this.imgCon.add(h)}this.valueText.visible=!1},HouseAttributeValue}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicHousePanel",(function(){return u}));var n,o=i(112),r=i(114),s=i(113),a=i(115),h=i(127),c=i(296),l=i(109),p=i(120),d=i(298),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function PicHousePanel(e,i){var n=t.call(this,e,i)||this;return n.key="pichousepanel",n}return m(PicHousePanel,t),PicHousePanel.prototype.resize=function(t,e){this.scale;var i=this.scaleWidth,n=this.scaleHeight;this.content.x=.5*i,this.content.y=.5*n,this.setSize(i,n),this.itemsPanel.y=.5*this.height-60*this.dpr,this.itemsPanel.x=.5*this.width},PicHousePanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen(),this.updateData()):this.preload())},PicHousePanel.prototype.hide=function(){this.mShow=!1,this.removeListen()},PicHousePanel.prototype.addListen=function(){this.mInitialized&&(this.closeBtn.on("pointerup",this.onCloseHandler,this),this.editorRoomBtn.on("pointerup",this.onEnterEditorHandler,this))},PicHousePanel.prototype.removeListen=function(){this.mInitialized&&(this.closeBtn.off("pointerup",this.onCloseHandler,this),this.editorRoomBtn.off("pointerup",this.onEnterEditorHandler,this))},PicHousePanel.prototype.destroy=function(){t.prototype.destroy.call(this)},PicHousePanel.prototype.setRoomInfoData=function(t,e){if(void 0===e&&(e=!0),this.mRoomInfoData=t,this.mInitialized){var i=295*this.dpr,n=370*this.dpr;"store"===t.roomType?(n=460*this.dpr,this.content.setSize(i,n),this.bg.resize(i,n),this.closeShopBtn.visible=!0,this.roomInfoBtn.y=.5*-this.content.height-.5*this.roomInfoBtn.height+5*this.dpr,this.roomSettingBtn.y=this.roomInfoBtn.y,this.closeBtn.y=.5*-this.bg.height+5*this.dpr,this.editorRoomBtn.y=.5*this.content.height-30*this.dpr,this.houseInfoPanel.y=.5*-this.content.height+.5*this.houseInfoPanel.height+30*this.dpr,this.closeShopBtn.on(String(l.ClickEvent.Tap),this.onCloseShopHandler,this)):this.closeShopBtn.visible=!1,this.houseInfoPanel.setAttributeData(t),this.roomSettingBtn.visible=e,this.editorRoomBtn.visible=e}},PicHousePanel.prototype.on_REFURBISH_REQUIREMENTS=function(t){var e=this;this.itemsPanel.setHandler(new p.a(this,(function(){e.emit("queryrefurbish",e.mRoomInfoData.roomId)}))),this.itemsPanel.setItemDatas(t.requirements)},PicHousePanel.prototype.preload=function(){this.addAtlas(this.key,"room_information/room_information.png","room_information/room_information.json"),this.addAtlas(a.UIAtlasKey.commonKey,a.UIAtlasName.commonUrl+".png",a.UIAtlasName.commonUrl+".json"),this.addAtlas(a.UIAtlasKey.common2Key,a.UIAtlasName.common2Url+".png",a.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicHousePanel.prototype.init=function(){var e=this;if(!this.mInitialized){var i=this.scaleWidth,n=this.scaleHeight;this.mBackground=this.scene.make.graphics(void 0,!1),this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.mBackground.fillStyle(0,.66),this.mBackground.fillRect(0,0,i,n),this.add(this.mBackground),this.content=this.scene.make.container(void 0,!1);var o=295*this.dpr,m=370*this.dpr;this.content.setSize(o,m),this.bg=new l.NineSlicePatch(this.scene,0,0,o,m,a.UIAtlasKey.common2Key,"bg",{left:20*this.dpr,top:20*this.dpr,right:20*this.dpr,bottom:60*this.dpr}),this.content.add(this.bg),this.closeBtn=this.scene.make.image({x:.5*this.bg.width-5*this.dpr,y:.5*-this.bg.height+5*this.dpr,key:a.UIAtlasKey.commonKey,frame:"close"}).setScale(1.3),this.closeBtn.setInteractive(),this.closeBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.content.add([this.closeBtn]),this.roomInfoBtn=this.createTabButton(r.a.t("room_info.infobtn"),"small_information"),this.roomSettingBtn=this.createTabButton(r.a.t("room_info.setting"),"small_setting"),this.roomInfoBtn.setPosition(.5*-this.roomInfoBtn.width-2*this.dpr,.5*-this.content.height-.5*this.roomInfoBtn.height+3*this.dpr),this.roomSettingBtn.setPosition(.5*this.roomSettingBtn.width+2*this.dpr,this.roomInfoBtn.y),this.topCheckBox=new h.CheckboxGroup,this.topCheckBox.appendItemAll([this.roomInfoBtn,this.roomSettingBtn]),this.topCheckBox.on("selected",this.onTabBtnHandler,this),this.content.add([this.roomInfoBtn,this.roomSettingBtn]),this.houseInfoPanel=new c.PicHouseInfoPanel(this.scene,0,0,this.content.width-40*this.dpr,this.content.height-70*this.dpr,this.key,this.dpr),this.houseInfoPanel.y=.5*-this.content.height+.5*this.houseInfoPanel.height+30*this.dpr,this.houseInfoPanel.setHandler(new p.a(this,(function(){e.itemsPanel.visible=!0,e.add(e.itemsPanel),e.itemsPanel.resetMask(),e.mRoomInfoData.undepreciated<1?e.emit("queryrequirements",e.mRoomInfoData.roomId):(e.itemsPanel.setContent(r.a.t("room_info.renovatetips")),e.itemsPanel.setHandler(null))}))),this.content.add(this.houseInfoPanel),this.closeShopBtn=new l.NineSliceButton(this.scene,0,this.houseInfoPanel.height-30*this.dpr,94*this.dpr,29*this.dpr,this.key,"close_shop",r.a.t("room_info.closeshop"),this.dpr,this.scale,{left:14*this.dpr,top:0*this.dpr,right:14*this.dpr,bottom:0*this.dpr}),this.closeShopBtn.setTextStyle({color:"#C12914",fontSize:12*this.dpr,fontFamily:s.a.BOLD_FONT});var u=this.houseInfoPanel.y+.5*this.houseInfoPanel.height+.5*this.closeShopBtn.height+20*this.dpr;this.closeShopBtn.y=u,this.houseInfoPanel.add(this.closeShopBtn),this.closeShopBtn.visible=!1;var f=.5*this.content.height;this.editorRoomBtn=new l.NineSliceButton(this.scene,0,f-30*this.dpr,100*this.dpr,35*this.dpr,a.UIAtlasKey.commonKey,"button_g",r.a.t("room_info.editorroom"),this.dpr,this.scale,{left:16*this.dpr,top:16*this.dpr,right:16*this.dpr,bottom:16*this.dpr}),this.editorRoomBtn.setTextStyle({color:"#022B55",fontSize:12*this.dpr,fontFamily:s.a.BOLD_FONT}),this.editorRoomBtn.setTextOffset(10*this.dpr,0);var y=.5*-this.editorRoomBtn.width+8*this.dpr,g=this.scene.make.image({x:y,y:-3*this.dpr,key:this.key,frame:"renovation"});this.editorRoomBtn.add(g),this.content.add(this.editorRoomBtn),this.editorRoomBtn.visible=!1,this.topCheckBox.selectIndex(0),this.itemsPanel=new d.ItemsConsumeFunPanel(this.scene,278*this.dpr,198*this.dpr,this.dpr,this.scale),this.itemsPanel.createBackGrphaic(i,n),this.itemsPanel.setTextInfo(r.a.t("room_info.renovate").toUpperCase(),r.a.t("compose.needMaterials")),this.itemsPanel.visible=!1,this.add(this.content),this.resize(0,0),t.prototype.init.call(this)}},PicHousePanel.prototype.updateData=function(){this.mRoomInfoData&&this.setRoomInfoData(this.mRoomInfoData)},PicHousePanel.prototype.onTabBtnHandler=function(t){this.roomInfoBtn===t?this.houseInfoPanel.visible=!0:this.houseInfoPanel.visible=!1,this.roomSettingBtn===t&&(this.houseInfoPanel.visible=!1)},PicHousePanel.prototype.createTabButton=function(t,e){var i=new l.TabButton(this.scene,this.key,"default tab","check tab",t);i.setTextStyle({fontFamily:s.a.BOLD_FONT,fontSize:12*this.dpr,color:"#ffffff"}),i.setTextOffset(13*this.dpr,0);var n=this.scene.make.image({key:this.key,frame:e});return i.add(n),n.x=.5*-i.width+.5*n.width+7*this.dpr,i},PicHousePanel.prototype.onCloseShopHandler=function(){this.emit("closeshop",this.mRoomInfoData)},PicHousePanel.prototype.onCloseHandler=function(){this.emit("hide")},PicHousePanel.prototype.onEnterEditorHandler=function(){this.emit("scenedecorate")},PicHousePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemsConsumeFunPanel",(function(){return d}));var n,o=i(114),r=i(113),s=i(129),a=i(115),h=i(116),c=i(111),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function ItemsConsumeFunPanel(e,i,n,o,r,s){void 0===s&&(s=!0);var a=t.call(this,e)||this;return a.materialItems=[],a.havebutton=!0,a.isEnough=!1,a.dpr=o,a.zoom=r,a.havebutton=s,a.setSize(i,n),a.create(),a}return p(ItemsConsumeFunPanel,t),ItemsConsumeFunPanel.prototype.createBackGrphaic=function(t,e){this.mblackGraphic=this.scene.make.graphics(void 0,!1),this.mblackGraphic.setInteractive(new Phaser.Geom.Rectangle(0,0,t,e),Phaser.Geom.Rectangle.Contains),this.mblackGraphic.fillStyle(0,.66),this.mblackGraphic.fillRect(.5*-t,.5*-e+this.y,t,e),this.addAt(this.mblackGraphic,0)},ItemsConsumeFunPanel.prototype.resetMask=function(){this.gameScroll.refreshMask()},ItemsConsumeFunPanel.prototype.setHandler=function(t){this.confirmHandler=t},ItemsConsumeFunPanel.prototype.setTextInfo=function(t,e,i){this.title.text=t,this.materialTitle.text=e,this.materialLine.x=this.materialTitle.x-.5*this.materialTitle.width-5*this.dpr-.5*this.materialLine.width,this.materialLine2.x=this.materialTitle.x+.5*this.materialTitle.width+5*this.dpr+.5*this.materialLine2.width,this.havebutton&&void 0!==i&&this.confirmBtn.setText(i)},ItemsConsumeFunPanel.prototype.setItemDatas=function(t){this.gameScroll.visible=!0,this.gameScroll.clearItems(!1);for(var e=0,i=this.materialItems;e<i.length;e++){(o=i[e]).visible=!1}this.isEnough=!0;for(var n=0;n<t.length;n++){var o=void 0,r=t[n];n<this.materialItems.length?o=this.materialItems[n]:(o=new m(this.scene,this.dpr),this.materialItems.push(o)),o.visible=!0,o.setItemData(r),this.gameScroll.addItem(o),r.neededCount>r.count&&(this.isEnough=!1)}this.gameScroll.Sort()},ItemsConsumeFunPanel.prototype.setContent=function(t){this.contentTitle.visible=!0,this.contentTitle.text=t,this.gameScroll.visible=!1},ItemsConsumeFunPanel.prototype.create=function(){var t=this,e=this.scene.make.image({key:a.UIAtlasKey.common2Key,frame:"bg_universal_box"});this.add(e),this.setSize(e.width,e.height),this.title=this.scene.make.text({x:0,y:.5*-this.height+25*this.dpr,text:"",style:{color:"#FFC51A",fontSize:13*this.dpr,fontFamily:r.a.BOLD_FONT}},!1).setOrigin(.5),this.add(this.title),this.closeBtn=new l.Button(this.scene,a.UIAtlasKey.commonKey,"close","close"),this.closeBtn.setPosition(.5*this.width-5*this.dpr,.5*-this.height+5*this.dpr).setScale(1.3),this.closeBtn.on(String(l.ClickEvent.Tap),this.onCloseHandler,this),this.add(this.closeBtn);var i=this.havebutton?0:20*this.dpr;this.materialTitle=this.scene.make.text({x:0,y:.5*-this.height+45*this.dpr+i,text:"",bold:!0,style:{color:"#263FCB",fontSize:13*this.dpr,fontFamily:r.a.DEFULT_FONT,wordWrap:{width:90*this.dpr,useAdvancedWrap:!0}}},!1).setOrigin(.5),this.materialLine=this.scene.make.image({x:-10*this.dpr,y:this.materialTitle.y,key:a.UIAtlasKey.common2Key,frame:"line_left"}),this.materialLine2=this.scene.make.image({x:10*this.dpr,y:this.materialTitle.y,key:a.UIAtlasKey.common2Key,frame:"line_right"}),this.add([this.materialTitle,this.materialLine,this.materialLine2]),this.gameScroll=new l.GameScroller(this.scene,{x:0,y:-10*this.dpr+i,width:this.width-40*this.dpr,height:90*this.dpr,zoom:this.zoom,align:2,orientation:1,dpr:this.dpr,cellupCallBack:function(e){t.onMaterialItemHandler(e)}}),this.add(this.gameScroll),this.contentTitle=this.scene.make.text({x:0,y:-10*this.dpr+i,text:"",style:{color:"#FFC51A",fontSize:15*this.dpr,fontFamily:r.a.BOLD_FONT}},!1).setOrigin(.5),this.add(this.contentTitle),this.contentTitle.visible=!1,this.havebutton&&(this.confirmBtn=new l.NineSliceButton(this.scene,0,0,106*this.dpr,40*this.dpr,a.UIAtlasKey.commonKey,"yellow_btn",o.a.t("common.confirm"),this.dpr,1,{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr}),this.confirmBtn.y=.5*this.height-.5*this.confirmBtn.height-15*this.dpr,this.confirmBtn.setTextStyle({fontSize:16*this.dpr,color:"#996600"}),this.confirmBtn.on(String(l.ClickEvent.Tap),this.onConfirmHandler,this),this.add(this.confirmBtn));var n=145*this.dpr,h=55*this.dpr;this.itemtips=new s.ItemInfoTips(this.scene,n,h,a.UIAtlasKey.common2Key,"tips_bg",this.dpr,{left:10*this.dpr,top:10*this.dpr,right:10*this.dpr,bottom:10*this.dpr}),this.itemtips.x=.5*-this.width+.5*n+10*this.dpr,this.itemtips.y=.5*-this.height+70*this.dpr,this.itemtips.visible=!1,this.add(this.itemtips)},ItemsConsumeFunPanel.prototype.onConfirmHandler=function(){this.onCloseHandler(),this.confirmHandler&&this.isEnough&&this.confirmHandler.run()},ItemsConsumeFunPanel.prototype.onCloseHandler=function(){this.visible=!1,this.gameScroll.clearItems(!1),this.gameScroll.visible=!1,this.contentTitle.visible=!1,this.parentContainer&&this.parentContainer.remove(this)},ItemsConsumeFunPanel.prototype.onMaterialItemHandler=function(t){this.itemtips.visible=!1,this.curSelectItem&&this.curSelectItem!==t&&(this.curSelectItem.select=!1),t.select=!t.select,t.select&&(this.itemtips.setItemData(t.itemData),this.itemtips.visible=!0),this.curSelectItem=t,this.setTipsPosition(t)},ItemsConsumeFunPanel.prototype.setTipsPosition=function(t){for(var e=t.x,i=t.y,n=t;n.parentContainer!==this;)e+=n.parentContainer.x,i+=n.parentContainer.y,n=n.parentContainer;e-.5*this.itemtips.width<.5*-this.width?this.itemtips.x=.5*this.itemtips.width-.5*this.width:e+.5*this.itemtips.width>.5*this.width?this.itemtips.x=.5*this.width-.5*this.itemtips.width:this.itemtips.x=e,this.itemtips.y=i-.5*this.itemtips.height+5*this.dpr},ItemsConsumeFunPanel}(Phaser.GameObjects.Container),m=function(t){function MaterialItem(e,i){var n=t.call(this,e)||this;return n.mselect=!1,n.dpr=i,n.bg=n.scene.make.image({key:a.UIAtlasKey.common2Key,frame:"material_unchecked"}),n.itemIcon=new h.DynamicImage(e,0,0),n.itemCount=new l.BBCodeText(n.scene,0,15*i,"10/20",{color:"#000000"}).setOrigin(.5).setFontSize(11*i).setFontFamily(r.a.DEFULT_FONT),n.add([n.bg,n.itemIcon,n.itemCount]),n.setSize(n.bg.width,n.bg.height),n.itemCount.y=.5*n.height+8*i,n}return p(MaterialItem,t),MaterialItem.prototype.setItemData=function(t){var e=this;this.itemData=t,this.itemCount.text=this.getCountText(t.count,t.neededCount);var i=c.i.getOsdRes(t.display.texturePath);this.itemIcon.load(i,this,(function(){e.itemIcon.scale=e.dpr,e.itemIcon.setPosition(0,0)}))},Object.defineProperty(MaterialItem.prototype,"select",{get:function(){return this.mselect},set:function(t){this.mselect=t,this.bg.setFrame(t?"material_checked":"material_unchecked")},enumerable:!1,configurable:!0}),MaterialItem.prototype.getCountText=function(t,e){var i=t>=e?"#000000":"#ff0000";return"[stroke="+i+"][color="+i+"]"+t+"[/color][/stroke]/"+e},MaterialItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicOpenParty",(function(){return s}));var n,o=i(110),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function PicOpenParty(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return r(PicOpenParty,t),PicOpenParty.prototype.register=function(){this.connection&&this.connection.addPacketListener(this)},PicOpenParty.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicOpenParty.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicOpenParty.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicOpenParty.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicOpenParty.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicOpenParty}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicOpenPartyCreatePanel",(function(){return l}));var n,o=i(109),r=i(114),s=i(113),a=i(116),h=i(115),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicOpenPartyCreatePanel(e,i,n,o,r,s,a){var h=t.call(this,e,i,n)||this;return h.itemCount=0,h.key=s,h.dpr=a,h.setSize(o,r),h.create(),h.setPartyData(),h}return c(PicOpenPartyCreatePanel,t),PicOpenPartyCreatePanel.prototype.resize=function(){this.gamegride&&this.gamegride.resetMask()},PicOpenPartyCreatePanel.prototype.hide=function(){this.visible=!1,this.describleInput.visible=!1,this.describleInput.node.style.display="none",this.mNameInput.visible=!1,this.mNameInput.node.style.display="none",this.openBtn.off(String(o.ClickEvent.Tap),this.onOpenPartyHandler,this)},PicOpenPartyCreatePanel.prototype.show=function(){this.visible=!0,this.describleInput.visible=!0,this.describleInput.node.style.display="true",this.mNameInput.visible=!0,this.mNameInput.node.style.display="true",this.openBtn.on(String(o.ClickEvent.Tap),this.onOpenPartyHandler,this)},PicOpenPartyCreatePanel.prototype.setPartyData=function(){this.timeSlider.setValue(50,0,100),this.gamegride.setItems(new Array(60))},PicOpenPartyCreatePanel.prototype.create=function(){var t=this;this.partyNameTitle=this.scene.make.text({x:.5*-this.width+10*this.dpr,y:.5*-this.height+20*this.dpr,text:r.a.t("party.partyname"),style:{fontFamily:s.a.DEFULT_FONT,fontSize:11*this.dpr,bold:!0,color:"#000000"}}),this.partyNameTitle.setOrigin(0,.5).setResolution(this.dpr),this.partyNameTitle.setStroke("#000000",2),this.add(this.partyNameTitle),this.mNameInput=this.createInput(this.partyNameTitle.x+this.partyNameTitle.width+5*this.dpr,this.partyNameTitle.y,203*this.dpr,37*this.dpr),this.partyThemeTitle=this.scene.make.text({x:this.partyNameTitle.x,y:this.partyNameTitle.y+60*this.dpr,text:r.a.t("party.partytheme"),style:{fontFamily:s.a.DEFULT_FONT,fontSize:11*this.dpr,bold:!0,color:"#000000"}}),this.partyThemeTitle.setOrigin(0,.5).setResolution(this.dpr),this.partyThemeTitle.setStroke("#000000",2),this.add(this.partyThemeTitle);var e={x:20*this.dpr,y:this.partyThemeTitle.y,table:{width:207*this.dpr,height:90*this.dpr,columns:1,cellWidth:70*this.dpr,cellHeight:70*this.dpr,reuseCellContainer:!0,zoom:this.scale},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(e,i){e.scene,e.index,e.item;return null===i&&(i=new p(t.scene,65*t.dpr,70*t.dpr,t.key,t.dpr)),i.setThemeData(),i}};this.gamegride=new o.GameGridTable(this.scene,e),this.gamegride.layout(),this.add(this.gamegride),this.describleTitle=this.scene.make.text({x:this.partyThemeTitle.x,y:this.partyThemeTitle.y+60*this.dpr,text:r.a.t("party.partydescrible"),style:{fontFamily:s.a.DEFULT_FONT,fontSize:11*this.dpr,bold:!0,color:"#000000"}}),this.describleTitle.setOrigin(0,.5).setResolution(this.dpr),this.describleTitle.setStroke("#000000",2),this.add(this.describleTitle),this.describleInput=this.createInput(this.describleTitle.x+this.describleTitle.width+5*this.dpr,this.describleTitle.y+10*this.dpr,203*this.dpr,52*this.dpr,"textarea"),this.partyTimeTitle=this.scene.make.text({x:this.describleTitle.x,y:this.describleTitle.y+80*this.dpr,text:r.a.t("party.partytime"),style:{fontFamily:s.a.DEFULT_FONT,fontSize:11*this.dpr,bold:!0,color:"#000000"}}),this.partyTimeTitle.setOrigin(0,.5).setResolution(this.dpr),this.partyTimeTitle.setStroke("#000000",2),this.add(this.partyTimeTitle);var i=200*this.dpr,n=4*this.dpr,c=this.partyTimeTitle.x+this.partyTimeTitle.width+5*this.dpr+.5*i;this.createSlider(c,this.partyTimeTitle.y,i,n),this.partyTimeLable=this.scene.make.text({x:this.partyTimeTitle.x,y:this.partyTimeTitle.y+60*this.dpr,text:r.a.t("party.partycardlabel"),style:{fontFamily:s.a.DEFULT_FONT,fontSize:11*this.dpr,bold:!0,color:"#000000"}}),this.partyTimeLable.setOrigin(0,.5).setResolution(this.dpr),this.add(this.partyTimeLable),this.partyCardImage=new a.DynamicImage(this.scene,this.partyTimeLable.x+this.partyTimeLable.width,this.partyTimeLable.y),this.add(this.partyCardImage),this.partyTimevalue=this.scene.make.text({x:this.partyCardImage.x,y:this.partyCardImage.y,text:"",style:{fontFamily:s.a.DEFULT_FONT,fontSize:14*this.dpr,bold:!0,color:"#000000"}}),this.partyTimevalue.setOrigin(0,.5).setResolution(this.dpr),this.partyTimevalue.setStroke("#000000",2),this.add(this.partyTimevalue),this.openBtn=new o.NineSliceButton(this.scene,0,.5*this.height+2*this.dpr,100*this.dpr,33*this.dpr,h.UIAtlasKey.commonKey,"yellow_btn_normal",r.a.t("party.partyopen"),this.dpr,this.scale,{left:14*this.dpr,top:0*this.dpr,right:14*this.dpr,bottom:0*this.dpr}),this.openBtn.setTextStyle({color:"#996600",fontSize:13*this.dpr,fontFamily:s.a.BOLD_FONT}),this.add(this.openBtn)},PicOpenPartyCreatePanel.prototype.createSlider=function(t,e,i,n){var r=new o.NineSlicePatch(this.scene,0,0,8,7*this.dpr,h.UIAtlasKey.common2Key,"slider_bg",{left:3,top:1,right:3,bottom:1}),a=new o.NineSlicePatch(this.scene,0,0,8,7*this.dpr,h.UIAtlasKey.common2Key,"slider_rate",{left:3,top:1,right:3,bottom:1});this.thumb=this.scene.make.image({key:h.UIAtlasKey.common2Key,frame:"block"}),this.itemCountText=this.scene.make.text({x:0,y:0,style:{color:"#744803",fontSize:12*this.dpr,fontFamily:s.a.DEFULT_FONT,bold:!0}},!1).setOrigin(.5),this.timeSlider=new o.GameSlider(this.scene,{x:t,y:e,width:i,height:n,orientation:1,background:r,indicator:a,thumb:this.thumb,offsetX:.5*this.thumb.width,valuechangeCallback:this.onSliderValueHandler,valuechangeCallbackScope:this,value:.5}),this.timeSlider.add(this.itemCountText),this.timeSlider.setValue(0),this.add(this.timeSlider)},PicOpenPartyCreatePanel.prototype.onSliderValueHandler=function(t){this.itemCountText.x=this.thumb.x,this.itemCountText.text=Math.floor(100*t)+"",this.itemCount=t},PicOpenPartyCreatePanel.prototype.onOpenPartyHandler=function(){},PicOpenPartyCreatePanel.prototype.createInput=function(t,e,i,n,s){void 0===s&&(s="text");var a=this.scene.make.graphics(void 0,!1);a.fillStyle(10809331,.66),a.fillRect(0,.5*-n,i,n),a.setPosition(t,e),this.add(a);var h=new o.InputText(this.scene,t+.5*i,e,i,n-10*this.dpr,{type:s,placeholder:r.a.t("party.partydescrible"),color:"#055C62",fontSize:14*this.dpr+"px"});return this.add(h),h},PicOpenPartyCreatePanel}(Phaser.GameObjects.Container),p=function(t){function PicPartyThemeItem(e,i,n,o,r){var h=t.call(this,e)||this;return h.dpr=r,h.setSize(i,n),h.icon=new a.DynamicImage(e,0,0),h.icon.setTexture(o,"party_icon_1"),h.value=e.make.text({x:0,y:0,text:"10",style:{color:"#333333",fontSize:11*r,fontFamily:s.a.DEFULT_FONT}}),h.value.setOrigin(.5,0),h.value.y=.5*h.height-10*r,h.value.setWordWrapWidth(h.width,!0),h.add([h.icon,h.value]),h}return c(PicPartyThemeItem,t),PicPartyThemeItem.prototype.setThemeData=function(){this.value.text="发生四点山豆根士大夫敢死队风格去问人体温热太温柔额我让他为人体微软他"},PicPartyThemeItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicOpenPartyPanel",(function(){return d}));var n,o=i(112),r=i(114),s=i(113),a=i(115),h=i(127),c=i(109),l=i(300),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function PicOpenPartyPanel(e,i){var n=t.call(this,e,i)||this;return n.key="picpartypanel",n}return p(PicOpenPartyPanel,t),PicOpenPartyPanel.prototype.resize=function(t,e){this.scale;var i=this.scaleWidth,n=this.scaleHeight;this.content.x=.5*i,this.content.y=.5*n,this.setSize(i,n),this.partyCreatePanel.resize()},PicOpenPartyPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen(),this.updateData()):this.preload())},PicOpenPartyPanel.prototype.addListen=function(){this.mInitialized&&this.closeBtn.on("pointerup",this.onCloseHandler,this)},PicOpenPartyPanel.prototype.removeListen=function(){this.mInitialized&&this.closeBtn.off("pointerup",this.onCloseHandler,this)},PicOpenPartyPanel.prototype.destroy=function(){this.removeListen(),t.prototype.destroy.call(this)},PicOpenPartyPanel.prototype.setPartyData=function(t,e){void 0===e&&(e=!0),this.mPartyData=t,this.mInitialized&&(this.settingBtn.visible=e)},PicOpenPartyPanel.prototype.preload=function(){this.addAtlas(this.key,"party/party.png","party/party.json"),this.addAtlas(a.UIAtlasKey.commonKey,a.UIAtlasName.commonUrl+".png",a.UIAtlasName.commonUrl+".json"),this.addAtlas(a.UIAtlasKey.common2Key,a.UIAtlasName.common2Url+".png",a.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicOpenPartyPanel.prototype.init=function(){if(!this.mInitialized){var e=this.scaleWidth,i=this.scaleHeight;this.mBackground=this.scene.make.graphics(void 0,!1),this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,e,i),Phaser.Geom.Rectangle.Contains),this.mBackground.fillStyle(0,.66),this.mBackground.fillRect(0,0,e,i),this.add(this.mBackground),this.content=this.scene.make.container(void 0,!1);var n=295*this.dpr,o=450*this.dpr;this.content.setSize(n,o),this.bg=new c.NineSlicePatch(this.scene,0,0,n,o,a.UIAtlasKey.common2Key,"bg",{left:20*this.dpr,top:20*this.dpr,right:20*this.dpr,bottom:60*this.dpr}),this.content.add(this.bg),this.closeBtn=this.scene.make.image({x:.5*this.bg.width-5*this.dpr,y:.5*-this.bg.height+5*this.dpr,key:a.UIAtlasKey.commonKey,frame:"close"}).setScale(1.3),this.closeBtn.setInteractive(),this.closeBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.content.add([this.closeBtn]),this.partyBtn=this.createTabButton(r.a.t("main_ui.party")),this.settingBtn=this.createTabButton(r.a.t("common.setting")),this.partyBtn.setPosition(.5*-this.partyBtn.width-2*this.dpr,.5*-this.content.height-.5*this.partyBtn.height+3*this.dpr),this.settingBtn.setPosition(.5*this.settingBtn.width+2*this.dpr,this.partyBtn.y),this.topCheckBox=new h.CheckboxGroup,this.topCheckBox.appendItemAll([this.partyBtn,this.settingBtn]),this.topCheckBox.on("selected",this.onTabBtnHandler,this),this.content.add([this.partyBtn,this.settingBtn]),this.partyCreatePanel=new l.PicOpenPartyCreatePanel(this.scene,0,0,this.content.width-20*this.dpr,this.content.height-70*this.dpr,this.key,this.dpr),this.partyCreatePanel.y=0,this.content.add(this.partyCreatePanel),this.add(this.content),this.resize(0,0),t.prototype.init.call(this),this.topCheckBox.selectIndex(0)}},PicOpenPartyPanel.prototype.updateData=function(){this.mPartyData&&this.setPartyData(this.mPartyData)},PicOpenPartyPanel.prototype.onTabBtnHandler=function(t){this.partyBtn===t?this.partyCreatePanel.show():this.partyCreatePanel.hide(),this.settingBtn},PicOpenPartyPanel.prototype.createTabButton=function(t){var e=new c.TabButton(this.scene,a.UIAtlasKey.common2Key,"default_tab","check_tab",t);return e.setTextStyle({fontFamily:s.a.BOLD_FONT,fontSize:16*this.dpr,color:"#ffffff"}),e.setTextOffset(0,0),e},PicOpenPartyPanel.prototype.onCloseHandler=function(){this.emit("close")},PicOpenPartyPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicOrder",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicOrder(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicOrder,t),PicOrder.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_ORDER_LIST,this.on_ORDER_LIST),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_QUERY_PLAYER_PROGRESS,this.on_PLAYER_PROGRESS))},PicOrder.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicOrder.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicOrder.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicOrder.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicOrder.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicOrder.prototype.query_ORDER_LIST=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_ORDER_LIST);this.connection.send(t)},PicOrder.prototype.query_CHANGE_ORDER_STAGE=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_CHANGE_ORDER_STAGE),n=i.content;n.index=t,n.op=e,this.connection.send(i)},PicOrder.prototype.query_PLAYER_PROGRESS=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_PLAYER_PROGRESS);this.connection.send(t)},PicOrder.prototype.query_PLAYER_PROGRESS_REWARD=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_TAKE_PLAYER_PROGRESS_REWARD);e.content.index=t,this.connection.send(e)},PicOrder.prototype.on_ORDER_LIST=function(t){var e=t.content;this.mEvent.emit("questlist",e)},PicOrder.prototype.on_PLAYER_PROGRESS=function(t){var e=t.content;this.mEvent.emit("progresslist",e)},PicOrder}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicOrderPanel",(function(){return y}));var n,o=i(112),r=i(113),s=i(2),a=i(115),h=i(114),c=i(116),l=i(120),p=i(111),d=i(135),m=i(109),u=i(129),f=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),y=function(t){function PicOrderPanel(e,i){var n=t.call(this,e,i)||this;return n.key="order_ui",n}return f(PicOrderPanel,t),PicOrderPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,n,o),this.setSize(n,o),this.mBackground.clear(),this.mBackground.fillStyle(0,.5),this.mBackground.fillRoundedRect(-this.x,-this.y,n,o),this.content.x=.5*n,this.content.y=.5*o,this.mGameGrid.resetMask(),this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,n,o),Phaser.Geom.Rectangle.Contains)},PicOrderPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},PicOrderPanel.prototype.addListen=function(){this.mInitialized&&this.closeBtn.on("pointerup",this.OnClosePanel,this)},PicOrderPanel.prototype.removeListen=function(){this.mInitialized&&this.closeBtn.off("pointerup",this.OnClosePanel,this)},PicOrderPanel.prototype.preload=function(){this.addAtlas(this.key,"order/order.png","order/order.json"),this.addAtlas(a.UIAtlasKey.commonKey,a.UIAtlasName.commonUrl+".png",a.UIAtlasName.commonUrl+".json"),this.addAtlas(a.UIAtlasKey.common2Key,a.UIAtlasName.common2Url+".png",a.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicOrderPanel.prototype.init=function(){var e=this;this.mBackground=this.scene.make.graphics(void 0,!1),this.add(this.mBackground);var i=295*this.dpr,n=454*this.dpr;this.content=this.scene.make.container(void 0,!1),this.content.setSize(i,n),this.add(this.content),this.bg=new m.NineSlicePatch(this.scene,0,0,i,n,a.UIAtlasKey.commonKey,"bg",{left:30*this.dpr,top:30*this.dpr,bottom:30*this.dpr,right:30*this.dpr});var o=.5*-n;this.titlebg=this.scene.make.image({x:0,y:0,key:this.key,frame:"order_title_bg"}),this.titlebg.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.titlebg.y=o-.5*this.titlebg.height+2*this.dpr;var s=this.scene.make.image({x:0,y:0,key:this.key,frame:"order_title"});s.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),s.y=this.titlebg.y+34*this.dpr,this.tilteName=this.scene.make.text({x:0,y:o-18*this.dpr,text:h.a.t("order.title"),style:{color:"#905B06",fontSize:15*this.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(.5,0),this.closeBtn=this.scene.make.image({x:.5*i-5*this.dpr,y:o+5*this.dpr,key:a.UIAtlasKey.commonKey,frame:"close"}),this.tilteName.setStroke("#8F4300",2),this.tilteName.setResolution(this.dpr),this.closeBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.closeBtn.setInteractive(),this.orderProgressPanel=new w(this.scene,252*this.dpr,45*this.dpr,this.key,this.dpr),this.orderProgressPanel.y=.5*-n+20*this.dpr,this.orderProgressPanel.setHandler(new l.a(this,this.onProgressHandler));var c={x:0,y:15*this.dpr,table:{width:i-40*this.dpr,height:n-110*this.dpr,columns:1,cellWidth:i-40*this.dpr,cellHeight:70*this.dpr,reuseCellContainer:!0,zoom:this.scale},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,i){t.scene;var n=t.index,o=t.item;return null===i&&((i=new g(e.scene,e.mWorld,e.key,e.dpr)).setHandler(new l.a(e,e.onSendHandler),new l.a(e,e.onRefreshOrderList),new l.a(e,e.onItemInfoTips)),i.on("pointerdown",e.onClickDownHandler,e)),i.setOrderData(o,n),i}};this.mGameGrid=new m.GameGridTable(this.scene,c),this.mGameGrid.layout(),this.goldImageValue=new P(this.scene,50*this.dpr,14*this.dpr,this.key,this.dpr),this.goldImageValue.setFrameValue("",this.key,"order_precious"),this.goldImageValue.setTextStyle({color:"#144B99",fontSize:10*this.dpr,bold:!0,stroke:"#144B99",strokeThickness:4}),this.goldImageValue.y=.5*n-25*this.dpr,this.goldImageValue.visible=!1,this.orderProgressPanel.visible=!1,this.itemtips=new u.ItemInfoTips(this.scene,121*this.dpr,46*this.dpr,a.UIAtlasKey.common2Key,"tips_bg",this.dpr),this.itemtips.visible=!1,this.content.add([this.bg,this.closeBtn,this.titlebg,s,this.tilteName,this.orderProgressPanel,this.mGameGrid,this.goldImageValue,this.itemtips]),this.resize(),t.prototype.init.call(this),this.emit("questlist"),this.emit("questprogress")},PicOrderPanel.prototype.setOrderDataList=function(t){this.goldImageValue.visible=!0,this.orderProgressPanel.visible=!0;var e=t.orders;this.mGameGrid.setItems(e),this.royalOrderLimit=t.royalOrderLimit,this.goldImageValue.setText(this.royalOrderLimit.currentValue+"/"+this.royalOrderLimit.max),this.goldImageValue.resetSize(),this.goldImageValue.x=.5*this.content.width-.5*this.goldImageValue.width-20*this.dpr},PicOrderPanel.prototype.setOrderProgress=function(t){this.progressData=t,this.orderProgressPanel.setProgressDatas(t)},PicOrderPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},PicOrderPanel.prototype.OnClosePanel=function(){this.emit("hide")},PicOrderPanel.prototype.onSendHandler=function(t,e){var i=this;e===s.op_pkt_def.PKT_Order_Operator.PKT_ORDER_DELETE?(this.alertView||(this.alertView=new d.AlertView(this.scene,this.mWorld)),this.parentContainer.add(this.alertView),this.alertView.show({text:h.a.t("order.refreshtips"),title:h.a.t("order.refreshtitle"),oy:302*this.dpr*this.mWorld.uiScale,callback:function(){i.emit("changeorder",t,e)}})):this.emit("changeorder",t,e)},PicOrderPanel.prototype.onProgressHandler=function(t,e){if(this.progressData){var i=e.progressData;i.received||(i.targetValue<=this.progressData.currentProgressValue?this.emit("questreward",t):(this.itemtips.setItemData(i.rewards[0]),this.showItemTipsState(e)))}},PicOrderPanel.prototype.onRefreshOrderList=function(){this.emit("questlist")},PicOrderPanel.prototype.onItemInfoTips=function(t){var e=t.itemData;this.itemtips.setText(this.getDesText(e)),this.showItemTipsState(t,10*this.dpr)},PicOrderPanel.prototype.onClickDownHandler=function(){this.setItemTipsVisible(!1)},PicOrderPanel.prototype.showItemTipsState=function(t,e){void 0===e&&(e=0);var i=this.itemtips.x,n=this.itemtips.y;this.setTipsPosition(t,e),i!==this.itemtips.x||n!==this.itemtips.y?this.setItemTipsVisible(!0):this.itemtips.visible?this.setItemTipsVisible(!1):this.setItemTipsVisible(!0)},PicOrderPanel.prototype.setItemTipsVisible=function(t){this.itemtips.visible=t},PicOrderPanel.prototype.setTipsPosition=function(t,e){void 0===e&&(e=0);for(var i=t.x,n=t.y,o=t;o.parentContainer!==this.content;)i+=o.parentContainer.x,n+=o.parentContainer.y,o=o.parentContainer;i-.5*this.itemtips.width<.5*-this.content.width?this.itemtips.x=.5*this.itemtips.width-.5*this.content.width+20*this.dpr:i+.5*this.itemtips.width>.5*this.content.width?this.itemtips.x=.5*this.content.width-.5*this.itemtips.width-20*this.dpr:this.itemtips.x=i,this.itemtips.y=n-.5*this.itemtips.height+10*this.dpr+e},PicOrderPanel.prototype.getDesText=function(t){t||(t={sellingPrice:!0,tradable:!1});var e=t.name+"\n",i=h.a.t("common.source")+":";if(e+=(i="[stroke=#333333][color=#333333]"+(i+=t.source)+"[/color][/stroke]")+"\n",t.sellingPrice){var n=h.a.t("common.sold");e+=(n="[stroke=#333333][color=#333333]"+(n+=p.f.getName(t.sellingPrice.coinType)+" x "+t.sellingPrice.price)+"[/color][/stroke]")+"\n"}if(!t.tradable){var o=h.a.t("furni_unlock.notrading");e+=o="[stroke=#333333][color=#ff0000]*"+o+"[/color][/stroke]"}return e},PicOrderPanel}(o.BasePanel),g=function(t){function OrderItem(e,i,n,o){var s=t.call(this,e)||this;s.materialItems=[],s.imageValues=[],s.orderRewards=[],s.key=n,s.dpr=o,s.mworld=i,s.bg=e.make.image({key:n,frame:"order_ordinary_bg"}),s.add(s.bg),s.setSize(s.bg.width,s.bg.height),s.headbg=e.make.image({key:n,frame:"order_ordinary_head_bg"}),s.add(s.headbg),s.headbg.x=.5*-s.width+.5*s.headbg.width+4*o,s.headbg.y=5*o,s.headIcon=new c.DynamicImage(e,s.headbg.x,0),s.add(s.headIcon),s.refreshBtn=new m.Button(e,s.key,"order_delete_bg","order_delete_bg"),s.refreshBtn.x=.5*s.width-.5*s.refreshBtn.width,s.refreshBtn.y=.5*-s.height+.5*s.refreshBtn.height,s.add(s.refreshBtn);var l=e.make.image({key:n,frame:"order_delete"});return s.refreshBtn.add(l),s.sendBtn=new m.Button(e,a.UIAtlasKey.commonKey,"order_green_butt","order_green_butt",h.a.t("order.send")),s.sendBtn.x=.5*s.width-.5*s.sendBtn.width-5*o,s.sendBtn.setTextStyle({fontSize:10*o}),s.add(s.sendBtn),s.sendTitle=e.make.text({x:.5*s.width-5*o,y:0,text:h.a.t("order.deliverying"),style:{color:"#ffffff",fontSize:13*o,fontFamily:r.a.DEFULT_FONT}}),s.sendTitle.setOrigin(1,.5),s.add(s.sendTitle),s.acceleBtn=new m.Button(e,a.UIAtlasKey.commonKey,"order_red_butt","order_red_butt",h.a.t("order.accele")),s.acceleBtn.x=20*o,s.acceleBtn.y=0,s.acceleBtn.setTextStyle({fontSize:11*o}),s.add(s.acceleBtn),s.acceleSpend=new P(e,30*o,10*o,s.key,s.dpr),s.acceleSpend.x=s.acceleBtn.x,s.acceleSpend.y=s.acceleBtn.y-.5*s.acceleBtn.height-10*o,s.add(s.acceleSpend),s.calcuTime=new P(e,30*o,10*o,s.key,o),s.add(s.calcuTime),s.calcuTime.setTextStyle({color:"#144B99",fontSize:10*o,bold:!0,shadow:{offsetX:0,offsetY:0,color:"#144B99",blur:4,stroke:!0,fill:!0}}),s.calcuTime.x=s.acceleBtn.x,s.calcuTime.y=s.acceleBtn.y+.5*s.acceleBtn.height+10*o,s.sendBtn.on(String(m.ClickEvent.Tap),s.onSendHandler,s),s.acceleBtn.on(String(m.ClickEvent.Tap),s.onAcceleHandler,s),s.refreshBtn.on(String(m.ClickEvent.Tap),s.onRefreshHandler,s),s.setInteractive(),s}return f(OrderItem,t),OrderItem.prototype.setHandler=function(t,e,i){this.sendHandler=t,this.tipsHandler=i,this.refreshHandler=e},OrderItem.prototype.setOrderData=function(t,e){var i=this;if(this.orderData=t,this.index=e,this.hideAllElement(),this.bg.setFrame(t.questType===s.op_pkt_def.PKT_Quest_Type.ORDER_QUEST_ROYAL_MISSION?"order_precious_bg":"order_ordinary_bg"),t.stage!==s.op_pkt_def.PKT_Quest_Stage.PKT_QUEST_STAGE_END){var n=p.i.getOsdRes(t.display.texturePath);this.headIcon.load(n,this,(function(){i.headIcon.scale=1,i.headIcon.scaleY=49*i.dpr/i.headIcon.displayHeight,i.headIcon.scaleX=i.headIcon.scaleY})),this.headIcon.visible=!0}t.stage===s.op_pkt_def.PKT_Quest_Stage.PKT_QUEST_STAGE_ACCEPTABLE?(this.deliveryState(t),this.orderOperator=s.op_pkt_def.PKT_Order_Operator.PKT_ORDER_DELIVERY):t.stage===s.op_pkt_def.PKT_Quest_Stage.PKT_QUEST_STAGE_PROCESSING?this.deliveryingState(t):t.stage===s.op_pkt_def.PKT_Quest_Stage.PKT_QUEST_STAGE_FINISHED?(this.rewardState(t),this.orderOperator=s.op_pkt_def.PKT_Order_Operator.PKT_ORDER_GET_REWARD):t.stage===s.op_pkt_def.PKT_Quest_Stage.PKT_QUEST_STAGE_END&&(this.cooldownState(t),this.orderOperator=s.op_pkt_def.PKT_Order_Operator.PKT_ORDER_SPEED_UP)},OrderItem.prototype.destroy=function(e){this.timeID&&(clearTimeout(this.timeID),this.timeID=void 0),t.prototype.destroy.call(this,e)},Object.defineProperty(OrderItem.prototype,"serviceTimestamp",{get:function(){return this.mworld.clock.unixTime},enumerable:!1,configurable:!0}),OrderItem.prototype.onAcceleHandler=function(){this.sendHandler&&this.sendHandler.runWith([this.index,this.orderOperator])},OrderItem.prototype.onSendHandler=function(){this.sendHandler&&this.sendHandler.runWith([this.index,this.orderOperator])},OrderItem.prototype.onRefreshHandler=function(){this.sendHandler&&this.sendHandler.runWith([this.index,s.op_pkt_def.PKT_Order_Operator.PKT_ORDER_DELETE])},OrderItem.prototype.deliveryState=function(t){var e=t.questType;this.headbg.setFrame(e===s.op_pkt_def.PKT_Quest_Type.ORDER_QUEST_ROYAL_MISSION?"order_precious_head_bg":"order_ordinary_head_bg"),this.refreshBtn.visible=!0,this.refreshBtn.setInteractive(),this.refreshBtn.setFrameNormal(e===s.op_pkt_def.PKT_Quest_Type.ORDER_QUEST_ROYAL_MISSION?"order_precious_delete_bg":"order_delete_bg");for(var i=.5*-this.width+58*this.dpr,n=!0,o=0;o<t.targets.length;o++){var r=t.targets[o],a=void 0;o<this.materialItems.length?a=this.materialItems[o]:(a=new _(this.scene,this.key,this.dpr),this.add(a),this.materialItems.push(a),a.setHandler(this.tipsHandler),a.addListen()),a.setMaterialData(r),a.x=i+.5*a.width,i+=a.width+8*this.dpr,a.y=-10*this.dpr,a.visible=!0,n=r.count>=r.neededCount}n?(this.sendBtn.setFrameNormal("order_green_butt"),this.sendBtn.setInteractive()):(this.sendBtn.setFrameNormal("order_gray_butt"),this.sendBtn.disInteractive()),this.sendBtn.visible=!0,this.sendBtn.setText(h.a.t("order.send")),this.sendBtn.setTextColor("#ffffff"),i=.5*-this.width+58*this.dpr;for(o=0;o<t.rewards.length;o++){var c=t.rewards[o];a=void 0;o<this.imageValues.length?a=this.imageValues[o]:(a=new P(this.scene,30*this.dpr,13*this.dpr,this.key,this.dpr,this.dpr),this.add(a),this.imageValues.push(a)),a.setFrameValue("x"+c.count,this.key,this.getIconName(c.display.texturePath)+"_s"),a.setTextStyle({color:e===s.op_pkt_def.PKT_Quest_Type.ORDER_QUEST_ROYAL_MISSION?"#ffffff":"#2154BD"}),a.x=i+.5*a.width,i+=a.width+20*this.dpr,a.y=.5*this.height-.5*a.height-4*this.dpr,a.visible=!0}},OrderItem.prototype.deliveryingState=function(t){var e=this;this.deliverybg?this.deliverybg.visible=!0:(this.deliverybg=this.scene.make.image({key:this.key,frame:"order_transport"}),this.addAt(this.deliverybg,1),this.deliverybg.x=.5*this.width-.5*this.deliverybg.width-10*this.dpr),this.headbg.setFrame("order_ordinary_head_bg"),this.sendTitle.visible=!0,this.timeID&&(clearTimeout(this.timeID),this.timeID=void 0);var timeextu=function(){var i=Math.ceil(t.deliveryDeadline-e.serviceTimestamp/1e3);i<0&&(i=0);var n=Math.floor(i/60),o=i%60,r=(n<10?"0"+n:n+"")+":"+(o<10?"0"+o:o+"");e.calcuTime.visible=!0,e.calcuTime.setFrameValue(r,e.key,"order_time"),e.calcuTime.resetSize(),e.calcuTime.x=.5*e.width-.5*e.calcuTime.width-10*e.dpr,e.calcuTime.y=.5*e.height-.5*e.calcuTime.height-5*e.dpr,i>0?e.timeID=setTimeout((function(){timeextu()}),1e3):(e.timeID&&e.refreshHandler&&e.refreshHandler.run(),e.timeID=void 0)};timeextu();for(var i=.5*-this.width+60*this.dpr,n=0;n<t.rewards.length;n++){var o=t.rewards[n],r=void 0;n<this.imageValues.length?r=this.imageValues[n]:(r=new P(this.scene,30*this.dpr,13*this.dpr,this.key,this.dpr,this.dpr),this.add(r),this.imageValues.push(r)),r.setFrameValue("x"+o.count,this.key,this.getIconName(o.display.texturePath)+"_s"),r.setTextStyle({color:"#2154BD"}),r.x=i+.5*r.width,i+=r.width+20*this.dpr,r.y=.5*this.height-.5*r.height-4*this.dpr,r.visible=!0}},OrderItem.prototype.rewardState=function(t){this.headbg.setFrame("order_ordinary_head_bg"),this.sendBtn.visible=!0,this.sendBtn.setInteractive(),this.sendBtn.setFrameNormal("order_yellow_butt"),this.sendBtn.setText(h.a.t("order.receive")),this.sendBtn.setTextColor("#9A6600");for(var e=.5*-this.width+60*this.dpr,i=0;i<t.rewards.length;i++){var n=t.rewards[i],o=void 0;i<this.orderRewards.length?o=this.orderRewards[i]:(o=new v(this.scene,this.key,this.dpr),this.add(o),this.orderRewards.push(o)),o.x=e+.5*o.width,e+=o.width+20*this.dpr,o.y=-6*this.dpr,o.visible=!0,o.setItemData(n)}},OrderItem.prototype.cooldownState=function(t){var e=this;this.headbg.setFrame("order_unknown_head"),this.headIcon.visible=!1,this.acceleBtn.visible=!0,this.acceleBtn.setInteractive(),this.acceleSpend.visible=!0,this.calcuTime.visible=!0,this.calcuTime.y=this.acceleBtn.y+.5*this.acceleBtn.height+10*this.dpr,this.timeID&&(clearTimeout(this.timeID),this.timeID=void 0);var timeextu=function(){var i=Math.ceil(t.refreshDeadline-e.serviceTimestamp/1e3);i<0&&(i=0);var n=Math.floor(i/60),o=i%60,r=(n<10?"0"+n:n+"")+":"+(o<10?"0"+o:o+"");e.calcuTime.visible=!0,e.calcuTime.setFrameValue(r,e.key,"order_time"),e.calcuTime.resetSize(),e.calcuTime.x=e.acceleBtn.x,e.acceleSpend.setFrameValue(n+"",e.key,"iv_diamond_s"),i>0?e.timeID=setTimeout((function(){timeextu()}),1e3):(e.timeID&&e.refreshHandler&&e.refreshHandler.run(),e.timeID=void 0)};timeextu()},OrderItem.prototype.getIconName=function(t){var e=t,i=e.lastIndexOf("/"),n=e.lastIndexOf(".");return e.slice(i+1,n)},OrderItem.prototype.hideAllElement=function(){this.refreshBtn.visible=!1,this.refreshBtn.disInteractive(),this.sendBtn.visible=!1,this.sendBtn.disInteractive(),this.sendTitle.visible=!1,this.acceleBtn.visible=!1,this.acceleBtn.disInteractive(),this.acceleSpend.visible=!1,this.calcuTime.visible=!1,this.deliverybg&&(this.deliverybg.visible=!1);for(var t=0,e=this.materialItems;t<e.length;t++){(s=e[t]).visible=!1,s.removeListen()}for(var i=0,n=this.orderRewards;i<n.length;i++){(s=n[i]).visible=!1}for(var o=0,r=this.imageValues;o<r.length;o++){var s;(s=r[o]).visible=!1}this.timeID&&(clearTimeout(this.timeID),this.timeID=void 0)},OrderItem}(Phaser.GameObjects.Container),_=function(t){function MaterialItem(e,i,n){var o=t.call(this,e)||this;return o.key=i,o.dpr=n,o.bg=e.make.image({key:i,frame:"order_demand_icon"}),o.setSize(o.bg.width,o.bg.height),o.icon=new c.DynamicImage(e,0,-5*n),o.icon.setSize(15*n,15*n),o.value=new m.BBCodeText(o.scene,0,6*n,"60/30",{color:"#0",fontSize:8*o.dpr,fontFamily:r.a.DEFULT_FONT}).setOrigin(.5),o.add([o.bg,o.icon,o.value]),o.setInteractive(),o}return f(MaterialItem,t),MaterialItem.prototype.setMaterialData=function(t){var e=this;this.itemData=t;var i=p.i.getOsdRes(t.display.texturePath);this.icon.load(i,this,(function(){e.icon.scale=1,e.icon.scaleX=e.icon.displayWidth/e.icon.width,e.icon.scaleY=e.icon.scaleX})),this.value.text=t.count+"/"+t.neededCount},MaterialItem.prototype.setHandler=function(t){this.tipsHandler=t},MaterialItem.prototype.addListen=function(){this.on("pointerup",this.onClickHandler,this)},MaterialItem.prototype.removeListen=function(){this.off("pointerdown",this.onClickHandler,this)},MaterialItem.prototype.destroy=function(e){this.removeListen(),t.prototype.destroy.call(this,e)},MaterialItem.prototype.onClickHandler=function(){this.tipsHandler&&this.tipsHandler.runWith(this)},MaterialItem}(Phaser.GameObjects.Container),P=function(t){function ImageValue(e,i,n,o,s,a){void 0===a&&(a=0);var h=t.call(this,e)||this;return h.dpr=s,h.setSize(i,n),h.icon=e.make.image({key:o,frame:"iv_coin_s"}),h.value=e.make.text({x:0,y:a,text:"10",style:{color:"#ffffff",fontSize:11*s,fontFamily:r.a.DEFULT_FONT}}),h.value.setOrigin(0,.5),h.add([h.icon,h.value]),h}return f(ImageValue,t),ImageValue.prototype.setFrameValue=function(t,e,i){this.icon.setTexture(e,i),this.value.text=t,this.resetPosition()},ImageValue.prototype.setText=function(t){this.value.text=t},ImageValue.prototype.setTextStyle=function(t){this.value.setStyle(t)},ImageValue.prototype.setShadow=function(t,e,i,n,o,r){this.value.setShadow(t,e,i,n,o,r)},ImageValue.prototype.setStroke=function(t,e){this.value.setStroke(t,e)},ImageValue.prototype.resetSize=function(){var t=this.icon.displayWidth+this.value.width;this.setSize(t,this.height),this.resetPosition()},ImageValue.prototype.resetPosition=function(){this.icon.x=.5*-this.width+.5*this.icon.displayWidth,this.value.x=this.icon.x+.5*this.icon.displayWidth+4*this.dpr},ImageValue}(Phaser.GameObjects.Container),v=function(t){function OrderRewardItem(e,i,n){var o=t.call(this,e)||this;return o.bg=e.make.image({key:i,frame:"order_reward"}),o.setSize(o.bg.width,o.bg.height),o.icon=e.make.image({key:i,frame:"order_silver_middle"}),o.text=e.make.text({x:0,y:.5*o.bg.height+13*n,text:"10",style:{color:"#144B99",fontSize:9*n,fontFamily:r.a.DEFULT_FONT}}),o.text.setOrigin(.5),o.add([o.bg,o.icon,o.text]),o}return f(OrderRewardItem,t),OrderRewardItem.prototype.setItemData=function(t){this.text.text=t.name+"*"+t.count;var e=t.display.texturePath,i=e.lastIndexOf("/"),n=e.lastIndexOf("."),o=t.display.texturePath.slice(i+1,n);this.icon.setFrame(o)},OrderRewardItem}(Phaser.GameObjects.Container),w=function(t){function OrderProgressPanel(e,i,n,o,r){var s=t.call(this,e)||this;s.progressItems=[],s.setSize(i,n),s.dpr=r,s.key=o;var a={x:0*r/2,y:15*r,width:251*r,height:11*r,background:{x:0,y:0,width:251*r,height:11*r,config:{top:0*r,left:7*r,right:7*r,bottom:0*r},key:o,frame:"order_progress_bottom"},bar:{x:0,y:0,width:251*r,height:11*r,config:{top:0*r,left:7*r,right:7*r,bottom:0*r},key:o,frame:"order_progress_top"},dpr:r,textConfig:void 0};return s.progress=new m.ProgressBar(e,a),s.add(s.progress),s}return f(OrderProgressPanel,t),OrderProgressPanel.prototype.setProgressDatas=function(t){for(var e=t.steps.length,i=100,n=0;n<e;n++){var o=t.steps[n],r=void 0;n<this.progressItems.length?r=this.progressItems[n]:(r=new S(this.scene,0,0,this.key,this.dpr),this.add(r),this.progressItems.push(r),r.setHandler(this.receiveHandler)),r.x=.5*-this.width+this.width*(n+1)/e-16*this.dpr,r.y=15*this.dpr,r.setItemData(o,n,t.currentProgressValue),i=o.targetValue}this.progress.setProgress(t.currentProgressValue,i)},OrderProgressPanel.prototype.setHandler=function(t){this.receiveHandler=t},OrderProgressPanel}(Phaser.GameObjects.Container),S=function(t){function OrderProgressItem(e,i,n,o,s){var a=t.call(this,e,i,n)||this;return a.dpr=s,a.key=o,a.bg=new m.Button(e,o,"order_progress_unfinished","order_progress_unfinished"),a.icon=new c.DynamicImage(e,0,0),a.text=e.make.text({x:0,y:.5*a.bg.height+10*s,text:"10",style:{color:"#2154BD",fontSize:12*s,bold:!0,fontFamily:r.a.DEFULT_FONT}}),a.text.setStroke("#2154BD",4),a.text.setOrigin(.5),a.finishIcon=e.make.image({key:o,frame:"order_progress_ok"}),a.balckgraphic=e.make.graphics(void 0,!1),a.balckgraphic.clear(),a.balckgraphic.fillStyle(0,.5),a.balckgraphic.fillCircle(0,0,16*s),a.add([a.bg,a.icon,a.text,a.balckgraphic,a.finishIcon]),a.finishIcon.visible=!1,a}return f(OrderProgressItem,t),OrderProgressItem.prototype.setItemData=function(t,e,i){var n=this;if(this.progressData=t,this.index=e,this.text.text=t.targetValue+"",t.rewards){var o=p.i.getOsdRes(t.rewards[0].display.texturePath);this.icon.load(o,this,(function(){n.icon.scale=1,n.icon.scaleY=29*n.dpr/n.icon.displayHeight,n.icon.scaleX=n.icon.scaleY}))}this.finishIcon.visible=!1,this.balckgraphic.visible=!1,t.targetValue<=i?(this.bg.setFrameNormal("order_progress_finished","order_progress_finished"),t.received&&(this.finishIcon.visible=!0,this.balckgraphic.visible=!0)):this.bg.setFrameNormal("order_progress_unfinished","order_progress_unfinished"),t.received?this.bg.off(String(m.ClickEvent.Tap),this.onReceiveHandler,this):this.bg.on(String(m.ClickEvent.Tap),this.onReceiveHandler,this)},OrderProgressItem.prototype.setHandler=function(t){this.receiveHandler=t},OrderProgressItem.prototype.onReceiveHandler=function(){this.receiveHandler&&this.receiveHandler.runWith([this.index,this])},OrderProgressItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicPartyList",(function(){return s}));var n,o=i(110),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function PicPartyList(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return r(PicPartyList,t),PicPartyList.prototype.register=function(){this.connection&&this.connection.addPacketListener(this)},PicPartyList.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicPartyList.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicPartyList.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicPartyList.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicPartyList.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicPartyList}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicPartyListPanel",(function(){return d}));var n,o=i(112),r=i(114),s=i(113),a=i(115),h=i(127),c=i(109),l=i(306),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function PicPartyListPanel(e,i){var n=t.call(this,e,i)||this;return n.key="picpartypanel",n}return p(PicPartyListPanel,t),PicPartyListPanel.prototype.resize=function(t,e){this.scale;var i=this.scaleWidth,n=this.scaleHeight;this.content.x=.5*i,this.content.y=.5*n+20*this.dpr,this.partyNavigationPanel.refreshMask(),this.setSize(i,n)},PicPartyListPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen(),this.updateData()):this.preload())},PicPartyListPanel.prototype.addListen=function(){this.mInitialized&&this.closeBtn.on("pointerup",this.onCloseHandler,this)},PicPartyListPanel.prototype.removeListen=function(){this.mInitialized&&this.closeBtn.off("pointerup",this.onCloseHandler,this)},PicPartyListPanel.prototype.destroy=function(){this.removeListen(),t.prototype.destroy.call(this)},PicPartyListPanel.prototype.setPartyData=function(t,e){void 0===e&&(e=!0),this.mPartyData=t,this.mInitialized&&(this.mineBtn.visible=e)},PicPartyListPanel.prototype.preload=function(){this.addAtlas(this.key,"party/party.png","party/party.json"),this.addAtlas(a.UIAtlasKey.commonKey,a.UIAtlasName.commonUrl+".png",a.UIAtlasName.commonUrl+".json"),this.addAtlas(a.UIAtlasKey.common2Key,a.UIAtlasName.common2Url+".png",a.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicPartyListPanel.prototype.init=function(){if(!this.mInitialized){var e=this.scaleWidth,i=this.scaleHeight;this.mBackground=this.scene.make.graphics(void 0,!1),this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,e,i),Phaser.Geom.Rectangle.Contains),this.mBackground.fillStyle(0,.66),this.mBackground.fillRect(0,0,e,i),this.add(this.mBackground),this.content=this.scene.make.container(void 0,!1);var n=295*this.dpr,o=490*this.dpr;this.content.setSize(n,o),this.bg=new c.NineSlicePatch(this.scene,0,0,n,o,a.UIAtlasKey.commonKey,"bg",{left:20*this.dpr,top:20*this.dpr,right:20*this.dpr,bottom:60*this.dpr}),this.content.add(this.bg),this.closeBtn=this.scene.make.image({x:.5*this.bg.width-5*this.dpr,y:.5*-this.bg.height+5*this.dpr,key:a.UIAtlasKey.commonKey,frame:"close"}).setScale(1.3),this.closeBtn.setInteractive(),this.closeBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.content.add([this.closeBtn]),this.navigationBtn=this.createTabButton(r.a.t("party.navigation")),this.mineBtn=this.createTabButton(r.a.t("party.mine")),this.searchBtn=this.createTabButton(r.a.t("common.search")),this.navigationBtn.setPosition(-this.navigationBtn.width-2*this.dpr,.5*-this.content.height-.5*this.navigationBtn.height+6*this.dpr),this.mineBtn.setPosition(this.navigationBtn.x+this.navigationBtn.width+2*this.dpr,this.navigationBtn.y),this.searchBtn.setPosition(this.mineBtn.x+this.mineBtn.width+2*this.dpr,this.navigationBtn.y),this.topCheckBox=new h.CheckboxGroup,this.topCheckBox.appendItemAll([this.navigationBtn,this.mineBtn,this.searchBtn]),this.topCheckBox.on("selected",this.onTabBtnHandler,this),this.content.add([this.navigationBtn,this.mineBtn,this.searchBtn]),this.partyNavigationPanel=new l.PicPartyNavigationPanel(this.scene,this.content.width-40*this.dpr,this.content.height-40*this.dpr,this.key,this.dpr,this.scale),this.partyNavigationPanel.y=0*this.dpr,this.content.add(this.partyNavigationPanel),this.add(this.content),this.resize(0,0),t.prototype.init.call(this),this.topCheckBox.selectIndex(0)}},PicPartyListPanel.prototype.updateData=function(){this.mPartyData&&this.setPartyData(this.mPartyData)},PicPartyListPanel.prototype.onTabBtnHandler=function(t){this.partyNavigationPanel.visible=!1,this.navigationBtn===t?this.partyNavigationPanel.visible=!0:this.mineBtn===t||this.searchBtn},PicPartyListPanel.prototype.createTabButton=function(t){var e=new c.TabButton(this.scene,a.UIAtlasKey.common2Key,"default_tab_s","check_tab_s",t);return e.setTextStyle({fontFamily:s.a.BOLD_FONT,fontSize:16*this.dpr,color:"#ffffff"}),e},PicPartyListPanel.prototype.onCloseHandler=function(){this.emit("close")},PicPartyListPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicPartyNavigationPanel",(function(){return m}));var n,o=i(113),r=i(115),s=i(114),a=i(116),h=i(120),c=i(111),l=i(109),p=i(129),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function PicPartyNavigationPanel(e,i,n,o,r,s){var a=t.call(this,e)||this;return a.setSize(i,n),a.key=o,a.dpr=r,a.zoom=s,a.create(),a}return d(PicPartyNavigationPanel,t),PicPartyNavigationPanel.prototype.create=function(){var t=this;this.signProgressPanel=new y(this.scene,252*this.dpr,45*this.dpr,this.key,this.dpr),this.signProgressPanel.y=.5*-this.height+15*this.dpr,this.signProgressPanel.setHandler(new h.a(this,this.onProgressHandler)),this.add(this.signProgressPanel);var e={x:0,y:60*this.dpr,table:{width:254*this.dpr,height:330*this.dpr,columns:1,cellWidth:254*this.dpr,cellHeight:50*this.dpr,reuseCellContainer:!0,zoom:this.zoom},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(e,i){e.scene;var n=e.index,o=e.item;return null===i&&(i=new u(t.scene,t.key,t.dpr)).setHandler(new h.a(t,t.onSendHandler)),i.setPartyData(o,n),i}};this.mGameGrid=new l.GameGridTable(this.scene,e),this.mGameGrid.layout(),this.add(this.mGameGrid),this.itemtips=new p.ItemInfoTips(this.scene,121*this.dpr,46*this.dpr,r.UIAtlasKey.commonKey,"tips_bg",this.dpr),this.itemtips.visible=!1,this.add(this.itemtips),this.hotelBtn=new l.Button(this.scene,this.key,"hotel","hotel",s.a.t("party.hotel")),this.hotelBtn.text.setOrigin(0,1),this.hotelBtn.setTextStyle({fontSize:16*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#FFDE00"}),this.hotelBtn.setTextOffset(.5*-this.hotelBtn.width+5*this.dpr,.5*this.hotelBtn.height-2*this.dpr),this.hotelBtn.setPosition(.5*-this.hotelBtn.width-18*this.dpr,this.signProgressPanel.y+.5*this.signProgressPanel.height+.5*this.hotelBtn.height+20*this.dpr),this.hotelBtn.on(String(l.ClickEvent.Tap),this.onHotelHandler,this),this.add(this.hotelBtn),this.picatownBtn=new l.Button(this.scene,this.key,"town","town",s.a.t("party.picatown")),this.picatownBtn.text.setOrigin(0,1),this.picatownBtn.setTextStyle({fontSize:16*this.dpr,fontFamily:o.a.BOLD_FONT,color:"#FFDE00"}),this.picatownBtn.setTextOffset(.5*-this.picatownBtn.width+5*this.dpr,.5*this.picatownBtn.height-2*this.dpr),this.picatownBtn.setPosition(.5*this.picatownBtn.width-10*this.dpr,this.hotelBtn.y),this.picatownBtn.on(String(l.ClickEvent.Tap),this.onPicatownHandler,this),this.add(this.picatownBtn),this.setPartyDataList(),this.setSignProgress()},PicPartyNavigationPanel.prototype.refreshMask=function(){this.mGameGrid.resetMask()},PicPartyNavigationPanel.prototype.setHandler=function(t){this.sendHandler=t},PicPartyNavigationPanel.prototype.setPartyDataList=function(){var t=new Array(60);this.mGameGrid.setItems(t)},PicPartyNavigationPanel.prototype.setSignProgress=function(){this.signProgressPanel.setProgressDatas(null)},PicPartyNavigationPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},PicPartyNavigationPanel.prototype.onHotelHandler=function(){this.sendHandler&&this.sendHandler.runWith(["hotel"])},PicPartyNavigationPanel.prototype.onPicatownHandler=function(){this.sendHandler&&this.sendHandler.runWith(["pictown"])},PicPartyNavigationPanel.prototype.onSendHandler=function(t,e){this.sendHandler&&this.sendHandler.runWith(["partylist"])},PicPartyNavigationPanel.prototype.onProgressHandler=function(){this.sendHandler&&this.sendHandler.runWith(["progress"])},PicPartyNavigationPanel.prototype.onItemInfoTips=function(t,e,i){this.itemtips.visible=e,this.itemtips.x=i.x,this.itemtips.y=i.y,this.itemtips.setText(this.getDesText(t))},PicPartyNavigationPanel.prototype.getDesText=function(t){t||(t={sellingPrice:!0,tradable:!1});var e=t.name+"\n",i=s.a.t("common.source")+":";if(e+=(i="[stroke=#333333][color=#333333]"+(i+=t.source)+"[/color][/stroke]")+"\n",t.sellingPrice){var n=s.a.t("common.sold");e+=(n="[stroke=#333333][color=#333333]"+(n+=c.f.getName(t.sellingPrice.coinType)+" x "+t.sellingPrice.price)+"[/color][/stroke]")+"\n"}if(!t.tradable){var o=s.a.t("furni_unlock.notrading");e+=o="[stroke=#333333][color=#ff0000]*"+o+"[/color][/stroke]"}return e},PicPartyNavigationPanel}(Phaser.GameObjects.Container),u=function(t){function PartyListItem(e,i,n){var s=t.call(this,e)||this;return s.key=i,s.dpr=n,s.bg=new l.NineSlicePatch(s.scene,0,0,254*n,40*n,s.key,"list_bg",{left:12*s.dpr,top:0*s.dpr,right:12*s.dpr,bottom:0*s.dpr}),s.add(s.bg),s.setSize(s.bg.width,s.bg.height),s.imagIcon=new a.DynamicImage(e,0,0),s.imagIcon.setTexture(s.key,"party_icon_1"),s.imagIcon.x=.5*-s.width+.5*s.imagIcon.width+8*n,s.imagIcon.y=.5*-s.height+.5*s.imagIcon.height+5*n,s.add(s.imagIcon),s.hotImageValue=new f(e,30*n,10*n,i,"hot",n),s.hotImageValue.setTextStyle({fontSize:10*n,color:"#D2691E"}),s.hotImageValue.x=.5*-s.width+.5*s.hotImageValue.width+8*n,s.hotImageValue.y=.5*s.height-.5*s.hotImageValue.height-5*n,s.add(s.hotImageValue),s.partyName=e.make.text({x:.5*-s.width+40*n,y:.5*-s.height+5*n,text:"某某某排队",style:{color:"#333333",fontSize:12*n,fontFamily:o.a.DEFULT_FONT}}),s.partyName.setOrigin(0),s.add(s.partyName),s.partyOwnerName=new f(e,50*n,20*n,i,"user",n),s.partyOwnerName.setTextStyle({fontSize:10*n,color:"#333333"}),s.partyOwnerName.x=s.partyName.x+.5*s.partyOwnerName.width,s.partyOwnerName.y=s.partyName.y+25*n,s.add(s.partyOwnerName),s.playerCount=new f(e,30*n,20*n,r.UIAtlasKey.commonKey,"home_persons",n),s.playerCount.setTextStyle({color:"#333333"}),s.playerCount.x=.5*s.width-25*n,s.add(s.playerCount),s.setPartyData(null,null),s}return d(PartyListItem,t),PartyListItem.prototype.setHandler=function(t){this.sendHandler=t},PartyListItem.prototype.setPartyData=function(t,e){this.hotImageValue.setText("88"),this.partyOwnerName.setText("派对主任昵称")},PartyListItem.prototype.onSendHandler=function(){this.sendHandler&&this.sendHandler.runWith([this.index])},PartyListItem}(Phaser.GameObjects.Container),f=function(t){function ImageValue(e,i,n,r,s,a,h){void 0===h&&(h=0);var c=t.call(this,e)||this;return c.dpr=a,c.setSize(i,n),c.icon=e.make.image({key:r,frame:s}),c.value=e.make.text({x:0,y:h,text:"10",style:{color:"#ffffff",fontSize:11*a,fontFamily:o.a.DEFULT_FONT}}),c.value.setOrigin(0,.5),c.add([c.icon,c.value]),c.resetSize(),c}return d(ImageValue,t),ImageValue.prototype.setFrameValue=function(t,e,i){this.icon.setTexture(e,i),this.value.text=t,this.resetPosition()},ImageValue.prototype.setText=function(t){this.value.text=t},ImageValue.prototype.setTextStyle=function(t){this.value.setStyle(t)},ImageValue.prototype.setShadow=function(t,e,i,n,o,r){this.value.setShadow(t,e,i,n,o,r)},ImageValue.prototype.setStroke=function(t,e){this.value.setStroke(t,e)},ImageValue.prototype.resetSize=function(){var t=this.icon.displayWidth+this.value.width;this.setSize(t,this.height),this.resetPosition()},ImageValue.prototype.resetPosition=function(){this.icon.x=.5*-this.width+.5*this.icon.displayWidth,this.value.x=this.icon.x+.5*this.icon.displayWidth+4*this.dpr},ImageValue}(Phaser.GameObjects.Container),y=function(t){function SignProgressPanel(e,i,n,o,r){var s=t.call(this,e)||this;s.progressItems=[],s.setSize(i,n),s.dpr=r,s.key=o;var a={x:0*r/2,y:15*r,width:251*r,height:11*r,background:{x:0,y:0,width:251*r,height:11*r,config:{top:0*r,left:7*r,right:7*r,bottom:0*r},key:o,frame:"order_progress_bottom"},bar:{x:0,y:0,width:251*r,height:11*r,config:{top:0*r,left:7*r,right:7*r,bottom:0*r},key:o,frame:"order_progress_top"},dpr:r,textConfig:void 0};return s.progress=new l.ProgressBar(e,a),s.add(s.progress),s}return d(SignProgressPanel,t),SignProgressPanel.prototype.setProgressDatas=function(t){for(var e=0;e<5;e++){var i=void 0;e<this.progressItems.length?i=this.progressItems[e]:(i=new g(this.scene,0,0,this.key,this.dpr),this.add(i),this.progressItems.push(i),i.setHandler(new h.a(this,this.onReceiveHandler))),i.x=.5*-this.width+this.width*(e+1)/5-16*this.dpr,i.y=15*this.dpr}},SignProgressPanel.prototype.setHandler=function(t){this.receiveHandler=t},SignProgressPanel.prototype.onReceiveHandler=function(t){this.receiveHandler&&this.receiveHandler.runWith(t)},SignProgressPanel}(Phaser.GameObjects.Container),g=function(t){function SignProgressItem(e,i,n,r,s){var h=t.call(this,e,i,n)||this;return h.dpr=s,h.key=r,h.bg=new l.Button(e,r,"order_progress_unfinished","order_progress_unfinished"),h.icon=new a.DynamicImage(e,0,0),h.text=e.make.text({x:0,y:.5*-h.bg.height-8*s,text:"10",style:{color:"#FFDE00",fontSize:12*s,bold:!0,fontFamily:o.a.DEFULT_FONT}}),h.text.setStroke("#905C06",4),h.text.setOrigin(.5),h.finishIcon=e.make.image({key:r,frame:"order_progress_ok"}),h.balckgraphic=e.make.graphics(void 0,!1),h.balckgraphic.clear(),h.balckgraphic.fillStyle(0,.5),h.balckgraphic.fillCircle(0,0,16*s),h.add([h.bg,h.icon,h.text,h.balckgraphic,h.finishIcon]),h.finishIcon.visible=!1,h}return d(SignProgressItem,t),SignProgressItem.prototype.setItemData=function(t,e,i){var n=this;if(this.progressData=t,this.index=e,this.text.text=t.targetValue+"",t.rewards){var o=c.i.getOsdRes(t.rewards[0].display.texturePath);this.icon.load(o,this,(function(){n.icon.scale=1,n.icon.scaleY=29*n.dpr/n.icon.displayHeight,n.icon.scaleX=n.icon.scaleY}))}this.finishIcon.visible=!1,this.balckgraphic.visible=!1,t.targetValue<i?(this.bg.setFrameNormal("order_progress_finished","order_progress_finished"),t.received?(this.finishIcon.visible=!0,this.balckgraphic.visible=!0,this.bg.off(String(l.ClickEvent.Tap),this.onReceiveHandler,this)):this.bg.on(String(l.ClickEvent.Tap),this.onReceiveHandler,this)):(this.bg.setFrameNormal("order_progress_unfinished","order_progress_unfinished"),this.bg.off(String(l.ClickEvent.Tap),this.onReceiveHandler,this))},SignProgressItem.prototype.setHandler=function(t){this.receiveHandler=t},SignProgressItem.prototype.onReceiveHandler=function(){this.receiveHandler&&this.receiveHandler.runWith(this.index)},SignProgressItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicPropFunPanel",(function(){return d}));var n,o=i(113),r=i(112),s=i(111),a=i(114),h=i(115),c=i(130),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function PicPropFunPanel(e,i){var n=t.call(this,e,i)||this;return n.itemCount=1,n.key="picpropfunpanel",n}return p(PicPropFunPanel,t),PicPropFunPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,n,o),this.blackGraphic.clear(),this.blackGraphic.fillStyle(0,.66),this.blackGraphic.fillRect(0,0,n,o),this.content.x=n/2,this.content.y=o/2,this.setSize(n*this.scale,o*this.scale)},PicPropFunPanel.prototype.show=function(t){if(this.mShowData=t,!this.mPreLoad)if(this.mInitialized){if(!this.mShow){this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen();var e=this.mShowData[0];this.setProp(e),this.updateData()}}else this.preload()},PicPropFunPanel.prototype.addListen=function(){this.mInitialized&&(this.cancelBtn.on(l.ClickEvent.Tap,this.onCancelBtnHandler,this),this.confirmBtn.on(l.ClickEvent.Tap,this.onConfirmBtnHandler,this))},PicPropFunPanel.prototype.removeListen=function(){this.mInitialized&&(this.cancelBtn.off(l.ClickEvent.Tap,this.onCancelBtnHandler,this),this.confirmBtn.off(l.ClickEvent.Tap,this.onConfirmBtnHandler,this))},PicPropFunPanel.prototype.preload=function(){this.addAtlas(h.UIAtlasKey.commonKey,h.UIAtlasName.commonUrl+".png",h.UIAtlasName.commonUrl+".json"),this.addAtlas(h.UIAtlasKey.common2Key,h.UIAtlasName.common2Url+".png",h.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicPropFunPanel.prototype.init=function(){var e=this.scaleWidth,i=this.scaleHeight,n=this.dpr;this.blackGraphic=this.scene.make.graphics(void 0,!1),this.blackGraphic.setInteractive(new Phaser.Geom.Rectangle(0,0,e,i),Phaser.Geom.Rectangle.Contains),this.add(this.blackGraphic),this.content=this.scene.make.container(void 0,!1);var r=299*this.dpr,s=305*this.dpr;this.content.setSize(r,s),this.add(this.content);var p=new l.NineSlicePatch(this.scene,0,0,r,s,h.UIAtlasKey.common2Key,"bg",{left:20*this.dpr,top:20*this.dpr,right:30*this.dpr,bottom:40*this.dpr});p.setInteractive(new Phaser.Geom.Rectangle(0,0,e,i),Phaser.Geom.Rectangle.Contains);var d=.5*-p.height+3*n,m=this.scene.make.image({x:0,y:d,key:h.UIAtlasKey.common2Key,frame:"title"});this.titleName=this.scene.make.text({x:0,y:d+3*n,text:"售出",style:{color:"#905B06",fontSize:16*n,fontFamily:o.a.BOLD_FONT}},!1).setOrigin(.5),this.titleName.setFontStyle("bold"),this.itemName=this.scene.make.text({x:0,y:d+40*n,style:{color:"#000000",fontSize:15*n,fontFamily:o.a.DEFULT_FONT}},!1).setOrigin(.5);var u=-40*n;this.mDetailDisplay=new c.DetailDisplay(this.scene),this.mDetailDisplay.scale=.8*this.dpr,this.mDetailDisplay.y=u;var f=30*n;this.priceBg=this.scene.make.image({x:0,y:f,key:h.UIAtlasKey.common2Key,frame:"price_bg"}),this.pricText=this.scene.make.text({x:0,y:f,style:{color:"#000000",fontSize:15*n,fontFamily:o.a.DEFULT_FONT}},!1).setOrigin(.5),this.mCoinIcon=this.scene.make.image({x:-45*this.dpr,y:f,key:h.UIAtlasKey.commonKey,frame:"iv_coin"},!1).setOrigin(.5);var y=new l.NineSlicePatch(this.scene,0,0,8,7*n,h.UIAtlasKey.common2Key,"slider_bg",{left:3,top:1,right:3,bottom:1}),g=new l.NineSlicePatch(this.scene,0,0,8,7*n,h.UIAtlasKey.common2Key,"slider_rate",{left:3,top:1,right:3,bottom:1}),_=this.scene.make.image({key:h.UIAtlasKey.common2Key,frame:"block"});this.thumb=_,this.itemCountText=this.scene.make.text({x:0,y:0,style:{color:"#744803",fontSize:15*n,fontFamily:o.a.DEFULT_FONT}},!1).setOrigin(.5),this.slider=new l.GameSlider(this.scene,{x:0,y:70*n,width:136*n,height:7*n,orientation:1,background:y,indicator:g,thumb:_,offsetX:.5*_.width,valuechangeCallback:this.onSliderValueHandler,valuechangeCallbackScope:this,value:.5}),this.slider.add(this.itemCountText),this.slider.setValue(0);var P=.5*p.height-30*n,v=-66*n;this.cancelBtn=new l.NineSliceButton(this.scene,v,P,112*n,36*n,h.UIAtlasKey.commonKey,"red_btn",a.a.t("common.cancel"),n,this.scale,{left:12*n,top:12*n,right:12*n,bottom:12*n}),this.confirmBtn=new l.NineSliceButton(this.scene,-v,P,112*n,36*n,h.UIAtlasKey.commonKey,"yellow_btn",a.a.t("common.confirm"),n,this.scale,{left:12*n,top:12*n,right:12*n,bottom:12*n}),this.cancelBtn.setTextStyle({color:"#FFFFFF",fontSize:16*n,fontFamily:o.a.BOLD_FONT}),this.confirmBtn.setTextStyle({color:"#976400",fontSize:16*n,fontFamily:o.a.BOLD_FONT}),this.content.add([p,m,this.titleName,this.itemName,this.mDetailDisplay,this.priceBg,this.mCoinIcon,this.pricText,this.slider,this.cancelBtn,this.confirmBtn]),this.resize(0,0),t.prototype.init.call(this)},PicPropFunPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},PicPropFunPanel.prototype.setProp=function(t){var e=t.data,i=void 0===t.price||t.price;i=!!e.sellingPrice&&i;var n=void 0===t.slider||t.slider;if(this.itemData=e,this.itemCount=n?1:e.count,this.setResource(t.resource),this.itemName.text=e.name||e.shortName,this.itemCountText.text=this.itemCount+"",t.title&&(this.titleName.text=t.title),i){this.pricText.visible=!0,this.priceBg.visible=!0,this.mCoinIcon.visible=!0,this.slider.y=70*this.dpr,this.pricText.text=s.f.getName(e.sellingPrice.coinType)+" x "+e.sellingPrice.price*this.itemCount;var o=s.f.getIcon(e.sellingPrice.coinType);this.mCoinIcon.setFrame(o)}else this.pricText.visible=!1,this.priceBg.visible=!1,this.mCoinIcon.visible=!1,this.slider.y=50*this.dpr;this.confirmHandler=t.confirmHandler,this.cancelHandler=t.cancelHandler,this.slider.visible=n,this.slider.setValue(0)},PicPropFunPanel.prototype.setResource=function(t){t?t.display?this.mDetailDisplay.loadDisplay(t):t.avatar&&this.mDetailDisplay.loadAvatar(t,2,new Phaser.Geom.Point(0,70)):this.mDetailDisplay.loadUrl(this.itemData.display.texturePath)},PicPropFunPanel.prototype.updateData=function(){this.itemCountText&&(this.itemCountText.text=this.itemCount+""),this.pricText&&this.itemData&&this.itemData.sellingPrice&&(this.pricText.text=s.f.getName(this.itemData.sellingPrice.coinType)+" x "+this.itemData.sellingPrice.price*this.itemCount)},PicPropFunPanel.prototype.onCancelBtnHandler=function(){this.cancelHandler&&this.cancelHandler.runWith(this.itemData),this.emit("close")},PicPropFunPanel.prototype.onConfirmBtnHandler=function(){this.confirmHandler&&this.confirmHandler.runWith([this.itemData,this.itemCount]),this.emit("close")},PicPropFunPanel.prototype.onSliderValueHandler=function(t){this.itemCountText.x=this.thumb.x,this.itemCount=this.calcuSliderValue(t),this.updateData()},PicPropFunPanel.prototype.calcuSliderValue=function(t){var e=this.itemData?this.itemData.count:1,i=0;if(e<=40)i=Math.round(e*t);else if(t<=1/4)i=40*t;else{var n=e-10;if(n<=40)i=10+n*(t-1/4)/.75;else{var o=n/4;i=10;for(var r=1;r<4;r++){var s=o+n/12*(r-1);if(t>r/4&&t<=(r+1)/4){i+=s*(t-r/4)/(1/4);break}i+=s}}}return(i=Math.round(i))<1&&(i=1),i},PicPropFunPanel}(r.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicRoomUpgrade",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicRoomUpgrade(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicRoomUpgrade,t),PicRoomUpgrade.prototype.register=function(){this.connection&&this.connection.addPacketListener(this)},PicRoomUpgrade.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicRoomUpgrade.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicRoomUpgrade.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicRoomUpgrade.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicRoomUpgrade.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicRoomUpgrade.prototype.queryTargetUI=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),i=e.content;i.uiId=t,i.componentId=0,this.connection.send(e)},PicRoomUpgrade}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicRoomUpgradePanel",(function(){return h}));var n,o=i(112),r=i(114),s=i(113),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicRoomUpgradePanel(e,i){var n=t.call(this,e,i)||this;return n.key="picroomupgradepanel",n.MAX_TIMES=4,n}return a(PicRoomUpgradePanel,t),PicRoomUpgradePanel.prototype.resize=function(t,e){var i=this.scaleWidth,n=this.scaleHeight;this.content.x=.5*i,this.content.y=.5*n,this.setSize(i,n)},PicRoomUpgradePanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen(),this.updateData()):this.preload())},PicRoomUpgradePanel.prototype.hide=function(){this.mShow=!1,this.removeListen()},PicRoomUpgradePanel.prototype.updateData=function(){var t=this.mShowData[0];this.mTitleName.text=t.text[0].text;var e=t.data[0];this.roomIcon.on(Phaser.Animations.Events.SPRITE_ANIMATION_REPEAT,this.animationRepeat,this),this.mPlayedTimes=0,this.roomIcon.play("lv"+e)},PicRoomUpgradePanel.prototype.addListen=function(){this.mInitialized&&(this.setInteractive(new Phaser.Geom.Rectangle(.5*this.width,.5*this.height,this.width,this.height),Phaser.Geom.Rectangle.Contains),this.on("pointerup",this.onClickHandler,this))},PicRoomUpgradePanel.prototype.removeListen=function(){this.mInitialized&&(this.removeInteractive(),this.off("pointerup",this.onClickHandler,this))},PicRoomUpgradePanel.prototype.destroy=function(){this.mPlayedTimes=0,t.prototype.destroy.call(this)},PicRoomUpgradePanel.prototype.preload=function(){this.addAtlas(this.key,"e_roomupgrade/e_roomupgrade.png","e_roomupgrade/e_roomupgrade.json"),t.prototype.preload.call(this)},PicRoomUpgradePanel.prototype.init=function(){if(!this.mInitialized){var e=this.scaleWidth,i=this.scaleHeight;this.mBackground=this.scene.make.graphics(void 0,!1),this.mBackground.clear(),this.mBackground.fillStyle(0,.66),this.mBackground.fillRect(0,0,e,i),this.add(this.mBackground),this.content=this.scene.make.container(void 0,!1),this.content.setSize(e,462*this.dpr);var n=this.scene.make.image({x:0,y:-20*this.dpr,key:this.key,frame:"effect_bg"});this.content.add(n);var o=this.scene.make.image({key:this.key,frame:"tittle_bg"});o.y=.5*-this.content.height;var a=22*this.dpr+"px "+s.a.BOLD_FONT;this.mTitleName=this.scene.make.text({x:0,y:o.y,text:"",style:{font:a,fill:"#FFF36D"}}).setOrigin(.5),this.mTitleName.setStroke("#471C1E",8),this.mTitleName.setShadow(2,2,"#471C1E",2,!0,!0),this.mTitleName.setTint(16773997,16773997,16756224,16756224),this.content.add([o,this.mTitleName]);var h=this.scene.make.text({x:0,y:.5*this.content.height-40*this.dpr,text:r.a.t("room_upgrade.clicktocontinue"),style:{fontFamily:s.a.DEFULT_FONT,fontSize:16*this.dpr,color:"#FFF000"}}).setOrigin(.5);this.roomIcon=this.scene.make.sprite({key:this.key,frame:"lv1"}),this.roomIcon.y=-40*this.dpr,this.content.add([this.roomIcon,h]),this.add(this.content),this.createAnimations(),this.resize(0,0),t.prototype.init.call(this)}},PicRoomUpgradePanel.prototype.onClickHandler=function(){if(!(this.mPlayedTimes<this.MAX_TIMES)){var t=this.mShowData[0];this.emit("querytargetui",t.id)}},PicRoomUpgradePanel.prototype.createAnimations=function(){for(var t=1;t<=4;t++)this.scene.anims.create({key:"lv"+t,frames:this.scene.anims.generateFrameNames(this.key,{prefix:"lv",frames:[t-1,t]}),duration:500,repeat:-1})},PicRoomUpgradePanel.prototype.animationRepeat=function(){this.mPlayedTimes++,this.mPlayedTimes>=this.MAX_TIMES&&this.roomIcon.off(Phaser.Animations.Events.SPRITE_ANIMATION_REPEAT,this.animationRepeat,this)},PicRoomUpgradePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicWork",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicWork(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicWork,t),PicWork.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_JOB_LIST,this.on_JOB_LIST),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_PKT_PLAYER_INFO,this.onUpdatePlayerInfo))},PicWork.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicWork.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicWork.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicWork.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(PicWork.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicWork.prototype.query_JOB_LIST=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_JOB_LIST);this.connection.send(t)},PicWork.prototype.query_WORK_ON_JOB=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_WORK_ON_JOB);e.content.id=t,this.connection.send(e)},PicWork.prototype.on_JOB_LIST=function(t){var e=t.content;this.mEvent.emit("questlist",e)},PicWork.prototype.onUpdatePlayerInfo=function(t){this.mEvent.emit("updateplayer",t.content)},PicWork}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicWorkPanel",(function(){return u}));var n,o=i(112),r=i(113),s=i(115),a=i(114),h=i(116),c=i(120),l=i(111),p=i(129),d=i(109),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function PicWorkPanel(e,i){var n=t.call(this,e,i)||this;return n.key="work_ui",n.workItems=[],n}return m(PicWorkPanel,t),PicWorkPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,n,o),this.setSize(n,o),this.mBackground.clear(),this.mBackground.fillStyle(0,.5),this.mBackground.fillRoundedRect(-this.x,-this.y,n,o),this.content.x=.5*n,this.content.y=.5*o,this.mGameScroll.refreshMask(),this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,n,o),Phaser.Geom.Rectangle.Contains)},PicWorkPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},PicWorkPanel.prototype.addListen=function(){this.mInitialized&&this.closeBtn.on("pointerup",this.OnClosePanel,this)},PicWorkPanel.prototype.removeListen=function(){this.mInitialized&&this.closeBtn.off("pointerup",this.OnClosePanel,this)},PicWorkPanel.prototype.preload=function(){this.addAtlas(this.key,"work/work.png","work/work.json"),this.addAtlas(s.UIAtlasKey.commonKey,s.UIAtlasName.commonUrl+".png",s.UIAtlasName.commonUrl+".json"),this.addAtlas(s.UIAtlasKey.common2Key,s.UIAtlasName.common2Url+".png",s.UIAtlasName.common2Url+".json"),t.prototype.preload.call(this)},PicWorkPanel.prototype.init=function(){var e=this;this.mBackground=this.scene.make.graphics(void 0,!1),this.add(this.mBackground);var i=295*this.dpr,n=454*this.dpr;this.content=this.scene.make.container(void 0,!1),this.content.setSize(i,n),this.add(this.content),this.bg=new d.NineSlicePatch(this.scene,0,0,i,n,s.UIAtlasKey.commonKey,"bg",{left:30*this.dpr,top:30*this.dpr,bottom:30*this.dpr,right:30*this.dpr});var o=.5*-n;this.titlebg=this.scene.make.image({x:0,y:0,key:s.UIAtlasKey.common2Key,frame:"title"}),this.titlebg.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.titlebg.y=o+3*this.dpr,this.tilteName=this.scene.make.text({x:0,y:this.titlebg.y+2*this.dpr,text:a.a.t("work.title"),style:{color:"#905C06",fontSize:15*this.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(.5),this.closeBtn=this.scene.make.image({x:.5*i-5*this.dpr,y:o+5*this.dpr,key:s.UIAtlasKey.commonKey,frame:"close"}),this.tilteName.setStroke("#905C06",2),this.tilteName.setResolution(this.dpr),this.closeBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.closeBtn.setInteractive(),this.timesPorgress=new _(this.scene,76*this.dpr,14*this.dpr,this.key,"slider_orange",a.a.t("work.worktimes"),this.dpr),this.timesPorgress.setImageValue(this.key,"icon_work"),this.timesPorgress.y=.5*-n+40*this.dpr,this.timesPorgress.x=-43*this.dpr,this.powerProgress=new _(this.scene,76*this.dpr,14*this.dpr,this.key,"slider_blue",a.a.t("work.vim"),this.dpr),this.powerProgress.setImageValue(this.key,"icon_strength"),this.powerProgress.y=this.timesPorgress.y,this.powerProgress.x=70*this.dpr,this.helpBtn=new d.Button(this.scene,this.key,"icon_tips","icon_tips"),this.helpBtn.y=this.powerProgress.y,this.helpBtn.x=this.powerProgress.x+.5*this.powerProgress.width+5*this.dpr+.5*this.helpBtn.width,this.mGameScroll=new d.GameScroller(this.scene,{x:0,y:18*this.dpr,width:i,height:n-70*this.dpr,zoom:this.scale,dpr:this.dpr,align:2,orientation:0,space:10*this.dpr,selfevent:!0,cellupCallBack:function(t){e.onPointerUpHandler(t)}}),this.itemtips=new p.ItemInfoTips(this.scene,150*this.dpr,46*this.dpr,s.UIAtlasKey.commonKey,"tips_bg",this.dpr),this.itemtips.visible=!1,this.content.add([this.bg,this.closeBtn,this.titlebg,this.tilteName,this.timesPorgress,this.powerProgress,this.helpBtn,this.mGameScroll,this.itemtips]),this.resize(),t.prototype.init.call(this),this.emit("questlist")},PicWorkPanel.prototype.setWorkDataList=function(t){var e=t.jobs;this.mGameScroll.clearItems(!1);for(var i=0,n=this.workItems;i<n.length;i++){(r=n[i]).visible=!1}for(var o=0;o<e.length;o++){var r=void 0;o<this.workItems.length?r=this.workItems[o]:(r=new f(this.scene,this.key,this.dpr),this.workItems.push(r),r.setHandler(new c.a(this,this.onSendHandler),new c.a(this,this.onItemInfoTips))),r.visible=!0,r.setJobData(e[o]),this.mGameScroll.addItem(r)}this.mGameScroll.Sort()},PicWorkPanel.prototype.setProgressData=function(t,e){e&&this.timesPorgress.setProgressDatas(e),t&&this.powerProgress.setProgressDatas(t)},PicWorkPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},PicWorkPanel.prototype.OnClosePanel=function(){this.emit("hide")},PicWorkPanel.prototype.onPointerUpHandler=function(t){this.selectItem&&this.selectItem.setExtend(!1),t.setExtend(!0),this.selectItem=t,this.mGameScroll.Sort(!0)},PicWorkPanel.prototype.onSendHandler=function(t){this.emit("questwork",t)},PicWorkPanel.prototype.onItemInfoTips=function(t,e,i){this.itemtips.visible=e,this.itemtips.x=i.x*this.scale-this.content.x,this.itemtips.y=i.y*this.scale-this.content.y-30*this.dpr,this.itemtips.setText(this.getDesText(t))},PicWorkPanel.prototype.getDesText=function(t){return t||(t={sellingPrice:!0,tradable:!1}),a.a.t("work.attri",{name:""+t.name,value:t.neededCount})},PicWorkPanel}(o.BasePanel),f=function(t){function WorkItem(e,i,n){var o=t.call(this,e)||this;o.imageValues=[],o.isExtend=!1,o.pointTimestamp=0,o.key=i,o.dpr=n;var c=256*n,l=68*n;o.setSize(c,l),o.topCon=e.make.container(void 0,!1),o.add(o.topCon),o.topCon.setSize(c,l),o.bg=new d.NineSlicePatch(o.scene,0,0,c,l,o.key,"bg_default",{left:6*o.dpr,top:0*o.dpr,bottom:0*o.dpr,right:6*n}),o.headIcon=new h.DynamicImage(e,0,0),o.title=e.make.text({x:.5*-o.width+60*n,y:.5*-l+5*n,text:"",style:{color:"#ffffff",fontSize:13*n,fontFamily:r.a.DEFULT_FONT}}),o.salaryvalue=new y(e,60*n,20*n,o.key,o.dpr),o.salaryvalue.setTextStyle({color:"#FFEA00"}),o.salaryvalue.setFrameValue("",s.UIAtlasKey.commonKey,"iv_coin"),o.salaryvalue.x=.5*o.width-30*n,o.salaryvalue.y=.5*-o.height+10*n,o.salaryLabel=e.make.text({x:o.salaryvalue.x-.5*o.salaryvalue.width-5*n,y:o.salaryvalue.y,text:a.a.t("work.salary")+":",style:{color:"#ffffff",fontSize:11*n,fontFamily:r.a.DEFULT_FONT}}),o.salaryLabel.setOrigin(1,.5),o.worklabel=e.make.text({x:.5*-o.width+60*n,y:.5*o.height-12*n,text:"",style:{color:"#ffffff",fontSize:11*n,fontFamily:r.a.DEFULT_FONT}}),o.worklabel.setOrigin(0,.5),o.topCon.add([o.bg,o.headIcon,o.title,o.salaryvalue,o.salaryLabel,o.worklabel]);var p=46*n;return o.bottomCon=e.make.container(void 0,!1),o.bottomCon.setSize(c,p),o.workbg=new d.NineSlicePatch(o.scene,0,0,o.width,p,o.key,"bg_a_unfold",{left:6*o.dpr,top:0*o.dpr,bottom:0*o.dpr,right:6*n}),o.workBtn=new d.NineSliceButton(e,0,0,90*n,36*n,s.UIAtlasKey.commonKey,"yellow_btn_normal",a.a.t("work.title"),n,void 0,{left:14*o.dpr,top:14*o.dpr,bottom:14*o.dpr,right:14*n}),o.workBtn.x=0,o.workBtn.setTextStyle({fontSize:12*n,color:"#996600",bold:!0}),o.bottomCon.add([o.workbg,o.workBtn]),o.workBtn.on(String(d.ClickEvent.Tap),o.onWorkHandler,o),o}return m(WorkItem,t),WorkItem.prototype.setHandler=function(t,e){this.sendHandler=t,this.tipsHandler=e},WorkItem.prototype.setJobData=function(t){var e=this;this.jobData=t;var i=l.i.getOsdRes(t.display.texturePath);this.headIcon.load(i,this,(function(){e.headIcon.scale=1,e.headIcon.scaleX=45*e.dpr/e.headIcon.displayHeight,e.headIcon.scaleY=e.headIcon.scaleX,e.headIcon.x=.5*-e.width+.5*e.headIcon.displayWidth+10*e.dpr})),this.title.text=t.name;var n="0";if(t.rewards){var o=t.rewards[0].countRange;n=o.start+"~"+o.stop}this.salaryvalue.setText(n),this.salaryvalue.x=.5*this.width-.5*this.salaryvalue.width-10*this.dpr,this.salaryLabel.x=this.salaryvalue.x-.5*this.salaryvalue.width-5*this.dpr,this.worklabel.text=t.detail;for(var r=t.targets,s=0,a=this.imageValues;s<a.length;s++){(d=a[s]).visible=!1}for(var h=.5*-this.width+55*this.dpr,p=0;p<r.length;p++){var d=void 0,m=r[p];p<this.imageValues.length?d=this.imageValues[p]:(d=new g(this.scene,35*this.dpr,15*this.dpr,this.key,this.dpr),this.topCon.add(d),this.imageValues.push(d),d.setHandler(new c.a(this,this.onTipsandler)));var u=l.i.getOsdRes(m.display.texturePath);d.setUrlValue(u,m.neededCount),d.setTextStyle({color:m.count>=m.neededCount?"#000000":"#E71313"}),d.setImageData(m),d.visible=!0,d.x=h+.5*d.width,d.y=0,h+=d.width+20*this.dpr}},WorkItem.prototype.setExtend=function(t){if(this.isExtend!==t)if(this.isExtend=t,this.bottomCon.visible=t,t){this.add(this.bottomCon);var e=this.topCon.height+this.bottomCon.height;this.setSize(this.width,e),this.topCon.y=.5*-e+.5*this.topCon.height,this.bottomCon.y=this.topCon.y+.5*this.topCon.height+.5*this.bottomCon.height,this.bg.setFrame("bg_click")}else{this.remove(this.bottomCon);e=this.topCon.height;this.setSize(this.width,e),this.topCon.y=0,this.bg.setFrame("bg_default")}},WorkItem.prototype.destroy=function(e){t.prototype.destroy.call(this,e)},WorkItem.prototype.onWorkHandler=function(){var t=(new Date).getTime();this.pointTimestamp>t||(this.pointTimestamp=t+1e3,this.sendHandler&&this.sendHandler.runWith(this.jobData.id))},WorkItem.prototype.onTipsandler=function(t,e){var i=t.getWorldTransformMatrix();this.tipsHandler&&this.tipsHandler.runWith([t.imageData,e,new Phaser.Geom.Point(i.tx,i.ty)])},WorkItem}(Phaser.GameObjects.Container),y=function(t){function ImageValue(e,i,n,o,r,s){void 0===s&&(s=0);var a=t.call(this,e)||this;return a.dpr=r,a.key=o,a.offsetx=s,a.setSize(i,n),a.create(),a}return m(ImageValue,t),ImageValue.prototype.setFrameValue=function(t,e,i){this.icon.setTexture(e,i),this.value.text=t,this.resetSize()},ImageValue.prototype.setText=function(t){this.value.text=t,this.resetSize()},ImageValue.prototype.setTextStyle=function(t){this.value.setStyle(t)},ImageValue.prototype.setShadow=function(t,e,i,n,o,r){this.value.setShadow(t,e,i,n,o,r)},ImageValue.prototype.setStroke=function(t,e){this.value.setStroke(t,e)},ImageValue.prototype.resetSize=function(){var t=this.icon.displayWidth+this.value.width;this.setSize(t,this.height),this.resetPosition()},ImageValue.prototype.create=function(){this.icon=this.scene.make.image(void 0),this.value=this.scene.make.text({x:0,y:this.offsetx,text:"10",style:{color:"#ffffff",fontSize:11*this.dpr,fontFamily:r.a.DEFULT_FONT}}),this.value.setOrigin(0,.5),this.add([this.icon,this.value])},ImageValue.prototype.resetPosition=function(){this.icon.x=.5*-this.width+.5*this.icon.displayWidth,this.value.x=this.icon.x+.5*this.icon.displayWidth+4*this.dpr},ImageValue}(Phaser.GameObjects.Container),g=function(t){function PointerImageValue(e,i,n,o,r,s){void 0===s&&(s=0);var a=t.call(this,e,i,n,o,r,s)||this;return a.addListen(),a}return m(PointerImageValue,t),PointerImageValue.prototype.setImageData=function(t){this.imageData=t},PointerImageValue.prototype.setUrlValue=function(t,e){var i=this;this.value.text=e,this.icon.load(t,this,(function(){i.icon.scale=1,i.icon.scaleY=14*i.dpr/i.icon.displayHeight,i.icon.scaleX=i.icon.scaleY,i.value.x=i.icon.x+.5*i.icon.displayWidth+10*i.dpr,i.resetSize()}))},PointerImageValue.prototype.addListen=function(){this.setInteractive(),this.on("pointerdown",this.onClickDownHandler,this),this.scene.input.on("pointerup",this.onClickUpHandler,this)},PointerImageValue.prototype.removeListen=function(){this.disableInteractive(),this.off("pointerdown",this.onClickDownHandler,this),this.scene.input.off("pointerup",this.onClickUpHandler,this)},PointerImageValue.prototype.destroy=function(e){this.removeListen(),t.prototype.destroy.call(this,e)},PointerImageValue.prototype.setHandler=function(t){this.tipsHandler=t},PointerImageValue.prototype.create=function(){this.icon=new h.DynamicImage(this.scene,0,0),this.value=this.scene.make.text({x:0,y:this.offsetx,text:"10",style:{color:"#ffffff",fontSize:11*this.dpr,fontFamily:r.a.DEFULT_FONT}}),this.value.setOrigin(0,.5),this.add([this.icon,this.value])},PointerImageValue.prototype.onClickDownHandler=function(){new Phaser.Geom.Point;this.tipsHandler&&this.tipsHandler.runWith([this,!0])},PointerImageValue.prototype.onClickUpHandler=function(){this.tipsHandler&&this.tipsHandler.runWith([this,!1])},PointerImageValue}(y),_=function(t){function ProgressItem(e,i,n,o,s,a,h){var c=t.call(this,e)||this;c.setSize(i,n),c.dpr=h,c.key=o;var l={x:0,y:0,width:i,height:n,background:{x:0,y:0,width:i,height:n,config:{top:0*h,left:7*h,right:7*h,bottom:0*h},key:o,frame:"slider_bottom"},bar:{x:0,y:0,width:i-4*h,height:n-4*h,config:{top:0*h,left:7*h,right:7*h,bottom:0*h},key:o,frame:s},dpr:h,textConfig:void 0};return c.progress=new d.ProgressBar(e,l),c.add(c.progress),c.imgvalue=new y(e,c.width-20*h,c.height,o,h),c.imgvalue.y=h,c.add(c.imgvalue),c.imgvalue.setTextStyle({fontSize:10*h,fontFamily:r.a.NUMBER}),c.title=e.make.text({x:.5*-c.progress.width-3*h,y:0,text:a,style:{color:"#6A7AFF",fontSize:9*h,fontFamily:r.a.DEFULT_FONT}}),c.title.setOrigin(1,.5),c.add(c.title),c}return m(ProgressItem,t),ProgressItem.prototype.setImageValue=function(t,e){this.imgvalue.setFrameValue("",t,e)},ProgressItem.prototype.setProgressDatas=function(t){this.progress.setProgress(t.currentValue,t.max),this.imgvalue.setText(t.currentValue+"/"+t.max)},ProgressItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMessageBoxPanel",(function(){return l}));var n,o=i(112),r=i(117),s=i(113),a=i(121),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicaMessageBoxPanel(e,i){var n=t.call(this,e,i)||this;return n.key="pica_message_box",n}return c(PicaMessageBoxPanel,t),PicaMessageBoxPanel.prototype.show=function(e){if(t.prototype.show.call(this,e),this.mInitialized){var i=e[0];this.mButtons=[],i&&(i.text&&i.text[0]&&(this.mText.setText(i.text[0].text),this.mText.x=-this.mText.width/2,this.mText.y=-this.mText.height),i.title&&this.mTitleLabel.setText(i.title.text));var n=i.button;if(n){var o=114*this.dpr,r=40*this.dpr,h=(this.width-42*this.dpr)/n.length;this.mButtonContaier.y=this.height/2-r;var c=this.scene.textures.getFrame(this.key,"yellow_btn_normal");if(!c)return;for(var l={left:13*this.dpr,top:13*this.dpr,bottom:c.width-2-13*this.dpr,right:c.height-2-13*this.dpr},p=0,d=0;d<n.length;d++){n[d]&&n[d].text;var m=new a.NinePatchButton(this.mScene,0,0,o,r,this.key,0===d?"yellow_btn":"red_btn",n[d].text,l,n[d]);m.setTextStyle({fontFamily:s.a.DEFULT_FONT,fontSize:16*this.dpr}),m.x=d*h+o/2,p+=d*h+o/2,this.mButtons.push(m),m.on("click",this.onClickHandler,this)}this.mButtonContaier.add(this.mButtons),this.mButtonContaier.x=-p/2}this.resize(0,0)}},PicaMessageBoxPanel.prototype.resize=function(e,i){var n=this.scene.cameras.main.width,o=this.scene.cameras.main.height;this.x=n/2,this.y=o/2,t.prototype.resize.call(this,e,i)},PicaMessageBoxPanel.prototype.preload=function(){this.addAtlas(this.key,"pica_message_box/pica_message_box.png","pica_message_box/pica_message_box.json"),t.prototype.preload.call(this)},PicaMessageBoxPanel.prototype.init=function(){var e=this.scene.cameras.main,i=e.width,n=e.height,o=this.scene.make.graphics(void 0,!1);o.fillStyle(0,.6),o.fillRect(.5*-i,.5*-n,i,n),o.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains),this.add(o);var a=this.scene.textures.getFrame(this.key,"bg"),c=new r.NinePatch(this.scene,0,0,286*this.dpr,a.height,this.key,"bg",{left:22*this.dpr,top:a.height,right:22*this.dpr,bottom:0});this.setSize(c.width,c.height),this.mButtonContaier=this.scene.make.container(void 0,!1);var l=this.scene.make.image({y:-c.height/2,key:this.key,frame:"title"});this.mTitleLabel=this.scene.make.text({y:l.y-6*this.dpr,style:{fontFamily:s.a.DEFULT_FONT,fontSize:16*this.dpr,color:"#3366cc"}},!1).setOrigin(.5),this.mText=new h.BBCodeText(this.mScene,0,0,"",{fontSize:14*this.dpr+"px",fontFamily:s.a.DEFULT_FONT,color:"#000000",origin:{x:.5,y:.5},wrap:{mode:"char",width:this.width},align:"center"}),this.add([c,l,this.mTitleLabel,this.mText,this.mButtonContaier]),t.prototype.init.call(this),this.resize(i,n),this.setInteractive(new Phaser.Geom.Rectangle(0,0,i,n),Phaser.Geom.Rectangle.Contains)},PicaMessageBoxPanel.prototype.onClickHandler=function(t,e){if(e){var i=e.getBtnData();i&&this.emit("click",i)}},PicaMessageBoxPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNavigate",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicaNavigate(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicaNavigate,t),PicaNavigate.prototype.register=function(){this.connection&&this.connection.addPacketListener(this)},PicaNavigate.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicaNavigate.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicaNavigate.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicaNavigate.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},PicaNavigate.prototype.queryGOHomeHandler=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_GO_HOME);this.connection.send(t)},Object.defineProperty(PicaNavigate.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicaNavigate}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNavigatePanel",(function(){return c}));var n,o=i(112),r=i(114),s=i(115),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicaNavigatePanel(e,i){var n=t.call(this,e,i)||this;return n.key="pica_navigate",n.key_lang="key_lang",n.UIType=a.UIType.Scene,n.setTween(!1),n.setInteractive(),n}return h(PicaNavigatePanel,t),PicaNavigatePanel.prototype.resize=function(e,i){this.setSize(e,i);var n=this.scale,o=this.scene.cameras.main.width/n,r=this.scene.cameras.main.height,a=o/this.scene.textures.getFrame(s.UIAtlasKey.commonKey,"menu_bg").width*this.dpr;this.mBackground.scaleX=a,this.mBackground.x=o/2,this.mBackground.setInteractive(),this.mCloseBtn.x=o-this.mCloseBtn.width/2-3*this.dpr,this.mGoHomeBtn.x=this.mCloseBtn.x-.5*this.mCloseBtn.width-.5*this.mGoHomeBtn.width-24*this.dpr,this.y=r-this.height/2,t.prototype.resize.call(this,e,i)},PicaNavigatePanel.prototype.addListen=function(){this.mInitialized&&this.interactiveBoo&&(this.mMapBtn.on("pointerup",this.onShowMapHandler,this),this.mShopBtn.on("pointerup",this.onShowShopHandler,this),this.mBagBtn.on("pointerup",this.onShowBagHandler,this),this.mFamilyBtn.on("pointerup",this.onShowFamilyHandler,this),this.mGoHomeBtn.on("pointerup",this.onShowGoHomeHandler,this),this.mCloseBtn.on("pointerup",this.onCloseHandler,this))},PicaNavigatePanel.prototype.removeListen=function(){this.mInitialized&&(this.mMapBtn.off("pointerup",this.onShowMapHandler,this),this.mShopBtn.off("pointerup",this.onShowShopHandler,this),this.mBagBtn.off("pointerup",this.onShowBagHandler,this),this.mFamilyBtn.off("pointerup",this.onShowFamilyHandler,this),this.mGoHomeBtn.on("pointerup",this.onShowGoHomeHandler,this),this.mCloseBtn.off("pointerup",this.onCloseHandler,this))},PicaNavigatePanel.prototype.hide=function(){this.mShow=!1},PicaNavigatePanel.prototype.show=function(e){t.prototype.show.call(this,e),this.checkUpdateActive()},PicaNavigatePanel.prototype.updateUIState=function(t){this.mInitialized&&("picanavigate.mapbtn"===t.name&&(this.mMapBtn.visible=t.visible,t.disabled?this.mMapBtn.removeInteractive():this.mMapBtn.setInteractive()),"picanavigate.marketbtn"===t.name&&(this.mShopBtn.visible=t.visible,t.disabled?this.mShopBtn.removeInteractive():this.mShopBtn.setInteractive()),"picanavigate.bagbtn"===t.name&&(this.mBagBtn.visible=t.visible,t.disabled?this.mBagBtn.removeInteractive():this.mBagBtn.setInteractive()),"picanavigate.gohomebtn"===t.name&&(this.mGoHomeBtn.visible=t.visible,t.disabled?this.mGoHomeBtn.removeInteractive():this.mGoHomeBtn.setInteractive()))},Object.defineProperty(PicaNavigatePanel.prototype,"isZh_CN",{get:function(){return"zh-CN"===r.a.language},enumerable:!1,configurable:!0}),PicaNavigatePanel.prototype.preload=function(){this.addAtlas(s.UIAtlasKey.commonKey,s.UIAtlasName.commonUrl+".png",s.UIAtlasName.commonUrl+".json");var e="cn";this.isZh_CN||(e="en"),this.addAtlas(this.key_lang,"pica_navigate/pica_navigate_"+e+".png","pica_navigate/pica_navigate_"+e+".json"),t.prototype.preload.call(this)},PicaNavigatePanel.prototype.init=function(){this.mBackground=this.createImage(s.UIAtlasKey.commonKey,"menu_bg"),this.mBackground.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.mMapBtn=this.createButton(this.key_lang,"map_btn"),this.mShopBtn=this.createButton(this.key_lang,"shop_btn"),this.mBagBtn=this.createButton(this.key_lang,"bag_btn"),this.mFamilyBtn=this.createButton(this.key_lang,"family_btn"),this.mGoHomeBtn=this.createImage(this.key_lang,"home_btn").setInteractive(),this.mCloseBtn=this.createImage(s.UIAtlasKey.commonKey,"close_1").setInteractive();var e,i=[this.mMapBtn,this.mShopBtn,this.mBagBtn,this.mFamilyBtn,this.mGoHomeBtn];this.add([this.mBackground]),this.add(i),this.add(this.mCloseBtn);for(var n=0;n<i.length;n++)0===n?i[n].x=10.33*this.dpr+.5*i[n].width:(e=i[n-1],i[n].x=e.x+12*this.dpr+.5*(i[n].width+e.width));var o=this.scale;this.resize(this.mBackground.width*o,this.mBackground.height*o),t.prototype.init.call(this)},PicaNavigatePanel.prototype.createButton=function(t,e){var i;return(i=this.isZh_CN?this.createImage(t,e):this.createSprite(t,e)).setInteractive(),i},PicaNavigatePanel.prototype.createImage=function(t,e){return this.scene.make.image({key:t,frame:e},!1)},PicaNavigatePanel.prototype.createSprite=function(t,e){var i=this.scene.make.sprite({key:this.key_lang,frame:e+"_1"});return this.scene.anims.create({key:e,frames:this.scene.anims.generateFrameNames(this.key_lang,{prefix:e+"_",frames:[1,3]}),duration:500,repeat:-1}),i.play(e),i},PicaNavigatePanel.prototype.onShowMapHandler=function(){this.emit("showPanel","PicaRoomList")},PicaNavigatePanel.prototype.onShowShopHandler=function(){this.emit("showPanel","Market")},PicaNavigatePanel.prototype.onShowBagHandler=function(){this.emit("showPanel","FurniBag")},PicaNavigatePanel.prototype.onShowFamilyHandler=function(){this.emit("showPanel","PicOrder")},PicaNavigatePanel.prototype.onShowGoHomeHandler=function(){this.emit("goHome")},PicaNavigatePanel.prototype.onCloseHandler=function(){this.emit("close")},PicaNavigatePanel.prototype.checkUpdateActive=function(){var t=this.mWorld.uiManager.getActiveUIData("PicHandheld");if(t)for(var e=0,i=t;e<i.length;e++){var n=i[e];this.updateUIState(n)}},PicaNavigatePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNoticePanel",(function(){return h}));var n,o=i(112),r=i(113),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicaNoticePanel(e,i){return t.call(this,e,i)||this}return a(PicaNoticePanel,t),PicaNoticePanel.prototype.show=function(t){var e=this;if(this.mShowData=t,this.mInitialized){if(t&&t.length>0){var i=t[0].text;this.mContent&&this.mContent.setText(i[0].text);this.scene.cameras.main.width;this.scene.tweens.timeline({targets:this,duration:500,tweens:[{y:"-="+20*this.dpr,ease:"Bounce.easeOut"},{delay:2e3,y:"-="+20*this.dpr,ease:"Linear",alpha:0}],onComplete:function(){e.emit("close")}})}}else this.preload()},PicaNoticePanel.prototype.resize=function(){this.x=this.scene.cameras.main.width/2,this.y=170*this.dpr},PicaNoticePanel.prototype.preload=function(){this.addImage("pica_notice_bg","pica_notice/bg.png"),t.prototype.preload.call(this)},PicaNoticePanel.prototype.init=function(){var e=this.scene.make.image({key:"pica_notice_bg"},!1);this.mContent=new s.BBCodeText(this.mScene,0,0,"",{fontSize:16*this.dpr+"px",fontFamily:r.a.DEFULT_FONT,stroke:"#000000",strokeThickness:1*this.dpr,align:"center",textMask:!1,shadow:{offsetX:0,offsetY:0,color:"#000",blur:4,stroke:!0,fill:!0},wrap:{mode:"char",width:e.width*this.scale-12*this.dpr}}).setOrigin(.5,.5),this.mContent.setFontStyle("bold"),this.add([e,this.mContent]),this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),t.prototype.init.call(this),this.resize()},PicaNoticePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaRoomListPanel",(function(){return d})),i.d(e,"RoomDelegate",(function(){return m})),i.d(e,"RoomZoon",(function(){return f}));var n,o=i(112),r=i(113),s=i(127),a=i(114),h=i(2),c=i(115),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function PicaRoomListPanel(e,i){var n=t.call(this,e,i)||this;return n.key="pica_roomlist",n.mSelectIndex=0,n}return p(PicaRoomListPanel,t),PicaRoomListPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;this.content.x=n>>1,this.content.y=o>>1,this.mBackGround.clear(),this.mBackGround.fillStyle(7004927,0),this.mBackGround.fillRect(0,0,n,o),this.mBackGround.setInteractive(new Phaser.Geom.Rectangle(0,0,n,o),Phaser.Geom.Rectangle.Contains),t.prototype.resize.call(this,n,o),this.setSize(n,o)},PicaRoomListPanel.prototype.updateRoomList=function(t){t&&this.mRoomDele.updateList(t)},PicaRoomListPanel.prototype.updateMyRoomList=function(t){t&&this.mMyRoomDele.updateList(t)},PicaRoomListPanel.prototype.addListen=function(){this.mInitialized&&(this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.mSeachBtn.on("pointerup",this.onSeachHandler,this))},PicaRoomListPanel.prototype.removeListen=function(){this.mInitialized&&(this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.mSeachBtn.off("pointerup",this.onSeachHandler,this))},PicaRoomListPanel.prototype.destroy=function(){this.mScroller&&this.mScroller.destroy(),t.prototype.destroy.call(this)},PicaRoomListPanel.prototype.preload=function(){this.addAtlas(c.UIAtlasKey.commonKey,c.UIAtlasName.commonUrl+".png",c.UIAtlasName.commonUrl+".json"),this.addAtlas(this.key,"pica_roomlist/pica_roomlist.png","pica_roomlist/pica_roomlist.json"),t.prototype.preload.call(this)},PicaRoomListPanel.prototype.init=function(){var e=this;this.setSize(this.scaleWidth,this.scaleWidth);var i=this.mWorld.uiScale,n=this.scene.make.image({key:this.key,frame:"bg.png"},!1).setInteractive();this.mBackGround=this.scene.make.graphics(void 0,!1),this.mCloseBtn=this.scene.make.image({key:this.key,frame:"close_btn.png"},!1).setInteractive(),this.mCloseBtn.x=n.width/2-this.mCloseBtn.width/2-2*this.dpr,this.mCloseBtn.y=-n.height/2+this.mCloseBtn.height/2,this.mRoomDeleBtn=new l.TabButton(this.scene,this.key,"checkbox_normal","checkbox_down",a.a.t("room_list.visit")),this.mRoomDeleBtn.x=-54*this.dpr,this.mRoomDeleBtn.y=-n.height/2+this.mRoomDeleBtn.displayHeight/2-4*this.dpr,this.mRoomDeleBtn.setTextStyle({color:"#3333cc",fontFamily:r.a.DEFULT_FONT,fontSize:14*this.dpr}),this.mRoomDeleBtn.setFontStyle("bold"),this.mMyRoomDeleBtn=new l.TabButton(this.scene,this.key,"checkbox_normal","checkbox_down",a.a.t("room_list.my")),this.mMyRoomDeleBtn.x=54*this.dpr,this.mMyRoomDeleBtn.y=this.mRoomDeleBtn.y,this.mMyRoomDeleBtn.setTextStyle({color:"#3333cc",fontFamily:r.a.DEFULT_FONT,fontSize:16*this.dpr}),this.mMyRoomDeleBtn.setFontStyle("bold");var o=new s.CheckboxGroup;o.appendItemAll([this.mRoomDeleBtn,this.mMyRoomDeleBtn]),o.on("selected",this.onSelectedHandler,this),this.mSelectIndex=0,this.mRoomContainer=this.scene.make.container(void 0,!1),this.mRoomContainer.setSize(282*this.dpr,362*this.dpr),this.mRoomContainer.y=-n.height/2+11*this.dpr*i,this.mSeachBtn=this.scene.make.image({key:this.key,frame:"seach_btn.png"},!1).setInteractive(),this.mSeachBtn.y=n.height/2-this.mSeachBtn.height/2+12*this.dpr;var h=this.scene.make.text({x:-35*this.dpr,y:this.mSeachBtn.y,text:a.a.t("room_list.seach"),style:{color:"#996600",fontFamily:r.a.DEFULT_FONT,fontSize:14*this.dpr}},!1).setOrigin(.5),c=this.scene.make.text({x:35*this.dpr,y:this.mSeachBtn.y,text:a.a.t("room_list.room"),style:{color:"#996600",fontFamily:r.a.DEFULT_FONT,fontSize:14*this.dpr}},!1).setOrigin(.5);this.content=this.scene.make.container(void 0,!1),this.content.setSize(n.width,n.height),this.content.add([n,this.mRoomContainer,this.mCloseBtn,this.mSeachBtn,h,c]),this.add([this.mBackGround,this.content]),t.prototype.init.call(this),this.resize(0,0);var p=this.mRoomContainer.width*this.scale,d=this.mRoomContainer.height*this.scale,m={x:this.scaleWidth-p/this.scale>>1,y:this.content.y-this.content.height/2+20*this.dpr*this.scale,clickX:0,clickY:0,width:this.scaleWidth,height:d,boundPad0:-40*this.dpr*i,zoom:i,dpr:this.dpr,value:this.content.y,valuechangeCallback:function(t){e.mRoomContainer.y=t-e.content.y-d/2},cellupCallBack:function(t){t.onEnterRoomHandler()},overminCallbackScope:this,overminCallback:function(){e.mRoomDele&&0===e.mSelectIndex&&e.mRoomDele.overminHandler(),e.mMyRoomDele||1!==e.mSelectIndex||e.mMyRoomDele.overminHandler()}};this.mScroller=new l.BaseScroller(this.scene,this.mRoomContainer,m),this.content.add([this.mRoomDeleBtn,this.mMyRoomDeleBtn,this.mCloseBtn]),o.selectIndex(0)},PicaRoomListPanel.prototype.showRoomList=function(){this.mMyRoomDele&&(this.mMyRoomDele.removeFromContainer(),this.mMyRoomDele.off("enterRoom",this.onEnterRoomHandler,this)),this.mRoomDele||(this.mRoomDele=new m(this.mRoomContainer,this.mScroller,this.scene,this.mWorld,this.key,this.dpr)),this.mRoomDele.on("enterRoom",this.onEnterRoomHandler,this),this.mRoomDele.addToContainer(),this.emit("getRoomList")},PicaRoomListPanel.prototype.showMyRoomList=function(){this.mRoomDele&&(this.mRoomDele.removeFromContainer(),this.mRoomDele.off("enterRoom",this.onEnterRoomHandler,this)),this.mMyRoomDele||(this.mMyRoomDele=new u(this.mRoomContainer,this.mScroller,this.mWorld,this.scene,this.key,this.dpr)),this.mMyRoomDele.on("enterRoom",this.onEnterRoomHandler,this),this.mMyRoomDele.addToContainer(),this.emit("getMyRoomList")},PicaRoomListPanel.prototype.onEnterRoomHandler=function(t){this.emit("enterRoom",t)},PicaRoomListPanel.prototype.onSelectedHandler=function(t){if(t instanceof l.Button){switch(this.mRoomContainer.removeAll(!1),t){case this.mRoomDeleBtn:this.showRoomList(),this.mSelectIndex=0;break;case this.mMyRoomDeleBtn:this.showMyRoomList(),this.mSelectIndex=1}t.setTextColor("#996600"),this.preTabButton&&this.preTabButton.setTextColor("#3333cc"),this.preTabButton=t}},PicaRoomListPanel.prototype.onSeachHandler=function(){},PicaRoomListPanel.prototype.onCloseHandler=function(){this.emit("close")},PicaRoomListPanel}(o.BasePanel),m=function(t){function RoomDelegate(e,i,n,o,r,s){void 0===s&&(s=1);var a=t.call(this)||this;return a.mChildPad=0,a.mDpr=1,a.mHeight=0,a.mDpr=s,a.mWorld=o,a.mChildPad=0,a.mScene=n,a.mContainer=e,a.mScroller=i,a.mKey=r,a.init(),a}return p(RoomDelegate,t),RoomDelegate.prototype.addListen=function(){this.mPopularityRoom.on("enterRoom",this.onEnterRoomHandler,this),this.mPlayerRoom.on("enterRoom",this.onEnterRoomHandler,this)},RoomDelegate.prototype.removeListen=function(){this.mPopularityRoom.off("enterRoom",this.onEnterRoomHandler,this),this.mPlayerRoom.off("enterRoom",this.onEnterRoomHandler,this)},RoomDelegate.prototype.updateList=function(t){this.mContent=t,this.mScroller.clearInteractiveObject(),this.mHeight=this.activity.height,this.mChildPad=this.activity.height+14*this.mDpr,this.mContent&&this.mPopularityRoom.addItem(t.popularRooms,this.mChildPad)},RoomDelegate.prototype.addToContainer=function(){this.addListen(),this.refreshPos()},RoomDelegate.prototype.removeFromContainer=function(){this.removeListen(),this.mPopularityRoom&&this.mPopularityRoom.clear(),this.mPlayerRoom&&this.mPlayerRoom.clear()},RoomDelegate.prototype.destroy=function(){this.removeListen(),this.mPlayerRoom&&this.mPopularityRoom.destroy(),this.mPopularityRoom&&this.mPopularityRoom.destroy(),this.mScroller&&this.mScroller.destroy(),this.activity&&this.activity.destroy(),t.prototype.destroy.call(this)},RoomDelegate.prototype.overminHandler=function(){var t=this.mPlayerRoom.updateItem();t&&this.mPlayerRoom.mRefreshRooms&&(this.mHeight+=t,this.mContainer.add(this.mPlayerRoom.mRefreshRooms),this.setUpdateScrollInteractive(this.mPlayerRoom.mRefreshRooms))},RoomDelegate.prototype.setUpdateScrollInteractive=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];this.mScroller.setInteractiveObject(n)}this.mScroller.refreshBound(this.mHeight)},RoomDelegate.prototype.init=function(){var t=this;this.activity=this.mScene.make.image({key:this.mKey,frame:"activity_title.png"},!1),this.activity.y=this.activity.height/2+2*this.mDpr,this.mChildPad+=this.activity.height/2+18*this.mDpr,this.mPopularityRoom=new g(this.mScene,this.mKey,"popularity_icon.png",a.a.t("room_list.popularity_room"),this.mDpr,this.mWorld.uiScale,0,this.mChildPad,(function(e){t.mPopularityRoom.roomList&&t.setScrollInteractive(t.mPopularityRoom.roomList),t.mHeight+=e,t.refreshPos(),t.mChildPad+=t.mPopularityRoom.height,t.mPlayerRoom.addItem(t.mContent.playerRooms,t.mChildPad)})),this.mPlayerRoom=new f(this.mScene,this.mKey,"player_icon.png",a.a.t("room_list.player_room"),this.mDpr,this.mWorld.uiScale,0,this.mChildPad,(function(e){t.mPlayerRoom.roomList&&t.setScrollInteractive(t.mPlayerRoom.roomList),t.mHeight+=e,t.refreshPos(),t.mScroller.refreshBound(t.mHeight),t.mScroller.setValue(t.mContainer.parentContainer.y)})),this.mScroller.refreshBound(this.activity.height),this.mScroller.setValue(this.mContainer.parentContainer.y)},RoomDelegate.prototype.refreshPos=function(){var t=this;this.activity&&(this.activity.setTexture(this.mKey,"activity_title.png"),this.mContainer.add(this.activity)),this.mPopularityRoom&&this.mPopularityRoom.showList&&(this.mContainer.add(this.mPopularityRoom.showList),this.mPopularityRoom.roomList&&this.mPopularityRoom.roomList.forEach((function(e){t.mContainer.add(e)}))),this.mPlayerRoom&&this.mPlayerRoom.showList&&(this.mContainer.add(this.mPlayerRoom.showList),this.mPlayerRoom.roomList&&this.mPlayerRoom.roomList.forEach((function(e){t.mContainer.add(e)})))},RoomDelegate.prototype.onEnterRoomHandler=function(t){this.emit("enterRoom",t)},RoomDelegate.prototype.setScrollInteractive=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];this.mScroller.setInteractiveObject(n)}this.refreshPos()},RoomDelegate}(Phaser.Events.EventEmitter),u=function(t){function MyRoomDelegate(e,i,n,o,r,s){return void 0===s&&(s=1),t.call(this,e,i,o,n,r,s)||this}return p(MyRoomDelegate,t),MyRoomDelegate.prototype.addListen=function(){this.mMyRoom.on("enterRoom",this.onEnterRoomHandler,this),this.mMyHistory.on("enterRoom",this.onEnterRoomHandler,this)},MyRoomDelegate.prototype.removeListen=function(){this.mMyRoom.off("enterRoom",this.onEnterRoomHandler,this),this.mMyHistory.off("enterRoom",this.onEnterRoomHandler,this)},MyRoomDelegate.prototype.addToContainer=function(){this.addListen(),this.refreshPos()},MyRoomDelegate.prototype.removeFromContainer=function(){this.removeListen(),this.mMyRoom&&this.mMyRoom.clear(),this.mMyHistory&&this.mMyHistory.clear()},MyRoomDelegate.prototype.updateList=function(t){this.mMyRoom&&(this.mContent=t,this.mScroller.clearInteractiveObject(),this.mHeight=this.activity.height,this.mChildPad=this.activity.height+14*this.mDpr,this.mMyRoom.addItem(t.selfRooms,this.mChildPad))},MyRoomDelegate.prototype.overminHandler=function(){var t=this.mMyHistory.updateItem();t&&this.mMyHistory.mRefreshRooms&&(this.mHeight+=t,this.mContainer.add(this.mMyHistory.mRefreshRooms),this.setUpdateScrollInteractive(this.mMyHistory.mRefreshRooms))},MyRoomDelegate.prototype.destroy=function(){this.mMyRoom&&this.mMyRoom.destroy(),this.mMyHistory&&this.mMyHistory.destroy(),t.prototype.destroy.call(this)},MyRoomDelegate.prototype.refreshPos=function(){var t=this;this.activity&&(this.activity.setTexture(this.mKey,"activity_title.png"),this.mContainer.add(this.activity)),this.mMyRoom&&this.mMyRoom.showList&&(this.mContainer.add(this.mMyRoom.showList),this.mMyRoom.roomList&&this.mMyRoom.roomList.forEach((function(e){t.mContainer.add(e)}))),this.mMyHistory&&this.mMyHistory.showList&&(this.mContainer.add(this.mMyHistory.showList),this.mMyHistory.roomList&&this.mMyHistory.roomList.forEach((function(e){t.mContainer.add(e)})))},MyRoomDelegate.prototype.init=function(){var t=this;this.activity=this.mScene.make.image({key:this.mKey,frame:"activity_title.png"},!1),this.activity.y=this.activity.height/2+2*this.mDpr,this.mChildPad=this.activity.height+14*this.mDpr,this.mMyRoom=new y(this.mScene,this.mKey,"my_room_icon.png",a.a.t("room_list.my_room"),this.mDpr,this.mWorld.uiScale,0,this.mChildPad,(function(e){t.mMyRoom.roomList&&t.setScrollInteractive(t.mMyRoom.roomList),t.mHeight+=e,t.refreshPos(),t.mChildPad+=t.mMyRoom.height,t.mMyHistory.addItem(t.mContent.historyRooms,t.mChildPad)})),this.mMyHistory=new f(this.mScene,this.mKey,"history_icon.png",a.a.t("room_list.my_history"),this.mDpr,this.mWorld.uiScale,0,this.mChildPad,(function(e){t.mMyHistory.roomList&&t.setScrollInteractive(t.mMyHistory.roomList),t.mHeight+=e,t.refreshPos(),t.mScroller.refreshBound(t.mHeight),t.mScroller.setValue(t.mContainer.parentContainer.y)})),this.mScroller.refreshBound(this.activity.height),this.mScroller.setValue(this.mContainer.parentContainer.y)},MyRoomDelegate.prototype.onEnterRoomHandler=function(t){this.emit("enterRoom",t)},MyRoomDelegate}(m),f=function(t){function RoomZoon(e,i,n,o,s,a,h,c,l){void 0===h&&(h=0),void 0===c&&(c=0);var p=t.call(this)||this;return p.mWidth=0,p.mHeight=0,p.mPad1=0,p.mShowList=[],p.mScene=e,p.mKey=i,p.mDpr=s,p.uiScale=a,p.mPad=c,p.mOrientaction=h,p.mIconFrame=n,p.mLabel=o,p.icon=e.make.image({key:i,frame:n},!1),p.icon.x=h?-254*s/2+c:-254*s/2,p.icon.y=h?0:c,p.text=e.make.text({text:o,style:{color:"#ffcc33",fontSize:16*s,fontFamily:r.a.DEFULT_FONT}},!1).setOrigin(0,.5),p.text.setStroke("#663300",2*s),p.text.x=h?p.icon.x+p.icon.width/2+4*s+c:p.icon.x+p.icon.width/2+4*s,p.text.y=h?0:c,p.mWidth=p.icon.width,p.mHeight=p.icon.height,p.mAddCallBack=l,p.mRooms=[],p}return p(RoomZoon,t),Object.defineProperty(RoomZoon.prototype,"showList",{get:function(){return this.mShowList},enumerable:!1,configurable:!0}),Object.defineProperty(RoomZoon.prototype,"roomList",{get:function(){return this.mRooms},enumerable:!1,configurable:!0}),RoomZoon.prototype.addItem=function(t,e){void 0===e&&(e=0),this.icon=this.mScene.make.image({key:this.mKey,frame:this.mIconFrame},!1),this.text=this.mScene.make.text({text:this.mLabel,style:{color:"#ffcc33",fontSize:16*this.mDpr,fontFamily:r.a.DEFULT_FONT}},!1).setOrigin(0,.5),this.text.setStroke("#663300",2*this.mDpr),this.icon.x=this.mOrientaction?-254*this.mDpr/2+e:-254*this.mDpr/2,this.icon.y=this.mOrientaction?0:e,this.text.x=this.mOrientaction?this.icon.x+this.icon.width/2+4*this.mDpr+e:this.icon.x+this.icon.width/2+4*this.mDpr,this.text.y=this.mOrientaction?0:e,this.mShowList.push(this.icon),this.mShowList.push(this.text),this.mHeight=this.icon.height,this.mPad=e||this.mPad,this.mPad1=e;var i=this.uiScale,n=this.mOrientaction?this.mPad+e:0,o=6*this.mDpr*i;if(t.length>0){var s=t.length;this.mPad+=this.icon.height+12*this.mDpr*i;for(var a=0;a<s;a++)if(a*(_.Hei+o)+this.mPad<=362*this.mDpr+_.Hei+o){var h=new _(this.mScene,this.mKey,this.mDpr);h.setInfo(t[0]),t.splice(0,1),h.on("enterRoom",this.onEnterRoomHandler,this),h.x=n;var c=a*(_.Hei+o)+this.mPad;this.mRooms.push(h),h.y=c,this.mHeight+=_.Hei+o}this.mRoomDatas=t}this.mHeight+=o,this.mAddCallBack&&this.mAddCallBack(this.mHeight)},RoomZoon.prototype.updateItem=function(){var t=this.mRoomDatas.slice(0,10),e=t.length;if(e<1)return 0;var i=this.uiScale,n=this.mOrientaction?this.mPad+this.mPad1:0,o=6*this.mDpr*i,r=this.mRooms.length;this.mRefreshRooms=[];for(var s=0,a=0;a<e;a++){var h=new _(this.mScene,this.mKey,this.mDpr);h.setInfo(t[a]),h.on("enterRoom",this.onEnterRoomHandler,this),h.x=n;var c=(a+r)*(_.Hei+o)+this.mPad;h.y=c,this.mRefreshRooms.push(h),this.mRooms.push(h),this.mHeight+=_.Hei+o,s+=_.Hei+o}return this.mRoomDatas.splice(0,10),s},Object.defineProperty(RoomZoon.prototype,"width",{get:function(){return this.mWidth},enumerable:!1,configurable:!0}),Object.defineProperty(RoomZoon.prototype,"height",{get:function(){return this.mHeight},enumerable:!1,configurable:!0}),RoomZoon.prototype.destroy=function(){this.clear(),t.prototype.destroy.call(this)},RoomZoon.prototype.clear=function(){for(var t=0,e=this.mRooms;t<e.length;t++){e[t].destroy()}for(var i=0,n=this.mShowList;i<n.length;i++){n[i].destroy()}this.icon.destroy(),this.text.destroy(),this.mShowList.length=0,this.mRooms.length=0},RoomZoon.prototype.onEnterRoomHandler=function(t){this.emit("enterRoom",t)},RoomZoon}(Phaser.Events.EventEmitter),y=function(t){function MyRoomZoon(){return null!==t&&t.apply(this,arguments)||this}return p(MyRoomZoon,t),MyRoomZoon.prototype.addItem=function(t,e){void 0===e&&(e=0),this.icon=this.mScene.make.image({key:this.mKey,frame:this.mIconFrame},!1),this.text=this.mScene.make.text({text:this.mLabel,style:{color:"#ffcc33",fontSize:16*this.mDpr,fontFamily:r.a.DEFULT_FONT}},!1).setOrigin(0,.5),this.text.setStroke("#663300",2*this.mDpr),this.icon.x=this.mOrientaction?-254*this.mDpr/2+e:-254*this.mDpr/2,this.icon.y=this.mOrientaction?0:e,this.text.x=this.mOrientaction?this.icon.x+this.icon.width/2+4*this.mDpr+e:this.icon.x+this.icon.width/2+4*this.mDpr,this.text.y=this.mOrientaction?0:e,this.mShowList.push(this.icon),this.mShowList.push(this.text),this.mHeight=this.icon.height,this.mPad=e||this.mPad;var i=this.uiScale,n=this.mOrientaction?this.mPad+e:0,o=6*this.mDpr*i;if(t.length>0){this.mPad+=this.icon.height+14*this.mDpr*i;for(var s=0;s<t.length;s++){var a=new P(this.mScene,this.mKey,this.mDpr);a.setInfo(t[s]),a.on("enterRoom",this.onEnterRoomHandler,this),a.x=n;var h=s*(_.Hei+o)+this.mPad;a.y=h,this.mRooms[s]=a,this.mHeight+=_.Hei+o}}this.mHeight+=o,this.mAddCallBack&&this.mAddCallBack(this.mHeight)},MyRoomZoon}(f),g=function(t){function PopularRoomZoon(){return null!==t&&t.apply(this,arguments)||this}return p(PopularRoomZoon,t),PopularRoomZoon.prototype.addItem=function(t,e){void 0===e&&(e=0),this.icon=this.mScene.make.image({key:this.mKey,frame:this.mIconFrame},!1),this.text=this.mScene.make.text({text:this.mLabel,style:{color:"#ffcc33",fontSize:16*this.mDpr,fontFamily:r.a.DEFULT_FONT}},!1).setOrigin(0,.5),this.text.setStroke("#663300",2*this.mDpr),this.icon.x=this.mOrientaction?-254*this.mDpr/2+e:-254*this.mDpr/2,this.icon.y=this.mOrientaction?0:e,this.text.x=this.mOrientaction?this.icon.x+this.icon.width/2+4*this.mDpr+e:this.icon.x+this.icon.width/2+4*this.mDpr,this.text.y=this.mOrientaction?0:e,this.mShowList.push(this.icon),this.mShowList.push(this.text),this.mHeight=this.icon.height,this.mPad=e||this.mPad;var i=this.uiScale,n=this.mOrientaction?this.mPad:0,o=6*this.mDpr*i;if(t.length>0){this.mPad+=this.icon.height+12*this.mDpr*i;for(var s=0;s<t.length;s++){var a=new v(this.mScene,this.mKey,this.mDpr);a.setInfo(t[s]),a.setRank(s+1),a.on("enterRoom",this.onEnterRoomHandler,this),a.x=n;var h=s*(a.height+o)+this.mPad;a.y=h,this.mHeight+=a.height+o,this.mRooms[s]=a}}return this.mHeight+=o,this.mAddCallBack&&this.mAddCallBack(this.mHeight),this.mHeight},PopularRoomZoon}(f),_=function(t){function RoomItem(e,i,n){void 0===n&&(n=1);var o=t.call(this,e)||this;return o.mKey=i,o.mDpr=n,o.init(i,n),o}return p(RoomItem,t),RoomItem.prototype.setInfo=function(t){t&&(t.name&&this.mNickName.setText(t.name),t.playerCount&&this.mCounter.setText(t.playerCount.toString())),this.mCounterIcon.x=this.mCounter.x-this.mCounter.width/2-this.mCounterIcon.width/2-4*this.mDpr,this.mRoom=t},RoomItem.prototype.roomData=function(){return this.mRoom},RoomItem.prototype.onEnterRoomHandler=function(t){this.mRoom&&this.emit("enterRoom",this.mRoom.roomId)},RoomItem.prototype.init=function(t,e){this.mBackground=this.scene.make.image({key:t,frame:"room_gray.png"},!1).setInteractive(),this.setSize(this.mBackground.width,this.mBackground.height),RoomItem.Hei=this.mBackground.height,this.mNickName=this.scene.make.text({style:{color:"#000000",fontFamily:r.a.DEFULT_FONT,fontSize:14*e}},!1),this.mNickName.x=-this.width/2+12*e,this.mNickName.y=-this.mNickName.height/2,this.mCounterIcon=this.scene.make.image({key:c.UIAtlasKey.commonKey,frame:"home_persons"},!1),this.mCounter=this.scene.make.text({style:{color:"#000000",fontFamily:r.a.DEFULT_FONT,fontSize:14*e}},!1).setOrigin(.5),this.mCounter.x=this.width/2-23*e,this.add([this.mBackground,this.mNickName,this.mCounterIcon,this.mCounter])},RoomItem.prototype.crateLabel=function(t){var e="",i="";t===h.op_def.EditModeRoomPrivacy.EDIT_MODE_ROOM_LOCKED?(e="passworld_label.png",i=a.a.t("room_list.password")):t===h.op_def.EditModeRoomPrivacy.EDIT_MODE_ROOM_PRIVATE&&(e="close_label.png",i=a.a.t("room_list.close")),""!==e&&""!==i&&(this.mLabelImg=this.scene.make.image({key:this.mKey,frame:e},!1),this.mLabelText=this.scene.make.text({text:i,style:{color:"#666666",fontFamily:r.a.DEFULT_FONT,fontSize:12*this.mDpr}},!1).setOrigin(0,.5),this.add([this.mLabelImg,this.mLabelText]),this.mLabelImg.x=this.width/2-85*this.mDpr,this.mLabelText.x=this.mLabelImg.x-7*this.mDpr)},RoomItem}(Phaser.GameObjects.Container),P=function(t){function MyRoomItem(e,i,n){return void 0===n&&(n=1),t.call(this,e,i,n)||this}return p(MyRoomItem,t),MyRoomItem.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.mBackground&&this.mBackground.setFrame("room_yellow.png"),this.mNickName&&(this.mNickName.setColor("#663300"),this.mCounter.setColor("#663300"))},MyRoomItem}(_),v=function(t){function PopularRoomItem(e,i,n){return void 0===n&&(n=1),t.call(this,e,i,n)||this}return p(PopularRoomItem,t),PopularRoomItem.prototype.setRank=function(t){this.mRankImage&&(this.mRankImage.setTexture(this.mKey,"rank_"+t+".png"),this.mRankImage.x=-this.width/2+this.mRankImage.width/2-2*this.mDpr,this.add(this.mRankImage))},PopularRoomItem.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.mRankImage=this.scene.make.image(void 0,!1),this.mNickName.x=-this.width/2+37*i},PopularRoomItem}(P)},function(t,e,i){"use strict";i.r(e),i.d(e,"RoomList",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function RoomList(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(RoomList,t),RoomList.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ROOM_LIST,this.onRoomListHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_GET_PLAYER_ENTER_ROOM_HISTORY,this.onMyRoomListHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ENTER_ROOM,this.onEnterRoomResultHandler))},RoomList.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},RoomList.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},RoomList.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},RoomList.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},RoomList.prototype.sendGetRoomList=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_ROOM_LIST),e=t.content;e.page=1,e.perPage=30,this.connection.send(t)},RoomList.prototype.sendMyHistory=function(){this.connection.send(new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_PLAYER_ENTER_ROOM_HISTORY))},RoomList.prototype.sendEnterRoom=function(t,e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER_ROOM),n=i.content;n.roomId=t,n.password=e,this.connection.send(i)},RoomList.prototype.onRoomListHandler=function(t){this.mEvent.emit("roomList",t.content)},RoomList.prototype.onMyRoomListHandler=function(t){this.mEvent.emit("myRoomList",t.content)},RoomList.prototype.onEnterRoomResultHandler=function(t){this.mEvent.emit("enterRoomResult",t)},Object.defineProperty(RoomList.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),RoomList}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopMediator",(function(){return l}));var n,o=i(119),r=i(110),s=i(2),a=i(319),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ShopMediator(e,i,n){var o=t.call(this)||this;return o._perPage=50,o.isEnd=!1,o.world=n,o.mScene=i,o.mLayerManager=e,o.mUIType=h.UIType.Normal,o}return c(ShopMediator,t),ShopMediator.prototype.isSceneUI=function(){return!1},ShopMediator.prototype.resize=function(){if(this.mView)return this.mView.resize()},ShopMediator.prototype.getView=function(){return this.mView},ShopMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||this.mShow||(this.mView=new a.ShopPanel(this.mScene,this.world),this.mView.show(e),this.world.emitter.on(o.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.emitter.on(o.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.requestVirtualWorldQueryPackage(e[0].id,1,a.ShopPanel.ShopSlotCount),this.mLayerManager.addToUILayer(this.mView),this.world.uiManager.checkUIState(ShopMediator.NAME,!1),t.prototype.show.call(this,e))},ShopMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},ShopMediator.prototype.hide=function(){this.mView&&(this.mShow=!1,this.world.emitter.off(o.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.emitter.off(o.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.mView.hide(),this.mView=null,this.world.uiManager.checkUIState(ShopMediator.NAME,!0),t.prototype.hide.call(this))},ShopMediator.prototype.destroy=function(){this.world.emitter.off(o.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.emitter.off(o.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.world=null,this.mScene=null,this._curPage=0,this.fetching=!1,this.isEnd=!1,t.prototype.destroy.call(this)},ShopMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ShopMediator.prototype.requestVirtualWorldQueryPackage=function(t,e,i){var n=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),o=n.content;o.id=t,o.page=e,o.perPage=i,this.world.connection.send(n)},ShopMediator.prototype.queryShopProps=function(t,e){if(void 0===t&&(t=1),void 0===e&&(e=50),!1!=!!this.mParam){this.fetching=!0;var i=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),n=i.content;n.id=this.mParam[0].id,n.page=t,n.perPage=e,this.world.connection.send(i)}},ShopMediator.prototype.queryPackageHandler=function(t){t.items.length>0&&t.id===this.mParam[0].id?this.mView.setDataList(t):this.isEnd=!0,this.fetching=!1},ShopMediator.prototype.onShowItemHandler=function(t){for(var e=0,i=t.price;e<i.length;e++){i[e].coinType,s.op_def.CoinType.TU_DING_COIN}var n=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),o=n.content;o.uiId=this.mParam[0].id,o.componentId=t.id,this.world.connection.send(n)},ShopMediator.prototype.syncUserBalance=function(){var t=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_USER_BALANCE);this.world.connection.send(t)},ShopMediator.prototype.onChangeIndex=function(t){t>=.9&&!1===this.fetching&&!1===this.isEnd&&(this._curPage++,this.queryShopProps(this._curPage))},ShopMediator.prototype.onSyncUserBalanceHandler=function(t){this.mView},ShopMediator.prototype.onPayTuDingHandler=function(){},ShopMediator.NAME="ShopMediator",ShopMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopPanel",(function(){return d}));var n,o=i(112),r=i(111),s=i(331),a=i(318),h=i(117),c=i(124),l=i(125),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function ShopPanel(e,i){var n=t.call(this,e,i)||this;return n.mWorld=i,n}return p(ShopPanel,t),ShopPanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.mWorld.game.device.os.desktop?(this.x=i.width+t>>1,this.y=i.height+e>>1):(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.x=i.width+t>>1,this.y=i.height+e>>1),this.scale=this.mWorld.uiScale},ShopPanel.prototype.setDataList=function(t){this.mShopData=t,this.mInitialized&&this.refreshDataList()},ShopPanel.prototype.destroy=function(){this.mShopItemSlotList&&(this.mShopItemSlotList.forEach((function(t){t&&t.destroy()})),this.mShopItemSlotList.length=0,this.mShopItemSlotList=null),this.mShopData=null,this.mInitialized=!1,t.prototype.destroy.call(this)},ShopPanel.prototype.addListen=function(){this.mInitialized&&this.mClsBtn.on("pointerup",this.shopMedClose,this)},ShopPanel.prototype.removeListen=function(){this.mInitialized&&this.mClsBtn.off("pointerup",this.shopMedClose,this)},ShopPanel.prototype.preload=function(){this.mScene&&(this.mScene.load.image(r.d.getName(),r.d.getPNG()),this.mScene.load.image(r.a.getName(),r.a.getPNG()),this.mScene.load.atlas("itemChose",r.i.getRes("ui/bag/itemChose.png"),r.i.getRes("ui/bag/itemChose.json")),this.mScene.load.atlas("clsBtn",r.i.getRes("ui/common/common_clsBtn.png"),r.i.getRes("ui/common/common_clsBtn.json")),this.mScene.load.atlas("shopView",r.i.getRes("ui/shop/shopView.png"),r.i.getRes("ui/shop/shopView.json")),t.prototype.preload.call(this))},ShopPanel.prototype.loadComplete=function(e,i,n){var o=this.mScene.textures.get("itemChose").frames,r=[];for(var s in o){if("__BASE"!==s)o[s]&&r.push(s)}this.mScene.anims.create({key:"itemSelectFrame",frames:this.mScene.anims.generateFrameNumbers("itemChose",{start:0,end:8,frames:r}),frameRate:33,yoyo:!0,repeat:-1}),t.prototype.loadComplete.call(this,e,i,n)},ShopPanel.prototype.init=function(){var e=this.mWorld.getSize();this.mBg=new h.NinePatch(this.scene,0,0,500,350,r.a.getName(),null,r.a.getConfig()),this.mBg.x=0,this.mBg.y=0,this.setSize(this.mBg.width,this.mBg.height),this.addAt(this.mBg,0),this.mBorder=new h.NinePatch(this.scene,0,0,this.mBg.width-10,this.mBg.height-30,r.d.getName(),null,r.d.getConfig()),this.mBorder.x=this.mBg.x,this.mBorder.y=this.mBg.y+10,this.addAt(this.mBorder,1),this.mWorld.game.device.os.desktop?(this.x=e.width>>1,this.y=e.height-300):(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.x=e.width>>1,this.y=e.height>>1);var i=this.mScene.make.sprite(void 0,!1);i.setTexture("shopView","shopView_titleIcon"),i.x=35+(-this.mBg.width>>1),i.y=-this.mBg.height>>1,this.add(i);var n,o,a,p=this.mScene.make.text(void 0,!1);p.setFontFamily("Tahoma"),p.setFontStyle("bold"),p.setFontSize(20),p.setText("内购商城"),p.x=i.x+i.width-10,p.y=i.y-(p.height>>1),this.add(p),this.mShopItemSlotList=[];for(var d=0;d<20;d++)o=d%5*88-this.mBg.width/2+75,a=82*Math.floor(d/5)-this.mBg.height/2+72,(n=new s.ShopItemSlot(this.mScene,this.mWorld,this,o,a,"shopView","ui/shop/shopView.png","ui/shop/shopView.json","shopView_bagSlot","itemSelectFrame")).createUI(),this.mShopItemSlotList.push(n);this.mClsBtn=new c.IconBtn(this.mScene,this.mWorld,{key:l.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/shop/shopView.png",jsonUrl:"ui/shop/shopView.json"}),this.mClsBtn.x=(this.width>>1)-65,this.mClsBtn.y=-this.height>>1,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn),this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mShopData&&this.refreshDataList(),t.prototype.init.call(this)},ShopPanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(a.ShopMediator.NAME).resize()},ShopPanel.prototype.refreshDataList=function(){if(this.mShopData)for(var t,e=ShopPanel.ShopSlotCount,i=0;i<e;i++)(t=this.mShopItemSlotList[i])&&t.shopDataChange(this.mShopData.items[i],this.mShopData.id)},ShopPanel.prototype.shopMedClose=function(){this.mWorld.uiManager.getMediator(a.ShopMediator.NAME).hide()},ShopPanel.ShopSlotCount=20,ShopPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Task",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Task(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Task,t),Task.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_QUERY_QUEST_LIST,this.onRetQuestList),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_QUERY_QUEST_DETAIL,this.onRetQuestDetail))},Task.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Task.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Task.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Task.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(Task.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Task.prototype.queryQuestList=function(){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_QUEST_LIST);this.connection.send(t)},Task.prototype.queryQuestDetail=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_QUERY_QUEST_DETAIL);e.content.id=t,this.connection.send(e)},Task.prototype.querySubmitQuest=function(t){var e=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_SUBMIT_QUEST);e.content.id=t,this.connection.send(e)},Task.prototype.onRetQuestList=function(t){var e=t.content;this.mEvent.emit("questlist",e.quests)},Task.prototype.onRetQuestDetail=function(t){var e=t.content;this.mEvent.emit("questdetail",e.quest)},Task}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"TaskPanel",(function(){return u}));var n,o=i(112),r=i(113),s=i(2),a=i(115),h=i(114),c=i(116),l=i(120),p=i(111),d=i(109),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function TaskPanel(e,i){var n=t.call(this,e,i)||this;return n.key="task_ui",n.taskItems=[],n}return m(TaskPanel,t),TaskPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,n,o),this.setSize(n,o),this.blackBg.clear(),this.blackBg.fillStyle(0,.5),this.blackBg.fillRoundedRect(-this.x,-this.y,n,o),this.content.x=.5*n,this.content.y=.5*o,this.mGameScroll.refreshMask(),this.blackBg.setInteractive(new Phaser.Geom.Rectangle(0,0,n,o),Phaser.Geom.Rectangle.Contains)},TaskPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},TaskPanel.prototype.addListen=function(){this.mInitialized&&this.closeBtn.on("pointerup",this.OnClosePanel,this)},TaskPanel.prototype.removeListen=function(){this.mInitialized&&this.closeBtn.off("pointerup",this.OnClosePanel,this)},TaskPanel.prototype.preload=function(){this.addAtlas(this.key,"task/task.png","task/task.json"),this.addAtlas(a.UIAtlasKey.commonKey,a.UIAtlasName.commonUrl+".png",a.UIAtlasName.commonUrl+".json"),t.prototype.preload.call(this)},TaskPanel.prototype.init=function(){this.setSize(this.scaleWidth,this.scaleWidth),this.blackBg=this.scene.make.graphics(void 0,!1),this.add(this.blackBg);var e=300*this.dpr,i=418*this.dpr;this.content=this.scene.make.container(void 0,!1),this.content.setSize(e,i),this.add(this.content),this.bg=new d.NineSlicePatch(this.scene,0,0,e,i,a.UIAtlasKey.commonKey,"bg",{left:40,top:40,bottom:50,right:50});var n=this.bg.width,o=this.bg.height,s=.5*-this.bg.height;this.titlebg=this.scene.make.image({x:0,y:s,key:this.key,frame:"title"}),this.titlebg.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.titlebg.y=s-.5*this.titlebg.height+20*this.dpr;var c="bold "+15*this.dpr+"px Source Han Sans";this.tilteName=this.scene.make.text({x:0,y:s-12*this.dpr,text:h.a.t("task.title"),style:{font:c,color:"#8F4300",fontSize:15*this.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(.5,0),this.closeBtn=this.scene.make.image({x:.5*this.bg.width-5*this.dpr,y:s+5*this.dpr,key:a.UIAtlasKey.commonKey,frame:"close"}),this.tilteName.setStroke("#8F4300",1),this.tilteName.setResolution(this.dpr),this.closeBtn.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.closeBtn.setInteractive();var l=this.scene.make.container(void 0,!1);l.setSize(80*this.dpr,30*this.dpr),l.setPosition(.5*-n+70*this.dpr,.5*-o+30*this.dpr),l.setInteractive(),l.on("pointerup",this.onOpenOptionHandler,this),this.optionText=this.scene.make.text({x:-30*this.dpr,y:0,text:h.a.t("task.all_task"),style:{color:"#8F4300",fontSize:16*this.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(0,.5),this.optionArrow=this.scene.make.image({x:0,y:0,key:this.key,frame:"drop_down"}),this.optionArrow.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),this.optionArrow.x=this.optionText.x+30*this.dpr,l.add([this.optionText,this.optionArrow]);var p=253*this.dpr,m=this.scene.make.graphics(void 0,!1);m.clear(),m.fillStyle(12632256,1),m.fillRect(.5*-p,-1,p,2),m.y=.5*-o+50*this.dpr,this.optionCon=this.scene.make.container(void 0,!1),this.optionCon.visible=!1,this.optionCon.y=.5*-o+50*this.dpr,this.mGameScroll=new d.GameScroller(this.scene,{x:0,y:18*this.dpr,width:n,height:o-70*this.dpr,zoom:this.scale,dpr:this.dpr,align:2,orientation:0,space:20*this.dpr}),this.content.add([this.bg,this.closeBtn,this.titlebg,this.tilteName,this.mGameScroll,l,m,this.optionCon]),this.resize(),t.prototype.init.call(this),this.emit("questlist")},TaskPanel.prototype.setTaskDatas=function(t){this.mInitialized&&(this.curTaskItem&&this.curTaskItem.setExtend(!1),this.taskDatas=t,this.setTaskOptions(),this.setTaskItems(t),this.onTaskOptionHandler(this.curOptionItem))},TaskPanel.prototype.setTaskOptions=function(){var t=[0],e=s.op_pkt_def.PKT_Quest_Type;for(var i in e){var n=Number(i);if(!isNaN(n)){var o=n;t.push(o)}}for(var r=this.optionCon.list,a=0,h=r;a<h.length;a++){(p=h[a]).visible=!1}for(var c=0;c<t.length;c++){var p=void 0;c<r.length?p=r[c]:((p=new _(this.scene,this.key,this.dpr)).setHandler(new l.a(this,this.onTaskOptionHandler)),this.optionCon.add(p)),p.visible=!0,p.setOptionData(t[c])}for(var d=0,m=0,u=r;m<u.length;m++){var f=u[m];f.y=f.height*f.originY+d,d+=f.height+2}this.curOptionItem||(this.curOptionItem=r[0])},TaskPanel.prototype.setTaskDetail=function(t){this.curTaskItem&&t&&this.curTaskItem.questData.id===t.id&&this.curTaskItem.setTaskDetail(t)},TaskPanel.prototype.setTaskItems=function(t){for(var e=0,i=this.taskItems;e<i.length;e++){(o=i[e]).visible=!1}for(var n=0;n<t.length;n++){var o=void 0;n<this.taskItems.length?o=this.taskItems[n]:(o=new f(this.scene,this.key,this.dpr),this.mGameScroll.addItem(o),o.setHandler(new l.a(this,this.onExtendsHandler),new l.a(this,this.onFinishHandler)),this.taskItems.push(o)),o.setTaskData(t[n]),o.visible=!0}this.mGameScroll.Sort()},TaskPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},TaskPanel.prototype.OnClosePanel=function(){this.emit("hide")},TaskPanel.prototype.onFinishHandler=function(t){this.emit("submitquest",t)},TaskPanel.prototype.onExtendsHandler=function(t,e){this.curTaskItem&&this.curTaskItem.setExtend(!1,!1),this.curTaskItem=e,t?this.emit("questdetail",e.questData.id):this.curTaskItem=null,this.mGameScroll.Sort(!0)},TaskPanel.prototype.onOpenOptionHandler=function(){var t=this.optionCon.visible;this.optionCon.visible=!t,this.optionArrow.scaleY=t?-1:1},TaskPanel.prototype.onTaskOptionHandler=function(t){for(var e=0,i=this.optionCon.list;e<i.length;e++){i[e].changeNormal()}var n;n=0===t.optionData?this.taskDatas:this.taskDatas.filter((function(e){return e.questType===t.optionData})),this.setTaskItems(n),this.optionCon.visible=!1,this.curOptionItem=t,t.changeDown(),this.optionText.text=t.optionText,this.optionArrow.x=this.optionText.x+this.optionText.width+10*this.dpr},TaskPanel}(o.BasePanel),f=function(t){function TaskItem(e,i,n){var o=t.call(this,e)||this;o.key=i,o.dpr=n;var s=254*n,a=45*n;o.content=e.make.container(void 0,!1),o.content.setSize(s,a),o.bg=new d.NineSlicePatch(o.scene,0,0,s,a,i,"main_bg",{left:6*n,top:6*n,bottom:6*n,right:6*n});var l=.5*-s,p=.5*-a,m=e.make.image({key:i,frame:"head_border"});return m.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),m.x=l+25*n,o.headIcon=new c.DynamicImage(e,m.x,0),o.headIcon.setTexture(i,"head_test"),o.typeBg=e.make.image({key:i,frame:"tag_main"}),o.typeBg.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),o.typeBg.setPosition(l+.5*o.typeBg.width,p+.5*o.typeBg.height-2*n),o.typeTex=e.make.text({x:0,y:0,text:h.a.t("task.m"),style:{color:"#ffffff",fontSize:10*o.dpr,fontFamily:r.a.DEFULT_FONT}}),o.typeTex.setOrigin(.5).setPosition(o.typeBg.x-1*n,o.typeBg.y),o.taskName=e.make.text({x:o.headIcon.x+20*n,y:-9*n,text:"",style:{color:"#ffffff",fontSize:13*o.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(0,.5),o.taskDes=e.make.text({x:o.headIcon.x+25*n,y:10*n,text:"",style:{color:"#ffffff",fontSize:12*o.dpr,fontFamily:r.a.DEFULT_FONT}}).setOrigin(0,.5),o.finish=e.make.image({key:i,frame:"done"}),o.finish.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),o.finish.setPosition(.5*s-30*n,4*n),o.openBtn=new d.Button(e,i,"open","open"),o.setExtendBtn(o.openBtn),o.openBtn.setPosition(.5*s-25*n,4*n),o.closeBtn=new d.Button(e,i,"close"),o.setExtendBtn(o.closeBtn),o.closeBtn.setPosition(o.openBtn.x,o.openBtn.y).visible=!1,o.openBtn.on(d.ClickEvent.Tap,o.onOpenHandler,o),o.closeBtn.on(d.ClickEvent.Tap,o.onCloseHandler,o),o.content.add([o.bg,m,o.headIcon,o.typeBg,o.typeTex,o.taskName,o.taskDes,o.finish,o.openBtn,o.closeBtn]),o.add(o.content),o.setSize(s,a),o}return m(TaskItem,t),TaskItem.prototype.setTaskData=function(t){this.questData=t;var e=this.getQuestTypeTag(t.questType);this.typeBg.setFrame(e[0]),this.typeTex.text=e[1],this.setTextLimit(this.taskName,e[2]+t.name,12),this.bg.setFrame(e[3]),this.setTextLimit(this.taskDes,t.detail),this.taskDes.setColor(e[4]),this.finish.visible=t.stage===s.op_pkt_def.PKT_Quest_Stage.PKT_QUEST_STAGE_FINISHED},TaskItem.prototype.setTaskDetail=function(t){var e=this.getQuestTypeTag(t.questType);this.extend&&this.extend.setItemData(t,e[5])},TaskItem.prototype.setHandler=function(t,e){this.extendHandler=t,this.finishHandler=e},TaskItem.prototype.setExtend=function(t,e){void 0===e&&(e=!0),t?e?this.onOpenHandler():this.openExtend():e?this.onCloseHandler():this.closeExtend()},TaskItem.prototype.onOpenHandler=function(){this.openExtend(),this.extendHandler&&this.extendHandler.runWith([!0,this])},TaskItem.prototype.openExtend=function(){this.extend||(this.extend=new y(this.scene,this.key,this.dpr),this.extend.setFinishHandler(new l.a(this,this.onFinishHandler)),this.add(this.extend),this.extend.y=.5*this.height+.5*this.extend.height),this.extend.visible=!0,this.height=this.content.height+this.extend.height,this.content.y=.5*-this.height+.5*this.content.height,this.extend.y=.5*-this.height+this.content.height+.5*this.extend.height,this.openBtn.visible=!1,this.closeBtn.visible=!0},TaskItem.prototype.setExtendBtn=function(t){var e=60*this.dpr,i=60*this.dpr,n=this.scene.make.graphics(void 0,!1);n.clear(),n.fillStyle(16185078,0),n.fillRect(.5*-e,.5*-i,e,i),t.addAt(n,0),t.setInteractive(new Phaser.Geom.Rectangle(0,0,e,i),Phaser.Geom.Rectangle.Contains)},TaskItem.prototype.onFinishHandler=function(){this.finishHandler&&this.finishHandler.runWith(this.questData.id)},TaskItem.prototype.onCloseHandler=function(){this.closeExtend(),this.extendHandler&&this.extendHandler.runWith([!1,this])},TaskItem.prototype.closeExtend=function(){this.extend&&(this.extend.visible=!1),this.height=this.content.height,this.content.y=0,this.openBtn.visible=!0,this.closeBtn.visible=!1},TaskItem.prototype.getQuestTypeTag=function(t){var e=[];return t===s.op_pkt_def.PKT_Quest_Type.QUEST_MAIN_MISSION?(e[0]="tag_main",e[1]=h.a.t("task.m"),e[2]=""+h.a.t("task.main"),e[3]="main_bg",e[4]="#4C42C8",e[5]="#8780E0",e):t===s.op_pkt_def.PKT_Quest_Type.QUEST_SIDE_MISSION?(e[0]="tag_side",e[1]=h.a.t("task.s"),e[2]=h.a.t("task.side"),e[3]="side_bg",e[4]="#CB0A1D",e[5]="#F4919B",e):t===s.op_pkt_def.PKT_Quest_Type.QUEST_DAILY_GOAL?(e[0]="tag_daly",e[1]=h.a.t("task.d"),e[2]=h.a.t("task.daily"),e[3]="daly_bg",e[4]="#866107",e[5]="#F1D56C",e):void 0},TaskItem.prototype.setTextLimit=function(t,e,i){if(void 0===i&&(i=15),e.length>i)for(var n=155*this.dpr,o=4;o<e.length;o++){var r=e.slice(0,o);if(t.setText(r).width>n){r+="...",t.setText(r);break}}else t.setText(e)},TaskItem}(Phaser.GameObjects.Container),y=function(t){function TaskItemExtend(e,i,n){var o=t.call(this,e)||this;o.needArr=[],o.rewardArr=[],o.dpr=0;var s=253*n,c=202*n;o.dpr=n;var l=new d.NineSlicePatch(o.scene,0,0,s,c,i,"detail_bg",{left:4,top:4,right:4,bottom:4}),p=.5*-s+10*n,m=.5*-c+5*n;o.taskLabel=e.make.text({x:p,y:m,text:h.a.t("task.objective"),style:{color:"#8F4300",fontSize:12*o.dpr,fontFamily:r.a.DEFULT_FONT}}),o.taskTex=e.make.text({x:p,y:m+18*n,text:h.a.t("task.collect_materials"),style:{color:"#8F4300",fontSize:12*o.dpr,fontFamily:r.a.DEFULT_FONT}}),o.taskTex.setWordWrapWidth(s-10*n,!0),o.rewardLabel=e.make.text({x:p,y:m+90*n,text:h.a.t("task.rewards"),style:{color:"#8F4300",fontSize:12*o.dpr,fontFamily:r.a.DEFULT_FONT}});var u=e.make.image({key:i,frame:"reward_cutline"});return u.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),u.setPosition(0,m+110*n),o.line=u,o.finishBtn=new d.NineSliceButton(o.scene,Math.ceil(.5*s-40*o.dpr),Math.ceil(.5*c-25*o.dpr),60*o.dpr,30*o.dpr,a.UIAtlasKey.commonKey,"button_g",h.a.t("task.submit_task"),o.dpr,o.scale,{left:12*o.dpr,top:12*o.dpr,right:12*o.dpr,bottom:12*o.dpr}),o.finishBtn.setTextStyle({fontSize:12*n,color:"#000000"}),o.finishBtn.on(d.ClickEvent.Tap,o.onFinishHandler,o),o.add([l,o.taskLabel,o.taskTex,o.rewardLabel,u,o.finishBtn]),o.setSize(s,c),o.key=i,o.finishBtn.visible=!1,o}return m(TaskItemExtend,t),TaskItemExtend.prototype.setItemData=function(t,e){this.taskLabel.setColor(e),this.taskTex.setColor(e),this.rewardLabel.setColor(e);var i=0,n=33*this.dpr;this.taskTex.text=this.getTaskTargetText(t),this.createTaskCells(this.needArr,t.targets,!0),i=this.taskTex.y+this.taskTex.height+5*this.dpr,t.targets.length>0&&(i+=.5*n,this.sortItem(this.needArr,i),i+=.5*n+8*this.dpr),this.rewardLabel.y=i,i+=this.rewardLabel.height+5*this.dpr,this.line.y=i,i+=5*this.dpr,this.createTaskCells(this.rewardArr,t.rewards,!1),i+=.5*n,this.sortItem(this.rewardArr,i),this.finishBtn.visible=t.stage===s.op_pkt_def.PKT_Quest_Stage.PKT_QUEST_STAGE_FINISHED},TaskItemExtend.prototype.setFinishHandler=function(t){this.finishHandler=t},TaskItemExtend.prototype.sortItem=function(t,e){void 0===e&&(e=0);for(var i=.5*-this.width+10*this.dpr,n=t,o=0,r=10*this.dpr,s=0,a=n;s<a.length;s++){var h=a[s];h.x=i+h.width*h.originX+o,h.y=e,o+=h.width+r}},TaskItemExtend.prototype.createTaskCells=function(t,e,i){void 0===i&&(i=!0);for(var n=0,o=t;n<o.length;n++){(s=o[n]).visible=!1}for(var r=0;r<e.length;r++){var s=void 0;r<t.length?s=t[r]:(s=new g(this.scene,this.key,this.dpr),t.push(s),this.add(s)),s.visible=!0,s.setCellData(e[r],i)}return t},TaskItemExtend.prototype.onFinishHandler=function(){this.finishHandler&&this.finishHandler.run()},TaskItemExtend.prototype.getTaskTargetText=function(t){t.targets;return t.detail},TaskItemExtend}(Phaser.GameObjects.Container),g=function(t){function TaskCell(e,i,n){var o=t.call(this,e)||this;return o.key=i,o.dpr=n,o.bg=e.make.image({key:i,frame:"task_bg"}),o.bg.texture.setFilter(Phaser.Textures.FilterMode.LINEAR),o.setSize(o.bg.width,o.bg.height),o.itemIcon=new c.DynamicImage(e,0,0),o.countTex=new d.BBCodeText(o.scene,0,0).setOrigin(.5).setFontSize(12*n).setFontFamily(r.a.DEFULT_FONT),o.countTex.setPosition(.5*o.width,.5*o.height-2*n),o.add([o.bg,o.itemIcon,o.countTex]),o}return m(TaskCell,t),TaskCell.prototype.setCellData=function(t,e){var i=this;void 0===e&&(e=!0);var n=e?"task_bg":"reward_bg";this.bg.setTexture(this.key,n);var o=p.i.getOsdRes(t.display.texturePath);this.itemIcon.load(o,this,(function(){i.itemIcon.scale=.6*i.dpr})),this.countTex.text=e?this.getCountText(t.count,t.neededCount):"[stroke=#666666][color=#666666]"+t.count+"[/color][/stroke]/"},TaskCell.prototype.getCountText=function(t,e){var i=t>=e?"#0054FF":"#FF2B2B";return"[stroke="+i+"][color="+i+"]"+t+"[/color][/stroke]"+"/"+("[stroke=#2D2D2D][color=#2D2D2D]"+e+"[/color][/stroke]")},TaskCell}(Phaser.GameObjects.Container),_=function(t){function TaskOption(e,i,n){var o=t.call(this,e)||this;o.dpr=0;var s=256*n,a=30*n;o.dpr=n,o.bg=e.make.graphics(void 0,!1),o.text=e.make.text({x:0,y:0,text:"全部",style:{color:"#666666",fontSize:15*n,fontFamily:r.a.DEFULT_FONT}}).setOrigin(0,.5),o.bg.clear(),o.bg.fillStyle(16185078,1),o.bg.fillRect(.5*-s,.5*-a,s,a);var h=o.scene.make.graphics(void 0,!1);return h.clear(),h.fillStyle(13421772,1),h.fillRect(.5*-s,.5*a,s,2),o.add([o.bg,o.text,h]),o.setSize(s,a),o.bg.setInteractive(new Phaser.Geom.Rectangle(.5*-s,.5*-a,s,a),Phaser.Geom.Rectangle.Contains),o.bg.on("pointerup",o.onClickHandler,o),o}return m(TaskOption,t),TaskOption.prototype.setSize=function(e,i){return t.prototype.setSize.call(this,e,i),this.text.setPosition(.5*-e+20*this.dpr,0),this.changeNormal(),this},TaskOption.prototype.setOptionData=function(t){this.optionData=t,t===s.op_pkt_def.PKT_Quest_Type.QUEST_MAIN_MISSION?this.text.text=h.a.t("task.main_quest"):t===s.op_pkt_def.PKT_Quest_Type.QUEST_SIDE_MISSION?this.text.text=h.a.t("task.side_quest"):t===s.op_pkt_def.PKT_Quest_Type.QUEST_DAILY_GOAL?this.text.text=h.a.t("task.daily_quest"):this.text.text=h.a.t("task.all_task"),this.optionText=this.text.text},TaskOption.prototype.changeDown=function(){this.bg.clear(),this.bg.fillStyle(14673663,1),this.bg.fillRect(.5*-this.width,.5*-this.height,this.width,this.height)},TaskOption.prototype.changeNormal=function(){this.bg.clear(),this.bg.fillStyle(16185078,1),this.bg.fillRect(.5*-this.width,.5*-this.height,this.width,this.height)},TaskOption.prototype.setHandler=function(t){this.clickHandler=t},TaskOption.prototype.onClickHandler=function(){this.clickHandler&&this.clickHandler.runWith(this)},TaskOption}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserInfoMediator",(function(){return h}));var n,o=i(323),r=i(119),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function UserInfoMediator(e,i,n){var o=t.call(this)||this;return o.mLayerManager=e,o.mScene=i,o.world=n,o}return a(UserInfoMediator,t),UserInfoMediator.prototype.getView=function(){return this.mView},UserInfoMediator.prototype.hide=function(){this.mShow=!1,this.world.emitter.off(r.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView&&(this.mView.hide(),this.mView=null)},UserInfoMediator.prototype.isSceneUI=function(){return!1},UserInfoMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},UserInfoMediator.prototype.resize=function(){this.mView&&this.mView.resize()},UserInfoMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||e&&0!==e.length&&(this.mView=new o.UserInfoPanel(this.mScene,this.world),this.mView.show(e[0]),this.mLayerManager.addToUILayer(this.mView),this.world.emitter.on(r.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),t.prototype.show.call(this,e))},UserInfoMediator.prototype.destroy=function(){this.mView&&this.mView.destroy()},UserInfoMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},UserInfoMediator.prototype.onClosePanel=function(){this.hide()},UserInfoMediator.NAME="UserInfoMediator",UserInfoMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserInfoPanel",(function(){return d}));var n,o=i(112),r=i(116),s=i(111),a=i(113),h=i(121),c=i(322),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function UserInfoPanel(e,i){var n=t.call(this,e,i)||this;return n.mBadgeImages=[],n.mWorld=i,n}return p(UserInfoPanel,t),UserInfoPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.setData("data",e),this.setInfo(e)},UserInfoPanel.prototype.hide=function(){this.clearBadge(),t.prototype.hide.call(this)},UserInfoPanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.x=i.width-this.width-8,this.y=i.height-100-this.height},UserInfoPanel.prototype.setInfo=function(t){var e=this;if(this.mInitialized&&t&&0!==t.actors.length){var i=t.actors[0];this.mWorld.httpService.userDetail(i.platformId).then((function(t){if(200===t.code){var i=t.data;i&&(e.mActor.load(s.i.getOsdRes("show/"+i.username+".png"),e,void 0,e.loadDefaultAvatar),e.mNickName.setText(i.nickname),e.mLv.setText(i.level))}})),this.mWorld.httpService.badgecards(i.platformId).then((function(t){200===t.code&&e.createBadge(t.data)})),this.updateFollwer(i.platformId)}},UserInfoPanel.prototype.destroy=function(){this.mActor&&(this.mActor.destroy(!0),this.mActor=null),this.mBadgeImages&&(this.mBadgeImages.forEach((function(t){t.destroy(!0),t=null})),this.mBadgeImages=[]),this.mNickName&&(this.mNickName.destroy(!0),this.mNickName=null),this.mLv&&(this.mLv.destroy(!0),this.mLv=null),this.mFollwerBtn&&(this.mFollwerBtn.destroy(!0),this.mFollwerBtn=null),this.mWorld=null,t.prototype.destroy.call(this)},UserInfoPanel.prototype.preload=function(){this.scene.load.image(s.d.getName(),s.d.getPNG()),this.scene.load.image(s.a.getName(),s.a.getPNG()),this.scene.load.atlas(s.c.getName(),s.c.getPNG(),s.c.getJSON()),t.prototype.preload.call(this)},UserInfoPanel.prototype.init=function(){this.setSize(359,199);var e=new l.NinePatch(this.scene,{width:359,height:199,key:s.a.getName(),columns:s.a.getColumns(),rows:s.a.getRows()}).setOrigin(0,0);this.add(e);var i=new l.NinePatch(this.scene,{x:7,y:19,width:345,height:173,key:s.d.getName(),columns:s.d.getColumns(),rows:s.d.getRows()}).setOrigin(0,0);this.add(i);var n=this.scene.make.text({x:20,y:-5,text:"昵称：",stroke:"#000000",strokeThickness:2,style:{color:"#b4b4b4",font:a.a.YAHEI_18_BOLD}},!1);this.add(n);var o=this.scene.make.text({x:20,y:30,text:"等级：",stroke:"#000000",strokeThickness:2,color:"#b4b4b4",style:{color:"#b4b4b4",font:a.a.YAHEI_18_BOLD}},!1);this.add(o),this.mNickName=this.scene.make.text({x:n.x+50,y:n.y,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",style:{font:a.a.YAHEI_18_BOLD}},!1),this.add(this.mNickName),this.mLv=this.scene.make.text({x:o.x+50,y:o.y,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",style:{font:a.a.YAHEI_18_BOLD}}),this.add(this.mLv),this.mFollwerBtn=new h.NinePatchButton(this.scene,258,145,80,34,s.c.getName(),s.c.getName(),"关注",s.c.getConfig()),this.mFollwerBtn.x=258+(this.mFollwerBtn.width>>1),this.mFollwerBtn.y=145+(this.mFollwerBtn.height>>1),this.mFollwerBtn.setTextStyle({font:a.a.YAHEI_16_BOLD}),this.add(this.mFollwerBtn),this.mActor=new r.DynamicImage(this.scene,300,125).setOrigin(.5,1),this.mActor.scale=2,this.add(this.mActor),this.mWorld.uiManager.getMediator(c.UserInfoMediator.NAME).resize(),t.prototype.init.call(this),this.setInfo(this.getData("data"))},UserInfoPanel.prototype.updateFollwer=function(t){var e=this,i=this.mWorld.roomManager.currentRoom.playerManager.actor.model;i&&t!==i.platformId&&this.mWorld.httpService.checkFollowed([t]).then((function(i){200===i.code&&(i.data.length>0?e.mFollwerBtn.setText("取消关注"):e.mFollwerBtn.setText("关注"),e.mFollwerBtn.setData("node",{text:e.mFollwerBtn.getText(),platformId:t}))}))},UserInfoPanel.prototype.createBadge=function(t){if(t)for(var e=0;e<t.length;e++){var i=new r.DynamicImage(this.scene,70*e+60,100);i.load(s.i.getOsdRes(t[e].target_entity.thumbnail)),this.add(i),this.mBadgeImages.push(i)}},UserInfoPanel.prototype.loadDefaultAvatar=function(){this.mActor.load(s.i.getOsdRes("show/avatar_default.png"))},UserInfoPanel.prototype.clearBadge=function(){for(var t=0,e=this.mBadgeImages;t<e.length;t++){var i=e[t];i.destroy(),this.remove(i)}this.mBadgeImages.length=0},UserInfoPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"MenuItem",(function(){return h}));var n,o=i(121),r=i(117),s=i(111),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function MenuItem(e,i,n,o,r,s,a,h){return t.call(this,e,i,n,o,r,s,"",a,h)||this}return a(MenuItem,t),MenuItem.prototype.appendItem=function(t){this.mChild||(this.mMenus=[],this.mChild=this.scene.make.container(void 0,!1),this.mArrow=this.scene.make.image({x:this.width*this.originX-3,key:"usermenu_arrow"}),this.add(this.mArrow),this.mBackground=new r.NinePatch(this.scene,0,0,0,0,s.d.getName(),null,s.d.getConfig())),this.mChild.add(t),this.mMenus.push(t),this.mBackground.resize(74,32*this.mMenus.length),this.mBackground.x=this.mBackground.width,this.mBackground.y=this.mBackground.height/2-16,this.mChild.addAt(this.mBackground,0),this.mChild.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBackground.width,this.mBackground.height),Phaser.Geom.Rectangle.Contains)},MenuItem.prototype.show=function(){this.add(this.mChild)},MenuItem.prototype.destroy=function(e){if(this.mMenus){for(var i=this.mMenus.length,n=0;n<i;n++){var o=this.mMenus[n];o&&(o.destroy(!0),o=null)}this.mMenus=[]}this.mBackground&&(this.mBackground.destroy(),this.mBackground=null),this.mChild&&(this.mChild.destroy(!0),this.mChild=null),this.mArrow&&(this.mArrow.destroy(!0),this.mArrow=null),t.prototype.destroy.call(this,e)},Object.defineProperty(MenuItem.prototype,"menus",{get:function(){return this.mMenus||[]},enumerable:!1,configurable:!0}),MenuItem}(o.NinePatchButton)},function(t,e,i){"use strict";i.r(e),i.d(e,"StorageMediator",(function(){return a}));var n,o=i(326),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function StorageMediator(e,i,n){var o=t.call(this)||this;return o.mLayerManager=e,o.world=i,o.mScene=n,o.mUIType=r.UIType.Normal,o}return s(StorageMediator,t),StorageMediator.prototype.isShow=function(){return this.mView.isShow()},StorageMediator.prototype.resize=function(){this.mView&&this.mView.resize()},StorageMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView||(this.mView=new o.StoragePanel(this.mScene,this.world)),this.mView.show(e),this.world.uiManager.checkUIState(StorageMediator.NAME,!1),t.prototype.show.call(this,e))},StorageMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},StorageMediator.prototype.hide=function(){this.mView&&(this.mView.hide(),this.world.uiManager.checkUIState(StorageMediator.NAME,!0))},StorageMediator.prototype.destroy=function(){this.mView&&(this.mView.destroy(),this.mView=null)},StorageMediator.NAME="StorageMediator",StorageMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"StoragePanel",(function(){return d}));var n,o=i(133),r=i(111),s=i(124),a=i(117),h=i(325),c=i(125),l=i(112),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function StoragePanel(e,i){return t.call(this,e,i)||this}return p(StoragePanel,t),StoragePanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.x=i.width+t>>1,this.y=i.height+e-200},StoragePanel.prototype.destroy=function(){if(this.mBagItemSlotList){for(var e=this.mBagItemSlotList.length,i=0;i<e;i++){var n=this.mBagItemSlotList[i];n&&(n.destroy(),n=null)}this.mBagItemSlotList=null}this.mWorld=null,t.prototype.destroy.call(this)},StoragePanel.prototype.addListen=function(){this.mClsBtn.on("pointerup",this.hide,this)},StoragePanel.prototype.removeListen=function(){this.mClsBtn.off("pointerup",this.hide,this)},StoragePanel.prototype.init=function(){if(!this.mInitialized){t.prototype.init.call(this),this.mBg=new a.NinePatch(this.scene,0,0,500,350,r.a.getName(),null,r.a.getConfig()),this.addAt(this.mBg,0),this.setSize(this.mBg.width,this.mBg.height),this.mBorder=new a.NinePatch(this.scene,0,0,this.mBg.width-10,this.mBg.height-30,r.d.getName(),null,r.d.getConfig()),this.mBorder.x=this.mBg.x,this.mBorder.y=this.mBg.y+10,this.addAt(this.mBorder,1),this.setSize(this.mBg.width,this.mBg.height);var e=this.scene.make.image(void 0,!1);e.setTexture(this.mResStr,"itemBagView_title.png"),e.x=80+(-this.mBg.width>>1),e.y=-this.mBg.height>>1,this.add(e);var i,n=this.scene.make.text(void 0,!1);n.setFontFamily("Tahoma"),n.setFontStyle("bold"),n.setFontSize(20),n.setText("书柜"),n.x=e.x+e.width-10,n.y=e.y-(n.height>>1),this.add(n);var h=0,l=0;this.mBagItemSlotList=[];for(var p=0;p<9;p++)h=p%9*60+32-362,l=60*Math.floor(p/9)-55,(i=new o.ItemSlot(this.scene,this.mWorld,this,h,l,this.mResStr,this.mResPng,this.mResJson,"bagView_slot.png","bagView_itemSelect.png")).createUI(),this.mBagItemSlotList.push(i);this.mClsBtn=new s.IconBtn(this.scene,this.mWorld,{key:c.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/common/common_clsBtn.png",jsonUrl:"ui/common/common_clsBtn.json"}),this.mClsBtn.x=(this.width>>1)-65,this.mClsBtn.y=-this.height>>1,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn)}},StoragePanel.prototype.preload=function(){this.scene&&(this.mResStr="bagView",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.scene.load.image(r.d.getName(),r.d.getPNG()),this.scene.load.image(r.a.getName(),r.a.getPNG()),this.scene.load.atlas("clsBtn",r.i.getRes("ui/common/common_clsBtn.png"),r.i.getRes("ui/common/common_clsBtn.json")),this.scene.load.atlas(this.mResStr,r.i.getRes(this.mResPng),r.i.getRes(this.mResJson)),t.prototype.preload.call(this))},StoragePanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(h.StorageMediator.NAME).resize()},StoragePanel}(l.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"TopBtnGroup",(function(){return l}));var n,o=i(112),r=i(111),s=i(124),a=i(167),h=i(125),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function TopBtnGroup(e,i){var n=t.call(this,e,i)||this;return n.mBtnPad=10,n.mBtnX=0,n.mExpandBoo=!1,n.mOrientation=Phaser.Scale.Orientation.LANDSCAPE,n.disInteractive(),n}return c(TopBtnGroup,t),TopBtnGroup.prototype.show=function(e){this.scale=this.mWorld.uiScale,t.prototype.show.call(this,e)},TopBtnGroup.prototype.resize=function(){var t=this.mWorld.getSize();this.x=t.width-50*this.mWorld.uiScale,this.y=this.height/2+10*this.mWorld.uiScale,this.scale=this.mWorld.uiScale},TopBtnGroup.prototype.destroy=function(){this.mBtnX=0,this.mTurnBtn&&this.mTurnBtn.destroy(),this.mReturnBtn&&this.mReturnBtn.destroy(),this.mDebugBtn&&this.mDebugBtn.destroy(),this.mBtnList&&this.mBtnList.forEach((function(t){t&&(t.destroy(),t=null)})),this.mResKey="",this.mBtnList=null,this.mTurnBtn=null,this.mReturnBtn=null,t.prototype.destroy.call(this)},TopBtnGroup.prototype.tweenView=function(t){if(this.scene){var e=this.height/2+10*this.mWorld.uiScale,i=!0===t?e:e-50,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Cubic.Out",props:{y:{value:i},alpha:{value:n}}})}},TopBtnGroup.prototype.addBtn=function(t){if(this.mAddBtnDataList||(this.mAddBtnDataList=[]),this.mInitialized){var e=new s.IconBtn(this.scene,this.mWorld,t);this.mBtnList.push(e),this.btnRefreshPos()}else this.mAddBtnDataList.push(t)},TopBtnGroup.prototype.removeBtn=function(t){if(this.mRemoveBtnKeyList&&(this.mRemoveBtnKeyList=[]),this.mInitialized){for(var e=0,i=this.mBtnList.length;e<i;e++){var n=this.mBtnList[e];if(n){var o=n.getKey();if(o&&o===t){n.destroy(),n=null,this.mBtnList.splice(e,1);break}}}this.btnRefreshPos()}else this.mRemoveBtnKeyList.push(t)},TopBtnGroup.prototype.preload=function(){this.scene&&(this.mResKey="baseView",this.scene.load.atlas(this.mResKey,r.i.getRes("ui/baseView/mainui_mobile.png"),r.i.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this))},TopBtnGroup.prototype.init=function(){var e=this,i=0,n=0;this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mBtnList=[],this.mBtnX=0,this.mTurnBtn=new s.IconBtn(this.scene,this.mWorld,{key:h.UIMediatorType.Turn_Btn_Top,bgResKey:this.mResKey,bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mTurnBtn.x=this.mBtnX,this.mTurnBtn.setPos(this.mBtnX,0),n+=this.mTurnBtn.width+this.mBtnPad,this.add(this.mTurnBtn),this.mBtnX+=-this.mTurnBtn.width-this.mBtnPad,i+=this.mTurnBtn.height/2+20,this.mWorld.game.device.os.desktop||(this.mReturnBtn=new s.IconBtn(this.scene,this.mWorld,{key:h.UIMediatorType.App_Back,bgResKey:this.mResKey,bgTextures:["btnGroup_white_normal.png","btnGroup_white_light.png","btnGroup_white_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mReturnBtn.x=this.mBtnX,this.mReturnBtn.setPos(this.mBtnX,0),this.mBtnList.push(this.mReturnBtn),n+=this.mReturnBtn.width+this.mBtnPad,this.add(this.mReturnBtn),this.mBtnX+=-this.mReturnBtn.width-this.mBtnPad,this.mDebugBtn=new s.IconBtn(this.scene,this.mWorld,{key:a.DebugLoggerMediator.NAME,bgResKey:this.mResKey,bgTextures:["btnGroup_blue_normal.png","btnGroup_blue_light.png","btnGroup_blue_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mDebugBtn.x=this.mBtnX,this.mDebugBtn.setPos(this.mBtnX,0),this.mBtnList.push(this.mDebugBtn),n+=this.mDebugBtn.width+this.mBtnPad,this.add(this.mDebugBtn),this.mReturnBtn.setClick((function(){e.mWorld.closeGame()})),this.mDebugBtn.setClick((function(){var t=e.mWorld.uiManager.getMediator(a.DebugLoggerMediator.NAME);t||(e.mWorld.uiManager.setMediator(a.DebugLoggerMediator.NAME,new a.DebugLoggerMediator(e.mWorld.uiManager.getUILayerManager(),e.scene,e.mWorld)),t=e.mWorld.uiManager.getMediator(a.DebugLoggerMediator.NAME)),t.isShow()?t.hide():t.show()}))),this.setSize(n,i),this.mTurnBtn.setClick((function(){e.turnHandler()})),this.resize(),t.prototype.init.call(this)},TopBtnGroup.prototype.tweenComplete=function(e){var i=this;t.prototype.tweenComplete.call(this,e),e&&(this.mAddBtnDataList&&this.mAddBtnDataList.forEach((function(t){i.addBtn(t)})),this.mRemoveBtnKeyList&&this.mRemoveBtnKeyList.forEach((function(t){i.removeBtn(t)})))},TopBtnGroup.prototype.turnHandler=function(){var t=this;if(this.mBtnList||!(this.mBtnList.length<1))for(var e=this.mBtnList.length,_loop_1=function(n){var o=i.mBtnList[n],r=i.mExpandBoo?o.getPos().x:i.mTurnBtn.width>>1,s=i.mExpandBoo?1:0,a=i.mExpandBoo?"Sine.easeIn":"Sine.easeOut";i.scene.tweens.add({targets:o,duration:300,ease:a,props:{x:{value:r},alpha:{value:s}},onComplete:function(i,o,r){n===e-1&&(t.mExpandBoo=!t.mExpandBoo)},onCompleteParams:[i]})},i=this,n=0;n<e;n++)_loop_1(n)},TopBtnGroup.prototype.btnRefreshPos=function(){var t=this;if(this.mBtnList&&this.mBtnList.length>1){this.mBtnX=-this.mTurnBtn.width-this.mBtnPad;var e=this.mTurnBtn.height/2+20,i=0;this.mBtnList.forEach((function(e){e&&(e.x=t.mBtnX,e.setPos(t.mBtnX,0),t.mBtnX+=-e.width-t.mBtnPad,i+=e.width+t.mBtnPad,t.add(e))})),this.setSize(i,e)}this.resize()},TopBtnGroup}(o.BasePanel)},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n,o=i(118),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function GridLayer(e){return t.call(this,e)||this}return r(GridLayer,t),GridLayer.prototype.draw=function(t){if(this.clear(),t&&t.roomSize){this.lineStyle(1,16777215);for(var e=t.roomSize.rows,i=t.roomSize.cols,n=0;n<=e;n++)this.drawLine(t.transformTo90(new o.a(0,n)),t.transformTo90(new o.a(i,n)));for(n=0;n<=i;n++)this.drawLine(t.transformTo90(new o.a(n,0)),t.transformTo90(new o.a(n,e)))}},GridLayer.prototype.drawLine=function(t,e){this.lineBetween(t.x,t.y,e.x,e.y)},GridLayer}(Phaser.GameObjects.Graphics),a=function(){function LayerManager(t){this.room=t,this.mSurfaceInteractived=!0,this.mDelta=0;var e=1;t&&(t.world&&(e=t.world.scaleRatio),this.mScene=t.scene,this.mGroundClickLayer=this.mScene.add.container(0,0),this.mUGroundLayer2=this.mScene.add.container(0,0),this.mGroundLayer=this.mScene.add.container(0,0).setScale(e),this.mTileLayer=new s(this.mScene).setScale(e),this.mScene.sys.displayList.add(this.mTileLayer),this.mMiddleLayer=this.mScene.add.container(0,0).setScale(e),this.mSurfaceLayer=this.mScene.add.container(0,0).setScale(e),this.mAtmosphere=this.mScene.add.container(0,0),this.mSceneUILayer=this.mScene.add.container(0,0))}return LayerManager.prototype.addToGround=function(t,e){void 0!==e?this.mGroundLayer.addAt(t,e):Array.isArray(t)?this.mGroundLayer.add(t):this.mGroundLayer.add([t])},LayerManager.prototype.addToSurface=function(t){Array.isArray(t)?this.mSurfaceLayer.add(t):this.mSurfaceLayer.add([t])},LayerManager.prototype.addToSceneToUI=function(t){this.mSceneUILayer.add(t)},LayerManager.prototype.addToAtmosphere=function(t){this.mAtmosphere.add(t)},LayerManager.prototype.addToMiddle=function(t){this.mMiddleLayer.add(t)},LayerManager.prototype.resize=function(t,e){var i=this.room.world.scaleRatio;this.mGroundLayer.setScale(i),this.mTileLayer.setScale(i),this.mMiddleLayer.setScale(i),this.mSurfaceLayer.setScale(i)},LayerManager.prototype.sortSurface=function(){this.mSurfaceLayer.sort("depth")},LayerManager.prototype.changeScene=function(){this._clearLayer()},LayerManager.prototype.drawGrid=function(t){this.mTileLayer&&this.mTileLayer.draw(t)},LayerManager.prototype.setGridVisible=function(t){this.mTileLayer&&this.mTileLayer.setVisible(t)},LayerManager.prototype.update=function(t,e){t-this.mDelta<200||(this.mDelta=t,this.mDepthGround&&(this.mGroundLayer.sort("depth"),this.mDepthGround=!1),this.mDepthSurface&&(this.mDepthSurface=!1,this.mSurfaceLayer.sort("depth",(function(t,e){return t.sortY+t.sortZ>e.sortY+e.sortZ}))))},LayerManager.prototype.setSurfaceInteractive=function(t){if(this.mSurfaceInteractived!==t){this.mSurfaceInteractived=t;var e=this.mSurfaceLayer.list;t?e.forEach((function(t){t.setInteractive()})):e.forEach((function(t){t.disableInteractive()}))}},LayerManager.prototype.destroy=function(){this.mDelta=0,this._clearLayer()},LayerManager.prototype._clearLayer=function(){this.clearLayer(this.mGroundClickLayer),this.clearLayer(this.mGroundLayer),this.clearLayer(this.mSurfaceLayer),this.clearLayer(this.mUGroundLayer2),this.clearLayer(this.mAtmosphere),this.mTileLayer.destroy(!0)},LayerManager.prototype.clearLayer=function(t,e){void 0===e&&(e=!1);var i=t.list;if(i)for(var n=i.length,o=void 0,r=0;r<n;r++)(o=i[r])&&(o.destroy(e),o=null);t.destroy(e)},Object.defineProperty(LayerManager.prototype,"depthSurfaceDirty",{set:function(t){this.mDepthSurface=t},enumerable:!1,configurable:!0}),Object.defineProperty(LayerManager.prototype,"depthGroundDirty",{set:function(t){this.mDepthGround=t},enumerable:!1,configurable:!0}),Object.defineProperty(LayerManager.prototype,"layer",{get:function(){return this.mGroundLayer},enumerable:!1,configurable:!0}),LayerManager}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var n,o=i(110),r=i(2),s=i(0),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Rectangle45(e,i,n,o){var r=t.call(this,e,i,n,o)||this;return r.row=e,r.col=i,r.endRow=n,r.endCol=o,r}return a(Rectangle45,t),Rectangle45}(Phaser.Geom.Rectangle),c=i(118),l=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),p=function(t){function CamerasManager(e){var i=t.call(this)||this;return i.mRoomService=e,i.MINI_VIEW_SIZE=50,i.VIEW_PORT_SIZE=50,i.viewPort=new Phaser.Geom.Rectangle,i.miniViewPort=new Phaser.Geom.Rectangle,i.zoom=1,i.mRoomService&&i.mRoomService.world&&(i.zoom=i.mRoomService.world.scaleRatio),i.mCameras=[],i}return l(CamerasManager,t),CamerasManager.prototype.getViewPort=function(){if(this.mMain){var t=this.mMain.worldView;return this.viewPort.x=t.x/this.zoom+(t.width/this.zoom-this.viewPort.width>>1),this.viewPort.y=t.y/this.zoom+(t.height/this.zoom-this.viewPort.height>>1),this.viewPort}},CamerasManager.prototype.getMiniViewPort=function(){if(this.mMain){var t=this.mMain.worldView;this.miniViewPort.x=t.x/this.zoom+(t.width/this.zoom-this.miniViewPort.width>>1),this.miniViewPort.y=t.y/this.zoom+(t.height/this.zoom-this.miniViewPort.height>>1);var e=this.mRoomService.transformTo45(new c.a(this.miniViewPort.x+(this.miniViewPort.width>>1),this.miniViewPort.y));return new h(e.x,e.y,this.MINI_VIEW_SIZE,this.MINI_VIEW_SIZE)}},CamerasManager.prototype.pan=function(t,e,i){var n=this;t*=this.zoom,e*=this.zoom;for(var o=0,r=this.mCameras;o<r.length;o++){r[o].pan(t,e,i)}return new Promise((function(t,e){n.mMain.once(Phaser.Cameras.Scene2D.Events.PAN_COMPLETE,(function(){t()}))}))},Object.defineProperty(CamerasManager.prototype,"camera",{get:function(){return this.mMain},set:function(t){this.mMain=t,this.addCamera(t),this.setViewPortSize()},enumerable:!1,configurable:!0}),CamerasManager.prototype.resize=function(t,e){this.resetCameraSize(t,e),this.mTarget&&this.startFollow(this.mTarget)},CamerasManager.prototype.setScroll=function(t,e){if(this.mMain)for(var i=0,n=this.mCameras;i<n.length;i++){n[i].setScroll(t,e)}},CamerasManager.prototype.offsetScroll=function(t,e){if(this.mMain){for(var i=0,n=this.mCameras;i<n.length;i++){var o=n[i];o.scrollX+=t/this.camera.zoom,o.scrollY+=e/this.camera.zoom}this.moving=!0}},CamerasManager.prototype.startFollow=function(t){if(this.mTarget=t,this.mMain&&t)for(var e=0,i=this.mCameras;e<i.length;e++){i[e].startFollow(t)}},CamerasManager.prototype.stopFollow=function(){if(this.mTarget=null,this.mMain)for(var t=0,e=this.mCameras;t<e.length;t++){e[t].stopFollow()}},CamerasManager.prototype.addCamera=function(t){-1===this.mCameras.indexOf(t)&&this.mCameras.push(t),this.mTarget&&t.startFollow(this.mTarget)},CamerasManager.prototype.removeCamera=function(t){var e=this.mCameras.indexOf(t);e>-1&&this.mCameras.splice(e,1)},CamerasManager.prototype.setBounds=function(t,e,i,n,o){if(this.mMain)for(var r=0,a=this.mCameras;r<a.length;r++){a[r].setBounds(t,e,i,n,o)}else s.a.getInstance().error("camera does not exist")},CamerasManager.prototype.setPosition=function(t,e){if(this.mMain)for(var i=0,n=this.mCameras;i<n.length;i++){n[i].setPosition(t,e)}},CamerasManager.prototype.syncToEditor=function(){if(this.mMain){var t=this.mMain.worldView,e=new o.PBpacket(r.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_RESET_CAMERA),i=e.content;i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,this.connection.send(e)}},CamerasManager.prototype.centerCameas=function(){},CamerasManager.prototype.syncCamera=function(){if(this.mMain){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_RESET_CAMERA_SIZE),e=t.content;e.width=this.mMain.width/this.mMain.zoom,e.height=this.mMain.height/this.mMain.zoom,this.connection.send(t)}},CamerasManager.prototype.syncCameraScroll=function(){if(this.mMain){var t=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SET_CAMERA_POSITION),e=t.content,i=r.op_def.PBPoint3f.create();i.x=this.mMain.scrollX/Math.ceil(window.devicePixelRatio),i.y=this.mMain.scrollY/Math.ceil(window.devicePixelRatio),e.pos=i,this.connection.send(t)}},CamerasManager.prototype.scrollTargetPoint=function(t,e){this.mMain&&this.setScroll(t*this.mRoomService.world.scaleRatio-this.mMain.width/2,e*this.mRoomService.world.scaleRatio-this.mMain.height/2)},CamerasManager.prototype.destroy=function(){this.mMain=void 0,this.mCameras=[]},CamerasManager.prototype.resetCameraSize=function(t,e){this.connection?this.syncCamera():s.a.getInstance().error("connection is undefined")},CamerasManager.prototype.setViewPortSize=function(){if(this.mMain){var t=this.mRoomService.roomSize;if(t){var e=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileWidth/2),i=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileHeight/2);this.viewPort.setSize(e,i);var n=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileWidth/2),o=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileHeight/2);this.miniViewPort.setSize(n,o)}else s.a.getInstance().error("room size does not exist")}else s.a.getInstance().error("camera does not exist")},Object.defineProperty(CamerasManager.prototype,"connection",{get:function(){if(this.mRoomService)return this.mRoomService.connection;s.a.getInstance().error("room service is undefined")},enumerable:!1,configurable:!0}),Object.defineProperty(CamerasManager.prototype,"moving",{get:function(){return this.mMoving},set:function(t){this.mMoving=t},enumerable:!1,configurable:!0}),Object.defineProperty(CamerasManager.prototype,"targetFollow",{get:function(){return this.mTarget},enumerable:!1,configurable:!0}),CamerasManager}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractionBubbleCell",(function(){return h}));var n,o=i(344),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function BubbleAnimation(e){var i=t.call(this,e)||this;return i.loaded=!1,i.isPlaying=!1,i.loop=!1,i}return r(BubbleAnimation,t),BubbleAnimation.prototype.load=function(t,e,i){this.resName=t||e,this.resUrl=e,this.animUrlData=new o.a,t?this.animUrlData.setData(this.resName,this.resUrl):this.animUrlData.setDisplayData(e,i),this.scene.load.image(this.resName,this.animUrlData.pngUrl),this.scene.load.image(this.animUrlData.jsonUrl,this.animUrlData.jsonUrl),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.start()},BubbleAnimation.prototype.play=function(t){this.isPlaying=!0,this.frameAnim&&(this.setScale(.2,.2),this.y=50,this.scene.tweens.add({targets:this,y:{value:-100,duration:300,ease:"Bounce.easeOut"},scaleX:{value:1,duration:300,ease:"Bounce.easeOut"},scaleY:{value:1,duration:300,ease:"Bounce.easeOut"}}))},BubbleAnimation.prototype.destroy=function(){this.frameAnim&&this.frameAnim.destroy(),this.bubblebg&&this.bubblebg.destroy(),this.animUrlData&&this.animUrlData.dispose(),this.frameAnim=null,this.animUrlData=null,this.bubblebg=null},BubbleAnimation.prototype.onLoadComplete=function(t,e,i){this.loaded=!0,this.bubblebg=this.scene.add.image(0,0,this.resName),this.frameAnim=this.scene.add.image(0,0,this.animUrlData.jsonUrl),this.add([this.bubblebg,this.frameAnim]),this.isPlaying&&this.play()},BubbleAnimation}(Phaser.GameObjects.Container),a=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),h=function(t){function InteractionBubbleCell(e,i){var n=t.call(this,e)||this;return n.mWdith=78,n.mHeight=78,n.width=n.mWdith*i,n.height=n.mHeight*i,n}return a(InteractionBubbleCell,t),InteractionBubbleCell.prototype.setContentData=function(t,e){this.content=t,this.handler&&this.handler.clear(),this.handler=e},InteractionBubbleCell.prototype.load=function(t,e,i){this.createAnimation(),this.mBubbleAni.load(t,e,i),this.mBubbleAni.play()},InteractionBubbleCell.prototype.show=function(){this.mBubbleAni&&this.add(this.mBubbleAni),this.removeDelay()},InteractionBubbleCell.prototype.hide=function(){this.mBubbleAni&&this.remove(this.mBubbleAni),this.mRemoveDelay&&(clearTimeout(this.mRemoveDelay),this.mRemoveDelay=null)},InteractionBubbleCell.prototype.destroy=function(){this.hide(),this.mBubbleAni&&this.mBubbleAni.destroy(),this.handler&&this.handler.clear(),this.mBubbleAni=null,this.handler=null,t.prototype.destroy.call(this)},InteractionBubbleCell.prototype.createAnimation=function(){this.mBubbleAni=new s(this.scene),this.mBubbleAni.width=this.width,this.mBubbleAni.height=this.height;var t=Phaser.Input.Events.POINTER_DOWN;this.mBubbleAni.setInteractive(new Phaser.Geom.Rectangle(0,0,2*this.mBubbleAni.width,2*this.mBubbleAni.height),Phaser.Geom.Rectangle.Contains),this.mBubbleAni.on(t,this.onBubbleClick,this)},InteractionBubbleCell.prototype.onBubbleClick=function(){this.handler&&this.handler.runWith(this.content)},InteractionBubbleCell.prototype.removeDelay=function(){var t=this;this.mRemoveDelay=setTimeout((function(){t.handler&&t.handler.runWith(t.content.id),t.hide()}),this.content.duration)},InteractionBubbleCell}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopItemSlot",(function(){return f}));var n,o,r,s=i(133),a=i(145),h=i(2),c=i(111);o=n||(n={}),r=function(){function TuDing18(){}return TuDing18.getName=function(){return"ui_moneyIcon_tuding_18_png"},TuDing18.getPNG=function(){return c.i.getRes("ui/moneyIcon/tuding_18.png")},TuDing18}(),o.TuDing18=r;var l,p=i(116),d=i(158),m=i(110),u=(l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function ShopItemSlot(e,i,n,o,r,s,a,h,c,l,p){return t.call(this,e,i,n,o,r,s,a,h,c,l)||this}return u(ShopItemSlot,t),ShopItemSlot.prototype.shopDataChange=function(e,i){if(e){this.mPackageID=i,t.prototype.dataChange.call(this,e);for(var o=e.price,r=o.length,s=0;s<r;s++){o[s].coinType===h.op_def.CoinType.TU_DING_COIN&&(n.TuDing18.getName(),n.TuDing18.getPNG()),this.makeCoin(o[s],20*s+30)}}},ShopItemSlot.prototype.destroy=function(){this.moneyIcon&&(this.moneyIcon.destroy(!0),this.moneyIcon=null),t.prototype.destroy.call(this)},ShopItemSlot.prototype.makeCoin=function(t,e){var i;t.coinType===h.op_def.CoinType.TU_DING_COIN&&(n.TuDing18.getName(),i=n.TuDing18.getPNG()),this.moneyIcon=new p.DynamicImage(this.mScene,0,0),this.moneyIcon.x=15+(-this.mWid>>1),this.moneyIcon.y=e,this.toolTipCon.add(this.moneyIcon),this.moneyIcon.load(i);var o=this.mScene.make.text(void 0,!1);o.setFontFamily("Tahoma"),o.setFontSize(15),o.x=-this.mWid/2+this.moneyIcon.width+20,o.y=e-9,this.toolTipCon.add(o),o.setText(t.price.toString())},ShopItemSlot.prototype.onLoadCompleteHandler=function(){this.mWid=80,this.mHei=88,this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.itemBG.y=-10,this.toolTipCon.setSize(this.mWid,this.mHei),this.toolTipCon.addAt(this.itemBG,0),this.mIcon=new a.DragDropIcon(this.mScene,0,-10),this.toolTipCon.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1),this.isTipBoo&&(this.toolTip=new d.ToolTip(this.mScene,"itemSlotTip",c.i.getRes("ui/toolTip/toolTip.json"),c.i.getRes("ui/toolTip/toolTip.png"),this.mWorld.uiScale)),this.toolTipCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.toolTipCon.on("pointerover",this.overHandler,this),this.toolTipCon.on("pointerout",this.outHandler,this),this.toolTipCon.on("pointerdown",this.downHandler,this),this.toolTipCon.on("pointerup",this.outHandler,this),this.minitialize=!0,this.mData&&this.dataChange(this.mData),this.mSelectSprite=this.mScene.make.sprite(void 0,!1),this.createTexture(this.mWid,this.mHei)},ShopItemSlot.prototype.overHandler=function(e){t.prototype.overHandler.call(this,e),this.mSelectSprite.y-=10},ShopItemSlot.prototype.downHandler=function(t){if(this.mData){var e=new m.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),i=e.content;i.uiId=this.mPackageID,i.componentId=this.mData.id,this.mWorld.connection.send(e)}},ShopItemSlot.prototype.outHandler=function(e){t.prototype.outHandler.call(this,e)},ShopItemSlot.prototype.createTexture=function(t,e){var i=this.mScene.add.graphics();i.fillStyle(11184553,.3),i.fillRoundedRect(0,0,t,e,5),i.generateTexture("selectBg",t,e),i.clear()},ShopItemSlot}(s.ItemSlot)},,,,,,,function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n,o=i(118),r=i(138),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function ReferenceArea(e,i){var n=t.call(this,e)||this;return n.mRoomService=i,n}return s(ReferenceArea,t),ReferenceArea.prototype.draw=function(t,e){if(this.clear(),0!==t.length&&0!==t[0].length){var i,n,s,a,h=t.length,c=t[0].length,l=this.mRoomService.roomSize,p=l.tileWidth/2,d=l.tileHeight/2;this.mOrigin=e,this.mSize={rows:h,cols:c,tileWidth:p,tileHeight:d,sceneWidth:(h+c)*(p/2),sceneHeight:(h+c)*(d/2)},this.beginPath();for(var m=0;m<h;m++)for(var u=0;u<c;u++)this.lineStyle(2,0),i=r.a.transformTo90(new o.a(u,m),this.mSize),n=r.a.transformTo90(new o.a(u+1,m),this.mSize),s=r.a.transformTo90(new o.a(u+1,m+1),this.mSize),a=r.a.transformTo90(new o.a(u,m+1),this.mSize),this.beginPath(),this.fillStyle(1===t[m][u]?65280:16711680),this.strokePoints([i.toPoint(),n.toPoint(),s.toPoint(),a.toPoint()],!0,!0),this.fillPath();this.setPosition(0,0)}},ReferenceArea.prototype.setPosition=function(e,i,n,o){if(this.mSize){var r=e-this.mSize.rows*(this.mSize.tileWidth>>1)-(this.mOrigin.x-this.mOrigin.y)*(this.mSize.tileWidth>>1),s=i-(this.mOrigin.x+this.mOrigin.y+.5)*(this.mSize.tileHeight>>1);return t.prototype.setPosition.call(this,r,s,n,o)}},Object.defineProperty(ReferenceArea.prototype,"size",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),ReferenceArea}(Phaser.GameObjects.Graphics)},,function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n,o=i(122),r=i(2),s=i(118),a=i(110),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function Player(e,i){var n=t.call(this,e,i)||this;return n.mElementManager=i,n.nodeType=r.op_def.NodeType.CharacterNodeType,n.mOffsetY=void 0,n.mDisplay&&e.displayBadgeCards&&e.displayBadgeCards.length>0&&n.mDisplay.setDisplayBadges(e.displayBadgeCards),n}return h(Player,t),Player.prototype.setModel=function(e){t.prototype.setModel.call(this,e),this.showNickname()},Player.prototype.move=function(e){this.getDirection()!==e.direction&&(this.roomService.world.moveStyle===r.op_def.MoveStyle.DIRECTION_MOVE_STYLE?this.mId!==this.roomService.playerManager.actor.id&&this.setDirection(e.direction):this.setDirection(e.direction)),e.destinationPoint3f.y+=this.offsetY,t.prototype.move.call(this,e)},Player.prototype.movePath=function(t){var e=this;if(this.mDisplay){var i=t.path;if(i){var n=new s.a(this.mDisplay.x,this.mDisplay.y-this.offsetY),o=[];this.mMoveData.arrivalTime=t.timestemp;for(var r=null,a=null,h=this.mElementManager.roomService.now(),c=0,l=0,p=0,d=i;p<d.length;p++){var m=d[p];(a=m.point3f).y===n.y&&a.x===n.x||(r=Math.atan2(a.y-n.y,a.x-n.x)*(180/Math.PI)),h+=c,c=m.timestemp-h,o.push({x:a.x,y:a.y+this.offsetY,duration:c,onStartParams:r,onStart:function(t,i,n){e.onCheckDirection(n)},onCompleteParams:{duration:c,index:l},onComplete:function(t,i,n){e.onMovePathPointComplete(n)}}),n=new s.a(a.x,a.y),l++}this.mMoveData.posPath=o,this.mMoveData.onCompleteParams=a,this.mMoveData.onComplete=this.mMovePathPointFinished,this._doMove()}}},Player.prototype.setDirection=function(t){t!==this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t,this.mModel.direction=t,this.mDisplay&&this.mDisplay.play(this.mModel.currentAnimation))},Player.prototype.changeState=function(t){this.mDisplay&&this.mCurState!==t&&(t||(t=o.d.IDLE),this.mCheckStateHandle(t)&&(this.mCurState=t,this.mModel.currentAnimationName=this.mCurState,this.mDisplay.play(this.mModel.currentAnimation)))},Player.prototype.setPosition=function(e){e.y+=this.offsetY,t.prototype.setPosition.call(this,e)},Player.prototype.getPosition=function(){var e=t.prototype.getPosition.call(this);return e.y-=this.offsetY,e},Player.prototype.onCheckDirection=function(t){"number"==typeof t&&(t>90?this.setDirection(3):t>=0?this.setDirection(5):t>=-90?this.setDirection(7):this.setDirection(1))},Player.prototype.onMoveStart=function(){this.changeState(o.d.WALK),this.mMoveData&&(this.mMoveData.step=0),t.prototype.onMoveStart.call(this)},Player.prototype.onMoveComplete=function(){this.preMoveComplete(),t.prototype.onMoveComplete.call(this),this.changeState(o.d.IDLE)},Player.prototype.preMoveComplete=function(){if(this.mMoveData&&this.mMoveData.posPath){var t=this.mMoveData.onComplete;t&&(t.call(this,this.mMoveData.onCompleteParams),delete this.mMoveData.onComplete,delete this.mMoveData.onCompleteParams)}},Player.prototype.onMovePathPointComplete=function(t){this.mMoveData&&(this.mMoveData.step+=1)},Player.prototype.mMovePathPointFinished=function(t){if(t&&this.mRoomService){var e=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOVE_PATH_POINT_FINISHED),i=e.content,n=r.op_def.PBPoint3f.create(),o=this.getPosition();n.x=o.x,n.y=o.y,n.z=o.z;var s=r.op_def.PBPoint3f.create();s.x=t.x,s.y=t.y,i.currentPoint=n,i.lastTargetPoint=s,i.timestemp=this.mRoomService.world.clock.unixTime,this.mRoomService.connection.send(e)}},Object.defineProperty(Player.prototype,"offsetY",{get:function(){if(void 0===this.mOffsetY){if(!this.mElementManager||!this.mElementManager.roomService||!this.mElementManager.roomService.roomSize)return 0;this.mOffsetY=this.mElementManager.roomService.roomSize.tileHeight>>2}return this.mOffsetY},enumerable:!1,configurable:!0}),Player.prototype.onDisplayReady=function(e){t.prototype.onDisplayReady.call(this,e),this.showNickname()},Player.prototype.mCheckStateHandle=function(t){return!0},Player}(o.b)},function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n,o=i(0),r=i(178),s=i(175),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Terrain(e,i){var n=t.call(this,i.roomService)||this;return n.mElementManager=i,n.mId=e.id,n.model=e,n}return a(Terrain,t),Terrain.prototype.setModel=function(t){this.mModel=t,t&&(this.load(this.mModel.displayInfo),this.mDisplay&&this.setPosition45(this.mModel.pos))},Terrain.prototype.updateModel=function(t){},Terrain.prototype.load=function(t){this.mDisplayInfo=t,this.mDisplayInfo&&(this.mDisplay||this.createDisplay(),this.mDisplayInfo=t,this.mDisplay.once("initialized",this.onInitializedHandler,this),this.mDisplay.load(this.mDisplayInfo))},Terrain.prototype.play=function(t){this.mModel?this.mModel.currentAnimationName!==t&&(this.mModel.currentAnimationName=t,this.mDisplay&&this.mDisplay.play(this.model.currentAnimation)):o.a.getInstance().error(Terrain.name+": sprite is empty")},Terrain.prototype.setDirection=function(t){this.mDisplayInfo&&this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t)},Terrain.prototype.getDirection=function(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},Terrain.prototype.setPosition=function(t){this.mDisplay&&this.mDisplay.setPosition(t.x,t.y,t.z),this.setDepth()},Terrain.prototype.getDisplay=function(){return this.mDisplay},Terrain.prototype.showNickname=function(){},Terrain.prototype.hideNickname=function(){},Terrain.prototype.showEffected=function(){},Terrain.prototype.turn=function(){},Terrain.prototype.setAlpha=function(t){},Terrain.prototype.scaleTween=function(){},Terrain.prototype.setQueue=function(){},Terrain.prototype.update=function(){},Terrain.prototype.mount=function(){return this},Terrain.prototype.unmount=function(){return this},Terrain.prototype.addMount=function(){return this},Terrain.prototype.removeMount=function(){return this},Terrain.prototype.destroy=function(){this.mBlockable&&this.mDisplay&&this.roomService.removeBlockObject(this),t.prototype.destroy.call(this)},Terrain.prototype.createDisplay=function(){if(this.mDisplayInfo){if(this.mDisplay)return this.mDisplay;var t=this.mElementManager.scene;return t&&(this.mDisplay=new r.a(t,this.mElementManager.roomService,this),this.setPosition45(this.model.pos),this.addToBlock()),this.mDisplay}},Terrain.prototype.addDisplay=function(){if(this.createDisplay(),this.mDisplay)if(this.mElementManager){var t=this.mElementManager.roomService;t?(t.addToGround(this.mDisplay),this.setDepth()):o.a.getInstance().error("roomService does not exist")}else o.a.getInstance().error("element manager does not exist")},Terrain.prototype.setDepth=function(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.y),!this.roomService)throw new Error("roomService is undefined");var t=this.roomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthGroundDirty=!0}},Terrain.prototype.onInitializedHandler=function(){this.mDisplay&&this.mDisplay.play(this.model.currentAnimation)},Terrain.prototype.setPosition45=function(t){if(this.roomService){var e=this.roomService.transformTo90(t);this.setPosition(e)}else o.a.getInstance().error("roomService does not exist")},Object.defineProperty(Terrain.prototype,"id",{get:function(){return this.mId},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"dir",{get:function(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"roomService",{get:function(){if(this.mElementManager)return this.mElementManager.roomService;o.a.getInstance().error("element manager is undefined")},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"model",{get:function(){return this.mModel},set:function(t){this.setModel(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"currentAnimationName",{get:function(){return this.mModel?this.mModel.currentAnimationName:""},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"scene",{get:function(){if(this.mElementManager)return this.mElementManager.scene},enumerable:!1,configurable:!0}),Terrain}(s.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),r=function(t){function PlayCamera(e,i,n,o,r,s){var a=t.call(this,e,i,n,o)||this;return a.pixelRatio=r,a.moveRatio=s||1,a}return o(PlayCamera,t),PlayCamera.prototype.setPixelRatio=function(t){this.pixelRatio=t},PlayCamera.prototype.startFollow=function(t,e,i,n,o,r){void 0===e&&(e=!1),void 0===i&&(i=1),void 0===n&&(n=i),void 0===o&&(o=0),void 0===r&&(r=o),this._follow=t,this.roundPixels=e,this.lerp.set(i,n),this.followOffset.set(o,r);var s=this.width/2,a=this.height/2,h=this._follow.getPosition(),c=h.x*this.pixelRatio*this.moveRatio-o,l=h.y*this.pixelRatio*this.moveRatio-r;return this.midPoint.set(c,l),this.scrollX=c-s,this.scrollY=l-a,this.useBounds&&(this.scrollX=this.clampX(this.scrollX),this.scrollY=this.clampY(this.scrollY)),this},PlayCamera.prototype.preRender=function(t){var e=this.width,i=this.height,n=.5*e,o=.5*i,r=this.zoom*t,s=this.matrix,a=e*this.originX,h=i*this.originY,c=this._follow,l=this.deadzone,p=this.scrollX,d=this.scrollY;if(c&&!this.panEffect.isRunning){var m=c.getPosition(),u=m.x*this.pixelRatio*this.moveRatio-this.followOffset.x,f=m.y*this.pixelRatio*this.moveRatio-this.followOffset.y;l?(u<l.x?p=this.linear(p,p-(l.x-u),this.lerp.x):u>l.right&&(p=this.linear(p,p+(u-l.right),this.lerp.x)),f<l.y?d=this.linear(d,d-(l.y-f),this.lerp.y):f>l.bottom&&(d=this.linear(d,d+(f-l.bottom),this.lerp.y))):(p=this.linear(p,u-a,this.lerp.x),d=this.linear(d,f-h,this.lerp.y))}this.useBounds&&(p=this.clampX(p),d=this.clampY(d)),this.roundPixels&&(a=Math.round(a),h=Math.round(h)),this.scrollX=p,this.scrollY=d;var y=p+n,g=d+o;this.midPoint.set(y,g);var _=e/r,P=i/r;this.worldView.setTo(y-_/2,g-P/2,_,P),s.applyITRS(this.x+a,this.y+h,this.rotation,r,r),s.translate(-a,-h),this.shakeEffect.preRender()},PlayCamera.prototype.linear=function(t,e,i){return(e-t)*i+t},PlayCamera}(Phaser.Cameras.Scene2D.Camera)},function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return n}));var n,o=i(0),r=function(){function Scenery(t){this.mID=t.id,this.mDepth=t.depth,this.mUris=[];var e=null;(e=Array.isArray(t.uris)?t.uris:t.uris.value).length<1&&o.a.getInstance().error(Scenery.name+": scenery uris is empty");for(var i=0;i<e.length;i++){var n=e[i].value||e;this.mUris[i]=new Array(n[i].length);for(var r=0;r<n[i].length;r++)this.mUris[i][r]=n[i][r]}this.mSpeed=t.speed||1,t.width||o.a.getInstance().error(Scenery.name+": scenery width is "+t.width),t.height||o.a.getInstance().error(Scenery.name+": scenery height is "+t.height),this.mWidth=t.width,this.mHeight=t.height,this.mFit=t.fit,this.mOffset=t.offset||{x:0,y:0}}return Object.defineProperty(Scenery.prototype,"width",{get:function(){return this.mWidth},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"height",{get:function(){return this.mHeight},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"depth",{get:function(){return this.mDepth},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"offset",{get:function(){return this.mOffset},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"speed",{get:function(){return this.mSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"uris",{get:function(){return this.mUris},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"fit",{get:function(){return this.mFit},enumerable:!1,configurable:!0}),Scenery}();!function(t){t[t.Center=1]="Center",t[t.Fill=2]="Fill",t[t.Stretch=3]="Stretch",t[t.Repeat=4]="Repeat"}(n||(n={}))},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function AnimationUrlData(){}return AnimationUrlData.prototype.setData=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=".json"),this.resName=t,this.resUrl=e,this.pngUrl=e+"/"+t+(i?"_tex.png":".png"),this.jsonUrl=e+"/"+t+(i?"_tex.json":".json"),i&&(this.boneUrl=e+"/"+t+"_ske"+n),this.responseType=".dbbin"===n?"arraybuffer":null,this.boneXhrSettings=this.responseType?{responseType:"arraybuffer"}:null},AnimationUrlData.prototype.setDisplayData=function(t,e,i){void 0===i&&(i=".json"),this.pngUrl=t,this.jsonUrl=e,this.responseType=".dbbin"===i?"arraybuffer":null,this.boneXhrSettings=this.responseType?{responseType:"arraybuffer"}:null},AnimationUrlData.prototype.dispose=function(){this.textureXhrSettings=null,this.atlasXhrSettings=null,this.boneXhrSettings=null},AnimationUrlData}()},function(t,e,i){"use strict";i.r(e),i.d(e,"GraphicsProgressBar",(function(){return r}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),r=function(t){function GraphicsProgressBar(e,i,n,o,r,s){void 0===s&&(s=!0);var a=t.call(this,e,i,n)||this;return a.value=.5,a.bgGraphics=a.scene.make.graphics(void 0,!1),a.barGraphics=a.scene.make.graphics(void 0,!1),a.add([a.bgGraphics,a.barGraphics]),a.setSize(o,r),a.bgColor=0,a.barColor=267386880,a.bgGraphics.clear(),a.bgGraphics.fillStyle(a.bgColor,1),a.bgGraphics.fillRect(0,0,a.width,a.height),a.setValue(a.value),a}return o(GraphicsProgressBar,t),GraphicsProgressBar.prototype.setColor=function(t,e){this.barColor=t,e&&(this.bgColor=e),this.bgGraphics.clear(),this.bgGraphics.fillStyle(this.bgColor,1),this.bgGraphics.fillRect(0,0,this.width,this.height),this.setValue(this.value)},GraphicsProgressBar.prototype.setValue=function(t){this.value=t;var e=this.width*(this.isHorizontal?t:1),i=this.height*(this.isHorizontal?1:t);this.barGraphics.clear(),this.barGraphics.fillStyle(this.barColor,1),this.barGraphics.fillRect(0,0,e,i)},GraphicsProgressBar.prototype.setRoundedRectValue=function(t,e){this.value=t;var i=this.width*(this.isHorizontal?t:1),n=this.height*(this.isHorizontal?1:t);this.barGraphics.clear(),this.barGraphics.fillStyle(this.barColor,1),this.barGraphics.fillRoundedRect(0,0,i,n,e)},GraphicsProgressBar}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"GridLayoutGroup",(function(){return c})),i.d(e,"AlignmentType",(function(){return o})),i.d(e,"CornerType",(function(){return r})),i.d(e,"AxisType",(function(){return s})),i.d(e,"ConstraintType",(function(){return a}));var n,o,r,s,a,h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function GridLayoutGroup(e,i,n){var h=t.call(this,e,i,n)||this;return h.layoutElements=[],h._padding=new Phaser.Math.Vector4(0,0,0,0),h._cellSize=new Phaser.Math.Vector2(100,100),h._spacing=new Phaser.Math.Vector2(0,0),h._alignmentType=o.UpperLeft,h._startCorner=r.UpperLeft,h._startAxis=s.Horizontal,h._constraint=a.Flexible,h._constraintCount=4,h}return h(GridLayoutGroup,t),GridLayoutGroup.prototype.onPlay=function(){},GridLayoutGroup.prototype.start=function(){},Object.defineProperty(GridLayoutGroup.prototype,"padding",{get:function(){return this._padding},set:function(t){void 0!==t&&(this._padding=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"cellSize",{get:function(){return this._cellSize},set:function(t){void 0!==t&&(t.x<0&&(t.x=0),t.y<0&&(t.y=0),this._cellSize=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"spacing",{get:function(){return this._spacing},set:function(t){void 0!==t&&(this._spacing=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"alignmentType",{get:function(){return this._alignmentType},set:function(t){t!==this._alignmentType&&(this._alignmentType=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"startCorner",{get:function(){return this._startCorner},set:function(t){t!==this._startCorner&&(this._startCorner=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"startAxis",{get:function(){return this._startAxis},set:function(t){t!==this._startAxis&&(this._startAxis=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"constraint",{get:function(){return this._constraint},set:function(t){t!==this._constraint&&(this._constraint=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"constraintCount",{get:function(){return this._constraintCount},set:function(t){void 0===t||isNaN(t)||(this._constraintCount=t)},enumerable:!1,configurable:!0}),GridLayoutGroup.prototype.Layout=function(){this.layoutElements.length=0;for(var t=0,e=this.list;t<e.length;t++){var i=e[t];i.active&&this.layoutElements.push(i)}if(0!==this.layoutElements.length){var n=this._startCorner%2,o=Math.floor(this._startCorner/2),r=0,a=0,h=0,c=this.getCellCount();this._startAxis===s.Horizontal?(r=c.x,a=Phaser.Math.Clamp(c.x,1,this.layoutElements.length),h=Phaser.Math.Clamp(c.y,1,Math.ceil(this.layoutElements.length/r))):(r=c.y,h=Phaser.Math.Clamp(c.y,1,this.layoutElements.length),a=Phaser.Math.Clamp(c.x,1,Math.ceil(this.layoutElements.length/r)));for(var l=new Phaser.Math.Vector2(a*this._cellSize.x+(a-1)*this._spacing.x,h*this._cellSize.y+(h-1)*this._spacing.y),p=new Phaser.Math.Vector2(this.getStartOffset(0,l.x),this.getStartOffset(1,l.y)),d=0,m=0,u=0;u<this.layoutElements.length;u++)this._startAxis===s.Horizontal?(d=u%r,m=Math.floor(u/r)):(d=Math.floor(u/r),m=u%r),1===n&&(d=a-1-d),1===o&&(m=h-1-m),this.setChildAlongAxis(this.layoutElements[u],0,p.x+(this._cellSize.x+this._spacing.x)*d,this._cellSize.x),this.setChildAlongAxis(this.layoutElements[u],1,p.y+(this._cellSize.y+this._spacing.y)*m,this._cellSize.y);var f=p.x+(this._cellSize.x+this._spacing.x)*(d+1),y=p.y+(this._cellSize.y+this._spacing.y)*(m+1);this.startAxis===s.Horizontal?(this.height=y,this.setAllChildPositionOffset(0)):(this.width=f,this.setAllChildPositionOffset(1)),this.width<f&&(this.width=f),this.height<y&&(this.height=y)}},GridLayoutGroup.prototype.setChildAlongAxis=function(t,e,i,n){0===e?t.width=n:t.height=n;var o=i;0===e?t.x=o+n*t.originX:t.y=o+n*t.originY},GridLayoutGroup.prototype.setAllChildPositionOffset=function(t){for(var e=0,i=this.layoutElements;e<i.length;e++){var n=i[e];if(0===t){var o=.5*this.width;n.x-=o}else{o=.5*this.height;n.y-=o}}},GridLayoutGroup.prototype.getStartOffset=function(t,e){var i=e+(0===t?this.paddingHorizontal():this.paddingVertical()),n=(0===t?this.width:this.height)-i,o=this.getAlignmentOnAxis(t);return(0===t?this._padding.x:this._padding.z)+n*o},GridLayoutGroup.prototype.getAlignmentOnAxis=function(t){return 0===t?this._alignmentType%3*.5:.5*Math.floor(this._alignmentType/3)},GridLayoutGroup.prototype.getCellCount=function(){var t=new Phaser.Math.Vector2;return this._constraint===a.FixedColumnCount?(t.x=this._constraintCount,this.layoutElements.length>=t.x&&(t.y=Math.floor(this.layoutElements.length/t.x)+(this.layoutElements.length%t.x>0?1:0))):this._constraint===a.FixedRowCount?(t.y=this._constraintCount,this.layoutElements.length>=t.y&&(t.x=Math.floor(this.layoutElements.length/t.y)+(this.layoutElements.length%t.y>0?1:0))):(t.x=Math.max(1,Math.floor((this.width-this.paddingHorizontal()+this._spacing.x+.001)/(this._cellSize.x+this._spacing.x))),t.y=Math.max(1,Math.floor((this.height-this.paddingVertical()+this._spacing.y+.001)/(this._cellSize.y+this._spacing.y)))),t},GridLayoutGroup.prototype.paddingHorizontal=function(){return this._padding.x+this._padding.y},GridLayoutGroup.prototype.paddingVertical=function(){return this._padding.z+this._padding.w},GridLayoutGroup.ClassName="gridLayoutGroup",GridLayoutGroup}(Phaser.GameObjects.Container);!function(t){t[t.UpperLeft=0]="UpperLeft",t[t.UpperCenter=1]="UpperCenter",t[t.UpperRight=2]="UpperRight",t[t.MiddleLeft=3]="MiddleLeft",t[t.MiddleCenter=4]="MiddleCenter",t[t.MiddleRight=5]="MiddleRight",t[t.LowerLeft=6]="LowerLeft",t[t.LowerCenter=7]="LowerCenter",t[t.LowerRight=8]="LowerRight"}(o||(o={})),function(t){t[t.UpperLeft=0]="UpperLeft",t[t.UpperRight=1]="UpperRight",t[t.LowerLeft=2]="LowerLeft",t[t.LowerRight=3]="LowerRight"}(r||(r={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(s||(s={})),function(t){t[t.Flexible=0]="Flexible",t[t.FixedColumnCount=1]="FixedColumnCount",t[t.FixedRowCount=2]="FixedRowCount"}(a||(a={}))},function(t,e,i){"use strict";i.r(e),i.d(e,"ControlFMediator",(function(){return l}));var n,o=i(261),r=i(110),s=i(2),a=i(122),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ControlFMediator(e,i,n){var o=t.call(this)||this;return o.mUIType=h.UIType.Tips,o.mScene=i,o.mLayerManager=e,o.world=n,o}return c(ControlFMediator,t),ControlFMediator.prototype.getName=function(){return""},ControlFMediator.prototype.getView=function(){},ControlFMediator.prototype.hide=function(){this.mShow=!1,this.mView&&this.mView.isShow()&&(this.world.roomManager.currentRoom&&this.world.roomManager.currentRoom.playerManager.actor&&this.world.roomManager.currentRoom.playerManager.actor.getState()!==a.d.WALK||(this.mView.off("control",this.handControlF,this),this.mView.destroy(),this.mView=null))},ControlFMediator.prototype.isSceneUI=function(){return!1},ControlFMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ControlFMediator.prototype.resize=function(){this.mView&&this.mView.resize()},ControlFMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||this.mShow||(this.mView=new o.ControlFPanel(this.mScene,this.world),this.mView.on("control",this.handControlF,this),this.mLayerManager.addToUILayer(this.mView),this.mView.show(e),t.prototype.show.call(this,e))},ControlFMediator.prototype.update=function(t){},ControlFMediator.prototype.destroy=function(){this.mView&&(this.mView.off("control",this.handControlF,this),this.mView.destroy(),this.mView=null),this.mScene=null,this.mLayerManager=null,t.prototype.destroy.call(this)},ControlFMediator.prototype.handControlF=function(){if(this.world&&this.world.connection){var t,e=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),i=e.content;t=(t=this.world.inputManager?this.world.inputManager.getKeyDowns():[]).concat(Phaser.Input.Keyboard.KeyCodes.F),i.keyCodes=t,this.world.connection.send(e)}},ControlFMediator.NAME="ControlFMediator",ControlFMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInMediator",(function(){return a}));var n,o=i(262),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function CutInMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,o}return s(CutInMediator,t),CutInMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||(this.mView=new o.CutInPanel(this.scene,this.world),this.mView.once("close",this.onCloseHandler,this),this.mView.show(t))},CutInMediator.prototype.onCloseHandler=function(){this.mView&&(this.mView.destroy(),this.mView=void 0)},CutInMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInMenuMediator",(function(){return h}));var n,o=i(263),r=i(264),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function CutInMenuMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return a(CutInMenuMediator,t),CutInMenuMediator.prototype.show=function(t){this.mView||(this.mView||(this.mView=new r.CutInMenuPanel(this.scene,this.world),this.mView.on("hide",this.onHideView,this),this.mView.on("rightButton",this.onRightButtonHandler,this),this.mView.on("openmed",this.openPanelMediator,this)),this.cutInMenu||(this.cutInMenu=new o.CutInMenu(this.world),this.cutInMenu.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show(t))},CutInMenuMediator.prototype.isSceneUI=function(){return!0},CutInMenuMediator.prototype.destroy=function(){this.cutInMenu&&(this.cutInMenu.destroy(),this.cutInMenu=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},CutInMenuMediator.prototype.onRightButtonHandler=function(t,e){this.cutInMenu.reqRightButton(t,e)},CutInMenuMediator.prototype.openPanelMediator=function(t,e){var i=this.world.uiManager;e?i.showMed(t,e):i.showMed(t)},CutInMenuMediator.prototype.onHideView=function(){this.destroy()},CutInMenuMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"DialogMediator",(function(){return h}));var n,o=i(266),r=i(267),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function DialogMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return a(DialogMediator,t),DialogMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new r.DialogPanel(this.scene,this.world),this.mView.on("querydialog",this.onQueryNextDialog,this),this.mView.on("hide",this.onHideHandler,this)),this.dialog||(this.dialog=new o.Dialog(this.world),this.dialog.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show(e),t.prototype.show.call(this,e))},DialogMediator.prototype.update=function(e){this.mView&&this.mView.isShow&&t.prototype.update.call(this,e)},DialogMediator.prototype.isSceneUI=function(){return!0},DialogMediator.prototype.destroy=function(){this.dialog&&(this.dialog.destroy(),this.dialog=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},DialogMediator.prototype.hide=function(){t.prototype.hide.call(this),this.destroy()},DialogMediator.prototype.onQueryNextDialog=function(t,e,i){this.dialog.queryNextDialog(t,e,i)},DialogMediator.prototype.onHideHandler=function(){this.hide(),this.destroy()},DialogMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"DragManager",(function(){return n}));var n=function(){function DragManager(t){}return DragManager.prototype.setDragProp=function(t){},DragManager}()},function(t,e,i){"use strict";i.r(e),i.d(e,"FriendInviteMediator",(function(){return c}));var n,o=i(268),r=i(2),s=i(110),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function FriendInviteMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mLayerManager=e,o.mScene=i,o}return h(FriendInviteMediator,t),FriendInviteMediator.prototype.show=function(t){if(this.mView)return this.mView.show(t),void this.mLayerManager.addToDialogLayer(this.mView);this.mView=new o.FriendInvitePanel(this.mScene,this.world),this.mView.on("hide",this.onHideHandler,this),this.mView.on("agree",this.onAgreeHandler,this),this.mView.on("targetUI",this.onTargetUIHandler,this),this.mView.show(t),this.mLayerManager.addToDialogLayer(this.mView)},FriendInviteMediator.prototype.onTargetUIHandler=function(t,e){if(this.world){var i=new s.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),n=i.content;n.uiId=t,n.componentId=e,this.world.connection.send(i),this.destroy()}},FriendInviteMediator.prototype.onAgreeHandler=function(){},FriendInviteMediator.prototype.onHideHandler=function(){this.destroy()},FriendInviteMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"FurniBagMediator",(function(){return c}));var n,o=i(270),r=i(269),s=i(2),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function FurniBagMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o.world&&o.world.roomManager&&o.world.roomManager.currentRoom?o.mScneType=o.world.roomManager.currentRoom.sceneType:o.mScneType=s.op_def.SceneTypeEnum.NORMAL_SCENE_TYPE,o}return h(FurniBagMediator,t),FurniBagMediator.prototype.show=function(){if(this.mView&&this.mView.isShow()||this.mShow)return this.layerManager.addToUILayer(this.mView),void this.addLisenter();this.mFurniBag||(this.mFurniBag=new r.FurniBag(this.world,this.mScneType),this.mFurniBag.register(),this.mFurniBag.on("packageCategory",this.onPackageCategoryHandler,this),this.mFurniBag.on("queryPackage",this.onQueryPackageHandler,this),this.mFurniBag.on("queryCommodityResource",this.onQueryCommodityResourceHandler,this),this.mFurniBag.on("queryResetAvatar",this.onResetAvatar,this),this.mFurniBag.on("avatarIDs",this.onDressAvatarIDS,this)),this.mView||(this.mView=new o.FurniBagPanel(this.scene,this.world,this.mScneType),this.mView.on("getCategories",this.onGetCategoriesHandler,this),this.mView.on("queryPackage",this.onQueryPackage,this),this.mView.on("close",this.onCloseHandler,this),this.mView.on("queryPropResource",this.onQueryPropResourceHandler,this),this.mView.on("seachPackage",this.onSeachPackageHandler,this),this.mView.on("addFurniToScene",this.onAddFurniHandler,this),this.mView.on("sellProps",this.onSellPropsHandler,this),this.mView.on("querySaveAvatar",this.onQuerySaveAvatar,this),this.mView.on("queryResetAvatar",this.onQueryResetAvatar,this),this.mView.on("queryDressAvatarIDS",this.queryDressAvatarIDS,this),this.mView.on("useprops",this.onUsePropsHandler,this)),this.mView.show(),this.layerManager.addToUILayer(this.mView),this.addLisenter()},FurniBagMediator.prototype.destroy=function(){this.mFurniBag&&(this.mFurniBag.destroy(),this.mFurniBag=void 0),t.prototype.destroy.call(this),this.removeLisenter()},Object.defineProperty(FurniBagMediator.prototype,"playerData",{get:function(){if(this.bag)return this.bag.playerData},enumerable:!1,configurable:!0}),Object.defineProperty(FurniBagMediator.prototype,"bag",{get:function(){if(this.world.user&&this.world.user.bag)return this.world.user.bag},enumerable:!1,configurable:!0}),FurniBagMediator.prototype.onCloseHandler=function(){this.destroy()},FurniBagMediator.prototype.addLisenter=function(){if(this.bag){var t=this.bag;t&&(t.on("syncfinish",this.onSyncFinishHandler,this),t.on("update",this.onUpdateHandler,this))}},FurniBagMediator.prototype.removeLisenter=function(){if(this.bag){var t=this.bag;t&&(t.off("syncfinish",this.onSyncFinishHandler,this),t.off("update",this.onUpdateHandler,this))}},FurniBagMediator.prototype.onSyncFinishHandler=function(){this.mView&&this.mView.queryRefreshPackage()},FurniBagMediator.prototype.onUpdateHandler=function(){this.mView&&this.mView.queryRefreshPackage(!0)},FurniBagMediator.prototype.onPackageCategoryHandler=function(t){this.mView&&this.mView.setCategories(t)},FurniBagMediator.prototype.onQueryCommodityResourceHandler=function(t){this.mView.setSelectedResource(t)},FurniBagMediator.prototype.onGetCategoriesHandler=function(t){this.mFurniBag&&this.mFurniBag.getCategories(t)},FurniBagMediator.prototype.onQueryPackageHandler=function(t){this.mView.setProp(t.items)},FurniBagMediator.prototype.onQueryPackage=function(t,e,i){if(this.playerData){var n=this.playerData.getItemsByCategory(t,e);this.mView.setProp(n,i)}},FurniBagMediator.prototype.onQueryPropResourceHandler=function(t){this.mFurniBag.queryCommodityResource(t.id)},FurniBagMediator.prototype.onQuerySaveAvatar=function(t){this.mFurniBag.querySaveAvatar(t)},FurniBagMediator.prototype.onQueryResetAvatar=function(t){this.mFurniBag.queryResetAvatar(t)},FurniBagMediator.prototype.onSeachPackageHandler=function(t,e){this.mFurniBag.seachPackage(t,e)},FurniBagMediator.prototype.onAddFurniHandler=function(t){this.mView.enableEdit?this.mFurniBag.enterEditAndSelectedSprite(t):this.mFurniBag.addFurniToScene(t),this.destroy()},FurniBagMediator.prototype.onSellPropsHandler=function(t,e,i){this.mFurniBag.sellProps(t,e,i)},FurniBagMediator.prototype.onUsePropsHandler=function(t,e){this.mFurniBag.useProps(t,e)},FurniBagMediator.prototype.onResetAvatar=function(t){this.mView.resetAvatar(t)},FurniBagMediator.prototype.onDressAvatarIDS=function(t){this.mView.setDressAvatarIds(t)},FurniBagMediator.prototype.queryDressAvatarIDS=function(){this.mFurniBag.queryDressAvatarItemIDs()},FurniBagMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"GMToolsMediator",(function(){return c}));var n,o=i(271),r=i(2),s=i(110),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function GMToolsMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return h(GMToolsMediator,t),GMToolsMediator.prototype.show=function(e){if(t.prototype.show.call(this,e),this.mView)return this.mView.show(e),void this.layerMgr.addToUILayer(this.mView);this.mView=new o.GMToolsPanel(this.scene,this.world),this.mView.on("close",this.onCloseHandler,this),this.mView.on("targetUI",this.onTargetUIHandler,this),this.mView.show(e),this.layerMgr.addToUILayer(this.mView)},GMToolsMediator.prototype.update=function(t){this.mView&&this.mView.show(t)},GMToolsMediator.prototype.hide=function(){this.destroy()},GMToolsMediator.prototype.onCloseHandler=function(){this.hide()},GMToolsMediator.prototype.onTargetUIHandler=function(t,e,i){if(this.world){var n=new s.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),o=n.content;o.uiId=t,o.componentId=e,o.strData=i,this.world.connection.send(n)}},GMToolsMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemDetailMediator",(function(){return l}));var n,o=i(276),r=i(2),s=i(110),a=i(121),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ItemDetailMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mScene=i,o.mUIType=h.UIType.Tips,o.mLayerManager=e,o}return c(ItemDetailMediator,t),ItemDetailMediator.prototype.isSceneUI=function(){return!1},ItemDetailMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ItemDetailMediator.prototype.show=function(t){this.mView&&this.isShow()||(this.mView=new o.ItemDetail(this.mScene,this.world),this.mView.show(t),this.mLayerManager.addToToolTipsLayer(this.mView),this.mScene.input.on("gameobjectdown",this.onBtnHandler,this),this.mShow=!0)},ItemDetailMediator.prototype.update=function(e){t.prototype.update.call(this,e)},ItemDetailMediator.prototype.hide=function(){this.mView&&(this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),this.mView.hide(),this.mView=null,t.prototype.hide.call(this))},ItemDetailMediator.prototype.destroy=function(){this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),t.prototype.destroy.call(this)},ItemDetailMediator.prototype.onBtnHandler=function(t,e){if(e&&e instanceof a.NinePatchButton){var i=this.mParam[0],n=new s.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),o=n.content;o.uiId=i.id,o.componentId=e.getBtnData().node.id,this.world.connection.send(n)}},ItemDetailMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemPopCardMediator",(function(){return a}));var n,o=i(277),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function ItemPopCardMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.world=n,o.layerManager=e,o}return s(ItemPopCardMediator,t),ItemPopCardMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||this.mShow||(this.mView=new o.ItemPopCardPanel(this.scene,this.world),this.mView.show(t),this.mView.on("close",this.onCloseHandler,this),this.layerManager.addToDialogLayer(this.mView))},ItemPopCardMediator.prototype.onCloseHandler=function(){this.mView&&(this.mView.hide(),this.mView=void 0)},ItemPopCardMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"LoginMediator",(function(){return l}));var n,o=i(0),r=i(278),s=i(279),a=i(135),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function LoginMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o}return c(LoginMediator,t),LoginMediator.prototype.show=function(){this.mView||(this.mView=new r.LoginPanel(this.layerManager.scene,this.world)),this.mView.show(),this.mView.on("fetchCode",this.onFetchCodeHandler,this),this.mView.on("login",this.onLoginHandler,this),this.mView.on("error",this.onLoginErrorHanler,this),this.layerManager.addToUILayer(this.mView)},LoginMediator.prototype.destroy=function(){t.prototype.destroy.call(this),this.verifiedPanel&&(this.verifiedPanel.destroy(),this.verifiedPanel=null)},LoginMediator.prototype.onFetchCodeHandler=function(t,e){this.world.httpService.requestPhoneCode(t,e)},LoginMediator.prototype.enterGame=function(t){var e=this;if(this.world.httpClock&&(this.world.httpClock.enable=!t),t)return this.destroy(),void this.world.enterGame();this.world.httpClock.allowLogin((function(){e.mView.setInputVisible(!0)})).then((function(t){t?(e.destroy(),e.world.enterGame()):e.mView.setInputVisible(!1)})).catch((function(t){e.onLoginErrorHanler("服务器错误，请与管管联系！","确定"),o.a.getInstance().error(t)}))},LoginMediator.prototype.onLoginHandler=function(t,e,i){var n=this;this.mView.setLoginEnable(!1),this.world.httpService.loginByPhoneCode(t,e,i).then((function(e){if(200===e.code||201===e.code){var i=e.data;n.world.account.setAccount(i),localStorage.setItem("accountphone",JSON.stringify({account:t}));var o=Object({debug:!0,api_root:"https://api-dev.tooqing.com/",osd:"https://osd-alpha.tooqing.com/",gateway:Object({host:"gdev.tooqing.com",port:11100,secure:!0}),game_id:"5cd8cf04cbcbf91a0afc3f96.5e410ba50681ad5557b4d6e9",virtual_world_id:"0"}).verified_enable;if(void 0!==o&&!1===o)return void n.enterGame(!o);i.hasIdentityInfo?n.enterGame(i.adult):(n.mView.setInputVisible(!1),n.onShowVerified())}else e.code>=400&&n.onLoginErrorHanler(e.msg||"服务器错误");n.mView.setLoginEnable(!0)}))},LoginMediator.prototype.onShowVerified=function(){this.verifiedPanel||(this.verifiedPanel=new s.VerifiedPanel(this.layerManager.scene,this.world)),this.verifiedPanel.isShow()||(this.verifiedPanel.show(),this.verifiedPanel.on("verified",this.onVerifiedHandler,this),this.verifiedPanel.on("error",this.onShowErrorHandler,this),this.layerManager.addToDialogLayer(this.verifiedPanel))},LoginMediator.prototype.onShowErrorHandler=function(t,e){var i=this;this.verifiedPanel.setVerifiedEnable(!1),new a.AlertView(this.layerManager.scene,this.world).setOKText(e||"重新输入").show({text:t||"[color=#F9361B]证件格式有误[/color]",title:"提示",callback:function(){i.verifiedPanel.setVerifiedEnable(!0)},btns:a.Buttons.Ok})},LoginMediator.prototype.onLoginErrorHanler=function(t,e){var i=this;this.mView.setInputVisible(!1),new a.AlertView(this.layerManager.scene,this.world).setOKText(e||"重新输入").show({text:t,title:"提示",callback:function(){i.mView.setInputVisible(!0)},btns:a.Buttons.Ok})},LoginMediator.prototype.onVerifiedHandler=function(t,e){var i=this;this.world.httpService.verified(t,e).then((function(t){var e=t.code;t.data;200===e||201===e||0===e?i.enterGame(!0):(10001===e||e>=400)&&(i.verifiedPanel.setVerifiedEnable(!1),i.onShowErrorHandler("[color=#F9361B]实名认证失败，身份证号码有误\n请如实进行实名认证！[/color]","重新认证"))}))},LoginMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxMediator",(function(){return l}));var n,o=i(280),r=i(121),s=i(2),a=i(110),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function MessageBoxMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mScene=i,o.mLayerManager=e,o.mUIType=h.UIType.Tips,o}return c(MessageBoxMediator,t),MessageBoxMediator.prototype.isSceneUI=function(){return!1},MessageBoxMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},MessageBoxMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new o.MessageBoxView(this.mScene,this.world),this.mView.show(e),this.mLayerManager.addToToolTipsLayer(this.mView),this.mScene.input.on("gameobjectdown",this.onBtnHandler,this),t.prototype.show.call(this,e))},MessageBoxMediator.prototype.update=function(e){t.prototype.update.call(this,e)},MessageBoxMediator.prototype.hide=function(){this.mShow=!1,this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),this.mView&&(this.mView.hide(),this.mView=null)},MessageBoxMediator.prototype.destroy=function(){this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),t.prototype.destroy.call(this)},MessageBoxMediator.prototype.onBtnHandler=function(t,e){if(e&&e instanceof r.NinePatchButton){var i=e.getBtnData();if(!i)return;var n=this.mParam[0],o=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),h=o.content;h.uiId=n.id,h.componentId=i.node.id,this.world.connection.send(o)}},MessageBoxMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessMarketingPlanMediator",(function(){return c}));var n,o=i(2),r=i(282),s=i(283),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicBusinessMarketingPlanMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return h(PicBusinessMarketingPlanMediator,t),PicBusinessMarketingPlanMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow?this.layerMgr.addToUILayer(this.mView):(this.mView||(this.mView=new s.default(this.scene,this.world),this.mView.on("queryplanmodels",this.query_MARKET_PLAN_MODELS_BY_TYPE,this),this.mView.on("querymarketplan",this.query_Equiped_MARKET_PLAN,this),this.mView.on("queryselectplan",this.query_SELECT_MARKET_PLAN,this),this.mView.on("hide",this.onHidePanel,this)),this.picPlan||(this.picPlan=new r.PicBusinessMarketingPlan(this.world),this.picPlan.on("onequipedplan",this.onEquiped_MARKET_PLAN,this),this.picPlan.on("onplanmodels",this.onMARKET_PLAN_MODELS_BY_TYPE,this),this.picPlan.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show())},PicBusinessMarketingPlanMediator.prototype.destroy=function(){this.picPlan&&(this.picPlan.destroy(),this.picPlan=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},Object.defineProperty(PicBusinessMarketingPlanMediator.prototype,"playerData",{get:function(){return this.bag?this.bag.playerData:null},enumerable:!1,configurable:!0}),Object.defineProperty(PicBusinessMarketingPlanMediator.prototype,"bag",{get:function(){var t=this.world.user;if(t&&t.bag)return t.bag},enumerable:!1,configurable:!0}),PicBusinessMarketingPlanMediator.prototype.onHidePanel=function(){this.destroy()},PicBusinessMarketingPlanMediator.prototype.query_MARKET_PLAN_MODELS_BY_TYPE=function(t){this.picPlan.query_MARKET_PLAN_MODELS_BY_TYPE(t)},PicBusinessMarketingPlanMediator.prototype.query_Equiped_MARKET_PLAN=function(){var t=this.world.uiManager.getMediator("PicaMainUIMediator").roomInfo.roomId;this.picPlan.query_Equiped_MARKET_PLAN(t)},PicBusinessMarketingPlanMediator.prototype.query_SELECT_MARKET_PLAN=function(t){var e=this.world.uiManager.getMediator("PicaMainUIMediator").roomInfo.roomId;this.picPlan.query_SELECT_MARKET_PLAN(e,t)},PicBusinessMarketingPlanMediator.prototype.onEquiped_MARKET_PLAN=function(t){this.mView.setEquipedPlan(t)},PicBusinessMarketingPlanMediator.prototype.onMARKET_PLAN_MODELS_BY_TYPE=function(t){if(this.mView.setPlanModels(t),t.marketPlan)for(var e=0,i=t.marketPlan;e<i.length;e++){var n=i[e].requirements;this.updateMaterials(n)}},PicBusinessMarketingPlanMediator.prototype.updateMaterials=function(t){if(this.playerData&&t)for(var e=0,i=t;e<i.length;e++){var n=i[e],r=this.playerData.getItemsCount(o.op_pkt_def.PKT_PackageType.PropPackage,n.id,n.subcategory);n.count=r}},PicBusinessMarketingPlanMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicBusinessStreetMediator",(function(){return h}));var n,o=i(294),r=i(291),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicBusinessStreetMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return a(PicBusinessStreetMediator,t),PicBusinessStreetMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow?this.layerMgr.addToUILayer(this.mView):(this.mView||(this.mView=new o.default(this.scene,this.world),this.mView.on("querymystore",this.queryMyStoreList,this),this.mView.on("queryallsaves",this.query_TAKE_ALL_STORE_SAVINGS,this),this.mView.on("querystreet",this.query_COMMERCIAL_STREET,this),this.mView.on("querymodels",this.query_INDUSTRY_MODELS,this),this.mView.on("querycreatestore",this.query_CREATE_STORE,this),this.mView.on("queryenterroom",this.query_ENTER_ROOM,this),this.mView.on("queryranklist",this.query_RANKING_LIST,this),this.mView.on("queryrankdetail",this.query_STORE_RANKING_DETAIL,this),this.mView.on("queryrankreward",this.query_STORE_RANKING_REWARD,this),this.mView.on("queryenterhistory",this.query_STORE_ENTER_HISTORY,this),this.mView.on("hide",this.onHidePanel,this)),this.picStreet||(this.picStreet=new r.PicBusinessStreet(this.world),this.picStreet.on("onmystore",this.onMyStoreList,this),this.picStreet.on("onstreet",this.onCOMMERCIAL_STREET,this),this.picStreet.on("onmodels",this.onINDUSTRY_MODELS,this),this.picStreet.on("onranklist",this.onSTORE_RANKING_LIST,this),this.picStreet.on("onrankdetail",this.onSTORE_RANKING_DETAIL,this),this.picStreet.on("onrankreward",this.onSTORE_RANKING_REWARD,this),this.picStreet.on("onenterhistory",this.onSTORE_ENTER_HISTORY,this),this.picStreet.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show())},PicBusinessStreetMediator.prototype.destroy=function(){this.picStreet&&(this.picStreet.destroy(),this.picStreet=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},PicBusinessStreetMediator.prototype.onHidePanel=function(){this.destroy()},PicBusinessStreetMediator.prototype.queryMyStoreList=function(){this.picStreet.query_My_STORE()},PicBusinessStreetMediator.prototype.query_TAKE_ALL_STORE_SAVINGS=function(){this.picStreet.query_TAKE_ALL_STORE_SAVINGS()},PicBusinessStreetMediator.prototype.query_COMMERCIAL_STREET=function(t,e){this.picStreet.query_COMMERCIAL_STREET(t,e)},PicBusinessStreetMediator.prototype.query_INDUSTRY_MODELS=function(){this.picStreet.query_INDUSTRY_MODELS()},PicBusinessStreetMediator.prototype.query_CREATE_STORE=function(t){this.picStreet.query_CREATE_STORE(t)},PicBusinessStreetMediator.prototype.query_ENTER_ROOM=function(t,e){this.picStreet.query_ENTER_ROOM(t,e)},PicBusinessStreetMediator.prototype.query_RANKING_LIST=function(){this.picStreet.query_RANKING_LIST()},PicBusinessStreetMediator.prototype.query_STORE_RANKING_DETAIL=function(t,e){this.picStreet.query_STORE_RANKING_DETAIL(t,e)},PicBusinessStreetMediator.prototype.query_STORE_RANKING_REWARD=function(t,e){this.picStreet.query_STORE_RANKING_REWARD(t,e)},PicBusinessStreetMediator.prototype.query_STORE_ENTER_HISTORY=function(){this.picStreet.query_STORE_ENTER_HISTORY()},PicBusinessStreetMediator.prototype.onMyStoreList=function(t){this.mView.setMyStore(t)},PicBusinessStreetMediator.prototype.onCOMMERCIAL_STREET=function(t){this.mView.setCommercialStreet(t)},PicBusinessStreetMediator.prototype.onINDUSTRY_MODELS=function(t){this.mView.setIndustryModels(t)},PicBusinessStreetMediator.prototype.onSTORE_RANKING_LIST=function(t){this.mView.setStoreRankingList(t)},PicBusinessStreetMediator.prototype.onSTORE_RANKING_DETAIL=function(t){this.mView.setStoreRankingDetial(t)},PicBusinessStreetMediator.prototype.onSTORE_RANKING_REWARD=function(t){this.mView.setStoreRankingReward(t)},PicBusinessStreetMediator.prototype.onSTORE_ENTER_HISTORY=function(t){this.mView.setEnterHistory(t)},PicBusinessStreetMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicHouseMediator",(function(){return h}));var n,o=i(297),r=i(295),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicHouseMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return a(PicHouseMediator,t),PicHouseMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow?this.layerManager.addToUILayer(this.mView):(this.picHouse||(this.picHouse=new r.PicHouse(this.world),this.picHouse.on("roominfo",this.onRoomInfoHandler,this),this.picHouse.on("refurbish",this.on_REFURBISH_REQUIREMENTS,this),this.picHouse.register()),this.mView||(this.mView=new o.PicHousePanel(this.scene,this.world),this.mView.on("hide",this.onHideHandler,this),this.mView.on("scenedecorate",this.onSendEnterDecorate,this),this.mView.on("queryrequirements",this.query_REFURBISH_REQUIREMENTS,this),this.mView.on("queryrefurbish",this.query_ROOM_REFURBISH,this)),this.mView.show(),this.layerManager.addToUILayer(this.mView),this.queryRoomInfoHandler())},PicHouseMediator.prototype.hide=function(){t.prototype.hide.call(this),this.layerManager.removeToUILayer(this.mView)},PicHouseMediator.prototype.getView=function(){return this.mView},PicHouseMediator.prototype.destroy=function(){this.picHouse&&(this.picHouse.destroy(),this.picHouse=void 0),t.prototype.destroy.call(this)},PicHouseMediator.prototype.onRoomInfoHandler=function(t){var e=this.world.uiManager.getMediator("PicaMainUIMediator");this.mView.setRoomInfoData(t,e.isSelfRoom)},PicHouseMediator.prototype.queryRoomInfoHandler=function(){var t=this.world.uiManager.getMediator("PicaMainUIMediator").roomInfo;t&&this.picHouse.queryRoomInfo(t.roomId)},PicHouseMediator.prototype.query_REFURBISH_REQUIREMENTS=function(t){this.picHouse.query_REFURBISH_REQUIREMENTS(t)},PicHouseMediator.prototype.query_ROOM_REFURBISH=function(t){this.picHouse.query_ROOM_REFURBISH(t)},PicHouseMediator.prototype.on_REFURBISH_REQUIREMENTS=function(t){this.mView.on_REFURBISH_REQUIREMENTS(t)},PicHouseMediator.prototype.onHideHandler=function(){this.destroy()},PicHouseMediator.prototype.onSendEnterDecorate=function(){this.picHouse.sendEnterDecorate()},PicHouseMediator}(s.BaseMediator)},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"PicOpenPartyMediator",(function(){return h}));var n,o=i(109),r=i(301),s=i(299),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicOpenPartyMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return a(PicOpenPartyMediator,t),PicOpenPartyMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new r.PicOpenPartyPanel(this.scene,this.world),this.mView.on("close",this.onCloseHandler,this)),this.picOrder||(this.picOrder=new s.PicOpenParty(this.world),this.picOrder.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show())},PicOpenPartyMediator.prototype.isSceneUI=function(){return!0},PicOpenPartyMediator.prototype.destroy=function(){this.picOrder&&(this.picOrder.destroy(),this.picOrder=void 0),t.prototype.destroy.call(this)},PicOpenPartyMediator.prototype.onCloseHandler=function(){this.destroy()},PicOpenPartyMediator}(o.BaseMediator)},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"PicOrderMediator",(function(){return c}));var n,o=i(2),r=i(303),s=i(302),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicOrderMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return h(PicOrderMediator,t),PicOrderMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new r.PicOrderPanel(this.scene,this.world),this.mView.on("questlist",this.query_ORDER_LIST,this),this.mView.on("changeorder",this.query_CHANGE_ORDER_STAGE,this),this.mView.on("questprogress",this.query_PLAYER_PROGRESS,this),this.mView.on("questreward",this.query_PLAYER_PROGRESS_REWARD,this),this.mView.on("hide",this.onHideView,this)),this.picOrder||(this.picOrder=new s.PicOrder(this.world),this.picOrder.on("questlist",this.on_ORDER_LIST,this),this.picOrder.on("progresslist",this.on_PLAYER_PROGRESS,this),this.picOrder.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show())},PicOrderMediator.prototype.isSceneUI=function(){return!0},PicOrderMediator.prototype.destroy=function(){this.picOrder&&(this.picOrder.destroy(),this.picOrder=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},Object.defineProperty(PicOrderMediator.prototype,"playerData",{get:function(){var t=this.world.user;if(t&&t.bag)return t.bag.playerData},enumerable:!1,configurable:!0}),PicOrderMediator.prototype.query_ORDER_LIST=function(){this.picOrder.query_ORDER_LIST()},PicOrderMediator.prototype.query_CHANGE_ORDER_STAGE=function(t,e){this.picOrder.query_CHANGE_ORDER_STAGE(t,e)},PicOrderMediator.prototype.query_PLAYER_PROGRESS=function(){this.picOrder.query_PLAYER_PROGRESS()},PicOrderMediator.prototype.query_PLAYER_PROGRESS_REWARD=function(t){this.picOrder.query_PLAYER_PROGRESS_REWARD(t)},PicOrderMediator.prototype.on_ORDER_LIST=function(t){for(var e=0,i=t.orders;e<i.length;e++){var n=i[e].targets;if(n)for(var r=0,s=n;r<s.length;r++){var a=s[r],h=this.playerData.getItemsCount(o.op_pkt_def.PKT_PackageType.PropPackage,a.id,a.subcategory);a.count=h}}this.mView.setOrderDataList(t)},PicOrderMediator.prototype.on_PLAYER_PROGRESS=function(t){this.mView.setOrderProgress(t)},PicOrderMediator.prototype.onHideView=function(){this.destroy()},PicOrderMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicPartyListMediator",(function(){return h}));var n,o=i(109),r=i(304),s=i(305),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicPartyListMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return a(PicPartyListMediator,t),PicPartyListMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new s.PicPartyListPanel(this.scene,this.world),this.mView.on("close",this.onCloseHandler,this)),this.picList||(this.picList=new r.PicPartyList(this.world),this.picList.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show())},PicPartyListMediator.prototype.isSceneUI=function(){return!0},PicPartyListMediator.prototype.destroy=function(){t.prototype.destroy.call(this),this.picList&&(this.picList.destroy(),this.picList=void 0)},PicPartyListMediator.prototype.onCloseHandler=function(){this.destroy()},PicPartyListMediator}(o.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicPropFunConfig",(function(){return n}));var n=function n(){}},function(t,e,i){"use strict";i.r(e),i.d(e,"PicPropFunMediator",(function(){return a}));var n,o=i(307),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicPropFunMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return s(PicPropFunMediator,t),PicPropFunMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.PicPropFunPanel(this.scene,this.world),this.mView.on("close",this.onCloseHandler,this)),this.mView.show(this.mParam)),this.layerManager.addToUILayer(this.mView)},PicPropFunMediator.prototype.getView=function(){return this.mView},PicPropFunMediator.prototype.onCloseHandler=function(){this.destroy()},PicPropFunMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicRoomUpgradeMediator",(function(){return h}));var n,o=i(309),r=i(308),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicRoomUpgradeMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return a(PicRoomUpgradeMediator,t),PicRoomUpgradeMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.picRoom||(this.picRoom=new r.PicRoomUpgrade(this.world),this.picRoom.register()),this.mView||(this.mView=new o.PicRoomUpgradePanel(this.scene,this.world),this.mView.on("querytargetui",this.onQueryTargetUI,this)),this.mView.show(this.mParam)),this.layerManager.addToUILayer(this.mView)},PicRoomUpgradeMediator.prototype.hide=function(){t.prototype.hide.call(this),this.layerManager.removeToUILayer(this.mView)},PicRoomUpgradeMediator.prototype.getView=function(){return this.mView},PicRoomUpgradeMediator.prototype.destroy=function(){this.picRoom&&(this.picRoom.destroy(),this.picRoom=void 0),t.prototype.destroy.call(this)},PicRoomUpgradeMediator.prototype.onQueryTargetUI=function(t){this.picRoom.queryTargetUI(t),this.destroy()},PicRoomUpgradeMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicWorkMediator",(function(){return h}));var n,o=i(311),r=i(310),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicWorkMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return a(PicWorkMediator,t),PicWorkMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.PicWorkPanel(this.scene,this.world),this.mView.on("questlist",this.query_ORDER_LIST,this),this.mView.on("questwork",this.query_WORK_ON_JOB,this),this.mView.on("hide",this.onHideView,this)),this.picWork||(this.picWork=new r.PicWork(this.world),this.picWork.on("questlist",this.on_ORDER_LIST,this),this.picWork.on("updateplayer",this.onUpdatePlayerInfo,this),this.picWork.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show())},PicWorkMediator.prototype.isSceneUI=function(){return!0},PicWorkMediator.prototype.destroy=function(){this.picWork&&(this.picWork.destroy(),this.picWork=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},Object.defineProperty(PicWorkMediator.prototype,"playerInfo",{get:function(){if(!this.mPlayerInfo){var t=this.world.uiManager.getMediator("PicaMainUIMediator");t&&(this.mPlayerInfo=t.playerInfo)}return this.mPlayerInfo},enumerable:!1,configurable:!0}),PicWorkMediator.prototype.query_ORDER_LIST=function(){this.picWork.query_JOB_LIST()},PicWorkMediator.prototype.query_WORK_ON_JOB=function(t){this.picWork.query_WORK_ON_JOB(t)},PicWorkMediator.prototype.on_ORDER_LIST=function(t){this.mView.setWorkDataList(t),this.onUpdatePlayerInfo(this.playerInfo)},PicWorkMediator.prototype.onUpdatePlayerInfo=function(t){this.mView&&this.mView.setProgressData(t.energy,t.workChance)},PicWorkMediator.prototype.onHideView=function(){this.destroy()},PicWorkMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMessageBoxMediator",(function(){return c}));var n,o=i(312),r=i(2),s=i(110),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicaMessageBoxMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return h(PicaMessageBoxMediator,t),PicaMessageBoxMediator.prototype.show=function(t){this.mParam=t,this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.PicaMessageBoxPanel(this.scene,this.world),this.mView.on("click",this.onClickHandler,this)),this.mView.show(t),this.layerManager.addToDialogLayer(this.mView))},PicaMessageBoxMediator.prototype.hide=function(){t.prototype.hide.call(this),t.prototype.destroy.call(this)},PicaMessageBoxMediator.prototype.onClickHandler=function(t){if(t.local)t.clickhandler&&t.clickhandler.run(),this.hide();else{var e=this.mParam[0],i=new s.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),n=i.content;n.uiId=e.id,n.componentId=t.node.id,this.world.connection.send(i)}},PicaMessageBoxMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNavigateMediator",(function(){return l}));var n,o=i(314),r=i(148),s=i(313),a=i(166),h=i(109),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicaNavigateMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return c(PicaNavigateMediator,t),PicaNavigateMediator.prototype.show=function(){if(this.mView&&this.mView.isShow()||this.mShow)return this.mView.show(),void this.layerManager.addToUILayer(this.mView);this.mView||(this.mView=new o.PicaNavigatePanel(this.scene,this.world),this.mView.on("showPanel",this.onShowPanelHandler,this),this.mView.on("close",this.onCloseHandler,this),this.mView.on("goHome",this.onGomeHomeHandler,this)),this.picaNa||(this.picaNa=new s.PicaNavigate(this.world)),this.mView.show(),this.layerManager.addToUILayer(this.mView)},PicaNavigateMediator.prototype.isSceneUI=function(){return!1},PicaNavigateMediator.prototype.destroy=function(){this.picaNa&&(this.picaNa.destroy(),this.picaNa=void 0),t.prototype.destroy.call(this)},PicaNavigateMediator.prototype.onCloseHandler=function(){if(this.world){var t=this.world.uiManager;t.showExistMed(r.PicaChatMediator.name,""),t.showExistMed(a.PicHandheldMediator.name,""),this.destroy()}},PicaNavigateMediator.prototype.onShowPanelHandler=function(t,e){if(t&&this.world){var i=this.world.uiManager;e?i.showMed(t,e):i.showMed(t)}},PicaNavigateMediator.prototype.onGomeHomeHandler=function(){this.picaNa.queryGOHomeHandler()},PicaNavigateMediator.NAME="PicaNavigateMediator",PicaNavigateMediator}(h.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNoticeMediator",(function(){return a}));var n,o=i(315),r=i(109),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PicaNoticeMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.panelQueue=[],o.world=n,o}return s(PicaNoticeMediator,t),PicaNoticeMediator.prototype.show=function(t){var e=new o.PicaNoticePanel(this.scene,this.world);if(e.once("close",this.onCloseHandler,this),this.mView){var i={param:t,view:e};this.panelQueue.push(i)}else this.mView=e,this.mView.show(t)},PicaNoticeMediator.prototype.onCloseHandler=function(){if(this.mView&&(this.mView.destroy(),this.mView=void 0),this.panelQueue.length>0){var t=this.panelQueue.shift();t.view.show(t.param)}},PicaNoticeMediator}(r.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaRoomListMediator",(function(){return c}));var n,o=i(316),r=i(317),s=i(0),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicaRoomListMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return h(PicaRoomListMediator,t),PicaRoomListMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.roomList=new r.RoomList(this.world),this.roomList.register(),this.roomList.on("myRoomList",this.updateMyRoomListHandler,this),this.roomList.on("roomList",this.updateRoomListHandler,this),this.roomList.on("enterRoomResult",this.onEnterRoomResuleHandler,this),this.mView||(this.mView=new o.PicaRoomListPanel(this.scene,this.world)),this.mView.on("close",this.onCloseHandler,this),this.mView.on("getRoomList",this.onGetRoomListHandler,this),this.mView.on("getMyRoomList",this.onGetMyRoomListHandler,this),this.mView.on("enterRoom",this.onEnterRoomHandler,this),this.mView.show()),this.layerManager.addToUILayer(this.mView)},PicaRoomListMediator.prototype.getView=function(){return this.mView},PicaRoomListMediator.prototype.destroy=function(){this.roomList&&this.roomList.destroy(),this.mView&&(this.mView.destroy(),this.mView=void 0),t.prototype.destroy.call(this)},PicaRoomListMediator.prototype.onCloseHandler=function(){this.destroy()},PicaRoomListMediator.prototype.updateRoomListHandler=function(t){this.mView&&this.mView.updateRoomList(t)},PicaRoomListMediator.prototype.updateMyRoomListHandler=function(t){this.mView&&this.mView.updateMyRoomList(t)},PicaRoomListMediator.prototype.onEnterRoomResuleHandler=function(t){s.a.getInstance().log("enter room result:",t)},PicaRoomListMediator.prototype.onGetRoomListHandler=function(){this.roomList&&this.roomList.sendGetRoomList()},PicaRoomListMediator.prototype.onGetMyRoomListHandler=function(){this.roomList&&this.roomList.sendMyHistory()},PicaRoomListMediator.prototype.onEnterRoomHandler=function(t,e){this.roomList&&this.roomList.sendEnterRoom(t,e)},PicaRoomListMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"TaskMediator",(function(){return h}));var n,o=i(320),r=i(321),s=i(109),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function TaskMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return a(TaskMediator,t),TaskMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new r.TaskPanel(this.scene,this.world),this.mView.on("hide",this.onHideView,this),this.mView.on("questlist",this.onQueryQuestList,this),this.mView.on("questdetail",this.onQueryQuestDetail,this),this.mView.on("submitquest",this.onQuerySubmitQuest,this)),this.task||(this.task=new o.Task(this.world),this.task.register(),this.task.on("questlist",this.onRetQuestList,this),this.task.on("questdetail",this.onRetQuestDetail,this)),this.layerMgr.addToUILayer(this.mView),this.mView.show())},TaskMediator.prototype.isSceneUI=function(){return!0},TaskMediator.prototype.destroy=function(){this.task&&(this.task.destroy(),this.task=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},TaskMediator.prototype.onHideView=function(){this.destroy()},TaskMediator.prototype.onQueryQuestList=function(){this.task.queryQuestList()},TaskMediator.prototype.onQueryQuestDetail=function(t){this.task.queryQuestDetail(t)},TaskMediator.prototype.onQuerySubmitQuest=function(t){this.task.querySubmitQuest(t)},TaskMediator.prototype.onRetQuestList=function(t){this.mView.setTaskDatas(t)},TaskMediator.prototype.onRetQuestDetail=function(t){this.mView.setTaskDetail(t)},TaskMediator}(s.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserMenuMediator",(function(){return c}));var n,o=i(110),r=i(2),s=i(119),a=i(109),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function UserMenuMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mLayerManager=e,o.mScene=i,o.mUIType=a.UIType.Tips,o}return h(UserMenuMediator,t),UserMenuMediator.prototype.getView=function(){return this.mView},UserMenuMediator.prototype.hide=function(){this.mShow=!1,this.world.emitter.off(s.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView&&(this.mView.off("menuClick",this.onClickMenuHandler,this),this.mView.hide(),this.mView=null)},UserMenuMediator.prototype.isSceneUI=function(){return!1},UserMenuMediator.prototype.isShow=function(){return!1},UserMenuMediator.prototype.resize=function(){this.mView&&this.mView.resize()},UserMenuMediator.prototype.show=function(t){},UserMenuMediator.prototype.update=function(t){this.mView&&this.mView.update(t[0])},UserMenuMediator.prototype.destroy=function(){this.mView&&(this.mView.destroy(),this.mView=null),this.mScene=null},UserMenuMediator.prototype.onClickMenuHandler=function(t){if(this.mView){var e=this.mView.getData("data");if(t&&e&&this.world&&this.world.connection)if(this.hide(),t.platformid)"关注"===t.text?this.world.httpService.follow(t.platformid):"取消关注"===t.text&&this.world.httpService.unfollow(t.platformid);else{var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),n=i.content;n.uiId=e.id,n.componentId=t.id,this.world.connection.send(i)}}},UserMenuMediator.prototype.onClosePanel=function(t,e){this.hide()},UserMenuMediator}(a.BaseMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserMenuPanel",(function(){return c}));var n,o=i(112),r=i(111),s=i(324),a=i(117),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function UserMenuPanel(e,i){var n=t.call(this,e,i)||this;return n.mMenus=[],n.disInteractive(),n.scale=2,n}return h(UserMenuPanel,t),UserMenuPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.scene&&(this.setData("data",e),this.addItem(e),this.x=this.scene.input.activePointer.x+32,this.y=this.scene.input.activePointer.y+32,this.scaleX=this.scaleY=this.scale)},UserMenuPanel.prototype.hide=function(){this.disInteractive(),this.clear(),t.prototype.hide.call(this)},UserMenuPanel.prototype.addListen=function(){this.mInitialized&&this.scene.input.on("gameobjectdown",this.onClickMenu,this)},UserMenuPanel.prototype.removeListen=function(){this.mInitialized&&this.scene.input.off("gameobjectdown",this.onClickMenu,this)},UserMenuPanel.prototype.setSize=function(e,i){return t.prototype.setSize.call(this,e,i),this.mBackground&&this.mBackground.resize(e,i),this},UserMenuPanel.prototype.destroy=function(){if(this.mBackground&&this.mBackground.destroy(),this.mMenus){for(var e=this.mMenus.length,i=0;i<e;i++){var n=this.mMenus[i];n||(n.destroy(!0),n=null)}this.mMenus=[]}t.prototype.destroy.call(this)},UserMenuPanel.prototype.addItem=function(t){if(this.mInitialized){this.clear();for(var e=t.menuItem,i=0;i<e.length;i++){var n=this.appendItem(e[i],0,32*i);this.add(n),this.mMenus.push(n)}this.setSize(70,30*this.mMenus.length);var o=this.mWorld.roomManager.currentRoom.playerManager.actor.model;if(o){var r=t.actors[0];if(r&&o.platformId!==r.platformId){var s={text:"关注",platformid:r.platformId},a=this.appendItem({text:"关注",node:void 0},0,31*this.mMenus.length);a.setData("node",s),this.add(a),this.mMenus.push(a),this.mWorld.httpService.checkFollowed([r.platformId]).then((function(t){200===t.code&&(t.data.length>0&&a.setText("取消关注"),s.text=a.getText(),a.setData("node",s))}))}}}},UserMenuPanel.prototype.preload=function(){this.scene.load.image(r.b.getName(),r.b.getPNG()),this.scene.load.image(r.d.getName(),r.d.getPNG()),this.scene.load.image("usermenu_arrow",r.i.getRes("ui/usermenu/arrow.png")),this.scene.load.atlas(r.h.getName(),r.h.getPNG(),r.h.getJSON()),t.prototype.preload.call(this)},UserMenuPanel.prototype.init=function(){this.mBackground=new a.NinePatch(this.scene,0,0,70,30,r.d.getName(),null,r.d.getConfig()),this.add(this.mBackground),t.prototype.init.call(this),this.mShowData&&this.addItem(this.showData)},UserMenuPanel.prototype.appendItem=function(t,e,i){var n=new s.MenuItem(this.scene,0,0,59,29,r.h.getName(),t.text,r.h.getConfig());if(n.x=e,n.y=i-(n.height>>1),n.setData("node",t.node),t.child&&t.child.length>0)for(var o=t.child,a=0,h=o.length;a<h;a++){var c=o[a],l=this.appendItem(c,73,31*a-15.5+31*this.mMenus.length);n.appendItem(l)}return n},UserMenuPanel.prototype.onClickMenu=function(t,e){e instanceof s.MenuItem&&(e.menus.length>0?e.show():this.emit("menuClick",e.getData("node")))},UserMenuPanel.prototype.resizeBackground=function(t,e){this.mBackground&&this.mBackground.resize(t,e)},UserMenuPanel.prototype.clear=function(){for(var t=0,e=this.mMenus;t<e.length;t++){var i=e[t];this.remove(i),i.off("pointerup",this.onClickMenu),i.destroy()}this.mMenus.length=0},UserMenuPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PopUpTextUI",(function(){return s}));var n,o=i(112),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function PopUpTextUI(e,i){var n=t.call(this,i,e)||this;return n.mWorld=e,n.scene=i,n.disInteractive(),n}return r(PopUpTextUI,t),PopUpTextUI.prototype.show=function(e){var i=this,n=this.mWorld.getSize(),o=this.scene.make.text({x:0,y:0,text:e,style:{fill:"#FF0000",fontSize:20}});this.add(o),this.setSize(o.width,o.height),this.setPosition(n.width-this.width>>1,n.height>>1),this.scene.tweens.add({targets:this,duration:1e3,ease:"Linear",props:{y:{value:(n.height>>1)-80},alhpa:{value:0}},onComplete:function(t,e,n){i.destroy()},onCompleteParams:[this]}),t.prototype.show.call(this,e)},PopUpTextUI.prototype.resize=function(){if(this.mInitialized){var t=this.mWorld.getSize();this.x=t.width-this.width>>1}},PopUpTextUI.prototype.destroy=function(){t.prototype.destroy.call(this)},PopUpTextUI}(o.BasePanel)},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"TopMediator",(function(){return l}));var n,o=i(134),r=i(327),s=i(147),a=i(110),h=i(2),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function TopMediator(e,i){return t.call(this,e,i)||this}return c(TopMediator,t),TopMediator.prototype.preRefreshBtn=function(t){this.refreshMedList||(this.refreshMedList=[]),this.refreshMedList.push(t)},TopMediator.prototype.refreshBtn=function(t,e){var i=this,n=this.mView;switch(t){case s.RankMediator.NAME:e?n.addBtn({key:t,bgResKey:"baseView",bgTextures:["btnGroup_red_normal.png","btnGroup_red_light.png","btnGroup_red_select.png"],iconResKey:"baseView",iconTexture:"btnGroup_rank_icon.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json",callBack:function(){var e=i.world.uiManager.getMediator(t);if(e){var n=e.getParam();e.show(n)}}}):n.removeBtn(t);break;case"EnterDecorate":case"SaveDecorate":e?n.addBtn({key:t,bgResKey:"baseView",bgTextures:["btnGroup_red_normal.png","btnGroup_red_light.png","btnGroup_red_select.png"],iconResKey:"baseView",iconTexture:"btnGroup_rank_icon.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json",callBack:function(){i.onEnterDecorate()}}):n.removeBtn(t)}},TopMediator.prototype.tweenView=function(t){this.mView&&this.mView.tweenView(t)},TopMediator.prototype.show=function(e){var i=this;this.mView&&this.isShow()||(this.mView=new r.TopBtnGroup(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e),this.refreshMedList&&this.refreshMedList.forEach((function(t){i.refreshBtn(t,!0)})))},TopMediator.prototype.hide=function(){var t=this;this.mShow=!1,this.refreshMedList&&this.refreshMedList.forEach((function(e){t.refreshBtn(e,!1)})),this.mView&&(this.mView.hide(),this.mView=null)},TopMediator.prototype.addBtn=function(t){this.mView&&this.mView.addBtn(t)},TopMediator.prototype.onEnterDecorate=function(){if(this.world&&this.world.connection){var t=new a.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER);this.world.connection.send(t)}},TopMediator.prototype.onSaveDecorate=function(){if(this.world&&this.world.connection){var t=new a.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_SAVE);this.world.connection.send(t)}},TopMediator.NAME="TopMediator",TopMediator}(o.BaseFaceMediator)},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"LoadingView",(function(){return s}));var n,o=i(112),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function LoadingView(e,i){var n=t.call(this,e,i)||this;return n.key="loading_ui",n.disInteractive(),n}return r(LoadingView,t),LoadingView.prototype.show=function(t){},LoadingView.prototype.preload=function(){this.addAtlas(this.key,"pica_alert/pica_alert.png","pica_alert/pica_alert.json"),t.prototype.preload.call(this)},LoadingView.prototype.init=function(){t.prototype.init.call(this)},LoadingView}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxUI",(function(){return r})),i.d(e,"MessageBtn",(function(){return s}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),r=function(t){function MessageBoxUI(e,i){var n=t.call(this,e)||this;return n.mScene=e,n.mConfig=i,n.init(),n}return o(MessageBoxUI,t),MessageBoxUI.prototype.selectCall=function(t){this.mtxt.text=t.text,this.mtxt.x=this.mConfig.wid-this.mtxt.width>>1,this.mtxt.y=this.mConfig.hei-this.mtxt.height>>1,this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)},MessageBoxUI.prototype.init=function(){var t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},MessageBoxUI.prototype.onLoadCompleteHandler=function(){var t=this.mConfig.resKey,e=this.mConfig.resBtn;if(this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2,this.mBg.y=this.mConfig.hei/2,this.mBg.setSize(this.mConfig.wid,this.mConfig.hei),this.mBtnList=[],this.mConfig.btnData)for(var i=this.mConfig.btnData.length,n=void 0,o=0;o<i;o++)n=new s(this.mScene,this,t,e,this.mConfig.btnWid,this.mConfig.btnHei),this.mBtnList.push(n);this.mtxt=this.mScene.make.text({x:0,y:0,style:{fill:"#F7EDED",fontSize:18}},!1),this.add(this.mBg),this.add(this.mtxt)},MessageBoxUI}(Phaser.GameObjects.Container),s=function(t){function MessageBtn(e,i,n,o,r,s){var a=t.call(this,e)||this;return a.messageBoxUI=i,a.mBtn=e.make.image(void 0,!1),a.mBtn.setTexture(n,o),a.mText=a.scene.make.text({x:-r>>1,y:-s>>1,style:{fill:"#F7EDED",fontSize:18}},!1),a.add(a.mBtn),a.add(a.mText),a.setSize(r,s),a.setInteractive(),a.on("pointerdown",a.selectHandler,a),a}return o(MessageBtn,t),Object.defineProperty(MessageBtn.prototype,"itemData",{get:function(){return this.mData},set:function(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width/2+(this.width-this.mText.width>>1),this.mText.y=-this.height/2+(this.height-this.mText.height>>1)},enumerable:!1,configurable:!0}),MessageBtn.prototype.destroy=function(){this.mText.destroy(!0),this.mBtn.destroy(!0),this.mData=null,t.prototype.destroy.call(this,!0)},MessageBtn.prototype.selectHandler=function(){this.addTween(this.mBtn),this.messageBoxUI.selectCall(this.itemData)},MessageBtn.prototype.addTween=function(t){this.scene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=t.scaleY=1},MessageBtn}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"TabButton",(function(){return s}));var n,o=i(121),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function TabButton(e,i,n,o,r,s,a,h,c,l){var p=t.call(this,e,i,n,o,r,s,a,h,c,l)||this;return p.setInteractive(new Phaser.Geom.Rectangle(0,0,o,r),Phaser.Geom.Rectangle.Contains),p}return r(TabButton,t),TabButton.prototype.onPointerUp=function(){},TabButton}(o.NinePatchButton)},function(t,e,i){"use strict";i.r(e),i.d(e,"LoadingView",(function(){return n}));var n=function(){function LoadingView(t){this.mScene=t,this.mShowing=!1,this.createPanel()}return LoadingView.prototype.setFollow=function(t,e,i){},LoadingView.prototype.isShow=function(){return this.mShowing},LoadingView.prototype.show=function(t){this.mTween=this.mScene.tweens.add({targets:this.mBg,duration:2e6,ease:"Linear",props:{rotation:360}})},LoadingView.prototype.update=function(t){},LoadingView.prototype.hide=function(){this.mTween&&(this.mTween.stop(),this.mTween.remove())},LoadingView.prototype.tweenExpand=function(t){},LoadingView.prototype.resize=function(){},LoadingView.prototype.destroy=function(){this.mBg&&this.mBg.destroy()},LoadingView.prototype.createPanel=function(){var t=this.mScene.game.scale.gameSize;this.mBg=this.mScene.add.sprite(t.width>>1,t.height>>1,"stars"),this.mBg.scaleX=this.mBg.scaleY=1.3},LoadingView}()},function(t,e){},function(t,e,i){"use strict";i.d(e,"a",(function(){return R}));var n,o=i(392),r=i(329),s=i(328),a=i(138),h=i(2),c=i(118),l=i(110),p=i(131),d=i(169),m=i(0),u=i(137),f=i(178),y=i(152),g=i(126),_=i(122),P=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),v=h.op_def.NodeType,w=function(t){function DecorateElementManager(e){return t.call(this,e)||this}return P(DecorateElementManager,t),DecorateElementManager.prototype.addMap=function(t){var e=t.displayInfo;if(e&&(!this.mRoom.selectedSprite||this.mRoom.selectedSprite.id!==t.id)){var i=t.currentAnimation,n=i.name,o=i.flip,r=e.getCollisionArea(n,o),s=e.getWalkableArea(n,o),a=e.getOriginPoint(n,o),h=r.length,c=r[0].length,l=this.mRoom.transformToMini45(t.pos);if(!s){s=new Array(h);for(var p=0;p<h;p++)s[p]=new Array(c).fill(0)}var d=0,m=0;for(p=0;p<h;p++){d=l.y+p-a.y;for(var u=0;u<c;u++)1===r[p][u]&&(p>=s.length||u>=s[p].length||0===s[p][u])&&(m=l.x+u-a.x,d>=0&&d<this.mMap.length&&m>=0&&m<this.mMap[d].length&&(this.mMap[d][m]=1))}}},DecorateElementManager.prototype.removeMap=function(t){var e=t.displayInfo;if(e)for(var i=t.currentAnimation,n=i.name,o=i.flip,r=e.getCollisionArea(n,o),s=e.getOriginPoint(n,o),a=r.length,h=r[0].length,c=this.mRoom.transformToMini45(t.pos),l=0,p=0,d=0;d<a;d++){l=c.y+d-s.y;for(var m=0;m<h;m++)p=c.x+m-s.x,1===r[d][m]&&l>=0&&l<this.mMap.length&&p>=0&&p<this.mMap[l].length&&(this.mMap[l][p]=0)}},DecorateElementManager.prototype.canPut=function(t,e,i){for(var n=0,o=0,r=this.map,s=0;s<e.length;s++){if((n=s+t.y-i.y)<0||n>=r.length)return!1;for(var a=0;a<e[s].length;a++)if((o=a+t.x-i.x)>=r[s].length||1===r[n][o])return!1}return!0},DecorateElementManager.prototype._add=function(t,e){void 0===e&&(e=!0);var i=this.mElements.get(t.id);return i?i.model=t:(i=new _.b(t,this),"FROZEN"===this.getFrozenType(t)?i.setInputEnable(_.c.Diasble):i.setInputEnable(_.c.Enable)),e&&this.addMap(t),this.mElements.set(i.id||0,i),i},DecorateElementManager.prototype.onSync=function(t){var e=t.content;if(e.nodeType===v.ElementNodeType)for(var i=null,n=0,o=e.sprites;n<o.length;n++){var r=o[n];if(i=this.get(r.id)){var s=new g.a(r,e.nodeType);i.model=s,this.addMap(s)}}},Object.defineProperty(DecorateElementManager.prototype,"map",{get:function(){return this.mMap},enumerable:!1,configurable:!0}),DecorateElementManager.prototype.getFrozenType=function(t){var e,i=t.attrs;return i&&i.forEach((function(t){"frozenType"===t.key&&(e=t.value)})),e},DecorateElementManager}(y.a),S=i(119),b=i(177),C=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),T=function(t){function DecorateTerrainManager(e){var i=t.call(this,e)||this,n=e.miniSize;i.mMap=new Array(n.rows);for(var o=0;o<n.rows;o++)i.mMap[o]=new Array(n.cols).fill(0);return i}return C(DecorateTerrainManager,t),DecorateTerrainManager.prototype.remove=function(e){var i=t.prototype.remove.call(this,e);return i&&this.removeMap(i.model),i},DecorateTerrainManager.prototype.canPut=function(t,e,i){for(var n=0,o=0,r=this.map,s=0;s<e.length;s++){if((n=s+t.y-i.y)>=r.length)return!1;for(var a=0;a<e[s].length;a++)if((o=a+t.x-i.x)>=r[s].length||0===r[n][o])return!1}},DecorateTerrainManager.prototype._add=function(e){var i=t.prototype._add.call(this,e);return e.displayInfo&&this.addMap(e),i},DecorateTerrainManager.prototype.onSyncSprite=function(t){var e=t.content;if(e.nodeType===h.op_def.NodeType.TerrainNodeType)for(var i=null,n=0,o=e.sprites;n<o.length;n++){var r=o[n];if(i=this.get(r.id)){var s=new g.a(r,e.nodeType);i.model=s,s.displayInfo&&this.addMap(s)}}},DecorateTerrainManager.prototype.addMap=function(t){this.setMap(t,1)},DecorateTerrainManager.prototype.removeMap=function(t){this.setMap(t,0)},DecorateTerrainManager.prototype.setMap=function(t,e){var i=t.displayInfo;if(i){var n=t.currentAnimation,o=n.name,r=n.flip,s=i.getCollisionArea(o,r),a=i.getWalkableArea(o,r),h=i.getOriginPoint(o,r),c=s.length,l=s[0].length,p=!0;1===c&&1===l&&(c=2,l=2,p=!1);var d=t.pos;d.x*=2,d.y*=2;for(var m=0,u=0,f=0;f<c;f++){m=d.y+f-h.x;for(var y=0;y<l;y++)if(!p||1===s[f][y]&&1===a[f][y]){if(u=d.x+y-h.y,m>=this.mMap.length||u>=this.mMap[m].length)continue;this.mMap[m][u]=e}}}},DecorateTerrainManager}(b.a),I=i(142),M=i(143),E=function(){function SpawnPoint(){this.id=100,this.nodeType=h.op_def.NodeType.SpawnPointType,this.pos=new c.a,this.displayInfo=new I.a({id:0,animations:{defaultAnimationName:"idle",display:this.display,animationData:[new M.a(this.animation)]}}),this.currentAnimation={name:"idle",flip:!1},this.direction=3,this.nickname="出生点",this.alpha=1}return SpawnPoint.prototype.newID=function(){throw new Error("Method not implemented.")},SpawnPoint.prototype.setPosition=function(t,e){this.pos.x=t,this.pos.y=e},SpawnPoint.prototype.turn=function(){throw new Error("Method not implemented.")},SpawnPoint.prototype.toSprite=function(){throw new Error("Method not implemented.")},SpawnPoint.prototype.updateAvatar=function(t){throw new Error("Method not implemented.")},SpawnPoint.prototype.updateDisplay=function(t,e,i){throw new Error("Method not implemented.")},SpawnPoint.prototype.setAnimationName=function(){throw new Error("Method not implemented.")},SpawnPoint.prototype.setAnimationQueue=function(){throw new Error("Method not implemented.")},Object.defineProperty(SpawnPoint.prototype,"display",{get:function(){var t=h.op_gameconfig.Display.create();return t.texturePath="pixelpai/SpawnPointNode/5cc42f6417553727db1d2bba/1/5cc42f6417553727db1d2bba.png",t.dataPath="pixelpai/SpawnPointNode/5cc42f6417553727db1d2bba/1/5cc42f6417553727db1d2bba.json",t},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"animation",{get:function(){var t=h.op_gameconfig_01.AnimationData.create();return t.frameRate=5,t.collisionArea="1,1&1,1",t.loop=!0,t.baseLoc="-30,-30",t.originPoint=[0,0],t.frameName=["switch_0027_3_01.png"],t.node=h.op_gameconfig_01.Node.create(),t.node.id=0,t.node.name="idle",t.node.Parent=0,t},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"currentCollisionArea",{get:function(){return[[1,1],[1,1]]},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"currentWalkableArea",{get:function(){return[[0]]},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"currentCollisionPoint",{get:function(){return new Phaser.Geom.Point(0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"hasInteractive",{get:function(){return!1},enumerable:!1,configurable:!0}),SpawnPoint}(),k=i(181),B=function(){function SelectorElement(t){var e=this;this.mElement=t,this.mScene=this.mElement.scene,this.mRoomService=this.mElement.roomService,this.mDecorateManager=new k.DecorateManager(this.mScene,this.mRoomService),this.mDecorateManager.setElement(t);var i=t.getDisplay();i.collisionArea?i.showRefernceArea():i.once("initialized",(function(){i.play(e.mElement.model.currentAnimation),i.showRefernceArea()})),this.mSelecting=!0,this.mDecorateManager.on("moveElement",this.onMoveElementHandler,this),this.mRoomService.world.emitter.emit(S.a.EDIT_PACKAGE_COLLAPSE),this.mRoomService.world.emitter.emit(S.a.SELECTED_DECORATE_ELEMENT)}return SelectorElement.prototype.turnElement=function(){this.mElement&&(this.mElement.turn(),this.checkCanPut())},SelectorElement.prototype.setDisplayPos=function(t){this.mElement&&(this.mElement.setPosition(t),this.checkCanPut())},SelectorElement.prototype.update=function(t,e){if(this.mElement){var i=this.mElement.getPosition();this.mDecorateManager.updatePos(i.x,i.y),this.checkCanPut()}},SelectorElement.prototype.clone=function(){if(this.mElement){var t=this.mElement.model,e=t.pos;this.mSourceData={x:e.x,y:e.y,z:e.z,direction:t.direction}}},SelectorElement.prototype.recover=function(){this.mElement&&this.mSourceData&&(this.mElement.setAlpha(1),this.mElement.setPosition(new c.a(this.mSourceData.x,this.mSourceData.y)),this.mElement.setDirection(this.mSourceData.direction))},SelectorElement.prototype.destroy=function(){if(this.mDecorateManager&&this.mDecorateManager.destroy(),this.mElement){var t=this.mElement.getDisplay();t&&t.hideRefernceArea()}this.mSourceData=void 0,this.mRoomService.world.emitter.emit(S.a.EDIT_PACKAGE_EXPANED),this.mRoomService.world.emitter.emit(S.a.CANCEL_DECORATE_ELEMENT)},SelectorElement.prototype.checkCanPut=function(){if(this.mRoomService&&this.mElement){var t=this.mElement.model,e=this.mRoomService.canPut(this.mElement.getPosition(),t.currentCollisionArea,t.currentCollisionPoint);e?this.element.setAlpha(1):this.element.setAlpha(.6),this.mDecorateManager&&this.mDecorateManager.canPut(e)}},SelectorElement.prototype.onMoveElementHandler=function(t){t&&this.setDisplayPos(t)},Object.defineProperty(SelectorElement.prototype,"selecting",{get:function(){return this.mSelecting},set:function(t){this.mSelecting=t},enumerable:!1,configurable:!0}),Object.defineProperty(SelectorElement.prototype,"element",{get:function(){return this.mElement},enumerable:!1,configurable:!0}),Object.defineProperty(SelectorElement.prototype,"root",{get:function(){return this.mSourceData},enumerable:!1,configurable:!0}),SelectorElement}(),O=i(180),D=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),R=function(t){function DecorateRoom(e){var i=t.call(this)||this;return i.clockSyncComplete=!0,i.world=e.world,i.mScaleRatio=i.world.scaleRatio,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_SELECTED_SPRITE,i.onSelectSpriteHandler),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_GET_SPAWN_POINT,i.onShowSpawnPointHandler),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ADD_SPRITE_BY_TYPE,i.onAddSpriteHandler),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ADD_SINGLE_SPRITE_BY_TYPE,i.onAddSingleSpriteHandler)),i}return D(DecorateRoom,t),DecorateRoom.prototype.enter=function(t){var e=this;this.mID=t.id;var i=t.rows,n=t.cols,o=t.tileWidth,s=t.tileHeight;this.mSize={cols:t.cols,rows:t.rows,tileHeight:t.tileHeight,tileWidth:t.tileWidth,sceneWidth:(t.rows+t.cols)*(t.tileWidth/2),sceneHeight:(t.rows+t.cols)*(t.tileHeight/2)},i*=2,n*=2,o/=2,s/=2,this.mMiniSize={cols:n,rows:i,tileHeight:s,tileWidth:o,sceneWidth:(i+n)*(o/2),sceneHeight:(i+n)*(s/2)},this.mMap=new Array(i);for(var a=0;a<i;a++)this.mMap[a]=new Array(n).fill(0);this.mCameraService=new r.a(this),this.world.showLoading().then((function(){e.completeLoad()}))},DecorateRoom.prototype.addBlockObject=function(t){this.mBlocks&&this.mBlocks.add(t)},DecorateRoom.prototype.addMouseListen=function(){},DecorateRoom.prototype.addToGround=function(t){this.mLayerManager.addToGround(t)},DecorateRoom.prototype.addToSceneUI=function(t){this.mLayerManager.addToSceneToUI(t)},DecorateRoom.prototype.addToSurface=function(t){this.mLayerManager.addToSurface(t)},DecorateRoom.prototype.addToUI=function(t){},DecorateRoom.prototype.completeLoad=function(){this.world.game.scene.add(d.a.name,d.a,!0,{room:this})},DecorateRoom.prototype.initUI=function(){this.world.uiManager&&this.world.uiManager.showDecorateUI()},DecorateRoom.prototype.destroy=function(){this.mTerrainManager&&this.mTerrainManager.destroy(),this.mElementManager&&this.mElementManager.destroy(),this.mLayerManager&&this.mLayerManager.destroy(),this.mBlocks&&this.mBlocks.destroy(),this.mSkyboxManager&&this.mSkyboxManager.destroy(),this.removePointerMoveHandler(),this.world.game.scene.remove(d.a.name),this.world.emitter.off(S.a.TURN_ELEMENT,this.onTurnElementHandler,this),this.world.emitter.off(S.a.RECYCLE_ELEMENT,this.onRecycleHandler,this),this.world.emitter.off(S.a.PUT_ELEMENT,this.onPutElement,this),this.world.emitter.off(S.a.CANCEL_PUT,this.onCancelPutHandler,this),this.mScene&&(this.mScene.input.off("pointerup",this.onPointerUpHandler,this),this.mScene.input.off("pointerdown",this.onPointerDownHandler,this),this.mScene.input.off("gameobjectdown",this.onGameobjectUpHandler,this))},DecorateRoom.prototype.now=function(){return 0},DecorateRoom.prototype.pause=function(){this.mScene&&this.mScene.scene.pause()},DecorateRoom.prototype.removeBlockObject=function(t){this.mBlocks&&this.mBlocks.remove(t)},DecorateRoom.prototype.requestActorMove=function(t,e){},DecorateRoom.prototype.resume=function(t){this.mScene&&this.mScene.scene.resume(t)},DecorateRoom.prototype.startLoad=function(){},DecorateRoom.prototype.startPlay=function(){this.mLayerManager&&this.mLayerManager.destroy(),this.mScene=this.world.game.scene.getScene(d.a.name),this.mLayerManager=new s.a(this),this.mTerrainManager=new T(this),this.mElementManager=new w(this),this.mBlocks=new o.a(this.mCameraService),this.mSkyboxManager=new O.a(this),this.mBlocks.int(this.mSize),this.mScene.input.on("pointerup",this.onPointerUpHandler,this),this.mScene.input.on("pointerdown",this.onPointerDownHandler,this),this.mScene.input.on("gameobjectdown",this.onGameobjectUpHandler,this);var t=this.scene.cameras.main;this.mCameraService.camera=t;var e=Math.ceil(window.devicePixelRatio);this.mCameraService.setBounds(-t.width>>1,-t.height>>1,this.mSize.sceneWidth*e+t.width,this.mSize.sceneHeight*e+t.height),this.cameraPos&&(this.mCameraService.scrollTargetPoint(this.cameraPos.x,this.cameraPos.y),this.mCameraService.syncCameraScroll()),this.world.changeRoom(this);var i=this.world.game.scene.getScene(p.a.name);i&&i.sleep(),this.connection.send(new l.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED)),this.world.emitter.on(S.a.TURN_ELEMENT,this.onTurnElementHandler,this),this.world.emitter.on(S.a.RECYCLE_ELEMENT,this.onRecycleHandler,this),this.world.emitter.on(S.a.PUT_ELEMENT,this.onPutElement,this),this.world.emitter.on(S.a.CANCEL_PUT,this.onCancelPutHandler,this),this.initSkyBox()},DecorateRoom.prototype.transformTo45=function(t){if(this.mSize)return a.a.transformTo45(t,this.mSize);m.a.getInstance().error("position object is undefined")},DecorateRoom.prototype.transformTo90=function(t){if(this.mSize)return a.a.transformTo90(t,this.mSize);m.a.getInstance().error("position object is undefined")},DecorateRoom.prototype.transformToMini90=function(t){if(this.mMiniSize)return a.a.transformTo90(t,this.mMiniSize);m.a.getInstance().error("position object is undefined")},DecorateRoom.prototype.transformToMini45=function(t){if(this.mMiniSize)return a.a.transformTo45(t,this.mMiniSize);m.a.getInstance().error("position object is undefined")},DecorateRoom.prototype.update=function(t,e){this.mLayerManager&&this.mLayerManager.update(t,e),this.mSelectorElement&&this.mSelectorElement.update(t,e),this.mBlocks&&this.mBlocks.update(t,e)},DecorateRoom.prototype.updateBlockObject=function(){},DecorateRoom.prototype.resize=function(t,e){this.layerManager.resize(t,e),this.mCameraService.resize(t,e)},DecorateRoom.prototype.transitionGrid=function(t,e){var i=new c.a(t,e),n=this.transformToMini45(i);return this.checkBound(n)},DecorateRoom.prototype.addElements=function(t,e){e===h.op_def.NodeType.ElementNodeType?this.mElementManager.add(t):e===h.op_def.NodeType.TerrainNodeType&&this.mTerrainManager.add(t)},DecorateRoom.prototype.setEnterPos=function(t,e){this.cameraPos=new c.a(t,e)},DecorateRoom.prototype.checkBound=function(t,e){var i=new c.a(t.x,t.y),n=this.mMiniSize;return t.x<0?i.x=0:t.x>n.cols&&(i.x=n.cols),t.y<0?i.y=0:t.y>n.rows&&(i.y=n.rows),i.equal(t)&&e?e:this.transformToMini90(i)},DecorateRoom.prototype.canPut=function(t,e,i){if(e&&i){var n=this.transformToMini45(t);if(n.x<0||n.y<0||n.y>this.miniSize.rows||n.x>this.miniSize.cols)return!1;for(var o=0,r=[this.mElementManager,this.mTerrainManager];o<r.length;o++){if(!1===r[o].canPut(n,e,i))return!1}return!0}},DecorateRoom.prototype.setMap=function(t,e,i){e<0||t<0||this.mMap.length<e||this.mMap[0].length<t||(this.mMap[t][e]=i)},DecorateRoom.prototype.getElement=function(t){var e=null;return this.mElementManager&&(e=this.elementManager.get(t)),!e&&this.mTerrainManager&&(e=this.mTerrainManager.get(t)),e},DecorateRoom.prototype.initSkyBox=function(){var t=this.world.elementStorage.getScenerys();if(t)for(var e=0,i=t;e<i.length;e++){var n=i[e];this.addSkyBox(n)}},DecorateRoom.prototype.addSkyBox=function(t){this.mSkyboxManager.add(t)},DecorateRoom.prototype.addPointerMoveHandler=function(){this.mScene&&(this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("gameout",this.onGameOutHandler,this))},DecorateRoom.prototype.removePointerMoveHandler=function(){this.mScene&&(this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("gameout",this.onGameOutHandler,this))},DecorateRoom.prototype.onPointerUpHandler=function(t){this.removePointerMoveHandler(),this.mSelectorElement&&(this.mSelectorElement.selecting=!1)},DecorateRoom.prototype.onPointerDownHandler=function(){this.addPointerMoveHandler()},DecorateRoom.prototype.onGameobjectUpHandler=function(t,e){var i=e.parentContainer.parentContainer||e.parentContainer;i&&i instanceof u.b&&(i instanceof f.a||this.selectedElement(i.element))},DecorateRoom.prototype.onPointerMoveHandler=function(t){!this.mSelectorElement||this.mSelectorElement&&!1===this.mSelectorElement.selecting?this.moveCamera(t):t.downX===t.x&&t.downY===t.y||this.moveElement(t)},DecorateRoom.prototype.onGameOutHandler=function(){this.removePointerMoveHandler()},DecorateRoom.prototype.moveCamera=function(t){this.cameraService.offsetScroll(t.prevPosition.x-t.position.x,t.prevPosition.y-t.position.y)},DecorateRoom.prototype.moveElement=function(t){var e=this.transitionGrid(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio);this.mSelectorElement&&this.mSelectorElement.setDisplayPos(e)},DecorateRoom.prototype.removeElement=function(t,e){(e===h.op_def.NodeType.ElementNodeType||e===h.op_def.NodeType.SpawnPointType||e===h.op_def.NodeType.TerrainNodeType)&&this.elementManager.remove(t)},DecorateRoom.prototype.addElement=function(t,e){var i=t.nodeType;i===h.op_def.NodeType.ElementNodeType||i===h.op_def.NodeType.SpawnPointType?this.mElementManager.add([t],e):i===h.op_def.NodeType.TerrainNodeType&&this.mTerrainManager.add([t])},DecorateRoom.prototype.selectedElement=function(t,e){void 0===e&&(e=!0),t&&(this.mSelectorElement?this.mSelectorElement.element===t?this.mSelectorElement.selecting=!0:(this.onPutElement(null),this.selectedElement(t,e)):(this.mSelectorElement=new B(t),e&&(this.mSelectorElement.clone(),this.elementManager.removeMap(t.model)),this.mSelectorElement.update()))},DecorateRoom.prototype.cancelSelector=function(){if(this.mSelectorElement){var t=null;this.mSelectorElement.root&&(t=this.mSelectorElement.element.model),this.mSelectorElement.destroy(),this.mSelectorElement=void 0,t&&this.mElementManager.addMap(t)}},DecorateRoom.prototype.onTurnElementHandler=function(t){this.mSelectorElement&&this.mSelectorElement.turnElement()},DecorateRoom.prototype.onRecycleHandler=function(t){if(this.mSelectorElement){var e=this.mSelectorElement.element.model;if(e){var i=new l.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_RECYCLE_SPRITE),n=i.content;n.sprites=[e.toSprite()],n.nodeType=e.nodeType,this.world.connection.send(i),this.mSelectorElement.destroy(),this.mSelectorElement=void 0}}},DecorateRoom.prototype.onPutElement=function(t){if(this.removePointerMoveHandler(),this.mSelectorElement){var e=this.mSelectorElement.element;if(e){var i=e.model;i&&(this.canPut(i.pos,i.currentCollisionArea,i.currentCollisionPoint)?(this.mSelectorElement.root?this.sendUpdateSprite(i):i.nodeType===h.op_def.NodeType.SpawnPointType?(this.sendSpawnPoint(i.pos),this.removeElement(i.id,i.nodeType)):this.sendAddSprite(i),this.cancelSelector()):this.onCancelPutHandler(e))}}},DecorateRoom.prototype.onCancelPutHandler=function(t){(this.removePointerMoveHandler(),this.mSelectorElement)&&(t||(t=this.mElementManager.get(this.mSelectorElement.element.id)),t&&(this.mSelectorElement.root?this.mSelectorElement.recover():this.removeElement(t.id,t.model.nodeType),this.cancelSelector()))},DecorateRoom.prototype.sendAddSprite=function(t){var e=new l.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ADD_SPRITE),i=e.content;i.sprites=[t.toSprite()],i.nodeType=t.nodeType,this.connection.send(e)},DecorateRoom.prototype.sendUpdateSprite=function(t){var e=new l.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_UPDATE_SPRITE),i=e.content;i.sprites=[t.toSprite()],i.nodeType=t.nodeType,this.connection.send(e)},DecorateRoom.prototype.sendSpawnPoint=function(t){var e=new l.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_SET_SPAWN_POINT),i=e.content,n=h.op_def.PBPoint3f.create();n.x=t.x,n.y=t.y,i.spawnPoint=n,this.connection.send(e)},DecorateRoom.prototype.sendPosition=function(t){var e=new l.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_CHANGE_SPRITE_POSITION),i=e.content;i.sprites=[t.toSprite()],i.nodeType=t.nodeType,this.connection.send(e)},DecorateRoom.prototype.onSelectSpriteHandler=function(t){var e=t.content,i=this.cameraService.camera,n=new g.a(e.sprite,e.nodeType);n.setPosition((i.scrollX+i.width/2)/this.world.scaleRatio,(i.scrollY+i.height/2)/this.world.scaleRatio),this.addElement(n,!1);var o=this.mElementManager.get(e.sprite.id);o&&this.selectedElement(o,!1)},DecorateRoom.prototype.onShowSpawnPointHandler=function(t){var e=t.content,i=new E,n=e.spawnPoint;i.setPosition(n.x,n.y),this.addElement(i,!1),this.selectedElement(this.mElementManager.get(i.id),!1),this.mCameraService.scrollTargetPoint(n.x,n.y)},DecorateRoom.prototype.onAddSpriteHandler=function(t){t.content;this.cancelSelector()},DecorateRoom.prototype.onAddSingleSpriteHandler=function(t){var e=t.content,i=e.addedSprites;if(i){for(var n=[],o=0,r=i;o<r.length;o++){var s=r[o];n.push(new g.a(s,e.nodeType))}if(n.length>0){this.mElementManager.add(n);var a=this.mElementManager.get(n[n.length-1].id);a&&(this.cancelSelector(),this.selectedElement(a),this.mSelectorElement&&(this.mSelectorElement.selecting=!1))}}},Object.defineProperty(DecorateRoom.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"roomSize",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"terrainManager",{get:function(){return this.mTerrainManager},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"elementManager",{get:function(){return this.mElementManager},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"layerManager",{get:function(){return this.mLayerManager},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"cameraService",{get:function(){return this.mCameraService},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"scene",{get:function(){return this.mScene},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"connection",{get:function(){return this.world.connection},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"miniSize",{get:function(){return this.mMiniSize},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"selectedSprite",{get:function(){if(this.mSelectorElement)return this.mSelectorElement.element},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"enableEdit",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"sceneType",{get:function(){return h.op_def.SceneTypeEnum.EDIT_SCENE_TYPE},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"effectManager",{get:function(){},enumerable:!1,configurable:!0}),DecorateRoom}(l.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=function(){function Viewblock(t,e){this.mRect=t,this.mElements=new Map,this.mIndex=e}return Viewblock.prototype.add=function(t,e){if(this.mElements.set(t.id,t),e){var i=t.getPosition45();t.setRenderable(e.contains(i.x,i.y)&&this.mInCamera)}},Viewblock.prototype.remove=function(t){return this.mElements.delete(t.id)},Viewblock.prototype.check=function(t,e){if(t){var i=Phaser.Geom.Intersects.RectangleToRectangle(t,this.rectangle);e&&(this.mInCamera&&this.mElements.forEach((function(t){var i=t.getPosition45();t.setRenderable(e.contains(i.x,i.y),0)})),this.mInCamera=i)}},Viewblock.prototype.getElement=function(t){return this.mElements.get(t)},Object.defineProperty(Viewblock.prototype,"rectangle",{get:function(){return this.mRect||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Viewblock.prototype,"inCamera",{get:function(){return this.mInCamera},enumerable:!1,configurable:!0}),Viewblock}(),o=function(){function ViewblockManager(t){this.mBlocks=[],this.mDelay=0,this.mCameras=t}return ViewblockManager.prototype.add=function(t){if(!this.mCameras)return!1;for(var e=this.mCameras.getMiniViewPort(),i=0,n=this.mBlocks;i<n.length;i++){var o=n[i],r=o.rectangle,s=t.getPosition();if(!s)return;if(r.contains(s.x,s.y))return void o.add(t,e)}},ViewblockManager.prototype.remove=function(t){if(t)for(var e=0,i=this.mBlocks;e<i.length;e++){if(i[e].remove(t))return}},ViewblockManager.prototype.check=function(t){if(t)for(var e=0,i=this.mBlocks;e<i.length;e++){var n=i[e];if(n.inCamera){var o=n.rectangle,r=t.getPosition();if(o.contains(r.x,r.y))return void(n.getElement(t.id)||(this.remove(t),n.add(t)))}}},ViewblockManager.prototype.int=function(t){if(t){this.mBlocks=[];for(var e=t.tileWidth/2*20,i=t.tileHeight/2*20,o=t.sceneWidth/e,r=t.sceneHeight/i,s=0,a=0;a<o;a++)for(var h=0;h<r;h++){var c=new n(new Phaser.Geom.Rectangle(a*e,h*i,e,i),s++);this.mBlocks.push(c)}}},ViewblockManager.prototype.update=function(t,e){if(this.mCameras){this.mDelay=t;for(var i=this.mCameras.getViewPort(),n=this.mCameras.getMiniViewPort(),o=0,r=this.mBlocks;o<r.length;o++){r[o].check(i,n)}}},ViewblockManager.prototype.destroy=function(){this.mDelay=0},ViewblockManager}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));var n,o=i(116),r=i(0),s=i(111),a=i(128),h=i(342),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function SkyBoxScene(){return t.call(this,{})||this}return c(SkyBoxScene,t),SkyBoxScene.prototype.init=function(t){t&&(this.skyBoxManager=t)},SkyBoxScene.prototype.create=function(){var t=this.cameras.main;this.cameras.addExisting(new h.a(0,0,this.sys.scale.width,this.sys.scale.height,this.skyBoxManager.world.scaleRatio),!0),this.cameras.remove(t),this.skyBoxManager.startPlay(this)},SkyBoxScene.prototype.update=function(t,e){this.skyBoxManager.check(t,e)},SkyBoxScene}(a.a),p=i(343),d=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),m=function(){function BlockManager(t,e){this.mRows=1,this.mCols=1,this.mSceneName="",this.mGrids=[],this.mScenery=t,this.mUris=t.uris,this.mRoom=e,this.mWorld=e.world,this.mCameras=e.cameraService,this.mMainCamera=this.mCameras.camera,this._bound=this.mMainCamera.getBounds(),this.mScaleRatio=this.mWorld.scaleRatio,this.setSize(t.width,t.height);var i=e.scene;if(i){this.mSceneName=l.name+"_"+t.id;this.mWorld.game.scene.add(this.mSceneName,l,!1);i.scene.launch(this.mSceneName,this),this.updateDepth()}else r.a.getInstance().fatal(BlockManager.name+" scene does not exist")}return BlockManager.prototype.startPlay=function(t){var e=this;this.scene=t,this.initBlock(),this.mStateMap&&this.mStateMap.forEach((function(t){return e.handlerState(t)}))},BlockManager.prototype.check=function(t,e){for(var i=this.mMainCamera.worldView,n=new Phaser.Geom.Rectangle(i.x-i.width/2,i.y-i.height/2,2*i.width,2*i.height),o=0,r=this.mGrids;o<r.length;o++){var s=r[o];s.checkCamera(Phaser.Geom.Intersects.RectangleToRectangle(n,s.rectangle))}},BlockManager.prototype.update=function(t){this.mScenery=t,this.mUris=t.uris,this.setSize(t.width,t.height),this.initBlock(),this.updateDepth()},BlockManager.prototype.setSize=function(t,e,i,n){if(0!==this.mUris.length){var o=1,r=1;(this.mUris.length>1||this.mUris[0].length>1)&&(o=t/1024,r=e/1024),this.mCols=Math.round(o),this.mRows=Math.round(r),this.mGridWidth=t/this.mCols,this.mGridHeight=e/this.mRows}},BlockManager.prototype.resize=function(t,e){if(this.scene&&this.mMainCamera){var i=this.scene.cameras.main;if(i){this.mScaleRatio=this.mWorld.scaleRatio,this.updatePosition(),this._bound=this.mMainCamera.getBounds(),i.setBounds(this._bound.x,this._bound.y,this._bound.width,this._bound.height);for(var n=0,o=this.mGrids;n<o.length;n++){var r=o[n];r.setScaleRatio(this.mScaleRatio),r.resize(t,e)}}}},BlockManager.prototype.updatePosition=function(){var t=this.scene.cameras.main,e=this.mScenery.offset,i=this.fixPosition({x:e.x,y:e.y});t.setPosition(i.x,i.y);for(var n=0,o=this.mGrids;n<o.length;n++){o[n].updatePosition()}},BlockManager.prototype.destroy=function(){this.mWorld&&this.mWorld.game&&this.mWorld.game.scene.remove(this.mSceneName),this.mGrids.length=0},BlockManager.prototype.setState=function(t){this.handlerState(t)},BlockManager.prototype.playSkyBoxAnimation=function(t){var e=t.id,i=t.targets,n=t.duration,o=t.reset,r=t.resetDuration;if(void 0!==e&&void 0!==i&&void 0!==n&&this.scene&&e===this.mScenery.id){var s=this.scene.cameras.main;this.move(s,this.fixPosition(i),n,this.fixPosition(o),r)}},BlockManager.prototype.handlerState=function(t){for(var e=0,i=t.packet;e<i.length;e++){var n=i[e];this.mScenery.id===n.id&&this.playSkyBoxAnimation(n)}},BlockManager.prototype.updateDepth=function(){if(this.mRoom){var t=this.mRoom.scene;if(this.mScenery&&t){var e=this.mWorld.game.scene.getScene(this.mSceneName);e&&(this.mScenery.depth<0?e.scene.sendToBack(this.mSceneName):e.scene.moveAbove(t.sys.settings.key,this.mSceneName))}}},BlockManager.prototype.initBlock=function(){this.clear(),this.mContainer=this.scene.add.container(0,0),this.mContainer.setScale(this.mWorld.scaleRatio);var t=this.mUris.length;if(this.mScenery.fit===p.a.Repeat)for(var e=this.mRoom.getMaxScene(),i=e.width,n=e.height,o=Math.floor(i/this.mScenery.width),r=Math.floor(n/this.mScenery.height),s=0;s<o;s++)for(var a=0;a<r;a++){(c=new u(this.scene,this.mUris[0][0],this.mScaleRatio)).setRectangle(a*this.mGridWidth,s*this.mGridHeight,this.mGridWidth,this.mGridHeight),this.mGrids.push(c)}else for(s=0;s<t;s++){var h=this.mUris[s].length;for(a=0;a<h;a++){var c;(c=new u(this.scene,this.mUris[s][a],this.mScaleRatio)).setRectangle(a*this.mGridWidth,s*this.mGridHeight,this.mGridWidth,this.mGridHeight),this.mGrids.push(c)}}this.mContainer.add(this.mGrids),this.initCamera()},BlockManager.prototype.move=function(t,e,i,n,o){var r=this;this.tween&&(this.tween.stop(),this.tween.removeAllListeners()),this.tween=this.scene.tweens.add({targets:t,props:e,duration:i,loop:-1,onUpdate:function(){for(var t=0,e=r.mGrids;t<e.length;t++){e[t].updatePosition()}}}),n&&this.tween.once("loop",(function(){n&&(t.x=n.x,t.y=n.y),r.tween.stop(),r.move(t,e,o)}))},BlockManager.prototype.initCamera=function(){var t=this.scene.cameras.main;this.mCameras&&(t.setBounds(this._bound.x,this._bound.y,this._bound.width,this._bound.height),this.updatePosition(),t.setScroll(this.mMainCamera.scrollX,this.mMainCamera.scrollY),this.mCameras.addCamera(t))},BlockManager.prototype.clear=function(){for(var t=0,e=this.mGrids;t<e.length;t++){e[t].destroy()}this.mGrids.length=0,this.mContainer&&this.mContainer.destroy(!0)},Object.defineProperty(BlockManager.prototype,"world",{get:function(){return this.mWorld},enumerable:!1,configurable:!0}),Object.defineProperty(BlockManager.prototype,"scenery",{get:function(){return this.mScenery},enumerable:!1,configurable:!0}),BlockManager.prototype.fixPosition=function(t){if(t){var e=this.offset;return void 0!==t.x&&(t.x=(e.x+t.x)*this.mWorld.scaleRatio),void 0!==t.y&&(t.y=(e.y+t.y)*this.mWorld.scaleRatio),t}},Object.defineProperty(BlockManager.prototype,"offset",{get:function(){var t=0,e=0;if(this.mScenery&&this.mScenery.fit===p.a.Center){var i=this.mRoom.roomSize,n=this.mScenery,o=n.width,r=n.height;t=i.sceneWidth-o>>1,e=i.sceneHeight-r>>1}return{x:t,y:e}},enumerable:!1,configurable:!0}),BlockManager}(),u=function(t){function Block(e,i,n){var o=t.call(this,e,0,0)||this;return o.mLoaded=!1,o.mInCamera=!1,o.mKey=i,o.mScale=n,o.setOrigin(0),o}return d(Block,t),Block.prototype.checkCamera=function(t){this.mInCamera!==t&&(this.mInCamera=t,this.visible=t,this.mLoaded||this.load(s.i.getOsdRes(this.mKey)))},Block.prototype.setRectangle=function(t,e,i,n){this.x=t,this.y=e,this.setSize(i,n);var o=this.scene.cameras.main;this.mRectangle=new Phaser.Geom.Rectangle(t*this.mScale+o.x,e*this.mScale+o.y,i*this.mScale,n*this.mScale)},Block.prototype.updatePosition=function(){if(this.mRectangle){var t=this.scene.cameras.main;this.mRectangle.x=this.x*this.mScale+t.x,this.mRectangle.y=this.y*this.mScale+t.y}},Block.prototype.resize=function(t,e){var i=this.scene.cameras.main;this.mRectangle=new Phaser.Geom.Rectangle(this.x*this.mScale+i.x,this.y*this.mScale+i.y,this.width*this.mScale,this.height*this.mScale)},Block.prototype.setScaleRatio=function(t){this.mScale=t},Object.defineProperty(Block.prototype,"rectangle",{get:function(){return this.mRectangle},enumerable:!1,configurable:!0}),Object.defineProperty(Block.prototype,"key",{get:function(){return this.mKey},enumerable:!1,configurable:!0}),Block.prototype.onLoadComplete=function(e){t.prototype.onLoadComplete.call(this,e),this.texture&&(this.mLoaded=!0,this.texture.setFilter(Phaser.Textures.FilterMode.NEAREST))},Block}(o.DynamicImage)},function(t,e,i){"use strict";var n;i.d(e,"a",(function(){return n})),function(t){t[t.NONE=0]="NONE",t[t.GAME_INIT=1]="GAME_INIT",t[t.SOCKET_CONNECT=2]="SOCKET_CONNECT",t[t.LOGIN=3]="LOGIN",t[t.PLAYER_INIT=4]="PLAYER_INIT",t[t.WORLD_INIT=5]="WORLD_INIT",t[t.LOAD_PI=6]="LOAD_PI",t[t.PI_COMPLETE=7]="PI_COMPLETE",t[t.DECODE_PI=8]="DECODE_PI",t[t.GAME_CREATE=9]="GAME_CREATE",t[t.CHARACTER_CREATED=10]="CHARACTER_CREATED",t[t.ENTER_SCENE=11]="ENTER_SCENE",t[t.SCENE_CREATE=12]="SCENE_CREATE",t[t.PAUSE=13]="PAUSE",t[t.PLAYING=14]="PLAYING",t[t.SOCKET_DISCONNECT=15]="SOCKET_DISCONNECT",t[t.SOCKET_ERROR=16]="SOCKET_ERROR"}(n||(n={}))},,,,,,,,,,,,,,,function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n,o=i(110),r=i(2),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function KeyBoardManager(e,i){var n=t.call(this)||this;return n.worldService=e,n.mInitilized=!0,n.mKeyboardListeners=[],n.mKeyList=[],n.mKeyDownList=[],n.mKeyEvents=i,n.mTmpUpKeysStr="",n.mTmpDownKeyStr="",n.mKeyEventMap=new Map,n.mConnect=n.worldService.connection,n}return s(KeyBoardManager,t),KeyBoardManager.prototype.onRoomChanged=function(t,e){var i=this;if(this.mRoom=t,this.mScene=t.scene,this.mScene){if(this.mKeyEvents){for(var n=this.mKeyEvents.length,o=void 0,r=void 0,s=0;s<n;s++)(o=this.mKeyEvents[s]).keyCodes,r=o.tqEvent,this.mKeyEventMap.get(r)||this.mKeyEventMap.set(r,o);this.mKeyEvents.length=0,this.mKeyEvents=null}this.mKeyEventMap.forEach((function(t){if(t)for(var e=t.keyCodes,n=e.length,o=void 0,r=0;r<n;r++){o=e[r];var s=i.mScene.input.keyboard.addKey(o,!1);i.addKeyEvent(s,t.tqEvent)}}))}},KeyBoardManager.prototype.getKeyCodes=function(t){if(this.mKeyEventMap.has(t))return this.mKeyEventMap.get(t).keyCodes},KeyBoardManager.prototype.resize=function(t,e){},KeyBoardManager.prototype.addListener=function(t){this.mKeyboardListeners.push(t)},KeyBoardManager.prototype.removeListener=function(t){var e=this.mKeyboardListeners.indexOf(t);e>=0&&this.mKeyboardListeners.splice(e,1)},Object.defineProperty(KeyBoardManager.prototype,"enable",{get:function(){return void 0!==this.mScene&&this.mScene.input.keyboard.enabled},set:function(t){this.mScene&&(this.mScene.input.keyboard.enabled=t)},enumerable:!1,configurable:!0}),Object.defineProperty(KeyBoardManager.prototype,"keyList",{get:function(){return this.mKeyList},enumerable:!1,configurable:!0}),KeyBoardManager.prototype.getKeyDowns=function(){return this.mInitilized&&this.mKeyList?(this.mKeyDownList=this.mKeyList.filter((function(t){return t.isDown})),this.mKeyDownList.map((function(t){return t.keyCode}))):[]},KeyBoardManager.prototype.getKeyUps=function(){var t,e=[];if(!this.mInitilized)return e;if(!this.mKeyDownList)return[];for(var i=0;i<this.mKeyDownList.length;i++)(t=this.mKeyDownList[i])&&t.isUp&&(this.mKeyDownList.splice(i,1),e.push(t.keyCode),i--);return e},KeyBoardManager.prototype.destroy=function(){this.removeKeyEvents(),this.mKeyDownList&&(this.mKeyDownList.length=0,this.mKeyDownList=null),this.mTmpDownKeyStr=null,this.mTmpUpKeysStr=null,this.mScene=null,this.mConnect=null,this.mInitilized=!1},KeyBoardManager.prototype.concatArr=function(t,e){var i,n=t.length>e.length?e.length:t.length,o=t.length>e.length?t:e,r=t.length>e.length?e:t;for(i=0;i<n;i++)o.push(r[i]);return o},KeyBoardManager.prototype.checkMoveKeyDown=function(t){for(var e,i,n=this.mKeyList,o=n.length,s=[],a=0,h=this.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_LEFT),c=this.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_DOWN),l=this.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_RIGHT),p=this.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_UP),d=0;d<o;d++)if(i=(e=n[d]).keyCode,e&&e.isDown){if(s.push(e.keyCode),h)if(h.indexOf(i)>-1){a+=-1;continue}if(l)if(l.indexOf(i)>-1){a+=1;continue}if(c)if(c.indexOf(i)>-1){a+=3;continue}if(p)if(p.indexOf(i)>-1){a+=-3;continue}}if(0===a)return!1;var m,u=t.getDirection();switch(a){case-1:m=u<=1?1:3;break;case-2:m=7;break;case-3:m=u<=3?1:7;break;case-4:m=1;break;case 1:m=u<=5?5:7;break;case 2:m=3;break;case 3:m=u<=3?3:5;break;case 4:m=5}return this.enable&&(t.setDirection(m),t.downHandler(m,s),this.mRoom&&this.mRoom.playerManager.actor&&this.mRoom.playerManager.actor.setDirection(m)),!0},KeyBoardManager.prototype.checkMoveKeyAllUp=function(){for(var t,e=this.mKeyList,i=e.length,n=0;n<i;n++)if((t=e[n])&&t.isDown)return!1;return!0},KeyBoardManager.prototype.addKeyEvent=function(t,e){t.on("down",this.keyDownHandle,this),t.on("up",this.keyUpHandle,this),this.mKeyList.push(t)},KeyBoardManager.prototype.keyDownHandle=function(t){var e=this;if(this.enable){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),n=i.content,s=this.getKeyDowns();this.mTmpDownKeyStr!==s.toString()&&(this.mTmpUpKeysStr="",this.mTmpDownKeyStr=s.toString(),n.keyCodes=s,this.mConnect.send(i),this.mKeyboardListeners.forEach((function(t){e.checkMoveKeyDown(t)})))}},KeyBoardManager.prototype.keyUpHandle=function(t){var e=this;if(this.enable){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_UP),n=i.content,s=this.getKeyUps();this.mTmpUpKeysStr===s.toString()||s.length<1||(this.mTmpDownKeyStr="",this.mTmpUpKeysStr=s.toString(),n.keyCodes=s,this.mConnect.send(i),this.mKeyboardListeners.forEach((function(t){e.checkMoveKeyAllUp()?t.upHandler():e.checkMoveKeyDown(t)})))}},KeyBoardManager.prototype.removeKeyEvents=function(){if(this.mScene){for(var t,e=this.mKeyList.length,i=0;i<e;i++)(t=this.mKeyList[i])&&(t.off("down",this.keyDownHandle),t.off("up",this.keyUpHandle),this.mScene.input.keyboard.removeKey(t.keyCode));this.mKeyList.length=0}},KeyBoardManager}(o.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n,o,r=i(110),s=i(2),a=i(119),h=i(141),c=i(122),l=i(109),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.RightMouseDown=1]="RightMouseDown",t[t.RightMouseUp=2]="RightMouseUp",t[t.LeftMouseDown=3]="LeftMouseDown",t[t.LeftMouseUp=4]="LeftMouseUp",t[t.WheelDown=5]="WheelDown",t[t.WheelUp=6]="WheelUp",t[t.RightMouseHolding=7]="RightMouseHolding",t[t.LeftMouseHolding=8]="LeftMouseHolding",t[t.Tap=9]="Tap"}(o||(o={}));var d=function(t){function MouseManager(e){var i=t.call(this)||this;return i.worldService=e,i.running=!1,i.mDownDelay=1e3,i.delay=500,i.mConnect=i.worldService.connection,i.zoom=i.worldService.scaleRatio||1,i}return p(MouseManager,t),MouseManager.prototype.changeRoom=function(t){this.pause(),this.mGameObject=null,this.mScene=t.scene,this.mScene&&(t.scene.input.on("gameobjectdown",this.groundDown,this),t.scene.input.on("pointerdown",this.pointerDownHandler,this),this.resume())},MouseManager.prototype.resize=function(t,e){this.zoom=this.worldService.scaleRatio||1},MouseManager.prototype.pause=function(){this.running=!1},MouseManager.prototype.resume=function(){this.running=!0},MouseManager.prototype.onUpdate=function(t,e){if(!1!==this.running&&void 0!==t){var i=[];t.leftButtonDown()?i.push(o.LeftMouseDown):t.leftButtonReleased()&&i.push(o.LeftMouseUp),t.middleButtonDown()?i.push(o.WheelDown):t.middleButtonReleased()&&i.push(o.WheelUp),t.rightButtonDown()?i.push(o.RightMouseDown):t.rightButtonReleased()&&i.push(o.RightMouseUp);var n=0,r=null;if(e&&e.parentContainer&&(n=e.parentContainer.getData("id"),r=e.parentContainer.parentContainer||e.parentContainer),!1===t.isDown){var s=Math.abs(t.downX-t.upX),a=Math.abs(t.downY-t.upY);if(s<10&&a<10)if(this.worldService.emitter.emit(l.ClickEvent.Tap,t,e),!1===t.isDown)if(r instanceof h.a)r.element instanceof c.b&&r.scaleTween()}0!==i.length&&this.sendMouseEvent(i,n,{x:t.worldX/this.zoom,y:t.worldY/this.zoom})}},Object.defineProperty(MouseManager.prototype,"enable",{get:function(){return!!this.mScene&&this.mScene.input.mouse.enabled},set:function(t){this.mScene&&(this.mScene.input.mouse.enabled=t)},enumerable:!1,configurable:!0}),MouseManager.prototype.destroy=function(){this.mScene=null,this.mConnect=null,this.running=!1,this.debounce=null},MouseManager.prototype.groundDown=function(t,e){this.mGameObject=e,this.mDownTime=setTimeout(this.holdHandler.bind(this),this.mDownDelay,t,e)},MouseManager.prototype.groundUp=function(t,e){this.onUpdate(t,e)},MouseManager.prototype.pointerDownHandler=function(t,e){var i=this;this.debounce?this.mGameObject=null:(this.debounce=setTimeout((function(){i.debounce=null}),this.delay),this.mScene.input.off("pointerup",this.onPointerUpHandler,this),this.mScene.input.once("pointerup",this.onPointerUpHandler,this),this.worldService&&this.worldService.emitter&&this.worldService.emitter.emit(a.a.SCENE_BACKGROUND_CLICK,t),this.onUpdate(t,this.mGameObject))},MouseManager.prototype.onPointerUpHandler=function(t){clearTimeout(this.mDownTime),this.onUpdate(t,this.mGameObject),this.mGameObject=null},MouseManager.prototype.holdHandler=function(t,e){var i=0;e&&e.parentContainer&&(i=e.parentContainer.getData("id"),e.parentContainer.parentContainer||e.parentContainer,this.sendMouseEvent([o.LeftMouseHolding],i,{x:t.worldX/this.zoom,y:t.worldY/this.zoom}))},MouseManager.prototype.sendMouseEvent=function(t,e,i){var n=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOUSE_EVENT),o=n.content;o.id=e,o.mouseEvent=t,o.point3f=i,this.mConnect.send(n)},MouseManager}(r.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i(0),o=i(122),r=i(2),s=i(391),a=function(){function JoyStickManager(t,e){this.worldService=t,this.mEnabled=!1,this.mOnListener=!1,this.mJoyListeners=[],this.mScale=t.uiScale,this.mKeyEvents=e,this.mKeyEventMap=new Map,n.a.getInstance().debug("JoyStickManager "+t.uiScale)}return JoyStickManager.prototype.onRoomChanged=function(t,e){this.mJoyStick?t instanceof s.a?this.mJoyStick.offListener():this.mJoyStick.onListener():this.mOnListener=!(t instanceof s.a)},JoyStickManager.prototype.setScene=function(t){if(this.mScene=t,this.mScene&&this.mKeyEvents){for(var e,i,n=this.mKeyEvents.length,o=0;o<n;o++)(e=this.mKeyEvents[o]).keyCodes,i=e.tqEvent,this.mKeyEventMap.get(i)||this.mKeyEventMap.set(i,e);this.mKeyEvents.length=0,this.mKeyEvents=null,this.mParentcon=this.mScene.add.container(0,0);var r=this.mScale?this.mScale:1;this.mJoyStick=new h(this.mScene,this.worldService,this.mParentcon,this.mJoyListeners,r),this.mOnListener?this.mJoyStick.onListener():this.mJoyStick.offListener()}},JoyStickManager.prototype.resize=function(){this.mParentcon&&(this.mParentcon.scaleX=this.mParentcon.scaleY=this.worldService.uiScale)},JoyStickManager.prototype.tweenView=function(t){this.mParentcon.visible=t},JoyStickManager.prototype.addListener=function(t){this.mJoyListeners.push(t),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)},JoyStickManager.prototype.getKeyCodes=function(t){if(this.mKeyEventMap.has(t)){for(var e=this.mKeyEventMap.get(t).keyCodes.length,i=[],n=0;n<e;n++){var o=this.mKeyEventMap.get(t).keyCodes[n];i.push(o)}return i}},JoyStickManager.prototype.removeListener=function(t){var e=this.mJoyListeners.indexOf(t);e>=0&&this.mJoyListeners.splice(e,1),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)},JoyStickManager.prototype.getKeyDowns=function(){return[]},JoyStickManager.prototype.getKeyUps=function(){return[]},JoyStickManager.prototype.downHandler=function(){},JoyStickManager.prototype.upHandler=function(){},Object.defineProperty(JoyStickManager.prototype,"enable",{get:function(){return this.mEnabled},set:function(t){this.mEnabled=t},enumerable:!1,configurable:!0}),JoyStickManager}(),h=function(){function JoyStick(t,e,i,n,o){this.mDown=!1,this.mScene=t,this.mWorld=e,this.parentCon=i,this.mJoyListeners=n,this.mScale=o,this.mKeyCodes=[],this.load()}return JoyStick.prototype.load=function(){this.mScene.load.atlas("joystick","./resources/ui/joystick/joystick.png","./resources/ui/joystick/joystick.json"),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start()},JoyStick.prototype.onListener=function(){this.mScene.input.on("pointerdown",this.downHandler,this),this.mScene.input.on("pointerup",this.upHandler,this)},JoyStick.prototype.offListener=function(){this.parentCon.visible=!1,this.mScene.input.off("pointermove",this.pointerMove,this),this.mScene.input.off("pointerdown",this.downHandler,this),this.mScene.input.off("pointerup",this.upHandler,this)},JoyStick.prototype.changeListeners=function(t){this.mJoyListeners=t},JoyStick.prototype.onLoadCompleteHandler=function(){this.mWorld.getSize();this.bg=this.mScene.make.sprite(void 0,!1),this.bg.setTexture("joystick","joystick_bg.png"),this.bgRadius=this.bg.width+100>>1,this.btn=this.mScene.make.sprite(void 0,!1),this.btn.name="joystick_btn",this.btn.setTexture("joystick","joystick_tab.png"),this.btn.x=this.bg.x,this.btn.y=this.bg.y,this.parentCon.alpha=.5,this.parentCon.addAt(this.bg,0),this.parentCon.addAt(this.btn,1),this.btn.setInteractive(new Phaser.Geom.Rectangle(0,0,this.btn.width,this.btn.height),Phaser.Geom.Rectangle.Contains),this.parentCon.setSize(this.bg.width,this.bg.height),this.parentCon.visible=!1},JoyStick.prototype.downHandler=function(t,e){if(this.mWorld.inputManager.enable&&!this.mDown){if(e){if(e.length>1)return;if(1===e.length){if(!e[0].name)return;if("joystick_btn"!==e[0].name)return}}this.mDown=!0,this.mScene.input.on("pointermove",this.pointerMove,this),this.parentCon.x=t.worldX,this.parentCon.y=t.worldY,this.parentCon.visible=!0}},JoyStick.prototype.pointerMove=function(t){var e=this;if(this.mWorld.inputManager.enable){var i=t.worldX-this.parentCon.x,n=t.worldY-this.parentCon.y,o=Math.sqrt(i*i+n*n);o>this.bgRadius&&(o=this.bgRadius);var r=Math.atan2(n,i);if(this.btn.x=Math.cos(r)*o,this.btn.y=Math.sin(r)*o,this.mWorld.inputManager.enable){var s=Math.acos(i/o);t.worldY>this.parentCon.y&&(s=-s),this.mJoyListeners.forEach((function(t){e.checkdragDown(t,s)}))}}},JoyStick.prototype.upHandler=function(t){var e=this;this.btn.x=this.bg.x,this.btn.y=this.bg.y,this.mDown=!1,this.parentCon.visible=!1,this.mScene.input.off("pointermove",this.pointerMove,this),this.mWorld.inputManager.enable&&this.mJoyListeners.forEach((function(t){e.checkdragUp()&&t.upHandler()}))},JoyStick.prototype.checkdragDown=function(t,e){var i,r=[],s=.125*Math.PI;if(e>-s&&e<=s?(i=o.a.east,n.a.getInstance().log("dir:Direction.east")):e>s&&e<=3*s?(i=o.a.east_north,n.a.getInstance().log("dir:Direction.east_north")):e>3*s&&e<=5*s?(i=o.a.north,n.a.getInstance().log("dir:Direction.north")):e>5*s&&e<=7*s?(i=o.a.north_west,n.a.getInstance().log("dir:Direction.nroth_west")):e>=7*s&&e<=Math.PI||e>=-Math.PI&&e<-7*s?(i=o.a.west,n.a.getInstance().log("dir:Direction.west")):e<-5*s&&e>=-7*s?(i=o.a.west_south,n.a.getInstance().log("dir:Direction.west_south")):e>-5*s&&e<=-3*s?(i=o.a.south,n.a.getInstance().log("dir:Direction.south")):e>-3*s&&e<=-s&&(i=o.a.south_east,n.a.getInstance().log("dir:Direction.south_east")),void 0!==i)return r=this.getKeys(i),this.mdownStr!==r.toString()&&(this.mdownStr=r.toString(),t.downHandler(i,r),this.mWorld.roomManager.currentRoom.playerManager.actor.setDirection(i),!0)},JoyStick.prototype.getKeys=function(t){var e=this.mKeyCodes[t];if(e)return e;switch(t){case 0:e=this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_UP);break;case 1:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_UP).concat,this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_LEFT));break;case 2:e=this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_LEFT);break;case 3:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_DOWN),this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_LEFT));break;case 4:e=this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_DOWN);break;case 5:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_DOWN),this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_RIGHT));break;case 6:e=this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_RIGHT);break;case 7:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_UP),this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_RIGHT))}return this.mKeyCodes[t]=e,e},JoyStick.prototype.checkdragUp=function(){return this.mdownStr="",!0},JoyStick}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n=i(142),o=i(0),r=i(2),s=i(143),a=i(111),h=function(){function ElementStorage(){this.mModels=new Map,this.mElementRef=new Map,this.terrainPalette=new Map,this.terrainPaletteWithBindId=new Map,this.mossPalette=new Map,this.event=new Phaser.Events.EventEmitter}return ElementStorage.prototype.on=function(t,e,i){this.event.on(t,e,i)},ElementStorage.prototype.off=function(t,e,i){this.event.off(t,e,i)},ElementStorage.prototype.setGameConfig=function(t){if(o.a.getInstance().log("TCL: ElementStorage -> config",t),t){for(var e=null,i=0,a=t.objectsList;i<a.length;i++){var h=a[i];if(h.type===r.op_def.NodeType.ElementNodeType){if(!(e=this.mModels.get(h.id))){for(var c=[],l=h.animations,p=0,d=l.animationData;p<d.length;p++){var m=d[p];c.push(new s.a(m.createProtocolObject()))}e=new n.a({id:h.id,sn:h.sn,animations:{defaultAnimationName:l.defaultAnimationName,display:l.display,animationData:c}}),this.mModels.set(h.id,e)}var u={id:h.id,displayModel:e};this.mElementRef.set(h.id,u)}}this.updatePalette(t.root.palette),this.updateMoss(t.root.moss),this.updateAssets(t.root.assets)}},ElementStorage.prototype.updatePalette=function(t){for(var e=0,i=Array.from(t.peersDict.keys());e<i.length;e++){var o=i[e],r=t.peersDict.get(o);if(!this.terrainPalette.get(r.id)){var a=new n.a({id:r.id,sn:r.sn,animations:{defaultAnimationName:r.animations.defaultAnimationName,display:r.animations.display,animationData:r.animations.animationData.map((function(t){return new s.a(t.createProtocolObject())}))}});this.terrainPalette.set(o,a),this.terrainPaletteWithBindId.set(r.id,a)}}},ElementStorage.prototype.updateMoss=function(t){for(var e=0,i=Array.from(t.peersDict.keys());e<i.length;e++){var o=i[e],r=t.peersDict.get(o);if(!this.mossPalette.get(r.id)){var a=new n.a({id:r.id,sn:r.sn,animations:{defaultAnimationName:r.animations.defaultAnimationName,display:r.animations.display,animationData:r.animations.animationData.map((function(t){return new s.a(t.createProtocolObject())}))}});this.mossPalette.set(o,a)}}},ElementStorage.prototype.updateAssets=function(t){var e=t.getAssetList();this._assets=[];for(var i=0,n=e;i<n.length;i++){var o=n[i],r=o.media;if(r){var s=r.match(/\.([a-zA-Z0-9]+)($|\?)/);s&&s[1]&&this._assets.push({type:s[1],key:o.key,source:a.i.getOsdRes(r)})}}},ElementStorage.prototype.setSceneConfig=function(t){for(var e=null,i=0,o=t.objectsList;i<o.length;i++){var a=o[i];if(a.type===r.op_def.NodeType.ElementNodeType){if(!(e=this.mModels.get(a.id))){for(var h=[],c=a.animations,l=0,p=c.animationData;l<p.length;l++){var d=p[l];h.push(new s.a(d.createProtocolObject()))}e=new n.a({id:a.id,sn:a.sn,animations:{defaultAnimationName:c.defaultAnimationName,display:c.display,animationData:h}}),this.mModels.set(a.id,e)}var m={id:a.id,displayModel:e};this.mElementRef.set(a.id,m)}}var u=t.root.children.find((function(t){return t.type===r.op_def.NodeType.SceneNodeType}));this._terrainCollection=u.terrainCollection,this._mossCollection=u.mossCollection,this._scenerys=u.getScenerys()},ElementStorage.prototype.add=function(t){this.mModels.set(t.id,t)},ElementStorage.prototype.getDisplayModel=function(t){var e=this.mElementRef.get(t);if(e)return e.displayModel},ElementStorage.prototype.getTerrainCollection=function(){return this._terrainCollection},ElementStorage.prototype.getTerrainPalette=function(t){if(this.terrainPalette.get(t))return this.terrainPalette.get(t)},ElementStorage.prototype.getTerrainPaletteByBindId=function(t){if(this.terrainPaletteWithBindId.get(t))return this.terrainPaletteWithBindId.get(t)},ElementStorage.prototype.getMossCollection=function(){return this._mossCollection},ElementStorage.prototype.getMossPalette=function(t){if(this.mossPalette.get(t))return this.mossPalette.get(t)},ElementStorage.prototype.getScenerys=function(){return this._scenerys},ElementStorage.prototype.getAssets=function(){return this._assets},ElementStorage.prototype.destroy=function(){this.mElementRef.clear(),this.terrainPalette.clear(),this.terrainPaletteWithBindId.clear(),this.mossPalette.clear(),this.mModels.forEach((function(t,e){t.destroy()})),this.mModels.clear(),this._assets=void 0},ElementStorage}()},function(t,e,i){"use strict";function load(t,e){return new Promise((function(i,n){var o=new XMLHttpRequest;o.onload=function(t){i(t.currentTarget)},o.onerror=function(){n(t+" load error")},o.open("GET",t),o.responseType=e||"",o.send()}))}i.d(e,"a",(function(){return load}))},function(t,e,i){var n={"./Activity/ActivityMediator":210,"./Activity/ActivityMediator.ts":210,"./Activity/ActivityPanel":211,"./Activity/ActivityPanel.ts":211,"./Bubble/InteractionBubbleCell":330,"./Bubble/InteractionBubbleCell.ts":330,"./Bubble/InteractionBubbleContainer":249,"./Bubble/InteractionBubbleContainer.ts":249,"./Bubble/InteractiveBubble":250,"./Bubble/InteractiveBubble.ts":250,"./Bubble/InteractiveBubbleMediator":247,"./Bubble/InteractiveBubbleMediator.ts":247,"./Bubble/InteractiveBubblePanel":248,"./Bubble/InteractiveBubblePanel.ts":248,"./CharacterInfo/CharacterAttributePanel":258,"./CharacterInfo/CharacterAttributePanel.ts":258,"./CharacterInfo/CharacterEditorPanel":257,"./CharacterInfo/CharacterEditorPanel.ts":257,"./CharacterInfo/CharacterInfo":252,"./CharacterInfo/CharacterInfo.ts":252,"./CharacterInfo/CharacterInfoMediator":251,"./CharacterInfo/CharacterInfoMediator.ts":251,"./CharacterInfo/CharacterInfoPanel":256,"./CharacterInfo/CharacterInfoPanel.ts":256,"./CharacterInfo/GraphicsProgressBar":345,"./CharacterInfo/GraphicsProgressBar.ts":345,"./CharacterInfo/GridLayoutGroup":346,"./CharacterInfo/GridLayoutGroup.ts":346,"./ComponentRank/ComponentRankMediator":259,"./ComponentRank/ComponentRankMediator.ts":259,"./ComponentRank/ComponentRankPanel":260,"./ComponentRank/ComponentRankPanel.ts":260,"./Compose/Compose":224,"./Compose/Compose.ts":224,"./Compose/ComposeMediator":222,"./Compose/ComposeMediator.ts":222,"./Compose/ComposePanel":223,"./Compose/ComposePanel.ts":223,"./ControlF/ControlFMediator":347,"./ControlF/ControlFMediator.ts":347,"./ControlF/ControlFPanel":261,"./ControlF/ControlFPanel.ts":261,"./CutIn/CutInMediator":348,"./CutIn/CutInMediator.ts":348,"./CutIn/CutInPanel":262,"./CutIn/CutInPanel.ts":262,"./CutInMenu/CutInMenu":263,"./CutInMenu/CutInMenu.ts":263,"./CutInMenu/CutInMenuMediator":349,"./CutInMenu/CutInMenuMediator.ts":349,"./CutInMenu/CutInMenuPanel":264,"./CutInMenu/CutInMenuPanel.ts":264,"./DebugLogger/DebugLoggerMediator":167,"./DebugLogger/DebugLoggerMediator.ts":167,"./DebugLogger/DebugLoggerPanel":265,"./DebugLogger/DebugLoggerPanel.ts":265,"./DecorateControl/DecorateControlMediator":208,"./DecorateControl/DecorateControlMediator.ts":208,"./DecorateControl/DecorateControlPanel":209,"./DecorateControl/DecorateControlPanel.ts":209,"./Dialog/Dialog":266,"./Dialog/Dialog.ts":266,"./Dialog/DialogMediator":350,"./Dialog/DialogMediator.ts":350,"./Dialog/DialogPanel":267,"./Dialog/DialogPanel.ts":267,"./ElementStorage/DragManager":351,"./ElementStorage/DragManager.ts":351,"./ElementStorage/ElementStorageMediator":163,"./ElementStorage/ElementStorageMediator.ts":163,"./ElementStorage/ElementStoragePanel":197,"./ElementStorage/ElementStoragePanel.ts":197,"./ElementStorage/ElementStorate":199,"./ElementStorage/ElementStorate.ts":199,"./ElementStorage/item/Item":198,"./ElementStorage/item/Item.ts":198,"./EquipUpgrade/EquipUpgrade":231,"./EquipUpgrade/EquipUpgrade.ts":231,"./EquipUpgrade/EquipUpgradeItem":230,"./EquipUpgrade/EquipUpgradeItem.ts":230,"./EquipUpgrade/EquipUpgradeMediator":228,"./EquipUpgrade/EquipUpgradeMediator.ts":228,"./EquipUpgrade/EquipUpgradePanel":229,"./EquipUpgrade/EquipUpgradePanel.ts":229,"./FriendInvite/FriendInviteMediator":352,"./FriendInvite/FriendInviteMediator.ts":352,"./FriendInvite/FriendInvitePanel":268,"./FriendInvite/FriendInvitePanel.ts":268,"./FurniBag/FurniBag":269,"./FurniBag/FurniBag.ts":269,"./FurniBag/FurniBagMediator":353,"./FurniBag/FurniBagMediator.ts":353,"./FurniBag/FurniBagPanel":270,"./FurniBag/FurniBagPanel.ts":270,"./GMTools/GMToolsMediator":354,"./GMTools/GMToolsMediator.ts":354,"./GMTools/GMToolsPanel":271,"./GMTools/GMToolsPanel.ts":271,"./InfoPanel/InfoPanel":272,"./InfoPanel/InfoPanel.ts":272,"./InfoPanel/InfoPanelMediator":273,"./InfoPanel/InfoPanelMediator.ts":273,"./InteractivePanel/InteractivePanel":274,"./InteractivePanel/InteractivePanel.ts":274,"./InteractivePanel/InteractivePanelMediator":275,"./InteractivePanel/InteractivePanelMediator.ts":275,"./ItemDetail/ItemDetail":276,"./ItemDetail/ItemDetail.ts":276,"./ItemDetail/ItemDetailMediator":355,"./ItemDetail/ItemDetailMediator.ts":355,"./ItemPopCard/ItemPopCardMediator":356,"./ItemPopCard/ItemPopCardMediator.ts":356,"./ItemPopCard/ItemPopCardPanel":277,"./ItemPopCard/ItemPopCardPanel.ts":277,"./Login/LoginMediator":357,"./Login/LoginMediator.ts":357,"./Login/LoginPanel":278,"./Login/LoginPanel.ts":278,"./Login/VerifiedPanel":279,"./Login/VerifiedPanel.ts":279,"./Market/DetailDisplay":130,"./Market/DetailDisplay.ts":130,"./Market/ElementDetail":234,"./Market/ElementDetail.ts":234,"./Market/Market":237,"./Market/Market.ts":237,"./Market/MarketMediator":232,"./Market/MarketMediator.ts":232,"./Market/MarketPanel":233,"./Market/MarketPanel.ts":233,"./Market/NumberCounter":235,"./Market/NumberCounter.ts":235,"./Market/item":236,"./Market/item.ts":236,"./MessageBox/MessageBoxMediator":358,"./MessageBox/MessageBoxMediator.ts":358,"./MessageBox/MessageBoxView":280,"./MessageBox/MessageBoxView.ts":280,"./MineCar/MineCar":218,"./MineCar/MineCar.ts":218,"./MineCar/MineCarMediator":216,"./MineCar/MineCarMediator.ts":216,"./MineCar/MineCarPanel":217,"./MineCar/MineCarPanel.ts":217,"./MineSettle/MineSettle":227,"./MineSettle/MineSettle.ts":227,"./MineSettle/MineSettleMediator":225,"./MineSettle/MineSettleMediator.ts":225,"./MineSettle/MineSettlePanel":226,"./MineSettle/MineSettlePanel.ts":226,"./Notice/Notice":191,"./Notice/Notice.ts":191,"./Notice/NoticeMediator":189,"./Notice/NoticeMediator.ts":189,"./Notice/NoticePanel":190,"./Notice/NoticePanel.ts":190,"./PicBusinessMarketingPlan/PicBusinessChoosePlanPanel":281,"./PicBusinessMarketingPlan/PicBusinessChoosePlanPanel.ts":281,"./PicBusinessMarketingPlan/PicBusinessMarketingPlan":282,"./PicBusinessMarketingPlan/PicBusinessMarketingPlan.ts":282,"./PicBusinessMarketingPlan/PicBusinessMarketingPlanMediator":359,"./PicBusinessMarketingPlan/PicBusinessMarketingPlanMediator.ts":359,"./PicBusinessMarketingPlan/PicBusinessMarketingPlanPanel":283,"./PicBusinessMarketingPlan/PicBusinessMarketingPlanPanel.ts":283,"./PicBusinessMarketingPlan/PicBusinessPlanPanel":284,"./PicBusinessMarketingPlan/PicBusinessPlanPanel.ts":284,"./PicBusinessStreet/PicBusinessContentPanel":168,"./PicBusinessStreet/PicBusinessContentPanel.ts":168,"./PicBusinessStreet/PicBusinessHistoryPanel":285,"./PicBusinessStreet/PicBusinessHistoryPanel.ts":285,"./PicBusinessStreet/PicBusinessMyStreetPanel":286,"./PicBusinessStreet/PicBusinessMyStreetPanel.ts":286,"./PicBusinessStreet/PicBusinessRankRewardPanel":287,"./PicBusinessStreet/PicBusinessRankRewardPanel.ts":287,"./PicBusinessStreet/PicBusinessRankingDetailPanel":288,"./PicBusinessStreet/PicBusinessRankingDetailPanel.ts":288,"./PicBusinessStreet/PicBusinessRankingPanel":289,"./PicBusinessStreet/PicBusinessRankingPanel.ts":289,"./PicBusinessStreet/PicBusinessStoreCreatePanel":290,"./PicBusinessStreet/PicBusinessStoreCreatePanel.ts":290,"./PicBusinessStreet/PicBusinessStreet":291,"./PicBusinessStreet/PicBusinessStreet.ts":291,"./PicBusinessStreet/PicBusinessStreetListPanel":292,"./PicBusinessStreet/PicBusinessStreetListPanel.ts":292,"./PicBusinessStreet/PicBusinessStreetMediator":360,"./PicBusinessStreet/PicBusinessStreetMediator.ts":360,"./PicBusinessStreet/PicBusinessStreetPanel":294,"./PicBusinessStreet/PicBusinessStreetPanel.ts":294,"./PicBusinessStreet/SecondaryMenuPanel":293,"./PicBusinessStreet/SecondaryMenuPanel.ts":293,"./PicFriend/PicFriend":255,"./PicFriend/PicFriend.ts":255,"./PicFriend/PicFriendEvent":151,"./PicFriend/PicFriendEvent.ts":151,"./PicFriend/PicFriendMediator":253,"./PicFriend/PicFriendMediator.ts":253,"./PicFriend/PicFriendPanel":254,"./PicFriend/PicFriendPanel.ts":254,"./PicFriend/PicFriendRelation":139,"./PicFriend/PicFriendRelation.ts":139,"./PicFurniFun/PicFurniFun":244,"./PicFurniFun/PicFurniFun.ts":244,"./PicFurniFun/PicFurniFunMediator":242,"./PicFurniFun/PicFurniFunMediator.ts":242,"./PicFurniFun/PicFurniFunPanel":243,"./PicFurniFun/PicFurniFunPanel.ts":243,"./PicHandheld/PicHandheld":245,"./PicHandheld/PicHandheld.ts":245,"./PicHandheld/PicHandheldMediator":166,"./PicHandheld/PicHandheldMediator.ts":166,"./PicHandheld/PicHandheldPanel":246,"./PicHandheld/PicHandheldPanel.ts":246,"./PicHouse/PicHouse":295,"./PicHouse/PicHouse.ts":295,"./PicHouse/PicHouseInfoPanel":296,"./PicHouse/PicHouseInfoPanel.ts":296,"./PicHouse/PicHouseMediator":361,"./PicHouse/PicHouseMediator.ts":361,"./PicHouse/PicHousePanel":297,"./PicHouse/PicHousePanel.ts":297,"./PicHouse/PicHouseSettingPanel":362,"./PicHouse/PicHouseSettingPanel.ts":362,"./PicOpenParty/PicOpenParty":299,"./PicOpenParty/PicOpenParty.ts":299,"./PicOpenParty/PicOpenPartyCreatePanel":300,"./PicOpenParty/PicOpenPartyCreatePanel.ts":300,"./PicOpenParty/PicOpenPartyMediator":363,"./PicOpenParty/PicOpenPartyMediator.ts":363,"./PicOpenParty/PicOpenPartyPanel":301,"./PicOpenParty/PicOpenPartyPanel.ts":301,"./PicOpenParty/PicOpenPartySettingPanel":364,"./PicOpenParty/PicOpenPartySettingPanel.ts":364,"./PicOrder/PicOrder":302,"./PicOrder/PicOrder.ts":302,"./PicOrder/PicOrderMediator":365,"./PicOrder/PicOrderMediator.ts":365,"./PicOrder/PicOrderPanel":303,"./PicOrder/PicOrderPanel.ts":303,"./PicPartyList/PicPartyList":304,"./PicPartyList/PicPartyList.ts":304,"./PicPartyList/PicPartyListMediator":366,"./PicPartyList/PicPartyListMediator.ts":366,"./PicPartyList/PicPartyListPanel":305,"./PicPartyList/PicPartyListPanel.ts":305,"./PicPartyList/PicPartyNavigationPanel":306,"./PicPartyList/PicPartyNavigationPanel.ts":306,"./PicPropFun/PicPropFunConfig":367,"./PicPropFun/PicPropFunConfig.ts":367,"./PicPropFun/PicPropFunMediator":368,"./PicPropFun/PicPropFunMediator.ts":368,"./PicPropFun/PicPropFunPanel":307,"./PicPropFun/PicPropFunPanel.ts":307,"./PicRoomUpgrade/PicRoomUpgrade":308,"./PicRoomUpgrade/PicRoomUpgrade.ts":308,"./PicRoomUpgrade/PicRoomUpgradeMediator":369,"./PicRoomUpgrade/PicRoomUpgradeMediator.ts":369,"./PicRoomUpgrade/PicRoomUpgradePanel":309,"./PicRoomUpgrade/PicRoomUpgradePanel.ts":309,"./PicWork/PicWork":310,"./PicWork/PicWork.ts":310,"./PicWork/PicWorkMediator":370,"./PicWork/PicWorkMediator.ts":370,"./PicWork/PicWorkPanel":311,"./PicWork/PicWorkPanel.ts":311,"./PicaChat/PicChatInputPanel":213,"./PicaChat/PicChatInputPanel.ts":213,"./PicaChat/PicGiftPanel":214,"./PicaChat/PicGiftPanel.ts":214,"./PicaChat/PicaChat":215,"./PicaChat/PicaChat.ts":215,"./PicaChat/PicaChatMediator":148,"./PicaChat/PicaChatMediator.ts":148,"./PicaChat/PicaChatPanel":212,"./PicaChat/PicaChatPanel.ts":212,"./PicaMainUI/PicaMainUI":241,"./PicaMainUI/PicaMainUI.ts":241,"./PicaMainUI/PicaMainUIMediator":238,"./PicaMainUI/PicaMainUIMediator.ts":238,"./PicaMainUI/PicaMainUIPanel":239,"./PicaMainUI/PicaMainUIPanel.ts":239,"./PicaMessageBox/PicaMessageBoxMediator":371,"./PicaMessageBox/PicaMessageBoxMediator.ts":371,"./PicaMessageBox/PicaMessageBoxPanel":312,"./PicaMessageBox/PicaMessageBoxPanel.ts":312,"./PicaNavigate/PicaNavigate":313,"./PicaNavigate/PicaNavigate.ts":313,"./PicaNavigate/PicaNavigateMediator":372,"./PicaNavigate/PicaNavigateMediator.ts":372,"./PicaNavigate/PicaNavigatePanel":314,"./PicaNavigate/PicaNavigatePanel.ts":314,"./PicaNotice/PicaNoticeMediator":373,"./PicaNotice/PicaNoticeMediator.ts":373,"./PicaNotice/PicaNoticePanel":315,"./PicaNotice/PicaNoticePanel.ts":315,"./PicaRoomList/PicaRoomListMediator":374,"./PicaRoomList/PicaRoomListMediator.ts":374,"./PicaRoomList/PicaRoomListPanel":316,"./PicaRoomList/PicaRoomListPanel.ts":316,"./PicaRoomList/RoomList":317,"./PicaRoomList/RoomList.ts":317,"./Rank/BasicRankPanel":160,"./Rank/BasicRankPanel.ts":160,"./Rank/RankMediator":147,"./Rank/RankMediator.ts":147,"./Rank/RankPanel":194,"./Rank/RankPanel.ts":194,"./ReAwardTips/ReAwardTip":220,"./ReAwardTips/ReAwardTip.ts":220,"./ReAwardTips/ReAwardTipsMediator":219,"./ReAwardTips/ReAwardTipsMediator.ts":219,"./ReAwardTips/ReAwardTipsPanel":221,"./ReAwardTips/ReAwardTipsPanel.ts":221,"./Shop/ShopMediator":318,"./Shop/ShopMediator.ts":318,"./Shop/ShopPanel":319,"./Shop/ShopPanel.ts":319,"./Shop/shop.itemSlot":331,"./Shop/shop.itemSlot.ts":331,"./Task/Task":320,"./Task/Task.ts":320,"./Task/TaskMediator":375,"./Task/TaskMediator.ts":375,"./Task/TaskPanel":321,"./Task/TaskPanel.ts":321,"./UserInfo/UserInfoMediator":322,"./UserInfo/UserInfoMediator.ts":322,"./UserInfo/UserInfoPanel":323,"./UserInfo/UserInfoPanel.ts":323,"./UserMenu/MenuItem":324,"./UserMenu/MenuItem.ts":324,"./UserMenu/UserMenuMediator":376,"./UserMenu/UserMenuMediator.ts":376,"./UserMenu/UserMenuPanel":377,"./UserMenu/UserMenuPanel.ts":377,"./alert/PopUpTextUI":378,"./alert/PopUpTextUI.ts":378,"./bag/IListItemRender":379,"./bag/IListItemRender.ts":379,"./bag/bagView/bagMediator":132,"./bag/bagView/bagMediator.ts":132,"./bag/bagView/bagPanel":192,"./bag/bagView/bagPanel.ts":192,"./bag/basebag":380,"./bag/basebag.ts":380,"./bag/baseitem":381,"./bag/baseitem.ts":381,"./bag/dragDropIcon":145,"./bag/dragDropIcon.ts":145,"./bag/idragable":382,"./bag/idragable.ts":382,"./bag/idropable":383,"./bag/idropable.ts":383,"./bag/item.slot":133,"./bag/item.slot.ts":133,"./bag/storage/storageMediator":325,"./bag/storage/storageMediator.ts":325,"./bag/storage/storagePanel":326,"./bag/storage/storagePanel.ts":326,"./baseView/bagGroup/bag.group":204,"./baseView/bagGroup/bag.group.mediator":203,"./baseView/bagGroup/bag.group.mediator.ts":203,"./baseView/bagGroup/bag.group.ts":204,"./baseView/baseFace.mediator":134,"./baseView/baseFace.mediator.ts":134,"./baseView/bottomGroup/bottom.btn.group":196,"./baseView/bottomGroup/bottom.btn.group.ts":196,"./baseView/bottomGroup/bottom.mediator":162,"./baseView/bottomGroup/bottom.mediator.ts":162,"./baseView/icon.btn":124,"./baseView/icon.btn.ts":124,"./baseView/icon.select.btn":202,"./baseView/icon.select.btn.ts":202,"./baseView/leftGroup/left.btn.group":201,"./baseView/leftGroup/left.btn.group.ts":201,"./baseView/leftGroup/left.mediator":200,"./baseView/leftGroup/left.mediator.ts":200,"./baseView/rightGroup/right.btn.group":195,"./baseView/rightGroup/right.btn.group.ts":195,"./baseView/rightGroup/right.mediator":161,"./baseView/rightGroup/right.mediator.ts":161,"./baseView/top.menu/top.menu.container":206,"./baseView/top.menu/top.menu.container.ts":206,"./baseView/top.menu/top.menu.mediator":205,"./baseView/top.menu/top.menu.mediator.ts":205,"./baseView/topGroup/top.btn.group":327,"./baseView/topGroup/top.btn.group.ts":327,"./baseView/topGroup/top.mediator":384,"./baseView/topGroup/top.mediator.ts":384,"./chat/Chat":187,"./chat/Chat.ts":187,"./chat/base.chat.panel":157,"./chat/base.chat.panel.ts":157,"./chat/chat.mediator":144,"./chat/chat.mediator.ts":144,"./chat/chatPanel.pc":184,"./chat/chatPanel.pc.ts":184,"./chat/message":385,"./chat/message.ts":385,"./chat/mobile/chatPanel.mobile":186,"./chat/mobile/chatPanel.mobile.ts":186,"./components/BasePanel":112,"./components/BasePanel.ts":112,"./components/ItemsConsumeFunPanel":298,"./components/ItemsConsumeFunPanel.ts":298,"./components/LoadingView":386,"./components/LoadingView.ts":386,"./components/TextButton":150,"./components/TextButton.ts":150,"./components/alert.view":135,"./components/alert.view.ts":135,"./components/check.button":156,"./components/check.button.ts":156,"./components/checkbox.group":127,"./components/checkbox.group.ts":127,"./components/dynamic.image":116,"./components/dynamic.image.ts":116,"./components/dynamic.ninepatch":176,"./components/dynamic.ninepatch.ts":176,"./components/dynamic.sprite":174,"./components/dynamic.sprite.ts":174,"./components/input.panel":165,"./components/input.panel.ts":165,"./components/inputTextFactory":207,"./components/inputTextFactory.ts":207,"./components/label.input":149,"./components/label.input.ts":149,"./components/message.box":387,"./components/message.box.ts":387,"./components/nine.patch":117,"./components/nine.patch.ts":117,"./components/ninepatch.button":121,"./components/ninepatch.button.ts":121,"./components/patches.config":185,"./components/patches.config.ts":185,"./components/radio":164,"./components/radio.ts":164,"./components/tab.button":388,"./components/tab.button.ts":388,"./decorate/decorate.manager":181,"./decorate/decorate.manager.ts":181,"./decorate/decorate.panel":182,"./decorate/decorate.panel.ts":182,"./friend/friend.mediator":159,"./friend/friend.mediator.ts":159,"./friend/friend.panel":193,"./friend/friend.panel.ts":193,"./layer.manager":188,"./layer.manager.ts":188,"./loadview":389,"./loadview.ts":389,"./tips/ItemInfoTips":129,"./tips/ItemInfoTips.ts":129,"./tips/TextToolTip":240,"./tips/TextToolTip.ts":240,"./tips/itoolTip":390,"./tips/itoolTip.ts":390,"./tips/toolTip":158,"./tips/toolTip.ts":158,"./ui.atals.name":115,"./ui.atals.name.ts":115,"./ui.manager":183,"./ui.manager.ts":183,"./ui.mediatorType":125,"./ui.mediatorType.ts":125};function webpackContext(t){var e=webpackContextResolve(t);return i(e)}function webpackContextResolve(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}webpackContext.keys=function webpackContextKeys(){return Object.keys(n)},webpackContext.resolve=webpackContextResolve,t.exports=webpackContext,webpackContext.id=414},,function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n,o=i(128),r=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function LoginScene(){return t.call(this,{key:LoginScene.name})||this}return r(LoginScene,t),LoginScene.prototype.preload=function(){},LoginScene.prototype.create=function(){if(this.world){var t=this.world.uiManager;t.setScene(this),t.showMed("Login")}},LoginScene.prototype.init=function(t){t&&(this.world=t.world)},LoginScene}(o.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function Account(){}return Account.prototype.setAccount=function(t){this.mCurAccountData={id:t.id,fingerprint:t.fingerprint,refreshToken:t.refreshToken,expire:t.expire,accessToken:t.token||t.accessToken},this.saveLocalStorage()},Account.prototype.refreshToken=function(t){if(this.mCurAccountData){var e=t.newExpire,i=t.newFingerprint,n=t.newToken;this.mCurAccountData.expire=e,this.mCurAccountData.fingerprint=i,this.mCurAccountData.accessToken=n,this.saveLocalStorage()}},Account.prototype.saveLocalStorage=function(){if(this.mCurAccountData){var t=this.mCurAccountData,e=t.id,i=t.fingerprint,n=t.refreshToken,o=t.expire,r=t.accessToken;localStorage.setItem("token",JSON.stringify({id:e,fingerprint:i,refreshToken:n,expire:o,accessToken:r}))}},Account.prototype.clear=function(){this.mCurAccountData={accessToken:"",expire:0,fingerprint:"",id:"",refreshToken:""}},Account.prototype.destroy=function(){this.clear(),localStorage.removeItem("token"),this.enterGame(void 0,void 0,void 0,void 0)},Object.defineProperty(Account.prototype,"accountData",{get:function(){return this.mCurAccountData},enumerable:!1,configurable:!0}),Account.prototype.enterGame=function(t,e,i,n){this.mGameId=t,this.mVirtualWorldId=e,this.mSceneID=i,this.mLoc=n},Object.defineProperty(Account.prototype,"gameID",{get:function(){return this.mGameId},enumerable:!1,configurable:!0}),Object.defineProperty(Account.prototype,"virtualWorldId",{get:function(){return this.mVirtualWorldId},enumerable:!1,configurable:!0}),Object.defineProperty(Account.prototype,"sceneId",{get:function(){return this.mSceneID},enumerable:!1,configurable:!0}),Object.defineProperty(Account.prototype,"loc",{get:function(){return this.mLoc},enumerable:!1,configurable:!0}),Account}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function HttpService(t){this.mWorld=t,this.api_root=this.mWorld.getConfig().api_root}return HttpService.prototype.follow=function(t){return this.post("user/follow",{fuid:t})},HttpService.prototype.unfollow=function(t){return this.post("user/unfollow",{fuid:t})},HttpService.prototype.banUser=function(t){return this.post("user/ban",{fuid:t})},HttpService.prototype.removeBanUser=function(t){return this.post("user/unban",{fuid:t})},HttpService.prototype.checkFollowed=function(t){return this.post("user/check_followed",{uids:t})},HttpService.prototype.login=function(t,e){return fetch(this.mWorld.getConfig().api_root+"account/signin",{body:JSON.stringify({account:t,password:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(t){return t.json()}))},HttpService.prototype.requestPhoneCode=function(t,e){return fetch(this.api_root+"account/sms_code",{body:JSON.stringify({phone:t,areaCode:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(t){return t.json()}))},HttpService.prototype.tokenCheck=function(){return this.get("account/tokencheck")},HttpService.prototype.refreshToekn=function(t,e){return this.post("account/refresh_token",{refreshToken:t,token:e})},HttpService.prototype.loginByPhoneCode=function(t,e,i){return fetch(this.api_root+"account/phone_signin",{body:JSON.stringify({phone:t,code:e,areaCode:i}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(t){return t.json()}))},HttpService.prototype.quickLogin=function(){return fetch(this.api_root+"account/quick_signin",{method:"POST"}).then((function(t){return t.json()}))},HttpService.prototype.verified=function(t,e){return this.post("game/real_name_authentication",{realName:t,identifcationCode:e})},HttpService.prototype.firend=function(){return this.get("user/friends")},HttpService.prototype.userDetail=function(t){return this.get("account/"+t+"/detail")},HttpService.prototype.badgecards=function(t){return this.get("userpackage/"+t+"/badgecards")},HttpService.prototype.playedDuration=function(t,e){return this.post("game/played_duration",{gameId:e},{"App-Key":t})},HttpService.prototype.post=function(t,e,i){var n=this.mWorld.account;if(!n)return Promise.reject("account does not exist");if(!n.accountData)return Promise.reject("token does not exist");i=Object.assign({"Content-Type":"application/json","X-Pixelpai-TK":n.accountData.accessToken},i);var o={body:JSON.stringify(e),method:"POST",headers:i};return fetch(""+this.api_root+t,o).then((function(t){return t.json()}))},HttpService.prototype.get=function(t){var e=this.mWorld.account;if(!e)return Promise.reject("account does not exist");if(!e.accountData)return Promise.reject("token does not exist");var i={method:"GET",headers:{"X-Pixelpai-TK":e.accountData.accessToken}};return fetch(""+this.api_root+t,i).then((function(t){return t.json()}))},HttpService}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n,o=i(111),r=i(179),s=i(128),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function GamePauseScene(){return t.call(this,{key:GamePauseScene.name})||this}return a(GamePauseScene,t),GamePauseScene.prototype.preload=function(){this.load.image("gamepause.png",o.i.getRes("gamepause.png"))},GamePauseScene.prototype.init=function(t){this.mWorld=t.world},GamePauseScene.prototype.create=function(){var t=this.scale.gameSize.width,e=this.scale.gameSize.height;this.bg=this.add.graphics(),this.bg.fillStyle(0,.8),this.bg.fillRect(0,0,t,e),this.pauseImg=this.add.image(t>>1,e>>1,"gamepause.png"),this.tipTF=this.add.text(t-240>>1,e-50,"点击任意位置开始游戏",{font:"30px Tahoma"}),this.scale.on("resize",this.checkSize,this),this.checkSize(new r.a(t,e)),this.input.on("pointerdown",this.downHandler,this)},GamePauseScene.prototype.awake=function(){this.scale.on("resize",this.checkSize,this),this.input.on("pointerdown",this.downHandler,this),this.scene.wake()},GamePauseScene.prototype.sleep=function(){this.scale.off("resize",this.checkSize,this),this.input.off("pointerdown",this.downHandler,this),this.scene.sleep()},GamePauseScene.prototype.getKey=function(){return this.sys.config.key},GamePauseScene.prototype.downHandler=function(){this.mWorld.onFocus()},GamePauseScene.prototype.checkSize=function(t){var e=t.width,i=t.height;this.bg.clear(),this.bg.fillStyle(0,.8),this.bg.fillRect(0,0,e,i),this.pauseImg.scaleX=this.pauseImg.scaleY=.7*this.mWorld.uiScale,this.pauseImg.x=e>>1,this.pauseImg.y=i>>1,this.tipTF.scaleX=this.tipTF.scaleY=this.mWorld.uiScale,this.tipTF.x=e-280*this.mWorld.uiScale>>1,this.tipTF.y=i-50*this.mWorld.uiScale},GamePauseScene}(s.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n,o,r=i(0),s=i(110),a=i(2),h=i(111),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.Background=0]="Background",t[t.Element=1]="Element",t[t.Effect=2]="Effect"}(o||(o={}));var l=function(t){function SoundManager(e){var i=t.call(this)||this;return i.world=e,i}return c(SoundManager,t),SoundManager.prototype.addPackListener=function(){var t=this.world.connection;t&&(t.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SOUND_CTL,this.onPlaySoundHandler))},SoundManager.prototype.removePacketListener=function(){var t=this.world.connection;t&&t.removePacketListener(this)},SoundManager.prototype.changeRoom=function(t){this.mSoundMap&&this.mSoundMap.clear(),this.mSoundMap=new Map,this.mScene=t.scene},SoundManager.prototype.play=function(t){if(this.mScene){var e=t.key;e||(e=Array.isArray(t.urls)?t.urls.join(""):t.urls);var i=t.field||o.Background,n=this.mSoundMap.get(i);n||(n=new p(this.mScene),this.mSoundMap.set(i,n)),n.play(e,t.urls,t.soundConfig)}else r.a.getInstance().fatal(SoundManager.name+" scene does not exist. play "+t.key+" fatal")},SoundManager.prototype.stop=function(t){if(this.mScene){var e=this.mSoundMap.get(t);e&&e.stop()}else r.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't stop")},SoundManager.prototype.pause=function(t){if(this.mScene){var e=this.mSoundMap.get(t);e&&e.pause()}else r.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't pause")},SoundManager.prototype.resumes=function(t){if(this.mScene){var e=this.mSoundMap.get(t);e&&e.resume()}else r.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't resume")},SoundManager.prototype.stopAll=function(){this.mScene?this.mSoundMap.forEach((function(t){t&&t.stop()})):r.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't stopAll")},SoundManager.prototype.pauseAll=function(){this.mScene?this.mSoundMap.forEach((function(t){t&&t.pause()})):r.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't pauseAll")},SoundManager.prototype.resume=function(){this.mScene?this.mSoundMap.forEach((function(t){t&&t.resume()})):r.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't resumeAll")},SoundManager.prototype.destroy=function(){this.mSoundMap&&(this.mSoundMap.forEach((function(t){t&&t.destroy()})),this.mSoundMap.clear(),this.mSoundMap=void 0),this.removePacketListener()},SoundManager.prototype.onPlaySoundHandler=function(t){var e=t.content;void 0===e.loop&&(e.loop=!0),this.play({key:e.soundKey,urls:h.i.getOsdRes(e.soundKey),field:e.scope,soundConfig:{loop:e.loop}})},SoundManager}(s.PacketHandler),p=function(){function Sound(t){this.scene=t}return Sound.prototype.sound=function(){return this.mSound},Sound.prototype.play=function(t,e,i){if(this.scene)if(this.mSound&&this.mSound.key===t){if(this.mSound.isPlaying)return;this.mSound.play()}else if(this.mKey=t,this.scene.cache.audio.exists(t))this.startPlay();else{if(!e)return;this.scene.load.once("filecomplete-audio-"+t,this.onSoundCompleteHandler,this),this.scene.load.audio(t,e),this.scene.load.start()}},Sound.prototype.pause=function(){if(this.scene)if(this.mSound){if(this.mSound.isPaused)return;this.mSound.pause()}else;},Sound.prototype.stop=function(){if(this.scene)if(this.mSound){if(!this.mSound.isPlaying)return;this.mSound.stop()}else;},Sound.prototype.resume=function(){if(this.scene)if(this.mSound){if(!this.mSound.isPaused)return;this.mSound.resume()}else;},Sound.prototype.destroy=function(){this.mSound&&(this.mSound.stop(),this.mSound.destroy(),this.mSound=void 0)},Sound.prototype.onSoundCompleteHandler=function(){this.startPlay()},Sound.prototype.startPlay=function(){this.mSound&&(this.mSound.stop(),this.mSound.destroy()),this.mSound=this.scene.sound.add(this.mKey),this.mSound.play()},Sound}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(131),__awaiter=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function fulfilled(t){try{step(n.next(t))}catch(t){r(t)}}function rejected(t){try{step(n.throw(t))}catch(t){r(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())}))},__generator=function(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function verb(r){return function(a){return function step(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},o=function(){function LoadingManager(t){this.world=t,this.mResources=[]}return LoadingManager.prototype.start=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i;return __generator(this,(function(o){return(e=this.game.scene)?((i=e.getScene(n.a.name))||e.add(n.a.name,n.a),i?i.awake({world:this.world,text:t,callBack:this.sceneCallback.bind(this)}):e.start(n.a.name,{world:this.world,text:t,callBack:this.sceneCallback.bind(this)}),[2]):[2,Promise.reject("start faild. SceneManager does not exist")]}))}))},LoadingManager.prototype.addAssets=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i,n;return __generator(this,(function(o){if(!this.scene)return[2];if(!t)return[2];for(e=0,i=t;e<i.length;e++)n=i[e],this.loadAsset(n);return[2,this.startup(this.scene)]}))}))},LoadingManager.prototype.startup=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i,n,o=this;return __generator(this,(function(r){for(this.scene=t,this.scene.load.once(Phaser.Loader.Events.COMPLETE,(function(){return o.mLoading=!1,o.mResources=[],Promise.resolve()})),e=0,i=this.mResources;e<i.length;e++)n=i[e],this.loadAsset(n);return this.scene.load.start(),this.mLoading=!0,[2]}))}))},LoadingManager.prototype.destroy=function(){this.mResources&&(this.mResources=[]),this.scene=void 0},LoadingManager.prototype.loadAsset=function(t){var e=this.getLoadType(t.type);this.scene.load[e]&&this.scene.load[e](t.key,t.source)},LoadingManager.prototype.sceneCallback=function(t){return this.scene=t,this.mResources.length>0?this.addAssets(this.mResources):Promise.resolve()},Object.defineProperty(LoadingManager.prototype,"game",{get:function(){if(this.world)return this.world.game},enumerable:!1,configurable:!0}),LoadingManager.prototype.getLoadType=function(t){return"mp3"===t||"wmv"===t||"ogg"===t?"audio":t},LoadingManager}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i(135),o=i(114),r=function(){function HttpClock(t){this.world=t,this.interval=6e4,this.mTimestamp=0,this.mEnable=!1,this.httpService=t.httpService}return HttpClock.prototype.update=function(t,e){!1!==this.mEnable&&(this.mTimestamp>this.interval&&(this.sync(),this.mTimestamp=0),this.mTimestamp+=e)},HttpClock.prototype.allowLogin=function(t){var e=this;return new Promise((function(i,n){e.fetch().then((function(o){var r=o.code,s=o.data;if(0===r){if(!e.allowedPeriod(s,t))return void i(!1);if(!e.checkTimeAllowed(s,t))return void i(!1);i(!0)}else n(o.msg)}))}))},HttpClock.prototype.fetch=function(){return this.world.httpService.playedDuration("831dab",this.world.getConfig().game_id)},HttpClock.prototype.sync=function(){var t=this;this.fetch().then((function(e){var i=e.code,n=e.data;0===i&&(t.checkTimeAllowed(n)&&t.allowedPeriod(n)||t.world.connection.closeConnect())}))},HttpClock.prototype.allowedPeriod=function(t,e){return!!t.in_allowed_period||(this.showAlert("[color=#ff0000][size="+14*this.world.uiRatio+"]您的账号属于未成年人[/size][/color]\n每日22:00~次日8:00是休息时间，根据相关规定，该时间不可登录游戏，请注意休息哦！",e),!1)},HttpClock.prototype.checkTimeAllowed=function(t,e){return!(t.time_played>=t.max_time_allowed)||(this.showAlert("[color=#ff0000][size="+14*this.world.uiRatio+"]您的账号属于未成年人[/size][/color]\n今日累计时长已超过"+(t.max_time_allowed/3600).toFixed(1)+"小时！\n不可登录",e),!1)},HttpClock.prototype.showAlert=function(t,e){var i=this.world.uiManager.getUILayerManager();new n.AlertView(i.scene,this.world).show({text:t,callback:e,btns:n.Buttons.Ok,title:o.a.t("common.tips")})},Object.defineProperty(HttpClock.prototype,"enable",{set:function(t){this.mEnable=t},enumerable:!1,configurable:!0}),HttpClock}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(114),o=function(){function LoadingTips(){}return LoadingTips.enterGame=function(){return n.a.t("loading.enter_game")},LoadingTips.downloadGameConfig=function(){return n.a.t("loading.downloading_config")},LoadingTips.downloadSceneConfig=function(){return n.a.t("loading.downloading_scene_config")},LoadingTips.parseConfig=function(){return n.a.t("loading.parse_config")},LoadingTips.waitEnterRoom=function(){return n.a.t("loading.wait_enter_room")},LoadingTips.loginGame=function(){return n.a.t("loading.logging")},LoadingTips}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n,o=i(179),r=i(111),s=i(0),a=i(128),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function LoginAccountScene(){return t.call(this,{key:LoginAccountScene.name})||this}return h(LoginAccountScene,t),LoginAccountScene.prototype.preload=function(){var t=2;this.mWorld&&(t=this.mWorld.uiRatio||2),this.load.image("avatar_placeholder",r.i.getRes("dragonbones/avatar.png")),this.load.atlas("curtain",r.i.getUIRes(t,"loading/curtain.png"),r.i.getUIRes(t,"loading/curtain.json")),this.load.atlas("loading",r.i.getRes("ui/loading/loading.png"),r.i.getRes("ui/loading/loading.json")),this.load.script("webfont","./resources/scripts/webfont/1.6.26/webfont.js")},LoginAccountScene.prototype.init=function(t){this.createFont(),this.mWorld=t.world,this.mCallback=t.callBack},LoginAccountScene.prototype.create=function(){var t=this;try{WebFont.load({custom:{families:["Source Han Sans","tt0173m_","tt0503m_","t04B25"]}})}catch(t){s.a.getInstance().warn("webfont failed to load")}var e=this.scale.gameSize.width,i=this.scale.gameSize.height;this.anims.create({key:"loading_anis",frames:this.anims.generateFrameNames("loading",{prefix:"loading_",start:1,end:3,zeroPad:1,suffix:".png"}),frameRate:5,repeat:-1});var n=this.mWorld.uiRatio;this.bg=this.add.sprite(.5*e,.5*i,"loading").setScale(this.mWorld.uiScale*n*2),this.bg.play("loading_anis"),this.checkSize(new o.a(e,i)),this.scale.on("resize",this.checkSize,this);var r=this.add.graphics();r.fillStyle(16763904,.8),r.fillRect(0,0,100,50),r.setInteractive(new Phaser.Geom.Rectangle(0,0,100,50),Phaser.Geom.Rectangle.Contains),r.x=200,r.y=300,r.on("pointerdown",(function(){t.mCallback&&(t.mCallback.call(t,t),t.mCallback=void 0)}),this)},LoginAccountScene.prototype.getKey=function(){return this.sys.config.key},LoginAccountScene.prototype.checkSize=function(t){},LoginAccountScene.prototype.createFont=function(){var t=document.createElement("style");document.head.appendChild(t);var e=t.sheet;e.insertRule("@font-face { font-family: 'tt0173m_'; src: url('./resources/fonts/en/tt0173m_.ttf') format('truetype');font-display:swap }\n",0),e.insertRule("@font-face { font-family: 'tt0503m_'; src: url('./resources/fonts/en/tt0503m_.ttf') format('truetype'); font-display:swap}\n",0),e.insertRule("@font-face { font-family: 't04B25'; src: url('./resources/fonts/04B.ttf') format('truetype'); font-display:swap}",0)},LoginAccountScene}(a.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return Gt}));var n,o,r=i(152),s=i(110),a=i(2),h=i(0),c=i(118),l=i(126),p=i(119),d=i(340),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=a.op_def.NodeType,f=function(t){function PlayerManager(e){var i=t.call(this)||this;return i.mRoom=e,i.hasAddComplete=!1,i.mPlayerMap=new Map,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,i.onAdd),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE_END,i.addComplete),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,i.onRemove),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,i.onAdjust),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MOVE_SPRITE,i.onMove),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_EFFECT,i.onShowEffect),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE,i.onOnlyBubbleHandler),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,i.onShowBubble),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE_CLEAN,i.onClearBubbleHandler),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SYNC_SPRITE,i.onSync),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_CHANGE_SPRITE_ANIMATION,i.onChangeAnimation),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SET_SPRITE_POSITION,i.onSetPosition),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MOVE_SPRITE_BY_PATH,i.onMovePath)),i}return m(PlayerManager,t),Object.defineProperty(PlayerManager.prototype,"actor",{get:function(){return this.mRoom.world.user},enumerable:!1,configurable:!0}),PlayerManager.prototype.destroy=function(){var t=this;this.mActor&&(this.mActor.destroy(),this.mActor=null),this.connection&&this.connection.removePacketListener(this),this.mPlayerMap&&(this.mPlayerMap.forEach((function(e){return t.removeFromMap(e.id)})),this.mPlayerMap.clear())},PlayerManager.prototype.removeFromMap=function(t){var e=this.mPlayerMap.get(t);e&&(this.mPlayerMap.delete(t),e.destroy())},PlayerManager.prototype.get=function(t){if(this.mPlayerMap){var e=this.mPlayerMap.get(t);if(!e){var i=this.actor;i&&i.id===t&&(e=i)}return e}},PlayerManager.prototype.add=function(t){},PlayerManager.prototype.remove=function(t){var e=this.mPlayerMap.get(t);return e&&(this.mPlayerMap.delete(t),e.destroy()),this.mActor&&(this.mActor.destroy(),this.mActor=null),e},PlayerManager.prototype.setMe=function(t){this.mActor=t,this.mPlayerMap.set(t.id,t)},PlayerManager.prototype.getElements=function(){return Array.from(this.mPlayerMap.values())},PlayerManager.prototype.set=function(t,e){this.mPlayerMap||(this.mPlayerMap=new Map),this.mPlayerMap.set(t,e)},Object.defineProperty(PlayerManager.prototype,"camera",{get:function(){return this.mRoom.cameraService.camera},enumerable:!1,configurable:!0}),PlayerManager.prototype.addPackItems=function(t,e){var i=this.mPlayerMap.get(t);i&&i.id===this.mActor.id&&(i.package||(i.package=a.op_gameconfig.Package.create()),i.package.items=i.package.items.concat(e),this.mRoom.world.emitter.emit(p.a.UPDATED_CHARACTER_PACKAGE))},PlayerManager.prototype.removePackItems=function(t,e){var i=this.mPlayerMap.get(t);if(i&&this.mActor.id)for(var n=i.package.items,o=n.length,r=0;r<o;r++)if(e===n[r].id)return n.splice(r,1),!0;return!1},PlayerManager.prototype.onSync=function(t){var e=t.content;if(e.nodeType===a.op_def.NodeType.CharacterNodeType)for(var i=null,n=e.sprites,o=e.command,r=0,s=n;r<s.length;r++){var h=s[r];(i=this.get(h.id))&&(o===a.op_def.OpCommand.OP_COMMAND_UPDATE?i.model=new l.a(h):o===a.op_def.OpCommand.OP_COMMAND_PATCH&&i.updateModel(h))}},PlayerManager.prototype.onAdjust=function(t){var e=t.content,i=e.spritePositions;if(e.nodeType===a.op_def.NodeType.CharacterNodeType&&this.mActor)for(var n=void 0,o=void 0,r=0,s=i;r<s.length;r++){var h=s[r];(n=this.mPlayerMap.get(h.id))&&(o=h.point3f,n.setPosition(new c.a(o.x||0,o.y||0,o.z||0)))}},PlayerManager.prototype.onAdd=function(t){this.mPlayerMap||(this.mPlayerMap=new Map);var e=t.content,i=e.sprites;if(e.nodeType===a.op_def.NodeType.CharacterNodeType)for(var n=0,o=i;n<o.length;n++){var r=o[n];this._add(new l.a(r))}},PlayerManager.prototype._add=function(t){if(this.mPlayerMap||(this.mPlayerMap=new Map),!this.mPlayerMap.has(t.id)){var e=new d.a(t,this);this.mPlayerMap.set(e.id||0,e)}},PlayerManager.prototype.addComplete=function(t){this.hasAddComplete=!0},PlayerManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,n=e.ids;if(i===a.op_def.NodeType.CharacterNodeType)for(var o=0,r=n;o<r.length;o++){var s=r[o];this.removeFromMap(s)}},PlayerManager.prototype.onMove=function(t){var e=t.content;if(e.moveData)for(var i=e.moveData,n=i.length,o=(e.nodeType,void 0),r=void 0,s=void 0,a=0;a<n;a++)r=(o=i[a]).moveObjectId,(s=this.get(r))&&s.move(o)},PlayerManager.prototype.onSetPosition=function(t){var e=t.content,i=e.nodeType,n=e.id;if(i===u.CharacterNodeType){var o=this.get(n);o&&o.setPosition(new c.a(e.position.x,e.position.y,e.position.z))}},PlayerManager.prototype.onShowBubble=function(t){var e=t.content,i=this.get(e.chatSenderid);i&&i.showBubble(e.chatContext,e.chatSetting)},PlayerManager.prototype.onOnlyBubbleHandler=function(t){var e=t.content,i=this.get(e.receiverid);i&&i.showBubble(e.context,e.chatsetting)},PlayerManager.prototype.onClearBubbleHandler=function(t){var e=t.content,i=this.get(e.receiverid);i&&i.clearBubble()},PlayerManager.prototype.onShowEffect=function(t){for(var e,i=0,n=t.content.id;i<n.length;i++){var o=n[i];(e=this.get(o))&&e.showEffected(null)}},PlayerManager.prototype.onChangeAnimation=function(t){var e=t.content;if(e.nodeType===u.CharacterNodeType)for(var i=null,n=0,o=e.ids;n<o.length;n++){var r=o[n];(i=this.get(r))&&i.setQueue(e.changeAnimation)}},PlayerManager.prototype.onMovePath=function(t){var e=t.content;if(e.nodeType===u.CharacterNodeType){var i=this.get(e.id);i&&i.movePath(e)}},Object.defineProperty(PlayerManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),Object.defineProperty(PlayerManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!1,configurable:!0}),Object.defineProperty(PlayerManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;h.a.getInstance().error("room is undefined")},enumerable:!1,configurable:!0}),Object.defineProperty(PlayerManager.prototype,"map",{get:function(){return[]},enumerable:!1,configurable:!0}),PlayerManager}(s.PacketHandler),y=i(328),g=i(177),_=i(138),P=i(329),v=i(169),w=i(392),S=i(131),b=i(122),C=i(137),T=i(338),I=i(111),M=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),E=function(t){function FallEffect(e,i){var n=t.call(this,e)||this;return n.scale=i,n}return M(FallEffect,t),FallEffect.prototype.show=function(t){this.mStatus=t,this.load()},FallEffect.prototype.load=function(){this.scene.textures.exists("fall_effect")?this.onCompleteHandler():(this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onCompleteHandler,this),this.scene.load.atlas("fall_effect",I.i.getRes("ui/fall_effect/falleffect.png"),I.i.getRes("ui/fall_effect/falleffect.json")),this.scene.load.start())},FallEffect.prototype.showEnable=function(){this.mDisplay=new k(this.scene,"fall_effect"),this.add(this.mDisplay)},FallEffect.prototype.showDisable=function(){this.mDisplay=new B(this.scene,"fall_effect"),this.add(this.mDisplay)},FallEffect.prototype.onCompleteHandler=function(){var t=this;this.mStatus===a.op_def.PathReachableStatus.PATH_REACHABLE_AREA||this.mStatus===a.op_def.PathReachableStatus.PATH_REACHABLE_WITH_INTERACTION_SPRITE?this.showEnable():this.showDisable(),this.scene.tweens.add({targets:this,duration:1e3,ease:"Expo",delay:1e3,props:{alpha:0},onComplete:function(){t.destroy(),t.emit("remove",t)}})},FallEffect}(Phaser.GameObjects.Container),k=function(t){function EnableDisplay(e,i){var n=t.call(this,e)||this;n.mImage=e.make.sprite({key:i,x:9,y:-20},!1).setScale(.5),n.add(n.mImage),n.mEllipse=e.make.sprite(void 0,!1),n.addAt(n.mEllipse,0);var o={key:"fill_effect_enable",frames:n.scene.anims.generateFrameNames("fall_effect",{prefix:"enable",end:6,zeroPad:2}),frameRate:16,repeat:0};n.scene.anims.create(o),n.mImage.play("fill_effect_enable");var r={key:"fill_effect_ellipse",frames:n.scene.anims.generateFrameNames("fall_effect",{prefix:"ellipse",end:7,zeroPad:2}),frameRate:10,repeat:0};return n.scene.anims.create(r),n.mEllipse.play("fill_effect_ellipse"),n}return M(EnableDisplay,t),EnableDisplay}(Phaser.GameObjects.Container),B=function(t){function DisableDisplay(e,i){var n=t.call(this,e)||this;return n.mImage=e.make.image({key:i,y:-6,frame:"disable"},!1).setScale(.5),n.add(n.mImage),n.mEllipse=e.make.image({key:i,frame:"forbid"},!1).setScale(.5),n.add([n.mImage,n.mEllipse]),n}return M(DisableDisplay,t),DisableDisplay}(Phaser.GameObjects.Container),O=function(){function FallEffectContainer(t,e){this.scene=t,this.room=e,this.mFalls=[]}return FallEffectContainer.prototype.addFall=function(t,e){if(t){var i=new E(this.scene,this.room.world.scaleRatio);i.once("remove",this.onRemoveHandler,this),i.setPosition(t.x,t.y),this.room.addToSceneUI(i)}},FallEffectContainer.prototype.onRemoveHandler=function(t){},FallEffectContainer}(),D=i(175),R=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),x=function(t){function WallDisplay(e,i){var n=t.call(this,e,0,0,void 0)||this;return n.roomService=i,n}return R(WallDisplay,t),WallDisplay.prototype.loadDisplay=function(t,e){this.scene.textures.exists("wall")?this.onLoadCompleteHandler():(this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.scene.load.atlas("wall",t,e),this.scene.load.start())},WallDisplay.prototype.setDir=function(t){this.mImage&&(this.mImage.setTexture("wall","wall_"+t+".png"),t===o.LEFT?this.mImage.x=-this.mImage.width/2:t===o.RIGHT&&(this.mImage.x=this.mImage.width/2),this.mImage.y=-this.mImage.height/2+30)},WallDisplay.prototype.load=function(t){},WallDisplay.prototype.changeAlpha=function(t){},WallDisplay.prototype.play=function(t){},WallDisplay.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this)},WallDisplay.prototype.fadeIn=function(t){},WallDisplay.prototype.fadeOut=function(t){},WallDisplay.prototype.showNickname=function(t){},WallDisplay.prototype.setDisplayBadges=function(t){},WallDisplay.prototype.showRefernceArea=function(){},WallDisplay.prototype.hideRefernceArea=function(){},WallDisplay.prototype.showEffect=function(){},WallDisplay.prototype.onLoadCompleteHandler=function(){this.mImage=this.scene.make.image({key:"wall",frame:"wall_up.png"},!1),this.add(this.mImage),this.mImage.y=-this.mImage.height/2+10,this.emit("initialized",this)},Object.defineProperty(WallDisplay.prototype,"sortX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(WallDisplay.prototype,"sortY",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(WallDisplay.prototype,"sortZ",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(WallDisplay.prototype,"baseLoc",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(WallDisplay.prototype,"element",{get:function(){},enumerable:!1,configurable:!0}),WallDisplay}(Phaser.GameObjects.Container),A=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t.UP="up",t.LEFT="left",t.RIGHT="right",t.DOWN="down"}(o||(o={}));var L,F,N=function(t){function Wall(e,i,n,o){var r=t.call(this,e)||this;return r.room=e,r.mID=i,r.mDirection=o,r.mPosition=n,r.createDisplay(),r}return A(Wall,t),Wall.prototype.setPosition=function(t){this.mPosition=t,this.mDisplay&&(this.mDisplay.x=t.x,this.mDisplay.y=t.y)},Wall.prototype.createDisplay=function(){if(this.mDisplay)return this.mDisplay;var t=this.room.scene;return t&&(this.mDisplay=new x(t,this.room),this.setPosition(this.mPosition),this.mDisplay.once("initialized",this.onInitializedHandler,this),this.mDisplay.loadDisplay(I.i.getRes("wall/wall.png"),I.i.getRes("wall/wall.json")),this.addToBlock()),this.mDisplay},Wall.prototype.onInitializedHandler=function(){this.mDisplay.setDir(this.mDirection)},Wall.prototype.addDisplay=function(){this.createDisplay(),this.mDisplay&&(this.mRoomService.addToGround(this.mDisplay,0),this.setDepth())},Wall.prototype.setDepth=function(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.y),!this.mRoomService)throw new Error("roomService is undefined");var t=this.mRoomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthGroundDirty=!0}},Object.defineProperty(Wall.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Wall}(D.a),H=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),U=function(t){function WallManager(e){var i=t.call(this)||this;return i.mRoom=e,i.mWalls=new Map,i}return H(WallManager,t),WallManager.prototype.destroy=function(){this.mRoom.connection&&this.mRoom.connection.removePacketListener(this),this.mWalls.forEach((function(t){return t.destroy()})),this.mWalls.clear()},WallManager.prototype._add=function(t,e,i){var n=this.mRoom.transformTo90(new c.a(t,e));new N(this.mRoom,1e6*t+1e3*e,n,i)},WallManager.prototype.onDawWallHandler=function(t){var e=this.mRoom.world.elementStorage.getTerrainCollection();if(e){var i=this.mRoom.world.getConfig().game_id.split(".");if(!(i.length<2)&&"5e410ba50681ad5557b4d6e9"===i[1])for(var n=e.data,r=0;r<n.length;r++)for(var s=0;s<n[0].length;s++)0!==n[r][s]&&(this.isUp(r,s,n)?this._add(r,s,o.UP):this.isLeft(r,s,n)?this._add(r,s,o.RIGHT):this.isRight(r,s,n)?this._add(r,s,o.LEFT):this.isDown(r,s,n)&&this._add(r,s,o.DOWN))}},WallManager.prototype.isUp=function(t,e,i){return 0===t?0===e||0===i[t][e-1]:0===e?0===t||0===i[t-1][e]:0===i[t-1][e]&&0===i[t][e-1]},WallManager.prototype.isLeft=function(t,e,i){if(0===e){if(t>0)return!0}else if(t>0&&e>0&&0===i[t][e-1])return!0},WallManager.prototype.isRight=function(t,e,i){if(0===t){if(e>0)return!0}else if(e>0&&t>0&&0===i[t-1][e])return!0},WallManager.prototype.isDown=function(t,e,i){if(t>0&&e>0&&0===i[t-1][e-1]&&0!==i[t-1][e]&&0!==i[t][e-1])return!0},WallManager}(s.PacketHandler),V=i(180),G=i(120),W=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),z=function(){function HandlerDispatcher(){}return HandlerDispatcher.prototype.hasListener=function(t){return!!(this._events&&this._events[t])},HandlerDispatcher.prototype.emitter=function(t,e){if(void 0===e&&(e=null),!this._events||!this._events[t])return!1;var i=this._events[t];if(i.run)i.once&&delete this._events[t],null!=e?i.runWith(e):i.run();else{for(var n=0,o=i.length;n<o;n++){var r=i[n];r&&(null!=e?r.runWith(e):r.run()),r&&!r.once||(i.splice(n,1),n--,o--)}0===i.length&&this._events&&delete this._events[t]}return!0},HandlerDispatcher.prototype.on=function(t,e,i,n){return void 0===n&&(n=null),this._createListener(t,e,i,n,!1)},HandlerDispatcher.prototype.once=function(t,e,i,n){return void 0===n&&(n=null),this._createListener(t,e,i,n,!0)},HandlerDispatcher.prototype.off=function(t,e,i,n){if(void 0===n&&(n=!1),!this._events||!this._events[t])return this;var o=this._events[t];if(null!=i)if(o.run)e&&o.caller!==e||o.method!==i||n&&!o.once||(delete this._events[t],o.recover());else{for(var r=0,s=o.length,a=0,h=o.length;a<h;a++){var c=o[a];!c||e&&c.caller!==e||c.method!==i||n&&!c.once||(r++,o[a]=null,c.recover())}r===s&&delete this._events[t]}return this},HandlerDispatcher.prototype.offAll=function(t){void 0===t&&(t=null);var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this},HandlerDispatcher.prototype.destroy=function(){this.offAll()},HandlerDispatcher.prototype._createListener=function(t,e,i,n,o,r){void 0===r&&(r=!0),r&&this.off(t,e,i,o);var s=j.create(e||this,i,n,o);this._events||(this._events={});var a=this._events;return a[t]?a[t].run?a[t]=[a[t],s]:a[t].push(s):a[t]=s,this},HandlerDispatcher.prototype._recoverHandlers=function(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;e>-1;e--)t[e]&&(t[e].recover(),t[e]=null)},HandlerDispatcher}(),j=function(t){function EventHandler(e,i,n,o){return t.call(this,e,i,n,o)||this}return W(EventHandler,t),EventHandler.create=function(t,e,i,n){return void 0===i&&(i=null),void 0===n&&(n=!0),EventHandler._mpool.length?EventHandler._mpool.pop().setTo(t,e,i,n):new EventHandler(t,e,i,n)},EventHandler.prototype.recover=function(){this._id>0&&(this._id=0,EventHandler._mpool.push(this.clear()))},EventHandler._mpool=[],EventHandler}(G.a),K=function(){function FollowGroup(){this.groupType=L.Follow,this.eventDisp=new z,this.childs=[]}return FollowGroup.prototype.addChild=function(t){this.removeChild(t),this.childs.push(t)},FollowGroup.prototype.removeChild=function(t){var e=this.childs.indexOf(t);-1!==e&&this.childs.splice(e,1)},FollowGroup.prototype.replaceOwner=function(t){this.owner=t,this.eventDisp.emitter(F.REPLACE_TYPE,t)},FollowGroup.prototype.emitter=function(t,e){t||(t=F.DEFAULT_TYPE),this.eventDisp.emitter(t,e)},FollowGroup.prototype.on=function(t,e,i,n){this.eventDisp.on(t,e,i,n)},FollowGroup.prototype.off=function(t,e,i){this.eventDisp.off(t,e,i)},FollowGroup.prototype.destroy=function(){this.eventDisp.destroy(),this.childs.length=0,this.owner=null,this.data=null},FollowGroup}(),q=function(){function GroupManager(t){this.room=t,this.map=new Map}return GroupManager.prototype.createGroup=function(t,e){if(!this.hasGroup(t,e)){var i=this.map.get(t),n=void 0;if(i||(i=[],this.map.set(t,i)),e===L.Follow){var o=new K;o.owner=t,i.push(o),n=o}return n}},GroupManager.prototype.getGroup=function(t,e){var i;if(this.map.has(t))for(var n=0,o=this.map.get(t);n<o.length;n++){var r=o[n];if(r.groupType===e)return i=r}return i},GroupManager.prototype.hasGroup=function(t,e){return!!this.getGroup(t,e)},GroupManager.prototype.destroy=function(){this.map.forEach((function(t,e){for(var i=0,n=t;i<n.length;i++){n[i].destroy()}t.length=0})),this.map.clear()},GroupManager}();!function(t){t[t.Follow=1]="Follow"}(L||(L={})),function(t){t.DEFAULT_TYPE="DEFAULT_TYPE",t.REPLACE_TYPE="REPLACE_TYPE"}(F||(F={}));var Q,Y=function(){function FrameManager(){this.handlers=[]}return FrameManager.prototype.add=function(t,e,i){this.remove(t,e);var n=new G.a(t,e,i);this.handlers.push(n)},FrameManager.prototype.remove=function(t,e){for(var i=-1,n=0;n<this.handlers.length;n++){var o=this.handlers[n];if(o.caller===t&&o.method===e){i=n;break}}-1!==i&&this.handlers.splice(i,1)[0].clear()},FrameManager.prototype.update=function(t,e){for(var i=0,n=this.handlers;i<n.length;i++){n[i].runWith([t,e])}},FrameManager.prototype.destroy=function(){for(var t=0,e=this.handlers;t<e.length;t++){e[t].clear()}this.handlers.length=0},FrameManager.prototype.hasRegistered=function(t,e){for(var i=-1,n=0;n<this.handlers.length;n++){var o=this.handlers[n];if(o.caller===t&&o.method===e){i=n;break}}return-1!==i},FrameManager}(),X=i(44),J=function(){function StateParse(){}return StateParse.decode=function(t,e){return this[t]?StateParse[t](e):StateParse.json(e)},StateParse.json=function(t){var e=X.Buffer.from(t),i=e.readUInt32BE(0);try{var n=e.slice(4);if(i===n.length)return JSON.parse(n.toString());h.a.getInstance().error("parse packet error. packet length: "+i+" received length: "+n.length)}catch(t){h.a.getInstance().error(t)}},StateParse.setCameraBounds=function(t){var e=X.Buffer.from(t);if(e){var i=null,n=null,o=e.readDoubleBE(0),r=e.readDoubleBE(8);return e.length>=24&&(i=o,n=r,o=e.readDoubleBE(16),r=e.readDoubleBE(24)),{x:i,y:n,width:o,height:r}}},StateParse}(),Z=(function(){function StateGroup(){this.states=[]}StateGroup.prototype.update=function(t){this.mName=t.owner.name}}(),function(){function State(t){this.mType=t.type,this.mName=t.name,t.packet&&(this.mPacket=J.decode(t.name,t.packet))}return Object.defineProperty(State.prototype,"name",{get:function(){return this.mName},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"type",{get:function(){return this.mType},enumerable:!1,configurable:!0}),Object.defineProperty(State.prototype,"packet",{get:function(){return this.mPacket},enumerable:!1,configurable:!0}),State}()),$=i(142),tt=i(143),et=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),it=function(t){function Effect(e){var i=t.call(this)||this;return i.mID=e,i}return et(Effect,t),Effect.prototype.syncSprite=function(t){this.mDisplayInfo&&this.mDisplayInfo.destroy();var e=t.display,i=t.animations;if(e&&i){for(var n=[],o=0,r=i;o<r.length;o++){var s=r[o];n.push(new tt.a(s))}this.displayInfo=new $.a({animations:{defaultAnimationName:t.currentAnimationName,display:e,animationData:n}})}},Effect.prototype.destroy=function(){},Object.defineProperty(Effect.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Effect.prototype,"displayInfo",{get:function(){return this.mDisplayInfo},set:function(t){this.mDisplayInfo=t,this.emit("updateDisplayInfo",t)},enumerable:!1,configurable:!0}),Effect}(Phaser.Events.EventEmitter),nt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ot=function(t){function EffectManager(e){var i=t.call(this)||this;return i.room=e,i.mEffects=new Map,i.connection.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SYNC_SPRITE,i.onSyncSprite),i}return nt(EffectManager,t),EffectManager.prototype.add=function(t){var e=new it(t);return this.mEffects.set(t,e),this.updateDisplay(e),e},EffectManager.prototype.remove=function(t){this.mEffects.delete(t)},EffectManager.prototype.get=function(t){var e=this.mEffects.get(t);return e||(e=this.add(t)),e},EffectManager.prototype.destroy=function(){this.mEffects.forEach((function(t){t.destroy()})),this.mEffects.clear(),this.connection.removePacketListener(this)},EffectManager.prototype.updateDisplay=function(t){var e=t.id,i=this.room.world.elementStorage.getDisplayModel(e);i?t.displayInfo=i:this.fetchDisplay([e])},EffectManager.prototype.fetchDisplay=function(t){var e=new s.PBpacket(a.op_virtual_world.OPCODE._OP_REQ_VIRTUAL_WORLD_QUERY_SPRITE_RESOURCE);e.content.ids=t,this.connection.send(e)},EffectManager.prototype.onSyncSprite=function(t){var e=t.content;if(e.nodeType===a.op_def.NodeType.ElementNodeType)for(var i=null,n=0,o=e.sprites;n<o.length;n++){var r=o[n];(i=this.mEffects.get(r.id))&&i.syncSprite(r)}},Object.defineProperty(EffectManager.prototype,"connection",{get:function(){return this.room.connection},enumerable:!1,configurable:!0}),EffectManager}(s.PacketHandler),rt=i(109),st=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),at=function(t){function Room(e){var i=t.call(this)||this;return i.manager=e,i.mEnableEdit=!1,i.mWorld=i.manager.world,i.moveStyle=i.mWorld.moveStyle,i.mScaleRatio=i.mWorld.scaleRatio,i.mWorld&&i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ENABLE_EDIT_MODE,i.onEnableEditModeHandler),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_UNWALKABLE_BIT_MAP,i.onShowMapTitle),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MOVE_SPRITE_BY_PATH,i.onMovePathHandler),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SET_CAMERA_FOLLOW,i.onCameraFollowHandler),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SYNC_STATE,i.onSyncStateHandler)),i}return st(Room,t),Room.prototype.enter=function(t){var e=this;this.mWorld.getSize();t&&(this.mID=t.id,this.mSize={cols:t.cols,rows:t.rows,tileHeight:t.tileHeight,tileWidth:t.tileWidth,sceneWidth:(t.rows+t.cols)*(t.tileWidth/2),sceneHeight:(t.rows+t.cols)*(t.tileHeight/2)},this.mMiniSize={cols:2*t.cols,rows:2*t.rows,tileWidth:t.tileWidth/2,tileHeight:t.tileHeight/2},this.world.showLoading().then((function(){e.completeLoad()})))},Room.prototype.onFullPacketReceived=function(t){a.op_def.NodeType.TerrainNodeType},Room.prototype.onClockReady=function(){},Room.prototype.startLoad=function(){},Room.prototype.completeLoad=function(){if(this.mWorld.game.scene.getScene(v.a.name)){var t=this.mWorld.game.scene.getScene(S.a.name);t&&t.sleep()}else this.mWorld.game.scene.add(v.a.name,v.a,!0,{room:this})},Room.prototype.startPlay=function(){if(this.mLayManager&&this.layerManager.destroy(),this.mCameraService=new P.a(this),this.mScene=this.world.game.scene.getScene(v.a.name),this.mTerrainManager=new g.a(this,this),this.mElementManager=new r.a(this),this.mPlayerManager=new f(this),this.mWallManager=new U(this),this.mBlocks=new w.a(this.mCameraService),this.mLayManager=new y.a(this),this.mGroupManager=new q(this),this.mFrameManager=new Y,this.mSkyboxManager=new V.a(this),this.mEffectManager=new ot(this),this.scene){var t=this.scene.cameras.main;this.mCameraService.camera=t;var e=199*this.mScaleRatio;this.mCameraService.setBounds(-e,-e,this.mSize.sceneWidth*this.mScaleRatio+2*e,this.mSize.sceneHeight*this.mScaleRatio+2*e),this.mBlocks.int(this.mSize),this.mWorld.moveStyle!==a.op_def.MoveStyle.DIRECTION_MOVE_STYLE&&(this.mFallEffectContainer=new O(this.mScene,this))}this.mWorld.user.enterScene(this,this.mActorData);var i=this.mWorld.game.scene.getScene(S.a.name);this.world.emitter.on(p.a.PRESS_ELEMENT,this.onPressElementHandler,this),i&&i.sleep(),this.world.changeRoom(this),this.connection&&(this.cameraService.syncCamera(),this.connection.send(new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED))),this.scene.input.on("pointerdown",this.onPointerDownHandler,this),this.scene.input.on("pointerup",this.onPointerUpHandler,this),this.world.emitter.on(rt.ClickEvent.Tap,this.onTapHandler,this),this.initSkyBox()},Room.prototype.pause=function(){h.a.getInstance().log("#BlackSceneFromBackground; room.pause(); mScene:"+this.mScene),this.mScene&&this.mScene.scene.pause(),this.mWorld&&this.mWorld.inputManager&&(this.mWorld.inputManager.enable=!1)},Room.prototype.resume=function(t){h.a.getInstance().log("#BlackSceneFromBackground; room.resume(); name:"+t+"; mScene:"+this.mScene),this.mScene&&this.mScene.scene.resume(t),this.mWorld&&this.mWorld.inputManager&&(this.mWorld.inputManager.enable=!0)},Room.prototype.addActor=function(t){this.mActorData=t},Room.prototype.addBlockObject=function(t){this.blocks&&this.blocks.add(t)},Room.prototype.removeBlockObject=function(t){this.blocks&&this.blocks.remove(t)},Room.prototype.updateBlockObject=function(t){this.blocks&&this.blocks.check(t)},Room.prototype.addToGround=function(t,e){this.layerManager.addToGround(t,e)},Room.prototype.addToSurface=function(t){this.layerManager.addToSurface(t)},Room.prototype.addToSceneUI=function(t){this.layerManager.addToSceneToUI(t)},Room.prototype.resize=function(t,e){if(this.mScaleRatio=this.mWorld.scaleRatio,this.layerManager&&this.layerManager.resize(t,e),this.mCameraService){var i=199*this.mScaleRatio;this.mCameraService.setBounds(-i,-i,this.mSize.sceneWidth*this.mScaleRatio+2*i,this.mSize.sceneHeight*this.mScaleRatio+2*i),this.mCameraService.resize(t,e)}this.mSkyboxManager&&this.mSkyboxManager.resize(t,e)},Room.prototype.transformTo90=function(t){if(this.mSize)return _.a.transformTo90(t,this.mSize)},Room.prototype.transformTo45=function(t){if(this.mSize)return _.a.transformTo45(t,this.mSize)},Room.prototype.transformToMini90=function(t){if(this.mMiniSize)return _.a.transformTo90(t,this.miniSize)},Room.prototype.transformToMini45=function(t){if(this.mMiniSize)return _.a.transformTo45(t,this.mMiniSize)},Room.prototype.getElement=function(t){var e=null;return this.mPlayerManager&&(e=this.mPlayerManager.get(t)),!e&&this.mElementManager&&(e=this.elementManager.get(t)),e},Room.prototype.moveable=function(t){var e=this.transformToMini45(t),i=this.mElementManager.map;return!(e.x<0||e.x>i.length||e.y<0||e.y>i[0].length)&&0!==i[e.y][e.x]},Room.prototype.update=function(t,e){this.updateClock(t,e),this.mBlocks.update(t,e),this.layerManager&&this.layerManager.update(t,e),this.elementManager&&this.elementManager.update(t,e),this.mFrameManager&&this.frameManager.update(t,e),this.mWorld.httpClock&&this.mWorld.httpClock.update(t,e);for(var i=0,n=this.elementManager.getElements();i<n.length;i++){n[i].update()}for(var o=0,r=this.mPlayerManager.getElements();o<r.length;o++){r[o].update()}},Room.prototype.updateClock=function(t,e){this.mWorld.clock&&this.mWorld.clock.update(t,e)},Room.prototype.now=function(){return this.mWorld.clock.unixTime},Room.prototype.getMaxScene=function(){if(this.mSize){for(var t=this.mSize.sceneWidth,e=this.mSize.sceneHeight,i=0,n=this.mSkyboxManager.scenery;i<n.length;i++){var o=n[i];o.scenery&&(o.scenery.width>t&&(t=o.scenery.width),o.scenery.height>e&&(e=o.scenery.height))}return{width:t,height:e}}},Room.prototype.setState=function(t){var e;this.mStateMap||(this.mStateMap=new Map);for(var i=0,n=t;i<n.length;i++){var o=n[i];switch(o.execCode){case a.op_def.ExecCode.EXEC_CODE_ADD:case a.op_def.ExecCode.EXEC_CODE_UPDATE:e=new Z(o),this.mStateMap.set(o.name,new Z(o)),this.handlerState(e);break;case a.op_def.ExecCode.EXEC_CODE_DELETE:this.mStateMap.delete(o.name)}}},Room.prototype.initUI=function(){this.world.uiManager&&this.world.uiManager.showMainUI()},Room.prototype.clear=function(){this.mLayManager&&this.mLayManager.destroy(),this.mTerrainManager&&this.mTerrainManager.destroy(),this.mElementManager&&this.mElementManager.destroy(),this.mPlayerManager&&this.mPlayerManager.destroy(),this.mBlocks&&this.mBlocks.destroy(),this.mSkyboxManager&&this.mSkyboxManager.destroy(),this.mWallManager&&this.mWallManager.destroy(),this.mActorData&&(this.mActorData=null),this.mStateMap&&(this.mStateMap=null),this.mCameraService&&this.mCameraService.destroy(),this.mEffectManager&&this.mEffectManager.destroy()},Room.prototype.destroy=function(){this.world.emitter.off(rt.ClickEvent.Tap,this.onTapHandler,this),this.connection&&this.connection.removePacketListener(this),this.clear(),h.a.getInstance().log("#BlackSceneFromBackground; remove scene: ",v.a.name),this.mWorld.game.scene.remove(v.a.name),this.world.emitter.off(p.a.PRESS_ELEMENT,this.onPressElementHandler,this)},Room.prototype.initSkyBox=function(){var t=this.world.elementStorage.getScenerys();if(t)for(var e=0,i=t;e<i.length;e++){var n=i[e];this.addSkyBox(n)}},Room.prototype.addSkyBox=function(t){this.mSkyboxManager.add(t)},Room.prototype.onPointerDownHandler=function(t){this.addPointerMoveHandler()},Room.prototype.onPointerUpHandler=function(t){this.removePointerMoveHandler()},Room.prototype.addPointerMoveHandler=function(){this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("gameout",this.onGameOutHandler,this)},Room.prototype.removePointerMoveHandler=function(){this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("gameout",this.onGameOutHandler,this),this.cameraService.moving&&(this.cameraService.syncCameraScroll(),this.cameraService.moving=!1)},Room.prototype.onPointerMoveHandler=function(t){this.mCameraService.targetFollow||this.cameraService.offsetScroll(t.prevPosition.x-t.position.x,t.prevPosition.y-t.position.y)},Room.prototype.onGameOutHandler=function(){this.removePointerMoveHandler()},Room.prototype.handlerState=function(t){switch(t.name){case"skyBoxAnimation":this.mSkyboxManager.setState(t);break;case"setCameraBounds":if(this.mCameraService){var e=t.packet;if(!e||!e.width||!e.height)return void h.a.getInstance().log("setCameraBounds error",e);var i=e.x,n=e.y,o=e.width,r=e.height;null!==i&&null!==n||(i=.5*(this.mSize.sceneWidth-o),n=.5*(this.mSize.sceneHeight-r)),i*=this.mScaleRatio,n*=this.mScaleRatio,o*=this.mScaleRatio,r*=this.mScaleRatio,this.mCameraService.setBounds(i,n,o,r)}}},Object.defineProperty(Room.prototype,"scene",{get:function(){return this.mScene||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"terrainManager",{get:function(){return this.mTerrainManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"elementManager",{get:function(){return this.mElementManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"playerManager",{get:function(){return this.mPlayerManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"layerManager",{get:function(){return this.mLayManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"groupManager",{get:function(){return this.mGroupManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"frameManager",{get:function(){return this.mFrameManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"cameraService",{get:function(){return this.mCameraService||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"effectManager",{get:function(){return this.mEffectManager},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"roomSize",{get:function(){return this.mSize||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"miniSize",{get:function(){return this.mMiniSize},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"blocks",{get:function(){return this.mBlocks},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"world",{get:function(){return this.mWorld},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"enableEdit",{get:function(){return this.mEnableEdit},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"connection",{get:function(){if(this.manager)return this.manager.connection},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"sceneType",{get:function(){return a.op_def.SceneTypeEnum.NORMAL_SCENE_TYPE},enumerable:!1,configurable:!0}),Room.prototype.onPressElementHandler=function(t,e){if(e&&e.parentContainer){var i=e.parentContainer;if(i instanceof C.b)if(i.element instanceof b.b&&this.mEnableEdit){var n=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER);this.connection.send(n)}}},Room.prototype.onEnableEditModeHandler=function(t){this.mEnableEdit=!0},Room.prototype.onShowMapTitle=function(t){if(this.scene){for(var e=t.content,i=new T.a(this.scene,this),n=[],o=e.intArray,r=0;r<o.length;r++){n[r]=[];for(var s=0;s<o[r].value.length;s++)n[r][s]=o[r].value[s]}i.draw(n,new Phaser.Geom.Point(0,0)),i.setAlpha(.1),i.size&&(i.setPosition(i.size.sceneWidth/2,0),this.mLayManager.addToMiddle(i))}},Room.prototype.addFillEffect=function(t,e){if(this.scene){var i=new E(this.scene,this.mScaleRatio);i.show(e),i.setPosition(t.x*this.mScaleRatio,t.y*this.mScaleRatio),this.addToSceneUI(i)}else h.a.getInstance().log("Room scene  does not exist")},Room.prototype.onMovePathHandler=function(t){var e=t.content,i=e.pathStatus;if(i){var n=e.targetPos;this.addFillEffect({x:n.x,y:n.y},i)}},Room.prototype.onCameraFollowHandler=function(t){var e=this;if(this.mCameraService){var i=t.content,n=this.getElement(i.id);if(n)if("liner"===i.effect){var o=n.getPosition();this.mCameraService.pan(o.x,o.y,300).then((function(){e.mCameraService.startFollow(n)}))}else this.mCameraService.startFollow(n);else this.mCameraService.stopFollow()}},Room.prototype.onSyncStateHandler=function(t){for(var e=0,i=t.content.stateGroup;e<i.length;e++){var n=i[e];switch(n.owner.type){case a.op_def.NodeType.SceneNodeType:this.setState(n.state);break;case a.op_def.NodeType.ElementNodeType:this.elementManager.setState(n)}}},Room.prototype.move=function(t,e,i){if(this.moveStyle===a.op_def.MoveStyle.PATH_MOVE_STYLE&&this.mPlayerManager){var n=this.mPlayerManager.actor;if(n){var o=n.getPosition45(),r=this.transformTo45(new c.a(t,e));if(Math.abs(o.x-r.x)>20||Math.abs(o.y-r.y)>20)this.addFillEffect({x:t,y:e},a.op_def.PathReachableStatus.PATH_UNREACHABLE_AREA);else{var h=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOVE_TO_TARGET_BY_PATH),l=h.content;if(i){var p=i.parentContainer.parentContainer||i.parentContainer;if(p&&p instanceof C.b){var d=p.element;d&&d.model&&(l.id=d.model.id,l.nodeType=d.model.nodeType)}}l.point3f={x:t,y:e},this.connection.send(h),this.tryMove()}}}},Room.prototype.tryMove=function(){var t=this.mPlayerManager.actor;if(t){var e=t.moveData,i=e.posPath;if(i&&!(i.length<0)){var n=e.step||0;if(!(n>=i.length)){var o=t.getPosition(),r=a.op_def.PBPoint3f.create();r.x=o.x,r.y=o.y,void 0===i[n]&&h.a.getInstance().log("move error",i,n);var c=a.op_def.PBPoint3f.create();c.x=i[n].x,c.y=i[n].y;var l=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_CHECK_MOVE_PATH_NEXT_POINT),p=l.content;p.timestemp=this.now(),p.position=r,p.nextPoint=c,this.connection.send(l)}}}},Room.prototype.onTapHandler=function(t,e){this.move(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio,e)},Room.prototype.enterRoom=function(){this.mWorld.game.scene.run(v.a.name,{room:this})},Room}(s.PacketHandler);!function(t){t.MOVE="move",t.BRUSH="brush",t.SELECT="select",t.ERASER="eraser",t.FILL="FILL"}(Q||(Q={}));var ht=function(){function Brush(t){this.mEditorRoom=t,this.mMode=Q.SELECT}return Object.defineProperty(Brush.prototype,"mode",{get:function(){return this.mMode},set:function(t){this.mMode=t},enumerable:!1,configurable:!0}),Brush}(),ct=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),lt=function(t){function EditScene(){return t.call(this,{key:EditScene.name})||this}return ct(EditScene,t),EditScene.prototype.create=function(){this.mRoom.startPlay()},EditScene}(v.a),pt=i(141),dt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),mt=a.op_def.NodeType,ut=function(){function MouseFollow(t,e){this.mScene=t,this.mRoomService=e,this.mScaleRatio=1,this.mSize=1,this.mLayerManager=this.mRoomService.layerManager,this.mScaleRatio=this.mRoomService.world.scaleRatio}return MouseFollow.prototype.setDisplay=function(t){if(this.mScene){this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null),this.mNodeType=t.nodeType,this.isMoss=t.isMoss,this.key=t.key,this.mSprite=new l.a(t.sprite,t.nodeType),this.mDisplay=new ft(this.mScene,this.mRoomService);var e=this.mNodeType===mt.TerrainNodeType?this.mSize:1;this.mDisplay.setDisplay(this.mSprite,e),this.mDisplay.scale=this.mScaleRatio,this.mLayerManager.addToSceneToUI(this.mDisplay),this.mNodeType===mt.TerrainNodeType?this.mElementManager=this.mRoomService.terrainManager:this.mNodeType!==mt.ElementNodeType&&this.mNodeType!==mt.SpawnPointType||(this.mElementManager=this.mRoomService.elementManager),this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("wheel",this.onWheelHandler,this)}},MouseFollow.prototype.showEraserArea=function(){this.mScene&&(this.mDisplay&&this.mDisplay.destroy(),this.mDisplay=new yt(this.mScene,this.mRoomService),this.mDisplay.setDisplay(null,this.mSize),this.mNodeType=mt.TerrainNodeType,this.mLayerManager.addToSceneToUI(this.mDisplay),this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("wheel",this.onWheelHandler,this))},MouseFollow.prototype.createTerrainsOrMossesData=function(){var t=this;return{locs:this.mDisplay.displays.map((function(e){return t.getPosition(e.x,e.y)})),key:this.key}},MouseFollow.prototype.createSprites=function(){if(this.mSprite){for(var t=[],e=null,i=0,n=this.mDisplay.displays;i<n.length;i++){var o=n[i];(e=Object.assign(Object.create(Object.getPrototypeOf(this.mSprite)),this.mSprite)).newID(),e.pos=this.getPosition(o.x,o.y),e.bindID=this.mSprite.id,e.sn=this.mSprite.sn,t.push(e)}return t}},MouseFollow.prototype.getEaserPosition=function(){var t=[];if(this.display){for(var e=null,i=0;i<this.mSize;i++)for(var n=0;n<this.mSize;n++)e=this.display.transformTo90(i,n),t.push(this.getPosition(e.x,e.y));return t}},MouseFollow.prototype.transitionGrid=function(t,e){var i=new c.a(t,e),n=this.mNodeType===a.op_def.NodeType.TerrainNodeType?this.mRoomService.transformTo45(i):this.mRoomService.transformToMini45(i);return!1===this.mAlignGrid?this.checkBound(n,i):this.checkBound(n)},MouseFollow.prototype.checkBound=function(t,e){var i=new c.a(t.x,t.y),n=this.mNodeType===a.op_def.NodeType.TerrainNodeType?this.mRoomService.roomSize:this.mRoomService.miniSize;return t.x<0?i.x=0:t.x>n.cols&&(i.x=n.cols),t.y<0?i.y=0:t.y>n.rows&&(i.y=n.rows),i.equal(t)&&e?e:this.mNodeType===a.op_def.NodeType.TerrainNodeType?this.mRoomService.transformTo90(i):this.mRoomService.transformToMini90(i)},MouseFollow.prototype.destroy=function(){this.mScene&&(this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("wheel",this.onWheelHandler,this)),this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null),this.mNodeType=mt.UnknownNodeType},MouseFollow.prototype.onPointerMoveHandler=function(t){this.updatePos(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio)},MouseFollow.prototype.getPosition=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.mNodeType===a.op_def.NodeType.TerrainNodeType?this.mRoomService.transformTo45(new c.a(this.mDisplay.x/this.mScaleRatio+t,this.mDisplay.y/this.mScaleRatio+e)):new c.a(this.mDisplay.x/this.mScaleRatio+t,this.mDisplay.y/this.mScaleRatio+e,this.mDisplay.z)},MouseFollow.prototype.onWheelHandler=function(t){this.mNodeType===mt.TerrainNodeType&&(t.deltaY<0?this.size--:this.size++,this.updatePos(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio))},MouseFollow.prototype.updatePos=function(t,e){if(this.mDisplay){var i=this.transitionGrid(t,e);i&&this.mDisplay.setLocation(i.x*this.mScaleRatio,i.y*this.mScaleRatio)}},Object.defineProperty(MouseFollow.prototype,"alignGrid",{set:function(t){this.mAlignGrid=t},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"display",{get:function(){return this.mDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"sprite",{get:function(){return this.mSprite},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"nodeType",{get:function(){return this.mNodeType},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"elementManager",{get:function(){return this.mElementManager},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"size",{get:function(){return this.mSize},set:function(t){t<1&&(t=1),t>20&&(t=20),this.mSize=t,this.mDisplay.setDisplay(this.mSprite,this.mSize)},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"isMoss",{get:function(){return this._isMoss},set:function(t){this._isMoss=t},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"key",{get:function(){return this._key},set:function(t){this._key=t},enumerable:!1,configurable:!0}),MouseFollow}(),ft=function(t){function MouseDisplayContainer(e,i){var n=t.call(this,e)||this;return n.mRoomService=i,n.mScaleRatio=1,n.mScaleRatio=n.mRoomService.world.scaleRatio,n.mOffset=new Phaser.Geom.Point,n}return dt(MouseDisplayContainer,t),MouseDisplayContainer.prototype.setDisplay=function(t,e){if(this.clear(),this.mDisplay=[],this.mSprite=t,t){var i,n=t.displayInfo;this.mNodeType=t.nodeType;var o=this.mRoomService.roomSize,r=o.tileWidth,s=o.tileHeight;this.mTileSize={tileWidth:r,tileHeight:s,rows:e,cols:e,sceneWidth:(e+e)*(r/2),sceneHeight:(e+e)*(s/2)},this.mOffset.x=-this.mTileSize.sceneWidth/2*this.mScaleRatio,this.mOffset.y=-(this.mTileSize.sceneHeight/this.mScaleRatio-(e%2==0?0:s))/2;for(var a=0;a<e;a++)for(var h=0;h<e;h++){(i=new pt.a(this.scene,this.mRoomService)).setAlpha(.8),i.once("initialized",this.onInitializedHandler,this),i.load(n);var l=_.a.transformTo90(new c.a(a,h),this.mTileSize);i.x=l.x,i.y=l.y,this.add(i),this.mDisplay.push(i)}}},MouseDisplayContainer.prototype.transformTo90=function(t,e){return _.a.transformTo90(new c.a(t,e),this.mTileSize)},MouseDisplayContainer.prototype.transformTo45=function(t,e){return _.a.transformTo45(new c.a(t,e),this.mTileSize)},MouseDisplayContainer.prototype.setLocation=function(t,e){return this.x=t+this.mOffset.x,this.y=e+this.mOffset.y,this},MouseDisplayContainer.prototype.clear=function(){this.removeAll(!0),this.mDisplay=void 0},MouseDisplayContainer.prototype.destroy=function(e){this.clear(),t.prototype.destroy.call(this,e)},Object.defineProperty(MouseDisplayContainer.prototype,"displays",{get:function(){return this.mDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(MouseDisplayContainer.prototype,"tileWidth",{get:function(){var t=this.mTileSize.tileHeight;return this.mTileSize.rows%2==0&&(t=0),this.mTileSize.sceneWidth-t},enumerable:!1,configurable:!0}),Object.defineProperty(MouseDisplayContainer.prototype,"tileHeight",{get:function(){return this.mTileSize.sceneHeight},enumerable:!1,configurable:!0}),MouseDisplayContainer.prototype.onInitializedHandler=function(t){t&&(this.mSprite&&t.play(this.mSprite.currentAnimation),this.mNodeType!==a.op_def.NodeType.TerrainNodeType&&t.showRefernceArea())},MouseDisplayContainer}(Phaser.GameObjects.Container),yt=function(t){function EraserArea(e,i){return t.call(this,e,i)||this}return dt(EraserArea,t),EraserArea.prototype.setDisplay=function(t,e){this.area&&this.area.clear();var i,n,o,r,s=this.mRoomService.roomSize,a=s.tileWidth,h=s.tileHeight;this.mTileSize={tileWidth:a,tileHeight:h,rows:e,cols:e,sceneWidth:(e+e)*(a/2),sceneHeight:(e+e)*(h/2)},this.mOffset.x=-this.mTileSize.sceneWidth/2,this.mOffset.y=-(this.mTileSize.sceneHeight-(e%2==0?0:h))/2,this.area=this.scene.make.graphics(void 0,!1);for(var l=0;l<e;l++)for(var p=0;p<e;p++)this.area.lineStyle(2,0),i=_.a.transformTo90(new c.a(p,l),this.mTileSize),n=_.a.transformTo90(new c.a(p+1,l),this.mTileSize),o=_.a.transformTo90(new c.a(p+1,l+1),this.mTileSize),r=_.a.transformTo90(new c.a(p,l+1),this.mTileSize),this.area.beginPath(),this.area.fillStyle(0,.5),this.area.strokePoints([i.toPoint(),n.toPoint(),o.toPoint(),r.toPoint()],!0,!0),this.area.fillPath();this.add(this.area)},EraserArea}(ft),gt=i(178),_t=i(116),Pt=function(){function SelectedElement(t,e){this.mScene=t,this.mLayerManager=e,this.mDisplayHeight=0,this.mEffecte=new _t.DynamicImage(this.mScene,0,0),this.mEffecte.load(I.i.getRes("ui/editor/selectFlag.png"))}return SelectedElement.prototype.setElement=function(t){this.mDisplay&&(this.mDisplay.hideRefernceArea(),this.mDisplay.element&&this.mDisplay.element.hideNickname(),this.mSprite=void 0),this.mDisplay=t,t.showRefernceArea(),this.mDisplayHeight=this.mDisplay.spriteHeight;var e=t.element;e&&(e.showNickname(),this.mSprite=e.model),this.mLayerManager.addToSceneToUI(this.mEffecte),this.mSelecting=!0,this.update()},SelectedElement.prototype.remove=function(){this.mSelecting=!1,this.mEffecte&&(this.mEffecte.parentContainer&&this.mEffecte.parentContainer.remove(this.mEffecte),this.mDisplay&&(this.mDisplay.parentContainer&&this.mDisplay.hideRefernceArea(),this.mDisplay=null,this.mSprite=void 0))},SelectedElement.prototype.update=function(){if(this.mDisplay){this.mEffecte.x=this.mDisplay.x,this.mEffecte.y=this.mDisplay.y-(this.mDisplayHeight>>1);var t=this.mDisplay.element;t&&t.update()}},SelectedElement.prototype.setDisplayPos=function(t,e){if(this.mDisplay&&(this.mDisplay.x=t,this.mDisplay.y=e,this.mSprite)){var i=this.mSprite.pos;i&&(i.x=t,i.y=e)}},SelectedElement.prototype.destroy=function(){this.mEffecte&&(this.remove(),this.mEffecte.destroy(),this.mEffecte=null)},Object.defineProperty(SelectedElement.prototype,"display",{get:function(){return this.mDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(SelectedElement.prototype,"selecting",{get:function(){return this.mSelecting},set:function(t){this.mSelecting=t},enumerable:!1,configurable:!0}),Object.defineProperty(SelectedElement.prototype,"sprite",{get:function(){return this.mSprite},enumerable:!1,configurable:!0}),SelectedElement}(),vt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),wt=a.op_def.NodeType,St=function(t){function EditorElementManager(e){var i=t.call(this,e)||this;return i.mRoom=e,i.taskQueue=new Map,i.connection&&(i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_CREATE_SPRITE,i.handleCreateElements),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_SPRITE,i.handleDeleteElements),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SYNC_SPRITE,i.handleSyncElements)),i}return vt(EditorElementManager,t),EditorElementManager.prototype.update=function(){this.batchActionSprites()},EditorElementManager.prototype.addElements=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];this.taskQueue.set(n.id,{action:"ADD",sprite:n})}this.callEditorCreateElementData(t)},EditorElementManager.prototype.callEditorCreateElementData=function(t){var e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_CREATE_SPRITE),i=e.content;i.nodeType=t[0].nodeType,i.sprites=t.map((function(t){return t.toSprite()})),this.connection.send(e),h.a.getInstance().log("add sprites: ",i)},EditorElementManager.prototype.updateElements=function(t){this.callEditorUpdateElementData(t)},EditorElementManager.prototype.callEditorUpdateElementData=function(t){var e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_SYNC_SPRITE);e.content.sprites=t,this.connection.send(e)},EditorElementManager.prototype.deleteElements=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];this.taskQueue.set(n,{action:"DELETE",sprite:{id:n}})}this.callEditorDeleteElementData(t)},EditorElementManager.prototype.callEditorDeleteElementData=function(t){var e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_DELETE_SPRITE),i=e.content;i.ids=t,i.nodeType=a.op_def.NodeType.ElementNodeType,this.connection.send(e)},EditorElementManager.prototype.handleCreateElements=function(t){if(this.mRoom.layerManager)for(var e=t.content,i=e.sprites,n=(e.nodeType,0),o=i;n<o.length;n++){var r=o[n];this.taskQueue.set(r.id,{action:"ADD",sprite:new l.a(r)})}else h.a.getInstance().error("layer manager does not exist")},EditorElementManager.prototype.handleDeleteElements=function(t){var e=t.content,i=e.ids,n=e.nodeType;if(n===wt.ElementNodeType||n===wt.SpawnPointType){for(var o=0,r=i;o<r.length;o++){var s=r[o];this.taskQueue.set(s,{action:"DELETE",sprite:{id:s}})}this.roomService.removeSelected()}},EditorElementManager.prototype.handleSyncElements=function(t){var e=t.content,i=e.sprites;if(e.nodeType===a.op_def.NodeType.ElementNodeType)for(var n=0,o=i;n<o.length;n++){var r=o[n];this.taskQueue.set(r.id,{action:"UPDATE",sprite:new l.a(r)})}},EditorElementManager.prototype.batchActionSprites=function(){if(Array.from(this.taskQueue.keys()).length)for(var t=0,e=Array.from(this.taskQueue.keys()).splice(0,200);t<e.length;t++){var i=e[t],n=this.taskQueue.get(i),o=n.action,r=n.sprite;this.taskQueue.delete(i),"ADD"===o?this.mRoom.displayObjectPool.push("elements",r.id.toString(),r,this):"DELETE"===o?this.mRoom.displayObjectPool.remove("elements",r.id.toString()):"UPDATE"===o&&this.mRoom.displayObjectPool.update("elements",r.id.toString(),r)}},Object.defineProperty(EditorElementManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),EditorElementManager}(r.a),bt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),__assign=function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Ct=function(t){function EditorTerrainManager(e,i){var n=t.call(this,e,i)||this;return n.mRoom=e,n.taskQueue=new Map,n.mEditorTerrains=new Map,n.connection&&(n.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ADD_SPRITES_WITH_LOCS,n.handleAddTerrains),n.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_SPRITES_WITH_LOCS,n.handleDeleteTerrains)),n}return bt(EditorTerrainManager,t),EditorTerrainManager.prototype.addTerrains=function(t){for(var e=this,i=t.locs,n=t.key,o=i.filter((function(t){return e.canPut(t,n)})),r=0,s=o;r<s.length;r++){var a=s[r],h=this.genLocId(a.x,a.y),c=this.mEditorTerrains.get(h);c&&c!==n?this.taskQueue.set(h,{action:"UPDATE",loc:__assign(__assign({},a),{key:n})}):this.taskQueue.set(h,{action:"ADD",loc:__assign(__assign({},a),{key:n})})}this.reqEditorAddTerrainsData(o,n)},EditorTerrainManager.prototype.reqEditorAddTerrainsData=function(t,e){var i=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_ADD_TERRAINS),n=i.content;n.locs=t,n.key=e,this.connection.send(i)},EditorTerrainManager.prototype.removeTerrains=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e],o=this.genLocId(n.x,n.y);this.taskQueue.set(o,{action:"DELETE",loc:{x:n.x,y:n.y}})}this.reqEditorDeleteTerrainsData(t)},EditorTerrainManager.prototype.reqEditorDeleteTerrainsData=function(t){var e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_DELETE_TERRAINS);e.content.locs=t.map((function(t){return{x:t.x,y:t.y,z:t.z}})),this.connection.send(e)},EditorTerrainManager.prototype.update=function(){this.batchActionSprites()},EditorTerrainManager.prototype.handleAddTerrains=function(t){if(this.mRoom.layerManager){var e=t.content,i=e.locs;if(e.nodeType===a.op_def.NodeType.TerrainNodeType)for(var n=0,o=i;n<o.length;n++){var r=o[n],s=this.genLocId(r.x,r.y),c=this.mEditorTerrains.get(s);c&&c===r.key||this.taskQueue.set(s,{action:"ADD",loc:r})}}else h.a.getInstance().error("layer manager does not exist")},EditorTerrainManager.prototype.handleDeleteTerrains=function(t){if(this.mRoom.layerManager){var e=t.content,i=e.locs;if(e.nodeType===a.op_def.NodeType.TerrainNodeType)for(var n=0,o=i;n<o.length;n++){var r=o[n],s=this.genLocId(r.x,r.y);this.taskQueue.set(s,{action:"DELETE",loc:r})}}else h.a.getInstance().error("layer manager does not exist")},EditorTerrainManager.prototype.canPut=function(t,e){var i=this.genLocId(t.x,t.y),n=this.roomService.roomSize;return!!n&&(!(t.x<0||t.y<0||t.x>=n.cols||t.y>=n.rows)&&this.mEditorTerrains.get(i)!==e)},EditorTerrainManager.prototype.batchActionSprites=function(){if(Array.from(this.taskQueue.keys()).length)for(var t=0,e=Array.from(this.taskQueue.keys()).splice(0,200);t<e.length;t++){var i=e[t],n=this.taskQueue.get(i),o=n.action,r=n.loc,s=this.genLocId(r.x,r.y);if(this.taskQueue.delete(i),"ADD"===o){if(!(c=this.mRoom.world.elementStorage.getTerrainPalette(r.key)))continue;var h=c.createSprite({nodeType:a.op_def.NodeType.TerrainNodeType,x:r.x,y:r.y});this.mEditorTerrains.set(s,r.key),this.mRoom.displayObjectPool.push("terrains",s,h,this)}else if("DELETE"===o)this.mEditorTerrains.delete(s),this.mRoom.displayObjectPool.remove("terrains",s);else if("UPDATE"===o){var c;if(!(c=this.mRoom.world.elementStorage.getTerrainPalette(r.key)))continue;h=c.createSprite({nodeType:a.op_def.NodeType.TerrainNodeType,x:r.x,y:r.y});this.mEditorTerrains.set(s,r.key),this.mRoom.displayObjectPool.update("terrains",s,h)}}},EditorTerrainManager.prototype.genLocId=function(t,e){return t+"_"+e},EditorTerrainManager}(g.a),Tt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),It=function(t){function EditorCamerasManager(){return null!==t&&t.apply(this,arguments)||this}return Tt(EditorCamerasManager,t),EditorCamerasManager.prototype.centerCameas=function(){if(this.mMain&&this.mRoomService){var t=this.mRoomService.roomSize;this.mMain.setScroll(t.sceneWidth-this.mMain.width>>1,t.sceneHeight-this.mMain.height>>1);this.mMain.worldView;var e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_RESET_CAMERA),i=e.content;i.x=this.mMain.scrollX,i.y=this.mMain.scrollY,i.width=this.mMain.width,i.height=this.mMain.height,this.connection.send(e)}},EditorCamerasManager.prototype.offsetScroll=function(t,e){if(this.mMain)for(var i=0,n=this.mCameras;i<n.length;i++){var o=n[i];o.scrollX+=t/this.zoom,o.scrollY+=e/this.zoom}},EditorCamerasManager.prototype.syncCameraScroll=function(){var t=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_RESET_CAMERA),e=t.content;e.x=this.mMain.scrollX/this.zoom,e.y=this.mMain.scrollY/this.zoom,e.width=0,e.height=0,this.connection.send(t)},EditorCamerasManager}(P.a),Mt=i(155),Et=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),editor_moss_manager_assign=function(){return(editor_moss_manager_assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},kt=function(t){function EditorMossManager(e){var i=t.call(this,e)||this;return i.mRoom=e,i.taskQueue=new Map,i.editorMosses=new Map,i.connection&&(i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ADD_MOSSES,i.handleAddMosses),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_MOSSES,i.handleDeleteMosses),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SYNC_MOSSES,i.handleUpdateMosses)),i}return Et(EditorMossManager,t),EditorMossManager.prototype.update=function(){this.batchActionSprites()},EditorMossManager.prototype.addMosses=function(t){for(var e=[],i=t.locs,n=t.key,o=0,r=i;o<r.length;o++){var s=r[o],a=Mt.a.genId(),h={x:s.x,y:s.y,z:s.z,key:n,id:a};this.taskQueue.set(a,{action:"ADD",loc:h}),e.push(h)}this.reqEditorCreateMossData(e)},EditorMossManager.prototype.reqEditorCreateMossData=function(t){var e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_CREATE_MOSSES);e.content.locs=t,this.connection.send(e)},EditorMossManager.prototype.updateMosses=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i].display.element.model.toSprite(),r=this.editorMosses.get(o.id),s={x:o.point3f.x,y:o.point3f.y,z:o.point3f.z,id:o.id,dir:o.direction,key:r.key};this.taskQueue.set(o.id,{action:"UPDATE",loc:s}),e.push(s)}this.reqEditorUpdateMossData(e)},EditorMossManager.prototype.reqEditorUpdateMossData=function(t){var e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_SYNC_MOSSES);e.content.locs=t,this.connection.send(e)},EditorMossManager.prototype.deleteMosses=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i],r=this.editorMosses.get(o);e.push(r),this.taskQueue.set(o,{action:"DELETE",loc:r})}this.reqEditorDeleteMossData(e)},EditorMossManager.prototype.reqEditorDeleteMossData=function(t){var e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_DELETE_MOSSES);e.content.locs=t,this.connection.send(e)},EditorMossManager.prototype.handleAddMosses=function(t){for(var e=0,i=t.content.locs;e<i.length;e++){var n=i[e];this.taskQueue.set(n.id,{action:"ADD",loc:n})}},EditorMossManager.prototype.handleDeleteMosses=function(t){for(var e=0,i=t.content.ids;e<i.length;e++){var n=i[e];this.taskQueue.set(n,{action:"DELETE",loc:this.editorMosses.get(n)})}this.roomService.removeSelected()},EditorMossManager.prototype.handleUpdateMosses=function(t){for(var e=0,i=t.content.locs;e<i.length;e++){var n=i[e];this.taskQueue.set(n.id,{action:"UPDATE",loc:n})}},EditorMossManager.prototype.batchActionSprites=function(){if(Array.from(this.taskQueue.keys()).length)for(var t=0,e=Array.from(this.taskQueue.keys()).splice(0,200);t<e.length;t++){var i=e[t],n=this.taskQueue.get(i),o=n.action,r=n.loc;if(this.taskQueue.delete(i),"ADD"===o){if(!(h=this.mRoom.world.elementStorage.getMossPalette(r.key)))continue;var s=h.createSprite(editor_moss_manager_assign(editor_moss_manager_assign({},r),{nodeType:a.op_def.NodeType.ElementNodeType,isMoss:!0}));this.editorMosses.set(r.id,r),this.mRoom.displayObjectPool.push("mosses",r.id.toString(),s,this)}else if("DELETE"===o)r&&(this.editorMosses.delete(r.id),this.mRoom.displayObjectPool.remove("mosses",r.id.toString()));else if("UPDATE"===o){var h;if(!(h=this.mRoom.world.elementStorage.getMossPalette(r.key)))continue;s=h.createSprite(editor_moss_manager_assign(editor_moss_manager_assign({},r),{nodeType:a.op_def.NodeType.ElementNodeType,isMoss:!0}));this.editorMosses.set(r.id,r),this.mRoom.displayObjectPool.update("mosses",r.id.toString(),s)}}},Object.defineProperty(EditorMossManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),EditorMossManager}(r.a),Bt=i(341),Ot=function(){function DisplayObjectPool(){this.terrains=new Map,this.mosses=new Map,this.elements=new Map,this.POOLOBJECTCONFIG={terrains:Bt.a,mosses:b.b,elements:b.b}}return DisplayObjectPool.prototype.getPool=function(t){return this[t]},DisplayObjectPool.prototype.push=function(t,e,i,n){var o=this[t],r=new this.POOLOBJECTCONFIG[t](i,n);r.setBlockable(!1),r.setRenderable(!0),r instanceof b.b&&r.setInputEnable(b.c.Enable),o.set(e,r)},DisplayObjectPool.prototype.remove=function(t,e){var i=this[t].get(e);i&&(i.isUsed=!1,i.destroy()),this[t].delete(e)},DisplayObjectPool.prototype.update=function(t,e,i){var n=this[t].get(e);n&&(n.isUsed=!0,n.setModel(i))},DisplayObjectPool.prototype.destroy=function(){for(var t=0,e=Object.keys(this.POOLOBJECTCONFIG);t<e.length;t++){this[e[t]].clear()}},DisplayObjectPool}(),Dt=i(343),Rt=i(393),xt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),At=function(t){function EditorBlockManager(e,i){return t.call(this,e,i)||this}return xt(EditorBlockManager,t),EditorBlockManager.prototype.move=function(){},EditorBlockManager}(Rt.a),Lt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ft=function(t){function EditorSkyBoxManager(e){var i=t.call(this,e)||this,n=e.connection;return n&&(n.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ADD_SCENERY,i.onAddSceneryHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_UPDATE_SCENERY,i.onUpdateSceneryHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_SCENERY,i.onDeleteSceneryHandler)),i}return Lt(EditorSkyBoxManager,t),EditorSkyBoxManager.prototype.add=function(t){this.mScenetys.set(t.id,new At(t,this.mRoom))},EditorSkyBoxManager.prototype.fetch=function(t){this.mScenetys&&(this.mSelected=this.mScenetys.get(t))},EditorSkyBoxManager.prototype.move=function(t){if(this.selected){var e=this.mSelected.scenery;if(e){var i=e.offset;i.x+=(t.x-t.prevPosition.x)/this.mRoom.world.scaleRatio,i.y+=(t.y-t.prevPosition.y)/this.mRoom.world.scaleRatio,this.mSelected.updatePosition(),this.onSyncSceneryOffset()}}},EditorSkyBoxManager.prototype.keyboardMove=function(t){if(this.mSelected){var e=this.mSelected.scenery;if(e){var i=e.offset;switch(t){case 37:case 65:i.x--;break;case 38:case 87:i.y--;break;case 39:case 68:i.x++;break;case 40:case 83:i.y++}this.mSelected.updatePosition(),this.onSyncSceneryOffset()}}},EditorSkyBoxManager.prototype.removeSelect=function(){this.mSelected&&(this.mSelected=void 0)},EditorSkyBoxManager.prototype.onAddSceneryHandler=function(t){var e=t.content;this.add(new Dt.b(e))},EditorSkyBoxManager.prototype.onUpdateSceneryHandler=function(t){var e=t.content;this.update(new Dt.b(e))},EditorSkyBoxManager.prototype.onDeleteSceneryHandler=function(t){for(var e=0,i=t.content.ids;e<i.length;e++){var n=i[e];this.remove(n)}},EditorSkyBoxManager.prototype.onSyncSceneryOffset=function(){var t=this.mSelected.scenery,e=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_UPDATE_SCENERY),i=e.content;i.id=t.id;var n=a.op_def.PBPoint2f.create();Object.assign(n,t.offset),i.offset=n,this.mRoom.connection.send(e)},Object.defineProperty(EditorSkyBoxManager.prototype,"selected",{get:function(){return this.mSelected},enumerable:!1,configurable:!0}),EditorSkyBoxManager}(V.a),Nt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ht=function(t){function EditorRoom(e){var i=t.call(this,e)||this;return i.mBrush=new ht(i),i.mPointerDelta=null,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SET_EDITOR_MODE,i.onSetEditorModeHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ALIGN_GRID,i.onAlignGridHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_VISIBLE_GRID,i.onVisibleGridHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_MOUSE_FOLLOW,i.onMouseFollowHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_MOUSE_SELECTED_SPRITE,i.onMouseFollowHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_FETCH_SPRITE,i.onFetchSpriteHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_FETCH_SCENERY,i.onFetchSceneryHandler)),i}return Nt(EditorRoom,t),EditorRoom.prototype.enter=function(t){if(t){this.mID=t.id;var e=t.rows,i=t.cols,n=t.tileWidth,o=t.tileHeight;this.mSize={cols:i,rows:e,tileHeight:o,tileWidth:n,sceneWidth:(e+i)*(n/2),sceneHeight:(e+i)*(o/2)},e*=2,i*=2,n/=2,o/=2,this.mNimiSize={cols:i,rows:e,tileHeight:o,tileWidth:n,sceneWidth:(e+i)*(n/2),sceneHeight:(e+i)*(o/2)},this.editorTerrainManager=new Ct(this),this.editorElementManager=new St(this),this.editorMossManager=new kt(this),this.editorSkyboxManager=new Ft(this),this.mCameraService=new It(this),this.displayObjectPool=new Ot,this.mWorld.game.scene.add(lt.name,lt,!1,{room:this}),this.mWorld.game.scene.start(lt.name,{room:this})}else h.a.getInstance().error("wrong room")},EditorRoom.prototype.startPlay=function(){this.mScene=this.mWorld.game.scene.getScene(lt.name),this.mLayManager=new y.a(this),this.mLayManager.drawGrid(this);var t=this.scene.cameras.main;this.mCameraService.camera=t;var e=this.world.scaleRatio;this.mCameraService.setBounds(-t.width>>1,-t.height>>1,this.mSize.sceneWidth*e+t.width,this.mSize.sceneHeight*e+t.height);var i=this.mWorld.game.scene.getScene(S.a.name);i&&i.sleep(),this.connection.send(new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED)),this.mCameraService.centerCameas(),this.mScene.input.on("pointerdown",this.onPointerDownHandler,this),this.mScene.input.on("pointerup",this.onPointerUpHandler,this),this.mScene.input.on("gameobjectdown",this.onGameobjectDownHandler,this),this.mScene.input.on("gameout",this.onGameOutHandler,this),this.mScene.input.keyboard.on("keydown",this.onKeyDownHandler,this)},EditorRoom.prototype.destroy=function(){this.mWorld&&this.mWorld.connection&&this.mWorld.connection.removePacketListener(this),this.editorTerrainManager&&this.editorTerrainManager.destroy(),this.editorMossManager&&this.editorMossManager.destroy(),this.editorElementManager&&this.editorElementManager.destroy(),this.displayObjectPool&&this.displayObjectPool.destroy(),this.editorSkyboxManager&&this.editorSkyboxManager.destroy(),t.prototype.destroy.call(this)},EditorRoom.prototype.update=function(t,e){this.layerManager&&this.layerManager.update(t,e),this.mSelectedElementEffect&&this.mSelectedElementEffect.update(),this.editorTerrainManager&&this.editorTerrainManager.update(),this.editorMossManager&&this.editorMossManager.update(),this.editorElementManager&&this.editorElementManager.update()},EditorRoom.prototype.transformToMini90=function(t){if(this.mNimiSize)return _.a.transformTo90(t,this.mNimiSize);h.a.getInstance().error("position object is undefined")},EditorRoom.prototype.transformToMini45=function(t){if(this.mNimiSize)return _.a.transformTo45(t,this.mNimiSize);h.a.getInstance().error("position object is undefined")},EditorRoom.prototype.removeSelected=function(){this.mSelectedElementEffect&&(this.mSelectedElementEffect.remove(),this.mPointerDelta=null)},EditorRoom.prototype.addPointerMoveHandler=function(){this.mScene.input.on("pointermove",this.onPointerMoveHandler,this)},EditorRoom.prototype.removePointerMoveHandler=function(){this.mScene.input.off("pointermove",this.onPointerMoveHandler,this)},EditorRoom.prototype.addPointerDownHandler=function(){this.mScene.input.on("pointerdown",this.onPointerDownHandler,this)},EditorRoom.prototype.removePointerDownHandler=function(){this.mScene.input.off("pointerdown",this.onPointerDownHandler,this)},EditorRoom.prototype.addPointerUpHandler=function(){this.mScene.input.on("pointerup",this.onPointerUpHandler,this)},EditorRoom.prototype.removePointerUpHandler=function(){this.mScene.input.off("pointerup",this.onPointerUpHandler,this)},EditorRoom.prototype.addGameObjectDownHandler=function(){this.mScene.input.on("gameobjectdown",this.onGameobjectDownHandler,this)},EditorRoom.prototype.removeGameObjectDownHandler=function(){this.mScene.input.off("gameobjectdown",this.onGameobjectDownHandler,this)},EditorRoom.prototype.addKeydownHandler=function(){this.mScene.input.keyboard.on("keydown",this.onKeyDownHandler,this)},EditorRoom.prototype.removeKeydownHandler=function(){this.mScene.input.keyboard.off("keydown",this.onKeyDownHandler,this)},EditorRoom.prototype.onPointerDownHandler=function(){var t=this.mouseFollow.nodeType;this.mouseFollow.key&&(t===a.op_def.NodeType.TerrainNodeType?this.world.elementStorage.getTerrainPalette(this.mouseFollow.key)||this.reqEditorSyncPaletteOrMoss(this.mouseFollow.key,this.mouseFollow.nodeType):t===a.op_def.NodeType.ElementNodeType&&(this.world.elementStorage.getMossPalette(this.mouseFollow.key)||this.reqEditorSyncPaletteOrMoss(this.mouseFollow.key,this.mouseFollow.nodeType))),this.addPointerMoveHandler()},EditorRoom.prototype.onPointerUpHandler=function(t){switch(this.removePointerMoveHandler(),this.brush.mode){case Q.BRUSH:this.createElements();break;case Q.SELECT:if(this.mSelectedElementEffect&&this.mSelectedElementEffect.selecting){if(t.downX!==t.upX&&t.downY!==t.upY)if(this.mSelectedElementEffect.sprite.isMoss)this.editorMossManager.updateMosses([this.mSelectedElementEffect]);else{var e=this.mSelectedElementEffect.display.element.model.toSprite();this.editorElementManager.updateElements([e])}this.mSelectedElementEffect.selecting=!1,this.mPointerDelta=null}break;case Q.ERASER:this.eraserTerrains();break;case Q.MOVE:this.mCameraService.syncCameraScroll()}},EditorRoom.prototype.onPointerMoveHandler=function(t){if(this.mScene.cameras)switch(this.mBrush.mode){case Q.BRUSH:this.mMouseFollow.nodeType===a.op_def.NodeType.TerrainNodeType&&this.createElements();break;case Q.MOVE:this.moveCameras(t);break;case Q.SELECT:this.editorSkyboxManager&&this.editorSkyboxManager.move(t),this.moveElement(t);break;case Q.ERASER:this.eraserTerrains()}},EditorRoom.prototype.moveCameras=function(t){this.cameraService.offsetScroll(t.prevPosition.x-t.position.x,t.prevPosition.y-t.position.y)},EditorRoom.prototype.reqEditorSyncPaletteOrMoss=function(t,e){var i=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_SYNC_PALETTE_MOSS),n=i.content;n.key=t,n.type=e,this.connection.send(i)},EditorRoom.prototype.createElements=function(){if(this.mMouseFollow.sprite)if(this.mMouseFollow.nodeType===a.op_def.NodeType.TerrainNodeType){var t=this.mMouseFollow.createTerrainsOrMossesData();this.editorTerrainManager&&this.editorTerrainManager.addTerrains(t)}else if(this.mMouseFollow.nodeType===a.op_def.NodeType.ElementNodeType){if(!(i=this.mMouseFollow.createSprites()))return;if(!this.editorElementManager)return;if(this.mMouseFollow.isMoss){var e=this.mMouseFollow.createTerrainsOrMossesData();this.editorMossManager.addMosses(e)}else this.editorElementManager.addElements(i)}else if(this.mMouseFollow.nodeType===a.op_def.NodeType.SpawnPointType){var i=this.mMouseFollow.createSprites();this.editorElementManager.addElements(i)}},EditorRoom.prototype.eraserTerrains=function(){var t=this.mMouseFollow.getEaserPosition();this.editorTerrainManager.removeTerrains(t)},EditorRoom.prototype.onSetEditorModeHandler=function(t){var e=t.content;this.mBrush.mode=e.mode,this.mMouseFollow&&this.mMouseFollow.destroy(),this.mBrush.mode!==Q.SELECT&&this.mSelectedElementEffect&&(this.mSelectedElementEffect.destroy(),this.mSelectedElementEffect=null,this.mPointerDelta=null),this.mBrush.mode===Q.SELECT?(this.removeGameObjectDownHandler(),this.addGameObjectDownHandler()):this.removeGameObjectDownHandler(),this.mBrush.mode===Q.ERASER&&(this.mMouseFollow||(this.mMouseFollow=new ut(this.mScene,this)),this.mMouseFollow.showEraserArea()),this.editorSkyboxManager&&this.editorSkyboxManager.removeSelect(),this.layerManager.setSurfaceInteractive(this.mBrush.mode!==Q.ERASER)},EditorRoom.prototype.onAlignGridHandler=function(t){var e=t.content;this.mouseFollow.alignGrid=e.align},EditorRoom.prototype.onVisibleGridHandler=function(t){var e=t.content;this.layerManager.setGridVisible(e.visible)},EditorRoom.prototype.onMouseFollowHandler=function(t){var e=t.content;this.mScene&&this.mouseFollow.setDisplay(e)},EditorRoom.prototype.onFetchSpriteHandler=function(t){for(var e,i=t.content,n=i.ids,o=i.nodeType,r=((e={})[a.op_def.NodeType.SpawnPointType]="elements",e[a.op_def.NodeType.ElementNodeType]="elements",e[a.op_def.NodeType.MossCollectionType]="mosses",e),s=0,h=n;s<h.length;s++){var c=h[s],l=r[o],p=this.displayObjectPool.getPool(l).get(c.toString());p&&this.selectedElement(p.getDisplay())}},EditorRoom.prototype.sendFetch=function(t,e,i){if(this.mSelectedElementEffect&&this.mSelectedElementEffect.display){var n=new s.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_FETCH_SPRITE),o=n.content;o.ids=t,o.isMoss=i,o.nodeType=e,this.connection.send(n),h.a.getInstance().log("fetch sprite",o)}},EditorRoom.prototype.onFetchSceneryHandler=function(t){if(this.mSelectedElementEffect&&(this.mSelectedElementEffect.destroy(),this.mSelectedElementEffect=null,this.mPointerDelta=null),this.editorSkyboxManager){var e=t.content;this.editorSkyboxManager.fetch(e.id)}},EditorRoom.prototype.onGameobjectDownHandler=function(t,e){var i=e.parentContainer.parentContainer||e.parentContainer;if(i){var n=this.selectedElement(i);n&&this.sendFetch([n.element.id],a.op_def.NodeType.ElementNodeType,n.element.model.isMoss)}},EditorRoom.prototype.selectedElement=function(t){if(t instanceof C.b&&!(t instanceof gt.a))return this.mSelectedElementEffect||(this.mSelectedElementEffect=new Pt(this.mScene,this.layerManager)),this.mSelectedElementEffect.setElement(t),this.editorSkyboxManager&&this.editorSkyboxManager.removeSelect(),t},EditorRoom.prototype.onKeyDownHandler=function(t){if(this.editorSkyboxManager&&this.editorSkyboxManager.keyboardMove(t.keyCode),this.mSelectedElementEffect)switch(t.keyCode){case 37:case 38:case 39:case 40:case 65:case 87:case 83:case 68:this.keyboardMoveElement(t.keyCode)}},EditorRoom.prototype.keyboardMoveElement=function(t){var e=this.mSelectedElementEffect.display;if(e){var i=new c.a(e.x,e.y,e.z);switch(t){case 37:i.x--;break;case 38:i.y--;break;case 39:i.x++;break;case 40:i.y++}e.setPosition(i.x,i.y,i.z),this.layerManager.depthSurfaceDirty=!0}},EditorRoom.prototype.moveElement=function(t){if(this.mSelectedElementEffect&&this.mSelectedElementEffect.selecting&&this.mouseFollow&&this.mSelectedElementEffect.display){if(!this.mPointerDelta){var e=new Phaser.GameObjects.Components.TransformMatrix,i=new Phaser.GameObjects.Components.TransformMatrix;this.mSelectedElementEffect.display.getWorldTransformMatrix(e,i),this.mPointerDelta=new c.a(e.tx-t.worldX,e.ty-t.worldY)}var n=new c.a(this.mPointerDelta.x+t.worldX,this.mPointerDelta.y+t.worldY),o=this.mMouseFollow.transitionGrid(n.x/this.mScaleRatio,n.y/this.mScaleRatio);o&&(o.x===this.mSelectedElementEffect.display.x&&o.y===this.mSelectedElementEffect.display.y||(this.mSelectedElementEffect.setDisplayPos(o.x,o.y),this.mLayManager.depthSurfaceDirty=!0))}},Object.defineProperty(EditorRoom.prototype,"brush",{get:function(){return this.mBrush},enumerable:!1,configurable:!0}),Object.defineProperty(EditorRoom.prototype,"miniSize",{get:function(){return this.mNimiSize},enumerable:!1,configurable:!0}),Object.defineProperty(EditorRoom.prototype,"mouseFollow",{get:function(){return this.mMouseFollow||(this.mMouseFollow=new ut(this.mScene,this)),this.mMouseFollow},enumerable:!1,configurable:!0}),EditorRoom.prototype.removeDisplay=function(t){t.sprite.isMoss?this.editorMossManager.deleteMosses([t.sprite.id]):this.editorElementManager.deleteElements([t.sprite.id]),this.removeSelected()},EditorRoom}(at),Ut=i(391),Vt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),__awaiter=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function fulfilled(t){try{step(n.next(t))}catch(t){r(t)}}function rejected(t){try{step(n.throw(t))}catch(t){r(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())}))},__generator=function(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function verb(r){return function(a){return function step(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},Gt=function(t){function RoomManager(e){var i=t.call(this)||this;return i.mRooms=[],i.mWorld=e,i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ENTER_SCENE,i.onEnterSceneHandler),i.addHandlerFun(a.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_CHANGE_TO_EDITOR_MODE,i.onEnterEditor),i}return Vt(RoomManager,t),RoomManager.prototype.addPackListener=function(){this.connection&&this.connection.addPacketListener(this)},RoomManager.prototype.removePackListener=function(){this.connection&&this.connection.removePacketListener(this)},RoomManager.prototype.getRoom=function(t){return this.mRooms.find((function(e){return e.id===t}))},RoomManager.prototype.onFocus=function(){this.mRooms.forEach((function(t){t&&t.scene&&t.resume(t.scene.scene.key)}))},RoomManager.prototype.onBlur=function(){this.mRooms.forEach((function(t){t&&t.scene&&t.pause()}))},RoomManager.prototype.pasuseRoom=function(t){var e=this.mRooms.findIndex((function(e,i){return t===e.id}));e>=0&&this.mRooms[e].pause()},RoomManager.prototype.resumeRoom=function(t){var e=this.mRooms.findIndex((function(e,i){return t===e.id}));if(e>=0){var i=this.mRooms[e];i&&i.scene&&i.resume(i.scene.scene.key)}},RoomManager.prototype.stop=function(){this.mRooms.forEach((function(t){t&&t.scene&&t.destroy()}))},RoomManager.prototype.resize=function(t,e){this.mRooms.forEach((function(i){i&&i.resize(t,e)}))},RoomManager.prototype.destroy=function(){this.removePackListener(),this.mCurRoom=null;for(var t=0,e=this.mRooms;t<e.length;t++){var i=e[t];i.destroy(),i=null}this.mRooms.length=0},RoomManager.prototype.hasRoom=function(t){return this.mRooms.findIndex((function(e,i){return t===e.id}))>=0},RoomManager.prototype.onEnterScene=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i=this;return __generator(this,(function(n){return e=t,this.hasRoom(e.scene.id)?this.onEnterRoom(t):this.world.loadSceneConfig(e.scene.id.toString()).then((function(e){return __awaiter(i,void 0,void 0,(function(){return __generator(this,(function(i){return this.world.elementStorage.setSceneConfig(e),this.onEnterRoom(t),[2]}))}))})),[2]}))}))},RoomManager.prototype.onEnterRoom=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(i){switch(i.label){case 0:return this.mCurRoom?[4,this.leaveScene(this.mCurRoom)]:[3,2];case 1:i.sent(),i.label=2;case 2:return e=new at(this),this.mRooms.push(e),e.addActor(t.actor),e.enter(t.scene),this.mCurRoom=e,[2]}}))}))},RoomManager.prototype.onEnterDecorate=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i;return __generator(this,(function(n){switch(n.label){case 0:return this.mCurRoom?[4,this.leaveScene(this.mCurRoom)]:[3,2];case 1:n.sent(),n.label=2;case 2:return(e=new Ut.a(this)).enter(t.scene),(i=t.actor)&&e.setEnterPos(i.x,i.y),this.mRooms.push(e),this.mCurRoom=e,[2]}}))}))},RoomManager.prototype.onEnterEditor=function(t){var e=t.content,i=new Ht(this);i.enter(e.scene),this.mCurRoom=i,this.mRooms.push(i)},RoomManager.prototype.leaveScene=function(t){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(i){return t?[2,new Promise((function(i,n){var o=e.mWorld.game.scene.getScene(S.a.name);o&&o.show().then((function(){e.mRooms=e.mRooms.filter((function(e){return e.id!==t.id})),t.destroy(),i()}))}))]:[2]}))}))},RoomManager.prototype.onEnterSceneHandler=function(t){var e=t.content;switch(e.scene.sceneType){case a.op_def.SceneTypeEnum.NORMAL_SCENE_TYPE:this.onEnterScene(e);break;case a.op_def.SceneTypeEnum.EDIT_SCENE_TYPE:this.onEnterDecorate(e)}},Object.defineProperty(RoomManager.prototype,"world",{get:function(){return this.mWorld},enumerable:!1,configurable:!0}),Object.defineProperty(RoomManager.prototype,"currentRoom",{get:function(){return this.mCurRoom},enumerable:!1,configurable:!0}),Object.defineProperty(RoomManager.prototype,"connection",{get:function(){if(this.mWorld)return this.mWorld.connection;h.a.getInstance().error("world manager is undefined")},enumerable:!1,configurable:!0}),RoomManager}(s.PacketHandler)},,function(t,e,i){"use strict";i.d(e,"a",(function(){return b}));var n,o=i(110),r=i(131),s=i(128),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function CreateRoleScene(){return t.call(this,{key:CreateRoleScene.name})||this}return a(CreateRoleScene,t),CreateRoleScene.prototype.init=function(t){t.role&&(this.role=t.role)},CreateRoleScene.prototype.create=function(){this.role&&(this.game.scene.stop(r.a.name),this.role.start(this))},CreateRoleScene}(s.a),c=i(112),l=i(121),p=i(117),d=i(153),m=i(154),u=i(113),f=i(114),y=i(109),g=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),_=function(t){function CreateRolePanel(e,i){var n=t.call(this,e,i)||this;return n.key="createCharacter",n.mCurPageNum=0,n.setTween(!1),n.scene.add.container(0,0).add(n),e.scale.on("resize",n.onResize,n),n}return g(CreateRolePanel,t),CreateRolePanel.prototype.show=function(e){e&&(this.avatars=e.avatars),t.prototype.show.call(this,e)},CreateRolePanel.prototype.preload=function(){this.addAtlas(this.key,"create_role/create_role.png","create_role/create_role.json"),t.prototype.preload.call(this)},CreateRolePanel.prototype.resize=function(t,e){this.mWorld.getSize();if(this.setSize(this.scaleWidth,this.scaleHeight),this.mBackground){var i=this.scale,n=this.scene.cameras.main.width/i,o=this.scene.cameras.main.height/i,r=this.scene.cameras.main.centerX/i;this.mBackground.x=r,this.mFoot.x=r,this.mFoot.y=o-(this.mFoot.height>>1),this.mBackgroundColor.clear(),this.mBackgroundColor.fillGradientStyle(7304703,7304703,314367,314367),this.mBackgroundColor.fillRect(0,0,n,o),this.mSubmit.x=r,this.inputText.x=r,this.mInputTextBg.x=r,this.dragonbones.x=r,this.mNextPageBtn.x=n-150,this.mRandomBtn.x=this.mInputTextBg.x+this.mInputTextBg.width/2-26*this.dpr}},CreateRolePanel.prototype.init=function(){var e=this.mWorld.getSize(),i=this.mWorld.uiScale;this.mBackground=this.scene.make.image({key:this.key,frame:"bg.png",x:e.width>>1}).setScale(i),this.mBackground.y=this.mBackground.height/2+92*this.dpr,this.add(this.mBackground),this.mFoot=this.scene.make.image({key:this.key,frame:"bg_foot.png"},!1),this.add(this.mFoot),this.mBackgroundColor=this.scene.make.graphics(void 0,!1),this.mBackgroundColor.fillGradientStyle(7304703,7304703,314367,314367),this.mBackgroundColor.fillRect(0,0,e.width,e.height),this.addAt(this.mBackgroundColor,0),this.mInputTextBg=new p.NinePatch(this.scene,e.width>>1,350*this.dpr,255*this.dpr,50*this.dpr,this.key,"input_bg.png",{left:27*this.dpr,top:24*this.dpr,right:28*this.dpr,bottom:24*this.dpr}),this.add(this.mInputTextBg),this.inputText=new y.InputText(this.scene,e.width>>1,350*this.dpr,160*this.dpr,80,{type:"input",fontSize:18*this.dpr+"px",color:"#717171",align:"center",placeholder:f.a.t("create_role.enter_nick")}).setOrigin(.5),this.add(this.inputText);var n=f.a.t("create_role.commit");this.mShowData&&this.mShowData.button&&(n=this.mShowData.button.text);var o=this.scene.textures.getFrame(this.key,"submit_button_normal"),r=42,s=43;o&&(r=o.width,s=o.height),this.mSubmit=new l.NinePatchButton(this.scene,e.width>>1,445*this.dpr,202*this.dpr,55*this.dpr,this.key,"submit_button",n,{left:19*this.dpr,top:20*this.dpr,right:r-2-19*this.dpr,bottom:s-2-20*this.dpr}),this.mSubmit.setTextStyle({color:"#976400",fontSize:18*this.dpr,fontFamily:u.a.DEFULT_FONT}),this.mSubmit.setFontStyle("bold"),this.mSubmit.on("pointerup",this.onSubmitHandler,this),this.add(this.mSubmit),this.mPrePageBtn=this.scene.make.image({x:60*this.dpr,y:216*this.dpr,key:this.key,frame:"arrow_left.png"}).setInteractive(),this.mPrePageBtn.on("pointerup",this.onPrePageHandler,this),this.mNextPageBtn=this.scene.make.image({x:e.width-60*this.dpr,y:this.mPrePageBtn.y,key:this.key,frame:"arrow.png"}).setFlipX(!0).setInteractive(),this.mNextPageBtn.on("pointerup",this.onNextPageHandler,this),this.mRandomBtn=this.scene.make.image({x:this.mInputTextBg.x,y:this.mInputTextBg.y,key:this.key,frame:"random.png"}).setInteractive(),this.add([this.mPrePageBtn,this.mNextPageBtn,this.mRandomBtn]),this.mRandomBtn.on("pointerup",this.onRandomNameHandler,this),this.mErrorBg=this.scene.make.image({key:this.key,frame:"tips_bg.png",x:220*this.dpr,y:57*this.dpr}).setVisible(!1),this.mError=this.scene.make.text({x:127*this.dpr,y:30*this.dpr,style:{color:"#26265d",font:"bold 34px YaHei",wordWrap:{width:420,useAdvancedWrap:!0}}},!1).setVisible(!1),this.add([this.mErrorBg,this.mError]),this.dragonbones=new d.a(this.scene,void 0,void 0,!0),this.dragonbones.scale=2*this.dpr,this.dragonbones.x=e.width>>1,this.dragonbones.y=this.mNextPageBtn.y+70*this.dpr,this.dragonbones.on("initialized",this.loadDragonbonesComplete,this),this.add(this.dragonbones),this.setPageNum(0),t.prototype.init.call(this),this.resize(0,0)},CreateRolePanel.prototype.setAvatars=function(t){this.avatars=t},CreateRolePanel.prototype.showError=function(t){this.mError&&(this.mError.text=t,this.mError.setVisible(!0),this.mErrorBg.setVisible(!0))},CreateRolePanel.prototype.setNickName=function(t){this.inputText&&(this.inputText.text=t)},CreateRolePanel.prototype.destroy=function(){this.scene&&this.scene.scale.off("resize",this.onResize,this),this.dragonbones&&this.dragonbones.off("initialized",this.loadDragonbonesComplete,this),t.prototype.destroy.call(this)},CreateRolePanel.prototype.onRandomNameHandler=function(){this.emit("randomName"),this.inputText.setBlur()},CreateRolePanel.prototype.onSubmitHandler=function(){this.emit("submit",this.inputText.text,this.avatars[this.mCurPageNum]),this.inputText.setBlur(),this.mError&&(this.mError.setVisible(!1),this.mErrorBg.setVisible(!1))},CreateRolePanel.prototype.onPrePageHandler=function(){this.setPageNum(this.mCurPageNum-1),this.inputText.setBlur()},CreateRolePanel.prototype.onNextPageHandler=function(){this.setPageNum(this.mCurPageNum+1),this.inputText.setBlur()},CreateRolePanel.prototype.setPageNum=function(t){this.mCurPageNum=t,this.mCurPageNum<0?this.mCurPageNum=this.avatars.length-1:this.mCurPageNum>=this.avatars.length&&(this.mCurPageNum=0),this.dragonbones.load(new m.a({id:0,avatar:this.avatars[this.mCurPageNum]}))},CreateRolePanel.prototype.onResize=function(t){this.resize(t.width,t.height)},CreateRolePanel.prototype.loadDragonbonesComplete=function(){this.dragonbones.play({name:"idle",flip:!1})},CreateRolePanel}(c.BasePanel),P=i(2),v=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),w=function(t){function CreateRole(e){var i=t.call(this)||this;return i.roleManager=e,i.world=i.roleManager.world,i}return v(CreateRole,t),CreateRole.prototype.enter=function(t){this.mAvatars=t.avatars,this.mParam=t,this.world.game.scene.getScene(h.name)||this.world.game.scene.add(h.name,h),this.world.game.scene.start(h.name,{world:this.world,role:this})},CreateRole.prototype.start=function(t){this.createPanel=new _(t,this.world),this.createPanel.show(this.mParam),this.createPanel.on("randomName",this.onRandomNameHandler,this),this.createPanel.on("submit",this.onSubmitHandler,this),this.world.connection&&(this.world.connection.addPacketListener(this),this.addHandlerFun(P.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CREATE_ROLE_ERROR_MESSAGE,this.onCreateErrorHandler),this.addHandlerFun(P.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CREATE_ROLE_GENERATE_NEW_NAME,this.onGenerateNameHandler))},CreateRole.prototype.destroy=function(){this.world.connection&&this.world.connection.removePacketListener(this),this.world.game.scene.remove(h.name)},CreateRole.prototype.onRandomNameHandler=function(){var t=this.world.connection,e=new o.PBpacket(P.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_CREATE_ROLE_GENERATE_NEW_NAME);t.send(e)},CreateRole.prototype.onSubmitHandler=function(t,e){var i=this.world.connection,n=new o.PBpacket(P.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_CREATE_ROLE),r=n.content;r.name=t,r.avatar=e,i.send(n)},CreateRole.prototype.onCreateErrorHandler=function(t){if(this.createPanel){var e=t.content;this.createPanel.showError(e.errorMsg)}},CreateRole.prototype.onGenerateNameHandler=function(t){if(this.createPanel){var e=t.content;this.createPanel.setNickName(e.name)}},CreateRole}(o.PacketHandler),S=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),b=function(t){function RoleManager(e){var i=t.call(this)||this;return i.world=e,i}return S(RoleManager,t),RoleManager.prototype.register=function(){if(this.world){var t=this.world.connection;t&&(t.addPacketListener(this),this.addHandlerFun(P.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SHOW_CREATE_ROLE_UI,this.onOpenCreateCharacter),this.addHandlerFun(P.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_CLOSE_CREATE_ROLE_UI,this.onCloseCreateCharacterHandler))}},RoleManager.prototype.unregister=function(){if(this.world){var t=this.world.connection;t&&t.removePacketListener(this)}},RoleManager.prototype.onOpenCreateCharacter=function(t){this.mCreateCharacter=new w(this),this.mCreateCharacter.enter(t.content)},RoleManager.prototype.onCloseCreateCharacterHandler=function(){this.mCreateCharacter&&(this.mCreateCharacter.destroy(),this.mCreateCharacter=void 0)},RoleManager}(o.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return g}));var n,o=i(340),r=i(2),s=i(126),a=i(118),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PlayerModel(e){var i=t.call(this,e)||this;return i.mPos=new a.a(e.x,e.y,e.z),i.mAlpha=1,i.mPackage=e.package,i.mSceneId=e.sceneId,i.mUuid=e.uuid,i.mPlatformId=e.platformId,i.currentAnimationName="idle",i}return h(PlayerModel,t),PlayerModel}(s.a),l=i(122),p=i(110),d=function(){function PlayerData(){}return PlayerData.prototype.destroy=function(){this.itemBag&&this.itemBag.destroy(),this.furniBag&&this.furniBag.destroy(),this.avatarBag&&this.avatarBag.destroy(),this.mineBag&&this.mineBag.destroy(),this.editFurniBag&&this.editFurniBag.destroy(),this.itemBag=void 0,this.furniBag=void 0,this.avatarBag=void 0,this.mineBag=void 0,this.editFurniBag=void 0},PlayerData.prototype.getItemsByCategory=function(t,e){return this.getPackage(t).getItemsByCategory(e)},PlayerData.prototype.getItems=function(t,e,i){return this.getPackage(t).getItems(e,i)},PlayerData.prototype.getItem=function(t,e,i,n){return this.getPackage(t).getItem(e,i,n)},PlayerData.prototype.getItemsCount=function(t,e,i){var n=this.getItems(t,e,i),o=0;return n.forEach((function(t){o+=t.count})),o},PlayerData.prototype.syncPackage=function(t){var e=this.getPackage(t.packageName);return e.syncPackage(t),e},PlayerData.prototype.updatePackage=function(t){this.getPackage(t.packageName).updatePackage(t)},PlayerData.prototype.getPackage=function(t){return t===r.op_pkt_def.PKT_PackageType.PropPackage?(this.itemBag||(this.itemBag=new m),this.itemBag):t===r.op_pkt_def.PKT_PackageType.FurniturePackage?(this.furniBag||(this.furniBag=new m),this.furniBag):t===r.op_pkt_def.PKT_PackageType.AvatarPackage?(this.avatarBag||(this.avatarBag=new m),this.avatarBag):t===r.op_pkt_def.PKT_PackageType.MinePackage?(this.mineBag||(this.mineBag=new m),this.mineBag):t===r.op_pkt_def.PKT_PackageType.EditFurniturePackage?(this.editFurniBag||(this.editFurniBag=new m),this.editFurniBag):void 0},PlayerData}(),m=function(){function PackageData(){this.syncFinish=!1,this.list=[],this.subMap=new Map}return PackageData.prototype.getItemsByCategory=function(t){if("alltype"===t)return Array.from(this.list);if(this.subMap.has(t)){var e=this.subMap.get(t);if(e)return Array.from(e.values())}},PackageData.prototype.getItems=function(t,e){var i=[];if(void 0!==e&&"alltype"!==e){var n=this.subMap.get(e);n&&n.forEach((function(e){e.id===t&&i.push(e)}))}else this.list.forEach((function(e){e.id===t&&i.push(e)}));return i},PackageData.prototype.getItem=function(t,e,i){var n;if(void 0!==i&&"alltype"!==i){var o=this.subMap.get(i);if(o){if(t&&o.has(t))return o.get(t);e&&o.forEach((function(t){if(t.id===e)return n=t}))}}else this.subMap.forEach((function(i){if(t&&i.has(t))return n=i.get(t);e&&i.forEach((function(t){if(t.id===e)return n=t}))}));return n},PackageData.prototype.syncPackage=function(t){this.packageName=t.packageName,this.syncFinish&&this.clear();for(var e=0,i=t.items;e<i.length;e++){var n=i[e],o=void 0!==n.subcategory?n.subcategory:"default",r=this.subMap.get(o);r||(r=new Map,this.subMap.set(o,r)),r.set(n.indexId,n),this.list.push(n)}t.packet.currentFrame===t.packet.totalFrame&&(this.syncFinish=!0),this.limit=t.limit},PackageData.prototype.updatePackage=function(t){for(var e=0,i=t.items;e<i.length;e++){var n=i[e];if("-1"===n.id){for(var o=void 0,r=-1,s=0,a=this.list;s<a.length;s++){var h=a[s];if(r++,h.indexId===n.indexId){o=h;break}}if(o){this.list.splice(r,1);var c=void 0!==o.subcategory?o.subcategory:"default";(l=this.subMap.get(c))&&l.has(o.indexId)&&l.delete(o.indexId)}}else{var l;c=void 0!==n.subcategory?n.subcategory:"default";if((l=this.subMap.get(c))||(l=new Map,this.subMap.set(c,l)),l.has(n.indexId)){o=l.get(n.indexId);for(var p in n)o[p]=n[p]}else l.set(n.indexId,n),this.list.push(n)}}},PackageData.prototype.destroy=function(){this.list.length=0,this.subMap.forEach((function(t){t.clear()})),this.subMap.clear(),this.list=null,this.subMap=null},PackageData.prototype.clear=function(){this.list.length=0,this.subMap.forEach((function(t){t.clear()})),this.subMap.clear()},PackageData}(),u=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),f=function(t){function PlayerDataManager(e){var i=t.call(this)||this;return i.mWorld=e,i.mEvent=new Phaser.Events.EventEmitter,i.mPlayerData=new d,i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_SYNC_PACKAGE,i.onSYNC_PACKAHE),i.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_UPDATE_PACKAGE,i.onUPDATE_PACKAGE),i}return u(PlayerDataManager,t),PlayerDataManager.prototype.addPackListener=function(){this.connection&&this.connection.addPacketListener(this)},PlayerDataManager.prototype.removePackListener=function(){this.connection&&this.connection.removePacketListener(this)},PlayerDataManager.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PlayerDataManager.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PlayerDataManager.prototype.clear=function(){this.removePackListener(),this.playerData.destroy(),this.mEvent.removeAllListeners()},PlayerDataManager.prototype.destroy=function(){this.removePackListener(),this.mEvent.destroy(),this.playerData.destroy()},Object.defineProperty(PlayerDataManager.prototype,"connection",{get:function(){if(this.mWorld)return this.mWorld.connection},enumerable:!1,configurable:!0}),Object.defineProperty(PlayerDataManager.prototype,"playerData",{get:function(){if(this.mPlayerData)return this.mPlayerData},enumerable:!1,configurable:!0}),PlayerDataManager.prototype.querySYNC_ALL_PACKAGE=function(){this.querySYNC_PACKAGE(r.op_pkt_def.PKT_PackageType.PropPackage),this.querySYNC_PACKAGE(r.op_pkt_def.PKT_PackageType.AvatarPackage),this.querySYNC_PACKAGE(r.op_pkt_def.PKT_PackageType.FurniturePackage)},PlayerDataManager.prototype.querySYNC_PACKAGE=function(t){var e=new p.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_SYNC_PACKAGE);e.content.packageName=t,this.connection.send(e)},PlayerDataManager.prototype.onSYNC_PACKAHE=function(t){var e=t.content;this.playerData.syncPackage(e).syncFinish&&this.mEvent.emit("syncfinish",e.packageName)},PlayerDataManager.prototype.onUPDATE_PACKAGE=function(t){var e=t.content;this.playerData.updatePackage(e),this.mEvent.emit("update",e.packageName)},PlayerDataManager}(p.PacketHandler),y=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),g=function(t){function User(e){var i=t.call(this,void 0,void 0)||this;return i.mBlockable=!1,i.mBag=new f(e),i}return y(User,t),User.prototype.addPackListener=function(){this.mBag.addPackListener()},User.prototype.removePackListener=function(){this.mBag.removePackListener()},User.prototype.enterScene=function(t,e){if(t&&e){this.mId=e.id,this.mRoomService=t,this.mElementManager=t.playerManager,this.model=new c(e),t.world.inputManager&&t.world.inputManager.addListener(this),this.mRoomService.playerManager.setMe(this);var i=this.mElementManager.roomService;if(i&&i.cameraService){var n=this.mElementManager.scene.scale;i.cameraService.setScroll(e.x*i.world.scaleRatio-n.width/2,e.y*i.world.scaleRatio-n.height/2),i.cameraService.syncCameraScroll()}}},User.prototype.downHandler=function(t,e){if(this.mDisplay&&(this.startMove(),!this.roomService.world.game.device.os.desktop)){var i=new p.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN);i.content.keyCodes=e,this.mRoomService.connection.send(i)}},User.prototype.upHandler=function(){this.mDisplay&&this.stopMove()},User.prototype.startMove=function(){t.prototype.startMove.call(this)},User.prototype.stopMove=function(){if(t.prototype.stopMove.call(this),this.mRoomService&&this.mRoomService.world.moveStyle===r.op_def.MoveStyle.DIRECTION_MOVE_STYLE){var e=new p.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_STOP_SPRITE),i=e.content;i.nodeType=this.nodeType;var n=this.getPosition();i.spritePositions={id:this.id,point3f:{x:n.x,y:n.y,z:n.z},direction:this.dir},this.mElementManager.connection.send(e)}},User.prototype.move=function(e){if(this.mRoomService.world.moveStyle===r.op_def.MoveStyle.DIRECTION_MOVE_STYLE){if(this.mCurState!==l.d.WALK)return}else this.startMove();t.prototype.move.call(this,e)},User.prototype.movePath=function(e){if(this.mRoomService.world.moveStyle!==r.op_def.MoveStyle.DIRECTION_MOVE_STYLE||this.mCurState===l.d.WALK){var i=e.path,n=this.mElementManager.roomService.now(),o=0;i.map((function(t){return n+=o,o=t.timestemp-n,{x:t.point3f.x,y:t.point3f.y,duration:o,timestemp:t.timestemp}}));t.prototype.movePath.call(this,e)}},User.prototype.setRenderable=function(t){},User.prototype.getBag=function(){},User.prototype.getFriend=function(){},User.prototype.clear=function(){this.removePackListener(),t.prototype.clear.call(this),this.mBag&&this.bag.destroy(),this.destroy()},User.prototype.onMoveComplete=function(){this.preMoveComplete(),this.mCurState===l.d.WALK?(this.mRoomService.world.moveStyle!==r.op_def.MoveStyle.DIRECTION_MOVE_STYLE&&(this.changeState(l.d.IDLE),this.stopMove()),this._doMove()):this.mMoveData.tweenAnim.stop()},User.prototype.onMoving=function(){this.mCurState===l.d.WALK?t.prototype.onMoving.call(this):this.mMoveData.tweenLineAnim.stop()},User.prototype.addToBlock=function(){this.addDisplay()},User.prototype.drawPath=function(t){},Object.defineProperty(User.prototype,"model",{get:function(){return this.mModel},set:function(t){this.mModel=t,t&&(t.package,this.load(this.mModel.displayInfo),this.mModel.pos&&this.setPosition(this.mModel.pos),this.mDisplay.changeAlpha(this.mModel.alpha),this.mModel.nickname&&this.showNickname(),this.setDirection(this.mModel.direction))},enumerable:!1,configurable:!0}),Object.defineProperty(User.prototype,"package",{get:function(){},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(User.prototype,"moveData",{get:function(){return this.mMoveData},enumerable:!1,configurable:!0}),Object.defineProperty(User.prototype,"bag",{get:function(){return this.mBag},enumerable:!1,configurable:!0}),Object.defineProperty(User.prototype,"moveStyle",{get:function(){return this.mMoveStyle},set:function(t){this.mMoveStyle=t},enumerable:!1,configurable:!0}),User}(o.a)},function(t,e,i){"use strict";var n=i(110),o=i(44),r=i(0),mainWorker=function(){return new Worker(i.p+"js/46864bac6af2e084f75c.mainWorker.js")},s=i(2),a=i(16);for(var h in s)n.PBpacket.addProtocol(s[h]);var c=function(){function Connection(t){this.mPacketHandlers=[],this._isConnect=!1,this.mListener=t}return Connection.prototype.isConnect=function(){return this._isConnect},Connection.prototype.startConnect=function(t,e){this.mCachedServerAddress=t;try{this.mMainWorker=new mainWorker,this.mMainWorker.postMessage({method:"init"}),this._doConnect()}catch(t){throw new Error("startConnect Error: "+t)}},Connection.prototype.closeConnect=function(){this._isConnect=!1,this.mMainWorker&&(r.a.getInstance().log("close connect"),this.mMainWorker.postMessage({method:"close"}),this.mMainWorker.terminate(),this.mMainWorker=null),this.mCachedServerAddress=void 0,this.mTimeout=null,this.clearPacketListeners()},Connection.prototype.clearHeartBeat=function(){this.mMainWorker&&this.mMainWorker.postMessage({method:"clearBeat"})},Connection.prototype.addPacketListener=function(t){this.mPacketHandlers.push(t)},Connection.prototype.send=function(t){if(!this.mMainWorker)throw new Error("NetWorker is undefined.");this.mMainWorker.postMessage({method:"send",buffer:t.Serialization()})},Connection.prototype.clearReconnectCount=function(){this.mMainWorker.postMessage("clearBeat")},Connection.prototype.removePacketListener=function(t){var e=this.mPacketHandlers.indexOf(t);-1!==e&&this.mPacketHandlers.splice(e,1)},Connection.prototype.clearPacketListeners=function(){if(this.mPacketHandlers&&!(this.mPacketHandlers.length<1))for(var t=this.mPacketHandlers.length,e=0;e<t;e++){var i=this.mPacketHandlers[e];i&&(this.removePacketListener(i),e--)}},Connection.prototype.onFocus=function(){this.mMainWorker&&this.mMainWorker.postMessage({method:"focus"})},Connection.prototype.onBlur=function(){this.mMainWorker&&this.mMainWorker.postMessage({method:"blur"})},Connection.prototype.loadRes=function(t){this.mMainWorker&&this.mMainWorker.postMessage({method:"loadRes",url:t})},Connection.prototype.move=function(t,e){this.mMainWorker&&this.mMainWorker.postMessage({method:"move",data:e})},Connection.prototype._doConnect=function(){var t=this;this.mMainWorker&&(this.mMainWorker.onmessage=function(e){t.onWorkerMessage(e.data)},this.mMainWorker.postMessage({method:"connect",address:t.mCachedServerAddress}))},Connection.prototype.onWorkerMessage=function(t){switch(t.method){case"canStartBeat":r.a.getInstance().log("canStartBeat"),this.mMainWorker&&this.mMainWorker.postMessage({method:"startBeat"});break;case"onConnected":this.mListener.onConnected(),this._isConnect=!0;break;case"onReconnect":this._isConnect=!1,this.closeConnect(),this.mListener.onReconnect();break;case"onDisConnected":this._isConnect=!1,this.closeConnect(),this.mListener.onDisConnected();break;case"onConnectError":this._isConnect=!1,this.mListener.onError(),r.a.getInstance().error("error"+t.error);break;case"heartBeat":this.worldStartHeartBeat();break;case"endBeat":this.endHeartBeat();break;case"reConnect":this.closeConnect(),this.reConnect();break;default:t instanceof ArrayBuffer?this._onData(t):t instanceof Blob&&this._onBlob(t)}},Connection.prototype._onBlob=function(t){var e=this;new Promise((function(i,n){var o=new FileReader;o.readAsDataURL(t),o.onload=function(i){switch(t.type){case"image/png":break;case"application/json":new Response(t).arrayBuffer().then((function(t){var i=new a.Lite;i.deserialize(new Uint8Array(t)),e.mListener.elementStorage.setGameConfig(i)}))}}}))},Connection.prototype._onData=function(t){var e=new n.PBpacket;e.Deserialization(new o.Buffer(t)),this.mPacketHandlers.forEach((function(t){t.onPacketArrived(e)}))},Connection.prototype.reConnect=function(){this.mPacketHandlers[0].reconnect()},Connection.prototype.worldStartHeartBeat=function(){this.mPacketHandlers[0].startHeartBeat()},Connection.prototype.endHeartBeat=function(){this.mMainWorker&&this.mMainWorker.postMessage({method:"endHeartBeat"})},Connection}();e.a=c},function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n,o=i(110),r=i(2),s=function(){function Algorithm(){}return Algorithm.median=function(t){var e=t.sort((function(t,e){return e-t})),i=Math.floor(e.length/2);return e.length%2==0?(e[i-1]+e[i])/2:e[i]},Algorithm}(),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Clock(e,i){var n=t.call(this)||this;return n.mClockSync=!1,n.mAutoSync=!1,n.mTimestamp=0,n.mLatency=[],n.mConn=e,n.mConn.addPacketListener(n),n.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SYNC_TIME,n.proof),n.mListener=i,n._check(),n}return a(Clock,t),Object.defineProperty(Clock.prototype,"sysUnixTime",{get:function(){return(new Date).getTime()},enumerable:!1,configurable:!0}),Object.defineProperty(Clock.prototype,"unixTime",{get:function(){return this.mTimestamp},set:function(t){this.mTimestamp=t},enumerable:!1,configurable:!0}),Clock.prototype.sync=function(t){if(void 0===t&&(t=1),this.mConn){t<0&&(t=1);for(var e=0;e<t;++e){var i=new o.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_TIME);i.content.clientStartTs=this.sysUnixTime,this.mConn.send(i)}}},Clock.prototype.update=function(t,e){this.mTimestamp?this.mTimestamp+=e:this.mTimestamp=t},Clock.prototype.clearTime=function(){this.mClockSync=!1,this.mIntervalId&&clearInterval(this.mIntervalId),this.mTimestamp=0,this._check()},Clock.prototype.destroy=function(){this.mConn&&(this.mConn.removePacketListener(this),this.mConn=void 0),this.mIntervalId&&clearInterval(this.mIntervalId),this.mLatency=void 0},Object.defineProperty(Clock.prototype,"clockSync",{get:function(){return this.mClockSync},enumerable:!1,configurable:!0}),Clock.prototype._check=function(){var t=this;this.mIntervalId=setInterval((function(){t.sync()}),600)},Clock.prototype.proof=function(t){var e=t.content,i=this.sysUnixTime,n=e.clientStartTs,o=e.serverReceiveTs,r=e.serverSendTs,a=r-o,h=i-n-a,c=Math.round(h/2);if(!(c<0)){this.mLatency.push(c),this.mLatency.length>7&&this.mLatency.shift();var l=r-(s.median(this.mLatency)+a);if(Math.abs(l-this.mTimestamp)>500)return this.mTimestamp=l,this.mAutoSync=!0,void this.sync(-1);this.mAutoSync=!1,this.mListener&&this.mLatency.length>=2&&!this.mAutoSync&&(this.mClockSync=!0,this.mListener.onClockReady())}},Object.defineProperty(Clock.prototype,"medianLatency",{get:function(){return s.median(this.mLatency)},enumerable:!1,configurable:!0}),Clock}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),function(t){i.d(e,"World",(function(){return A}));var n,o=i(25),r=(i(45),i(394)),s=i(110),a=i(2),h=i(429),c=i(0),l=i(425),p=i(409),d=i(410),m=i(411),u=i(412),f=i(413),y=i(111),g=i(16),_=i(183),P=i(416),v=i(417),w=i(418),S=i(419),b=i(430),C=i(427),T=i(114),I=i(11),M=i(146),E=i(420),k=i(421),B=i(422),O=i(423),D=i(428),R=i(424),x=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),__awaiter=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function fulfilled(t){try{step(n.next(t))}catch(t){r(t)}}function rejected(t){try{step(n.throw(t))}catch(t){r(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())}))},__generator=function(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function verb(r){return function(a){return function step(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},A=function(e){function World(t,i){var n=e.call(this)||this;return n.isPause=!1,n.DEFAULT_WIDTH=360,n.DEFAULT_HEIGHT=640,n.mMoveStyle=1,n.isFullStart=!1,n.mOrientation=0,n.gameConfigUrls=new Map,n.gameConfigUrl="",n.reconnectIng=!1,n._isIOS=-1,n.mReconnect=0,n.focusoutFunc=function(){n.game&&n.game.device.os.iOS&&window.scrollTo(0,0)},n.gameState=r.a.NONE,n.initWorld(t,i),n}return x(World,e),World.prototype.initWorld=function(e,i){if(this.mCallBack=i,this.mConfig=e,!e.game_id)throw new Error("Config.game_id is required.");e.devicePixelRatio||(e.devicePixelRatio=window.devicePixelRatio||1),void 0===e.width&&(e.width=window.innerWidth),void 0===e.height&&(e.height=window.innerHeight),this.mScaleRatio=Math.ceil(e.devicePixelRatio||1),this.mUIRatio=Math.round(e.devicePixelRatio||1);var n=e.width/this.DEFAULT_WIDTH*(e.devicePixelRatio/this.mUIRatio);this.mUIScale=n,y.i.OSD_PATH=this.mConfig.osd||"https://osd-alpha.tooqing.com/",y.i.RES_PATH="./resources/",y.i.RESUI_PATH="./resources/ui/",this.mUser=new D.a(this),this._newGame(),this.mConnection=e.connection||new h.a(this),this.mConnection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_VIRTUAL_WORLD_INIT,this.onInitVirtualWorldPlayerInit),this.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_ERROR,this.onClientErrorHandler),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SELECT_CHARACTER,this.onSelectCharacter),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_GOTO_ANOTHER_GAME,this.onGotoAnotherGame),this.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_PONG,this.heartBeatCallBack),this.mGameEmitter=new Phaser.Events.EventEmitter,this.mRoomMamager=new l.a(this),this.mUiManager=new _.UiManager(this),this.mMouseManager=new d.a(this),this.mElementStorage=new u.a,this.mHttpService=new w.a(this),this.mRoleManager=new C.a(this),this.mSoundManager=new E.a(this),this.mLoadingManager=new k.a(this),this.mAccount=new v.a,this.mAccount.enterGame(this.mConfig.game_id,this.mConfig.virtual_world_id,null,null),Object(T.b)(I.relative(t,"../resources/locales/{{lng}}.json")),this.mRoleManager.register(),this.mRoomMamager.addPackListener(),this.mUiManager.addPackListener(),this.mSoundManager.addPackListener(),this.user.addPackListener(),this.gameState=r.a.GAME_INIT;var o=this.mConfig.server_addr||Object({host:"gdev.tooqing.com",port:11100,secure:!0});o&&this.mConnection.startConnect(o),document.body.addEventListener("focusout",this.focusoutFunc)},Object.defineProperty(World.prototype,"moveStyle",{get:function(){return this.mMoveStyle},enumerable:!1,configurable:!0}),World.prototype.getConfig=function(){return this.mConfig},World.prototype.setKeyBoardHeight=function(t){this.mConfig.keyboardHeight=t},World.prototype.setGameConfig=function(t){this.elementStorage.setGameConfig(t)},World.prototype.updatePalette=function(t){this.elementStorage.updatePalette(t)},World.prototype.updateMoss=function(t){this.elementStorage.updateMoss(t)},World.prototype.destroy=function(){var t=this;return new Promise((function(e,i){t.mConnection.closeConnect(),document.body.removeEventListener("focusout",t.focusoutFunc),t.clearGame((function(){e()}))}))},World.prototype.onConnected=function(t){this.gameState=r.a.SOCKET_CONNECT,this.mReconnect=0,this.mClock||(this.mClock=new b.a(this.mConnection,this)),this.mHttpClock||(this.mHttpClock=new B.a(this)),this.enterVirtualWorld()},World.prototype.onDisConnected=function(t){var e=this;(this.gameState=r.a.SOCKET_DISCONNECT,c.a.getInstance().log("app connectFail=====disConnect"),this.game&&!this.isPause)&&(this.mConfig.connectFail?this.onError():this.mReconnect>2?(this.mGame.scene.getScene(R.a.name)||this.mGame.scene.add(R.a.name,R.a,!1,{world:this,callBack:function(){e.clearGame().then((function(){e.initWorld(e.mConfig,e.mCallBack)}))}}),this.mGame.scene.start(R.a.name)):(this.mReconnect++,this.clearGame().then((function(){e.initWorld(e.mConfig,e.mCallBack)}))))},World.prototype.onReconnect=function(t){var e=this;this.gameState=r.a.SOCKET_DISCONNECT,c.a.getInstance().log("app connectFail=====reconnect"),this.game&&!this.isPause&&(this.mConfig.connectFail?this.onError():this.clearGame().then((function(){e.initWorld(e.mConfig,e.mCallBack)})))},World.prototype.onError=function(t){if(this.gameState=r.a.SOCKET_ERROR,c.a.getInstance().log("socket error"),!this.mConnection.isConnect){if(this.mConfig.connectFail)return c.a.getInstance().log("app connectFail"),this.mConfig.connectFail();this.reconnect()}},World.prototype.onClientErrorHandler=function(t){var e=t.content;c.a.getInstance().error("Remote Error["+e.responseStatus+"]: "+e.msg)},World.prototype.changeRoom=function(t){this.mInputManager&&this.mInputManager.onRoomChanged(t),this.mMouseManager.changeRoom(t),this.mSoundManager.changeRoom(t)},World.prototype.getSize=function(){if(this.mGame)return this.mGame.scale.gameSize},World.prototype.scaleChange=function(t){this.emitter.emit(World.SCALE_CHANGE)},World.prototype.closeGame=function(){this.mConfig.closeGame&&(this.destroy(),this.mConfig.closeGame())},World.prototype.restart=function(t,e){c.a.getInstance().log("restart game"),t&&(this.mConfig=t),e&&(this.mCallBack=e);var i=this.mConfig.game_id,n=this.mConfig.virtual_world_id;this.mAccount.gameID&&this.mAccount.virtualWorldId&&(i=this.mAccount.gameID,n=this.mAccount.virtualWorldId),this._createAnotherGame(i,n,null,null)},World.prototype.resize=function(t,e){this.mConfig&&(this.mConfig.width=t,this.mConfig.height=e);var i=t*window.devicePixelRatio,n=e*window.devicePixelRatio;if(this.mGame){this.mScaleRatio=Math.ceil(window.devicePixelRatio||1),this.mUIRatio=Math.round(window.devicePixelRatio||1);var o=t/this.DEFAULT_WIDTH*(window.devicePixelRatio/this.mUIRatio);this.mUIScale=this.game.device.os.desktop?1:o,this.mGame.scale.zoom=1/window.devicePixelRatio,this.mGame.scale.resize(i,n);for(var r=0,s=this.mGame.scene.scenes;r<s.length;r++){var a=s[r].cameras.main;a&&a.setPixelRatio&&a.setPixelRatio(this.mScaleRatio)}}this.mRoomMamager&&this.mRoomMamager.resize(i,n),this.mUiManager&&this.mUiManager.resize(i,n),this.mInputManager&&this.mInputManager.resize(i,n),c.a.getInstance().log("resize"+i+"|"+n)},World.prototype.onOrientationChange=function(t,e,i){"app"!==this.mConfig.platform&&(this.mOrientation=t,this.mConfig.screenWidth>this.mConfig.screenHeight?t<=135&&t>=45||t<=-45&&t>=-135?this.orientationResize(this.mConfig.screenWidth,this.mConfig.screenHeight,e,i):this.orientationResize(this.mConfig.screenHeight,this.mConfig.screenWidth,e,i):t<=135&&t>=45||t<=-45&&t>=-135?this.orientationResize(this.mConfig.screenHeight,this.mConfig.screenWidth,e,i):this.orientationResize(this.mConfig.screenWidth,this.mConfig.screenHeight,e,i))},World.prototype.startFullscreen=function(){this.mGame&&(this.isFullStart=!0,this.mGame.scale.startFullscreen())},World.prototype.stopFullscreen=function(){this.mGame&&(this.isFullStart=!1,this.mGame.scale.stopFullscreen())},World.prototype.onGotoAnotherGame=function(t){var e=t.content;this._createAnotherGame(e.gameId,e.virtualWorldId,e.sceneId,e.loc)},World.prototype.changeScene=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(i){switch(i.label){case 0:return t=this.mConfig.game_id,e=this.mConfig.virtual_world_id,[4,this.clearGame()];case 1:return i.sent(),this.mConfig.game_id=t,this.mConfig.virtual_world_id=e,this._newGame(),this.loginEnterWorld(),[2]}}))}))},World.prototype.reconnect=function(){if(this.mConfig.connectFail)return this.mConfig.connectFail();if(this.game&&!this.isPause&&!this.reconnectIng){this.reconnectIng=!0;var t=this.mConfig.game_id,e=this.mConfig.virtual_world_id;this.mAccount.gameID&&this.mAccount.virtualWorldId&&(t=this.mAccount.gameID,e=this.mAccount.virtualWorldId),this._createAnotherGame(t,e,null,null)}},World.prototype.startHeartBeat=function(){var t=new s.PBpacket(a.op_gateway.OPCODE._OP_CLIENT_REQ_GATEWAY_PING);this.mConnection.send(t),this.mClock.sync(-1)},World.prototype.playSound=function(t){this.mSoundManager.play(t)},Object.defineProperty(World.prototype,"uiScale",{get:function(){return this.mUIScale},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"uiRatio",{get:function(){return this.mUIRatio},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"scaleRatio",{get:function(){return this.mScaleRatio},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"game",{get:function(){return this.mGame},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"roomManager",{get:function(){return this.mRoomMamager},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"orientation",{get:function(){return this.mOrientation},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"elementStorage",{get:function(){return this.mElementStorage},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"uiManager",{get:function(){return this.mUiManager},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"mouseManager",{get:function(){return this.mMouseManager},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"inputManager",{get:function(){return this.mInputManager},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"connection",{get:function(){return this.mConnection},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"clock",{get:function(){return this.mClock},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"httpClock",{get:function(){return this.mHttpClock},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"emitter",{get:function(){return this.mGameEmitter},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"httpService",{get:function(){return this.mHttpService},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"account",{get:function(){return this.mAccount},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"user",{get:function(){return this.mUser},enumerable:!1,configurable:!0}),World.prototype.enableClick=function(){this.game&&this.mRoomMamager&&this.mRoomMamager.currentRoom&&this.mRoomMamager.currentRoom.scene&&this.mRoomMamager.currentRoom.scene.input&&(this.mRoomMamager.currentRoom.scene.input.enabled=!0)},World.prototype.disableClick=function(){this.game&&this.mRoomMamager&&this.mRoomMamager.currentRoom&&this.mRoomMamager.currentRoom.scene&&this.mRoomMamager.currentRoom.scene.input&&(this.mRoomMamager.currentRoom.scene.input.enabled=!1)},World.prototype.exitUser=function(){this.mConfig.token_expire=this.mConfig.token_fingerprint=this.mConfig.user_id=this.mConfig.auth_token=null,this.mAccount&&this.mAccount.destroy(),this._createAnotherGame(this.mConfig.game_id,this.mConfig.virtual_world_id,null,null)},World.prototype.showLoading=function(){return this.mLoadingManager.start()},World.prototype.getGameConfig=function(){return this.gameConfig},World.prototype.onClockReady=function(){this.mInputManager&&(this.mInputManager.enable=!0)},World.prototype.onFocus=function(){if(c.a.getInstance().log("#BlackSceneFromBackground; world.onFocus()"),this.connection){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=a.op_def.GameStatus.Focus,this.connection.send(t),this.mClock.sync(-1)}else c.a.getInstance().error("connection is undefined");this.resumeScene()},World.prototype.onBlur=function(){if(c.a.getInstance().log("#BlackSceneFromBackground; world.onBlur()"),this.connection){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=a.op_def.GameStatus.Blur,this.connection.send(t)}else c.a.getInstance().error("connection is undefined");this.pauseScene()},World.prototype.initgameConfigUrls=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e],o=M.a.baseName(n);this.gameConfigUrls.set(o,n),3===n.split(o).length&&(this.gameConfigUrl=n)}},World.prototype.getConfigUrl=function(t){return this.gameConfigUrls.get(t)},World.prototype.loadSceneConfig=function(t){var e=this.getConfigUrl(t);return this.mLoadingManager.start(O.a.downloadSceneConfig()),this.loadGameConfig(e)},World.prototype.createGame=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this._newGame(),this.mGame.events.on(Phaser.Core.Events.BLUR,this.onBlur,this),this.moveStyle===a.op_def.MoveStyle.DIRECTION_MOVE_STYLE||1===this.moveStyle?this.mGame.device.os.desktop?this.mInputManager=new p.a(this,t):this.mInputManager=new m.a(this,t):this.mGame.device.os.desktop&&(this.mInputManager=new p.a(this,t)),this.mInputManager&&(this.mInputManager.enable=!1),window.screen.width>window.screen.height?this.mConfig.width>this.mConfig.height?this.resize(this.mConfig.width,this.mConfig.height):this.resize(this.mConfig.height,this.mConfig.width):this.mConfig.width<this.mConfig.height?this.resize(this.mConfig.width,this.mConfig.height):this.resize(this.mConfig.height,this.mConfig.width),[4,this.mLoadingManager.addAssets(this.mElementStorage.getAssets())];case 1:return e.sent(),this.gameCreated(),[2]}}))}))},World.prototype.enterGame=function(){this.loginEnterWorld(),this.mGame.scene.remove(P.a.name),this.uiManager.destroy(),this.uiManager.addPackListener(),this.mLoadingManager.start(O.a.enterGame())},World.prototype._createAnotherGame=function(t,e,i,n){var o=this;this.clearGame().then((function(){o.isPause=!1,o.mConnection&&o.mConnection.closeConnect(),o.mClock&&(o.mClock.destroy(),o.mClock=null),o.mAccount&&o.mAccount.enterGame(t,e,i,n),o.mConnection.addPacketListener(o);var r=o.mConfig.server_addr||Object({host:"gdev.tooqing.com",port:11100,secure:!0});r&&o.mConnection.startConnect(r),o.mClock=new b.a(o.mConnection,o),o._newGame(),o.mGame.scene.getScene(P.a.name)&&o.mGame.scene.remove(P.a.name),o.mLoadingManager.start().then((function(){o.reconnectIng=!1}))}))},World.prototype.onFullScreenChange=function(){this.resize(this.mGame.scale.gameSize.width,this.mGame.scale.gameSize.height)},World.prototype.onSelectCharacter=function(){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_CHARACTER_CREATED);this.connection.send(t);var e=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SET_LOCALE);e.content.localeCode=T.a.language,this.connection.send(e),this.user.bag.querySYNC_ALL_PACKAGE()},World.prototype.clearGame=function(t){var e=this;return new Promise((function(i,n){e.mClock&&(e.mClock.destroy(),e.mClock=null),e.mGame?(e.mGame.events.off(Phaser.Core.Events.BLUR,e.onBlur,e),e.mGame.scale.off("enterfullscreen",e.onFullScreenChange,e),e.mGame.scale.off("leavefullscreen",e.onFullScreenChange,e),e.mGame.scale.off("orientationchange",e.onOrientationChange,e),e.mGame.plugins.removeGlobalPlugin("rexButton"),e.mGame.plugins.removeGlobalPlugin("rexNinePatchPlugin"),e.mGame.plugins.removeGlobalPlugin("rexInputText"),e.mGame.plugins.removeGlobalPlugin("rexBBCodeTextPlugin"),e.mGame.plugins.removeGlobalPlugin("rexMoveTo"),e.mGame.plugins.removeScenePlugin("DragonBones"),e.mGameEmitter.destroy(),e.roomManager.destroy(),e.uiManager.destroy(),e.mElementStorage.destroy(),e.mLoadingManager.destroy(),e.game.scene.destroy(),e.user.clear(),e.mGame.events.once(Phaser.Core.Events.DESTROY,(function(){e.mGame=void 0,t&&t(),i()})),e.mGame.destroy(!0)):i()}))},World.prototype.heartBeatCallBack=function(){this.mConnection.clearHeartBeat()},World.prototype.login=function(){var t=this;this.mGame.scene.getScene(P.a.name)||this.mGame.scene.add(P.a.name,P.a),this.mGame.scene.start(P.a.name,{connect:this.mConnection,world:this,callBack:function(){t.enterGame()}})},World.prototype.orientationResize=function(t,e,i,n){this.mGame&&(i<n?(this.mGame.scale.orientation=Phaser.Scale.Orientation.PORTRAIT,this.isFullStart||c.a.getInstance().log("竖版"+this.mGame.scale.orientation)):(this.mGame.scale.orientation=Phaser.Scale.Orientation.LANDSCAPE,this.isFullStart||c.a.getInstance().log("横版"+this.mGame.scale.orientation)),this.mGame.scale.resize(t,e),c.a.getInstance().log("orientation"+this.mGame.scale.orientation)),this.mRoomMamager&&this.mRoomMamager.resize(i,n),this.mUiManager&&this.mUiManager.resize(i,n),this.mInputManager&&this.mInputManager.resize(i,n)},World.prototype.enterVirtualWorld=function(){var t=this;if(this.mGame){if(this.gameState=r.a.LOGIN,this.mConfig&&this.mConnection){var e=localStorage.getItem("token"),i=e?JSON.parse(e):null;if(this.mConfig.auth_token)this.mAccount.setAccount({token:this.mConfig.auth_token,expire:this.mConfig.token_expire,fingerprint:this.mConfig.token_fingerprint,refreshToken:i?i.refreshToken:"",id:this.mConfig.user_id?this.mConfig.user_id:i?i.id:""}),this.loginEnterWorld();else{if(!i)return void this.login();this.mAccount.setAccount(i),this.httpService.refreshToekn(i.refreshToken,i.accessToken).then((function(e){200===e.code?(t.mAccount.refreshToken(e),t.loginEnterWorld()):t.login()}))}}}else this.reconnect()},World.prototype.loginEnterWorld=function(){return __awaiter(this,void 0,void 0,(function(){var t,e,i,n,o,r;return __generator(this,(function(h){return this.mLoadingManager.start(O.a.enterGame()),t=new s.PBpacket(a.op_gateway.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PLAYER_INIT),e=t.content,i=this.mConfig.game_id,n=this.mConfig.virtual_world_id,o=null,r=null,this.mAccount&&this.mAccount.gameID&&void 0!==this.mAccount&&(i=this.mAccount.gameID,n=this.mAccount.virtualWorldId,o=this.mAccount.sceneId,r=this.mAccount.loc),e.virtualWorldUuid=n,this.mConfig.game_id&&this.mAccount&&this.mAccount.accountData&&this.mAccount.accountData.accessToken&&this.mAccount.accountData.expire&&this.mAccount.accountData.fingerprint?(e.gameId=i,e.userToken=this.mConfig.auth_token=this.mAccount.accountData.accessToken,e.expire=this.mConfig.token_expire=this.mAccount.accountData.expire+"",e.fingerprint=this.mConfig.token_fingerprint=this.mAccount.accountData.fingerprint,e.sceneId=o,e.loc=r,this.mConnection.send(t),[2]):(this.mGame&&this.mGame.destroy(!0),[2])}))}))},World.prototype.onInitVirtualWorldPlayerInit=function(t){var e=this,i=t.content,n=i.configUrls;if(this.mMoveStyle=i.moveStyle,this.clock.sync(-1),this.initgameConfigUrls(n),!n||n.length<=0)return c.a.getInstance().error("configUrls error: , "+n+", gameId: "+this.mAccount.gameID),void this.createGame(i.keyEvents);c.a.getInstance().log("mMoveStyle:"+i.moveStyle);var o=this.mAccount.gameID;o.indexOf(".")>-1&&(o=o.split(".")[1]);var r=this.gameConfigUrl;this.mLoadingManager.start(O.a.downloadGameConfig()),this.loadGameConfig(r).then((function(t){e.mElementStorage.setGameConfig(t),e.createGame(i.keyEvents),c.a.getInstance().debug("created game suc")})).catch((function(t){c.a.getInstance().log(t)}))},World.prototype._newGame=function(){return this.mGame||(c.a.getInstance().log("dragonbones: ",dragonBones),this.gameConfig={type:Phaser.AUTO,parent:this.mConfig.parent||"game",scene:null,disableContextMenu:!0,transparent:!1,backgroundColor:0,resolution:1,fps:{target:60,forceSetTimeOut:!0},dom:{createContainer:!0},plugins:{scene:[{key:"DragonBones",plugin:dragonBones.phaser.plugin.DragonBonesScenePlugin,mapping:"dragonbone"}]},render:{pixelArt:!0,roundPixels:!0},scale:{mode:Phaser.Scale.NONE,width:this.mConfig.width*window.devicePixelRatio,height:this.mConfig.height*window.devicePixelRatio,zoom:1/window.devicePixelRatio}},Object.assign(this.gameConfig,this.mConfig),this.mGame=new o.Game(this.gameConfig),this.mGame.input.mouse.capture=!0,this.mGame.device.os.desktop&&(this.mUIScale=1),this.mRoomMamager&&this.mRoomMamager.addPackListener(),this.mUiManager&&this.mUiManager.addPackListener(),this.mRoleManager&&this.mRoleManager.register(),this.mSoundManager&&this.mSoundManager.addPackListener(),this.user&&this.user.addPackListener(),this.mElementStorage&&this.mElementStorage.on("SCENE_PI_LOAD_COMPELETE",this.loadSceneConfig)),this.mGame},World.prototype.gameCreated=function(){if(this.connection){this.mLoadingManager.start(O.a.waitEnterRoom());var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_GAME_CREATED);this.connection.send(t),this.mCallBack&&this.mCallBack(),this.mConfig.game_created&&this.mConfig.game_created()}this.mGame.scale.on("enterfullscreen",this.onFullScreenChange,this),this.mGame.scale.on("leavefullscreen",this.onFullScreenChange,this)},World.prototype.loadGameConfig=function(t){var e=this,i=y.g.getGameConfig(t);return Object(f.a)(i,"arraybuffer").then((function(t){return c.a.getInstance().log("start decodeConfig"),e.mLoadingManager.start(O.a.parseConfig()),e.decodeConfigs(t)}))},World.prototype.decodeConfigs=function(t){return new Promise((function(e,i){var n=t.response;if(n)try{var o=new g.Lite;o.deserialize(new Uint8Array(n)),c.a.getInstance().log("TCL: World -> gameConfig",o),e(o)}catch(t){i(t)}else i("error")}))},World.prototype.resumeScene=function(){if(c.a.getInstance().log("#BlackSceneFromBackground; world.resumeScene(); isEditor:"+this.mConfig.isEditor+"; isPause:"+this.isPause+"; mGame:"+this.mGame),!this.mConfig.isEditor&&this.isPause&&(this.isPause=!1,this.mGame)){if(!this.mConnection.isConnect)return this.mConfig.connectFail?this.mConfig.connectFail():this.onDisConnected();this.mConnection.onFocus(),this.mRoomMamager.onFocus();var t=this.mGame.scene.getScene(S.a.name);t&&(t.sleep(),this.mGame.scene.stop(S.a.name))}},World.prototype.pauseScene=function(){c.a.getInstance().log("#BlackSceneFromBackground; world.pauseScene(); isEditor:"+this.mConfig.isEditor+"; isPause:"+this.isPause+"; mGame:"+this.mGame),this.mConfig.isEditor||this.isPause||(this.isPause=!0,this.mGame&&(this.mConnection.onBlur(),this.mRoomMamager.onBlur(),this.mGame.scene.getScene(S.a.name)||this.mGame.scene.add(S.a.name,S.a),this.mGame.scene.start(S.a.name,{world:this})))},World.SCALE_CHANGE="scale_change",World}(s.PacketHandler)}.call(this,"/")}])]);