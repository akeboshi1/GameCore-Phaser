/*! For license information please see game_v1.0.221.js.LICENSE.txt */
(this.webpackJsonpTooqingCore=this.webpackJsonpTooqingCore||[]).push([[0],[,,function(t,e,i){"use strict";i.r(e),function(t){i.d(e,"World",(function(){return F}));var n,o=i(75),a=(i(333),i(4)),s=i(3),h=i(363),l=i(58),c=i(8),p=i(434),u=i(368),m=i(369),d=i(370),f=i(371),y=i(372),g=i(5),_=i(373),v=i(137),b=i(438),P=i(439),S=i(425),w=i(440),T=i(435),C=i(441),D=i(426),M=i(427),O=i(428),x=i(442),E=i(437),B=i(31),I=i(429),A=i(70),R=i(431),k=i(432),L=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),__awaiter=function(t,e,i,n){return new(i||(i=Promise))((function(o,a){function fulfilled(t){try{step(n.next(t))}catch(t){a(t)}}function rejected(t){try{step(n.throw(t))}catch(t){a(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())}))},__generator=function(t,e){var i,n,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function verb(a){return function(h){return function step(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}},F=function(e){function World(t,i){var n=e.call(this)||this;if(n.DEFAULT_WIDTH=360,n.DEFAULT_HEIGHT=640,n.mMoveStyle=1,n.isFullStart=!1,n.mOrientation=0,n.gameConfigUrls=new Map,n.gameConfigUrl="",n._isIOS=-1,n.focusoutFunc=function(){n.game&&n.game.device.os.iOS&&window.scrollTo(0,0)},n.mCallBack=i,n.mConfig=t,!t.game_id)throw new Error("Config.game_id is required.");t.devicePixelRatio||(t.devicePixelRatio=window.devicePixelRatio||1),void 0===t.width&&(t.width=window.innerWidth),void 0===t.height&&(t.height=window.innerHeight),n.mScaleRatio=Math.ceil(t.devicePixelRatio||1),n.mUIRatio=Math.round(t.devicePixelRatio||1);var o=t.width/n.DEFAULT_WIDTH*(t.devicePixelRatio/n.mUIRatio);n.mUIScale=o,g.h.OSD_PATH=n.mConfig.osd||"https://osd.tooqing.com/",g.h.RES_PATH="./resources/",g.h.RESUI_PATH="./resources/ui/",n._newGame(),n.mConnection=t.connection||new h.a(n),n.mConnection.addPacketListener(n),n.mClock=new x.a(n.mConnection,n),n.addHandlerFun(s.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_VIRTUAL_WORLD_INIT,n.onInitVirtualWorldPlayerInit),n.addHandlerFun(s.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_ERROR,n.onClientErrorHandler),n.addHandlerFun(s.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SELECT_CHARACTER,n.onSelectCharacter),n.addHandlerFun(s.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_GOTO_ANOTHER_GAME,n.onGotoAnotherGame),n.addHandlerFun(s.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_PONG,n.heartBeatCallBack),n.mGameEmitter=new Phaser.Events.EventEmitter,n.mRoomMamager=new p.a(n),n.mUiManager=new v.UiManager(n),n.mMouseManager=new m.a(n),n.mElementStorage=new f.a,n.mHttpService=new M.a(n),n.mRoleManager=new E.a(n),n.mSoundManager=new R.a(n),n.mLoadingManager=new k.a(n),n.mRoleManager.register(),n.mRoomMamager.addPackListener(),n.mUiManager.addPackListener();var a=n.mConfig.server_addr||Object({host:"172.18.0.103",port:12100,secure:!1});return a&&n.mConnection.startConnect(a),document.body.addEventListener("focusout",n.focusoutFunc),n}return L(World,e),Object.defineProperty(World.prototype,"moveStyle",{get:function(){return this.mMoveStyle},enumerable:!1,configurable:!0}),World.prototype.getConfig=function(){return this.mConfig},World.prototype.setGameConfig=function(t){this.elementStorage.setGameConfig(t)},World.prototype.updatePalette=function(t){this.elementStorage.updatePalette(t)},World.prototype.updateMoss=function(t){this.elementStorage.updateMoss(t)},World.prototype.destroy=function(){this.mConnection.closeConnect(),document.body.removeEventListener("focusout",this.focusoutFunc),this.clearGame()},World.prototype.onConnected=function(t){this.enterVirtualWorld()},World.prototype.onDisConnected=function(t){},World.prototype.onError=function(t){},World.prototype.onClientErrorHandler=function(t){var e=t.content;c.a.getInstance().error("Remote Error["+e.responseStatus+"]: "+e.msg)},World.prototype.changeRoom=function(t){this.mInputManager&&this.mInputManager.onRoomChanged(t),this.mMouseManager.changeRoom(t),this.mSoundManager.changeRoom(t)},World.prototype.getSize=function(){if(this.mGame)return this.mGame.scale.gameSize},World.prototype.scaleChange=function(t){this.emitter.emit(World.SCALE_CHANGE)},World.prototype.closeGame=function(){this.mConfig.closeGame&&(this.destroy(),this.mConfig.closeGame())},World.prototype.resize=function(t,e){var i=t*window.devicePixelRatio,n=e*window.devicePixelRatio;c.a.getInstance().log("resize"+i+"|"+n)},World.prototype.onOrientationChange=function(t,e,i){"app"!==this.mConfig.platform&&(this.mOrientation=t,this.mConfig.screenWidth>this.mConfig.screenHeight?t<=135&&t>=45||t<=-45&&t>=-135?this.orientationResize(this.mConfig.screenWidth,this.mConfig.screenHeight,e,i):this.orientationResize(this.mConfig.screenHeight,this.mConfig.screenWidth,e,i):t<=135&&t>=45||t<=-45&&t>=-135?this.orientationResize(this.mConfig.screenHeight,this.mConfig.screenWidth,e,i):this.orientationResize(this.mConfig.screenWidth,this.mConfig.screenHeight,e,i))},World.prototype.startFullscreen=function(){this.mGame&&(this.isFullStart=!0,this.mGame.scale.startFullscreen())},World.prototype.stopFullscreen=function(){this.mGame&&(this.isFullStart=!1,this.mGame.scale.stopFullscreen())},World.prototype.onGotoAnotherGame=function(t){var e=t.content;this._createAnotherGame(e.gameId,e.virtualWorldId)},World.prototype.changeScene=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(i){switch(i.label){case 0:return t=this.mConfig.game_id,e=this.mConfig.virtual_world_id,[4,this.clearGame()];case 1:return i.sent(),this.mConfig.game_id=t,this.mConfig.virtual_world_id=e,this._newGame(),this.loginEnterWorld(),[2]}}))}))},World.prototype.reconnect=function(){var t=this.mConfig.game_id,e=this.mConfig.virtual_world_id;this._createAnotherGame(t,e)},World.prototype.startHeartBeat=function(){var t=new a.PBpacket(s.op_gateway.OPCODE._OP_CLIENT_REQ_GATEWAY_PING);this.mConnection.send(t),this.mClock.sync(-1)},World.prototype.playSound=function(t){this.mSoundManager.play(t)},Object.defineProperty(World.prototype,"uiScale",{get:function(){return this.mUIScale},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"uiRatio",{get:function(){return this.mUIRatio},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"scaleRatio",{get:function(){return this.mScaleRatio},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"game",{get:function(){return this.mGame},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"roomManager",{get:function(){return this.mRoomMamager},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"orientation",{get:function(){return this.mOrientation},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"elementStorage",{get:function(){return this.mElementStorage},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"uiManager",{get:function(){return this.mUiManager},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"mouseManager",{get:function(){return this.mMouseManager},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"inputManager",{get:function(){return this.mInputManager},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"connection",{get:function(){return this.mConnection},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"clock",{get:function(){return this.mClock},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"emitter",{get:function(){return this.mGameEmitter},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"httpService",{get:function(){return this.mHttpService},enumerable:!1,configurable:!0}),Object.defineProperty(World.prototype,"account",{get:function(){return this.mAccount},enumerable:!1,configurable:!0}),World.prototype.enableClick=function(){this.game&&this.mRoomMamager&&this.mRoomMamager.currentRoom&&this.mRoomMamager.currentRoom.scene&&this.mRoomMamager.currentRoom.scene.input&&(this.mRoomMamager.currentRoom.scene.input.enabled=!0)},World.prototype.disableClick=function(){this.game&&this.mRoomMamager&&this.mRoomMamager.currentRoom&&this.mRoomMamager.currentRoom.scene&&this.mRoomMamager.currentRoom.scene.input&&(this.mRoomMamager.currentRoom.scene.input.enabled=!1)},World.prototype.showLoading=function(){return this.mLoadingManager.start()},World.prototype.getGameConfig=function(){return this.gameConfig},World.prototype.onClockReady=function(){this.mInputManager&&(this.mInputManager.enable=!0)},World.prototype.onFocus=function(){if(this.connection){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=s.op_def.GameStatus.Focus,this.connection.send(t),this.mClock.sync(-1)}else c.a.getInstance().error("connection is undefined");this.resumeScene()},World.prototype.onBlur=function(){if(this.connection){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=s.op_def.GameStatus.Blur,this.connection.send(t)}else c.a.getInstance().error("connection is undefined");this.game.device.os.desktop&&this.pauseScene()},World.prototype.initgameConfigUrls=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e],o=A.a.baseName(n);this.gameConfigUrls.set(o,n),3===n.split(o).length&&(this.gameConfigUrl=n)}},World.prototype.getConfigUrl=function(t){return this.gameConfigUrls.get(t)},World.prototype.loadSceneConfig=function(t){var e=this.getConfigUrl(t);return this.loadGameConfig(e)},World.prototype.createGame=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this._newGame(),this.mGame.events.on(Phaser.Core.Events.BLUR,this.onBlur,this),this.moveStyle===s.op_def.MoveStyle.DIRECTION_MOVE_STYLE||1===this.moveStyle?this.mGame.device.os.desktop?this.mInputManager=new u.a(this,t):this.mInputManager=new d.a(this,t):this.mGame.device.os.desktop&&(this.mInputManager=new u.a(this,t)),this.mInputManager&&(this.mInputManager.enable=!1),window.screen.width>window.screen.height?this.mConfig.width>this.mConfig.height?this.resize(this.mConfig.width,this.mConfig.height):this.resize(this.mConfig.height,this.mConfig.width):this.mConfig.width<this.mConfig.height?this.resize(this.mConfig.width,this.mConfig.height):this.resize(this.mConfig.height,this.mConfig.width),[4,this.mLoadingManager.addAssets(this.mElementStorage.getAssets())];case 1:return e.sent(),this.gameCreated(),[2]}}))}))},World.prototype._createAnotherGame=function(t,e){return __awaiter(this,void 0,void 0,(function(){var i,n;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.clearGame()];case 1:return o.sent(),this.mConnection&&this.mConnection.closeConnect(),this.mClock&&(this.mClock.destroy(),this.mClock=null),this.mConfig.game_id=t,this.mConfig.virtual_world_id=e,this.mConnection.addPacketListener(this),(i=this.mConfig.server_addr||Object({host:"172.18.0.103",port:12100,secure:!1}))&&this.mConnection.startConnect(i),this.mClock=new x.a(this.mConnection,this),this._newGame(),(n=this.mGame.scene.getScene(C.a.name))&&n.remove(),this.mLoadingManager.start(),[2]}}))}))},World.prototype.onFullScreenChange=function(){this.resize(this.mGame.scale.gameSize.width,this.mGame.scale.gameSize.height)},World.prototype.onSelectCharacter=function(){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_CHARACTER_CREATED);this.connection.send(t)},World.prototype.clearGame=function(){var t=this;return new Promise((function(e,i){t.mGame?(t.mGame.events.off(Phaser.Core.Events.BLUR,t.onBlur,t),t.mGame.scale.off("enterfullscreen",t.onFullScreenChange,t),t.mGame.scale.off("leavefullscreen",t.onFullScreenChange,t),t.mGame.scale.off("orientationchange",t.onOrientationChange,t),t.mGame.plugins.removeGlobalPlugin("rexButton"),t.mGame.plugins.removeGlobalPlugin("rexNinePatchPlugin"),t.mGame.plugins.removeGlobalPlugin("rexInputText"),t.mGame.plugins.removeGlobalPlugin("rexBBCodeTextPlugin"),t.mGame.plugins.removeGlobalPlugin("rexMoveTo"),t.mGame.plugins.removeScenePlugin("DragonBones"),t.mGame.plugins.removeScenePlugin("rexUI"),t.mGameEmitter.destroy(),t.roomManager.destroy(),t.uiManager.destroy(),t.mElementStorage.destroy(),t.mLoadingManager.destroy(),t.mGame.events.once(Phaser.Core.Events.DESTROY,(function(){t.mGame=void 0,e()})),t.mGame.destroy(!0)):e()}))},World.prototype.heartBeatCallBack=function(){this.mConnection.clearHeartBeat()},World.prototype.login=function(){var t=this;this.mGame.scene.getScene(C.a.name)||this.mGame.scene.add(C.a.name,C.a),this.mGame.scene.start(C.a.name,{connect:this.mConnection,world:this,callBack:function(){t.loginEnterWorld(),t.mGame.scene.getScene(C.a.name).remove(),t.mLoadingManager.start()}})},World.prototype.orientationResize=function(t,e,i,n){this.mGame&&(i<n?(this.mGame.scale.orientation=Phaser.Scale.Orientation.PORTRAIT,this.isFullStart||c.a.getInstance().log("竖版"+this.mGame.scale.orientation)):(this.mGame.scale.orientation=Phaser.Scale.Orientation.LANDSCAPE,this.isFullStart||c.a.getInstance().log("横版"+this.mGame.scale.orientation)),this.mGame.scale.resize(t,e),c.a.getInstance().log("orientation"+this.mGame.scale.orientation)),this.mRoomMamager&&this.mRoomMamager.resize(i,n),this.mUiManager&&this.mUiManager.resize(i,n),this.mInputManager&&this.mInputManager.resize(i,n)},World.prototype.enterVirtualWorld=function(){if(this.mGame){if(this.mConfig&&this.mConnection){if(this.mAccount=new D.a,this.mGame.scene.getScene(l.a.name)||this.mGame.scene.add(l.a.name,l.a),!this.mConfig.auth_token)return void this.login();this.mLoadingManager.start(),this.mAccount.setAccount({token:this.mConfig.auth_token,expire:this.mConfig.token_expire,fingerprint:this.mConfig.token_fingerprint}),this.loginEnterWorld()}}else this.reconnect()},World.prototype.loginEnterWorld=function(){return __awaiter(this,void 0,void 0,(function(){var e,i;return __generator(this,(function(n){switch(n.label){case 0:return[4,Object(B.b)(I.relative(t,"../resources/locales/{{lng}}.json"))];case 1:return n.sent(),e=new a.PBpacket(s.op_gateway.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PLAYER_INIT),(i=e.content).virtualWorldUuid=""+this.mConfig.virtual_world_id,this.mConfig.game_id&&this.mAccount&&this.mAccount.accountData&&this.mAccount.accountData.token&&this.mAccount.accountData.expire&&this.mAccount.accountData.fingerprint?(i.gameId=this.mConfig.game_id,i.userToken=this.mConfig.auth_token=this.mAccount.accountData.token,i.expire=this.mConfig.token_expire=this.mAccount.accountData.expire+"",i.fingerprint=this.mConfig.token_fingerprint=this.mAccount.accountData.fingerprint,this.mConnection.send(e),[2]):(this.mGame&&this.mGame.destroy(!0),[2])}}))}))},World.prototype.onInitVirtualWorldPlayerInit=function(t){var e=this,i=t.content,n=i.configUrls;if(this.mMoveStyle=i.moveStyle,this.clock.sync(-1),this.initgameConfigUrls(n),!n||n.length<=0)return c.a.getInstance().error("configUrls error: , "+n+", gameId: "+this.mConfig.game_id),void this.createGame(i.keyEvents);c.a.getInstance().log("mMoveStyle:"+i.moveStyle);var o=this.mConfig.game_id;o.indexOf(".")>-1&&(o=o.split(".")[1]);var a=this.gameConfigUrl;this.loadGameConfig(a).then((function(t){e.mElementStorage.setGameConfig(t),e.createGame(i.keyEvents),c.a.getInstance().debug("created game suc")})).catch((function(t){c.a.getInstance().log(t)}))},World.prototype._newGame=function(){return this.mGame||(this.gameConfig={type:Phaser.AUTO,parent:this.mConfig.parent||"game",scene:null,disableContextMenu:!0,transparent:!1,backgroundColor:0,resolution:1,fps:{target:30},dom:{createContainer:!0},plugins:{global:[{key:"rexButton",plugin:w.a,start:!0},{key:"rexNinePatchPlugin",plugin:b.a,start:!0},{key:"rexInputText",plugin:P.a,start:!0},{key:"rexBBCodeTextPlugin",plugin:S.a,start:!0}],scene:[{key:"DragonBones",plugin:dragonBones.phaser.plugin.DragonBonesScenePlugin,mapping:"dragonbone"},{key:"rexUI",plugin:T.a,mapping:"rexUI"}]},render:{pixelArt:!1,roundPixels:!0},scale:{mode:Phaser.Scale.NONE,width:this.mConfig.width*window.devicePixelRatio,height:this.mConfig.height*window.devicePixelRatio,zoom:1/window.devicePixelRatio}},Object.assign(this.gameConfig,this.mConfig),this.mGame=new o.Game(this.gameConfig),this.mGame.input.mouse.capture=!0,this.mGame.device.os.desktop&&(this.mUIScale=1),this.mRoomMamager&&this.mRoomMamager.addPackListener(),this.mUiManager&&this.mUiManager.addPackListener(),this.mRoleManager&&this.mRoleManager.register(),this.mElementStorage&&this.mElementStorage.on("SCENE_PI_LOAD_COMPELETE",this.loadSceneConfig)),this.mGame},World.prototype.gameCreated=function(){if(this.connection){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_GAME_CREATED);this.connection.send(t),this.mCallBack&&this.mCallBack(),this.mConfig.game_created&&this.mConfig.game_created()}this.mGame.scale.on("enterfullscreen",this.onFullScreenChange,this),this.mGame.scale.on("leavefullscreen",this.onFullScreenChange,this)},World.prototype.loadGameConfig=function(t){var e=this,i=g.f.getGameConfig(t);return Object(y.a)(i,"arraybuffer").then((function(t){return c.a.getInstance().log("start decodeConfig"),e.decodeConfigs(t)}))},World.prototype.decodeConfigs=function(t){return new Promise((function(e,i){var n=t.response;if(n)try{var o=new _.Lite;o.deserialize(new Uint8Array(n)),c.a.getInstance().log("TCL: World -> gameConfig",o),e(o)}catch(t){i(t)}else i("error")}))},World.prototype.resumeScene=function(){if(!this.mConfig.isEditor&&(this.mRoomMamager.onFocus(),this.mGame&&"pc"===this.mConfig.platform)){var t=this.mGame.scene.getScene(O.a.name);t&&(t.sleep(),this.mGame.scene.stop(O.a.name))}},World.prototype.pauseScene=function(){this.mConfig.isEditor||(this.mRoomMamager.onBlur(),this.mGame&&"pc"===this.mConfig.platform&&(this.mGame.scene.getScene(O.a.name)||this.mGame.scene.add(O.a.name,O.a),this.mGame.scene.start(O.a.name,{world:this})))},World.SCALE_CHANGE="scale_change",World}(a.PacketHandler)}.call(this,"/")},,,function(t,e,i){"use strict";i.d(e,"h",(function(){return o})),i.d(e,"f",(function(){return a})),i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return h})),i.d(e,"i",(function(){return l})),i.d(e,"e",(function(){return c})),i.d(e,"a",(function(){return p})),i.d(e,"d",(function(){return u})),i.d(e,"g",(function(){return m}));var n=/^(http|https):/i,o=function(){function Url(){}return Url.getRes=function(t){return Object({debug:!0,api_root:"http://172.18.0.100:17170/",osd:"https://osd.tooqing.com/",gateway:Object({host:"172.18.0.103",port:12100,secure:!1}),game_id:"5e9a7dace87abc390c4b1b73",virtual_world_id:"65541"}).BUNDLE_RESOURCES_ROOT?Object({debug:!0,api_root:"http://172.18.0.100:17170/",osd:"https://osd.tooqing.com/",gateway:Object({host:"172.18.0.103",port:12100,secure:!1}),game_id:"5e9a7dace87abc390c4b1b73",virtual_world_id:"65541"}).BUNDLE_RESOURCES_ROOT+t:Url.RES_PATH+t},Url.getUIRes=function(t,e){return Object({debug:!0,api_root:"http://172.18.0.100:17170/",osd:"https://osd.tooqing.com/",gateway:Object({host:"172.18.0.103",port:12100,secure:!1}),game_id:"5e9a7dace87abc390c4b1b73",virtual_world_id:"65541"}).BUNDLE_RESOURCES_ROOT?Object({debug:!0,api_root:"http://172.18.0.100:17170/",osd:"https://osd.tooqing.com/",gateway:Object({host:"172.18.0.103",port:12100,secure:!1}),game_id:"5e9a7dace87abc390c4b1b73",virtual_world_id:"65541"}).BUNDLE_RESOURCES_ROOT+t+"x"+e:Url.RESUI_PATH+(t+"x/")+e},Url.getOsdRes=function(t){return Url.OSD_PATH?n.test(Url.OSD_PATH)?Url.OSD_PATH+t:"https://osd.tooqing.com/"+t:t},Url.OSD_PATH="",Url.RES_PATH="",Url.RESUI_PATH="",Url}(),a=function(){function ResUtils(){}return ResUtils.getPartName=function(t){return t+"_png"},ResUtils.getPartUrl=function(t){return n.test(o.OSD_PATH)?o.OSD_PATH+"avatar/part/"+t+".png":"https://osd.tooqing.com/avatar/part/"+t+".png"},ResUtils.getGameConfig=function(t){return n.test(t)?t:o.OSD_PATH+t},ResUtils}(),s=function(){function BlackButton(){}return BlackButton.getName=function(){return"black_button"},BlackButton.getPNG=function(){return o.getRes("ui/common/button.png")},BlackButton.getColumns=function(){return[4,2,4]},BlackButton.getRows=function(){return[4,2,4]},BlackButton.getConfig=function(){return{top:4,left:4,right:4,bottom:4}},BlackButton}(),h=function(){function BlueButton(){}return BlueButton.getName=function(){return"button_blue"},BlueButton.getPNG=function(){return o.getRes("ui/common/button_blue.png")},BlueButton.getJSON=function(){return o.getRes("ui/common/button_blue.json")},BlueButton.getColumns=function(){return[7,1,7]},BlueButton.getRows=function(){return[7,1,7]},BlueButton.getConfig=function(){return{left:7,top:7,right:7,bottom:7}},BlueButton}(),l=function(){function WhiteButton(){}return WhiteButton.getName=function(){return"button_white"},WhiteButton.getPNG=function(){return o.getRes("ui/common/button_white.png")},WhiteButton.getJSON=function(){return o.getRes("ui/common/button_white.json")},WhiteButton.getColumns=function(){return[7,1,7]},WhiteButton.getRows=function(){return[7,1,7]},WhiteButton.getConfig=function(){return{left:7,top:7,right:7,bottom:7}},WhiteButton}(),c=function(){function CloseButton(){}return CloseButton.getName=function(){return"common_clsBtn"},CloseButton.getPNG=function(){return o.getRes("ui/common/common_clsBtn.png")},CloseButton.getJSON=function(){return o.getRes("ui/common/common_clsBtn.json")},CloseButton.getFrameConfig=function(){return{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}},CloseButton}(),p=function(){function Background(){}return Background.getName=function(){return"common_background"},Background.getPNG=function(){return o.getRes("ui/common/common_panelBg.png")},Background.getColumns=function(){return[11,9,11]},Background.getRows=function(){return[14,13,14]},Background.getConfig=function(){return{left:10,top:15,right:10,bottom:15}},Background}(),u=function(){function Border(){}return Border.getName=function(){return"common_border"},Border.getPNG=function(){return o.getRes("ui/common/common_border.png")},Border.getColumns=function(){return[4,2,4]},Border.getRows=function(){return[4,2,4]},Border.getConfig=function(){return{left:4,top:4,right:4,bottom:4}},Border}(),m=function(){function TransparentButton(){}return TransparentButton.getName=function(){return"button_transparent"},TransparentButton.getPNG=function(){return o.getRes("ui/common/button_transparent.png")},TransparentButton.getJSON=function(){return o.getRes("ui/common/button_transparent.json")},TransparentButton.getConfig=function(){return{left:4,top:4,right:4,bottom:4}},TransparentButton}()},function(t,e,i){"use strict";i.r(e),i.d(e,"BasePanel",(function(){return u}));var n,o=i(5),a=Phaser.Utils.Objects.GetValue,s=function(){function Tool(){}return Tool.checkPointerContains=function(t,e){var i=-t.width/2,n=t.width/2,o=-t.height/2,a=t.height/2;if(e){var s=t.getWorldTransformMatrix(),h=e.x-s.tx,l=e.y-s.ty;return i<=h&&n>=h&&o<=l&&a>=l}return!1},Tool.getTransfrom=function(t){return t?t.transform:void 0},Tool.getPos=function(t){var e,i={x:0,y:0};if(!t)return i;var n=a(t,"width",0),o=a(t,"height",0);return void 0===t.x&&(t.x=0),void 0===t.y&&(t.y=0),"string"==typeof t.x?(e=a(t,"x","100%"),i.x=Number(e.split("%")[0])*n):i.x=a(t,"x",0),"string"==typeof t.y?(e=a(t,"y","100%"),i.y=Number(e.split("%")[0])*o):i.y=a(t,"y",0),i},Tool.checkNinePatch=function(t){return!!(t.top||t.bottom||t.right||t.left)},Tool}(),h=i(29),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function Panel(e,i,n){var o=t.call(this,e,i.dpr,i.uiScaleNew)||this;return o.mPreLoad=!1,o.mTweening=!1,o.mReloadTimes=0,o.mTweenBoo=!0,o.mMute=!1,o.mEnabled=!0,o.soundMap=new Map,o.scene=e,o.mWorld=i,o.soundGroup=n,o.mInitialized=!1,o.setTween(!1),o}return l(Panel,t),Panel.prototype.addListen=function(){this.mInitialized&&(this.removeListen(),t.prototype.addListen.call(this))},Panel.prototype.removeListen=function(){this.mInitialized&&t.prototype.removeListen.call(this)},Panel.prototype.setFollow=function(t,e,i){this.mFollow=t,this.mFroscene=e,i&&(this.posFunc=i)},Panel.prototype.isShow=function(){return this.mShow},Panel.prototype.hide=function(){this.soundGroup&&this.soundGroup.close&&this.playSound(this.soundGroup.close),!this.mTweening&&this.mTweenBoo?this.showTween(!1):this.destroy()},Panel.prototype.destroy=function(){this.mPanelTween&&(this.mPanelTween.stop(),this.mPanelTween.remove(),this.mPanelTween=void 0),this.mResources&&(this.mResources.clear(),this.mResources=void 0),this.mMute=!1,this.mInitialized=!1,this.mShow=!1,this.width=0,this.height=0,this.mReloadTimes=0,this.offLoad(),t.prototype.destroy.call(this)},Panel.prototype.resize=function(t,e){},Panel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen()):this.preload())},Panel.prototype.update=function(t){this.mShowData=t},Panel.prototype.tweenExpand=function(t){},Panel.prototype.setTween=function(t){this.mTweenBoo=t},Object.defineProperty(Panel.prototype,"showData",{get:function(){return this.mShowData},enumerable:!1,configurable:!0}),Object.defineProperty(Panel.prototype,"interactive",{get:function(){return this.mEnabled},enumerable:!1,configurable:!0}),Panel.prototype.showTween=function(t){var e=this;this.mTweening=!0;var i=t?this.scale:0;this.scale=i,this.mPanelTween&&this.mPanelTween.stop(),this.mPanelTween=this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{scaleX:{value:i},scaleY:{value:i}},onComplete:function(){e.tweenComplete(t)},onCompleteParams:[this]})},Panel.prototype.tweenComplete=function(t){this.mTweening=!1,this.mPanelTween.stop(),this.mShow=t,t||this.destroy()},Panel.prototype.init=function(){this.mInitialized=!0,this.mResources&&(this.mResources.clear(),this.mResources=null),this.show(this.mShowData)},Panel.prototype.addAtlas=function(t,e,i){this.mResources||(this.mResources=new Map),this.mResources.set(t,{dpr:this.dpr,type:"atlas",texture:e,data:i})},Panel.prototype.addImage=function(t,e){this.mResources||(this.mResources=new Map),void 0===e&&(e=t),this.mResources.set(t,{dpr:this.dpr,type:"image",texture:e})},Panel.prototype.preload=function(){var t=this;this.mPreLoad=!0,this.scene&&(this.mResources&&this.mResources.forEach((function(e,i){t.addResources(i,e)}),this),this.startLoad())},Panel.prototype.loadComplete=function(t,e,i){this.mPreLoad=!1,this.mInitialized||(i>0&&this.mResources&&this.mResources.size>0?this.reload():(this.offLoad(),this.init()))},Panel.prototype.loadError=function(t){if(this.mResources){var e=this.mResources.get(t.key);e&&(e.dpr=2,this.mReLoadResources||(this.mReLoadResources=new Map),this.mReLoadResources.set(t.key,e))}},Panel.prototype.onFileKeyComplete=function(t){this.mResources&&this.mResources.has(t)&&this.mResources.delete(t)},Panel.prototype.addResources=function(t,e){this.scene},Panel.prototype.reload=function(){var t=this;!this.mReLoadResources||this.mReLoadResources.size<=0||++this.mReloadTimes>1||(this.mReLoadResources.forEach((function(e,i){t.addResources(i,e)}),this),this.startLoad())},Panel.prototype.startLoad=function(){this.scene&&(this.scene.load.on(Phaser.Loader.Events.FILE_KEY_COMPLETE,this.onFileKeyComplete,this),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.loadComplete,this),this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,this.loadError,this),this.scene.load.start())},Panel.prototype.offLoad=function(){this.scene&&(this.scene.load.off(Phaser.Loader.Events.FILE_KEY_COMPLETE,this.onFileKeyComplete,this),this.scene.load.off(Phaser.Loader.Events.COMPLETE,this.loadComplete,this),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.loadError,this))},Panel.prototype.sceneClick=function(t){s.checkPointerContains(this,t)&&this.checkPointerDelection(t)&&this.emit("panelClick",t)},Panel.prototype.uiClick=function(t){this.checkPointerDelection(t)&&this.emit("panelClick",t)},Panel}(h.a),p=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),u=function(t){function BasePanel(e,i){var n=t.call(this,e,i)||this;return n.mTweening=!1,n.mWidth=0,n.mHeight=0,n.mReloadTimes=0,n.mScene=e,n.mWorld=i,n.mInitialized=!1,i&&(n.dpr=Math.round(i.uiRatio||1),n.scale=n.mWorld.uiScale),n}return p(BasePanel,t),BasePanel.prototype.addResources=function(e,i){t.prototype.addResources.call(this,e,i),i.type&&this.scene.load[i.type]&&this.scene.load[i.type](e,o.h.getUIRes(i.dpr,i.texture),o.h.getUIRes(i.dpr,i.data))},Object.defineProperty(BasePanel.prototype,"scaleWidth",{get:function(){return this.scene.cameras.main.width/this.scale},enumerable:!1,configurable:!0}),Object.defineProperty(BasePanel.prototype,"scaleHeight",{get:function(){return this.scene.cameras.main.height/this.scale},enumerable:!1,configurable:!0}),BasePanel}(c)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(18),o=function(){function BaseMediator(){this.mShow=!1,this.mUIType=n.a.None}return Object.defineProperty(BaseMediator.prototype,"UIType",{get:function(){return this.mUIType},enumerable:!1,configurable:!0}),BaseMediator.prototype.updateViewPos=function(){this.mView&&this.mView.updatePos()},BaseMediator.prototype.tweenExpand=function(t){this.mView&&this.mView.tweenExpand(t)},BaseMediator.prototype.getView=function(){return this.mView},BaseMediator.prototype.hide=function(){this.mShow=!1;var t=this.getView();t&&t.hide()},BaseMediator.prototype.isSceneUI=function(){return!1},BaseMediator.prototype.isShow=function(){return this.mShow},BaseMediator.prototype.resize=function(t,e){var i=this.getView();i&&i.isShow()&&i.resize(t,e)},BaseMediator.prototype.show=function(t){this.mShow=!0},BaseMediator.prototype.update=function(t){var e=this.getView();e&&e.update(t)},BaseMediator.prototype.setParam=function(t){this.mParam=t},BaseMediator.prototype.getParam=function(){return this.mParam},BaseMediator.prototype.destroy=function(){this.mShow=!1,this.mParam=null;var t=this.getView();t&&(t.destroy(),t=void 0)},BaseMediator}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var __spreadArrays=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var a=arguments[e],s=0,h=a.length;s<h;s++,o++)n[o]=a[s];return n},n=function(){function Logger(){this.mErrorList=[],this.mWarnList=[]}return Logger.getInstance=function(){return Logger._instance||(Logger._instance=new Logger),Logger._instance},Logger.prototype.fatal=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];throw t},Logger.prototype.log=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.log.apply(console,__spreadArrays([t],e))},Logger.prototype.error=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.error.apply(console,__spreadArrays([t],e)),this.mErrorList.push(t)},Logger.prototype.warn=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.warn.apply(console,__spreadArrays([t],e)),this.mWarnList.push(t)},Logger.prototype.debug=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.log.apply(console,__spreadArrays([t],e))},Logger.prototype.info=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.info.apply(console,__spreadArrays([t],e))},Logger.prototype.getErrorList=function(){return this.mErrorList},Logger.prototype.getWarnList=function(){return this.mWarnList},Logger}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function Font(){}return Font.YAHEI_14_BOLD="bold 14px YaHei",Font.YAHEI_16_BOLD="bold 16px YaHei",Font.YAHEI_18_BOLD="bold 18px YaHei",Font.YAHEI_20_BOLD="bold 20px YaHei",Font.DEFULT_FONT="'Source Han Sans'",Font}()},,function(t,e,i){"use strict";var IsInValidKey=function(t){return null==t||""===t||0===t.length};e.a=function(t,e,i){if("object"==typeof t){if(IsInValidKey(e)){if(null==i)return;"object"==typeof i&&(t=i)}else{"string"==typeof e&&(e=e.split("."));var n=e.pop();(function(t,e,i){var n=t;if(IsInValidKey(e));else{var o;"string"==typeof e&&(e=e.split("."));for(var a=0,s=e.length;a<s;a++){var h;if(null==n[o=e[a]]||"object"!=typeof n[o])h=a===s-1?void 0===i?{}:i:{},n[o]=h;n=n[o]}}return n}(t,e))[n]=i}return t}}},function(t,e,i){"use strict";i.r(e),i.d(e,"NinePatch",(function(){return s}));var n,o=i(143),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function NinePatch(e,i,n,a,s,h,l,c){var p=t.call(this,e,i,n)||this;return p.config=c||p.scene.cache.custom.ninePatch.get(l?""+l:h),p.config.top=Math.round(p.config.top),p.config.right&&(p.config.right=Math.round(p.config.right)),p.config.bottom&&(p.config.bottom=Math.round(p.config.bottom)),p.config.left&&(p.config.left=Math.round(p.config.left)),Object(o.normalizePatchesConfig)(p.config),p.setSize(a,s),p.setTexture(h,l),p}return a(NinePatch,t),NinePatch.prototype.resize=function(t,e){return t=Math.round(t),e=Math.round(e),this.config?this.width===t&&this.height===e?this:(t=Math.max(t,this.config.left+this.config.right+1),e=Math.max(e,this.config.top+this.config.bottom+1),this.setSize(t,e),void this.drawPatches()):this},NinePatch.prototype.setTexture=function(t,e){return this.originTexture=this.scene.textures.get(t),this.setFrame(e),this},NinePatch.prototype.setFrame=function(t){return this.originFrame=this.originTexture.frames[t]||this.originTexture.frames[NinePatch.__BASE],this.createPatches(),this.drawPatches(),this},NinePatch.prototype.setSize=function(e,i){return t.prototype.setSize.call(this,e,i),this.finalXs=[0,this.config.left,this.width-this.config.right,this.width],this.finalYs=[0,this.config.top,this.height-this.config.bottom,this.height],this},NinePatch.prototype.setTint=function(t){return this.tint=t,this},NinePatch.prototype.setTintFill=function(t){return this.tint=t,this.tintFill=!0,this},Object.defineProperty(NinePatch.prototype,"tintFill",{get:function(){return this.first&&this.first.tintFill},set:function(t){this.each((function(e){return e.tintFill=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(NinePatch.prototype,"tint",{set:function(t){this.each((function(e){return e.setTintFill(t)})),this.internalTint=t},enumerable:!1,configurable:!0}),Object.defineProperty(NinePatch.prototype,"isTinted",{get:function(){return this.first&&this.first.isTinted},enumerable:!1,configurable:!0}),NinePatch.prototype.clearTint=function(){this.each((function(t){return t.clearTint()})),this.internalTint=void 0,this.tintFill=!1},NinePatch.prototype.createPatches=function(){for(var t=[0,this.config.left,this.originFrame.width-this.config.right,this.originFrame.width],e=[0,this.config.top,this.originFrame.height-this.config.bottom,this.originFrame.height],i=0,n=0;n<3;n++)for(var o=0;o<3;o++)this.createPatchFrame(this.getPatchNameByIndex(i),t[o],e[n],t[o+1]-t[o],e[n+1]-e[n]),++i},NinePatch.prototype.drawPatches=function(){var t=this.tintFill;this.removeAll(!0);for(var e=0,i=0;i<3;i++)for(var n=0;n<3;n++){var o=this.originTexture.frames[this.getPatchNameByIndex(e)],a=new Phaser.GameObjects.Image(this.scene,0,0,o.texture.key,o.name);a.setOrigin(0),a.setPosition((1e3*this.finalXs[n]-this.width*this.originX*1e3)/1e3,(1e3*this.finalYs[i]-this.height*this.originY*1e3)/1e3),a.displayWidth=this.finalXs[n+1]-this.finalXs[n],a.displayHeight=this.finalYs[i+1]-this.finalYs[i],this.add(a),this.internalTint&&a.setTint(this.internalTint),a.tintFill=t,++e}},NinePatch.prototype.createPatchFrame=function(t,e,i,n,o){this.originTexture.frames.hasOwnProperty(t)||this.originTexture.add(t,this.originFrame.sourceIndex,this.originFrame.cutX+e,this.originFrame.cutY+i,n,o)},NinePatch.prototype.getPatchNameByIndex=function(t){return this.originFrame.name+"|"+NinePatch.patches[t]},NinePatch.__BASE="__BASE",NinePatch.patches=["[0][0]","[1][0]","[2][0]","[0][1]","[1][1]","[2][1]","[0][2]","[1][2]","[2][2]"],NinePatch}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function MessageType(){}return MessageType.CREATE_ROLE="create_role",MessageType.APP_START="app_start",MessageType.EDITOR_CHANGE_MODE="editor_change_mode",MessageType.CLIENT_RESIZE="app_client_resize",MessageType.SCENE_INITIALIZED="SCENE_INITIALIZED",MessageType.SCENE_CLEARED="SCENE_CLEARED",MessageType.SCENE_CHANGE_TO="SCENE_CHANGE_TO",MessageType.SCENE_MOVE_TO="scene_move_to",MessageType.SCENE_MOVE_STOP="scene_move_stop",MessageType.CHANGE_ELEMENT_ANIMATION="change_element_animation",MessageType.CHANGE_CHARACTER_ANIMATION="change_character_animation",MessageType.CHAT_TO="chat_to",MessageType.SHOW_CHAT_BUBBLE="show_chat_bubble",MessageType.REMOVE_CHAT_BUBBLE="remove_chat_bubble",MessageType.PROMPT_ALERT="prompt_alert",MessageType.CHARACTER_TALING="characterTaling",MessageType.CHARACTER_SHUT_UP="characterShutUp",MessageType.QCLOUD_AUTH="qcloud_auth",MessageType.ENTER_SCENE="enter_scene",MessageType.SCENE_ADD_PLAYER="scene_add_player",MessageType.SCENE_REMOVE_PLAYER="scene_remove_player",MessageType.SCENE_UPDATE_PLAYER="scene_update_player",MessageType.SCENE_ADD_ELEMENT="scene_add_element",MessageType.SCENE_ADD_TERRAIN="scene_add_terrain",MessageType.SCENE_ADD_TERRAIN_END="scene_add_terrain_end",MessageType.SCENE_ADD_ALL_TERRAIN="scene_add_all_terrain",MessageType.SCENE_REMOVE_ELEMENT="scene_remove_element",MessageType.SCENE_REMOVE_TERRAIN="scene_remove_terrain",MessageType.SCENE_REMOVE_ALL_TERRAIN="scene_remove_all_terrain",MessageType.SCENE_MOUSE_FOLLOW="scene_mouse_follow",MessageType.SCENE_SELECT_ELEMENT="scene_select_element",MessageType.SCENE_FIXED_TO_ELEMENT="scene_fixed_to_element",MessageType.SCENE_UPDATE_ELEMENT="sceneUpdateElement",MessageType.SCENE_SYNCHRO_PACKAGE="sceneSynchroPackage",MessageType.SCENE_VISIBLE_GRID="sceneVisibleGrid",MessageType.PLAYER_SELECT_CHARACTER="player_select_character",MessageType.PLAYER_DATA_INITIALIZE="player_data_initialize",MessageType.SCENE_DATA_INITIALIZE="scene_data_initialize",MessageType.PACKAGE_ITEM_ADD="package_item_add",MessageType.PACKAGE_ITEM_REMOVE="package_item_remove",MessageType.PACKAGE_EXCHANGE_ITEM_POS="package_exchange_item_pos",MessageType.SCENE_BACKGROUND_CLICK="SCENE_BACKGROUND_CLICK",MessageType.CHANGE_SELF_AVATAR="CHANGE_SELF_AVATAR",MessageType.DRAG_TO_DROP="DRAG_TO_DROP",MessageType.DRAG_OVER_DROP="DRAG_OVER_DROP",MessageType.QUERY_PACKAGE="query_package",MessageType.SYNC_USER_BALANCE="syncUserBalance",MessageType.UPDATED_CHARACTER_PACKAGE="updatedCharacterPackage",MessageType.SHOW_EFFECT="showEffect",MessageType.EDIT_MODE_QUERY_PACKAGE="editModeQueryPackage",MessageType.PRESS_ELEMENT="PRESS_ELEMENT",MessageType.TURN_ELEMENT="turnElement",MessageType.RECYCLE_ELEMENT="recycleElement",MessageType.PUT_ELEMENT="putElement",MessageType.CANCEL_PUT="cancelPut",MessageType.EDIT_PACKAGE_EXPANED="editPackageExpaned",MessageType.EDIT_PACKAGE_COLLAPSE="editPackageCollapse",MessageType.SELECTED_DECORATE_ELEMENT="selectedDecorateElement",MessageType.CANCEL_DECORATE_ELEMENT="cancelDecorateElement",MessageType.ADD_ICON_TO_TOP="addIconToTop",MessageType.REMOVE_ICON_FROM_TOP="removeIconFromTop",MessageType.SHOW_UI="showUI",MessageType.SHOW_NOTICE="showNotice",MessageType}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function Pos(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.depth=0|n}return Pos.prototype.add=function(t,e,i){return this.x+=t,this.x+=e,this.z+=i||0,this},Pos.prototype.equal=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.depth===this.depth},Pos.prototype.toString=function(){return"Pos >> x: "+this.x+", y: "+this.y+", z: "+this.z+", depth: "+this.depth},Pos.prototype.toPoint=function(){return new Phaser.Geom.Point(this.x,this.y)},Pos}()},function(t,e,i){"use strict";i.d(e,"b",(function(){return GetDisplayWidth})),i.d(e,"a",(function(){return GetDisplayHeight}));var GetDisplayWidth=function(t){return void 0!==t.displayWidth?t.displayWidth:t.width},GetDisplayHeight=function(t){return void 0!==t.displayHeight?t.displayHeight:t.height}},function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicImage",(function(){return s}));var n,o=i(8),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function DynamicImage(e,i,n){return t.call(this,e,i,n,void 0)||this}return a(DynamicImage,t),DynamicImage.prototype.load=function(t,e,i,n){this.mLoadCompleteCallbak=i,this.mLoadErrorCallback=n,this.mLoadContext=e,this.scene?(this.mUrl=t,this.scene.textures.exists(t)?this.onLoadComplete(t):(this.scene.load.image(t,t),this.scene.load.on(Phaser.Loader.Events.FILE_COMPLETE,this.onLoadComplete,this),this.scene.load.on(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())):o.a.getInstance().fatal(DynamicImage.name+" Create failed does not exist")},DynamicImage.prototype.destroy=function(e){void 0===e&&(e=!1),this.mLoadCompleteCallbak=null,this.mLoadContext=null,this.mLoadErrorCallback=null,this.mUrl="",this.scene&&(this.scene.load.off(Phaser.Loader.Events.FILE_COMPLETE,this.onLoadComplete,this),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this)),t.prototype.destroy.call(this,e)},DynamicImage.prototype.onLoadComplete=function(t){if(t===this.mUrl&&(this.scene.load.off(Phaser.Loader.Events.FILE_COMPLETE,this.onLoadComplete,this),this.scene.load.off(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.setTexture(this.mUrl),this.mLoadCompleteCallbak)){var e=this.mLoadCompleteCallbak;this.mLoadCompleteCallbak=null,e.call(this.mLoadContext),this.mLoadContext=null}},DynamicImage.prototype.onLoadError=function(t){if(this.mUrl===t.url&&this.mLoadErrorCallback){var e=this.mLoadErrorCallback;this.mLoadErrorCallback=null,e.call(this.mLoadContext),this.mLoadContext=null}},DynamicImage}(Phaser.GameObjects.Image)},,function(t,e,i){"use strict";var n;i.d(e,"a",(function(){return n})),function(t){t[t.None=0]="None",t[t.Scene=1]="Scene",t[t.Normal=2]="Normal",t[t.Pop=3]="Pop",t[t.Tips=4]="Tips",t[t.Monopoly=5]="Monopoly",t[t.Activity=6]="Activity"}(n||(n={}))},function(t,e,i){"use strict";i.r(e),i.d(e,"NinePatchButton",(function(){return s}));var n,o=i(12),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function NinePatchButton(e,i,n,a,s,h,l,c,p,u){var m=t.call(this,e,i,n)||this;return m.mScene=e,m.mKey=h,m.mFrame=l||"__BASE",m.initFrame(),m.setSize(a,s),m.mNingBg=new o.NinePatch(m.scene,0,0,a,s,h,m.mFrame_nrmal,p),m.add(m.mNingBg),u&&(m.btnData=u),m.mLabel=m.scene.make.text(void 0,!1).setOrigin(.5,.5).setSize(m.width,m.height).setAlign("center").setText(c),m.add(m.mLabel),m.setInteractive(new Phaser.Geom.Rectangle(0,0,a,s),Phaser.Geom.Rectangle.Contains),m.on("pointerdown",m.onPointerDown,m),m.on("pointerup",m.onPointerUp,m),m}return a(NinePatchButton,t),Object.defineProperty(NinePatchButton.prototype,"enable",{set:function(t){t?(this.mNingBg.clearTint(),this.mLabel.clearTint(),this.setInteractive()):(this.mNingBg.setTintFill(6710886),this.mLabel.setTintFill(7829367),this.removeInteractive())},enumerable:!1,configurable:!0}),NinePatchButton.prototype.getBtnData=function(){return this.btnData},NinePatchButton.prototype.setText=function(t){this.mLabel.setText(t)},NinePatchButton.prototype.getText=function(){return this.mLabel.text},NinePatchButton.prototype.setTextStyle=function(t){this.mLabel.setStyle(t)},NinePatchButton.prototype.setFontStyle=function(t){this.mLabel.setFontStyle(t)},NinePatchButton.prototype.setTextOffset=function(t,e){this.mLabel.setPosition(t,e)},NinePatchButton.prototype.setFrame=function(t){return this.mNingBg.setFrame(t),this},NinePatchButton.prototype.destroy=function(e){this.mLabel&&this.mLabel.destroy(),t.prototype.destroy.call(this,e)},NinePatchButton.prototype.setFrameNormal=function(t,e,i){return this.mFrame_nrmal=t,this.mFrame_down=e||t,this.mFrame_over=i||t,this.changeNormal(),this},NinePatchButton.prototype.changeNormal=function(){this.setFrame(this.mFrame_nrmal)},NinePatchButton.prototype.changeDown=function(){this.setFrame(this.mFrame_down)},NinePatchButton.prototype.changeOver=function(){this.setFrame(this.mFrame_over)},NinePatchButton.prototype.isExists=function(t){var e=this.scene.textures.get(this.mKey);return!(!e||!e.has(t))},NinePatchButton.prototype.onPointerDown=function(t){this.changeDown()},NinePatchButton.prototype.onPointerUp=function(t){this.changeNormal(),this.emit("click",t,this)},Object.defineProperty(NinePatchButton.prototype,"label",{get:function(){return this.mLabel},enumerable:!1,configurable:!0}),NinePatchButton.prototype.scaleHandler=function(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1},NinePatchButton.prototype.initFrame=function(){var t=this.mFrame?this.mFrame:this.mKey;this.mFrame_nrmal=t+"_normal";var e=t+"_down";this.isExists(e)||(e=t+"_normal"),this.mFrame_down=e;var i=t+"_over";this.isExists(i)||(i=t+"_normal"),this.mFrame_over=i},NinePatchButton}(Phaser.GameObjects.Container)},,function(t,e,i){"use strict";var n=i(324),o=i(258),a={plainText:null,prevProp:null},s=new o.a,h={},l={splitText:function(t,e){for(var i,n,o=[],a=0,s=t.length,h=s;i=c.exec(t);)n=i[0],a<(h=c.lastIndex-n.length)&&o.push(t.substring(a,h)),void 0===e&&o.push(n),a=c.lastIndex;return a<s&&o.push(t.substring(a,s)),o},tagTextToProp:function(t,e){var i,n;null==e&&(e={}),e.img&&updateProp(e,B,"img"),p.test(t)?(updateProp(e,I,"b",!0),i=""):u.test(t)?(updateProp(e,B,"b"),i=""):m.test(t)?(updateProp(e,I,"i",!0),i=""):d.test(t)?(updateProp(e,B,"i"),i=""):f.test(t)?(n=t.match(f),updateProp(e,I,"size",n[1]+"px"),i=""):y.test(t)?(updateProp(e,B,"size"),i=""):g.test(t)?(n=t.match(g),updateProp(e,I,"color",n[1]),i=""):_.test(t)?(updateProp(e,B,"color"),i=""):v.test(t)?(n=t.match(v),updateProp(e,I,"u",!0),i=""):b.test(t)?(n=t.match(b),updateProp(e,I,"u",n[1]),i=""):P.test(t)?(updateProp(e,B,"u"),i=""):S.test(t)?(updateProp(e,I,"shadow",!0),i=""):w.test(t)?(updateProp(e,B,"shadow"),i=""):T.test(t)?(updateProp(e,I,"stroke",!0),i=""):C.test(t)?(n=t.match(C),updateProp(e,I,"stroke",n[1]),i=""):D.test(t)?(updateProp(e,B,"stroke"),i=""):M.test(t)?(n=t.match(M),updateProp(e,I,"img",n[1]),i=""):O.test(t)?(updateProp(e,B,"img"),i=""):x.test(t)?(n=t.match(x),updateProp(e,I,"area",n[1]),i=""):E.test(t)?(updateProp(e,B,"area"),i=""):i=t;var o=a;return o.plainText=i,o.prop=e,o},propToContextStyle:function(t,e){var i=s;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")?i.fontFamily=e.family:i.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var n=e.size;"number"==typeof n&&(n=n.toString()+"px"),i.fontSize=n}else i.fontSize=t.fontSize;i.fontStyle=getFontStyle(e.b,e.i),e.hasOwnProperty("color")?i.color=e.color:i.color=t.color,e.hasOwnProperty("stroke")?!0===e.stroke?(i.stroke=t.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=e.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=t.stroke,i.strokeThickness=0)}return e.hasOwnProperty("shadow")?!0===e.shadow?(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor=e.shadow,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor="#000",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,i.shadowStroke=!1,i.shadowFill=!1),e.hasOwnProperty("u")?!0===e.u?(i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor=e.u,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor="#000",i.underlineThickness=0,i.underlineOffset=0),i},propToTagText:function(t,e,i){for(var n in null==i&&(i=h),i)e.hasOwnProperty(n)||(t="[/"+n+"]"+t);var o="";for(var n in e)i[n]!==e[n]&&("size"===n?o+="[size="+e[n].replace("px","")+"]":"color"===n||"stroke"===n||"img"===n?o+="["+n+"="+e[n]+"]":"u"===n?!0===e[n]?o+="[u]":o+="[u="+e[n]+"]":o+="["+n+"]");return t=o+t}},updateProp=function(t,e,i,n){return e===I?t[i]=n:t.hasOwnProperty(i)&&delete t[i],t},getFontStyle=function(t,e){return t&&e?"bold italic":t?"bold":e?"italic":""},c=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/gi,p=/\[b\]/i,u=/\[\/b\]/i,m=/\[i\]/i,d=/\[\/i\]/i,f=/\[size=(\d+)\]/i,y=/\[\/size\]/i,g=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,_=/\[\/color\]/i,v=/\[u\]/i,b=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,P=/\[\/u\]/i,S=/\[shadow\]/i,w=/\[\/shadow\]/i,T=/\[stroke\]/i,C=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,D=/\[\/stroke\]/i,M=/\[img=([^\]]+)\]/i,O=/\[\/img\]/i,x=/\[area=([^\]]+)\]/i,E=/\[\/area\]/i;const B=!1,I=!0;var A=l;class BBCodeText_BBCodeText extends n.a{constructor(t,e,i,n,o){super(t,e,i,n,o,"rexBBCodeText",A)}}e.a=BBCodeText_BBCodeText},function(t,e,i){"use strict";i.d(e,"d",(function(){return o})),i.d(e,"a",(function(){return a})),i.d(e,"c",(function(){return s})),i.d(e,"b",(function(){return I}));var n,o,a,s,h=i(111),l=i(78),c=i(3),p=i(8),u=i(14),m=i(119),d=i(120),f=i(5),y=i(9),g=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),_=function(t){function Bubble(e,i){var n=t.call(this,e)||this;return n.mMinWidth=0,n.mMinHeight=0,n.mScale=i,n.x=-40*i,n}return g(Bubble,t),Bubble.prototype.show=function(t,e){this.mChatContent=this.scene.make.text({text:t,style:{x:0,y:4*this.mScale,fontFamily:y.a.DEFULT_FONT,fontSize:14*this.mScale,color:"#000000",origin:{x:0,y:0},wordWrap:{width:300,useAdvancedWrap:!0}}},!1),this.add(this.mChatContent),this.mMinHeight=this.mChatContent.height+26,this.mMinHeight=this.mMinHeight<54?54:this.mMinHeight,this.mMinWidth=this.mChatContent.width+40,this.mMinWidth=this.mMinWidth<69?69:this.mMinWidth,this.mBubbleBg=new d.DynamicNinepatch(this.scene,this);var i=f.h.getOsdRes(e.bubbleResource||"platformitem/thumbnail/bubble_01.png");this.mBubbleBg.load(i,{width:this.mMinWidth,height:this.mMinHeight,key:i,columns:[34,2,32],rows:[42,2,9]},this.onComplete,this)},Bubble.prototype.tweenTo=function(t){this.mToY=t,this.scene.tweens.add({targets:this,y:t,alpha:1,duration:200})},Bubble.prototype.durationRemove=function(t,e,i){var n=this;this.mTweenCompleteCallback=e,this.mTweenCallContext=i,this.mRemoveDelay=setTimeout((function(){n.removeTween()}),t)},Bubble.prototype.removeTween=function(){var t=this,e=this.mToY-30;this.scene.tweens.add({targets:this,y:e,alpha:0,duration:200,onComplete:function(){t.mTweenCompleteCallback&&t.mTweenCompleteCallback.call(t.mTweenCallContext,t)}})},Bubble.prototype.destroy=function(){this.mChatContent&&this.mChatContent.destroy(!0),this.mChatContent=null,this.mMinWidth=0,this.mMinHeight=0,this.mToY=0,this.mTweenCompleteCallback=null,this.mTweenCallContext=null,this.mRemoveDelay&&clearTimeout(this.mRemoveDelay),t.prototype.destroy.call(this,!0)},Bubble.prototype.onComplete=function(t){if(t){t.setOrigin(0,0),this.addAt(t,0);this.getBounds();this.mChatContent.x=this.mMinWidth-this.mChatContent.width>>1,this.mChatContent.y=6+(this.mMinHeight-this.mChatContent.height>>1)}},Object.defineProperty(Bubble.prototype,"minWidth",{get:function(){return this.mMinWidth},enumerable:!1,configurable:!0}),Object.defineProperty(Bubble.prototype,"minHeight",{get:function(){return this.mMinHeight},enumerable:!1,configurable:!0}),Bubble}(Phaser.GameObjects.Container),v=i(16),b=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),P=function(t){function BubbleContainer(e,i){var n=t.call(this,e)||this;return n.mBubbles=[],n.mScale=i,n.mArrow=new v.DynamicImage(n.scene,0,0),n.mArrow.scale=i,n.mArrow.load(f.h.getRes("ui/chat/bubble_arrow.png")),n.add(n.mArrow),n}return b(BubbleContainer,t),BubbleContainer.prototype.addBubble=function(t,e){var i=this.createBubble(e),n=this.mBubbles.length,o=null,a=0;i.show(t,e);for(var s=n-1;s>=0;s--)a+=(o=this.mBubbles[s]).minHeight+5*this.mScale,o.tweenTo(-a);this.add(i),this.mArrow.y=4*this.mScale},BubbleContainer.prototype.updatePos=function(t,e){this.x=t*this.mScale,this.y=e*this.mScale},BubbleContainer.prototype.destroy=function(e){if(this.mBubbles){for(var i=null,n=this.mBubbles.length-1;n>=0;n--)(i=this.mBubbles[n])&&i.destroy();this.mBubbles=null,this.removeFormParent(),t.prototype.destroy.call(this,e)}},BubbleContainer.prototype.removeFormParent=function(){this.parentContainer&&this.parentContainer.remove(this)},BubbleContainer.prototype.createBubble=function(t){if(t){var e=new _(this.scene,this.mScale);this.mBubbles.push(e);var i=t.duration?t.duration:5e3;return e.durationRemove(i,this.onRemoveBubble,this),e}},BubbleContainer.prototype.onRemoveBubble=function(t){t&&(this.mBubbles=this.mBubbles.filter((function(e){return t!==e})),this.remove(t),t.destroy(),0===this.mBubbles.length&&this.removeFormParent())},BubbleContainer}(Phaser.GameObjects.Container),S=i(4),w=function w(){},T=i(13),C=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),D=function(t){function ShopEntity(e){var i=t.call(this)||this;return i.mWorld=e,i.mInitialize=!1,i.mConnect=i.mWorld.connection,i.addHandlerFun(c.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QUERY_PACKAGE,i.handlerQueryPackage),i.mShopModel=new w,i}return C(ShopEntity,t),ShopEntity.prototype.initialize=function(){return this.mInitialize},ShopEntity.prototype.register=function(){this.mConnect.addPacketListener(this)},ShopEntity.prototype.unRegister=function(){this.mConnect.removePacketListener(this)},ShopEntity.prototype.destroy=function(){this.unRegister(),this.mShopModel=null,this.mInitialize=!1,this.mConnect=null},ShopEntity.prototype.handlerQueryPackage=function(t){var e=t.content;this.mWorld.emitter.emit(T.a.QUERY_PACKAGE,e)},ShopEntity.NAME="ShopModel",ShopEntity}(S.PacketHandler),M=function(){function AIAction(){this.isBreak=!0,this.isEnd=!1}return AIAction.prototype.nextAction=function(){this.isEnd=!0,this.group&&this.group.nextAction()},AIAction.prototype.destroy=function(){this.owner=null,this.group=null},AIAction}(),O=function(){function ActionGroup(){}return ActionGroup.prototype.addAction=function(t){this.list||(this.list=[]),this.list.push(t)},ActionGroup.prototype.nextAction=function(){this.current&&(this.current.destroy(),this.current=null),this.list&&this.list.length>0&&(this.current=this.list.splice(0,1)[0],this.current.isEnd=!1,this.current.execute())},ActionGroup.prototype.setComplHandler=function(t){this.compHandler=t},ActionGroup.prototype.clear=function(){if(this.list){for(var t=0,e=this.list;t<e.length;t++){e[t].destroy()}this.list.length=0}this.current&&(this.current.destroy(),this.current=null)},ActionGroup.prototype.stopCurrentAction=function(){this.current&&(this.current.destroy(),this.current=null)},ActionGroup.prototype.isExecuting=function(){return!(!this.current||this.current.isEnd)},ActionGroup.prototype.hasLast=function(){return!(!this.list||0===this.list.length)},ActionGroup.prototype.breakAction=function(){for(var t=0,e=this.list;t<e.length;t++){e[t].destroy()}this.list.length=0,this.current&&this.current.isBreak&&(this.current.destroy(),this.current=null)},ActionGroup.prototype.destroy=function(){this.clear(),this.list=null,this.sleepAction&&(this.sleepAction.destroy(),this.sleepAction=null),this.compHandler&&(this.compHandler.clear(),this.compHandler=null)},ActionGroup}(),x=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),E=function(t){function AI(e){var i=t.call(this)||this;return i.owner=e,i.group=new O,i}return x(AI,t),AI.prototype.execute=function(){this.group.nextAction()},AI.prototype.nextAction=function(){this.group.nextAction()},AI.prototype.addAction=function(t,e){void 0===e&&(e=!1),t.group=this.group,t.owner=this.owner,e&&this.group.current&&this.group.current.isBreak&&this.group.stopCurrentAction(),this.group.addAction(t),this.group.isExecuting()||this.group.nextAction()},AI.prototype.breakAction=function(){this.group.breakAction()},AI.prototype.destroy=function(){this.group.destroy(),this.owner=null},AI}(M),B=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t.IDLE="idle",t.WALK="walk",t.RUN="run",t.ATTACK="attack",t.JUMP="jump",t.INJURED="injured",t.FAILED="failed",t.DANCE01="dance01",t.DANCE02="dance02",t.FISHING="fishing",t.GREET01="greet01",t.SIT="sit",t.LIE="lit",t.EMOTION01="emotion01"}(o||(o={})),function(t){t[t.north=0]="north",t[t.north_west=1]="north_west",t[t.west=2]="west",t[t.west_south=3]="west_south",t[t.south=4]="south",t[t.south_east=5]="south_east",t[t.east=6]="east",t[t.east_north=7]="east_north"}(a||(a={})),function(t){t[t.Diasble=0]="Diasble",t[t.Enable=1]="Enable",t[t.Interactive=2]="Interactive"}(s||(s={}));var I=function(t){function Element(e,i){var n=t.call(this,i.roomService)||this;return n.mElementManager=i,n.mAnimationName="",n.mMoveData={},n.mCurState=o.IDLE,n.mOffsetY=void 0,n.mMoving=!1,n.mId=e.id,n.model=e,n.mAi=new E(n),n}return B(Element,t),Object.defineProperty(Element.prototype,"dir",{get:function(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"roomService",{get:function(){if(this.mElementManager)return this.mElementManager.roomService},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"id",{get:function(){return this.mId},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"model",{get:function(){return this.mModel},set:function(t){this.setModel(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"scene",{get:function(){if(this.mElementManager)return this.mElementManager.scene},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"ai",{get:function(){return this.mAi},enumerable:!1,configurable:!0}),Object.defineProperty(Element.prototype,"eleMgr",{get:function(){if(this.mElementManager)return this.mElementManager},enumerable:!1,configurable:!0}),Element.prototype.load=function(t){this.mDisplayInfo=t,this.loadDisplayInfo()},Element.prototype.setModel=function(t){if(this.mModel=t,t&&(this.mQueueAnimations=void 0,this.load(this.mModel.displayInfo),this.mDisplay)){this.mModel.pos&&this.setPosition(this.mModel.pos),this.mDisplay.changeAlpha(this.mModel.alpha),this.setDirection(this.mModel.direction);var e=this.mDisplayInfo;this.mInputEnable===s.Interactive&&this.setInputEnable(this.mInputEnable),e&&e.shops&&(this.mShopEntity=new D(this.mElementManager.roomService.world),this.mShopEntity.register())}},Element.prototype.updateModel=function(t){if(this.mModel.id===t.id){if(t.hasOwnProperty("avatar")&&(this.mModel.updateAvatar(t.avatar),this.load(this.mModel.displayInfo)),t.display&&t.animations&&(this.mModel.updateDisplay(t.display,t.animations),this.load(this.mModel.displayInfo)),t.hasOwnProperty("point3f")){var e=t.point3f;this.setPosition(new u.a(e.x,e.y,e.z))}t.hasOwnProperty("currentAnimationName")&&(this.play(t.currentAnimationName),this.setInputEnable(this.mInputEnable),this.mModel.setAnimationQueue(void 0)),t.hasOwnProperty("direction")&&this.setDirection(t.direction)}},Element.prototype.scaleTween=function(){this.mDisplay&&this.mDisplay.scaleTween()},Element.prototype.play=function(t){this.mModel?this.mModel.currentAnimationName!==t&&(this.mModel.currentAnimationName=t,this.mDisplay&&this.mDisplay.play(this.model.currentAnimation)):p.a.getInstance().error(Element.name+": sprite is empty")},Element.prototype.setQueue=function(t){var e=this;if(this.mModel){for(var i=[],n=0,a=t;n<a.length;n++){var s=a[n],h={name:s.animationName,playTimes:s.times};s.times>0&&(h.complete=function(){var t=e.model.animationQueue;t.shift();var i=t.length>0?t[0].name:o.IDLE;e.play(i)}),i.push(h)}this.mModel.setAnimationQueue(i),i.length>0&&this.play(t[0].animationName)}},Element.prototype.setDirection=function(t){this.mDisplayInfo&&(this.mDisplayInfo.avatarDir=t),this.mDisplay&&this.model&&(this.model.direction=t,this.mDisplay.play(this.model.currentAnimation))},Element.prototype.getDirection=function(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},Element.prototype.changeState=function(t){this.mCurState!==t&&(this.mCurState=t,this.mDisplay&&(t||(t=o.IDLE),this.play(this.mCurState)))},Element.prototype.getState=function(){return this.mCurState},Element.prototype.getRenderable=function(){return this.mRenderable},Element.prototype.getDisplay=function(){return this.mDisplay},Element.prototype.move=function(t){this.mElementManager&&this.mDisplay&&(this.mMoveData.arrivalTime=t.timestemp,this.mMoveData.posPath=[{x:t.destinationPoint3f.x,y:t.destinationPoint3f.y}],this._doMove())},Element.prototype.movePosition=function(t,e){if(this.mElementManager&&this.mDisplay){this.startMove(),t.depth||(t.depth=this.getDepth()),this.setPosition(t);var i=this.calculateDirectionByAngle(e);-1!==i&&i!==this.model.direction&&this.setDirection(i)}},Element.prototype.movePath=function(t){var e=this;if(this.mElementManager&&(this.mDisplay&&t.path)){this.mMoveData.arrivalTime=t.timestemp;for(var i=new u.a(this.mDisplay.x,this.mDisplay.y-this.offsetY),n=[],o=null,a=null,s=this.mElementManager.roomService.now(),h=0,l=0,c=t.path;l<c.length;l++){var p=c[l];(a=p.point3f).y===i.y&&a.x===i.x||(o=Math.atan2(a.y-i.y,a.x-i.x)*(180/Math.PI)),s+=h,h=p.timestemp-s,n.push({x:a.x,y:a.y,duration:h,onStartParams:o,onStart:function(t,i,n){e.onCheckDirection(n)}}),i=new u.a(a.x,a.y)}this.mMoveData.posPath=n,this._doMove()}},Element.prototype.startMove=function(){this.changeState(o.WALK)},Element.prototype.stopMove=function(){this.mMoving=!1,this.mDisplay&&(this.mMoveData&&this.mMoveData.posPath&&(delete this.mMoveData.posPath,this.mMoveData.arrivalTime&&(this.mMoveData.arrivalTime=0),this.mMoveData.tweenLineAnim&&(this.mMoveData.tweenLineAnim.stop(),this.mMoveData.tweenLineAnim.destroy())),this.changeState(o.IDLE))},Element.prototype.setPosition=function(t){if(this.mMoving&&this.stopMove(),this.mDisplay&&t){this.mDisplay.setPosition(t.x,t.y,t.z),this.mModel.setPosition(t.x,t.y);var e=t.depth?t.depth:0;this.setDepth(e)}this.updateBlock()},Element.prototype.getRootPosition=function(){return new u.a(this.mDisplay.x,this.mDisplay.y,0)},Element.prototype.showBubble=function(t,e){var i=this.mElementManager.scene;i&&(this.mBubble||(this.mBubble=new P(i,this.roomService.world.scaleRatio)),this.mBubble.addBubble(t,e),this.updateBubble(),this.roomService.addToSceneUI(this.mBubble))},Element.prototype.clearBubble=function(){this.mBubble&&(this.mBubble.destroy(),this.mBubble=null)},Element.prototype.showNickName=function(){this.mDisplay&&this.model&&this.mDisplay.showNickname(this.model.nickname)},Element.prototype.showEffected=function(){this.mDisplay&&this.mDisplay.showEffect()},Element.prototype.showNickname=function(){this.model&&this.mDisplay&&this.mDisplay.showNickname(this.model.nickname)},Element.prototype.toSprite=function(){var t=c.op_client.Sprite.create();return t.id=this.id,this.mDisplay&&(t.point3f=c.op_def.PBPoint3f.create(),t.point3f.x=this.mDisplay.x,t.point3f.y=this.mDisplay.y,t.point3f.z=this.mDisplay.z),t},Element.prototype.turn=function(){this.mModel&&(this.mModel.turn(),this.mDisplay&&this.mDisplay.play(this.mModel.currentAnimation))},Element.prototype.setAlpha=function(t){this.mDisplay&&this.mDisplay.setAlpha(t)},Element.prototype.getDepth=function(){var t=0;return this.model&&this.model.pos&&(t=this.model.pos.depth?this.model.pos.depth:0),t},Element.prototype.destroy=function(){this.mMoveData&&this.mMoveData.tweenAnim&&(this.mMoveData.tweenAnim.stop(),this.mMoveData.tweenAnim.remove(),this.mMoveData.tweenAnim=null,this.mMoveData=null),this.mDisplay&&(this.mBlockable&&this.roomService.removeBlockObject(this),this.mDisplay.destroy(),this.mDisplay=null),this.mBubble&&(this.mBubble.destroy(),this.mBubble=void 0),this.mShopEntity&&(this.mShopEntity.destroy(),this.mShopEntity=null),this.mAi&&(this.mAi.destroy(),this.mAi=null),t.prototype.destroy.call(this)},Element.prototype._doMove=function(){var t=this;if(this.mMoveData.posPath){var e=this.mMoveData.tweenLineAnim;e&&(e.stop(),e.destroy());var i=this.mMoveData.posPath;this.mMoveData.tweenLineAnim=this.mElementManager.scene.tweens.timeline({targets:this.mDisplay,ease:"Linear",tweens:i,onStart:function(){t.onMoveStart()},onComplete:function(){t.onMoveComplete()},onUpdate:function(){t.onMoving()},onCompleteParams:[this]})}},Element.prototype.createDisplay=function(){if(this.mDisplayInfo){if(this.mDisplay)return this.mDisplay;var t=this.mElementManager.scene;if(t){"DragonbonesModel"===this.mDisplayInfo.discriminator?this.mDisplay=new h.a(t,this.mElementManager.roomService,this):this.mDisplay=new l.a(t,this.mElementManager.roomService,this);var e=this.mModel.pos;e&&this.mDisplay.setPosition(e.x,e.y,e.z),this.addToBlock()}return this.mDisplay}p.a.getInstance().error("displayinfo does not exist, Create "+this.model.nickname+" failed")},Element.prototype.loadDisplayInfo=function(){this.mDisplayInfo&&(this.mDisplay||this.createDisplay(),this.mDisplay.once("initialized",this.onDisplayReady,this),this.mDisplay.load(this.mDisplayInfo))},Element.prototype.addDisplay=function(){this.createDisplay();var t=this.roomService;if(t&&this.mDisplay){t.addToSurface(this.mDisplay);var e=0;this.model&&this.model.pos&&(e=this.model.pos.depth?this.model.pos.depth:0),this.setDepth(e)}},Element.prototype.setDepth=function(t){if(this.mDisplay){if(this.mDisplay.setDepth(t),!this.roomService)throw new Error("roomService is undefined");var e=this.roomService.layerManager;if(!e)throw new Error("layerManager is undefined");e.depthSurfaceDirty=!0}},Element.prototype.onDisplayReady=function(){if(this.mDisplay){this.setInputEnable(this.mInputEnable),this.mDisplay.play(this.model.currentAnimation);var t=0;this.model&&this.model.pos&&(t=this.model.pos.depth?this.model.pos.depth:0),this.setDepth(t)}},Element.prototype.updateBubble=function(){if(this.mBubble){var t=this.getPosition();t&&this.mBubble.updatePos(t.x,t.y-80)}},Element.prototype.onMoveStart=function(){this.mMoving=!0},Element.prototype.onMoveComplete=function(){this.stopMove()},Element.prototype.onMoving=function(){var t=this.roomService.now();if(t-(this.mMoveData.tweenLastUpdate||0)>=50){var e=0;this.model&&this.model.pos&&(e=this.model.pos.depth?this.model.pos.depth:0),this.setDepth(e),this.mMoveData.tweenLastUpdate=t,this.updateBubble(),this.mDisplay&&this.mDisplay.emit("posChange",this.scene),this.mBlockable&&this.roomService.updateBlockObject(this)}},Object.defineProperty(Element.prototype,"offsetY",{get:function(){if(void 0===this.mOffsetY){if(!this.mElementManager||!this.mElementManager.roomService||!this.mElementManager.roomService.roomSize)return 0;this.mOffsetY=this.mElementManager.roomService.roomSize.tileHeight>>2}return 0},enumerable:!1,configurable:!0}),Element.prototype.onCheckDirection=function(t){if("number"==typeof t){var e=this.calculateDirectionByAngle(t);-1!==e&&this.setDirection(e)}},Element.prototype.calculateDirectionByAngle=function(t){return t>90?3:t>=0?5:t>=-90?7:1},Element}(m.a)},function(t,e,i){"use strict";var callback=function(t){t.stopPropagation()},input_StopPropagationTouchEvents=function(t){t.addEventListener("touchstart",callback,!1),t.addEventListener("touchmove",callback,!1),t.addEventListener("touchend",callback,!1),t.addEventListener("mousedown",callback,!1),t.addEventListener("mouseup",callback,!1),t.addEventListener("mousemove",callback,!1)};const n=Phaser.GameObjects.DOMElement,o=Phaser.Utils.Objects.IsPlainObject,a=Phaser.Utils.Objects.GetValue;const s={id:["id",void 0],text:["value",void 0],placeholder:["placeholder",void 0],tooltip:["title",void 0],readOnly:["readonly",!1],spellCheck:["spellcheck",!1],autoComplete:["autocomplete","off"]},h={align:["textAlign",void 0],width:["width",void 0],height:["height",void 0],fontFamily:["fontFamily",void 0],fontSize:["font-size",void 0],color:["color","#ffffff"],backgroundColor:["backgroundColor","transparent"],borderColor:["borderColor","transparent"],outline:["outline","none"]},l={textchange:"oninput",click:"onclick",dblclick:"ondblclick",focus:"onfocus",blur:"onblur"};e.a=class InputText_InputText extends n{constructor(t,e,i,n,c,p){o(e)?(e=a(p=e,"x",0),i=a(p,"y",0),n=a(p,"width",void 0),c=a(p,"height",void 0)):o(n)&&(n=a(p=n,"width",void 0),c=a(p,"height",void 0)),void 0===p&&(p={});var u,m=t.scale.autoRound;void 0!==n&&(m&&(n=Math.floor(n)),p.width=n+"px"),void 0!==c&&(m&&(c=Math.floor(c)),p.height=c+"px");var d,f,y=a(p,"type","text");for(var g in"textarea"===y?(u=document.createElement("textarea")).style.resize="none":(u=document.createElement("input")).type=y,s)d=s[g],void 0!==(f=a(p,g,d[1]))&&(u[d[0]]=f);var _,v,b=a(p,"style",void 0);for(var g in void 0===b&&(b={}),h)_=h[g],void 0!==(v=a(p,g,_[1]))&&(b[_[0]]=v);var P=u.style;for(var g in p)g in s||g in h||g in P&&(b[g]=p[g]);b["box-sizing"]="border-box",super(t,e,i,u,b),this.type="rexInputText";for(let t in l)this.node[l[t]]=function(){this.emit(t,this)}.bind(this);input_StopPropagationTouchEvents(this.node)}resize(t,e){var i=this.node.style;return i.width=t+"px",i.height=e+"px",this.updateSize(),this}get text(){return this.node.value}set text(t){this.node.value=t}setText(t){return this.text=t,this}selectText(){return this.node.select(),this}get placeholder(){return this.node.placeholder}set placeholder(t){this.node.placeholder=t}setPlaceholder(t){return this.placeholder=t,this}get tooltip(){return this.node.title}set tooltip(t){this.node.title=t}setTooltip(t){return this.tooltip=t,this}setTextChangedCallback(t){return this.onTextChanged=t,this}get readOnly(){return this.node.readOnly}set readOnly(t){this.node.readOnly=t}setReadOnly(t){return void 0===t&&(t=!0),this.readOnly=t,this}get spellCheck(){return this.node.spellcheck}set spellCheck(t){this.node.spellcheck=t}setSpellCheck(t){return this.spellCheck=t,this}setStyle(t,e){return this.node.style[t]=e,this}getStyle(t){return this.node.style[t]}scrollToBottom(){return this.node.scrollTop=this.node.scrollHeight,this}setEnabled(t){return void 0===t&&(t=!0),this.node.disabled=!t,this}setBlur(){return this.node.blur(),this}setFocus(){return this.node.focus(),this}}},,function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return c}));var n,o,a,s=i(29),h=i(60),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t.Normal="normal",t.Over="over",t.Select="select",t.Disable="disable"}(o||(o={})),a||(a={});Phaser.Utils.Objects.GetValue;var c=function(t){function Button(e,i,n,o,a,s,h,l,c){var p=t.call(this,e)||this;return p.mDownTime=0,p.mPressDelay=1e3,p.mIsMove=!1,p.dpr=h||1,p.scale=l||1,p.soundGroup={up:{key:"click"}},Object.assign(p.soundGroup,s),p.ninePatchConfig=c,p.mKey=i,p.mFrame=n,p.mDownFrame=o,p.createBackground(),a&&(p.mText=p.scene.make.text(void 0,!1).setOrigin(.5,.5).setText(a).setSize(p.mBackground.width,p.mBackground.height),p.add(p.mText)),p.setInteractive(),p.addListen(),p}return l(Button,t),Object.defineProperty(Button.prototype,"background",{get:function(){return this.mBackground},enumerable:!1,configurable:!0}),Object.defineProperty(Button.prototype,"text",{get:function(){return this.mText},enumerable:!1,configurable:!0}),Button.prototype.addListen=function(){this.removeListen(),this.on("pointerdown",this.onPointerDownHandler,this),this.on("pointerup",this.onPointerUpHandler,this),this.on("pointermove",this.onPointerMoveHandler,this)},Button.prototype.removeListen=function(){this.off("pointerdown",this.onPointerDownHandler,this),this.off("pointerup",this.onPointerUpHandler,this),this.off("pointermove",this.onPointerMoveHandler,this)},Button.prototype.mute=function(t){this.silent=t},Button.prototype.changeNormal=function(){this.setBgFrame(this.mFrame)},Button.prototype.changeDown=function(){this.mDownFrame&&this.setBgFrame(this.mDownFrame)},Button.prototype.setFrame=function(t){this.mBackground&&this.setBgFrame(t)},Button.prototype.setText=function(t){this.mText&&this.mText.setText(t)},Button.prototype.setTextStyle=function(t){this.mText&&this.mText.setStyle(t)},Button.prototype.setFontStyle=function(t){this.mText&&this.mText.setFontStyle(t)},Button.prototype.setTextOffset=function(t,e){this.mText&&this.mText.setPosition(t,e)},Button.prototype.setTextColor=function(t){this.mText&&this.mText.setColor(t)},Button.prototype.createBackground=function(){this.mBackground=this.scene.make.image({key:this.mKey,frame:this.mFrame},!1),this.setSize(this.mBackground.width,this.mBackground.height),this.add(this.mBackground)},Button.prototype.setBgFrame=function(t){this.mBackground.setFrame(t),this.setSize(this.mBackground.width,this.mBackground.height)},Button.prototype.buttonStateChange=function(t){switch(t){case o.Normal:this.changeNormal();break;case o.Over:break;case o.Select:this.changeDown();break;case o.Disable:}},Button.prototype.onPointerMoveHandler=function(t){this.soundGroup&&this.soundGroup.move&&this.playSound(this.soundGroup.move),this.interactiveBoo&&(this.mIsMove=!0,this.emit(h.a.MouseEvent.Move))},Button.prototype.onPointerUpHandler=function(t){this.interactiveBoo?(this.buttonStateChange(o.Normal),(!this.mIsMove||Date.now()-this.mDownTime>this.mPressTime)&&Math.abs(t.downX-t.upX)<30&&Math.abs(t.downY-t.upY)<30&&(this.soundGroup&&this.soundGroup.up&&this.playSound(this.soundGroup.up),this.emit(h.a.MouseEvent.Tap,t,this)),clearTimeout(this.mPressDelay),this.mIsMove=!1,this.mDownTime=0):this.soundGroup&&this.soundGroup.disabled&&this.playSound(this.soundGroup.disabled)},Button.prototype.onPointerDownHandler=function(t){var e=this;this.interactiveBoo?(this.soundGroup&&this.soundGroup.down&&this.playSound(this.soundGroup.down),this.buttonStateChange(o.Select),this.mDownTime=Date.now(),this.mPressTime=setTimeout((function(){e.emit(h.a.MouseEvent.Hold,e)}),this.mPressTime),this.emit(h.a.MouseEvent.Down,this)):this.soundGroup&&this.soundGroup.disabled&&this.playSound(this.soundGroup.disabled)},Button}(s.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"IconBtn",(function(){return h}));var n,o=i(14),a=i(5),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function IconBtn(e,i,n){var o=t.call(this,e)||this;return o.mScene=e,o.mWorld=i,o.mBtnBg=e.make.image(void 0,!1),o.mBgResKey=n.bgResKey,o.mBgTexture=n.bgTextures,o.mData=n,!o.mScene.textures.exists(o.mBgResKey)&&n.pngUrl&&n.jsonUrl?(o.mScene.load.atlas(n.key,a.h.getRes(n.pngUrl),a.h.getRes(n.jsonUrl)),o.mScene.load.once(Phaser.Loader.Events.COMPLETE,o.loadComplete,o),o.mScene.load.start(),o):(o.loadComplete(),o)}return s(IconBtn,t),IconBtn.prototype.getKey=function(){return this.mData.key},IconBtn.prototype.setPos=function(t,e){this.mBasePos||(this.mBasePos=new o.a),this.mBasePos.x=t,this.mBasePos.y=e},IconBtn.prototype.getPos=function(){return this.mBasePos},IconBtn.prototype.setBtnData=function(t){this.mBtnData=t},IconBtn.prototype.getBtnData=function(){return this.mBtnData},IconBtn.prototype.setClick=function(t){this.monClick=t},IconBtn.prototype.destroy=function(){this.mBtnBg&&this.mBtnBg.destroy(!0),this.mBtnIcon&&this.mBtnIcon.destroy(!0),this.monClick=null,this.mBtnBg=null,this.mBtnIcon=null,this.mBtnData=null,this.mScene=null,t.prototype.destroy.call(this)},IconBtn.prototype.loadComplete=function(){this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[0]),this.mBtnBg.scaleX=this.mBtnBg.scaleY=this.mData.scale,this.addAt(this.mBtnBg,0),this.mData.iconResKey&&this.mData.iconTexture&&this.mData.iconTexture.length>0&&(this.mBtnIcon=this.mScene.make.image(void 0,!1),this.mBtnIcon.setTexture(this.mData.iconResKey,this.mData.iconTexture),this.add(this.mBtnIcon)),this.setSize(this.mBtnBg.width,this.mBtnBg.height),this.setInteractive(),this.on("pointerup",this.upHandler,this),this.on("pointerdown",this.downHandler,this),this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this)},IconBtn.prototype.overHandler=function(t){this.mBgTexture.length<2||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[1])},IconBtn.prototype.outHandler=function(t){this.mBgTexture.length<2||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[0])},IconBtn.prototype.upHandler=function(){this.monClick&&this.monClick(),this.mData&&this.mData.callBack&&this.mData.callBack.apply(this),this.emit("click",this),this.mBgTexture.length<3||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[2])},IconBtn.prototype.downHandler=function(){this.mBgTexture.length<4||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[3])},IconBtn.prototype.scaleHandler=function(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1},IconBtn}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"UIMediatorType",(function(){return n}));var n=function(){function UIMediatorType(){}return UIMediatorType.BagMediator="BagMediator",UIMediatorType.ChatMediator="ChatMediator",UIMediatorType.NOTICE="Notice",UIMediatorType.DIALOGO="DIALOGO",UIMediatorType.Turn_Btn_Top="Turn_Btn_Top",UIMediatorType.Turn_Btn_Bottom="Turn_Btn_Bottom",UIMediatorType.App_Back="App_Back",UIMediatorType.Editor_Save="Editor_Save",UIMediatorType.Editor_Cancel="Editor_Cancel",UIMediatorType.Close_Btn="Close_Btn",UIMediatorType.ControlF="ControlF",UIMediatorType.Storage="Storage",UIMediatorType.UserInfo="UserInfo",UIMediatorType.UserMenu="UserMenu",UIMediatorType.MessageBox="MessageBox",UIMediatorType.ComponentRank="ComponentRank",UIMediatorType.Rank="Rank",UIMediatorType.VoteResult="VoteResult",UIMediatorType.Shop="Shop",UIMediatorType.MineSettle="MineSettle",UIMediatorType.EquipUpgrade="EquipUpgrade",UIMediatorType}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i(14),o=i(79),a=i(3),s=i(80),h=i(124),l=i(122),c=i(8),p=i(22),u=function(){function Sprite(t,e){if(this.mID=t.id,t.point3f){var i=t.point3f;this.mPos=new n.a(i.x,i.y,i.z)}this.mAttrs=t.attrs,t.avatar&&this.updateAvatar(t.avatar),t.display&&this.updateDisplay(t.display,t.animations,t.currentAnimationName),t.sn&&(this.mSn=t.sn),this.tryRegisterAnimation(t.animationRegistrationMap),this.mCurrentAnimationName=t.currentAnimationName||"idle",this.direction=t.direction||3,this.mNickname=t.nickname,this.mBindID=t.bindId,this.mAlpha=void 0===t.opacity?1:t.opacity/100,this.mDisplayBadgeCards=t.displayBadgeCards,this.mNodeType=e,t.version&&(this.mVersion=t.version),void 0!==t.isMoss&&(this.isMoss=t.isMoss)}return Sprite.prototype.toSprite=function(){var t=a.op_client.Sprite.create();if(t.id=this.id,t.nickname=this.mNickname,this.mDisplayInfo instanceof s.a){t.display=this.mDisplayInfo.display,t.currentAnimationName=this.currentAnimationName;var e=a.op_def.PBPoint3f.create();e.x=this.pos.x,e.y=this.pos.y,e.z=this.pos.z,t.point3f=e,t.animations=this.displayInfo.createProtocolObject()}return t.direction=this.direction,t.bindId=this.bindID,t.sn=this.sn,t.version=this.mVersion,t},Sprite.prototype.newID=function(){this.mID=l.a.genId()},Sprite.prototype.setPosition=function(t,e){this.mPos||(this.mPos=new n.a),this.mPos.x=t,this.mPos.y=e},Sprite.prototype.turn=function(){if(this.mDisplayInfo){var t=this.dirable(this.mCurrentAnimationName),e=t.indexOf(this.mDirection);return e>-1?this.direction=t[(e+1)%t.length]:c.a.getInstance().error(Sprite.name+": error dir "+this.mDirection),this}},Sprite.prototype.updateAvatar=function(t){this.mDisplayInfo&&this.mDisplayInfo.destroy(),this.mAvatar={id:t.id},this.mAvatar=Object.assign(this.mAvatar,t),this.mDisplayInfo=new o.a(this)},Sprite.prototype.updateDisplay=function(t,e,i){if(t&&e&&(this.mDisplayInfo&&this.mDisplayInfo.destroy(),t)){for(var n=[],o=0,a=e;o<a.length;o++){var l=a[o];n.push(new h.a(l))}i=i||this.mCurrentAnimationName||"",this.mDisplayInfo=new s.a({animations:{defaultAnimationName:i,display:t,animationData:n}}),i&&(this.currentAnimationName=i)}},Sprite.prototype.setAnimationQueue=function(t){this.mAnimationQueue=t},Sprite.prototype.updateAttr=function(t){this.mAttrs=t},Sprite.prototype.setAnimationName=function(t){return this.mDisplayInfo&&(this.mDisplayInfo.animationName=t),this.mCurrentAnimationName=t,this.setAnimationData(t,this.direction)},Object.defineProperty(Sprite.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"pos",{get:function(){return this.mPos},set:function(t){this.mPos=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"avatar",{get:function(){return this.mAvatar},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentAnimationName",{get:function(){return this.mCurrentAnimationName},set:function(t){this.mDisplayInfo&&(this.mDisplayInfo.animationName=t),this.mCurrentAnimationName=t,this.setAnimationData(t,this.direction)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"direction",{get:function(){return this.mDirection},set:function(t){this.mDirection=t,this.mDisplayInfo&&this.setAnimationData(this.mCurrentAnimationName,t)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"nickname",{get:function(){return this.mNickname},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"bindID",{get:function(){return this.mBindID},set:function(t){this.mBindID=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"sn",{get:function(){return this.mSn},set:function(t){this.mSn=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"alpha",{get:function(){return this.mAlpha},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"package",{get:function(){return this.mPackage},set:function(t){this.mPackage=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"sceneId",{get:function(){return this.mSceneId},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"uuid",{get:function(){return this.mUuid},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"displayBadgeCards",{get:function(){return this.mDisplayBadgeCards},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"platformId",{get:function(){return this.mPlatformId},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"displayInfo",{get:function(){return this.mDisplayInfo},set:function(t){this.mDisplayInfo=t,this.currentAnimationName&&(this.mDisplayInfo.animationName=this.currentAnimationName,this.setAnimationData(this.currentAnimationName,this.direction))},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"isMoss",{get:function(){return this.mIsMoss},set:function(t){this.mIsMoss=t},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"animationQueue",{get:function(){return this.mAnimationQueue},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"nodeType",{get:function(){return this.mNodeType},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentAnimation",{get:function(){return this.mCurrentAnimation},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentCollisionArea",{get:function(){return this.mCurrentCollisionArea||(this.mCurrentCollisionArea=this.getCollisionArea()),this.mCurrentCollisionArea},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentWalkableArea",{get:function(){return this.mCurrentWalkableArea||(this.mCurrentWalkableArea=this.getWalkableArea()),this.mCurrentWalkableArea},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentCollisionPoint",{get:function(){return this.mCurrentCollisionPoint||(this.mCurrentCollisionPoint=this.getOriginPoint()),this.mCurrentCollisionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"hasInteractive",{get:function(){if(!this.mDisplayInfo||!this.mCurrentAnimation)return!1;var t=this.mCurrentAnimation.animationName,e=this.mDisplayInfo.getInteractiveArea(t);return!!(e&&e.length>0)},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"animationMap",{get:function(){return this.mRegisterAnimation||(this.mRegisterAnimation=new Map),this.mRegisterAnimation},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"originCollisionPoint",{get:function(){return this._originCollisionPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"originWalkPoint",{get:function(){return this._originWalkPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Sprite.prototype,"attrs",{get:function(){return this.mAttrs},enumerable:!1,configurable:!0}),Sprite.prototype.setOriginCollisionPoint=function(t){void 0===this._originCollisionPoint&&(this._originCollisionPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originCollisionPoint.x=t[0],this._originCollisionPoint.y=t[1])},Sprite.prototype.setOriginWalkPoint=function(t){void 0===this._originWalkPoint&&(this._originWalkPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originWalkPoint.x=t[0],this._originWalkPoint.y=t[1])},Sprite.prototype.getInteracviveArea=function(){if(this.mDisplayInfo&&this.mCurrentAnimation){var t=this.mCurrentAnimation.animationName;return this.mDisplayInfo.getInteractiveArea(t)}},Sprite.prototype.setAnimationData=function(t,e){if(this.displayInfo){var i=t.split("_")[0];return this.mRegisterAnimation&&this.mRegisterAnimation.has(i)&&(i=this.mRegisterAnimation.get(i)),this.mCurrentAnimation=this.displayInfo.findAnimation(i,e),this.mAnimationQueue&&this.mAnimationQueue.length>0&&(this.mCurrentAnimation.playingQueue=this.mAnimationQueue[0]),this.mCurrentCollisionArea&&this.setArea(),this.mCurrentAnimation}},Sprite.prototype.checkDirectionAnimation=function(t,e){var i=t+"_"+e;return this.mDisplayInfo.existAnimation(i)?i:null},Sprite.prototype.setArea=function(){this.mCurrentCollisionArea=this.getCollisionArea(),this.mCurrentWalkableArea=this.getWalkableArea(),this.mCurrentCollisionPoint=this.getOriginPoint()},Sprite.prototype.getCollisionArea=function(){if(this.mDisplayInfo&&this.mCurrentAnimation){var t=this.mCurrentAnimation,e=t.animationName,i=t.flip;return this.mDisplayInfo.getCollisionArea(e,i)}},Sprite.prototype.getWalkableArea=function(){if(this.mDisplayInfo&&this.mCurrentAnimation){var t=this.mCurrentAnimation,e=t.animationName,i=t.flip;return this.mDisplayInfo.getWalkableArea(e,i)}},Sprite.prototype.getOriginPoint=function(){if(this.mDisplayInfo&&this.mCurrentAnimation){var t=this.mCurrentAnimation,e=t.animationName,i=t.flip;return this.mDisplayInfo.getOriginPoint(e,i)}},Sprite.prototype.dirable=function(t){var e=t.split("_")[0],i=[3,5];return this.checkDirectionAnimation(e,p.a.east_north)&&i.push(7,1),i},Sprite.prototype.tryRegisterAnimation=function(t){if(t&&!(t.length<1)){this.mRegisterAnimation=new Map;for(var e=0,i=t;e<i.length;e++){var n=i[e];this.mRegisterAnimation.set(n.key,n.value)}}},Sprite}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function BaseUI(e,i,n){var o=t.call(this,e)||this;return o.silent=!1,o.dpr=1,o.mInitialized=!1,o.interactiveBoo=!1,o.mShow=!1,o.dpr=i||1,o.scale=n||1,o.soundMap=new Map,o.disInteractive(),o}return o(BaseUI,t),BaseUI.prototype.setFollow=function(t,e,i){this.mFollow=t,this.mFroscene=e,i&&(this.posFunc=i)},BaseUI.prototype.updatePos=function(){if(this.mShow)if(this.posFunc)this.posFunc({scene:this.mFroscene,followX:this.mFollow.x,followY:this.mFollow.y,baseX:this.x,baseY:this.y});else{var t=this.mFroscene.cameras.main,e=this.x-t.scrollX,i=this.y-t.scrollY;this.x=e,this.y=i}},BaseUI.prototype.setInteractive=function(e,i,n){return this.interactiveBoo=!0,t.prototype.setInteractive.call(this,e,i,n),this},BaseUI.prototype.disInteractive=function(){this.interactiveBoo=!1,t.prototype.disableInteractive.call(this)},BaseUI.prototype.addListen=function(){},BaseUI.prototype.removeListen=function(){},BaseUI.prototype.playSound=function(t){if(!this.silent){var e=t.key;this.scene.cache.audio.exists(e)&&this.startPlay(t)}},BaseUI.prototype.startPlay=function(t){if(!this.silent){var e=t.key,i=this.soundMap.get(e);i||(i=this.scene.sound.add(e,t.soundConfig),this.soundMap.set(e,i)),i.isPlaying||i.play()}},BaseUI.prototype.stopSound=function(){this.silent||this.soundMap.forEach((function(t){t.isPlaying&&t.stop()}))},BaseUI.prototype.pauseSound=function(){this.silent||this.soundMap.forEach((function(t){t.isPaused||t.pause()}))},BaseUI.prototype.resumeSound=function(){this.silent||this.soundMap.forEach((function(t){t.isPaused&&t.resume()}))},BaseUI.prototype.setSilent=function(t){this.silent=t},BaseUI.prototype.destroy=function(){this.soundMap.forEach((function(t){t.isPlaying&&t.stop()})),this.mInitialized=!1,this.interactiveBoo=!1,this.silent=!1,this.removeListen(),t.prototype.destroy.call(this)},BaseUI.prototype.checkPointerDelection=function(t){return!this.scene||(Math.abs(t.downX-t.upX)<10*this.dpr*this.scale||Math.abs(t.downY-t.upY)<10*this.dpr*this.scale)},BaseUI}(Phaser.GameObjects.Container)},,function(t,e,i){"use strict";i.d(e,"b",(function(){return initLocales})),i.d(e,"a",(function(){return s}));var n=i(436),o=i(422),a=i(423);function initLocales(t){return n.a.use(o.a).use(a.a).init({fallbackLng:"en",backend:{loadPath:t,crossDomain:!0}})}var s=n.a},function(t,e,i){"use strict";var n=i(106),o=i(15),sizer_GetChildrenWidth=function(t){if(this.rexSizer.hidden)return 0;void 0===t&&(t=!0);var e,i,n,a=0,s=this.sizerChildren;if(0===this.orientation)for(var h=0,l=s.length;h<l;h++)(e=s[h]).rexSizer.hidden||(n=0===e.rexSizer.proportion||t&&!e.isRexSpace&&e.rexSizer.proportion>0?e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):Object(o.b)(e):0,a+=n+=(i=e.rexSizer.padding).left+i.right);else for(h=0,l=s.length;h<l;h++)(e=s[h]).hasOwnProperty("rexSizer")&&(e.rexSizer.hidden||(n=e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):Object(o.b)(e),n+=(i=e.rexSizer.padding).left+i.right,a=Math.max(n,a)));return a},sizer_GetChildrenHeight=function(t){if(this.rexSizer.hidden)return 0;void 0===t&&(t=!0);var e,i,n,a=0,s=this.sizerChildren;if(0===this.orientation)for(var h=0,l=s.length;h<l;h++)(e=s[h]).rexSizer.hidden||(n=e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):Object(o.a)(e),n+=(i=e.rexSizer.padding).top+i.bottom,a=Math.max(n,a));else for(h=0,l=s.length;h<l;h++)(e=s[h]).hasOwnProperty("rexSizer")&&(e.rexSizer.hidden||(n=0===e.rexSizer.proportion||t&&!e.isRexSpace&&e.rexSizer.proportion>0?e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):Object(o.a)(e):0,a+=n+=(i=e.rexSizer.padding).top+i.bottom));return a},sizer_GetChildrenProportion=function(){for(var t,e,i=0,n=this.sizerChildren,o=0,a=n.length;o<a;o++)(t=n[o]).rexSizer.hidden||(e=t.rexSizer.proportion)>0&&(i+=e);return i},sizer_GetChildrenSizers=function(t){void 0===t&&(t=[]);for(var e,i=this.sizerChildren,n=0,o=i.length;n<o;n++)(e=i[n]).isRexSizer&&t.push(e);return t},sizer_GetExpandedChildWidth=function(t,e){var i,n=e.rexSizer,o=n.padding;return 0===t.orientation?n.proportion>0&&t.proportionLength>0&&(i=n.proportion*t.proportionLength):n.expand&&(i=t.width-o.left-o.right),i},sizer_GetExpandedChildHeight=function(t,e){var i,n=e.rexSizer,o=n.padding;return 0===t.orientation?n.expand&&(i=t.height-o.top-o.bottom):n.proportion>0&&t.proportionLength>0&&(i=n.proportion*t.proportionLength),i},a=i(38),s=i(65),h=i(43),l={getChildrenWidth:sizer_GetChildrenWidth,getChildrenHeight:sizer_GetChildrenHeight,getChildrenProportion:sizer_GetChildrenProportion,getChildrenSizers:sizer_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var n;if(this.preLayout(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i),this.childrenProportion>0){var l=0===this.orientation?this.width-this.childrenWidth:this.height-this.childrenHeight;n=l>0?(l=0===this.orientation?this.width-this.getChildrenWidth(!1):this.height-this.getChildrenHeight(!1))/this.childrenProportion:0}else n=0;this.proportionLength=n;for(var c,p,u,m,d,f,y,g,_,v=this.sizerChildren,b=this.left,P=this.top,S=0,w=v.length;S<w;S++)(c=v[S]).rexSizer.hidden||(u=(p=c.rexSizer).padding,g=sizer_GetExpandedChildWidth(this,c),_=sizer_GetExpandedChildHeight(this,c),c.isRexSizer?c.layout(this,g,_):Object(a.a)(c,g,_),void 0===g&&(g=Object(o.b)(c)),void 0===_&&(_=Object(o.a)(c)),0===this.orientation?(m=b+u.left,f=0===p.proportion||0===n?g:p.proportion*n,d=P+u.top,y=this.height-u.top-u.bottom):(m=b+u.left,f=this.width-u.left-u.right,d=P+u.top,y=0===p.proportion||0===n?_:p.proportion*n),s.a.setPosition(m,d).setSize(f,y),Object(h.a)(c,s.a,p.align),this.resetChildPositionState(c),0===this.orientation?b+=f+u.left+u.right:P+=y+u.top+u.bottom);return this.layoutBackgrounds(),this.postLayout()},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0,this._childrenProportion=void 0}},c=i(142),p={x:0,h:0,horizontal:0,"left-to-right":0,y:1,v:1,vertical:1,"top-to-bottom":1},u=i(140),utils_Space=function(t){var e=t.add.zone(0,0,1,1);return e.isRexSpace=!0,e};const m=Phaser.Utils.Objects.IsPlainObject,d=Phaser.Utils.Objects.GetValue,f=Phaser.Utils.Array.Remove,y=Phaser.Display.Align.CENTER;class Sizer_Sizer extends n.a{constructor(t,e,i,n,o,a,s){m(e)?(e=d(s=e,"x",0),i=d(s,"y",0),n=d(s,"width",void 0),o=d(s,"height",void 0)):m(n)?(n=d(s=n,"width",void 0),o=d(s,"height",void 0)):m(a)&&(s=a),void 0!==s&&(a=d(s,"orientation",0)),void 0===a&&(a=0),super(t,e,i,n,o,s),this.type="rexSizer",this.sizerChildren=[],this.setOrientation(a)}destroy(t){this.scene&&(this.sizerChildren.length=0,super.destroy(t))}setOrientation(t){return"string"==typeof t&&(t=p[t]),this.orientation=t,this}add(t,e,i,n,o,a){super.add(t);var s=typeof e;if(null===e)return this;if("number"===s);else if("string"===s)e=g[e];else if(m(e)){var h;e=d(h=e,"proportion",0),i=d(h,"align",y),n=d(h,"padding",0),o=d(h,"expand",!1),a=d(h,"key",void 0)}return"string"==typeof i&&(i=u.a[i]),void 0===e&&(e=0),void 0===i&&(i=y),void 0===n&&(n=0),void 0===o&&(o=!1),(h=this.getSizerConfig(t)).parent=this,h.proportion=e,h.align=i,h.padding=Object(c.a)(n),h.expand=o,this.sizerChildren.push(t),void 0!==a&&this.addChildrenMap(a,t),this}addSpace(t){return void 0===t&&(t=1),this.add(utils_Space(this.scene),t),this}insert(t,e,i,n,o,a){return this.add(e,i,n,o,a),this.moveTo(e,t),this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this||(e.parent=void 0,f(this.sizerChildren,t),super.remove(t)),this}clear(t){for(var e=0,i=this.sizerChildren.length;e<i;e++)this.getSizerConfig(this.sizerChildren[e]).parent=void 0;return this.sizerChildren.length=0,super.clear(t),this}get childrenProportion(){return void 0===this._childrenProportion&&(this._childrenProportion=this.getChildrenProportion()),this._childrenProportion}}Object.assign(Sizer_Sizer.prototype,l);const g={min:0,full:-1};e.a=Sizer_Sizer},function(t,e,i){"use strict";var n=i(246),o=i(107),textarea_InjectProperties=function(t){Object.defineProperty(t,"childOY",{configurable:!0,get:function(){return t.textOY},set:function(e){t.textOY=e}}),Object.defineProperty(t,"topChildOY",{get:function(){return t.topTextOY}}),Object.defineProperty(t,"bottomChildOY",{get:function(){return t.bottomTextOY}})},textarea_SetText=function(t){return this.childrenMap.child.setText(t),this.resizeController(),this},textarea_AppendText=function(t){return this.setText(this.text+t),this};const a=Phaser.Utils.Objects.GetValue;class TextArea_TextArea extends n.a{constructor(t,e){void 0===e&&(e={});var i=a(e,"text",void 0),n=a(e,"textWidth",void 0),s=a(e,"textHeight",void 0),h=a(e,"textMask",!0),l=a(e,"content",""),c=new o.a(t,{width:n,height:s,text:i,textMask:h,content:l,clamplTextOY:a(e,"clamplChildOY",!1)}),p=void 0===n?1:0,u=void 0===s;textarea_InjectProperties(c),e.scrollMode=0,e.type="rexTextArea",e.child={gameObject:c,proportion:p,expand:u};var m=a(e,"space",void 0);m&&(m.child=m.text),super(t,e),this.addChildrenMap("text",i)}get text(){return this.childrenMap.child.text}get linesCount(){return this.childrenMap.child.linesCount}}var s={setText:textarea_SetText,appendText:textarea_AppendText};Object.assign(TextArea_TextArea.prototype,s);e.a=TextArea_TextArea},,function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function BasicScene(e){return t.call(this,e)||this}return o(BasicScene,t),BasicScene.prototype.setViewPort=function(t,e,i,n){this.cameras.main.setViewport(t,e,i,n)},BasicScene}(Phaser.Scene)},,function(t,e,i){"use strict";e.a={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){return this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown(),this},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(t){return this._eventEmitter&&t&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}}},function(t,e,i){"use strict";e.a=function(t,e,i){!t||void 0===e&&void 0===i||(t.resize?(void 0===e&&(e=t.width),void 0===i&&(i=t.height),t.resize(e,i)):(void 0!==e&&(t.displayWidth=e),void 0!==i&&(t.displayHeight=i)))}},function(t,e,i){"use strict";i.r(e),i.d(e,"DragType",(function(){return o})),i.d(e,"DropType",(function(){return a})),i.d(e,"BagMediator",(function(){return d}));var n,o,a,s=i(13),h=i(8),l=i(152),c=i(23),p=i(7),u=i(18),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.DRAG_TYPE_SHORTCUT=1]="DRAG_TYPE_SHORTCUT",t[t.DRAG_TYPE_BAG=2]="DRAG_TYPE_BAG"}(o||(o={})),function(t){t[t.DROP_TYPE_SHORTCUT=1]="DROP_TYPE_SHORTCUT",t[t.DROP_TYPE_BAG=2]="DROP_TYPE_BAG"}(a||(a={}));var d=function(t){function BagMediator(e,i,n){var o=t.call(this)||this;return o.mPageNum=0,o.mLayerManager=e,o.world=i,o.mScene=n,o.mUIType=u.a.Normal,o}return m(BagMediator,t),BagMediator.prototype.resize=function(t,e){this.mView&&this.mView.resize(t,e)},BagMediator.prototype.isSceneUI=function(){return!1},BagMediator.prototype.isShow=function(){if(this.mView)return this.mView.isShow()},BagMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView||(this.mView=new l.BagPanel(this.mScene,this.world)),this.world.emitter.on(s.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.emitter.on(s.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.emitter.on(s.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mScene.input.on("gameobjectdown",this.onBtnHandler,this),e?this.world.roomManager.currentRoom.playerManager.actor.getBag().requestVirtualWorldQueryPackage(e[0].id,1,l.BagPanel.PageMaxCount):this.world.roomManager.currentRoom.playerManager.actor.getBag().requestVirtualWorldQueryPackage(this.world.roomManager.currentRoom.playerManager.actor.package.id,1,l.BagPanel.PageMaxCount),this.mView.show(e),this.mLayerManager.addToUILayer(this.mView),this.world.uiManager.checkUIState(BagMediator.NAME,!1),this.refrehView(),t.prototype.show.call(this,e))},BagMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},BagMediator.prototype.hide=function(){this.world.emitter.off(s.a.DRAG_TO_DROP,this.handleDrop,this),this.world.emitter.off(s.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.emitter.off(s.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.emitter.off(s.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),this.mView&&(this.mView.hide(),this.mView=null,this.world.uiManager.checkUIState(BagMediator.NAME,!0))},BagMediator.prototype.destroy=function(){this.world.emitter.off(s.a.DRAG_TO_DROP,this.handleDrop,this),this.world.emitter.off(s.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.emitter.off(s.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.emitter.off(s.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),this.mView&&(this.mView.destroy(),this.mView=null),this.mPageNum=0,this.mScene=null,this.world=null},BagMediator.prototype.handleDrop=function(t){var e=t[0];t[1].getDropType()===a.DROP_TYPE_BAG&&e.getDragType()===o.DRAG_TYPE_SHORTCUT&&h.a.getInstance().debug("背包拖到快捷栏了！！！")},BagMediator.prototype.refrehView=function(t){var e;if(t)e=t;else{var i=this.world.roomManager.currentRoom.playerManager.actor.package;if(null==i)return;e=i.items}this.setListData(e)},BagMediator.prototype.onBtnHandler=function(t,e){e instanceof c.a||this.mView&&this.mView.setBlur()},BagMediator.prototype.setListData=function(t){this.mView.setDataList()},BagMediator.prototype.handleSynchroPackage=function(){var t=this.world.roomManager.currentRoom.playerManager.actor.package.items;this.refrehView(t)},BagMediator.prototype.onUpdatePackageHandler=function(){var t=this.world.roomManager.currentRoom.playerManager.actor.package.items;this.refrehView(t)},BagMediator.NAME="BagMediator",BagMediator}(p.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemSlot",(function(){return l}));var n=i(3),o=i(69),a=i(4),s=i(5),h=i(90),l=function(){function ItemSlot(t,e,i,n,o,a,s,h,l,c,p){this.minitialize=!1,this.mWid=0,this.mHei=0,this.isTipBoo=!0,this.mScene=t,this.mWorld=e,this.toolTipCon=t.make.container(void 0,!1),this.toolTipCon.x=n,this.toolTipCon.y=o,i.add(this.toolTipCon),this.mResStr=a,this.mResPng=s,this.mResJson=h,this.mResSlot=l,this.mSubScriptRes=p,this.mSelectRes=c}return Object.defineProperty(ItemSlot.prototype,"hasTip",{get:function(){return this.isTipBoo},set:function(t){this.isTipBoo=t},enumerable:!1,configurable:!0}),ItemSlot.prototype.createUI=function(){this.onLoadCompleteHandler()},ItemSlot.prototype.getView=function(){return this.toolTipCon},ItemSlot.prototype.getBg=function(){return this.itemBG},ItemSlot.prototype.getIcon=function(){return this.mIcon},ItemSlot.prototype.dataChange=function(t){var e=this;if(this.minitialize)if(this.mData=t,this.mIcon){var i=void 0;if(this.mData&&this.mData.display){i=this.mData.display.texturePath;this.mData.des&&this.mData.des;this.setToolTipData(this.mData.name+this.mData.des)}else this.mIcon.icon.visible=!1;if(!i)return;this.mScene.textures.exists(s.h.getOsdRes(i))?this.mData&&(this.mIcon.icon.setTexture(s.h.getOsdRes(i)),this.mIcon.icon.visible=!0):this.mIcon.load(i,this,(function(){e.mData&&(e.mIcon.icon.visible=!0)}))}else this.mIcon.icon.visible=!1},ItemSlot.prototype.destroy=function(){this.mSubScriptSprite&&(this.mSubScriptSprite.destroy(!0),this.mSubScriptSprite=null),this.mSelectSprite&&(this.mSelectSprite.destroy(!0),this.mSelectSprite=null),this.mIcon&&this.mIcon.destroy(),this.toolTipCon&&(this.toolTipCon.destroy(),this.toolTipCon=null),this.toolTip&&(this.toolTip.destroy(),this.toolTip=null),this.mAnimationCon&&(this.mAnimationCon.destroy(!0),this.mAnimationCon=null),this.itemBG&&(this.itemBG.destroy(!0),this.itemBG=null),this.index=0,this.mData=null,this.mScene=null,this.mWorld=null,this.mResStr=null,this.mResPng=null,this.mResSlot=null,this.mResJson=null,this.mSubScriptRes=null,this.mSelectRes=null,this.mWorld=null,this.minitialize=!1,this.mWid=0,this.mHei=0,this.mData=null,this.isTipBoo=!0},ItemSlot.prototype.setToolTipData=function(t){this.toolTip&&this.toolTip.setToolTipData(t)},ItemSlot.prototype.onLoadCompleteHandler=function(){this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.toolTipCon.addAt(this.itemBG,0),this.toolTipCon.setSize(this.itemBG.width,this.itemBG.height),this.mIcon=new o.DragDropIcon(this.mScene,0,0),this.toolTipCon.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1),this.isTipBoo&&(this.toolTip=new h.ToolTip(this.mScene,"itemSlotTip",s.h.getRes("ui/toolTip/toolTip.json"),s.h.getRes("ui/toolTip/toolTip.png"),this.mWorld.uiScale)),this.toolTipCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.toolTipCon.on("pointerover",this.overHandler,this),this.toolTipCon.on("pointerout",this.outHandler,this),this.toolTipCon.on("pointerdown",this.downHandler,this),this.toolTipCon.on("pointerup",this.outHandler,this),this.minitialize=!0,this.mData&&this.dataChange(this.mData),this.mWid+=this.itemBG.width,this.mHei+=this.itemBG.height},ItemSlot.prototype.downHandler=function(t){if(this.mData&&this.mWorld.roomManager.currentRoom.playerManager.actor&&this.mWorld.roomManager.currentRoom&&this.mWorld.roomManager.currentRoom.playerManager){var e=this.mWorld.roomManager.currentRoom.playerManager.actor.package,i=new a.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),o=i.content;o.uiId=e.id,o.componentId=this.mData.id,this.mWorld.connection.send(i)}},ItemSlot.prototype.overHandler=function(t){this.toolTip&&this.mData&&(this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this.toolTip),this.toolTip.setToolTipData(this.mData.name+this.mData.des),this.toolTip.x=t.x,this.toolTip.y=t.y),this.mSelectRes&&this.mSelectRes.length>0&&(this.mSelectSprite=this.mScene.make.sprite(void 0,!1),this.mSelectSprite.play(this.mSelectRes),this.toolTipCon.add(this.mSelectSprite))},ItemSlot.prototype.outHandler=function(t){this.toolTip&&this.toolTip.parentContainer&&this.toolTip.parentContainer.remove(this.toolTip),this.mSelectSprite&&this.mSelectSprite.parentContainer&&(this.mSelectSprite.parentContainer.remove(this.mSelectSprite),this.mSelectSprite.destroy(!0),this.mSelectSprite=null)},ItemSlot}()},function(t,e,i){"use strict";i.r(e),i.d(e,"BaseFaceMediator",(function(){return h}));var n,o=i(7),a=i(18),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function BaseFaceMediator(e,i){var n=t.call(this)||this;return n.mScene=i,n.world=e,n.mUIType=a.a.Scene,n}return s(BaseFaceMediator,t),BaseFaceMediator.prototype.getView=function(){return this.mView},BaseFaceMediator.prototype.isSceneUI=function(){return!0},BaseFaceMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},BaseFaceMediator.prototype.resize=function(){var t=this.world.getSize(),e=this.getView();if(this.mView&&e.isShow())return this.mView.resize(t.width,t.height)},BaseFaceMediator.prototype.hide=function(){this.mShow=!1,this.mView&&this.mView.hide()},BaseFaceMediator.prototype.destroy=function(){t.prototype.destroy.call(this)},BaseFaceMediator}(o.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n,o=i(105),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=(Phaser.Utils.Objects.GetValue,function(t){function GameGridTable(e,i){var n=t.call(this)||this;return n.mGridTable=new o.a(e,i),n.mConfig=i,n.addListen(),n}return a(GameGridTable,t),GameGridTable.prototype.adjustScrollMode=function(t){},GameGridTable.prototype.adjustMask=function(t,e,i,n){void 0===t&&(t=this.mConfig.x),void 0===e&&(e=this.mConfig.y),this.mGridTable&&(this.mGridTable.x=t,this.mGridTable.y=e,i===this.mGridTable.width&&n===this.mGridTable.height||this.mGridTable.resize(i,n))},Object.defineProperty(GameGridTable.prototype,"gridTable",{get:function(){return this.mGridTable},enumerable:!1,configurable:!0}),Object.defineProperty(GameGridTable.prototype,"childrenMap",{get:function(){if(this.mGridTable)return this.mGridTable.childrenMap},enumerable:!1,configurable:!0}),Object.defineProperty(GameGridTable.prototype,"table",{get:function(){if(this.mGridTable)return this.mGridTable.getElement("table")},enumerable:!1,configurable:!0}),GameGridTable.prototype.adjustCellHeight=function(t){if(this.mGridTable)for(var e=0,i=this.mGridTable.getCells().length;e<i;e++)this.mGridTable.setCellHeight(e,t)},GameGridTable.prototype.adjusetCellWidth=function(t){if(this.mGridTable)for(var e=0,i=this.mGridTable.getCells().length;e<i;e++)this.mGridTable.setCellWidth(e,t)},Object.defineProperty(GameGridTable.prototype,"items",{get:function(){return this.mGridTable?this.mGridTable.items:null},enumerable:!1,configurable:!0}),GameGridTable.prototype.setItems=function(t){this.mGridTable&&(this.mGridTable.setItems(t),this.mGridTable.layout())},GameGridTable.prototype.setColumnCount=function(t){return this.mGridTable.setColumnCount(t),this},GameGridTable.prototype.getCells=function(){return this.mGridTable.getCells()},GameGridTable.prototype.getCell=function(t){return this.mGridTable.getCell(t,!0)},GameGridTable.prototype.setT=function(t){this.mGridTable&&this.mGridTable.setT(t)},GameGridTable.prototype.addListen=function(){this.mGridTable&&this.mGridTable.on("cell.1tap",this.cellTapHandler,this)},GameGridTable.prototype.removeListen=function(){this.mGridTable&&this.mGridTable.off("cell.1tap",this.cellTapHandler,this)},Object.defineProperty(GameGridTable.prototype,"x",{get:function(){return this.mGridTable?this.mGridTable.x:0},set:function(t){this.mGridTable&&(this.mGridTable.x=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GameGridTable.prototype,"y",{get:function(){return this.mGridTable?this.mGridTable.y:0},set:function(t){this.mGridTable&&(this.mGridTable.y=t)},enumerable:!1,configurable:!0}),GameGridTable.prototype.refresh=function(){this.mGridTable&&this.mGridTable.refresh()},GameGridTable.prototype.layout=function(){this.mGridTable&&this.mGridTable.layout()},GameGridTable.prototype.refreshPos=function(t,e,i,n){this.mGridTable&&(this.mGridTable.x=t,this.mGridTable.y=e,this.table&&void 0!==i&&void 0!==n&&(this.table.tableOX=i,this.table.tableOY=n),this.adjustMask(t,e),this.mGridTable.layout())},GameGridTable.prototype.destroy=function(){this.mGridTable&&(this.removeListen(),this.mGridTable.destroy())},GameGridTable.prototype.cellTapHandler=function(t){this.emit("cellTap",t)},GameGridTable}(Phaser.Events.EventEmitter))},function(t,e,i){"use strict";var n={TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12},o=i(15),bounds_GetBottom=function(t){var e=Object(o.a)(t);return t.y+e-e*t.originY},bounds_GetCenterX=function(t){var e=Object(o.b)(t);return t.x-e*t.originX+.5*e},bounds_SetBottom=function(t,e){var i=Object(o.a)(t);return t.y=e-i+i*t.originY,t},bounds_SetCenterX=function(t,e){var i=Object(o.b)(t),n=i*t.originX;return t.x=e+n-.5*i,t},in_BottomCenter=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_SetCenterX(t,bounds_GetCenterX(e)+i),bounds_SetBottom(t,bounds_GetBottom(e)+n),t},bounds_GetLeft=function(t){var e=Object(o.b)(t);return t.x-e*t.originX},bounds_SetLeft=function(t,e){var i=Object(o.b)(t);return t.x=e+i*t.originX,t},in_BottomLeft=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_SetLeft(t,bounds_GetLeft(e)-i),bounds_SetBottom(t,bounds_GetBottom(e)+n),t},bounds_GetRight=function(t){var e=Object(o.b)(t);return t.x+e-e*t.originX},bounds_SetRight=function(t,e){var i=Object(o.b)(t);return t.x=e-i+i*t.originX,t},in_BottomRight=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_SetRight(t,bounds_GetRight(e)+i),bounds_SetBottom(t,bounds_GetBottom(e)+n),t},bounds_SetCenterY=function(t,e){var i=Object(o.a)(t),n=i*t.originY;return t.y=e+n-.5*i,t},bounds_CenterOn=function(t,e,i){return bounds_SetCenterX(t,e),bounds_SetCenterY(t,i)},bounds_GetCenterY=function(t){var e=Object(o.a)(t);return t.y-e*t.originY+.5*e},in_Center=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_CenterOn(t,bounds_GetCenterX(e)+i,bounds_GetCenterY(e)+n),t},in_LeftCenter=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_SetLeft(t,bounds_GetLeft(e)-i),bounds_SetCenterY(t,bounds_GetCenterY(e)+n),t},in_RightCenter=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_SetRight(t,bounds_GetRight(e)+i),bounds_SetCenterY(t,bounds_GetCenterY(e)+n),t},bounds_GetTop=function(t){var e=Object(o.a)(t);return t.y-e*t.originY},bounds_SetTop=function(t,e){var i=Object(o.a)(t);return t.y=e+i*t.originY,t},in_TopCenter=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_SetCenterX(t,bounds_GetCenterX(e)+i),bounds_SetTop(t,bounds_GetTop(e)-n),t},in_TopLeft=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_SetLeft(t,bounds_GetLeft(e)-i),bounds_SetTop(t,bounds_GetTop(e)-n),t},in_TopRight=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),bounds_SetRight(t,bounds_GetRight(e)+i),bounds_SetTop(t,bounds_GetTop(e)-n),t},a=[];a[n.BOTTOM_CENTER]=in_BottomCenter,a[n.BOTTOM_LEFT]=in_BottomLeft,a[n.BOTTOM_RIGHT]=in_BottomRight,a[n.CENTER]=in_Center,a[n.LEFT_CENTER]=in_LeftCenter,a[n.RIGHT_CENTER]=in_RightCenter,a[n.TOP_CENTER]=in_TopCenter,a[n.TOP_LEFT]=in_TopLeft,a[n.TOP_RIGHT]=in_TopRight;e.a=function(t,e,i,n,o){return a[i](t,e,n,o)}},function(t,e,i){"use strict";var n=i(121),texture_SetTexture=function(t,e,i,o){Object(n.a)(e)&&(o=i,i=e,e=void 0),void 0===e&&(e="__BASE"),this.textureKey=t,this.baseFrameName=e,this.columns.data=i,this.columns.count=i?i.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.rows.data=o,this.rows.count=o?o.length:0,this.rows.stretch=0,this.rows.minHeight=0;var a=this.scene.textures.get(t);if(!a)return this.clear(),this;if(!i||!o)return this.clear(),this;for(var s=a.frames[e],h=s.width,l=0,c=0,p=i.length;c<p;c++)void 0===i[c]?l++:"number"==typeof i[c]?h-=i[c]:h-=i[c].width;var u=h/l,m=s.height,d=0;for(c=0,p=o.length;c<p;c++)void 0===o[c]?d++:"number"==typeof o[c]?m-=o[c]:m-=o[c].width;for(var f,y,g,_,v,b=m/d,P=0,S=0,w=0,T=o.length;w<T;w++){void 0===o[w]&&(o[w]=b),"number"==typeof o[w]&&(o[w]={height:o[w],stretch:w%2}),g=(f=o[w]).height,this.rows.stretch+=0|f.stretch,this.rows.minHeight+=f.stretch>0?0:g,P=0;c=0;for(var C=i.length;c<C;c++)void 0===i[c]&&(i[c]=u),"number"==typeof i[c]&&(i[c]={width:i[c],stretch:c%2}),_=(y=i[c]).width,0===w&&(this.columns.stretch+=0|y.stretch,this.columns.minWidth+=y.stretch>0?0:_),_>=1&&g>=1?(v=this.getFrameNameCallback(c,w,e))&&a.add(v,0,P+s.cutX,S+s.cutY,_,g):console.warn(`Size of Grid(${c},${w}) = ${_}x${g}, which is invalid`),P+=_;S+=g}return this.updateTexture(),this},renderTexture_MakeChildImageGameObject=function(t,e,i){return void 0===i&&(i="image"),t[e]||(t[e]=t.scene.make[i]({add:!1,origin:{x:0,y:0}}),t.on("destroy",(function(){t[e]&&(t[e].destroy(),t[e]=void 0)}))),t[e]},texture_UpdateTexture=function(){if(this.clear(),void 0===this.textureKey)return this;var t=this.scene.textures.get(this.textureKey);if(!t)return this;var e,i,n=this.width-this.columns.minWidth;n>=0?(e=this.columns.stretch>0?n/this.columns.stretch:0,i=1):(e=0,i=this.width/this.columns.minWidth);var o,a,s,h,l,c,p,u=this.height-this.rows.minHeight;u>=0?(o=this.rows.stretch>0?u/this.rows.stretch:0,a=1):(o=0,a=this.height/this.rows.minHeight);for(var m,d=0,f=0,y=0,g=this.rows.count;y<g;y++){p=0===(l=this.rows.data[y]).stretch?l.height*a:o*l.stretch,d=0;for(var _=0,v=this.columns.count;_<v;_++)c=0===(h=this.columns.data[_]).stretch?h.width*i:e*h.stretch,(s=this.getFrameNameCallback(_,y,this.baseFrameName))&&c>0&&p>0&&t.has(s)&&(0===(0===l.stretch&&0===h.stretch||0===this.getStretchMode(_,y)?0:1)?(m=renderTexture_MakeChildImageGameObject(this,"_image","image")).setTexture(this.textureKey,s).setDisplaySize(c,p):(m=renderTexture_MakeChildImageGameObject(this,"_tileSprite","tileSprite")).setTexture(this.textureKey,s).setSize(c,p)),m&&(this.draw(m,d,f),m=void 0),d+=c;f+=p}};const o=Phaser.Utils.Objects.IsPlainObject,a=Phaser.Utils.Objects.GetValue;var parseMode=function(t){return"string"==typeof t&&(t=s[t]),t};const s={scale:0,repeat:1};var utils_IsEdge=function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1},h={setTexture:texture_SetTexture,updateTexture:texture_UpdateTexture,setStretchMode:function(t){return o(t)?(this.stretchMode.edge=parseMode(a(t,"edge",0)),this.stretchMode.internal=parseMode(a(t,"internal",0))):(t=parseMode(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return utils_IsEdge.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal}};var DefaultGetFrameNameCallback=function(t,e,i){return"__BASE"===i?`${t},${e}`:`${i}_${t},${e}`};const l=Phaser.GameObjects.RenderTexture,c=Phaser.Utils.Objects.IsPlainObject,p=Phaser.Utils.Objects.GetValue;class NinePatch_NinePatch extends l{constructor(t,e,i,o,a,s,h,l,u,m){c(e)?(e=p(m=e,"x",0),i=p(m,"y",0),o=p(m,"width",1),a=p(m,"height",1),s=p(m,"key",void 0),h=p(m,"baseFrame",void 0),l=p(m,"columns",void 0),u=p(m,"rows",void 0)):c(o)?(o=p(m=o,"width",1),a=p(m,"height",1),s=p(m,"key",void 0),h=p(m,"baseFrame",void 0),l=p(m,"columns",void 0),u=p(m,"rows",void 0)):c(s)?(s=p(m=s,"key",void 0),h=p(m,"baseFrame",void 0),l=p(m,"columns",void 0),u=p(m,"rows",void 0)):c(h)?(h=p(m=h,"baseFrame",void 0),l=p(m,"columns",void 0),u=p(m,"rows",void 0)):Object(n.a)(h)?(m=u,u=l,l=h,h=p(m,"baseFrame",void 0)):c(l)&&(l=p(m=l,"columns",void 0),u=p(m,"rows",void 0)),super(t,e,i,o,a),this.columns={},this.rows={},this.stretchMode={},this._tileSprite=void 0,this._image=void 0,this.setOrigin(.5,.5),this.setGetFrameNameCallback(p(m,"getFrameNameCallback",void 0)),this.setStretchMode(p(m,"stretchMode",0)),this.setTexture(s,h,l,u)}setGetFrameNameCallback(t){return void 0===t&&(t=DefaultGetFrameNameCallback),this.getFrameNameCallback=t,this}get minWidth(){return this.columns.minWidth}get minHeight(){return this.rows.minHeight}resize(t,e){return this.width===t&&this.height===e||(super.resize(t,e),this.updateTexture()),this}}Object.assign(NinePatch_NinePatch.prototype,h);e.a=NinePatch_NinePatch},function(t,e,i){"use strict";var n=i(37),o=i(285),a=i.n(o);class FSM_FSM{constructor(t){var e=a()(t,"states",void 0);e&&this.addStates(e);var i=a()(t,"extend",void 0);if(i)for(var n in i)this.hasOwnProperty(n)&&void 0!==this[n]||(this[n]=i[n]);var o=a()(t,"eventEmitter",void 0),s=a()(t,"EventEmitterClass",void 0);this.setEventEmitter(o,s),this._stateLock=!1,this.resetFromJSON(t)}shutdown(){this.destroyEventEmitter()}destroy(){this.shutdown()}resetFromJSON(t){this.setEnable(a()(t,"enable",!0)),this.start(a()(t,"start",void 0));var e=a()(t,"init",void 0);return e&&e.call(this),this}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}set state(t){if(this.enable&&!this._stateLock&&this._state!==t){if(this._prevState=this._state,this._state=t,this._stateLock=!0,this.emit("statechange",this),null!=this._prevState){var e="exit_"+this._prevState,i=this[e];i&&i.call(this),this.emit(e,this)}if(this._stateLock=!1,null!=this._state){var n="enter_"+this._state,o=this[n];o&&o.call(this),this.emit(n,this)}}}get state(){return this._state}get prevState(){return this._prevState}start(t){return this._start=t,this._prevState=void 0,this._state=t,this}goto(t){return null!=t&&(this.state=t),this}next(){var t,e=this["next_"+this.state];return e&&(t="string"==typeof e?e:e.call(this)),this.goto(t),this}addState(t,e){var i=a()(e,"next",void 0);i&&(this["next_"+t]=i);var n=a()(e,"exit",void 0);n&&(this["exit_"+t]=n);var o=a()(e,"enter",void 0);return o&&(this["enter_"+t]=o),this}addStates(t){for(var e in t)this.addState(e,t[e]);return this}update(t,e,i){void 0===i&&(i="update");var n=this[i+"_"+this.state];n&&n.call(this,t,e)}preupdate(t,e){this.update(t,e,"preupdate")}postupdate(t,e){this.update(t,e,"postupdate")}}Object.assign(FSM_FSM.prototype,n.a);var s=FSM_FSM;e.a=s},,function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(14),o=function(){function Position45(){}return Position45.transformTo90=function(t,e){var i=e.rows*(e.tileWidth/2);return new n.a((t.x-t.y)*(e.tileWidth/2)+i,(t.x+t.y)*(e.tileHeight/2))},Position45.transformTo45=function(t,e){var i=e.rows*(e.tileWidth/2);return new n.a(Math.floor((t.y+t.z)/e.tileHeight+(t.x-i)/e.tileWidth),Math.floor((t.y+t.z)/e.tileHeight-(t.x-i)/e.tileWidth))},Position45}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function Handler(t,e,i,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=!1),this.once=!1,this._id=0,this.setTo(t,e,i,n)}return Handler.create=function(t,e,i,n){return void 0===i&&(i=null),void 0===n&&(n=!0),Handler._pool.length?Handler._pool.pop().setTo(t,e,i,n):new Handler(t,e,i,n)},Handler.prototype.setTo=function(t,e,i,n){return this._id=Handler._gid++,this.caller=t,this.method=e,this.args=i,this.once=n,this},Handler.prototype.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},Handler.prototype.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t instanceof Array?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},Handler.prototype.clear=function(){return this.caller=null,this.method=null,this.args=null,this},Handler.prototype.recover=function(){this._id>0&&(this._id=0,Handler._pool.push(this.clear()))},Handler._pool=[],Handler._gid=1,Handler}()},,,function(t,e,i){"use strict";e.a=function(){}},function(t,e,i){"use strict";var n=i(283);e.a=function(t){return Object(n.a)(t)?t:t.scene&&Object(n.a)(t.scene)?t.scene:t.parent&&t.parent.scene&&Object(n.a)(t.parent.scene)?t.parent.scene:void 0}},function(t,e,i){"use strict";e.a={NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/}},function(t,e,i){"use strict";i.d(e,"c",(function(){return Show})),i.d(e,"a",(function(){return Hide})),i.d(e,"b",(function(){return IsShown}));var n=i(139),Show=function(t){_hide(t,!1)},Hide=function(t){_hide(t,!0)},IsShown=function(t){return!!t&&!Object(n.a)(t).hidden},_hide=function(t,e){t&&(Object(n.a)(t).hidden=e,t.setVisible(!e))}},function(t,e,i){"use strict";i.r(e),i.d(e,"DetailDisplay",(function(){return l}));var n,o=i(5),a=i(111),s=i(79),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function DetailDisplay(e){return t.call(this,e)||this}return h(DetailDisplay,t),DetailDisplay.prototype.loadDisplay=function(t){if(this.mDisplay=t,this.destroyDragon(),t.display){var e=t.display;this.scene.textures.exists(e.texturePath)?this.onCompleteHandler():(this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onCompleteHandler,this),this.scene.load.atlas(e.texturePath,o.h.getOsdRes(e.texturePath),o.h.getOsdRes(e.dataPath)),this.scene.load.start())}},DetailDisplay.prototype.loadAvatar=function(t,e,i){var n=this;void 0===e&&(e=1),this.mDragonboneDisplay||(this.mDragonboneDisplay=new a.a(this.scene,void 0),i&&(this.mDragonboneDisplay.x+=i.x,this.mDragonboneDisplay.y+=i.y)),this.mImage&&this.remove(this.mImage),this.mDragonboneDisplay.once("initialized",(function(){n.mDragonboneDisplay.play({animationName:"idle",flip:!1})})),this.mDragonboneDisplay.load(new s.a({id:0,avatar:t.avatar})),this.mDragonboneDisplay.scale=e,this.add(this.mDragonboneDisplay)},DetailDisplay.prototype.loadUrl=function(t){this.mUrl=t,this.mDisplay&&(this.mDisplay=null),this.destroyDragon(),this.scene.textures.exists(t)?this.onCompleteHandler():(this.scene.load.image(t,o.h.getOsdRes(t)),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onCompleteHandler,this),this.scene.load.start())},DetailDisplay.prototype.setTexture=function(t,e){this.destroyDragon(),this.mImage||(this.mImage=this.scene.make.image({key:t,frame:e},!1)),this.setSize(this.mImage.width*this.scale,this.mImage.height*this.scale),this.add(this.mImage),this.emit("show",this.mImage)},DetailDisplay.prototype.setNearest=function(){this.mImage&&this.mImage.texture.setFilter(Phaser.Textures.FilterMode.NEAREST)},Object.defineProperty(DetailDisplay.prototype,"display",{get:function(){return this.mDisplay},enumerable:!1,configurable:!0}),DetailDisplay.prototype.onCompleteHandler=function(){if(this.scene){if(this.mImage||(this.mImage=this.scene.make.image(void 0,!1)),this.mDisplay){this.mDisplay.display;var t=this.mDisplay.animations;if(!t||t.length<=0)return;this.mImage.setTexture(this.mDisplay.display.texturePath,t[0].frameName[0])}else this.mImage.setTexture(this.mUrl);this.setNearest(),this.setSize(this.mImage.width*this.scale,this.mImage.height*this.scale),this.add(this.mImage),this.emit("show",this.mImage)}},DetailDisplay.prototype.destroyDragon=function(){this.mDragonboneDisplay&&(this.mDragonboneDisplay.destroy(),this.mDragonboneDisplay=void 0)},DetailDisplay}(Phaser.GameObjects.Container)},,,function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n,o=i(117),a=i(5),s=i(8),h=i(35),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function LoadingScene(){var e=t.call(this,{key:LoadingScene.name})||this;return e.mRequestCom=!1,e}return l(LoadingScene,t),LoadingScene.prototype.preload=function(){var t=2;this.mWorld&&(t=this.mWorld.uiRatio||2),s.a.getInstance().log("has Texture: ",this.game.textures.exists("loading_bg")),!1===this.game.device.os.desktop&&this.load.image("loading_bg",a.h.getUIRes(t,"loading/loading_bg.jpg")),this.load.atlas("loading",a.h.getUIRes(t,"loading/loading.png"),a.h.getUIRes(t,"loading/loading.json")),this.load.script("webfont","./resources/scripts/webfont/1.6.26/webfont.js")},LoadingScene.prototype.init=function(t){var e=document.createElement("style");document.head.appendChild(e);e.sheet.insertRule("@font-face { font-family: 'Source Han Sans'; src: url('./resources/fonts/otf/SourceHanSansTC-Regular.otf') format('opentype'); }\n",0),this.mWorld=t.world,this.mRoom=t.room,this.mRequestCom=!1,this.mCallback=t.callBack},LoadingScene.prototype.create=function(){try{WebFont.load({custom:{families:["Source Han Sans"]}})}catch(t){s.a.getInstance().warn("webfont failed to load")}this.mRoom&&this.mRoom.startLoad();var t=this.scale.gameSize.width,e=this.scale.gameSize.height;this.anims.create({key:"loading_anmis",frames:this.anims.generateFrameNames("loading",{prefix:"loading_",start:1,end:59,zeroPad:3,suffix:".png"}),frameRate:16,yoyo:!1,repeat:-1}),this.bg=this.add.image(t/2,e/2,"loading_bg"),this.bg.scale=this.mWorld.uiScale,this.lo=this.add.sprite(0,0,"loading"),this.scale.on("resize",this.checkSize,this),this.lo.play("loading_anmis"),this.checkSize(new o.a(t,e)),this.mCallback&&(this.mCallback.call(this,this),this.mCallback=void 0)},LoadingScene.prototype.awake=function(){this.scale.on("resize",this.checkSize,this),this.scene.wake()},LoadingScene.prototype.sleep=function(){this.scale.off("resize",this.checkSize,this),this.scene.sleep()},LoadingScene.prototype.getKey=function(){return this.sys.config.key},LoadingScene.prototype.checkSize=function(t){var e=t.width,i=t.height;this.lo.x=e/2,this.lo.y=i/2},LoadingScene}(h.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n,o,a=i(9),s=i(118),h=i(16),l=i(5),c=i(266),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.BACKEND=1]="BACKEND",t[t.STAGE=2]="STAGE",t[t.FRONTEND=3]="FRONTEND",t[t.FLAG=4]="FLAG"}(o||(o={}));var u=function(t){function DisplayObject(e,i,n,o){void 0===o&&(o=!1);var a=t.call(this,e)||this;return a.mAlpha=1,a.mDirection=3,a.mAntial=!1,a.mElement=n,a.mRoomService=i,a.mAntial=o,a}return p(DisplayObject,t),DisplayObject.prototype.changeAlpha=function(t){this.mAlpha!==t&&(this.alpha=t,this.mAlpha=t)},DisplayObject.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this)},DisplayObject.prototype.fadeIn=function(t){},DisplayObject.prototype.fadeOut=function(t){},DisplayObject.prototype.load=function(t,e){},DisplayObject.prototype.play=function(t,e){},DisplayObject.prototype.setDirection=function(t){this.mDirection!==t&&(this.mDirection=t,this.scaleX=5===t||7===t?-1:1)},DisplayObject.prototype.destroy=function(e){this.mFlagContainer&&(this.mNickname&&(this.mNickname.destroy(),this.mNickname=void 0),this.mBackEffect&&(this.mBackEffect.destroy(),this.mBackEffect=void 0),this.mFrontEffect&&(this.mFrontEffect.destroy(),this.mFrontEffect=void 0),this.clearBadges(),this.mFlagContainer.destroy(),this.mFlagContainer=void 0),this.mReferenceArea&&(this.mReferenceArea.destroy(),this.mReferenceArea=void 0),this.mChildMap&&(this.mChildMap.clear(),this.mChildMap=null),t.prototype.destroy.call(this,e)},DisplayObject.prototype.showNickname=function(t){this.mNickname||(this.mNickname=this.scene.make.text({style:{font:a.a.YAHEI_14_BOLD}},!1).setOrigin(.5,.5),this.mNickname.setStroke("#0",2),this.mAntial&&this.mNickname.setShadow(2,2,"#0",4,!0,!0),this.flagContainer.add(this.mNickname)),this.mNickname.setText(t),this.layouFlag()},DisplayObject.prototype.setDisplayBadges=function(t){this.mBadges?this.clearBadges():this.mBadges=[];for(var e=0,i=t;e<i.length;e++){var n=i[e],o=new h.DynamicImage(this.scene,0,0);o.load(l.h.getOsdRes(n.thumbnail),this,this.layouFlag),this.flagContainer.add(o),this.mBadges.push(o)}},DisplayObject.prototype.showRefernceArea=function(){this.mReferenceArea||(this.mReferenceArea=new c.a(this.scene,this.mRoomService),this.addChildMap("reference",this.mReferenceArea)),!this.mCollisionArea||this.mCollisionArea.length<=0||(this.mReferenceArea.draw(this.mCollisionArea,this.mOriginPoint),this.addAt(this.mReferenceArea,0))},DisplayObject.prototype.hideRefernceArea=function(){this.mReferenceArea&&(this.mReferenceArea.destroy(),this.mReferenceArea=void 0)},DisplayObject.prototype.scaleTween=function(){},DisplayObject.prototype.showEffect=function(){this.addEffect(this.mBackEffect,l.h.getRes("ui/vip/vip_effect_back.png"),l.h.getRes("ui/vip/vip_effect_back.json"),!0,15,!1,!0),this.addEffect(this.mFrontEffect,l.h.getRes("ui/vip/vip_effect_front.png"),l.h.getRes("ui/vip/vip_effect_front.json"),!0,15,!1,!0)},DisplayObject.prototype.getElement=function(t){if(this.mChildMap)return this.mChildMap.get(t)},DisplayObject.prototype.addEffect=function(t,e,i,n,a,h,l){t||(t=new s.DynamicSprite(this.scene,0,0)),t.load(e,i),t.y=-20,n?this.addAt(t,o.BACKEND):this.addAt(t,o.FRONTEND),t.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,(function(){t.destroy()}))},DisplayObject.prototype.layouFlag=function(t){if(void 0===t&&(t=4),this.mFlagContainer){this.mFlagContainer.y=-96,this.bringToTop(this.mNickname);for(var e=0,i=0,n=this.mFlagContainer.list;i<n.length;i++){var o=n[i];o.x=e,o.width&&(e=o.width)}}},DisplayObject.prototype.clearBadges=function(){if(this.mBadges){for(var t=0,e=this.mBadges;t<e.length;t++){e[t].destroy()}this.mBadges.length=0}},Object.defineProperty(DisplayObject.prototype,"flagContainer",{get:function(){return this.mFlagContainer||(this.mFlagContainer=this.scene.make.container(void 0,!1),this.addAt(this.mFlagContainer,o.FLAG)),this.mFlagContainer},enumerable:!1,configurable:!0}),DisplayObject.prototype.addChildMap=function(t,e){this.mChildMap||(this.mChildMap=new Map),this.mChildMap.set(t,e)},DisplayObject.prototype.removeChildMap=function(t){this.mChildMap&&this.mChildMap.delete(t)},Object.defineProperty(DisplayObject.prototype,"baseLoc",{get:function(){return this.mBaseLoc||new Phaser.Geom.Point},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"sortX",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"sortY",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"sortZ",{get:function(){return this.z||0},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"element",{get:function(){return this.mElement},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"collisionArea",{get:function(){return this.mCollisionArea},enumerable:!1,configurable:!0}),Object.defineProperty(DisplayObject.prototype,"originPoint",{get:function(){return this.mOriginPoint},enumerable:!1,configurable:!0}),DisplayObject}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";var n;i.d(e,"a",(function(){return n})),function(t){!function(t){t.Click="click",t.Up="Up",t.Down="Down",t.Hold="Hold",t.Tap="Tap",t.Move="Move",t.Over="Over",t.Out="Out",t.DragStart="DragStart",t.DragStop="DragStop"}(t.MouseEvent||(t.MouseEvent={}))}(n||(n={}))},,,,function(t,e,i){"use strict";i.r(e),i.d(e,"ChatMediator",(function(){return d}));var n,o=i(4),a=i(3),s=i(8),h=i(138),l=i(146),c=i(7),p=i(147),u=i(18),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function ChatMediator(e,i){var n=t.call(this)||this;return n.mInRoom=!1,n.mAllMessage=[],n.mMaxMessageNum=50,n.world=e,n.mScene=i,n.chat=new p.Chat(e),n.mUIType=n.world.game.device.os.desktop?u.a.Scene:u.a.Normal,n}return m(ChatMediator,t),ChatMediator.prototype.getUIType=function(){return this.mUIType},ChatMediator.prototype.enterRoom=function(){if(this.room&&this.room.playerManager.actor&&this.mGMEApi){this.room.playerManager.actor.id;var t=this.room.id;this.mGMEApi.EnterRoom(t.toString(),1,this.mQCLoudAuth),this.mInRoom=!0,this.sendVoiceRoomStatus(a.op_def.ChatChannel.CurrentScene,t,a.op_def.VoiceRoomStatus.InVoiceRoom)}},ChatMediator.prototype.exitRoom=function(){this.mGMEApi&&(this.mGMEApi.EnableMic(!1),this.mGMEApi.ExitRoom(),this.mInRoom=!1,this.room&&this.sendVoiceRoomStatus(a.op_def.ChatChannel.CurrentScene,this.room.id,a.op_def.VoiceRoomStatus.OutsideVoiceRoom))},ChatMediator.prototype.isSceneUI=function(){return!0},ChatMediator.prototype.tweenView=function(t){this.mView&&this.mView.tweenExpand(t)},ChatMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ChatMediator.prototype.showing=function(){return!0},ChatMediator.prototype.resize=function(){var t=this.world.getSize();this.mView&&this.mView.resize(t.width,t.height)},ChatMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||(this.world.game.device.os.desktop?this.mView=new h.ChatPanelPC(this.mScene,this.world):(this.mView=new l.ChatPanelMobile(this.mScene,this.world),this.world.uiManager.checkUIState(ChatMediator.NAME,!1)),this.world.uiManager.getUILayerManager().addToUILayer(this.mView),this.addListen(),this.mView.show(),this.mView.scale=this.world.uiScale)},ChatMediator.prototype.update=function(t){this.mView.update(t),this.mParam=t},ChatMediator.prototype.hide=function(){this.removeListen(),this.mView.hide(),this.world.game.device.os.desktop||this.world.uiManager.checkUIState(ChatMediator.NAME,!0)},ChatMediator.prototype.setParam=function(t){this.mParam=t},ChatMediator.prototype.getParam=function(){return this.mParam},ChatMediator.prototype.destroy=function(){this.removeListen(),this.chat&&(this.chat.unregister(),this.chat=null),this.mGMEApi&&(this.mGMEApi=null),this.mScene=null,this.world=null,this.mInRoom=!1,this.mQCLoudAuth=null,this.mAllMessage.forEach((function(t){t&&(t=null)})),this.mAllMessage=null,t.prototype.destroy.call(this)},ChatMediator.prototype.addListen=function(){this.chat.on("characterChat",this.handleCharacterChat,this),this.chat.on("QCLoundGME",this.handleQCLoudGME,this),this.mView.on("sendChat",this.onSendChatHandler,this),this.mView.on("selectedVoice",this.onSelectedVoiceHandler,this),this.mView.on("selectedMic",this.onSelectedMicHandler,this),this.chat.register()},ChatMediator.prototype.removeListen=function(){this.chat.off("characterChat",this.handleCharacterChat,this),this.chat.off("QCLoundGME",this.handleQCLoudGME,this),this.mView.off("sendChat",this.onSendChatHandler,this),this.mView.off("selectedVoice",this.onSelectedVoiceHandler,this),this.mView.off("selectedMic",this.onSelectedMicHandler,this),this.chat.unregister()},ChatMediator.prototype.initGME=function(){var t=this;if(this.room.playerManager.actor){var e=this.room.playerManager.actor.id;this.mGMEApi=new WebGMEAPI,this.mGMEApi.Init(document,"1400209172",e.toString()),this.mGMEApi.SetTMGDelegate((function(e,i){switch(e){case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ENTER_ROOM:s.a.getInstance().log("[GME]: EnterRoom: "+i);break;case t.mGMEApi.event.ITMG_MAIN_EVNET_TYPE_USER_UPDATE:break;case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_EXIT_ROOM:s.a.getInstance().log("[GME]: ExitRoom");break;case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ROOM_DISCONNECT:s.a.getInstance().log("[GME]: Room Disconnect!!!");break;default:s.a.getInstance().log("[GME]: Sth wrong...")}}))}},ChatMediator.prototype.appendMessage=function(t,e){t.push(e),t.length>this.mMaxMessageNum&&t.shift()},ChatMediator.prototype.changeMessageChannel=function(){var t=this;if(this.mView)for(var e=this.mAllMessage.filter((function(e){return e.channel===t.mView.outChannel||e.channel===a.op_def.ChatChannel.System||null===t.mView.outChannel})),i=e.length,n=null,o="\n",s=0;s<i;s++)n=e[s],s===i-1&&(o=""),this.mView.appendChat(n.chat+o)},ChatMediator.prototype.handleCharacterChat=function(t){var e=t.content;if(this.world&&this.world.emitter&&this.room&&this.mView){var i=this.world.roomManager.currentRoom.playerManager;if(i){var n=i.get(e.chatSenderid),o=n?n.model.nickname+":":"",a=e.chatSetting&&e.chatSetting.textColor?e.chatSetting.textColor:"#FFFFFF";this.appendMessage(this.mAllMessage,{chat:"[color="+a+"]"+o+":"+e.chatContext+"[/color]",channel:e.chatChannel}),this.mView.appendChat("[b][color="+a+"]"+o+e.chatContext+"[/color][/b]\n")}}},ChatMediator.prototype.onSendChatHandler=function(t){if(this.world.connection){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_GATEWAY_REQ_VIRTUAL_WORLD_CHAT),i=e.content;i.chatChannel=0,i.chatContext=t,this.world.connection.send(e)}},ChatMediator.prototype.sendVoiceRoomStatus=function(t,e,i){if(this.room.connection){var n=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS),s=n.content;s.voiceChannel=t,s.voiceRoomId=e,s.voiceRoomStatus=i,this.room.connection.send(n)}},ChatMediator.prototype.handleQCLoudGME=function(t){var e=t.content;this.mQCLoudAuth=e.signature,this.initGME()},ChatMediator.prototype.onSelectedVoiceHandler=function(t){t?this.enterRoom():this.exitRoom()},ChatMediator.prototype.onSelectedMicHandler=function(t){if(this.mGMEApi&&(this.mInRoom&&this.mGMEApi.EnableMic(t),this.world.connection)){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS);this.world.connection.send(e)}},Object.defineProperty(ChatMediator.prototype,"room",{get:function(){if(this.world&&this.world.roomManager)return this.world.roomManager.currentRoom},enumerable:!1,configurable:!0}),ChatMediator.NAME="ChatMediator",ChatMediator}(c.a)},function(t,e,i){"use strict";var n=i(51),o=new Phaser.GameObjects.Zone({sys:{queueDepthSort:n.a,events:{once:n.a}}},0,0,1,1);o.setOrigin(0),e.a=o},function(t,e,i){"use strict";const n=Phaser.GameObjects.GameObject;e.a=function(t){return t instanceof n}},function(t,e,i){"use strict";i.d(e,"b",(function(){return WaitEvent})),i.d(e,"a",(function(){return WaitComplete}));var WaitEvent=function(t,e){return new Promise((function(i,n){t.once(e,(function(){i()}))}))},WaitComplete=function(t){return WaitEvent(t,"complete")}},function(t,e,i){"use strict";var n=i(139);e.a=function(t){return Object(n.a)(t).parent}},function(t,e,i){"use strict";i.r(e),i.d(e,"DragDropIcon",(function(){return h}));var n,o=i(5),a=i(16),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function DragDropIcon(e,i,n,o){var s=t.call(this,e,i,n)||this;return s.mScene=e,s.mIcon=new a.DynamicImage(s.mScene,0,0),s.add(s.mIcon),s}return s(DragDropIcon,t),DragDropIcon.prototype.load=function(t,e,i){var n=this;this.mUrl=t;this.resKey;this.mIcon.load(o.h.getOsdRes(this.mUrl),(function(){n.mCallBack&&n.mCallBack()})),this.mCallBack=i},DragDropIcon.prototype.dragStart=function(){},DragDropIcon.prototype.dragStop=function(t){},DragDropIcon.prototype.dragDrop=function(t){},DragDropIcon.prototype.dragOver=function(t){},DragDropIcon.prototype.getDragData=function(){},DragDropIcon.prototype.getDropData=function(){},DragDropIcon.prototype.getDragImage=function(){return this.mIcon},DragDropIcon.prototype.getVisualDisplay=function(){},DragDropIcon.prototype.getBound=function(){var t=this.getBounds();return new Phaser.Geom.Rectangle(t.x,t.y,t.width,t.height)},Object.defineProperty(DragDropIcon.prototype,"resKey",{get:function(){return void 0===this.mUrl?"":o.h.getOsdRes(this.mUrl)},enumerable:!1,configurable:!0}),DragDropIcon.prototype.destroy=function(){this.mCallBack=null,t.prototype.destroy.call(this,!0)},Object.defineProperty(DragDropIcon.prototype,"icon",{get:function(){return this.mIcon},enumerable:!1,configurable:!0}),DragDropIcon.prototype.setDragType=function(t){this.mDragType=t},DragDropIcon.prototype.setDropType=function(t){this.mDropType=t},DragDropIcon.prototype.getDropType=function(){return this.mDropType},DragDropIcon.prototype.getDragType=function(){return this.mDragType},DragDropIcon}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(14),o=function(){function Tool(){}return Tool.getPosByScenes=function(t,e){var i=t.cameras.main,o=e.x-i.scrollX,a=e.y-i.scrollY;return new n.a(o,a)},Tool.twoPointDistance=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},Tool.twoPointRadin=function(t,e){var i=t.x-e.x,n=t.y-e.y,o=Math.sqrt(Math.pow(i,2)+Math.pow(n,2)),a=Math.acos(i/o);return e.y<t.y&&(a=-a),a},Tool.formatChineseString=function(t,e,i){"string"==typeof e&&(e=parseInt(e,10));var n=Math.floor(i/e);return this.chunk(t,n).join(" ")},Tool.checkChinese=function(t){for(var e=/[\u4e00-\u9fa5]+/,i=t.split(""),n=0,o=i.length;n<o;n++)if(e.test(i[n]))return!0;return!1},Tool.checkItemName=function(t,e){var i=e.split("")||[],n=!1;return i.forEach((function(e){if(e)for(var i=new RegExp(e),o=t.split(""),a=0,s=o.length;a<s;a++)if(i.test(o[a])){n=!0;break}})),n},Tool.checkPointerContains=function(t,e){if(!t)return!1;var i=-t.width/2,n=t.width/2,o=-t.height/2,a=t.height/2;if(e){var s=t.getWorldTransformMatrix(),h=e.x-s.tx-t.x,l=e.y-s.ty-t.y;return i<=h&&n>=h&&o<=l&&a>=l}return!1},Tool.baseName=function(t){var e=new String(t).substring(t.lastIndexOf("/")+1);return-1!==e.lastIndexOf(".")&&(e=e.substring(0,e.lastIndexOf("."))),e},Tool.chunk=function(t,e){for(var i=[],n=0;n<t.length;n+=e)i.push(t.substr(n,e));return i},Tool}()},function(t,e,i){"use strict";i.r(e),i.d(e,"RankMediator",(function(){return l}));var n,o=i(154),a=i(7),s=i(18),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function RankMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mScene=i,o.mlayerManager=e,o.mUIType=o.world.game.device.os.desktop?s.a.Scene:s.a.Normal,o}return h(RankMediator,t),RankMediator.prototype.tweenView=function(t){this.mView&&this.world.game.device.os.desktop&&this.mView.tweenView(t)},RankMediator.prototype.getName=function(){return""},RankMediator.prototype.getView=function(){return this.mView},RankMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView.hide(),this.mView=null,this.world.game.device.os.desktop||this.world.uiManager.checkUIState(RankMediator.NAME,!0))},RankMediator.prototype.isSceneUI=function(){return!1},RankMediator.prototype.isShow=function(){return!1},RankMediator.prototype.resize=function(){this.mView&&this.mView.resize()},RankMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView=new o.RankPanel(this.mScene,this.world),this.mlayerManager.addToUILayer(this.mView),e&&e.length>0&&this.mView.addItem(e[0]),this.mView.show(),this.world.game.device.os.desktop||this.world.uiManager.checkUIState(RankMediator.NAME,!1),t.prototype.show.call(this,e))},RankMediator.prototype.update=function(t){this.mView&&t&&t.length>0&&this.mView.update(t[0])},RankMediator.prototype.destroy=function(){this.mView&&(this.mView.parentContainer&&this.mView.parentContainer.remove(this.mView),this.mView.destroy(),this.mView=null),this.mScene=null},RankMediator.NAME="RankMediator",RankMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"CheckboxGroup",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function CheckboxGroup(){var e=t.call(this)||this;return e.mList=[],e}return o(CheckboxGroup,t),CheckboxGroup.prototype.appendItem=function(t){return this.mList.push(t),t.on("Tap",this.onGameObjectUpHandler,this),this},CheckboxGroup.prototype.appendItemAll=function(t){this.mList=this.mList.concat(t);for(var e=0,i=t;e<i.length;e++){i[e].on("Tap",this.onGameObjectUpHandler,this)}return this},CheckboxGroup.prototype.removeItem=function(t){return this.mList=this.mList.filter((function(e){return e!==t})),t.removeAllListeners(),this},CheckboxGroup.prototype.selectIndex=function(t){return t<0&&(t=0),t>=this.mList.length&&(t=this.mList.length-1),this.mList.length>0&&this.select(this.mList[t]),this},CheckboxGroup.prototype.select=function(t){this.mPrevButton!==t&&(this.mPrevButton&&this.mPrevButton.changeNormal(),t.changeDown(),this.emit("selected",t,this.mPrevButton),this.mPrevButton=t)},CheckboxGroup.prototype.reset=function(){var t=this;this.mList&&this.mList.forEach((function(e){t.removeItem(e)}))},CheckboxGroup.prototype.destroy=function(){var e=this;this.mList&&this.mList.forEach((function(t){e.removeItem(t),t.destroy()})),t.prototype.destroy.call(this)},CheckboxGroup.prototype.onGameObjectUpHandler=function(t,e){this.select(e)},CheckboxGroup}(Phaser.Events.EventEmitter)},function(t,e,i){"use strict";var n=class Stack{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}clear(){return this.items.length=0,this}};e.a=n},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n,o=i(29),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=(Phaser.Utils.Objects.GetValue,function(t){function NineSlicePatch(e,i,n,o,a,s,h,l,c,p){var u=t.call(this,e,c,p)||this;return u.dpr=c||1,u.scale=p||1,u.patchesConfig={top:0,left:0,right:0,bottom:0},u.setConfig(l),u.setSize(o,a),u.setTexture(s,h),u}return a(NineSlicePatch,t),NineSlicePatch.prototype.resize=function(t,e){return t=Math.round(t),e=Math.round(e),this.patchesConfig?this.width===t&&this.height===e?this:(this.setSize(t,e),void this.drawPatches()):this},NineSlicePatch.prototype.getConfig=function(){return this.patchesConfig},NineSlicePatch.prototype.setConfig=function(t){Object.assign(this.patchesConfig,t),this.patchesConfig.top=Math.round(this.patchesConfig.top),this.patchesConfig.right&&(this.patchesConfig.right=Math.round(this.patchesConfig.right)),this.patchesConfig.bottom&&(this.patchesConfig.bottom=Math.round(this.patchesConfig.bottom)),this.patchesConfig.left&&(this.patchesConfig.left=Math.round(this.patchesConfig.left)),function(t){t.bottom=void 0!==t.bottom?t.bottom:t.top,t.left=void 0!==t.left?t.left:t.top,t.right=void 0!==t.right?t.right:t.left}(t)},NineSlicePatch.prototype.setTexture=function(t,e){return this.originTexture=this.scene.textures.get(t),this.setFrame(e),this},NineSlicePatch.prototype.setFrame=function(t){return this.originFrame=this.originTexture.frames[t]||this.originTexture.frames[NineSlicePatch.__BASE],this.createPatches(),this.drawPatches(),this},NineSlicePatch.prototype.setSize=function(e,i){t.prototype.setSize.call(this,e,i);var n=this.width-this.patchesConfig.right>0?this.width-this.patchesConfig.right:this.patchesConfig.right,o=this.height-this.patchesConfig.bottom>0?this.height-this.patchesConfig.bottom:this.patchesConfig.right;return this.finalXs=[0,this.patchesConfig.left,n,this.width],this.finalYs=[0,this.patchesConfig.top,o,this.height],this},NineSlicePatch.prototype.setTint=function(t){return this.tint=t,this},NineSlicePatch.prototype.setTintFill=function(t){return this.tint=t,this.tintFill=!0,this},Object.defineProperty(NineSlicePatch.prototype,"tintFill",{get:function(){return this.first&&this.first.tintFill},set:function(t){this.each((function(e){return e.tintFill=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePatch.prototype,"tint",{set:function(t){this.each((function(e){return e.setTint(t)})),this.internalTint=t},enumerable:!1,configurable:!0}),Object.defineProperty(NineSlicePatch.prototype,"isTinted",{get:function(){return this.first&&this.first.isTinted},enumerable:!1,configurable:!0}),NineSlicePatch.prototype.clearTint=function(){this.each((function(t){return t.clearTint()})),this.internalTint=void 0,this.tintFill=!1},NineSlicePatch.prototype.createPatches=function(){for(var t=[0,this.patchesConfig.left,this.originFrame.width-this.patchesConfig.right,this.originFrame.width],e=[0,this.patchesConfig.top,this.originFrame.height-this.patchesConfig.bottom,this.originFrame.height],i=0,n=0;n<3;n++)for(var o=0;o<3;o++)this.createPatchFrame(this.getPatchNameByIndex(i),t[o],e[n],t[o+1]-t[o],e[n+1]-e[n]),++i},NineSlicePatch.prototype.drawPatches=function(){var t=this.tintFill;this.removeAll(!0);for(var e=0,i=0;i<3;i++)if(!(this.height<this.patchesConfig.bottom+this.patchesConfig.top&&1===i))for(var n=0;n<3;n++)if(!(this.width<this.patchesConfig.left+this.patchesConfig.right&&1===n)){var o=this.originTexture.frames[this.getPatchNameByIndex(e)],a=new Phaser.GameObjects.Image(this.scene,0,0,o.texture.key,o.name);a.setOrigin(0),a.setPosition((1e3*this.finalXs[n]-this.width*this.originX*1e3)/1e3,(1e3*this.finalYs[i]-this.height*this.originY*1e3)/1e3),a.displayWidth=this.finalXs[n+1]-this.finalXs[n],a.displayHeight=this.finalYs[i+1]-this.finalYs[i],this.add(a),this.internalTint&&a.setTint(this.internalTint),a.tintFill=t,++e}},NineSlicePatch.prototype.createPatchFrame=function(t,e,i,n,o){this.originTexture.frames.hasOwnProperty(t)||this.originTexture.add(t,this.originFrame.sourceIndex,this.originFrame.cutX+e,this.originFrame.cutY+i,n,o)},NineSlicePatch.prototype.getPatchNameByIndex=function(t){return this.originFrame.name+"|"+NineSlicePatch.patches[t]},NineSlicePatch.prototype.calculScale=function(t,e){return e*t/(2*e*(e+t))},NineSlicePatch.__BASE="__BASE",NineSlicePatch.patches=["[0][0]","[1][0]","[2][0]","[0][1]","[1][1]","[2][1]","[0][2]","[1][2]","[2][2]"],NineSlicePatch}(o.a))},,,function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));var n,o=i(4),a=i(3),s=i(22),h=i(8),l=i(14),c=i(28),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=a.op_def.NodeType,m=function(t){function ElementManager(e){var i=t.call(this)||this;i.mRoom=e,i.hasAddComplete=!1,i.mElements=new Map,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,i.onAdd),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE_END,i.addComplete),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,i.onRemove),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MOVE_SPRITE,i.onMove),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,i.onAdjust),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SYNC_SPRITE,i.onSync),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE,i.onShowBubble),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE_CLEAN,i.onClearBubbleHandler),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_CHANGE_SPRITE_ANIMATION,i.onChangeAnimation),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SET_SPRITE_POSITION,i.onSetPosition)),i.mRoom&&i.mRoom.world&&(i.mGameConfig=i.mRoom.world.elementStorage);var n=i.mRoom.miniSize;i.mMap=new Array(n.cols);for(var o=0;o<i.mMap.length;o++)i.mMap[o]=new Array(n.rows).fill(-1);return i}return p(ElementManager,t),ElementManager.prototype.init=function(){},ElementManager.prototype.get=function(t){var e=this.mElements.get(t);if(e)return e},ElementManager.prototype.remove=function(t){var e=this.mElements.get(t);return e&&(this.mElements.delete(t),e.destroy(),this.removeMap(e.model)),e},ElementManager.prototype.getElements=function(){return Array.from(this.mElements.values())},ElementManager.prototype.add=function(t,e){for(var i=0,n=t;i<n.length;i++){var o=n[i];this._add(o,e)}},ElementManager.prototype.destroy=function(){var t=this;this.connection&&this.connection.removePacketListener(this),this.mElements&&(this.mElements.forEach((function(e){return t.remove(e.id)})),this.mElements.clear())},ElementManager.prototype.update=function(t,e){},ElementManager.prototype.addMap=function(t){},ElementManager.prototype.removeMap=function(t){},Object.defineProperty(ElementManager.prototype,"camera",{get:function(){return this.mRoom.cameraService.camera},enumerable:!1,configurable:!0}),Object.defineProperty(ElementManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;h.a.getInstance().log("roomManager is undefined")},enumerable:!1,configurable:!0}),ElementManager.prototype.onAdjust=function(t){var e=t.content,i=e.spritePositions;if(e.nodeType===u.ElementNodeType)for(var n,o,a=0,s=i;a<s.length;a++){var h=s[a];(n=this.mElements.get(h.id))&&(o=h.point3f,n.setPosition(new l.a(o.x||0,o.y||0,o.z||0)))}},ElementManager.prototype.onAdd=function(t){if(this.mRoom.layerManager)if(this.mGameConfig){var e=t.content,i=e.sprites;if(i)if(e.nodeType===u.ElementNodeType){for(var n=null,o=[],a=0,s=i;a<s.length;a++){var l=s[a];l.point3f&&((n=new c.a(l,e.nodeType)).displayInfo||this.checkDisplay(n)||o.push(n.id),this._add(n))}this.fetchDisplay(o)}}else h.a.getInstance().error("gameConfig does not exist");else h.a.getInstance().error("layer manager does not exist")},ElementManager.prototype._add=function(t,e){void 0===e&&(e=!0);var i=this.mElements.get(t.id);return i?i.model=t:(i=new s.b(t,this)).setInputEnable(s.c.Interactive),e&&this.addMap(t),this.mElements.set(i.id||0,i),i},ElementManager.prototype.addComplete=function(t){this.hasAddComplete=!0},ElementManager.prototype.checkDisplay=function(t){if(!t.displayInfo){var e=this.roomService.world.elementStorage.getDisplayModel(t.bindID||t.id);if(e)return t.displayInfo=e,e}},ElementManager.prototype.fetchDisplay=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_REQ_VIRTUAL_WORLD_QUERY_SPRITE_RESOURCE);e.content.ids=t,this.connection.send(e)},Object.defineProperty(ElementManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),Object.defineProperty(ElementManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!1,configurable:!0}),Object.defineProperty(ElementManager.prototype,"map",{get:function(){return this.mMap},enumerable:!1,configurable:!0}),ElementManager.prototype.onSetPosition=function(t){var e=t.content,i=e.nodeType,n=e.id;i===u.ElementNodeType&&this.get(n).setPosition(new l.a(e.position.x,e.position.y,e.position.z))},ElementManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,n=e.ids;if(i===u.ElementNodeType)for(var o=0,a=n;o<a.length;o++){var s=a[o];this.remove(s)}},ElementManager.prototype.onSync=function(t){var e=t.content;if(e.nodeType===u.ElementNodeType)for(var i=null,n=e.sprites,o=e.command,s=0,h=n;s<h.length;s++){var l=h[s];(i=this.get(l.id))&&(o===a.op_def.OpCommand.OP_COMMAND_UPDATE?i.model=new c.a(l):o===a.op_def.OpCommand.OP_COMMAND_PATCH&&i.updateModel(l))}},ElementManager.prototype.onMove=function(t){var e=t.content;if(e.moveData)for(var i=e.moveData,n=i.length,o=(e.nodeType,void 0),a=void 0,s=void 0,h=0;h<n;h++)a=(o=i[h]).moveObjectId,(s=this.get(a))&&s.move(o)},ElementManager.prototype.onShowBubble=function(t){var e=t.content,i=this.get(e.receiverid);i&&i.showBubble(e.context,e.chatsetting)},ElementManager.prototype.onClearBubbleHandler=function(t){var e=t.content,i=this.get(e.receiverid);i&&i.clearBubble()},ElementManager.prototype.onChangeAnimation=function(t){var e=t.content;if(e.nodeType===u.ElementNodeType)for(var i=null,n=0,o=e.ids;n<o.length;n++){var a=o[n];(i=this.get(a))&&i.setQueue(e.changeAnimation)}},ElementManager}(o.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n,o,a=i(8),s=i(59),h=i(5),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.BACKEND=1]="BACKEND",t[t.STAGE=2]="STAGE",t[t.FRONTEND=3]="FRONTEND"}(o||(o={}));var c=function(t){function FramesDisplay(){var e=null!==t&&t.apply(this,arguments)||this;return e.mDisplayDatas=new Map,e.mSprites=new Map,e.mHasAnimation=!1,e}return l(FramesDisplay,t),FramesDisplay.prototype.load=function(t,e){e=e||o.STAGE;var i=t;if(i&&i.gene){var n=this.mDisplayDatas.get(e);if(!n||n.gene!==t.gene)if(this.mDisplayDatas.set(e,i),this.scene.textures.exists(i.gene))this.onLoadCompleted(e);else{var s=i.display;s||a.a.getInstance().error("display is undefined"),this.scene.load.atlas(i.gene,h.h.OSD_PATH+s.texturePath,h.h.OSD_PATH+s.dataPath),this.scene.textures.on(Phaser.Textures.Events.ADD,this.onAddTextureHandler,this),this.scene.load.start()}}},FramesDisplay.prototype.play=function(t,e){if(this.mActionName=t,t){e=e||o.STAGE;var i=this.mDisplayDatas.get(e),n=this.mSprites.get(e),a=i.getAnimations(t.animationName);a&&(n&&(n instanceof Phaser.GameObjects.Sprite?(n.off(Phaser.Animations.Events.ANIMATION_REPEAT,this.onAnimationRepeatHander,this),a.frameName.length>1?(n.play(i.gene+"_"+t.animationName),t.playingQueue&&t.playingQueue.complete&&n.on(Phaser.Animations.Events.ANIMATION_REPEAT,this.onAnimationRepeatHander,this)):(n.anims.stop(),n.setTexture(i.gene,a.frameName[0]))):n.setTexture(i.gene,a.frameName[0]),this.scaleX=t.flip?-1:1),this.initBaseLoc(e,t.animationName))}},FramesDisplay.prototype.fadeIn=function(t){0!==this.mAlpha&&(this.alpha=0,this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:this.mAlpha,duration:1200,onComplete:function(){t&&t()}}))},FramesDisplay.prototype.fadeOut=function(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:function(){t&&t()}})},FramesDisplay.prototype.scaleTween=function(){var t=this,e=this.mSprites.get(o.STAGE);if(e&&!this.mScaleTween){var i=e.scale;this.mScaleTween=this.scene.tweens.add({targets:e,duration:100,scale:1.25*i,yoyo:!0,repeat:0,onComplete:function(){e.scale=1,t.mScaleTween&&(t.mScaleTween=void 0)}})}},FramesDisplay.prototype.setInteractive=function(t,e,i){return this.mSprites.forEach((function(t){t.setInteractive({pixelPerfect:!0})})),this},FramesDisplay.prototype.disableInteractive=function(){return this.mSprites.forEach((function(t){t.disableInteractive()})),this},FramesDisplay.prototype.destroy=function(){this.mSprites.forEach((function(t){return t.destroy()})),this.mSprites.clear(),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=void 0),this.mScaleTween&&(this.mScaleTween.stop(),this.mScaleTween=void 0),this.mDisplayDatas.clear(),t.prototype.destroy.call(this)},FramesDisplay.prototype.clearFadeTween=function(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())},FramesDisplay.prototype.onAddTextureHandler=function(t){var e=this.mDisplayDatas.get(o.STAGE);e&&e.gene===t&&(this.scene.textures.off(Phaser.Textures.Events.ADD,this.onAddTextureHandler,this),this.onLoadCompleted(o.STAGE))},FramesDisplay.prototype.onLoadCompleted=function(t){var e=this.mDisplayDatas.get(t);e&&this.scene.textures.exists(e.gene)&&(this.makeAnimations(t),this.createDisplay(t))},FramesDisplay.prototype.makeAnimations=function(t){var e=this.mDisplayDatas.get(t);if(e)for(var i=0,n=Array.from(e.animations.values());i<n.length;i++){var o=n[i];this.makeAnimation(t,o)}},FramesDisplay.prototype.makeAnimation=function(t,e){var i=this.mDisplayDatas.get(t);if(e&&i&&i.gene&&!(e.frameName.length<=1)){var n=[];e.frameName.forEach((function(t){n.push({key:i.gene,frame:t})}));var o={key:i.gene+"_"+e.name,frames:n,frameRate:e.frameRate,repeat:e.loop?-1:0};this.mHasAnimation=!0,this.scene.anims.create(o)}},FramesDisplay.prototype.initBaseLoc=function(t,e){var i=this.mDisplayDatas.get(t),n=this.mSprites.get(t);if(n&&i&&i.animations){var o=i.getAnimations(e);o&&(this.mBaseLoc=o.baseLoc,this.mCollisionArea=o.collisionArea,this.mOriginPoint=o.originPoint,n.x=this.baseLoc.x+n.width/2,n.y=this.baseLoc.y+n.height/2)}},FramesDisplay.prototype.createDisplay=function(t){var e=this.mDisplayDatas.get(t);if(e&&e.gene){var i=this.mSprites.get(t);i||(i=this.mHasAnimation?this.scene.make.sprite(void 0,!1):this.scene.make.image(void 0,!1),this.mSprites.set(t,i)),this.play({animationName:e.animationName,flip:!1},t),i.x=this.baseLoc.x+i.width/2,i.y=this.baseLoc.y+i.height/2,this.mAntial&&i.texture.setFilter(Phaser.Textures.FilterMode.NEAREST),this.addAt(i,t),this.setData("id",e.id),this.emit("initialized",this)}},FramesDisplay.prototype.onAnimationRepeatHander=function(){var t=this.mActionName.playingQueue;if(void 0===t.playedTimes?t.playedTimes=1:t.playedTimes++,t.playedTimes>=t.playTimes){var e=this.mSprites.get(o.STAGE);e&&e.off(Phaser.Animations.Events.ANIMATION_REPEAT,this.onAnimationRepeatHander,this),t.complete&&(t.complete.call(this),delete t.complete)}},Object.defineProperty(FramesDisplay.prototype,"spriteWidth",{get:function(){var t=this.mSprites.get(o.STAGE);return t?t.width:0},enumerable:!1,configurable:!0}),Object.defineProperty(FramesDisplay.prototype,"spriteHeight",{get:function(){var t=this.mSprites.get(o.STAGE);return t?t.height:0},enumerable:!1,configurable:!0}),FramesDisplay}(s.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(22),o=function(){function DragonbonesModel(t){this.discriminator="DragonbonesModel",t&&(this.id=t.id,this.avatar=t.avatar)}return DragonbonesModel.prototype.setInfo=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},DragonbonesModel.prototype.destroy=function(){},DragonbonesModel.prototype.getCollisionArea=function(t){return[[1,1],[1,1]]},DragonbonesModel.prototype.getWalkableArea=function(){return[[1,1],[1,1]]},DragonbonesModel.prototype.getOriginPoint=function(t){return new Phaser.Geom.Point(1,1)},DragonbonesModel.prototype.getInteractiveArea=function(){},DragonbonesModel.prototype.existAnimation=function(t){return!0},DragonbonesModel.prototype.findAnimation=function(t,e){var i=!1;switch(e){case n.a.south_east:i=!0,e=n.a.west_south;break;case n.a.east_north:i=!0,e=n.a.north_west}var o="";return(e>=n.a.north&&e<n.a.west||e>n.a.east&&e<=n.a.east_north)&&(o="_back"),{animationName:""+t+o,flip:i}},DragonbonesModel}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i(3),o=i(8),a=i(366),s=i(122),h=i(28),l=i(22),c=function(){function FramesModel(t){this.discriminator="FramesModel",this.id=t.id||0,this.type=t.sn||"";var e=t.animations;e&&(this.animationName=e.defaultAnimationName,this.setDisplay(e.display),this.setAnimationData(e.animationData))}return FramesModel.prototype.setInfo=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},FramesModel.prototype.getAnimationData=function(){return this.animations},FramesModel.prototype.existAnimation=function(t){return!!this.animations&&this.animations.has(t)},FramesModel.prototype.getAnimations=function(t){if(this.animations)return this.animations.get(t)},FramesModel.prototype.destroy=function(){this.animations&&this.animations.clear()},Object.defineProperty(FramesModel.prototype,"gene",{get:function(){return this.mGen},enumerable:!1,configurable:!0}),FramesModel.prototype.createProtocolObject=function(){var t=[];return this.animations.forEach((function(e){t.push(e.createProtocolObject())}),this),t},FramesModel.prototype.getCollisionArea=function(t,e){void 0===e&&(e=!1);var i=this.getAnimations(t);if(i)return e?s.a.flipArray(i.collisionArea):i.collisionArea},FramesModel.prototype.getWalkableArea=function(t,e){void 0===e&&(e=!1);var i=this.getAnimations(t);return e?s.a.flipArray(i.walkableArea):i.walkableArea},FramesModel.prototype.getInteractiveArea=function(t){var e=this.getAnimations(t);return e?e.interactiveArea:void 0},FramesModel.prototype.getOriginPoint=function(t,e){void 0===e&&(e=!1);var i=this.getAnimations(t);if(i){var n=i.originPoint;return e?new Phaser.Geom.Point(n.y,n.x):n}},FramesModel.prototype.getDirable=function(){},FramesModel.prototype.createSprite=function(t){var e=t.nodeType,i=t.x,o=t.y,a=t.z,l=t.id,c=t.dir,p=t.isMoss,u=n.op_client.Sprite.create();u.id=l||s.a.genId(),u.display=this.display,u.currentAnimationName=this.animationName;var m=n.op_def.PBPoint3f.create();return m.x=i,m.y=o,a&&(m.z=a),u.point3f=m,u.animations=this.createProtocolObject(),c&&(u.direction=c),void 0!==p&&(u.isMoss=p),new h.a(u,e)},FramesModel.prototype.findAnimation=function(t,e){var i=this.checkDirectionAnimation(t,e),n=!1;if(i)return{animationName:i,flip:n};switch(e){case l.a.west_south:case l.a.east_north:i=this.getDefaultAnimation(t);break;case l.a.south_east:i=this.getDefaultAnimation(t),n=!0;break;case l.a.north_west:null===(i=this.checkDirectionAnimation(t,l.a.east_north))&&(i=this.getDefaultAnimation(t)),n=!0}return{animationName:i,flip:n}},FramesModel.prototype.setDisplay=function(t){t?(this.display={dataPath:t.dataPath,texturePath:t.texturePath},this.mGen=a.sync(t.dataPath+t.texturePath)):o.a.getInstance().error(this.type+" display does not exist")},FramesModel.prototype.setAnimationData=function(t){if(t){this.animations=new Map;for(var e=0,i=t;e<i.length;e++){var n=i[e];this.animations.set(n.name,n)}}else o.a.getInstance().error(this.id+" animationData does not exist")},FramesModel.prototype.checkDirectionAnimation=function(t,e){var i=t+"_"+e;return this.existAnimation(i)?i:null},FramesModel.prototype.getDefaultAnimation=function(t){var e=this.checkDirectionAnimation(t,l.a.west_south);return null===e&&(this.existAnimation(t)?e=t:(o.a.getInstance().warn(FramesModel.name+": can't find animation "+t),e="idle")),e},FramesModel}()},,,function(t,e,i){"use strict";var n=i(323);e.a=n.a},function(t,e,i){"use strict";var n=void 0;e.a=function(t,e,i,o){if(void 0===n&&(n=new Phaser.Geom.Rectangle),t.getBounds(n),e)return!(i&&!i(t,e))&&(!!n.contains(e.x,e.y)&&!(o&&!o(t,e)));for(var a=t.scene.input.manager,s=a.pointersTotal,h=a.pointers,l=0;l<s;l++)if(e=h[l],(!i||i(t,e))&&n.contains(e.x,e.y)&&(!o||o(t,e)))return!0;return!1}},function(t,e,i){"use strict";var n=i(68);e.a=function(t){for(var e=Object(n.a)(t);e;)t=e,e=Object(n.a)(e);return t}},function(t,e,i){"use strict";var n=i(284);const o=Phaser.Utils.Objects.GetValue;e.a=function(t,e){void 0===e&&(e="scrollMode");var i=o(t,"scrollMode",0);return"string"==typeof i&&(i=n.a[i]),i}},function(t,e,i){"use strict";const n=Phaser.GameObjects.Graphics;const o={rectangle:0,circle:1};e.a=class DefaultMask extends n{constructor(t,e,i){void 0===e&&(e=0),"string"==typeof e&&(shaep=o[e]),void 0===i&&(i=0),super(t.scene),this.parent=t,this.shape=e,this.padding=i,this.setPosition().resize()}destroy(){return this.parent=void 0,super.destroy(),this}setPosition(t,e){var i=this.parent;return void 0===t&&(t=i.x),void 0===e&&(e=i.y),super.setPosition(t,e),this}resize(t,e,i){var n=this.parent;if(void 0===t&&(t=n.width),void 0===e&&(e=n.height),void 0===i&&(i=this.padding),this.widthSave===t&&this.heightSave===e&&this.paddingSave===i)return this;switch(this.clear().fillStyle(16777215),this.shape){case 1:var o=Math.min(t,e)/2;this.fillCircle(0,0,o+i);break;default:this.fillRect(-t*n.originX-i,-e*n.originY-i,t+2*i,e+2*i)}return this.widthSave=t,this.heightSave=e,this.paddingSave=i,this}}},function(t,e,i){"use strict";i.r(e),i.d(e,"CheckButton",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function CheckButton(e,i,n,o,a,s){var h=t.call(this,e,i,n,o,a)||this;return h.mSelected=!1,h.mNormalFrame=a,h.mSelectFrame=s,h.setInteractive(new Phaser.Geom.Rectangle(0,0,h.width,h.height),Phaser.Geom.Rectangle.Contains),h.on("pointerup",h.onSelected,h),h}return o(CheckButton,t),CheckButton.prototype.onSelected=function(){this.selected=!this.mSelected,this.emit("selected",this.mSelected)},Object.defineProperty(CheckButton.prototype,"selected",{get:function(){return this.mSelected},set:function(t){if(this.mSelected!==t){this.mSelected=t;var e=t?this.mSelectFrame:this.mNormalFrame;this.setFrame(e)}},enumerable:!1,configurable:!0}),CheckButton}(Phaser.GameObjects.Image)},function(t,e,i){"use strict";i.r(e),i.d(e,"BaseChatPanel",(function(){return s}));var n,o=i(6),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function BaseChatPanel(e,i){return t.call(this,e,i)||this}return a(BaseChatPanel,t),BaseChatPanel.prototype.appendChat=function(t){},Object.defineProperty(BaseChatPanel.prototype,"outChannel",{get:function(){return 0},enumerable:!1,configurable:!0}),BaseChatPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ToolTip",(function(){return s}));var n,o=i(70),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function ToolTip(e,i,n,o,a){var s=t.call(this,e)||this;return s.mScene=e,s.resStr=i,s.resJson=n,s.resUrl=o,s.uiScale=a,s.mWidth=0,s.mHeight=0,s.mBaseMidHeight=0,s.preLoad(),s}return a(ToolTip,t),ToolTip.prototype.setToolTipData=function(t){if(this.mText){var e=o.a.formatChineseString(t,this.mText.style.fontSize,this.mWidth-20);this.mText.setText(e),this.refreshTip()}},ToolTip.prototype.destroy=function(){this.topImage&&this.topImage.destroy(!0),this.midImage&&this.midImage.destroy(!0),this.botImage&&this.botImage.destroy(!0),this.mText&&this.mText.destroy(!0),this.mWidth=0,this.mHeight=0,this.removeAllListeners(),this.removeAll(),t.prototype.destroy.call(this,!0)},ToolTip.prototype.preLoad=function(){this.scene.load.atlas(this.resStr,this.resUrl,this.resJson),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.start()},ToolTip.prototype.init=function(){this.topImage=this.scene.make.image(void 0,!1),this.topImage.setOrigin(0,0),this.topImage.setTexture(this.resStr,ToolTip.TOP),this.midImage=this.scene.make.image(void 0,!1),this.midImage.setOrigin(0,0),this.midImage.setTexture(this.resStr,ToolTip.MID),this.botImage=this.scene.make.image(void 0,!1),this.botImage.setOrigin(0,0),this.botImage.setTexture(this.resStr,ToolTip.BOT),this.mText=this.scene.make.text(void 0,!1),this.mText.setFontFamily("YaHei"),this.mText.setFontStyle("bold"),this.mText.setFontSize(14),this.mText.style.align="center",this.mText.lineSpacing=15,this.mWidth=this.topImage.width,this.mBaseMidHeight=this.midImage.height,this.mText.style.fixedWidth=this.mWidth-20,this.mText.style.setWordWrapWidth(this.mWidth-20,!0),this.add(this.topImage),this.add(this.midImage),this.add(this.botImage),this.add(this.mText)},ToolTip.prototype.refreshTip=function(){this.midImage.scaleY=(this.mText.height+20)/this.mBaseMidHeight,this.mHeight=this.topImage.height+this.midImage.height*this.midImage.scaleY+this.botImage.height,this.topImage.y=-this.topImage.height>>1,this.midImage.y=this.topImage.y+this.topImage.height,this.botImage.y=this.midImage.y+this.midImage.height*this.midImage.scaleY,this.mText.x=this.mWidth-this.mText.style.fixedWidth>>1,this.mText.y=this.mHeight-this.mText.height-10>>1,this.setSize(this.mWidth,this.mHeight)},ToolTip.prototype.onLoadComplete=function(){this.init()},ToolTip.TOP="tip_top.png",ToolTip.MID="tip_mid.png",ToolTip.BOT="tip_bot.png",ToolTip}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"FriendMediator",(function(){return l}));var n,o=i(153),a=i(7),s=i(18),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function FriendMediator(e,i){var n=t.call(this)||this;return n.mUIType=s.a.Normal,n.mScene=e,n.world=i,n}return h(FriendMediator,t),FriendMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},FriendMediator.prototype.isSceneUI=function(){return!1},FriendMediator.prototype.resize=function(){if(this.mView)return this.mView.resize()},FriendMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new o.FriendPanel(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},FriendMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView=null)},FriendMediator.prototype.destroy=function(){t.prototype.destroy.call(this)},FriendMediator.NAME="FriendMediator",FriendMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"BasicRankPanel",(function(){return c}));var n,o=i(6),a=i(5),s=i(9),h=i(12),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function BasicRankPanel(e,i){var n=t.call(this,e,i)||this;return n.mTexts=[],n.disInteractive(),n}return l(BasicRankPanel,t),BasicRankPanel.prototype.addItem=function(t){if(this.setData("data",t),this.mInitialized){this.clearText();var e=t.text;if(e&&!(e.length<1)){this.mTitleLabel&&(this.mTitleLabel.setText(e[0].text),this.mTitleLabel.setData("node",e[0].node));for(var i=[-this.width/2+15,-this.width/2+63,-this.width/2+241],n=0,o=1;o<4;o++){n=(a=this.scene.make.text({x:i[o-1],y:-this.height/2+22,text:e?e[o].text:"123",style:{font:s.a.YAHEI_16_BOLD}},!1)).y,a.setData("node",e[o].node),a.setStroke("#000000",2),this.mChildContainer.add(a),this.mTexts.push(a)}n+=20;for(o=4;o<e.length;o++){var a,h=e[o],l=(o-4)%3,c=22*Math.floor((o-4)/3);(a=this.scene.make.text({x:i[l],y:n+c,text:h?h.text:"123",style:{font:s.a.YAHEI_14_BOLD}},!1)).setData("node",h.node),a.setStroke("#000000",2),this.mChildContainer.add(a),this.mTexts.push(a)}}}},BasicRankPanel.prototype.tweenView=function(t){},BasicRankPanel.prototype.update=function(t){this.addItem(t)},BasicRankPanel.prototype.destroy=function(){this.mBackground&&this.mBackground.destroy();for(var e=this.mTexts.length,i=0;i<e;i++){var n=this.mTexts[i];n&&(n.destroy(!0),n=null)}this.mTitleLabel&&this.mTitleLabel.destroy(!0),this.mTexts=[],this.mBackground=null,this.mTitleLabel=null,t.prototype.destroy.call(this)},BasicRankPanel.prototype.preload=function(){this.scene.load.image(a.a.getName(),a.a.getPNG()),this.scene.load.image(a.d.getName(),a.d.getPNG()),this.scene.load.atlas("clsBtn",a.h.getRes("ui/common/common_clsBtn.png"),a.h.getRes("ui/common/common_clsBtn.json")),this.scene.load.atlas("rank_atlas",a.h.getRes("ui/rank/rank_atlas.png"),a.h.getRes("ui/rank/rank_atlas.json")),t.prototype.preload.call(this)},BasicRankPanel.prototype.init=function(){if(!this.mInitialized){this.setSize(328,361),this.mBackground=new h.NinePatch(this.scene,0,0,328,361,a.a.getName(),null,a.a.getConfig()),this.add(this.mBackground),this.mChildContainer=this.scene.make.container({},!1),this.add(this.mChildContainer);var e=new h.NinePatch(this.scene,0,0,315,318,a.d.getName(),null,a.d.getConfig());this.mChildContainer.add(e);var i=this.scene.make.image({x:-this.width/2+20,y:-this.height/2-12,key:"rank_atlas",frame:"icon.png"},!1).setOrigin(0,0);this.add(i),this.mTitleLabel=this.scene.make.text({x:-this.width/2+54,y:-this.height/2-10,text:"排行榜",style:{font:s.a.YAHEI_20_BOLD}}).setOrigin(0,0).setStroke("#000000",2),this.add(this.mTitleLabel),t.prototype.init.call(this)}},BasicRankPanel.prototype.clearText=function(){for(var t=0,e=this.mTexts;t<e.length;t++){e[t].destroy()}this.mTexts.length=0},BasicRankPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"RightMediator",(function(){return l}));var n,o=i(41),a=i(155),s=i(13),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function RightMediator(e,i){return t.call(this,e,i)||this}return h(RightMediator,t),RightMediator.prototype.tweenView=function(t){this.mView&&this.mView.tweenView(t)},RightMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new a.RightBtnGroup(this.mScene,this.world),this.mView.show(e),this.world.emitter.on(s.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.on(s.a.PACKAGE_ITEM_ADD,this.heroItemChange,this),t.prototype.show.call(this,e))},RightMediator.prototype.hide=function(){this.mShow=!1,this.world.emitter.off(s.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.off(s.a.PACKAGE_ITEM_ADD,this.heroItemChange,this),this.mView&&(this.mView.hide(),this.mView=null)},RightMediator.prototype.heroItemChange=function(){this.world.roomManager.currentRoom&&this.world.roomManager.currentRoom.playerManager&&this.world.roomManager.currentRoom.playerManager.actor&&this.mView&&this.mView&&this.mView.refreshSlot()},RightMediator.NAME="RightMediator",RightMediator}(o.BaseFaceMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"BottomMediator",(function(){return h}));var n,o=i(41),a=i(156),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function BottomMediator(e,i){return t.call(this,e,i)||this}return s(BottomMediator,t),BottomMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new a.BottomBtnGroup(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},BottomMediator.NAME="BottomMediator",BottomMediator}(o.BaseFaceMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"ElementStorageMediator",(function(){return u}));var n,o=i(157),a=i(159),s=i(13),h=i(4),l=i(3),c=i(7),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function ElementStorageMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mStorage=new a.ElementStorage(n),o.mLayerManager=e,o.mScene=i,o.register(),o}return p(ElementStorageMediator,t),ElementStorageMediator.prototype.show=function(t){this.mParam=t,this.mView&&this.mView.isShow()||this.mShow||(this.mView=new o.ElementStoragePanel(this.mScene,this.world),this.mStorage.register(),this.mStorage.on(s.a.EDIT_MODE_QUERY_PACKAGE,this.onEditModeQueryPackageHandler,this),this.mLayerManager.addToUILayer(this.mView),this.mView.on("queryElement",this.onQueryElementHandler,this),this.mView.on("selectedElement",this.onSelectedElement,this),this.mView.show(t))},ElementStorageMediator.prototype.hide=function(){this.mParam=void 0,t.prototype.hide.call(this)},ElementStorageMediator.prototype.isSceneUI=function(){return!0},ElementStorageMediator.prototype.expand=function(){var t=this.getView();t&&t.expand()},ElementStorageMediator.prototype.collapse=function(){var t=this.getView();t&&t.collapse()},ElementStorageMediator.prototype.destroy=function(){this.unregister(),this.mStorage&&(this.mStorage.unregister(),this.mStorage=void 0),t.prototype.destroy.call(this)},ElementStorageMediator.prototype.getView=function(){return this.mView},ElementStorageMediator.prototype.onQueryElementHandler=function(t,e){this.mParam?this.mStorage.queryMarketPackage(t,e):this.mStorage.queryPackage(t,e)},ElementStorageMediator.prototype.register=function(){this.world.emitter.on(s.a.EDIT_PACKAGE_EXPANED,this.onExpanedHandler,this),this.world.emitter.on(s.a.EDIT_PACKAGE_COLLAPSE,this.onCollapseHandler,this)},ElementStorageMediator.prototype.unregister=function(){this.world.emitter.off(s.a.EDIT_PACKAGE_EXPANED,this.onExpanedHandler,this),this.world.emitter.off(s.a.EDIT_PACKAGE_COLLAPSE,this.onCollapseHandler,this)},ElementStorageMediator.prototype.onEditModeQueryPackageHandler=function(t){t&&this.getView().setProps(t)},ElementStorageMediator.prototype.onSelectedElement=function(t){var e=new h.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_SELECTED_SPRITE);e.content.id=t.id,this.world.connection.send(e)},ElementStorageMediator.prototype.onExpanedHandler=function(){this.expand()},ElementStorageMediator.prototype.onCollapseHandler=function(){this.collapse()},ElementStorageMediator.NAME="ElementStorageMediator",ElementStorageMediator}(c.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"Radio",(function(){return l})),i.d(e,"RadioItemRender",(function(){return c}));var n,o=i(12),a=i(5),s=i(21),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function Radio(e,i){var n=t.call(this,e)||this;return n.mIsShow=!1,n.mInit=!1,n.mScene=e,n.mConfig=i,n.init(),n}return h(Radio,t),Radio.prototype.setRadioData=function(t){this.clearRadioData(),this.itemList=[];for(var e=t.length,i=0;i<e;i++){var n=new c(this.mScene,this,this.mConfig.wid+10,20,this.mConfig.resKey,this.mConfig.resArrow),o=t[i];n.itemData={index:i,text:o.text,data:o.node.id,selected:!1,enabled:!0},n.x=this.mConfig.wid/2+25,n.y=33*i+23,this.add(n),this.itemList.push(n)}},Radio.prototype.clearRadioData=function(){if(this.itemList){for(var t=this.itemList.length,e=0;e<t;e++){var i=this.itemList[e];i&&(i.destroy(),i=null)}this.itemList.length=0}},Object.defineProperty(Radio.prototype,"isShow",{get:function(){return this.mIsShow},set:function(t){this.mIsShow=t},enumerable:!1,configurable:!0}),Radio.prototype.selectCall=function(t){this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)},Radio.prototype.destroy=function(){if(this.itemList){for(var e=this.itemList.length,i=0;i<e;i++){var n=this.itemList[i];n&&n.destroy()}this.itemList.length=0,this.itemList=null}this.removeAll(),this.removeAllListeners(),this.parentContainer&&this.parentContainer.remove(this),t.prototype.destroy.call(this,!0)},Radio.prototype.init=function(){var t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},Radio.prototype.onLoadCompleteHandler=function(){this.mInit=!0;var t=this.mConfig.resKey;this.mBg=new o.NinePatch(this.scene,0,0,this.mConfig.wid+20,this.mConfig.hei,a.a.getName(),null,a.a.getConfig()),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2-2,this.mBg.y=this.mConfig.hei/2,this.addAt(this.mBg,0),this.setSize(this.mConfig.wid,this.mConfig.hei),this.mConfig.completeBack&&this.mConfig.completeBack()},Radio}(Phaser.GameObjects.Container),c=function(t){function RadioItemRender(e,i,n,o,a,h){var l=t.call(this,e)||this;l.mSelectCallUI=i,l.mText=new s.a(e,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:n}});return l.mSelectBG=e.make.graphics(void 0,!1),l.mSelectBG.fillStyle(16763904,.8),l.mSelectBG.fillRect(-n>>1,-o>>1,n-36,o),l.mSelectBG.visible=!1,l.setSize(n,o),l.setInteractive(new Phaser.Geom.Rectangle(0,0,n,o),Phaser.Geom.Rectangle.Contains),l.addListen(),l.mArrow=e.make.image(void 0,!1),l.mArrow.setTexture(a,h),l.mArrow.x=-n/2-10,l.mArrow.y=0,l.mArrow.visible=!1,l.add([l.mSelectBG,l.mText,l.mArrow]),l}return h(RadioItemRender,t),RadioItemRender.prototype.addListen=function(){this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this),this.on("pointerdown",this.selectHandler,this)},RadioItemRender.prototype.removeListen=function(){this.off("pointerover",this.overHandler,this),this.off("pointerout",this.outHandler,this),this.off("pointerdown",this.selectHandler,this)},Object.defineProperty(RadioItemRender.prototype,"itemData",{get:function(){return this.mData},set:function(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width>>1,this.mText.y=-this.height/2+(this.height-this.mText.height>>1)},enumerable:!1,configurable:!0}),RadioItemRender.prototype.destroy=function(){this.removeListen(),this.mText.destroy(!0),this.mSelectBG.destroy(!0),this.mArrow.destroy(!0),this.mText=null,this.mData=null,this.mSelectCallUI=null,this.mArrow=null,t.prototype.destroy.call(this,!0)},RadioItemRender.prototype.setSelected=function(t){this.mSelectBG.visible=t,this.mArrow.visible=t,this.mSelectCallUI&&this.mSelectCallUI.selectCall(this.itemData)},RadioItemRender.prototype.overHandler=function(){this.mSelectBG.visible=!0,this.mArrow.visible=!0},RadioItemRender.prototype.outHandler=function(){this.mSelectBG.visible=!1,this.mArrow.visible=!1},RadioItemRender.prototype.selectHandler=function(){this.overHandler(),this.mSelectCallUI.selectCall(this.itemData)},RadioItemRender}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"InputTextFactory",(function(){return s})),i.d(e,"InputTextFieldEvent",(function(){return h})),i.d(e,"InputTextField",(function(){return l}));var n,o=i(23),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(){function InputTextFactory(t){this.mWorld=t}return InputTextFactory.prototype.getInputText=function(t,e){return new l(t,this.mWorld,e)},InputTextFactory}(),h={textchange:"textchange",textclick:"textclick",textdblclick:"textdblclick",textfocus:"textfocus",textblur:"textblur",textExit:"textExit"},l=function(t){function InputTextField(e,i,n){var o=t.call(this)||this;return o.mDelayTime=300,o.mScene=e,o.mWorld=i,o.textConfig=n,o.mTextField=e.make.text({x:n.x||0,y:n.y||0,stroke:"#000000",strokeThickness:2,align:n.align||"left",style:{color:n.color||"#fff",font:n.font||"16px YaHei",wordWrap:{width:n.textWidt||null}}},!1).setInteractive(new Phaser.Geom.Rectangle(0,0,n.textWidth,n.textHeight),Phaser.Geom.Rectangle.Contains),o.mTextField.setOrigin(.5,.5),o.mTextField.setAlign(n.align),o.mTextField.setText(n.text||""),o.mTextField.on("pointerdown",o.showText,o),o}return a(InputTextField,t),InputTextField.prototype.onBlur=function(){this.mInputText.onBlur()},InputTextField.prototype.onFocus=function(){this.mInputText.onFocus()},InputTextField.prototype.getText=function(){return this.mTextField.text},InputTextField.prototype.getSkin=function(){return this.mTextField},InputTextField.prototype.destroy=function(){this.mInputText&&this.mInputText.destroy(),this.mInputText=null},InputTextField.prototype.showText=function(){var t=this,e=1===this.textConfig.posType?-this.textConfig.textWidth>>1:-this.mWorld.getSize().width>>1,i=this.mTextField.text&&this.mTextField.text.length>0?this.mTextField.text:this.textConfig.minNum;this.mInputText?this.mInputText.setText(i):(this.mInputText=new o.a(this.mScene,{id:this.textConfig.id||"input",x:e||0,y:this.textConfig.y||0,width:this.textConfig.textWidth||100,height:this.textConfig.textHeight||100,type:this.textConfig.type||"",fontSize:this.textConfig.font||"16px YaHei",color:this.textConfig.color||"#fff","z-index":999,align:"left",text:i,posType:this.textConfig.posType}),this.mInputText.setOrigin(0,.6)),1===this.textConfig.posType&&(this.mTextField.visible=!1,this.mInputText.parentContainer||this.mTextField.parentContainer.add(this.mInputText)),this.mInputText.visible=!0,this.mInputText.on("textchange",this.onTextchange,this),this.mInputText.on("onclick",this.onTextClick,this),this.mInputText.on("ondblclick",this.onTextDbclick,this),this.mInputText.on("focus",this.onTextFocus,this),this.mInputText.on("blur",this.onTextBlur,this),this.mInputText.node.addEventListener("keypress",(function(e){13===(e.keyCode||e.which)&&(t.emit(h.textExit),t.hideText())})),this.mScene.input.on("gameobjectdown",this.sceneDown,this),this.mWorld.game.device.os.iOS&&!this.mWorld.game.device.os.desktop?this.setInputFocus():this.mInputTimeID=this.mScene.setTimeout((function(){t.setInputFocus()}),this.mDelayTime)},InputTextField.prototype.hideText=function(){if(this.mTextField.visible=!0,this.mInputText){this.mInputText.off("textchange",this.onTextchange,this),this.mInputText.off("onclick",this.onTextClick,this),this.mInputText.off("ondblclick",this.onTextDbclick,this),this.mInputText.off("focus",this.onTextFocus,this),this.mInputText.off("blur",this.onTextBlur,this),this.mScene.input.off("gameobjectdown",this.sceneDown,this);var t=this.mInputText.text;t.length>0&&this.mTextField.setText(t),this.mInputText.setText(""),this.mInputText.setBlur(),this.mInputText.visible=!1,this.mInputTimeID&&this.mScene.clearTimeout(this.mInputTimeID),1===this.textConfig.posType&&(this.mTextField.visible=!0)}},InputTextField.prototype.setInputFocus=function(){var t=document.all.namedItem(this.textConfig.id);t&&t.focus()},InputTextField.prototype.sceneDown=function(t,e){e&&e===this.mTextField||this.onTextBlur()},InputTextField.prototype.onTextchange=function(){if("number"===this.textConfig.type){var t=Number(this.mInputText.text);isNaN(t)&&(t=0),this.textConfig.minNum&&this.textConfig.maxNum&&(t<this.textConfig.minNum?t=this.textConfig.minNum:t>this.textConfig.maxNum&&(t=this.textConfig.maxNum)),this.mInputText.text=t+""}this.emit(h.textchange)},InputTextField.prototype.onTextClick=function(){this.emit(h.textclick)},InputTextField.prototype.onTextDbclick=function(){this.emit(h.textdblclick)},InputTextField.prototype.onTextFocus=function(){this.onFocus(),this.emit(h.textfocus)},InputTextField.prototype.onTextBlur=function(){this.onBlur(),this.hideText(),this.emit(h.textblur)},InputTextField}(Phaser.Events.EventEmitter)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaChatMediator",(function(){return c}));var n,o=i(174),a=i(100),s=i(176),h=i(7),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicaChatMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return l(PicaChatMediator,t),PicaChatMediator.prototype.show=function(){if(this.mView&&this.mView.isShow()||this.mShow)return this.mView.show(),void this.layerManager.addToUILayer(this.mView);this.mChat||(this.mChat=new s.PicaChat(this.world),this.mChat.on("chat",this.onChatHandler,this),this.mChat.register()),this.mView||(this.mView=new o.PicaChatPanel(this.scene,this.world),this.mView.on("showNavigate",this.onShowNavigateHandler,this),this.mView.on("chat",this.onSendChatHandler,this)),this.mView.show(),this.layerManager.addToUILayer(this.mView)},PicaChatMediator.prototype.isSceneUI=function(){return!0},PicaChatMediator.prototype.destroy=function(){this.mChat&&(this.mChat.destroy(),this.mChat=void 0),t.prototype.destroy.call(this)},PicaChatMediator.prototype.onShowNavigateHandler=function(){if(this.world){var t=this.world.uiManager.getMediator(a.PicaNavigateMediator.name);t&&(t.show(),this.mView.hide(),this.mView.removeListen(),this.layerManager.removeToUILayer(this.mView))}},PicaChatMediator.prototype.onChatHandler=function(t){if(this.mView&&this.world&&this.world.roomManager&&this.world.roomManager.currentRoom){var e=this.world.roomManager.currentRoom.playerManager.get(t.chatSenderid);e&&this.mView.appendChat("[color=#ffffff][当前]"+e.model.nickname+": "+t.chatContext+"[/color]\n")}},PicaChatMediator.prototype.onSendChatHandler=function(t){this.mChat&&("whosyourdaddy"===t&&this.world.uiManager.showMed("DebugLogger"),this.mChat.sendMessage(t))},PicaChatMediator.NAME="PicaChatMediator",PicaChatMediator}(h.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"InputPanel",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function InputPanel(e,i,n){var o=t.call(this)||this,a=e.cameras.main.width,s=e.cameras.main.height;return o.mBackground=e.add.graphics(),o.mBackground.fillStyle(0,.6),o.mBackground.fillRect(0,0,a,s).setInteractive(new Phaser.Geom.Rectangle(0,0,a,s),Phaser.Geom.Rectangle.Contains),o.mInput=e.add.rexInputText(6*i.uiRatio,6*i.uiRatio,a-12*i.uiRatio,40*i.uiRatio,{fontSize:20*i.uiRatio+"px",color:"#0",text:n,backgroundColor:"#FFFFFF",borderColor:"#FF9900"}).setOrigin(0,0).setFocus(),o.mInput.node.addEventListener("keypress",(function(t){13===(t.keyCode||t.which)&&o.onCloseHandler()})),o}return o(InputPanel,t),InputPanel.prototype.onCloseHandler=function(){this.emit("close",this.mInput.text),this.mBackground.destroy(),this.mInput.destroy(),this.destroy()},InputPanel}(Phaser.Events.EventEmitter)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNavigateMediator",(function(){return l}));var n,o=i(175),a=i(98),s=i(7),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicaNavigateMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return h(PicaNavigateMediator,t),PicaNavigateMediator.prototype.show=function(){if(this.mView&&this.mView.isShow()||this.mShow)return this.mView.show(),void this.layerManager.addToUILayer(this.mView);this.mView||(this.mView=new o.PicaNavigatePanel(this.scene,this.world),this.mView.on("showPanel",this.onShowPanelHandler,this),this.mView.on("close",this.onCloseHandler,this)),this.mView.show(),this.layerManager.addToUILayer(this.mView)},PicaNavigateMediator.prototype.isSceneUI=function(){return!1},PicaNavigateMediator.prototype.onCloseHandler=function(){if(this.world){var t=this.world.uiManager.getMediator(a.PicaChatMediator.name);t&&(t.show(),this.mView.hide(),this.mView.removeListen(),this.layerManager.removeToUILayer(this.mView))}},PicaNavigateMediator.prototype.onShowPanelHandler=function(t,e){if(t&&this.world){var i=this.world.uiManager;e?i.showMed(t,e):i.showMed(t)}},PicaNavigateMediator.NAME="PicaNavigateMediator",PicaNavigateMediator}(s.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n,o=i(25),a=i(60),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function TabButton(e,i,n,o,a,s,h,l,c){var p=t.call(this,e,i,n,o,a,s,h,l,c)||this;return p.mSelected=!1,p}return s(TabButton,t),Object.defineProperty(TabButton.prototype,"selected",{get:function(){return this.mSelected},set:function(t){this.mSelected=t;var e=t?o.b.Select:o.b.Normal;this.buttonStateChange(e),this.emit("selectChange",t)},enumerable:!1,configurable:!0}),TabButton.prototype.destroy=function(){this.selected=!1,t.prototype.destroy.call(this)},TabButton.prototype.onPointerUpHandler=function(t){this.interactiveBoo?((!this.mIsMove||Date.now()-this.mDownTime>this.mPressTime)&&Math.abs(t.downX-t.upX)<30&&Math.abs(t.downY-t.upY)<30&&(this.soundGroup&&this.soundGroup.up&&this.playSound(this.soundGroup.up),this.emit(a.a.MouseEvent.Tap,t,this),this.selected=!0),clearTimeout(this.mPressDelay),this.mIsMove=!1,this.mDownTime=0):this.soundGroup&&this.soundGroup.disabled&&this.playSound(this.soundGroup.disabled)},TabButton.prototype.onPointerDownHandler=function(t){var e=this;this.interactiveBoo?(this.soundGroup&&this.soundGroup.down&&this.playSound(this.soundGroup.down),this.mDownTime=Date.now(),this.mPressTime=setTimeout((function(){e.emit(a.a.MouseEvent.Hold,e)}),this.mPressTime),this.emit(a.a.MouseEvent.Down,this)):this.soundGroup&&this.soundGroup.disabled&&this.playSound(this.soundGroup.disabled)},TabButton}(o.a)},function(t,e,i){"use strict";var n=i(67);i.d(e,"b",(function(){return n.b})),i.d(e,"a",(function(){return n.a}))},function(t,e,i){"use strict";i.r(e),i.d(e,"DebugLoggerMediator",(function(){return l}));var n,o=i(208),a=i(7),s=i(18),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function DebugLoggerMediator(e,i,n){var o=t.call(this)||this;return o.mUIType=s.a.Scene,o.mScene=i,o.world=n,o}return h(DebugLoggerMediator,t),DebugLoggerMediator.prototype.resize=function(){if(this.mView)return this.mView.resize()},DebugLoggerMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},DebugLoggerMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new o.DebugLogger(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},DebugLoggerMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView.hide(),this.mView=null)},DebugLoggerMediator.prototype.destroy=function(){this.mScene=null,t.prototype.destroy.call(this)},DebugLoggerMediator.NAME="DebugLoggerMediator",DebugLoggerMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"TextButton",(function(){return s}));var n,o=i(9),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function TextButton(e,i,n,a,s,h){void 0===n&&(n=1);var l=t.call(this,e,s,h)||this;return l.normalColor="#FFFFFF",l.changeColor="#0099cc",l.mText=l.scene.make.text({text:a,style:{fontSize:15*window.devicePixelRatio,fontFamily:o.a.DEFULT_FONT}},!1),l.add(l.mText),l}return a(TextButton,t),TextButton.prototype.setText=function(t){this.mText.text=t},TextButton.prototype.setFontSize=function(t){this.mText.setFontSize(t)},TextButton.prototype.setFontStyle=function(t){this.mText.setFontStyle(t)},TextButton.prototype.setStyle=function(t){this.mText.setStyle(t)},TextButton.prototype.setNormalColor=function(t){this.normalColor=t},TextButton.prototype.setChangeColor=function(t){this.changeColor=t},TextButton.prototype.changeDown=function(){this.mText.setFill(this.changeColor)},TextButton.prototype.changeNormal=function(){this.mText.setFill(this.normalColor)},TextButton.prototype.onPointerUpHandler=function(t){this.emit("click",t,this)},Object.defineProperty(TextButton.prototype,"text",{get:function(){return this.mText},enumerable:!1,configurable:!0}),TextButton}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";var n=i(246),o=i(86),a=i(323),s=i(285),h=i.n(s),l=i(145),c=i(144),p={enableData(){return void 0===this.data&&(this.data={}),this},getData(t,e){return this.enableData(),void 0===t?this.data:h()(this.data,t,e)},setData(t,e){return this.enableData(),this.data[t]=e,this},incData(t,e,i){return void 0===i&&(i=0),this.enableData(),this.setData(t,this.getData(t,i)+e),this},mulData(t,e,i){return void 0===i&&(i=0),this.enableData(),this.setData(t,this.getData(t,i)*e),this},clearData(){return this.data&&Object(l.a)(this.data),this},resetData(t){if(this.clearData(),t)for(var e in this.enableData(),t)this.data[e]=t[e];return this},cloneData(){return this.data?Object(c.a)(this.data):{}}};class Cell{constructor(t,e){this.container=null,this.setParent(t),this._deltaHeight=0}setParent(t){this.parent=t,this.parentContainer=t.getParentContainer()}destroy(t){if(void 0===t&&(t=!1),!t){var e=this.parent;0!==this.deltaHeight&&e.nonZeroDeltaHeightCount--,this.destroyContainer()}this.data=void 0,this.container=null,this.parent=void 0,this.parentContainer=void 0}get table(){return this.parent}get scrollMode(){return this.parentContainer.scrollMode}get colIndx(){return this.parent.cellIndxeToColIndex(this.index)}get rowIndx(){return this.parent.cellIndxeToRowIndex(this.index)}getContainer(){return this.container}setContainer(t){return t?(this.container&&this.container.destroy(),this.container=t,this.parentContainer.add(t),this):(this.destroyContainer(),this)}destroyContainer(){return this.container&&(this.container.destroy(),this.container=null),this}popContainer(){if(this.container){var t=this.container;return this.container=null,this.parentContainer.remove(t),t}return null}setXY(t,e){return this.container&&this.parentContainer.setChildLocalPosition(this.container,t,e),this}get deltaHeight(){return this._deltaHeight}set deltaHeight(t){null==t&&(t=0);var e=this.parent;0===this._deltaHeight&&0!==t?e.nonZeroDeltaHeightCount++:0!==this._deltaHeight&&0===t&&e.nonZeroDeltaHeightCount--,this._deltaHeight=t}setDeltaHeight(t){return this.deltaHeight=t,this}get height(){return 0===this.scrollMode?this.deltaHeight+this.parent.defaultCellHeight:this.parent.defaultCellWidth}set height(t){1!==this.scrollMode&&this.setDeltaHeight(t-this.parent.defaultCellHeight)}setHeight(t){return this.height=t,this}get width(){return 0===this.scrollMode?this.parent.defaultCellWidth:this.deltaHeight+this.parent.defaultCellHeight}set width(t){0!==this.scrollMode&&this.setDeltaHeight(t-this.parent.defaultCellHeight)}setWidth(t){return this.width=t,this}get scene(){return this.parentContainer.scene}}Object.assign(Cell.prototype,p);var u=Cell,m=i(73);const d=Phaser.Utils.Objects.GetValue,f=Phaser.Utils.Array.SpliceOne;var y=class Table_Table{constructor(t,e){this.parent=t,this.cells=[],this.cellPool=new m.a,this.resetFromJSON(e)}resetFromJSON(t){return this.colCount=void 0,this._nonZeroDeltaHeightCount=0,this.resetTotalRowsHeight(),this.zoom=d(t,"zoom",1),this.dpr=d(t,"dpr",1),this.cellOriginX=d(t,"cellOriginX",.5),this.cellOriginY=d(t,"cellOriginY",.5),this.padX=d(t,"cellPadX",0),this.padY=d(0,"cellPadY",0),this.setDefaultCellHeight(d(t,"cellHeight",30)),this.setDefaultCellWidth(d(t,"cellWidth",30)),this.initCells(d(t,"cellsCount",0)),this.setColumnCount(d(t,"columns",1)),this}destroy(t){for(var e=0,i=this.cells.length;e<i;e++)this.freeCell(this.cells[e],t);this.cellPool.destroy(),this.cells=void 0,this.parent=void 0}get nonZeroDeltaHeightCount(){return this._nonZeroDeltaHeightCount}set nonZeroDeltaHeightCount(t){this._nonZeroDeltaHeightCount!==t&&(this._nonZeroDeltaHeightCount=t,this.resetTotalRowsHeight())}get defaultCellHeightMode(){return 0===this.nonZeroDeltaHeightCount}setDefaultCellHeight(t){return this.defaultCellHeight=t,this}setDefaultCellWidth(t){return this.defaultCellWidth=t,this}initCells(t){var e=this.cells;e.length=t;for(var i=0;i<t;i++)e[i]=null;return this}insertNewCells(t,e){var i=this.cells;if(t===i.length){var n=t+e;i.length=n;for(var o=t;o<n;o++)i[o]=null}else{var a=[];a.length=e;for(o=0;o<e;o++)a[o]=null;this.cells.splice(t,0,...a)}return this.resetTotalRowsHeight(),this}removeCells(t,e){for(var i=t+e,n=t;n<i;n++)this.freeCell(n);return i===this.cells.length?this.cells.length=t:(1===e?f(this.cells,t):this.cells.splice(t,e),this.buildCellIndex(t)),this.resetTotalRowsHeight(),this}setColumnCount(t){return this.colCount=t,this.resetTotalRowsHeight(),this}get rowCount(){return Math.ceil(this.cells.length/this.colCount)}get cellsCount(){return this.cells.length}isValidCellIdx(t){return t>=0&&t<this.cells.length}heightToRowIndex(t,e){if(this.defaultCellHeightMode){var i=t/this.defaultCellHeight;return i=e?Math.ceil(i):Math.floor(i)}var n,o=this.rowCount,a=t;for(i=0;;){if(n=i>=0&&i<o,!((a-=this.getRowHeight(i))>0&&n)){if(0===a)return i;if(e){var s=i;(n=(i+=1)>=0&&i<o)||(i=s)}return i}i+=1}}widthToColIndex(t,e){var i=t/this.defaultCellWidth;return i=e?Math.ceil(i):Math.floor(i)}colRowToCellIndex(t,e){return t>=this.colCount?null:e*this.colCount+t}rowIndexToHeight(t,e){if(this.defaultCellHeightMode)return(e-t+1)*this.defaultCellHeight+this.defaultCellHeight*this.cellOriginY+this.padY;for(var i=0,n=t;n<=e;n++)i+=this.getRowHeight(n);return i}colIndexToWidth(t,e){return(e-t+1)*this.defaultCellWidth+this.defaultCellWidth*this.cellOriginX+this.padX}getRowHeight(t){var e=this.colCount;if(e<=1)return this.getCellHeight(this.colRowToCellIndex(0,t));for(var i,n=0,o=0;o<e;o++)n<(i=this.getCellHeight(this.colRowToCellIndex(o,t)))&&(n=i);return n}getColWidth(t){return this.defaultCellWidth}getCellHeight(t){if(!this.isValidCellIdx(t))return 0;var e;if(this.defaultCellHeightMode)e=this.defaultCellHeight;else{var i=this.getCell(t,!1),n=i?i.deltaHeight:0;e=this.defaultCellHeight+n}return e}resetTotalRowsHeight(){this._totalRowsHeight=null}get totalRowsHeight(){return null===this._totalRowsHeight&&(this._totalRowsHeight=this.rowIndexToHeight(0,this.rowCount-1)),this._totalRowsHeight}get totalColumnWidth(){return this.colCount*this.defaultCellWidth+this.cellOriginX*this.defaultCellWidth+this.padX}cellIndxeToColIndex(t){return t%this.colCount}cellIndxeToRowIndex(t){return Math.floor(t/this.colCount)}getCell(t,e){if(!this.isValidCellIdx(t))return null;if(void 0===e&&(e=!0),null===this.cells[t]&&e){var i=this.newCell(t);this.cells[t]=i}return this.cells[t]}newCell(t){var e=this.cellPool.pop();return null===e?e=new u(this):e.setParent(this),e.index=t,e}buildCellIndex(t){void 0===t&&(t=0);for(var e,i=this.cells,n=t,o=i.length;n<o;n++)(e=i[n])&&(e.index=n);return this}getParentContainer(){return this.parent}freeCell(t,e){return"number"==typeof t&&(t=this.cells[t]),t?(t.destroy(e),e||this.cellPool.push(t),this):this}},g=i(87),_=i(38),v=i(180),methods_SetTableOY=function(t){var e=this.table,i=this.topTableOY,n=this.bottomTableOY,o=t>this.topTableOY,a=t<this.bottomTableOY;this.clampTableOXYMode&&(e.rowCount<e.heightToRowIndex(this.instHeight,!0)?t=0:o?t=i:a&&(t=n));return this._tableOY!==t&&(this._tableOY=t),o&&(this.execeedTopState||this.emit("execeedtop",this,t,i)),this.execeedTopState=o,a&&(this.execeedBottomState||this.emit("execeedbottom",this,t,n)),this.execeedBottomState=a,this},methods_SetTableOX=function(t){var e=this.table,i=this.leftTableOX,n=this.rightTableOX,o=t>this.leftTableOX,a=t<this.rightTableOX;this.clampTableOXYMode&&(e.colCount<e.widthToColIndex(this.instWidth,!0)?t=0:o?t=i:a&&(t=n));return this._tableOX!==t&&(this._tableOX=t),o&&(this.execeedLeftState||this.emit("execeedleft",this,t,i)),this.execeedLeftState=o,a&&(this.execeedRightState||this.emit("execeedright",this,t,n)),this.execeedRightState=a,this},updatetable_HideCell=function(t){if(this.emit("cellinvisible",t),this.cellContainersPool){var e=t.popContainer();e&&this.cellContainersPool.killAndHide(e)}t.destroyContainer()},updatetable_HideCells=function(){var t=this.preVisibleCells,e=this.visibleCells;t.iterate((function(t){e.contains(t)||updatetable_HideCell.call(this,t)}),this)},updatetable_ShowCell=function(t){var e=null;if(this.cellContainersPool&&null!==(e=this.cellContainersPool.getFirstDead())&&e.setActive(!0).setVisible(!0),this.emit("cellvisible",t,e),this.cellContainersPool){var i=t.getContainer();i?null===e?this.cellContainersPool.add(i):e!==i&&(this.cellContainersPool.add(i),this.cellContainersPool.killAndHide(e)):null!==e&&this.cellContainersPool.killAndHide(e)}},GetCellTLX=function(t){var e=0===this.scrollMode?this.topLeftX:this.topLeftY;return this.tableOX+this.table.colIndexToWidth(0,t-1)+e},GetCellTLY=function(t){var e=0===this.scrollMode?this.topLeftY:this.topLeftX;return this.tableOY+this.table.rowIndexToHeight(0,t-1)+e},updatetable_ShowCells=function(){if(0!==this.cellsCount){var t=this.table,e=t.heightToRowIndex(-this.tableOY);e<0&&(e=0);var i=t.widthToColIndex(-this.tableOX);i<0&&(i=0);var n=t.colRowToCellIndex(i,e),o=this.bottomBound,a=this.rightBound,s=t.cellsCount-1,h=t.colCount-1,l=GetCellTLX.call(this,i),c=l,p=GetCellTLY.call(this,e);for(this.visibleStartY=null,this.visibleEndY=null,this.visibleStartX=null,this.visibleEndX=null,this.lastVisibleCellIdx=null;p<o&&n<=s;){if(this.table.isValidCellIdx(n)){null===this.visibleStartY&&(this.visibleStartY=e,this.visibleEndY=e),null===this.visibleStartX&&(this.visibleStartX=i,this.visibleEndX=i),null===this.lastVisibleCellIdx&&(this.lastVisibleCellIdx=n),this.visibleEndY<e&&(this.visibleEndY=e),this.visibleEndX<i&&(this.visibleEndX=i),this.lastVisibleCellIdx<n&&(this.lastVisibleCellIdx=n);var u=t.getCell(n,!0);this.visibleCells.set(u),this.preVisibleCells.contains(u)||updatetable_ShowCell.call(this,u),0===this.scrollMode?u.setXY(c,p):u.setXY(p,c)}c<a&&i<h?(c+=t.getColWidth(i),i+=1):(c=l,p+=t.getRowHeight(e),i=this.visibleStartX,e+=1),n=t.colRowToCellIndex(i,e)}}},b=i(286),updatetable_MaskCells=function(){for(var t,e=[],i=this.visibleCells.entries,n=0,o=i.length;n<o;n++)(t=i[n].getContainer())&&(t.isRexContainerLite?t.getAllChildren(e):e.push(t));Object(b.a)(this,this.cellsMask,e)},ClearVisibleCellIndexes=function(){var t=this.preVisibleCells;this.preVisibleCells=this.visibleCells,this.visibleCells=t,this.visibleCells.clear()},updatetable_UpdateTable=function(t){return void 0===t&&(t=!1),t&&(ClearVisibleCellIndexes.call(this),updatetable_HideCells.call(this)),ClearVisibleCellIndexes.call(this),updatetable_ShowCells.call(this),updatetable_HideCells.call(this),updatetable_MaskCells.call(this),this},methods_IsCellVisible=function(t){var e=this.table.getCell(t,!1);return e&&this.visibleCells.contains(e)},PointerToCellIndex=function(t,e){e-=this.y+this.topLeftY,t-=this.x+this.topLeftX;var i=this.tableOY-(0===this.scrollMode?e:t),n=this.tableOX-(0===this.scrollMode?t:e),o=this.table,a=o.heightToRowIndex(-i),s=o.widthToColIndex(-n),h=o.colRowToCellIndex(s,a);return null===h?null:this.isCellVisible(h)?h:null},methods_SetCellsCount=function(t){var e=this.cellsCount;return e===t||(e>t?this.removeCells(t,e-t):this.insertNewCells(e,t-e)),this};const P=Phaser.Math.Clamp;var S={setTableOY:methods_SetTableOY,setTableOX:methods_SetTableOX,updateTable:updatetable_UpdateTable,isCellVisible:methods_IsCellVisible,pointerToCellIndex:PointerToCellIndex,pointerToCellContainer:function(t,e){var i=PointerToCellIndex.call(this,t,e);if(null!==i)return this.getCellContainer(i)},eachVisibleCell:function(t,e){return this.visibleCells.each(t,e),this},iterateVisibleCell:function(t,e){return this.visibleCells.iterate(t,e),this},eachCell:function(t,e){return this.table.cells.slice().forEach(t,e),this},iterateCell:function(t,e){return this.table.cells.forEach(t,e),this},setCellsCount:methods_SetCellsCount,insertNewCells:function(t,e){return"object"==typeof t&&(t=t.index),void 0===e&&(e=1),e<=0||(t=P(t,0,this.cellsCount),this.table.insertNewCells(t,e)),this},removeCells:function(t,e){if("object"==typeof t&&(t=t.index),void 0===e&&(e=1),t<0&&(e+=t,t=0),e<=0)return this;if(t>this.cellsCount)return this;if(t<=this.lastVisibleCellIdx)for(var i,n=this.preVisibleCells,o=this.visibleCells,a=t,s=t+e;a<s;a++)(i=this.getCell(a,!1))&&(o.contains(i)&&(updatetable_HideCell.call(this,i),o.delete(i)),n.delete(i));return this.table.removeCells(t,e),this},setColumnCount:function(t){return this.table.colCount===t||this.table.setColumnCount(t),this},setGridSize:function(t,e){return this.setCellsCount(t*e),this.table.setColumnCount(t),this}};const w=a.a,T=Phaser.GameObjects.Components,C=Phaser.Structs.Set,D=Phaser.Utils.Objects.GetValue;class GridTable_GridTable extends w{constructor(t,e,i,n,o,a){void 0===a&&(a={}),super(t,e,i,n,o),this.type="rexGridTable",this._tableOX=D(a,"tableOX",0),this._tableOY=D(a,"tableOY",0),this.visibleCells=new C,this.preVisibleCells=new C,this.visibleStartX=null,this.visibleEndX=null,this.visibleStartY=null,this.visibleEndY=null,this.lastVisibleCellIdx=null,this.execeedTopState=!1,this.execeedBottomState=!1,this.execeedLeftState=!1,this.execeedRightState=!1;var s=D(a,"reuseCellContainer",!1);this.cellContainersPool=s?t.add.group():void 0;var h=D(a,"cellVisibleCallback",null);if(null!==h){var l=D(a,"cellVisibleCallbackScope",void 0);this.on("cellvisible",h,l)}if(null!==(h=D(a,"cellInvisibleCallback",null))){l=D(a,"cellInvisibleCallbackScope",void 0);this.on("cellinvisible",h,l)}if(this.cellsMask=void 0,this.setCellsMask(D(a,"mask",!0)),this.cellsMaskGameObject=void 0,this.setScrollMode(D(a,"scrollMode",0)),this.setClampMode(D(a,"clamplTableOXY",!0)),0===this.scrollMode){var c=D(a,"cellWidth",void 0);if(this.expandCellSize=void 0===c,void 0===c){var p=D(a,"columns",1);a.cellWidth=this.width/p}}else{c=D(a,"cellHeight",void 0);var u=D(a,"cellWidth",void 0);this.expandCellSize=void 0===c,a.cellWidth=c,a.cellHeight=u}this.scrollMode;D(a,"cellOriginX",.5)>0&&this.scrollMode&&(a.cellOriginX=0);D(a,"cellOriginY",.5)>0&&!this.scrollMode&&(a.cellOriginY=0),this.table=new y(this,a),this.updateTable()}destroy(t){this.scene&&(this.table.destroy(t),this.table=void 0,this.cellContainersPool&&(this.cellContainersPool.destroy(!0),this.cellContainersPool=void 0),super.destroy(t))}setScrollMode(t){return"string"==typeof t&&(t=M[t.toLowerCase()]),this.scrollMode=t,this}setClampMode(t){return this.clampTableOXYMode=t,this}setColumnCount(t){return this.table.setColumnCount(t),this}get tableOY(){return this._tableOY}get tableOX(){return this._tableOX}set tableOY(t){this.setTableOY(t).updateTable(!0)}set tableOX(t){this.setTableOX(t).updateTable(!0)}setTableOXY(t,e){return this.setTableOY(e).setTableOX(t),this}addTableOY(t){return this.setTableOY(this.tableOY+t),this}addTableOX(t){return this.setTableOX(this.tableOX+t),this}addTableOXY(t,e){return this.addTableOY(e).addTableOX(t),this}setTableOYByPercentage(t){return this.setTableOY(-this.tableVisibleHeight*t),this}getTableOYPercentage(){var t=this.tableVisibleHeight;return 0===t?0:this.tableOY/-t}set t(t){this.setTableOYByPercentage(t).updateTable()}get t(){return this.getTableOYPercentage()}getCells(){return this.table.cells}getCell(t){return this.table.getCell(t,!0)}getCellContainer(t){var e,i=this.table.getCell(t,!1);return i&&(e=i.getContainer()),e}get cellsCount(){return this.table.cellsCount}get columnCount(){return this.table.colCount}setCellHeight(t,e){return("number"==typeof t?this.table.getCell(t,!0):t).height=e,this}setCellWidth(t,e){return("number"==typeof t?this.table.getCell(t,!0):t).width=e,this}setCellsMask(t){var e,i;return!0===t?(e=!0,i=0):!1===t?e=!1:(e=D(t,"mask",!0),i=D(t,"padding",0)),e&&(this.cellsMaskGameObject=new g.a(this,0,i),this.cellsMask=this.cellsMaskGameObject.createGeometryMask(),this.add(this.cellsMaskGameObject)),this}getCellsMaskGameObject(){return this.cellsMaskGameObject}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get tableHeight(){return this.table.totalRowsHeight}get tableWidth(){return this.table.totalColumnWidth}get topTableOY(){return 0}get bottomTableOY(){return-this.tableVisibleHeight}get leftTableOX(){return 0}get rightTableOX(){return-this.tableVisibleWidth}get tableVisibleHeight(){var t=this.tableHeight,e=this.instHeight;return t>e?t-e:0}get tableVisibleWidth(){var t=this.tableWidth,e=this.instWidth;return t>e?t-e:0}get bottomLeftY(){return-this.displayHeight*this.originY+this.displayHeight}get topRightX(){return-this.displayWidth*this.originX+this.displayWidth}get topLeftX(){return-this.displayWidth*this.originX}get topLeftY(){return-this.displayHeight*this.originY}get bottomBound(){return 0===this.scrollMode?this.bottomLeftY:this.topRightX}get rightBound(){return 0===this.scrollMode?this.topRightX:this.bottomLeftY}resize(t,e){return this.width===t&&this.height===e||(super.resize(t,e),this.cellsMask&&Object(_.a)(Object(v.a)(this.cellsMask),t,e),this.expandCellSize&&this.table.setDefaultCellWidth(this.instWidth/this.table.colCount),this.updateTable(!0)),this}}Object.assign(GridTable_GridTable.prototype,T.GetBounds,S);const M={v:0,vertical:0,h:1,horizontal:1};var O=GridTable_GridTable,gridtable_InjectProperties=function(t){Object.defineProperty(t,"childOY",{configurable:!0,get:function(){return t.tableOY},set:function(e){t.tableOY=e}}),Object.defineProperty(t,"topChildOY",{get:function(){return t.topTableOY}}),Object.defineProperty(t,"bottomChildOY",{get:function(){return t.bottomTableOY}})},gridtable_TableOnCellVisible=function(t){t.on("cellvisible",(function(t,e){var i=this.createCellContainerCallback,n=this.createCellContainerCallbackScope;t.item=this.items[t.index],(e=n?i.call(n,t,e):i(t,e))&&(e.setOrigin&&e.setOrigin(0),e.isRexSizer&&e.layout()),t.item=void 0,t.setContainer(e)}),this)},x=i(181),input_EmitCellEvent=function(t,e,i,n,o){var a;if(null!=(a=void 0===o?n:i.pointerToCellIndex(n,o))){var s=i.getCellContainer(a);t.emit(e,s,a)}},input_ClickCell=function(t,e){t._click=new x.a(t,{threshold:10}),t._click.on("click",(function(t,e,i){input_EmitCellEvent(this.eventEmitter,"cell.click",e,i.x,i.y)}),this)},OnMove=function(t){if(!t.isDown){var e=this.childrenMap.child,i=e.pointerToCellIndex(t.x,t.y);if(i!==this._lastOverCellIndex){var n=this._lastOverCellIndex;this._lastOverCellIndex=i,input_EmitCellEvent(this.eventEmitter,"cell.out",e,n),input_EmitCellEvent(this.eventEmitter,"cell.over",e,i)}}},OnOut=function(){var t=this.childrenMap.child,e=this._lastOverCellIndex;this._lastOverCellIndex=void 0,input_EmitCellEvent(this.eventEmitter,"cell.out",t,e)},input_OverCell=function(t,e){t.on("pointermove",OnMove,this).on("pointerover",OnMove,this).on("pointerup",OnOut,this).on("pointerout",OnOut,this)},E=i(113);const B=Phaser.Utils.Objects.GetValue;var input_TapCell=function(t,e){var i=B(e,"press",void 0);t._tap=new E.a(t,i),t._tap.on("tap",(function(t){var e=`cell.${t.tapsCount}tap`;input_EmitCellEvent(this.eventEmitter,e,t.gameObject,t.x,t.y)}),this)},I=i(114);const A=Phaser.Utils.Objects.GetValue;var input_PressCell=function(t,e){var i=A(e,"press",void 0);t._press=new I.a(t,i),t._press.on("pressstart",(function(e){var i=t.pointerToCellIndex(e.x,e.y);e._cellIndex=i,input_EmitCellEvent(this.eventEmitter,"cell.pressstart",t,i)}),this).on("pressend",(function(e){var i=e._cellIndex;e._cellIndex=void 0,input_EmitCellEvent(this.eventEmitter,"cell.pressend",t,i)}),this)},R=i(327);const k=Phaser.Utils.Objects.GetValue;var input_SwipeCell=function(t,e){var i=k(e,"swipe",void 0);void 0===i&&(i={}),i.dir="4dir",t._swipe=new R.a(t,i),t._swipe.on("swipe",(function(e){if(0===t.scrollMode?e.left||e.right:e.up||e.down){var i=t.pointerToCellIndex(e.x,e.y),n=e.left?"left":e.right?"right":e.up?"up":"down";input_EmitCellEvent(this.eventEmitter,"cell.swipe"+n,t,i)}}),this)},input_TableSetInteractive=function(t,e){t.setInteractive(),input_ClickCell.call(this,t,e),input_OverCell.call(this,t,e),input_TapCell.call(this,t,e),input_PressCell.call(this,t,e),input_SwipeCell.call(this,t,e)},L=i(51),gridtable_SetItems=function(t){void 0===t?this.items.length=0:this.items=t;var e=this.childrenMap.child;return e.setCellsCount(this.items.length),e.updateTable(!0),this.resizeController(),this};const F=Phaser.Utils.Objects.GetValue;class gridtable_GridTable_GridTable extends n.a{constructor(t,e){void 0===e&&(e={});var i=Object(o.a)(e),n=F(e,"table",void 0);void 0===n&&(n={}),n.scrollMode=i,n.clamplTableOXY=F(e,"clamplChildOY",!1);var a,s,h=F(n,"width",void 0),l=F(n,"height",void 0),c=new O(t,0,0,h,l,n);t.add.existing(c),0===i?(a=void 0===h?1:0,s=void 0===l):(a=void 0===l?1:0,s=void 0===h),gridtable_InjectProperties(c),e.type="rexGridTable",e.child={gameObject:c,proportion:a,expand:s};var p=F(e,"space",void 0);p&&(p.child=p.table),super(t,e),this.addChildrenMap("table",c),this.eventEmitter=F(e,"eventEmitter",this);var u=F(e,"createCellContainerCallback",L.a),m=F(e,"createCellContainerCallbackScope",void 0);this.setCreateCellContainerCallback(u,m),gridtable_TableOnCellVisible.call(this,c),F(n,"interactive",!0)&&input_TableSetInteractive.call(this,c,n),this.setItems(F(e,"items",[]))}set tableOX(t){const e=this.getElement("table");e&&(e.tableOX=t)}set tableOY(t){const e=this.getElement("table");e&&(e.tableOY=t)}setColumnCount(t){const e=this.getElement("table");return e&&e.setColumnCount(t),this}getCells(){return this.getElement("table").table.cells}getCell(t){return this.getElement("table").getCell(t,!0)}setCreateCellContainerCallback(t,e){return this.createCellContainerCallback=t,this.createCellContainerCallbackScope=e,this}refresh(){return this.setItems(this.items),this}}var N={setItems:gridtable_SetItems};Object.assign(gridtable_GridTable_GridTable.prototype,N);e.a=gridtable_GridTable_GridTable},function(t,e,i){"use strict";var n=i(83),o=i(139),a=i(282),basesizer_PushIntoBounds=function(t){return void 0===t&&(t=Object(a.a)(this.scene)),this.left=Math.max(this.left,t.left),this.right=Math.min(this.right,t.right),this.top=Math.max(this.top,t.top),this.bottom=Math.min(this.bottom,t.bottom),this},s=i(140),h=i(65),l=i(43);const c=Phaser.Utils.Objects.GetValue;var DefaultCreateTextCallback=function(t,e,i){return t.add.text(0,0,"")},p=new Phaser.Geom.Rectangle,basesizer_DrawBounds=function(t,e){var i,n,o,a,u=t.scene;if("number"==typeof e)i=e;else{i=c(e,"color",16777215);var m=c(e,"name",!1);m&&(n=c(m,"createTextCallback",DefaultCreateTextCallback),o=c(m,"createTextCallbackScope",void 0),"string"==typeof(a=c(m,"align","left-top"))&&(a=s.a[a]))}if(n&&!t.children){t.children=u.add.group(),t.on("destroy",(function(){t.children.destroy(),t.children=void 0}));var d=t.clear.bind(t);t.clear=function(){d(),t.children.clear(!1,!0)}}for(var f,y,g=this.getAllChildren([this]),_=0,v=g.length;_<v;_++)(f=g[_]).getBounds&&(i&&t.lineStyle(1,i).strokeRectShape(f.getBounds(p)),f.name&&n&&(y=o?n.call(o,u):n(u))&&(y.setText(f.name),t.children.add(y),h.a.setPosition(p.x,p.y).setSize(p.width,p.height),Object(l.a)(y,h.a,a)));return this},basesizer_AddChildrenMap=function(t,e){return void 0===this.childrenMap&&(this.childrenMap={}),this.childrenMap[t]=e,this},u=i(121),GetElementByName=function(t,e){var i;if(Object(u.a)(t)){for(var n=0,o=t.length;n<o;n++)if(i=TestName(t[n],e))return i}else for(var a in t)if(i=TestName(t[a],e))return i},TestName=function(t,e){return t?t.hasOwnProperty("name")?t.name===e?t:null:GetElementByName(t,e):null};const m=/(\S+)\[(\d+)\]/i;var basesizer_GetElement=function(t){if(void 0!==this.childrenMap&&("string"==typeof t&&(t=t.split(".")),0!==t.length)){var e,i=t.shift();if("#"===i.charAt(0))i=i.substring(1),e=GetElementByName(this.childrenMap,i);else if(-1===i.indexOf("["))e=this.childrenMap[i];else{var n=i.match(m);if(null!=n){var o=this.childrenMap[n[1]];o&&(e=o[n[2]])}}return 0===t.length?e:e&&e.childrenMap?e.getElement(t):null}},basesizer_GetChildrenWidth=function(){return 0},basesizer_GetChildrenHeight=function(){return 0},basesizer_GetAllChildrenSizers=function(t){void 0===t&&(t=[]);for(var e=t.length,i=this.getChildrenSizers(t),n=t.length,o=e;o<n;o++)i[o].getAllChildrenSizers(t);return t},basesizer_GetChildrenSizers=function(t){return void 0===t&&(t=[]),t},PreLayout=function(t){if(!t)for(var e,i=this.getAllChildrenSizers([this]),n=0,o=i.length;n<o;n++)(e=i[n]).rexSizer&&e._layoutInit()},basesizer_Layout=function(t,e,i){return this.rexSizer.hidden?this:(this.preLayout(),this.postLayout())},basesizer_PostLayout=function(t,e,i){return this._anchor&&this._anchor.updatePosition(),this},basesizer_layoutInit=function(){};const d=Phaser.Geom.Rectangle;var anchor_GetViewport=function(t,e){void 0===e&&(e=new d);var i=t.canvasBounds,n=t.displayScale,o=t.autoCenter;return e.x=i.x>=0?0:-i.x*n.x,e.y=i.y>=0?0:-i.y*n.y,e.width=i.width*n.x-e.x,e.height=i.height*n.y-e.y,1!==o&&2!==o||(e.width-=e.x),1!==o&&3!==o||(e.height-=e.y),e};const f=Phaser.Geom.Rectangle;var y=class Anchor_Anchor{constructor(t,e){this.gameObject=t,this.viewport=new f,this.resetFromJSON(e),this.boot()}resetFromJSON(t){var e,i,n,o,a,s,h,l;return void 0!==t.x?(e=null,i=t.x):void 0!==t.left?(e=0,i=t.left):void 0!==t.right?(e=1,i=t.right):void 0!==t.centerX&&(e=.5,i=t.centerX),void 0!==t.y?(n=null,o=t.y):void 0!==t.top?(n=0,o=t.top):void 0!==t.bottom?(n=1,o=t.bottom):void 0!==t.centerY&&(n=.5,o=t.centerY),void 0!==i&&(i=i.replace("left","0%").replace("right","100%").replace("center","50%").split("%"),a=parseFloat(i[0])/100,s=""===i[1]?0:parseFloat(i[1])),void 0!==o&&(o=o.replace("top","0%").replace("bottom","100%").replace("center","50%").split("%"),h=parseFloat(o[0])/100,l=""===o[1]?0:parseFloat(o[1])),this.setAlign(e,n),this.setPercentage(a,h),this.setOffset(s,l),this}boot(){this.scaleManamger.on("resize",this.anchor,this),this.gameObject.on("destroy",this.destroy,this),this.anchor()}shutdown(){this.scaleManamger.off("resize",this.anchor,this),this.gameObject=void 0}destroy(){this.shutdown()}setAlign(t,e){return this.alignX=t,this.alignY=e,this}setPercentage(t,e){return this.percentageX=t,this.percentageY=e,this}setOffset(t,e){return this.offsetX=t,this.offsetY=e,this}anchor(){return anchor_GetViewport(this.scaleManamger,this.viewport),this.updatePosition(),this}updatePosition(){var t=this.gameObject;return null===this.alignX?t.x=this.anchorX:void 0!==this.alignX&&(t.x=this.anchorX+t.displayWidth*(t.originX-this.alignX)),null===this.alignY?this.gameObject.y=this.anchorY:void 0!==this.alignY&&(t.y=this.anchorY+t.displayHeight*(t.originY-this.alignY)),this}get scaleManamger(){return this.gameObject.scene.scale}get anchorX(){return this.viewport.x+this.viewport.width*this.percentageX+this.offsetX}get anchorY(){return this.viewport.y+this.viewport.height*this.percentageY+this.offsetY}},basesizer_SetAnchor=function(t){return void 0===this._anchor?this._anchor=new y(this,t):this._anchor.resetFromJSON(t),this},g=i(141);const _=Phaser.Utils.Objects.GetValue,v=Phaser.Utils.Objects.GetAdvancedValue;class Scale_Scale extends g.a{constructor(t,e){super(t),this.gameObject=t,this.scaleStart={},this.scaleEnd={},this.resetFromJSON(e)}resetFromJSON(t){return this.setMode(_(t,"mode",0)),this.setScaleRange(v(t,"start",void 0),v(t,"end",0)),this.setDelay(v(t,"delay",0)),this.setDuration(v(t,"duration",1e3)),this.setEase(_(t,"ease",void 0)),this}toJSON(){return{mode:this.mode,start:this.scaleStart,end:this.scaleEnd,delay:this.delay,duration:this.duration}}setMode(t){return"string"==typeof t&&(t=b[t]),this.mode=t,this}setScaleRange(t,e){return"number"==typeof t?(this.scaleStart.x=t,this.scaleStart.y=t):(this.scaleStart.x=_(t,"x",this.gameObject.scaleX),this.scaleStart.y=_(t,"y",this.gameObject.scaleY)),"number"==typeof e?(this.scaleEnd.x=e,this.scaleEnd.y=e):(this.scaleEnd.x=_(e,"x",this.scaleStart.x),this.scaleEnd.y=_(e,"y",this.scaleStart.y)),this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}setEase(t){return void 0===t&&(t="Linear"),this.ease=t,this}start(){return this.isRunning||(this.gameObject.setScale(this.scaleStart.x,this.scaleStart.y),super.start({targets:this.gameObject,scaleX:this.scaleEnd.x,scaleY:this.scaleEnd.y,duration:this.duration,ease:this.ease,yoyo:2==this.mode,repeat:2==this.mode?-1:0})),this}complete(){return super.complete(),1===this.mode&&this.gameObject.destroy(),this}}const b={stop:0,destroy:1,yoyo:2};var P=Scale_Scale,S={},popup=function(t,e,i,n,o){switch(S.mode=0,i){case 0:case"x":S.start={x:0};break;case 1:case"y":S.start={y:0};break;default:S.start=0}return S.end=1,S.duration=e,S.ease=void 0===n?"Cubic":n,void 0===o?o=new P(t,S):o.resetFromJSON(S),o.restart(),o},w={},scale_down_destroy=function(t,e,i,n,o,a){switch(o instanceof P&&(a=o,o=void 0),void 0===o&&(o=!0),w.mode=o?1:0,i){case 0:case"x":w.end={x:0};break;case 1:case"y":w.end={y:0};break;default:w.end=0}return w.duration=e,w.ease=void 0===n?"Linear":n,void 0===a?a=new P(t,w):a.resetFromJSON(w),a.restart(),a},T=i(67);const C=Phaser.Utils.Objects.IsPlainObject,D=Phaser.Utils.Objects.GetValue;var M={popUp(t,e,i){if(C(t)){var n=t;t=D(n,"duration",void 0),e=D(n,"orientation",void 0),i=D(n,"ease",void 0)}return this._scale=popup(this,t,e,i,this._scale),this._scale.once("complete",(function(){this.emit("popup.complete",this)}),this),this},popUpPromise(t,e,i){return this.popUp(t,e,i),Object(T.a)(this._scale)},scaleDownDestroy(t,e,i,n){if(C(t)){var o=t;t=D(o,"duration",void 0),e=D(o,"orientation",void 0),i=D(o,"ease",void 0),n=D(o,"destroy",void 0)}return this._scale=scale_down_destroy(this,t,e,i,n,this._scale),this._scale.once("complete",(function(){this.emit("scaledown.complete",this)}),this),this},scaleDownDestroyPromise(t,e,i,n){return this.scaleDownDestroy(t,e,i,n),Object(T.a)(this._scale)},scaleDown(t,e,i){return this.scaleDownDestroy(t,e,i,!1),this},scaleDownPromise(t,e,i){return this.scaleDown(t,e,i),Object(T.a)(this._scale)}};const O=Phaser.Utils.Objects.GetValue,x=Phaser.Utils.Objects.GetAdvancedValue;class Fade_Fade extends g.a{constructor(t,e){super(t),this.gameObject=t,this.alphaStart=void 0,this.alphaEnd=void 0,this.resetFromJSON(e)}resetFromJSON(t){return this.setMode(O(t,"mode",0)),this.setAlphaRange(x(t,"start",this.gameObject.alpha),x(t,"end",0)),this.setDelay(x(t,"delay",0)),this.setDuration(x(t,"duration",1e3)),this}toJSON(){return{mode:this.mode,start:this.alphaStart,end:this.alphaEnd,delay:this.delay,duration:this.duration}}shutdown(){return super.shutdown(),this.gameObject=void 0,this}setMode(t){return"string"==typeof t&&(t=E[t]),this.mode=t,this}setAlphaRange(t,e){return this.alphaStart=t,this.alphaEnd=e,this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}start(){return this.isRunning||(this.gameObject.setAlpha(this.alphaStart),super.start({targets:this.gameObject,alpha:this.alphaEnd,delay:this.delay,duration:this.duration,ease:"Linear",yoyo:2==this.mode,repeat:2==this.mode?-1:0})),this}complete(){return super.complete(),1===this.mode&&this.gameObject.destroy(),this}}const E={stop:0,destroy:1,yoyo:2};var B=Fade_Fade;const I=Phaser.Utils.Objects.IsPlainObject;var A={},fade_in=function(t,e,i,n){var o,a;return I(i)?(o=i.start,a=i.end):a=i,void 0===o&&(o=0),void 0===a&&(a=t.alpha),A.mode=0,A.start=o,A.end=a,A.duration=e,void 0===n?n=new B(t,A):n.resetFromJSON(A),n.restart(),n},R={},fade_out_destroy=function(t,e,i,n){return i instanceof B&&(n=i,i=void 0),void 0===i&&(i=!0),R.mode=i?1:0,R.end=0,R.duration=e,void 0===n?n=new B(t,R):n.resetFromJSON(R),n.restart(),n};const k=Phaser.Utils.Objects.IsPlainObject,L=Phaser.Utils.Objects.GetValue;var F={fadeIn(t,e){k(t)&&(t=L(t,"duration",void 0));return this._fade=fade_in(this,t,e,this._fade),this._fade.once("complete",(function(){this.emit("fadein.complete",this)}),this),this},fadeInPromoise(t,e){return this.fadeIn(t,e),Object(T.a)(this._fade)},fadeOutDestroy(t,e){if(k(t)){var i=t;t=L(i,"duration",void 0),e=L(i,"destroy",void 0)}return this._fade=fade_out_destroy(this,t,e,this._fade),this._fade.once("complete",(function(){this.emit("fadeout.complete",this)}),this),this},fadeOutDestroyPromise(t,e){return this.fadeOutDestroy(t,e),Object(T.a)(this._fade)},fadeOut(t){return this.fadeOutDestroy(t,!1),this},fadeOutPromise(t){return this.fadeOut(t),Object(T.a)(this._fade)}},N=i(84),j=i(68),H=i(85),U=i(38);const G=Phaser.Display.Align.CENTER;var basesizer_LayoutBackgrounds=function(){if(void 0!==this.backgroundChildren)for(var t,e=this.backgroundChildren,i=this.left,n=this.top,o=this.width,a=this.height,s=0,c=e.length;s<c;s++)(t=e[s]).rexSizer.hidden||(Object(U.a)(t,o,a),h.a.setPosition(i,n).setSize(o,a),Object(l.a)(t,h.a,G),this.resetChildPositionState(t))},onDrag=function(t,e,i){var n=this.getTopmostSizer();n.x+=e-this.x,n.y+=i-this.y},basesizer_SetDraggable=function(t,e){var i=typeof t;return"string"===i?t=this.getElement(t):void 0!==t&&"object"==i||(e=t,t=this),void 0===e&&(e=!0),t.input&&t.input.hasOwnProperty("draggable")?t.input.draggable=e:e&&(t.setInteractive(),t.scene.input.setDraggable(t),t.on("drag",onDrag,this)),this},V={getSizerConfig:o.a,pushIntoBounds:basesizer_PushIntoBounds,drawBounds:basesizer_DrawBounds,getChildrenWidth:basesizer_GetChildrenWidth,getChildrenHeight:basesizer_GetChildrenHeight,addChildrenMap:basesizer_AddChildrenMap,addElement:basesizer_AddChildrenMap,getElement:basesizer_GetElement,getAllChildrenSizers:basesizer_GetAllChildrenSizers,getChildrenSizers:basesizer_GetChildrenSizers,preLayout:PreLayout,_layoutInit:basesizer_layoutInit,layout:basesizer_Layout,layoutBackgrounds:basesizer_LayoutBackgrounds,postLayout:basesizer_PostLayout,setAnchor:basesizer_SetAnchor,isInTouching:function(t){return Object(N.a)(this,t)},getParentSizer:function(){return Object(j.a)(this)},getTopmostSizer:function(){return Object(H.a)(this)},setDraggable:basesizer_SetDraggable};Object.assign(V,F,M);var W=V,z=i(15);const Y=Phaser.Utils.Objects.GetValue;class BaseSizer_Base extends n.a{constructor(t,e,i,n,o,a){super(t,e,i,2,2),this.isRexSizer=!0,this.setMinSize(n,o),this.setName(Y(a,"name","")),this.rexSizer={},this.backgroundChildren=void 0;var s=Y(a,"anchor",void 0);s&&this.setAnchor(s),this.setDraggable(Y(a,"draggable",!1))}destroy(t){this.scene&&(void 0!==this.backgroundChildren&&(this.backgroundChildren.length=0),super.destroy(t))}setMinSize(t,e){return this.setMinWidth(t).setMinHeight(e),this}setMinWidth(t){return null==t&&(t=0),this.minWidth=t,this}setMinHeight(t){return null==t&&(t=0),this.minHeight=t,this}get childrenWidth(){return void 0===this._childrenWidth&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return void 0===this._childrenHeight&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}get left(){return this.x-Object(z.b)(this)*this.originX}set left(t){this.x+=t-this.left}alignLeft(t){return this.left=t,this}get right(){return this.left+Object(z.b)(this)}set right(t){this.x+=t-this.right}alignRight(t){return this.right=t,this}get centerX(){return this.left+Object(z.b)(this)/2}set centerX(t){this.x+=t-this.centerX}alignCenterX(t){return this.centerX=t,this}get top(){return this.y-Object(z.a)(this)*this.originY}set top(t){this.y+=t-this.top}alignTop(t){return this.top=t,this}get bottom(){return this.top+Object(z.a)(this)}set bottom(t){this.y+=t-this.bottom}alignBottom(t){return this.bottom=t,this}get centerY(){return this.top+Object(z.a)(this)/2}set centerY(t){this.y+=t-this.centerY}alignCenterY(t){return this.centerY=t,this}pin(t){return super.add(t),this}addBackground(t,e){return void 0===this.backgroundChildren&&(this.backgroundChildren=[]),super.add(t),this.getSizerConfig(t).parent=this,this.backgroundChildren.push(t),void 0!==e&&this.addChildrenMap(e,t),this}}Object.assign(BaseSizer_Base.prototype,W);e.a=BaseSizer_Base},function(t,e,i){"use strict";var n=i(106),o=i(142);const a=Phaser.GameObjects.Text;var text_IsTextGameObject=function(t){return t instanceof a},s=i(87);const h=Phaser.Display.Align.TOP_LEFT;var textblock_SetTextObject=function(t,e){void 0===e&&(e=!0),this.add(t);var i=this.getSizerConfig(t);return i.parent=this,i.align=h,i.padding=Object(o.a)(0),i.expand=!0,this.textObject=t,this.textObjectType=text_IsTextGameObject(t)?0:1,i.preOffsetY=0,i.offsetY=0,e&&(this.textMask=new s.a(this),this.textObject.setMask(this.textMask.createGeometryMask()),this.pin(this.textMask)),this},textblock_SetText=function(t){return void 0!==t&&(this.text=t),0===this.textObjectType?this.lines=this.textObject.getWrappedText(this.text):this.lines=this.textObject.getPenManager(this.text,this.lines),this.updateTextObject(),this},textblock_TextHeightToLinesCount=function(t){return(t-this.textLineSpacing)/(this.textLineHeight+this.textLineSpacing)},textblock_LinesCountToTextHeight=function(t){return t*(this.textLineHeight+this.textLineSpacing)-this.textLineSpacing},textblock_GetLines=function(t){var e,i=t+this.textObject.style.maxLines;if(0===this.textObjectType)e=this.lines.slice(t,i).join("\n");else{var n=this.lines.getLineStartIndex(t),o=this.lines.getLineEndIndex(i-1);e=this.lines.getSliceTagText(n,o,!0)}return e},textblock_ResetTextObjectPosition=function(){var t=this.textObject.rexSizer;this.textObject.y+=t.offsetY-t.preOffsetY,t.preOffsetY=t.offsetY,this.resetChildPositionState(this.textObject)},textblock_UpdateTextObject=function(){var t=Math.max(Math.floor(textblock_TextHeightToLinesCount.call(this,-this.textOY)),0),e=textblock_LinesCountToTextHeight.call(this,t)+this.textOY;return this.textObject.setText(textblock_GetLines.call(this,t)),this.textObject.rexSizer.offsetY=e,textblock_ResetTextObjectPosition.call(this),this},textblock_ResizeText=function(t,e,i){if(i+=this.textLineHeight+this.textLineSpacing,t.width!==e||t.height!==i){t.setFixedSize(e,i);var n=t.style,o=Math.max(e,0),a=Math.ceil(textblock_TextHeightToLinesCount.call(this,i))+1;0===this.textObjectType?(n.wordWrapWidth=o,n.maxLines=a):(n.wrapWidth=o,n.maxLines=a),this.setText()}},l=i(65),c=i(43),p={setTextObject:textblock_SetTextObject,setText:textblock_SetText,updateTextObject:textblock_UpdateTextObject,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var n,o,a;this.preLayout(t),void 0===e&&(e=this.minWidth),void 0===i&&(i=this.minHeight),this.resize(e,i);var s,h,p,u,m=this.left,d=this.top;return(n=this.textObject).rexSizer.hidden||(s=m+(a=(o=n.rexSizer).padding).left,h=d+a.top,p=this.width-a.left-a.right,u=this.height-a.top-a.bottom,textblock_ResizeText.call(this,n,p,u),l.a.setPosition(s,h).setSize(p,u),Object(c.a)(n,l.a,o.align),o.preOffsetY=0,textblock_ResetTextObjectPosition.call(this),this.textMask&&(this.textMask.setPosition().resize(),this.resetChildPositionState(this.textMask))),this.layoutBackgrounds(),this.postLayout()}};const u=Phaser.Utils.Objects.IsPlainObject,m=Phaser.Utils.Objects.GetValue;class TextBlock_TextBlock extends n.a{constructor(t,e,i,n,o,a){u(e)?(e=m(a=e,"x",0),i=m(a,"y",0),n=m(a,"width",void 0),o=m(a,"height",void 0)):u(n)&&(n=m(a=n,"width",void 0),o=m(a,"height",void 0)),super(t,e,i,n,o,a),this.type="rexTextBlock",this.textObject=void 0,this.textMask=void 0,this.textObjectType=void 0,this.lines=void 0,this.text=m(a,"content",""),this._textOY=0,this.execeedTopState=!1,this.execeedBottomState=!1,this.setClampMode(m(a,"clamplTextOY",!0));var s=m(a,"background",void 0),h=m(a,"text",void 0);void 0===h&&(h=createDefaultTextObject(t));var l=m(a,"textMask",!0);s&&this.addBackground(s),this.setTextObject(h,l),this.addChildrenMap("background",s),this.addChildrenMap("text",h)}destroy(t){this.scene&&(this.textObject=void 0,this.textMask=void 0,void 0===this.lines||(0===this.textObjectType?this.lines.length=0:this.lines.destroy()),super.destroy(t))}setClampMode(t){return this.clampTextOYMode=t,this}get textLineHeight(){var t=this.textObject.style;return t.metrics.fontSize+t.strokeThickness}get textLineSpacing(){return this.textObject.lineSpacing}get linesCount(){return void 0===this.lines?0:0===this.textObjectType?this.lines.length:this.lines.linesCount}get visibleLinesCount(){return Math.floor(textblock_TextHeightToLinesCount.call(this,this.textObject.height))}get topTextOY(){return 0}get bottomTextOY(){return-this.textVisibleHeight}get textHeight(){return textblock_LinesCountToTextHeight.call(this,this.linesCount)}get textObjectHeight(){return this.textObject.height-this.textLineHeight-this.textLineSpacing}get textVisibleHeight(){var t=this.textHeight,e=this.textObjectHeight;return t>e?t-e:0}textOYExceedTop(t){return void 0===t&&(t=this.textOY),t>this.topTextOY}textOYExeceedBottom(t){return void 0===t&&(t=this.textOY),t<this.bottomTextOY}get textOY(){return this._textOY}set textOY(t){var e=this.topTextOY,i=this.bottomTextOY,n=this.textOYExceedTop(t),o=this.textOYExeceedBottom(t);this.clampTextOYMode&&(this.visibleLinesCount>this.linesCount?t=0:n?t=e:o&&(t=i)),this._textOY!==t&&(this._textOY=t,this.updateTextObject()),n&&(this.execeedTopState||this.emit("execeedtop",this,t,e)),this.execeedTopState=n,o&&(this.execeedBottomState||this.emit("execeedbottom",this,t,i)),this.execeedBottomState=o}setTextOY(t){return this.textOY=t,this}set t(t){this.textOY=-this.textVisibleHeight*t}get t(){var t=this.textVisibleHeight;return 0===t?0:this.textOY/-t}setTextOYByPercentage(t){return this.t=t,this}}var createDefaultTextObject=function(t){return t.add.text(0,0,"")};Object.assign(TextBlock_TextBlock.prototype,p);e.a=TextBlock_TextBlock},function(t,e,i){"use strict";var n=i(32);const o=Phaser.Math.Percent;var slider_PositionToPercent=function(t,e,i){var n,a,s;return t.y===e.y?(n=Math.min(t.x,e.x),a=Math.max(t.x,e.x),s=o(i.x,n,a)):t.x===e.x&&(n=Math.min(t.y,e.y),a=Math.max(t.y,e.y),s=o(i.y,n,a)),s},a={},slider_OnDragThumb=function(t,e,i){this.enable&&(a.x=e,a.y=i,this.value=slider_PositionToPercent(this.getStartPoint(),this.getEndPoint(),a))},s={},slider_OnTouchTrack=function(t,e,i){this.enable&&t.isDown&&(s.x=t.worldX,s.y=t.worldY,this.value=slider_PositionToPercent(this.getStartPoint(),this.getEndPoint(),s))},h=i(43),l={},slider_GetThumbAlignPoint=function(t,e){void 0===e&&(e=l);var i=this.childrenMap.thumb,n=i.x,o=i.y;return Object(h.a)(i,this,t),e.x=i.x,e.y=i.y,i.x=n,i.y=o,e};const c=Phaser.Display.Align.LEFT_CENTER,p=Phaser.Display.Align.TOP_CENTER;var u={},slider_GetStartPoint=function(t){if(void 0===t&&(t=u),this.childrenMap.thumb){var e=0===this.orientation?p:c;slider_GetThumbAlignPoint.call(this,e,t)}else 0===this.orientation?(t.x=this.centerX,t.y=this.top+1):(t.x=this.left+1,t.y=this.centerY);return t};const m=Phaser.Display.Align.RIGHT_CENTER,d=Phaser.Display.Align.BOTTOM_CENTER;var f={},GetEndPoint=function(t){if(void 0===t&&(t=f),this.childrenMap.thumb){var e=1===this.orientation?m:d;slider_GetThumbAlignPoint.call(this,e,t)}else 0===this.orientation?(t.x=this.centerX,t.y=this.bottom-1):(t.x=this.right-1,t.y=this.centerY);return t};const y=Phaser.Math.Linear;var g={},slider_PercentToPosition=function(t,e,i,n){return void 0===n&&(n=g),n.x=y(e.x,i.x,t),n.y=y(e.y,i.y,t),n},slider_UpdateThumb=function(t){var e=this.childrenMap.thumb;return void 0===e||(void 0===t&&(t=this.value),slider_PercentToPosition(t,this.getStartPoint(),this.getEndPoint(),e),this.resetChildPositionState(e)),this},_=i(38),v=i(15);const b=Phaser.Display.Align.LEFT_CENTER,P=Phaser.Display.Align.TOP_CENTER;var slider_UpdateIndicator=function(t){var e,i,n=this.childrenMap.indicator;if(void 0===n)return this;void 0===t&&(t=this.value);var o=this.childrenMap.thumb;if(o)if(0===this.orientation){var a=Object(v.a)(o);i=o.y-a*o.originY+a-this.top}else{var s=Object(v.b)(o);e=o.x-s*o.originX+s-this.left}else 0===this.orientation?i=this.height*t:e=this.width*t;Object(_.a)(n,e,i);var l=1===this.orientation?b:P;Object(h.a)(n,this,l),this.resetChildPositionState(n)};const S=Phaser.Utils.Objects.GetValue,w=Phaser.Math.Clamp,T=Phaser.Math.Linear,C=Phaser.Math.Percent,D=Phaser.Math.Snap.To;class Slider_Slider extends n.a{constructor(t,e){super(t,e),this.type="rexSlider",this.eventEmitter=S(e,"eventEmitter",this);var i=S(e,"background",void 0),n=S(e,"track",void 0),o=S(e,"indicator",void 0),a=S(e,"thumb",void 0),s=S(e,"space.left",0),h=S(e,"space.right",0),l=S(e,"space.top",0),c=S(e,"space.bottom",0);if(i&&this.addBackground(i),n){var p={left:s,right:h,top:l,bottom:c};this.add(n,0,void 0,p,!0)}o&&this.add(o,null),a&&this.add(a,null);var u=S(e,"input",0);switch("string"==typeof u&&(u=M[u]),u){case 0:a&&(a.setInteractive(),this.scene.input.setDraggable(a),a.on("drag",slider_OnDragThumb,this));break;case 1:this.setInteractive().on("pointerdown",slider_OnTouchTrack,this).on("pointermove",slider_OnTouchTrack,this)}this.addChildrenMap("background",i),this.addChildrenMap("track",n),this.addChildrenMap("indicator",o),this.addChildrenMap("thumb",a);var m=S(e,"valuechangeCallback",null);if(null!==m){var d=S(e,"valuechangeCallbackScope",void 0);this.eventEmitter.on("valuechange",m,d)}this.setEnable(S(e,"enable",void 0)),this.setGap(S(e,"gap",void 0)),this.setValue(S(e,"value",0))}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}setGap(t){return this.gap=t,this}get value(){return this._value}set value(t){void 0!==this.gap&&(t=D(t,this.gap));var e=this._value;this._value=w(t,0,1),e!==this._value&&(this.updateThumb(this._value),this.updateIndicator(this._value),this.eventEmitter.emit("valuechange",this._value,e,this.eventEmitter))}setValue(t,e,i){return null==t||(void 0!==e&&(t=C(t,e,i)),this.value=t),this}addValue(t,e,i){return void 0!==e&&(t=C(t,e,i)),this.value+=t,this}getValue(t,e){var i=this.value;return void 0!==t&&(i=T(t,e,i)),i}layout(t,e,i){return super.layout(t,e,i),this.updateThumb(),this.updateIndicator(),this}}const M={drag:0,click:1,none:-1};var O={getStartPoint:slider_GetStartPoint,getEndPoint:GetEndPoint,updateThumb:slider_UpdateThumb,updateIndicator:slider_UpdateIndicator};Object.assign(Slider_Slider.prototype,O);e.a=Slider_Slider},function(t,e,i){"use strict";var n=i(32),o=i(181),ButtonSetInteractive=function(t,e){t._buttonBehavior=new o.a(t,e),t._buttonBehavior.on("click",(function(e,i,n,o){FireEvent.call(this,"button.click",t,n,o)}),this),t.on("pointerover",(function(e,i,n,o){FireEvent.call(this,"button.over",t,e,o)}),this).on("pointerout",(function(e,i){FireEvent.call(this,"button.out",t,e,i)}),this)},FireEvent=function(t,e,i,n){var o;if("number"==typeof e){if(o=e,!(e=this.childrenMap.buttons[o]))return}else if(-1===(o=this.childrenMap.buttons.indexOf(e)))return;this.eventEmitter!==this&&this.emit(t,e,o,i,n),void 0!==this.groupName?this.eventEmitter.emit(t,e,this.groupName,o,i,n):this.eventEmitter.emit(t,e,o,i,n)},a=i(54),s={getButton(t){var e;return"number"==typeof t?e=this.childrenMap.buttons[t]:(e=t,-1===this.childrenMap.buttons.indexOf(e)&&(e=void 0)),e},emitButtonClick(t){return FireEvent.call(this,"button.click",t),this},showButton(t){return Object(a.c)(this.getButton(t)),this},hideButton(t){return Object(a.a)(this.getButton(t)),this},isButtonShown(t){return Object(a.b)(this.getButton(t)),this},forEachButtton(t,e){for(var i=this.childrenMap.buttons,n=0,o=i.length;n<o;n++)e?t.call(e,i[n],n,i):t(i[n],n,i);return this}};const h=Phaser.Utils.Objects.GetValue;var types_InitData=function(t,e){void 0===e&&(e=!1);var i=h(t,"dataManager",void 0),n=h(t,"setValueCallback",void 0),o=h(t,"setValueCallbackScope",void 0);void 0===i&&(this.setDataEnabled(),i=this.data),this.childrenMap.buttons.forEach((function(t){var a=t.name;n&&i.events.on("changedata-"+a,(function(e,i,a){o?n.call(o,t,i,a):n(t,i)}),this),i.set(a,void 0),i.set(a,e)})),this._dataManager=i},types_SetRadioType=function(t){types_InitData.call(this,t),this._value=void 0,Object.defineProperty(this,"value",{get:function(){return this._value}.bind(this),set:function(t){if(t!==this._value){this._value=t;var e=this._dataManager;this.getElement("buttons").forEach((function(i){var n=i.name,o=e.get(n);n===t?o||e.set(n,!0):o&&e.set(n,!1)}))}}.bind(this),enumerable:!0,configurable:!0}),this.on("button.click",(function(t){this.value=t.name}),this)},types_SetCheckboxesType=function(t){types_InitData.call(this,t),this.on("button.click",(function(t){var e=this._dataManager,i=t.name,n=e.get(i);e.set(i,!n)}),this)};const l=Phaser.Utils.Objects.GetValue,c={radio:types_SetRadioType,checkboxes:types_SetCheckboxesType};var types_SetType=function(t){var e=l(t,"type",void 0);e&&c.hasOwnProperty(e)&&c[e].call(this,t)};const p=Phaser.Utils.Objects.GetValue;class Buttons_Buttons extends n.a{constructor(t,e){void 0===e&&(e={}),super(t,e),this.type="rexButtons",this.eventEmitter=p(e,"eventEmitter",this),this.groupName=p(e,"groupName",void 0);var i=p(e,"background",void 0),n=p(e,"buttons",void 0);n&&0===n.length&&(n=void 0);var o=p(e,"space",0);if(i&&this.addBackground(i),n){var a,s,h=p(e,"expand",!1),l=h?1:0,c=p(e,"align",void 0),u=p(e,"click",void 0);h||"right"!==c&&"bottom"!==c&&"center"!==c||this.addSpace();for(var m=0,d=n.length;m<d;m++)a=n[m],s=0===this.orientation?{left:m>=1?o:0,right:0,top:0,bottom:0}:{left:0,right:0,top:m>=1?o:0,bottom:0},this.add(a,l,"center",s,!0),ButtonSetInteractive.call(this,a,u);h||"center"!==c||this.addSpace()}this.addChildrenMap("background",i),this.addChildrenMap("buttons",n||[]),types_SetType.call(this,e)}}Object.assign(Buttons_Buttons.prototype,s);e.a=Buttons_Buttons},function(t,e,i){"use strict";var n=i(106),o=i(87);const a=Phaser.Utils.Objects.GetValue,s=Phaser.Display.Align.TOP_LEFT;var scrollableblock_SetChild=function(t,e,i){t.setOrigin&&t.setOrigin(0),this.add(t);var n,h,l=this.getSizerConfig(t);if(l.parent=this,l.align=s,l.expand=e,this.child=t,!0===i?(n=!0,h=0):!1===i?n=!1:(n=a(i,"mask",!0),h=a(i,"padding",0)),n){var c=new o.a(this,0,h);this.childMask=c.createGeometryMask(),this.pin(c)}return this},h=i(15),scrollableblock_GetChildrenWidth=function(){if(this.rexSizer.hidden)return 0;var t=this.child;return t.rexSizer.hidden?0:0===this.scrollMode?t.isRexSizer?Math.max(t.minWidth,t.childrenWidth):Object(h.b)(t):0},scrollableblock_GetChildrenHeight=function(){if(this.rexSizer.hidden)return 0;var t=this.child;return t.rexSizer.hidden||0===this.scrollMode?0:t.isRexSizer?Math.max(t.minHeight,t.childrenHeight):Object(h.a)(t)},l=i(286),scrollableblock_ResetChildPosition=function(){var t=this.left,e=this.top;0===this.scrollMode?e+=this.childOY:t+=this.childOY,this.child.setPosition(t,e),Object(l.a)(this,this.childMask,this.child.getAllChildren()),this.resetChildPositionState(this.child)},c=i(38),p=i(180),u={setChild:scrollableblock_SetChild,getChildrenWidth:scrollableblock_GetChildrenWidth,getChildrenHeight:scrollableblock_GetChildrenHeight,resetChildPosition:scrollableblock_ResetChildPosition,layout:function(t,e,i){if(this.rexSizer.hidden)return this;this.preLayout(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i);var n,o,a=this.child;if(!a.rexSizer.hidden&&(0===this.scrollMode?n=this.width:o=this.height,a.isRexSizer?a.layout(this,n,o):Object(c.a)(a,n,o),this.resetChildPosition(),this.childMask)){var s=Object(p.a)(this.childMask);s.setPosition().resize(),this.resetChildPositionState(s)}return this.postLayout()}},m=i(284);const d=Phaser.Utils.Objects.IsPlainObject,f=Phaser.Utils.Objects.GetValue;class ScrollableBlock_ScrollableBlock extends n.a{constructor(t,e,i,n,o,a){d(e)?(e=f(a=e,"x",0),i=f(a,"y",0),n=f(a,"width",void 0),o=f(a,"height",void 0)):d(n)&&(n=f(a=n,"width",void 0),o=f(a,"height",void 0)),super(t,e,i,n,o,a),this.type="rexScrollableBlock",this.child=void 0,this.childMask=void 0,this._childOY=0,this.execeedTopState=!1,this.execeedBottomState=!1,this.setScrollMode(f(a,"scrollMode",!0)),this.setClampMode(f(a,"clamplChildOY",!0));var s=f(a,"child",void 0),h=f(a,"expand",!0),l=f(a,"mask",void 0);this.setChild(s,h,l)}destroy(t){this.scene&&(this.child=void 0,this.childMask&&(this.childMask.destroy(),this.childMask=void 0),super.destroy(t))}setScrollMode(t){return"string"==typeof t&&(t=m.a[t.toLowerCase()]),this.scrollMode=t,this}setClampMode(t){return this.clampChildOYMode=t,this}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get childHeight(){return 0===this.scrollMode?Object(h.a)(this.child):Object(h.b)(this.child)}get childWidth(){return 0===this.scrollMode?Object(h.b)(this.child):Object(h.a)(this.child)}get topChildOY(){return 0}get bottomChildOY(){return-this.visibleHeight}get visibleHeight(){var t=this.childHeight,e=this.instHeight;return t>e?t-e:0}childOYExceedTop(t){return void 0===t&&(t=this.childOY),t>this.topChildOY}childOYExeceedBottom(t){return void 0===t&&(t=this.childOY),t<this.bottomChildOY}get childOY(){return this._childOY}set childOY(t){var e=this.topChildOY,i=this.bottomChildOY,n=this.childOYExceedTop(t),o=this.childOYExeceedBottom(t);this.clampChildOYMode&&(this.instHeight>this.childHeight?t=0:n?t=e:o&&(t=i)),this._childOY!==t&&(this._childOY=t,this.resetChildPosition()),n&&(this.execeedTopState||this.emit("execeedtop",this,t,e)),this.execeedTopState=n,o&&(this.execeedBottomState||this.emit("execeedbottom",this,t,i)),this.execeedBottomState=o}setChildOY(t){return this.childOY=t,this}set t(t){this.childOY=-this.visibleHeight*t}get t(){var t=this.visibleHeight;return 0===t?0:this.childOY/-t}setChildOYByPercentage(t){return this.t=t,this}}Object.assign(ScrollableBlock_ScrollableBlock.prototype,u);e.a=ScrollableBlock_ScrollableBlock},function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var n,o=i(5),a=i(59);!function(t){t[t.Background=0]="Background",t[t.Element=1]="Element",t[t.Effect=2]="Effect"}(n||(n={}));var s,h,l,c=(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t.BodyCostDres="body_cost_$_dres",t.BodyCost="body_cost_$",t.BodyTail="body_tail_$",t.BodyWing="body_wing_$",t.BodyBase="body_base_$",t.BodySpec="body_spec_$",t.FlegSpec="fleg_spec_$",t.FlegBase="fleg_base_$",t.FlegCost="fleg_cost_$",t.BarmSpec="barm_spec_$",t.BarmBase="barm_base_$",t.BarmCost="barm_cost_$",t.WeapBarm="weap_barm_$",t.ShldBarm="shld_barm_$",t.BlegSpec="bleg_spec_$",t.BlegBase="bleg_base_$",t.BlegCost="bleg_cost_$",t.FarmSpec="farm_spec_$",t.FarmBase="farm_base_$",t.FarmCost="farm_cost_$",t.ShldFarm="shld_farm_$",t.WeapFarm="weap_farm_$",t.HeadSpec="head_spec_$",t.HeadMask="head_mask_$",t.HeadEyes="head_eyes_$",t.HeadBase="head_base_$",t.HeadHairBack="head_hair_$_back",t.HeadMous="head_mous_$",t.HeadHair="head_hair_$",t.HeadHats="head_hats_$"}(h||(h={})),function(t){t.BarmBase="barm_base_#_$",t.BarmCost="barm_cost_#_$",t.BarmSpec="barm_spec_#_$",t.BlegBase="bleg_base_#_$",t.BlegCost="bleg_cost_#_$",t.BlegSpec="bleg_spec_#_$",t.BodyBase="body_base_#_$",t.BodyCost="body_cost_#_$",t.BodyCostDres="body_cost_#_$_dres",t.BodySpec="body_spec_#_$",t.BodyTail="body_tail_#_$",t.BodyWing="body_wing_#_$",t.FarmBase="farm_base_#_$",t.FarmCost="farm_cost_#_$",t.FarmSpec="farm_spec_#_$",t.FlegBase="fleg_base_#_$",t.FlegCost="fleg_cost_#_$",t.FlegSpec="fleg_spec_#_$",t.HeadBase="head_base_#_$",t.HeadEyes="head_eyes_#_$",t.HeadHair="head_hair_#_$",t.HeadHairBack="head_hair_#_$_back",t.HeadHats="head_hats_#_$",t.HeadMask="head_mask_#_$",t.HeadMous="head_mous_#_$",t.HeadSpec="head_spec_#_$",t.ShldFarm="shld_farm_#_$",t.WeapFarm="weap_farm_#_$",t.ShldBarm="shld_barm_#_$",t.WeapBarm="weap_barm_#_$"}(l||(l={}));var p=function(t){function DragonbonesDisplay(e,i,n,o){void 0===o&&(o=!1);var a=t.call(this,e,i,n,o)||this;return a.mAnimationName="Armature",a.mDragonbonesName="",a.replaceArr=[],a.mHasLoadMap=new Map,a.mLoadMap=new Map,a.mErrorLoadMap=new Map,a}return c(DragonbonesDisplay,t),Object.defineProperty(DragonbonesDisplay.prototype,"spriteWidth",{get:function(){return this.mArmatureDisplay?this.mArmatureDisplay.width:0},enumerable:!1,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"spriteHeight",{get:function(){return this.mArmatureDisplay?this.mArmatureDisplay.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"GameObject",{get:function(){return this},enumerable:!1,configurable:!0}),DragonbonesDisplay.prototype.changeAlpha=function(t){},DragonbonesDisplay.prototype.load=function(t){this.mDisplayInfo=t,this.mCollisionArea=[[1,1],[1,1]],this.mOriginPoint=new Phaser.Geom.Point(1,1),this.mDisplayInfo&&(this.dragonBonesName="bones_human01")},DragonbonesDisplay.prototype.getDisplay=function(){return this.mArmatureDisplay},DragonbonesDisplay.prototype.play=function(t){this.mActionName=t,this.mArmatureDisplay&&(this.mArmatureDisplay.hasDBEventListener(dragonBones.EventObject.LOOP_COMPLETE)&&this.mArmatureDisplay.removeDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onArmatureLoopComplete,this),t.playingQueue&&t.playingQueue.complete&&this.mArmatureDisplay.addDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onArmatureLoopComplete,this),this.mArmatureDisplay.animation.play(t.animationName),this.mArmatureDisplay.scaleX=t.flip?-1:1)},DragonbonesDisplay.prototype.fadeIn=function(t){this.clearFadeTween(),this.alpha=0,this.mFadeTween=this.scene.tweens.add({targets:this,alpha:1,duration:1200,onComplete:function(){t&&t()}})},DragonbonesDisplay.prototype.fadeOut=function(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:function(){t&&t()}})},DragonbonesDisplay.prototype.destroy=function(){this.mDisplayInfo=null,this.mArmatureDisplay&&(this.mArmatureDisplay.dispose(!0),this.mArmatureDisplay=null),this.mClickCon&&(this.mClickCon.destroy(!0),this.mClickCon=null),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=null),t.prototype.destroy.call(this)},DragonbonesDisplay.prototype.buildDragbones=function(){if(this.scene.cache.custom.dragonbone.get(this.mDragonbonesName))this.onLoadCompleteHandler();else{var t="./resources/dragonbones",e=t+"/"+this.mDragonbonesName+"_tex.png",i=t+"/"+this.mDragonbonesName+"_tex.json",n=t+"/"+this.mDragonbonesName+"_ske.dbbin";this.loadDragonBones(t,e,i,n)}},DragonbonesDisplay.prototype.onLoadCompleteHandler=function(t,e,i){if(this.scene){this.mArmatureDisplay&&this.mArmatureDisplay.dbClear(),this.mArmatureDisplay=this.scene.add.armature(this.mAnimationName,this.dragonBonesName),this.mArmatureDisplay.addDBEventListener(dragonBones.EventObject.SOUND_EVENT,this.onSoundEventHandler,this),this.mArmatureDisplay.visible=!1,this.add(this.mArmatureDisplay),this.clearArmatureSlot(),this.getReplaceArr(),this.showReplaceArmatrue(),this.mArmatureDisplay.x=this.baseLoc.x,this.mArmatureDisplay.y=this.baseLoc.y;var n=new Phaser.Geom.Rectangle(0,0,50,70);this.mClickCon||(this.mClickCon=this.scene.make.container(void 0,!1),this.mClickCon.setInteractive(n,Phaser.Geom.Rectangle.Contains),this.mClickCon.x=-n.width>>1,this.mClickCon.y=-n.height),this.setData("id",this.mDisplayInfo.id),this.add(this.mClickCon),this.emit("initialized")}},DragonbonesDisplay.prototype.loadDragonBones=function(t,e,i,n){this.scene.load.dragonbone(this.mDragonbonesName,e,i,n,null,null,{responseType:"arraybuffer"}),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.scene.load.start()},DragonbonesDisplay.prototype.clearArmatureSlot=function(){this.mArmatureDisplay.armature.getSlots().forEach((function(t){t&&(t.display.visible=!1)}))},DragonbonesDisplay.prototype.clearReplaceArmature=function(){if(this.mArmatureDisplay.armature.animation.stop(),this.replaceArr&&0!==this.replaceArr.length)for(var t=this.replaceArr.length,e=0;e<t;e++){var i=this.replaceArr[e].slot.replace("$",this.replaceArr[e].dir.toString());this.mArmatureDisplay.armature.getSlot(i).replaceDisplay(null)}},DragonbonesDisplay.prototype.showReplaceArmatrue=function(){for(var t=0,e=this.replaceArr;t<e.length;t++){var i=e[t];this.replacePartDisplay(i.slot,i.part,i.dir,i.skin)}this.mLoadMap&&this.mLoadMap.size>0?this.startLoad():this.refreshAvatar()},DragonbonesDisplay.prototype.getReplaceArr=function(){this.replaceArr.length=0;var t=this.mDisplayInfo.avatar;t.bodyBaseId&&(this.replaceArr.push({slot:h.BodyBase,part:l.BodyBase,dir:3,skin:t.bodyBaseId}),this.replaceArr.push({slot:h.BodyBase,part:l.BodyBase,dir:1,skin:t.bodyBaseId})),t.bodySpecId&&(this.replaceArr.push({slot:h.BodySpec,part:l.BodySpec,dir:3,skin:t.bodySpecId}),this.replaceArr.push({slot:h.BodySpec,part:l.BodySpec,dir:1,skin:t.bodySpecId})),t.bodyWingId&&(this.replaceArr.push({slot:h.BodyWing,part:l.BodyWing,dir:3,skin:t.bodyWingId}),this.replaceArr.push({slot:h.BodyWing,part:l.BodyWing,dir:1,skin:t.bodyWingId})),t.bodyTailId&&(this.replaceArr.push({slot:h.BodyTail,part:l.BodyTail,dir:3,skin:t.bodyTailId}),this.replaceArr.push({slot:h.BodyTail,part:l.BodyTail,dir:1,skin:t.bodyTailId})),t.bodyCostId&&(this.replaceArr.push({slot:h.BodyCost,part:l.BodyCost,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:h.BodyCost,part:l.BodyCost,dir:1,skin:t.bodyCostId}),this.replaceArr.push({slot:h.BodyCostDres,part:l.BodyCostDres,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:h.BodyCostDres,part:l.BodyCostDres,dir:1,skin:t.bodyCostId})),t.farmBaseId&&(this.replaceArr.push({slot:h.FarmBase,part:l.FarmBase,dir:3,skin:t.farmBaseId}),this.replaceArr.push({slot:h.FarmBase,part:l.FarmBase,dir:1,skin:t.farmBaseId})),t.farmSpecId&&(this.replaceArr.push({slot:h.FarmSpec,part:l.FarmSpec,dir:3,skin:t.farmSpecId}),this.replaceArr.push({slot:h.FarmSpec,part:l.FarmSpec,dir:1,skin:t.farmSpecId})),t.farmCostId&&(this.replaceArr.push({slot:h.FarmCost,part:l.FarmCost,dir:3,skin:t.farmCostId}),this.replaceArr.push({slot:h.FarmCost,part:l.FarmCost,dir:1,skin:t.farmCostId})),t.barmBaseId&&(this.replaceArr.push({slot:h.BarmBase,part:l.BarmBase,dir:3,skin:t.barmBaseId}),this.replaceArr.push({slot:h.BarmBase,part:l.BarmBase,dir:1,skin:t.barmBaseId})),t.barmSpecId&&(this.replaceArr.push({slot:h.BarmSpec,part:l.BarmSpec,dir:3,skin:t.barmSpecId}),this.replaceArr.push({slot:h.BarmSpec,part:l.BarmSpec,dir:1,skin:t.barmSpecId})),t.barmCostId&&(this.replaceArr.push({slot:h.BarmCost,part:l.BarmCost,dir:3,skin:t.barmCostId}),this.replaceArr.push({slot:h.BarmCost,part:l.BarmCost,dir:1,skin:t.barmCostId})),t.blegBaseId&&(this.replaceArr.push({slot:h.BlegBase,part:l.BlegBase,dir:3,skin:t.blegBaseId}),this.replaceArr.push({slot:h.BlegBase,part:l.BlegBase,dir:1,skin:t.blegBaseId})),t.blegSpecId&&(this.replaceArr.push({slot:h.BlegSpec,part:l.BlegSpec,dir:3,skin:t.blegSpecId}),this.replaceArr.push({slot:h.BlegSpec,part:l.BlegSpec,dir:1,skin:t.blegSpecId})),t.blegCostId&&(this.replaceArr.push({slot:h.BlegCost,part:l.BlegCost,dir:3,skin:t.blegCostId}),this.replaceArr.push({slot:h.BlegCost,part:l.BlegCost,dir:1,skin:t.blegCostId})),t.flegBaseId&&(this.replaceArr.push({slot:h.FlegBase,part:l.FlegBase,dir:3,skin:t.flegBaseId}),this.replaceArr.push({slot:h.FlegBase,part:l.FlegBase,dir:1,skin:t.flegBaseId})),t.flegSpecId&&(this.replaceArr.push({slot:h.FlegSpec,part:l.FlegSpec,dir:3,skin:t.flegSpecId}),this.replaceArr.push({slot:h.FlegSpec,part:l.FlegSpec,dir:1,skin:t.flegSpecId})),t.flegCostId&&(this.replaceArr.push({slot:h.FlegCost,part:l.FlegCost,dir:3,skin:t.flegCostId}),this.replaceArr.push({slot:h.FlegCost,part:l.FlegCost,dir:1,skin:t.flegCostId})),t.headBaseId&&(this.replaceArr.push({slot:h.HeadBase,part:l.HeadBase,dir:3,skin:t.headBaseId}),this.replaceArr.push({slot:h.HeadBase,part:l.HeadBase,dir:1,skin:t.headBaseId})),t.barmWeapId&&(this.replaceArr.push({slot:h.WeapBarm,part:l.WeapBarm,dir:3,skin:t.barmWeapId}),this.replaceArr.push({slot:h.WeapBarm,part:l.WeapBarm,dir:1,skin:t.barmWeapId})),t.headHairId&&(this.replaceArr.push({slot:h.HeadHair,part:l.HeadHair,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:h.HeadHair,part:l.HeadHair,dir:1,skin:t.headHairId}),this.replaceArr.push({slot:h.HeadHairBack,part:l.HeadHairBack,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:h.HeadHairBack,part:l.HeadHairBack,dir:1,skin:t.headHairId})),t.headHatsId&&(this.replaceArr.push({slot:h.HeadHats,part:l.HeadHats,dir:3,skin:t.headHatsId}),this.replaceArr.push({slot:h.HeadHats,part:l.HeadHats,dir:1,skin:t.headHatsId})),t.headSpecId&&(this.replaceArr.push({slot:h.HeadSpec,part:l.HeadSpec,dir:3,skin:t.headSpecId}),this.replaceArr.push({slot:h.HeadSpec,part:l.HeadSpec,dir:1,skin:t.headSpecId})),t.headEyesId&&this.replaceArr.push({slot:h.HeadEyes,part:l.HeadEyes,dir:3,skin:t.headEyesId}),t.headMousId&&this.replaceArr.push({slot:h.HeadMous,part:l.HeadMous,dir:3,skin:t.headMousId}),t.headMaskId&&this.replaceArr.push({slot:h.HeadMask,part:l.HeadMask,dir:3,skin:t.headMaskId}),t.farmShldId&&(this.replaceArr.push({slot:h.ShldFarm,part:l.ShldFarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:h.ShldFarm,part:l.ShldFarm,dir:1,skin:t.farmShldId}),this.replaceArr.push({slot:h.ShldBarm,part:l.ShldBarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:h.ShldBarm,part:l.ShldBarm,dir:1,skin:t.farmShldId})),t.farmWeapId&&(this.replaceArr.push({slot:h.WeapFarm,part:l.WeapFarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:h.WeapFarm,part:l.WeapFarm,dir:1,skin:t.farmWeapId}),this.replaceArr.push({slot:h.WeapBarm,part:l.WeapBarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:h.WeapBarm,part:l.WeapBarm,dir:1,skin:t.farmWeapId}))},DragonbonesDisplay.prototype.replacePartDisplay=function(t,e,i,n){var a=t.replace("$",i.toString()),s=this.mArmatureDisplay.armature.getSlot(a),h=e.replace("#",n.toString()).replace("$",i.toString()),l=this.scene.game.textures.get(this.mDragonbonesName);if(this.scene.cache.custom.dragonbone.get(this.dragonBonesName)){var c=o.f.getPartName(h),p="test resources/"+h;if(this.mErrorLoadMap.get(c))return;this.scene.textures.exists(c)||(l.frames[p]?this.mHasLoadMap.set(h,this.scene.textures.get(c)):this.mLoadMap.set(s.name,[s.name,h]))}},DragonbonesDisplay.prototype.startLoad=function(){var t=this,e=[];this.scene.load.once(Phaser.Loader.Events.COMPLETE,(function(i,n,o){e&&t.scene&&(t.refreshAvatar(),t.mLoadMap.clear())}),this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,(function(e){t.mLoadMap.delete(e.key),t.mErrorLoadMap.set(e.key,e)}),this),this.mLoadMap.forEach((function(t){var i=t,n=o.f.getPartUrl(i[1]),a=o.f.getPartName(i[1]);e.push({key:a,url:n})})),this.scene.load.image(e),this.scene.load.start()},DragonbonesDisplay.prototype.refreshAvatar=function(){var t=this,e=this.scene.game.textures.get(this.mDragonbonesName),i=e.getFrameNames(),n="bones_"+this.mDisplayInfo.id;this.scene.textures.get(n);this.mDragonBonesRenderTexture||(this.mDragonBonesRenderTexture=this.scene.make.renderTexture({x:0,y:0,width:e.source[0].width,height:e.source[0].height},!1)),this.mDragonBonesRenderTexture.clear();for(var a=0,s=i.length;a<s;a++){var h=i[a],l=h.split("/")[1].split("_"),c=l[4]?l[0]+"_"+l[1]+"_"+l[3]+"_"+l[4]:l[0]+"_"+l[1]+"_"+l[3],p=(this.mArmatureDisplay.armature.getSlot(c),e.get(h)),u=this.mLoadMap.get(c);if(u){var m=u[1]+"_png",d=this.scene.game.textures.get(m);this.mDragonBonesRenderTexture.drawFrame(m,d.firstFrame,p.cutX,p.cutY)}else for(var f=0,y=this.replaceArr;f<y.length;f++){var g=y[f],_=g.part.replace("#",g.skin.toString()).replace("$",g.dir.toString()),v=o.f.getPartName(_),b="test resources/"+_;if(g.slot.replace("$",g.dir.toString())===c){var P=this.scene.textures.get(v);if(e.frames[b]){this.mDragonBonesRenderTexture.drawFrame(this.mDragonbonesName,h,p.cutX,p.cutY);break}this.mDragonBonesRenderTexture.drawFrame(v,P.firstFrame,p.cutX,p.cutY);break}}}this.mDragonBonesRenderTexture.snapshotArea(0,0,e.source[0].width,e.source[0].height,(function(i){if(i instanceof HTMLImageElement){t.scene.game.textures.exists(n)&&t.scene.game.textures.removeKey(n);var o=t.scene.game.textures.create(n,i,e.source[0].width,e.source[0].height);t.mAntial&&o.setFilter(Phaser.Textures.FilterMode.NEAREST),t.mArmatureDisplay.armature.replacedTexture=o}})),this.mArmatureDisplay.visible=!0},DragonbonesDisplay.prototype.clearFadeTween=function(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())},DragonbonesDisplay.prototype.onArmatureLoopComplete=function(t){if(this.mArmatureDisplay&&this.mActionName){var e=this.mActionName.playingQueue;void 0===e.playedTimes?e.playedTimes=1:e.playedTimes++,e.playedTimes>=e.playTimes&&(this.mArmatureDisplay.removeDBEventListener(dragonBones.EventObject.LOOP_COMPLETE,this.onArmatureLoopComplete,this),e.complete&&(e.complete.call(this),delete e.complete))}},DragonbonesDisplay.prototype.onSoundEventHandler=function(t){t.name&&this.mRoomService.world.playSound({field:n.Element,key:t.name})},Object.defineProperty(DragonbonesDisplay.prototype,"dragonBonesName",{get:function(){return this.mDragonbonesName},set:function(t){this.mDragonbonesName=t,this.buildDragbones()},enumerable:!1,configurable:!0}),DragonbonesDisplay}(a.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var n,o=i(9),a=i(35),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function MainUIScene(){var e=t.call(this,{key:MainUIScene.name})||this;return e.timeOutID=0,e.timeOutCancelMap={},e.timeOutCallerList=[],e.timeOutTimeMap={},e}return s(MainUIScene,t),MainUIScene.prototype.preload=function(){},MainUIScene.prototype.init=function(t){this.mRoom=t.room},MainUIScene.prototype.create=function(){this.fps=this.add.text(10,10,"",{style:{color:"#64DD17"}}),this.fps.setStroke("0x0",1),this.fps.setFontFamily(o.a.DEFULT_FONT),this.fps.setFontSize(20*window.devicePixelRatio),this.sizeTF=this.add.text(10,50,"",{style:{color:"#64DD17"},wordWrap:{width:800,useAdvancedWrap:!0}}),this.sizeTF.setFontSize(20*window.devicePixelRatio),this.sizeTF.setFontFamily(o.a.DEFULT_FONT),this.sizeTF.setStroke("#0",3);var t=this.mRoom.world;t.game.device.os.desktop||t.inputManager&&t.inputManager.setScene(this),t.uiManager.setScene(this)},MainUIScene.prototype.setTimeout=function(t,e){var i=Date.now();return this.timeOutCallerList[++this.timeOutID]=t,this.timeOutTimeMap[this.timeOutID]={now:i,delay:e},this.timeOutID},MainUIScene.prototype.clearTimeout=function(t){this.timeOutCancelMap[t]=!0},MainUIScene.prototype.update=function(t,e){this.fps.setText(this.game.loop.actualFps.toFixed())},MainUIScene.prototype.getKey=function(){return this.sys.config.key},MainUIScene.prototype.checkSize=function(t){t.width,t.height;var e=this.mRoom.world,i=e.getSize();this.sizeTF.text="CSS size: "+e.getConfig().width+" "+e.getConfig().height+"\n    Game size: "+i.width.toFixed(2)+" "+i.height.toFixed(2)+"\n    deviceRatio: "+window.devicePixelRatio+"\n    scene ratio: "+e.scaleRatio+"\n    ui ratio: "+e.uiRatio+"\n    ui scale: "+e.uiScale.toFixed(5)+"\n    "},MainUIScene}(a.a),l=i(269),c=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),p=function(t){function PlayScene(e){return t.call(this,e||{key:PlayScene.name})||this}return c(PlayScene,t),PlayScene.prototype.preload=function(){},PlayScene.prototype.init=function(t){t&&(this.mRoom=t.room)},PlayScene.prototype.create=function(){var t=this.cameras.main;this.cameras.addExisting(new l.a(0,0,this.sys.scale.width,this.sys.scale.height,this.mRoom.world.scaleRatio),!0),this.cameras.remove(t),this.game.scene.getScene(h.name)||this.game.scene.add(h.name,h,!1),this.game.scene.getScene(h.name).scene.isActive()||this.scene.launch(h.name,{room:this.mRoom}),this.scene.sendToBack(),this.scale.on("orientationchange",this.checkOriention,this),this.scale.on("resize",this.checkSize,this),this.mRoom&&this.mRoom.startPlay()},PlayScene.prototype.update=function(t,e){this.mRoom&&this.mRoom.update(t,e)},PlayScene.prototype.setViewPort=function(e,i,n,o){t.prototype.setViewPort.call(this,e,i,n,o),this.cameras.main.zoom=Math.ceil(window.devicePixelRatio)},PlayScene.prototype.getKey=function(){return this.sys.config.key},PlayScene.prototype.checkOriention=function(t){t===Phaser.Scale.PORTRAIT||Phaser.Scale.LANDSCAPE},PlayScene.prototype.checkSize=function(t){t.width,t.height},PlayScene}(a.a)},function(t,e,i){"use strict";var n=i(115),o=i(45);const a=Phaser.Utils.Objects.GetValue,s=Phaser.Math.Distance.Between;class Tap_Tap extends n.a{constructor(t,e){super(t,e);var i=this,n={states:{IDLE:{enter:function(){i.stop(),i.tapsCount=0,i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start(),i.tapsCount=0,i.emit("tappingstart",i,i.gameObject,i.lastPointer)}},RECOGNIZED:{enter:function(){i.start(),i.emit("tap",i,i.gameObject,i.lastPointer),i.emit(i.tapsCount+"tap",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=h},eventEmitter:!1};this.setRecongizedStateObject(new o.a(n))}resetFromJSON(t){super.resetFromJSON(t),this.setMaxHoldTime(a(t,"time",250)),this.setTapInterval(a(t,"tapInterval",200)),this.setDragThreshold(a(t,"threshold",9)),this.setTapOffset(a(t,"tapOffset",10));var e=a(t,"taps",void 0);return void 0!==e?this.setTaps(e):(this.setMaxTaps(a(t,"maxTaps",void 0)),this.setMinTaps(a(t,"minTaps",void 0))),this}onDragStart(){switch(this.state){case h:this.state=l;break;case l:var t=this.lastPointer;s(t.upX,t.upY,t.x,t.y)>this.tapOffset&&(this.state=c,this.state=l);break;case c:this.state=l}}onDragEnd(){this.state===l&&(this.tapsCount++,this.emit("tapping",this,this.gameObject,this.lastPointer),void 0!==this.maxTaps&&this.tapsCount===this.maxTaps&&(this.state=c))}onDrag(){this.state!==h&&this.pointer.getDistance()>this.dragThreshold&&(this.state=h)}preUpdate(t,e){if(this.state===l){var i=this.lastPointer;if(i.isDown)t-i.downTime>this.holdTime&&(this.state=h);else t-i.upTime>this.tapInterval&&(void 0===this.minTaps||this.tapsCount>=this.minTaps?this.state=c:this.state=h)}}postUpdate(t,e){this.state===c&&(this.state=h)}get isTapped(){return this.state===c}setMaxHoldTime(t){return this.holdTime=t,this}setTapInterval(t){return this.tapInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setTapOffset(t){return this.tapOffset=t,this}setMaxTaps(t){return this.maxTaps=t,this}setMinTaps(t){return this.minTaps=t,this}setTaps(t,e){return void 0===e&&(e=t),this.setMinTaps(t).setMaxTaps(e),this}}const h="IDLE",l="BEGIN",c="RECOGNIZED";var p=Tap_Tap;e.a=p},function(t,e,i){"use strict";var n=i(115),o=i(45);const a=Phaser.Utils.Objects.GetValue;class Press_Press extends n.a{constructor(t,e){super(t,e);var i=this,n={states:{IDLE:{enter:function(){i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start()},exit:function(){i.stop()}},RECOGNIZED:{enter:function(){i.emit("pressstart",i,i.gameObject,i.lastPointer)},exit:function(){i.emit("pressend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=s},eventEmitter:!1};this.setRecongizedStateObject(new o.a(n))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(a(t,"threshold",9)),this.setMinHoldTime(a(t,"time",251)),this}onDragStart(){this.state=0===this.holdTime?l:h}onDragEnd(){this.state=s}onDrag(){this.state!==s&&this.pointer.getDistance()>this.dragThreshold&&(this.state=s)}preUpdate(t,e){this.state===h&&(t-this.pointer.downTime>=this.holdTime&&(this.state=l))}get isPressed(){return this.state===l}setDragThreshold(t){return this.dragThreshold=t,this}setMinHoldTime(t){return this.holdTime=t,this}}const s="IDLE",h="BEGIN",l="RECOGNIZED";var c=Press_Press;e.a=c},function(t,e,i){"use strict";var n=i(37);const o=Phaser.Utils.Objects.GetValue;class TickTask{constructor(t,e){this.parent=t,this._isRunning=!1,this.tickingState=!1,this.setEventEmitter(o(e,"eventEmitter",void 0)),this.setTickingMode(o(e,"tickingMode",1))}boot(){2!==this.tickingMode||this.tickingState||this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(t){"string"==typeof t&&(t=a[t]),this.tickingMode=t}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking()))}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(){this.isRunning=!1,this.emit("complete",this.parent,this)}}Object.assign(TickTask.prototype,n.a);const a={no:0,lazy:1,always:2};var s=TickTask,h=i(52);const l=Phaser.Utils.Objects.GetValue;const c=0,p=1,u="IDLE";e.a=class OnePointerTracer_OnePointerTracer extends s{constructor(t,e){var i=Object(h.a)(t);i===t&&(t=void 0),super(i,e),this.scene=i,this.gameObject=t,t&&t.setInteractive(l(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(l(t,"enable",!0)),void 0===this.gameObject?this.bounds=l(t,"bounds",void 0):this.bounds=void 0,this.tracerState=c,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,this.isTouchingAnyObject=!1,this}boot(){super.boot(),this.gameObject?this.gameObject.on("pointerdown",this.onPointerDown,this):this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.gameObject?this.gameObject.off("pointerdown",this.onPointerDown,this):this.scene&&this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene&&(this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0,this.gameObject=void 0,this.bounds=void 0,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,super.shutdown()}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t||(t||this.dragCancel(),this.enable=t),this}onPointerDown(t,e){this.enable&&(void 0===this.pointer&&(!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer!==t&&(this.pointer=t,this.lastPointer=t,this.movedState=!1,this.tracerState=p,void 0===this.gameObject&&(this.isTouchingAnyObject=e.length>0),this.onDragStart()))}onPointerUp(t){this.enable&&((!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer===t&&(this.pointer=void 0,this.movedState=!1,this.tracerState=c,this.onDragEnd()))}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),i=this.pointer===t;!i&&e||(i&&!e?this.onPointerUp(t):(this.movedState||(this.movedState=t.x!==t.downX||t.y!==t.downY),this.movedState&&this.onDrag()))}}dragCancel(){return this.tracerState===p&&this.onDragEnd(),this.pointer=void 0,this.tracerState=c,this}onDragStart(){this.emit("dragstart",this)}onDragEnd(){this.emit("dragend",this)}onDrag(){this.emit("drag",this)}preUpdate(t,e){}postUpdate(t,e){}startTicking(){super.startTicking(),this.scene.events.on("preupdate",this.preUpdate,this),this.scene.events.on("postupdate",this.postUpdate,this)}stopTicking(){super.stopTicking(),this.scene&&(this.scene.events.off("preupdate",this.preUpdate,this),this.scene.events.off("postupdate",this.postUpdate,this))}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=u,this}}},,function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Size(e,i){return t.call(this,e,i)||this}return o(Size,t),Size}(Phaser.Structs.Size)},function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicSprite",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function DynamicSprite(e,i,n){var o=t.call(this,e,i,n,void 0)||this;return e.sys.updateList.add(o),o}return o(DynamicSprite,t),DynamicSprite.prototype.load=function(t,e,i,n,o){this.mLoadCompleteCallbak=n,this.mLoadErrorCallback=o,this.mLoadContext=i,this.mUrl=t+e,this.scene.cache.obj.get(this.mUrl)?this.onLoadComplete():(this.scene.load.atlas(this.mUrl,t,e),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())},DynamicSprite.prototype.destroy=function(e){this.scene.sys.updateList.remove(this),t.prototype.destroy.call(this,e)},DynamicSprite.prototype.onLoadComplete=function(){if(this.mLoadCompleteCallbak){var t=this.mLoadCompleteCallbak;this.mLoadCompleteCallbak=null,t.call(this.mLoadContext),this.mLoadContext=null}this.scene.anims.create({key:this.mUrl,frames:this.scene.anims.generateFrameNames(this.mUrl),repeat:1}),this.play(this.mUrl)},DynamicSprite.prototype.onLoadError=function(t){if(this.mUrl===t.url&&this.mLoadErrorCallback){var e=this.mLoadErrorCallback;this.mLoadErrorCallback=null,e.call(this.mLoadContext),this.mLoadContext=null}},DynamicSprite}(Phaser.GameObjects.Sprite)},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i(22),o=i(14),a=function(){function BlockObject(t){this.mRoomService=t,this.isUsed=!1,this.mRenderable=!1,this.mBlockable=!0,this.mInputEnable=n.c.Diasble,this.isUsed=!0}return BlockObject.prototype.setRenderable=function(t,e){var i=this;if(void 0===e&&(e=0),this.mRenderable!==t){if(this.mRenderable=t,t)return this.addDisplay(),void(e>0&&this.fadeIn());e>0?this.fadeOut((function(){i.removeDisplay()})):this.removeDisplay()}},BlockObject.prototype.getPosition=function(){return this.mDisplay?new o.a(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z):new o.a},BlockObject.prototype.getPosition45=function(){var t=this.getPosition();return t?this.mRoomService.transformTo45(t):new o.a},BlockObject.prototype.getRenderable=function(){return this.mRenderable},BlockObject.prototype.fadeIn=function(t){this.mDisplay&&this.mDisplay.fadeIn(t)},BlockObject.prototype.fadeOut=function(t){this.mDisplay&&this.mDisplay.fadeOut(t)},BlockObject.prototype.fadeAlpha=function(t){this.mDisplay},BlockObject.prototype.setInputEnable=function(t){if(this.mInputEnable=t,this.mDisplay)switch(t){case n.c.Interactive:this.mModel&&this.mModel.hasInteractive&&this.mDisplay.setInteractive();break;case n.c.Enable:this.mDisplay.setInteractive();break;default:this.mDisplay.disableInteractive()}},BlockObject.prototype.setBlockable=function(t){return this.mBlockable!==t&&(this.mBlockable=t,this.mDisplay&&this.mRoomService&&(t?this.mRoomService.addBlockObject(this):this.mRoomService.removeBlockObject(this))),this},BlockObject.prototype.destroy=function(){this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null)},BlockObject.prototype.clear=function(){this.isUsed=!1},BlockObject.prototype.addDisplay=function(){},BlockObject.prototype.removeDisplay=function(){this.mDisplay&&this.mDisplay.removeFromParent()},BlockObject.prototype.addToBlock=function(){this.mBlockable?this.mRoomService.addBlockObject(this):this.addDisplay()},BlockObject.prototype.updateBlock=function(){this.mBlockable&&this.mRoomService.updateBlockObject(this)},Object.defineProperty(BlockObject.prototype,"id",{get:function(){return-1},enumerable:!1,configurable:!0}),BlockObject}()},function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicNinepatch",(function(){return o}));var n=i(44),o=function(){function DynamicNinepatch(t,e){this.mScene=t,this.mParent=e}return DynamicNinepatch.prototype.load=function(t,e,i,n){this.mLoadCompleteCallBack=i,this.mLoadContext=n,this.mConfig=e,this.mUrl=t,this.mScene.cache.obj.get(t)?this.onLoadCompleteHandler():(this.mScene.load.image(this.mUrl,this.mUrl),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},DynamicNinepatch.prototype.onLoadCompleteHandler=function(){this.mImage=new n.a(this.mScene,this.mConfig),this.mLoadCompleteCallBack&&(this.mLoadCompleteCallBack.call(this.mLoadContext,this.mImage),this.mLoadCompleteCallBack=null,this.mLoadContext=null)},Object.defineProperty(DynamicNinepatch.prototype,"image",{get:function(){return this.mImage},enumerable:!1,configurable:!0}),DynamicNinepatch}()},function(t,e,i){"use strict";e.a=function(t){return"[object Array]"===Object.prototype.toString.call(t)}},function(t,e,i){"use strict";var n=i(123),__spreadArrays=function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),o=0;for(e=0;e<i;e++)for(var a=arguments[e],s=0,h=a.length;s<h;s++,o++)n[o]=a[s];return n},o=function(){function Helpers(){}return Helpers.genId=function(){return(new n).natural({min:1e4,max:Helpers.MAX_ID})},Helpers.flipArray=function(t){if(t){var e=__spreadArrays(t),i=[];if(e.length>0)for(var n=e[0].length,o=0;o<n;o++){i[o]=[];for(var a=0,s=e;a<s.length;a++){var h=s[a];i[o].push(h[o])}}return i}},Helpers.MAX_ID=Math.pow(2,31),Helpers}();e.a=o},,function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(3),o=function(){function Animation(t){var e=t.baseLoc.split(",");this.mNode=t.node,this.mID=t.node.id,this.mName=t.node.name,this.mFrameName=t.frameName,!t.frameName||this.mFrameName.length,this.mLoop=t.loop,t.loop,t.frameRate,t.originPoint,t.baseLoc,this.mFrameRate=t.frameRate,this.mBaseLoc=new Phaser.Geom.Point(parseInt(e[0],10),parseInt(e[1],10));var i=t.originPoint;this.mOriginPoint=new Phaser.Geom.Point(i[0],i[1]),"string"==typeof t.collisionArea?this.mCollisionArea=this.stringToArray(t.collisionArea,",","&")||[[0]]:this.mCollisionArea=t.collisionArea||[[0]],"string"==typeof t.walkableArea?this.mWalkableArea=this.stringToArray(t.walkableArea,",","&")||[[0]]:this.mWalkableArea=t.walkableArea||[[0]],this.mInteractiveArea=t.interactiveArea,this.mLayer=t.layer,this.mMountLayer=t.mountLayer}return Animation.prototype.createProtocolObject=function(){var t=n.op_gameconfig_01.AnimationData.create();return t.node=this.mNode,t.baseLoc=this.baseLoc.x+","+this.baseLoc.y,t.node.name=this.name,t.loop=this.loop,t.frameRate=this.frameRate,t.frameName=this.frameName,t.originPoint=[this.originPoint.x,this.originPoint.y],t.walkOriginPoint=[this.originPoint.x,this.originPoint.y],t.walkableArea=this.arrayToString(this.mWalkableArea,",","&"),t.collisionArea=this.arrayToString(this.mCollisionArea,",","&"),t.interactiveArea=this.mInteractiveArea,t.layer=this.mLayer,t.mountLayer=this.mMountLayer,t},Animation.prototype.stringToArray=function(t,e,i){if(t){for(var n=[],o=0,a=t.split(i);o<a.length;o++){var s=a[o].split(e);n.push(s.map((function(t){return parseInt(t,10)})))}return n}},Animation.prototype.arrayToString=function(t,e,i){if(!t)return"";for(var n=[],o=0,a=t;o<a.length;o++){var s=a[o];n.push(s.join(e))}return n.join(i)},Object.defineProperty(Animation.prototype,"baseLoc",{get:function(){return this.mBaseLoc},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"frameName",{get:function(){return this.mFrameName},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"frameRate",{get:function(){return this.mFrameRate},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"loop",{get:function(){return this.mLoop},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"name",{get:function(){return this.mName},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"collisionArea",{get:function(){return this.mCollisionArea},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"walkableArea",{get:function(){return this.mWalkableArea},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"originPoint",{get:function(){return this.mOriginPoint},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"interactiveArea",{get:function(){return this.mInteractiveArea},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"layer",{get:function(){return this.mLayer.length>0?this.mLayer:[{frameName:this.mFrameName,offsetLoc:this.mBaseLoc}]},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"mountLayer",{get:function(){return this.mMountLayer},enumerable:!1,configurable:!0}),Animation}()},function(t,e,i){"use strict";i.r(e),i.d(e,"ControlFMediator",(function(){return u}));var n,o=i(126),a=i(4),s=i(3),h=i(22),l=i(7),c=i(18),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function ControlFMediator(e,i,n){var o=t.call(this)||this;return o.mUIType=c.a.Tips,o.mScene=i,o.mLayerManager=e,o.world=n,o}return p(ControlFMediator,t),ControlFMediator.prototype.getName=function(){return""},ControlFMediator.prototype.getView=function(){},ControlFMediator.prototype.hide=function(){this.mShow=!1,this.mView&&this.mView.isShow()&&(this.world.roomManager.currentRoom&&this.world.roomManager.currentRoom.playerManager.actor&&this.world.roomManager.currentRoom.playerManager.actor.getState()!==h.d.WALK||(this.mView.off("control",this.handControlF,this),this.mView.destroy(),this.mView=null))},ControlFMediator.prototype.isSceneUI=function(){return!1},ControlFMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ControlFMediator.prototype.resize=function(){this.mView&&this.mView.resize()},ControlFMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||this.mShow||(this.mView=new o.ControlFPanel(this.mScene,this.world),this.mView.on("control",this.handControlF,this),this.mLayerManager.addToUILayer(this.mView),this.mView.show(e),t.prototype.show.call(this,e))},ControlFMediator.prototype.update=function(t){},ControlFMediator.prototype.destroy=function(){this.mView&&(this.mView.off("control",this.handControlF,this),this.mView.destroy(),this.mView=null),this.mScene=null,this.mLayerManager=null,t.prototype.destroy.call(this)},ControlFMediator.prototype.handControlF=function(){if(this.world&&this.world.connection){var t,e=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),i=e.content;t=(t=this.world.inputManager?this.world.inputManager.getKeyDowns():[]).concat(Phaser.Input.Keyboard.KeyCodes.F),i.keyCodes=t,this.world.connection.send(e)}},ControlFMediator.NAME="ControlFMediator",ControlFMediator}(l.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ControlFPanel",(function(){return l}));var n,o=i(6),a=i(5),s=i(9),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ControlFPanel(e,i){var n=t.call(this,e,i)||this;return n.setTween(!1),n}return h(ControlFPanel,t),ControlFPanel.prototype.addListen=function(){this.on("pointerdown",this.onMouseDownHandler,this)},ControlFPanel.prototype.removeListen=function(){this.off("pointerdown",this.onMouseDownHandler,this)},ControlFPanel.prototype.resize=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),this.mScene){var i=this.mScene.cameras.main.worldView;this.x=i.x+(i.width>>1),this.y=i.y+(i.height>>1)}},ControlFPanel.prototype.destroy=function(){this.mControlText&&this.mControlText.destroy(!0),t.prototype.destroy.call(this)},ControlFPanel.prototype.preload=function(){this.mScene.load.image("controlF_background",a.h.getRes("ui/controlf/background.png")),t.prototype.preload.call(this)},ControlFPanel.prototype.init=function(){if(this.mScene){var e=this.mScene.make.image({key:"controlF_background"},!1);this.add(e),this.mControlText=this.mScene.make.text({align:"center",text:"F",style:{font:s.a.YAHEI_20_BOLD}},!1),this.mControlText.x=-(this.mControlText.width>>1),this.mControlText.y=-(this.mControlText.height>>1),this.add(this.mControlText),this.setSize(e.width,e.height),this.setInteractive(),t.prototype.init.call(this),this.resize()}},ControlFPanel.prototype.onMouseDownHandler=function(){this.scale=.8},ControlFPanel.prototype.onMouseUpHandler=function(){this.scale=1,this.emit("control")},ControlFPanel}(o.BasePanel)},function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var n,o=i(4),a=i(3),s=i(268),h=i(28),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=a.op_def.NodeType,p=function(t){function TerrainManager(e,i){var n=t.call(this)||this;n.mRoom=e,n.hasAddComplete=!1,n.mTerrains=new Map,n.mPacketFrameCount=0,n.mListener=i,n.connection&&(n.connection.addPacketListener(n),n.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,n.onAdd),n.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE_END,n.addComplete),n.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,n.onRemove),n.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SYNC_SPRITE,n.onSyncSprite),n.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_CHANGE_SPRITE_ANIMATION,n.onChangeAnimation)),n.mRoom&&n.mRoom.world&&(n.mGameConfig=n.mRoom.world.elementStorage);var o=n.roomService.miniSize;n.mMap=new Array(o.cols);for(var s=0;s<o.rows;s++)n.mMap[s]=new Array(o.rows).fill(0);return n}return l(TerrainManager,t),TerrainManager.prototype.init=function(){},TerrainManager.prototype.destroy=function(){var t=this;this.connection&&this.connection.removePacketListener(this),this.mTerrains&&(this.mTerrains.forEach((function(e){return t.remove(e.id)})),this.mTerrains.clear())},TerrainManager.prototype.get=function(t){var e=this.mTerrains.get(t);if(e)return e},TerrainManager.prototype.add=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];this._add(n)}},TerrainManager.prototype.remove=function(t){if(this.mTerrains){var e=this.mTerrains.get(t);return e&&(this.mTerrains.delete(t),e.destroy()),e}},TerrainManager.prototype.getElements=function(){return Array.from(this.mTerrains.values())},TerrainManager.prototype.onAdd=function(t){if(this.mPacketFrameCount++,this.mGameConfig){var e=t.content,i=e.sprites,n=e.nodeType,o=e.packet;if(n===a.op_def.NodeType.TerrainNodeType){for(var s=[],l=0,c=i;l<c.length;l++){var p=c[l];if(p.point3f){var u=new h.a(p,n);u.displayInfo||this.checkTerrainDisplay(u),u.displayInfo||s.push(u.id),this._add(u)}}this.fetchDisplay(s),this.mListener&&this.mPacketFrameCount===o.totalFrame&&this.mListener.onFullPacketReceived(n)}}},TerrainManager.prototype._add=function(t){var e=this.mTerrains.get(t.id);return e?e.model=t:e=new s.a(t,this),this.mTerrains.set(e.id||0,e),e},TerrainManager.prototype.addComplete=function(t){this.hasAddComplete=!0},TerrainManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,n=e.ids;if(i===a.op_def.NodeType.TerrainNodeType)for(var o=0,s=n;o<s.length;o++){var h=s[o];this.remove(h)}},TerrainManager.prototype.onSyncSprite=function(t){var e=t.content;if(e.nodeType===a.op_def.NodeType.TerrainNodeType)for(var i=null,n=0,o=e.sprites;n<o.length;n++){var s=o[n];if(i=this.get(s.id)){var l=new h.a(s,e.nodeType);i.model=l}}},TerrainManager.prototype.checkDisplay=function(t){if(!t.displayInfo){var e=this.roomService.world.elementStorage.getDisplayModel(t.bindID||t.id);if(e)return t.displayInfo=e,e}},TerrainManager.prototype.checkTerrainDisplay=function(t){if(!t.displayInfo){var e=this.roomService.world.elementStorage.getTerrainPaletteByBindId(t.bindID);e&&(t.displayInfo=e)}},TerrainManager.prototype.fetchDisplay=function(t){if(0!==t.length){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_REQ_VIRTUAL_WORLD_QUERY_SPRITE_RESOURCE);e.content.ids=t,this.connection.send(e)}},TerrainManager.prototype.removeMap=function(t){this.setMap(t,1)},TerrainManager.prototype.addMap=function(t){this.setMap(t,0)},TerrainManager.prototype.setMap=function(t,e){var i=t.displayInfo;if(i){var n=t.currentAnimation.animationName,o=i.getCollisionArea(n,!1),a=(i.getWalkableArea(n,!1),i.getOriginPoint(n,!1),o.length),s=o[0].length;1===a&&1===s&&(a=2,s=2,!1);t.pos;for(var h=0;h<a;h++)for(var l=0;l<s;l++);}},TerrainManager.prototype.onChangeAnimation=function(t){var e=t.content;if(e.nodeType===c.TerrainNodeType){e.changeAnimation;for(var i=0,n=e.ids;i<n.length;i++){var o=n[i];this.get(o)}}},Object.defineProperty(TerrainManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection},enumerable:!1,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!1,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"camera",{get:function(){return this.camera},enumerable:!1,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"map",{get:function(){return this.mMap},enumerable:!1,configurable:!0}),TerrainManager}(o.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n,o=i(78),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function TerrainDisplay(){return null!==t&&t.apply(this,arguments)||this}return a(TerrainDisplay,t),TerrainDisplay.prototype.showRefernceArea=function(){},TerrainDisplay}(o.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"DecorateManager",(function(){return l}));var n,o=i(130),a=i(4),s=i(3),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function DecorateManager(e,i){var n=t.call(this)||this;return n.mPanel=new o.DecoratePanel(e,i),n.mPanel.on("moveElement",n.onMoveElementHandler,n),n.mPanel.on("addSprite",n.onAddSpriteHandler,n),n.mPanel.on("addSingleSprite",n.onAddSingleSprtieHandle,n),n.mRoomService=i,n.mLayerManager=i.layerManager,n}return h(DecorateManager,t),DecorateManager.prototype.setElement=function(t){this.mPanel.setElement(t),this.mLayerManager.addToSceneToUI(this.mPanel),this.mPanel.show()},DecorateManager.prototype.canPut=function(t){this.mPanel&&this.mPanel.canPUt(t)},DecorateManager.prototype.remove=function(){this.mPanel.parentContainer&&this.mPanel.parentContainer.remove(this.mPanel),this.mPanel.removeListen()},DecorateManager.prototype.updatePos=function(t,e){this.mPanel&&this.mPanel.setPos(t,e)},DecorateManager.prototype.destroy=function(){this.mPanel&&this.mPanel.destroy(),t.prototype.destroy.call(this)},DecorateManager.prototype.onMoveElementHandler=function(t){this.emit("moveElement",t)},DecorateManager.prototype.onAddSpriteHandler=function(t,e){this.sendAddSpriteByType(t,e)},DecorateManager.prototype.onAddSingleSprtieHandle=function(t,e){this.sendAddSingleSprite(t,e)},DecorateManager.prototype.sendAddSpriteByType=function(t,e){if(t&&e&&!(e.length<1)){for(var i=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ADD_SPRITE_BY_TYPE),n=i.content,o=[],h=0,l=e;h<l.length;h++){var c=l[h],p=s.op_def.PBPoint3f.create();p.x=c.x,p.y=c.y,o.push(p)}n.nodeType=s.op_def.NodeType.ElementNodeType,n.sprite=t.toSprite(),n.points=o,this.mRoomService.connection.send(i)}},DecorateManager.prototype.sendAddSingleSprite=function(t,e){if(t&&e&&!(e.length<1)){for(var i=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ADD_SINGLE_SPRITE_BY_TYPE),n=i.content,o=[],h=0,l=e;h<l.length;h++){var c=l[h],p=s.op_def.PBPoint3f.create();p.x=c.x,p.y=c.y,o.push(p)}n.nodeType=s.op_def.NodeType.ElementNodeType,n.sprite=t.toSprite(),n.points=o,this.mRoomService.connection.send(i)}},DecorateManager}(Phaser.Events.EventEmitter)},function(t,e,i){"use strict";i.r(e),i.d(e,"DecoratePanel",(function(){return u}));var n,o=i(6),a=i(14),s=i(47),h=i(13),l=i(22),c=i(25),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function DecoratePanel(e,i){var n=t.call(this,e,i.world)||this;return n.mRoomService=i,n.resKey="decorate",n.minGrid=2,n.maxGrid=10,n.key="decorate_edit_menu",n.offset=new a.a,n.mScaleRatio=1,n.setTween(!1),n.mWorld&&(n.mScaleRatio=n.mWorld.scaleRatio),n}return p(DecoratePanel,t),DecoratePanel.prototype.show=function(t){this.mShowData=t,this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0):this.preload()},DecoratePanel.prototype.addListen=function(){this.mCancelBtn&&this.mCancelBtn.on("pointerup",this.onCancelHandler,this),this.mOkBtn&&this.mOkBtn.on("pointerup",this.onAddHandler,this),this.mRecycleBtn&&this.mRecycleBtn.on("pointerup",this.onRecycleHandler,this),this.mTurnBtn&&this.mTurnBtn.on("pointerup",this.onTurnHandler,this),this.mMoveBtn&&this.mMoveBtn.on("pointerup",this.onShowMoveMenuHandler,this),this.mRepeatBtn&&this.mRepeatBtn.on("pointerup",this.onShowRepeatHandler,this),this.mExtendBtn&&this.mExtendBtn.on("pointerup",this.onShowExtendsHandler,this),this.mMoveMenuContainer&&(this.mMoveMenuContainer.register(),this.mMoveMenuContainer.on("move",this.onMoveHandler,this)),this.mRepeatMenuContainer&&(this.mRepeatMenuContainer.register(),this.mRepeatMenuContainer.on("move",this.onRepeatHandler,this),this.mRepeatMenuContainer.on("hold",this.onHoldRepeatHandler,this))},DecoratePanel.prototype.removeListen=function(){this.mCancelBtn&&this.mCancelBtn.off("pointerup",this.onCancelHandler,this),this.mOkBtn&&this.mOkBtn.off("pointerup",this.onAddHandler,this),this.mRecycleBtn&&this.mRecycleBtn.off("pointerup",this.onRecycleHandler,this),this.mTurnBtn&&this.mTurnBtn.off("pointerup",this.onTurnHandler,this),this.mMoveBtn&&this.mMoveBtn.off("pointerup",this.onShowMoveMenuHandler,this),this.mRepeatBtn&&this.mRepeatBtn.off("pointerup",this.onShowRepeatHandler,this),this.mExtendBtn&&this.mExtendBtn.off("pointerup",this.onShowExtendsHandler,this),this.mMoveMenuContainer&&(this.mMoveMenuContainer.unRegister(),this.mMoveMenuContainer.off("move",this.onMoveHandler,this)),this.mRepeatMenuContainer&&(this.mRepeatMenuContainer.unRegister(),this.mRepeatMenuContainer.off("move",this.onRepeatHandler,this),this.mRepeatMenuContainer.off("hold",this.onHoldRepeatHandler,this))},DecoratePanel.prototype.setElement=function(t){if(this.mDisplayObject=t,this.mSprite=t.model,this.mInitialized){var e=this.mDisplayObject.getPosition();this.x=e.x,this.y=e.y,this.updateArrowPos(t),this.addListen()}},DecoratePanel.prototype.canPUt=function(t){if(t!==this.mCanPut){if(this.mCanPut=t,!this.mOkBtn)return;t?this.mOkBtn.clearTint():this.mOkBtn.setTint(6710886)}},DecoratePanel.prototype.setPos=function(t,e,i){return this.x=t*this.mScaleRatio,this.y=(e+this.offset.y)*this.mScaleRatio,this.z=i||0,this},DecoratePanel.prototype.preload=function(){this.addAtlas(this.key,"decorate_edit_menu/decorate_edit_menu.png","decorate_edit_menu/decorate_edit_menu.json"),t.prototype.preload.call(this)},DecoratePanel.prototype.init=function(){var e=this.scene.cameras.main.width/this.scale;this.scene.cameras.main.height,this.scale;this.mMainMenus=[],this.mMenuContainer=this.scene.make.container({x:e>>1},!1),this.mSubMenus=this.scene.make.container({x:e>>1,y:60*this.dpr},!1),this.mOkBtn=this.scene.make.image({key:this.key,frame:"ok_btn.png"},!1).setInteractive().setOrigin(0),this.mRecycleBtn=this.scene.make.image({key:this.key,frame:"recycly_btn.png"},!1).setInteractive().setOrigin(0),this.mTurnBtn=this.scene.make.image({key:this.key,frame:"turn_btn.png"},!1).setInteractive().setOrigin(0),this.mCancelBtn=this.scene.make.image({key:this.key,frame:"cancel_btn.png"},!1).setInteractive().setOrigin(0),this.mHorizontalBtn=this.scene.make.image({key:this.key,frame:"horizontal_btn.png"},!1).setInteractive().setOrigin(0),this.mMoveBtn=this.scene.make.image({key:this.key,frame:"move_btn.png"},!1).setInteractive().setOrigin(0),this.mRepeatBtn=this.scene.make.image({key:this.key,frame:"repeat_btn.png"},!1).setInteractive().setOrigin(0),this.mExtendBtn=this.scene.make.image({key:this.key,frame:"extend_btn.png"},!1).setInteractive().setOrigin(0),this.mMoveMenuContainer=new m(this.scene,this.key,this.dpr,this.scale),this.mMoveMenuContainer.y=this.mSubMenus.y+60*this.dpr+this.mMoveMenuContainer.height/2,this.mRepeatMenuContainer=new m(this.scene,this.key,this.dpr,this.scale),this.mRepeatMenuContainer.y=this.mMoveMenuContainer.y;var i=this.scale;this.add([this.mMenuContainer,this.mSubMenus]),this.mMenuContainer.add([this.mOkBtn,this.mTurnBtn,this.mRecycleBtn,this.mCancelBtn]),this.mSubMenus.add([this.mHorizontalBtn,this.mMoveBtn,this.mRepeatBtn,this.mExtendBtn]);var n=e-55*this.dpr*this.mWorld.uiScale*2;this.mMenuContainer.x=-n>>1;var o=this.mMenuContainer.list;o.map((function(t){return n-=t.width}));for(var a=n/(o.length-1)/i,s=1;s<o.length;s++){var h=o[s-1];o[s].x=h.width+h.x+a}n=e-70*this.dpr*this.mWorld.uiScale*2,this.mSubMenus.x=-n>>1;var l=this.mSubMenus.list;l.map((function(t){return n-=t.width})),a=n/(l.length-1)/i;for(s=1;s<l.length;s++){h=l[s-1];l[s].x=h.width+h.x+a}this.mMoveMenuContainer.x=this.mSubMenus.x+this.mMoveBtn.x+this.mMoveBtn.width/2+29*this.dpr,this.mRepeatMenuContainer.x=this.mSubMenus.x+this.mRepeatBtn.x+this.mRepeatBtn.width/2+29*this.dpr,this.mCanPut?this.mOkBtn.clearTint():this.mOkBtn.setTint(6710886),t.prototype.init.call(this),this.setElement(this.mDisplayObject)},DecoratePanel.prototype.onLeftUpHandler=function(){if(this.mDisplayObject){var t=this.mRoomService.transformToMini45(this.mDisplayObject.getPosition());t.x-=1,this.onMoveElement(t)}},DecoratePanel.prototype.onLeftDownHandler=function(){var t=this.mRoomService.transformToMini45(this.mDisplayObject.getPosition());t.y+=1,this.onMoveElement(t)},DecoratePanel.prototype.onRightUpHandler=function(){var t=this.mRoomService.transformToMini45(this.mDisplayObject.getPosition());t.y-=1,this.onMoveElement(t)},DecoratePanel.prototype.onRightDownHandler=function(){var t=this.mRoomService.transformToMini45(this.mDisplayObject.getPosition());t.x=t.x+1,this.onMoveElement(t)},DecoratePanel.prototype.getNorthWestPoints=function(t){void 0===t&&(t=10);for(var e=this.mSprite.currentCollisionArea,i=this.mSprite.currentCollisionPoint,n=[],o=this.mRoomService.transformToMini45(this.mSprite.pos),a=0;a<t;a++)n[a]=this.mRoomService.transformToMini90(o),o.x-=e[0].length;return this.checkNextPos(n,e,i)},DecoratePanel.prototype.getWestSouthPoints=function(t){void 0===t&&(t=10);for(var e=this.mSprite.currentCollisionArea,i=this.mSprite.currentCollisionPoint,n=[],o=this.mRoomService.transformToMini45(this.mSprite.pos),a=0;a<t;a++)n[a]=this.mRoomService.transformToMini90(o),o.y+=e.length;return this.checkNextPos(n,e,i)},DecoratePanel.prototype.getSouthEastPoints=function(t){void 0===t&&(t=10);for(var e=this.mSprite.currentCollisionArea,i=this.mSprite.currentCollisionPoint,n=[],o=this.mRoomService.transformToMini45(this.mSprite.pos),a=0;a<t;a++)n[a]=this.mRoomService.transformToMini90(o),o.x+=e[0].length;return this.checkNextPos(n,e,i)},DecoratePanel.prototype.getEastNorthPoints=function(t){void 0===t&&(t=10);for(var e=this.mSprite.currentCollisionArea,i=this.mSprite.currentCollisionPoint,n=[],o=this.mRoomService.transformToMini45(this.mSprite.pos),a=0;a<t;a++)n[a]=this.mRoomService.transformToMini90(o),o.y-=e.length;return this.checkNextPos(n,e,i)},DecoratePanel.prototype.checkNextPos=function(t,e,i){for(var n=[],o=0,a=t;o<a.length;o++){var s=a[o],h=this.getNextRepeatPos(s,e,i);if(!h)break;n.push(h)}return n},DecoratePanel.prototype.getNextRepeatPos=function(t,e,i){if(this.mRoomService.canPut(t,e,i))return t},DecoratePanel.prototype.onMoveElement=function(t){if(this.mDisplayObject){var e=this.mRoomService.transformToMini90(t);this.emit("moveElement",e)}},DecoratePanel.prototype.createImage=function(t,e,i,n){return this.scene.make.image({key:t,frame:e,x:i,y:n},!1).setInteractive().setOrigin(0)},DecoratePanel.prototype.validateGrid=function(t){return t>this.maxGrid&&(t=this.maxGrid),t<this.minGrid&&(t=this.minGrid),t},DecoratePanel.prototype.updateArrowPos=function(t){var e;if(t&&t.model&&t.getDisplay()){t.getDisplay();var i=t.model.currentCollisionArea.length,n=t.model.currentCollisionArea[0].length;i=this.validateGrid(i),n=this.validateGrid(n),-1===t.getDisplay().scaleX&&(i=(e=[n,i])[0],n=e[1]);var o=this.mRoomService.roomSize,h={rows:i,cols:n,tileWidth:o.tileWidth/2,tileHeight:o.tileHeight/2},l=t.model,c=s.a.transformTo90(new a.a(n-l.currentCollisionPoint.y,i-l.currentCollisionPoint.x),h);this.offset.y=c.y}},DecoratePanel.prototype.onTurnHandler=function(){this.mWorld.emitter.emit(h.a.TURN_ELEMENT,this.mDisplayObject)},DecoratePanel.prototype.onRecycleHandler=function(){this.mWorld.emitter.emit(h.a.RECYCLE_ELEMENT,this.mDisplayObject)},DecoratePanel.prototype.onCancelHandler=function(){this.mWorld.emitter.emit(h.a.CANCEL_PUT,this.mDisplayObject)},DecoratePanel.prototype.onAddHandler=function(){this.mCanPut&&this.mWorld.emitter.emit(h.a.PUT_ELEMENT,this.mDisplayObject)},DecoratePanel.prototype.onMoveHandler=function(t){if("number"==typeof t)switch(t){case l.a.north_west:this.onLeftUpHandler();break;case l.a.west_south:this.onLeftDownHandler();break;case l.a.south_east:this.onRightDownHandler();break;case l.a.east_north:this.onRightUpHandler()}},DecoratePanel.prototype.onPutHandler=function(){this.mWorld.emitter.emit(h.a.PUT_ELEMENT,this.mDisplayObject)},DecoratePanel.prototype.onRepeatHandler=function(t){var e=null;switch(t){case l.a.north_west:e=this.getNorthWestPoints(2);break;case l.a.west_south:e=this.getWestSouthPoints(2);break;case l.a.south_east:e=this.getSouthEastPoints(2);break;case l.a.east_north:e=this.getEastNorthPoints(2)}this.onSendAddSingleSprite(e)},DecoratePanel.prototype.onHoldRepeatHandler=function(t){var e=null;switch(t){case l.a.north_west:e=this.getNorthWestPoints();break;case l.a.west_south:e=this.getWestSouthPoints();break;case l.a.south_east:e=this.getSouthEastPoints();break;case l.a.east_north:e=this.getEastNorthPoints()}this.onSendAddSprites(e)},DecoratePanel.prototype.onShowMoveMenuHandler=function(){this.add(this.mMoveMenuContainer),this.remove(this.mRepeatMenuContainer)},DecoratePanel.prototype.onShowRepeatHandler=function(){this.add(this.mRepeatMenuContainer),this.remove(this.mMoveMenuContainer)},DecoratePanel.prototype.onShowExtendsHandler=function(){},DecoratePanel.prototype.onSendAddSprites=function(t){t.length>1&&this.emit("addSprite",this.mSprite,t)},DecoratePanel.prototype.onSendAddSingleSprite=function(t){t.length>1&&this.emit("addSingleSprite",this.mSprite,t)},DecoratePanel}(o.BasePanel),m=function(t){function MoveMenu(e,i,n,o){void 0===n&&(n=1),void 0===o&&(o=1);var a=t.call(this,e)||this,s=e.make.image({key:i,frame:"bg.png"},!1);a.setSize(s.displayWidth,s.displayHeight),a.mArrow1=new c.a(a.scene,i,"arrow_1.png"),a.mArrow1.setData("dir",l.a.north_west),a.mArrow3=new c.a(a.scene,i,"arrow_3.png"),a.mArrow3.setData("dir",l.a.west_south),a.mArrow5=new c.a(a.scene,i,"arrow_5.png"),a.mArrow5.setData("dir",l.a.south_east),a.mArrow7=new c.a(a.scene,i,"arrow_7.png"),a.mArrow7.setData("dir",l.a.east_north),a.mBtns=[a.mArrow1,a.mArrow3,a.mArrow5,a.mArrow7],a.add(s),a.add(a.mBtns);a.width;var h=a.width-20*n;a.mBtns.map((function(t){return h-=t.displayWidth}));for(var p=h/=a.mBtns.length-1,u=3*n,m=0;m<a.mBtns.length;m++)a.mBtns[m].x=0===m?10*n+a.mBtns[m].width/2-a.width/2:p+a.mBtns[m-1].x+a.mBtns[m-1].width,a.mBtns[m].y=u;return a.setInteractive(),a}return p(MoveMenu,t),MoveMenu.prototype.register=function(){this.mArrow1.on("Hold",this.onHoldHandler,this),this.mArrow1.on("Tap",this.onClickHandler,this),this.mArrow3.on("Hold",this.onHoldHandler,this),this.mArrow3.on("Tap",this.onClickHandler,this),this.mArrow5.on("Hold",this.onHoldHandler,this),this.mArrow5.on("Tap",this.onClickHandler,this),this.mArrow7.on("Hold",this.onHoldHandler,this),this.mArrow7.on("Tap",this.onClickHandler,this)},MoveMenu.prototype.unRegister=function(){this.mArrow1.off("Hold",this.onHoldHandler,this),this.mArrow1.off("Tap",this.onClickHandler,this),this.mArrow3.off("Hold",this.onHoldHandler,this),this.mArrow3.off("Tap",this.onClickHandler,this),this.mArrow5.off("Hold",this.onHoldHandler,this),this.mArrow5.off("Tap",this.onClickHandler,this),this.mArrow7.off("Hold",this.onHoldHandler,this),this.mArrow7.off("Tap",this.onClickHandler,this)},MoveMenu.prototype.onArrow1Handler=function(t){this.emit("move",l.a.north_west)},MoveMenu.prototype.onArrow3Handler=function(){this.emit("move",l.a.west_south)},MoveMenu.prototype.onArrow5Handler=function(){this.emit("move",l.a.south_east)},MoveMenu.prototype.onArrow7Handler=function(){this.emit("move",l.a.east_north)},MoveMenu.prototype.onHoldHandler=function(t){this.emit("hold",t.getData("dir"))},MoveMenu.prototype.onClickHandler=function(t,e){this.emit("move",e.getData("dir"))},MoveMenu}(Phaser.GameObjects.Container)},,,,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"UiManager",(function(){return B}));var n,o=i(4),a=i(3),s=i(64),h=i(148),l=i(149),c=i(39),p=i(91),u=i(71),m=i(93),d=i(160),f=i(94),y=i(163),g=i(165),_=i(13),v=i(97),b=i(167),P=i(169),S=i(172),w=i(98),T=i(100),C=i(177),D=i(183),M=i(27),O=i(18),x=i(185),E=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),B=function(t){function UiManager(e){var i=t.call(this)||this;return i.worldService=e,i.mCache=[],i.mNoneUIMap=new Map,i.mSceneUIMap=new Map,i.mNormalUIMap=new Map,i.mPopUIMap=new Map,i.mTipUIMap=new Map,i.mMonopolyUIMap=new Map,i.mActivityUIMap=new Map,i.mShowuiList=[],i.mConnect=e.connection,i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_UI,i.handleShowUI),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_UPDATE_UI,i.handleUpdateUI),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CLOSE_UI,i.handleCloseUI),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ENABLE_MARKET,i.onEnableMarket),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MINING_MODE_SHOW_REWARD_PACKAGE,i.openMineSettle),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MINING_MODE_SHOW_SELECT_EQUIPMENT_PANEL,i.openEquipUpgrade),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_CRAFT_SKILLS,i.openComposePanel),i.mUILayerManager=new h.LayerManager,i.mInputTextFactory=new v.InputTextFactory(e),i.interBubbleMgr=new D.InteractiveBubbleManager(i.mUILayerManager,i.worldService),i}return E(UiManager,t),UiManager.prototype.getInputTextFactory=function(){return this.mInputTextFactory},UiManager.prototype.addPackListener=function(){this.mConnect&&(this.mConnect.addPacketListener(this),this.worldService.emitter.on(_.a.SHOW_UI,this.handleShowUI,this))},UiManager.prototype.removePackListener=function(){this.mConnect&&(this.mConnect.removePacketListener(this),this.worldService.emitter.off(_.a.SHOW_UI,this.handleShowUI,this))},UiManager.prototype.getUILayerManager=function(){return this.mUILayerManager},UiManager.prototype.setScene=function(t){this.mScene=t,this.mUILayerManager.setScene(t),this.interBubbleMgr.setScene(t),this.mCacheUI&&(this.mCacheUI(),this.mCacheUI=void 0)},UiManager.prototype.showMainUI=function(){var t=this;if(this.mScene){var e=this.mScene;if(this.clearMediator(),!this.mMedMap){this.mMedMap=new Map,this.worldService.game.device.os.desktop?this.mMedMap.set(y.BagGroupMediator.NAME,new y.BagGroupMediator(this.worldService,e)):(this.mMedMap.set(S.ActivityMediator.name,new S.ActivityMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(P.PicaMainUIMediator.name,new P.PicaMainUIMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(w.PicaChatMediator.name,new w.PicaChatMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(T.PicaNavigateMediator.name,new T.PicaNavigateMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(C.MineCarMediator.name,new C.MineCarMediator(this.mUILayerManager,e,this.worldService))),this.mMedMap.set(M.UIMediatorType.BagMediator,new c.BagMediator(this.mUILayerManager,this.worldService,e)),this.worldService.game.device.os.desktop&&this.mMedMap.set(M.UIMediatorType.ChatMediator,new s.ChatMediator(this.worldService,e)),this.mMedMap.set(M.UIMediatorType.NOTICE,new l.NoticeMediator(this.mUILayerManager,e,this.worldService)),this.mMedMap.set(p.FriendMediator.NAME,new p.FriendMediator(e,this.worldService)),this.mMedMap.set(x.ReAwardTipsMediator.name,new x.ReAwardTipsMediator(e,this.worldService));for(var i=0,n=this.mCache;i<n.length;i++){var o=n[i][0];this.showMed(o.name,o)}this.mCache.length=0}this.mMedMap.forEach((function(e,i){var n,o=!!t.worldService.game.device.os.desktop;switch(i){case d.LeftMediator.NAME:case m.RightMediator.NAME:case f.BottomMediator.NAME:n=t.mSceneUIMap;break;case y.BagGroupMediator.NAME:case M.UIMediatorType.ChatMediator:case u.RankMediator.NAME:o&&(n=t.mSceneUIMap)}n&&n.set(i,e),e.isSceneUI()&&e.show()}))}else this.mCacheUI=this.showMainUI},UiManager.prototype.showDecorateUI=function(){this.mScene?(this.clearMediator(),this.mMedMap||(this.mMedMap=new Map),this.mMedMap.set(b.DecorateControlMediator.NAME,new b.DecorateControlMediator(this.mUILayerManager,this.mScene,this.worldService)),this.mMedMap.set(M.UIMediatorType.NOTICE,new l.NoticeMediator(this.mUILayerManager,this.mScene,this.worldService)),this.showAll()):this.mCacheUI=this.showDecorateUI},UiManager.prototype.resize=function(t,e){this.mMedMap&&this.mMedMap.forEach((function(t){t.isShow&&t.resize()}))},UiManager.prototype.setMediator=function(t,e){this.mMedMap.set(t,e)},UiManager.prototype.getMediator=function(t){if(this.mMedMap)return this.mMedMap.get(t)},UiManager.prototype.clearMediator=function(){this.mMedMap&&(this.mMedMap.forEach((function(t){return t.destroy()})),this.mMedMap.clear(),this.mMedMap=null)},UiManager.prototype.destroy=function(){this.removePackListener(),this.clearMediator(),this.mMedMap=void 0,this.mScene=void 0},UiManager.prototype.baseFaceResize=function(){var t=this.getMediator(f.BottomMediator.NAME),e=this.getMediator(m.RightMediator.NAME),i=this.getMediator(d.LeftMediator.NAME);e&&e.getView()&&e.getView().resize(0,0),i&&i.getView()&&i.getView().resize(0,0),t&&t.getView()&&t.getView().resize(0,0)},UiManager.prototype.baseFaceTween=function(t){var e=this.getMediator(m.RightMediator.NAME),i=this.getMediator(d.LeftMediator.NAME),n=this.getMediator(f.BottomMediator.NAME);e&&e.getView()&&e.getView().tweenExpand(t),i&&i.getView()&&i.getView().tweenExpand(t),n&&n.getView()&&n.getView().tweenExpand(t)},UiManager.prototype.checkUIState=function(t,e){var i=this.mMedMap.get(t);if(i){var n,o=i.UIType,a=this.worldService.game.device.os.desktop;switch(o){case O.a.None:n=this.mNoneUIMap;break;case O.a.Scene:n=this.mSceneUIMap;break;case O.a.Normal:n=this.mNormalUIMap,a?this.checkNormalUITween(e,t):this.checkBaseUImap(e);break;case O.a.Monopoly:n=this.mMonopolyUIMap,this.checkBaseUImap(e),this.checkNormalUImap(e),this.chekcTipUImap(e);break;case O.a.Tips:n=this.mTipUIMap;break;case O.a.Pop:n=this.mPopUIMap;break;case O.a.Activity:n=this.mActivityUIMap}n.set(t,i)}},UiManager.prototype.showMed=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(this.mMedMap){"MessageBox"===t&&(t="PicaMessageBox");var o=t+"Mediator",a=this.mMedMap.get(o);if(!a){var s=i(421)("./"+t+"/"+o);if(!(a=new s[o](this.mUILayerManager,this.mScene,this.worldService)))return;this.mMedMap.set(t+"Mediator",a)}e&&a.setParam(e),this.checkUIState(o,!1),a.show(e)}else this.mCache.push(e)},UiManager.prototype.handleShowUI=function(t){var e=t.content;this.showMed(e.name,e)},UiManager.prototype.handleUpdateUI=function(t){var e=t.content;this.updateMed(e.name,e)},UiManager.prototype.handleCloseUI=function(t){var e=t.content;this.hideMed(e.name)},UiManager.prototype.onEnableEditMode=function(t){var e=this.mMedMap.get(g.TopMenuMediator.NAME);e||(e=new g.TopMenuMediator(this.mScene,this.worldService),this.mMedMap.set(g.TopMenuMediator.NAME,e)),e.addItem({key:"Turn_Btn_Top",name:"EnterDecorate",bgResKey:"baseView",bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:"",iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"})},UiManager.prototype.onEnableMarket=function(){if(this.mMedMap){var t=this.mMedMap.get(g.TopMenuMediator.NAME);t||(t=new g.TopMenuMediator(this.mScene,this.worldService),this.mMedMap.set(g.TopMenuMediator.NAME,t)),t.addItem({key:"Turn_Btn_Top",name:"Market",bgResKey:"baseView",bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:"",iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"})}},UiManager.prototype.checkBaseUImap=function(t){this.mSceneUIMap.forEach((function(e){e&&e.tweenExpand(t)}))},UiManager.prototype.checkNormalUITween=function(t,e){var i,n,o=this.worldService.getSize(),a=this.mShowuiList.length;if(t){var s=void 0;for(l=0;l<a;l++)i=this.mShowuiList[l],n=this.mMedMap.get(i),i!==e?n.resize(0,0):s=l;this.mShowuiList.splice(s,1)}else{-1===this.mShowuiList.indexOf(e)&&this.mShowuiList.push(e);for(var h=(a=this.mShowuiList.length)>1?o.width/3:0,l=0;l<a;l++)i=this.mShowuiList[l],n=this.mMedMap.get(i),a>2&&0===l?n.hide():n.resize((2*l-1)*h,0);a>2&&this.mShowuiList.shift()}},UiManager.prototype.checkNormalUImap=function(t){this.mNormalUIMap.forEach((function(e){e&&(t||e.hide())})),t||this.mNormalUIMap.clear()},UiManager.prototype.chekcTipUImap=function(t){this.mTipUIMap.forEach((function(e){e&&(t||e.hide())})),t||this.mNormalUIMap.clear()},UiManager.prototype.updateMed=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(this.mMedMap){var n=t+"Mediator",o=this.mMedMap.get(n);o&&(e&&o.setParam(e),o.update(e))}},UiManager.prototype.hideMed=function(t){if(this.mMedMap){"MessageBox"===t&&(t="PicaMessageBox");var e=t+"Mediator",i=this.mMedMap.get(e);i&&(this.checkUIState(e,!0),i.hide())}},UiManager.prototype.showAll=function(){this.mMedMap&&this.mMedMap.forEach((function(t){t.isSceneUI()&&t.show()}))},UiManager.prototype.closeAll=function(){this.mMedMap&&this.mMedMap.forEach((function(t){return t.hide()}))},UiManager.prototype.openMineSettle=function(t){var e=t.content;this.showMed("MineSettle",e)},UiManager.prototype.openEquipUpgrade=function(t){var e=t.content;this.showMed("EquipUpgrade",e)},UiManager.prototype.openComposePanel=function(t){var e=t.content;this.showMed("Compose",e)},UiManager}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatPanelPC",(function(){return f}));var n,o=i(328),a=i(33),s=i(23),h=i(19),l=i(5),c=i(88),p=i(21),u=i(12),m=i(89),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function ChatPanelPC(e,i){var n=t.call(this,e,i)||this;return n.mPreHei=0,n.mPreWid=0,n}return d(ChatPanelPC,t),ChatPanelPC.prototype.appendChat=function(t){this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom())},ChatPanelPC.prototype.tweenExpand=function(t){if(this.scene){var e=!0===t?0:-200,i=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Cubic.Out",props:{x:{value:e},alpha:{value:i}}})}},ChatPanelPC.prototype.setPosition=function(e,i){if(this.mInitialized){var n=this.mWorld.getSize();if(t.prototype.setPosition.call(this,0,n.height-this.mPreHei),this.mTextArea)this.mTextArea.childrenMap.text.y=n.height-this.height+25*this.dpr,this.mTextArea.scrollToBottom();return this}},ChatPanelPC.prototype.addListen=function(){this.mInitialized&&(this.sendMsgBtn&&this.sendMsgBtn.on("pointerdown",this.onSendMsgHandler,this),this.mVoiceBtn&&this.mVoiceBtn.on("selected",this.onSelectedVoiceHandler,this),this.mMicBtn&&this.mMicBtn.on("selected",this.onSelectedMicHandler,this),this.mInputText&&(this.mInputText.on("focus",this.onFocusHandler,this),this.mInputText.on("blur",this.onBlurHandler,this)))},ChatPanelPC.prototype.removeListen=function(){t.prototype.removeListen.call(this),this.mInitialized&&(this.sendMsgBtn&&this.sendMsgBtn.off("pointerdown",this.onSendMsgHandler,this),this.mVoiceBtn&&this.mVoiceBtn.off("selected",this.onSelectedVoiceHandler,this),this.mMicBtn&&this.mMicBtn.off("selected",this.onSelectedMicHandler,this),this.mInputText&&(this.mInputText.off("focus",this.onFocusHandler,this),this.mInputText.off("blur",this.onBlurHandler,this)))},ChatPanelPC.prototype.destroy=function(){t.prototype.destroy.call(this)},ChatPanelPC.prototype.preload=function(){this.scene&&(this.scene.load.image("button",l.h.getRes("ui/common/button.png")),this.scene.load.image("thumbTexture",l.h.getRes("ui/common/common_thumb_texture.png")),this.scene.load.image("track",l.h.getRes("ui/common/common_track.png")),this.scene.load.image("chat_input_bg",l.h.getRes("ui/chat/input_bg.png")),this.scene.load.image(l.d.getName(),l.d.getPNG()),this.scene.load.atlas("chat_atlas",l.h.getRes("ui/chat/chat_atlas.png"),l.h.getRes("ui/chat/chat_atlas.json")),t.prototype.preload.call(this))},ChatPanelPC.prototype.init=function(){if(!this.mInitialized){var e=this.mWorld.getSize();this.mPreHei=e.height,this.mPreWid=e.width,this.setSize(464,281);var i=new u.NinePatch(this.scene,0,0,this.width,this.height,l.d.getName(),null,l.d.getConfig());i.x=4*this.mWorld.uiScale+i.width*i.originX,i.y=e.height-260*this.mWorld.uiScale+i.height*i.originY,this.add(i),this.outPut=this.scene.make.container(void 0,!1),this.add(this.outPut);var n=new o.a(this.scene,0,0,2,2,3,8421504,.5);this.outPut.add(n);var m=new h.NinePatchButton(this.scene,0,0,4,7,"track","","",{left:0,top:2,right:0,bottom:2});m.x=100*this.mWorld.uiScale,m.y=10*this.mWorld.uiScale,this.outPut.add(m);var d=new p.a(this.scene,0,0,"",{fontSize:"14px",wrap:{mode:"char",width:400*this.mWorld.uiScale}});this.outPut.add(d);var f=new h.NinePatchButton(this.scene,0,0,20,35,"button","","",{left:4,top:4,right:4,bottom:4});this.outPut.add(f),this.mTextArea=new a.a(this.scene,{x:230*this.mWorld.uiScale,y:e.height-155*this.mWorld.uiScale,textWidth:430,textHeight:200,text:d,slider:{track:m,thumb:f}}).layout(),this.outPut.add(this.mTextArea);this.mTextArea.getElement("child");var y=this.scene.make.container(void 0,!1);this.add(y);var g=new u.NinePatch(this.scene,0,0,370,32,"chat_input_bg",null,{left:4,top:4,right:4,bottom:4});g.x=8*this.mWorld.uiScale+g.width*g.originX,g.y=e.height-46*this.mWorld.uiScale+g.height*g.originY,y.add(g),this.mInputText=new s.a(this.scene,0,0,10,10,{type:"input",fontSize:"14px",color:"#808080"}).resize(360,20).setOrigin(0,0).setStyle({font:"bold 16px YaHei"}),this.mInputText.x=12*this.mWorld.uiScale,this.mInputText.y=e.height-40*this.mWorld.uiScale,y.add(this.mInputText),this.sendMsgBtn=new h.NinePatchButton(this.scene,0,0,60,30,"button","","发送",{left:4,top:4,right:4,bottom:4}),this.sendMsgBtn.x=this.width-this.sendMsgBtn.width+10*this.mWorld.uiScale,this.sendMsgBtn.y=e.height-this.sendMsgBtn.height,this.add(this.sendMsgBtn),this.mSendKey=this.scene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.mVoiceBtn=new c.CheckButton(this.scene,0,0,"chat_atlas","voice_normal.png","voice_selected.png"),this.mVoiceBtn.x=this.width-60*this.mWorld.uiScale,this.mVoiceBtn.y=e.height-this.height,this.add(this.mVoiceBtn),this.mMicBtn=new c.CheckButton(this.scene,0,0,"chat_atlas","mic_normal.png","mic_selected.png"),this.mMicBtn.x=this.width-20*this.mWorld.uiScale,this.mMicBtn.y=e.height-this.height,this.add(this.mMicBtn),this.setPosition(),t.prototype.init.call(this)}},ChatPanelPC.prototype.onSelectedVoiceHandler=function(t){!1===t&&(this.mMicBtn.selected=!1),this.emit("selectedVoice",t)},ChatPanelPC.prototype.onSelectedMicHandler=function(t){!1!==this.mVoiceBtn.selected?(this.mMicBtn.selected=t,this.emit("selectedMic",t)):this.mMicBtn.selected=!1},ChatPanelPC.prototype.onSendMsgHandler=function(){var t=this.mInputText.text;t.length>0&&(this.emit("sendChat",t),this.mInputText.setText(""),this.mInputText.setBlur())},ChatPanelPC.prototype.onFocusHandler=function(){this.mWorld&&this.mWorld.inputManager&&this.mSendKey&&this.mSendKey.on("down",this.onDownEnter,this)},ChatPanelPC.prototype.onBlurHandler=function(){this.mWorld&&this.mWorld.inputManager&&this.mSendKey&&this.mSendKey.off("down",this.onDownEnter,this)},ChatPanelPC.prototype.onDownEnter=function(){this.onSendMsgHandler()},Object.defineProperty(ChatPanelPC.prototype,"outChannel",{get:function(){return 0},enumerable:!1,configurable:!0}),ChatPanelPC}(m.BaseChatPanel)},function(t,e,i){"use strict";e.a=function(t){return t.hasOwnProperty("rexSizer")||(t.rexSizer={}),t.rexSizer}},function(t,e,i){"use strict";const n=Phaser.Display.Align;e.a={center:n.CENTER,left:n.LEFT_CENTER,right:n.RIGHT_CENTER,top:n.TOP_CENTER,bottom:n.BOTTOM_CENTER,"left-top":n.TOP_LEFT,"left-center":n.LEFT_CENTER,"left-bottom":n.BOTTOM_LEFT,"center-top":n.TOP_CENTER,"center-center":n.CENTER,"center-bottom":n.BOTTOM_CENTER,"right-top":n.TOP_RIGHT,"right-center":n.RIGHT_CENTER,"right-bottom":n.BOTTOM_RIGHT}},function(t,e,i){"use strict";var n=i(37),o=i(52),a=i(66),s=i(283);const h=Phaser.Utils.Objects.GetValue;class TweenBase{constructor(t,e){this.parent=t,this.scene=Object(o.a)(t);var i=h(e,"eventEmitter",!1);!0===i&&(i=void 0),this.setEventEmitter(i),this.boot()}boot(){Object(a.a)(this.parent)?this.parent.once&&this.parent.on("destroy",this.destroy,this):Object(s.a)(this.parent)&&this.parent.events.once("shutdown",this.destroy,this)}shutdown(){return this.stop(),Object(s.a)(this.parent)&&this.parent.events.off("shutdown",this.destroy,this),this.destroyEventEmitter(),this.parent=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}start(t){return this.isRunning||(this.tween=this.scene.tweens.add(t).on("complete",this.complete,this),!1===this.getEventEmitter()&&this.setEventEmitter(this.tween)),this}restart(){return this.stop().start(),this}stop(){return this.tween?(this.getEventEmitter()===this.tween&&this.setEventEmitter(!1),this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),this.getEventEmitter()&&this.emit("complete"),this}get isRunning(){return!!this.tween}}Object.assign(TweenBase.prototype,n.a),e.a=TweenBase},function(t,e,i){"use strict";const n=Phaser.Utils.Objects.GetValue;e.a=function(t,e){return void 0===e&&(e={}),"number"==typeof t?(e.left=t,e.right=t,e.top=t,e.bottom=t):(e.left=n(t,"left",0),e.right=n(t,"right",0),e.top=n(t,"top",0),e.bottom=n(t,"bottom",0)),e}},function(t,e,i){"use strict";i.r(e),i.d(e,"normalizePatchesConfig",(function(){return normalizePatchesConfig}));var normalizePatchesConfig=function(t){return t.bottom=void 0!==t.bottom?t.bottom:t.top,t.left=void 0!==t.left?t.left:t.top,t.right=void 0!==t.right?t.right:t.left,t}},function(t,e,i){"use strict";var n=i(145);e.a=function(t,e){var i=Array.isArray(t);if(void 0===e?e=i?[]:{}:Object(n.a)(e),i){e.length=t.length;for(var o=0,a=t.length;o<a;o++)e[o]=t[o]}else for(var s in t)e[s]=t[s];return e}},function(t,e,i){"use strict";e.a=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatPanelMobile",(function(){return m}));var n,o=i(89),a=i(33),s=i(23),h=i(5),l=i(12),c=i(21),p=i(19),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function ChatPanelMobile(e,i){var n=t.call(this,e,i)||this;return n.setTween(!1),n}return u(ChatPanelMobile,t),ChatPanelMobile.prototype.addListen=function(){this.mSendBtn.on("pointerdown",this.onSendMsgHandler,this),this.clickContainer.on("pointerdown",this.clickHandler,this),this.mInputText.on("focus",this.onFocusHandler,this),this.mInputText.on("blur",this.onBlurHandler,this)},ChatPanelMobile.prototype.removeListen=function(){this.mSendBtn.off("pointerdown",this.onSendMsgHandler,this),this.clickContainer.off("pointerdown",this.clickHandler,this),this.mInputText.off("focus",this.onFocusHandler,this),this.mInputText.off("blur",this.onBlurHandler,this)},ChatPanelMobile.prototype.appendChat=function(t){this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom())},ChatPanelMobile.prototype.show=function(e){t.prototype.show.call(this,e),this.tweenExpand(!0)},ChatPanelMobile.prototype.setPosition=function(t,e){if(this.mShow){var i,n,o,h=this.mWorld.getSize();if(this.mTextArea&&(this.mTextArea.destroy(),this.mTextArea=null,o=new c.a(this.scene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:this.width>>1}}),i=new p.NinePatchButton(this.scene,0,0,4,7,"track","","",{left:0,top:2,right:0,bottom:2}),n=new p.NinePatchButton(this.scene,0,0,20,35,"button","","",{left:4,top:4,right:4,bottom:4}),this.add(o),this.add(i),this.add(n)),this.mInputText&&(this.mInputText.destroy(),this.mInputText=null,this.mInputText=new s.a(this.scene,0,0,10,10,{type:"input",fontSize:"20px",color:"#808080"}).resize(328,26).setOrigin(0,0).setStyle({font:"bold 20px YaHei"})),this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE)this.width=h.width>>1,this.height=h.height,this.mBorder.resize(this.width/this.mWorld.uiScale,this.height/this.mWorld.uiScale),this.x=0,this.y=0,this.clickContainer.x=this.width/this.mWorld.uiScale+this.clickContainer.width/2,this.clickContainer.y=this.height/(2*this.mWorld.uiScale),this.clickContainer.rotation=.5*Math.PI,this.arrow.rotation=.5*Math.PI,this.mInputBg.y=this.mBorder.height-this.mInputBg.height/2,this.mTextArea=new a.a(this.scene,{x:.5*this.width/this.mWorld.uiScale,y:this.height/2,textWidth:this.mBorder.width-20*this.mWorld.uiScale,textHeight:this.height,text:o,slider:{track:i,thumb:n},clamplChildOY:!0}),this.mInputText.setPosition(2,this.mInputBg.y-12*this.mWorld.uiScale);else this.width=h.width,this.height=h.height/2,this.mBorder.resize(this.width/this.mWorld.uiScale,this.height/this.mWorld.uiScale),this.x=0,this.y=this.height+20*this.mWorld.uiScale,this.mInputBg.y=this.mBorder.height-this.mInputBg.height,this.mTextArea=new a.a(this.scene,{x:(this.width-15)/this.mWorld.uiScale>>1,y:(h.height/2-this.mSendBtn.height-20)/this.mWorld.uiScale>>1,textWidth:this.mBorder.width-20*this.mWorld.uiScale,textHeight:(h.height/2-this.mSendBtn.height-20)/this.mWorld.uiScale,text:o,slider:{track:i,thumb:n},scroller:{bounds:[0,this.height>>1]},clamplChildOY:!0,backDeceleration:!0}),this.clickContainer.x=h.width/(2*this.mWorld.uiScale),this.clickContainer.y=-this.clickContainer.height>>1,this.mTextArea.getElement("slider").y=this.height>>1,this.clickContainer.rotation=Math.PI,this.arrow.rotation=1.5*Math.PI,this.mInputText.setPosition(2,this.mInputBg.y-6*this.mWorld.uiScale);return this.mTextArea.layout(),this.add(this.mTextArea),this.mTextArea.childrenMap.child.textMask.setPosition(-5,h.height-this.height).resize(this.width+18,this.height-this.mSendBtn.height),this.mBorder.x=this.mBorder.width/2,this.mBorder.y=this.mBorder.height/2,this.setSize(this.width,this.height),this.mInputBg.x=this.mInputBg.width>>1,this.mSendBtn.x=this.mBorder.width-this.mSendBtn.width,this.mSendBtn.y=this.mInputBg.y,this.scale=this.mWorld.uiScale,this.add(this.mInputText),this}},ChatPanelMobile.prototype.destroy=function(){t.prototype.destroy.call(this)},ChatPanelMobile.prototype.tweenExpand=function(t){var e=this,i=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{alpha:{value:i}},onComplete:function(i,n,o){t||e.hide(),e.addListen()}}),t&&this.setPosition()},ChatPanelMobile.prototype.hide=function(){this.removeListen(),t.prototype.hide.call(this)},ChatPanelMobile.prototype.preload=function(){this.scene&&(this.scene.load.image("button",h.h.getRes("ui/common/button.png")),this.scene.load.image("thumbTexture",h.h.getRes("ui/common/common_thumb_texture.png")),this.scene.load.image("track",h.h.getRes("ui/common/common_track.png")),this.scene.load.image("channelSelect",h.h.getRes("ui/common/common_channelSelect.png")),this.scene.load.image("channelUnSelect",h.h.getRes("ui/common/common_channelUnSelect.png")),this.scene.load.image("arrow",h.h.getRes("ui/common/common_arrow.png")),this.scene.load.image("chat_input_bg",h.h.getRes("ui/chat/input_bg.png")),this.scene.load.image(h.d.getName(),h.d.getPNG()),this.scene.load.atlas(h.i.getName(),h.i.getPNG(),h.i.getJSON()),this.scene.load.atlas("chat_atlas",h.h.getRes("ui/chat/chat_atlas.png"),h.h.getRes("ui/chat/chat_atlas.json")),t.prototype.preload.call(this))},ChatPanelMobile.prototype.init=function(){if(!this.mInitialized){var e=this.mWorld.getSize();this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.width=e.width>>1,this.height=e.height):(this.width=e.width,this.height=e.height>>1),this.setSize(this.width,this.height),this.mBorder=new l.NinePatch(this.scene,0,0,this.width/this.mWorld.uiScale,this.height/this.mWorld.uiScale,h.d.getName(),null,h.d.getConfig()),this.mBorder.x=this.mBorder.width/2,this.mBorder.y=this.mBorder.height/2,this.addAt(this.mBorder,0);var i=new c.a(this.scene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:this.width>>1}}),n=new p.NinePatchButton(this.scene,0,0,4,7,"track","","",{left:0,top:2,right:0,bottom:2});n.x=this.width/2,n.y=8*this.mWorld.uiScale;var o=new p.NinePatchButton(this.scene,0,0,20,35,"button","","",{left:4,top:4,right:4,bottom:4});this.add(i),this.add(n),this.add(o),this.mTextArea=new a.a(this.scene,{x:this.width>>1,y:this.height+178*this.mWorld.uiScale>>1,textWidth:this.width,textHeight:this.height+150*this.mWorld.uiScale,text:i,slider:{track:n,thumb:o}}).layout(),this.add(this.mTextArea),this.mInputBg=new l.NinePatch(this.scene,0,0,340,30,"chat_input_bg",null,{left:4,top:4,right:4,bottom:4}),this.add(this.mInputBg),this.mInputText=new s.a(this.scene,0,0,10,10,{type:"input",fontSize:"20px",color:"#808080"}).resize(328,26).setOrigin(0,0).setStyle({font:"bold 20px YaHei"}).on("focus",this.onFocusHandler,this).on("blur",this.onBlurHandler,this),this.mSendBtn=new p.NinePatchButton(this.scene,0,0,60,30,h.i.getName(),"","发送",h.i.getConfig()),this.add(this.mSendBtn),this.clickContainer=this.scene.make.container(void 0,!1);var u=new l.NinePatch(this.scene,0,0,53/this.mWorld.uiScale,30/this.mWorld.uiScale,h.d.getName(),null,h.d.getConfig());this.arrow=this.scene.make.image(void 0,!1),this.arrow.setTexture("arrow"),this.clickContainer.setSize(u.width+4,u.height+10),this.clickContainer.add(u),this.clickContainer.add(this.arrow),this.clickContainer.setInteractive(),this.add(this.clickContainer),this.add(this.mInputText),this.setPosition(),t.prototype.init.call(this)}},ChatPanelMobile.prototype.clickHandler=function(){this.scene.tweens.add({targets:this.clickContainer,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.clickContainer.scaleX=this.clickContainer.scaleY=1,this.tweenExpand(!1),this.mWorld.uiManager.baseFaceTween(!0)},ChatPanelMobile.prototype.onSendMsgHandler=function(){var t=this.mInputText.text;t.length>0&&(this.emit("sendChat",t),this.mInputText.setText(""),this.mInputText.setBlur())},ChatPanelMobile.prototype.onFocusHandler=function(){this.mWorld&&this.mWorld.inputManager},ChatPanelMobile.prototype.onBlurHandler=function(){this.mWorld&&this.mWorld.inputManager},ChatPanelMobile}(o.BaseChatPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Chat",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Chat(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Chat,t),Chat.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Chat.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Chat.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,this.handleCharacterChat),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QCLOUD_GME_AUTHBUFFER,this.handleQCLoudGME))},Chat.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Object.defineProperty(Chat.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Chat.prototype.handleCharacterChat=function(t){t.content;this.mEvent.emit("characterChat",t)},Chat.prototype.handleQCLoudGME=function(t){t.content;this.mEvent.emit("QCLoundGME",t)},Chat}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"LayerManager",(function(){return n}));var n=function(){function LayerManager(){}return LayerManager.prototype.setScene=function(t){t&&(this.destroy(),this.mScene=t,this.mUILayer=t.add.container(0,0),this.mDialogLayer=t.add.container(0,0),this.mToolTipsLyaer=t.add.container(0,0))},LayerManager.prototype.addToUILayer=function(t){this.mUILayer&&this.mUILayer.add(t)},LayerManager.prototype.addToDialogLayer=function(t){this.mDialogLayer&&this.mDialogLayer.add(t)},LayerManager.prototype.addToToolTipsLayer=function(t){this.mToolTipsLyaer&&this.mToolTipsLyaer.add(t)},LayerManager.prototype.removeToUILayer=function(t){this.mUILayer.remove(t)},LayerManager.prototype.removeToDialogLayer=function(t){this.mDialogLayer.remove(t)},LayerManager.prototype.removeToToolTipsLayer=function(t){this.mToolTipsLyaer.remove(t)},LayerManager.prototype.destroy=function(){this.mUILayer&&(this.mUILayer.destroy(),this.mUILayer=null),this.mDialogLayer&&(this.mDialogLayer.destroy(),this.mDialogLayer=null),this.mToolTipsLyaer&&(this.mToolTipsLyaer.destroy(),this.mToolTipsLyaer=null)},Object.defineProperty(LayerManager.prototype,"interactive",{get:function(){return this.mInteractive},enumerable:!1,configurable:!0}),Object.defineProperty(LayerManager.prototype,"scene",{get:function(){return this.mScene},enumerable:!1,configurable:!0}),LayerManager}()},function(t,e,i){"use strict";i.r(e),i.d(e,"NoticeMediator",(function(){return p}));var n,o=i(150),a=i(13),s=i(7),h=i(151),l=i(18),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function NoticeMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mLayerManager=e,o.mScene=i,o.notice=new h.Notice(n),o.mUIType=l.a.Tips,o.addListen(),o}return c(NoticeMediator,t),NoticeMediator.prototype.setUiScale=function(t){this.mView.scale=t},NoticeMediator.prototype.getView=function(){return void 0!==this.mView?this.mView:void 0},NoticeMediator.prototype.getUIType=function(){return this.mUIType},NoticeMediator.prototype.hide=function(){this.mView&&t.prototype.hide.call(this)},NoticeMediator.prototype.destroy=function(){this.removeListen(),this.notice.unregister(),this.notice=null,t.prototype.destroy.call(this)},NoticeMediator.prototype.isShow=function(){return this.mView.isShow()},NoticeMediator.prototype.resize=function(){this.mView&&this.mView.resize()},NoticeMediator.prototype.show=function(t){this.mView&&this.mView.isShow()?this.mView.showNotice(t):(this.mView=new o.NoticePanel(this.mScene,this.world),this.mView.show(t),this.mView.showNotice(t),this.mLayerManager.addToDialogLayer(this.mView))},NoticeMediator.prototype.update=function(t){this.mParam=t,this.mView},NoticeMediator.prototype.setParam=function(t){this.mParam=t},NoticeMediator.prototype.getParam=function(){return this.mParam},NoticeMediator.prototype.addListen=function(){this.notice.on("showNotice",this.noticeHandler,this),this.world.emitter.on(a.a.SHOW_NOTICE,this.noticeHandler,this),this.notice.register()},NoticeMediator.prototype.removeListen=function(){this.notice.off("showNotice",this.noticeHandler,this),this.world.emitter.off(a.a.SHOW_NOTICE,this.noticeHandler,this)},NoticeMediator.prototype.noticeHandler=function(t){t&&t.content&&this.show(t.content)},NoticeMediator.NAME="NoticeMediator",NoticeMediator}(s.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"NoticePanel",(function(){return l}));var n,o=i(6),a=i(5),s=i(12),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function NoticePanel(e,i){return t.call(this,e,i)||this}return h(NoticePanel,t),NoticePanel.prototype.show=function(e){t.prototype.show.call(this,e),this.resize(),this.scale=this.mWorld.uiRatio,this.refreshData()},NoticePanel.prototype.addListen=function(){this.mInitialized},NoticePanel.prototype.removeListen=function(){this.mInitialized},NoticePanel.prototype.destroy=function(){this.mContentText&&(this.mContentText.destroy(),this.mContentText=null),this.mTween&&(this.mTween.stop(),this.mTween.remove(),this.mTween=null),t.prototype.destroy.call(this)},NoticePanel.prototype.resize=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=this.scene.cameras.main.worldView;this.x=i.x+i.width+t>>1,this.y=180+e},NoticePanel.prototype.showNotice=function(t){var e=this;if(this.mInitialized&&t){this.mTween&&(this.mTween.stop(),this.mTween.remove());var i="#FFFFFF",n=5e3,o=t.chatsetting;o&&(o.textColor&&(i=o.textColor),o.duration&&(n=o.duration)),this.mContentText.setText(t.noticeContext),this.mContentText.setFill(i),this.mContentText.x=-(this.mContentText.width>>1),this.mContentText.y=-(this.mContentText.height>>1),this.mTween=this.scene.tweens.add({targets:this,alpha:0,duration:200,delay:n,onComplete:function(){e.removeFromParent()}})}},NoticePanel.prototype.preload=function(){this.scene.load.image(a.d.getName(),a.d.getPNG()),t.prototype.preload.call(this)},NoticePanel.prototype.init=function(){var e=new s.NinePatch(this.scene,0,0,1200,120,a.d.getName(),null,a.d.getConfig());this.add(e),this.mContentText=this.scene.make.text({align:"center",style:{fontFamily:"bold YaHei",fontSize:20*this.dpr*this.mWorld.uiScale,wordWrap:{width:1180,useAdvancedWrap:!0}}},!1).setStroke("#000000",1),this.add(this.mContentText),t.prototype.init.call(this)},NoticePanel.prototype.refreshData=function(){var t=this.mShowData;t&&this.showNotice(t)},NoticePanel.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this),this.mTween&&(this.mTween.stop(),this.mTween.remove(),this.mTween=null),this.mShow=!1},NoticePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Notice",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Notice(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Notice,t),Notice.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Notice.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Notice.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_NOTICE,this.noticeHandler))},Notice.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Object.defineProperty(Notice.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Notice.prototype.noticeHandler=function(t){t&&t.content&&this.mEvent.emit("showNotice",t)},Notice}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"BagPanel",(function(){return y}));var n,o=i(40),a=i(8),s=i(5),h=i(39),l=i(12),c=i(23),p=i(70),u=i(26),m=i(27),d=i(6),f=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),y=function(t){function BagPanel(e,i){var n=t.call(this,e,i)||this;return n.mPageNum=0,n.mPageIndex=1,n.mBaseStr="输入关键字进行搜索",n.bagSlotList=[],n.mCheckList=[],n}return f(BagPanel,t),BagPanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.mWorld.game.device.os.desktop||this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.x=i.width>>1,this.y=i.height>>1):(this.x=i.width>>1,this.y=i.height-this.height/2*this.mWorld.uiScale>>1)},BagPanel.prototype.setDataList=function(){var t=this.mWorld.roomManager.currentRoom.playerManager.actor.package.items;this.mPageNum=Math.ceil(t.length/BagPanel.PageMaxCount),this.mDataList=t,this.mInitialized&&this.checkChinese()},BagPanel.prototype.getPageNum=function(){return this.mPageNum},BagPanel.prototype.destroy=function(){this.bagSlotList&&(this.bagSlotList.forEach((function(t){t&&t.destroy()})),this.bagSlotList.length=0,this.bagSlotList=null),this.mWorld=null,this.mPageNum=0,this.mPageIndex=1,t.prototype.destroy.call(this)},BagPanel.prototype.getCurPageIndex=function(){return this.mPageIndex},BagPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&(this.mPreBtn.play("slipBtn"),this.mNextBtn.play("slipBtn"))},BagPanel.prototype.setBlur=function(){this.mInputText&&this.mInputText.setBlur()},BagPanel.prototype.addListen=function(){this.mInitialized&&(this.mInputText.on("focus",this.onFocusHandler,this),this.mInputText.on("blur",this.onBlurHandler,this),this.mNextBtn.on("pointerup",this.nextHandler,this),this.mPreBtn.on("pointerup",this.preHandler,this),this.mClsBtn.on("pointerup",this.closeHandler,this))},BagPanel.prototype.removeListen=function(){this.mInitialized&&(this.mInputText.off("focus",this.onFocusHandler,this),this.mInputText.off("blur",this.onBlurHandler,this),this.mNextBtn.off("pointerup",this.nextHandler,this),this.mPreBtn.off("pointerup",this.preHandler,this),this.mClsBtn.off("pointerup",this.closeHandler,this))},BagPanel.prototype.init=function(){if(!this.mInitialized){var e,i=this.mWorld.getSize();this.mWorld.game.device.os.desktop||this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.x=i.width>>1,this.y=i.height>>1):(this.x=i.width>>1,this.y=i.height-this.height/2*this.mWorld.uiScale>>1);var n=0,a=0;this.mBg=new l.NinePatch(this.scene,0,0,500,350,s.a.getName(),null,s.a.getConfig()),this.addAt(this.mBg,0),this.setSize(this.mBg.width,this.mBg.height),this.mBorder=new l.NinePatch(this.scene,0,0,this.mBg.width-10,this.mBg.height-30,s.d.getName(),null,s.d.getConfig()),this.mBorder.x=this.mBg.x,this.mBorder.y=this.mBg.y+10,this.addAt(this.mBorder,1);var p=new l.NinePatch(this.scene,this.mBorder.width/4+5,-this.mBg.height/2+65,this.mBorder.width/2-40,35,s.d.getName(),null,s.d.getConfig());this.add(p),this.mInputText=new c.a(this.scene,0,0,10,10,{type:"input",fontSize:"14px",color:"#808080"}).resize(p.width,p.height).setOrigin(0,0).setStyle({font:"bold 16px YaHei"}),this.mInputText.x=p.x-p.width/2,this.mInputText.y=p.y-p.height/2,this.mInputText.setText(this.mBaseStr),this.add(this.mInputText),this.bagSlotList=[];for(var d=0;d<BagPanel.PageMaxCount;d++)n=d%8*60-210,a=60*Math.floor(d/8)-this.mBorder.height/2+this.mBorder.y+this.mBorder.height/2-55,(e=new o.ItemSlot(this.scene,this.mWorld,this,n,a,this.mResStr,this.mResPng,this.mResJson,"bagView_slot.png","itemSelectFrame")).createUI(),this.bagSlotList.push(e);this.mPreBtn=this.scene.make.sprite(void 0,!1),this.mPreBtn.x=-this.mBg.width>>1,this.mNextBtn=this.scene.make.sprite(void 0,!1),this.mNextBtn.scaleX=-1,this.mNextBtn.x=this.mBg.width>>1;var f=this.scene.make.sprite(void 0,!1);f.setTexture(this.mResStr,"bagView_titleBtn.png"),f.x=50+(-this.mBg.width>>1),f.y=-this.mBg.height>>1,this.add(f);var y=this.scene.make.text(void 0,!1);y.setFontFamily("Tahoma"),y.setFontStyle("bold"),y.setFontSize(20),y.setText("背包"),y.x=f.x+f.width-10,y.y=f.y-(y.height>>1),this.add(y),this.add(this.mPreBtn),this.add(this.mNextBtn),this.mNextBtn.setInteractive(),this.mPreBtn.setInteractive(),this.width=this.mBg.width,this.height=this.mBg.height,this.mClsBtn=new u.IconBtn(this.scene,this.mWorld,{key:m.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:this.mResPng,jsonUrl:this.mResJson}),this.mClsBtn.x=(this.width>>1)-65,this.mClsBtn.y=-this.height>>1,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn),this.mInitialized=!0,this.mDataList&&this.refreshDataList(this.mDataList),this.setInteractive(),this.mWorld.uiManager.getMediator(h.BagMediator.NAME).resize(this.width,this.height),t.prototype.init.call(this)}},BagPanel.prototype.preload=function(){this.scene&&(this.mResStr="bagView",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.scene.load.atlas("itemChose",s.h.getRes("ui/bag/itemChose.png"),s.h.getRes("ui/bag/itemChose.json")),this.scene.load.atlas("slip",s.h.getRes("ui/bag/slip.png"),s.h.getRes("ui/bag/slip.json")),this.scene.load.image(s.d.getName(),s.d.getPNG()),this.scene.load.image(s.a.getName(),s.a.getPNG()),this.scene.load.atlas("clsBtn",s.h.getRes("ui/common/common_clsBtn.png"),s.h.getRes("ui/common/common_clsBtn.json")),this.scene.load.atlas(this.mResStr,s.h.getRes(this.mResPng),s.h.getRes(this.mResJson)),t.prototype.preload.call(this))},BagPanel.prototype.loadComplete=function(e,i,n){var o=this.scene.textures.get("itemChose").frames,a=[];for(var s in o){if("__BASE"!==s)o[s]&&a.push(s)}this.scene.anims.create({key:"itemSelectFrame",frames:this.scene.anims.generateFrameNumbers("itemChose",{start:0,end:8,frames:a}),frameRate:33,yoyo:!0,repeat:-1});var h=this.scene.textures.get("slip").frames,l=[];for(var s in h){if("__BASE"!==s)h[s]&&l.push(s)}this.scene.anims.create({key:"slipBtn",frames:this.scene.anims.generateFrameNumbers("slip",{start:0,end:14,frames:l}),frameRate:33,yoyo:!0,repeat:-1}),t.prototype.loadComplete.call(this,e,i,n)},BagPanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(h.BagMediator.NAME).resize(this.width,this.height)},BagPanel.prototype.nextHandler=function(t,e){if(this.preNextBtnScaleHandler(this.mNextBtn,-1),!(this.mPageIndex>=this.mPageNum)){this.mPageIndex++;var i=this.mCheckList.length>0?this.mCheckList:this.mDataList;this.refreshDataList(i)}},BagPanel.prototype.preHandler=function(t,e){if(this.preNextBtnScaleHandler(this.mPreBtn),!(this.mPageIndex<=1)){this.mPageIndex--;var i=this.mCheckList.length>0?this.mCheckList:this.mDataList;this.refreshDataList(i)}},BagPanel.prototype.preNextBtnScaleHandler=function(t,e){void 0===e&&(e=1),this.scene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1},BagPanel.prototype.refreshDataList=function(t){if(t)for(var e,i=t.slice((this.mPageIndex-1)*BagPanel.PageMaxCount,this.mPageIndex*BagPanel.PageMaxCount),n=BagPanel.PageMaxCount,o=0;o<n;o++)(e=this.bagSlotList[o])&&e.dataChange(i[o]);else a.a.getInstance().error("checkItemList is undefiend")},BagPanel.prototype.closeHandler=function(){this.mWorld.uiManager.getMediator(h.BagMediator.NAME).hide()},BagPanel.prototype.onFocusHandler=function(){this.mWorld&&this.mWorld.inputManager&&this.mInputText&&(this.mInputText.on("textchange",this.checkChinese,this),this.mInputText.setText(""))},BagPanel.prototype.onBlurHandler=function(){this.mWorld&&this.mWorld.inputManager&&this.mInputText&&(this.mInputText.on("textchange",this.checkChinese,this),this.mInputText.setText(this.mBaseStr))},BagPanel.prototype.checkChinese=function(){var t=this,e=this.mInputText.text;e.length<1||!p.a.checkChinese(e)||e===this.mBaseStr?this.refreshDataList(this.mDataList):(this.mWorld.roomManager.currentRoom.playerManager.actor.package.items.forEach((function(e){e&&p.a.checkItemName(e.name,t.mInputText.text)&&t.mCheckList.push(e)})),this.refreshDataList(this.mCheckList))},BagPanel.PageMaxCount=32,BagPanel}(d.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"FriendPanel",(function(){return f})),i.d(e,"FriendItem",(function(){return y}));var n,o=i(6),a=i(5),s=i(12),h=i(9),l=i(16),c=i(75),p=i(26),u=i(91),m=i(27),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function FriendPanel(e,i){var n=t.call(this,e,i)||this;return n.mIndex=0,n}return d(FriendPanel,t),FriendPanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.mShow&&(this.mWorld.game.device.os.desktop?(this.x=i.width+t>>1,this.y=i.height+e>>1):this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.mBg.resize((.5*i.width-20)/this.mWorld.uiScale,(i.height-20)/this.mWorld.uiScale),this.setSize(this.mBg.width,this.mBg.height),this.x=(this.width/2+10)*this.mWorld.uiScale,this.y=(this.height/2+10)*this.mWorld.uiScale):(this.mBg.resize((i.width-20)/this.mWorld.uiScale,(.5*i.height-20)/this.mWorld.uiScale),this.setSize(this.mBg.width,this.mBg.height),this.x=(this.width/2+15)*this.mWorld.uiScale,this.y=i.height-.5*this.mBg.height*this.mWorld.uiScale-10),this.scale=this.mWorld.uiScale,this.mUpBtn.y=(this.mUpBtn.height/2-this.mBg.height)/2,this.mDownBtn.y=(this.mBg.height-this.mDownBtn.height/2)/2,this.mTitleTxt.x=-this.mBg.width/2+15,this.mTitleTxt.y=-this.mBg.height/2+8,this.mClsBtn&&(this.mClsBtn.x=(this.mBg.width>>1)-65,this.mClsBtn.y=-this.mBg.height>>1),this.initFriendItem(),this.addAt(this.mBg,0),this.add(this.mTitleTxt))},FriendPanel.prototype.addListen=function(){t.prototype.addListen.call(this),this.mDownBtn.on("pointerup",this.downHandler,this),this.mUpBtn.on("pointerup",this.upHandler,this),this.mClsBtn.on("pointerup",this.hide,this)},FriendPanel.prototype.removeListen=function(){t.prototype.removeListen.call(this),this.mDownBtn.off("pointerup",this.downHandler,this),this.mUpBtn.off("pointerup",this.upHandler,this),this.mClsBtn.off("pointerup",this.hide,this)},FriendPanel.prototype.show=function(e){this.mWorld.getSize();this.mShowData=e,this.mInitialized?t.prototype.show.call(this,e):this.preload()},FriendPanel.prototype.destroy=function(){this.mFriendList&&this.mFriendList.forEach((function(t){t&&(t.destory(),t=null)})),t.prototype.destroy.call(this)},FriendPanel.prototype.friendChat=function(t){},FriendPanel.prototype.friendGo=function(t){},FriendPanel.prototype.btnScaleHandler=function(t,e){void 0===e&&(e=1),this.mScene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1},FriendPanel.prototype.hide=function(){this.mWorld.uiManager.baseFaceTween(!0),t.prototype.hide.call(this)},FriendPanel.prototype.preload=function(){this.mScene&&(this.mScene.load.image(a.d.getName(),a.d.getPNG()),this.mScene.load.image(a.a.getName(),a.a.getPNG()),this.mScene.load.atlas("clsBtn",a.h.getRes("ui/common/common_clsBtn.png"),a.h.getRes("ui/common/common_clsBtn.json")),this.scene.load.image("friendChat",a.h.getRes("ui/friend/friend_chat.png")),this.scene.load.image("friendGo",a.h.getRes("ui/friend/friend_go.png")),this.mScene.load.atlas("bagView",a.h.getRes("ui/bag/bagView.png"),a.h.getRes("ui/bag/bagView.json")),t.prototype.preload.call(this))},FriendPanel.prototype.init=function(){this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this);var e=this.mWorld.getSize();this.mBg=new s.NinePatch(this.scene,0,0,600/this.mWorld.uiScale,.5*e.height*this.mWorld.uiScale,a.d.getName(),null,a.d.getConfig()),this.setSize(this.mBg.width,this.mBg.height),this.mTitleTxt=this.mScene.make.text(void 0,!1),this.mTitleTxt.setFontFamily("YaHei"),this.mTitleTxt.setFontStyle("bold"),this.mTitleTxt.setFontSize(14),this.mTitleTxt.style.align="left",this.mTitleTxt.setText("好友列表"),this.mUpBtn=this.mScene.make.sprite(void 0,!1),this.mUpBtn.setTexture("bagView","bagView_tab.png"),this.mUpBtn.rotation=Math.PI/2,this.mDownBtn=this.mScene.make.sprite(void 0,!1),this.mDownBtn.setTexture("bagView","bagView_tab.png"),this.mDownBtn.rotation=-Math.PI/2,this.mDownBtn.setInteractive(),this.mUpBtn.setInteractive();var i=this.scene.make.image(void 0,!1);i.setTexture(this.mWorld.roomManager.currentRoom.playerManager.actor.getDisplay().mDisplayInfo.id+""),this.add(i),this.mBg=new s.NinePatch(this.scene,0,0,500,350,a.a.getName(),null,a.a.getConfig()),this.addAt(this.mBg,0),this.setSize(this.mBg.width,this.mBg.height),this.initFriendItem(),this.mClsBtn=new p.IconBtn(this.mScene,this.mWorld,{key:m.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/common/common_clsBtn.png",jsonUrl:"ui/common/common_clsBtn.json"}),this.mClsBtn.x=(this.mWidth>>1)-65,this.mClsBtn.y=-this.mHeight>>1,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn),t.prototype.init.call(this)},FriendPanel.prototype.tweenComplete=function(e){var i=this;t.prototype.tweenComplete.call(this,e),this.mWorld.roomManager.currentRoom.playerManager.actor.getFriend().requestFriend((function(t){i.setDataList(t)})),e&&this.mWorld.uiManager.getMediator(u.FriendMediator.NAME).resize()},FriendPanel.prototype.downHandler=function(){this.btnScaleHandler(this.mDownBtn);var t=this.mFriendDataList?this.mFriendDataList.length:0,e=Math.floor(t/FriendPanel.count);this.mIndex=this.mIndex+1>e?e:this.mIndex+1,this.refreshDataList()},FriendPanel.prototype.upHandler=function(){this.btnScaleHandler(this.mUpBtn),this.mIndex=this.mIndex-1>0?this.mIndex-1:0,this.refreshDataList()},FriendPanel.prototype.setDataList=function(t){if(this.mFriendList){this.mFriendDataList=t;t.length>FriendPanel.count?FriendPanel.count:t.length;for(var e=0;e<4;e++){var i=this.mFriendList[e],n=t[this.mIndex*FriendPanel.count+e];n?(i.visible=!0,n.index=e):i.visible=!1}this.add(this.mUpBtn),this.add(this.mDownBtn)}},FriendPanel.prototype.refreshDataList=function(){},FriendPanel.prototype.initFriendItem=function(){var t=this.mFriendList?this.mFriendList.length:FriendPanel.count;if(this.mFriendList&&this.mFriendList.length>0)for(var e=0;e<t;e++){(n=this.mFriendList[e]).resize(),n.y=this.mWorld.game.device.os.desktop?(-this.mBg.height/2+this.mTitleTxt.height+e*(n.height+10)+(n.height/2+10))*this.mWorld.uiScale:(e-1.5)*(n.height+10)}else{this.mFriendList=[];var i=[{res:"friendChat",name:"聊天"},{res:"friendGo",name:"跟随"}];for(e=0;e<t;e++){var n;(n=new y(this.mWorld,this.mScene,this,i)).y=this.mWorld.game.device.os.desktop?(-this.mBg.height/2+this.mTitleTxt.height+e*(n.height+10)+(n.height/2+10))*this.mWorld.uiScale:(e-1.5)*(n.height+10),this.mFriendList.push(n)}}},FriendPanel.count=4,FriendPanel}(o.BasePanel),y=function(t){function FriendItem(e,i,n,o){var p=t.call(this,i)||this;p.iconResList=[],p.mPanel=n,p.mWorld=e,p.mScene=i;p.mWorld.getSize();if(p.mBg=new s.NinePatch(p.mScene,0,0,p.mPanel.width,90,a.d.getName(),null,a.d.getConfig()),p.addAt(p.mBg,0),p.setSize(p.mBg.width,p.mBg.height),p.mRoleIcon=new l.DynamicImage(p.mScene,-p.mBg.width/2,0),p.nameTF=p.mScene.make.text({align:"left",style:{font:h.a.YAHEI_20_BOLD,fill:"#FFCC00"}},!1),p.statusTF=p.mScene.make.text({align:"left",style:{font:"14px YaHei"}},!1),o)for(var u=o.length,_loop_1=function(t){var e=m.mScene.make.image(void 0,!1),i=m.mScene.make.container(void 0,!1),n=new s.NinePatch(m.mScene,0,0,60,60,a.d.getName(),null,a.d.getConfig()),h=m.mScene.make.text(void 0,!1),l=o[t];h.setText(l.name),e.setTexture(l.res),e.scaleX=e.scaleY=.8,i.add(e),i.add(h),i.addAt(n,0),i.setSize(60,60),i.setInteractive(new c.Geom.Rectangle(0,0,60,60),Phaser.Geom.Rectangle.Contains),i.on("pointerdown",(function(){p.mPanel.btnScaleHandler(i)}),m),e.y=-n.height/2+e.height/2,h.x=-h.width>>1,h.y=i.height/2-h.height-4,m.add(i),m.iconResList.push(i)},m=this,d=0;d<u;d++)_loop_1(d);return p.add(p.mRoleIcon),p.add(p.nameTF),p.add(p.statusTF),p.refreshUIPos(),p}return d(FriendItem,t),FriendItem.prototype.resize=function(){this.mWorld.game.device.os.desktop||(this.mBg.resize(.95*this.mPanel.width,90),this.setSize(this.mBg.width,this.mBg.height),this.addAt(this.mBg,0),this.refreshUIPos())},FriendItem.prototype.getView=function(){return this},FriendItem.prototype.dataChange=function(t){var e=this,i=(t.level,t.id,t.nickname||"test");this.nameTF.setText(i),this.mRoleIcon.load(a.h.getOsdRes(t.avatar||"1"),this,(function(){e.mRoleIcon.scaleX=e.height/e.mRoleIcon.width,e.mRoleIcon.scaleY=e.height/e.mRoleIcon.height}),(function(){e.mRoleIcon.scaleX=e.mRoleIcon.scaleY=1})),this.mRoleIcon.x=-this.width/2+64,this.nameTF.x=this.mRoleIcon.x+54,this.index=t.index},FriendItem.prototype.destory=function(){this.index=0,this.nameTF&&this.nameTF.destroy(!0),this.statusTF&&this.statusTF.destroy(!0),this.mRoleIcon&&this.mRoleIcon.destroy(!0),this.nameTF=null,this.statusTF=null,this.mPanel=null,this.mWorld=null,t.prototype.destroy.call(this,!0)},FriendItem.prototype.refreshUIPos=function(){if(this.mRoleIcon.x=-this.width/2+64,this.nameTF.x=this.mRoleIcon.x+54,this.mRoleIcon.y=0,this.nameTF.y=10-this.mBg.height/2,this.statusTF.x=this.nameTF.x,this.iconResList)for(var t=this.iconResList.length,e=0;e<t;e++){this.iconResList[e].x=this.width/2-70*(e+1)+20}},FriendItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"RankPanel",(function(){return c}));var n,o=i(92),a=i(26),s=i(71),h=i(27),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function RankPanel(e,i){var n=t.call(this,e,i)||this;return n.mCurrentIndex=0,n}return l(RankPanel,t),RankPanel.prototype.addListen=function(){this.mInitialized&&(this.mWorld.game.device.os.desktop?this.mZoonInBtn.on("pointerup",this.onZoomHandler,this):this.mClsBtn.on("pointerup",this.closeHandler,this))},RankPanel.prototype.removeListen=function(){this.mInitialized&&(this.mWorld.game.device.os.desktop?this.mZoonInBtn.off("pointerup",this.onZoomHandler,this):this.mClsBtn.off("pointerup",this.closeHandler,this))},RankPanel.prototype.resize=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),this.mWorld){var i=this.mWorld.getSize();this.mWorld.game.device.os.desktop?(this.x=i.width-this.width/2,this.y=this.height/2+10):(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.x=i.width+t>>1,this.y=i.height+e>>1),this.scale=this.mWorld.uiScale}},RankPanel.prototype.tweenView=function(t){if(this.scene){var e=this.height/2+10,i=!0===t?e:e-300,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Cubic.Out",props:{y:{value:i},alpha:{value:n}}})}},RankPanel.prototype.destroy=function(){this.mZoonInBtn&&this.mZoonInBtn.destroy(!0),this.mZoonInBtn=null,this.mCurrentIndex=0,t.prototype.destroy.call(this)},RankPanel.prototype.init=function(){t.prototype.init.call(this),this.mWorld.game.device.os.desktop?(this.mZoonInBtn=this.scene.make.image({x:0,y:this.height/2-10,key:"rank_atlas",frame:"arrow.png"},!1),this.add(this.mZoonInBtn),this.mZoonInBtn.setInteractive()):(this.mClsBtn=new a.IconBtn(this.scene,this.mWorld,{key:h.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/common/common_clsBtn.png",jsonUrl:"ui/common/common_clsBtn.json"}),this.mClsBtn.x=this.width/2-35,this.mClsBtn.y=-this.height/2,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn)),this.resize()},RankPanel.prototype.tweenComplete=function(e){if(t.prototype.tweenComplete.call(this,e),e){var i=this.getData("data");i&&this.addItem(i)}},RankPanel.prototype.closeHandler=function(){this.mWorld.uiManager.getMediator(s.RankMediator.NAME).hide()},RankPanel.prototype.onZoomHandler=function(){this.currentSizeIndex=0===this.mCurrentIndex?1:0},Object.defineProperty(RankPanel.prototype,"currentSizeIndex",{set:function(t){if(this.mCurrentIndex!==t){this.mCurrentIndex=t;var e=1===this.mCurrentIndex?30:this.height,i=1===this.mCurrentIndex?-this.height/2+20:this.height/2-10,n=1===this.mCurrentIndex?-this.height/2+15:0;this.mBackground.resize(328,e),this.mZoonInBtn.angle=1===this.mCurrentIndex?180:0,e>300?this.parentContainer&&this.add(this.mChildContainer):this.remove(this.mChildContainer),this.mBackground.y=n,this.mZoonInBtn.y=i}},enumerable:!1,configurable:!0}),RankPanel}(o.BasicRankPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"RightBtnGroup",(function(){return d}));var n,o=i(6),a=i(26),s=i(40),h=i(5),l=i(3),c=i(4),p=i(39),u=i(94),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function RightBtnGroup(e,i){var n=t.call(this,e,i)||this;return n.mBtnY=0,n.mWid=0,n.mHei=0,n.disInteractive(),n}return m(RightBtnGroup,t),RightBtnGroup.prototype.show=function(e){t.prototype.show.call(this,e)},RightBtnGroup.prototype.resize=function(){var t=this.mWorld.getSize();this.refreshSlot();var e=this.mWorld.uiManager.getMediator(u.BottomMediator.NAME),i=e?e.getView().height:this.height/2;if(this.scale=this.mWorld.uiScale,this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){var n=this.mWorld.roomManager.currentRoom.playerManager.actor.package;this.y=t.height-this.height*this.mWorld.uiScale,this.x=t.width-this.width/2*this.mWorld.uiScale,n&&n.items&&n.items.length>0?(this.y=t.height-this.height/2*this.mWorld.uiScale,this.x=t.width-this.width/4*this.mWorld.uiScale):(this.y=t.height-this.height*this.mWorld.uiScale,this.x=t.width-this.width/2*this.mWorld.uiScale)}else this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.PORTRAIT&&(this.y=t.height-(i+this.height/2)*this.mWorld.uiScale,this.x=t.width-this.width/2*this.mWorld.uiScale)},RightBtnGroup.prototype.hide=function(){t.prototype.hide.call(this),this.destroy()},RightBtnGroup.prototype.destroy=function(){this.mBtnY=0,this.mWid=0,this.mHei=0,this.mBagSlotList&&this.mBagSlotList.forEach((function(t){t&&(t.destroy(),t=null)})),this.mResKey="",this.mBagSlotList=null,t.prototype.destroy.call(this)},RightBtnGroup.prototype.tweenView=function(t){var e,i=this.mWorld.getSize();if(this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){var n=this.mWorld.roomManager.currentRoom.playerManager.actor.package;e=n&&n.items&&n.items.length>0?i.width-this.width/4*this.mWorld.uiScale:i.width-this.width/2*this.mWorld.uiScale}else e=i.width-this.width/2*this.mWorld.uiScale;var o=!0===t?e:e+this.width,a=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{x:{value:o},alpha:{value:a}}})},RightBtnGroup.prototype.refreshSlot=function(){if(this.handBtn){if(this.mHei=this.handBtn.height,this.mBagSlotList){this.mBagSlotList.forEach((function(t){t&&(t.getView().visible=!1)}));var t=this.mWorld.roomManager.currentRoom.playerManager.actor.package;if(t&&t.items)for(var e=t.items,i=e.length>RightBtnGroup.SlotMaxCount?RightBtnGroup.SlotMaxCount:e.length,n=0,o=0,a=0;a<i;a++){if(this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){var s=38*(a+2)/-180*Math.PI;n=110*Math.cos(s),o=this.handBtn.y+110*Math.sin(s),a===i-1&&(this.mWid=110+this.handBtn.width+30+28,this.mHei=110+this.handBtn.height+30+28)}else n=0,o=-56*(a+1)-20*a,a===i-1&&(this.mWid=this.handBtn.width,this.mHei=56*(i-1)+5*(i-2)+this.handBtn.height+5);var h=this.mBagSlotList[a];h.getView().visible=!0,h.toolTipCon.x=n,h.toolTipCon.y=o,h.dataChange(e[a])}}this.setSize(this.mWid,this.mHei)}},RightBtnGroup.prototype.tweenComplete=function(e){this.resize(),t.prototype.tweenComplete.call(this,e)},RightBtnGroup.prototype.preload=function(){this.mResKey="baseView",this.scene.load.atlas(this.mResKey,h.h.getRes("ui/baseView/mainui_mobile.png"),h.h.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this)},RightBtnGroup.prototype.init=function(){var e=this;this.mWorld.getSize();this.mWorld.uiManager.getUILayerManager().addToUILayer(this),this.mBtnY=0,this.handBtn=new a.IconBtn(this.scene,this.mWorld,{key:p.BagMediator.NAME,bgResKey:this.mResKey,bgTextures:["btnGroup_bg.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_hand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.handBtn.x=0,this.handBtn.y=this.mBtnY+this.handBtn.height/2,this.handBtn.setClick((function(){var t=new c.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN);t.content.keyCodes=[70],e.mWorld.connection.send(t)})),this.add(this.handBtn),this.mWid=this.handBtn.width,this.mHei=this.handBtn.height,this.initBagSlotData(),t.prototype.init.call(this)},RightBtnGroup.prototype.initBagSlotData=function(){this.mBagSlotList=[];this.mWorld.getSize();for(var t=RightBtnGroup.SlotMaxCount,e=0;e<t;e++){var i=new s.ItemSlot(this.scene,this.mWorld,this,0,0,this.mResKey,h.h.getRes("ui/baseView/mainui_mobile.png"),h.h.getRes("ui/baseView/mainui_mobile.json"),"btnGroup_bg.png");i.createUI(),i.getBg().scaleX=i.getBg().scaleY=.8,i.getIcon().scaleX=i.getIcon().scaleY=1.2,this.mBagSlotList.push(i),this.add(i.toolTipCon),i.getView().visible=!1}this.resize()},RightBtnGroup.SlotMaxCount=4,RightBtnGroup}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"BottomBtnGroup",(function(){return f}));var n,o=i(6),a=i(5),s=i(26),h=i(27),l=i(64),c=i(88),p=i(39),u=i(93),m=i(95),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function BottomBtnGroup(e,i){var n=t.call(this,e,i)||this;return n.mExpandBoo=!1,n.tmpWid=0,n.tmpHei=0,n.disInteractive(),n}return d(BottomBtnGroup,t),BottomBtnGroup.prototype.show=function(e){t.prototype.show.call(this,e)},BottomBtnGroup.prototype.addListen=function(){this.mChatContainer.on("pointerdown",this.chatHandler,this),this.mVoiceBtn.on("selected",this.onSelectedVoiceHandler,this),this.mMicBtn.on("selected",this.onSelectedMicHandler,this)},BottomBtnGroup.prototype.removeListen=function(){this.mChatContainer.off("pointerdown",this.chatHandler,this),this.mVoiceBtn.off("selected",this.onSelectedVoiceHandler,this),this.mMicBtn.off("selected",this.onSelectedMicHandler,this)},BottomBtnGroup.prototype.resize=function(){var t=this.mWorld.getSize();this.scale=this.mWorld.uiScale,this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.x=t.width>>1,this.mVoiceBtn.x=this.mVoiceBtn.width*this.mMicBtn.scaleX-this.mChatContainer.width/2,this.mVoiceBtn.y=-this.mVoiceBtn.height/2*this.mVoiceBtn.scaleY-this.mChatContainer.height/2,this.mMicBtn.x=this.mVoiceBtn.x+this.mVoiceBtn.width*this.mMicBtn.scaleX+20,this.mMicBtn.y=this.mVoiceBtn.y):this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.PORTRAIT&&(this.x=t.width-(this.width/2+40)*this.mWorld.uiScale,this.mVoiceBtn.x=this.mVoiceBtn.width-this.mChatContainer.width/2,this.mVoiceBtn.y=this.mChatContainer.y-this.mChatContainer.height/2-this.mVoiceBtn.height/2*this.mMicBtn.scaleX,this.mMicBtn.x=this.mVoiceBtn.x+this.mMicBtn.width*this.mMicBtn.scaleX+20,this.mMicBtn.y=this.mVoiceBtn.y),this.y=t.height-120*this.mWorld.uiScale;var e,i=this.mWorld.uiManager.getMediator(u.RightMediator.NAME);if(i&&(e=i.getView()),i){if(this.mWorld.inputManager)this.mWorld.inputManager.resize();e&&e.resize()}this.mChatText.setStyle({fontSize:Math.floor(30*this.mWorld.uiScale)})},BottomBtnGroup.prototype.tweenView=function(t){var e=this.mWorld.getSize().height-120*this.mWorld.uiScale,i=!0===t?e:e+50,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{y:{value:i},alpha:{value:n}}})},BottomBtnGroup.prototype.preload=function(){this.scene&&(this.mResKey="baseView",this.scene.load.atlas("chat_atlas",a.h.getRes("ui/chat/chat_atlas.png"),a.h.getRes("ui/chat/chat_atlas.json")),this.scene.load.atlas(this.mResKey,a.h.getRes("ui/baseView/mainui_mobile.png"),a.h.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this))},BottomBtnGroup.prototype.init=function(){var e=this;this.mBtnList=[];var i=this.mWorld.getSize();this.mWorld.uiManager.getUILayerManager().addToUILayer(this);this.mChatContainer=this.scene.make.container(void 0,!1),this.mChatBg=this.scene.make.image(void 0,!1),this.mChatBg.setTexture(this.mResKey,"btnGroup_chatBg.png"),this.mChatContainer.addAt(this.mChatBg,0),this.mChatText=this.scene.make.text({width:430,height:230,style:{font:"bold YaHei",color:"#666666",fontSize:Math.floor(30*this.mWorld.uiScale),wordWrap:{width:430,useAdvancedWrap:!0}}},!1),this.mChatText.setText("点击窗口进入聊天界面"),this.mChatContainer.addAt(this.mChatText,1),this.mChatContainer.setSize(430,230),this.mChatText.x=-this.mChatContainer.width>>1,this.mChatText.y=-this.mChatContainer.height>>1,this.mChatContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,430,230),Phaser.Geom.Rectangle.Contains),this.add(this.mChatContainer),this.tmpWid+=this.mChatContainer.width,this.tmpHei+=this.mChatContainer.height,this.mTurnBtn=new s.IconBtn(this.scene,this.mWorld,{key:h.UIMediatorType.Turn_Btn_Bottom,bgResKey:this.mResKey,bgTextures:["btnGroup_white_normal.png","btnGroup_white_light.png","btnGroup_white_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_bottom_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mTurnBtn.x=30+(this.tmpWid>>1),this.mTurnBtn.y=this.tmpHei-this.mTurnBtn.height>>1,this.mTurnBtn.setPos(this.mTurnBtn.x,this.mTurnBtn.y),this.add(this.mTurnBtn),this.mBagBtn=new s.IconBtn(this.scene,this.mWorld,{key:p.BagMediator.NAME,bgResKey:this.mResKey,bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_bag_icon.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mBagBtn.x=this.mTurnBtn.x,this.mBagBtn.y=this.mTurnBtn.y-this.mTurnBtn.height/2-this.mBagBtn.height/2-10,this.mBagBtn.setPos(this.mBagBtn.x,this.mBagBtn.y),this.tmpWid+=this.mBagBtn.width+30,this.add(this.mBagBtn),this.mBtnList.push(this.mBagBtn),this.mTurnBtn.setClick((function(){e.turnHandler()})),this.mBagBtn.setClick((function(){e.bagHandler()})),this.mMarketBag=new s.IconBtn(this.scene,this.mWorld,{key:p.BagMediator.NAME,bgResKey:this.mResKey,bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_bag_icon.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mMarketBag.x=this.mTurnBtn.x,this.mMarketBag.y=this.mTurnBtn.y-this.mTurnBtn.height/2-this.mBagBtn.height/2-60-this.mMarketBag.height/2,this.mMarketBag.setPos(this.mMarketBag.x,this.mBagBtn.y),this.tmpWid+=this.mMarketBag.width+30,this.add(this.mMarketBag),this.setSize(this.tmpWid,this.tmpHei),this.mBtnList.push(this.mMarketBag),this.mMarketBag.setClick((function(){e.marketBagHandler()})),this.mVoiceBtn=new c.CheckButton(this.scene,0,0,"chat_atlas","voice_normal.png","voice_selected.png"),this.mVoiceBtn.x=this.width-60*this.mWorld.uiScale,this.mVoiceBtn.y=i.height-this.height,this.add(this.mVoiceBtn),this.mMicBtn=new c.CheckButton(this.scene,0,0,"chat_atlas","mic_normal.png","mic_selected.png"),this.mMicBtn.x=this.width-20*this.mWorld.uiScale,this.mMicBtn.y=i.height-this.height,this.add(this.mMicBtn),this.mVoiceBtn.scaleX=this.mVoiceBtn.scaleY=1.5,this.mMicBtn.scaleX=this.mMicBtn.scaleY=1.5,this.setSize(this.tmpWid,this.tmpHei),this.resize(),t.prototype.init.call(this)},BottomBtnGroup.prototype.tweenComplete=function(e){this.resize(),t.prototype.tweenComplete.call(this,e)},BottomBtnGroup.prototype.onSelectedVoiceHandler=function(t){!1===t&&(this.mMicBtn.selected=!1),this.emit("selectedVoice",t)},BottomBtnGroup.prototype.onSelectedMicHandler=function(t){!1!==this.mVoiceBtn.selected?(this.mMicBtn.selected=t,this.emit("selectedMic",t)):this.mMicBtn.selected=!1},BottomBtnGroup.prototype.turnHandler=function(){var t=this;this.mVoiceBtn.visible=this.mExpandBoo,this.mMicBtn.visible=this.mExpandBoo;var e=this.mExpandBoo?"Sine.easeIn":"Sine.easeOut";if(this.mChatContainer&&this.mChatContainer.parentContainer){var i=this.mExpandBoo?1:0,n=this.mExpandBoo?1:0;this.scene.tweens.add({targets:this.mChatContainer,duration:300,ease:e,props:{scaleX:{value:i},scaleY:{value:n}}})}if(!this.mBtnList||this.mBtnList.length<1)this.mExpandBoo=!this.mExpandBoo;else{var o,a=this.mBtnList.length,s=this.mWorld.uiManager.getMediator(u.RightMediator.NAME);s&&(o=s.getView());for(var _loop_1=function(i){var n=h.mBtnList[i],l=h.mExpandBoo?n.getPos().x:h.mChatContainer.width/2-Math.abs(n.getPos().y)-20,c=h.mExpandBoo?n.getPos().y:h.mTurnBtn.y;h.scene.tweens.add({targets:n,duration:300,ease:e,props:{x:{value:l},y:{value:c}},onComplete:function(e,h,l){if(i===a-1&&(t.mExpandBoo=!t.mExpandBoo,t.mExpandBoo?t.setSize(t.tmpWid,2*n.height):t.setSize(t.tmpWid,t.tmpHei),s)){if(t.mWorld.inputManager)t.mWorld.inputManager.resize();o&&o.resize()}},onCompleteParams:[h]})},h=this,l=0;l<a;l++)_loop_1(l)}},BottomBtnGroup.prototype.chatHandler=function(){var t=this.mWorld.uiManager.getMediator(l.ChatMediator.NAME);void 0===t&&(t=new l.ChatMediator(this.mWorld,this.scene),this.mWorld.uiManager.setMediator(l.ChatMediator.NAME,t)),t.isShow()||t.show(),this.mWorld.uiManager.baseFaceTween(!1)},BottomBtnGroup.prototype.bagHandler=function(){this.mWorld.uiManager.getMediator(h.UIMediatorType.BagMediator).show()},BottomBtnGroup.prototype.marketBagHandler=function(){var t=this.mWorld.uiManager.getMediator(m.ElementStorageMediator.name);t||(t=new m.ElementStorageMediator(this.mWorld.uiManager.getUILayerManager(),this.scene,this.mWorld),this.mWorld.uiManager.setMediator(m.ElementStorageMediator.name,t)),t.isShow()?t.hide():t.show(!0)},BottomBtnGroup}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ElementStoragePanel",(function(){return m}));var n,o=i(6),a=i(12),s=i(5),h=i(23),l=i(19),c=i(158),p=i(95),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function ElementStoragePanel(e,i){var n=t.call(this,e,i)||this;return n.mExpaned=!0,n.mItemNum=32,n.setTween(!1),n.dpr/=2,n}return u(ElementStoragePanel,t),ElementStoragePanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&this.setPackageNum(1)},ElementStoragePanel.prototype.resize=function(t){var e=this.mWorld.getSize();if(this.scale=this.dpr,this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){this.setSize(341,450),this.x=e.width-this.width*this.dpr-10,this.y=e.height-this.height*this.dpr>>1,this.mBackground.resize(this.width,this.height),this.mBackground.x=this.mBackground.width>>1,this.mBackground.y=this.mBackground.height>>1,this.mBorder.resize(327,423),this.mBorder.x=7+(this.mBorder.width>>1),this.mBorder.y=19+(this.mBorder.height>>1),this.mSearchInput.x=145,this.mSearchInput.y=40,this.mDragBtn.x=-this.mDragBtn.height,this.mDragBtn.y=this.height>>1;for(var i=this.mProps.length,n=0;n<i;n++)this.mProps[n].x=n%4*60+20,this.mProps[n].y=60*Math.floor(n/4)+80}else{this.setSize(510,329),this.mBackground.resize(this.width,this.height),this.mBackground.x=this.mBackground.width>>1,this.mBackground.y=this.mBackground.height>>1,this.mBorder.resize(496,303),this.mBorder.x=7+(this.mBorder.width>>1),this.mBorder.y=19+(this.mBorder.height>>1),this.mSearchInput.x=270,this.mSearchInput.y=33,this.x=e.width-this.width*this.dpr>>1,this.y=e.height-this.height*this.dpr-10,this.mDragBtn.x=this.width>>1,this.mDragBtn.y=-this.mDragBtn.height>>1;for(i=this.mProps.length,n=0;n<i;n++)this.mProps[n].x=n%8*60+20,this.mProps[n].y=60*Math.floor(n/8)+80}this.mPrePageBtn.y=this.height>>1,this.mNextPageBtn.x=this.width,this.mNextPageBtn.y=this.height>>1,this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,this.width,this.height),Phaser.Geom.Rectangle.Contains)},ElementStoragePanel.prototype.addListen=function(){t.prototype.addListen.call(this),this.mBackground&&this.mBackground.on("pointerout",this.onPointerOutHandler,this),this.mDragBtn&&this.mDragBtn.on("pointerup",this.switchExpand,this),this.mPrePageBtn&&this.mPrePageBtn.on("pointerup",this.onPrePageHandler,this),this.mNextPageBtn&&this.mNextPageBtn.on("pointerup",this.onNextPageHandler,this),this.mCloseBtn&&this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.scene&&(this.scene.input.on("dragstart",this.onDragStartHandler,this),this.scene.input.on("dragend",this.onDragEndHandler,this),this.scene.input.on("drag",this.onDragHandler,this))},ElementStoragePanel.prototype.removeListen=function(){t.prototype.removeListen.call(this),this.mBackground&&this.mBackground.off("pointerout",this.onPointerOutHandler,this),this.mDragBtn&&this.mDragBtn.off("pointerup",this.switchExpand,this),this.mPrePageBtn&&this.mPrePageBtn.off("pointerup",this.onPrePageHandler,this),this.mNextPageBtn&&this.mNextPageBtn.off("pointerup",this.onNextPageHandler,this),this.mCloseBtn&&this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.scene&&(this.scene.input.off("dragstart",this.onDragStartHandler,this),this.scene.input.off("dragend",this.onDragEndHandler,this),this.scene.input.off("drag",this.onDragHandler,this))},ElementStoragePanel.prototype.setProps=function(t){var e=t.items;this.clearItem();for(var i=0;i<e.length;i++){if(i>=this.mProps.length)return;this.mProps[i].setProp(e[i])}},ElementStoragePanel.prototype.expand=function(){if(!this.mExpaned){var t=this.mWorld.getSize(),e=null;e=this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?{x:t.width-this.width*this.dpr-10}:{y:t.height-this.height*this.dpr-10},this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:e}),this.remove(this.mDragBtn),this.add([this.mPrePageBtn,this.mNextPageBtn]),this.mExpaned=!0}},ElementStoragePanel.prototype.collapse=function(){if(this.mExpaned){var t=this.mWorld.getSize(),e=null;e=this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?{x:t.width}:{y:t.height},this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:e}),this.addAt(this.mDragBtn,0),this.remove([this.mPrePageBtn,this.mNextPageBtn]),this.mExpaned=!1}},ElementStoragePanel.prototype.destroy=function(){this.scene&&(this.scene.input.off("dragstart",this.onDragStartHandler,this),this.scene.input.off("dragend",this.onDragEndHandler,this),this.scene.input.off("drag",this.onDragHandler,this)),t.prototype.destroy.call(this)},ElementStoragePanel.prototype.preload=function(){this.scene.load.image(s.d.getName(),s.d.getPNG()),this.scene.load.image("button",s.h.getRes("ui/common/button.png")),this.scene.load.image("prop_background",s.h.getRes("ui/common/prop_background.png")),this.scene.load.atlas("slip",s.h.getRes("ui/bag/slip.png"),s.h.getRes("ui/bag/slip.json")),this.mScene.load.atlas("clsBtn",s.h.getRes("ui/common/common_clsBtn.png"),s.h.getRes("ui/common/common_clsBtn.json")),this.scene.load.image(s.a.getName(),s.a.getPNG()),t.prototype.preload.call(this)},ElementStoragePanel.prototype.init=function(){this.mBackground=new a.NinePatch(this.scene,0,0,this.width,this.height,s.a.getName(),null,s.a.getConfig()),this.mBorder=new a.NinePatch(this.scene,7,19,327,423,s.d.getName(),null,s.d.getConfig()),this.mSearchInput=new h.a(this.scene,145,40,210,26,{type:"input",fontSize:"14px",color:"#808080",placeholder:"输入关键词进行搜索"});this.mDragBtn=new l.NinePatchButton(this.scene,0,-20,80,40,"button","","物件容器",{left:4,top:4,right:4,bottom:4}),this.mPrePageBtn=this.scene.make.sprite({key:"slip"},!1),this.mPrePageBtn.setInteractive(),this.mNextPageBtn=this.scene.make.sprite({key:"slip"},!1).setFlipX(!0),this.mNextPageBtn.setInteractive(),this.mProps=[],this.add([this.mBackground,this.mBorder,this.mSearchInput]);for(var e=0;e<this.mItemNum;e++){var i=new c.Item(this.scene);this.mProps[e]=i}this.add(this.mProps),this.add([this.mPrePageBtn,this.mNextPageBtn]),this.mCloseBtn=this.scene.make.image({key:"clsBtn",frame:"btn_normal"},!1).setInteractive().setScale(2),this.add(this.mCloseBtn),t.prototype.init.call(this),this.resize(),this.expand()},ElementStoragePanel.prototype.onPrePageHandler=function(){this.setPackageNum(this.mPacgeNum-1)},ElementStoragePanel.prototype.onNextPageHandler=function(){this.setPackageNum(this.mPacgeNum+1)},ElementStoragePanel.prototype.setPackageNum=function(t){this.mPacgeNum=t<1?1:t,this.emit("queryElement",this.mPacgeNum,32)},ElementStoragePanel.prototype.switchExpand=function(){this.mExpaned?this.collapse():this.expand()},ElementStoragePanel.prototype.onSelectedHandler=function(){},ElementStoragePanel.prototype.onClick=function(t){},ElementStoragePanel.prototype.onDragStartHandler=function(t,e,i,n){var o=e.parentContainer;o instanceof c.Item&&(this.mDragData=o.prop),this.mDragImage||(this.mDragImage=this.scene.make.image(void 0,!1),this.add(this.mDragImage)),this.mDragImage.x=o.x,this.mDragImage.y=o.y,this.mDragImage.setTexture(e.texture.key),this.mDragging=!0},ElementStoragePanel.prototype.onDragEndHandler=function(){this.mDragImage&&(this.mDragImage.setTexture(void 0),this.mDragging=!1)},ElementStoragePanel.prototype.onDragHandler=function(t,e,i,n){this.mDragImage&&(this.mDragImage.x+=t.x-t.prevPosition.x,this.mDragImage.y+=t.y-t.prevPosition.y)},ElementStoragePanel.prototype.onPointerOutHandler=function(){this.mDragImage&&this.mDragging&&(this.emit("selectedElement",this.mDragData),this.mDragImage.setTexture(void 0),this.mDragging=!1)},ElementStoragePanel.prototype.clearItem=function(){this.mProps&&this.mProps.map((function(t){return t.clear()}))},ElementStoragePanel.prototype.onCloseHandler=function(){var t=this.mWorld.uiManager.getMediator(p.ElementStorageMediator.name);t&&t.hide()},ElementStoragePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Item",(function(){return h}));var n,o=i(16),a=i(5),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Item(e){var i=t.call(this,e)||this,n=e.make.image({key:"prop_background"}).setOrigin(0,0);return i.setSize(n.width,n.height),i.add(n),i.mImage=new o.DynamicImage(i.scene,0,0).setOrigin(0,0),i.add(i.mImage),i.mCount=e.make.text(void 0,!1),i.mCount.setAlign("right"),i.mCount.y=i.height-20,i.add(i.mCount),i}return s(Item,t),Item.prototype.setProp=function(t){var e=this;this.mProp=t,this.mCount&&t&&(this.mImage.load(a.h.getOsdRes(t.display.texturePath),this,(function(){e.mImage.setInteractive(),e.scene.input.setDraggable(e.mImage);var t=1;e.mImage.width>e.width&&(t=e.width/e.mImage.width),e.mImage.height>e.height&&(t=e.height/e.mImage.height),e.mImage.scale=t})),this.mCount.setText(t.count>1?t.count.toString():""),this.mCount.x=this.width-this.mCount.width)},Item.prototype.clear=function(){this.count&&this.mProp&&(this.mCount.setText(""),this.mImage.setTexture(void 0),this.mImage.off("pointerup",this.onPointerUpHandler,this),this.mProp=void 0)},Item.prototype.destroy=function(){this.clear(),t.prototype.destroy.call(this)},Object.defineProperty(Item.prototype,"prop",{get:function(){return this.mProp},enumerable:!1,configurable:!0}),Item.prototype.onPointerUpHandler=function(){this.emit("click",this.mProp)},Item}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"ElementStorage",(function(){return l}));var n,o=i(4),a=i(3),s=i(13),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ElementStorage(e){var i=t.call(this)||this;return i.world=e,i.event=new Phaser.Events.EventEmitter,i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_QUERY_EDIT_PACKAGE,i.onQueryEditPackageResuleHandler),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE,i.onQueryMarketPacketResuleHandler),i}return h(ElementStorage,t),ElementStorage.prototype.register=function(){this.world&&this.world.connection.addPacketListener(this)},ElementStorage.prototype.unregister=function(){this.world&&(this.world.connection.removePacketListener(this),this.event.removeAllListeners())},ElementStorage.prototype.on=function(t,e,i){this.event.on(t,e,i)},ElementStorage.prototype.off=function(t,e,i){this.event.off(t,e,i)},ElementStorage.prototype.queryPackage=function(t,e,i,n){this.world},ElementStorage.prototype.queryMarketPackage=function(t,e,i,n){this.world},ElementStorage.prototype.destroy=function(){this.unregister()},ElementStorage.prototype.onQueryEditPackageResuleHandler=function(t){this.event.emit(s.a.EDIT_MODE_QUERY_PACKAGE,t.content)},ElementStorage.prototype.onQueryMarketPacketResuleHandler=function(t){this.event.emit(s.a.EDIT_MODE_QUERY_PACKAGE,t.content)},ElementStorage}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"LeftMediator",(function(){return h}));var n,o=i(41),a=i(161),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function LeftMediator(e,i){return t.call(this,e,i)||this}return s(LeftMediator,t),LeftMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new a.LeftBtnGroup(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},LeftMediator.NAME="LeftMediator",LeftMediator}(o.BaseFaceMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"LeftBtnGroup",(function(){return l}));var n,o=i(6),a=i(5),s=i(162),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function LeftBtnGroup(e,i){var n=t.call(this,e,i)||this;return n.mCollapse=!1,n.disInteractive(),n}return h(LeftBtnGroup,t),LeftBtnGroup.prototype.show=function(e){this.scale=this.mWorld.uiScale,t.prototype.show.call(this,e)},LeftBtnGroup.prototype.resize=function(){this.x=this.width+5*this.mWorld.uiScale,this.y=this.height/2+10*this.mWorld.uiScale,this.scale=this.mWorld.uiScale},LeftBtnGroup.prototype.destroy=function(){this.mExpandBtn&&this.mExpandBtn.destroy(),this.mResKey="",this.mExpandBtn=null,this.mCollapse=!1,t.prototype.destroy.call(this)},LeftBtnGroup.prototype.tweenView=function(t){var e=this.width+5*this.mWorld.uiScale,i=!0===t?e:e-50,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Linear",props:{x:{value:i},alpha:{value:n}}})},LeftBtnGroup.prototype.addListen=function(){},LeftBtnGroup.prototype.removeListen=function(){},LeftBtnGroup.prototype.preload=function(){this.scene&&(this.mResKey="baseView",this.scene.load.atlas(this.mResKey,a.h.getRes("ui/baseView/mainui_mobile.png"),a.h.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this))},LeftBtnGroup.prototype.init=function(){var e=this;this.mWorld.uiManager.getUILayerManager().addToUILayer(this);var i=0;"app"!==this.mWorld.getConfig().platform&&(this.mExpandBtn=new s.IconSelectBtn(this.scene,this.mWorld,this.mResKey,["btnGroup_expand.png","btnGroup_collapse.png"],1),this.add(this.mExpandBtn),this.mExpandBtn.setClick((function(){e.mCollapse?e.mWorld.stopFullscreen():e.mWorld.startFullscreen(),e.mExpandBtn.setBgRes(Number(!e.mCollapse)),e.mCollapse=!e.mCollapse})),i+=this.mExpandBtn.height/2+20,this.setSize(this.mExpandBtn.width,i)),this.resize(),t.prototype.init.call(this)},LeftBtnGroup}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"IconSelectBtn",(function(){return s}));var n,o=i(14),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function IconSelectBtn(e,i,n,o,a){void 0===a&&(a=28/43);var s=t.call(this,e)||this;return s.mScene=e,s.mWorld=i,s.mBtnBg=e.make.image(void 0,!1),s.mBgTexture=o,s.mBgResKey=n,s.mBtnBg.setTexture(n,o[0]),s.mBtnBg.scaleX=s.mBtnBg.scaleY=a,s.addAt(s.mBtnBg,0),s.setSize(s.mBtnBg.width,s.mBtnBg.height),s.setInteractive(),s.on("pointerup",s.upHandler,s),s.on("pointerdown",s.downHandler,s),s.on("pointerover",s.overHandler,s),s.on("pointerout",s.outHandler,s),s}return a(IconSelectBtn,t),IconSelectBtn.prototype.setPos=function(t,e){this.mBasePos||(this.mBasePos=new o.a),this.mBasePos.x=t,this.mBasePos.y=e},IconSelectBtn.prototype.getPos=function(){return this.mBasePos},IconSelectBtn.prototype.setBtnData=function(t){this.mBtnData=t},IconSelectBtn.prototype.getBtnData=function(){return this.mBtnData},IconSelectBtn.prototype.setClick=function(t){this.monClick=t},IconSelectBtn.prototype.setBgRes=function(t){this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[t]||0)},IconSelectBtn.prototype.destroy=function(){this.mBtnBg&&this.mBtnBg.destroy(!0),this.mBtnIcon&&this.mBtnIcon.destroy(!0),this.monClick=null,this.mBtnBg=null,this.mBtnIcon=null,this.mBtnData=null,this.mScene=null,t.prototype.destroy.call(this)},IconSelectBtn.prototype.overHandler=function(t){},IconSelectBtn.prototype.outHandler=function(t){},IconSelectBtn.prototype.upHandler=function(){this.monClick&&this.monClick()},IconSelectBtn.prototype.downHandler=function(){this.scaleHandler()},IconSelectBtn.prototype.scaleHandler=function(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1},IconSelectBtn}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"BagGroupMediator",(function(){return c}));var n,o=i(41),a=i(13),s=i(164),h=i(18),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function BagGroupMediator(e,i){var n=t.call(this,e,i)||this;return n.mUIType=h.a.Scene,n}return l(BagGroupMediator,t),BagGroupMediator.prototype.isSceneUI=function(){return!0},BagGroupMediator.prototype.isShow=function(){if(this.mView)return this.mView.isShow()},BagGroupMediator.prototype.show=function(e){if(!this.mView||!this.mView.isShow()){var i=this.world.getSize();this.mView=new s.BagGroup(this.mScene,this.world,(i.width>>1)-29,i.height-50),this.mView.show(e),this.addListen(),t.prototype.show.call(this,e)}},BagGroupMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},BagGroupMediator.prototype.hide=function(){this.mShow=!1,this.removeListen(),this.mView&&(this.mView.hide(),this.mView=null)},BagGroupMediator.prototype.addListen=function(){this.world.emitter.on(a.a.QUERY_PACKAGE,this.queryPackAge,this),this.world.emitter.on(a.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.on(a.a.PACKAGE_ITEM_ADD,this.heroItemChange,this)},BagGroupMediator.prototype.removeListen=function(){this.world.emitter.off(a.a.QUERY_PACKAGE,this.queryPackAge,this),this.world.emitter.off(a.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.off(a.a.PACKAGE_ITEM_ADD,this.heroItemChange,this)},BagGroupMediator.prototype.heroItemChange=function(){if(this.world.roomManager.currentRoom&&this.world.roomManager.currentRoom.playerManager&&this.world.roomManager.currentRoom.playerManager.actor){var t=this.world.roomManager.currentRoom.playerManager.actor.package.items;this.mView&&this.mView.setDataList(t)}},BagGroupMediator.prototype.queryPackAge=function(t){this.world.roomManager.currentRoom&&this.world.roomManager.currentRoom.playerManager&&this.world.roomManager.currentRoom.playerManager.actor&&t.id===this.world.roomManager.currentRoom.playerManager.actor.package.id&&this.mView&&this.mView.setDataList(t.items)},BagGroupMediator.NAME="BagGroupMediator",BagGroupMediator}(o.BaseFaceMediator)},function(t,e,i){"use strict";i.r(e),i.d(e,"BagGroup",(function(){return u}));var n,o=i(40),a=i(5),s=i(96),h=i(64),l=i(39),c=i(6),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function BagGroup(e,i,n,o){var a=t.call(this,e,i)||this;return a.tmpWid=0,a.x=n,a.y=o,i.uiManager.getUILayerManager().addToToolTipsLayer(a),a.bagSlotList=[],a}return p(BagGroup,t),BagGroup.prototype.show=function(e){t.prototype.show.call(this)},BagGroup.prototype.resize=function(t,e){var i=this.mWorld.getSize(),n=this.mWorld.uiManager.getMediator(h.ChatMediator.NAME);this.x=(i.width-this.tmpWid)/2<n.getView().width?n.getView().width+this.width/2:(i.width-this.tmpWid)/2,this.y=i.height-50},BagGroup.prototype.tweenExpand=function(t){if(this.scene){var e=this.mWorld.getSize().height-50,i=!0===t?e:e+100,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Cubic.Out",props:{y:{value:i},alpha:{value:n}}})}},BagGroup.prototype.destroy=function(){this.bagSlotList&&(this.bagSlotList.forEach((function(t){t&&t.destroy()})),this.bagSlotList.length=0,this.bagSlotList=null),this.tmpWid=0,this.baseBagBgWid=0,this.mResStr=null,this.mResPng=null,this.mResJson=null,t.prototype.destroy.call(this)},BagGroup.prototype.addListen=function(){this.mBagBtnCon&&(this.mBagBtnCon.on("pointerdown",this.bagHandler,this),this.mBagBtnCon.on("pointerover",this.bagBtnOver,this),this.mBagBtnCon.on("pointerout",this.bagBtnOut,this))},BagGroup.prototype.removeListen=function(){this.mBagBtnCon&&(this.mBagBtnCon.off("pointerdown",this.bagHandler,this),this.mBagBtnCon.off("pointerover",this.bagBtnOver,this),this.mBagBtnCon.off("pointerout",this.bagBtnOut,this))},BagGroup.prototype.setDataList=function(t){this.bagSlotList&&this.bagSlotList.forEach((function(t){t&&(t.getView().visible=!1)}));for(var e=[],i=t.length>BagGroup.SlotMaxCount?BagGroup.SlotMaxCount:t.length,n=this.baseBagBgWid+5,o=0;o<i;o++){var a=this.bagSlotList[o];a.getView().visible=!0,e.push(a.toolTipCon),a.dataChange(t[o]),n+=61}this.width!==n&&(this.width=n,this.buttons&&(this.buttons.destroy(!0),this.buttons=null),this.buttons=this.scene.rexUI.add.buttons({x:(n+this.mBagBg.width)/2,y:0,width:56,height:56,orientation:0,buttons:e,groupName:"bagBtn",align:"right",click:{mode:"pointerup",clickInterval:100},space:5,name:"bag"}),this.buttons.layout(),this.setSize(n,65),this.mWorld.uiManager.baseFaceResize())},BagGroup.prototype.preload=function(){this.scene&&(this.mResStr="bag",this.mResPng="ui/bag/bag.png",this.mResJson="ui/bag/bag.json",this.scene.load.atlas(this.mResStr,a.h.getRes(this.mResPng),a.h.getRes(this.mResJson)),t.prototype.preload.call(this))},BagGroup.prototype.init=function(){if(this.mBagBtnCon=this.scene.add.container(0,0),this.mBagBg=this.scene.add.sprite(0,0,this.mResStr,"bag_BtnBg"),this.baseBagBgWid=this.mBagBg.width,this.tmpWid+=this.mBagBg.width+5,this.bagBtn=this.scene.add.sprite(this.mBagBg.x,this.mBagBg.y,this.mResStr,"bag_Btn"),this.mSubScriptSprite=this.scene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,"bag_SubScripta"),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.mBagBg.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.mBagBg.height>>1,this.mBagBtnCon.addAt(this.mBagBg,0),this.mBagBtnCon.addAt(this.bagBtn,1),this.mBagBtnCon.setSize(56,56),this.mBagBtnCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBagBg.width,this.mBagBg.height),Phaser.Geom.Rectangle.Contains),this.initBagSlot(),this.setSize(this.tmpWid,65),this.mWorld.roomManager.currentRoom&&this.mWorld.roomManager.currentRoom.playerManager&&this.mWorld.roomManager.currentRoom.playerManager.actor){var e=this.mWorld.roomManager.currentRoom.playerManager.actor.package;e&&e.items&&this.setDataList(e.items)}this.add(this.mBagBtnCon),t.prototype.init.call(this)},BagGroup.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.baseFaceResize()},BagGroup.prototype.initBagSlot=function(){for(var t,e=["0","b","c"],i=0;i<BagGroup.SlotMaxCount;i++){t=i>=9?"bag_SubScript"+e[i%9]:"bag_SubScript"+(i+1);var n=new o.ItemSlot(this.scene,this.mWorld,this,0,0,this.mResStr,this.mResPng,this.mResJson,"bag_Slot","",t);n.createUI(),n.getView().visible=!1,this.bagSlotList.push(n)}},BagGroup.prototype.bagHandler=function(){var t=this.mWorld.uiManager.getMediator(l.BagMediator.NAME);t.isShow()?t.hide():t.show()},BagGroup.prototype.tmpLoad=function(){var t=this;this.radio?this.radio.isShow||this.radioComplete():this.radio=new s.Radio(this.scene,{wid:328,hei:142,resKey:"juqingRadio",resPng:"./resources/ui/juqing/juqing.png",resJson:"./resources/ui/juqing/juqing.json",resBg:"radio_bg.png",resArrow:"radio_arrow.png",fontStyle:{size:20,color:"#ffcc00",bold:!1},completeBack:function(){t.radioComplete()},clickCallBack:function(){t.radio&&t.radio.parentContainer&&(t.radio.clearRadioData(),t.radio.parentContainer.remove(t.radio))}})},BagGroup.prototype.radioComplete=function(){this.radio.setRadioData(["1111111111","2222222222","333333333333","444444444444"]),this.radio.x=this.bagBtn.x,this.radio.y=this.bagBtn.y-142,this.add(this.radio)},BagGroup.prototype.bagBtnOver=function(t){this.mBagSelect=this.scene.make.sprite(void 0,!1),this.mBagSelect.setTexture(this.mResStr,"bag_BtnSelect"),this.mBagBtnCon.add(this.mBagSelect)},BagGroup.prototype.bagBtnOut=function(t){this.mBagSelect&&this.mBagSelect.parentContainer&&this.mBagSelect.parentContainer.remove(this.mBagSelect)},BagGroup.SlotMaxCount=12,BagGroup}(c.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"TopMenuMediator",(function(){return p}));var n,o=i(13),a=i(166),s=i(4),h=i(3),l=i(7),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function TopMenuMediator(e,i){var n=t.call(this)||this;return n.scene=e,n.world=i,n}return c(TopMenuMediator,t),TopMenuMediator.prototype.show=function(){this.register()},TopMenuMediator.prototype.hide=function(){this.unregister()},TopMenuMediator.prototype.isSceneUI=function(){return!0},TopMenuMediator.prototype.register=function(){this.world.emitter.on(o.a.ADD_ICON_TO_TOP,this.onAddIconHandler,this),this.world.emitter.on(o.a.REMOVE_ICON_FROM_TOP,this.onAddIconHandler,this)},TopMenuMediator.prototype.unregister=function(){this.world.emitter.off(o.a.ADD_ICON_TO_TOP,this.onAddIconHandler,this),this.world.emitter.off(o.a.REMOVE_ICON_FROM_TOP,this.onRemoveIcon,this)},TopMenuMediator.prototype.destroy=function(){this.hide(),t.prototype.destroy.call(this)},TopMenuMediator.prototype.addItem=function(t){this.mView||(this.mView=new a.TopMenuContainer(this.scene,this.world),this.mView.on("saveDecorate",this.onSaveDecorateHandler,this),this.mView.on("enterDecorate",this.onEnterDecorateHandler,this),this.mView.on("showMarket",this.onShowMarketHandler,this)),this.mView.addItem(t)},TopMenuMediator.prototype.removeItem=function(t){this.mView&&this.mView.removeItem(t)},TopMenuMediator.prototype.onAddIconHandler=function(t){this.addItem(t)},TopMenuMediator.prototype.onRemoveIcon=function(t){this.removeItem(t)},TopMenuMediator.prototype.onSaveDecorateHandler=function(){var t=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_LEAVE);t.content.needSaveEditScene=!0,this.world.connection.send(t)},TopMenuMediator.prototype.onEnterDecorateHandler=function(){var t=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER);this.world.connection.send(t)},TopMenuMediator.prototype.onShowMarketHandler=function(){var t=new s.PBpacket(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_UI);t.content.name="Market",this.world.emitter.emit(o.a.SHOW_UI,t)},TopMenuMediator.NAME="TopMenuMediator",TopMenuMediator}(l.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"TopMenuContainer",(function(){return h}));var n,o=i(6),a=i(5),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function TopMenuContainer(e,i){var n=t.call(this,e,i)||this;return n.maxNum=3,n.setTween(!1),n.mButtons=[],n}return s(TopMenuContainer,t),TopMenuContainer.prototype.resize=function(){var t=this.mWorld.getSize();this.x=t.width-50*this.mWorld.uiScale,this.y=this.height/2+120*this.mWorld.uiScale,this.scale=this.dpr},TopMenuContainer.prototype.show=function(){this.mWorld&&this.mWorld.uiManager.getUILayerManager().addToUILayer(this),t.prototype.show.call(this)},TopMenuContainer.prototype.hide=function(){this.parentContainer&&this.parentContainer.remove(this)},TopMenuContainer.prototype.addItem=function(t){},TopMenuContainer.prototype.removeItem=function(t){var e=this.mButtons.findIndex((function(e){return e.name===t}));e>=0&&(this.mButtons[e].destroy(),this.mButtons.splice(e,1)),this.mButtons.length,this.maxNum,0===this.mButtons.length&&this.hide(),this.refresh()},TopMenuContainer.prototype.preload=function(){this.scene.load.atlas("baseView",a.h.getRes("ui/baseView/mainui_mobile.png"),a.h.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this)},TopMenuContainer.prototype.init=function(){this.mInitialized||(t.prototype.init.call(this),this.resize())},TopMenuContainer.prototype.refresh=function(){for(var t=0;t<this.mButtons.length;t++)this.mButtons[t].x=-(60*t+30)},TopMenuContainer.prototype.expand=function(){},TopMenuContainer.prototype.collapse=function(){},TopMenuContainer.prototype.destroy=function(){this.mButtons.map((function(t){return t.destroy()})),this.mButtons.length=0,t.prototype.destroy.call(this)},TopMenuContainer.prototype.onGameObjectUpHandler=function(t){switch(t.name){case"SaveDecorate":this.emit("saveDecorate");break;case"EnterDecorate":this.emit("enterDecorate");break;case"Market":this.emit("showMarket")}},TopMenuContainer}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"DecorateControlMediator",(function(){return p}));var n,o=i(168),a=i(4),s=i(3),h=i(13),l=i(7),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function DecorateControlMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,n&&(n.emitter.on(h.a.SELECTED_DECORATE_ELEMENT,o.onSelectedDecorateHandler,o),n.emitter.on(h.a.CANCEL_DECORATE_ELEMENT,o.onCancelDecorateHandler,o)),o}return c(DecorateControlMediator,t),DecorateControlMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.DecorateControlPanel(this.scene,this.world)),this.addActionListener(),this.mView.show(),this.layerManager.addToUILayer(this.mView))},DecorateControlMediator.prototype.destroy=function(){this.world&&(this.world.emitter.on(h.a.SELECTED_DECORATE_ELEMENT,this.onSelectedDecorateHandler,this),this.world.emitter.on(h.a.CANCEL_DECORATE_ELEMENT,this.onCancelDecorateHandler,this)),t.prototype.destroy.call(this)},DecorateControlMediator.prototype.isSceneUI=function(){return!0},DecorateControlMediator.prototype.onSelectedDecorateHandler=function(){this.mView&&this.mView.parentContainer&&this.mView.parentContainer.remove(this.mView)},DecorateControlMediator.prototype.onCancelDecorateHandler=function(){this.mView&&this.layerManager.addToUILayer(this.mView)},DecorateControlMediator.prototype.addActionListener=function(){this.mView&&(this.mView.on("exit",this.onExitHandler,this),this.mView.on("recycleAll",this.onRecycleAllHandler,this),this.mView.on("redo",this.onRedoHandler,this),this.mView.on("showFurni",this.onShowFurniHandler,this),this.mView.on("save",this.onSaveHandler,this),this.mView.on("getDoor",this.onGetDoorHandler,this))},DecorateControlMediator.prototype.onExitHandler=function(){if(this.connection){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_LEAVE);t.content.needSaveEditScene=!1,this.world.connection.send(t)}},DecorateControlMediator.prototype.onRecycleAllHandler=function(){if(this.connection){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_RECYCLE_ALL);this.world.connection.send(t)}},DecorateControlMediator.prototype.onRedoHandler=function(){if(this.connection){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_RECYCLE_LAST_SPRITE);this.connection.send(t)}},DecorateControlMediator.prototype.onShowFurniHandler=function(){var t=this.world.uiManager;t&&t.showMed("FurniBag")},DecorateControlMediator.prototype.onSaveHandler=function(){if(this.connection){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_LEAVE);t.content.needSaveEditScene=!0,this.connection.send(t)}},DecorateControlMediator.prototype.onGetDoorHandler=function(){if(this.connection){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_SPAWN_POINT);this.connection.send(t)}},Object.defineProperty(DecorateControlMediator.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),DecorateControlMediator.NAME="DecorateControlMediator",DecorateControlMediator}(l.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"DecorateControlPanel",(function(){return s}));var n,o=i(6),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function DecorateControlPanel(e,i){var n=t.call(this,e,i)||this;return n.key="decorateControl",n}return a(DecorateControlPanel,t),DecorateControlPanel.prototype.addListen=function(){this.mInitialized&&(this.mExitBtn.on("pointerup",this.onExitHandler,this),this.mRecycleAllBtn.on("pointerup",this.onRecycleAllHandler,this),this.mRedoBtn.on("pointerup",this.onRedoHandler,this),this.mFurniBtn.on("pointerup",this.onShowFurniHandler,this),this.mSaveBtn.on("pointerup",this.onSaveHandler,this),this.mDoorBtn.on("pointerup",this.onGetDoorHandler,this))},DecorateControlPanel.prototype.removeListen=function(){this.mInitialized&&(this.mExitBtn.off("pointerup",this.onExitHandler,this),this.mRecycleAllBtn.off("pointerup",this.onRecycleAllHandler,this),this.mRedoBtn.off("pointerup",this.onRedoHandler,this),this.mFurniBtn.off("pointerup",this.onShowFurniHandler,this),this.mSaveBtn.off("pointerup",this.onSaveHandler,this),this.mDoorBtn.off("pointerup",this.onGetDoorHandler,this))},DecorateControlPanel.prototype.resize=function(e,i){this.setSize(e,131*this.dpr),this.mBackground.clear(),this.mBackground.fillStyle(0,.6),this.mBackground.fillRect(0,0,this.width,this.height),t.prototype.resize.call(this,e,i)},DecorateControlPanel.prototype.preload=function(){this.addAtlas(this.key,"decorate_control/decorate_control.png","decorate_control/decorate_control.json"),t.prototype.preload.call(this)},DecorateControlPanel.prototype.init=function(){var e=this.scene.cameras.main.width,i=this.scene.cameras.main.height;this.mBackground=this.scene.make.graphics(void 0,!1),this.mTopBtns=[],this.mExitBtn=this.scene.make.image({key:this.key,frame:"exitBtn.png"},!1).setOrigin(0).setInteractive(),this.mRecycleAllBtn=this.scene.make.image({key:this.key,frame:"recycleAllBtn.png"},!1).setOrigin(0).setInteractive(),this.mRedoBtn=this.scene.make.image({key:this.key,frame:"redoBtn.png"},!1).setOrigin(0).setInteractive(),this.mFurniBtn=this.scene.make.image({key:this.key,frame:"furniBtn.png"},!1).setOrigin(0).setInteractive(),this.mSaveBtn=this.scene.make.image({key:this.key,frame:"saveBtn.png"},!1).setOrigin(0).setInteractive(),this.mDoorBtn=this.scene.make.image({x:10*this.dpr,y:83*this.dpr,key:this.key,frame:"doorBtn.png"},!1).setOrigin(0).setInteractive(),this.mStairBtn=this.scene.make.image({x:64*this.dpr,y:83*this.dpr,key:this.key,frame:"stairBtn.png"},!1).setOrigin(0),this.mTopBtns=[this.mExitBtn,this.mRecycleAllBtn,this.mRedoBtn,this.mFurniBtn,this.mSaveBtn],this.add(this.mBackground),this.add(this.mTopBtns),this.add([this.mDoorBtn,this.mStairBtn]);var n=this.mWorld.uiScale,o=e-20*this.dpr*n;this.mTopBtns.map((function(t){return o-=t.width*n}));for(var a=o/(this.mTopBtns.length-1)/n,s=0;s<this.mTopBtns.length;s++)this.mTopBtns[s].x=s>0?a+this.mTopBtns[s-1].width+this.mTopBtns[s-1].x:10*this.dpr,this.mTopBtns[s].y=11*this.dpr;this.resize(e,i),t.prototype.init.call(this)},DecorateControlPanel.prototype.onExitHandler=function(){this.emit("exit")},DecorateControlPanel.prototype.onRecycleAllHandler=function(){this.emit("recycleAll")},DecorateControlPanel.prototype.onRedoHandler=function(){this.emit("redo")},DecorateControlPanel.prototype.onShowFurniHandler=function(){this.emit("showFurni")},DecorateControlPanel.prototype.onSaveHandler=function(){this.emit("save")},DecorateControlPanel.prototype.onGetDoorHandler=function(){this.emit("getDoor")},DecorateControlPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMainUIMediator",(function(){return l}));var n,o=i(170),a=i(7),s=i(171),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicaMainUIMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,o.mainUI=new s.PicaMainUI(n),o.mainUI.on("update",o.onUpdateHandler,o),o}return h(PicaMainUIMediator,t),PicaMainUIMediator.prototype.show=function(t){this.mView?this.update(t):(this.mView||(this.mView=new o.PicaMainUIPanel(this.scene,this.world)),this.mView.show(t),this.mView.on("enterEdit",this.onEnterEditSceneHandler,this),this.layerManager.addToUILayer(this.mView))},PicaMainUIMediator.prototype.destroy=function(){this.mainUI&&this.mainUI.destroy(),t.prototype.destroy.call(this)},PicaMainUIMediator.prototype.onEnterEditSceneHandler=function(){this.mainUI&&this.mainUI.sendEnterDecorate()},PicaMainUIMediator.prototype.onUpdateHandler=function(t){this.show(t)},PicaMainUIMediator.NAME="PicaMainUIMediator",PicaMainUIMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMainUIPanel",(function(){return c}));var n,o=i(6),a=i(9),s=i(12),h=i(8),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicaMainUIPanel(e,i){var n=t.call(this,e,i)||this;return n.key="main_ui",n}return l(PicaMainUIPanel,t),PicaMainUIPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&(this.setInteractive(),this.update(e))},PicaMainUIPanel.prototype.resize=function(e,i){var n=this.scene.cameras.main.width/this.scale,o=this.scene.cameras.main.height/this.scale;t.prototype.resize.call(this,n,o),this.mCoinValue.x=n-this.mCoinValue.width/2-5*this.dpr,this.mDiamondValue.x=n-this.mDiamondValue.width/2-5*this.dpr},PicaMainUIPanel.prototype.preload=function(){this.addAtlas(this.key,"main_ui/main_ui.png","main_ui/main_ui.json"),t.prototype.preload.call(this)},PicaMainUIPanel.prototype.addListen=function(){this.mInitialized&&(this.mSceneName?this.mSceneName.on("pointerup",this.onEnterEditScene,this):h.a.getInstance().fatal(PicaMainUIPanel.name+": sceneName does not exist!"))},PicaMainUIPanel.prototype.removeListen=function(){this.mInitialized&&(this.mSceneName?this.mSceneName.off("pointerup",this.onEnterEditScene,this):h.a.getInstance().fatal(PicaMainUIPanel.name+": sceneName does not exist!"))},PicaMainUIPanel.prototype.update=function(e){if(Object.assign(this.mShowData,e),t.prototype.update.call(this,this.mShowData),e&&this.mInitialized){if(e.hasOwnProperty("level")&&this.mExpProgress.setLv(e.level),e.hasOwnProperty("coin")&&this.mCoinValue.setText(e.coin.toString()),e.hasOwnProperty("diamond")&&this.mDiamondValue.setText(e.diamond.toString()),e.hasOwnProperty("energy")){var i=e.energy;i?this.mStrengthValue.setValue(i.currentValue,i.max):this.mStrengthValue.setValue(0,100)}if(e.hasOwnProperty("name")){this.mSceneName.setText(e.name);var n=this.mSceneName.getBounds();this.mSceneName.setSize(n.width,n.height),this.mSceneName.setInteractive(new Phaser.Geom.Rectangle(this.mSceneName.width/2,this.mSceneName.height/2,this.mSceneName.width,this.mSceneName.height),Phaser.Geom.Rectangle.Contains)}e.hasOwnProperty("ownerName")&&this.mSceneType.setText(e.ownerName),e.hasOwnProperty("playerCount")&&this.mCounter.setText(e.playerCount+"人")}},PicaMainUIPanel.prototype.init=function(){var e=this.scene.cameras.main.width,i=this.scene.cameras.main.height;this.mCoinValue=new p(this.scene,this.key,"coin",this.dpr),this.mCoinValue.y=28*this.dpr,this.mDiamondValue=new p(this.scene,this.key,"diamond",this.dpr),this.mDiamondValue.y=68*this.dpr,this.mSceneName=new m(this.scene,this.key,"room_icon","setting_icon",this.dpr),this.mSceneName.setText(""),this.mSceneName.x=15*this.dpr,this.mSceneName.y=55*this.dpr,this.mSceneType=new u(this.scene,this.key,"star_icon",this.dpr),this.mSceneType.setText(""),this.mSceneType.x=15*this.dpr,this.mSceneType.y=80*this.dpr,this.mSceneType.setColor("#FFFF00"),this.mCounter=new u(this.scene,this.key,"counter_icon",this.dpr),this.mCounter.setText("1人"),this.mCounter.x=15*this.dpr,this.mCounter.y=105*this.dpr,this.mCounter.setColor("#27f6ff"),this.add([this.mCoinValue,this.mDiamondValue,this.mSceneName,this.mSceneType,this.mCounter]);var n=this.scene.textures.getFrame(this.key,"strength_progress");this.mStrengthValue=new f(this.scene,this.key,"strength_icon",this.dpr),this.mStrengthValue.x=50*this.dpr,this.mStrengthValue.y=27*this.dpr;var o=new s.NinePatch(this.scene,60*this.dpr/2,this.mStrengthValue.height/2-n.height-1*this.dpr,62*this.dpr,n.height,this.key,"strength_progress",{left:8*this.dpr,top:3*this.dpr,right:n.width-2-8*this.dpr,bottom:n.height-1-3*this.dpr});this.mStrengthValue.setProgress(o,this.scale),this.add(this.mStrengthValue),this.mStrengthValue.setValue(1e3,1e3),this.mExpProgress=new d(this.scene,this.key,this.dpr,this.scale,this.mWorld),this.add(this.mExpProgress),this.resize(e,i),t.prototype.init.call(this)},PicaMainUIPanel.prototype.onEnterEditScene=function(){this.emit("enterEdit")},PicaMainUIPanel}(o.BasePanel),p=function(t){function ValueContainer(e,i,n,o){void 0===o&&(o=1);var a=t.call(this,e)||this;return a.init(i,n,o),a}return l(ValueContainer,t),ValueContainer.prototype.setText=function(t){this.mText.setText(t)},ValueContainer.prototype.init=function(t,e,i){var n=this.scene.make.image({key:t,frame:"price_bg"},!1),o=this.scene.make.image({key:t,frame:e},!1);this.mText=this.scene.make.text({text:"0",width:n.width,height:n.height,style:{fontSize:14*i,fontFamily:a.a.DEFULT_FONT}},!1).setOrigin(1,0),this.mText.setStroke("#000000",1*i),this.mAddBtn=this.scene.make.image({key:t,frame:"add_btn"}),this.setSize(n.width,n.height),o.x=-this.width*this.originX+10*i,this.mAddBtn.x=this.width*this.originX-this.mAddBtn.width*this.originX,this.mAddBtn.y=(this.height-this.mAddBtn.height)/2+2*i,this.mText.x=this.width/2-30*i,this.mText.y=-(this.height-12*i)/2,this.add([n,o,this.mText,this.mAddBtn])},ValueContainer}(Phaser.GameObjects.Container),u=function(t){function IconText(e,i,n,o){void 0===o&&(o=1);var s=t.call(this,e)||this,h=e.make.image({key:i,frame:n},!1);return s.mText=e.make.text({style:{fontSize:16*o,fontFamily:a.a.DEFULT_FONT}},!1).setOrigin(0,.5),s.mText.x=h.width/2+8*o,s.mText.setStroke("#000000",2*o),s.add([h,s.mText]),s}return l(IconText,t),IconText.prototype.setText=function(t){this.mText.setText(t)},IconText.prototype.setStroke=function(t,e){this.mText.setStroke(t,e)},IconText.prototype.setColor=function(t){this.mText.setColor(t)},IconText}(Phaser.GameObjects.Container),m=function(t){function SceneName(e,i,n,o,a){void 0===a&&(a=1);var s=t.call(this,e,i,n,a)||this;return s.mDpr=a,s.mRightIcon=e.make.image({y:2*a,key:i,frame:o},!1),s.add(s.mRightIcon),s}return l(SceneName,t),SceneName.prototype.setText=function(e){t.prototype.setText.call(this,e),this.mRightIcon.x=this.mText.x+this.mText.width+this.mRightIcon.width/2+2*this.mDpr},SceneName}(u),d=function(t){function ExpProgress(e,i,n,o,h){var l=t.call(this,e)||this,c=h.getSize().width/o,p=l.scene.textures.getFrame(i,"exp_bg");l.setSize(c,p.height);var u=l.width,m=l.height;l.mProgressBar=new y(e,n),l.mProgressBar.setSize(l.width,l.height);var d=new s.NinePatch(l.scene,u/2,m/2,u,m,i,"exp_bg",{left:8*n,top:3*n,right:p.width-2-8*n,bottom:p.height-1-3*n});l.mProgressBar.setBackground(d),p=l.scene.textures.getFrame(i,"exp_progress");var f=new s.NinePatch(l.scene,u/2,m/2,c,p.height,i,"exp_progress",{left:8*n,top:3*n,right:p.width-2-10*n,bottom:p.height-1-5*n});return l.mProgressBar.setProgress(f,l.x,l.y,o),l.mProgressBar.setRatio(.5),l.mCurrentLv=e.make.text({text:"Lv. 57",style:{fontSize:10*n,fontFamily:a.a.DEFULT_FONT}},!1),l.mCurrentLv.setStroke("#000000",1*n),l.mNextLv=e.make.text({text:"Lv. 58",style:{fontSize:10*n,fontFamily:a.a.DEFULT_FONT}},!1).setOrigin(0,0),l.mNextLv.setStroke("#000000",1*n),l.mNextLv.x=l.width-l.mNextLv.width,l.add([l.mProgressBar,l.mCurrentLv,l.mNextLv]),l}return l(ExpProgress,t),ExpProgress.prototype.setLv=function(t){this.mCurrentLv.setText(t.toString()),this.mNextLv.setText((t+1).toString()),this.mNextLv.x=this.width-this.mNextLv.width},ExpProgress}(Phaser.GameObjects.Container),f=function(t){function ProgressValue(e,i,n,o){return t.call(this,e,i,n,o)||this}return l(ProgressValue,t),ProgressValue.prototype.setProgress=function(t,e){this.mProgress.setProgress(t,this.x+this.mProgress.x,this.y+this.mProgress.y,e)},ProgressValue.prototype.setValue=function(t,e){this.mText&&(this.mText.text=t.toString(),this.mProgress.setRatio(t/e))},ProgressValue.prototype.init=function(t,e,i){var n=this.scene.make.image({key:t,frame:"strength_bg"},!1);this.setSize(n.width,n.height);var o=this.scene.make.image({key:t,frame:e},!1);this.mProgress=new y(this.scene,i),this.mProgress.x=-this.width/2+10*i,this.mProgress.y=4*i,this.mText=this.scene.make.text({text:"0",width:n.width,height:n.height,style:{fontSize:10*i,fontFamily:a.a.DEFULT_FONT}},!1).setOrigin(.5),this.mText.setStroke("#000000",1*i),this.mAddBtn=this.scene.make.image({key:t,frame:"add_btn"}),this.setSize(n.width,n.height),o.x=-this.width*this.originX+10*i,this.mAddBtn.x=this.width*this.originX-10*i,this.mAddBtn.y=6*i,this.mText.y=(this.height-this.mText.height)/2,this.add([n,this.mProgress,o,this.mText,this.mAddBtn])},ProgressValue}(p),y=function(t){function ProgressBar(e,i){var n=t.call(this,e)||this;return n.offsetX=0,n.offsetY=0,n.dpr=i,n}return l(ProgressBar,t),ProgressBar.prototype.setBackground=function(t){this.addAt(t,0)},ProgressBar.prototype.setProgress=function(t,e,i,n){this.offsetX=e,this.offsetY=i,this.mScale=n,this.mProgress=t,this.setSize(t.width*this.mScale,t.height*this.mScale),this.mMaskGraphics=this.scene.make.graphics(void 0,!1),this.mMaskGraphics.fillStyle(16750848),this.mMaskGraphics.fillRoundedRect(0,t.y*this.mScale-t.height*this.mScale/2,this.width,t.height,10),this.add(this.mProgress),this.mProgress.mask=new Phaser.Display.Masks.GeometryMask(this.scene,this.mMaskGraphics),this.mMaskGraphics.x=e*n,this.mMaskGraphics.y=i*n},ProgressBar.prototype.setRatio=function(t){this.mMaskGraphics&&(this.mMaskGraphics.x=this.width*t-this.width+this.offsetX)},ProgressBar}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMainUI",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicaMainUI(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i.register(),i}return s(PicaMainUI,t),PicaMainUI.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicaMainUI.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicaMainUI.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_PKT_PLAYER_INFO,this.onUpdatePlayerInfo),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ROOM_INFO,this.onUpdateModeRoomInfo))},PicaMainUI.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicaMainUI.prototype.sendEnterDecorate=function(){this.connection&&this.connection.send(new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER))},PicaMainUI.prototype.destroy=function(){this.unregister()},PicaMainUI.prototype.onUpdatePlayerInfo=function(t){this.mEvent.emit("update",t.content)},PicaMainUI.prototype.onUpdateModeRoomInfo=function(t){this.mEvent.emit("update",t.content)},Object.defineProperty(PicaMainUI.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicaMainUI}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ActivityMediator",(function(){return l}));var n,o=i(173),a=i(18),s=i(7),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ActivityMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.mUIType=a.a.Scene,o.world=n,o}return h(ActivityMediator,t),ActivityMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.ActivityPanel(this.scene,this.world)),this.mView.show(),this.layerManager.addToUILayer(this.mView))},ActivityMediator.prototype.isSceneUI=function(){return!0},ActivityMediator.NAME="ActivityMediator",ActivityMediator}(s.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ActivityPanel",(function(){return s}));var n,o=i(6),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function ActivityPanel(e,i){var n=t.call(this,e,i)||this;return n.key="activity",n}return a(ActivityPanel,t),ActivityPanel.prototype.resize=function(t,e){var i=this.scaleWidth;this.scaleHeight;this.content.x=i-20*this.dpr,this.content.y=120*this.dpr,this.setSize(t,e)},ActivityPanel.prototype.show=function(e){this.mInitialized&&this.setInteractive(),t.prototype.show.call(this,e)},ActivityPanel.prototype.preload=function(){this.addAtlas(this.key,"activity/activity.png","activity/activity.json"),t.prototype.preload.call(this)},ActivityPanel.prototype.init=function(){this.content=this.scene.make.container(void 0,!1),this.add(this.content);for(var e=0;e<4;e++){var i=this.scene.make.image({key:this.key,frame:"icon_"+(e+1)},!1);this.content.add(i)}var n=160*this.dpr,o=this.content.list;o.map((function(t){return n-=t.height}));var a=n/(o.length-1),s=15*this.dpr,h=0,l=0;for(e=1;e<o.length;e++){var c=o[e-1],p=o[e];p.y=c.height+c.y+a+s,l+=p.y,h=p.width}this.resize(h,l),t.prototype.init.call(this)},ActivityPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaChatPanel",(function(){return p}));var n,o=i(6),a=i(33),s=i(21),h=i(9),l=i(99),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function PicaChatPanel(e,i){var n=t.call(this,e,i)||this;return n.key="pica_chat",n.MAX_HEIGHT=460*n.dpr,n.MIN_HEIGHT=100*n.dpr,n.scale=1,n}return c(PicaChatPanel,t),PicaChatPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},PicaChatPanel.prototype.resize=function(e,i){this.setSize(e,i);var n=this.scale,o=this.scene.cameras.main.width,a=this.scene.cameras.main.height,s=o/this.scene.textures.getFrame(this.key,"title_bg.png").width;this.mTitleBg.scaleX=s,this.mTitleBg.x=o/2,this.y=a-this.height,this.mBackground.clear(),this.mBackground.fillStyle(0,.6),this.mBackground.fillRect(0,0,o,i),this.mNavigateBtn.x=o-this.mNavigateBtn.width/2-2*this.dpr*n,this.mNavigateBtn.y=this.height-this.mNavigateBtn.height/2-5*this.dpr*n,this.mScrollBtn.x=o-this.mScrollBtn.width/2-2*this.dpr*n,this.mTextArea.childrenMap.child.setMinSize(e,(i-16*this.dpr)*n),this.mTextArea.layout(),this.mTextArea.setPosition(this.width/2+4*this.dpr,this.y+this.mTextArea.height/2+10*this.dpr*n),this.mTextArea.childrenMap.text.y=8*this.dpr,this.mTextArea.scrollToBottom(),t.prototype.resize.call(this,e,i)},PicaChatPanel.prototype.appendChat=function(t){this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom())},PicaChatPanel.prototype.hide=function(){this.mShow=!1},PicaChatPanel.prototype.addListen=function(){this.mInitialized&&this.interactiveBoo&&(this.mChatBtn.setInteractive(),this.mEmojiBtn.setInteractive(),this.mScrollBtn.setInteractive(),this.mNavigateBtn.setInteractive(),this.mTextArea.childrenMap.child.setInteractive(),this.mScrollBtn.on("drag",this.onDragHandler,this),this.scene.input.setDraggable(this.mScrollBtn,!0),this.mNavigateBtn.on("pointerup",this.onShowNavigateHandler,this),this.mChatBtn.on("pointerup",this.onShowInputHanldler,this))},PicaChatPanel.prototype.removeListen=function(){this.mInitialized&&(this.mBackground.disableInteractive(),this.mChatBtn.disableInteractive(),this.mEmojiBtn.disableInteractive(),this.mScrollBtn.disableInteractive(),this.mNavigateBtn.disableInteractive(),this.mTextArea.childrenMap.child.disableInteractive(),this.mScrollBtn.off("drag",this.onDragHandler,this),this.mNavigateBtn.off("pointerup",this.onShowNavigateHandler,this),this.mChatBtn.off("pointerup",this.onShowInputHanldler,this))},PicaChatPanel.prototype.preload=function(){this.addAtlas(this.key,"pica_chat/pica_chat.png","pica_chat/pica_chat.json"),t.prototype.preload.call(this)},PicaChatPanel.prototype.init=function(){var e=this.scene.cameras.main.width;this.scene.cameras.main.height;this.mBackground=this.scene.make.graphics(void 0,!1);var i=this.scale;this.setSize(e,135*this.dpr),this.mTileContainer=this.scene.make.container(void 0,!1),this.mScrollBtn=this.scene.make.image({key:this.key,frame:"scroll_btn.png"},!1).setScale(i),this.mTitleBg=this.scene.make.image({key:this.key,frame:"title_bg.png"},!1).setScale(i),this.mTitleBg.texture.setFilter(Phaser.Textures.FilterMode.NEAREST),this.mChatBtn=this.scene.make.image({x:33*this.dpr*i,key:this.key,frame:"chat_icon.png"},!1).setScale(i),this.mHornBtn=this.scene.make.image({x:96*this.dpr*i,key:this.key,frame:"horn_icon.png"},!1).setScale(i),this.mEmojiBtn=this.scene.make.image({x:155*this.dpr*i,key:this.key,frame:"emoji.png"},!1).setScale(i),this.mChatBtn.y=-this.mChatBtn.height/2+this.mTitleBg.height,this.mHornBtn.y=-this.mHornBtn.height/2+this.mTitleBg.height,this.mEmojiBtn.y=-this.mEmojiBtn.height/2+this.mTitleBg.height,this.mOutputText=new s.a(this.mScene,0,0,"",{fontSize:14*this.dpr/i+"px",fontFamily:h.a.DEFULT_FONT,stroke:"#000000",strokeThickness:1*this.dpr*i,textMask:!1,shadow:{offsetX:0,offsetY:0,color:"#000",blur:4,stroke:!0,fill:!0},wrap:{mode:"char",width:e-12*this.dpr*i}});var n=this.scene.make.graphics(void 0,!1);this.mTextArea=new a.a(this.mScene,{x:e/2+4*this.dpr*i,y:160*this.dpr*i,textWidth:e-4*this.dpr*i,textHeight:this.MAX_HEIGHT,text:this.mOutputText}).layout(),this.mNavigateBtn=this.scene.make.image({key:this.key,frame:"more_btn.png"},!1).setScale(i),this.mTileContainer.add([this.mTitleBg,this.mChatBtn,this.mHornBtn,this.mEmojiBtn,this.mScrollBtn]),this.add([this.mBackground,this.mTileContainer,this.mTextArea,this.mOutputText,n,this.mNavigateBtn]),this.mTextArea.setSliderEnable(!1),this.resize(this.width,400),t.prototype.init.call(this),this.removeInteractive(),this.appendChat("小盆友[color=yellow]进入房间[/color]\n"),this.appendChat("一直狐狸[color=yellow]离开房间[/color]\n"),this.appendChat("[color=#ffffff][当前]小盆友：玩家注册后，账户等级为Lv1级。[/color]\n"),this.appendChat("[color=#66ffff][喇叭]。用户在游戏内游玩时，使用该道具，经验值收益为4倍增长，时间上限为4h[/color]\n"),this.appendChat("[color=#ffff00]等级提升为6级[/color]\n")},PicaChatPanel.prototype.onDragHandler=function(t,e,i){var n=this.height+(t.prevPosition.y-t.position.y);n>this.MAX_HEIGHT||n<this.MIN_HEIGHT||this.resize(this.width,n)},PicaChatPanel.prototype.onShowNavigateHandler=function(){this.emit("showNavigate")},PicaChatPanel.prototype.onShowInputHanldler=function(){this.mInputText||(this.mInputText=new l.InputPanel(this.scene,this.mWorld),this.mInputText.once("close",this.sendChat,this))},PicaChatPanel.prototype.sendChat=function(t){this.mInputText=void 0,t&&this.emit("chat",t)},PicaChatPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNavigatePanel",(function(){return s}));var n,o=i(6),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function PicaNavigatePanel(e,i){var n=t.call(this,e,i)||this;return n.key="pica_navigate",n.setTween(!1),n.setInteractive(),n}return a(PicaNavigatePanel,t),PicaNavigatePanel.prototype.resize=function(e,i){this.setSize(e,i);var n=this.scale,o=this.scene.cameras.main.width/n,a=this.scene.cameras.main.height,s=o/this.scene.textures.getFrame(this.key,"bg").width*this.dpr;this.mBackground.scaleX=s,this.mBackground.x=o/2,this.mBackground.setInteractive(),this.mCloseBtn.x=o-this.mCloseBtn.width/2-3*this.dpr,this.y=a-this.height/2,t.prototype.resize.call(this,e,i)},PicaNavigatePanel.prototype.addListen=function(){this.mInitialized&&this.interactiveBoo&&(this.mMapBtn.on("pointerup",this.onShowMapHandler,this),this.mShopBtn.on("pointerup",this.onShowShopHandler,this),this.mBagBtn.on("pointerup",this.onShowBagHandler,this),this.mFamilyBtn.on("pointerup",this.onShowFamilyHandler,this),this.mGoHomeBtn.on("pointerup",this.onShowGoHomeHandler,this),this.mPlayerBtn.on("pointerup",this.onShowPlayerHandler,this),this.mCloseBtn.on("pointerup",this.onCloseHandler,this))},PicaNavigatePanel.prototype.removeListen=function(){this.mInitialized&&(this.mMapBtn.off("pointerup",this.onShowMapHandler,this),this.mShopBtn.off("pointerup",this.onShowShopHandler,this),this.mBagBtn.off("pointerup",this.onShowBagHandler,this),this.mFamilyBtn.off("pointerup",this.onShowFamilyHandler,this),this.mGoHomeBtn.on("pointerup",this.onShowGoHomeHandler,this),this.mPlayerBtn.on("pointerup",this.onShowPlayerHandler,this),this.mCloseBtn.off("pointerup",this.onCloseHandler,this))},PicaNavigatePanel.prototype.hide=function(){this.mShow=!1},PicaNavigatePanel.prototype.preload=function(){this.addAtlas(this.key,"pica_navigate/pica_navigate.png","pica_navigate/pica_navigate.json"),t.prototype.preload.call(this)},PicaNavigatePanel.prototype.init=function(){this.mBackground=this.createImage(this.key,"bg"),this.mBackground.texture.setFilter(Phaser.Textures.FilterMode.NEAREST),this.mMapBtn=this.createImage(this.key,"map_btn").setInteractive(),this.mShopBtn=this.createImage(this.key,"shop_btn").setInteractive(),this.mBagBtn=this.createImage(this.key,"bag_btn").setInteractive(),this.mFamilyBtn=this.createImage(this.key,"family_btn").setInteractive(),this.mGoHomeBtn=this.createImage(this.key,"home_btn").setInteractive(),this.mPlayerBtn=this.createImage(this.key,"family_btn").setInteractive(),this.mCloseBtn=this.createImage(this.key,"close_btn").setInteractive();var e=[this.mMapBtn,this.mMapBtn,this.mShopBtn,this.mBagBtn,this.mFamilyBtn,this.mGoHomeBtn,this.mPlayerBtn];this.add([this.mBackground]),this.add(e),this.add(this.mCloseBtn);for(var i=0;i<e.length;i++)e[i].x=50*i*this.dpr-e[i].width/2;var n=this.scale;this.resize(this.mBackground.width*n,this.mBackground.height*n),t.prototype.init.call(this)},PicaNavigatePanel.prototype.createImage=function(t,e){return this.scene.make.image({key:t,frame:e},!1)},PicaNavigatePanel.prototype.onShowMapHandler=function(){this.emit("showPanel","PicaRoomList")},PicaNavigatePanel.prototype.onShowShopHandler=function(){this.emit("showPanel","Market")},PicaNavigatePanel.prototype.onShowBagHandler=function(){this.emit("showPanel","FurniBag")},PicaNavigatePanel.prototype.onShowFamilyHandler=function(){this.emit("showPanel","CharacterInfo")},PicaNavigatePanel.prototype.onShowGoHomeHandler=function(){this.emit("showPanel","")},PicaNavigatePanel.prototype.onShowPlayerHandler=function(){},PicaNavigatePanel.prototype.onCloseHandler=function(){this.emit("close")},PicaNavigatePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaChat",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicaChat(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(PicaChat,t),PicaChat.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,this.handleCharacterChat))},PicaChat.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},PicaChat.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},PicaChat.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},PicaChat.prototype.sendMessage=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_GATEWAY_REQ_VIRTUAL_WORLD_CHAT),i=e.content;i.chatChannel=0,i.chatContext=t,this.connection.send(e)},PicaChat.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},PicaChat.prototype.handleCharacterChat=function(t){this.mEvent.emit("chat",t.content)},Object.defineProperty(PicaChat.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),PicaChat}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineCarMediator",(function(){return l}));var n,o=i(178),a=i(182),s=i(7),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function MineCarMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,o.mMineCar=new a.MineCar(n),o.mMineCar.register(),o.mMineCar.on("query",o.onQueryHandler,o),o}return h(MineCarMediator,t),MineCarMediator.prototype.show=function(e){this.mShow||(t.prototype.show.call(this,e),this.mView||(this.mView=new o.MineCarPanel(this.scene,this.world)),this.mView.show(e),this.mView.on("close",this.onCloseHandler,this),this.mView.on("discard",this.onDiscardHandler,this),this.layerManager.addToUILayer(this.mView))},MineCarMediator.prototype.update=function(e){this.mView?t.prototype.update.call(this,e):this.show(e)},MineCarMediator.prototype.destroy=function(){this.mShow=!1,this.mMineCar&&(this.mMineCar.off("query",this.onQueryHandler,this),this.mMineCar.unregister(),this.mMineCar.destroy(),this.mMineCar=null),t.prototype.destroy.call(this)},MineCarMediator.prototype.onQueryHandler=function(t){this.update(t)},MineCarMediator.prototype.onDiscardHandler=function(t){this.mMineCar&&this.mMineCar.discard(t)},MineCarMediator.prototype.onCloseHandler=function(){this.mView&&(this.mView.hide(),this.mView=void 0),this.mShow=!1},MineCarMediator}(s.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineCarPanel",(function(){return f}));var n,o,a=i(9),s=i(16),h=i(6),l=i(5),c=i(179),p=i(42),u=i(25),m=i(101),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function MineCarPanel(e,i){var n=t.call(this,e,i)||this;return n.key="mine_car",n.scale=1,n.disInteractive(),n}return d(MineCarPanel,t),MineCarPanel.prototype.resize=function(e,i){var n=this.scene.cameras.main.width/this.scale,o=this.scene.cameras.main.height/this.scale;t.prototype.resize.call(this,e,i);var a=this.mWorld.uiScale;this.setSize(n,o),this.mBg.x=n/2,this.mBg.y=this.mBg.displayHeight/2+107*this.dpr*a,this.carIcon.x=this.mBg.x/2-4*this.dpr*a,this.carIcon.y=this.mBg.y-(this.mBg.displayHeight-this.carIcon.displayHeight)/2+4*this.dpr*a,this.mCloseBtn.x=this.mBg.x+this.mBg.displayWidth/2,this.mCloseBtn.y=this.mBg.y-(this.mBg.displayHeight-this.mCloseBtn.displayHeight)/2+10*this.dpr*a,this.mCounter.x=this.mBg.x/2,this.mCounter.y=this.mBg.y+(this.mBg.displayHeight-this.mDiscardBtn.displayHeight)/2-16*this.dpr*a,this.mTips.x=this.mBg.x+20*this.dpr*a,this.mTips.y=this.mBg.y-this.mBg.displayHeight/2-15*this.dpr*a,this.mDiscardBtn.x=this.mBg.x+this.mBg.displayWidth/2-this.mDiscardBtn.displayWidth/2-9*this.dpr*a,this.mDiscardBtn.y=this.mBg.y+this.mBg.displayHeight/2-this.mDiscardBtn.displayHeight/2-9*this.dpr*a,this.categoriesBg.x=this.mBg.x,this.categoriesBg.y=this.mBg.y-this.mBg.displayHeight/2+this.categoriesBg.displayHeight/2+38*this.dpr*a,this.mPropGrid.refreshPos(this.mBg.x+2*this.dpr*a,this.mBg.y+6*this.dpr*a),this.mCategoryTable.refreshPos(this.mBg.x,this.mBg.y-this.mBg.displayHeight/2+this.categoriesBg.displayHeight/2+44*this.dpr*a)},MineCarPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.mInitialized&&!this.mPreLoad&&this.refreshData()},MineCarPanel.prototype.update=function(e){t.prototype.update.call(this,e),this.mInitialized&&this.mShow&&this.refreshData()},MineCarPanel.prototype.setCategories=function(t){this.mPreSelectedCategorie=void 0,this.mCategoryTable.setItems(t)},MineCarPanel.prototype.addListen=function(){this.mInitialized&&(this.removeListen(),this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.mDiscardBtn.on("Tap",this.enterDiscardMode,this))},MineCarPanel.prototype.removeListen=function(){this.mInitialized&&(this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.mDiscardBtn.off("Tap",this.enterDiscardMode,this))},MineCarPanel.prototype.setProp=function(){},MineCarPanel.prototype.destroy=function(){this.mPropGrid&&this.mPropGrid.destroy(),this.mCategoryTable&&this.mCategoryTable.destroy(),t.prototype.destroy.call(this)},MineCarPanel.prototype.preload=function(){this.addAtlas(this.key,"mine_car/mine_car.png","mine_car/mine_car.json"),t.prototype.preload.call(this)},MineCarPanel.prototype.init=function(){var e=this,i=this.scene.cameras.main.width/this.scale,n=this.scene.cameras.main.height/this.scale;this.setSize(i,n);var s=this.mWorld.uiScale;this.mBg=this.scene.make.image({key:this.key,frame:"bg.png"}).setScale(s),this.mBg.x=i/2,this.mBg.y=n/2,this.carIcon=this.scene.make.image({key:this.key,frame:"car_icon.png"},!1).setScale(s),this.carIcon.x=-(this.mBg.width-this.carIcon.width)*s/2+28*this.dpr*s,this.carIcon.y=-(this.mBg.height-this.carIcon.height/2)*s/2+10*this.dpr*s,this.mCloseBtn=this.scene.make.image({key:this.key,frame:"close_btn.png"},!1).setScale(s),this.mCloseBtn.setInteractive(),this.mCloseBtn.x=this.mBg.width*s/2,this.mCloseBtn.y=-(this.mBg.height-this.mCloseBtn.height)*s/2+10*this.dpr*s,this.mCounter=this.scene.make.text({text:"25/50",style:{fontFamily:a.a.DEFULT_FONT,color:"#FFFFFF",fontSize:12*this.dpr*s}},!1),this.mCounter.x=-this.displayWidth/2+17*this.dpr*s,this.mCounter.y=this.displayHeight/2-18*this.dpr*s-this.mCounter.height,this.mCounter.setFontStyle("bold"),this.mTips=new g(this.scene,this.key,this.dpr,s),this.mTips.scale=s,this.mTips.x=40*this.dpr*s,this.mTips.y=-(this.mBg.height+this.mTips.height)*s/2+15*this.dpr*s,this.mDiscardBtn=new _(this.scene,this.key,"yellow_btn.png",void 0,"丢弃"),this.mDiscardBtn.setScale(s),this.mDiscardBtn.x=(this.mBg.width-this.mDiscardBtn.displayWidth)*s/2-17*this.dpr*s,this.mDiscardBtn.y=(this.mBg.height-this.mDiscardBtn.displayHeight)*s/2-10*this.dpr*s,this.mDiscardBtn.setTextStyle({color:"##996600",fontFamily:a.a.DEFULT_FONT,fontSize:10*this.dpr*s}),this.mDiscardBtn.changeState(o.Discard),this.categoriesBg=this.scene.make.image({key:this.key,frame:"nav_bg.png"}).setScale(s),this.categoriesBg.y=-(this.displayHeight-this.categoriesBg.displayHeight)/2+36*this.dpr*s;var h=this.scene.textures.getFrame(this.key,"item_border.png"),l=h.width*s+4*this.dpr*s,c=h.height*s+4*this.dpr*s,u=236*this.dpr*s,m={x:-7*this.dpr*s,y:-16*this.dpr*s,table:{width:u,height:295*this.dpr*s,columns:4,cellsCount:25,cellWidth:l,cellHeight:c,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0},scrollMode:0,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new y(n,e.key,e.dpr,s),e.add(i)),i.setData({item:o}),i.setProp(o),i}};this.mPropGrid=new p.a(this.scene,m),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){e.onSelectItemHandler(t)}));var d=this.scene.textures.getFrame(this.key,"nav_btn_normal.png"),f={x:-9*this.dpr*s,y:-155*this.dpr*s,table:{width:u,height:this.categoriesBg.displayHeight,cellWidth:(d.width+4*this.dpr)*s,cellHeight:29*this.dpr*s,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0},scrollMode:1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&((i=new v(n,e.key,"nav_btn_normal.png","nav_btn_down.png","1")).setTextStyle({color:"#566ddb",fontFamily:a.a.DEFULT_FONT,fontSize:10*e.dpr*s}),i.setFontStyle("bold"),i.setScale(s),e.add(i)),i.setText(o.value),i.setData("data",o),e.mPreSelectedCategorie||e.onClickCategoryHandler(i),i}};this.mCategoryTable=new p.a(this.scene,f),this.mCategoryTable.layout(),this.mCategoryTable.on("cellTap",(function(t){e.onClickCategoryHandler(t)})),this.add([this.mBg,this.carIcon,this.mCounter,this.categoriesBg,this.mPropGrid.table,this.mCategoryTable.table,this.mCloseBtn,this.mDiscardBtn]),this.resize(this.scene.cameras.main.width,this.scene.cameras.main.height),t.prototype.init.call(this)},MineCarPanel.prototype.refreshData=function(){var t=this.mShowData,e=t.items||[];this.mLimit=t.limit||0,this.mAllItem=[];for(var i=0,n=e;i<n.length;i++){var a=n[i];this.mAllItem.push({item:a})}this.mDiscardBtn.changeState(o.Discard),this.mCounter.setText(e.length+"/"+this.mLimit),this.setCategories(t.subcategories)},MineCarPanel.prototype.onCloseHandler=function(){this.emit("close")},MineCarPanel.prototype.onSelectedCategory=function(t){this.mFilterItem=[];for(var e=null,i=0,n=this.mAllItem;i<n.length;i++){var o=n[i];!(e=o.item)||e.subcategory!==t&&"all"!==t||this.mFilterItem.push(o)}for(var a=this.mLimit-this.mFilterItem.length,s=0;s<a;s++)this.mFilterItem.push({item:null});this.mPropGrid.setItems(this.mFilterItem)},MineCarPanel.prototype.onSelectItemHandler=function(t){if(this.mDiscardBtn&&this.mDiscardBtn.buttonState!==o.Discard)return t.switchSelect(),void this.checkMode();t&&t.item.item?(this.mTips.parentContainer||this.add(this.mTips),this.mTips.setItem(t.item.item)):this.remove(this.mTips)},MineCarPanel.prototype.onClickCategoryHandler=function(t){var e=t.getData("data");e&&(this.onSelectedCategory(e.key),this.mPreSelectedCategorie&&this.mPreSelectedCategorie.changeNormal(),t.changeDown(),this.mPreSelectedCategorie=t)},MineCarPanel.prototype.checkMode=function(){if(this.mFilterItem&&!(this.mFilterItem.length<1)){for(var t=0,e=this.mFilterItem;t<e.length;t++){if(e[t].selected)return void this.mDiscardBtn.changeState(o.Sutmit)}this.mDiscardBtn.changeState(o.Cancel)}},MineCarPanel.prototype.onDiscardSelectedItem=function(){var t=this;if(this.mFilterItem&&!(this.mFilterItem.length<1)){for(var e=[],i=[],n=0,o=this.mFilterItem;n<o.length;n++){var a=o[n];a.item&&a.selected&&(e.push(a.item),i.push(a.item.name+"*"+a.item.count))}new c.AlertView(this.scene,this.mWorld).show({text:"您确定要丢弃 [color=#0157BC]"+i.join("、")+"[/color] 吗？",title:"丢弃",oy:302*this.dpr*this.mWorld.uiScale,callback:function(){t.emit("discard",e)}})}},MineCarPanel.prototype.enterDiscardMode=function(){if(this.mFilterItem){var t=this.mDiscardBtn.buttonState,e=!1;t===o.Discard?(this.mDiscardBtn.changeState(o.Cancel),e=!0):(t===o.Sutmit&&this.onDiscardSelectedItem(),this.mDiscardBtn.changeState(o.Discard)),this.mFilterItem.length>0&&this.mFilterItem[0].selectVisible!==e&&(this.mFilterItem.map((function(t){t.selectVisible=e,t.selected=!1})),this.mPropGrid.setItems(this.mFilterItem))}},MineCarPanel}(h.BasePanel),y=function(t){function PackageItem(e,i,n,o){var h=t.call(this,e)||this,l=h.scene.make.image({key:i,frame:"item_border.png"},!1).setOrigin(0).setScale(o);return h.setSize(l.width*o,l.height*o),h.mItemImage=new s.DynamicImage(h.scene,0,0),h.mItemImage.setOrigin(0),h.mItemImage.setScale(n*o),h.mCounter=h.scene.make.text({x:l.displayWidth-2*n,y:l.displayHeight-1*n,style:{fontFamily:a.a.DEFULT_FONT,fontSize:9*n*o,color:"#566DDB"}}).setOrigin(1),h.mCounter.setFontStyle("bold"),h.mSelectedIcon=h.scene.make.image({key:i,frame:"icon_normal.png"},!1),h.mSelectedIcon.x=l.width*o-2*n-h.mSelectedIcon.width*o/2,h.mSelectedIcon.y=2*n+h.mSelectedIcon.height*o/2,h.add(l),h}return d(PackageItem,t),PackageItem.prototype.setProp=function(t){this.mItem=t;var e=t.item;t&&e?this.mItem&&(this.mItemImage.load(l.h.getOsdRes(e.display.texturePath),this,this.onLoadCompleteHandler),this.add(this.mItemImage),e.count>1&&(this.mCounter.setText(e.count.toString()),this.add(this.mCounter)),this.mItem.selectVisible?this.add(this.mSelectedIcon):this.remove(this.mSelectedIcon),this.setSelected()):this.remove([this.mItemImage,this.mCounter,this.mSelectedIcon])},PackageItem.prototype.switchSelect=function(){this.mItem.item&&(this.mItem.selected=!this.mItem.selected,this.setSelected())},Object.defineProperty(PackageItem.prototype,"item",{get:function(){return this.mItem},enumerable:!1,configurable:!0}),PackageItem.prototype.onLoadCompleteHandler=function(){this.mItemImage&&(this.mItemImage.x=this.width-this.mItemImage.displayWidth>>1,this.mItemImage.y=this.height-this.mItemImage.displayHeight>>1)},PackageItem.prototype.setSelected=function(){this.mItem.selected?this.mSelectedIcon.setFrame("icon_selected.png"):this.mSelectedIcon.setFrame("icon_normal.png")},PackageItem}(Phaser.GameObjects.Container),g=function(t){function Tips(e,i,n,o){void 0===o&&(o=1);var s=t.call(this,e)||this;s.mDpr=n;var h=s.scene.make.image({key:i,frame:"tips_bg.png"},!1);return s.mName=s.scene.make.text({x:-h.width/2+12*n*o,y:-h.height/2+5*n*o,style:{fontFamily:a.a.DEFULT_FONT,fontSize:10*n*o,color:"#000000"}},!1),s.mDes=s.scene.make.text({x:s.mName.x,style:{fontFamily:a.a.DEFULT_FONT,fontSize:10*n*o,color:"#000000"}},!1).setOrigin(0,1),s.add([h,s.mName,s.mDes]),s.setSize(h.width*o,h.height*o),s}return d(Tips,t),Tips.prototype.setItem=function(t){if(t){var e=this.y,i=this.alpha;this.y=e+50*this.mDpr,this.alpha=0,this.scene.tweens.add({targets:this,props:{alpha:i,y:e},duration:200,ease:Phaser.Math.Easing.Elastic.Out}),this.mName.setText(t.shortName||t.name),this.mDes.setText(t.des)}},Tips}(Phaser.GameObjects.Container),_=function(t){function DiscardButton(e,i,n,o,a){return t.call(this,e,i,n,o,a)||this}return d(DiscardButton,t),DiscardButton.prototype.changeState=function(t){if(this.mState!==t)switch(this.mState=t,t){case o.Cancel:this.setText("取消"),this.setFrame("gray_btn.png");break;case o.Sutmit:this.setText("提交"),this.setFrame("yellow_btn.png");break;default:this.setText("丢弃"),this.setFrame("yellow_btn.png")}},Object.defineProperty(DiscardButton.prototype,"buttonState",{get:function(){return this.mState},enumerable:!1,configurable:!0}),DiscardButton}(u.a);!function(t){t[t.Discard=0]="Discard",t[t.Cancel=1]="Cancel",t[t.Sutmit=2]="Sutmit"}(o||(o={}));var v=function(t){function CategorieButton(e,i,n,o,a){var s=t.call(this,e,i,n,o,a)||this;return s.disInteractive(),s.removeListen(),s.mBackground.setOrigin(0),s.mText&&s.mText.setPosition(s.mBackground.width/2,s.mBackground.height/2),s}return d(CategorieButton,t),CategorieButton}(m.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"AlertView",(function(){return c}));var n,o=i(6),a=i(9),s=i(21),h=i(25),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function AlertView(e,i){var n=t.call(this,e,i)||this;return n.key="pica_alert",n.disInteractive(),n}return l(AlertView,t),AlertView.prototype.show=function(e){if(this.mShowData=e,t.prototype.show.call(this,e),this.mInitialized){this.mWorld.uiManager.getUILayerManager().addToDialogLayer(this);var i=e.ox,n=e.oy;this.x=i||this.scene.cameras.main.width/2,this.y=n||this.scene.cameras.main.height/2,this.mContent.setText(e.text),e.title&&this.mTitleLabel.setText(e.title)}},AlertView.prototype.preload=function(){this.addAtlas(this.key,"pica_alert/pica_alert.png","pica_alert/pica_alert.json"),t.prototype.preload.call(this)},AlertView.prototype.init=function(){var e=this.mWorld.uiScale||1,i=this.scene.make.image({key:this.key,frame:"bg.png"},!1),n=this.scene.make.image({key:this.key,frame:"title.png"},!1);n.y=-i.height/2,this.mTitleLabel=this.scene.make.text({text:"丢弃",style:{fontFamily:a.a.DEFULT_FONT,fontSize:12*this.dpr*e,color:"#905B06"}},!1).setOrigin(.5),this.mTitleLabel.y=n.y,this.mContent=new s.a(this.scene,0,-11*this.dpr,"",{fontSize:12*this.dpr*e+"px",fontFamily:a.a.DEFULT_FONT,color:"#0",wrap:{mode:"char",width:218*this.dpr}}),this.mContent.setOrigin(.5,.5),this.mContent.setText("[color=#FF0000][/color]"),this.mOkBtn=new h.a(this.scene,this.key,"yellow_btn.png",void 0,"确定"),this.mOkBtn.setTextStyle({color:"#905B06",fontFamily:a.a.DEFULT_FONT,fontSize:13*this.dpr*e}),this.mOkBtn.x=(i.width-this.mOkBtn.displayWidth)/2-33*this.dpr,this.mOkBtn.y=(i.height-this.mOkBtn.displayHeight)/2-16*this.dpr,this.mOkBtn.on("Tap",this.onOkHandler,this),this.mCancelBtn=new h.a(this.scene,this.key,"red_btn.png",void 0,"取消"),this.mCancelBtn.setTextStyle({fontFamily:a.a.DEFULT_FONT,fontSize:13*this.dpr*e}),this.mCancelBtn.x=-(i.width-this.mCancelBtn.displayWidth)/2+33*this.dpr,this.mCancelBtn.y=this.mOkBtn.y,this.mCancelBtn.on("Tap",this.onCancelHandler,this),this.add([i,n,this.mTitleLabel,this.mTitleLabel,this.mContent,this.mOkBtn,this.mCancelBtn]),t.prototype.init.call(this)},AlertView.prototype.onOkHandler=function(){if(this.mShowData){var t=this.mShowData.callback;t&&t.call(this.mShowData.content),this.onCancelHandler()}},AlertView.prototype.onCancelHandler=function(){this.parentContainer&&this.parentContainer.remove(this)},AlertView}(o.BasePanel)},function(t,e,i){"use strict";e.a=function(t){return t.hasOwnProperty("geometryMask")?t.geometryMask:t.bitmapMask}},function(t,e,i){"use strict";var n=i(37),o=i(52);const a=Phaser.Utils.Objects.GetValue;class Button{constructor(t,e){this.gameObject=t,this.scene=Object(o.a)(t),this.setEventEmitter(a(e,"eventEmitter",void 0)),t.setInteractive(a(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.pointer=void 0,this.lastClickTime=void 0,this.setEnable(a(t,"enable",!0)),this.setMode(a(t,"mode",1)),this.setClickInterval(a(t,"clickInterval",100)),this.setDragThreshold(a(t,"threshold",void 0)),this}boot(){this.gameObject.on("pointerdown",this.onPress,this),this.gameObject.on("pointerup",this.onRelease,this),this.gameObject.on("pointerout",this.onPointOut,this),this.gameObject.on("pointermove",this.onMove,this),this.gameObject.on("destroy",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointer=void 0,this.gameObject=void 0,this.scene=void 0}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t||(t||this.cancel(),this.enable=t,this.gameObject.input.enabled=t),this}setMode(t){return"string"==typeof t&&(t=s[t]),this.mode=t,this}setClickInterval(t){return this.clickInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}onPress(t,e,i,n){void 0===this.pointer&&(this.pointer=t,0===this.mode&&this.click(t.downTime,t,n))}onRelease(t,e,i,n){this.pointer===t&&(1===this.mode&&this.click(t.upTime,t,n),this.pointer=void 0)}onPointOut(t,e){this.pointer===t&&this.cancel()}onMove(t,e,i,n){this.pointer===t&&void 0!==this.dragThreshold&&t.getDistance()>=this.dragThreshold&&this.cancel()}click(t,e,i){if(void 0===t)return this.emit("click",this,this.gameObject,e,i),this;this.pointer=void 0;var n=this.lastClickTime;return void 0!==n&&t-n<=this.clickInterval||(this.lastClickTime=t,this.emit("click",this,this.gameObject,e,i)),this}cancel(){return this.pointer=void 0,this}}Object.assign(Button.prototype,n.a);const s={press:0,pointerdown:0,release:1,pointerup:1};e.a=Button},function(t,e,i){"use strict";i.r(e),i.d(e,"MineCar",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function MineCar(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(MineCar,t),MineCar.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MINING_MODE_QUERY_MINE_PACKAGE,this.onQueryMinePackageHandler))},MineCar.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},MineCar.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},MineCar.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},MineCar.prototype.discard=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MINING_MODE_DELETE_MINEPACKAGE_ITEM);e.content.items=t,this.connection.send(e)},MineCar.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},MineCar.prototype.onQueryMinePackageHandler=function(t){var e=t.content;e&&e.subcategories&&e.subcategories.unshift({key:"all",value:"全部"}),this.mEvent.emit("query",t.content)},Object.defineProperty(MineCar.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),MineCar}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractiveBubbleManager",(function(){return f}));var n,o=i(4),a=i(8),s=i(3),h=i(184),l=i(48),c=i(14),p=i(112),u=i(70),m=i(5),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function InteractiveBubbleManager(e,i){var n=t.call(this)||this;return n.map=new Map,n.uilayer=e,n.mworld=i,n.addHandlerFun(s.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SHOW_INTERACTIVE_BUBBLE,n.onInteractiveBubble),n.addHandlerFun(s.op_client.OPCODE._OP_VIRTUAL_WORDL_REQ_CLIENT_REMOVE_INTERACTIVE_BUBBLE,n.onClearInteractiveBubble),n}return d(InteractiveBubbleManager,t),InteractiveBubbleManager.prototype.setScene=function(t){this.connection.removePacketListener(this),this.scene=t,this.connection.addPacketListener(this)},Object.defineProperty(InteractiveBubbleManager.prototype,"connection",{get:function(){if(this.mworld)return this.mworld.connection;a.a.getInstance().log("roomManager is undefined")},enumerable:!1,configurable:!0}),Object.defineProperty(InteractiveBubbleManager.prototype,"currentRoom",{get:function(){return this.mworld.roomManager.currentRoom},enumerable:!1,configurable:!0}),InteractiveBubbleManager.prototype.destroy=function(){if(this.connection.removePacketListener(this),this.map){for(var t in this.map){var e=this.map.get(Number(t));e&&e.destroy()}this.map.clear()}this.mCurRoom&&this.mCurRoom.frameManager.remove(this,this.update),this.map=null,this.mBubble=null,this.scene=null,this.uilayer=null,this.mworld=null},InteractiveBubbleManager.prototype.onInteractiveBubble=function(t){var e=t.content;this.mCurRoom!==this.currentRoom&&(this.mCurRoom&&this.mCurRoom.frameManager.remove(this,this.update),this.mCurRoom=this.currentRoom,this.mCurRoom.frameManager.add(this,this.update));var i=this.currentRoom.elementManager.get(e.receiverId);i||(i=this.currentRoom.playerManager.get(e.receiverId)),i&&this.showInteractionBubble(e,i)},InteractiveBubbleManager.prototype.onClearInteractiveBubble=function(t){for(var e=0,i=t.content.ids;e<i.length;e++){var n=i[e];this.clearInteractionBubble(n)}},InteractiveBubbleManager.prototype.clearInteractionBubble=function(t){this.map.has(t)&&(this.map.get(t).destroy(),this.map.delete(t))},InteractiveBubbleManager.prototype.showInteractionBubble=function(t,e){var i=this,n=Math.round(this.mworld.uiRatio||1);t.display.resName=null,t.display.texturePath=m.h.getUIRes(n,"bubble/bubblebg.png"),t.display.dataPath=m.h.getUIRes(n,"bubble/tipsicon.png");var o=t.id;this.mBubble&&this.mBubble.hide(),this.map.has(o)?this.mBubble=this.map.get(o):(this.mBubble=new h.InteractionBubbleContainer(this.scene,n),this.map.set(o,this.mBubble)),this.mBubble.setBubble(t,new l.a(this,this.onInteractiveBubbleHandler));var a=this.mworld.game.scene.getScene(p.a.name);this.updateBublePos(e,a),this.mBubble.setFollow(e,a,(function(t){i.updateBublePos(e,t.scene)})),this.mBubble.show=!0,this.uilayer.addToDialogLayer(this.mBubble)},InteractiveBubbleManager.prototype.updateBublePos=function(t,e){var i=this.mworld.uiRatio,n=this.mworld.uiScale,o=t.getDisplay().getWorldTransformMatrix();if(o){var a=u.a.getPosByScenes(e,new c.a(o.tx,o.ty-33*i*n));this.mBubble.setPosition(a.x,a.y)}},InteractiveBubbleManager.prototype.onInteractiveBubbleHandler=function(t){if("number"!=typeof t){var e=this.connection,i=new o.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_RES_VIRTUAL_WORLD_ACTIVE_BUBBLE);i.content.id=t.id,e.send(i)}else this.clearInteractionBubble(t)},InteractiveBubbleManager.prototype.update=function(){this.map&&this.map.forEach((function(t){t&&t.show&&t.updatePos()}))},InteractiveBubbleManager}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractionBubbleContainer",(function(){return h}));var n,o=i(249),a=i(29),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function InteractionBubbleContainer(e,i){return t.call(this,e)||this}return s(InteractionBubbleContainer,t),Object.defineProperty(InteractionBubbleContainer.prototype,"show",{get:function(){return this.mShow},set:function(t){this.mShow=t},enumerable:!1,configurable:!0}),InteractionBubbleContainer.prototype.hide=function(){this.mShow=!1,this.parentContainer&&this.parentContainer.remove(this)},InteractionBubbleContainer.prototype.setFollow=function(e,i,n){t.prototype.setFollow.call(this,e,i,n)},InteractionBubbleContainer.prototype.setBubble=function(t,e){this.id=t.id;var i=t.display.resName,n=t.display.texturePath,a=t.display.dataPath;return this.mBubble||(this.mBubble=new o.InteractionBubble(this.scene,this.dpr),this.mBubble.load(i,n,a),this.add(this.mBubble)),this.mBubble.setContentData(t,e),this.mBubble.show(),this.mBubble},InteractionBubbleContainer.prototype.destroy=function(){this.hide(),this.mBubble&&this.mBubble.destroy(),this.mBubble=null,t.prototype.destroy.call(this)},InteractionBubbleContainer}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ReAwardTipsMediator",(function(){return l}));var n,o=i(7),a=i(186),s=i(187),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ReAwardTipsMediator(e,i){var n=t.call(this)||this;return n.scene=e,n.world=i,n.mReAwardTips=new a.ReAwardTips(i),n.mReAwardTips.register(),n.mReAwardTips.on("showAward",n.onShowAwardHandler,n),n}return h(ReAwardTipsMediator,t),ReAwardTipsMediator.prototype.show=function(e){this.mView?this.mView.appendAward(e):(this.mView=new s.ReAwardTipsPanel(this.scene,this.world),this.mView.appendAward(e),t.prototype.show.call(this),this.world.uiManager.getUILayerManager().addToDialogLayer(this.mView))},ReAwardTipsMediator.prototype.destroy=function(){this.mReAwardTips&&this.mReAwardTips.destroy(),t.prototype.destroy.call(this)},ReAwardTipsMediator.prototype.onShowAwardHandler=function(t){this.show(t)},ReAwardTipsMediator}(o.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ReAwardTips",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ReAwardTips(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(ReAwardTips,t),ReAwardTips.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},ReAwardTips.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},ReAwardTips.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SHOW_REWARD_TIPS,this.onReAwardTipsHandler))},ReAwardTips.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},ReAwardTips.prototype.destroy=function(){this.unregister()},Object.defineProperty(ReAwardTips.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),ReAwardTips.prototype.onReAwardTipsHandler=function(t){this.mEvent.emit("showAward",t.content)},ReAwardTips}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ReAwardTipsPanel",(function(){return c}));var n,o=i(6),a=i(16),s=i(9),h=i(5),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function ReAwardTipsPanel(e,i){var n=t.call(this,e,i)||this;return n.key="reaward_tips",n.mTips=[],n.showingList=[],n}return l(ReAwardTipsPanel,t),ReAwardTipsPanel.prototype.show=function(){t.prototype.show.call(this),this.mInitialized&&0===this.showingList.length&&this.showAward()},ReAwardTipsPanel.prototype.appendAward=function(t){this.mTips.push(t),this.show()},ReAwardTipsPanel.prototype.addAward=function(){},ReAwardTipsPanel.prototype.preload=function(){this.addImage(this.key,"reaward_tips/bg.png"),t.prototype.preload.call(this)},ReAwardTipsPanel.prototype.init=function(){this.setSize(20,20),t.prototype.init.call(this),this.y=250*this.dpr},ReAwardTipsPanel.prototype.showAward=function(){if(!(this.mTips.length<1||this.showingList.length>=3)){for(var t=0,e=this.showingList;t<e.length;t++){e[t].beUp()}var i=new p(this.scene,this.key,this.dpr,this.scale);i.once("destroy",this.onDestroyHanlder,this),i.once("show",this.onAwardItemShowHandler,this),i.setProp(this.mTips.pop()),this.add(i),this.showingList.push(i)}},ReAwardTipsPanel.prototype.onAwardItemShowHandler=function(){this.showAward()},ReAwardTipsPanel.prototype.onDestroyHanlder=function(t){var e=this.showingList.indexOf(t);e>-1&&this.showingList.splice(e,1),this.showAward()},ReAwardTipsPanel}(o.BasePanel),p=function(t){function AwardItem(e,i,n,o){var h=t.call(this,e)||this;return h.mBg=h.scene.make.image({key:i},!1),h.mScaleRatio=n*o,h.mImage=new a.DynamicImage(h.scene,0,0),h.mImage.setScale(n),h.mImage.setOrigin(.5,1),h.mImage.y=h.mBg.height*o/2,h.mLabel=h.scene.make.text({x:h.mBg.width*h.originX-6*h.mScaleRatio,style:{fontFamily:s.a.DEFULT_FONT,fontSize:11*h.mScaleRatio,color:"#00FF00"}},!1).setOrigin(1,.5),h.addAt(h.mBg,0),h.add([h.mImage,h.mLabel]),h.setSize(h.mBg.width*o,h.mBg.height*o),h}return l(AwardItem,t),AwardItem.prototype.setProp=function(t){t&&(t.display&&t.display.texturePath&&this.mImage.load(h.h.getOsdRes(t.display.texturePath)),this.mLabel.setText(t.text),this.showTween())},AwardItem.prototype.showTween=function(){var t=this;this.scene.tweens.add({targets:this,props:{x:"+="+.3*this.width},ease:"Bounce.easeOut",onComplete:function(){t.emit("show"),t.closeDelay=setTimeout((function(){t.closeTween()}),1e3)},duration:300})},AwardItem.prototype.closeTween=function(){var t=this;this.scene&&this.scene.tweens.add({targets:this,props:{y:"-="+50*this.mScaleRatio,alpha:"0"},ease:"Linear",duration:300,onComplete:function(){t.destroy()}})},AwardItem.prototype.beUp=function(){var t=this;clearTimeout(this.closeDelay),this.scene.tweens.add({targets:this,props:{y:"-="+50*this.mScaleRatio},ease:"Linear",duration:300,onComplete:function(){t.closeDelay=setTimeout((function(){t.closeTween()}),1e3)}})},AwardItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterEditorPanel",(function(){return p}));var n,o=i(25),a=i(23),s=i(9),h=i(19),l=i(31),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function CharacterEditorPanel(e,i,n,l,c,p,u){var m=t.call(this,e,i,n)||this;m.dpr=0,m.key="",m.setSize(l,c),m.key=p,m.dpr=u;var d="bold "+15*m.dpr+"px Source Han Sans";m.title=m.scene.make.text({x:0,y:.5*-c+50*u,text:m.geti18n("edit_profile"),style:{font:d,blod:!0,color:"#ffffff",fontFamily:s.a.DEFULT_FONT}}).setOrigin(.5);var f=m.scene.make.graphics(void 0,!1);f.clear(),f.fillStyle(16777215,.5),f.fillRect(0,0,247*u,350*u),f.setPosition(.5*-l,-184*u);var y=.5*-l+9*u,g=-170*u,_=50*u,v=m.scene.make.text({x:y,y:g,style:{blod:!0,color:"#0062BB",fontSize:15*u,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0);v.setText(m.geti18n("user_name")+":"),m.inputText=new a.a(m.scene,y+v.width+20*u,g,162*u,27*u,{type:"input",fontSize:18*u+"px",color:"#0062BB",align:"center",placeholder:m.geti18n("input_nickname")}).setOrigin(0);var b=m.createLine(-230*m.dpr*.5,g+32*m.dpr);m.add(f),m.add([m.title,v,m.inputText,b]),m.idText=m.createText("I        D:","49855555",y,g+_),m.constellationText=m.createText(m.geti18n("constellation")+":","双子座",y,g+2*_),m.birthdayText=m.createText(m.geti18n("birthday")+":","1998-04-24",y,g+3*_),m.cityText=m.createText(m.geti18n("city")+":","中国·上海",y,g+4*_);var P=m.scene.make.text({x:y,y:g+5*_,style:{blod:!0,color:"#0062BB",fontSize:15*u,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0);P.setText(m.geti18n("signature")+":"),m.signInput=new a.a(m.scene,y+P.width+20*u,g+5*_,162*u,76*u,{type:"input",fontSize:18*u+"px",color:"#0062BB",align:"center",placeholder:m.geti18n("input_signature")}).setOrigin(0),m.add([P,m.signInput]);var S=new o.a(m.scene,"common_key","back_arrow","back_arrow"),w=new h.NinePatchButton(m.scene,0,.5*c-40*u,174*m.dpr,37*m.dpr,"common_key","yellow_btn",m.geti18n("save"),{left:12*m.dpr,top:12*m.dpr,right:12*m.dpr,bottom:12*m.dpr});return w.setTextStyle({fontSize:16*m.dpr,color:"#ED7814"}),S.setPosition(y+8*u,.5*-c+50*u),S.on("Tap",m.onBackHandler,m),w.on("Tap",m.onSaveHandler,m),m.add([S,w]),m}return c(CharacterEditorPanel,t),CharacterEditorPanel.prototype.destroy=function(){this.inputText&&this.inputText.destroy(),this.signInput&&this.signInput.destroy(),t.prototype.destroy.call(this)},CharacterEditorPanel.prototype.createText=function(t,e,i,n){var o=this.scene.make.text({x:i,y:n,style:{blod:!0,color:"#0062BB",fontSize:15*this.dpr,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,0);o.setText(t);var a=this.scene.make.text({x:i+o.width+20*this.dpr,y:n,text:e,style:{blod:!0,color:"#ffffff",fontSize:15*this.dpr,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,0),h=this.createLine(-230*this.dpr*.5,n+32*this.dpr);return this.add([o,a,h]),a},CharacterEditorPanel.prototype.geti18n=function(t){return l.a.t("player_info."+t)},CharacterEditorPanel.prototype.createLine=function(t,e){var i=this.scene.make.graphics(void 0,!1);return i.clear(),i.fillStyle(25275,.6),i.fillRect(0,0,230*this.dpr,3),i.setPosition(t,e),i},CharacterEditorPanel.prototype.onBackHandler=function(){this.visible=!1,this.emit("editorHide")},CharacterEditorPanel.prototype.onSaveHandler=function(){},CharacterEditorPanel}(Phaser.GameObjects.Container)},,,,function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterInfo",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function CharacterInfo(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(CharacterInfo,t),CharacterInfo.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_SELF_PLAYER_INFO,this.onOwnerCharacterInfo),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_ANOTHER_PLAYER_INFO,this.onOtherCharacterInfo))},CharacterInfo.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},CharacterInfo.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},CharacterInfo.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},CharacterInfo.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(CharacterInfo.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),CharacterInfo.prototype.queryPlayerInfo=function(){var t=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_SELF_PLAYER_INFO);this.connection.send(t)},CharacterInfo.prototype.onOwnerCharacterInfo=function(t){var e=t.content;this.mEvent.emit("ownerInfo",e)},CharacterInfo.prototype.onOtherCharacterInfo=function(t){var e=t.content;this.mEvent.emit("otherInfo",e)},CharacterInfo}(o.PacketHandler)},function(t,e,i){"use strict";var n=i(328);e.a=n.a},function(t,e,i){"use strict";var n=i(21);e.a=n.a},function(t,e,i){"use strict";var n=i(325);e.a=n.a},function(t,e,i){"use strict";var n=i(246),o=i(86),a=i(110);const s=Phaser.Utils.Objects.GetValue;class ScrollablePanel extends n.a{constructor(t,e){void 0===e&&(e={});var i=Object(o.a)(e),n=s(e,"panel",void 0);void 0===n&&(n={}),n.scrollMode=i,n.clamplChildOY=s(e,"clamplChildOY",!1);var h,l,c=new a.a(t,n),p=s(n,"width",void 0),u=s(n,"height",void 0);0===i?(h=void 0===p?1:0,l=void 0===u):(h=void 0===u?1:0,l=void 0===p),e.type="rexScrollablePanel",e.child={gameObject:c,proportion:h,expand:l};var m=s(e,"space",void 0);m&&(m.child=m.panel),super(t,e),this.addChildrenMap("panel",this.childrenMap.child.child)}}e.a=ScrollablePanel},function(t,e,i){"use strict";var n=i(329);e.a=function(t,e,i){return t._edit||(t._edit=new n.a(t)),t._edit.open(e,i),t._edit}},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n,o,a=i(245),s=i(29),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t.downinBound="downinBound",t.downoutBound="downoutBound",t.upinBound="upinBound",t.upoutBound="upoutBound"}(o||(o={}));var l=Phaser.Utils.Objects.GetValue,c=function(t){function GameScroller(e,i,n){var o=t.call(this,e)||this;o.mMoveing=!1,o.soundMap=new Map,o.mConfig=i,o.soundGroup=i.music,o.x=i.x,o.y=i.y,o.width=o.mConfig.width,o.height=o.mConfig.height;var s=i.zoom;return o.maskGraphic=e.make.graphics(void 0,!1),o.maskGraphic.fillStyle(0),o.maskGraphic.fillRect(.5*-o.width*s,.5*-o.height*s,o.width*s,o.height*s),o.maskGraphic.setPosition(o.x*s,o.y*s),n?o.mGameObject=n:(o.mGameObject=e.make.container(void 0,!1),o.add(o.mGameObject)),i.valuechangeCallback||(i.valuechangeCallback=function(t){o.onScrollValueChange(t)}),o.mScroller=new a.a(o,i),o.mDisDelection=l(i,"interactivedisDetection",10),o.mCellDownHandler=l(i,"celldownCallBack",void 0),o.mCellUpHandler=l(i,"cellupCallBack",void 0),o.setInteractive(),o.addListen(),o}return h(GameScroller,t),Object.defineProperty(GameScroller.prototype,"view",{get:function(){return this.mGameObject},enumerable:!1,configurable:!0}),GameScroller.prototype.setEnable=function(t){this.mScroller&&this.mScroller.setEnable(t)},GameScroller.prototype.setValue=function(t){this.mScroller&&this.mScroller.setValue(t)},GameScroller.prototype.adjustBackDeceleration=function(t){this.mScroller&&this.mScroller.setBackDeceleration(t)},GameScroller.prototype.adjustSlidingDeceleration=function(t){this.mScroller&&this.mScroller.setSlidingDeceleration(t)},GameScroller.prototype.adjustScrollMode=function(t){this.mConfig.orientation&&this.mConfig.orientation===t||this.mScroller&&this.mScroller.setOrientationMode(t),this.mConfig.orientation=t},GameScroller.prototype.adjustDragThreshol=function(t){this.mScroller&&this.mScroller.setDragThreshold(t)},GameScroller.prototype.updateScrollPos=function(t){this.mConfig.orientation?this.mGameObject.x=t:this.mGameObject.y=t},GameScroller.prototype.adjustMask=function(t,e,i,n){void 0===i&&(i=this.mConfig.x),void 0===n&&(n=this.mConfig.y),this.mGameObject.clearMask();var o=this.scene.make.graphics(void 0,!1);o.fillStyle(0),o.fillRect(0,0,t,e),o.setPosition(i,n),this.mGameObject.setMask(o.createGeometryMask())},GameScroller.prototype.addItem=function(t){this.mGameObject.add(t),this.setInteractiveObject(t)},GameScroller.prototype.addItemAt=function(t,e){this.mGameObject.addAt(t,e)},GameScroller.prototype.getItemList=function(){return this.mGameObject.list},GameScroller.prototype.setBounds=function(t,e){this.mScroller.setBounds(t,e)},GameScroller.prototype.setAlign=function(t){void 0===t&&(t=2),this.mConfig.align=t,this.Sort()},GameScroller.prototype.Sort=function(){for(var t=0,e=this.mGameObject.list,i=0,n=e;i<n.length;i++){var o=n[i];1===this.mConfig.orientation?(o.x=o.width*o.originX+t,t+=o.width):(o.y=o.height*o.originY+t,t+=o.height)}if(1===this.mConfig.orientation){this.mGameObject.width=t;for(var a=0,s=e;a<s.length;a++){(o=s[a]).x-=.5*t}t-=this.width}else{this.mGameObject.height=t;for(var h=0,l=e;h<l.length;h++){(o=l[h]).y-=.5*t}t-=this.height}var c=0,p=0,u=0;t<0?u=c=p=0===this.mConfig.align?-t/2:1===this.mConfig.align?0:t/2:(c=-t/2,p=t/2,u=0===this.mConfig.align?c:1===this.mConfig.align?0:p),this.mLeftBound=c,this.mRightBound=p,this.setBounds(c,p),this.setValue(u)},GameScroller.prototype.clearItems=function(){for(var t=0,e=this.mGameObject.list;t<e.length;t++){e[t].destroy()}this.mGameObject.list.length=0,this.clearInteractiveObject()},Object.defineProperty(GameScroller.prototype,"bounds",{get:function(){return[this.mLeftBound,this.mRightBound]},enumerable:!1,configurable:!0}),GameScroller.prototype.removeInteractiveObject=function(t){var e=this.mInteractiveList.indexOf(t);e>-1&&this.mInteractiveList.splice(e,1)},GameScroller.prototype.addListen=function(){this.scene&&(this.removeListen(),this.scene.input.on("pointermove",this.pointerMoveHandler,this),this.scene.input.on("pointerdown",this.pointerDownHandler,this),this.scene.input.on("pointerup",this.pointerUpHandler,this))},GameScroller.prototype.removeListen=function(){this.mMoveing=!1,this.scene&&(this.scene.input.off("pointerdown",this.pointerDownHandler,this),this.scene.input.off("pointerup",this.pointerUpHandler,this),this.scene.input.off("pointermove",this.pointerMoveHandler,this))},Object.defineProperty(GameScroller.prototype,"left",{get:function(){return-this.mGameObject.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(GameScroller.prototype,"right",{get:function(){return this.mGameObject.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(GameScroller.prototype,"top",{get:function(){return-this.mGameObject.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(GameScroller.prototype,"bottom",{get:function(){return this.mGameObject.height/2},enumerable:!1,configurable:!0}),GameScroller.prototype.setInteractiveObject=function(t){this.mInteractiveList||(this.mInteractiveList=[]),this.mInteractiveList.push(t)},GameScroller.prototype.destroy=function(){this.mMoveing=!1,this.mGameObject&&this.mGameObject.clearMask(!0),this.mScroller&&this.mScroller.destroy(),t.prototype.destroy.call(this)},GameScroller.prototype.clearInteractiveObject=function(){this.mInteractiveList&&(this.mInteractiveList.length=0,this.mInteractiveList=[],this.mScroller.setBounds(0,0))},GameScroller.prototype.pointerMoveHandler=function(t){this.soundGroup&&this.soundGroup.move&&this.playSound(this.soundGroup.move),this.mMoveing=!0},GameScroller.prototype.pointerDownHandler=function(t){this.soundGroup&&this.soundGroup.down&&this.playSound(this.soundGroup.down);var e=this.checkPointerInBounds(this,t);if(e&&this.checkPointerDelection(t)){if(this.mCellDownHandler&&!this.mMoveing){if(!this.mInteractiveList)return;for(var i=0,n=this.mInteractiveList.length;i<n;i++){var a=this.mInteractiveList[i];if(this.checkPointerInBounds(a,t,!0)){this.mCellDownHandler(a);break}}}var s=e?o.downinBound:o.downoutBound;this.emit(s,this)}},GameScroller.prototype.pointerUpHandler=function(t,e){this.soundGroup&&this.soundGroup.up&&this.playSound(this.soundGroup.up);var i=this.checkPointerInBounds(this,t);if(i&&this.checkPointerDelection(t)){if(this.mCellUpHandler&&!this.mMoveing){if(!this.mInteractiveList)return;for(var n=0,a=this.mInteractiveList.length;n<a;n++){var s=this.mInteractiveList[n];if(this.checkPointerInBounds(s,t,!0)){this.mCellUpHandler(s);break}}}var h=i?o.upinBound:o.upoutBound;this.emit(h,this)}this.mMoveing=!1},GameScroller.prototype.checkPointerInBounds=function(t,e,i){if(void 0===i&&(i=!1),this.mRectangle||(this.mRectangle=new Phaser.Geom.Rectangle(0,0,0,0)),this.mRectangle.left=-t.width/2,this.mRectangle.right=t.width/2,this.mRectangle.top=-t.height/2,this.mRectangle.bottom=t.height/2,e){var n=t.getWorldTransformMatrix(),o=e.x-n.tx,a=e.y-n.ty;return this.mRectangle.left<=o&&this.mRectangle.right>=o&&this.mRectangle.top<=a&&this.mRectangle.bottom>=a}return!1},GameScroller.prototype.onScrollValueChange=function(t){1===this.mConfig.orientation?this.mGameObject.x=t:this.mGameObject.y=t},GameScroller}(s.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"GridLayoutGroup",(function(){return c})),i.d(e,"AlignmentType",(function(){return o})),i.d(e,"CornerType",(function(){return a})),i.d(e,"AxisType",(function(){return s})),i.d(e,"ConstraintType",(function(){return h}));var n,o,a,s,h,l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function GridLayoutGroup(e,i,n){var l=t.call(this,e,i,n)||this;return l.layoutElements=[],l._padding=new Phaser.Math.Vector4(0,0,0,0),l._cellSize=new Phaser.Math.Vector2(100,100),l._spacing=new Phaser.Math.Vector2(0,0),l._alignmentType=o.UpperLeft,l._startCorner=a.UpperLeft,l._startAxis=s.Horizontal,l._constraint=h.Flexible,l._constraintCount=4,l}return l(GridLayoutGroup,t),GridLayoutGroup.prototype.onPlay=function(){},GridLayoutGroup.prototype.start=function(){},Object.defineProperty(GridLayoutGroup.prototype,"padding",{get:function(){return this._padding},set:function(t){void 0!==t&&(this._padding=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"cellSize",{get:function(){return this._cellSize},set:function(t){void 0!==t&&(t.x<0&&(t.x=0),t.y<0&&(t.y=0),this._cellSize=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"spacing",{get:function(){return this._spacing},set:function(t){void 0!==t&&(this._spacing=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"alignmentType",{get:function(){return this._alignmentType},set:function(t){t!==this._alignmentType&&(this._alignmentType=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"startCorner",{get:function(){return this._startCorner},set:function(t){t!==this._startCorner&&(this._startCorner=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"startAxis",{get:function(){return this._startAxis},set:function(t){t!==this._startAxis&&(this._startAxis=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"constraint",{get:function(){return this._constraint},set:function(t){t!==this._constraint&&(this._constraint=t)},enumerable:!1,configurable:!0}),Object.defineProperty(GridLayoutGroup.prototype,"constraintCount",{get:function(){return this._constraintCount},set:function(t){void 0===t||isNaN(t)||(this._constraintCount=t)},enumerable:!1,configurable:!0}),GridLayoutGroup.prototype.Layout=function(){this.layoutElements.length=0;for(var t=0,e=this.list;t<e.length;t++){var i=e[t];i.active&&this.layoutElements.push(i)}if(0!==this.layoutElements.length){var n=this._startCorner%2,o=Math.floor(this._startCorner/2),a=0,h=0,l=0,c=this.getCellCount();this._startAxis===s.Horizontal?(a=c.x,h=Phaser.Math.Clamp(c.x,1,this.layoutElements.length),l=Phaser.Math.Clamp(c.y,1,Math.ceil(this.layoutElements.length/a))):(a=c.y,l=Phaser.Math.Clamp(c.y,1,this.layoutElements.length),h=Phaser.Math.Clamp(c.x,1,Math.ceil(this.layoutElements.length/a)));for(var p=new Phaser.Math.Vector2(h*this._cellSize.x+(h-1)*this._spacing.x,l*this._cellSize.y+(l-1)*this._spacing.y),u=new Phaser.Math.Vector2(this.getStartOffset(0,p.x),this.getStartOffset(1,p.y)),m=0,d=0,f=0;f<this.layoutElements.length;f++)this._startAxis===s.Horizontal?(m=f%a,d=Math.floor(f/a)):(m=Math.floor(f/a),d=f%a),1===n&&(m=h-1-m),1===o&&(d=l-1-d),this.setChildAlongAxis(this.layoutElements[f],0,u.x+(this._cellSize.x+this._spacing.x)*m,this._cellSize.x),this.setChildAlongAxis(this.layoutElements[f],1,u.y+(this._cellSize.y+this._spacing.y)*d,this._cellSize.y);var y=u.x+(this._cellSize.x+this._spacing.x)*(m+1),g=u.y+(this._cellSize.y+this._spacing.y)*(d+1);this.startAxis===s.Horizontal?(this.height=g,this.setAllChildPositionOffset(0)):(this.width=y,this.setAllChildPositionOffset(1)),this.width<y&&(this.width=y),this.height<g&&(this.height=g)}},GridLayoutGroup.prototype.setChildAlongAxis=function(t,e,i,n){0===e?t.width=n:t.height=n;var o=i;0===e?t.x=o+n*t.originX:t.y=o+n*t.originY},GridLayoutGroup.prototype.setAllChildPositionOffset=function(t){for(var e=0,i=this.layoutElements;e<i.length;e++){var n=i[e];if(0===t){var o=.5*this.width;n.x-=o}else{o=.5*this.height;n.y-=o}}},GridLayoutGroup.prototype.getStartOffset=function(t,e){var i=e+(0===t?this.paddingHorizontal():this.paddingVertical()),n=(0===t?this.width:this.height)-i,o=this.getAlignmentOnAxis(t);return(0===t?this._padding.x:this._padding.z)+n*o},GridLayoutGroup.prototype.getAlignmentOnAxis=function(t){return 0===t?this._alignmentType%3*.5:.5*Math.floor(this._alignmentType/3)},GridLayoutGroup.prototype.getCellCount=function(){var t=new Phaser.Math.Vector2;return this._constraint===h.FixedColumnCount?(t.x=this._constraintCount,this.layoutElements.length>=t.x&&(t.y=Math.floor(this.layoutElements.length/t.x)+(this.layoutElements.length%t.x>0?1:0))):this._constraint===h.FixedRowCount?(t.y=this._constraintCount,this.layoutElements.length>=t.y&&(t.x=Math.floor(this.layoutElements.length/t.y)+(this.layoutElements.length%t.y>0?1:0))):(t.x=Math.max(1,Math.floor((this.width-this.paddingHorizontal()+this._spacing.x+.001)/(this._cellSize.x+this._spacing.x))),t.y=Math.max(1,Math.floor((this.height-this.paddingVertical()+this._spacing.y+.001)/(this._cellSize.y+this._spacing.y)))),t},GridLayoutGroup.prototype.paddingHorizontal=function(){return this._padding.x+this._padding.y},GridLayoutGroup.prototype.paddingVertical=function(){return this._padding.z+this._padding.w},GridLayoutGroup.ClassName="gridLayoutGroup",GridLayoutGroup}(Phaser.GameObjects.Container);!function(t){t[t.UpperLeft=0]="UpperLeft",t[t.UpperCenter=1]="UpperCenter",t[t.UpperRight=2]="UpperRight",t[t.MiddleLeft=3]="MiddleLeft",t[t.MiddleCenter=4]="MiddleCenter",t[t.MiddleRight=5]="MiddleRight",t[t.LowerLeft=6]="LowerLeft",t[t.LowerCenter=7]="LowerCenter",t[t.LowerRight=8]="LowerRight"}(o||(o={})),function(t){t[t.UpperLeft=0]="UpperLeft",t[t.UpperRight=1]="UpperRight",t[t.LowerLeft=2]="LowerLeft",t[t.LowerRight=3]="LowerRight"}(a||(a={})),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(s||(s={})),function(t){t[t.Flexible=0]="Flexible",t[t.FixedColumnCount=1]="FixedColumnCount",t[t.FixedRowCount=2]="FixedRowCount"}(h||(h={}))},function(t,e,i){"use strict";i.r(e),i.d(e,"ComponentRankMediator",(function(){return l}));var n,o=i(201),a=i(7),s=i(18),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ComponentRankMediator(e,i,n){var a=t.call(this)||this;return a.mUIType=s.a.Normal,a.mView=new o.ComponentRankPanel(i,n),e.addToUILayer(a.mView),a.mLayerManager=e,a.mScene=i,a.world=n,a}return h(ComponentRankMediator,t),ComponentRankMediator.prototype.getName=function(){return""},ComponentRankMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView.hide(),this.mView=null)},ComponentRankMediator.prototype.isSceneUI=function(){return!1},ComponentRankMediator.prototype.isShow=function(){return!1},ComponentRankMediator.prototype.resize=function(){this.mView.resize()},ComponentRankMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView=new o.ComponentRankPanel(this.mScene,this.world),this.mLayerManager.addToUILayer(this.mView),this.mView.show(),e&&e.length>0&&this.mView.addItem(e[0]),t.prototype.show.call(this,e))},ComponentRankMediator.prototype.destroy=function(){this.mView&&this.mView.parentContainer&&this.mView.parentContainer.remove(this.mView),t.prototype.destroy.call(this)},ComponentRankMediator.prototype.update=function(t){t&&t.length>0&&this.mView.addItem(t[0])},ComponentRankMediator.NAME="ComponentRankMediator",ComponentRankMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ComponentRankPanel",(function(){return l}));var n,o=i(92),a=i(5),s=i(200),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ComponentRankPanel(e,i){return t.call(this,e,i)||this}return h(ComponentRankPanel,t),ComponentRankPanel.prototype.addListen=function(){this.mCloseBtn.on("pointerup",this.onCloseHandler,this)},ComponentRankPanel.prototype.removeListen=function(){this.mCloseBtn.off("pointerup",this.onCloseHandler,this)},ComponentRankPanel.prototype.resize=function(t,e){if(this.scene){var i=this.scene.cameras.main.worldView;this.x=i.width-this.width-t>>1,this.y=i.height-this.height-e>>1}},ComponentRankPanel.prototype.destroy=function(){this.mCloseBtn&&(this.mCloseBtn.destroy(!0),this.mCloseBtn=null),t.prototype.destroy.call(this)},ComponentRankPanel.prototype.preload=function(){this.scene.load.spritesheet(a.e.getName(),a.e.getPNG(),a.e.getFrameConfig()),t.prototype.preload.call(this)},ComponentRankPanel.prototype.init=function(){this.mCloseBtn=this.scene.make.image({x:0,y:0,key:a.e.getName(),frame:"btn_normal"},!1),this.mCloseBtn.setTexture(a.e.getName(),"btn_normal"),this.mCloseBtn.x=(this.width>>1)-65,this.mCloseBtn.y=-this.height>>1,t.prototype.init.call(this),this.add(this.mCloseBtn),this.mCloseBtn.setInteractive(),this.mWorld.uiManager.getMediator(s.ComponentRankMediator.NAME).resize(),this.mCloseBtn.x=this.width-18},ComponentRankPanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(s.ComponentRankMediator.NAME).resize()},ComponentRankPanel.prototype.onCloseHandler=function(){this.hide()},ComponentRankPanel}(o.BasicRankPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Compose",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Compose(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Compose,t),Compose.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_CRAFT_QUERY_FORMULA,this.onRetFormulaDetial))},Compose.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Compose.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Compose.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Compose.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(Compose.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Compose.prototype.onReqFormulaDetail=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_CRAFT_QUERY_FORMULA);e.content.id=t,this.connection.send(e)},Compose.prototype.onReqUseFormula=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_CRAFT_ALCHEMY);e.content.id=t,this.connection.send(e)},Compose.prototype.onRetFormulaDetial=function(t){var e=t.content;this.mEvent.emit("formulaDetial",e)},Compose}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ComposePanel",(function(){return P}));var n,o=i(9),a=i(3),s=i(6),h=i(12),l=i(5),c=i(25),p=i(55),u=i(16),m=i(42),d=i(330),f=i(204),y=i(31),g=i(198),_=i(60),v=i(295),b=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),P=function(t){function ComposePanel(e,i){var n=t.call(this,e,i)||this;return n.key="compose",n.world=i,n}return b(ComposePanel,t),ComposePanel.prototype.resize=function(e,i){t.prototype.resize.call(this,e,i),this.content.x=.5*e,this.content.y=.5*i,this.mGrideTable.refreshPos(.5*e+10*this.dpr,i-70*this.dpr),this.setSize(e,i)},ComposePanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},ComposePanel.prototype.addListen=function(){this.mInitialized&&(this.scene.input.on("pointerup",this.onInputPointUp,this),this.makeBtn.on(_.a.MouseEvent.Tap,this.onMakeHandler,this))},ComposePanel.prototype.removeListen=function(){this.mInitialized&&(this.scene.input.off("pointerup",this.onInputPointUp,this),this.makeBtn.off(_.a.MouseEvent.Tap,this.onMakeHandler,this))},ComposePanel.prototype.preload=function(){this.addAtlas(this.key,"compose/compose.png","compose/compose.json"),this.addAtlas(f.UIAtlasKey.commonKey,f.UIAtlasName.common+".png",f.UIAtlasName.common+".json"),t.prototype.preload.call(this)},ComposePanel.prototype.init=function(){var e=this,i=this.scaleWidth,n=this.scaleHeight,a=this.scale;this.content=this.scene.make.container(void 0,!1),this.content.setSize(i,n),this.add(this.content);var s=this.scene.make.graphics(void 0,!1);s.clear(),s.fillGradientStyle(7365356,7365356,13408757,13408757),s.fillRect(.5*-i,.5*-n,i*a,n*a);var l=this.scene.make.image({key:this.key,frame:"main_bg"});l.y=.5*-n+.5*l.height,this.content.add([s,l]);var u="bold "+17*this.dpr+"px Source Han Sans",d=this.scene.make.image({key:this.key,frame:"title_bg"});d.y=.5*-n+23*this.dpr;var _=this.scene.make.text({x:0,y:d.y,text:y.a.t("compose.title"),style:{font:u,bold:!0,color:"#8B5603",fontSize:15*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5);this.content.add([d,_]);var b=new c.a(this.scene,f.UIAtlasKey.commonKey,"back_arrow","back_arrow");b.setPosition(.5*-i+20*this.dpr,.5*-n+30*this.dpr),b.on("Tap",this.onBackHandler,this),this.content.add(b),this.mDetailDisplay=new p.DetailDisplay(this.scene),this.mDetailDisplay.y=-150*this.dpr,this.mDetailDisplay.scale=2*this.dpr,this.content.add(this.mDetailDisplay),this.mDetailBubble=new S(this.scene,this.dpr),this.mDetailBubble.x=.5*-i,this.mDetailBubble.y=.5*n-360*this.dpr,this.content.add(this.mDetailBubble),this.makeBtn=new v.a(this.scene,Math.ceil(.5*i-60*this.dpr),Math.ceil(.5*n-310*this.dpr),106*this.dpr,40*this.dpr,f.UIAtlasKey.commonKey,"yellow_btn",y.a.t("compose.make"),this.dpr,this.scale,{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr}),this.makeBtn.setTextStyle({fontSize:16*this.dpr,color:"#996600"}),this.content.add(this.makeBtn);var P=360*this.dpr,T=92*this.dpr;this.materialCon=this.scene.make.container(void 0,!1).setSize(P,T),this.content.add(this.materialCon),this.materialCon.setPosition(0,.5*n-230*this.dpr);var C=this.scene.make.image({x:0,y:0,key:this.key,frame:"sourcelist_bg"}),D=this.scene.make.text({x:0,y:.5*-T+12*this.dpr,text:y.a.t("compose.needMaterials"),style:{color:"#ffffff",fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:90*this.dpr,useAdvancedWrap:!0}}},!1).setOrigin(.5),M=this.scene.make.image({x:-10*this.dpr,y:D.y,key:this.key,frame:"sourcelist_title_1"}),O=this.scene.make.image({x:10*this.dpr,y:D.y,key:this.key,frame:"sourcelist_title_1"}),x=.5*-D.width-.5*M.width-10*this.dpr;M.setPosition(x,D.y),O.setPosition(-x,D.y).rotation=-Math.PI;var E=this.scene.make.image({x:0,y:D.y+12*this.dpr,key:this.key,frame:"separator"});this.materialCon.add([C,D,M,O,E]),this.materialGameScroll=new g.a(this.scene,{x:.5*i,y:n-220*this.dpr,width:i,height:70*this.dpr,zoom:this.scale,align:2,orientation:1,valuechangeCallback:void 0,celldownCallBack:function(t){e.materialTipsCon.visible=!0,e.onMaterialItemHandler(t)},cellupCallBack:function(t){e.materialTipsCon.visible=!1}}),this.add(this.materialGameScroll),this.materialTipsCon=this.scene.make.container(void 0,!1).setPosition(0,-20*this.dpr),this.materialTipsCon.visible=!1,this.materialCon.add(this.materialTipsCon);var B=109*this.dpr,I=42*this.dpr,A=new h.NinePatch(this.scene,0,0,B,I,this.key,"tips_bg",{left:20*this.dpr,top:20*this.dpr,right:20*this.dpr,bottom:20*this.dpr});A.setPosition(26*this.dpr,.5*-I),this.tipsbg=A;var R=this.scene.make.image({key:this.key,frame:"tips_arrow"}),k=this.scene.make.text({x:0,y:.5*-T+12*this.dpr,text:"蓝矿石",style:{color:"#844ED5",fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:90*this.dpr,useAdvancedWrap:!0}}},!1).setOrigin(0,.5).setPosition(-19*this.dpr,-I+10*this.dpr);this.materialTipsName=k;var L=this.scene.make.text({x:0,y:.5*-T+12*this.dpr,text:"的肌肤委屈饿换热器我和佛前",style:{color:"#333333",fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:100*this.dpr,useAdvancedWrap:!0}}},!1).setOrigin(0).setPosition(-19*this.dpr,-I+20*this.dpr);this.materialTipsDes=L,this.materialTipsCon.add([A,k,L,R]);var F=this.scene.textures.getFrame(this.key,"bprint_bg_2"),N=F.width+10*this.dpr*a,j=F.height+12*this.dpr*a,H={x:i*a/2,y:n*a*.5+145*this.dpr*a,table:{width:i*a,height:190*this.dpr*a,columns:2,cellWidth:N,cellHeight:j,reuseCellContainer:!0,cellPadX:40*this.dpr*a,zoom:this.scale},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new w(n,e.key,e.dpr,a),e.add(i)),i.setItemData(o),e.mSelectItem&&o&&o.id===e.mSelectItem.itemData.id&&(i.select=!0),i}};this.mGrideTable=new m.a(this.scene,H),this.mGrideTable.layout(),this.mGrideTable.on("cellTap",(function(t){t&&e.onSelectItemHandler(t)})),this.add(this.mGrideTable.table),this.resize(i,n),t.prototype.init.call(this),this.mShowData&&this.setComposeData(this.mShowData.skills)},ComposePanel.prototype.destroy=function(){t.prototype.destroy.call(this)},ComposePanel.prototype.setComposeData=function(t){this.mGrideTable.setItems(t);var e=this.mGrideTable.getCell(0);this.onSelectItemHandler(e.container)},ComposePanel.prototype.setComposeDetialData=function(t){this.mDetailBubble.setDetailData(t.productName,t.productDes),this.setDetailDisplay(t),this.setMaterialItems(t.materials)},ComposePanel.prototype.setDetailDisplay=function(t){var e=new a.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE_ITEM_RESOURCE;e.animations=t.productAnimations,e.display=t.productDisplay,e.avatar=t.productAvatar,e.display?this.mDetailDisplay.loadDisplay(e):e.avatar&&this.mDetailDisplay.loadAvatar(e)},ComposePanel.prototype.onSelectItemHandler=function(t){var e=t.itemData;this.emit("reqformula",e.id),t.select=!0,this.mSelectItem&&(this.mSelectItem.select=!1),this.mSelectItem=t,this.makeBtn.enable=e.active&&e.qualified},ComposePanel.prototype.setMaterialItems=function(t){var e=t.length,i=this.scale,n=[];this.materialGameScroll.clearItems();for(var o=0;o<e;o++){var a=new T(this.scene,this.key,this.dpr,i);a.y=0,n.push(a),a.setItemData(t[o]),a.setData("itemData",t[o]),this.materialGameScroll.addItem(a)}this.materialGameScroll.Sort()},ComposePanel.prototype.onMaterialItemHandler=function(t){var e=t.getWorldTransformMatrix();this.materialTipsCon.x=e.tx-.5*this.scaleWidth,this.materialTipsName.text=t.itemData.name,this.materialTipsDes.text=t.itemData.source;var i=this.materialTipsName.height+this.materialTipsDes.height+20*this.dpr,n=this.tipsbg.width;this.tipsbg.resize(n,i),this.tipsbg.y=.5*-this.tipsbg.height,this.materialTipsName.y=-i+15*this.dpr,this.materialTipsDes.y=-i+25*this.dpr},ComposePanel.prototype.onMakeHandler=function(){this.mSelectItem&&this.emit("reqUseFormula",this.mSelectItem.itemData.id)},ComposePanel.prototype.onInputPointUp=function(){this.materialTipsCon.visible=!1},ComposePanel.prototype.onBackHandler=function(){this.emit("hide")},ComposePanel}(s.BasePanel),S=function(t){function DetailBubble(e,i){var n=t.call(this,e)||this;n.dpr=i,n.mDetailBubble=n.scene.make.graphics(void 0,!1);var a=198*i,s=96*i;return n.mDetailBubble=n.scene.make.graphics(void 0,!1),n.mDetailBubble.fillStyle(16777215,.1),n.mDetailBubble.fillRoundedRect(0,0,a,s),n.mItemName=n.scene.make.text({x:7*n.dpr,y:9*n.dpr,text:"道具名称道具名称",style:{fontSize:12*n.dpr,fontFamily:o.a.DEFULT_FONT,color:"#8C55E1",align:"center"}}),n.mDesText=n.scene.make.text({x:8*i,y:30*i,style:{color:"#ffffff",fontSize:10*i,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:180*i,useAdvancedWrap:!0}}},!1),n.add([n.mDetailBubble,n.mItemName,n.mDesText]),n.setSize(a,s),n}return b(DetailBubble,t),DetailBubble.prototype.setDetailData=function(t,e){this.mItemName.setText(t),this.mDesText.setText(e),this.resize()},DetailBubble.prototype.resize=function(t,e){void 0===t&&(t=this.width);var i=this.mDesText.height+60*this.dpr;t===this.width&&i===this.height||(this.mDetailBubble.clear(),this.mDetailBubble.fillStyle(16777215,.1),this.mDetailBubble.fillRoundedRect(0,0,t,i),this.setSize(t,i))},DetailBubble}(Phaser.GameObjects.Container),w=function(t){function ComposeItem(e,i,n,a){var s=t.call(this,e)||this;s.dpr=n,s.key=i,s.zoom=a,s.bg=s.scene.make.image({key:s.key,frame:"bprint_bg_1"}),s.setSize(s.bg.width,s.bg.height),s.itemIcon=new u.DynamicImage(s.scene,0,0);var h=s.width,l=s.height;return s.newIcon=s.scene.make.image({key:s.key,frame:"tag_new"}),s.newIcon.setPosition(.5*-h+3*n,.5*-l+3*n),s.newText=s.scene.make.text({x:s.newIcon.x,y:s.newIcon.y,text:"N",style:{fontSize:11*s.dpr*a,fontFamily:o.a.DEFULT_FONT,color:"#ffffff",align:"center"}}).setOrigin(.5),s.qualityIcon=s.scene.make.image({key:s.key,frame:"tag_rank_a"}),s.qualityIcon.setPosition(.5*-h+.5*s.qualityIcon.width-2*n,.5*l-.5*s.qualityIcon.height),s.qualityTex=s.scene.make.text({x:s.qualityIcon.x,y:s.qualityIcon.y,text:"A",style:{fontSize:11*s.dpr*a,fontFamily:o.a.DEFULT_FONT,color:"#ffffff",align:"center"}}).setOrigin(.5),s.qualifiedIcon=s.scene.make.image({key:s.key,frame:"tag_ready"}),s.qualifiedIcon.setOrigin(1).setPosition(.5*h-3*n,.5*l-3*n),s.lockbg=s.scene.make.image({key:s.key,frame:"bprint_mask"}),s.lockIcon=s.scene.make.image({key:s.key,frame:"lock"}),s.add([s.bg,s.itemIcon,s.newIcon,s.newText,s.qualityIcon,s.qualityTex,s.qualifiedIcon,s.lockbg,s.lockIcon]),s}return b(ComposeItem,t),ComposeItem.prototype.setItemData=function(t){this.itemData=t;var e=t.active;this.newIcon.visible=e,this.newText.visible=e,this.qualityIcon.visible=e,this.qualityTex.visible=e,this.qualityTex.text=t.quality,this.qualifiedIcon.visible=e&&t.qualified,this.lockbg.visible=!t.active,this.lockIcon.visible=!t.active,this.setQualityTexture(t.quality),t.display&&this.setItemIcon(t.display),this.select=!1},Object.defineProperty(ComposeItem.prototype,"select",{set:function(t){t?this.bg.setFrame("bprint_bg_2"):this.bg.setFrame("bprint_bg_1")},enumerable:!1,configurable:!0}),ComposeItem.prototype.setItemIcon=function(t){var e=this,i=l.h.getOsdRes(t.texturePath);this.itemIcon.load(i,this,(function(){e.itemIcon.scale=e.dpr*e.zoom,e.itemIcon.setPosition(0,0)}))},ComposeItem.prototype.setQualityTexture=function(t){"A"===t?this.qualityIcon.setFrame("tag_rank_a"):"B"===t?this.qualityIcon.setFrame("tag_rank_b"):"C"===t&&this.qualityIcon.setFrame("tag_rank_c")},ComposeItem}(Phaser.GameObjects.Container),T=function(t){function ComposeMaterialItem(e,i,n,a){var s=t.call(this,e)||this;s.dpr=n,s.key=i,s.zoom=a;var h=s.scene.make.image({key:s.key,frame:"source_bg"});return s.itemIcon=new u.DynamicImage(e,0,0),s.itemCount=new d.a(s.scene,0,0,{}).setOrigin(.5).setFontSize(11*n).setFontFamily(o.a.DEFULT_FONT),s.add([h,s.itemIcon,s.itemCount]),s.setSize(h.width,h.height),s.itemCount.y=.5*s.height,s}return b(ComposeMaterialItem,t),ComposeMaterialItem.prototype.setItemData=function(t){var e=this;this.itemData=t,this.itemCount.text=this.getCountText(t.count,t.neededCount);var i=l.h.getOsdRes(t.display.texturePath);this.itemIcon.load(i,this,(function(){e.itemIcon.scale=e.dpr*e.zoom,e.itemIcon.setPosition(0,0)}))},ComposeMaterialItem.prototype.getCountText=function(t,e){var i=t>=e?"#ffffff":"#ff0000";return"[stroke="+i+"][color="+i+"]"+t+"[/color][/stroke]/"+e},ComposeMaterialItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"UIAtlasName",(function(){return n})),i.d(e,"UIAtlasKey",(function(){return o}));var n=function(){function UIAtlasName(){}return UIAtlasName.common="common/ui_base",UIAtlasName}(),o=function(){function UIAtlasKey(){}return UIAtlasKey.commonKey="common_key",UIAtlasKey}()},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInPanel",(function(){return l}));var n,o=i(6),a=i(5),s=i(9),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function CutInPanel(e,i){var n=t.call(this,e,i)||this;return n.key="cut_in",n}return h(CutInPanel,t),CutInPanel.prototype.show=function(t){var e=this;if(this.mShowData=t,this.mInitialized){if(t&&t.length>0){var i=t[0].text;this.mName&&this.mName.setText(i[0].text)}else this.mName&&this.mName.setText("???");var n=this.scene.cameras.main.width;this.x=n+this.width/2;var o=this.scene.cameras.main.width/2;this.scene.tweens.timeline({targets:this,duration:300,tweens:[{x:o,alpha:1,ease:"Sine.easeInOut"},{delay:2e3,y:this.y-10*this.dpr,alpha:0}],onComplete:function(){e.emit("close")}})}else this.preload()},CutInPanel.prototype.resize=function(t,e){this.y=140*this.dpr},CutInPanel.prototype.preload=function(){this.scene.load.image(this.key,a.h.getUIRes(this.dpr,"cut_in/cut_in_bg.png")),t.prototype.preload.call(this)},CutInPanel.prototype.init=function(){var e=this.scene.make.image({key:this.key},!1);this.setSize(e.width*this.scale,e.height*this.scale),this.mName=this.scene.make.text({style:{color:"#ffcc33",fontSize:18*this.dpr,fotnFamily:s.a.DEFULT_FONT}},!1).setOrigin(.5),this.mName.setFontStyle("bold"),this.mName.setStroke("#000000",1*this.dpr),this.add([e,this.mName]),t.prototype.init.call(this),this.resize(this.scene.cameras.main.width,this.scene.cameras.main.height),this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this)},CutInPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInMenu",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function CutInMenu(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(CutInMenu,t),CutInMenu.prototype.register=function(){this.connection&&this.connection.addPacketListener(this)},CutInMenu.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},CutInMenu.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},CutInMenu.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},CutInMenu.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},CutInMenu.prototype.reqRightButton=function(t,e){var i=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),n=i.content;n.uiId=t,n.componentId=e,this.connection.send(i)},Object.defineProperty(CutInMenu.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),CutInMenu}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInMenuPanel",(function(){return l}));var n,o=i(6),a=i(25),s=i(48),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function CutInMenuPanel(e,i){var n=t.call(this,e,i)||this;return n.key="cutinmenupanel",n.mapPop=new Map,n.world=i,n}return h(CutInMenuPanel,t),CutInMenuPanel.prototype.resize=function(e,i){t.prototype.resize.call(this,e,i),this.setSize(e,i)},CutInMenuPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.addListen()):this.preload())},CutInMenuPanel.prototype.addListen=function(){this.mInitialized},CutInMenuPanel.prototype.removeListen=function(){this.mInitialized},CutInMenuPanel.prototype.preload=function(){this.addAtlas(this.key,"cutInmenu/cutInmenu.png","cutInmenu/cutInmenu.json"),t.prototype.preload.call(this)},CutInMenuPanel.prototype.init=function(){var e=this.scaleWidth,i=this.scaleHeight;this.rightPopButton=new c(this.scene,this.key,this.dpr);var n=e+.5*this.rightPopButton.width;this.rightPopButton.setPosition(n,.5*i),this.rightPopButton.setClickHandler(new s.a(this,this.onRightClickHandler)),this.add(this.rightPopButton),this.resize(e,i),t.prototype.init.call(this),this.openRightPopUI()},CutInMenuPanel.prototype.destroy=function(){t.prototype.destroy.call(this)},CutInMenuPanel.prototype.openRightPopUI=function(){var t=this,e=this.scaleWidth,i=e+.5*this.rightPopButton.width;if(this.mapPop.has(this.rightPopButton)){var n=this.mapPop.get(this.rightPopButton);clearTimeout(n),this.mapPop.delete(this.rightPopButton)}else{var o=e-15*this.dpr,a=this.rightPopButton;this.rightPopButton.x=i,this.scene.tweens.add({targets:a,x:{value:o,duration:300,ease:"Bounce.easeOut"}})}var s=setTimeout((function(){t.rightPopButton.visible=!1,t.mapPop.delete(t.rightPopButton),t.rightPopButton.x=i,t.emit("hide")}),8e3);this.mapPop.set(this.rightPopButton,s)},CutInMenuPanel.prototype.onRightClickHandler=function(){var t=this.mShowData[0];this.emit("rightButton",t.id,t.button[0].node.id)},CutInMenuPanel}(o.BasePanel),c=function(t){function RightPopContainer(e,i,n){var o=t.call(this,e)||this;o.dpr=n,o.key=i;var s=o.scene.make.image({key:o.key,frame:"minebag_bg"});return o.minecarBtn=new a.a(o.scene,o.key,"minecar","minecar"),o.minecarBtn.setPosition(-12*n,.5*-o.minecarBtn.height),o.teximg=o.scene.make.image({key:o.key,frame:"text_minebag"}),o.teximg.setPosition(o.minecarBtn.x,2*n),o.add([s,o.minecarBtn,o.teximg]),o.minecarBtn.on("Tap",o.onClickHandler,o),o.setSize(s.width,s.height),o}return h(RightPopContainer,t),RightPopContainer.prototype.setClickHandler=function(t){this.clickHandler=t},RightPopContainer.prototype.setPopData=function(t){this.popData=t},RightPopContainer.prototype.onClickHandler=function(){this.clickHandler&&this.clickHandler.runWith(this.popData)},RightPopContainer}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"DebugLogger",(function(){return m}));var n,o=i(6),a=i(5),s=i(8),h=i(103),l=i(26),c=i(27),p=i(9),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function DebugLogger(e,i){var n=t.call(this,e,i)||this;return n.mDelay=0,n.setTween(!1),n}return u(DebugLogger,t),DebugLogger.prototype.addListen=function(){this.mClsBtn.on("pointerup",this.closeHandler,this)},DebugLogger.prototype.removeListen=function(){this.mWorld.game.device.os.desktop||this.mClsBtn.off("pointerup",this.closeHandler,this)},DebugLogger.prototype.show=function(t){this.mInitialized?(this.mShow=!0,this.resize()):this.preload()},DebugLogger.prototype.resize=function(t,e){this.mWorld.getSize();this.showDescTxT(),this.update(0)},DebugLogger.prototype.update=function(t){var e=this.mWorld.roomManager.currentRoom.now();this.mDelay-e<3e3&&(this.showDescTxT(),this.mTimeTF.setText("FPS:"+t),this.mDescTF.setText(this.mDescTxt),this.mDelay=e)},DebugLogger.prototype.preload=function(){this.mScene&&(this.mScene.load.atlas("clsBtn",a.h.getRes("ui/common/common_clsBtn.png"),a.h.getRes("ui/common/common_clsBtn.json")),t.prototype.preload.call(this))},DebugLogger.prototype.init=function(){this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this);var e=this.mWorld.getSize();this.mBgWidth=400,this.mBgHeight=e.height>>1;var i=this.scene.cameras.main.width/2,n=this.scene.cameras.main.height;this.mBackground=this.scene.make.graphics(void 0,!1),this.mBackground.fillStyle(0,.6),this.mBackground.fillRect(0,0,i,n),this.setSize(i,n),this.add(this.mBackground),this.mTimeTF=this.mScene.make.text({style:{x:0,y:0,fontFamily:p.a.DEFULT_FONT,fontSize:14*this.dpr,origin:{x:0,y:0},wordWrap:{width:e.width-10,height:20,useAdvancedWrap:!0}}},!1),this.mDescTF=this.mScene.make.text({style:{x:0,y:20*this.dpr,fontFamily:p.a.DEFULT_FONT,fontSize:14*this.dpr,origin:{x:0,y:0},wordWrap:{width:this.width-10*this.dpr,height:this.height-30,useAdvancedWrap:!0}}},!1),this.add(this.mTimeTF),this.add(this.mDescTF),this.mWorld.game.device.os.desktop||(this.mClsBtn=new l.IconBtn(this.mScene,this.mWorld,{key:c.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/common/common_clsBtn.png",jsonUrl:"ui/common/common_clsBtn.json"}),this.mClsBtn.x=this.width,this.mClsBtn.y=10*this.dpr,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn)),t.prototype.init.call(this),this.addListen()},DebugLogger.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(h.DebugLoggerMediator.NAME).resize()},DebugLogger.prototype.showDescTxT=function(){this.mWorld.getSize().width,this.mWorld.getSize().height;var t="WEBGL";this.mWorld.game.config.renderType===Phaser.CANVAS?t="CANVAS":this.mWorld.game.config.renderType===Phaser.HEADLESS&&(t="HEADLESS");var e=this.mWorld.getConfig();this.mDescTxt="\n            rendertype: "+t+"\n            size: "+e.width+" "+e.height+"\n            device size: "+this.mWorld.getSize().width.toFixed(2)+" "+this.mWorld.getSize().height.toFixed(2)+"\n            scene scale: "+this.mWorld.scaleRatio+"\n            devicePixel: "+this.mWorld.uiRatio+"\n            ui scale: "+this.mWorld.uiScale.toFixed(4)},DebugLogger.prototype.closeHandler=function(){this.mWorld.uiManager.getMediator(h.DebugLoggerMediator.NAME).hide()},DebugLogger.prototype.showErrTxt=function(){var t=s.a.getInstance().getErrorList();if(t){var e="";t.forEach((function(t){e+="\n"+t})),this.mDescTxt+=e}},DebugLogger}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"EquipUpgrade",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function EquipUpgrade(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(EquipUpgrade,t),EquipUpgrade.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MINING_MODE_ACTIVE_EQUIPMENT,this.onActiveEquipmend))},EquipUpgrade.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},EquipUpgrade.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},EquipUpgrade.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},EquipUpgrade.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(EquipUpgrade.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),EquipUpgrade.prototype.reqEquipedEquipment=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_RES_VIRTUAL_WORLD_MINING_MODE_EQUIP_EQUIPMENT);e.content.equipmentId=t,this.connection.send(e)},EquipUpgrade.prototype.reqActiveEquipment=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_RES_VIRTUAL_WORLD_MINING_MODE_ACTIVE_EQUIPMENT);e.content.equipmentId=t,this.connection.send(e)},EquipUpgrade.prototype.onActiveEquipmend=function(t){var e=t.content;this.mEvent.emit("activeEquip",e.mineEquipment)},EquipUpgrade}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"EquipUpgradeItem",(function(){return p}));var n,o=i(9),a=i(16),s=i(5),h=i(42),l=i(12),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function EquipUpgradeItem(e,i,n,o,a,s){var h=t.call(this)||this;return h.haveEquiped=!1,h.cellWidth=0,h.cellHeight=0,h.dpr=n,h.zoom=o,h.key=a,h.commonKey=s,h.mScene=e,h.mContainer=i,h.create(),h}return c(EquipUpgradeItem,t),EquipUpgradeItem.prototype.setEquipItems=function(t){var e=t.equipmentType,i=t.mineEquipments;this.titleName.text=e;for(var n=0,o=i;n<o.length;n++){if(o[n].selected){this.haveEquiped=!0;break}0}this.gridTable.setItems(i),this.haveEquiped&&this.setBgTexture(t.isblue)},EquipUpgradeItem.prototype.setTransPosition=function(t,e){this.bg.x+=t,this.bg.y+=e,this.titleName.x+=t,this.titleName.y+=e,this.bottombg.x+=t,this.bottombg.y+=e,this.equipName.x+=t,this.equipName.y+=e,this.penetrationText.x+=t,this.penetrationText.y+=e,this.equipDes.x+=t,this.equipDes.y+=e,this.topbg.x+=t,this.topbg.y+=e,this.unlockbtn.x+=t,this.unlockbtn.y+=e,this.costNum.x+=t,this.costNum.y+=e,this.diamondIcon.x+=t,this.diamondIcon.y+=e,this.curEquipItem.x+=t,this.curEquipItem.y+=e,this.gridTable.refreshPos(t,e-10*this.dpr*this.zoom)},Object.defineProperty(EquipUpgradeItem.prototype,"displayList",{get:function(){return[this.bg,this.topbg,this.bottombg,this.titleName,this.equipName,this.penetrationText,this.equipDes]},enumerable:!1,configurable:!0}),EquipUpgradeItem.prototype.refreshEquipData=function(t,e){this.gridTable.items[e]=t,this.gridTable.refresh(),this.updateEquipItem(this.curEquipItem)},EquipUpgradeItem.prototype.destroy=function(){this.unlockbtn&&this.unlockbtn.off("pointerup",this.onUnlockEquipHandler,this),t.prototype.destroy.call(this),this.gridTable&&this.gridTable.destroy(),this.bg=null,this.topbg=null,this.bottombg=null,this.gridTable=null,this.titleName=null,this.equipName=null,this.penetrationText=null,this.equipDes=null,this.unlockbtn=null,this.costNum=null,this.diamondIcon=null,this.curEquipItem=null},EquipUpgradeItem.prototype.setBgTexture=function(t){var e=t?"topbg1":"topbg",i=t?"bottombg1":"bottombg",n=t?"#0867AE":"#8F4300";this.topbg.setTexture(this.key,e),this.bottombg.setTexture(this.key,i),this.titleName.setColor(n).setStroke(n,1),this.equipName.setColor(n).setStroke(n,1),this.penetrationText.setColor(n).setStroke(n,1)},EquipUpgradeItem.prototype.create=function(){this.bg=this.mScene.make.image({x:0,y:-21*this.dpr,key:this.key,frame:"bg1"}),this.topbg=this.mScene.make.image({x:0,y:-61*this.dpr,key:this.key,frame:"topbg"}),this.titleName=this.mScene.make.text({x:0,y:this.topbg.y+0*this.dpr,text:"矿镐",style:{blod:!0,color:"#8F4300",fontSize:14*this.dpr,font:this.getBoldFont(14*this.dpr)}}).setOrigin(.5,.5),this.bottombg=this.mScene.make.image({x:0,y:42*this.dpr,key:this.key,frame:"bottombg"}),this.equipName=this.mScene.make.text({x:-120*this.dpr,y:15*this.dpr,text:"精铁镐",style:{color:"#8F4300",fontSize:14*this.dpr,font:this.getBoldFont(14*this.dpr)}}),this.penetrationText=this.mScene.make.text({x:-60*this.dpr,y:16*this.dpr,text:"穿透力:10",style:{color:"#8F4300",fontSize:12*this.dpr,fontFamily:o.a.DEFULT_FONT}}),this.equipDes=this.mScene.make.text({x:-120*this.dpr,y:35*this.dpr,text:"描述文字",style:{color:"#000000",fontSize:10*this.dpr,fontFamily:o.a.DEFULT_FONT,wordWrap:{width:130*this.dpr,useAdvancedWrap:!0}}}),this.equipDes.setStroke("#000000",1),this.mContainer.add([this.bg,this.topbg,this.bottombg,this.titleName,this.equipName,this.penetrationText,this.equipDes]),this.createGridTable(),this.createBtn()},EquipUpgradeItem.prototype.createGridTable=function(){var t=this,e=this.mScene.textures.getFrame(this.key,"equipbg"),i=e.width+10*this.dpr*this.zoom,n=e.height+30*this.dpr*this.zoom;this.cellWidth=i,this.cellHeight=n;var o={scrollMode:1,table:{width:259*this.dpr*this.zoom,height:77*this.dpr*this.zoom,columns:1,cellWidth:i,cellHeight:n,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0},clamplChildOY:!1,createCellContainerCallback:function(e,o){var a=e.scene,s=e.item,h=e.index;return null===o&&((o=new u(a,t.dpr,t.key,t.zoom)).setSize(i,n),t.mContainer.add(o),o.setChildPosition()),o.setData({item:s}),o.setItemData(s,h),null==t.curEquipItem&&(t.haveEquiped?s.selected&&t.onSelectItemHandler(o):t.onSelectItemHandler(o)),o}};this.gridTable=new h.a(this.mScene,o),this.gridTable.layout(),this.gridTable.on("cellTap",(function(e){t.onSelectItemHandler(e)})),this.mContainer.add(this.gridTable.table)},EquipUpgradeItem.prototype.onSelectItemHandler=function(t){this.curEquipItem&&this.curEquipItem.setSelect(!1);var e=t.itemData;this.updateEquipItem(t),this.curEquipItem=t,e.owned&&!e.selected&&this.emit("reqEquiped",e.id)},EquipUpgradeItem.prototype.updateEquipItem=function(t){var e=t.itemData;this.penetrationText.text=e.buffDisplayNames[0],this.equipDes.text=e.description,this.equipName.text=e.name,this.costNum.text=e.price+"",e.owned?this.unlockbtn.visible=!1:this.unlockbtn.visible=!0,e.qualified?(this.unlockCondition.visible=!1,this.unlockbtn.setInteractive()):e.owned||(this.unlockCondition.visible=!0,this.unlockCondition.text=e.conditionDisplayNames[0],this.unlockbtn.disableInteractive()),null==e.price?(this.costNum.visible=!1,this.diamondIcon.visible=!1,this.btnName.setPosition(0,0*this.dpr)):(this.costNum.visible=!0,this.diamondIcon.visible=!0,this.btnName.setPosition(0,6*this.dpr)),t.setSelect(!0)},EquipUpgradeItem.prototype.onUnlockEquipHandler=function(){this.emit("reqActive",this.curEquipItem.itemData.id)},EquipUpgradeItem.prototype.createBtn=function(){this.unlockCondition=this.mScene.make.text({x:0,y:-26*this.dpr,text:"解锁条件",style:{color:"#000000",fontSize:10*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5,.5),this.unlockbtn=this.mScene.make.container(void 0,!1);var t=new l.NinePatch(this.mScene,0,0,88*this.dpr*this.zoom,31*this.dpr*this.zoom,this.commonKey,"yellow_btn_normal",{left:12*this.dpr*this.zoom,top:12*this.dpr*this.zoom,right:12*this.dpr*this.zoom,bottom:12*this.dpr*this.zoom});this.diamondIcon=this.mScene.make.image({x:-15*this.dpr,y:-8*this.dpr,key:this.commonKey,frame:"test_diamond"}),this.costNum=this.mScene.make.text({x:0,y:-8*this.dpr,text:"1000",style:{color:"#ffffff",fontSize:10*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(0,.5),this.btnName=this.mScene.make.text({x:0,y:6*this.dpr,text:"立即解锁",style:{color:"#8F4300",fontSize:13*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5,.5),this.costNum.setStroke("#ffffff",1),this.btnName.setStroke("#8F4300",1),this.unlockCondition.setStroke("#000000",1),this.unlockbtn.setPosition(70*this.dpr,48*this.dpr),this.unlockbtn.setSize(t.width,t.height),this.unlockbtn.add([this.unlockCondition,t,this.diamondIcon,this.costNum,this.btnName]),this.unlockbtn.on("pointerup",this.onUnlockEquipHandler,this),this.mContainer.add(this.unlockbtn)},EquipUpgradeItem.prototype.getBoldFont=function(t){return"bold "+t+"px Source Han Sans"},EquipUpgradeItem}(Phaser.Events.EventEmitter),u=function(t){function EquipItemCell(e,i,n,o){var a=t.call(this,e)||this;return a.index=0,a.isSelect=!1,a.isUnlock=!1,a.dpr=i,a.key=n,a.zoom=o,a.create(),a}return c(EquipItemCell,t),EquipItemCell.prototype.setItemData=function(t,e){var i=this;this.itemData=t,this.index=e;var n=s.h.getOsdRes(t.display.texturePath);this.equipIcon.load(n,this,(function(){i.equipIcon.scale=i.dpr*i.zoom})),this.setEquiped(t.selected,t.owned),this.setSelect(this.isSelect)},EquipItemCell.prototype.setSelect=function(t){this.isSelect=t;var e="equipbg";t||(e=this.isUnlock?"equipbg2":"equipbg1"),this.itemData.selected&&(e="equipbg2"),this.bg.setTexture(this.key,e)},EquipItemCell.prototype.setChildPosition=function(){var t=.5*this.bg.width+10*this.dpr*this.zoom,e=this.height-10*this.dpr*this.zoom;this.bg.setPosition(t,e),t+=1*this.dpr*this.zoom,e=.5*this.height+2*this.dpr*this.zoom,this.equipIcon.setPosition(t,e),t+=22*this.dpr*this.zoom,e=8*this.dpr*this.zoom,this.unlock.setPosition(t,e)},EquipItemCell.prototype.setEquiped=function(t,e){this.isUnlock=e,this.unlock.visible=!1,t?(this.isUnlock=!0,this.unlock.visible=!0,this.unlock.setTexture(this.key,"ok")):this.isUnlock||(this.unlock.visible=!0,this.unlock.setTexture(this.key,"lock"))},EquipItemCell.prototype.create=function(){this.bg=this.scene.make.image({x:0,y:-10*this.dpr*this.zoom,key:this.key,frame:"equipbg"}),this.equipIcon=new a.DynamicImage(this.scene,15*this.dpr*this.zoom,0*this.dpr*this.zoom),this.unlock=this.scene.make.image({x:30*this.dpr*this.zoom,y:-10*this.dpr*this.zoom,key:this.key,frame:"lock"}),this.add([this.bg,this.equipIcon,this.unlock])},EquipItemCell}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e);var n,o=i(6),a=i(9),s=i(210),h=i(12),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function EquipUpgradePanel(e,i){var n=t.call(this,e,i)||this;return n.key="equip_upgrade",n.commonkey="common_key",n.equipItems=[],n.scale=1,n}return l(EquipUpgradePanel,t),EquipUpgradePanel.prototype.resize=function(e,i){var n=this.scene.cameras.main.width/this.scale,o=this.scene.cameras.main.height/this.scale;t.prototype.resize.call(this,e,i),this.setSize(n,o),this.bg.x=n/2,this.bg.y=o/2,this.tilteName.x=this.bg.x,this.tilteName.y=this.bg.y-this.bg.height/2,this.titlebg.x=this.bg.x,this.titlebg.y=this.bg.y-this.bg.height/2,this.closeBtn.x=this.bg.x+this.bg.width/2-10*this.dpr*this.scale,this.closeBtn.y=this.bg.y-this.bg.height/2+10*this.dpr*this.scale,this.blackBg.clear(),this.blackBg.fillStyle(0,.5),this.blackBg.fillRoundedRect(-this.x,-this.y,n,o),this.add([this.blackBg,this.bg,this.closeBtn,this.titlebg,this.tilteName])},EquipUpgradePanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.refreshData(),this.addListen()):this.preload())},EquipUpgradePanel.prototype.addListen=function(){this.mInitialized&&this.closeBtn.on("pointerup",this.OnClosePanel,this)},EquipUpgradePanel.prototype.removeListen=function(){this.mInitialized&&this.closeBtn.off("pointerup",this.OnClosePanel,this)},EquipUpgradePanel.prototype.preload=function(){this.addAtlas(this.key,"equip_upgrade/mine_eqpm.png","equip_upgrade/mine_eqpm.json"),this.addAtlas(this.commonkey,"common/ui_base.png","common/ui_base.json"),t.prototype.preload.call(this)},EquipUpgradePanel.prototype.init=function(){var e=this.scene.cameras.main.width/this.scale,i=this.scene.cameras.main.height/this.scale;this.setSize(e,i),this.blackBg=this.scene.make.graphics(void 0,!1),this.bg=new h.NinePatch(this.scene,0,0,300*this.dpr,300*this.dpr,this.commonkey,"bg",{left:40,top:40,bottom:40,right:40});var n=.5*-this.bg.height;this.titlebg=this.scene.make.image({x:0,y:n,key:this.key,frame:"titlebg"});var o="bold "+15*this.dpr+"px Source Han Sans";this.tilteName=this.scene.make.text({x:0,y:n,text:"装备",style:{font:o,color:"#8F4300",fontSize:15*this.dpr,fontFamily:a.a.DEFULT_FONT}}).setOrigin(.5,0),this.closeBtn=this.scene.make.image({x:.5*this.bg.width-5*this.dpr,y:n+5*this.dpr,key:this.commonkey,frame:"close"}),this.tilteName.setStroke("#8F4300",1),this.closeBtn.setInteractive(),this.add([this.blackBg,this.bg,this.closeBtn,this.titlebg,this.tilteName]),this.resize(this.scene.cameras.main.width,this.scene.cameras.main.height),t.prototype.init.call(this)},EquipUpgradePanel.prototype.setEquipDatas=function(t){if(this.content=t,this.mInitialized){var e=this.scene.cameras.main.width/this.scale,i=this.scene.cameras.main.height/this.scale,n=t.mineEquipments,o=175*this.dpr*n.length-(n.length>=2?40*(n.length-2):0),a=155*this.dpr;this.resetPosition(this.bg.width,o);for(var h=.5*-o+100*this.dpr,l=0,c=0,p=n;c<p.length;c++){var u=p[c];u.isblue=l%2!=0;var m=new s.EquipUpgradeItem(this.scene,this,this.dpr,this.scale,this.key,this.commonkey);m.on("reqActive",this.onReqActiveEquipment,this),m.on("reqEquiped",this.onReqEquipedEquipment,this),m.setEquipItems(u),m.setTransPosition(e/2,h+i/2),this.equipItems.push(m),h+=a,l++}this.resize(e,i)}},EquipUpgradePanel.prototype.setActiveEquipment=function(t){for(var e=0,i=0,n=this.content.mineEquipments;i<n.length;i++){for(var o=n[i],a=this.equipItems[e],s=-1,h=0;h<o.mineEquipments.length;h++){var l=o.mineEquipments[h];l.id===t.id?(o.mineEquipments[h]=t,a.refreshEquipData(t,h),s=h):l.selected&&(l.selected=!1)}s>=0&&a.refreshEquipData(t,s),e++}},EquipUpgradePanel.prototype.destroy=function(){if(this.equipItems){for(var e=0,i=this.equipItems;e<i.length;e++){i[e].destroy()}this.equipItems.length=0}this.equipItems=null,this.content=null,t.prototype.destroy.call(this)},EquipUpgradePanel.prototype.getEuipDatas=function(){for(var t=[],e=0;e<3;e++){var i={};i.name=0===e?"矿镐":"矿车",i.items=[],i.isblue=!(e%2==0);for(var n=0;n<15;n++){var o={};o.name="矿镐"+n,o.penetration=10+n,o.des="describle",o.cost=100*n,o.unlock=!1,i.items.push(o)}t.push(i)}return t},EquipUpgradePanel.prototype.refreshData=function(){var t=this.getData("upgradeData");t&&this.setEquipDatas(t)},EquipUpgradePanel.prototype.resetPosition=function(t,e){this.bg.resize(t,e);var i=.5*-e;this.titlebg.setPosition(0,i),this.tilteName.setPosition(0,i),this.closeBtn.setPosition(.5*t-8*this.dpr,i+8*this.dpr)},EquipUpgradePanel.prototype.OnClosePanel=function(){this.emit("hide")},EquipUpgradePanel.prototype.onReqActiveEquipment=function(t){this.emit("reqActive",t)},EquipUpgradePanel.prototype.onReqEquipedEquipment=function(t){this.emit("reqEquiped",t)},EquipUpgradePanel}(o.BasePanel);e.default=c},function(t,e,i){"use strict";i.r(e),i.d(e,"FurniBag",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function FurniBag(e,i){var n=t.call(this)||this;return n.world=e,n.mSceneType=i,n.mEvent=new Phaser.Events.EventEmitter,n}return s(FurniBag,t),FurniBag.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_GET_PACKAGE_CATEGORIES,this.onPackageCategoriesHandler),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE,this.onQueryMarketPackage),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE_ITEM_RESOURCE,this.onQueryCommodityResultHandler),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_QUERY_EDIT_PACKAGE,this.onQueryEditPackage),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_PKT_RESET_AVATAR,this.onQueryResetAvatar))},FurniBag.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},FurniBag.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},FurniBag.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},FurniBag.prototype.getCategories=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_PACKAGE_CATEGORIES);e.content.category=t,this.connection.send(e),this.categoryType=t},FurniBag.prototype.queryPackage=function(t,e){this.mSceneType===a.op_def.SceneTypeEnum.NORMAL_SCENE_TYPE?this.queryMarketPackage(t,e):this.queryEditPackage(t,e)},FurniBag.prototype.queryCommodityResource=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_QUERY_PACKAGE_ITEM_RESOURCE);e.content.id=t,this.connection.send(e)},FurniBag.prototype.addFurniToScene=function(t){if(this.mSceneType===a.op_def.SceneTypeEnum.EDIT_SCENE_TYPE){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_SELECTED_SPRITE);e.content.id=t,this.connection.send(e)}},FurniBag.prototype.enterEditAndSelectedSprite=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENABLE_AND_SELECTED_SPRITE);e.content.id=t,this.connection.send(e)},FurniBag.prototype.seachPackage=function(t,e){this.queryPackage(e,t)},FurniBag.prototype.sellProps=function(t,e,i){var n=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_SELL_PACKAGE_ITEM),s=n.content;s.category=i;var h=a.op_client.CountablePackageItem.create(t);h.count=e,s.items=[h],s.totalPrice=h.sellingPrice,s.totalPrice.price*=e,this.connection.send(n)},FurniBag.prototype.querySaveAvatar=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_DRESS_UP_AVATAR);e.content.avatarItemIds=t,this.connection.send(e)},FurniBag.prototype.queryResetAvatar=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PKT_RESET_AVATAR);this.connection.send(e)},FurniBag.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},FurniBag.prototype.onPackageCategoriesHandler=function(t){var e=t.content;e.category===this.categoryType&&this.mEvent.emit("packageCategory",e.subcategory)},FurniBag.prototype.onQueryMarketPackage=function(t){var e=t.content;e.category===this.categoryType&&this.mEvent.emit("queryPackage",e)},FurniBag.prototype.onQueryEditPackage=function(t){var e=t.content;e.category===this.categoryType&&this.mEvent.emit("queryPackage",e)},FurniBag.prototype.onQueryCommodityResultHandler=function(t){this.mEvent.emit("queryCommodityResource",t.content)},FurniBag.prototype.onQueryResetAvatar=function(t){var e=t.content;this.mEvent.emit("queryResetAvatar",e)},FurniBag.prototype.queryMarketPackage=function(t,e){var i=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_QUERY_PACKAGE),n=i.content;n.category=this.categoryType,n.page=1,n.perPage=30,n.subcategory=t,n.queryString=e,this.connection.send(i)},FurniBag.prototype.queryEditPackage=function(t,e){var i=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_QUERY_EDIT_PACKAGE),n=i.content;n.category=this.categoryType,n.page=1,n.perPage=30,n.subcategory=t,n.queryString=e,this.connection.send(i)},Object.defineProperty(FurniBag.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),FurniBag}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"FurniBagPanel",(function(){return w}));var n,o=i(6),a=i(31),s=i(55),h=i(9),l=i(3),c=i(16),p=i(104),u=i(5),m=i(99),d=i(72),f=i(12),y=i(48),g=i(25),_=i(101),v=i(42),b=i(198),P=i(295),S=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),w=function(t){function FurniBagPanel(e,i,n){var o=t.call(this,e,i)||this;return o.key="furni_bag",o.commonkey="common_key",o.seachKey="key.seach",o.topBtns=[],o.mEnableEdit=!1,o.mInputBoo=!1,o.mSelectedItemData=[],o.mSceneType=n,o.scale=1,o.setInteractive(),o}return S(FurniBagPanel,t),FurniBagPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,n,o);var a=this.mWorld.uiScale;this.mBackground.clear(),this.mBackground.fillGradientStyle(7304703,7304703,314367,314367),this.mBackground.fillRect(0,0,n*a,o*a),this.mShelfContainer.setSize(n,295*this.dpr*a),this.mShelfContainer.y=o-this.mShelfContainer.height,this.mDetailBubble.y=this.mShelfContainer.y-10*this.dpr*a-this.mDetailBubble.height,this.mCategoriesBar.clear(),this.mCategoriesBar.fillStyle(3394815),this.mCategoriesBar.fillRect(0,0,n,40*this.dpr*a),this.mCategoriesBar.fillStyle(52428),this.mCategoriesBar.fillRect(0,40*this.dpr*a,n,3*this.dpr*a),this.mBg.x=n/2,this.mBg.y=this.mBg.height/2+10*this.dpr*a,this.mAdd.x=n-this.mAdd.width/2-10*this.dpr,this.mAdd.y=this.mShelfContainer.y-this.mAdd.height/2-9*this.dpr*a,this.useBtn.x=this.mAdd.x,this.useBtn.y=this.mAdd.y,this.sellBtn.x=this.mAdd.x-this.sellBtn.width-10*this.dpr,this.sellBtn.y=this.mAdd.y,this.resetBtn.x=this.mAdd.x+25*this.dpr,this.resetBtn.y=this.mAdd.y,this.saveBtn.x=this.resetBtn.x-(this.saveBtn.width+this.resetBtn.width)/2-10*this.dpr,this.saveBtn.y=this.resetBtn.y,this.mDetailDisplay.x=n/2,this.mDetailDisplay.y=this.mBg.y,this.mPropGrid.refreshPos(this.mShelfContainer.width/2,this.mShelfContainer.y+170*this.dpr*a,8*this.dpr*a,3*this.dpr*a),this.setSize(n,o)},FurniBagPanel.prototype.setCategories=function(t){this.mPreCategoryBtn=null,this.mSelectedCategeories=null;var e=this.mWorld.uiScale,i=60*this.dpr*e,n=41*this.dpr*e,o=[];this.mSeachInput.parentContainer&&this.closeSeach(null),this.mCategoryScroll.clearItems();var a=new g.a(this.scene,this.key,"seach_normal","seach_down");a.setData("item",{key:this.seachKey,value:"搜索"}),a.y=n-40*this.dpr*e,this.mCategoryScroll.addItem(a);for(var s=0;s<t.length;s++){var h=new p.TextButton(this.scene,this.dpr,e,t[s].value,0,0);h.x=s*i,h.y=n-h.text.height-40*this.dpr*e>>1,h.setData("item",t[s]),h.setSize(i,n),this.mCategoryScroll.addItem(h),o[s]=h,h.setFontSize(17*this.dpr*e),h.setFontStyle("bold")}o.length>1&&this.onSelectSubCategoryHandler(o[0]),this.updateCategeoriesLoc(!1)},FurniBagPanel.prototype.setProp=function(t){if(t){var e=t.length;if(e<24&&(t=t.concat(new Array(24-e))),this.mPropGrid.setItems(t),this.categoryType!==l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_AVATAR){var i=this.mPropGrid.getCell(0);this.onSelectItemHandler(i.container)}else if(0===this.mSelectedItemData.length)for(var n=0,o=this.mPropGrid.getCells();n<o.length;n++){if(i=o[n]){var a=i.container.getData("item");a&&a.rightSubscript===l.op_pkt_def.PKT_Subscript.PKT_SUBSCRIPT_CHECKMARK&&this.onSelectItemHandler(i.container)}}}},FurniBagPanel.prototype.displayAvatar=function(){var t=new l.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_PACKAGE_ITEM_RESOURCE;t.avatar=new l.op_gameconfig.Avatar;var e=this.mWorld.roomManager.currentRoom.playerManager.actor.model.avatar;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n&&(t.avatar[i]=n)}var o=new Phaser.Geom.Point(0,80);this.mDetailDisplay.loadAvatar(t,2,o)},FurniBagPanel.prototype.setSelectedResource=function(t){if(t.display)this.mDetailDisplay.loadDisplay(t);else if(t.avatar){var e=this.mWorld.roomManager.currentRoom.playerManager.actor.model.avatar;for(var i in e){if(e.hasOwnProperty(i))(s=e[i])&&(t.avatar[i]=s)}for(var n=0,o=this.mSelectedItemData;n<o.length;n++){var a=o[n].avatar;for(var i in a){var s;if(a.hasOwnProperty(i))(s=a[i])&&(t.avatar[i]=s)}}var h=new Phaser.Geom.Point(0,80);this.mDetailDisplay.loadAvatar(t,2,h)}},FurniBagPanel.prototype.resetAvatar=function(t){var e=new l.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_COMMODITY_RESOURCE;e.avatar=t.avatar;var i=new Phaser.Geom.Point(0,40*this.dpr);this.mDetailDisplay.loadAvatar(e,this.dpr,i)},FurniBagPanel.prototype.addListen=function(){this.mInitialized&&(this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.mSeachInput.on("seach",this.onSeachHandler,this),this.mAdd.on("pointerup",this.onAddFurniToSceneHandler,this),this.sellBtn.on("pointerup",this.onSellBtnHandler,this),this.useBtn.on("pointerup",this.onUseBtnHandler,this),this.saveBtn.on("pointerup",this.onSaveBtnHandler,this),this.resetBtn.on("pointerup",this.onResetBtnHandler,this))},FurniBagPanel.prototype.removeListen=function(){this.mInitialized&&(this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.mSeachInput.off("seach",this.onSeachHandler,this),this.mAdd.off("pointerup",this.onAddFurniToSceneHandler,this),this.sellBtn.off("pointerup",this.onSellBtnHandler,this),this.useBtn.off("pointerup",this.onUseBtnHandler,this),this.saveBtn.on("pointerup",this.onSaveBtnHandler,this),this.resetBtn.on("pointerup",this.onResetBtnHandler,this))},FurniBagPanel.prototype.destroy=function(){var e=this;this.mCategoryScroll&&this.mCategoryScroll.destroy(),this.mPropGrid&&this.mPropGrid.destroy(),this.itemPopPanel&&(this.itemPopPanel.off("itempopclose",(function(){e.mCategoryScroll.addListen()})),this.itemPopPanel.destroy()),t.prototype.destroy.call(this)},FurniBagPanel.prototype.preload=function(){this.addAtlas(this.key,"furni_bag/furni_bag.png","furni_bag/furni_bag.json"),this.addAtlas(this.commonkey,"common/ui_base.png","common/ui_base.json"),t.prototype.preload.call(this)},FurniBagPanel.prototype.init=function(){var e=this,i=this.scene.cameras.main.width,n=this.scene.cameras.main.height;this.mBackground=this.scene.make.graphics(void 0,!1);var o=this.mWorld.uiScale;this.mBg=this.scene.make.image({key:this.key,frame:"bg"},!1).setScale(o),this.mShelfContainer=this.scene.make.container(void 0,!1),this.mShelfContainer.setSize(i,295*this.dpr*o),this.mShelfContainer.y=n-this.mShelfContainer.height,this.mCategoriesBar=this.scene.make.graphics(void 0,!1),this.mBackground.setInteractive(new Phaser.Geom.Rectangle(0,0,this.scene.cameras.main.width,this.scene.cameras.main.height),Phaser.Geom.Rectangle.Contains),this.mCloseBtn=this.scene.make.image({key:this.key,frame:"back_arrow",x:21*this.dpr,y:30*this.dpr}).setScale(o).setInteractive();var c=90*this.dpr*o,p=40*this.dpr*o,u=i-c/2-20*this.dpr,m=this.mShelfContainer.y-25*this.dpr*o;this.mAdd=this.createNineButton(u+100*this.dpr*o,m,c,p,this.commonkey,"yellow_btn",a.a.t("furni_bag.add"),"#996600"),this.sellBtn=this.createNineButton(u,m,c,p,this.commonkey,"red_btn",a.a.t("furni_bag.sold"),"#FFFFFF"),this.useBtn=this.createNineButton(u+100*this.dpr*o,m,c,p,this.commonkey,"yellow_btn",a.a.t("furni_bag.use"),"#996600"),this.saveBtn=this.createNineButton(u+100*this.dpr*o,m,c,p,this.commonkey,"yellow_btn",a.a.t("furni_bag.save"),"#996600"),this.resetBtn=this.createNineButton(u+100*this.dpr*o,m-p-5*this.dpr*o,40*this.dpr,40*this.dpr,this.commonkey,"red_btn");var f=this.scene.make.image({key:this.key,frame:"restore"});this.resetBtn.add(f),this.mDetailDisplay=new s.DetailDisplay(this.scene),this.mDetailDisplay.setTexture(this.key,"ghost"),this.mDetailDisplay.setNearest(),this.mDetailDisplay.y=this.mBg.y+this.mBg.height/2,this.mDetailDisplay.scale=this.mWorld.scaleRatio*o,this.mDetailBubble=new C(this.scene,this.key,this.dpr,o),this.mDetailBubble.x=10*this.dpr,this.mSeachInput=new T(this.scene,this.mWorld,this.key,this.dpr);var y=this.mInputBoo?260*this.dpr*o:0,g=this.scene.cameras.main.width+y;this.mCategoryScroll=new b.a(this.scene,{x:.5*g,y:this.mShelfContainer.y+20*this.dpr*o,width:this.scene.cameras.main.width,height:41*this.dpr*o,zoom:this.scale,orientation:1,cellupCallBack:function(t){e.onSelectSubCategoryHandler(t)}}),this.add([this.mBackground,this.mBg,this.mCloseBtn,this.mDetailDisplay,this.mDetailBubble,this.mShelfContainer,this.mCategoryScroll]),this.add([this.sellBtn,this.useBtn,this.mAdd,this.saveBtn,this.resetBtn]),this.mShelfContainer.add(this.mCategoriesBar),this.mWorld&&this.mWorld.roomManager&&this.mWorld.roomManager.currentRoom&&(this.mEnableEdit=this.mWorld.roomManager.currentRoom.enableEdit);var P=67*this.dpr*o,S=30*this.dpr*o,w=30*this.dpr*o,M={fontFamily:h.a.DEFULT_FONT,fontSize:20*this.dpr*o,color:"#FFFFFF"};this.topCheckBox=new d.CheckboxGroup;var O=[l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_ITEM,l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_FURNITURE,l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_AVATAR],x=[a.a.t("furni_bag.Props"),a.a.t("furni_bag.furni"),a.a.t("furni_bag.decorate")];this.mEnableEdit;var E=.5*i-.5*P*(O.length-1);for(var B in O){var I=O[R=Number(B)],A=new _.a(this.scene,this.key,"tab_normal","tab_down",x[R]);A.setTextStyle(M),A.setData("data",I),A.setSize(P,S),A.setFontStyle("bold"),A.y=w,A.x=E+P*R,this.topBtns.push(A)}if(this.topCheckBox.appendItemAll(this.topBtns),this.topCheckBox.on("selected",this.onTopCategoryHandler,this),this.topBtns.forEach((function(t){e.add(t)})),this.mEnableEdit){var R=O.indexOf(l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_FURNITURE);this.topCheckBox.selectIndex(R)}else this.topCheckBox.selectIndex(0);var k=this.scene.textures.getFrame(this.key,"prop_bg"),L=(k.width+10*this.dpr)*o,F=(k.height+10*this.dpr)*o;g=this.scene.cameras.main.width+35*this.dpr*o+y;var N={x:0,y:0,table:{width:this.scene.cameras.main.width-16*this.dpr*o,height:250*this.dpr*o,columns:4,cellWidth:L,cellHeight:F,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,a=t.item;return null===i&&(i=new D(n,0,0,e.key,e.dpr,o),e.add(i)),i.setData({item:a}),i.setProp(a),a?(e.isSelectedItemData(a)&&(i.isSelect=!0),a.rightSubscript===l.op_pkt_def.PKT_Subscript.PKT_SUBSCRIPT_CHECKMARK?i.isEquip=!0:i.isEquip=!1):(i.isSelect=!1,i.isEquip=!1),i}};this.mPropGrid=new v.a(this.scene,N),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){t&&e.onSelectItemHandler(t)})),this.add(this.mPropGrid.table),this.resize(0,0),t.prototype.init.call(this)},FurniBagPanel.prototype.createNineButton=function(t,e,i,n,o,a,s,l){var c=this.scale,p=new P.a(this.scene,t,e,i,n,o,a,s,this.dpr,this.scale,{left:12*this.dpr*c,top:12*this.dpr*c,right:12*this.dpr*c,bottom:12*this.dpr*c});return s&&(p.setTextStyle({color:l,fontSize:16*this.dpr*c,fontFamily:h.a.DEFULT_FONT}),p.setFontStyle("bold")),p},FurniBagPanel.prototype.replaceSelectItem=function(t){if(this.categoryType!==l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_AVATAR)this.mSelectedItemData.length=0,this.mSelectedItemData.push(t);else{for(var e=t.avatar,i=[],n=0,o=this.mSelectedItemData;n<o.length;n++){var a=(p=o[n]).avatar;if(this.isContainProperty(a,e)){var s=this.mSelectedItemData.indexOf(p);i.push(p)}}for(var h=0,c=i;h<c.length;h++){var p=c[h];s=this.mSelectedItemData.indexOf(p);this.mSelectedItemData.splice(s,1)}this.mSelectedItemData.push(t)}},FurniBagPanel.prototype.isContainProperty=function(t,e){var i=!0;for(var n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n)){i=!1;break}return i},FurniBagPanel.prototype.isContainObject=function(t,e){if(!t&&!e)return!0;if(typeof t!=typeof e)return!1;if("object"==typeof t){var i=!0;for(var n in t)if(t.hasOwnProperty(n)){if(!e.hasOwnProperty(n)){i=!1;break}var o=e[n];if(!this.isContainObject(o,t[n])){i=!1;break}}return i}return t===e},FurniBagPanel.prototype.isSelectedItemData=function(t){for(var e=0,i=this.mSelectedItemData;e<i.length;e++){if(i[e].indexId===t.indexId)return!0}return!1},FurniBagPanel.prototype.setSelectedItem=function(t){if(this.emit("queryPropResource",t),this.mDetailBubble.setProp(t),this.mDetailBubble.y=this.mShelfContainer.y-10*this.dpr-this.mDetailBubble.height,this.sellBtn.enable=t.recyclable,this.useBtn.enable=t.executable,this.mAdd.enable=this.mSceneType===l.op_def.SceneTypeEnum.EDIT_SCENE_TYPE||this.mEnableEdit,this.categoryType===l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_AVATAR)this.saveBtn.enable=!0,this.resetBtn.enable=!0;else{var e=u.h.getOsdRes(t.display.texturePath);this.mDetailDisplay.loadUrl(e)}},FurniBagPanel.prototype.onSelectSubCategoryHandler=function(t){var e=t.getData("type");if(e)"seachBtn"===e?this.onSeachHandler(this.mSeachInput.seachText):"label"===e&&this.mSeachInput.showInputPanel();else{var i=t.getData("item");if(i){this.mPreCategoryBtn&&this.mPreCategoryBtn instanceof p.TextButton&&this.mPreCategoryBtn.changeNormal(),t instanceof p.TextButton&&t.changeDown();var n=i.key;if(n===this.seachKey)this.showSeach(t);else{if(this.mPreCategoryBtn)(n=this.mPreCategoryBtn.getData("item").key)===this.seachKey&&this.closeSeach(t);else this.closeSeach(t);this.mSelectedCategeories=i,this.emit("queryPackage",i.key)}this.mPreCategoryBtn=t}}},FurniBagPanel.prototype.onCloseHandler=function(){this.emit("close")},FurniBagPanel.prototype.onSelectItemHandler=function(t){var e=t.getData("item");e?(this.replaceSelectItem(e),this.setSelectedItem(e),this.mPropGrid.refresh()):0===this.mSelectedItemData.length&&(this.sellBtn.enable=!1,this.useBtn.enable=!1,this.mAdd.enable=!1,this.saveBtn.enable=!1,this.resetBtn.enable=!1,this.mDetailDisplay.setTexture(this.key,"ghost"),this.mDetailDisplay.setNearest())},FurniBagPanel.prototype.onSeachHandler=function(t){this.mSelectedCategeories&&t.length>0&&this.emit("seachPackage",t,this.mSelectedCategeories.key)},FurniBagPanel.prototype.onAddFurniToSceneHandler=function(){this.mSelectedItemData&&this.emit("addFurniToScene",this.mSelectedItemData[0].id)},FurniBagPanel.prototype.onTopCategoryHandler=function(t){var e=t.getData("data");this.scaleWidth;this.mSelectedItemData.length=0,e&&(this.onSelectedCategory(e),e===l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_FURNITURE?(this.sellBtn.visible=!0,this.mAdd.visible=!0,this.useBtn.visible=!1,this.saveBtn.visible=!1,this.resetBtn.visible=!1):e===l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_AVATAR?(this.sellBtn.visible=!1,this.saveBtn.visible=!0,this.resetBtn.visible=!0,this.useBtn.visible=!1,this.mAdd.visible=!1):(this.sellBtn.visible=!0,this.useBtn.visible=!0,this.mAdd.visible=!1,this.saveBtn.visible=!1,this.resetBtn.visible=!1)),this.layoutTopBtn(t)},FurniBagPanel.prototype.layoutTopBtn=function(t){for(var e=this.scene.cameras.main.width,i=this.mWorld.uiScale,n=0,o=0,a=this.topBtns;o<a.length;o++){n+=(p=a[o]).width}for(var s=.5*e-(n/=2),l=0,c=this.topBtns;l<c.length;l++){var p,u=0;(p=c[l])!==t?(p.setTextStyle({fontFamily:h.a.DEFULT_FONT,fontSize:12*this.dpr*i,color:"#2B4BB5"}),u=.5*p.height):(p.setTextStyle({fontFamily:h.a.DEFULT_FONT,fontSize:16*this.dpr*i,color:"#8B5603"}),u=.5*p.height+2*this.dpr*i);var m=.5*p.width;p.x=s+m,p.y=u,s+=2*m+12*this.dpr*i}},FurniBagPanel.prototype.onSelectedCategory=function(t){this.categoryType=t,this.emit("getCategories",t),t===l.op_def.EditModePackageCategory.EDIT_MODE_PACKAGE_CATEGORY_AVATAR&&this.displayAvatar()},FurniBagPanel.prototype.onSellBtnHandler=function(){this.popItemsPopPanle(),this.mSelectedItemData.length>0&&this.itemPopPanel.setProp(this.mSelectedItemData[0],0,this.categoryType,new y.a(this,this.onSellPropsHandler))},FurniBagPanel.prototype.onUseBtnHandler=function(){this.popItemsPopPanle(),this.mSelectedItemData.length>0&&this.itemPopPanel.setProp(this.mSelectedItemData[0],1,this.categoryType,new y.a(this,this.onUsePropsHandler))},FurniBagPanel.prototype.onSaveBtnHandler=function(){if(this.mSelectedItemData.length>0){for(var t=[],e=0,i=this.mSelectedItemData;e<i.length;e++){var n=i[e];t.push(n.id)}this.emit("querySaveAvatar",t)}},FurniBagPanel.prototype.onResetBtnHandler=function(){this.mSelectedItemData.length>0&&this.emit("queryResetAvatar")},FurniBagPanel.prototype.onSellPropsHandler=function(t,e,i){this.emit("sellProps",t,e,i)},FurniBagPanel.prototype.onUsePropsHandler=function(t,e,i){},FurniBagPanel.prototype.popItemsPopPanle=function(){var t=this,e=this.mWorld.uiScale,i=this.scene.cameras.main.width,n=this.scene.cameras.main.height;this.itemPopPanel||(this.itemPopPanel=new M(this.scene,.5*i,.5*n,this.key,this.commonkey,this.dpr,e)),this.itemPopPanel.once("itempopclose",(function(){t.mCategoryScroll.addListen()})),this.mCategoryScroll.removeListen(),this.add(this.itemPopPanel)},FurniBagPanel.prototype.showSeach=function(t){this.mCategoryScroll.addItemAt(this.mSeachInput,1),this.mCategoryScroll.setInteractiveObject(this.mSeachInput.seachBtn),this.mCategoryScroll.setInteractiveObject(this.mSeachInput.label),this.updateCategeoriesLoc(!0)},FurniBagPanel.prototype.closeSeach=function(t){this.mSeachInput.parentContainer&&this.mSeachInput.parentContainer.remove(this.mSeachInput),this.mCategoryScroll.removeInteractiveObject(this.mSeachInput.seachBtn),this.mCategoryScroll.removeInteractiveObject(this.mSeachInput.label),this.updateCategeoriesLoc(!1)},FurniBagPanel.prototype.updateCategeoriesLoc=function(t){for(var e=this.mCategoryScroll.getItemList(),i=this.scale,n=(this.dpr,null),o=30*this.dpr*i,a=(this.mScene.cameras.main.width,o),s=0;s<e.length;s++){var h=e[s];s>0?(n=e[s-1],h.x=n.x+n.width):h.x=a,a+=h.width}this.mCategoryScroll.setAlign()},Object.defineProperty(FurniBagPanel.prototype,"enableEdit",{get:function(){return this.mEnableEdit},enumerable:!1,configurable:!0}),FurniBagPanel}(o.BasePanel),T=function(t){function SeachInput(e,i,n,o){var a=t.call(this,e)||this;return a.mWorldService=i,a.bg=e.make.image({key:n,frame:"seach_bg"},!1).setOrigin(.5,.5),a.mLabelInput=a.scene.make.text({x:0,width:a.bg.width,height:a.bg.height,style:{fontFamily:h.a.DEFULT_FONT,fontSize:14*o,wordWrap:{width:200,useAdvancedWrap:!0}}},!1).setData("type","label").setOrigin(0,.5),a.mLabelInput.setSize(a.bg.width,a.bg.height),a.mLabelInput.setInteractive(),a.mSeachBtn=e.make.image({key:n,frame:"seach_normal"},!1).setData("type","seachBtn"),a.mLabelInput.x=-a.bg.width/2+6*o*i.uiScale,a.mSeachBtn.x=a.bg.width/2-a.mSeachBtn.width,a.add([a.bg,a.mLabelInput,a.mSeachBtn]),a.disableInteractive(),a.setSize(a.bg.width,a.bg.height),a}return S(SeachInput,t),SeachInput.prototype.showInputPanel=function(){this.mInputText||(this.mInputText=new m.InputPanel(this.scene,this.mWorldService,this.mLabelInput.text),this.mInputText.once("close",this.sendChat,this))},SeachInput.prototype.sendChat=function(t){this.mInputText.destroy(),this.mInputText=null,this.mLabelInput.setText(t),this.mLabelInput.setSize(this.bg.width,this.bg.height)},Object.defineProperty(SeachInput.prototype,"seachBtn",{get:function(){return this.mSeachBtn},enumerable:!1,configurable:!0}),Object.defineProperty(SeachInput.prototype,"label",{get:function(){return this.mLabelInput},enumerable:!1,configurable:!0}),Object.defineProperty(SeachInput.prototype,"seachText",{get:function(){return this.mLabelInput.text},enumerable:!1,configurable:!0}),SeachInput}(Phaser.GameObjects.Container),C=function(t){function DetailBubble(e,i,n,o){void 0===o&&(o=1);var a=t.call(this,e)||this;a.dpr=n,a.mDetailBubble=a.scene.make.graphics(void 0,!1);var s=100*n*o,l=96*n*o;return a.mDetailBubble=a.scene.make.graphics(void 0,!1),a.mDetailBubble.fillStyle(16777215,.1),a.mDetailBubble.fillRoundedRect(0,0,s,l),a.mNickName=a.scene.make.text({x:7*a.dpr,y:9*a.dpr,text:"背包里空空如也",style:{fontSize:12*a.dpr*o,fontFamily:h.a.DEFULT_FONT,color:"#FFFF00",align:"center"}}),a.mPriceText=a.scene.make.text({x:7*a.dpr,y:28*a.dpr,text:"不可交易",style:{fontSize:10*a.dpr*o,fontFamily:h.a.DEFULT_FONT,color:"#DC143C",align:"center"}}),a.mSource=a.scene.make.text({x:8*n,y:47*n,text:"可通过商城购物获得",style:{fontSize:10*n*o,fontFamily:h.a.DEFULT_FONT}},!1),a.mDesText=a.scene.make.text({x:8*n,y:66*n,style:{color:"#32347b",fontSize:10*n*o,fontFamily:h.a.DEFULT_FONT,wordWrap:{width:90*n,useAdvancedWrap:!0}}},!1),a.add([a.mDetailBubble,a.mNickName,a.mDesText,a.mSource,a.mPriceText]),a.setSize(s,l),a}return S(DetailBubble,t),DetailBubble.prototype.setProp=function(t){this.mNickName.setText(t.shortName||t.name);var e=9*this.dpr,i=21*this.dpr;return t.recyclable?(e+=i,this.mPriceText.y=e,this.mPriceText.setText("可售卖："+t.sellingPrice.price)):(e+=i,this.mPriceText.y=e,this.mPriceText.setText("不可交易")),t.tradable&&this.mPriceText.setText("可交易"),t.source?(this.mSource.setText("来源： "+t.source),e+=i,this.mSource.y=e):this.mSource.setText(""),t.des?(e+=i,this.mDesText.setText(t.des),this.mDesText.y=e):this.mDesText.setText(""),this.resize(),this},DetailBubble.prototype.resize=function(t,e){void 0===t&&(t=this.width);var i=this.mDesText.height+60*this.dpr;t===this.width&&i===this.height||(this.mDetailBubble.clear(),this.mDetailBubble.fillStyle(16777215,.1),this.mDetailBubble.fillRoundedRect(0,0,t,i),this.setSize(t,i))},DetailBubble}(Phaser.GameObjects.Container),D=function(t){function Item(e,i,n,o,a,s){void 0===s&&(s=1);var l=t.call(this,e,i,n)||this;l.dpr=a,l.zoom=s;var p=e.make.image({key:o,frame:"grid_bg"},!1).setOrigin(0).setScale(s);return l.setSize(p.width,p.height),l.selectbg=e.make.image({key:o,frame:"grid_choose"},!1).setOrigin(0).setScale(s).setPosition(-2*a*s,-2*a*s),l.selectIcon=e.make.image({key:o,frame:"selected"},!1).setOrigin(1).setScale(s).setPosition(l.width,l.height),l.mPropImage=new c.DynamicImage(l.scene,0,0),l.mPropImage.scale=a*s,l.mCounter=e.make.text({x:l.width-4*a,y:l.height+2*a,style:{fontSize:12*a*s,fontFamily:h.a.DEFULT_FONT}},!1).setOrigin(1),l.add([p,l.selectbg,l.selectIcon]),l.isSelect=!1,l.isEquip=!1,l}return S(Item,t),Item.prototype.setProp=function(t){if(this.mProp=t,this.isSelect=!1,!t)return this.mCounter.setText(""),void this.remove(this.mPropImage);this.mPropImage.load(u.h.getOsdRes(t.display.texturePath),this,this.onPropLoadCompleteHandler),this.add(this.mPropImage),t.count>1?(this.mCounter.setText(t.count.toString()),this.add(this.mCounter)):this.mCounter.parentContainer&&this.remove(this.mCounter)},Item.prototype.onPropLoadCompleteHandler=function(){if(this.mPropImage&&this.mPropImage.texture){var t=this.mPropImage.texture;this.mPropImage.x=this.width+3*this.dpr*this.zoom>>1,this.mPropImage.y=this.height+3*this.dpr*this.zoom>>1,this.mPropImage.displayHeight=45*this.dpr,this.mPropImage.scaleX=this.mPropImage.scaleY,t&&t.setFilter(Phaser.Textures.FilterMode.NEAREST)}},Object.defineProperty(Item.prototype,"isSelect",{set:function(t){this.selectbg.visible=t},enumerable:!1,configurable:!0}),Object.defineProperty(Item.prototype,"isEquip",{set:function(t){this.selectIcon.visible=t},enumerable:!1,configurable:!0}),Item.prototype.onSelectedHandler=function(){this.emit("select",this.mProp)},Item}(Phaser.GameObjects.Container),M=function(t){function ItemsPopPanel(e,i,n,o,s,l,p){void 0===p&&(p=1);var u=t.call(this,e,i,n)||this;u.itemCount=1,u.popState=0;var m=new f.NinePatch(u.scene,0,0,286*l*p,331*l*p,s,"bg",{top:40,bottom:40});u.blackBg=u.scene.make.graphics(void 0,!1),u.blackBg.clear(),u.blackBg.fillStyle(0,.5);var d=u.scene.cameras.main.width/u.scale,y=u.scene.cameras.main.height/u.scale;u.blackBg.fillRect(-d/2,-y/2,d,y),m.setInteractive(new Phaser.Geom.Rectangle(0,0,d,y),Phaser.Geom.Rectangle.Contains);var _=.5*-m.height+3*l*p,v=u.scene.make.image({x:0,y:_,key:o,frame:"title"});u.titleName=e.make.text({x:0,y:_+3*l*p,text:"售出",style:{color:"#905B06",fontSize:15*l*p,fontFamily:h.a.DEFULT_FONT}},!1).setOrigin(.5),u.titleName.setFontStyle("bold"),u.itemName=e.make.text({x:0,y:_+40*l*p,style:{color:"#000000",fontSize:15*l*p,fontFamily:h.a.DEFULT_FONT}},!1).setOrigin(.5);var b=-56*l*p,S=u.scene.make.image({x:0,y:b,key:o,frame:"sell_bg"});u.icon=new c.DynamicImage(u.scene,0,b),u.icon.scale=l*p;var w=10*l*p;u.priceBg=u.scene.make.image({x:0,y:w,key:s,frame:"price_bg"}),u.pricText=e.make.text({x:0,y:w,style:{color:"#FFFFFF",fontSize:15*l*p,fontFamily:h.a.DEFULT_FONT}},!1).setOrigin(.5);var T=50*l*p,C=-58*l*p,D=u.scene.make.image({x:0,y:T,key:s,frame:"input_bg"});u.itemCountText=e.make.text({x:0,y:T,style:{color:"#0771AC",fontSize:15*l*p,fontFamily:h.a.DEFULT_FONT}},!1).setOrigin(.5);var M=new g.a(u.scene,s,"reduce","reduce"),O=new g.a(u.scene,s,"increase","increase");M.x=C,M.y=T,O.x=-C,O.y=T;var x=.5*m.height-50*l*p,E=-66*l*p,B=new P.a(u.scene,E,x,112*l*p,40*l*p,s,"red_btn",a.a.t("common.cancel"),l,p,{left:12*l*p,top:12*l*p,right:12*l*p,bottom:12*l*p}),I=new P.a(u.scene,-E,x,112*l*p,40*l*p,s,"yellow_btn",a.a.t("common.confirm"),l,p,{left:12*l*p,top:12*l*p,right:12*l*p,bottom:12*l*p});return B.setTextStyle({color:"#FFFFFF",fontSize:16*l*p,fontFamily:h.a.DEFULT_FONT}),I.setTextStyle({color:"#976400",fontSize:16*l*p,fontFamily:h.a.DEFULT_FONT}),u.add([u.blackBg,m,v,u.titleName,u.itemName,S,u.icon,u.priceBg,u.pricText,D,u.itemCountText,M,O,B,I]),M.on("Tap",u.onMinusBtnHandler,u),O.on("Tap",u.onAddBtnHandler,u),B.on("Tap",u.onCancelBtnHandler,u),I.on("Tap",u.onConfirmBtnHandler,u),u}return S(ItemsPopPanel,t),ItemsPopPanel.prototype.setProp=function(t,e,i,n){this.itemData=t,this.itemCount=1,this.icon.load(u.h.getOsdRes(t.display.texturePath),this,this.onPropLoadCompleteHandler),this.itemName.text=t.name||t.shortName,this.pricText.text=t.sellingPrice.price*this.itemCount+"  银币",this.itemCountText.text=this.itemCount+"",this.popState=e,0===e?(this.titleName.text=a.a.t("furni_bag.sold"),this.pricText.visible=!0,this.priceBg.visible=!0):(this.titleName.text=a.a.t("furni_bag.use"),this.pricText.visible=!1,this.priceBg.visible=!1),this.handler=n,this.category=i},ItemsPopPanel.prototype.onMinusBtnHandler=function(){1!==this.itemCount&&(this.itemCount--,this.updateData())},ItemsPopPanel.prototype.onAddBtnHandler=function(){this.itemCount!==this.itemData.count&&(this.itemCount++,this.updateData())},ItemsPopPanel.prototype.updateData=function(){this.itemCountText.text=this.itemCount+"",this.pricText.text=this.itemData.sellingPrice.price*this.itemCount+"  银币"},ItemsPopPanel.prototype.onCancelBtnHandler=function(){this.emit("itempopclose"),this.parentContainer&&this.parentContainer.remove(this)},ItemsPopPanel.prototype.onConfirmBtnHandler=function(){this.emit("itempopclose"),this.parentContainer&&this.parentContainer.remove(this),this.handler&&this.handler.runWith([this.itemData,this.itemCount,this.category])},ItemsPopPanel.prototype.onPropLoadCompleteHandler=function(){if(this.icon&&this.icon.texture){var t=this.icon.texture;t&&t.setFilter(Phaser.Textures.FilterMode.NEAREST)}},ItemsPopPanel}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"InfoPanel",(function(){return y}));var n,o=i(6),a=i(16),s=i(33),h=i(21),l=i(19),c=i(5),p=i(44),u=i(9),m=i(215),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=Phaser.Utils.Objects.GetValue,y=function(t){function InfoPanel(e,i){var n=t.call(this,e,i)||this;return n.mWorld=i,n}return d(InfoPanel,t),InfoPanel.prototype.addListen=function(){this.mInitialized&&this.mCloseBtn&&this.mCloseBtn.on("pointerup",this.closeHandler,this)},InfoPanel.prototype.removeListen=function(){this.mInitialized&&this.mCloseBtn&&this.mCloseBtn.off("pointerup",this.closeHandler,this)},InfoPanel.prototype.resize=function(t,e){if(this.mInitialized){var i=this.mWorld.getSize(),n=this.mWorld.uiScale,o=this.mWorld.uiRatio;this.x=i.width>>1,this.y=i.height>>1,this.mActor.x=-this.width/2+80*n*o,this.mActor.y=-this.height/2+160*n*o,this.mNameTextArea.setMinSize(220*this.dpr*n,222*this.dpr*n),this.mNameTextArea.setPosition(i.width/2+60*this.dpr*n,i.height/2-110*this.dpr*n),this.mNameTextArea.layout();var a=this.mNameTextArea.childrenMap.text;a.x=-10*this.dpr*n,a.y=-200*this.dpr*n,this.mAttributesTextArea.setMinSize(360*this.dpr*n,180*this.dpr*n),this.mAttributesTextArea.setPosition(i.width/2+3*this.dpr*n,i.height/2+95*this.dpr*n),this.mAttributesTextArea.layout();var s=this.mAttributesTextArea.childrenMap.text;s.x=-this.width/2+30*this.dpr*n,s.y=5*this.dpr*n}},InfoPanel.prototype.show=function(e){if(!this.mShow&&(t.prototype.show.call(this,e),this.mInitialized)){var i=this.mWorld.getSize();this.setData("data",e),this.setInfo(e),this.resize(i.width,i.height)}},InfoPanel.prototype.hide=function(){t.prototype.hide.call(this)},InfoPanel.prototype.setInfo=function(t){var e=this;if(this.mInitialized&&t){if(t.actors){if(0===t.actors.length)return;var i=t.actors[0];this.mWorld.httpService.userDetail(i.platformId).then((function(t){if(200===t.code){var i=t.data;i&&e.mActor.load(c.h.getOsdRes("show/"+i.username+".png"),e,void 0,e.loadDefaultAvatar)}}))}var n=t.text;n[0]&&this.mNameTextArea.setText(this.checkValue(n[0])),n[1]&&this.mAttributesTextArea.setText(this.checkValue(n[1]))}},InfoPanel.prototype.destroy=function(){this.mActor&&(this.mActor.destroy(!0),this.mActor=null),this.mNameTextArea&&(this.mNameTextArea.destroy(),this.mNameTextArea=null),this.mAttributesTextArea&&(this.mAttributesTextArea.destroy(),this.mAttributesTextArea=null),this.mWorld=null,t.prototype.destroy.call(this)},InfoPanel.prototype.preload=function(){this.scene.load.image(c.d.getName(),c.d.getPNG()),this.scene.load.image(c.a.getName(),c.a.getPNG()),this.scene.load.atlas(c.c.getName(),c.c.getPNG(),c.c.getJSON()),t.prototype.preload.call(this)},InfoPanel.prototype.init=function(){var e=this.mWorld.getSize(),i=this.mWorld.uiScale;this.setSize(400*this.dpr*i,500*this.dpr*i);var n=new p.a(this.scene,{width:this.width,height:this.height,key:c.a.getName(),columns:c.a.getColumns(),rows:c.a.getRows()}),o=new p.a(this.scene,{width:this.width-20*this.dpr*i,height:this.height-20*this.dpr*i,key:c.d.getName(),columns:c.d.getColumns(),rows:c.d.getRows()});this.mNameBBCodeText=new h.a(this.scene,0,0,"",{fontSize:14*this.dpr*i+"px",fontFamily:u.a.DEFULT_FONT,textMask:!1,wrap:{mode:"char",width:270*this.dpr*i}}),this.mNameTextArea=new s.a(this.scene,{x:this.width/2-80*i*this.dpr,y:-75*i*this.dpr,textWidth:270*this.dpr*i,textHeight:180*this.dpr*i,textMask:!0,text:this.mNameBBCodeText}).layout(),this.mAttributesBBCodeText=new h.a(this.scene,0,0,"",{fontSize:14*this.dpr*i+"px",fontFamily:u.a.DEFULT_FONT,textMask:!1,wrap:{mode:"char",width:this.width-30*this.dpr*i}}),this.mAttributesTextArea=new s.a(this.scene,{x:e.width/2+3*this.dpr*i,y:e.height/2+95*this.dpr*i,textMask:!0,textWidth:this.width-60*this.dpr*i,textHeight:180*this.dpr*i,text:this.mAttributesBBCodeText}).layout(),this.mCloseBtn=new l.NinePatchButton(this.scene,258,145,80,34,c.c.getName(),"","关闭",c.c.getConfig()),this.mCloseBtn.x=0,this.mCloseBtn.y=this.height-100*this.mWorld.uiRatio*i>>1,this.mCloseBtn.setTextStyle({font:u.a.YAHEI_16_BOLD}),this.mActor=new a.DynamicImage(this.scene,300,125).setOrigin(.5,1),this.mActor.scale=2,this.mWorld.uiManager.getMediator(m.InfoPanelMediator.NAME).resize(),this.add([n,o,this.mNameBBCodeText,this.mAttributesBBCodeText,this.mCloseBtn,this.mActor]),this.addListen(),t.prototype.init.call(this),this.setInfo(this.getData("data"))},InfoPanel.prototype.closeHandler=function(t){this.checkPointerDis(t)&&this.hide()},InfoPanel.prototype.checkPointerDis=function(t){return!this.mWorld||(Math.abs(t.downX-t.upX)<10*this.mWorld.uiRatio*this.mWorld.uiScale||Math.abs(t.downY-t.upY)<10*this.mWorld.uiRatio*this.mWorld.uiScale)},InfoPanel.prototype.loadDefaultAvatar=function(){var t=c.h.getOsdRes("show/avatar_default.png");this.scene.textures.exists(t)?this.mActor.setTexture(t):this.mActor.load(t)},InfoPanel.prototype.checkValue=function(t){return f(t,"text","")},InfoPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"InfoPanelMediator",(function(){return c}));var n,o=i(13),a=i(214),s=i(70),h=i(7),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function InfoPanelMediator(e,i,n){var o=t.call(this)||this;return o.mLayerManager=e,o.mScene=i,o.world=n,o}return l(InfoPanelMediator,t),InfoPanelMediator.prototype.hide=function(){this.mShow=!1,this.world.emitter.off(o.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView&&(this.mView.hide(),this.mView=null)},InfoPanelMediator.prototype.isSceneUI=function(){return!1},InfoPanelMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},InfoPanelMediator.prototype.resize=function(){this.mView&&this.mView.resize()},InfoPanelMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||e&&0!==e.length&&(this.mView=new a.InfoPanel(this.mScene,this.world),this.mView.show(e[0]),this.mLayerManager.addToUILayer(this.mView),this.world.emitter.on(o.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),t.prototype.show.call(this,e))},InfoPanelMediator.prototype.destroy=function(){this.mView&&this.mView.destroy()},InfoPanelMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},InfoPanelMediator.prototype.onClosePanel=function(t){s.a.checkPointerContains(this.mView,t)||this.hide()},InfoPanelMediator.NAME="InfoPanelMediator",InfoPanelMediator}(h.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractivePanel",(function(){return d}));var n,o=i(6),a=i(5),s=i(12),h=i(96),l=i(3),c=i(21),p=i(217),u=i(33),m=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function InteractivePanel(e,i){var n=t.call(this,e,i)||this;return n.mRadioCom=!1,n.mLeftBaseScaleX=1,n.mLeftBaseScaleY=1,n.mMidBaseScaleX=1,n.mMidBaseScaleY=1,n.mRightBaseScaleX=1,n.mRightBaseScaleY=1,n.mDisDelection=10,n.setTween(!1),n}return m(InteractivePanel,t),InteractivePanel.prototype.show=function(e){var i=this;t.prototype.show.call(this,e);this.mWorld.getSize();if(this.mShowData=e,this.mInitialized){this.mShow=!0;var n=this.mWorld.uiManager.getMediator(p.InteractivePanelMediator.NAME),o=this.mShowData[0];if(this.mLeftFaceIcon&&(this.mLeftFaceIcon.visible=!1),this.mRightFaceIcon&&(this.mRightFaceIcon.visible=!1),this.mMidFaceIcon&&(this.mMidFaceIcon.visible=!1),o.display&&o.display.length>0){var s=o.display[0],l=a.h.getOsdRes(s.texturePath);this.scene.cache.obj.get(l)?this.onLoadComplete():(this.scene.load.image(l,l),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())}if(this.mDescTF.text="",this.mNameTF.text="",o.text&&o.text.length>0){var c=o.text[0];if(this.mDescCon.setData("nodeID",c.node.id),this.mTextArea.setText(c.text),this.mDescCon.off("pointerup",this.descConClick,this),this.mDescCon.on("pointerup",this.descConClick,this),o.text[1]){var u=o.text[1];this.mNameCon.setData("nodeID",u.node.id),this.mNameTF.text=u.text,this.mNameTF.x=-this.mNameTF.width>>1,this.mNameCon.off("pointerup",this.nameConClick,this),this.mNameCon.on("pointerup",this.nameConClick,this)}}if(this.mRadio&&(this.mRadio.visible=!1),o.button&&o.button.length>0){var m=33*(o.button.length-1)+46;this.mRadio||(this.mRadio=new h.Radio(this.mScene,{wid:350,hei:m,resKey:"juqing",resPng:"./resources/ui/juqing/juqing.png",resJson:"./resources/ui/juqing/juqing.json",resBg:"radio_bg.png",resArrow:"radio_arrow.png",fontStyle:{size:20,color:"#ffcc00",bold:!1},completeBack:function(){i.radioComplete()},clickCallBack:function(t){t&&n&&n.componentClick(t.data)}}),this.radioComplete()),this.setRadioData(o.button),this.mRadio.visible=!0}this.resize(),this.mShow}else this.preload()},InteractivePanel.prototype.hide=function(){t.prototype.hide.call(this)},InteractivePanel.prototype.update=function(t){this.show(t)},InteractivePanel.prototype.getRadio=function(){return this.mRadio},InteractivePanel.prototype.setRadioData=function(t){this.mRadio.setRadioData(t)},InteractivePanel.prototype.resize=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.scale=this.mWorld.uiScale;var n=this.mWorld.getSize(),o=this.mWorld.getSize().width,a=this.mWorld.getSize().height,s=this.mWorld.uiScale;this.mNameCon.add(this.mNameBg),this.mNameCon.add(this.mNameTF),this.mDescCon.add(this.mBg),this.mDescCon.add(this.mBorder),this.mDescCon.add(this.mDescTF),this.mDescCon.add(this.mTextArea),this.add(this.mNameCon),this.add(this.mDescCon),this.setSize(o,a),this.mWorld.game.device.os.desktop?this.y=n.height/2-250:(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.mBg.resize((n.width-10)/this.mWorld.uiScale,.5*n.height/this.mWorld.uiScale),this.mBorder.resize((n.width-20)/this.mWorld.uiScale,(.5*n.height-20)/this.mWorld.uiScale),this.y=1.5*this.mBg.height*this.mWorld.uiScale),this.x=n.width>>1,this.refreshUIPos(),this.mRadio&&this.add(this.mRadio),this.mTextArea.childrenMap.child.setMinSize(this.mBorder.width-10*this.dpr*s,this.mBorder.height-3*this.dpr*s),this.mTextArea.layout(),this.mTextArea.setPosition(o/2,this.y+this.mDescCon.y);var h=this.mTextArea.childrenMap.text;h.x=-this.mBorder.width>>1,h.y=-this.mBorder.height/2+20*this.dpr,h.resize(this.mBorder.width,this.mDescTF.displayHeight+2e3),this.mTextArea.scrollToBottom(),t.prototype.resize.call(this,e,i)},InteractivePanel.prototype.destroy=function(){this.mInitialized=!1,this.mNameCon&&this.mNameCon.destroy(!0),this.mDescCon&&this.mDescCon.destroy(!0),this.mLeftFaceIcon&&this.mLeftFaceIcon.destroy(!0),this.mMidFaceIcon&&this.mMidFaceIcon.destroy(!0),this.mRightFaceIcon&&this.mRightFaceIcon.destroy(!0),this.mNameTF&&this.mNameTF.destroy(!0),this.mDescTF&&this.mDescTF.destroy(!0),this.mRadio&&this.mRadio.destroy(),this.mNameCon=null,this.mDescCon=null,this.mLeftFaceIcon=null,this.mMidFaceIcon=null,this.mRightFaceIcon=null,this.mNameTF=null,this.mDescTF=null,this.mRadio=null,t.prototype.destroy.call(this)},InteractivePanel.prototype.preload=function(){this.mScene&&(this.scene.load.image(a.a.getName(),a.a.getPNG()),this.scene.load.image(a.d.getName(),a.d.getPNG()),this.mScene.load.atlas("juqing",a.h.getRes("ui/juqing/juqing.png"),a.h.getRes("ui/juqing/juqing.json")),t.prototype.preload.call(this))},InteractivePanel.prototype.init=function(){var e=this.mWorld.getSize().width,i=this.mWorld.getSize().height,n=this.mWorld.uiScale;this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mNameCon=this.mScene.make.container(void 0,!1),this.mDescCon=this.mScene.make.container(void 0,!1),this.mBg=new s.NinePatch(this.scene,0,0,1080,320,a.a.getName(),null,a.a.getConfig()),this.setSize(e,i),this.mBorder=new s.NinePatch(this.scene,0,0,1040,280,a.d.getName(),null,a.d.getConfig()),this.mLeftFaceIcon=this.mScene.make.image(void 0,!1),this.mMidFaceIcon=this.mScene.make.image(void 0,!1),this.mRightFaceIcon=this.mScene.make.image(void 0,!1),this.mNameTF=new c.a(this.mScene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:this.mBorder.width}}),this.mNameBg=this.mScene.make.image(void 0,!1),this.mNameBg.setTexture("juqing","juqing_name.png"),this.mDescTF=new c.a(this.mScene,0,0,"",{fontSize:"20px",halign:"left",textMask:!1,padding:{top:0,bottom:0,left:8*this.dpr*n,right:3*this.dpr*n},wrap:{mode:"character",width:this.mBorder.width-12*this.dpr*n}}),this.mTextArea=new u.a(this.mScene,{x:e/2,y:this.mBorder.y+this.mBorder.height/2+80*this.dpr*n,width:this.mBorder.width,height:this.mBorder.height-20*this.dpr*n,textWidth:this.mBorder.width-12*this.dpr*n,textHeight:0,text:this.mDescTF}).layout(),this.mDescCon.setSize(this.mBg.width,this.mBg.height),this.mNameCon.setSize(this.mNameBg.width,this.mNameBg.height),this.mDescCon.setInteractive(),this.mNameCon.setInteractive(),t.prototype.init.call(this)},InteractivePanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.resize()},InteractivePanel.prototype.refreshUIPos=function(){var t=this.mWorld.getSize(),e=this.mWorld.uiScale;this.mDescCon.setSize(this.mBg.width,this.mBg.height),this.mNameCon.setSize(this.mNameBg.width,this.mNameBg.height),this.mNameTF.y=-8*this.mWorld.uiScale,this.mDescCon.y=this.mWorld.game.device.os.desktop?t.height/2+80:0,this.mNameCon.x=150-this.mDescCon.width/2,this.mNameCon.y=this.mDescCon.y-this.mDescCon.height/2-this.mNameCon.height/2-10,this.mNameTF.setWrapWidth(this.mBorder.width),this.mDescTF.setWrapWidth(this.mBorder.width-10*this.dpr*e),this.mNameTF.x=-this.mNameTF.width>>1;this.mDescCon.getWorldTransformMatrix().ty;if(!this.mWorld.game.device.os.desktop){var i=this.mLeftFaceIcon.width*this.mWorld.uiScale,n=this.mLeftFaceIcon.height*this.mWorld.uiScale,o=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,i,n);this.mLeftFaceIcon.scaleX=this.mLeftBaseScaleX*o*.7,this.mLeftFaceIcon.scaleY=this.mLeftBaseScaleY*o*.7,this.mLeftFaceIcon.x=this.mNameCon.x,this.mLeftFaceIcon.y=this.mNameTF.y-this.mLeftFaceIcon.height;var a=this.mMidFaceIcon.width*this.mWorld.uiScale,s=this.mMidFaceIcon.height*this.mWorld.uiScale,h=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,a,s);this.mMidFaceIcon.scaleX=this.mMidBaseScaleX*h*.7,this.mMidFaceIcon.scaleY=this.mMidBaseScaleY*h*.7,this.mMidFaceIcon.x=0,this.mMidFaceIcon.y=this.mNameTF.y-this.mMidFaceIcon.height;var l=this.mRightFaceIcon.width*this.mWorld.uiScale,c=this.mRightFaceIcon.height*this.mWorld.uiScale,p=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,l,c);this.mRightFaceIcon.scaleX=this.mRightBaseScaleX*p*.7,this.mRightFaceIcon.scaleY=this.mRightBaseScaleY*p*.7,this.mRightFaceIcon.x=-this.mNameCon.x,this.mRightFaceIcon.y=this.mNameTF.y-this.mRightFaceIcon.height}this.mRadioCom&&(this.mWorld.game.device.os.desktop?(this.mRadio.x=this.mBg.x+this.mBg.width/2-this.mRadio.width,this.mRadio.y=this.mDescCon.y+this.mDescCon.height/2-this.mRadio.height):(this.mRadio.x=this.mBg.width/2-this.mRadio.width,this.mRadio.y=this.mBg.height/2-this.mRadio.height))},InteractivePanel.prototype.getScale=function(t,e,i,n){return t/i>e/n?t/i:e/n},InteractivePanel.prototype.onLoadComplete=function(){this.mWorld.getSize();var t=this.mShowData[0].display[0],e=a.h.getOsdRes(t.texturePath),i=-this.mBorder.width/2,n=(this.mBorder.height,t.scaleX),o=t.scaleY,s=1;this.mWorld.uiManager.getMediator(p.InteractivePanelMediator.NAME);switch(t.horizontal){case l.op_def.HorizontalAlignment.HORIZONTAL_LEFT:this.mLeftFaceIcon.setTexture(e),this.mLeftFaceIcon.setData("nodeID",t.node.id),this.mLeftBaseScaleX=n,this.mLeftBaseScaleY=o,s=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,this.mLeftFaceIcon.width,this.mLeftFaceIcon.height),this.mLeftFaceIcon.scaleX=n*s,this.mLeftFaceIcon.scaleY=o*s,this.mLeftFaceIcon.x=i+200,this.mLeftFaceIcon.setInteractive(),this.addAt(this.mLeftFaceIcon,0),this.mLeftFaceIcon.visible=!0,this.mLeftFaceIcon.off("pointerup",this.leftFaceClick,this),this.mLeftFaceIcon.on("pointerup",this.leftFaceClick,this);break;case l.op_def.HorizontalAlignment.HORIZONTAL_CENTER:this.mMidFaceIcon.setTexture(e),this.mMidFaceIcon.setData("nodeID",t.node.id),this.mMidBaseScaleX=n,this.mMidBaseScaleY=o,s=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,this.mMidFaceIcon.width,this.mMidFaceIcon.height),this.mMidFaceIcon.scaleX=n*s,this.mMidFaceIcon.scaleY=o*s,this.mMidFaceIcon.x=0,this.addAt(this.mMidFaceIcon,0),this.mMidFaceIcon.visible=!0,this.mMidFaceIcon.setInteractive(),this.mLeftFaceIcon.off("pointerup",this.midFaceClick,this),this.mMidFaceIcon.on("pointerup",this.midFaceClick,this);break;case l.op_def.HorizontalAlignment.HORIZONTAL_RIGHT:this.mRightFaceIcon.setTexture(e),this.mRightFaceIcon.setData("nodeID",t.node.id),this.mRightBaseScaleX=n,this.mRightBaseScaleY=o,s=this.getScale(InteractivePanel.baseWidth,InteractivePanel.baseHeight,this.mRightFaceIcon.width,this.mRightFaceIcon.height),this.mRightFaceIcon.scaleX=n*s,this.mRightFaceIcon.scaleY=o*s,this.mRightFaceIcon.x=200,this.addAt(this.mRightFaceIcon,0),this.mRightFaceIcon.visible=!0,this.mRightFaceIcon.setInteractive(),this.mRightFaceIcon.off("pointerup",this.rightFaceClick,this),this.mRightFaceIcon.on("pointerup",this.rightFaceClick,this)}this.resize()},InteractivePanel.prototype.rightFaceClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(p.InteractivePanelMediator.NAME);e&&e.componentClick(this.mRightFaceIcon.getData("nodeID"))}},InteractivePanel.prototype.midFaceClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(p.InteractivePanelMediator.NAME);e&&e.componentClick(this.mMidFaceIcon.getData("nodeID"))}},InteractivePanel.prototype.leftFaceClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(p.InteractivePanelMediator.NAME);e&&e.componentClick(this.mLeftFaceIcon.getData("nodeID"))}},InteractivePanel.prototype.descConClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(p.InteractivePanelMediator.NAME);this.mDescCon.getData("nodeID")&&e&&e.componentClick(this.mDescCon.getData("nodeID"))}},InteractivePanel.prototype.nameConClick=function(t){if(this.checkPointer(t)){var e=this.mWorld.uiManager.getMediator(p.InteractivePanelMediator.NAME);this.mNameCon.getData("nodeID")&&e&&e.componentClick(this.mNameCon.getData("nodeID"))}},InteractivePanel.prototype.checkPointer=function(t){return Math.abs(t.downX-t.upX)<this.mDisDelection&&Math.abs(t.downY-t.upY)<this.mDisDelection},InteractivePanel.prototype.onLoadError=function(t){},InteractivePanel.prototype.radioComplete=function(){this.mRadioCom=!0,this.mRadio&&(this.mRadio.x=220,this.mRadio.y=this.mDescCon.height+200,this.resize())},InteractivePanel.baseWidth=720,InteractivePanel.baseHeight=720,InteractivePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractivePanelMediator",(function(){return l}));var n,o=i(216),a=i(7),s=i(18),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function InteractivePanelMediator(e,i,n){var o=t.call(this)||this;return o.mUIType=s.a.Monopoly,o.mScene=i,o.world=n,o}return h(InteractivePanelMediator,t),InteractivePanelMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},InteractivePanelMediator.prototype.isSceneUI=function(){return!1},InteractivePanelMediator.prototype.resize=function(){if(this.mView&&this.mView.isShow)return this.mView.resize()},InteractivePanelMediator.prototype.getView=function(){return this.mView},InteractivePanelMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new o.InteractivePanel(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e))},InteractivePanelMediator.prototype.update=function(e){this.mView&&this.mView.isShow&&t.prototype.update.call(this,e)},InteractivePanelMediator.prototype.hide=function(){this.mShow=!1,this.mView&&(this.mView.hide(),this.mView=null)},InteractivePanelMediator.prototype.destroy=function(){this.world=null,this.mScene=null,this.mParam=null,t.prototype.destroy.call(this)},InteractivePanelMediator.prototype.componentClick=function(t){this.mParam&&this.world.roomManager.currentRoom.playerManager.actor.getInteractive().requestTargetUI(this.mParam[0].id,t)},InteractivePanelMediator.NAME="InteractivePanelMediator",InteractivePanelMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemDetail",(function(){return c}));var n,o=i(6),a=i(5),s=i(69),h=i(19),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function ItemDetail(e,i){var n=t.call(this,e,i)||this;return n.mBtnWid=100,n.mBtnHei=40,n.mWid=0,n.mHei=0,n}return l(ItemDetail,t),ItemDetail.prototype.getBtnList=function(){return this.mBtnList},ItemDetail.prototype.resize=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);var i=this.mWorld.getSize();this.mWorld.game.device.os.desktop,this.x=i.width-(this.width+this.mBtnWid)/2*this.mWorld.uiScale>>1,this.y=i.height-this.height*this.mWorld.uiScale>>1,this.scale=this.mWorld.uiScale},ItemDetail.prototype.show=function(t){if(this.mShowData=t,this.mInitialized){this.mShow=!0;var e=this.mShowData[0];if(e.display.length>0&&this.loadIcon(e.display[0]),e.text.length>0&&this.setText(e.text[0].text),e.button.length>0){this.mBtnList=[];for(var i=void 0,n=e.button.length,o=20,s=this.mWid+50,l=0;l<n;l++){var c=e.button[l];i=new h.NinePatchButton(this.mScene,0,0,this.mBtnWid,this.mBtnHei,a.c.getName(),a.c.getName(),c.text,a.c.getConfig(),c),this.mBtnList.push(i),i.x=s,i.y=o,o+=i.height+40,this.add(i)}}var p=this.mScene.add.graphics();p.fillStyle(0,.6),p.fillRoundedRect(0,0,this.mWid,this.mHei,6),this.addAt(p,0),this.setSize(this.mWid+120,this.mHei),this.resize(),this.setInteractive()}else this.preload()},ItemDetail.prototype.setText=function(t){this.mDescTF.setText(t),this.mHei+=this.mDescTF.y+this.mDescTF.height+10},ItemDetail.prototype.loadIcon=function(t){var e=this;this.mIcon&&this.mIcon.load(a.h.getOsdRes(t),(function(){e.mHei+=e.mIcon.y+e.mIcon.height}))},ItemDetail.prototype.hide=function(){this.disInteractive(),t.prototype.hide.call(this)},ItemDetail.prototype.destroy=function(){this.mBtnList&&(this.mBtnList.forEach((function(t){t.destroy(!0),t=null})),this.mBtnList=null),this.mResStr="",this.mResPng="",this.mResJson="",this.mNameTF&&this.mNameTF.destroy(!0),this.mDescTF&&this.mDescTF.destroy(!0),this.mIcon&&this.mIcon.destroy(),this.mNameTF=null,this.mDescTF=null,this.mIcon=null,this.mWid=0,this.mHei=0,t.prototype.destroy.call(this)},ItemDetail.prototype.preload=function(){this.mResStr="itemDetail",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.mScene&&(this.mScene.load.atlas(a.c.getName(),a.c.getPNG(),a.c.getJSON()),this.mScene.load.atlas("itemDetail",a.h.getRes("ui/bag/bagView.png"),a.h.getRes("ui/bag/bagView.json")),t.prototype.preload.call(this))},ItemDetail.prototype.init=function(){this.mWorld.getSize();this.mWid=290,this.mHei=0,this.mIcon=new s.DragDropIcon(this.mScene,30,25),this.add(this.mIcon),this.mNameTF=this.scene.make.text({style:{fontFamily:"YaHei",fontSize:20,origin:{x:0,y:0},wordWrap:{width:250,useAdvancedWrap:!0}}},!1),this.mNameTF.setFontStyle("bold"),this.mNameTF.setAlign("left"),this.mNameTF.x=this.mIcon.x+this.mIcon.width,this.mNameTF.y=this.mIcon.y,this.add(this.mNameTF),this.mDescTF=this.scene.make.text({style:{fontFamily:"YaHei",fontSize:25,origin:{x:0,y:0},wordWrap:{width:250,useAdvancedWrap:!0}}},!1),this.mDescTF.setFontStyle("bold"),this.mDescTF.setAlign("left"),this.mDescTF.x=this.mIcon.x-this.mIcon.width/2,this.mDescTF.y=this.mIcon.y+this.mIcon.height+20,this.add(this.mDescTF),this.mInitialized=!0,this.show(this.mShowData)},ItemDetail}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemPopCardPanel",(function(){return u}));var n,o=i(6),a=i(31),s=i(424),h=i(55),l=i(13),c=i(9),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function ItemPopCardPanel(e,i){var n=t.call(this,e,i)||this;return n.key="item_pop_card",n.mPressDelay=1e3,n.setTween(!1),n}return p(ItemPopCardPanel,t),ItemPopCardPanel.prototype.addListen=function(){this.mInitialized&&(this.mDetailDisplay.on("show",this.onShowHandler,this),this.on("pointerup",this.onCloseHandler,this),this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.mNickName.on("pointerup",this.onPointerNickNameHandler,this),this.mNickName.on("pointerdown",this.onPointerNickNameDownHandler,this),this.mDesText.on("pointerdown",this.onPointerDesDownHandler,this),this.mDesText.on("pointerup",this.onPointerNickNameHandler,this))},ItemPopCardPanel.prototype.removeListen=function(){this.mInitialized&&(this.mDetailDisplay.off("show",this.onShowHandler,this),this.off("pointerup",this.onCloseHandler,this),this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.mNickName.off("pointerup",this.onPointerNickNameHandler,this),this.mNickName.off("pointerdown",this.onPointerNickNameDownHandler,this),this.mDesText.off("pointerdown",this.onPointerDesDownHandler,this),this.mDesText.off("pointerup",this.onPointerNickNameHandler,this))},ItemPopCardPanel.prototype.resize=function(e,i){var n=this.mWorld.uiScale,o=this.scene.cameras.main.width/n,a=this.scene.cameras.main.height/n,s=this.scene.cameras.main.centerX/n,h=this.scene.cameras.main.centerY/n;this.setSize(o,a),this.mCardContainer.x=s,this.mCardContainer.y=h,this.mCloseBtn.x=s,this.mCloseBtn.y=h+this.mCardContainer.height/2+48*this.dpr,t.prototype.resize.call(this,e,i)},ItemPopCardPanel.prototype.setProp=function(){if(this.mShowData){var t=this.mShowData[0].prop;if(t){this.mDesText.setText(t.des),this.mNickName.setText(t.name),t.source?this.mSource.setText(a.a.t("item.source")+t.source):this.mSource.setText("");var e=this.mShowData[0].display;e&&(e.display?this.mDetailDisplay.loadDisplay(e):e.avatar?this.mDetailDisplay.loadAvatar(e.avatar):this.mDetailDisplay.loadUrl(t.icon))}}},ItemPopCardPanel.prototype.preload=function(){this.addAtlas(this.key,"item_pop_card/item_pop_card.png","item_pop_card/item_pop_card.json"),t.prototype.preload.call(this)},ItemPopCardPanel.prototype.init=function(){this.mCardContainer=this.scene.make.container({width:325*this.dpr,height:468*this.dpr},!1),this.mCardContainer.setSize(325*this.dpr,468*this.dpr),this.mCardContainer.setInteractive(),this.mBorder=this.scene.make.graphics(void 0,!1),this.mBorder.fillGradientStyle(7304703,7304703,118271,118271),this.mBorder.fillRect(-this.mCardContainer.width/2,-this.mCardContainer.height/2,this.mCardContainer.width,this.mCardContainer.height);var e=this.scene.make.image({key:this.key,frame:"bg.png"},!1);e.y=23*this.dpr-e.height/2;var i=this.scene.make.image({y:42*this.dpr,key:this.key,frame:"name_bg.png"});this.mNickName=this.scene.make.text({y:42*this.dpr,style:{fontSize:18*this.dpr,fontFamily:c.a.DEFULT_FONT}},!1).setOrigin(.5).setInteractive();var n=this.scene.make.image({y:138*this.dpr,key:this.key,frame:"des_bg.png"},!1);this.mDesText=this.scene.make.text({x:n.x-n.width/2+12*this.dpr,y:n.y-n.height/2+10*this.dpr,style:{fontSize:10*this.dpr,fontFamily:c.a.DEFULT_FONT,wordWrap:{width:240*this.dpr,useAdvancedWrap:!0}}},!1).setInteractive(),this.mDetailDisplay=new h.DetailDisplay(this.scene),this.mDetailDisplay.scale=2*this.dpr,this.mCloseBtn=this.scene.make.image({key:this.key,frame:"close.png"},!1).setInteractive(),this.mSource=this.scene.make.text({x:n.x-n.width/2+12*this.dpr,y:n.y+n.height/2-23*this.dpr,style:{fontSize:10*this.dpr,fontFamily:c.a.DEFULT_FONT}},!1),this.add(this.mCardContainer),this.mCardContainer.add([this.mBorder,e,n,this.mDetailDisplay,i,this.mNickName,this.mDesText,this.mSource]),this.add(this.mCloseBtn),this.resize(0,0),t.prototype.init.call(this),this.setInteractive(),this.setProp()},ItemPopCardPanel.prototype.onCloseHandler=function(){this.emit("close"),clearTimeout(this.mPressTime),this.mNickNameDown=!1},ItemPopCardPanel.prototype.onPointerNickNameHandler=function(){clearTimeout(this.mPressTime),this.mNickNameDown=!1},ItemPopCardPanel.prototype.onPointerNickNameDownHandler=function(){var t=this;this.mPressTime=setTimeout((function(){t.copyName()}),this.mPressDelay)},ItemPopCardPanel.prototype.onPointerDesDownHandler=function(){var t=this;this.mPressTime=setTimeout((function(){t.copyDes()}),this.mPressDelay)},ItemPopCardPanel.prototype.copyName=function(){if(this.mNickName){s(this.mNickName.text);var t={noticeContext:a.a.t("item.copy_suc",{name:a.a.t("item.name")})};this.mWorld.emitter.emit(l.a.SHOW_NOTICE,{content:t})}},ItemPopCardPanel.prototype.copyDes=function(){if(this.mDesText){s(this.mDesText.text);var t={noticeContext:a.a.t("item.copy_suc",{name:a.a.t("item.des")})};this.mWorld.emitter.emit(l.a.SHOW_NOTICE,{content:t})}},ItemPopCardPanel.prototype.onShowHandler=function(t){this.mDetailDisplay.y=-this.mCardContainer.height/4},ItemPopCardPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ElementDetail",(function(){return u}));var n,o=i(221),a=i(3),s=i(19),h=i(31),l=i(55),c=i(9),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function ElementDetail(e,i,n,a,p){var u=t.call(this,e)||this;u.key=n,u.mWorld=i,u.uiScale=p||1,u.dpr=a,u.setPosition(0,0),u.mCounter=new o.NumberCounter(u.scene,n,360,700,u.dpr,p);var m=u.scene.textures.getFrame(u.key,"yellow_button_normal"),d=60,f=65;m&&(d=m.width,f=m.height),u.mBuyBtn=new s.NinePatchButton(u.scene,440,700,81*u.dpr,41*u.dpr,u.key,"yellow_button",h.a.t("market.buy_button"),{left:14*u.dpr,top:14*u.dpr,right:d-2-14*u.dpr,bottom:f-2-14*u.dpr}).setScale(p),u.mBuyBtn.setTextStyle({color:"#976400",fontSize:16*u.dpr*p,fontFamily:c.a.DEFULT_FONT}),u.mBuyBtn.setFontStyle("bold"),u.mBuyBtn.on("pointerup",u.onBuyHandler,u),u.mNickName=u.scene.make.text({x:7*u.dpr,y:9*u.dpr,style:{fontSize:12*u.dpr*p,fontFamily:c.a.DEFULT_FONT,color:"#FFFF00",align:"center"}}),u.mPriceContainer=u.scene.make.container(void 0,!1),u.mPriceIcon=u.scene.make.image({x:-78,key:u.key,frame:"tuding_icon"},!1).setScale(p),u.mPriceText=u.scene.make.text({x:0,style:{fontSize:14*u.dpr*p,fontFamily:c.a.DEFULT_FONT}}).setOrigin(.5);var y=u.scene.make.image({key:u.key,frame:"price_bg"}).setScale(p);u.mDetailDisplay=new l.DetailDisplay(u.scene),u.mDetailDisplay.scale=u.dpr,u.mDetailDisplay.y=110*u.dpr;var g=110*u.dpr*u.uiScale,_=96*u.dpr*u.uiScale;return u.mDetailBubble=u.scene.make.graphics(void 0,!1),u.mDetailBubble.fillStyle(16777215,.1),u.mDetailBubble.fillRoundedRect(0,0,g,_),u.mDetailBubbleContainer=u.scene.make.container(void 0,!1),u.mDetailBubbleContainer.setSize(g,_),u.mDesText=u.scene.make.text({x:8*u.dpr,y:56*u.dpr,style:{color:"#32347b",fontSize:10*u.dpr*p,fontFamily:c.a.DEFULT_FONT,wordWrap:{width:90*u.dpr*p,useAdvancedWrap:!0}}},!1),u.mSource=u.scene.make.text({x:8*u.dpr,y:38*u.dpr,style:{fontSize:10*u.dpr*p,fontFamily:c.a.DEFULT_FONT}},!1),u.add([u.mDetailDisplay,u.mPriceContainer,u.mCounter,u.mBuyBtn,u.mDetailBubbleContainer]),u.mDetailBubbleContainer.add([u.mDetailBubble,u.mNickName,u.mDesText,u.mSource]),u.mPriceContainer.add([y,u.mPriceIcon,u.mPriceText]),u.addActionListener(),u}return p(ElementDetail,t),ElementDetail.prototype.resize=function(t,e){var i=this.scene.cameras.main.width,n=(this.scene.cameras.main.height>>1)-150,o=this.scene.cameras.main.centerX;this.mBuyBtn.x=i-this.mBuyBtn.displayWidth/2-10*this.dpr*this.uiScale,this.mBuyBtn.y=this.height-this.y-this.mBuyBtn.displayHeight/2-12*this.dpr*this.uiScale;var a=this.mBuyBtn.x-this.mBuyBtn.displayWidth/2-this.mCounter.displayWidth/2-17*this.dpr*this.uiScale;this.mCounter.x=a,this.mCounter.y=this.mBuyBtn.y,this.mDetailBubbleContainer.x=10*this.dpr;var s=i-(i-this.mCounter.x)-this.mCounter.width/2;if(this.mDetailBubbleContainer.displayWidth+this.mDetailBubbleContainer.x+10*this.dpr>s){var h=s-16*this.dpr*this.uiScale;this.mDesText.setWordWrapWidth(h-10*this.dpr*this.uiScale,!0),this.resizeDesBubble(h,this.mDetailBubbleContainer.height)}this.mPriceContainer.x=this.mCounter.x,this.mPriceContainer.y=this.mCounter.y-35*this.dpr,this.mDetailDisplay.x=o,this.mDetailDisplay.y=(this.height-this.y)/2;var l=.8*i,c=.7*n;this.setInteractive(new Phaser.Geom.Rectangle((i>>1)+(i-l>>1),n>>1,l,c),Phaser.Geom.Rectangle.Contains),this.mCounter.resize()},ElementDetail.prototype.addActionListener=function(){this.mCounter&&(this.mCounter.addActionListener(),this.mCounter.on("change",this.onChangeCounterHandler,this),this.on("pointerup",this.onPointerUpHandler,this))},ElementDetail.prototype.removeActionListener=function(){this.mCounter&&(this.mCounter.removeActionListener(),this.mCounter.off("change",this.onChangeCounterHandler,this),this.off("gameobjectup",this.onPointerUpHandler,this))},ElementDetail.prototype.setProp=function(t){this.mSelectedProp=t,this.mNickName.setText(t.shortName||t.name),this.mDesText.setText(t.des),t.price&&t.price.length>0?(this.mPriceIcon.setTexture(this.key,"tuding_icon"),this.updatePrice(t.price[0].price.toString())):this.mPriceText.setText(""),t.source?this.mSource.setText("来源： "+t.source):this.mSource.setText(""),this.resizeDesBubble(),this.mCounter.setCounter(1)},ElementDetail.prototype.setResource=function(t){t.display?this.mDetailDisplay.loadDisplay(t):t.avatar?this.mDetailDisplay.loadAvatar(t):this.mDetailDisplay.loadUrl(this.mSelectedProp.icon)},ElementDetail.prototype.updatePrice=function(t){this.mPriceText.setText(t),this.mPriceIcon.x=this.mPriceText.x-this.mPriceText.width/2-16*this.dpr},ElementDetail.prototype.onBuyHandler=function(){if(this.mSelectedProp){var t=a.op_def.OrderCommodities.create();t.id=this.mSelectedProp.id,t.quantity=this.mCounter.number,t.category=this.mSelectedProp.category,this.emit("buyItem",t)}},ElementDetail.prototype.onChangeCounterHandler=function(t){this.mSelectedProp&&(!this.mSelectedProp.price||this.mSelectedProp.price.length<1||this.updatePrice((this.mSelectedProp.price[0].price*this.mCounter.number).toString()))},ElementDetail.prototype.onPointerUpHandler=function(){this.emit("popItemCard",this.mSelectedProp,this.mDetailDisplay.display),this.mCounter.setBlur()},ElementDetail.prototype.resizeDesBubble=function(t,e){void 0===t&&(t=this.mDetailBubbleContainer.width);var i=this.mDesText.height+60*this.dpr*this.uiScale;t===this.mDetailBubbleContainer.width&&i===this.mDetailBubbleContainer.height||(this.mDetailBubble.clear(),this.mDetailBubble.fillStyle(16777215,.1),this.mDetailBubble.fillRoundedRect(0,0,t,i),this.mDetailBubbleContainer.setSize(t,i),this.mDetailBubbleContainer.y=this.height-this.y-this.mDetailBubbleContainer.height-6*this.dpr)},ElementDetail.prototype.onShowDisplayHandler=function(t){},ElementDetail}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"NumberCounter",(function(){return s}));var n,o=i(222),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function NumberCounter(e,i,n,a,s,h){void 0===s&&(s=1),void 0===h&&(h=1);var l=t.call(this,e,n,a)||this;return l.pressDelay=500,l.mMinNum=1,l.mMaxNum=99,l.mBackground=l.scene.make.image({key:i,frame:"input_bg"}).setScale(h),l.mReduceBtn=l.scene.make.image({key:i,frame:"reduce"},!1).setInteractive().setScale(h),l.mReduceBtn.x=-l.mBackground.displayWidth/2-l.mReduceBtn.displayWidth/2-7*s*h,l.mIncreaseBtn=l.scene.make.image({key:i,frame:"increase"},!1).setInteractive().setScale(h),l.mIncreaseBtn.x=(l.mBackground.displayWidth+l.mIncreaseBtn.displayWidth)/2+7*s*h,l.mLabelInput=new o.LabelInput(l.scene,{x:0,y:0,width:160,height:80,fontSize:14*s*h+"px",color:"#666666",align:"center",type:"number"}),l.mLabelInput.setOrigin(.5),l.mLabelInput.setText("1"),l.mLabelInput.on("textchange",l.onTextChangeHandler,l),l.add([l.mBackground,l.mLabelInput,l.mReduceBtn,l.mIncreaseBtn]),l.setSize(l.mIncreaseBtn.displayWidth+l.mReduceBtn.displayWidth+l.mBackground.displayWidth+14*s*h,l.mBackground.displayHeight),l}return a(NumberCounter,t),NumberCounter.prototype.resize=function(){},NumberCounter.prototype.setMinNumber=function(t){this.mMinNum=t},NumberCounter.prototype.setMaxNumber=function(t){this.mMaxNum=t},NumberCounter.prototype.addActionListener=function(){this.mIncreaseBtn.on("pointerup",this.onIncreaseHandler,this),this.mIncreaseBtn.on("pointerdown",this.onIncreaseDownHandler,this),this.mReduceBtn.on("pointerup",this.onReduceHandler,this),this.mReduceBtn.on("pointerdown",this.onReduceDownHandler,this)},NumberCounter.prototype.removeActionListener=function(){this.mIncreaseBtn.off("pointerup",this.onIncreaseHandler,this),this.mIncreaseBtn.off("pointerdown",this.onIncreaseDownHandler,this),this.mReduceBtn.off("pointerup",this.onReduceHandler,this),this.mReduceBtn.off("pointerdown",this.onReduceDownHandler,this)},NumberCounter.prototype.setCounter=function(t){isNaN(t)&&(t=0),t<this.mMinNum?t=this.mMinNum:t>this.mMaxNum&&(t=this.mMaxNum),this.mLabelInput.setText(t.toString()),this.emit("change",t)},NumberCounter.prototype.setBlur=function(){this.mLabelInput.setBlur()},Object.defineProperty(NumberCounter.prototype,"number",{get:function(){return parseInt(this.mLabelInput.text,10)},enumerable:!1,configurable:!0}),NumberCounter.prototype.onReduceHandler=function(){var t=parseInt(this.mLabelInput.text,10);this.setCounter(--t),this.clearTween()},NumberCounter.prototype.onIncreaseHandler=function(){var t=parseInt(this.mLabelInput.text,10);this.setCounter(++t),this.clearTween()},NumberCounter.prototype.onTextChangeHandler=function(){this.setCounter(parseInt(this.mLabelInput.text,10))},NumberCounter.prototype.onReduceDownHandler=function(){var t=this;this.pressTimeout=setTimeout((function(){t.delayTweenNumber(t.mMinNum)}),this.pressDelay),this.setBlur()},NumberCounter.prototype.onIncreaseDownHandler=function(){var t=this;this.pressTimeout=setTimeout((function(){t.delayTweenNumber(t.mMaxNum)}),this.pressDelay),this.setBlur()},NumberCounter.prototype.delayTweenNumber=function(t){var e=this,i=this.number;this.tween=this.scene.tweens.addCounter({from:i,to:t,onUpdate:function(){e.setCounter(e.tween.getValue()>>0)},duration:50*Math.abs(i-t)})},NumberCounter.prototype.clearTween=function(){clearTimeout(this.pressTimeout),this.tween&&(this.tween.stop(),this.tween=void 0)},NumberCounter}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"LabelInput",(function(){return h}));var n,o=i(23),a=i(9),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function LabelInput(e,i){var n=t.call(this,e)||this,o={fontFamily:a.a.DEFULT_FONT},s=i.width||100,h=i.height||100;return n.mLabel=n.scene.make.text({style:Object.assign(o,i)},!1).setInteractive(new Phaser.Geom.Rectangle(-(s>>1),-(h>>1),s,h),Phaser.Geom.Rectangle.Contains),n.mLabel.on("pointerup",n.onShowInputHandler,n),n.add(n.mLabel),n.mInputConfig=i,n}return s(LabelInput,t),LabelInput.prototype.setText=function(t){this.mLabel.setText(t),this.mInputText&&(this.mInputText.text=t)},LabelInput.prototype.setOrigin=function(t,e){this.mLabel.setOrigin(t,e),this.mInputText&&this.mInputText.setOrigin(t,e)},LabelInput.prototype.setBlur=function(){this.onShowLabel()},LabelInput.prototype.destroy=function(){this.mLabel.destroy(),this.destroyInput(),t.prototype.destroy.call(this)},LabelInput.prototype.createInputText=function(){var t=this;this.mInputText&&this.mInputText.destroy(),this.mInputText=new o.a(this.scene,Object.assign({},this.mInputConfig)),this.mInputText.on("textchange",this.onTextChangeHandler,this),this.mInputText.node.addEventListener("keypress",(function(e){13===(e.keyCode||e.which)&&t.onShowLabel()}))},LabelInput.prototype.onShowInputHandler=function(){this.createInputText(),this.remove(this.mLabel),this.add(this.mInputText),this.mInputText.setText(this.mLabel.text),this.mInputText.setFocus()},LabelInput.prototype.onShowLabel=function(){this.mInputText&&(this.mLabel.setText(this.mInputText.text),this.destroyInput()),this.add(this.mLabel)},LabelInput.prototype.destroyInput=function(){this.mInputText&&(this.mInputText.destroy(),this.mInputText=void 0)},LabelInput.prototype.onTextChangeHandler=function(){this.emit("textchange")},Object.defineProperty(LabelInput.prototype,"object",{get:function(){return this.mInputText||this.mLabel},enumerable:!1,configurable:!0}),Object.defineProperty(LabelInput.prototype,"text",{get:function(){return this.mInputText?this.mInputText.text:this.mLabel.text},enumerable:!1,configurable:!0}),LabelInput}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"Market",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function Market(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(Market,t),Market.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_GET_MARKET_CATEGORIES,this.onGetMarketCategoriesHandler),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY,this.onQueryMarketHandler),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_MARKET_QUERY_COMMODITY_RESOURCE,this.onQueryCommodityResultHandler))},Market.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},Market.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},Market.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},Market.prototype.getMarkCategories=function(){var t=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_GET_CATEGORIES);this.connection.send(t)},Market.prototype.queryMarket=function(t,e,i){var n=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_QUERY),s=n.content;s.page=t,s.category=e,s.subcategory=i,this.connection.send(n)},Market.prototype.buyMarketCommodities=function(t){var e=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_BUY_ORDER_COMMODITIES);e.content.orderCommodities=t,this.connection.send(e)},Market.prototype.queryCommodityResource=function(t,e){var i=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MARKET_QUERY_COMMODITY_RESOURCE),n=i.content;n.id=t,n.category=e,this.connection.send(i)},Market.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Market.prototype.onGetMarketCategoriesHandler=function(t){this.mEvent.emit("getMarketCategories",t.content)},Market.prototype.onQueryMarketHandler=function(t){this.mEvent.emit("queryMarket",t.content)},Market.prototype.onQueryCommodityResultHandler=function(t){t.content;this.mEvent.emit("queryCommodityResource",t.content)},Object.defineProperty(Market.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),Market}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"MarketItem",(function(){return l}));var n,o=i(16),a=i(5),s=i(9),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function MarketItem(e,i,n,a,h){var l=t.call(this,e,i,n)||this;l.dpr=a,l.mBackground=l.scene.make.image({key:"market",frame:"border"},!1).setOrigin(0).setScale(h),l.mBorder=l.scene.make.image({x:3*a*h,y:3*a*h,key:"market",frame:"item_border"},!1).setOrigin(0).setScale(h),l.mPropImage=new o.DynamicImage(e,0,0),l.mPropImage.scale=l.dpr*h,l.mNickName=l.scene.make.text({x:62*l.dpr*h,y:6*l.dpr*h,style:{fontSize:14*l.dpr*h,fontFamily:s.a.DEFULT_FONT,color:"#3399cc"}},!1);var c=l.scene.make.image({x:62*l.dpr*h,y:34*l.dpr*h,key:"market",frame:"price_border"},!1).setOrigin(0).setScale(h);return l.mCoinIcon=l.scene.make.image({x:48*l.dpr*h,y:35*l.dpr*h,key:"market",frame:"tuding_icon"},!1).setOrigin(0).setScale(h),l.mPriceText=l.scene.make.text({x:67*l.dpr*h,y:38*l.dpr*h,style:{fontSize:14*l.dpr*h,fontFamily:s.a.DEFULT_FONT,color:"#996600"}}),l.mTagIcon=l.scene.make.image({key:"market",frame:"tip_red",x:-86*l.dpr,y:-34*l.dpr},!1).setOrigin(0).setScale(h),l.add([l.mBackground,l.mBorder,l.mPropImage,l.mNickName,c,l.mCoinIcon,l.mPriceText]),l.setSize(l.mBackground.displayWidth,l.mBackground.displayHeight),l}return h(MarketItem,t),MarketItem.prototype.setProp=function(t){this.mProp=t,this.mPropImage.load(a.h.getOsdRes(t.icon),this,this.onPropLoadComplete),this.mPropImage.x=this.mBorder.x+this.mBorder.displayWidth/2,this.mPropImage.y=this.mBorder.y+this.mBorder.displayHeight/2,this.mNickName.setText(t.shortName||t.name),this.mPriceText.setText(t.price[0].price.toString())},MarketItem.prototype.onPropLoadComplete=function(){if(this.mPropImage){var t=this.mPropImage.texture;t&&t.setFilter(Phaser.Textures.FilterMode.NEAREST)}},MarketItem.prototype.onPointerUpHandler=function(){this.emit("select",this.mProp)},MarketItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxView",(function(){return p}));var n,o=i(6),a=i(19),s=i(5),h=i(12),l=i(21),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function MessageBoxView(e,i){return t.call(this,e,i)||this}return c(MessageBoxView,t),MessageBoxView.prototype.resize=function(){var t=this.mWorld.getSize();this.mWorld.game.device.os.desktop,this.x=t.width>>1,this.y=t.height>>1},MessageBoxView.prototype.show=function(e){if(t.prototype.show.call(this,e),this.mInitialized){this.mButtons=[],e[0]&&e[0].text&&e[0].text[0]&&this.mTxt.setText(e[0].text[0].text);var i=e[0].button;if(i){var n=this.mWidth/i.length,o=this.mScene.make.container(void 0,!1);o.y=this.mHeight-24-100;for(var h=0;h<i.length;h++){i[h]&&i[h].text;var l=new a.NinePatchButton(this.mScene,0,0,46,24,"button_blue","button_blue",i[h].text,s.c.getConfig(),i[h]);l.x=h*n+23,this.mButtons.push(l),o.add(l)}o.setSize((i.length-1)*n+46,24),o.x=this.width-o.width>>1,this.add(o)}this.resize()}},MessageBoxView.prototype.destroy=function(){this.mTxt&&this.mTxt.destroy(!0),this.mButtons&&this.mButtons.length>0&&(this.mButtons.forEach((function(t){t&&t.destroy(!0)})),this.mButtons.length=0,this.mButtons=[]),this.mTxt=null,this.mButtons=null,t.prototype.destroy.call(this)},Object.defineProperty(MessageBoxView.prototype,"buttons",{get:function(){return this.mButtons},enumerable:!1,configurable:!0}),MessageBoxView.prototype.preload=function(){this.mScene&&(this.mScene.load.atlas(s.c.getName(),s.c.getPNG(),s.c.getJSON()),this.mScene.load.image(s.d.getName(),s.d.getPNG()),t.prototype.preload.call(this))},MessageBoxView.prototype.init=function(){this.mWorld.getSize();this.mWidth=300,this.mHeight=200;var e=new h.NinePatch(this.scene,0,0,this.mWidth,this.mHeight,s.d.getName(),null,s.d.getConfig());e.x=0,e.y=0,this.add(e),this.mTxt=new l.a(this.mScene,0,0,"",{fontSize:"16px",wrap:{mode:"char",width:e.width},halign:"center"}),this.mTxt.x=-this.mWidth/2+10,this.mTxt.y=-this.mHeight/2+10,this.add(this.mTxt),t.prototype.init.call(this)},MessageBoxView}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineSettle",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function MineSettle(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(MineSettle,t),MineSettle.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MINING_MODE_SHOW_REWARD_PACKAGE,this.onMineSettlePackageHandler))},MineSettle.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},MineSettle.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},MineSettle.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},MineSettle.prototype.reqMineSettlePacket=function(){var t=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MINING_MODE_STORAGE_REWARD);this.connection.send(t)},MineSettle.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(MineSettle.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),MineSettle.prototype.onMineSettlePackageHandler=function(t){var e=t.content;this.mEvent.emit("minesettlepacket",e)},MineSettle}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineSettlePanel",(function(){return m}));var n,o=i(9),a=i(16),s=i(6),h=i(12),l=i(19),c=i(5),p=i(42),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function MineSettlePanel(e,i){var n=t.call(this,e,i)||this;return n.key="mine_settle",n}return u(MineSettlePanel,t),MineSettlePanel.prototype.resize=function(e,i){var n=this.scene.cameras.main.width/this.scale,o=this.scene.cameras.main.height/this.scale,a=this.mWorld.uiScale;t.prototype.resize.call(this,n,o),this.bg.x=n/2,this.bg.y=o/2,this.titleimage.x=n/2,this.titleimage.y=this.bg.y-this.bg.displayHeight/2-8*this.dpr*a,this.confirmBtn.x=n/2,this.confirmBtn.y=this.bg.y+100*this.dpr*a,this.titleName.x=n/2,this.titleName.y=this.titleimage.y+32*this.dpr*a,this.blackGraphic.clear(),this.blackGraphic.fillStyle(0,.66),this.blackGraphic.fillRect(0,0,n/this.scale*a,o/this.scale*a),this.mPropGrid.refreshPos(this.scene.cameras.main.width*a>>1,this.bg.y-5*this.dpr*a),this.setSize(n*this.scale*this.scale,o*this.scale*this.scale)},MineSettlePanel.prototype.show=function(t){this.mShowData=t,this.refreshData(),this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},MineSettlePanel.prototype.addListen=function(){this.mInitialized&&this.confirmBtn.on("click",this.onConfirmBtnClick,this)},MineSettlePanel.prototype.removeListen=function(){this.mInitialized&&this.confirmBtn.off("click",this.onConfirmBtnClick,this)},MineSettlePanel.prototype.preload=function(){this.addAtlas(this.key,"minesettle/settlement.png","minesettle/settlement.json"),t.prototype.preload.call(this)},MineSettlePanel.prototype.init=function(){var e=this,i=this.mWorld.uiScale;this.bg=new h.NinePatch(this.scene,0,0,293*this.dpr*i,260*this.dpr*i,this.key,"bg",{left:10,top:10,right:10,bottom:10}),this.blackGraphic=this.scene.make.graphics(void 0,!1),this.blackGraphic.setInteractive(new Phaser.Geom.Rectangle(0,0,this.scene.cameras.main.width,this.scene.cameras.main.height),Phaser.Geom.Rectangle.Contains);var n=this.scene.textures.getFrame(this.key,"icon_test"),a=n.width+20*this.dpr*i,s=n.height+25*this.dpr*i,c=(this.scene.cameras.main.width,this.scene.cameras.main.height,{x:0,y:0,table:{width:280*this.dpr*i,height:180*this.dpr*i,columns:5,cellWidth:a,cellHeight:s,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0},clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,o=t.item;return null===i&&(i=new d(n,e.dpr),e.add(i)),i.setData({item:o}),i.setItemData(o),i}});this.mPropGrid=new p.a(this.scene,c),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){var i=t.itemData;i&&e.onSelectItemHandler(i)})),this.titleimage=this.scene.make.image({x:0,y:.5*-this.bg.displayWidth-10*this.dpr*i,key:this.key,frame:"title"},!1),this.titleName=this.scene.make.text({x:0,y:this.titleimage.y+32*this.dpr*i,text:"获得物品",style:{fontSize:15*this.dpr,fontFamily:o.a.DEFULT_FONT}}).setOrigin(.5,.5),this.confirmBtn=new l.NinePatchButton(this.scene,0,100*this.dpr*i,90*this.dpr*i,40*this.dpr*i,this.key,"button","存入背包",{left:20,top:20,right:20,bottom:20}),this.confirmBtn.setTextStyle({color:"#976400",fontSize:16*this.dpr,fontFamily:o.a.DEFULT_FONT}),this.add([this.blackGraphic,this.bg,this.titleimage,this.titleName,this.confirmBtn]),this.add(this.mPropGrid.table),this.resize(0,0),t.prototype.init.call(this)},MineSettlePanel.prototype.setMineSettlePacket=function(t){this.mInitialized&&this.mPropGrid.setItems(t.items)},MineSettlePanel.prototype.destroy=function(){this.mPropGrid&&this.mPropGrid.destroy(),this.confirmBtn&&this.confirmBtn.destroy(),this.mPropGrid=null,this.confirmBtn=null,t.prototype.destroy.call(this)},MineSettlePanel.prototype.refreshData=function(){var t=this.getData("settleData");t&&this.setMineSettlePacket(t)},MineSettlePanel.prototype.onSelectItemHandler=function(t){},MineSettlePanel.prototype.onConfirmBtnClick=function(t){this.checkPointerDis(t)&&this.emit("hide")},MineSettlePanel.prototype.checkPointerDis=function(t){return!this.mWorld||Math.abs(t.downX-t.upX)<10*this.mWorld.uiRatio*this.mWorld.uiScale&&Math.abs(t.downY-t.upY)<10*this.mWorld.uiRatio*this.mWorld.uiScale},MineSettlePanel}(s.BasePanel),d=function(t){function MineSettleItem(e,i){var n=t.call(this,e)||this;return n.dpr=i,n.icon=new a.DynamicImage(e,0,0),n.itemCount=n.scene.make.text({text:"600",style:{fontSize:18,fontFamily:o.a.DEFULT_FONT}},!1),n.itemCount.setOrigin(.5,0),n.icon.setOrigin(0,0),n.icon.setScale(n.dpr),n.itemCount.setPosition(0,n.icon.height),n.add(n.icon),n.add(n.itemCount),n}return u(MineSettleItem,t),MineSettleItem.prototype.setItemData=function(t){var e=this;this.itemData=t,this.itemCount.setFontSize(14*this.dpr),this.itemCount.text=t.count+"";var i=c.h.getOsdRes(t.display.texturePath);this.icon.load(i,this,(function(){e.icon.setScale(33*e.dpr/e.icon.width),e.icon.setPosition(0,3*e.dpr),e.itemCount.setPosition(.5*e.icon.displayWidth,e.icon.x+e.icon.displayHeight+3*e.dpr)}))},MineSettleItem.prototype.destroy=function(){t.prototype.destroy.call(this),this.icon&&this.icon.destroy(),this.itemCount&&this.itemCount.destroy(),this.itemData=null,this.icon=null,this.itemCount=null,this.scene=null},MineSettleItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"NpcDialogue",(function(){return s}));var n,o=i(4),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function NpcDialogue(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return a(NpcDialogue,t),NpcDialogue.prototype.register=function(){this.connection&&this.connection.addPacketListener(this)},NpcDialogue.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},NpcDialogue.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},NpcDialogue.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},NpcDialogue.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},Object.defineProperty(NpcDialogue.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),NpcDialogue}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"NpcDialoguePanel",(function(){return p}));var n,o=i(6),a=i(16),s=i(9),h=i(25),l=i(48),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function NpcDialoguePanel(e,i){var n=t.call(this,e,i)||this;return n.key="commonkey",n.listItems=[],n}return c(NpcDialoguePanel,t),NpcDialoguePanel.prototype.resize=function(e,i){var n=this.mWorld.uiScale,o=this.scene.cameras.main.width/n,a=this.scene.cameras.main.height/n,s=177*this.dpr*n;t.prototype.resize.call(this,o,a),this.x=o/2,this.y=a/2,this.content.setPosition(0,(a-s)/2),this.setSize(o,a)},NpcDialoguePanel.prototype.preload=function(){this.addAtlas(this.key,"common/ui_base.png","common/ui_base.json"),t.prototype.preload.call(this)},NpcDialoguePanel.prototype.init=function(){var e=this.mWorld.uiScale,i=this.scene.cameras.main.width/e,n=this.scene.cameras.main.height/e,o=177*this.dpr*e;this.content=this.scene.make.container({x:0*this.dpr*e,y:(n-o)/2,width:i,height:o},!1),this.content.setSize(i,o);var l=this.scene.make.image({x:0,y:0,key:this.key,frame:"menu_bg_l"});l.scaleY=e,l.texture.setFilter(Phaser.Textures.FilterMode.NEAREST),l.displayWidth=i,l.displayHeight=o;var c=this.scene.make.graphics(void 0,!1),p=i-30*this.dpr*e,u=122*this.dpr*e;c.setPosition(-p>>1,.5*-u+13*this.dpr*e),c.clear(),c.fillStyle(16777215,1),c.fillRoundedRect(0,0,p,u,8*this.dpr*e);var m=.5*-i+38*this.dpr*e,d=.5*-o+25*this.dpr*e;this.npcIcon=new a.DynamicImage(this.scene,m,d);var f=this.scene.make.image({x:m+100*this.dpr*e,y:d,key:this.key,frame:"name_bg"});this.npcName=this.scene.make.text({x:f.x-48*this.dpr*e,y:f.y,text:"尼古拉斯.赵二",style:{fontSize:15*this.dpr,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,.5);var y=new h.a(this.scene,this.key,"close_1","close_1");y.setPosition(.5*i-30*this.dpr*e,.5*-o+10*this.dpr*e),y.on("Tap",this.onCloseHandler,this),this.content.add([l,c,this.npcIcon,f,this.npcName,y]),this.add(this.content),this.resize(0,0),t.prototype.init.call(this),this.layoutItem(void 0)},NpcDialoguePanel.prototype.layoutItem=function(t){var e=(t=["聊天","购买物品","威威"]).length,i=e>4?2:1,n=this.mWorld.uiScale,o=(this.dpr,295*this.dpr*n),a=27*this.dpr*n,s=o/i,h=4*this.dpr*n;2===e?h=15*this.dpr*n:3===e&&(h=10*this.dpr*n);for(var c=(124*this.dpr*n-(h+a)*(e<4?e:4)-h)/2-42*this.dpr*n,p=0;p<e;p++){var m=new u(this.scene,this.dpr,n,this.key),d=.5*(o-s)*(p<4?-1:1),f=c+.5*a+(a+h)*(p%4);m.setItemSize(s,a),m.setPosition(d,f),m.setItemData(t[p],new l.a(this,this.onItemHandler)),this.content.add(m)}},NpcDialoguePanel.prototype.onItemHandler=function(t){this.curSelectItem&&(this.curSelectItem.select=!1),t.select=!0,this.curSelectItem=t},NpcDialoguePanel.prototype.onCloseHandler=function(){this.hide()},NpcDialoguePanel}(o.BasePanel),u=function(t){function NpcDialogueItem(e,i,n,o){var a=t.call(this,e)||this;return a.dpr=0,a.zoom=0,a.zoom=n,a.dpr=i,a.selectBg=a.scene.make.image({x:0,y:0,key:o,frame:"select_bg"}),a.arrImg=a.scene.make.image({x:.5*-a.selectBg.width,y:0,key:o,frame:"arrow_r"}),a.content=a.scene.make.text({x:0,y:0,text:"购买物品",style:{color:"#000000",fontSize:15*i,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,.5),a.add([a.selectBg,a.arrImg,a.content]),a.width=a.selectBg.width,a.height=a.selectBg.height,a.on("pointerdown",a.onClickHandler,a),a}return c(NpcDialogueItem,t),NpcDialogueItem.prototype.setItemData=function(t,e){this.itemData=t,this.content.text=t,this.handler=e,this.select=!1},Object.defineProperty(NpcDialogueItem.prototype,"select",{set:function(t){this.selectBg.visible=t},enumerable:!1,configurable:!0}),NpcDialogueItem.prototype.setItemSize=function(e,i){t.prototype.setSize.call(this,e,i),this.selectBg.displayWidth=e,this.arrImg.x=.5*-e*.9,this.content.x=this.arrImg.x+20*this.dpr*this.zoom,this.removeInteractive(),this.setInteractive(new Phaser.Geom.Rectangle(0,0,e,i),Phaser.Geom.Rectangle.Contains)},NpcDialogueItem.prototype.onClickHandler=function(){this.handler&&this.handler.runWith(this)},NpcDialogueItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMessageBoxPanel",(function(){return p}));var n,o=i(6),a=i(12),s=i(9),h=i(19),l=i(21),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function PicaMessageBoxPanel(e,i){var n=t.call(this,e,i)||this;return n.key="pica_message_box",n.disInteractive(),n}return c(PicaMessageBoxPanel,t),PicaMessageBoxPanel.prototype.show=function(e){if(t.prototype.show.call(this,e),this.mInitialized){this.mButtons=[],e[0]&&e[0].text&&e[0].text[0]&&(this.mText.setText(e[0].text[0].text),this.mText.x=-this.mText.width/2,this.mText.y=-this.mText.height);var i=e[0].button;if(i){var n=114*this.dpr,o=40*this.dpr,a=(this.width-42*this.dpr)/i.length;this.mButtonContaier.y=this.height/2-o;var l=this.scene.textures.getFrame(this.key,"yellow_btn_normal");if(!l)return;for(var c={left:13*this.dpr,top:13*this.dpr,bottom:l.width-2-13*this.dpr,right:l.height-2-13*this.dpr},p=0,u=0;u<i.length;u++){i[u]&&i[u].text;var m=new h.NinePatchButton(this.mScene,0,0,n,o,this.key,0===u?"yellow_btn":"red_btn",i[u].text,c,i[u]);m.setTextStyle({fontFamily:s.a.DEFULT_FONT,fontSize:16*this.dpr}),m.x=u*a+n/2,p+=u*a+n/2,this.mButtons.push(m),m.on("click",this.onClickHandler,this)}this.mButtonContaier.add(this.mButtons),this.mButtonContaier.x=-p/2}this.resize(0,0)}},PicaMessageBoxPanel.prototype.resize=function(e,i){var n=this.scene.cameras.main.width,o=this.scene.cameras.main.height;this.x=n/2,this.y=o/2,t.prototype.resize.call(this,e,i)},PicaMessageBoxPanel.prototype.preload=function(){this.addAtlas(this.key,"pica_message_box/pica_message_box.png","pica_message_box/pica_message_box.json"),t.prototype.preload.call(this)},PicaMessageBoxPanel.prototype.init=function(){var e=this.scene.textures.getFrame(this.key,"bg"),i=new a.NinePatch(this.scene,0,0,286*this.dpr,e.height,this.key,"bg",{left:22*this.dpr,top:e.height,right:22*this.dpr,bottom:0});this.setSize(i.width,i.height),this.mButtonContaier=this.scene.make.container(void 0,!1);var n=this.scene.make.image({y:-i.height/2,key:this.key,frame:"title"});this.mTitleLabel=this.scene.make.text({y:n.y-6*this.dpr,style:{fontFamily:s.a.DEFULT_FONT,fontSize:16*this.dpr,color:"#3366cc"}},!1).setOrigin(.5),this.mText=new l.a(this.mScene,0,0,"",{fontSize:14*this.dpr+"px",fontFamily:s.a.DEFULT_FONT,color:"#000000",origin:{x:.5,y:.5},wrap:{mode:"char",width:this.width},align:"center"}),this.add([i,n,this.mTitleLabel,this.mText,this.mButtonContaier]),t.prototype.init.call(this),this.resize(0,0)},PicaMessageBoxPanel.prototype.onClickHandler=function(t,e){if(e){var i=e.getBtnData();i&&this.emit("click",i)}},PicaMessageBoxPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNoticePanel",(function(){return l}));var n,o=i(6),a=i(21),s=i(9),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function PicaNoticePanel(e,i){return t.call(this,e,i)||this}return h(PicaNoticePanel,t),PicaNoticePanel.prototype.show=function(t){var e=this;if(this.mShowData=t,this.mInitialized){if(t&&t.length>0){var i=t[0].text;this.mContent&&this.mContent.setText(i[0].text);this.scene.cameras.main.width;this.scene.tweens.timeline({targets:this,duration:500,tweens:[{y:"-="+20*this.dpr,ease:"Bounce.easeOut"},{delay:2e3,y:"-="+20*this.dpr,ease:"Linear",alpha:0}],onComplete:function(){e.emit("close")}})}}else this.preload()},PicaNoticePanel.prototype.resize=function(){this.x=this.scene.cameras.main.width/2,this.y=170*this.dpr},PicaNoticePanel.prototype.preload=function(){this.addImage("pica_notice_bg","pica_notice/bg.png"),t.prototype.preload.call(this)},PicaNoticePanel.prototype.init=function(){var e=this.scene.make.image({key:"pica_notice_bg"},!1);this.mContent=new a.a(this.mScene,0,0,"",{fontSize:16*this.dpr+"px",fontFamily:s.a.DEFULT_FONT,stroke:"#000000",strokeThickness:1*this.dpr,align:"center",textMask:!1,shadow:{offsetX:0,offsetY:0,color:"#000",blur:4,stroke:!0,fill:!0},wrap:{mode:"char",width:e.width*this.scale-12*this.dpr}}).setOrigin(.5,.5),this.mContent.setFontStyle("bold"),this.add([e,this.mContent]),this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),t.prototype.init.call(this),this.resize()},PicaNoticePanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"RoomList",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function RoomList(e){var i=t.call(this)||this;return i.world=e,i.mEvent=new Phaser.Events.EventEmitter,i}return s(RoomList,t),RoomList.prototype.register=function(){this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ROOM_LIST,this.onRoomListHandler),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_GET_PLAYER_ENTER_ROOM_HISTORY,this.onMyRoomListHandler),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ENTER_ROOM,this.onEnterRoomResultHandler))},RoomList.prototype.unregister=function(){this.connection&&this.connection.removePacketListener(this)},RoomList.prototype.on=function(t,e,i){this.mEvent.on(t,e,i)},RoomList.prototype.off=function(t,e,i){this.mEvent.off(t,e,i)},RoomList.prototype.destroy=function(){this.unregister(),this.mEvent.destroy()},RoomList.prototype.sendGetRoomList=function(){var t=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_ROOM_LIST);this.connection.send(t)},RoomList.prototype.sendMyHistory=function(){this.connection.send(new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_GET_PLAYER_ENTER_ROOM_HISTORY))},RoomList.prototype.sendEnterRoom=function(t,e){var i=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER_ROOM),n=i.content;n.roomId=t,n.password=e,this.connection.send(i)},RoomList.prototype.onRoomListHandler=function(t){this.mEvent.emit("roomList",t.content)},RoomList.prototype.onMyRoomListHandler=function(t){this.mEvent.emit("myRoomList",t.content)},RoomList.prototype.onEnterRoomResultHandler=function(t){this.mEvent.emit("enterRoomResult",t)},Object.defineProperty(RoomList.prototype,"connection",{get:function(){if(this.world)return this.world.connection},enumerable:!1,configurable:!0}),RoomList}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopMediator",(function(){return u}));var n,o=i(13),a=i(4),s=i(3),h=i(234),l=i(7),c=i(18),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function ShopMediator(e,i,n){var o=t.call(this)||this;return o._perPage=50,o.isEnd=!1,o.world=n,o.mScene=i,o.mLayerManager=e,o.mUIType=c.a.Normal,o}return p(ShopMediator,t),ShopMediator.prototype.isSceneUI=function(){return!1},ShopMediator.prototype.resize=function(){if(this.mView)return this.mView.resize()},ShopMediator.prototype.getView=function(){return this.mView},ShopMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||this.mShow||(this.mView=new h.ShopPanel(this.mScene,this.world),this.mView.show(e),this.world.emitter.on(o.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.emitter.on(o.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.requestVirtualWorldQueryPackage(e[0].id,1,h.ShopPanel.ShopSlotCount),this.mLayerManager.addToUILayer(this.mView),this.world.uiManager.checkUIState(ShopMediator.NAME,!1),t.prototype.show.call(this,e))},ShopMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},ShopMediator.prototype.hide=function(){this.mView&&(this.mShow=!1,this.world.emitter.off(o.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.emitter.off(o.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.mView.hide(),this.mView=null,this.world.uiManager.checkUIState(ShopMediator.NAME,!0),t.prototype.hide.call(this))},ShopMediator.prototype.destroy=function(){this.world.emitter.off(o.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.emitter.off(o.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.world=null,this.mScene=null,this._curPage=0,this.fetching=!1,this.isEnd=!1,t.prototype.destroy.call(this)},ShopMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ShopMediator.prototype.requestVirtualWorldQueryPackage=function(t,e,i){var n=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),o=n.content;o.id=t,o.page=e,o.perPage=i,this.world.connection.send(n)},ShopMediator.prototype.queryShopProps=function(t,e){if(void 0===t&&(t=1),void 0===e&&(e=50),!1!=!!this.mParam){this.fetching=!0;var i=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),n=i.content;n.id=this.mParam[0].id,n.page=t,n.perPage=e,this.world.connection.send(i)}},ShopMediator.prototype.queryPackageHandler=function(t){t.items.length>0&&t.id===this.mParam[0].id?this.mView.setDataList(t):this.isEnd=!0,this.fetching=!1},ShopMediator.prototype.onShowItemHandler=function(t){for(var e=0,i=t.price;e<i.length;e++){i[e].coinType,s.op_def.CoinType.TU_DING_COIN}var n=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),o=n.content;o.uiId=this.mParam[0].id,o.componentId=t.id,this.world.connection.send(n)},ShopMediator.prototype.syncUserBalance=function(){var t=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_USER_BALANCE);this.world.connection.send(t)},ShopMediator.prototype.onChangeIndex=function(t){t>=.9&&!1===this.fetching&&!1===this.isEnd&&(this._curPage++,this.queryShopProps(this._curPage))},ShopMediator.prototype.onSyncUserBalanceHandler=function(t){this.mView},ShopMediator.prototype.onPayTuDingHandler=function(){},ShopMediator.NAME="ShopMediator",ShopMediator}(l.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopPanel",(function(){return m}));var n,o=i(6),a=i(5),s=i(257),h=i(233),l=i(12),c=i(26),p=i(27),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function ShopPanel(e,i){var n=t.call(this,e,i)||this;return n.mWorld=i,n}return u(ShopPanel,t),ShopPanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.mWorld.game.device.os.desktop?(this.x=i.width+t>>1,this.y=i.height+e>>1):(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.x=i.width+t>>1,this.y=i.height+e>>1),this.scale=this.mWorld.uiScale},ShopPanel.prototype.setDataList=function(t){this.mShopData=t,this.mInitialized&&this.refreshDataList()},ShopPanel.prototype.destroy=function(){this.mShopItemSlotList&&(this.mShopItemSlotList.forEach((function(t){t&&t.destroy()})),this.mShopItemSlotList.length=0,this.mShopItemSlotList=null),this.mShopData=null,this.mInitialized=!1,t.prototype.destroy.call(this)},ShopPanel.prototype.addListen=function(){this.mInitialized&&this.mClsBtn.on("pointerup",this.shopMedClose,this)},ShopPanel.prototype.removeListen=function(){this.mInitialized&&this.mClsBtn.off("pointerup",this.shopMedClose,this)},ShopPanel.prototype.preload=function(){this.mScene&&(this.mScene.load.image(a.d.getName(),a.d.getPNG()),this.mScene.load.image(a.a.getName(),a.a.getPNG()),this.mScene.load.atlas("itemChose",a.h.getRes("ui/bag/itemChose.png"),a.h.getRes("ui/bag/itemChose.json")),this.mScene.load.atlas("clsBtn",a.h.getRes("ui/common/common_clsBtn.png"),a.h.getRes("ui/common/common_clsBtn.json")),this.mScene.load.atlas("shopView",a.h.getRes("ui/shop/shopView.png"),a.h.getRes("ui/shop/shopView.json")),t.prototype.preload.call(this))},ShopPanel.prototype.loadComplete=function(e,i,n){var o=this.mScene.textures.get("itemChose").frames,a=[];for(var s in o){if("__BASE"!==s)o[s]&&a.push(s)}this.mScene.anims.create({key:"itemSelectFrame",frames:this.mScene.anims.generateFrameNumbers("itemChose",{start:0,end:8,frames:a}),frameRate:33,yoyo:!0,repeat:-1}),t.prototype.loadComplete.call(this,e,i,n)},ShopPanel.prototype.init=function(){var e=this.mWorld.getSize();this.mBg=new l.NinePatch(this.scene,0,0,500,350,a.a.getName(),null,a.a.getConfig()),this.mBg.x=0,this.mBg.y=0,this.setSize(this.mBg.width,this.mBg.height),this.addAt(this.mBg,0),this.mBorder=new l.NinePatch(this.scene,0,0,this.mBg.width-10,this.mBg.height-30,a.d.getName(),null,a.d.getConfig()),this.mBorder.x=this.mBg.x,this.mBorder.y=this.mBg.y+10,this.addAt(this.mBorder,1),this.mWorld.game.device.os.desktop?(this.x=e.width>>1,this.y=e.height-300):(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.x=e.width>>1,this.y=e.height>>1);var i=this.mScene.make.sprite(void 0,!1);i.setTexture("shopView","shopView_titleIcon"),i.x=35+(-this.mBg.width>>1),i.y=-this.mBg.height>>1,this.add(i);var n,o,h,u=this.mScene.make.text(void 0,!1);u.setFontFamily("Tahoma"),u.setFontStyle("bold"),u.setFontSize(20),u.setText("内购商城"),u.x=i.x+i.width-10,u.y=i.y-(u.height>>1),this.add(u),this.mShopItemSlotList=[];for(var m=0;m<20;m++)o=m%5*88-this.mBg.width/2+75,h=82*Math.floor(m/5)-this.mBg.height/2+72,(n=new s.ShopItemSlot(this.mScene,this.mWorld,this,o,h,"shopView","ui/shop/shopView.png","ui/shop/shopView.json","shopView_bagSlot","itemSelectFrame")).createUI(),this.mShopItemSlotList.push(n);this.mClsBtn=new c.IconBtn(this.mScene,this.mWorld,{key:p.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/shop/shopView.png",jsonUrl:"ui/shop/shopView.json"}),this.mClsBtn.x=(this.width>>1)-65,this.mClsBtn.y=-this.height>>1,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn),this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mShopData&&this.refreshDataList(),t.prototype.init.call(this)},ShopPanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(h.ShopMediator.NAME).resize()},ShopPanel.prototype.refreshDataList=function(){if(this.mShopData)for(var t,e=ShopPanel.ShopSlotCount,i=0;i<e;i++)(t=this.mShopItemSlotList[i])&&t.shopDataChange(this.mShopData.items[i],this.mShopData.id)},ShopPanel.prototype.shopMedClose=function(){this.mWorld.uiManager.getMediator(h.ShopMediator.NAME).hide()},ShopPanel.ShopSlotCount=20,ShopPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserInfoMediator",(function(){return l}));var n,o=i(236),a=i(13),s=i(7),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function UserInfoMediator(e,i,n){var o=t.call(this)||this;return o.mLayerManager=e,o.mScene=i,o.world=n,o}return h(UserInfoMediator,t),UserInfoMediator.prototype.getView=function(){return this.mView},UserInfoMediator.prototype.hide=function(){this.mShow=!1,this.world.emitter.off(a.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView&&(this.mView.hide(),this.mView=null)},UserInfoMediator.prototype.isSceneUI=function(){return!1},UserInfoMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},UserInfoMediator.prototype.resize=function(){this.mView&&this.mView.resize()},UserInfoMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||e&&0!==e.length&&(this.mView=new o.UserInfoPanel(this.mScene,this.world),this.mView.show(e[0]),this.mLayerManager.addToUILayer(this.mView),this.world.emitter.on(a.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),t.prototype.show.call(this,e))},UserInfoMediator.prototype.destroy=function(){this.mView&&this.mView.destroy()},UserInfoMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},UserInfoMediator.prototype.onClosePanel=function(){this.hide()},UserInfoMediator.NAME="UserInfoMediator",UserInfoMediator}(s.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserInfoPanel",(function(){return m}));var n,o=i(6),a=i(16),s=i(5),h=i(44),l=i(9),c=i(19),p=i(235),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function UserInfoPanel(e,i){var n=t.call(this,e,i)||this;return n.mBadgeImages=[],n.mWorld=i,n}return u(UserInfoPanel,t),UserInfoPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.setData("data",e),this.setInfo(e)},UserInfoPanel.prototype.hide=function(){this.clearBadge(),t.prototype.hide.call(this)},UserInfoPanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.x=i.width-this.width-8,this.y=i.height-100-this.height},UserInfoPanel.prototype.setInfo=function(t){var e=this;if(this.mInitialized&&t&&0!==t.actors.length){var i=t.actors[0];this.mWorld.httpService.userDetail(i.platformId).then((function(t){if(200===t.code){var i=t.data;i&&(e.mActor.load(s.h.getOsdRes("show/"+i.username+".png"),e,void 0,e.loadDefaultAvatar),e.mNickName.setText(i.nickname),e.mLv.setText(i.level))}})),this.mWorld.httpService.badgecards(i.platformId).then((function(t){200===t.code&&e.createBadge(t.data)})),this.updateFollwer(i.platformId)}},UserInfoPanel.prototype.destroy=function(){this.mActor&&(this.mActor.destroy(!0),this.mActor=null),this.mBadgeImages&&(this.mBadgeImages.forEach((function(t){t.destroy(!0),t=null})),this.mBadgeImages=[]),this.mNickName&&(this.mNickName.destroy(!0),this.mNickName=null),this.mLv&&(this.mLv.destroy(!0),this.mLv=null),this.mFollwerBtn&&(this.mFollwerBtn.destroy(!0),this.mFollwerBtn=null),this.mWorld=null,t.prototype.destroy.call(this)},UserInfoPanel.prototype.preload=function(){this.scene.load.image(s.d.getName(),s.d.getPNG()),this.scene.load.image(s.a.getName(),s.a.getPNG()),this.scene.load.atlas(s.c.getName(),s.c.getPNG(),s.c.getJSON()),t.prototype.preload.call(this)},UserInfoPanel.prototype.init=function(){this.setSize(359,199);var e=new h.a(this.scene,{width:359,height:199,key:s.a.getName(),columns:s.a.getColumns(),rows:s.a.getRows()}).setOrigin(0,0);this.add(e);var i=new h.a(this.scene,{x:7,y:19,width:345,height:173,key:s.d.getName(),columns:s.d.getColumns(),rows:s.d.getRows()}).setOrigin(0,0);this.add(i);var n=this.scene.make.text({x:20,y:-5,text:"昵称：",stroke:"#000000",strokeThickness:2,style:{color:"#b4b4b4",font:l.a.YAHEI_18_BOLD}},!1);this.add(n);var o=this.scene.make.text({x:20,y:30,text:"等级：",stroke:"#000000",strokeThickness:2,color:"#b4b4b4",style:{color:"#b4b4b4",font:l.a.YAHEI_18_BOLD}},!1);this.add(o),this.mNickName=this.scene.make.text({x:n.x+50,y:n.y,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",style:{font:l.a.YAHEI_18_BOLD}},!1),this.add(this.mNickName),this.mLv=this.scene.make.text({x:o.x+50,y:o.y,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",style:{font:l.a.YAHEI_18_BOLD}}),this.add(this.mLv),this.mFollwerBtn=new c.NinePatchButton(this.scene,258,145,80,34,s.c.getName(),s.c.getName(),"关注",s.c.getConfig()),this.mFollwerBtn.x=258+(this.mFollwerBtn.width>>1),this.mFollwerBtn.y=145+(this.mFollwerBtn.height>>1),this.mFollwerBtn.setTextStyle({font:l.a.YAHEI_16_BOLD}),this.add(this.mFollwerBtn),this.mActor=new a.DynamicImage(this.scene,300,125).setOrigin(.5,1),this.mActor.scale=2,this.add(this.mActor),this.mWorld.uiManager.getMediator(p.UserInfoMediator.NAME).resize(),t.prototype.init.call(this),this.setInfo(this.getData("data"))},UserInfoPanel.prototype.updateFollwer=function(t){var e=this,i=this.mWorld.roomManager.currentRoom.playerManager.actor.model;i&&t!==i.platformId&&this.mWorld.httpService.checkFollowed([t]).then((function(i){200===i.code&&(i.data.length>0?e.mFollwerBtn.setText("取消关注"):e.mFollwerBtn.setText("关注"),e.mFollwerBtn.setData("node",{text:e.mFollwerBtn.getText(),platformId:t}))}))},UserInfoPanel.prototype.createBadge=function(t){if(t)for(var e=0;e<t.length;e++){var i=new a.DynamicImage(this.scene,70*e+60,100);i.load(s.h.getOsdRes(t[e].target_entity.thumbnail)),this.add(i),this.mBadgeImages.push(i)}},UserInfoPanel.prototype.loadDefaultAvatar=function(){this.mActor.load(s.h.getOsdRes("show/avatar_default.png"))},UserInfoPanel.prototype.clearBadge=function(){for(var t=0,e=this.mBadgeImages;t<e.length;t++){var i=e[t];i.destroy(),this.remove(i)}this.mBadgeImages.length=0},UserInfoPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"MenuItem",(function(){return l}));var n,o=i(19),a=i(12),s=i(5),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function MenuItem(e,i,n,o,a,s,h,l){return t.call(this,e,i,n,o,a,s,"",h,l)||this}return h(MenuItem,t),MenuItem.prototype.appendItem=function(t){this.mChild||(this.mMenus=[],this.mChild=this.scene.make.container(void 0,!1),this.mArrow=this.scene.make.image({x:this.width*this.originX-3,key:"usermenu_arrow"}),this.add(this.mArrow),this.mBackground=new a.NinePatch(this.scene,0,0,0,0,s.d.getName(),null,s.d.getConfig())),this.mChild.add(t),this.mMenus.push(t),this.mBackground.resize(74,32*this.mMenus.length),this.mBackground.x=this.mBackground.width,this.mBackground.y=this.mBackground.height/2-16,this.mChild.addAt(this.mBackground,0),this.mChild.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBackground.width,this.mBackground.height),Phaser.Geom.Rectangle.Contains)},MenuItem.prototype.show=function(){this.add(this.mChild)},MenuItem.prototype.destroy=function(e){if(this.mMenus){for(var i=this.mMenus.length,n=0;n<i;n++){var o=this.mMenus[n];o&&(o.destroy(!0),o=null)}this.mMenus=[]}this.mBackground&&(this.mBackground.destroy(),this.mBackground=null),this.mChild&&(this.mChild.destroy(!0),this.mChild=null),this.mArrow&&(this.mArrow.destroy(!0),this.mArrow=null),t.prototype.destroy.call(this,e)},Object.defineProperty(MenuItem.prototype,"menus",{get:function(){return this.mMenus||[]},enumerable:!1,configurable:!0}),MenuItem}(o.NinePatchButton)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserMenuPanel",(function(){return c}));var n,o=i(6),a=i(5),s=i(237),h=i(12),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function UserMenuPanel(e,i){var n=t.call(this,e,i)||this;return n.mMenus=[],n.disInteractive(),n.scale=2,n}return l(UserMenuPanel,t),UserMenuPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.scene&&(this.setData("data",e),this.addItem(e),this.x=this.scene.input.activePointer.x+32,this.y=this.scene.input.activePointer.y+32,this.scaleX=this.scaleY=this.scale)},UserMenuPanel.prototype.hide=function(){this.disInteractive(),this.clear(),t.prototype.hide.call(this)},UserMenuPanel.prototype.addListen=function(){this.mInitialized&&this.scene.input.on("gameobjectdown",this.onClickMenu,this)},UserMenuPanel.prototype.removeListen=function(){this.mInitialized&&this.scene.input.off("gameobjectdown",this.onClickMenu,this)},UserMenuPanel.prototype.setSize=function(e,i){return t.prototype.setSize.call(this,e,i),this.mBackground&&this.mBackground.resize(e,i),this},UserMenuPanel.prototype.destroy=function(){if(this.mBackground&&this.mBackground.destroy(),this.mMenus){for(var e=this.mMenus.length,i=0;i<e;i++){var n=this.mMenus[i];n||(n.destroy(!0),n=null)}this.mMenus=[]}t.prototype.destroy.call(this)},UserMenuPanel.prototype.addItem=function(t){if(this.mInitialized){this.clear();for(var e=t.menuItem,i=0;i<e.length;i++){var n=this.appendItem(e[i],0,32*i);this.add(n),this.mMenus.push(n)}this.setSize(70,30*this.mMenus.length);var o=this.mWorld.roomManager.currentRoom.playerManager.actor.model;if(o){var a=t.actors[0];if(a&&o.platformId!==a.platformId){var s={text:"关注",platformid:a.platformId},h=this.appendItem({text:"关注",node:void 0},0,31*this.mMenus.length);h.setData("node",s),this.add(h),this.mMenus.push(h),this.mWorld.httpService.checkFollowed([a.platformId]).then((function(t){200===t.code&&(t.data.length>0&&h.setText("取消关注"),s.text=h.getText(),h.setData("node",s))}))}}}},UserMenuPanel.prototype.preload=function(){this.scene.load.image(a.b.getName(),a.b.getPNG()),this.scene.load.image(a.d.getName(),a.d.getPNG()),this.scene.load.image("usermenu_arrow",a.h.getRes("ui/usermenu/arrow.png")),this.scene.load.atlas(a.g.getName(),a.g.getPNG(),a.g.getJSON()),t.prototype.preload.call(this)},UserMenuPanel.prototype.init=function(){this.mBackground=new h.NinePatch(this.scene,0,0,70,30,a.d.getName(),null,a.d.getConfig()),this.add(this.mBackground),t.prototype.init.call(this),this.mShowData&&this.addItem(this.showData)},UserMenuPanel.prototype.appendItem=function(t,e,i){var n=new s.MenuItem(this.scene,0,0,59,29,a.g.getName(),t.text,a.g.getConfig());if(n.x=e,n.y=i-(n.height>>1),n.setData("node",t.node),t.child&&t.child.length>0)for(var o=t.child,h=0,l=o.length;h<l;h++){var c=o[h],p=this.appendItem(c,73,31*h-15.5+31*this.mMenus.length);n.appendItem(p)}return n},UserMenuPanel.prototype.onClickMenu=function(t,e){e instanceof s.MenuItem&&(e.menus.length>0?e.show():this.emit("menuClick",e.getData("node")))},UserMenuPanel.prototype.resizeBackground=function(t,e){this.mBackground&&this.mBackground.resize(t,e)},UserMenuPanel.prototype.clear=function(){for(var t=0,e=this.mMenus;t<e.length;t++){var i=e[t];this.remove(i),i.off("pointerup",this.onClickMenu),i.destroy()}this.mMenus.length=0},UserMenuPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PopUpTextUI",(function(){return s}));var n,o=i(6),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function PopUpTextUI(e,i){var n=t.call(this,i,e)||this;return n.mWorld=e,n.scene=i,n.disInteractive(),n}return a(PopUpTextUI,t),PopUpTextUI.prototype.show=function(e){var i=this,n=this.mWorld.getSize(),o=this.scene.make.text({x:0,y:0,text:e,style:{fill:"#FF0000",fontSize:20}});this.add(o),this.setSize(o.width,o.height),this.setPosition(n.width-this.width>>1,n.height>>1),this.scene.tweens.add({targets:this,duration:1e3,ease:"Linear",props:{y:{value:(n.height>>1)-80},alhpa:{value:0}},onComplete:function(t,e,n){i.destroy()},onCompleteParams:[this]}),t.prototype.show.call(this,e)},PopUpTextUI.prototype.resize=function(){if(this.mInitialized){var t=this.mWorld.getSize();this.x=t.width-this.width>>1}},PopUpTextUI.prototype.destroy=function(){t.prototype.destroy.call(this)},PopUpTextUI}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"StorageMediator",(function(){return l}));var n,o=i(241),a=i(7),s=i(18),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function StorageMediator(e,i,n){var o=t.call(this)||this;return o.mLayerManager=e,o.world=i,o.mScene=n,o.mUIType=s.a.Normal,o}return h(StorageMediator,t),StorageMediator.prototype.isShow=function(){return this.mView.isShow()},StorageMediator.prototype.resize=function(){this.mView&&this.mView.resize()},StorageMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView||(this.mView=new o.StoragePanel(this.mScene,this.world)),this.mView.show(e),this.world.uiManager.checkUIState(StorageMediator.NAME,!1),t.prototype.show.call(this,e))},StorageMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},StorageMediator.prototype.hide=function(){this.mView&&(this.mView.hide(),this.world.uiManager.checkUIState(StorageMediator.NAME,!0))},StorageMediator.prototype.destroy=function(){this.mView&&(this.mView.destroy(),this.mView=null)},StorageMediator.NAME="StorageMediator",StorageMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"StoragePanel",(function(){return m}));var n,o=i(40),a=i(5),s=i(26),h=i(12),l=i(240),c=i(27),p=i(6),u=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function StoragePanel(e,i){return t.call(this,e,i)||this}return u(StoragePanel,t),StoragePanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();this.x=i.width+t>>1,this.y=i.height+e-200},StoragePanel.prototype.destroy=function(){if(this.mBagItemSlotList){for(var e=this.mBagItemSlotList.length,i=0;i<e;i++){var n=this.mBagItemSlotList[i];n&&(n.destroy(),n=null)}this.mBagItemSlotList=null}this.mWorld=null,t.prototype.destroy.call(this)},StoragePanel.prototype.addListen=function(){this.mClsBtn.on("pointerup",this.hide,this)},StoragePanel.prototype.removeListen=function(){this.mClsBtn.off("pointerup",this.hide,this)},StoragePanel.prototype.init=function(){if(!this.mInitialized){t.prototype.init.call(this),this.mBg=new h.NinePatch(this.scene,0,0,500,350,a.a.getName(),null,a.a.getConfig()),this.addAt(this.mBg,0),this.setSize(this.mBg.width,this.mBg.height),this.mBorder=new h.NinePatch(this.scene,0,0,this.mBg.width-10,this.mBg.height-30,a.d.getName(),null,a.d.getConfig()),this.mBorder.x=this.mBg.x,this.mBorder.y=this.mBg.y+10,this.addAt(this.mBorder,1),this.setSize(this.mBg.width,this.mBg.height);var e=this.scene.make.image(void 0,!1);e.setTexture(this.mResStr,"itemBagView_title.png"),e.x=80+(-this.mBg.width>>1),e.y=-this.mBg.height>>1,this.add(e);var i,n=this.scene.make.text(void 0,!1);n.setFontFamily("Tahoma"),n.setFontStyle("bold"),n.setFontSize(20),n.setText("书柜"),n.x=e.x+e.width-10,n.y=e.y-(n.height>>1),this.add(n);var l=0,p=0;this.mBagItemSlotList=[];for(var u=0;u<9;u++)l=u%9*60+32-362,p=60*Math.floor(u/9)-55,(i=new o.ItemSlot(this.scene,this.mWorld,this,l,p,this.mResStr,this.mResPng,this.mResJson,"bagView_slot.png","bagView_itemSelect.png")).createUI(),this.mBagItemSlotList.push(i);this.mClsBtn=new s.IconBtn(this.scene,this.mWorld,{key:c.UIMediatorType.Close_Btn,bgResKey:"clsBtn",bgTextures:["btn_normal","btn_over","btn_click"],iconResKey:"",iconTexture:"",scale:1,pngUrl:"ui/common/common_clsBtn.png",jsonUrl:"ui/common/common_clsBtn.json"}),this.mClsBtn.x=(this.width>>1)-65,this.mClsBtn.y=-this.height>>1,this.mClsBtn.scaleX=this.mClsBtn.scaleY=2,this.add(this.mClsBtn)}},StoragePanel.prototype.preload=function(){this.scene&&(this.mResStr="bagView",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.scene.load.image(a.d.getName(),a.d.getPNG()),this.scene.load.image(a.a.getName(),a.a.getPNG()),this.scene.load.atlas("clsBtn",a.h.getRes("ui/common/common_clsBtn.png"),a.h.getRes("ui/common/common_clsBtn.json")),this.scene.load.atlas(this.mResStr,a.h.getRes(this.mResPng),a.h.getRes(this.mResJson)),t.prototype.preload.call(this))},StoragePanel.prototype.tweenComplete=function(e){t.prototype.tweenComplete.call(this,e),e&&this.mWorld.uiManager.getMediator(l.StorageMediator.NAME).resize()},StoragePanel}(p.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"TopBtnGroup",(function(){return p}));var n,o=i(6),a=i(5),s=i(26),h=i(103),l=i(27),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function TopBtnGroup(e,i){var n=t.call(this,e,i)||this;return n.mBtnPad=10,n.mBtnX=0,n.mExpandBoo=!1,n.mOrientation=Phaser.Scale.Orientation.LANDSCAPE,n.disInteractive(),n}return c(TopBtnGroup,t),TopBtnGroup.prototype.show=function(e){this.scale=this.mWorld.uiScale,t.prototype.show.call(this,e)},TopBtnGroup.prototype.resize=function(){var t=this.mWorld.getSize();this.x=t.width-50*this.mWorld.uiScale,this.y=this.height/2+10*this.mWorld.uiScale,this.scale=this.mWorld.uiScale},TopBtnGroup.prototype.destroy=function(){this.mBtnX=0,this.mTurnBtn&&this.mTurnBtn.destroy(),this.mReturnBtn&&this.mReturnBtn.destroy(),this.mDebugBtn&&this.mDebugBtn.destroy(),this.mBtnList&&this.mBtnList.forEach((function(t){t&&(t.destroy(),t=null)})),this.mResKey="",this.mBtnList=null,this.mTurnBtn=null,this.mReturnBtn=null,t.prototype.destroy.call(this)},TopBtnGroup.prototype.tweenView=function(t){if(this.scene){var e=this.height/2+10*this.mWorld.uiScale,i=!0===t?e:e-50,n=!0===t?1:0;this.scene.tweens.add({targets:this,duration:200,ease:"Cubic.Out",props:{y:{value:i},alpha:{value:n}}})}},TopBtnGroup.prototype.addBtn=function(t){if(this.mAddBtnDataList||(this.mAddBtnDataList=[]),this.mInitialized){var e=new s.IconBtn(this.scene,this.mWorld,t);this.mBtnList.push(e),this.btnRefreshPos()}else this.mAddBtnDataList.push(t)},TopBtnGroup.prototype.removeBtn=function(t){if(this.mRemoveBtnKeyList&&(this.mRemoveBtnKeyList=[]),this.mInitialized){for(var e=0,i=this.mBtnList.length;e<i;e++){var n=this.mBtnList[e];if(n){var o=n.getKey();if(o&&o===t){n.destroy(),n=null,this.mBtnList.splice(e,1);break}}}this.btnRefreshPos()}else this.mRemoveBtnKeyList.push(t)},TopBtnGroup.prototype.preload=function(){this.scene&&(this.mResKey="baseView",this.scene.load.atlas(this.mResKey,a.h.getRes("ui/baseView/mainui_mobile.png"),a.h.getRes("ui/baseView/mainui_mobile.json")),t.prototype.preload.call(this))},TopBtnGroup.prototype.init=function(){var e=this,i=0,n=0;this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mBtnList=[],this.mBtnX=0,this.mTurnBtn=new s.IconBtn(this.scene,this.mWorld,{key:l.UIMediatorType.Turn_Btn_Top,bgResKey:this.mResKey,bgTextures:["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mTurnBtn.x=this.mBtnX,this.mTurnBtn.setPos(this.mBtnX,0),n+=this.mTurnBtn.width+this.mBtnPad,this.add(this.mTurnBtn),this.mBtnX+=-this.mTurnBtn.width-this.mBtnPad,i+=this.mTurnBtn.height/2+20,this.mWorld.game.device.os.desktop||(this.mReturnBtn=new s.IconBtn(this.scene,this.mWorld,{key:l.UIMediatorType.App_Back,bgResKey:this.mResKey,bgTextures:["btnGroup_white_normal.png","btnGroup_white_light.png","btnGroup_white_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mReturnBtn.x=this.mBtnX,this.mReturnBtn.setPos(this.mBtnX,0),this.mBtnList.push(this.mReturnBtn),n+=this.mReturnBtn.width+this.mBtnPad,this.add(this.mReturnBtn),this.mBtnX+=-this.mReturnBtn.width-this.mBtnPad,this.mDebugBtn=new s.IconBtn(this.scene,this.mWorld,{key:h.DebugLoggerMediator.NAME,bgResKey:this.mResKey,bgTextures:["btnGroup_blue_normal.png","btnGroup_blue_light.png","btnGroup_blue_select.png"],iconResKey:this.mResKey,iconTexture:"btnGroup_top_expand.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json"}),this.mDebugBtn.x=this.mBtnX,this.mDebugBtn.setPos(this.mBtnX,0),this.mBtnList.push(this.mDebugBtn),n+=this.mDebugBtn.width+this.mBtnPad,this.add(this.mDebugBtn),this.mReturnBtn.setClick((function(){e.mWorld.closeGame()})),this.mDebugBtn.setClick((function(){var t=e.mWorld.uiManager.getMediator(h.DebugLoggerMediator.NAME);t||(e.mWorld.uiManager.setMediator(h.DebugLoggerMediator.NAME,new h.DebugLoggerMediator(e.mWorld.uiManager.getUILayerManager(),e.scene,e.mWorld)),t=e.mWorld.uiManager.getMediator(h.DebugLoggerMediator.NAME)),t.isShow()?t.hide():t.show()}))),this.setSize(n,i),this.mTurnBtn.setClick((function(){e.turnHandler()})),this.resize(),t.prototype.init.call(this)},TopBtnGroup.prototype.tweenComplete=function(e){var i=this;t.prototype.tweenComplete.call(this,e),e&&(this.mAddBtnDataList&&this.mAddBtnDataList.forEach((function(t){i.addBtn(t)})),this.mRemoveBtnKeyList&&this.mRemoveBtnKeyList.forEach((function(t){i.removeBtn(t)})))},TopBtnGroup.prototype.turnHandler=function(){var t=this;if(this.mBtnList||!(this.mBtnList.length<1))for(var e=this.mBtnList.length,_loop_1=function(n){var o=i.mBtnList[n],a=i.mExpandBoo?o.getPos().x:i.mTurnBtn.width>>1,s=i.mExpandBoo?1:0,h=i.mExpandBoo?"Sine.easeIn":"Sine.easeOut";i.scene.tweens.add({targets:o,duration:300,ease:h,props:{x:{value:a},alpha:{value:s}},onComplete:function(i,o,a){n===e-1&&(t.mExpandBoo=!t.mExpandBoo)},onCompleteParams:[i]})},i=this,n=0;n<e;n++)_loop_1(n)},TopBtnGroup.prototype.btnRefreshPos=function(){var t=this;if(this.mBtnList&&this.mBtnList.length>1){this.mBtnX=-this.mTurnBtn.width-this.mBtnPad;var e=this.mTurnBtn.height/2+20,i=0;this.mBtnList.forEach((function(e){e&&(e.x=t.mBtnX,e.setPos(t.mBtnX,0),t.mBtnX+=-e.width-t.mBtnPad,i+=e.width+t.mBtnPad,t.add(e))})),this.setSize(i,e)}this.resize()},TopBtnGroup}(o.BasePanel)},function(t,e,i){"use strict";var n=i(106),o=i(15),gridsizer_GetChildrenWidth=function(){if(this.rexSizer.hidden)return 0;for(var t,e,i,n,a,s=0,h=this.gridChildren,l=0;l<this.columnCount;l++){if(t=0,void 0===(a=this.columnProportions[l])||0===a){for(var c=0;c<this.rowCount;c++)(e=h[c*this.columnCount+l])&&(e.rexSizer.hidden||(n=e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):Object(o.b)(e),n+=(i=e.rexSizer.padding).left+i.right,t=Math.max(t,n)));s+=t}this.columnWidth[l]=t}return s},gridsizer_GetChildrenHeight=function(){if(this.rexSizer.hidden)return 0;for(var t,e,i,n,a,s=0,h=this.gridChildren,l=0;l<this.rowCount;l++){if(t=0,void 0===(a=this.rowProportions[l])||0===a){for(var c=0;c<this.columnCount;c++)(e=h[l*this.columnCount+c])&&(e.rexSizer.hidden||(n=e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):Object(o.a)(e),n+=(i=e.rexSizer.padding).top+i.bottom,t=Math.max(t,n)));s+=t}this.rowHeight[l]=t}return s},gridsizer_GetChildrenSizers=function(t){void 0===t&&(t=[]);for(var e,i=this.gridChildren,n=0,o=i.length;n<o;n++)(e=i[n])&&e.isRexSizer&&t.push(e);return t},gridsizer_GetExpandedChildWidth=function(t,e){var i,n=t.rexSizer;if(n.expand){var o=n.padding;i=e-o.left-o.right}return i},gridsizer_GetExpandedChildHeight=function(t,e){var i,n=t.rexSizer;if(n.expand){var o=n.padding;i=e-o.top-o.bottom}return i},a=i(38),s=i(65),h=i(43),l={getChildrenWidth:gridsizer_GetChildrenWidth,getChildrenHeight:gridsizer_GetChildrenHeight,getChildrenSizers:gridsizer_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;this.preLayout(t);var n,o,l,c,p=this.totalColumnProportions,u=this.totalRowProportions;if(void 0===e)if(t&&p>0){var m=this.rexSizer.padding;e=t.width-m.left-m.right}else e=Math.max(this.childrenWidth,this.minWidth);if(void 0===i)if(t&&u>0){var m=this.rexSizer.padding;i=t.height-m.top-m.bottom}else i=Math.max(this.childrenHeight,this.minHeight);this.resize(e,i),n=p>0?(this.width-this.childrenWidth)/p:0,o=u>0?(this.height-this.childrenHeight)/u:0;for(var d,f,y,g,_,v,b,P,S,w,T=this.left,C=T,D=this.top,M=0;M<this.rowCount;M++){w=0===(P=this.rowProportions[M]||0)?this.rowHeight[M]:P*o,C=T;for(var O=0;O<this.columnCount;O++)S=0===(b=this.columnProportions[O]||0)?this.columnWidth[O]:b*n,(l=this.gridChildren[M*this.columnCount+O])&&!l.rexSizer.hidden?(_=gridsizer_GetExpandedChildWidth(l,S),v=gridsizer_GetExpandedChildHeight(l,w),l.isRexSizer?l.layout(this,_,v):Object(a.a)(l,_,v),d=C+(m=(c=l.rexSizer).padding).left,y=S-m.left-m.right,f=D+m.top,g=w-m.top-m.bottom,s.a.setPosition(d,f).setSize(y,g),Object(h.a)(l,s.a,c.align),this.resetChildPositionState(l),C+=S):C+=S;D+=w}return this.layoutBackgrounds(),this.postLayout()},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0}},c=i(142),p=i(140);const u=Phaser.Utils.Objects.IsPlainObject,m=Phaser.Utils.Objects.GetValue,d=Phaser.Utils.Array.Remove,f=Phaser.Display.Align.CENTER;class GridSizer_GridSizer extends n.a{constructor(t,e,i,n,o,a,s,h,l){var c;u(e)?(e=m(c=e,"x",0),i=m(c,"y",0),n=m(c,"width",void 0),o=m(c,"height",void 0),a=m(c,"column",0),s=m(c,"row",0),h=m(c,"columnProportions",void 0),l=m(c,"rowProportions",void 0)):u(n)?(n=m(c=n,"width",void 0),o=m(c,"height",void 0),a=m(c,"column",0),s=m(c,"row",0),h=m(c,"columnProportions",void 0),l=m(c,"rowProportions",void 0)):u(a)?(a=m(c=a,"column",0),s=m(c,"row",0),h=m(c,"columnProportions",void 0),l=m(c,"rowProportions",void 0)):u(h)&&(h=m(c=h,"columnProportions",void 0),l=m(c,"rowProportions",void 0)),super(t,e,i,n,o,c),this.type="rexGridSizer",this.initialGrid(a,s,h,l)}destroy(t){this.scene&&(this.gridChildren.length=0,super.destroy(t))}setColumnProportion(t,e){return t>=this.columnProportions.length||(this.columnProportions[t]=e),this}setRowProportion(t,e){return t>=this.rowProportions.length||(this.rowProportions[t]=e),this}add(t,e,i,n,o,a,s){var h;(super.add(t),u(e))&&(e=m(h=e,"column",0),i=m(h,"row",0),n=m(h,"align",f),o=m(h,"padding",0),a=m(h,"expand",!1),s=m(h,"key",void 0));return"string"==typeof n&&(n=p.a[n]),void 0===n&&(n=f),void 0===o&&(o=0),void 0===a&&(a=!0),(h=this.getSizerConfig(t)).parent=this,h.align=n,h.padding=Object(c.a)(o),h.expand=a,this.gridChildren[i*this.columnCount+e]=t,void 0!==s&&this.addChildrenMap(s,t),this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this||(e.parent=void 0,d(this.gridChildren,t),void 0!==this.backgroundChildren&&d(this.backgroundChildren,t),super.remove(t)),this}get totalColumnProportions(){for(var t,e=0,i=0;i<this.columnCount;i++)(t=this.columnProportions[i])>0&&(e+=t);return e}get totalRowProportions(){for(var t,e=0,i=0;i<this.rowCount;i++)(t=this.rowProportions[i])>0&&(e+=t);return e}initialGrid(t,e,i,n){if(this.columnCount=t,this.rowCount=e,this.gridChildren=[],this.gridChildren.length=t*e,this.columnProportions=[],this.columnProportions.length=t,this.columnWidth=[],this.columnWidth.length=t,this.rowProportions=[],this.rowProportions.length=e,this.rowHeight=[],this.rowHeight.length=e,i)for(var o="number"==typeof i,a=0;a<t;a++)if(o)this.setColumnProportion(a,i);else{var s=i[a];s>0&&this.setColumnProportion(a,s)}if(n){var h="number"==typeof n;for(a=0;a<e;a++)if(h)this.setRowProportion(a,n);else{var l=n[a];l>0&&this.setRowProportion(a,l)}}return this}}Object.assign(GridSizer_GridSizer.prototype,l);e.a=GridSizer_GridSizer},function(t,e,i){"use strict";var n=i(109),menu_GetEaseConfig=function(t,e){return e.orientation=t.orientation,e},o={expandSubMenu:function(t,e){var i;this.collapseSubMenu(),i=this.root.toggleOrientation?0===this.orientation?1:0:this.orientation;var n=new this.constructor(this.scene,{items:e,orientation:i,createBackgroundCallback:this.root.createBackgroundCallback,createBackgroundCallbackScope:this.root.createBackgroundCallbackScope,createButtonCallback:this.root.createButtonCallback,createButtonCallbackScope:this.root.createButtonCallbackScope,easeIn:this.root.easeIn,easeOut:this.root.easeOut,_rootMenu:this.root,_parentMenu:this,_parentButton:t});return this.pin(n),this.childrenMap.subMenu=n,this.root.emit("expand",n,t,this),this},collapse:function(){return this.root.emit("collapse",this,this.parentButton,this.parentMenu),this.scaleDownDestroy(menu_GetEaseConfig(this,this.root.easeOut)),this.collapseSubMenu(),this},collapseSubMenu:function(){if(void 0===this.childrenMap.subMenu)return this;var t=this.childrenMap.subMenu;return this.childrenMap.subMenu=void 0,this.remove(t),t.collapse(),this}},menu_CreateBackground=function(t,e,i,n){var o;return i&&(e.scene=t,o=n?i.call(n,e):i(e),e.scene=void 0),o},menu_CreateButtons=function(t,e,i,n){var o,a,s=[];if(e&&i)for(var h=0,l=e.length;h<l;h++)(o=e[h]).scene=t,a=n?i.call(n,o,h,e):i(o,h,e),o.scene=void 0,s.push(a);return s},a=i(282),menu_MenuSetInteractive=function(t){t.on(t.root.expandEventName,(function(t,e){if(!this._isPassedEvent){var i=this.items[e].children;i&&this.expandSubMenu(t,i)}}),t).on("button.click",(function(t,e,i,n){this!==this.root&&(this.root._isPassedEvent=!0,this.root.emit("button.click",t,e,i,n),this.root._isPassedEvent=!1)}),t).on("button.over",(function(t,e,i,n){this!==this.root&&(this.root._isPassedEvent=!0,this.root.emit("button.over",t,e,i,n),this.root._isPassedEvent=!1)}),t).on("button.out",(function(t,e,i,n){this!==this.root&&(this.root._isPassedEvent=!0,this.root.emit("button.out",t,e,i,n),this.root._isPassedEvent=!1)}),t)};const s=Phaser.Utils.Objects.GetValue;class Menu_Menu extends n.a{constructor(t,e){void 0===e&&(e={}),e.hasOwnProperty("orientation")||(e.orientation=1);var i=e._rootMenu,n=e._parentMenu,o=e._parentButton,h=s(e,"items",void 0),l=s(e,"createBackgroundCallback",void 0),c=s(e,"createBackgroundCallbackScope",void 0);e.background=menu_CreateBackground(t,h,l,c);var p=s(e,"createButtonCallback",void 0),u=s(e,"createButtonCallbackScope",void 0);e.buttons=menu_CreateButtons(t,h,p,u),super(t,e),this.type="rexMenu",this.items=h,this.root=void 0===i?this:i,this.parentMenu=n,this.parentButton=o;var m=this.root===this;m&&(void 0===(d=e.bounds)&&(d=Object(a.a)(t)),this.bounds=d,this.expandEventName=s(e,"expandEvent","button.click"),this.toggleOrientation=s(e,"toggleOrientation",!1),this.easeIn=s(e,"easeIn",0),"number"==typeof this.easeIn&&(this.easeIn={duration:this.easeIn}),this.easeOut=s(e,"easeOut",0),"number"==typeof this.easeOut&&(this.easeOut={duration:this.easeOut}),this.createBackgroundCallback=l,this.createBackgroundCallbackScope=c,this.createButtonCallback=p,this.createButtonCallbackScope=u,this._isPassedEvent=!1);this.setOrigin(0).layout();var d=this.root.bounds;if(m)this.expandOrientation=[this.y<d.centerY?1:3,this.x<d.centerX?0:2];else switch(this.root.expandOrientation[n.orientation]){case 0:this.alignTop(o.top).alignLeft(o.right);break;case 1:this.alignLeft(o.left).alignTop(o.bottom);break;case 2:this.alignTop(o.top).alignRight(o.left);break;case 3:this.alignLeft(o.left).alignBottom(o.top)}this.pushIntoBounds(d),menu_MenuSetInteractive(this),this.popUp(menu_GetEaseConfig(this,this.root.easeIn))}isInTouching(t){return!!super.isInTouching(t)||!!this.childrenMap.subMenu&&this.childrenMap.subMenu.isInTouching(t)}}Object.assign(Menu_Menu.prototype,o);e.a=Menu_Menu},function(t,e,i){"use strict";var n=i(52),o=i(37),a=i(45);class State_State extends a.a{constructor(t,e){super(e),this.parent=t,this.init()}init(){this.start("IDLE")}next_IDLE(){var t,e=this.parent;return e.dragState.isDown&&(t=0===e.dragThreshold?"DRAG":"DRAGBEGIN"),t}update_IDLE(t,e){this.next()}next_DRAGBEGIN(){var t=this.parent,e=t.dragState;return e.isDown?e.pointer.getDistance()>=t.dragThreshold?"DRAG":"DRAGBEGIN":"IDLE"}update_DRAGBEGIN(t,e){this.next()}next_DRAG(){var t,e=this.parent;return e.dragState.isUp&&(t=e.outOfBounds?"BACK":e.slidingEnable?"SLIDE":"IDLE"),t}update_DRAG(t,e){var i=this.parent;i.dragState.justMoved&&i.dragging(),this.next()}next_SLIDE(){var t,e=this.parent;return e.dragState.isDown?t="DRAG":e.isSliding||(t="IDLE"),t}enter_SLIDE(){this.parent.onSliding()}exit_SLIDE(){this.parent.stop()}update_SLIDE(t,e){this.parent.sliding(t,e),this.next()}next_BACK(){var t,e=this.parent;return e.dragState.isDown?t="DRAG":e.isPullBack||(t="IDLE"),t}enter_BACK(){this.parent.onPullBack()}exit_BACK(){this.parent.stop()}update_BACK(t,e){this.parent.pullBack(t,e),this.next()}}var s=State_State;const h=Phaser.Utils.Objects.GetValue,l=Phaser.Math.Distance.Between;class DragSpeed_DragSpeed{constructor(t,e){this.gameObject=t,this.scene=Object(n.a)(t),this.setEventEmitter(h(e,"eventEmitter",void 0)),t.setInteractive(h(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.pointer=void 0,this.isInTouched=!1,this.holdStartTime=void 0,this.x=void 0,this.y=void 0,this.preX=void 0,this.preY=void 0,this.localX=void 0,this.localY=void 0,this.justMoved=!1,this.setEnable(h(t,"enable",!0)),this.holdThreshold=h(t,"holdThreshold",50),this}boot(){this.gameObject.on("pointerdown",this.onPointIn,this),this.gameObject.on("pointerover",this.onPointIn,this),this.gameObject.on("pointerup",this.onPointOut,this),this.gameObject.on("pointerout",this.onPointOut,this),this.gameObject.on("pointermove",this.onPointerMove,this),this.gameObject.on("destroy",this.destroy,this),this.scene.events.on("preupdate",this.preupdate,this)}shutdown(){this.scene&&this.scene.events.off("preupdate",this.preupdate,this),this.pointer=void 0,this.gameObject=void 0,this.scene=void 0,this.destroyEventEmitter()}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t||(t||(this.isInTouched=!1,this.pointer=void 0),this.enable=t,this.gameObject.input.enabled=t),this}get isDown(){return this.pointer&&this.pointer.isDown}get isUp(){return!this.isDown}get dx(){return this.x-this.preX}get dy(){return this.y-this.preY}get dt(){return this.scene.sys.game.loop.delta}get speed(){return this.x===this.preX&&this.y===this.preY?0:l(this.preX,this.preY,this.x,this.y)/(.001*this.dt)}get speedX(){return this.dx/(.001*this.dt)}get speedY(){return this.dy/(.001*this.dt)}onPointIn(t,e,i){t.isDown&&void 0===this.pointer&&(this.pointer=t,this.localX=e,this.localY=i)}onPointOut(t){this.pointer===t&&(this.pointer=void 0)}onPointerMove(t,e,i){t.isDown&&this.pointer===t&&(this.localX=e,this.localY=i)}preupdate(t,e){var i=this.pointer;this.justMoved=!1,i&&!this.isInTouched?(this.x=i.x,this.y=i.y,this.preX=i.x,this.preY=i.y,this.isInTouched=!0,this.holdStartTime=void 0,this.emit("touchstart",i,this.localX,this.localY)):i&&this.isInTouched?this.x===i.x&&this.y===i.y?void 0===this.holdStartTime?this.holdStartTime=t:t-this.holdStartTime>this.holdThreshold&&(this.preX=this.x,this.preY=this.y):(this.preX=this.x,this.preY=this.y,this.x=i.x,this.y=i.y,this.holdStartTime=void 0,this.justMoved=!0,this.emit("touchmove",i,this.localX,this.localY)):!i&&this.isInTouched&&(this.isInTouched=!1,this.holdStartTime=void 0,this.emit("touchend",i))}}Object.assign(DragSpeed_DragSpeed.prototype,o.a);var c=DragSpeed_DragSpeed;const p=Phaser.Utils.Objects.GetValue;var u=class Movement{constructor(t){this.resetFromJSON(t)}resetFromJSON(t){return this.setValue(p(t,"value",0)),this.setSpeed(p(t,"speed",0)),this.setAcceleration(p(t,"acceleration",0)),this}reset(){this.setValue(0),this.setSpeed(0),this.setAcceleration(0)}setValue(t){return this.value=t,this}setSpeed(t){return this.speed=t,this}setAcceleration(t){return this.acceleration=t,this}updateSpeed(t){return 0!==this.acceleration&&(this.speed+=this.acceleration*t,this.speed<0&&(this.speed=0)),this}getDeltaValue(t){return this.updateSpeed(t),this.speed<=0?0:this.speed*t}update(t){return this.updateSpeed(t),this.speed>0&&(this.value+=this.getDeltaValue(t)),this}get isMoving(){return this.speed>0}};var m=class SlowDown_SlowDown{constructor(){this.value,this.dir,this.movement=new u}init(t,e,i,n,o){return this.value=t,this.end=o,this.dir=void 0!==o?t<o:e,this.movement.setSpeed(i).setAcceleration(-n),this}stop(){this.movement.reset()}update(t){var e=this.movement.getDeltaValue(t);return this.dir||(e=-e),void 0===this.end?this.value+=e:0===e?this.value=this.end:(this.value+=e,this.dir?this.value>this.end&&(this.value=this.end):this.value<this.end&&(this.value=this.end)),this}get isMoving(){return this.movement.isMoving}};const d=Phaser.Utils.Objects.GetValue;class Scroller_Scroller{constructor(t,e){this.gameObject=t,this.scene=Object(n.a)(t),this.setEventEmitter(d(e,"eventEmitter",void 0));var i=d(e,"enable",!0),o={enable:i,eventEmitter:!1};this._state=new s(this,o);var a={inputConfig:d(e,"inputConfig",void 0),enable:i,eventEmitter:!1};this.dragState=new c(t,a),this._value=void 0,this._slowDown=new m;var h=d(e,"valuechangeCallback",null);if(null!==h){var l=d(e,"valuechangeCallbackScope",void 0);this.on("valuechange",h,l)}if(null!==(h=d(e,"overmaxCallback",null))){l=d(e,"overmaxCallbackScope",void 0);this.on("overmax",h,l)}if(null!==(h=d(e,"overminCallback",null))){l=d(e,"overminCallbackScope",void 0);this.on("overmin",h,l)}this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setOrientationMode(d(t,"orientation",0)),this.setDragThreshold(d(t,"threshold",10)),this.setSlidingDeceleration(d(t,"slidingDeceleration",5e3)),this.setBackDeceleration(d(t,"backDeceleration",2e3)),this.boundPad0=d(t,"boundPad0",0),this.boundPad1=d(t,"boundPad1",0);var e=d(t,"bounds",void 0);return e?this.setBounds(e):this.setBounds(d(t,"max",0),d(t,"min",0)),this.setValue(d(t,"value",this.maxValue||0+this.boundPad1)),this.setEnable(d(t,"enable",!0)),this}boot(){this.scene.events.on("update",this._state.update,this._state),this.gameObject.on("destroy",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.scene&&this.scene.events.off("update",this._state.update,this._state),this.gameObject=void 0,this.scene=void 0,this._state.destroy(),this.dragState.destroy()}destroy(){this.shutdown()}setOrientationMode(t){return"string"==typeof t&&(t=f[t]),this.orientationMode=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setSlidingDeceleration(t){return this.slidingDeceleration=t,this}setBackDeceleration(t){return this.backDeceleration=t,this}setBounds(t,e){if(Array.isArray(t)){var i=t;t=i[0],e=i[1]}return t<e?(this.minValue=t+this.boundPad0,this.maxValue=e+this.boundPad1):(this.minValue=e+this.boundPad0,this.maxValue=t+this.boundPad1),this}get value(){return this._value}set value(t){if(t!==this._value){var e=this._value,i=this.overMax(t),n=this.overMin(t);i&&this.emit("overmax",t,e),n&&this.emit("overmin",t,e),this.backEnable||(i&&(t=this.maxValue),n&&(t=this.minValue)),this._value=t,this.emit("valuechange",t,e)}}setValue(t){this.value=t}setEnable(t){return this._state.setEnable(t),this.dragState.setEnable(t),this}get state(){return this._state.state}get isDragging(){return this.dragState.isInTouched}get outOfMaxBound(){return this.overMax(this.value)}get outOfMinBound(){return this.overMin(this.value)}get outOfBounds(){return this.outOfMinBound||this.outOfMaxBound}overMax(t){return null!=this.maxValue&&t>this.maxValue}overMin(t){return null!=this.minValue&&t<this.minValue}get backEnable(){return"number"==typeof this.backDeceleration}get isPullBack(){return this._slowDown.isMoving}get slidingEnable(){return"number"==typeof this.slidingDeceleration}get isSliding(){return this._slowDown.isMoving}get dragDelta(){return 0===this.orientationMode?this.dragState.dy:1===this.orientationMode?this.dragState.dx:0}get dragSpeed(){return 0===this.orientationMode?this.dragState.speedY:1===this.orientationMode?this.dragState.speedX:0}dragging(){this.value+=this.dragDelta}onSliding(){var t=this.value,e=this.dragSpeed;if(0===e)return this._slowDown.stop(),void this._state.next();var i=this.slidingDeceleration;this._slowDown.init(t,e>0,Math.abs(e),i)}sliding(t,e){e*=.001;var i=this._slowDown.update(e).value;this.overMax(i)?(this.value=this.maxValue,this._slowDown.stop()):this.overMin(i)?(this.value=this.minValue,this._slowDown.stop()):this.value=i}onPullBack(){var t=this.value,e=this.outOfMinBound?this.minValue:this.maxValue,i=Math.abs(e-t),n=this.backDeceleration,o=Math.sqrt(2*n*i);this._slowDown.init(t,void 0,o,n,e)}pullBack(t,e){e*=.001,this.value=this._slowDown.update(e).value,this._slowDown.isMoving||this._state.next()}stop(){this._slowDown.stop()}}Object.assign(Scroller_Scroller.prototype,o.a);const f={y:0,v:0,vertical:0,x:1,h:1,horizontal:1};e.a=Scroller_Scroller},function(t,e,i){"use strict";var n=i(32),o=i(86),a=i(108),s=i(245).a;const h=Phaser.Utils.Objects.GetValue;var scrollable_CreateScrollableSizer=function(t){var e,i,l=this.scene,c=Object(o.a)(t),p=new n.a(l,{orientation:c}),u=h(t,"child.gameObject",void 0),m=h(t,"slider",void 0),d=h(t,"scroller",!0);if(u){var f=h(t,"space.child",0);if(this.childPadding={},"number"!=typeof f){var y=f;0===c?(f=h(y,"right",0),this.childPadding.top=h(y,"top",0),this.childPadding.bottom=h(y,"bottom",0)):(f=h(y,"bottom",0),this.childPadding.top=h(y,"left",0),this.childPadding.bottom=h(y,"right",0))}else this.childPadding.top=0,this.childPadding.bottom=0;var g,_=h(t,"child.proportion",1),v=h(t,"child.expand",!0);g=0===c?{right:m?f:0}:{bottom:m?f:0},p.add(u,_,"center",g,v),m&&(!0===m&&(m={}),m.orientation=p.orientation,e=new a.a(l,m),p.add(e,0,"center",0,!0)),d&&(!0===d&&(d={}),d.orientation=c,i=new s(u,d))}return e&&e.on("valuechange",(function(t){this.t=t}),this),i&&i.on("valuechange",(function(t){this.childOY=t}),this),this.addChildrenMap("child",u),this.addChildrenMap("slider",e),this.addChildrenMap("scroller",i),p},scrollable_ResizeController=function(){var t=this.topChildOY,e=this.bottomChildOY,i=this.childrenMap.scroller,n=this.childrenMap.slider;return i&&i.setBounds(e,t),n&&n.setEnable(e!==t),this.updateController(),this},scrollable_UpdateController=function(){var t=this.childrenMap.scroller,e=this.childrenMap.slider;t&&t.setValue(this.childOY),e&&e.setValue(this.t)};const l=Phaser.Utils.Objects.GetValue;class Scrollable_Scrollable extends n.a{constructor(t,e){void 0===e&&(e={});var i=Object(o.a)(e);e.orientation=0===i?1:0,super(t,e),this.type=l(e,"type","rexScrollable");var n=l(e,"background",void 0),a=scrollable_CreateScrollableSizer.call(this,e),s=l(e,"header",void 0),h=l(e,"footer",void 0),c=l(e,"space.left",0),p=l(e,"space.right",0),u=l(e,"space.top",0),m=l(e,"space.bottom",0);if(n&&this.addBackground(n),s){var d=l(e,"align.header","center"),f=l(e,"space.header",0);g=0===i?{left:c,right:p,top:u,bottom:f}:{left:c,right:f,top:u,bottom:m};var y=l(e,"expand.header",!0);this.add(s,0,d,g,y)}a&&(g=0===i?{left:c,right:p,top:s?0:u,bottom:h?0:m}:{left:s?0:c,right:h?0:p,top:u,bottom:m},this.add(a,1,"center",g,!0));if(h){d=l(e,"align.footer","center");var g,_=l(e,"space.footer",0);g=0===i?{left:c,right:p,top:_,bottom:m}:{left:_,right:p,top:u,bottom:m};y=l(e,"expand.footer",!0);this.add(h,0,d,g,y)}this.addChildrenMap("background",n),this.addChildrenMap("header",s),this.addChildrenMap("footer",h)}layout(t,e,i){return super.layout(t,e,i),this.resizeController(),this}set t(t){var e=this.childPadding;if(0!==e.top||0!==e.bottom){var i=this.childrenMap.child,n=i.topChildOY-i.bottomChildOY;t=((n+e.top+e.bottom)*t-e.top)/n}this.childrenMap.child.t=t,this.updateController()}get t(){var t=this.childrenMap.child.t,e=this.childPadding;if(0!==e.top||0!==e.bottom){var i=this.childrenMap.child,n=i.topChildOY-i.bottomChildOY,o=n+e.top+e.bottom;t=(n*t+e.top)/o}return t}set childOY(t){this.childrenMap.child.childOY=t,this.updateController()}get childOY(){return this.childrenMap.child.childOY}get topChildOY(){return this.childrenMap.child.topChildOY+this.childPadding.top}get bottomChildOY(){return this.childrenMap.child.bottomChildOY-this.childPadding.bottom}setChildOY(t){return this.childOY=t,this}setT(t){return this.t=t,this}scrollToTop(){return this.t=0,this}scrollToBottom(){return this.t=1,this}get sliderEnable(){var t=this.childrenMap.slider;if(t)return t.enable}set sliderEnable(t){var e=this.childrenMap.slider;e&&e.setEnable(t)}setSliderEnable(t){return void 0===t&&(t=!0),this.sliderEnable=t,this}get scrollerEnable(){var t=this.childrenMap.scroller;if(t)return t.enable}set scrollerEnable(t){var e=this.childrenMap.scroller;e&&e.setEnable(t)}setScrollerEnable(t){return void 0===t&&(t=!0),this.scrollerEnable=t,this}}var c={resizeController:scrollable_ResizeController,updateController:scrollable_UpdateController};Object.assign(Scrollable_Scrollable.prototype,c);e.a=Scrollable_Scrollable},function(t,e,i){"use strict";var n=i(291),o=i(45);const a=Phaser.Math.RotateAround;var actions_RotateObjectAround=function(t,e,i,n){return a(t,e,i,n),t.rotation+=n,t},s={},rotate_SpinObject=function(t,e){if(!this.isRotation)return this;void 0===e&&(e=this.pointers[0].camera);var i=this.movementCenterX,n=this.movementCenterY;e.getWorldPoint(this.centerX,this.centerY,s);var o=s.x,a=s.y,h=this.rotation;if(Array.isArray(t))for(var l=t,c=0,p=l.length;c<p;c++)(t=l[c]).x+=i,t.y+=n,actions_RotateObjectAround(t,o,a,h);else t.x+=i,t.y+=n,actions_RotateObjectAround(t,x,y,h);return this};const h=Phaser.Utils.Objects.GetValue,l=Phaser.Math.Angle.WrapDegrees,c=Phaser.Math.Angle.ShortestBetween,p=Phaser.Math.RadToDeg,u=Phaser.Math.DegToRad;class Rotate_Rotate extends n.a{constructor(t,e){super(t,e);var i=this,n={states:{IDLE:{enter:function(){i.prevAngle=void 0,i.angle=0}},BEGIN:{},RECOGNIZED:{enter:function(){i.emit("rotatestart",i)},exit:function(){i.emit("rotateend",i)}}},init:function(){this.state=d},eventEmitter:!1};this.setRecongizedStateObject(new o.a(n))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(h(t,"threshold",0)),this}onDrag2Start(){this.prevAngle=l(p(this.angleBetween)),this.state=0===this.rotationThreshold?g:f}onDrag2End(){this.state=d}onDrag2(){switch(this.state){case f:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=l(p(this.angleBetween));this.angle=c(this.prevAngle,t),this.prevAngle=t,this.state=g}break;case g:t=l(p(this.angleBetween));this.angle=c(this.prevAngle,t),this.prevAngle=t,this.emit("rotate",this)}}get isRotation(){return this.state===g}get rotation(){return u(this.angle)}setDragThreshold(t){return this.dragThreshold=t,this}}var m={spinObject:rotate_SpinObject};Object.assign(Rotate_Rotate.prototype,m);const d="IDLE",f="BEGIN",g="RECOGNIZED";var _=Rotate_Rotate;e.a=_},function(t,e,i){"use strict";var n=i(141);const o=Phaser.Utils.Objects.IsPlainObject,a=Phaser.Utils.Objects.GetValue;var flip_GetFaceUpdatingCallback=function(t,e,i){var n;if(void 0===t)t=i.texture.key,e=i.frame.name;else if(o(t)){var s=t;t=a(s,"key",i.texture.key),e=a(s,"frame",i.frame.name)}else"string"==typeof t||(n=t);return void 0===n&&(n=function(i){i.setTexture(t,e)}),n};const s=Phaser.Utils.Objects.GetValue,h=Phaser.Utils.Objects.GetAdvancedValue;class Flip_Flip extends n.a{constructor(t,e){super(t,{eventEmitter:!0}),this.gameObject=t,this.resetFromJSON(e)}resetFromJSON(t){return this.setOrientation(s(t,"orientation",0)),this.setDelay(h(t,"delay",0)),this.setDuration(h(t,"duration",500)),this.setEase(s(t,"ease","Sine")),this.setFrontFace(s(t,"front",void 0)),this.setBackFace(s(t,"back",void 0)),this.setFace(s(t,"face",0)),this}shutdown(){return super.shutdown(),this.gameObject=void 0,this}setOrientation(t){return"string"==typeof t&&(t=l[t]),this.orientation=t,this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}setEase(t){return void 0===t&&(t="Linear"),this.ease=t,this}get face(){return this._face}set face(t){"string"==typeof t&&(t=c[t]),this._face=t,0===t&&this.frontFaceCallback?this.frontFaceCallback(this.gameObject):1===t&&this.backFaceCallback&&this.backFaceCallback(this.gameObject)}setFace(t){return this.face=t,this}toggleFace(){var t=0===this.face?1:0;return this.setFace(t),this}setFrontFace(t,e){return this.frontFaceCallback=flip_GetFaceUpdatingCallback(t,e,this.gameObject),this}setBackFace(t,e){return this.backFaceCallback=flip_GetFaceUpdatingCallback(t,e,this.gameObject),this}start(){if(this.isRunning)return this;var t={targets:this.gameObject,delay:this.delay,duration:this.duration/2,ease:this.ease,yoyo:!0,repeat:0,onYoyo:this.toggleFace,onYoyoScope:this};return t[0===this.orientation?"scaleX":"scaleY"]={from:1,to:0},super.start(t),this}flip(t){return this.isRunning||(void 0!==t&&this.setDuration(t),this.start()),this}}const l={x:0,horizontal:0,y:1,vertical:1},c={front:0,back:1};var p=Flip_Flip;e.a=p},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractionBubble",(function(){return l}));var n,o=function(){function AnimationUrlData(){}return AnimationUrlData.prototype.setData=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=".json"),this.resName=t,this.resUrl=e,this.pngUrl=e+"/"+t+(i?"_tex.png":".png"),this.jsonUrl=e+"/"+t+(i?"_tex.json":".json"),i&&(this.boneUrl=e+"/"+t+"_ske"+n),this.responseType=".dbbin"===n?"arraybuffer":null,this.boneXhrSettings=this.responseType?{responseType:"arraybuffer"}:null},AnimationUrlData.prototype.setDisplayData=function(t,e,i){void 0===i&&(i=".json"),this.pngUrl=t,this.jsonUrl=e,this.responseType=".dbbin"===i?"arraybuffer":null,this.boneXhrSettings=this.responseType?{responseType:"arraybuffer"}:null},AnimationUrlData.prototype.dispose=function(){this.textureXhrSettings=null,this.atlasXhrSettings=null,this.boneXhrSettings=null},AnimationUrlData}(),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function BubbleAnimation(e){var i=t.call(this,e)||this;return i.loaded=!1,i.isPlaying=!1,i.loop=!1,i}return a(BubbleAnimation,t),BubbleAnimation.prototype.load=function(t,e,i){this.resName=t||e,this.resUrl=e,this.animUrlData=new o,t?this.animUrlData.setData(this.resName,this.resUrl):this.animUrlData.setDisplayData(e,i),this.scene.load.image(this.resName,this.animUrlData.pngUrl),this.scene.load.image(this.animUrlData.jsonUrl,this.animUrlData.jsonUrl),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.start()},BubbleAnimation.prototype.play=function(t){this.isPlaying=!0,this.frameAnim&&(this.setScale(.2,.2),this.y=50,this.scene.tweens.add({targets:this,y:{value:-100,duration:300,ease:"Bounce.easeOut"},scaleX:{value:1,duration:300,ease:"Bounce.easeOut"},scaleY:{value:1,duration:300,ease:"Bounce.easeOut"}}))},BubbleAnimation.prototype.destroy=function(){this.frameAnim&&this.frameAnim.destroy(),this.bubblebg&&this.bubblebg.destroy(),this.animUrlData&&this.animUrlData.dispose(),this.frameAnim=null,this.animUrlData=null,this.bubblebg=null},BubbleAnimation.prototype.onLoadComplete=function(t,e,i){this.loaded=!0,this.bubblebg=this.scene.add.image(0,0,this.resName),this.frameAnim=this.scene.add.image(0,0,this.animUrlData.jsonUrl),this.add([this.bubblebg,this.frameAnim]),this.isPlaying&&this.play()},BubbleAnimation}(Phaser.GameObjects.Container),h=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),l=function(t){function InteractionBubble(e,i){var n=t.call(this,e)||this;return n.mWdith=78,n.mHeight=78,n.width=n.mWdith*i,n.height=n.mHeight*i,n}return h(InteractionBubble,t),InteractionBubble.prototype.setContentData=function(t,e){this.content=t,this.handler&&this.handler.clear(),this.handler=e},InteractionBubble.prototype.load=function(t,e,i){this.createAnimation(),this.mBubbleAni.load(t,e,i),this.mBubbleAni.play()},InteractionBubble.prototype.show=function(){this.mBubbleAni&&this.add(this.mBubbleAni),this.removeDelay()},InteractionBubble.prototype.hide=function(){this.mBubbleAni&&this.remove(this.mBubbleAni),this.mRemoveDelay&&(clearTimeout(this.mRemoveDelay),this.mRemoveDelay=null)},InteractionBubble.prototype.destroy=function(){this.hide(),this.mBubbleAni&&this.mBubbleAni.destroy(),this.handler&&this.handler.clear(),this.mBubbleAni=null,this.handler=null,t.prototype.destroy.call(this)},InteractionBubble.prototype.createAnimation=function(){this.mBubbleAni=new s(this.scene),this.mBubbleAni.width=this.width,this.mBubbleAni.height=this.height;var t=Phaser.Input.Events.POINTER_DOWN;this.mBubbleAni.setInteractive(new Phaser.Geom.Rectangle(0,0,2*this.mBubbleAni.width,2*this.mBubbleAni.height),Phaser.Geom.Rectangle.Contains),this.mBubbleAni.on(t,this.onBubbleClick,this)},InteractionBubble.prototype.onBubbleClick=function(){this.handler&&this.handler.runWith(this.content)},InteractionBubble.prototype.removeDelay=function(){var t=this;this.mRemoveDelay=setTimeout((function(){t.handler&&t.handler.runWith(t.content.id),t.hide()}),this.content.duration)},InteractionBubble}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";var n=i(324),o=i(258),a={plainText:null,prevProp:null},s=new o.a;var styleToProp=function(t){for(var e,i,n,o={},a=0,s=(t=t.split(";")).length;a<s;a++)if(i=(e=t[a].split(":"))[0],n=e[1],!isEmpty(i)&&!isEmpty(n)){switch(i){case"stroke":var h=n.split(" ");n={},(c=h.length)>=1&&(n.color=h[0]),c>=2&&(n.thinkness=parseInt(h[1].replace("px","")));break;case"shadow":var l=n.split(" ");n={},(c=l.length)>=1&&(n.color=l[0]),c>=2&&(n.offsetX=parseInt(l[1].replace("px",""))),c>=3&&(n.offsetY=parseInt(l[2].replace("px",""))),c>=4&&(n.blur=parseInt(l[3].replace("px","")));break;case"u":case"underline":var c,p=n.split(" ");n={},(c=p.length)>=1&&(n.color=p[0]),c>=2&&(n.thinkness=parseInt(p[1].replace("px",""))),c>=3&&(n.offset=parseInt(p[2].replace("px","")))}o[i]=n}return o},isEmpty=function(t){return 0===(t=t.replace(m,"")).length},h=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,l=/<\s*class=/i,c=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,p=/<\s*style=/i,u=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,m=/^\s+|\s+$/,d=class Parser_parser{constructor(t){void 0===t&&(t={}),this.tags=t}addTag(t,e){this.tags[t]=e}splitText(t,e){for(var i,n,o,a=[],s=0,m=t.length,d=m;i=h.exec(t);)n=i[0],s<(d=h.lastIndex-n.length)&&a.push(t.substring(s,d)),void 0===e?a.push(n):1===e&&(l.test(n)?(o=n.match(c),a.push(o[2])):p.test(n)&&(o=n.match(u),a.push(o[2]))),s=h.lastIndex;return s<m&&a.push(t.substring(s,m)),a}tagTextToProp(t,e){var i,n;if(l.test(t)){if(null!=(h=t.match(c))){var o=h[1],s=this.tags;(n=s.hasOwnProperty(o)?s[o]:{})._class=o,i=h[2]}}else if(p.test(t)){var h;if(null!=(h=t.match(u))){var m=h[1];(n=styleToProp(m))._style=m,i=h[2]}}null==i&&(i=t),null==n&&(n={});var d=a;return d.plainText=i,d.prop=n,d}propToContextStyle(t,e){var i=s;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var n=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];i.fontFamily=n}else i.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var o=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof o&&(o=o.toString()+"px"),i.fontSize=o}else i.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var a=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];i.fontStyle=a}else i.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){e.hasOwnProperty("color")?e.color:e["font-color"];i.color=e.color}else i.color=t.color;if(e.hasOwnProperty("stroke")){var h=e.stroke;i.stroke=h.hasOwnProperty("color")?h.color:t.stroke,i.strokeThickness=h.hasOwnProperty("thinkness")?h.thinkness:t.strokeThickness}else i.stroke=t.stroke,i.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var l=e.shadow;i.shadowColor=l.hasOwnProperty("color")?l.color:t.shadowColor,i.shadowOffsetX=l.hasOwnProperty("offsetX")?l.offsetX:t.shadowOffsetX,i.shadowOffsetY=l.hasOwnProperty("offsetY")?l.offsetY:t.shadowOffsetY,i.shadowBlur=l.hasOwnProperty("blur")?l.blur:t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=t.shadowStroke,i.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var c=e.hasOwnProperty("u")?e.u:e.underline;i.underlineColor=c.hasOwnProperty("color")?c.color:t.underlineColor,i.underlineThickness=c.hasOwnProperty("thinkness")?c.thinkness:t.underlineThickness,i.underlineOffset=c.hasOwnProperty("offset")?c.offset:t.underlineOffset}else i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset;return i}propToTagText(t,e,i){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='"+e._class+"'>"+t+"</class>":e.hasOwnProperty("_style")?"<style='"+e._style+"'>"+t+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(t){var e=this.tags[t];return!!e&&null==e.img}};const f=Phaser.Utils.Objects.GetValue;class TagText_TagText extends n.a{constructor(t,e,i,n,o){var a=f(o,"tags",void 0),s=new d(a);super(t,e,i,n,o,"rexTagText",s),this.parser=s}addTag(t,e){return this.parser.addTag(t,e),this.updateText(!0)}addTags(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}}var y=TagText_TagText;e.a=y},function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n,o=i(14),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function GridLayer(e){return t.call(this,e)||this}return a(GridLayer,t),GridLayer.prototype.draw=function(t){if(this.clear(),t&&t.roomSize){this.lineStyle(1,16777215);for(var e=t.roomSize.rows,i=t.roomSize.cols,n=0;n<=e;n++)this.drawLine(t.transformTo90(new o.a(0,n)),t.transformTo90(new o.a(i,n)));for(n=0;n<=i;n++)this.drawLine(t.transformTo90(new o.a(n,0)),t.transformTo90(new o.a(n,e)))}},GridLayer.prototype.drawLine=function(t,e){this.lineBetween(t.x,t.y,e.x,e.y)},GridLayer}(Phaser.GameObjects.Graphics),h=function(){function LayerManager(t){this.room=t,this.mSurfaceInteractived=!0,this.mDelta=0;var e=1;t&&(t.world&&(e=t.world.scaleRatio),this.mScene=t.scene,this.mGroundClickLayer=this.mScene.add.container(0,0),this.mUGroundLayer2=this.mScene.add.container(0,0),this.mGroundLayer=this.mScene.add.container(0,0).setScale(e),this.mTileLayer=new s(this.mScene).setScale(e),this.mScene.sys.displayList.add(this.mTileLayer),this.mMiddleLayer=this.mScene.add.container(0,0).setScale(e),this.mSurfaceLayer=this.mScene.add.container(0,0).setScale(e),this.mAtmosphere=this.mScene.add.container(0,0),this.mSceneUILayer=this.mScene.add.container(0,0),this.mUILayer=this.mScene.add.container(0,0).setScrollFactor(0))}return LayerManager.prototype.addToGround=function(t,e){void 0!==e?this.mGroundLayer.addAt(t,e):Array.isArray(t)?this.mGroundLayer.add(t):this.mGroundLayer.add([t])},LayerManager.prototype.addToSurface=function(t){Array.isArray(t)?this.mSurfaceLayer.add(t):this.mSurfaceLayer.add([t])},LayerManager.prototype.addToSceneToUI=function(t){this.mSceneUILayer.add(t)},LayerManager.prototype.addToUI=function(t){this.mUILayer.add(t)},LayerManager.prototype.addToAtmosphere=function(t){this.mAtmosphere.add(t)},LayerManager.prototype.addToMiddle=function(t){this.mMiddleLayer.add(t)},LayerManager.prototype.resize=function(t,e){},LayerManager.prototype.addMouseListen=function(){},LayerManager.prototype.sortSurface=function(){this.mSurfaceLayer.sort("depth")},LayerManager.prototype.changeScene=function(){this._clearLayer()},LayerManager.prototype.drawGrid=function(t){this.mTileLayer&&this.mTileLayer.draw(t)},LayerManager.prototype.setGridVisible=function(t){this.mTileLayer&&this.mTileLayer.setVisible(t)},LayerManager.prototype.update=function(t,e){this.mDelta=t,this.mDepthGround&&(this.mGroundLayer.sort("depth"),this.mDepthGround=!1),this.mDepthSurface&&(this.mDepthSurface=!1,this.mSurfaceLayer.sort("depth",(function(t,e){return(t.depth?t.depth:0)>(e.depth?e.depth:0)||Math.atan2(t.sortY-e.sortY,t.sortX-e.sortX)*(180*Math.PI)>=70?1:-1})))},LayerManager.prototype.setSurfaceInteractive=function(t){if(this.mSurfaceInteractived!==t){this.mSurfaceInteractived=t;var e=this.mSurfaceLayer.list;t?e.forEach((function(t){t.setInteractive()})):e.forEach((function(t){t.disableInteractive()}))}},LayerManager.prototype.destroy=function(){this.mDelta=0,this._clearLayer()},LayerManager.prototype._clearLayer=function(){this.clearLayer(this.mGroundClickLayer),this.clearLayer(this.mGroundLayer),this.clearLayer(this.mSurfaceLayer),this.clearLayer(this.mUGroundLayer2),this.clearLayer(this.mUILayer),this.clearLayer(this.mAtmosphere),this.mTileLayer.destroy(!0)},LayerManager.prototype.clearLayer=function(t,e){void 0===e&&(e=!1);var i=t.list;if(i)for(var n=i.length,o=void 0,a=0;a<n;a++)(o=i[a])&&(o.destroy(e),o=null);t.destroy(e)},Object.defineProperty(LayerManager.prototype,"depthSurfaceDirty",{set:function(t){this.mDepthSurface=t},enumerable:!1,configurable:!0}),Object.defineProperty(LayerManager.prototype,"depthGroundDirty",{set:function(t){this.mDepthGround=t},enumerable:!1,configurable:!0}),Object.defineProperty(LayerManager.prototype,"layer",{get:function(){return this.mGroundLayer},enumerable:!1,configurable:!0}),LayerManager}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n,o=i(4),a=i(3),s=i(8),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function Rectangle45(e,i,n,o){var a=t.call(this,e,i,n,o)||this;return a.row=e,a.col=i,a.endRow=n,a.endCol=o,a}return h(Rectangle45,t),Rectangle45}(Phaser.Geom.Rectangle),c=i(14),p=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),u=function(t){function CamerasManager(e){var i=t.call(this)||this;return i.mRoomService=e,i.MINI_VIEW_SIZE=30,i.VIEW_PORT_SIZE=30,i.viewPort=new Phaser.Geom.Rectangle,i.miniViewPort=new Phaser.Geom.Rectangle,i.zoom=1,i.mRoomService&&i.mRoomService.world&&(i.zoom=i.mRoomService.world.scaleRatio),i.mCameras=[],i}return p(CamerasManager,t),CamerasManager.prototype.getViewPort=function(){if(this.mMain){var t=this.mMain.worldView;return this.viewPort.x=t.x/this.zoom+(t.width/this.zoom-this.viewPort.width>>1),this.viewPort.y=t.y/this.zoom+(t.height/this.zoom-this.viewPort.height>>1),this.viewPort}},CamerasManager.prototype.getMiniViewPort=function(){if(this.mMain){var t=this.mMain.worldView;this.miniViewPort.x=t.x/this.zoom+(t.width/this.zoom-this.miniViewPort.width>>1),this.miniViewPort.y=t.y/this.zoom+(t.height/this.zoom-this.miniViewPort.height>>1);var e=this.mRoomService.transformTo45(new c.a(this.miniViewPort.x+(this.miniViewPort.width>>1),this.miniViewPort.y));return new l(e.x,e.y,this.MINI_VIEW_SIZE,this.MINI_VIEW_SIZE)}},Object.defineProperty(CamerasManager.prototype,"camera",{get:function(){return this.mMain},set:function(t){this.mMain=t,this.addCamera(t),this.setViewPortSize()},enumerable:!1,configurable:!0}),CamerasManager.prototype.resize=function(t,e){this.resetCameraSize(t,e)},CamerasManager.prototype.setScroll=function(t,e){if(this.mMain)for(var i=0,n=this.mCameras;i<n.length;i++){n[i].setScroll(t,e)}},CamerasManager.prototype.offsetScroll=function(t,e){if(this.mMain){for(var i=0,n=this.mCameras;i<n.length;i++){var o=n[i];o.scrollX+=t/this.camera.zoom,o.scrollY+=e/this.camera.zoom}this.moving=!0}},CamerasManager.prototype.startFollow=function(t){if(this.mTarget=t,this.mMain&&t)for(var e=0,i=this.mCameras;e<i.length;e++){i[e].startFollow(t)}},CamerasManager.prototype.stopFollow=function(){if(this.mTarget=null,this.mMain)for(var t=0,e=this.mCameras;t<e.length;t++){e[t].stopFollow()}},CamerasManager.prototype.addCamera=function(t){-1===this.mCameras.indexOf(t)&&this.mCameras.push(t),this.mTarget&&t.startFollow(this.mTarget)},CamerasManager.prototype.removeCamera=function(t){var e=this.mCameras.indexOf(t);e>-1&&this.mCameras.splice(e,1)},CamerasManager.prototype.setBounds=function(t,e,i,n,o){if(this.mMain)for(var a=0,h=this.mCameras;a<h.length;a++){h[a].setBounds(t,e,i,n,o)}else s.a.getInstance().error("camera does not exist")},CamerasManager.prototype.setPosition=function(t,e){if(this.mMain)for(var i=0,n=this.mCameras;i<n.length;i++){n[i].setPosition(t,e)}},CamerasManager.prototype.syncToEditor=function(){if(this.mMain){var t=this.mMain.worldView,e=new o.PBpacket(a.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_RESET_CAMERA),i=e.content;i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,this.connection.send(e)}},CamerasManager.prototype.centerCameas=function(){},CamerasManager.prototype.syncCamera=function(){if(this.mMain){var t=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_RESET_CAMERA_SIZE),e=t.content;e.width=this.mMain.width/this.mMain.zoom,e.height=this.mMain.height/this.mMain.zoom,this.connection.send(t)}},CamerasManager.prototype.syncCameraScroll=function(){if(this.mMain){var t=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SET_CAMERA_POSITION),e=t.content,i=a.op_def.PBPoint3f.create();i.x=this.mMain.scrollX/Math.ceil(window.devicePixelRatio),i.y=this.mMain.scrollY/Math.ceil(window.devicePixelRatio),e.pos=i,this.connection.send(t)}},CamerasManager.prototype.scrollTargetPoint=function(t,e){this.mMain&&this.setScroll(t*this.mRoomService.world.scaleRatio-this.mMain.width/2,e*this.mRoomService.world.scaleRatio-this.mMain.height/2)},CamerasManager.prototype.resetCameraSize=function(t,e){this.connection?this.syncCamera():s.a.getInstance().error("connection is undefined")},CamerasManager.prototype.setViewPortSize=function(){if(this.mMain){var t=this.mRoomService.roomSize;if(t){var e=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileWidth/2),i=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileHeight/2);this.viewPort.setSize(e,i);var n=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileWidth/2),o=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileHeight/2);this.miniViewPort.setSize(n,o)}else s.a.getInstance().error("room size does not exist")}else s.a.getInstance().error("camera does not exist")},Object.defineProperty(CamerasManager.prototype,"connection",{get:function(){if(this.mRoomService)return this.mRoomService.connection;s.a.getInstance().error("room service is undefined")},enumerable:!1,configurable:!0}),Object.defineProperty(CamerasManager.prototype,"moving",{get:function(){return this.mMoving},set:function(t){this.mMoving=t},enumerable:!1,configurable:!0}),Object.defineProperty(CamerasManager.prototype,"targetFollow",{get:function(){return this.mTarget},enumerable:!1,configurable:!0}),CamerasManager}(o.PacketHandler)},function(t,e,i){"use strict";i.r(e);var n,o,a=i(6),s=i(9),h=i(3),l=i(16),c=i(330),p=i(31),u=i(42),m=i(111),d=i(79),f=i(74),y=i(29),g=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t.tweenStart="tweenStart",t.tweenComplete="tweenComplete",t.tweenUpdate="tweenUpdate"}(o||(o={}));var _=Phaser.Utils.Objects.GetValue,v=function(t){function ProgressBar(e,i){var n=t.call(this,e)||this;n.mConfig=i;var o=i.x,a=i.y;n.width=i.width,n.height=i.height,n.setPosition(o,a),n.setSize(n.width,n.height),n.dpr=_(i,"dpr",1),n.scale=_(i,"scale",1);var s=i.background,h=i.bar;n.mBgSkin=new f.a(e,s.x,s.y,s.width,s.height,s.key,s.frame,s.config,n.dpr,n.scale),n.mBarSkin=new f.a(e,h.x,h.y,h.width,h.height,h.key,h.frame,h.config,n.dpr,n.scale);n.mText=e.make.text({style:Object.assign({},i.textConfig)},!1),n.barWid=h.width;var l=n.mBarSkin.height;return n.mBarMaskGraphics=n.scene.make.graphics(void 0,!1),n.mBarMaskGraphics.fillStyle(0,1),n.mBarMaskGraphics.beginPath(),n.mBarMaskGraphics.fillRect(0,0,10,l),n.mBarMaskGraphics.setPosition(-n.barWid/2,-l/2),n.add([n.mBgSkin,n.mBarSkin,n.mText]),n.disInteractive(),n}return g(ProgressBar,t),ProgressBar.prototype.setProgress=function(t,e){this.curWid=t/e*this.barWid;var i=this.mBarSkin.height;this.mBarSkin.resize(this.curWid,i),this.mBarSkin.x=-this.barWid/2+this.curWid/2},ProgressBar.prototype.setText=function(t){this.mText&&(this.mText.text=t,this.mText.parentContainer||this.add(this.mText))},ProgressBar.prototype.destory=function(){t.prototype.destroy.call(this)},ProgressBar}(y.a),b=i(188),P=i(198),S=i(5),w=i(60),T=i(19),C=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),D=Phaser.GameObjects.Container,M=function(t){function CharacterInfoPanel(e,i){var n=t.call(this,e,i)||this;return n.key="player_info",n.commonkey="common_key",n.isOwner=!0,n.scale=1,n}return C(CharacterInfoPanel,t),CharacterInfoPanel.prototype.resize=function(e,i){var n=this.scaleWidth,o=this.scaleHeight;t.prototype.resize.call(this,e,i),this.content.setPosition(n/2,o/2),this.setSize(n,o),this.mGrideTable.refreshPos(n/2+6*this.dpr*this.scale,o/2+180*this.dpr*this.scale),this.content.setInteractive()},CharacterInfoPanel.prototype.show=function(t){this.mShowData=t,this.mPreLoad||(this.mInitialized?this.mShow||(this.soundGroup&&this.soundGroup.open&&this.playSound(this.soundGroup.open),!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShow=!0,this.setInteractive(),this.addListen()):this.preload())},CharacterInfoPanel.prototype.addListen=function(){this.mInitialized&&(this.closeBtn.on(w.a.MouseEvent.Tap,this.OnClosePanel,this),this.nickEditor.on(w.a.MouseEvent.Tap,this.onEditorHandler,this),this.privaCharBtn.on(w.a.MouseEvent.Tap,this.onPrivateChatHandler,this),this.addFriendBtn.on(w.a.MouseEvent.Tap,this.onAddFriendHandler,this),this.tradeBtn.on(w.a.MouseEvent.Tap,this.onTradingHandler,this))},CharacterInfoPanel.prototype.removeListen=function(){this.mInitialized&&(this.closeBtn.off(w.a.MouseEvent.Tap,this.OnClosePanel,this),this.nickEditor.off(w.a.MouseEvent.Tap,this.onEditorHandler,this),this.privaCharBtn.off(w.a.MouseEvent.Tap,this.onPrivateChatHandler,this),this.addFriendBtn.off(w.a.MouseEvent.Tap,this.onAddFriendHandler,this),this.tradeBtn.off(w.a.MouseEvent.Tap,this.onTradingHandler,this))},CharacterInfoPanel.prototype.preload=function(){this.addAtlas(this.key,"player_info/player_info.png","player_info/player_info.json"),this.addAtlas(this.commonkey,"common/ui_base.png","common/ui_base.json"),t.prototype.preload.call(this)},CharacterInfoPanel.prototype.init=function(){var e=this,i=this.scale;this.bg=this.scene.make.image({x:0,y:0,key:this.key,frame:"bg"}),this.content=this.scene.make.container(void 0,!1),this.content.setSize(this.bg.width,this.bg.height),this.mainContent=this.scene.make.container(void 0,!1),this.mainContent.setSize(this.bg.width,this.bg.height);var n=.5*-this.bg.height+43*this.dpr,o="bold "+15*this.dpr+"px Source Han Sans";this.labelText=this.scene.make.text({x:0,y:n,text:p.a.t("player_info.title"),style:{font:o,bold:!0,color:"#ffffff",fontSize:15*this.dpr,fontFamily:s.a.DEFULT_FONT}}).setOrigin(.5,0),this.labelText.setStroke("#8F4300",1),this.closeBtn=new c.b(this.scene,this.commonkey,"close"),this.closeBtn.setPosition(.5*this.mainContent.width-30*this.dpr,n-10*this.dpr),this.likeBtn=new c.b(this.scene,this.key,"praise_bef","praise_bef","999"),this.likeBtn.setTextStyle({fontSize:13*this.dpr,fontFamily:s.a.DEFULT_FONT}),this.likeBtn.text.setOrigin(0,.5).x+=10*this.dpr,this.likeBtn.setPosition(.5*this.bg.width-50*this.dpr,n+50*this.dpr),this.likeBtn.visible=!1,this.avatar=new m.a(this.scene,void 0),this.avatar.scale=2*this.dpr,this.avatar.x=0,this.avatar.y=-50*this.dpr,this.avatar.once("initialized",(function(){e.avatar.play({animationName:"idle",flip:!1})}));var a=Math.round(.5*-this.bg.width+25*this.dpr),h=Math.round(.5*this.bg.height-306*this.dpr),l=30*this.dpr,d=Math.round(13*this.dpr);this.nickName=new c.a(this.scene,a,h,{}).setOrigin(0,.5).setFontSize(d).setFontFamily(s.a.DEFULT_FONT),this.nickEditor=new c.b(this.scene,this.key,"edit","edit"),this.nickEditor.setPosition(.5*this.bg.width-30*this.dpr,h).visible=!1;var f=this.scene.make.image({x:0,y:h+10*this.dpr,key:this.key,frame:"splitters"});this.idText=new c.a(this.scene,a,h+l).setFontSize(d).setOrigin(0,.5).setFontFamily(s.a.DEFULT_FONT);var y=this.scene.make.image({x:0,y:this.idText.y+10*this.dpr,key:this.key,frame:"splitters"});this.titleName=new c.a(this.scene,a,h+2*l).setFontSize(d).setOrigin(0,.5).setFontFamily(s.a.DEFULT_FONT);var g=this.scene.make.image({x:0,y:this.titleName.y+10*this.dpr,key:this.key,frame:"splitters"}),_=this.scene.make.image({x:0,y:0,key:this.key,frame:"level_bg"});this.lvText=this.scene.make.text({x:0,y:0,text:"lv 98",style:{color:"#996600",fontSize:d,fontFamily:s.a.DEFULT_FONT}}).setOrigin(.5,.5),this.lvCon=this.scene.make.container(void 0,!1),this.lvCon.setSize(_.width,_.height),this.lvCon.add([_,this.lvText]);var v=234*this.dpr,b=195*this.dpr;this.bottomCon=this.scene.make.container(void 0,!1).setSize(v,b),this.bottomCon.setPosition(0,.5*(this.mainContent.height-b)-30*this.dpr),this.bottombg=this.scene.make.graphics(void 0,!1);var S=-60*this.dpr,w=.5*this.bottomCon.height-20*this.dpr;this.addFriendBtn=new T.NinePatchButton(this.scene,S,w,94*this.dpr,37*this.dpr,this.key,"button_g",p.a.t("player_info.add_friend"),{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr}),this.addFriendBtn.setFrameNormal("button_g"),this.privaCharBtn=new T.NinePatchButton(this.scene,S,w,94*this.dpr,37*this.dpr,this.commonkey,"yellow_btn",p.a.t("player_info.private_chat"),{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr}),this.tradeBtn=new T.NinePatchButton(this.scene,-S,w,94*this.dpr,37*this.dpr,this.commonkey,"red_btn",p.a.t("player_info.tade_btn"),{left:12*this.dpr,top:12*this.dpr,right:12*this.dpr,bottom:12*this.dpr}),this.addFriendBtn.setTextStyle({fontSize:16*this.dpr,color:"#000000"}),this.privaCharBtn.setTextStyle({fontSize:16*this.dpr,color:"#996600"}),this.tradeBtn.setTextStyle({fontSize:16*this.dpr,color:"#ffffff"}),this.bottomCon.add([this.bottombg,this.addFriendBtn,this.privaCharBtn,this.tradeBtn]),this.mainContent.add([this.closeBtn,this.likeBtn,this.labelText,f,y,g,this.nickName,this.nickEditor,this.idText,this.titleName,this.lvCon,this.bottomCon]),this.mainContent.add(this.avatar),this.content.add(this.bg),this.content.add(this.mainContent),this.add(this.content);var C=this.scene.cameras.main.width,D=this.scene.cameras.main.height;this.mCategoryScroll=new P.a(this.scene,{x:.5*this.scaleWidth,y:.5*this.scaleHeight+62*this.dpr*i,width:v,height:41*this.dpr,zoom:this.scale,orientation:1,cellupCallBack:function(t){e.onSelectSubCategoryHandler(t)}}),this.add(this.mCategoryScroll);var M=this.scene.textures.getFrame(this.key,"skill_bg"),x=M.width+5*this.dpr*i,E=M.height+2*this.dpr*i,B={x:C/2,y:.5*D+145*this.dpr*i,table:{width:(this.bottomCon.width-10*this.dpr)*i,height:200*this.dpr*i,columns:3,cellWidth:x,cellHeight:E,reuseCellContainer:!0,cellPadX:24*this.dpr*i},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,n){var o=t.scene,a=t.item;return null===n&&(n=new O(o,0,0,e.key,e.dpr,i),e.add(n)),n.setData({item:a}),n.setItemData(a,e.isOwner),n}};this.mGrideTable=new u.a(this.scene,B),this.mGrideTable.layout(),this.mGrideTable.on("cellTap",(function(t){t&&e.onSelectItemHandler(t)})),this.add(this.mGrideTable.table),this.resize(C,D),t.prototype.init.call(this),this.reqPlayerInfo()},CharacterInfoPanel.prototype.reqPlayerInfo=function(){this.emit("queryOwnerInfo")},CharacterInfoPanel.prototype.setPlayerData=function(t){var e=t.nickname,i=t.currentTitle,n=t.level.currentLevelExp,o=t.level.nextLevelExp,a=t.id,s=t.level.level,l=this.getspaceStr(1*this.dpr);this.avatar&&this.avatar.load(new d.a({id:0,avatar:t.currentAvatar.avatar})),this.titleName.setText(this.getRichLabel(p.a.t("player_info.player_title"))+l+i),this.likeBtn.setText(t.like+"");var c=.5*this.bg.width-.5*this.likeBtn.width-this.likeBtn.text.width;this.likeBtn.x=c-20*this.dpr,this.lvText.text="Lv"+s;var u=[t.lifeSkills,t.badges];if(t instanceof h.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_PKT_SELF_PLAYER_INFO)this.nickName.setText(this.getRichLabel(p.a.t("player_info.nick_name"))+l+e),this.idText.setText(this.getRichLabel(p.a.t("player_info.player_lv"))+this.getspaceStr(20)+n+"/"+o),this.lvCon.setPosition(this.idText.x+58*this.dpr,this.idText.y),this.likeBtn.setFrame("praise_aft"),u.push(t.titles),this.addFriendBtn.visible=!1,this.privaCharBtn.visible=!1,this.tradeBtn.visible=!1,this.bottombg.clear(),this.bottombg.fillStyle(7004927,1),this.bottombg.fillRect(.5*-this.bottomCon.width,.5*-this.bottomCon.height,this.bottomCon.width,this.bottomCon.height),this.mGrideTable.setColumnCount(3),this.isOwner=!0;else{var m=t.remark?t.remark:"备注好友昵称";this.nickName.setText(this.getRichLabel(p.a.t("player_info.nick_name"))+l+e+" ("+m+")"),this.idText.setText(this.getRichLabel("I   D")+l+a),this.lvCon.setPosition(this.idText.x+.5*this.lvCon.width,.5*-this.mainContent.height+100*this.dpr),this.likeBtn.setFrame("praise_bef"),u.push(t.avatar),this.addFriendBtn.visible=!t.friend,this.privaCharBtn.visible=t.friend,this.tradeBtn.visible=!0,this.bottombg.clear(),this.bottombg.fillStyle(7004927,1),this.bottombg.fillRect(.5*-this.bottomCon.width,.5*-this.bottomCon.height,this.bottomCon.width,this.bottomCon.height-55*this.dpr),this.mGrideTable.setColumnCount(2),this.isOwner=!1}this.setSubCategory(u)},CharacterInfoPanel.prototype.destroy=function(){this.mGrideTable.destroy(),this.mCategoryScroll.destroy(),t.prototype.destroy.call(this)},CharacterInfoPanel.prototype.OnClosePanel=function(){this.emit("hide")},CharacterInfoPanel.prototype.setSubCategory=function(t){for(var e=[p.a.t("player_info.option_live"),p.a.t("player_info.option_badge"),p.a.t("player_info.option_title"),p.a.t("player_info.option_title"),p.a.t("player_info.option_title")],i=this.mScene.textures.getFrame(this.key,"title_select").width,n=[],o=0;o<1;o++){var a=new c.b(this.scene,this.key,"title_normal","title_select",e[o]);a.width=i,a.height=41*this.dpr,n.push(a),a.setTextStyle({color:"#2B4BB5",bold:!0,fontSize:14*this.dpr*this.scale,fontFamily:s.a.DEFULT_FONT}),a.disInteractive(),a.removeListen(),a.setData("subData",t[o]),this.mCategoryScroll.addItem(a)}n.length<=3?this.mCategoryScroll.setAlign(1):this.mCategoryScroll.setAlign(0),this.onSelectSubCategoryHandler(n[0])},CharacterInfoPanel.prototype.onSelectSubCategoryHandler=function(t){this.curSelectCategeory&&(this.curSelectCategeory.changeNormal(),this.curSelectCategeory.setTextColor("#2B4BB5")),t.changeDown(),t.setTextColor("#996600"),this.curSelectCategeory=t;var e=t.getData("subData");e&&this.mGrideTable.setItems(e),this.mGrideTable.refreshPos(this.scene.cameras.main.width/2,this.scene.cameras.main.height/2+185*this.dpr*this.scale,0,0)},CharacterInfoPanel.prototype.onSelectItemHandler=function(t){},CharacterInfoPanel.prototype.onEditorHandler=function(){var t=247*this.dpr,e=this.content.height;this.editorPanel||(this.editorPanel=new b.CharacterEditorPanel(this.scene,0,0,t,e,this.key,this.dpr)),this.content.add(this.editorPanel),this.editorPanel.visible=!0,this.editorPanel.on("editorHide",this.onEditorPanelHideHandler,this),this.setMainUIVisible(!1)},CharacterInfoPanel.prototype.onAddFriendHandler=function(){},CharacterInfoPanel.prototype.onTradingHandler=function(){},CharacterInfoPanel.prototype.onPrivateChatHandler=function(){},CharacterInfoPanel.prototype.onEditorPanelHideHandler=function(){this.mainContent.visible=!0,this.remove(this.editorPanel),this.editorPanel.off("editorHide",this.onEditorPanelHideHandler,this),this.editorPanel.destroy(),this.editorPanel=null,this.setMainUIVisible(!0)},CharacterInfoPanel.prototype.setMainUIVisible=function(t){this.avatar.visible=t,this.mCategoryScroll.visible=t,this.mGrideTable.table.visible=t,this.mainContent.visible=t},CharacterInfoPanel.prototype.getRichLabel=function(t,e){return void 0===e&&(e="#2B4BB5"),"[stroke="+e+"][color="+e+"]"+t+":[/color][/stroke]"},CharacterInfoPanel.prototype.getspaceStr=function(t){for(var e="",i=0;i<t;i++)e+=" ";return e},CharacterInfoPanel}(a.BasePanel),O=(e.default=M,function(t){function CharacterOwnerItem(e,i,n,o,a,h){void 0===h&&(h=1);var c=t.call(this,e,i,n)||this;c.dpr=0,c.zoom=0;var p=c.scene.make.image({x:0,y:0,key:o,frame:"skill_bg"});return c.nameText=c.scene.make.text({x:-1*a,y:0,text:"lv 98",style:{color:"#996600",fontSize:12*a,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,.5),c.lvText=c.scene.make.text({x:-1*a,y:0,text:"lv 98",style:{color:"#996600",fontSize:12*a,fontFamily:s.a.DEFULT_FONT}}).setOrigin(0,.5),c.progressBar=new v(c.scene,{x:48*a/2,y:15*a,width:41*a,height:4*a,background:{x:0,y:0,width:41*a,height:4*a,config:{top:1*a,left:2*a,right:2*a,bottom:1*a},key:o,frame:"slider_bg"},bar:{x:0,y:0,width:41*a,height:4*a,config:{top:1*a,left:2*a,right:2*a,bottom:1*a},key:o,frame:"slider_rate"},dpr:a,textConfig:void 0}),c.icon=new l.DynamicImage(c.scene,.5*-p.width+22*a,0),c.add([p,c.icon,c.nameText,c.lvText,c.progressBar]),c.setSize(p.width,p.height),c.dpr=a,c.zoom=h,c.key=o,c}return C(CharacterOwnerItem,t),CharacterOwnerItem.prototype.setItemData=function(t,e){var i=this;void 0===e&&(e=!1),this.itemData=t,this.nameText.text=t.name;var n=e?-16*this.dpr*this.zoom:-11*this.dpr*this.zoom,o=e?20*this.dpr*this.zoom:25*this.dpr*this.zoom,a=10*this.dpr*this.zoom;this.nameText.y=n+.5*a,this.icon.setTexture(this.key,"test_skillicon");var s=this.icon.width;t.level?(this.lvText.text=t.level.level,this.lvText.y=n+o,this.progressBar.setProgress(t.level.currentLevelExp,t.level.nextLevelExp),this.progressBar.visible=e):(this.progressBar.visible=!1,this.lvText.visible=!1);var h=S.h.getOsdRes(t.display.texturePath);this.icon.load(h,this,(function(){i.icon.scale=i.dpr*i.zoom;var t=.5*-i.width+.5*s+6*i.dpr*i.zoom;i.icon.setPosition(t,0)}))},CharacterOwnerItem}(D))},function(t,e,i){"use strict";var n=i(32),o=i(87),utils_AddChildMask=function(t,e,i,n){var a=new o.a(e,i,n);return t&&!t.isRexSizer&&t.setMask(a.createGeometryMask()),this.pin(a),a};const a=Phaser.Utils.Objects.GetValue;class Label_Label extends n.a{constructor(t,e){super(t,e),this.type="rexLabel";var i=a(e,"background",void 0),n=a(e,"icon",void 0),o=a(e,"iconMask",void 0),s=a(e,"text",void 0),h=a(e,"action",void 0),l=a(e,"actionMask",void 0),c=a(e,"align",void 0),p=a(e,"space.left",0),u=a(e,"space.right",0),m=a(e,"space.top",0),d=a(e,"space.bottom",0),f=a(e,"space.icon",0),y=a(e,"space.text",0);(i&&this.addBackground(i),"right"!==c&&"bottom"!==c&&"center"!==c||this.addSpace(),n)&&(_=0===this.orientation?{left:p,right:s||h?f:u,top:m,bottom:d}:{left:p,right:u,top:m,bottom:s||h?f:d},this.add(n,0,"center",_),o&&(o=this.addChildMask(n,n,1)));if(s){var g,_,v,b=a(e,"expandTextWidth",!1),P=a(e,"expandTextHeight",!1);0===this.orientation?(g=b?1:0,_={left:n?0:p,right:h?y:u,top:m,bottom:d},v=P):(g=P?1:0,_={left:p,right:u,top:n?0:m,bottom:h?y:d},v=b),this.add(s,g,"center",_,v)}h&&(_=0===this.orientation?{left:n||s?0:p,right:u,top:m,bottom:d}:{left:p,right:u,top:n||s?0:m,bottom:d},this.add(h,0,"center",_),l&&(l=this.addChildMask(h,h,1)));"center"===c&&this.addSpace(),this.addChildrenMap("background",i),this.addChildrenMap("icon",n),this.addChildrenMap("iconMask",o),this.addChildrenMap("text",s),this.addChildrenMap("action",h),this.addChildrenMap("actionMask",l)}get text(){var t=this.childrenMap.text;return void 0===t?"":t.text?t.text:t.getData("text")}set text(t){var e=this.childrenMap.text;void 0!==e&&(e.setText?e.setText(t):e.setData("text",t))}setText(t){return this.text=t,this}appendText(t){this.text+=t}layout(t,e,i){super.layout(t,e,i);var n=this.childrenMap.iconMask;n&&(n.setPosition(),this.resetChildPositionState(n));var o=this.childrenMap.actionMask;return o&&(o.setPosition(),this.resetChildPositionState(o)),this}resize(t,e){super.resize(t,e);var i=this.childrenMap.iconMask;i&&i.resize();var n=this.childrenMap.actionMask;return n&&n.resize(),this}}var s={addChildMask:utils_AddChildMask};Object.assign(Label_Label.prototype,s);e.a=Label_Label},function(t,e,i){"use strict";i.r(e),i.d(e,"MarketPanel",(function(){return v}));var n,o=i(6),a=i(220),s=i(31),h=i(72),l=i(104),c=i(224),p=i(9),u=i(42),m=i(74),d=i(101),f=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),y=function(t){function NinePatchTabButton(e,i,n,o,a,s,h,l,c,p,u){var m=t.call(this,e,o,a,s,h,{},c,p,{width:i,height:n,configlist:l})||this;return m.mBackground.setConfig(l[0]),m.dpr=c||1,m.scale=p||1,m.setSize(i,n),u&&(m.btnData=u),m.changeNormal(),m.enable=!0,m}return f(NinePatchTabButton,t),NinePatchTabButton.prototype.changeNormal=function(){this.setBgFrame(this.mFrame)},NinePatchTabButton.prototype.changeDown=function(){this.mDownFrame&&this.setBgFrame(this.mDownFrame)},NinePatchTabButton.prototype.setSize=function(e,i){return t.prototype.setSize.call(this,e,i),this.mBackground.setSize(e,i),this},NinePatchTabButton.prototype.getBtnData=function(){return this.btnData},Object.defineProperty(NinePatchTabButton.prototype,"enable",{set:function(t){t?(this.mBackground.clearTint(),this.setInteractive()):(this.mBackground.setTintFill(6710886),this.removeInteractive())},enumerable:!1,configurable:!0}),NinePatchTabButton.prototype.createBackground=function(){var t=this.ninePatchConfig.configlist[0],e=this.ninePatchConfig.width,i=this.ninePatchConfig.height;this.mBackground=new m.a(this.scene,0,0,e,i,this.mKey,this.mFrame,{left:t.left,top:t.top,right:t.right,bottom:t.bottom},this.dpr,1),this.add(this.mBackground)},NinePatchTabButton.prototype.setBgFrame=function(t){this.mBackground.setFrame(t)},NinePatchTabButton}(d.a),g=i(8),_=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),v=function(t){function MarketPanel(e,i){var n=t.call(this,e,i)||this;return n.key="market",n.mSubTabs=[],n.mTabs=[],n.scale=1,n}return _(MarketPanel,t),MarketPanel.prototype.addListen=function(){this.mInitialized&&(this.mSelectItem.on("buyItem",this.onBuyItemHandler,this),this.mSelectItem.on("popItemCard",this.onPopItemCardHandler,this),this.mCloseBtn.on("pointerup",this.onCloseHandler,this))},MarketPanel.prototype.removeListen=function(){this.mInitialized&&(this.mSelectItem.off("buyItem",this.onBuyItemHandler,this),this.mSelectItem.off("popItemCard",this.onPopItemCardHandler,this),this.mCloseBtn.off("pointerup",this.onCloseHandler,this))},MarketPanel.prototype.resize=function(t,e){var i=this.scale,n=this.mWorld.uiScale,o=this.scene.cameras.main.width/i,a=this.scene.cameras.main.height/i,s=this.scene.cameras.main.centerX/i;this.setSize(o,a),this.mTIle.x=s;var h=290*this.dpr*n;this.mBackgroundColor.setInteractive(new Phaser.Geom.Rectangle(0,0,o*n,a*n),Phaser.Geom.Rectangle.Contains),this.mShelfContainer.setSize(o,h),this.mShelfContainer.setPosition(0,a-this.mShelfContainer.height),this.mShelfBackground.clear(),this.mShelfBackground.fillStyle(183551),this.mShelfBackground.fillRect(0,0,this.mShelfContainer.width,this.mShelfContainer.height),this.mShelfBackground.y=this.mSubCategeoriesContainer.y+43*this.dpr*n,this.mSelectItem.setSize(o,a-this.mShelfContainer.height),this.mSelectItem.resize(t,e),this.mCategoriesBar.clear(),this.mCategoriesBar.fillStyle(4121087),this.mCategoriesBar.fillRect(0,0,o,40*this.dpr*n),this.mCategoriesBar.fillStyle(308179),this.mCategoriesBar.fillRect(0,40*this.dpr*n,o,3*this.dpr*n),this.mSubCategeoriesContainer.setSize(o,43*this.dpr*n)},MarketPanel.prototype.setCategories=function(t){if(this.mCategoriesContainer){this.mCategoriesContainer.removeAll(!0);var e=t.marketCategory;this.mTabs=[];var i=this.scene.textures.getFrame(this.key,"categories_normal"),n=60;i&&(n=i.width,i.height);for(var o={left:n/2+2*this.dpr,top:12*this.dpr,right:n/2-4*this.dpr,bottom:2*this.dpr},a=new h.CheckboxGroup,s=this.mWorld.uiScale,l=77*this.dpr*s,c=38*this.dpr*s,u=0;u<e.length;u++){var m=new y(this.scene,l,c,this.key,"categories_normal","categories_down",e[u].category.value,[o],this.dpr,this.scale);m.setTextStyle({fontSize:18*this.dpr*s,fontFamily:p.a.DEFULT_FONT}),this.mTabs[u]=m,m.setData("category",e[u]),m.x=80*u*this.dpr*s+l/2,m.y=c/2}this.mCategoriesContainer.setSize(this.mTabs.length*l,c),this.mShelfContainer.add(this.mTabs),this.mCategoriesBar.y=this.mCategoriesContainer.height+this.mShelfContainer.y,this.mSubCategeoriesContainer.addAt(this.mCategoriesBar,0),this.mPropContainer.y=this.mSubCategeoriesContainer.y+43*this.dpr*s+this.mSubCategeoriesContainer.height+9*this.dpr,this.mShelfBackground.y=this.mSubCategeoriesContainer.y+43*this.dpr*s,this.mSubCategorisScroll.y=this.mCategoriesBar.y+33*this.dpr,this.mPropGrid.y=this.mCategoriesBar.y+this.mSubCategeoriesContainer.height+122*this.dpr*s,this.mPropGrid.layout(),this.mSubCategorisScroll.layout(),a.on("selected",this.onSelectCategoryHandler,this),a.appendItemAll(this.mTabs),g.a.getInstance().log(this.mTabs[0].getWorldTransformMatrix()),a.selectIndex(0)}},MarketPanel.prototype.setProp=function(t){this.clearCategories(this.mItems),this.mItems=[];var e=t.commodities;this.mPropGrid.setItems(e),this.mPropGrid.layout(),e.length>0&&this.onSelectItemHandler(e[0])},MarketPanel.prototype.setCommodityResource=function(t){this.mSelectItem&&this.mSelectItem.setResource(t)},MarketPanel.prototype.destroy=function(){this.mSubCategorisScroll&&this.mSubCategorisScroll.destroy(),this.mPropGrid&&this.mPropGrid.destroy(),t.prototype.destroy.call(this)},MarketPanel.prototype.preload=function(){this.addAtlas(this.key,"market/market.png","market/market.json"),t.prototype.preload.call(this)},MarketPanel.prototype.init=function(){var e=this;if(!this.mInitialized){var i=this.scene.scale.width/this.scale,n=this.scene.scale.height/this.scale,o=this.mWorld.uiScale;this.mBackgroundColor=this.scene.make.graphics(void 0,!1),this.mBackgroundColor.fillGradientStyle(7304703,7304703,314367,314367),this.mBackgroundColor.fillRect(0,0,i,n),this.add(this.mBackgroundColor),this.mShelfContainer=this.scene.make.container({x:i/2,y:n},!1).setSize(i,290*this.dpr*o);for(var h=this.scene.textures.getFrame(this.key,"bg"),m=Math.ceil(i/(h.width*o)),d=Math.ceil((n-this.mShelfContainer.height+h.height*o)/(h.height*o)),f=0;f<m;f++)for(var y=0;y<d;y++){var g=this.scene.make.image({x:f*h.width*o,y:y*h.height*o,key:this.key,frame:"bg"},!1).setScale(o);this.add(g)}this.mShelfBackground=this.scene.make.graphics(void 0,!1),this.mCloseBtn=this.scene.make.image({key:this.key,frame:"back_arrow",x:21*this.dpr,y:30*this.dpr}).setInteractive().setScale(o),this.mPropContainer=this.scene.make.container(void 0,!1),this.mCategoriesContainer=this.scene.make.container(void 0,!1),this.mSubCategeoriesContainer=this.scene.make.container(void 0,!1),this.mShelfContainer.add([this.mShelfBackground,this.mCategoriesContainer,this.mPropContainer]),this.add([this.mShelfContainer,this.mSubCategeoriesContainer]),this.mSelectItem=new a.ElementDetail(this.scene,this.mWorld,this.key,this.dpr,this.mWorld.uiScale),this.mSelectItem.setSize(i,n-this.mShelfContainer.height),this.mTIle=this.scene.make.text({text:s.a.t("market.title"),y:30*this.dpr*o,style:{fontSize:36*this.dpr*o,fontFamily:p.a.DEFULT_FONT}}).setOrigin(.5),this.add([this.mTIle,this.mSelectItem,this.mCloseBtn]),t.prototype.init.call(this),this.mCategoriesBar=this.scene.make.graphics(void 0,!1);var _=56*this.dpr,v=41*this.dpr,b={x:i/2,table:{width:i,height:v,cellWidth:_,cellHeight:v,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0},scrollMode:1,createCellContainerCallback:function(t,i){var n=t.scene,a=t.item;return null===i&&(i=new l.TextButton(n,e.dpr,o),e.add(i)),i.setText(a.value),i.setData({item:a}),e.mPreSubCategoris||e.onSelectSubCategoryHandler(i),i}};this.mSubCategorisScroll=new u.a(this.scene,b),this.mSubCategorisScroll.on("cellTap",(function(t,i){e.onSelectSubCategoryHandler(t)})),this.add(this.mSubCategorisScroll.table);var P=this.scene.textures.getFrame(this.key,"border"),S=P.width*o+10*this.dpr,w=P.height*o+10*this.dpr,T={x:i/2,y:1050+41*this.dpr*o/2,table:{width:i-20*this.dpr*o,height:224*this.dpr*o,columns:3,cellWidth:S,cellHeight:w,reuseCellContainer:!0,cellOriginX:0,cellOriginY:0},scrollMode:1,clamplChildOY:!1,createCellContainerCallback:function(t,i){var n=t.scene,a=t.item;return null===i&&(i=new c.MarketItem(n,0,0,e.dpr,o),e.add(i)),i.setData({item:a}),i.setProp(a),i}};this.mPropGrid=new u.a(this.scene,T),this.mPropGrid.layout(),this.mPropGrid.on("cellTap",(function(t){var i=t.getData("item");i&&e.onSelectItemHandler(i)})),this.add(this.mPropGrid.table),this.resize(0,0),this.emit("getCategories")}},MarketPanel.prototype.setSelect=function(){},MarketPanel.prototype.clearCategories=function(t){t&&(t.map((function(t){return t.destroy()})),t=void 0)},MarketPanel.prototype.onSelectCategoryHandler=function(t){if(this.mSubCategeoriesContainer){this.mPreSubCategoris=null,this.clearCategories(this.mSubTabs);var e=t.getData("category");if(this.mSelectedCategories=t,e){var i=e.subcategory;this.mSubCategorisScroll&&(this.mSubCategorisScroll.setItems(i),this.mSubCategorisScroll.layout())}}},MarketPanel.prototype.onSelectSubCategoryHandler=function(t){if(this.mSelectedCategories&&t instanceof l.TextButton){var e=this.mSelectedCategories.getData("category");if(e){var i=t.getData("item");i&&(this.mPreSubCategoris&&this.mPreSubCategoris.changeNormal(),this.queryProp(e.category.key,i.key),t.changeDown(),this.mPreSubCategoris=t)}}},MarketPanel.prototype.queryProp=function(t,e){this.emit("queryProp",1,t,e)},MarketPanel.prototype.onSelectItemHandler=function(t){this.mSelectItem.setProp(t),this.emit("queryPropResource",t)},MarketPanel.prototype.onBuyItemHandler=function(t){this.emit("buyItem",t)},MarketPanel.prototype.onCloseHandler=function(){this.emit("close")},MarketPanel.prototype.onPopItemCardHandler=function(t,e){t&&this.emit("popItemCard",t,e)},MarketPanel}(o.BasePanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaRoomListPanel",(function(){return P})),i.d(e,"RoomDelegate",(function(){return S})),i.d(e,"RoomZoon",(function(){return T}));var n,o,a=i(6),s=i(9),h=i(72),l=i(31),c=i(3),p=i(245),u=i(29),m=i(38),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t.downinBound="downinBound",t.downoutBound="downoutBound",t.upinBound="upinBound",t.upoutBound="upoutBound"}(o||(o={}));var f=Phaser.Utils.Objects.GetValue,y=function(t){function BaseScroller(e,i,n){var o=t.call(this,e)||this;o.mChildPad=0,o.mMoveing=!1,o.soundMap=new Map,o.mConfig=n,o.soundGroup=n.music;var a=e.make.graphics(void 0,!1);a.fillStyle(0),a.fillRect(0,0,n.width,n.height),a.setPosition(n.x,n.y),o.width=o.mConfig.width,o.height=o.mConfig.height,i.setMask(a.createGeometryMask()),o.mGameObject=i,o.basePoint=n.basePoint?n.basePoint:new Phaser.Geom.Point(o.mGameObject.parentContainer.x,o.mGameObject.parentContainer.y);var s=e.make.container(void 0,!1);return s.setSize(n.width,n.height),o.mGameObject.parentContainer&&(s.x=n.clickX,s.y=n.clickY,o.mGameObject.parentContainer.add(s)),o.mScroller=new p.a(s,n),o.clickContainer=s,o.mDisDelection=f(n,"interactivedisDetection",10),o.mCellDownHandler=f(n,"celldownCallBack",void 0),o.mCellUpHandler=f(n,"cellupCallBack",void 0),o.setInteractive(),o.addListen(),o}return d(BaseScroller,t),BaseScroller.prototype.setEnable=function(t){this.mScroller&&this.mScroller.setEnable(t)},BaseScroller.prototype.setValue=function(t){this.mScroller&&this.mScroller.setValue(t)},BaseScroller.prototype.adjustBackDeceleration=function(t){this.mScroller&&this.mScroller.setBackDeceleration(t)},BaseScroller.prototype.adjustSlidingDeceleration=function(t){this.mScroller&&this.mScroller.setSlidingDeceleration(t)},BaseScroller.prototype.adjustScrollMode=function(t){this.mConfig.orientation&&this.mConfig.orientation===t||this.mScroller&&this.mScroller.setOrientationMode(t),this.mConfig.orientation=t},BaseScroller.prototype.adjustDragThreshol=function(t){this.mScroller&&this.mScroller.setDragThreshold(t)},BaseScroller.prototype.adjustMask=function(t,e,i,n){void 0===i&&(i=this.mConfig.x),void 0===n&&(n=this.mConfig.y);var o=this.mGameObject.mask;if(!o){var a=this.mConfig;(o=this.scene.make.graphics(void 0,!1)).fillStyle(0),o.fillRect(0,0,t,e),o.setPosition(a.x,a.y),this.width=t,this.height=e,this.mGameObject.setMask(o.createGeometryMask())}o.x=i,o.y=n,Object(m.a)(o,t,e)},BaseScroller.prototype.setBounds=function(t,e){this.mScroller.setBounds(t,e)},Object.defineProperty(BaseScroller.prototype,"bounds",{get:function(){return this.mConfig.bounds},enumerable:!1,configurable:!0}),BaseScroller.prototype.resize=function(t,e,i,n){this.width=t,this.height=e,this.mGameObject.parentContainer&&(this.clickContainer.x=this.mConfig.clickX,this.clickContainer.y=this.mConfig.clickY,this.mGameObject.parentContainer.add(this.clickContainer)),void 0!==i&&void 0!==n&&this.mScroller.setBounds(i,n)},BaseScroller.prototype.clearInteractiveObject=function(){this.mInteractiveList&&(this.mInteractiveList.length=0,this.mInteractiveList=[],this.mScroller.setBounds(0,0))},BaseScroller.prototype.setInteractiveObject=function(t){this.mInteractiveList||(this.mInteractiveList=[]),this.mInteractiveList.push(t)},BaseScroller.prototype.removeInteractiveObject=function(t){var e=this.mInteractiveList.indexOf(t);e>-1&&this.mInteractiveList.splice(e,1)},BaseScroller.prototype.addListen=function(){this.scene&&(this.removeListen(),this.scene.input.on("pointermove",this.pointerMoveHandler,this),this.scene.input.on("pointerdown",this.pointerDownHandler,this),this.scene.input.on("pointerup",this.pointerUpHandler,this))},BaseScroller.prototype.removeListen=function(){this.mMoveing=!1,this.scene&&(this.scene.input.off("pointerdown",this.pointerDownHandler,this),this.scene.input.off("pointerup",this.pointerUpHandler,this),this.scene.input.off("pointermove",this.pointerMoveHandler,this))},Object.defineProperty(BaseScroller.prototype,"left",{get:function(){return-this.mGameObject.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(BaseScroller.prototype,"right",{get:function(){return this.mGameObject.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(BaseScroller.prototype,"top",{get:function(){return-this.mGameObject.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(BaseScroller.prototype,"bottom",{get:function(){return this.mGameObject.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(BaseScroller.prototype,"boundPad0",{get:function(){return this.mScroller.boundPad0},enumerable:!1,configurable:!0}),Object.defineProperty(BaseScroller.prototype,"boundPad1",{get:function(){return this.mScroller.boundPad1},enumerable:!1,configurable:!0}),BaseScroller.prototype.destroy=function(){this.mMoveing=!1,this.mGameObject&&this.mGameObject.clearMask(!0),this.mScroller&&this.mScroller.destroy(),this.clickContainer&&this.clickContainer.destroy(),t.prototype.destroy.call(this)},BaseScroller.prototype.refreshBound=function(t){var e=this;if(this.mInteractiveList){var i=0;void 0!==t?i=t:this.mInteractiveList.forEach((function(t){t&&(i+=e.mConfig.orientation?t.width:t.height)}));var n=this.mConfig.orientation?this.basePoint.x:this.basePoint.y,o=this.mConfig.orientation?this.mConfig.width:this.mConfig.height;i<o&&(i=o),this.setBounds(n,n-i+o)}},BaseScroller.prototype.pointerMoveHandler=function(t){this.soundGroup&&this.soundGroup.move&&this.playSound(this.soundGroup.move),this.mMoveing=!0},BaseScroller.prototype.pointerDownHandler=function(t){this.soundGroup&&this.soundGroup.down&&this.playSound(this.soundGroup.down);var e=this.checkPointerInBounds(this.clickContainer,t);if(e&&this.checkPointerDelection(t)){if(this.mCellDownHandler&&!this.mMoveing){if(!this.mInteractiveList)return;for(var i=0,n=this.mInteractiveList.length;i<n;i++){var a=this.mInteractiveList[i];if(this.checkPointerInBounds(a,t,!0)){this.mCellDownHandler(a);break}}}var s=e?o.downinBound:o.downoutBound;this.emit(s,this.clickContainer)}},BaseScroller.prototype.pointerUpHandler=function(t,e){this.soundGroup&&this.soundGroup.up&&this.playSound(this.soundGroup.up);var i=this.checkPointerInBounds(this.clickContainer,t);if(i&&this.checkPointerDelection(t)){if(this.mCellUpHandler&&!this.mMoveing){if(!this.mInteractiveList)return;for(var n=0,a=this.mInteractiveList.length;n<a;n++){var s=this.mInteractiveList[n];if(this.checkPointerInBounds(s,t,!0)){this.mCellUpHandler(s);break}}}var h=i?o.upinBound:o.upoutBound;this.emit(h,this.clickContainer)}this.mMoveing=!1},BaseScroller.prototype.checkPointerInBounds=function(t,e,i){if(void 0===i&&(i=!1),this.mRectangle||(this.mRectangle=new Phaser.Geom.Rectangle(0,0,0,0)),this.mRectangle.left=-t.width/2,this.mRectangle.right=t.width/2,this.mRectangle.top=-t.height/2,this.mRectangle.bottom=t.height/2,e){var n=t.getWorldTransformMatrix(),o=e.x-n.tx,a=e.y-n.ty;return this.mRectangle.left<=o&&this.mRectangle.right>=o&&this.mRectangle.top<=a&&this.mRectangle.bottom>=a}return!1},BaseScroller}(u.a),g=i(8),_=i(25),v=i(101),b=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),P=function(t){function PicaRoomListPanel(e,i){var n=t.call(this,e,i)||this;return n.key="pica_roomlist",n.scale=1,n}return b(PicaRoomListPanel,t),PicaRoomListPanel.prototype.resize=function(e,i){var n=this.scale,o=this.scene.cameras.main.width/n,a=this.scene.cameras.main.height/n;this.scene.cameras.main.centerX;this.x=o/2,this.y=a/2,t.prototype.resize.call(this,e,i)},PicaRoomListPanel.prototype.updateRoomList=function(t){t&&this.mRoomDele.updateList(t)},PicaRoomListPanel.prototype.updateMyRoomList=function(t){t&&this.mMyRoomDele.updateList(t)},PicaRoomListPanel.prototype.addListen=function(){this.mInitialized&&(this.mCloseBtn.on("pointerup",this.onCloseHandler,this),this.mSeachBtn.on("pointerup",this.onSeachHandler,this))},PicaRoomListPanel.prototype.removeListen=function(){this.mInitialized&&(this.mCloseBtn.off("pointerup",this.onCloseHandler,this),this.mSeachBtn.off("pointerup",this.onSeachHandler,this))},PicaRoomListPanel.prototype.destroy=function(){this.mScroller&&this.mScroller.destroy(),t.prototype.destroy.call(this)},PicaRoomListPanel.prototype.preload=function(){this.addAtlas(this.key,"pica_roomlist/pica_roomlist.png","pica_roomlist/pica_roomlist.json"),t.prototype.preload.call(this)},PicaRoomListPanel.prototype.init=function(){var e=this,i=this.mWorld.uiScale,n=this.scene.make.image({key:this.key,frame:"bg.png"},!1).setInteractive();this.setSize(n.width,n.height),this.mCloseBtn=this.scene.make.image({key:this.key,frame:"close_btn.png"},!1).setInteractive(),this.mCloseBtn.x=this.width/2-this.mCloseBtn.width/2-2*this.dpr,this.mCloseBtn.y=-this.height/2+this.mCloseBtn.height/2,this.mRoomDeleBtn=new v.a(this.scene,this.key,"checkbox_normal","checkbox_down",l.a.t("room_list.visit")),this.mRoomDeleBtn.x=-54*this.dpr,this.mRoomDeleBtn.y=-this.height/2+this.mRoomDeleBtn.displayHeight/2-4*this.dpr,this.mRoomDeleBtn.setTextStyle({color:"#3333cc",fontFamily:s.a.DEFULT_FONT,fontSize:14*this.dpr}),this.mRoomDeleBtn.setFontStyle("bold"),this.mMyRoomDeleBtn=new v.a(this.scene,this.key,"checkbox_normal","checkbox_down",l.a.t("room_list.my")),this.mMyRoomDeleBtn.x=54*this.dpr,this.mMyRoomDeleBtn.y=this.mRoomDeleBtn.y,this.mMyRoomDeleBtn.setTextStyle({color:"#3333cc",fontFamily:s.a.DEFULT_FONT,fontSize:16*this.dpr}),this.mMyRoomDeleBtn.setFontStyle("bold");var o=new h.CheckboxGroup;o.appendItemAll([this.mRoomDeleBtn,this.mMyRoomDeleBtn]),o.on("selected",this.onSelectedHandler,this),this.mRoomContainer=this.scene.make.container(void 0,!1),this.mRoomContainer.setSize(272*this.dpr,362*this.dpr),this.mRoomContainer.y=-this.height/2+11*this.dpr*i,this.mSeachBtn=this.scene.make.image({key:this.key,frame:"seach_btn.png"},!1).setInteractive(),this.mSeachBtn.y=this.height/2-this.mSeachBtn.height/2+12*this.dpr;var a=this.scene.make.text({x:-35*this.dpr,y:this.mSeachBtn.y,text:l.a.t("room_list.seach"),style:{color:"#996600",fontFamily:s.a.DEFULT_FONT,fontSize:14*this.dpr}},!1).setOrigin(.5),c=this.scene.make.text({x:35*this.dpr,y:this.mSeachBtn.y,text:l.a.t("room_list.room"),style:{color:"#996600",fontFamily:s.a.DEFULT_FONT,fontSize:14*this.dpr}},!1).setOrigin(.5);this.add([n,this.mRoomContainer,this.mCloseBtn,this.mSeachBtn,a,c]),t.prototype.init.call(this),this.resize(0,0);var p=this.mRoomContainer.width*this.scale,u=this.mRoomContainer.height*this.scale,m={x:this.x-p/2,y:this.y-u/2-20*this.dpr*this.scale,clickX:0,clickY:0,width:p,height:u,boundPad0:-25*this.dpr*i,value:this.y,valuechangeCallback:function(t){e.mRoomContainer.y=t-e.y-u/2,g.a.getInstance().log(e.mRoomContainer.y+","+e.y)},cellupCallBack:function(t){t.onEnterRoomHandler(),g.a.getInstance().log(t.roomData().name)}};this.mScroller=new y(this.scene,this.mRoomContainer,m),this.add([this.mRoomDeleBtn,this.mMyRoomDeleBtn,this.mCloseBtn]),o.selectIndex(0)},PicaRoomListPanel.prototype.showRoomList=function(){this.mMyRoomDele&&(this.mMyRoomDele.removeFromContainer(),this.mMyRoomDele.off("enterRoom",this.onEnterRoomHandler,this)),this.mRoomDele||(this.mRoomDele=new S(this.mRoomContainer,this.mScroller,this.scene,this.mWorld,this.key,this.dpr)),this.mRoomDele.on("enterRoom",this.onEnterRoomHandler,this),this.mRoomDele.addToContainer(),this.emit("getRoomList")},PicaRoomListPanel.prototype.showMyRoomList=function(){this.mRoomDele&&(this.mRoomDele.removeFromContainer(),this.mRoomDele.off("enterRoom",this.onEnterRoomHandler,this)),this.mMyRoomDele||(this.mMyRoomDele=new w(this.mRoomContainer,this.mScroller,this.mWorld,this.scene,this.key,this.dpr)),this.mMyRoomDele.on("enterRoom",this.onEnterRoomHandler,this),this.mMyRoomDele.addToContainer(),this.emit("getMyRoomList")},PicaRoomListPanel.prototype.onEnterRoomHandler=function(t){this.emit("enterRoom",t)},PicaRoomListPanel.prototype.onSelectedHandler=function(t,e){if(t instanceof _.a){switch(this.mRoomContainer.removeAll(!1),t){case this.mRoomDeleBtn:this.showRoomList();break;case this.mMyRoomDeleBtn:this.showMyRoomList()}t.setTextColor("#996600"),e&&e instanceof _.a&&e.setTextColor("#3333cc")}},PicaRoomListPanel.prototype.onSeachHandler=function(){},PicaRoomListPanel.prototype.onCloseHandler=function(){this.emit("close")},PicaRoomListPanel}(a.BasePanel),S=function(t){function RoomDelegate(e,i,n,o,a,s){void 0===s&&(s=1);var h=t.call(this)||this;return h.mChildPad=0,h.mDpr=1,h.mHeight=0,h.mDpr=s,h.mWorld=o,h.mChildPad=0,h.mScene=n,h.mContainer=e,h.mScroller=i,h.mKey=a,h.init(),h}return b(RoomDelegate,t),RoomDelegate.prototype.addListen=function(){this.mPopularityRoom.on("enterRoom",this.onEnterRoomHandler,this),this.mPlayerRoom.on("enterRoom",this.onEnterRoomHandler,this)},RoomDelegate.prototype.removeListen=function(){this.mPopularityRoom.off("enterRoom",this.onEnterRoomHandler,this),this.mPlayerRoom.off("enterRoom",this.onEnterRoomHandler,this)},RoomDelegate.prototype.updateList=function(t){this.mContent=t,this.mScroller.clearInteractiveObject(),this.mHeight=this.activity.height,this.mChildPad=this.activity.height+14*this.mDpr*this.mWorld.uiScale,this.mContent&&this.mPopularityRoom.addItem(t.popularRooms,this.mChildPad)},RoomDelegate.prototype.addToContainer=function(){this.addListen(),this.refreshPos()},RoomDelegate.prototype.removeFromContainer=function(){this.removeListen(),this.mPopularityRoom&&this.mPopularityRoom.clear(),this.mPlayerRoom&&this.mPlayerRoom.clear()},RoomDelegate.prototype.destroy=function(){this.removeListen(),this.mPlayerRoom&&this.mPopularityRoom.destroy(),this.mPopularityRoom&&this.mPopularityRoom.destroy(),this.mScroller&&this.mScroller.destroy(),this.activity&&this.activity.destroy(),t.prototype.destroy.call(this)},RoomDelegate.prototype.init=function(){var t=this;this.activity=this.mScene.make.image({key:this.mKey,frame:"activity_title.png"},!1),this.activity.y=this.activity.height/2+2*this.mDpr,this.mChildPad+=this.activity.height/2+18*this.mDpr,this.mPopularityRoom=new D(this.mScene,this.mKey,"popularity_icon.png",l.a.t("room_list.popularity_room"),this.mDpr,this.mWorld.uiScale,0,this.mChildPad,(function(e){t.mPopularityRoom.roomList&&t.setScrollInteractive(t.mPopularityRoom.roomList),t.mHeight+=e,t.refreshPos(),t.mChildPad+=t.mPopularityRoom.height,t.mPlayerRoom.addItem(t.mContent.playerRooms,t.mChildPad)})),this.mPlayerRoom=new T(this.mScene,this.mKey,"player_icon.png",l.a.t("room_list.player_room"),this.mDpr,this.mWorld.uiScale,0,this.mChildPad,(function(e){t.mPlayerRoom.roomList&&t.setScrollInteractive(t.mPlayerRoom.roomList),t.mHeight+=e,t.refreshPos(),t.mScroller.refreshBound(t.mHeight),t.mScroller.setValue(t.mContainer.parentContainer.y)}))},RoomDelegate.prototype.refreshPos=function(){this.activity&&(this.activity.setTexture(this.mKey,"activity_title.png"),this.mContainer.add(this.activity)),this.mPopularityRoom&&this.mPopularityRoom.showList&&(this.mContainer.add(this.mPopularityRoom.showList),this.mPopularityRoom.roomList&&this.mContainer.add(this.mPopularityRoom.roomList)),this.mPlayerRoom&&this.mPlayerRoom.showList&&(this.mContainer.add(this.mPlayerRoom.showList),this.mPlayerRoom.roomList&&this.mContainer.add(this.mPlayerRoom.roomList))},RoomDelegate.prototype.onEnterRoomHandler=function(t){this.emit("enterRoom",t)},RoomDelegate.prototype.setScrollInteractive=function(t){for(var e=0,i=t.length;e<i;e++){var n=t[e];this.mScroller.setInteractiveObject(n)}},RoomDelegate}(Phaser.Events.EventEmitter),w=function(t){function MyRoomDelegate(e,i,n,o,a,s){return void 0===s&&(s=1),t.call(this,e,i,o,n,a,s)||this}return b(MyRoomDelegate,t),MyRoomDelegate.prototype.addListen=function(){this.mMyRoom.on("enterRoom",this.onEnterRoomHandler,this),this.mMyHistory.on("enterRoom",this.onEnterRoomHandler,this)},MyRoomDelegate.prototype.removeListen=function(){this.mMyRoom.off("enterRoom",this.onEnterRoomHandler,this),this.mMyHistory.off("enterRoom",this.onEnterRoomHandler,this)},MyRoomDelegate.prototype.addToContainer=function(){this.addListen(),this.refreshPos()},MyRoomDelegate.prototype.removeFromContainer=function(){this.removeListen(),this.mMyRoom&&this.mMyRoom.clear(),this.mMyHistory&&this.mMyHistory.clear()},MyRoomDelegate.prototype.updateList=function(t){this.mMyRoom&&(this.mContent=t,this.mScroller.clearInteractiveObject(),this.mHeight=this.activity.height,this.mChildPad=this.activity.height+14*this.mDpr*this.mWorld.uiScale,this.mMyRoom.addItem(t.selfRooms,this.mChildPad))},MyRoomDelegate.prototype.destroy=function(){this.mMyRoom&&this.mMyRoom.destroy(),this.mMyHistory&&this.mMyHistory.destroy(),t.prototype.destroy.call(this)},MyRoomDelegate.prototype.refreshPos=function(){this.activity&&(this.activity.setTexture(this.mKey,"activity_title.png"),this.mContainer.add(this.activity)),this.mMyRoom&&this.mMyRoom.showList&&(this.mContainer.add(this.mMyRoom.showList),this.mMyRoom.roomList&&this.mContainer.add(this.mMyRoom.roomList)),this.mMyHistory&&this.mMyHistory.showList&&(this.mContainer.add(this.mMyHistory.showList),this.mMyHistory.roomList&&this.mContainer.add(this.mMyHistory.roomList))},MyRoomDelegate.prototype.init=function(){var t=this;this.activity=this.mScene.make.image({key:this.mKey,frame:"activity_title.png"},!1),this.activity.y=this.activity.height/2+2*this.mDpr,this.mChildPad=this.activity.height+14*this.mDpr*this.mWorld.uiScale,this.mMyRoom=new C(this.mScene,this.mKey,"my_room_icon.png",l.a.t("room_list.my_room"),this.mDpr,this.mWorld.uiScale,0,this.mChildPad,(function(e){t.mMyRoom.roomList&&t.setScrollInteractive(t.mMyRoom.roomList),t.mHeight+=e,t.refreshPos(),t.mChildPad+=t.mMyRoom.height,t.mMyHistory.addItem(t.mContent.historyRooms,t.mChildPad)})),this.mMyHistory=new T(this.mScene,this.mKey,"history_icon.png",l.a.t("room_list.my_history"),this.mDpr,this.mWorld.uiScale,0,this.mChildPad,(function(e){t.mMyHistory.roomList&&t.setScrollInteractive(t.mMyHistory.roomList),t.mHeight+=e,t.refreshPos(),t.mScroller.refreshBound(t.mHeight),t.mScroller.setValue(t.mContainer.parentContainer.y)}))},MyRoomDelegate.prototype.onEnterRoomHandler=function(t){this.emit("enterRoom",t)},MyRoomDelegate}(S),T=function(t){function RoomZoon(e,i,n,o,a,h,l,c,p){void 0===l&&(l=0),void 0===c&&(c=0);var u=t.call(this)||this;return u.mWidth=0,u.mHeight=0,u.mShowList=[],u.mScene=e,u.mKey=i,u.mDpr=a,u.uiScale=h,u.mPad=c,u.mOrientaction=l,u.mIconFrame=n,u.mLabel=o,u.icon=e.make.image({key:i,frame:n},!1),u.icon.x=l?-254*a/2+c:-254*a/2,u.icon.y=l?0:c,u.text=e.make.text({text:o,style:{color:"#ffcc33",fontSize:16*a,fontFamily:s.a.DEFULT_FONT}},!1).setOrigin(0,.5),u.text.setStroke("#663300",2*a),u.text.x=l?u.icon.x+u.icon.width/2+4*a+c:u.icon.x+u.icon.width/2+4*a,u.text.y=l?0:c,u.mWidth=u.icon.width,u.mHeight=u.icon.height,u.mAddCallBack=p,u.mRooms=[],u}return b(RoomZoon,t),Object.defineProperty(RoomZoon.prototype,"showList",{get:function(){return this.mShowList},enumerable:!1,configurable:!0}),Object.defineProperty(RoomZoon.prototype,"roomList",{get:function(){return this.mRooms},enumerable:!1,configurable:!0}),RoomZoon.prototype.addItem=function(t,e){void 0===e&&(e=0),this.icon=this.mScene.make.image({key:this.mKey,frame:this.mIconFrame},!1),this.text=this.mScene.make.text({text:this.mLabel,style:{color:"#ffcc33",fontSize:16*this.mDpr,fontFamily:s.a.DEFULT_FONT}},!1).setOrigin(0,.5),this.text.setStroke("#663300",2*this.mDpr),this.icon.x=this.mOrientaction?-254*this.mDpr/2+e:-254*this.mDpr/2,this.icon.y=this.mOrientaction?0:e,this.text.x=this.mOrientaction?this.icon.x+this.icon.width/2+4*this.mDpr+e:this.icon.x+this.icon.width/2+4*this.mDpr,this.text.y=this.mOrientaction?0:e,this.mShowList.push(this.icon),this.mShowList.push(this.text),this.mHeight=this.icon.height,this.mPad=e||this.mPad;var i=t.length,n=this.uiScale,o=this.mOrientaction?this.mPad+e:0,a=6*this.mDpr*n;if(i>0){this.mPad+=this.icon.height+12*this.mDpr*n;for(var h=0;h<i;h++){var l=new M(this.mScene,this.mKey,this.mDpr);l.setInfo(t[h]),l.on("enterRoom",this.onEnterRoomHandler,this),l.x=o;var c=h*(l.height+a)+this.mPad;l.y=c,this.mHeight+=l.height+a,this.mRooms[h]=l}}this.mHeight+=a,this.mAddCallBack&&this.mAddCallBack(this.mHeight)},Object.defineProperty(RoomZoon.prototype,"width",{get:function(){return this.mWidth},enumerable:!1,configurable:!0}),Object.defineProperty(RoomZoon.prototype,"height",{get:function(){return this.mHeight},enumerable:!1,configurable:!0}),RoomZoon.prototype.destroy=function(){this.clear(),t.prototype.destroy.call(this)},RoomZoon.prototype.clear=function(){for(var t=0,e=this.mRooms;t<e.length;t++){e[t].destroy()}for(var i=0,n=this.mShowList;i<n.length;i++){n[i].destroy()}this.icon.destroy(),this.text.destroy(),this.mShowList.length=0,this.mRooms.length=0},RoomZoon.prototype.onEnterRoomHandler=function(t){this.emit("enterRoom",t)},RoomZoon}(Phaser.Events.EventEmitter),C=function(t){function MyRoomZoon(){return null!==t&&t.apply(this,arguments)||this}return b(MyRoomZoon,t),MyRoomZoon.prototype.addItem=function(t,e){void 0===e&&(e=0),this.icon=this.mScene.make.image({key:this.mKey,frame:this.mIconFrame},!1),this.text=this.mScene.make.text({text:this.mLabel,style:{color:"#ffcc33",fontSize:16*this.mDpr,fontFamily:s.a.DEFULT_FONT}},!1).setOrigin(0,.5),this.text.setStroke("#663300",2*this.mDpr),this.icon.x=this.mOrientaction?-254*this.mDpr/2+e:-254*this.mDpr/2,this.icon.y=this.mOrientaction?0:e,this.text.x=this.mOrientaction?this.icon.x+this.icon.width/2+4*this.mDpr+e:this.icon.x+this.icon.width/2+4*this.mDpr,this.text.y=this.mOrientaction?0:e,this.mShowList.push(this.icon),this.mShowList.push(this.text),this.mHeight=this.icon.height,this.mPad=e||this.mPad;var i=this.uiScale,n=this.mOrientaction?this.mPad+e:0,o=6*this.mDpr*i;if(t.length>0){this.mPad+=this.icon.height+14*this.mDpr*i;for(var a=0;a<t.length;a++){var h=new O(this.mScene,this.mKey,this.mDpr);h.setInfo(t[a]),h.on("enterRoom",this.onEnterRoomHandler,this),h.x=n;var l=a*(h.height+o)+this.mPad;h.y=l,this.mHeight+=h.height+o,this.mRooms[a]=h}}this.mHeight+=o,this.mAddCallBack&&(g.a.getInstance().log("myroomheight:"+this.mHeight),this.mAddCallBack(this.mHeight))},MyRoomZoon}(T),D=function(t){function PopularRoomZoon(){return null!==t&&t.apply(this,arguments)||this}return b(PopularRoomZoon,t),PopularRoomZoon.prototype.addItem=function(t,e){void 0===e&&(e=0),this.icon=this.mScene.make.image({key:this.mKey,frame:this.mIconFrame},!1),this.text=this.mScene.make.text({text:this.mLabel,style:{color:"#ffcc33",fontSize:16*this.mDpr,fontFamily:s.a.DEFULT_FONT}},!1).setOrigin(0,.5),this.text.setStroke("#663300",2*this.mDpr),this.icon.x=this.mOrientaction?-254*this.mDpr/2+e:-254*this.mDpr/2,this.icon.y=this.mOrientaction?0:e,this.text.x=this.mOrientaction?this.icon.x+this.icon.width/2+4*this.mDpr+e:this.icon.x+this.icon.width/2+4*this.mDpr,this.text.y=this.mOrientaction?0:e,this.mShowList.push(this.icon),this.mShowList.push(this.text),this.mHeight=this.icon.height,this.mPad=e||this.mPad;var i=this.uiScale,n=this.mOrientaction?this.mPad:0,o=6*this.mDpr*i;if(t.length>0){this.mPad+=this.icon.height+12*this.mDpr*i;for(var a=0;a<t.length;a++){var h=new x(this.mScene,this.mKey,this.mDpr);h.setInfo(t[a]),h.setRank(a+1),h.on("enterRoom",this.onEnterRoomHandler,this),h.x=n;var l=a*(h.height+o)+this.mPad;h.y=l,this.mHeight+=h.height+o,this.mRooms[a]=h}}return this.mHeight+=o,this.mAddCallBack&&(g.a.getInstance().log("popheight:"+this.mHeight),this.mAddCallBack(this.mHeight)),this.mHeight},PopularRoomZoon}(T),M=function(t){function RoomItem(e,i,n){void 0===n&&(n=1);var o=t.call(this,e)||this;return o.mKey=i,o.mDpr=n,o.init(i,n),o}return b(RoomItem,t),RoomItem.prototype.setInfo=function(t){t&&(t.name&&this.mNickName.setText(t.name),t.playerCount&&this.mCounter.setText(t.playerCount.toString())),this.mCounterIcon.x=this.mCounter.x-this.mCounter.width/2-this.mCounterIcon.width/2-4*this.mDpr,this.crateLabel(c.op_def.EditModeRoomPrivacy.EDIT_MODE_ROOM_LOCKED),this.mRoom=t},RoomItem.prototype.roomData=function(){return this.mRoom},RoomItem.prototype.onEnterRoomHandler=function(t){this.mRoom&&this.emit("enterRoom",this.mRoom.roomId)},RoomItem.prototype.init=function(t,e){this.mBackground=this.scene.make.image({key:t,frame:"room_gray.png"},!1).setInteractive(),this.setSize(this.mBackground.width,this.mBackground.height),this.mNickName=this.scene.make.text({style:{color:"#000000",fontFamily:s.a.DEFULT_FONT,fontSize:14*e}},!1),this.mNickName.x=-this.width/2+12*e,this.mNickName.y=-this.mNickName.height/2,this.mCounterIcon=this.scene.make.image({key:t,frame:"counter_icon.png"},!1),this.mCounter=this.scene.make.text({style:{color:"#000000",fontFamily:s.a.DEFULT_FONT,fontSize:14*e}},!1).setOrigin(.5),this.mCounter.x=this.width/2-23*e,this.add([this.mBackground,this.mNickName,this.mCounterIcon,this.mCounter])},RoomItem.prototype.crateLabel=function(t){var e="",i="";t===c.op_def.EditModeRoomPrivacy.EDIT_MODE_ROOM_LOCKED?(e="passworld_label.png",i=l.a.t("room_list.password")):t===c.op_def.EditModeRoomPrivacy.EDIT_MODE_ROOM_PRIVATE&&(e="close_label.png",i=l.a.t("room_list.close")),""!==e&&""!==i&&(this.mLabelImg=this.scene.make.image({key:this.mKey,frame:e},!1),this.mLabelText=this.scene.make.text({text:i,style:{color:"#666666",fontFamily:s.a.DEFULT_FONT,fontSize:12*this.mDpr}},!1).setOrigin(0,.5),this.add([this.mLabelImg,this.mLabelText]),this.mLabelImg.x=this.width/2-85*this.mDpr,this.mLabelText.x=this.mLabelImg.x-7*this.mDpr)},RoomItem}(Phaser.GameObjects.Container),O=function(t){function MyRoomItem(e,i,n){return void 0===n&&(n=1),t.call(this,e,i,n)||this}return b(MyRoomItem,t),MyRoomItem.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.mBackground&&this.mBackground.setFrame("room_yellow.png"),this.mNickName&&(this.mNickName.setColor("#663300"),this.mCounter.setColor("#663300"))},MyRoomItem}(M),x=function(t){function PopularRoomItem(e,i,n){return void 0===n&&(n=1),t.call(this,e,i,n)||this}return b(PopularRoomItem,t),PopularRoomItem.prototype.setRank=function(t){this.mRankImage&&(this.mRankImage.setTexture(this.mKey,"rank_"+t+".png"),this.mRankImage.x=-this.width/2+this.mRankImage.width/2-2*this.mDpr,this.add(this.mRankImage))},PopularRoomItem.prototype.init=function(e,i){t.prototype.init.call(this,e,i),this.mRankImage=this.scene.make.image(void 0,!1),this.mNickName.x=-this.width/2+37*i},PopularRoomItem}(O)},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopItemSlot",(function(){return y}));var n,o,a,s=i(40),h=i(69),l=i(3),c=i(5);o=n||(n={}),a=function(){function TuDing18(){}return TuDing18.getName=function(){return"ui_moneyIcon_tuding_18_png"},TuDing18.getPNG=function(){return c.h.getRes("ui/moneyIcon/tuding_18.png")},TuDing18}(),o.TuDing18=a;var p,u=i(16),m=i(90),d=i(4),f=(p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),y=function(t){function ShopItemSlot(e,i,n,o,a,s,h,l,c,p,u){return t.call(this,e,i,n,o,a,s,h,l,c,p)||this}return f(ShopItemSlot,t),ShopItemSlot.prototype.shopDataChange=function(e,i){if(e){this.mPackageID=i,t.prototype.dataChange.call(this,e);for(var o=e.price,a=o.length,s=0;s<a;s++){o[s].coinType===l.op_def.CoinType.TU_DING_COIN&&(n.TuDing18.getName(),n.TuDing18.getPNG()),this.makeCoin(o[s],20*s+30)}}},ShopItemSlot.prototype.destroy=function(){this.moneyIcon&&(this.moneyIcon.destroy(!0),this.moneyIcon=null),t.prototype.destroy.call(this)},ShopItemSlot.prototype.makeCoin=function(t,e){var i;t.coinType===l.op_def.CoinType.TU_DING_COIN&&(n.TuDing18.getName(),i=n.TuDing18.getPNG()),this.moneyIcon=new u.DynamicImage(this.mScene,0,0),this.moneyIcon.x=15+(-this.mWid>>1),this.moneyIcon.y=e,this.toolTipCon.add(this.moneyIcon),this.moneyIcon.load(i);var o=this.mScene.make.text(void 0,!1);o.setFontFamily("Tahoma"),o.setFontSize(15),o.x=-this.mWid/2+this.moneyIcon.width+20,o.y=e-9,this.toolTipCon.add(o),o.setText(t.price.toString())},ShopItemSlot.prototype.onLoadCompleteHandler=function(){this.mWid=80,this.mHei=88,this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.itemBG.y=-10,this.toolTipCon.setSize(this.mWid,this.mHei),this.toolTipCon.addAt(this.itemBG,0),this.mIcon=new h.DragDropIcon(this.mScene,0,-10),this.toolTipCon.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1),this.isTipBoo&&(this.toolTip=new m.ToolTip(this.mScene,"itemSlotTip",c.h.getRes("ui/toolTip/toolTip.json"),c.h.getRes("ui/toolTip/toolTip.png"),this.mWorld.uiScale)),this.toolTipCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.toolTipCon.on("pointerover",this.overHandler,this),this.toolTipCon.on("pointerout",this.outHandler,this),this.toolTipCon.on("pointerdown",this.downHandler,this),this.toolTipCon.on("pointerup",this.outHandler,this),this.minitialize=!0,this.mData&&this.dataChange(this.mData),this.mSelectSprite=this.mScene.make.sprite(void 0,!1),this.createTexture(this.mWid,this.mHei)},ShopItemSlot.prototype.overHandler=function(e){t.prototype.overHandler.call(this,e),this.mSelectSprite.y-=10},ShopItemSlot.prototype.downHandler=function(t){if(this.mData){var e=new d.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),i=e.content;i.uiId=this.mPackageID,i.componentId=this.mData.id,this.mWorld.connection.send(e)}},ShopItemSlot.prototype.outHandler=function(e){t.prototype.outHandler.call(this,e)},ShopItemSlot.prototype.createTexture=function(t,e){var i=this.mScene.add.graphics();i.fillStyle(11184553,.3),i.fillRoundedRect(0,0,t,e,5),i.generateTexture("selectBg",t,e),i.clear()},ShopItemSlot}(s.ItemSlot)},function(t,e,i){"use strict";const n=Phaser.Display.Canvas.CanvasPool;var textstyle_MeasureText=function(t){var e=n.create(this),i=e.getContext("2d");t.syncFont(e,i);var o=Math.ceil(i.measureText(t.testString).width*t.baselineX),a=o,s=2*a;a=a*t.baselineY|0,e.width=o,e.height=s,i.fillStyle="#f00",i.fillRect(0,0,o,s),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,a);var h={ascent:0,descent:0,fontSize:0};if(!i.getImageData(0,0,o,s))return h.ascent=a,h.descent=a+6,h.fontSize=h.ascent+h.descent,n.remove(e),h;var l,c,p=i.getImageData(0,0,o,s).data,u=p.length,m=4*o,d=0,f=!1;for(l=0;l<a;l++){for(c=0;c<m;c+=4)if(255!==p[d+c]){f=!0;break}if(f)break;d+=m}for(h.ascent=a-l,d=u-m,f=!1,l=s;l>a;l--){for(c=0;c<m;c+=4)if(255!==p[d+c]){f=!0;break}if(f)break;d-=m}return h.descent=l-a,h.fontSize=h.ascent+h.descent,n.remove(e),h},o=i(53);const a=Phaser.Utils.Objects.GetAdvancedValue,s=Phaser.Utils.Objects.GetValue;var h={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign","left"],valign:["valign","top"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};o.a.hleft,o.a.hcenter,o.a.hright,o.a.vtop,o.a.vcenter,o.a.vbottom;const l={none:o.a.NO_WRAP,word:o.a.WORD_WRAP,char:o.a.CHAR_WRAP,character:o.a.CHAR_WRAP};e.a=class TextStyle_TextStyle{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var i=s(e,"metrics",!1);this.metrics=i?{ascent:s(i,"ascent",0),descent:s(i,"descent",0),fontSize:s(i,"fontSize",0)}:textstyle_MeasureText(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var n=i.mode;"string"==typeof n&&(i.mode=l[n])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var o in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),h)this[o]="wrapCallback"===o||"wrapCallbackScope"===o?s(t,h[o][0],h[o][1]):a(t,h[o][0],h[o][1]);var c=s(t,"font",null);this._font=null===c?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:c;var p=s(t,"fill",null);return null!==p&&(this.color=p),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=textstyle_MeasureText(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=s(t,"fontFamily","Courier"),this.fontSize=s(t,"fontSize","16px"),this.fontStyle=s(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,n,o,a){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===n&&(n=0),void 0===o&&(o=!1),void 0===a&&(a=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=n,this.shadowStroke=o,this.shadowFill=a,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=l[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in h)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}}},,,,,,,,function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n,o=i(14),a=i(47),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ReferenceArea(e,i){var n=t.call(this,e)||this;return n.mRoomService=i,n}return s(ReferenceArea,t),ReferenceArea.prototype.draw=function(t,e){if(this.clear(),0!==t.length&&0!==t[0].length){var i,n,s,h,l=t.length,c=t[0].length,p=this.mRoomService.roomSize,u=p.tileWidth/2,m=p.tileHeight/2;this.mOrigin=e,this.mSize={rows:l,cols:c,tileWidth:u,tileHeight:m,sceneWidth:(l+c)*(u/2),sceneHeight:(l+c)*(m/2)},this.beginPath();for(var d=0;d<l;d++)for(var f=0;f<c;f++)this.lineStyle(2,0),i=a.a.transformTo90(new o.a(f,d),this.mSize),n=a.a.transformTo90(new o.a(f+1,d),this.mSize),s=a.a.transformTo90(new o.a(f+1,d+1),this.mSize),h=a.a.transformTo90(new o.a(f,d+1),this.mSize),this.beginPath(),this.fillStyle(1===t[d][f]?65280:16711680),this.strokePoints([i.toPoint(),n.toPoint(),s.toPoint(),h.toPoint()],!0,!0),this.fillPath();this.setPosition(0,0)}},ReferenceArea.prototype.setPosition=function(e,i,n,o){if(this.mSize){var a=e-this.mSize.rows*(this.mSize.tileWidth>>1)-(this.mOrigin.x-this.mOrigin.y)*(this.mSize.tileWidth>>1),s=i-(this.mOrigin.x+this.mOrigin.y)*(this.mSize.tileHeight>>1);return t.prototype.setPosition.call(this,a,s,n,o)}},Object.defineProperty(ReferenceArea.prototype,"size",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),ReferenceArea}(Phaser.GameObjects.Graphics)},,function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n,o=i(8),a=i(128),s=i(119),h=i(3),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function Terrain(e,i){var n=t.call(this,i.roomService)||this;return n.mElementManager=i,n.mId=e.id,n.model=e,n}return l(Terrain,t),Terrain.prototype.setModel=function(t){this.mModel=t,t&&(this.load(this.mModel.displayInfo),this.mDisplay&&this.setPosition45(this.mModel.pos))},Terrain.prototype.updateModel=function(t){},Terrain.prototype.load=function(t){this.mDisplayInfo=t,this.mDisplayInfo&&(this.mDisplay||this.createDisplay(),this.mDisplayInfo=t,this.mDisplay.once("initialized",this.onInitializedHandler,this),this.mDisplay.load(this.mDisplayInfo))},Terrain.prototype.play=function(t){this.mModel?this.mModel.currentAnimationName!==t&&(this.mModel.currentAnimationName=t,this.mDisplay&&this.mDisplay.play(this.model.currentAnimation)):o.a.getInstance().error(Terrain.name+": sprite is empty")},Terrain.prototype.setDirection=function(t){this.mDisplayInfo&&this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t)},Terrain.prototype.getDirection=function(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},Terrain.prototype.setPosition=function(t){this.mDisplay&&this.mDisplay.setPosition(t.x,t.y,t.z),this.setDepth()},Terrain.prototype.getDisplay=function(){return this.mDisplay},Terrain.prototype.showNickname=function(){},Terrain.prototype.showEffected=function(){},Terrain.prototype.toSprite=function(){var t=h.op_client.Sprite.create();if(t.id=this.id,this.mDisplay){var e=this.getPosition45();this.mDisplay.x=e.x,this.mDisplay.y=e.y}return t},Terrain.prototype.turn=function(){},Terrain.prototype.setAlpha=function(t){},Terrain.prototype.scaleTween=function(){},Terrain.prototype.setQueue=function(){},Terrain.prototype.destroy=function(){this.mBlockable&&this.mDisplay&&this.roomService.removeBlockObject(this),t.prototype.destroy.call(this)},Terrain.prototype.createDisplay=function(){if(this.mDisplayInfo){if(this.mDisplay)return this.mDisplay;var t=this.mElementManager.scene;return t&&(this.mDisplay=new a.a(t,this.mElementManager.roomService,this),this.setPosition45(this.model.pos),this.addToBlock()),this.mDisplay}},Terrain.prototype.addDisplay=function(){if(this.createDisplay(),this.mDisplay)if(this.mElementManager){var t=this.mElementManager.roomService;t?(t.addToGround(this.mDisplay),this.setDepth()):o.a.getInstance().error("roomService does not exist")}else o.a.getInstance().error("element manager does not exist")},Terrain.prototype.setDepth=function(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.y),!this.roomService)throw new Error("roomService is undefined");var t=this.roomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthGroundDirty=!0}},Terrain.prototype.onInitializedHandler=function(){this.mDisplay},Terrain.prototype.setPosition45=function(t){if(this.roomService){var e=this.roomService.transformTo90(t);this.setPosition(e)}else o.a.getInstance().error("roomService does not exist")},Object.defineProperty(Terrain.prototype,"id",{get:function(){return this.mId},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"dir",{get:function(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"roomService",{get:function(){if(this.mElementManager)return this.mElementManager.roomService;o.a.getInstance().error("element manager is undefined")},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"model",{get:function(){return this.mModel},set:function(t){this.setModel(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"currentAnimationName",{get:function(){return this.mModel?this.mModel.currentAnimationName:""},enumerable:!1,configurable:!0}),Object.defineProperty(Terrain.prototype,"scene",{get:function(){if(this.mElementManager)return this.mElementManager.scene},enumerable:!1,configurable:!0}),Terrain}(s.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function PlayCamera(e,i,n,o,a,s){var h=t.call(this,e,i,n,o)||this;return h.pixelRatio=a,h.moveRatio=s||1,h}return o(PlayCamera,t),PlayCamera.prototype.startFollow=function(t,e,i,n,o,a){void 0===e&&(e=!1),void 0===i&&(i=1),void 0===n&&(n=i),void 0===o&&(o=0),void 0===a&&(a=o),this._follow=t,this.roundPixels=e,this.lerp.set(i,n),this.followOffset.set(o,a);var s=this.width/2,h=this.height/2,l=t.x*this.pixelRatio*this.moveRatio-o,c=t.y*this.pixelRatio*this.moveRatio-a;return this.midPoint.set(l,c),this.scrollX=l-s,this.scrollY=c-h,this.useBounds&&(this.scrollX=this.clampX(this.scrollX),this.scrollY=this.clampY(this.scrollY)),this},PlayCamera.prototype.preRender=function(t){var e=this.width,i=this.height,n=.5*e,o=.5*i,a=this.zoom*t,s=this.matrix,h=e*this.originX,l=i*this.originY,c=this._follow,p=this.deadzone,u=this.scrollX,m=this.scrollY;if(c&&!this.panEffect.isRunning){var d=c.x*this.pixelRatio*this.moveRatio-this.followOffset.x,f=c.y*this.pixelRatio*this.moveRatio-this.followOffset.y;p?(d<p.x?u=this.linear(u,u-(p.x-d),this.lerp.x):d>p.right&&(u=this.linear(u,u+(d-p.right),this.lerp.x)),f<p.y?m=this.linear(m,m-(p.y-f),this.lerp.y):f>p.bottom&&(m=this.linear(m,m+(f-p.bottom),this.lerp.y))):(u=this.linear(u,d-h,this.lerp.x),m=this.linear(m,f-l,this.lerp.y))}this.useBounds&&(u=this.clampX(u),m=this.clampY(m)),this.roundPixels&&(h=Math.round(h),l=Math.round(l)),this.scrollX=u,this.scrollY=m;var y=u+n,g=m+o;this.midPoint.set(y,g);var _=e/a,v=i/a;this.worldView.setTo(y-_/2,g-v/2,_,v),s.applyITRS(this.x+h,this.y+l,this.rotation,a,a),s.translate(-h,-l),this.shakeEffect.preRender()},PlayCamera.prototype.linear=function(t,e,i){return(e-t)*i+t},PlayCamera}(Phaser.Cameras.Scene2D.Camera)},,,,,,,,,,,,,function(t,e,i){"use strict";var n;e.a=function(t,e){void 0===e&&(void 0===n&&(n=new Phaser.Geom.Rectangle),e=n);var i=t.game.config;return e.setTo(0,0,i.width,i.height),e}},function(t,e,i){"use strict";const n=Phaser.Scene;e.a=function(t){return t instanceof n}},function(t,e,i){"use strict";e.a={v:0,vertical:0,h:1,horizontal:1}},function(t,e){t.exports=function(t,e,i){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1!==e.indexOf(".")){for(var n=e.split("."),o=t,a=i,s=0;s<n.length;s++){if(!o.hasOwnProperty(n[s])){a=i;break}a=o[n[s]],o=o[n[s]]}return a}return i}return i}},function(t,e,i){"use strict";var n=i(180);const o=Phaser.Geom.Intersects.RectangleToRectangle,a=Phaser.Geom.Rectangle.Overlaps;var containsPoints=function(t,e){var i=0,n=e.top,o=e.bottom,a=e.left,s=e.right;return i+=t.contains(a,n)?1:0,i+=t.contains(a,o)?1:0,i+=t.contains(s,n)?1:0,i+=t.contains(s,o)?1:0},showAll=function(t,e){t.setVisible(!0),t.clearMask&&t.clearMask()},showSome=function(t,e){t.setVisible(!0),t.setMask&&t.setMask(e)},showNone=function(t,e){t.setVisible(!1),t.clearMask&&t.clearMask()};e.a=function(t,e,i){if(e){void 0===i&&(i=t.getAllChildren());for(var s,h,l=t.getBounds(),c=Object(n.a)(e),p=0,u=i.length;p<u;p++)if(!(s=i[p]).hasOwnProperty("isRexContainerLite")&&s!==c){if(s.getBounds)switch(h=s.getBounds(h),containsPoints(l,h)){case 4:showAll(s,e);break;case 0:o(l,h)||a(l,h)?showSome(s,e):showNone(s,e);break;default:showSome(s,e)}else showSome(s,e);t.resetChildVisibleState(s).updateChildVisible(s)}}}},,function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterInfoMediator",(function(){return c}));var n,o=i(3),a=i(7),s=i(253),h=i(192),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function CharacterInfoMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return l(CharacterInfoMediator,t),CharacterInfoMediator.prototype.show=function(){this.mView||(this.mView||(this.mView=new s.default(this.scene,this.world),this.mView.on("hide",this.onHidePanel,this),this.mView.on("queryOwnerInfo",this.onQueryOwnerInfo,this)),this.characterInfo||(this.characterInfo=new h.CharacterInfo(this.world),this.characterInfo.on("ownerInfo",this.onOwnerCharacterInfo,this),this.characterInfo.on("otherInfo",this.onOtherCharacterInfo,this),this.characterInfo.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show())},CharacterInfoMediator.prototype.isSceneUI=function(){return!0},CharacterInfoMediator.prototype.destroy=function(){this.characterInfo&&(this.characterInfo.destroy(),this.characterInfo=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},CharacterInfoMediator.prototype.onHidePanel=function(){this.destroy()},CharacterInfoMediator.prototype.onOwnerCharacterInfo=function(t){this.mView.setPlayerData(t)},CharacterInfoMediator.prototype.onOtherCharacterInfo=function(t){this.mView.setPlayerData(t)},CharacterInfoMediator.prototype.onQueryOwnerInfo=function(){this.characterInfo.queryPlayerInfo()},CharacterInfoMediator.prototype.testOwnerData=function(){var t=this.world.roomManager.currentRoom.playerManager.actor,e=new o.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_PKT_SELF_PLAYER_INFO;e.id=t.id,e.cid="5524121555",e.like=652,e.currentAvatar=new o.op_pkt_def.PKT_Avatar,e.currentAvatar.avatar=t.model.avatar,e.nickname=t.model.nickname,e.level=new o.op_pkt_def.PKT_Level,e.level.level=32,e.level.currentLevelExp=100,e.level.nextLevelExp=400,e.lifeSkills=[],e.currentTitle="这是一个称号";for(var i=0;i<20;i++){var n=new o.op_pkt_def.PKT_Skill;n.id=i+10+"",n.name="技能"+i,n.level=new o.op_pkt_def.PKT_Level,n.level.level=20+i,n.level.currentLevelExp=200+10*i,n.level.nextLevelExp=400+10*i,e.lifeSkills.push(n)}return e},CharacterInfoMediator}(a.a)},function(t,e,i){"use strict";var n=i(21);e.a=function(t,e,i,o){var a=new n.a(this.scene,t,e,i,o);return this.scene.add.existing(a),a}},function(t,e,i){"use strict";var n=i(21);const o=Phaser.Utils.Objects.GetAdvancedValue,a=Phaser.GameObjects.BuildGameObject;e.a=function(t,e){var i=o(t,"text",""),s=o(t,"style",null),h=o(t,"padding",null);null!==h&&(s.padding=h),void 0!==e&&(t.add=e);var l=new n.a(this.scene,0,0,i,s);return a(this.scene,l,t),l.autoRound=o(t,"autoRound",!0),l.resolution=o(t,"resolution",1),l}},function(t,e,i){"use strict";var n=i(37),o=i(145);const a=Phaser.Utils.Objects.GetValue,s=Phaser.Utils.Array.SpliceOne,h=Phaser.Math.Distance.Between,l=Phaser.Math.Angle.Between;class TwoPointersTracer{constructor(t,e){var i=t.input.manager.pointersTotal-1;i<2&&t.input.addPointer(2-i),this.scene=t,this.setEventEmitter(a(e,"eventEmitter",void 0)),this.pointers=[],this.movedState={},this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(a(t,"enable",!0)),this.bounds=a(t,"bounds",void 0),this.tracerState=p,this.pointers.length=0,Object(o.a)(this.movedState),this}boot(){this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointers.length=0,Object(o.a)(this.movedState),this.scene&&(this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t||(t||this.dragCancel(),this.enable=t),this}onPointerDown(t){if(this.enable&&(2!==this.pointers.length&&(!this.bounds||this.bounds.contains(t.x,t.y))&&-1===this.pointers.indexOf(t)))switch(this.movedState[t.id]=!1,this.pointers.push(t),this.tracerState){case p:this.tracerState=u,this.onDrag1Start();break;case u:this.tracerState=m,this.onDrag2Start()}}onPointerUp(t){if(this.enable&&(!this.bounds||this.bounds.contains(t.x,t.y))){var e=this.pointers.indexOf(t);if(-1!==e)switch(delete this.movedState[t.id],s(this.pointers,e),this.tracerState){case u:this.tracerState=p,this.onDrag1End();break;case m:this.tracerState=u,this.onDrag2End(),this.onDrag1Start()}}}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),i=-1!==this.pointers.indexOf(t);if(!i&&e);else if(i&&!e)this.onPointerUp(t);else if(this.movedState[t.id]||(this.movedState[t.id]=t.x!==t.downX||t.y!==t.downY),this.movedState[t.id])switch(this.tracerState){case u:this.onDrag1();break;case m:this.onDrag2()}}}dragCancel(){return this.tracerState===m&&this.onDrag2End(),this.pointers.length=0,Object(o.a)(this.movedState),this.tracerState=p,this}onDrag1Start(){this.emit("drag1start",this)}onDrag1End(){this.emit("drag1end",this)}onDrag1(){this.emit("drag1",this)}onDrag2Start(){this.emit("drag2start",this)}onDrag2End(){this.emit("drag2end",this)}onDrag2(){this.emit("drag2",this)}get distanceBetween(){if(this.tracerState!==m)return 0;var t=this.pointers[0],e=this.pointers[1];return h(t.x,t.y,e.x,e.y)}get angleBetween(){if(this.tracerState!==m)return 0;var t=this.pointers[0],e=this.pointers[1];return l(t.x,t.y,e.x,e.y)}get drag1Vector(){var t=this.pointers[0];if(t&&this.movedState[t.id]){var e=t.position,i=t.prevPosition;c.x=e.x-i.x,c.y=e.y-i.y}else c.x=0,c.y=0;return c}get centerX(){if(this.tracerState!==m)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.x+e.x)/2}get centerY(){if(this.tracerState!==m)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.y+e.y)/2}get prevCenterX(){if(this.tracerState!==m)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.x+e.x)/2}get prevCenterY(){if(this.tracerState!==m)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.y+e.y)/2}get movementCenterX(){return this.centerX-this.prevCenterX}get movementCenterY(){return this.centerY-this.prevCenterY}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=d,this}}Object.assign(TwoPointersTracer.prototype,n.a);var c={};const p=0,u=1,m=2,d="IDLE";e.a=TwoPointersTracer},function(t,e,i){"use strict";i.r(e),i.d(e,"GraphicsProgressBar",(function(){return a}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function GraphicsProgressBar(e,i,n,o,a,s){void 0===s&&(s=!0);var h=t.call(this,e,i,n)||this;return h.value=.5,h.bgGraphics=h.scene.make.graphics(void 0,!1),h.barGraphics=h.scene.make.graphics(void 0,!1),h.add([h.bgGraphics,h.barGraphics]),h.setSize(o,a),h.bgColor=0,h.barColor=267386880,h.bgGraphics.clear(),h.bgGraphics.fillStyle(h.bgColor,1),h.bgGraphics.fillRect(0,0,h.width,h.height),h.setValue(h.value),h}return o(GraphicsProgressBar,t),GraphicsProgressBar.prototype.setColor=function(t,e){this.barColor=t,e&&(this.bgColor=e),this.bgGraphics.clear(),this.bgGraphics.fillStyle(this.bgColor,1),this.bgGraphics.fillRect(0,0,this.width,this.height),this.setValue(this.value)},GraphicsProgressBar.prototype.setValue=function(t){this.value=t;var e=this.width*(this.isHorizontal?t:1),i=this.height*(this.isHorizontal?1:t);this.barGraphics.clear(),this.barGraphics.fillStyle(this.barColor,1),this.barGraphics.fillRect(0,0,e,i)},GraphicsProgressBar.prototype.setRoundedRectValue=function(t,e){this.value=t;var i=this.width*(this.isHorizontal?t:1),n=this.height*(this.isHorizontal?1:t);this.barGraphics.clear(),this.barGraphics.fillStyle(this.barColor,1),this.barGraphics.fillRoundedRect(0,0,i,n,e)},GraphicsProgressBar}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"ScrollRect",(function(){return s}));var n,o=i(199),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function ScrollRect(e,i,n){var a=t.call(this,e,i,n)||this;return a.content=new o.GridLayoutGroup(e,i,n),a}return a(ScrollRect,t),ScrollRect.prototype.setParent=function(t){t.add(this),t.add(this.content)},ScrollRect.prototype.setPosition=function(e,i){return t.prototype.setPosition.call(this,e,i),this},ScrollRect.prototype.addItem=function(t){this.content.add(t)},ScrollRect.prototype.sort=function(){this.content.Layout(),this.content.startAxis,o.AxisType.Horizontal},ScrollRect.prototype.onMove=function(t){},ScrollRect}(Phaser.GameObjects.Zone)},function(t,e,i){"use strict";i.r(e),i.d(e,"ComposeMediator",(function(){return c}));var n,o=i(203),a=i(3),s=i(202),h=i(7),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function ComposeMediator(e,i,n){var o=t.call(this)||this;return o.tsetskills=[],o.testDateils=[],o.scene=i,o.layerMgr=e,o.world=n,o}return l(ComposeMediator,t),ComposeMediator.prototype.show=function(){this.mView||(this.mView||(this.mView=new o.ComposePanel(this.scene,this.world),this.mView.on("hide",this.onHideView,this),this.mView.on("reqformula",this.onReqFormulaDetial,this),this.mView.on("reqUseFormula",this.onReqUseFormula,this)),this.compose||(this.compose=new s.Compose(this.world),this.compose.on("formulaDetial",this.onRetFormulaDetial,this),this.compose.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show(this.mParam[0]))},ComposeMediator.prototype.isSceneUI=function(){return!0},ComposeMediator.prototype.destroy=function(){this.compose&&(this.compose.destroy(),this.compose=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},ComposeMediator.prototype.onReqFormulaDetial=function(t){this.compose.onReqFormulaDetail(t)},ComposeMediator.prototype.onReqUseFormula=function(t){this.compose.onReqUseFormula(t)},ComposeMediator.prototype.onRetFormulaDetial=function(t){this.mView.setComposeDetialData(t)},ComposeMediator.prototype.onHideView=function(){this.destroy()},ComposeMediator.prototype.getTestData=function(){for(var t=[],e=0;e<20;e++){var i=new a.op_pkt_def.PKT_Skill;i.id="1"+e,i.name="蓝图"+e,i.quality=e%3==0?"A":e%2==0?"B":"C",i.active=e%6!=0,i.qualified=e%8!=0,t.push(i)}return t},ComposeMediator.prototype.getTestDeitals=function(){var t=this.getTestData();this.tsetskills=t;for(var e=0,i=t;e<i.length;e++){var n=i[e],o=new a.op_client.OP_VIRTUAL_WORLD_RES_CLIENT_PKT_CRAFT_QUERY_FORMULA;o.id=n.id,o.productName="蓝图"+n.id,o.productDes="这是一段道具的有关描述巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉巴拉",o.materials=[];for(var s=8+Math.floor(8*Math.random()),h=0;h<s;h++){var l=new a.op_client.CountablePackageItem;l.count=s,l.neededCount=n.qualified?l.count-2:l.count+2,o.materials.push(l)}this.testDateils.push(o)}},ComposeMediator}(h.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n,o=i(74),a=i(29),s=i(60),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function NineSliceButton(e,i,n,a,s,h,l,c,p,u,m,d,f){var y=t.call(this,e,i,n)||this;return y.x=i,y.y=n,y.mKey=h,y.mFrame=l||"__BASE",y.dpr=p||1,y.scale=u||1,y.initFrame(),y.setSize(a,s),y.mNingBg=new o.a(y.scene,0,0,a,s,h,y.mFrame_nrmal,m),y.add(y.mNingBg),f&&(y.btnData=f),y.mLabel=y.scene.make.text(void 0,!1).setOrigin(.5,.5).setSize(y.width,y.height).setAlign("center").setText(c),y.add(y.mLabel),y.setInteractive(new Phaser.Geom.Rectangle(0,0,a,s),Phaser.Geom.Rectangle.Contains),y.addListen(),y}return h(NineSliceButton,t),NineSliceButton.prototype.addListen=function(){this.removeListen(),this.on("pointerdown",this.onPointerDown,this),this.on("pointerup",this.onPointerUp,this)},NineSliceButton.prototype.removeListen=function(){this.off("pointerdown",this.onPointerDown,this),this.off("pointerup",this.onPointerUp,this)},Object.defineProperty(NineSliceButton.prototype,"enable",{set:function(t){t?(this.mNingBg.clearTint(),this.mLabel.clearTint(),this.setInteractive()):(this.mNingBg.setTintFill(6710886),this.mLabel.setTintFill(7829367),this.removeInteractive())},enumerable:!1,configurable:!0}),NineSliceButton.prototype.getBtnData=function(){return this.btnData},NineSliceButton.prototype.setText=function(t){this.mLabel.setText(t)},NineSliceButton.prototype.getText=function(){return this.mLabel.text},NineSliceButton.prototype.setTextStyle=function(t){this.mLabel.setStyle(t)},NineSliceButton.prototype.setFontStyle=function(t){this.mLabel.setFontStyle(t)},NineSliceButton.prototype.setTextOffset=function(t,e){this.mLabel.setPosition(t,e)},NineSliceButton.prototype.setFrame=function(t){return this.mNingBg.setFrame(t),this},NineSliceButton.prototype.destroy=function(){this.removeListen(),this.mLabel&&this.mLabel.destroy(),t.prototype.destroy.call(this)},NineSliceButton.prototype.setFrameNormal=function(t,e,i){return this.mFrame_nrmal=t,this.mFrame_down=e||t,this.mFrame_over=i||t,this.changeNormal(),this},NineSliceButton.prototype.changeNormal=function(){this.setFrame(this.mFrame_nrmal)},NineSliceButton.prototype.changeDown=function(){this.setFrame(this.mFrame_down)},NineSliceButton.prototype.changeOver=function(){this.setFrame(this.mFrame_over)},NineSliceButton.prototype.isExists=function(t){var e=this.scene.textures.get(this.mKey);return!(!e||!e.has(t))},NineSliceButton.prototype.onPointerDown=function(t){this.changeDown()},NineSliceButton.prototype.onPointerUp=function(t){this.changeNormal(),this.emit(s.a.MouseEvent.Tap,t,this)},Object.defineProperty(NineSliceButton.prototype,"label",{get:function(){return this.mLabel},enumerable:!1,configurable:!0}),NineSliceButton.prototype.initFrame=function(){var t=this.mFrame?this.mFrame:this.mKey;this.mFrame_nrmal=t+"_normal";var e=t+"_down";this.isExists(e)||(e=t+"_normal"),this.mFrame_down=e;var i=t+"_over";this.isExists(i)||(i=t+"_normal"),this.mFrame_over=i},NineSliceButton}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInMediator",(function(){return h}));var n,o=i(205),a=i(7),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function CutInMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,o}return s(CutInMediator,t),CutInMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||(this.mView=new o.CutInPanel(this.scene,this.world),this.mView.once("close",this.onCloseHandler,this),this.mView.show(t))},CutInMediator.prototype.onCloseHandler=function(){this.mView&&(this.mView.destroy(),this.mView=void 0)},CutInMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"CutInMenuMediator",(function(){return l}));var n,o=i(7),a=i(206),s=i(207),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function CutInMenuMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return h(CutInMenuMediator,t),CutInMenuMediator.prototype.show=function(t){this.mView||(this.mView||(this.mView=new s.CutInMenuPanel(this.scene,this.world),this.mView.on("hide",this.onHideView,this),this.mView.on("rightButton",this.onRightButtonHandler,this)),this.cutInMenu||(this.cutInMenu=new a.CutInMenu(this.world),this.cutInMenu.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show(t))},CutInMenuMediator.prototype.isSceneUI=function(){return!0},CutInMenuMediator.prototype.destroy=function(){this.cutInMenu&&(this.cutInMenu.destroy(),this.cutInMenu=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},CutInMenuMediator.prototype.onRightButtonHandler=function(t,e){this.cutInMenu.reqRightButton(t,e)},CutInMenuMediator.prototype.onHideView=function(){this.destroy()},CutInMenuMediator}(o.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"DragManager",(function(){return n}));var n=function(){function DragManager(t){}return DragManager.prototype.setDragProp=function(t){},DragManager}()},function(t,e,i){"use strict";i.r(e),i.d(e,"EquipUpgradeMediator",(function(){return l}));var n,o=i(211),a=i(209),s=i(7),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function EquipUpgradeMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return h(EquipUpgradeMediator,t),EquipUpgradeMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.default(this.scene,this.world),this.mView.on("hide",this.onHidePanel,this),this.mView.on("reqActive",this.onReqActiveEquipment,this),this.mView.on("reqEquiped",this.onReqEquipedEquipment,this)),this.equipUpgrade||(this.equipUpgrade=new a.EquipUpgrade(this.world),this.equipUpgrade.on("activeEquip",this.onActiveEquipment,this),this.equipUpgrade.register()),this.layerMgr.addToUILayer(this.mView),this.mParam&&this.mParam.length>0&&this.onEquipUpgradePacket(this.mParam[0]),this.mView.show())},EquipUpgradeMediator.prototype.isSceneUI=function(){return!0},EquipUpgradeMediator.prototype.destroy=function(){this.equipUpgrade&&(this.equipUpgrade.destroy(),this.equipUpgrade=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},EquipUpgradeMediator.prototype.onHidePanel=function(){this.destroy()},EquipUpgradeMediator.prototype.onEquipUpgradePacket=function(t){var e=this.mView;e&&(e.setData("upgradeData",t),e.setEquipDatas(t))},EquipUpgradeMediator.prototype.onActiveEquipment=function(t){this.mView&&this.mView.setActiveEquipment(t)},EquipUpgradeMediator.prototype.onReqEquipedEquipment=function(t){this.equipUpgrade&&this.equipUpgrade.reqEquipedEquipment(t)},EquipUpgradeMediator.prototype.onReqActiveEquipment=function(t){this.equipUpgrade&&this.equipUpgrade.reqActiveEquipment(t)},EquipUpgradeMediator}(s.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"FurniBagMediator",(function(){return c}));var n,o=i(213),a=i(212),s=i(3),h=i(7),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function FurniBagMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o.world&&o.world.roomManager&&o.world.roomManager.currentRoom?o.mScneType=o.world.roomManager.currentRoom.sceneType:o.mScneType=s.op_def.SceneTypeEnum.NORMAL_SCENE_TYPE,o}return l(FurniBagMediator,t),FurniBagMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mFurniBag||(this.mFurniBag=new a.FurniBag(this.world,this.mScneType),this.mFurniBag.register(),this.mFurniBag.on("packageCategory",this.onPackageCategoryHandler,this),this.mFurniBag.on("queryPackage",this.onQueryPackageHandler,this),this.mFurniBag.on("queryCommodityResource",this.onQueryCommodityResourceHandler,this),this.mFurniBag.on("queryResetAvatar",this.onResetAvatar,this)),this.mView||(this.mView=new o.FurniBagPanel(this.scene,this.world,this.mScneType),this.mView.on("getCategories",this.onGetCategoriesHandler,this),this.mView.on("queryPackage",this.onQueryPackage,this),this.mView.on("close",this.onCloseHandler,this),this.mView.on("queryPropResource",this.onQueryPropResourceHandler,this),this.mView.on("seachPackage",this.onSeachPackageHandler,this),this.mView.on("addFurniToScene",this.onAddFurniHandler,this),this.mView.on("sellProps",this.onSellPropsHandler,this),this.mView.on("querySaveAvatar",this.onQuerySaveAvatar,this),this.mView.on("queryResetAvatar",this.onQueryResetAvatar,this)),this.mView.show()),this.layerManager.addToUILayer(this.mView)},FurniBagMediator.prototype.destroy=function(){this.mFurniBag&&(this.mFurniBag.destroy(),this.mFurniBag=void 0),this.mView&&(this.mView.destroy(),this.mView=void 0),t.prototype.destroy.call(this)},FurniBagMediator.prototype.onCloseHandler=function(){this.destroy()},FurniBagMediator.prototype.onPackageCategoryHandler=function(t){this.mView&&this.mView.setCategories(t)},FurniBagMediator.prototype.onQueryCommodityResourceHandler=function(t){this.mView.setSelectedResource(t)},FurniBagMediator.prototype.onGetCategoriesHandler=function(t){this.mFurniBag&&this.mFurniBag.getCategories(t)},FurniBagMediator.prototype.onQueryPackageHandler=function(t){this.mView.setProp(t.items)},FurniBagMediator.prototype.onQueryPackage=function(t){this.mFurniBag.queryPackage(t)},FurniBagMediator.prototype.onQueryPropResourceHandler=function(t){this.mFurniBag.queryCommodityResource(t.id)},FurniBagMediator.prototype.onQuerySaveAvatar=function(t){this.mFurniBag.querySaveAvatar(t)},FurniBagMediator.prototype.onQueryResetAvatar=function(t){this.mFurniBag.queryResetAvatar(t)},FurniBagMediator.prototype.onSeachPackageHandler=function(t,e){this.mFurniBag.seachPackage(t,e)},FurniBagMediator.prototype.onAddFurniHandler=function(t){this.mView.enableEdit?this.mFurniBag.enterEditAndSelectedSprite(t):this.mFurniBag.addFurniToScene(t),this.destroy()},FurniBagMediator.prototype.onSellPropsHandler=function(t,e,i){this.mFurniBag.sellProps(t,e,i)},FurniBagMediator.prototype.onResetAvatar=function(t){this.mView.resetAvatar(t)},FurniBagMediator}(h.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemDetailMediator",(function(){return u}));var n,o=i(218),a=i(3),s=i(4),h=i(19),l=i(7),c=i(18),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function ItemDetailMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mScene=i,o.mUIType=c.a.Tips,o.mLayerManager=e,o}return p(ItemDetailMediator,t),ItemDetailMediator.prototype.isSceneUI=function(){return!1},ItemDetailMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ItemDetailMediator.prototype.show=function(t){this.mView&&this.isShow()||(this.mView=new o.ItemDetail(this.mScene,this.world),this.mView.show(t),this.mLayerManager.addToToolTipsLayer(this.mView),this.mScene.input.on("gameobjectdown",this.onBtnHandler,this),this.mShow=!0)},ItemDetailMediator.prototype.update=function(e){t.prototype.update.call(this,e)},ItemDetailMediator.prototype.hide=function(){this.mView&&(this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),this.mView.hide(),this.mView=null,t.prototype.hide.call(this))},ItemDetailMediator.prototype.destroy=function(){this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),t.prototype.destroy.call(this)},ItemDetailMediator.prototype.onBtnHandler=function(t,e){if(e&&e instanceof h.NinePatchButton){var i=this.mParam[0],n=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),o=n.content;o.uiId=i.id,o.componentId=e.getBtnData().node.id,this.world.connection.send(n)}},ItemDetailMediator}(l.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemPopCardMediator",(function(){return h}));var n,o=i(219),a=i(7),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ItemPopCardMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.world=n,o.layerManager=e,o}return s(ItemPopCardMediator,t),ItemPopCardMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||this.mShow||(this.mView=new o.ItemPopCardPanel(this.scene,this.world),this.mView.show(t),this.mView.on("close",this.onCloseHandler,this),this.layerManager.addToDialogLayer(this.mView))},ItemPopCardMediator.prototype.onCloseHandler=function(){this.mView&&(this.mView.hide(),this.mView=void 0)},ItemPopCardMediator}(a.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"MarketMediator",(function(){return c}));var n,o=i(255),a=i(223),s=i(13),h=i(7),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function MarketMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.world=n,o.layerManager=e,o}return l(MarketMediator,t),MarketMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||this.mShow||(this.mMarket=new a.Market(this.world),this.mMarket.register(),this.mMarket.on("getMarketCategories",this.onCategoriesHandler,this),this.mMarket.on("queryMarket",this.onQueryResuleHandler,this),this.mMarket.on("queryCommodityResource",this.onQueryCommodityResourceHandler,this),this.mView=new o.MarketPanel(this.scene,this.world),this.mView.on("getCategories",this.onGetCategoriesHandler,this),this.mView.on("queryProp",this.onQueryPropHandler,this),this.mView.on("buyItem",this.onBuyItemHandler,this),this.mView.on("close",this.onCloseHandler,this),this.mView.on("popItemCard",this.onPopItemCardHandler,this),this.mView.on("queryPropResource",this.onQueryPropresouceHandler,this),this.mView.show(),this.layerManager.addToUILayer(this.mView))},MarketMediator.prototype.onCategoriesHandler=function(t){this.mView.setCategories(t)},MarketMediator.prototype.onQueryResuleHandler=function(t){this.mView.setProp(t)},MarketMediator.prototype.onGetCategoriesHandler=function(){this.mMarket.getMarkCategories()},MarketMediator.prototype.onQueryPropHandler=function(t,e,i){this.mMarket.queryMarket(t,e,i)},MarketMediator.prototype.onBuyItemHandler=function(t){this.mMarket.buyMarketCommodities([t])},MarketMediator.prototype.onQueryPropresouceHandler=function(t){this.mMarket.queryCommodityResource(t.id,t.category)},MarketMediator.prototype.onPopItemCardHandler=function(t,e){var i={content:{name:"ItemPopCard",prop:t,display:e}};this.world.emitter.emit(s.a.SHOW_UI,i)},MarketMediator.prototype.onQueryCommodityResourceHandler=function(t){this.mView&&this.mView.setCommodityResource(t)},MarketMediator.prototype.onCloseHandler=function(){this.mMarket&&(this.mMarket.destroy(),this.mMarket=void 0,this.mView.hide(),this.mView=void 0)},MarketMediator}(h.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxMediator",(function(){return u}));var n,o=i(225),a=i(19),s=i(3),h=i(4),l=i(7),c=i(18),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function MessageBoxMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mScene=i,o.mLayerManager=e,o.mUIType=c.a.Tips,o}return p(MessageBoxMediator,t),MessageBoxMediator.prototype.isSceneUI=function(){return!1},MessageBoxMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},MessageBoxMediator.prototype.show=function(e){this.mView&&this.isShow()||(this.mView=new o.MessageBoxView(this.mScene,this.world),this.mView.show(e),this.mLayerManager.addToToolTipsLayer(this.mView),this.mScene.input.on("gameobjectdown",this.onBtnHandler,this),t.prototype.show.call(this,e))},MessageBoxMediator.prototype.update=function(e){t.prototype.update.call(this,e)},MessageBoxMediator.prototype.hide=function(){this.mShow=!1,this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),this.mView&&(this.mView.hide(),this.mView=null)},MessageBoxMediator.prototype.destroy=function(){this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),t.prototype.destroy.call(this)},MessageBoxMediator.prototype.onBtnHandler=function(t,e){if(e&&e instanceof a.NinePatchButton){var i=e.getBtnData();if(!i)return;var n=this.mParam[0],o=new h.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),l=o.content;l.uiId=n.id,l.componentId=i.node.id,this.world.connection.send(o)}},MessageBoxMediator}(l.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"MineSettleMediator",(function(){return l}));var n,o=i(227),a=i(226),s=i(7),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function MineSettleMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return h(MineSettleMediator,t),MineSettleMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.MineSettlePanel(this.scene,this.world),this.mView.on("hide",this.onHideMineSettle,this)),this.mineSettle||(this.mineSettle=new a.MineSettle(this.world),this.mineSettle.on("minesettlepacket",this.onMineSettlePacket,this),this.mineSettle.register()),this.layerMgr.addToUILayer(this.mView),this.mParam&&this.mParam.length>0&&this.onMineSettlePacket(this.mParam[0]),this.mView.show())},MineSettleMediator.prototype.isSceneUI=function(){return!0},MineSettleMediator.prototype.destroy=function(){this.mineSettle&&(this.mineSettle.destroy(),this.mineSettle=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},MineSettleMediator.prototype.onHideMineSettle=function(){this.mineSettle.reqMineSettlePacket(),this.destroy()},MineSettleMediator.prototype.onMineSettlePacket=function(t){var e=this.mView;e.setData("settleData",t),e.setMineSettlePacket(t)},MineSettleMediator}(s.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"NpcDialogueMediator",(function(){return l}));var n,o=i(7),a=i(228),s=i(229),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function NpcDialogueMediator(e,i,n){var o=t.call(this)||this;return o.scene=i,o.layerMgr=e,o.world=n,o}return h(NpcDialogueMediator,t),NpcDialogueMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new s.NpcDialoguePanel(this.scene,this.world)),this.npcDialogue||(this.npcDialogue=new a.NpcDialogue(this.world),this.npcDialogue.register()),this.layerMgr.addToUILayer(this.mView),this.mView.show())},NpcDialogueMediator.prototype.isSceneUI=function(){return!0},NpcDialogueMediator.prototype.destroy=function(){this.npcDialogue&&(this.npcDialogue.destroy(),this.npcDialogue=void 0),this.mView&&(this.mView.hide(),this.mView=void 0)},NpcDialogueMediator}(o.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaMessageBoxMediator",(function(){return c}));var n,o=i(230),a=i(3),s=i(4),h=i(7),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicaMessageBoxMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return l(PicaMessageBoxMediator,t),PicaMessageBoxMediator.prototype.show=function(t){this.mParam=t,this.mView&&this.mView.isShow()||this.mShow||(this.mView||(this.mView=new o.PicaMessageBoxPanel(this.scene,this.world),this.mView.on("click",this.onClickHandler,this)),this.mView.show(t),this.layerManager.addToDialogLayer(this.mView))},PicaMessageBoxMediator.prototype.hide=function(){t.prototype.hide.call(this),this.mView&&(this.mView.destroy(),this.mView=void 0)},PicaMessageBoxMediator.prototype.onClickHandler=function(t){var e=this.mParam[0],i=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),n=i.content;n.uiId=e.id,n.componentId=t.node.id,this.world.connection.send(i)},PicaMessageBoxMediator}(h.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaNoticeMediator",(function(){return h}));var n,o=i(7),a=i(231),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function PicaNoticeMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.scene=i,o.world=n,o}return s(PicaNoticeMediator,t),PicaNoticeMediator.prototype.show=function(t){this.mView&&this.mView.isShow()||(this.mView=new a.PicaNoticePanel(this.scene,this.world),this.mView.once("close",this.onCloseHandler,this),this.mView.show(t))},PicaNoticeMediator.prototype.onCloseHandler=function(){this.mView&&(this.mView.destroy(),this.mView=void 0)},PicaNoticeMediator}(o.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"PicaRoomListMediator",(function(){return c}));var n,o=i(256),a=i(232),s=i(8),h=i(7),l=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function PicaRoomListMediator(e,i,n){var o=t.call(this)||this;return o.layerManager=e,o.world=n,o.scene=o.layerManager.scene,o}return l(PicaRoomListMediator,t),PicaRoomListMediator.prototype.show=function(){this.mView&&this.mView.isShow()||this.mShow||(this.roomList=new a.RoomList(this.world),this.roomList.register(),this.roomList.on("myRoomList",this.updateMyRoomListHandler,this),this.roomList.on("roomList",this.updateRoomListHandler,this),this.roomList.on("enterRoomResult",this.onEnterRoomResuleHandler,this),this.mView||(this.mView=new o.PicaRoomListPanel(this.scene,this.world)),this.mView.on("close",this.onCloseHandler,this),this.mView.on("getRoomList",this.onGetRoomListHandler,this),this.mView.on("getMyRoomList",this.onGetMyRoomListHandler,this),this.mView.on("enterRoom",this.onEnterRoomHandler,this),this.mView.show()),this.layerManager.addToUILayer(this.mView)},PicaRoomListMediator.prototype.getView=function(){return this.mView},PicaRoomListMediator.prototype.destroy=function(){this.roomList&&this.roomList.destroy(),this.mView&&(this.mView.destroy(),this.mView=void 0),t.prototype.destroy.call(this)},PicaRoomListMediator.prototype.onCloseHandler=function(){this.destroy()},PicaRoomListMediator.prototype.updateRoomListHandler=function(t){this.mView&&this.mView.updateRoomList(t)},PicaRoomListMediator.prototype.updateMyRoomListHandler=function(t){this.mView&&this.mView.updateMyRoomList(t)},PicaRoomListMediator.prototype.onEnterRoomResuleHandler=function(t){s.a.getInstance().log("enter room result:",t)},PicaRoomListMediator.prototype.onGetRoomListHandler=function(){this.roomList&&this.roomList.sendGetRoomList()},PicaRoomListMediator.prototype.onGetMyRoomListHandler=function(){this.roomList&&this.roomList.sendMyHistory()},PicaRoomListMediator.prototype.onEnterRoomHandler=function(t,e){this.roomList&&this.roomList.sendEnterRoom(t,e)},PicaRoomListMediator}(h.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserMenuMediator",(function(){return u}));var n,o=i(238),a=i(4),s=i(3),h=i(13),l=i(7),c=i(18),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function UserMenuMediator(e,i,n){var o=t.call(this)||this;return o.world=n,o.mLayerManager=e,o.mScene=i,o.mUIType=c.a.Tips,o}return p(UserMenuMediator,t),UserMenuMediator.prototype.getView=function(){return this.mView},UserMenuMediator.prototype.hide=function(){this.mShow=!1,this.world.emitter.off(h.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView&&(this.mView.off("menuClick",this.onClickMenuHandler,this),this.mView.hide(),this.mView=null)},UserMenuMediator.prototype.isSceneUI=function(){return!1},UserMenuMediator.prototype.isShow=function(){return!1},UserMenuMediator.prototype.resize=function(){this.mView&&this.mView.resize()},UserMenuMediator.prototype.show=function(e){this.mView&&this.mView.isShow()||(this.mView=new o.UserMenuPanel(this.mScene,this.world),this.mView.show(e[0]),this.mLayerManager.addToUILayer(this.mView),this.world.emitter.on(h.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView.on("menuClick",this.onClickMenuHandler,this),t.prototype.show.call(this,e))},UserMenuMediator.prototype.update=function(t){this.mView&&this.mView.update(t[0])},UserMenuMediator.prototype.destroy=function(){this.mView&&(this.mView.destroy(),this.mView=null),this.mScene=null},UserMenuMediator.prototype.onClickMenuHandler=function(t){if(this.mView){var e=this.mView.getData("data");if(t&&e&&this.world&&this.world.connection)if(this.hide(),t.platformid)"关注"===t.text?this.world.httpService.follow(t.platformid):"取消关注"===t.text&&this.world.httpService.unfollow(t.platformid);else{var i=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),n=i.content;n.uiId=e.id,n.componentId=t.id,this.world.connection.send(i)}}},UserMenuMediator.prototype.onClosePanel=function(t,e){this.hide()},UserMenuMediator}(l.a)},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"TopMediator",(function(){return p}));var n,o=i(41),a=i(242),s=i(71),h=i(4),l=i(3),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),p=function(t){function TopMediator(e,i){return t.call(this,e,i)||this}return c(TopMediator,t),TopMediator.prototype.preRefreshBtn=function(t){this.refreshMedList||(this.refreshMedList=[]),this.refreshMedList.push(t)},TopMediator.prototype.refreshBtn=function(t,e){var i=this,n=this.mView;switch(t){case s.RankMediator.NAME:e?n.addBtn({key:t,bgResKey:"baseView",bgTextures:["btnGroup_red_normal.png","btnGroup_red_light.png","btnGroup_red_select.png"],iconResKey:"baseView",iconTexture:"btnGroup_rank_icon.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json",callBack:function(){var e=i.world.uiManager.getMediator(t);if(e){var n=e.getParam();e.show(n)}}}):n.removeBtn(t);break;case"EnterDecorate":case"SaveDecorate":e?n.addBtn({key:t,bgResKey:"baseView",bgTextures:["btnGroup_red_normal.png","btnGroup_red_light.png","btnGroup_red_select.png"],iconResKey:"baseView",iconTexture:"btnGroup_rank_icon.png",scale:1,pngUrl:"ui/baseView/mainui_mobile.png",jsonUrl:"ui/baseView/mainui_mobile.json",callBack:function(){i.onEnterDecorate()}}):n.removeBtn(t)}},TopMediator.prototype.tweenView=function(t){this.mView&&this.mView.tweenView(t)},TopMediator.prototype.show=function(e){var i=this;this.mView&&this.isShow()||(this.mView=new a.TopBtnGroup(this.mScene,this.world),this.mView.show(e),t.prototype.show.call(this,e),this.refreshMedList&&this.refreshMedList.forEach((function(t){i.refreshBtn(t,!0)})))},TopMediator.prototype.hide=function(){var t=this;this.mShow=!1,this.refreshMedList&&this.refreshMedList.forEach((function(e){t.refreshBtn(e,!1)})),this.mView&&(this.mView.hide(),this.mView=null)},TopMediator.prototype.addBtn=function(t){this.mView&&this.mView.addBtn(t)},TopMediator.prototype.onEnterDecorate=function(){if(this.world&&this.world.connection){var t=new h.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER);this.world.connection.send(t)}},TopMediator.prototype.onSaveDecorate=function(){if(this.world&&this.world.connection){var t=new h.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_SAVE);this.world.connection.send(t)}},TopMediator.NAME="TopMediator",TopMediator}(o.BaseFaceMediator)},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"InputPanel",(function(){return s}));var n,o=i(97),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function InputPanel(e,i){var n=t.call(this,e)||this,a=i.getSize().width,s=i.getSize().height;return n.mBg.clear(),n.mBg.fillStyle(0,.5),n.mBg.fillRect(0,0,a,s),n.setInteractive(new Phaser.Geom.Rectangle(0,0,a,s),Phaser.Geom.Rectangle.Contains),n.mInputText=i.uiManager.getInputTextFactory().getInputText(e),n.mInputText.on(o.InputTextFieldEvent.textExit,n.hide,n),n.add(n.mBg),n.add(n.mInputText.getSkin()),n}return a(InputPanel,t),Object.defineProperty(InputPanel.prototype,"text",{get:function(){return this.mInputText.getText()},enumerable:!1,configurable:!0}),InputPanel.prototype.hide=function(){this.mInputText&&(this.mInputText.onBlur(),this.mInputText.off(o.InputTextFieldEvent.textExit,this.hide,this),this.mInputText.destroy(),this.mInputText=null),this.mBg&&(this.mBg.destroy(),this.mBg=null),t.prototype.destroy.call(this)},InputPanel}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxUI",(function(){return a})),i.d(e,"MessageBtn",(function(){return s}));var n,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function MessageBoxUI(e,i){var n=t.call(this,e)||this;return n.mScene=e,n.mConfig=i,n.init(),n}return o(MessageBoxUI,t),MessageBoxUI.prototype.selectCall=function(t){this.mtxt.text=t.text,this.mtxt.x=this.mConfig.wid-this.mtxt.width>>1,this.mtxt.y=this.mConfig.hei-this.mtxt.height>>1,this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)},MessageBoxUI.prototype.init=function(){var t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},MessageBoxUI.prototype.onLoadCompleteHandler=function(){var t=this.mConfig.resKey,e=this.mConfig.resBtn;if(this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2,this.mBg.y=this.mConfig.hei/2,this.mBg.setSize(this.mConfig.wid,this.mConfig.hei),this.mBtnList=[],this.mConfig.btnData)for(var i=this.mConfig.btnData.length,n=void 0,o=0;o<i;o++)n=new s(this.mScene,this,t,e,this.mConfig.btnWid,this.mConfig.btnHei),this.mBtnList.push(n);this.mtxt=this.mScene.make.text({x:0,y:0,style:{fill:"#F7EDED",fontSize:18}},!1),this.add(this.mBg),this.add(this.mtxt)},MessageBoxUI}(Phaser.GameObjects.Container),s=function(t){function MessageBtn(e,i,n,o,a,s){var h=t.call(this,e)||this;return h.messageBoxUI=i,h.mBtn=e.make.image(void 0,!1),h.mBtn.setTexture(n,o),h.mText=h.scene.make.text({x:-a>>1,y:-s>>1,style:{fill:"#F7EDED",fontSize:18}},!1),h.add(h.mBtn),h.add(h.mText),h.setSize(a,s),h.setInteractive(),h.on("pointerdown",h.selectHandler,h),h}return o(MessageBtn,t),Object.defineProperty(MessageBtn.prototype,"itemData",{get:function(){return this.mData},set:function(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width/2+(this.width-this.mText.width>>1),this.mText.y=-this.height/2+(this.height-this.mText.height>>1)},enumerable:!1,configurable:!0}),MessageBtn.prototype.destroy=function(){this.mText.destroy(!0),this.mBtn.destroy(!0),this.mData=null,t.prototype.destroy.call(this,!0)},MessageBtn.prototype.selectHandler=function(){this.addTween(this.mBtn),this.messageBoxUI.selectCall(this.itemData)},MessageBtn.prototype.addTween=function(t){this.scene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=t.scaleY=1},MessageBtn}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"TabButton",(function(){return s}));var n,o=i(19),a=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function TabButton(e,i,n,o,a,s,h,l,c,p){var u=t.call(this,e,i,n,o,a,s,h,l,c,p)||this;return u.setInteractive(new Phaser.Geom.Rectangle(0,0,o,a),Phaser.Geom.Rectangle.Contains),u}return a(TabButton,t),TabButton.prototype.onPointerUp=function(){},TabButton}(o.NinePatchButton)},function(t,e,i){"use strict";i.r(e),i.d(e,"LoadingView",(function(){return n}));var n=function(){function LoadingView(t){this.mScene=t,this.mShowing=!1,this.createPanel()}return LoadingView.prototype.setFollow=function(t,e,i){},LoadingView.prototype.isShow=function(){return this.mShowing},LoadingView.prototype.show=function(t){this.mTween=this.mScene.tweens.add({targets:this.mBg,duration:2e6,ease:"Linear",props:{rotation:360}})},LoadingView.prototype.update=function(t){},LoadingView.prototype.hide=function(){this.mTween&&(this.mTween.stop(),this.mTween.remove())},LoadingView.prototype.tweenExpand=function(t){},LoadingView.prototype.resize=function(){},LoadingView.prototype.destroy=function(){this.mBg&&this.mBg.destroy()},LoadingView.prototype.createPanel=function(){var t=this.mScene.game.scale.gameSize;this.mBg=this.mScene.add.sprite(t.width>>1,t.height>>1,"stars"),this.mBg.scaleX=this.mBg.scaleY=1.3},LoadingView}()},function(t,e){},function(t,e,i){"use strict";var n={add(t){return Array.isArray(t)?this.addMultiple(t):this._add(t),this},addMultiple(t){return t.forEach(this._add,this),this},_add(t){return this.children.add(t),this.resetChildState(t).updateChildVisible(t).updateChildActive(t).updateChildScrollFactor(t).updateChildMask(t),this}},o={remove(t,e){return this.children.remove(t,!1,e),this},clear(t){return this.children.clear(!1,t),this}},a={getLocalState:t=>(t.hasOwnProperty("rexContainer")||(t.rexContainer={}),t.rexContainer),resetChildState(t){return this.resetChildPositionState(t).resetChildVisibleState(t).resetChildAlphaState(t).resetChildActiveState(t),this},resetChildrenState(t){for(var e=0,i=t.length;e<i;e++)this.resetChildState(t[e]);return this},syncProperties(){return this.syncPosition().syncVisible().syncAlpha().syncActive().syncScrollFactor().syncMask(),this}};const s=Phaser.Math.RotateAround;var h={worldToLocal(t){return t.x-=this.x,t.y-=this.y,s(t,0,0,-this.rotation),t.x/=this.scaleX,t.y/=this.scaleY,t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t},localToWorld(t){return t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t.x*=this.scaleX,t.y*=this.scaleY,s(t,0,0,this.rotation),t.x+=this.x,t.y+=this.y,t}},containerlite_Scale=function(t,e){return t===e?1:t/e},l={updateChildPosition(t){t.isRexContainerLite&&(t.syncChildrenEnable=!1);var e=this.getLocalState(t);return t.x=e.x,t.y=e.y,this.localToWorld(t),t.scaleX=e.scaleX*this.scaleX,t.scaleY=e.scaleY*this.scaleY,void 0!==t.flipX&&(t.flipX=this.flipX?!e.flipX:e.flipX,t.flipY=this.flipY?!e.flipY:e.flipY),t.rotation=e.rotation+this.rotation,t.isRexContainerLite&&(t.syncChildrenEnable=!0,t.syncPosition()),this},syncPosition(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildPosition,this),this},resetChildPositionState(t){var e=this.getLocalState(t);return e.x=t.x,e.y=t.y,this.worldToLocal(e),e.scaleX=containerlite_Scale(t.scaleX,this.scaleX),e.scaleY=containerlite_Scale(t.scaleY,this.scaleY),void 0!==t.flipX&&(e.flipX=t.flipX,e.flipY=t.flipY),e.rotation=t.rotation-this.rotation,this},setChildPosition(t,e,i){return t.x=e,t.y=i,this.resetChildPositionState(t),this},setChildLocalPosition(t,e,i){var n=this.getLocalState(t);return n.x=e,n.y=i,this.updateChildPosition(t),this}},c={updateChildVisible(t){return t.visible=this.visible&&this.getLocalState(t).visible,this},syncVisible(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildVisible,this),this},resetChildVisibleState(t){return this.getLocalState(t).visible=t.visible,this},setChildVisible(t,e){return t.visible=e,this.resetChildVisibleState(t),this},setChildLocalVisible(t,e){return void 0===e&&(e=!0),this.getLocalState(t).visible=e,this.updateChildVisible(t),this}},p={updateChildAlpha(t){return t.alpha=this.alpha*this.getLocalState(t).alpha,this},syncAlpha(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildAlpha,this),this},resetChildAlphaState(t){return this.getLocalState(t).alpha=containerlite_Scale(t.alpha,this.alpha),this},setChildAlpha(t,e){return t.alpha=e,this.resetChildAlphaState(t),this._add},setChildLocalAlpha(t,e){return this.getLocalState(t).alpha=e,this.updateChildAlpha(t),this}},u={updateChildActive(t){return t.active=this.active&&this.getLocalState(t).active,this},syncActive(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildActive,this),this},resetChildActiveState(t){return this.getLocalState(t).active=t.active,this},setChildActive(t,e){return t.active=e,this.resetChildActiveState(t),this},setChildLocalActive(t,e){return void 0===e&&(e=!0),this.getLocalState(t).active=e,this.updateChildActive(t),this}},m={updateChildScrollFactor(t){return t.setScrollFactor(this.scrollFactorX,this.scrollFactorY),this},syncScrollFactor(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildScrollFactor,this),this}},d={updateChildMask(t){return null==this.mask||(this.mask.hasOwnProperty("geometryMask")?this.mask.geometryMask:this.mask.bitmapMask)!==t&&(t.mask=this.mask),this},syncMask(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildMask,this),this},setMask(t){return this.mask=t,this},clearMask(t){return void 0===t&&(t=!1),t&&this.mask&&this.mask.destroy(),this.mask=null,this}},f={setDepth(t){if(this.depth=t,this.children)for(var e=this.getAllChildren(),i=0,n=e.length;i<n;i++)e[i].depth=t;return this},swapDepth(t){var e=this.depth,i=t.depth;return this.setDepth(i),t.setDepth(e),this},incDepth(t){if(this.depth+=t,this.children)for(var e=this.getAllChildren(),i=0,n=e.length;i<n;i++)e[i].depth+=t;return this}};const y=Phaser.Utils.Array;var g={getChildren(){return this.children.getChildren()},getAllChildren(t){void 0===t&&(t=[]);for(var e,i=this.children.getChildren(),n=0,o=i.length;n<o;n++)e=i[n],t.push(e),e.hasOwnProperty("isRexContainerLite")&&t.push(...e.getAllChildren());return t},contains(t){if(this.children.contains(t))return!0;for(var e,i=this.children.getChildren(),n=0,o=i.length;n<o;n++)if((e=i[n]).isRexContainerLite&&e.contains(t))return!0;return!1},getByName(t){return y.GetFirst(this.list,"name",t)},getRandom(t,e){return y.GetRandom(this.list,t,e)},getFirst(t,e,i,n){return y.GetFirstElement(this.list,t,e,i,n)},getAll(t,e,i,n){return y.GetAll(this.list,t,e,i,n)},count(t,e,i,n){return y.CountAllMatching(this.list,t,e,i,n)},swap(t,e){return y.Swap(this.list,t,e),this},moveTo(t,e){return y.MoveTo(this.list,t,e),this},setAll(t,e,i,n){return y.SetAll(this.list,t,e,i,n),this}};const _=Phaser.GameObjects.Zone,v=Phaser.GameObjects.Components;class ContainerLite extends _{constructor(t,e,i,n,o,a){Array.isArray(n)&&(a=n,n=void 0),void 0===n&&(n=1),void 0===o&&(o=1),super(t,e,i,n,o),this.children=t.add.group(),this.type="rexContainerLite",this.isRexContainerLite=!0,this.syncChildrenEnable=!0,this._flipX=!1,this._flipY=!1,this._alpha=1,this._active=!0,this._mask=null,this._scrollFactorX=1,this._scrollFactorY=1,a&&this.add(a)}destroy(t){this.scene&&(this.children.destroy(!t),this.children=void 0,super.destroy(t))}resize(t,e){return this.setSize(t,e),this}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.syncPosition())}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.syncPosition())}get rotation(){return super.rotation}set rotation(t){this.rotation!==t&&(super.rotation=t,this.syncPosition())}get scaleX(){return super.scaleX}set scaleX(t){this.scaleX!==t&&(super.scaleX=t,this.syncPosition())}get scaleY(){return super.scaleY}set scaleY(t){this.scaleY!==t&&(super.scaleY=t,this.syncPosition())}get flipX(){return this._flipX}set flipX(t){this._flipX!==t&&(this._flipX=t,this.syncPosition())}get flipY(){return this._flipY}set flipY(t){this._flipY!==t&&(this._flipY=t,this.syncPosition())}get visible(){return super.visible}set visible(t){this.visible!==t&&(super.visible=t,this.syncVisible())}get alpha(){return this._alpha}set alpha(t){this._alpha!==t&&(this._alpha=t,this.syncAlpha())}get active(){return this._active}set active(t){this._active!==t&&(this._active=t,this.syncActive())}get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t,this.syncMask())}get scrollFactorX(){return this._scrollFactorX}set scrollFactorX(t){this._scrollFactorX!==t&&(this._scrollFactorX=t,this.syncScrollFactor())}get scrollFactorY(){return this._scrollFactorY}set scrollFactorY(t){this._scrollFactorY!==t&&(this._scrollFactorY=t,this.syncScrollFactor())}get list(){return this.children.getChildren()}}Object.assign(ContainerLite.prototype,n,o,a,h,l,c,p,m,u,d,f,g,v.Alpha,v.Flip);e.a=ContainerLite},function(t,e,i){"use strict";var n=i(419),o=i.n(n),a=i(420),s=i.n(a),h=i(51),l=(h.a,h.a,{renderWebGL:o.a,renderCanvas:s.a}),c=i(258),p={draw(t,e,i,n){var o=this.penManager;this.hitAreaManager.clear();var a=this.context;a.save(),this.drawBackground(this.defatultStyle.backgroundColor);var s=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var h,l,c,p,u,m,d=s.halign,f=s.valign,y=s.lineHeight,g=o.lines,_=g.length,v=s.maxLines;v>0&&_>v?(l=v,c="center"===f?Math.floor((_-l)/2):"bottom"===f?_-l:0):(l=_,c=0),p=c+l,m="center"===f?Math.max((n-l*y)/2,0):"bottom"===f?Math.max(n-l*y-2,0):0,m+=e;for(var b=c;b<p;b++)if(0!==(h=o.getLineWidth(b))){u="center"===d?(i-h)/2:"right"===d?i-h:0,u+=t;for(var P=g[b],S=0,w=P.length;S<w;S++)this.drawPen(P[S],u,m)}a.restore()},drawPen(t,e,i){e+=t.x,i+=t.y;var n=this.canvas,o=this.context;o.save();var a=this.parser.propToContextStyle(this.defatultStyle,t.prop);a.buildFont(),a.syncFont(n,o),a.syncStyle(n,o),a.underlineThickness>0&&t.width>0&&this.drawUnderline(e,i,t.width,a),t.isTextPen&&this.drawText(e,i,t.text,a),t.isImagePen&&this.drawImage(e,i,t.prop.img,a),o.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,i-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,i,n){e+=n.underlineOffset-n.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var o=this.context,a=o.lineCap;o.lineCap="butt",o.beginPath(),o.strokeStyle=n.underlineColor,o.lineWidth=n.underlineThickness,o.moveTo(t,e),o.lineTo(t+i,e),o.stroke(),o.lineCap=a},drawText(t,e,i,n){this.autoRound&&(t=Math.round(t),e=Math.round(e));var o=this.context;n.strokeThickness&&(n.syncShadow(o,n.shadowStroke),o.strokeText(i,t,e)),n.color&&"none"!==n.color&&(n.syncShadow(o,n.shadowFill),o.fillText(i,t,e))},drawImage(t,e,i,n){var o=this.parent.imageManager,a=o.get(i),s=o.getFrame(i);t+=a.left,e+=-this.startYOffset+a.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(s.source.image,s.cutX,s.cutY,s.cutWidth,s.cutHeight,t,e,a.width,a.height)}},u=i(73),m=i(53);const d=Phaser.Utils.Objects.GetValue,f=m.a.NO_NEWLINE,y=m.a.RAW_NEWLINE;var g=class Pen{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=d(t,"text",""),this.x=d(t,"x",0),this.y=d(t,"y",0),this.width=d(t,"width",0);var e=d(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=d(t,"newLineMode",0),this.startIndex=d(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===y&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==f&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===y&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},_=i(144);const v=Phaser.Utils.Objects.GetFastValue,b=m.a.NO_NEWLINE,P=m.a.WRAPPED_NEWLINE;var S=new u.a,w=new u.a;class PenManager_PenManager{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=v(t,"pensPool",S),this.LinesPool=v(t,"linesPool",w),this.tagToText=v(t,"tagToText",h.a),this.tagToTextScope=v(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,n,o,a){var s=this.PensPool.pop();return null==s&&(s=new g),T.text=t,T.x=e,T.y=i,T.width=n,T.prop=o,T.newLineMode=a,s.resetFromJSON(T),this.addPen(s),this}addImagePen(t,e,i,n){return this.addTextPen("",t,e,i,n,b),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,n=t?Object(_.a)(t.prop):null;return this.addTextPen("",e,i,0,n,P),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(t),t.newLineMode!==b&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new PenManager_PenManager),t.freePens();for(var e=0,i=this.lines.length;e<i;e++)for(var n=this.lines[e],o=0,a=n.length;o<a;o++){var s=n[o];t.addPen(s.text,s.x,s.y,s.width,Object(_.a)(s.prop),s.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,n=!1;for(e=t;e>=0&&!(n=null!=(i=this.lines[e])&&i.length>0);e--);return n?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,n=this.lines.length;i<n;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,n=e.length;i<n;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,n=this.pens.length;i<n;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){if(void 0===t&&(t=0),void 0===e){var n=this.lastPen;if(null==n)return"";e=n.endIndex}void 0===i&&(i=!1);for(var o,a,s,h,l,c,p="",u=0,m=this.pens.length;u<m&&((h=(o=this.pens[u]).endIndex)<=t||(o=this.pens[u],a=i?o.wrapText:o.plainText,l=o.prop,(s=o.startIndex)>=t&&h<=e||(a=a.substring(t-s,e-s)),this.tagToTextScope?p+=this.tagToText.call(this.tagToTextScope,a,l,c):p+=this.tagToText(a,l,c),c=l,!(h>=e)));u++);return p}}var T={},C=PenManager_PenManager;const D=Phaser.Geom.Rectangle;var M=new u.a;var O=class HitAreaManager{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return M.pushMultiple(this.hitAreas),this}add(t,e,i,n,o){var a=M.pop();return null===a?a=new D(e,i,n,o):a.setTo(e,i,n,o),a.key=t,this.hitAreas.push(a),this}contains(t,e){for(var i,n=this.hitAreas,o=0,a=n.length;o<a;o++)if((i=n[o]).contains(t,e))return i.key;return!1}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var n,o=this.hitAreas,a=0,s=o.length;a<s;a++)n=o[a],t.lineStyle(1,e).strokeRect(n.x,n.y,n.width,n.height);return i&&t.restore(),this}},FireEvent=function(t,e,i,n){var o=this.hitAreaManager.contains(i,n);!1!==o&&(this.parent.emit(`${t}-${o}`,e,i,n),this.parent.emit(t,o,e,i,n))},canvastext_SetInteractive=function(){this.parent.on("pointerdown",(function(t,e,i,n){FireEvent.call(this,"areadown",t,e,i)}),this).on("pointerup",(function(t,e,i,n){FireEvent.call(this,"areaup",t,e,i)}),this)};const x=m.a.NO_NEWLINE,E=m.a.RAW_NEWLINE,B=m.a.WRAPPED_NEWLINE,I=m.a.NO_WRAP,A=m.a.WORD_WRAP,R=(m.a.CHAR_WRAP,m.a.SPLITREGEXP);var k=[],L=new u.a;L.newline=function(t,e,i){var n=this.pop();return null===n&&(n={}),n.text=t,n.width=e,n.newLineMode=i,n};var canvastext_WrapText=function(t,e,i,n,o){n<=0&&(i=I);var a=k;if(L.pushMultiple(a),!t||!t.length)return a;for(var s,h,l,c=t.split(R),p=0,u=c.length;p<u;p++)if(s=c[p],l=p===u-1?x:E,i!==I){var m,d;if(h=0===p?n-o:n,s.length<=100)if((P=e(s))<=h){a.push(L.newline(s,P,l));continue}for(var f,y="",g="",_=0,v=0,b=(m=i===A?s.split(" "):s).length;v<b;v++)d=m[v],i===A?(y+=d,v<b-1&&(y+=" ")):y+=d,(f=e(y))>h&&(0===v?a.push(L.newline("",0,B)):(a.push(L.newline(g,_,B)),y=d,i===A&&v<b-1&&(y+=" "),f=e(y)),h=n),g=y,_=f;a.push(L.newline(g,_,l))}else{var P=e(s);a.push(L.newline(s,P,l))}return a};const F=Phaser.Utils.Objects.GetValue,N=m.a.NO_WRAP,j=m.a.NO_NEWLINE;class CanvasText_CanvasText{constructor(t){this.parent=t.parent,this.context=F(t,"context",null),this.canvas=this.context.canvas,this.parser=F(t,"parser",null),this.defatultStyle=F(t,"style",null),this.autoRound=!0,this.pensPool=F(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new O;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,i,n,o){if(void 0===o&&(o=this.penManager),o.freePens(),""===t)return o;for(var a,s,h,l,c,p=this.canvas,u=this.context,m=0,d=0,f=this.parser.splitText(t),y=0,g=f.length;y<g;y++)if(a=(l=this.parser.tagTextToProp(f[y],s)).plainText,(s=l.prop).img){var v=this.imageManager.getOuterWidth(s.img);i>0&&e!==N&&i<m+v&&(o.addNewLinePen(),d+=n,m=0),o.addImagePen(m,d,v,Object(_.a)(s)),m+=v}else if(""!==a){var b;this.context.save(),(h=this.parser.propToContextStyle(this.defatultStyle,s)).buildFont(),h.syncFont(p,u),h.syncStyle(p,u);for(var P=0,S=(c=canvastext_WrapText(a,this.getTextWidth,e,i,m)).length;P<S;P++)b=c[P],o.addTextPen(b.text,m,d,b.width,Object(_.a)(s),b.newLineMode),b.newLineMode!==j?(m=0,d+=n):m+=b.width;this.context.restore()}return o}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new C({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var n;if(null==t)n=this.penManager.plainText;else{var o=this.parser.splitText(t,1);n="";for(var a=0,s=o.length;a<s;a++)n+=o[a]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=n.length),n=n.substring(e,i)),n}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,n){if(null==t)return this.penManager.getSliceTagText(e,i,n);var o=this.tmpPenManager,a=this.defatultStyle;return this.updatePenManager(t,a.wrapMode,a.wrapWidth,a.lineHeight,o),o.getSliceTagText(e,i,n)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var H={setInteractive:canvastext_SetInteractive};Object.assign(CanvasText_CanvasText.prototype,p,H);var U=CanvasText_CanvasText;const G=Phaser.Utils.Objects.GetValue;var V,W=class ImageManager{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var i=0,n=(o=t).length;i<n;i++)this._add(o[i]);else{var o=t;for(var t in o)this._add(t,o[t])}return this}_add(t,e){void 0===e&&(e={key:t});var i=e.key,n=e.frame,o=e.width,a=e.height;if(void 0===o||void 0===a){var s=this.textureManager.getFrame(i,n),h=s?s.cutWidth:0,l=s?s.cutHeight:0;void 0===o&&void 0===a?(o=h,a=l):void 0===o?o=h*(a/l):void 0===a&&(a=l*(o/h))}this.images[t]={key:i,frame:n,width:o,height:a,y:G(e,"y",0),left:G(e,"left",0),right:G(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}};const z=Phaser.DOM.AddToDOM,Y=Phaser.Display.Canvas.CanvasPool,X=Phaser.GameObjects.GameObject,K=Phaser.Utils.Objects.GetValue,q=Phaser.DOM.RemoveFromDOM,Q=m.a.SPLITREGEXP;var J={};class Text_Text extends X{constructor(t,e,i,n,o,a,s){if(void 0===e&&(e=0),void 0===i&&(i=0),super(t,a),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=Y.create(this),this.context=this.canvas.getContext("2d"),o&&o.hasOwnProperty("align")){var h=o.align;delete o.align,o.halign=h}this.style=new c.a(this,o),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),J.hasOwnProperty(a)||(J[a]=new u.a),this.canvasText=new U({parent:this,context:this.context,parser:s,style:this.style,pensPool:J[a]}),o&&o.padding&&this.setPadding(o.padding),this.setText(n),t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",z(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t){return this.style.setBackgroundColor(t)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,i,n,o,a){return this.style.setShadow(t,e,i,n,o,a)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setLineSpacing(t){return this.style.setLineSpacing(t)}setPadding(t,e,i,n){if("object"==typeof t){var o=t,a=K(o,"x",null);null!==a?(t=a,i=a):(t=K(o,"left",0),i=K(o,"right",t));var s=K(o,"y",null);null!==s?(e=s,n=s):(e=K(o,"top",0),n=K(o,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===n&&(n=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=n,this.updateText(!1)}setResolution(t){return this.style.setResolution(t)}setMaxLines(t){return this.style.setMaxLines(t)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var n,o,a=this.padding;0===i.fixedWidth?(this.width=e.linesWidth+a.left+a.right,n=e.linesWidth):(this.width=i.fixedWidth,(n=this.width-a.left-a.right)<e.linesWidth&&(n=e.linesWidth)),0===i.fixedHeight?(this.height=e.linesHeight+a.top+a.bottom,o=e.linesHeight):(this.height=i.fixedHeight,(o=this.height-a.top-a.bottom)<e.linesHeight&&(o=e.linesHeight));var s=this.width,h=this.height;this.updateDisplayOrigin();var l=i.resolution;s*=l,h*=l,s=Math.max(Math.ceil(s),1),h=Math.max(Math.ceil(h),1);var c=this.canvas,p=this.context;c.width!==s||c.height!==h?(c.width=s,c.height=h,this.frame.setSize(s,h)):p.clearRect(0,0,s,h),p.save(),p.scale(l,l),e.draw(a.left,a.top,n,o),p.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(c,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var t=Z.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}preDestroy(){this.style.rtl&&q(this.canvas),Y.remove(this.canvas),this.canvasText.destroy()}setInteractive(t,e,i){return X.prototype.setInteractive.call(this,t,e,i),this.canvasText.setInteractive(),this}getWrappedText(t,e,i){return(t=this.canvasText.getText(t,e,i,!0)).split(Q)}getPlainText(t,e,i){return this.canvasText.getPlainText(t,e,i)}getText(t,e,i){return this.canvasText.getText(t,e,i,!1)}getSubString(t,e,i){return this.getText(t,e,i)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}set lineSpacing(t){this.setLineSpacing(t)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return t=this.scene.textures,void 0===V&&(V=new W(t)),V;var t}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}const Z=Phaser.GameObjects.Components;Phaser.Class.mixin(Text_Text,[Z.Alpha,Z.BlendMode,Z.ComputedSize,Z.Crop,Z.Depth,Z.Flip,Z.GetBounds,Z.Mask,Z.Origin,Z.Pipeline,Z.ScrollFactor,Z.Tint,Z.Transform,Z.Visible,l]);e.a=Text_Text},function(t,e,i){"use strict";const n=Phaser.Renderer.WebGL.Utils;var render_WebGLRenderer=function(t,e,i,o,a){if(e.dirty&&(e.updateTexture(),e.dirty=!1),0!==e.width&&0!==e.height){var s=e.frame,h=s.width,l=s.height,c=n.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,s.glTexture,h,l,e.x,e.y,h/e.resolution,l/e.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,h,l,c(e._tintTL,o.alpha*e._alphaTL),c(e._tintTR,o.alpha*e._alphaTR),c(e._tintBL,o.alpha*e._alphaBL),c(e._tintBR,o.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,o,a)}},render_CanvasRenderer=function(t,e,i,n,o){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,n,o)},o=i(51),a=(o.a,o.a,{renderWebGL:render_WebGLRenderer,renderCanvas:render_CanvasRenderer});const s=Phaser.Display.Color;var h={clear(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this},fill(t){return this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this},getPixel(t,e,i){void 0===i&&(i=new s);var n=this.context.getImageData(t,e,1,1);return i.setTo(n.data[0],n.data[1],n.data[2],n.data[3]),i},setPixel(t,e,i,n,o,a){if("number"!=typeof i){var s=i;i=s.red,n=s.green,o=s.blue,a=s.alpha}void 0===a&&(a=0!==i||0!==n||0!==o?255:0);var h=this.context.createImageData(1,1);return h.data[0]=i,h.data[1]=n,h.data[2]=o,h.data[3]=a,this.context.putImageData(h,t,e),this.dirty=!0,this}},l={updateTexture(t,e){t&&(e?t.call(e,this.canvas,this.context):t(this.canvas,this.context)),this.canvas.width===this.frame.width&&this.canvas.height===this.frame.height||this.frame.setSize(this.canvas.width,this.canvas.height),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(this.canvas,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!1;var i=this.input;return i&&!i.customHitArea&&(i.hitArea.width=this.width,i.hitArea.height=this.height),this},generateTexture(t,e,i,n,o){var a,s=this.canvas,h=this.scene.sys,l=h.game.renderer;void 0===e&&(e=0),void 0===i&&(i=0),void 0===n?n=s.width:n*=this.resolution,void 0===o?o=s.height:o*=this.resolution;var c=(a=h.textures.exists(t)?h.textures.get(t):h.textures.createCanvas(t,n,o)).getSourceImage();c.width!==n&&(c.width=n),c.height!==o&&(c.height=o);var p=c.getContext("2d");return p.clearRect(0,0,n,o),p.drawImage(s,e,i,n,o),l.gl&&a&&l.canvasToTexture(c,a.source[0].glTexture,!0,0),this},loadTexture(t,e){var i=this.scene.textures.getFrame(t,e);return i?(this.width!==i.cutWidth||this.height!==i.cutHeight?this.resize(i.cutWidth,i.cutHeight):this.context.clearRect(0,0,i.cutWidth,i.cutHeight),this.context.drawImage(i.source.image,i.cutX,i.cutY,i.cutWidth,i.cutHeight,0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this):this}};const c=Phaser.Display.Canvas.CanvasPool,p=Phaser.GameObjects.GameObject;class Canvas extends p{constructor(t,e,i,n,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===o&&(o=1),super(t,"rexCanvas"),this.renderer=t.sys.game.renderer,this.resolution=t.sys.game.config.resolution,this.canvas=c.create(this,this.resolution*n,this.resolution*o),this.context=this.canvas.getContext("2d"),this.dirty=!1,this.setPosition(e,i),this.setSize(n,o),this.setOrigin(.5,.5),this.initPipeline(),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),this.dirty=!0,t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}getCanvas(t){return t||(this.dirty=!0),this.canvas}needRedraw(){return this.dirty=!0,this}preDestroy(){c.remove(this.canvas)}resize(t,e){return this.width===t&&this.height===e||(this.setSize(t,e).updateDisplayOrigin(),t*=this.resolution,e*=this.resolution,t=Math.max(Math.ceil(t),1),e=Math.max(Math.ceil(e),1),this.canvas.width=t,this.canvas.height=e,this.dirty=!0),this}}const u=Phaser.GameObjects.Components;Phaser.Class.mixin(Canvas,[u.Alpha,u.BlendMode,u.ComputedSize,u.Crop,u.Depth,u.Flip,u.GetBounds,u.Mask,u.Origin,u.Pipeline,u.ScrollFactor,u.Tint,u.Transform,u.Visible,a,h,l]);e.a=Canvas},function(t,e,i){"use strict";i.d(e,"a",(function(){return A}));var n,o=i(331),a=i(252),s=i(251),h=i(47),l=i(3),c=i(14),p=i(4),u=i(58),m=i(112),d=i(8),f=i(59),y=i(128),g=i(77),_=i(28),v=i(22),b=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),P=l.op_def.NodeType,S=function(t){function DecorateElementManager(e){return t.call(this,e)||this}return b(DecorateElementManager,t),DecorateElementManager.prototype.addMap=function(t){var e=t.displayInfo;if(e&&(!this.mRoom.selectedSprite||this.mRoom.selectedSprite.id!==t.id)){var i=t.currentAnimation,n=i.animationName,o=i.flip,a=e.getCollisionArea(n,o),s=e.getWalkableArea(n,o),h=e.getOriginPoint(n,o),l=a.length,c=a[0].length,p=this.mRoom.transformToMini45(t.pos);if(!s){s=new Array(l);for(var u=0;u<l;u++)s[u]=new Array(c).fill(0)}var m=0,d=0;for(u=0;u<l;u++){m=p.y+u-h.x;for(var f=0;f<c;f++)1===a[u][f]&&(u>=s.length||f>=s[u].length||0===s[u][f])&&(d=p.x+f-h.y,m>=0&&m<this.mMap.length&&d>=0&&d<this.mMap[m].length&&(this.mMap[m][d]=0))}}},DecorateElementManager.prototype.removeMap=function(t){var e=t.displayInfo;if(e)for(var i=t.currentAnimation,n=i.animationName,o=i.flip,a=e.getCollisionArea(n,o),s=e.getOriginPoint(n,o),h=a.length,l=a[0].length,c=this.mRoom.transformToMini45(t.pos),p=0,u=0,m=0;m<h;m++){p=c.y+m-s.x;for(var d=0;d<l;d++)u=c.x+d-s.y,1===a[m][d]&&p>=0&&p<this.mMap.length&&u>=0&&u<this.mMap[p].length&&(this.mMap[c.y+m-s.x][c.x+d-s.y]=-1)}},DecorateElementManager.prototype._add=function(t,e){void 0===e&&(e=!0);var i=this.mElements.get(t.id);return i?i.model=t:(i=new v.b(t,this)).setInputEnable(v.c.Enable),e&&this.addMap(t),this.mElements.set(i.id||0,i),i},DecorateElementManager.prototype.onSync=function(t){var e=t.content;if(e.nodeType===P.ElementNodeType)for(var i=null,n=0,o=e.sprites;n<o.length;n++){var a=o[n];if(i=this.get(a.id)){var s=new _.a(a,e.nodeType);i.model=s,this.addMap(s)}}},Object.defineProperty(DecorateElementManager.prototype,"map",{get:function(){return this.mMap},enumerable:!1,configurable:!0}),DecorateElementManager}(g.a),w=i(13),T=i(127),C=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),D=function(t){function DecorateTerrainManager(e){var i=t.call(this,e)||this,n=e.miniSize;i.mMap=new Array(n.cols);for(var o=0;o<n.rows;o++)i.mMap[o]=new Array(n.rows).fill(0);return i}return C(DecorateTerrainManager,t),DecorateTerrainManager.prototype.remove=function(e){var i=t.prototype.remove.call(this,e);return i&&this.removeMap(i.model),i},DecorateTerrainManager.prototype._add=function(e){var i=t.prototype._add.call(this,e);return e.displayInfo&&this.addMap(e),i},DecorateTerrainManager.prototype.onSyncSprite=function(t){var e=t.content;if(e.nodeType===l.op_def.NodeType.TerrainNodeType)for(var i=null,n=0,o=e.sprites;n<o.length;n++){var a=o[n];if(i=this.get(a.id)){var s=new _.a(a,e.nodeType);i.model=s,s.displayInfo&&this.addMap(s)}}},DecorateTerrainManager.prototype.addMap=function(t){this.setMap(t,1)},DecorateTerrainManager.prototype.removeMap=function(t){this.setMap(t,0)},DecorateTerrainManager.prototype.setMap=function(t,e){var i=t.displayInfo;if(i){var n=t.currentAnimation,o=n.animationName,a=n.flip,s=i.getCollisionArea(o,a),h=i.getWalkableArea(o,a),l=i.getOriginPoint(o,a),c=s.length,p=s[0].length,u=!0;1===c&&1===p&&(c=2,p=2,u=!1);for(var m=t.pos,d=0,f=0,y=0;y<c;y++){d=m.x+y-l.x;for(var g=0;g<p;g++)if(!u||1===s[y][g]&&1===h[y][g]){if(f=m.y+g-l.y,d>=this.mMap.length||f>=this.mMap[d].length)continue;this.mMap[m.x+y-l.x][m.y+g-l.y]=e}}}},DecorateTerrainManager}(T.a),M=i(80),O=i(124),x=function(){function SpawnPoint(){this.id=100,this.nodeType=l.op_def.NodeType.SpawnPointType,this.pos=new c.a,this.displayInfo=new M.a({id:0,animations:{defaultAnimationName:"idle",display:this.display,animationData:[new O.a(this.animation)]}}),this.currentAnimation={animationName:"idle",flip:!1},this.direction=3,this.nickname="出生点",this.alpha=1}return SpawnPoint.prototype.newID=function(){throw new Error("Method not implemented.")},SpawnPoint.prototype.setPosition=function(t,e){this.pos.x=t,this.pos.y=e},SpawnPoint.prototype.turn=function(){throw new Error("Method not implemented.")},SpawnPoint.prototype.toSprite=function(){throw new Error("Method not implemented.")},SpawnPoint.prototype.updateAvatar=function(t){throw new Error("Method not implemented.")},SpawnPoint.prototype.updateDisplay=function(t,e,i){throw new Error("Method not implemented.")},SpawnPoint.prototype.setAnimationName=function(){throw new Error("Method not implemented.")},SpawnPoint.prototype.setAnimationQueue=function(){throw new Error("Method not implemented.")},Object.defineProperty(SpawnPoint.prototype,"display",{get:function(){var t=l.op_gameconfig.Display.create();return t.texturePath="pixelpai/SpawnPointNode/5cc42f6417553727db1d2bba/1/5cc42f6417553727db1d2bba.png",t.dataPath="pixelpai/SpawnPointNode/5cc42f6417553727db1d2bba/1/5cc42f6417553727db1d2bba.json",t},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"animation",{get:function(){var t=l.op_gameconfig_01.AnimationData.create();return t.frameRate=5,t.collisionArea="1,1&1,1",t.loop=!0,t.baseLoc="-30,-30",t.originPoint=[0,0],t.frameName=["switch_0027_3_01.png"],t},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"currentCollisionArea",{get:function(){return[[1,1],[1,1]]},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"currentWalkableArea",{get:function(){return[[0]]},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"currentCollisionPoint",{get:function(){return new Phaser.Geom.Point(0,0)},enumerable:!1,configurable:!0}),Object.defineProperty(SpawnPoint.prototype,"hasInteractive",{get:function(){return!1},enumerable:!1,configurable:!0}),SpawnPoint}(),E=i(129),B=function(){function SelectorElement(t){this.mElement=t,this.mScene=this.mElement.scene,this.mRoomService=this.mElement.roomService,this.mDecorateManager=new E.DecorateManager(this.mScene,this.mRoomService),this.mDecorateManager.setElement(t);var e=t.getDisplay();e.collisionArea?e.showRefernceArea():e.once("initialized",(function(){e.showRefernceArea()})),this.mSelecting=!0,this.mDecorateManager.on("moveElement",this.onMoveElementHandler,this),this.mRoomService.world.emitter.emit(w.a.EDIT_PACKAGE_COLLAPSE),this.mRoomService.world.emitter.emit(w.a.SELECTED_DECORATE_ELEMENT)}return SelectorElement.prototype.turnElement=function(){this.mElement&&(this.mElement.turn(),this.checkCanPut())},SelectorElement.prototype.setDisplayPos=function(t){this.mElement&&(this.mElement.setPosition(t),this.checkCanPut())},SelectorElement.prototype.update=function(t,e){if(this.mElement){var i=this.mElement.getPosition();this.mDecorateManager.updatePos(i.x,i.y),this.checkCanPut()}},SelectorElement.prototype.clone=function(){if(this.mElement){var t=this.mElement.model,e=t.pos;this.mSourceData={x:e.x,y:e.y,z:e.z,direction:t.direction}}},SelectorElement.prototype.recover=function(){this.mElement&&this.mSourceData&&(this.mElement.setAlpha(1),this.mElement.setPosition(new c.a(this.mSourceData.x,this.mSourceData.y)),this.mElement.setDirection(this.mSourceData.direction))},SelectorElement.prototype.destroy=function(){if(this.mDecorateManager&&this.mDecorateManager.destroy(),this.mElement){var t=this.mElement.getDisplay();t&&t.hideRefernceArea()}this.mSourceData=void 0,this.mRoomService.world.emitter.emit(w.a.EDIT_PACKAGE_EXPANED),this.mRoomService.world.emitter.emit(w.a.CANCEL_DECORATE_ELEMENT)},SelectorElement.prototype.checkCanPut=function(){if(this.mRoomService&&this.mElement){var t=this.mElement.model,e=this.mRoomService.canPut(this.mElement.getPosition(),t.currentCollisionArea,t.currentCollisionPoint);e?this.element.setAlpha(1):this.element.setAlpha(.6),this.mDecorateManager&&this.mDecorateManager.canPut(e)}},SelectorElement.prototype.onMoveElementHandler=function(t){t&&this.setDisplayPos(t)},Object.defineProperty(SelectorElement.prototype,"selecting",{get:function(){return this.mSelecting},set:function(t){this.mSelecting=t},enumerable:!1,configurable:!0}),Object.defineProperty(SelectorElement.prototype,"element",{get:function(){return this.mElement},enumerable:!1,configurable:!0}),Object.defineProperty(SelectorElement.prototype,"root",{get:function(){return this.mSourceData},enumerable:!1,configurable:!0}),SelectorElement}(),I=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),A=function(t){function DecorateRoom(e){var i=t.call(this)||this;return i.clockSyncComplete=!0,i.world=e.world,i.mScaleRatio=i.world.scaleRatio,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(l.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_SELECTED_SPRITE,i.onSelectSpriteHandler),i.addHandlerFun(l.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_GET_SPAWN_POINT,i.onShowSpawnPointHandler),i.addHandlerFun(l.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ADD_SPRITE_BY_TYPE,i.onAddSpriteHandler),i.addHandlerFun(l.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EDIT_MODE_ADD_SINGLE_SPRITE_BY_TYPE,i.onAddSingleSpriteHandler)),i}return I(DecorateRoom,t),DecorateRoom.prototype.enter=function(t){var e=this;this.mID=t.id;var i=t.rows,n=t.cols,o=t.tileWidth,s=t.tileHeight;this.mSize={cols:t.cols,rows:t.rows,tileHeight:t.tileHeight,tileWidth:t.tileWidth,sceneWidth:(t.rows+t.cols)*(t.tileWidth/2),sceneHeight:(t.rows+t.cols)*(t.tileHeight/2)},i*=2,n*=2,o/=2,s/=2,this.mMiniSize={cols:n,rows:i,tileHeight:s,tileWidth:o,sceneWidth:(i+n)*(o/2),sceneHeight:(i+n)*(s/2)},this.mMap=new Array(i);for(var h=0;h<i;h++)this.mMap[h]=new Array(n).fill(0);this.mCameraService=new a.a(this),this.world.showLoading().then((function(){e.completeLoad()}))},DecorateRoom.prototype.addBlockObject=function(t){this.mBlocks&&this.mBlocks.add(t)},DecorateRoom.prototype.addMouseListen=function(){},DecorateRoom.prototype.addToGround=function(t){this.mLayerManager.addToGround(t)},DecorateRoom.prototype.addToSceneUI=function(t){this.mLayerManager.addToSceneToUI(t)},DecorateRoom.prototype.addToSurface=function(t){this.mLayerManager.addToSurface(t)},DecorateRoom.prototype.addToUI=function(t){},DecorateRoom.prototype.completeLoad=function(){this.world.game.scene.add(m.a.name,m.a,!0,{room:this})},DecorateRoom.prototype.destroy=function(){this.mTerrainManager&&this.mTerrainManager.destroy(),this.mElementManager&&this.mElementManager.destroy(),this.mLayerManager&&this.mLayerManager.destroy(),this.mBlocks&&this.mBlocks.destroy(),this.removePointerMoveHandler(),this.world.game.scene.remove(m.a.name),this.world.emitter.off(w.a.TURN_ELEMENT,this.onTurnElementHandler,this),this.world.emitter.off(w.a.RECYCLE_ELEMENT,this.onRecycleHandler,this),this.world.emitter.off(w.a.PUT_ELEMENT,this.onPutElement,this),this.world.emitter.off(w.a.CANCEL_PUT,this.onCancelPutHandler,this),this.mScene&&(this.mScene.input.off("pointerup",this.onPointerUpHandler,this),this.mScene.input.off("pointerdown",this.onPointerDownHandler,this),this.mScene.input.off("gameobjectdown",this.onGameobjectUpHandler,this))},DecorateRoom.prototype.now=function(){return 0},DecorateRoom.prototype.pause=function(){this.mScene&&this.mScene.scene.pause()},DecorateRoom.prototype.removeBlockObject=function(t){this.mBlocks&&this.mBlocks.remove(t)},DecorateRoom.prototype.requestActorMove=function(t,e){},DecorateRoom.prototype.resume=function(t){this.mScene&&this.mScene.scene.resume(t)},DecorateRoom.prototype.startLoad=function(){},DecorateRoom.prototype.startPlay=function(){this.mLayerManager&&this.mLayerManager.destroy(),this.mScene=this.world.game.scene.getScene(m.a.name),this.mLayerManager=new s.a(this),this.mLayerManager.drawGrid(this),this.mTerrainManager=new D(this),this.mElementManager=new S(this),this.mBlocks=new o.a(this.mCameraService),this.mBlocks.int(this.mSize),this.mScene.input.on("pointerup",this.onPointerUpHandler,this),this.mScene.input.on("pointerdown",this.onPointerDownHandler,this),this.mScene.input.on("gameobjectdown",this.onGameobjectUpHandler,this);var t=this.scene.cameras.main;this.mCameraService.camera=t;var e=Math.ceil(window.devicePixelRatio);this.mCameraService.setBounds(-t.width>>1,-t.height>>1,this.mSize.sceneWidth*e+t.width,this.mSize.sceneHeight*e+t.height),this.cameraPos&&(this.mCameraService.scrollTargetPoint(this.cameraPos.x,this.cameraPos.y),this.mCameraService.syncCameraScroll()),this.world.changeRoom(this);var i=this.world.game.scene.getScene(u.a.name);i&&i.sleep(),this.connection.send(new p.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED)),this.world.uiManager&&this.world.uiManager.showDecorateUI(),this.world.emitter.on(w.a.TURN_ELEMENT,this.onTurnElementHandler,this),this.world.emitter.on(w.a.RECYCLE_ELEMENT,this.onRecycleHandler,this),this.world.emitter.on(w.a.PUT_ELEMENT,this.onPutElement,this),this.world.emitter.on(w.a.CANCEL_PUT,this.onCancelPutHandler,this)},DecorateRoom.prototype.transformTo45=function(t){if(this.mSize)return h.a.transformTo45(t,this.mSize);d.a.getInstance().error("position object is undefined")},DecorateRoom.prototype.transformTo90=function(t){if(this.mSize)return h.a.transformTo90(t,this.mSize);d.a.getInstance().error("position object is undefined")},DecorateRoom.prototype.transformToMini90=function(t){if(this.mMiniSize)return h.a.transformTo90(t,this.mMiniSize);d.a.getInstance().error("position object is undefined")},DecorateRoom.prototype.transformToMini45=function(t){if(this.mMiniSize)return h.a.transformTo45(t,this.mMiniSize);d.a.getInstance().error("position object is undefined")},DecorateRoom.prototype.update=function(t,e){this.mLayerManager&&this.mLayerManager.update(t,e),this.mSelectorElement&&this.mSelectorElement.update(t,e),this.mBlocks&&this.mBlocks.update(t,e)},DecorateRoom.prototype.updateBlockObject=function(){},DecorateRoom.prototype.resize=function(t,e){this.layerManager.resize(t,e),this.mCameraService.resize(t,e)},DecorateRoom.prototype.transitionGrid=function(t,e){var i=new c.a(t,e),n=this.transformToMini45(i);return this.checkBound(n)},DecorateRoom.prototype.addElements=function(t,e){e===l.op_def.NodeType.ElementNodeType?this.mElementManager.add(t):e===l.op_def.NodeType.TerrainNodeType&&this.mTerrainManager.add(t)},DecorateRoom.prototype.setEnterPos=function(t,e){this.cameraPos=new c.a(t,e)},DecorateRoom.prototype.checkBound=function(t,e){var i=new c.a(t.x,t.y),n=this.mMiniSize;return t.x<0?i.x=0:t.x>n.cols&&(i.x=n.cols),t.y<0?i.y=0:t.y>n.rows&&(i.y=n.rows),i.equal(t)&&e?e:this.transformToMini90(i)},DecorateRoom.prototype.canPut=function(t,e,i){if(e&&i){var n=this.transformToMini45(t);if(n.x<0||n.y<0||n.x>this.miniSize.rows||n.y>this.miniSize.cols)return!1;for(var o=0,a=0,s=this.mElementManager.map,h=0;h<e.length;h++){if((o=h+n.y-i.y)>=s.length)return!1;for(var l=0;l<e[h].length;l++)if((a=l+n.x-i.x)>=s[h].length||0===s[o][a])return!1}return!0}},DecorateRoom.prototype.setMap=function(t,e,i){e<0||t<0||this.mMap.length<e||this.mMap[0].length<t||(this.mMap[t][e]=i)},DecorateRoom.prototype.addPointerMoveHandler=function(){this.mScene&&(this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("gameout",this.onGameOutHandler,this))},DecorateRoom.prototype.removePointerMoveHandler=function(){this.mScene&&(this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("gameout",this.onGameOutHandler,this))},DecorateRoom.prototype.onPointerUpHandler=function(t){this.removePointerMoveHandler(),this.mSelectorElement&&(this.mSelectorElement.selecting=!1)},DecorateRoom.prototype.onPointerDownHandler=function(){this.addPointerMoveHandler()},DecorateRoom.prototype.onGameobjectUpHandler=function(t,e){var i=e.parentContainer;i&&i instanceof f.a&&(i instanceof y.a||this.selectedElement(i.element))},DecorateRoom.prototype.onPointerMoveHandler=function(t){!this.mSelectorElement||this.mSelectorElement&&!1===this.mSelectorElement.selecting?this.moveCamera(t):t.downX===t.x&&t.downY===t.y||this.moveElement(t)},DecorateRoom.prototype.onGameOutHandler=function(){this.removePointerMoveHandler()},DecorateRoom.prototype.moveCamera=function(t){this.cameraService.offsetScroll(t.prevPosition.x-t.position.x,t.prevPosition.y-t.position.y)},DecorateRoom.prototype.moveElement=function(t){var e=this.transitionGrid(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio);this.mSelectorElement&&this.mSelectorElement.setDisplayPos(e)},DecorateRoom.prototype.removeElement=function(t,e){(e===l.op_def.NodeType.ElementNodeType||e===l.op_def.NodeType.SpawnPointType||e===l.op_def.NodeType.TerrainNodeType)&&this.elementManager.remove(t)},DecorateRoom.prototype.addElement=function(t,e){var i=t.nodeType;i===l.op_def.NodeType.ElementNodeType||i===l.op_def.NodeType.SpawnPointType?this.mElementManager.add([t],e):i===l.op_def.NodeType.TerrainNodeType&&this.mTerrainManager.add([t])},DecorateRoom.prototype.selectedElement=function(t,e){void 0===e&&(e=!0),t&&(this.mSelectorElement?this.mSelectorElement.element===t?this.mSelectorElement.selecting=!0:(this.onPutElement(null),this.selectedElement(t,e)):(this.mSelectorElement=new B(t),e&&(this.mSelectorElement.clone(),this.elementManager.removeMap(t.model)),this.mSelectorElement.update()))},DecorateRoom.prototype.cancelSelector=function(){if(this.mSelectorElement){var t=null;this.mSelectorElement.root&&(t=this.mSelectorElement.element.model),this.mSelectorElement.destroy(),this.mSelectorElement=void 0,t&&this.mElementManager.addMap(t)}},DecorateRoom.prototype.onTurnElementHandler=function(t){this.mSelectorElement&&this.mSelectorElement.turnElement()},DecorateRoom.prototype.onRecycleHandler=function(t){if(this.mSelectorElement){var e=this.mSelectorElement.element.model;if(e){var i=new p.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_RECYCLE_SPRITE),n=i.content;n.sprites=[e.toSprite()],n.nodeType=e.nodeType,this.world.connection.send(i),this.mSelectorElement.destroy(),this.mSelectorElement=void 0}}},DecorateRoom.prototype.onPutElement=function(t){if(this.removePointerMoveHandler(),this.mSelectorElement){var e=this.mSelectorElement.element;if(e){var i=e.model;i&&(this.canPut(i.pos,i.currentCollisionArea,i.currentCollisionPoint)?(this.mSelectorElement.root?this.sendUpdateSprite(i):i.nodeType===l.op_def.NodeType.SpawnPointType?(this.sendSpawnPoint(i.pos),this.removeElement(i.id,i.nodeType)):this.sendAddSprite(i),this.cancelSelector()):this.onCancelPutHandler(e))}}},DecorateRoom.prototype.onCancelPutHandler=function(t){(this.removePointerMoveHandler(),this.mSelectorElement)&&(t||(t=this.mElementManager.get(this.mSelectorElement.element.id)),t&&(this.mSelectorElement.root?this.mSelectorElement.recover():this.removeElement(t.id,t.model.nodeType),this.cancelSelector()))},DecorateRoom.prototype.sendAddSprite=function(t){var e=new p.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ADD_SPRITE),i=e.content;i.sprites=[t.toSprite()],i.nodeType=t.nodeType,this.connection.send(e)},DecorateRoom.prototype.sendUpdateSprite=function(t){var e=new p.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_UPDATE_SPRITE),i=e.content;i.sprites=[t.toSprite()],i.nodeType=t.nodeType,this.connection.send(e)},DecorateRoom.prototype.sendSpawnPoint=function(t){var e=new p.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_SET_SPAWN_POINT),i=e.content,n=l.op_def.PBPoint3f.create();n.x=t.x,n.y=t.y,i.spawnPoint=n,this.connection.send(e)},DecorateRoom.prototype.sendPosition=function(t){var e=new p.PBpacket(l.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_CHANGE_SPRITE_POSITION),i=e.content;i.sprites=[t.toSprite()],i.nodeType=t.nodeType,this.connection.send(e)},DecorateRoom.prototype.onSelectSpriteHandler=function(t){var e=t.content,i=this.cameraService.camera,n=new _.a(e.sprite,e.nodeType);n.setPosition((i.scrollX+i.width/2)/this.world.scaleRatio,(i.scrollY+i.height/2)/this.world.scaleRatio),this.addElement(n,!1);var o=this.mElementManager.get(e.sprite.id);o&&this.selectedElement(o,!1)},DecorateRoom.prototype.onShowSpawnPointHandler=function(t){var e=t.content,i=new x,n=e.spawnPoint;i.setPosition(n.x,n.y),this.addElement(i,!1),this.selectedElement(this.mElementManager.get(i.id),!1),this.mCameraService.scrollTargetPoint(n.x,n.y)},DecorateRoom.prototype.onAddSpriteHandler=function(t){t.content;this.cancelSelector()},DecorateRoom.prototype.onAddSingleSpriteHandler=function(t){var e=t.content,i=e.addedSprites;if(i){for(var n=[],o=0,a=i;o<a.length;o++){var s=a[o];n.push(new _.a(s,e.nodeType))}if(n.length>0){this.mElementManager.add(n);var h=this.mElementManager.get(n[n.length-1].id);h&&(this.cancelSelector(),this.selectedElement(h),this.mSelectorElement&&(this.mSelectorElement.selecting=!1))}}},Object.defineProperty(DecorateRoom.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"roomSize",{get:function(){return this.mSize},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"terrainManager",{get:function(){return this.mTerrainManager},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"elementManager",{get:function(){return this.mElementManager},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"layerManager",{get:function(){return this.mLayerManager},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"cameraService",{get:function(){return this.mCameraService},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"scene",{get:function(){return this.mScene},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"connection",{get:function(){return this.world.connection},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"miniSize",{get:function(){return this.mMiniSize},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"selectedSprite",{get:function(){if(this.mSelectorElement)return this.mSelectorElement.element},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"enableEdit",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(DecorateRoom.prototype,"sceneType",{get:function(){return l.op_def.SceneTypeEnum.EDIT_SCENE_TYPE},enumerable:!1,configurable:!0}),DecorateRoom}(p.PacketHandler)},function(t,e,i){"use strict";var n=i(115),o=i(45);const a=Phaser.Math.Distance.Between,s=Phaser.Math.Angle.Between;var h={getDt:function(){return this.scene.sys.game.loop.delta},getVelocity:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return a(e.x,e.y,t.x,t.y)/(.001*this.getDt())},getVelocityX:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.x-e.x)/(.001*this.getDt())},getVelocityY:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.y-e.y)/(.001*this.getDt())},getVelocityAngle:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return s(e.x,e.y,t.x,t.y)}},l={"up&down":0,"left&right":1,"4dir":2,"8dir":3},c={},angletodirections_AngleToDirections=function(t,e,i){switch(void 0===i?i={}:!0===i&&(i=c),i.left=!1,i.right=!1,i.up=!1,i.down=!1,t=(t+360)%360,e){case 0:t<180?i.down=!0:i.up=!0;break;case 1:t>90&&t<=270?i.left=!0:i.right=!0;break;case 2:t>45&&t<=135?i.down=!0:t>135&&t<=225?i.left=!0:t>225&&t<=315?i.up=!0:i.right=!0;break;case 3:t>22.5&&t<=67.5?(i.down=!0,i.right=!0):t>67.5&&t<=112.5?i.down=!0:t>112.5&&t<=157.5?(i.down=!0,i.left=!0):t>157.5&&t<=202.5?i.left=!0:t>202.5&&t<=247.5?(i.left=!0,i.up=!0):t>247.5&&t<=292.5?i.up=!0:t>292.5&&t<=337.5?(i.up=!0,i.right=!0):i.right=!0}return i};const p=Phaser.Utils.Objects.GetValue,u=Phaser.Math.RadToDeg;class Swipe_Swipe extends n.a{constructor(t,e){super(t,e);var i=this,n={states:{IDLE:{enter:function(){i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.validDrag=!1}},RECOGNIZED:{enter:function(){i.start(),i.updateDirectionStates(),i.emit("swipe",i,i.gameObject,i.lastPointer)},exit:function(){i.stop(),i.clearDirectionStates()}}},init:function(){this.state=m},eventEmitter:!1};this.setRecongizedStateObject(new o.a(n)),this.clearDirectionStates()}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(p(t,"threshold",10)),this.setMinDragVelocity(p(t,"velocityThreshold",1e3)),this.setDirectionMode(p(t,"dir","8dir")),this}onDragStart(){this.state=d}onDragEnd(){this.state=m}onDrag(){this.state===d&&(this.vaildDrag||(this.vaildDrag=0===this.dragThreshold||this.pointer.getDistance()>=this.dragThreshold),this.vaildDrag&&this.dragVelocity>this.minDragVelocity&&(this.state=f))}postUpdate(t,e){this.state===f&&(this.state=m)}get isSwiped(){return this.state===f}get dragVelocity(){var t;switch(this.dirMode){case 0:t=this.getVelocityY();break;case 1:t=this.getVelocityX();break;default:t=this.getVelocity()}return t}setDragThreshold(t){return this.dragThreshold=t,this}setMinDragVelocity(t){return this.minDragVelocity=t,this}setDirectionMode(t){return"string"==typeof t&&(t=l[t]),this.dirMode=t,this}updateDirectionStates(){var t=u(this.getVelocityAngle());return angletodirections_AngleToDirections(t,this.dirMode,this),this}clearDirectionStates(){return this.left=!1,this.right=!1,this.up=!1,this.down=!1,this}}Object.assign(Swipe_Swipe.prototype,h);const m="IDLE",d="BEGIN",f="RECOGNIZED";var y=Swipe_Swipe;e.a=y},function(t,e,i){"use strict";const n=Phaser.Utils.Objects.GetValue;var GetRadius=function(t,e,i){return void 0===t?{x:e,y:i}:"number"==typeof t?{x:t,y:t}:t},o=class RoundRectangle_RoundRectangle{constructor(t,e,i,n,o){this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,i,n,o)}setTo(t,e,i,n,o){return this.setPosition(t,e),this.setRadius(o),this.setSize(i,n),this}setPosition(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}setRadius(t){var e,i;void 0===t&&(t=0),"number"==typeof t?(e=t,i=t):(e=n(t,"x",0),i=n(t,"y",0));var o=this.cornerRadius;return o.tl=GetRadius(n(t,"tl",void 0),e,i),o.tr=GetRadius(n(t,"tr",void 0),e,i),o.bl=GetRadius(n(t,"bl",void 0),e,i),o.br=GetRadius(n(t,"br",void 0),e,i),this}setSize(t,e){return this.width=t,this.height=e,this}get minWidth(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}get minHeight(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}get width(){return this._width}set width(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}get height(){return this._height}set height(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}get radius(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}},utils_LineTo=function(t,e,i){var n=i.length;if(n>=2){var o=i[n-2],a=i[n-1];if(t===o&&e===a)return i}return i.push(t,e),i},a=i(411),s=i.n(a),utils_ArcTo=function(t,e,i,n,o,a,h,l,c){var p,u,m;h&&(a+=360),o=s()(o);for(var d=((a=s()(a))-o)/l,f=0;f<=l;f++)m=o+d*f,p=t+i*Math.cos(m),u=e+n*Math.sin(m),utils_LineTo(p,u,c);return c},h=i(412),l=i.n(h),c=i(413),p=i.n(c),u=i(416),m=i.n(u),d=i(51),f=(d.a,d.a,{renderWebGL:p.a,renderCanvas:m.a});const y=Phaser.Utils.Objects.GetValue;class roundrectangle_RoundRectangle_RoundRectangle extends Phaser.GameObjects.Shape{constructor(t,e,i,n,a,s,h,l){void 0===e&&(e=0),void 0===i&&(i=0);var c=y(s,"iteration",void 0);s=y(s,"radius",s),super(t,"RoundRectangle",new o(0,0,n,a,s)),this.setIteration(c),this.setPosition(e,i),void 0!==h&&this.setFillStyle(h,l),this.updateDisplayOrigin(),this.updateData()}updateData(){var t=this.geom,e=this.pathData;e.length=0;var i,n=t.cornerRadius,o=this.iteration+1;if(i=n.br,isArcCorner(i)){var a=t.width-i.x,s=t.height-i.y;utils_ArcTo(a,s,i.x,i.y,0,90,!1,o,e)}else utils_LineTo(t.width,t.height,e);if(i=n.bl,isArcCorner(i)){a=i.x,s=t.height-i.y;utils_ArcTo(a,s,i.x,i.y,90,180,!1,o,e)}else utils_LineTo(0,t.height,e);if(i=n.tl,isArcCorner(i)){a=i.x,s=i.y;utils_ArcTo(a,s,i.x,i.y,180,270,!1,o,e)}else utils_LineTo(0,0,e);if(i=n.tr,isArcCorner(i)){a=t.width-i.x,s=i.y;utils_ArcTo(a,s,i.x,i.y,270,360,!1,o,e)}else utils_LineTo(t.width,0,e);return e.push(e[0],e[1]),this.pathIndexes=l()(e),this}get width(){return this.geom.width}set width(t){this.resize(t,this.height)}get height(){return this.geom.height}set height(t){this.resize(this.width,t)}resize(t,e){if(void 0===e&&(e=t),this.geom.width===t&&this.geom.height===e)return this;this.geom.height=e,this.geom.width=t,this.updateDisplayOrigin(),this.updateData();var i=this.input;return i&&!i.customHitArea&&(i.hitArea.width=t,i.hitArea.height=e),this}get iteration(){return this._iteration}set iteration(t){void 0!==this._iteration?this._iteration!==t&&(this._iteration=t,this.updateData()):this._iteration=t}setIteration(t){return void 0===t&&(t=6),this.iteration=t,this}get radius(){return this.geom.radius}set radius(t){this.geom.setRadius(t),this.updateDisplayOrigin(),this.updateData()}setRadius(t){return void 0===t&&(t=0),this.radius=t,this}get cornerRadius(){return this.geom.cornerRadius}set cornerRadius(t){this.radius=t}setCornerRadius(t){return this.setRadius(t)}}var isArcCorner=function(t){return 0!==t.x&&0!==t.y};Object.assign(roundrectangle_RoundRectangle_RoundRectangle.prototype,f);e.a=roundrectangle_RoundRectangle_RoundRectangle},function(t,e,i){"use strict";var n=i(52),o=i(23);const a=Phaser.Utils.Objects.GetValue;var GetHAlign=function(t){return t.hasOwnProperty("align")?t.align:t.hasOwnProperty("halign")?t.halign:"left"},textedit_CreateInputText=function(t,e){void 0===e&&(e={});var i=t.scene,n=t.style,s=a(e,"backgroundColor",n.backgroundColor);null===s&&(s="transparent"),e.text=a(e,"text",t.text),e.fontFamily=a(e,"fontFamily",n.fontFamily),e.fontSize=a(e,"fontSize",n.fontSize),e.color=a(e,"color",n.color),e.backgroundColor=s,e.align=a(e,"align",GetHAlign(n));var h=new o.a(i,t.x,t.y,a(e,"width",t.width),a(e,"height",t.height),e);return h.setOrigin(t.originX,t.originY),i.add.existing(h),h},object_IsFunction=function(t){return t&&"function"==typeof t};const s=Phaser.Utils.Objects.GetValue;var h=void 0;e.a=class TextEdit_TextEdit{constructor(t){this.gameObject=t,this.scene=Object(n.a)(t),this.inputText=void 0,this.onClose=void 0,this.delayCall=void 0,this.boot()}boot(){return this.gameObject.on("destroy",this.destroy,this),this}shutdown(){return this.close(),this.gameObject=void 0,this.scene=void 0,h===this&&(h=void 0),this}destroy(){return this.shutdown(),this}open(t,e){void 0!==h&&h.close(),h=this,object_IsFunction(t)&&(e=t,t=void 0),void 0===e&&(e=s(t,"onClose",void 0));var i=s(t,"onTextChanged",void 0);return this.inputText=textedit_CreateInputText(this.gameObject,t).on("textchange",(function(t){var e=t.text;i?i(this.gameObject,e):this.gameObject.text=e}),this).setFocus(),this.gameObject.setVisible(!1),this.onClose=e,this.scene.input.keyboard.once("keydown-ENTER",this.close,this),this.delayCall=this.scene.time.delayedCall(0,(function(){this.scene.input.once("pointerdown",this.close,this)}),[],this),this}close(){return h=void 0,this.inputText?(this.gameObject.setVisible(!0),this.inputText.destroy(),this.inputText=void 0,this.delayCall&&(this.delayCall.remove(),this.delayCall=void 0),this.scene.input.keyboard.off("keydown-ENTER",this.close,this),this.scene.input.off("pointerdown",this.close,this),this.onClose&&this.onClose(this.gameObject),this):this}get isOpened(){return void 0!==this.inputText}get text(){return this.isOpened?this.inputText.text:this.gameObject.text}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return n.a})),i.d(e,"b",(function(){return o.a}));i(75),i(193);var n=i(194),o=(i(250),i(83),i(195),i(74),i(32),i(243),i(254),i(109),i(25)),a=(i(108),i(105),i(244),i(289)),s=i(290),h=i(21);Phaser.GameObjects.GameObjectFactory.register("rexBBCodeText",a.a),Phaser.GameObjects.GameObjectCreator.register("rexBBCodeText",s.a);var l,c=h.a,p=i(329),u=(l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});(function(t){function TextBox(e,i){var n=t.call(this)||this,o=i.textConfig,a=o.x,s=o.y,h=i.editType,l=i.text||"",u=i.onTextChanged||void 0,m=i.onClose||void 0,d={type:h,text:l,onTextChanged:u},f={};return Object.assign(f,o),n.mBBCodeText=new c(e,a,s,l,f),n.mBBCodeText.setOrigin(.5,.5),n.mBBCodeText.setInteractive(),n.mBBCodeText.on("pointerdown",(function(){n.mTextEdit||(n.mTextEdit=new p.a(n.mBBCodeText),n.mTextEdit.open(d,m))}),n),n}u(TextBox,t),Object.defineProperty(TextBox.prototype,"isOpened",{get:function(){return!!this.mTextEdit&&this.mTextEdit.isOpened},enumerable:!1,configurable:!0}),Object.defineProperty(TextBox.prototype,"text",{get:function(){return this.mTextEdit?this.mTextEdit.text:""},enumerable:!1,configurable:!0}),Object.defineProperty(TextBox.prototype,"view",{get:function(){return this.mBBCodeText},enumerable:!1,configurable:!0}),TextBox.prototype.close=function(){this.mTextEdit&&(this.mTextEdit.close(),this.mTextEdit.destroy())},TextBox.prototype.destroy=function(){this.close(),this.mBBCodeText&&this.mBBCodeText.destroy(),t.prototype.destroy.call(this)}})(Phaser.Events.EventEmitter),i(107),i(33),i(110),i(196),i(113),i(114),i(247),i(248),i(68),i(85),i(84),i(54),i(197),i(102)},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=function(){function Viewblock(t,e){this.mRect=t,this.mElements=new Map,this.mIndex=e}return Viewblock.prototype.add=function(t,e){if(this.mElements.set(t.id,t),e){var i=t.getPosition45();t.setRenderable(e.contains(i.x,i.y)&&this.mInCamera)}},Viewblock.prototype.remove=function(t){return this.mElements.delete(t.id)},Viewblock.prototype.check=function(t,e){if(t){var i=Phaser.Geom.Intersects.RectangleToRectangle(t,this.rectangle);e&&(this.mInCamera&&this.mElements.forEach((function(t){var i=t.getPosition45();t.setRenderable(e.contains(i.x,i.y),0)})),this.mInCamera=i)}},Viewblock.prototype.getElement=function(t){return this.mElements.get(t)},Object.defineProperty(Viewblock.prototype,"rectangle",{get:function(){return this.mRect||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Viewblock.prototype,"inCamera",{get:function(){return this.mInCamera},enumerable:!1,configurable:!0}),Viewblock}(),o=function(){function ViewblockManager(t){this.mBlocks=[],this.mDelay=0,this.mCameras=t}return ViewblockManager.prototype.add=function(t){if(!this.mCameras)return!1;for(var e=this.mCameras.getMiniViewPort(),i=0,n=this.mBlocks;i<n.length;i++){var o=n[i],a=o.rectangle,s=t.getPosition();if(!s)return;if(a.contains(s.x,s.y))return void o.add(t,e)}},ViewblockManager.prototype.remove=function(t){if(t)for(var e=0,i=this.mBlocks;e<i.length;e++){if(i[e].remove(t))return}},ViewblockManager.prototype.check=function(t){if(t)for(var e=0,i=this.mBlocks;e<i.length;e++){var n=i[e];if(n.inCamera){var o=n.rectangle,a=t.getPosition();if(o.contains(a.x,a.y))return void(n.getElement(t.id)||(this.remove(t),n.add(t)))}}},ViewblockManager.prototype.int=function(t){if(t){this.mBlocks=[];for(var e=t.tileWidth/2*20,i=t.tileHeight/2*20,o=t.sceneWidth/e,a=t.sceneHeight/i,s=0,h=0;h<o;h++)for(var l=0;l<a;l++){var c=new n(new Phaser.Geom.Rectangle(h*e,l*i,e,i),s++);this.mBlocks.push(c)}}},ViewblockManager.prototype.update=function(t,e){if(this.mCameras){this.mDelay=t;for(var i=this.mCameras.getViewPort(),n=this.mCameras.getMiniViewPort(),o=0,a=this.mBlocks;o<a.length;o++){a[o].check(i,n)}}},ViewblockManager.prototype.destroy=function(){this.mDelay=0},ViewblockManager}()},,function(t,e,i){(function(e){t.exports=e.dragonBones=i(334)}).call(this,i(56))},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])});!function(t){var e=function(){function DragonBones(e){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=e,console.info("DragonBones: "+DragonBones.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return DragonBones.prototype.advanceTime=function(e){if(this._objects.length>0){for(var i=0,n=this._objects;i<n.length;i++){n[i].returnToPool()}this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var o=0;o<this._events.length;++o){var a=this._events[o],s=a.armature;null!==s._armatureData&&(s.eventDispatcher.dispatchDBEvent(a.type,a),a.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(a.type,a)),this.bufferObject(a)}this._events.length=0}},DragonBones.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},DragonBones.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(DragonBones.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(DragonBones.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),DragonBones.VERSION="5.7.000",DragonBones.yDown=!0,DragonBones.debug=!1,DragonBones.debugDraw=!1,DragonBones}();t.DragonBones=e}(c||(c={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function now(){return(new Date).getTime()});var a,s,h,l,c,p;o=function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r};if(void 0===u&&"undefined"!=typeof window)var u=window;t.exports=c,function(t){var e=function(){function BaseObject(){this.hashCode=BaseObject._hashCode++,this._isInPool=!1}return BaseObject._returnObject=function(t){var e=String(t.constructor),i=e in BaseObject._maxCountMap?BaseObject._maxCountMap[e]:BaseObject._defaultMaxCount,n=BaseObject._poolsMap[e]=BaseObject._poolsMap[e]||[];n.length<i&&(t._isInPool?console.warn("The object is already in the pool."):(t._isInPool=!0,n.push(t)))},BaseObject.toString=function(){throw new Error},BaseObject.setMaxCount=function(t,e){if((e<0||e!=e)&&(e=0),null!==t)null!==(n=(i=String(t))in BaseObject._poolsMap?BaseObject._poolsMap[i]:null)&&n.length>e&&(n.length=e),BaseObject._maxCountMap[i]=e;else for(var i in BaseObject._defaultMaxCount=e,BaseObject._poolsMap){var n;(n=BaseObject._poolsMap[i]).length>e&&(n.length=e),i in BaseObject._maxCountMap&&(BaseObject._maxCountMap[i]=e)}},BaseObject.clearPool=function(t){if(void 0===t&&(t=null),null!==t){var e=String(t);null!==(n=e in BaseObject._poolsMap?BaseObject._poolsMap[e]:null)&&n.length>0&&(n.length=0)}else for(var i in BaseObject._poolsMap){var n;(n=BaseObject._poolsMap[i]).length=0}},BaseObject.borrowObject=function(t){var e=String(t),i=e in BaseObject._poolsMap?BaseObject._poolsMap[e]:null;if(null!==i&&i.length>0){var n=i.pop();return n._isInPool=!1,n}var o=new t;return o._onClear(),o},BaseObject.prototype.returnToPool=function(){this._onClear(),BaseObject._returnObject(this)},BaseObject._hashCode=0,BaseObject._defaultMaxCount=3e3,BaseObject._maxCountMap={},BaseObject._poolsMap={},BaseObject}();t.BaseObject=e}(c||(c={})),function(t){var e=function(){function Matrix(t,e,i,n,o,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===o&&(o=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=n,this.tx=o,this.ty=a}return Matrix.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},Matrix.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Matrix.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},Matrix.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},Matrix.prototype.concat=function(t){var e=this.a*t.a,i=0,n=0,o=this.d*t.d,a=this.tx*t.a+t.tx,s=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,n+=this.c*t.a,o+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,n+=this.d*t.c,a+=this.ty*t.c,s+=this.tx*t.b),this.a=e,this.b=i,this.c=n,this.d=o,this.tx=a,this.ty=s,this},Matrix.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,o=this.tx,a=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===n?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,n=this.d=1/n,this.tx=-t*o,this.ty=-n*a),this;var s=t*n-e*i;if(0===s)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;s=1/s;var h=this.a=n*s;return e=this.b=-e*s,i=this.c=-i*s,n=this.d=t*s,this.tx=-(h*o+i*a),this.ty=-(e*o+n*a),this},Matrix.prototype.transformPoint=function(t,e,i,n){void 0===n&&(n=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,n||(i.x+=this.tx,i.y+=this.ty)},Matrix.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var i=this.a,n=this.b,o=this.c,a=this.d,s=e?0:this.tx,h=e?0:this.ty,l=t.x,c=t.y,p=l+t.width,u=c+t.height,m=i*l+o*c+s,d=n*l+a*c+h,f=i*p+o*c+s,y=n*p+a*c+h,g=i*p+o*u+s,_=n*p+a*u+h,v=i*l+o*u+s,b=n*l+a*u+h,P=0;m>f&&(P=m,m=f,f=P),g>v&&(P=g,g=v,v=P),t.x=Math.floor(m<g?m:g),t.width=Math.ceil((f>v?f:v)-t.x),d>y&&(P=d,d=y,y=P),_>b&&(P=_,_=b,b=P),t.y=Math.floor(d<_?d:_),t.height=Math.ceil((y>b?y:b)-t.y)},Matrix}();t.Matrix=e}(c||(c={})),function(t){var e=function(){function Transform(t,e,i,n,o,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=1),void 0===a&&(a=1),this.x=t,this.y=e,this.skew=i,this.rotation=n,this.scaleX=o,this.scaleY=a}return Transform.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI},Transform.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},Transform.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},Transform.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},Transform.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},Transform.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},Transform.prototype.fromMatrix=function(t){var e=this.scaleX,i=this.scaleY,n=Transform.PI_Q;this.x=t.tx,this.y=t.ty,this.rotation=Math.atan(t.b/t.a);var o=Math.atan(-t.c/t.d);return this.scaleX=this.rotation>-n&&this.rotation<n?t.a/Math.cos(this.rotation):t.b/Math.sin(this.rotation),this.scaleY=o>-n&&o<n?t.d/Math.cos(o):-t.c/Math.sin(o),e>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),i>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,o-=Math.PI),this.skew=o-this.rotation,this},Transform.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},Transform.PI=Math.PI,Transform.PI_D=2*Math.PI,Transform.PI_H=Math.PI/2,Transform.PI_Q=Math.PI/4,Transform.RAD_DEG=180/Math.PI,Transform.DEG_RAD=Math.PI/180,Transform}();t.Transform=e}(c||(c={})),function(t){var e=function(){function ColorTransform(t,e,i,n,o,a,s,h){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===h&&(h=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=n,this.alphaOffset=o,this.redOffset=a,this.greenOffset=s,this.blueOffset=h}return ColorTransform.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},ColorTransform.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},ColorTransform}();t.ColorTransform=e}(c||(c={})),function(t){var e=function(){function Point(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return Point.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},Point.prototype.clear=function(){this.x=this.y=0},Point}();t.Point=e}(c||(c={})),function(t){var e=function(){function Rectangle(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}return Rectangle.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},Rectangle.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},Rectangle}();t.Rectangle=e}(c||(c={})),function(t){var e=function(t){function UserData(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return o(UserData,t),UserData.toString=function(){return"[class dragonBones.UserData]"},UserData.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},UserData.prototype.addInt=function(t){this.ints.push(t)},UserData.prototype.addFloat=function(t){this.floats.push(t)},UserData.prototype.addString=function(t){this.strings.push(t)},UserData.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},UserData.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},UserData.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},UserData}(t.BaseObject);t.UserData=e;var i=function(t){function ActionData(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return o(ActionData,t),ActionData.toString=function(){return"[class dragonBones.ActionData]"},ActionData.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},ActionData}(t.BaseObject);t.ActionData=i}(c||(c={})),function(t){var e=function(t){function DragonBonesData(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return o(DragonBonesData,t),DragonBonesData.toString=function(){return"[class dragonBones.DragonBonesData]"},DragonBonesData.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.colorArray=null,this.userData=null},DragonBonesData.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},DragonBonesData.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},DragonBonesData}(t.BaseObject);t.DragonBonesData=e}(c||(c={})),function(t){var e=function(e){function ArmatureData(){var i=null!==e&&e.apply(this,arguments)||this;return i.aabb=new t.Rectangle,i.animationNames=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.constraints={},i.skins={},i.animations={},i.canvas=null,i.userData=null,i}return o(ArmatureData,e),ArmatureData.toString=function(){return"[class dragonBones.ArmatureData]"},ArmatureData.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++){e[t].returnToPool()}for(var i=0,n=this.actions;i<n.length;i++){n[i].returnToPool()}for(var o in this.bones)this.bones[o].returnToPool(),delete this.bones[o];for(var o in this.slots)this.slots[o].returnToPool(),delete this.slots[o];for(var o in this.constraints)this.constraints[o].returnToPool(),delete this.constraints[o];for(var o in this.skins)this.skins[o].returnToPool(),delete this.skins[o];for(var o in this.animations)this.animations[o].returnToPool(),delete this.animations[o];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},ArmatureData.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,n=0;for(this.sortedBones.length=0;n<t;){var o=e[i++];if(i>=t&&(i=0),!(this.sortedBones.indexOf(o)>=0)){var a=!1;for(var s in this.constraints){var h=this.constraints[s];if(h.root===o&&this.sortedBones.indexOf(h.target)<0){a=!0;break}}a||null!==o.parent&&this.sortedBones.indexOf(o.parent)<0||(this.sortedBones.push(o),n++)}}}},ArmatureData.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},ArmatureData.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,n=i.length;return i.length+=10,i[n]=t.a,i[n+1]=t.b,i[n+2]=t.c,i[n+3]=t.d,i[n+4]=t.tx,i[n+5]=t.ty,i[n+6]=e.rotation,i[n+7]=e.skew,i[n+8]=e.scaleX,i[n+9]=e.scaleY,n},ArmatureData.prototype.getCacheFrame=function(t,e,i){var n=this.parent.cachedFrames;t.a=n[i],t.b=n[i+1],t.c=n[i+2],t.d=n[i+3],t.tx=n[i+4],t.ty=n[i+5],e.rotation=n[i+6],e.skew=n[i+7],e.scaleX=n[i+8],e.scaleY=n[i+9],e.x=t.tx,e.y=t.ty},ArmatureData.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},ArmatureData.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},ArmatureData.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},ArmatureData.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},ArmatureData.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},ArmatureData.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},ArmatureData.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},ArmatureData.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},ArmatureData.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},ArmatureData.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},ArmatureData.prototype.getMesh=function(t,e,i){var n=this.getSkin(t);return null===n?null:n.getDisplay(e,i)},ArmatureData.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},ArmatureData}(t.BaseObject);t.ArmatureData=e;var i=function(e){function BoneData(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.userData=null,i}return o(BoneData,e),BoneData.toString=function(){return"[class dragonBones.BoneData]"},BoneData.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.alpha=1,this.name="",this.transform.identity(),this.userData=null,this.parent=null},BoneData}(t.BaseObject);t.BoneData=i;var n=function(e){function SurfaceData(){var i=null!==e&&e.apply(this,arguments)||this;return i.geometry=new t.GeometryData,i}return o(SurfaceData,e),SurfaceData.toString=function(){return"[class dragonBones.SurfaceData]"},SurfaceData.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.geometry.clear()},SurfaceData}(i);t.SurfaceData=n;var a=function(e){function SlotData(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return o(SlotData,e),SlotData.createColor=function(){return new t.ColorTransform},SlotData.toString=function(){return"[class dragonBones.SlotData]"},SlotData.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.zIndex=0,this.alpha=1,this.name="",this.color=null,this.userData=null,this.parent=null},SlotData.DEFAULT_COLOR=new t.ColorTransform,SlotData}(t.BaseObject);t.SlotData=a}(c||(c={})),function(t){var e=function(t){function ConstraintData(){return null!==t&&t.apply(this,arguments)||this}return o(ConstraintData,t),ConstraintData.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},ConstraintData}(t.BaseObject);t.ConstraintData=e;var i=function(t){function IKConstraintData(){return null!==t&&t.apply(this,arguments)||this}return o(IKConstraintData,t),IKConstraintData.toString=function(){return"[class dragonBones.IKConstraintData]"},IKConstraintData.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},IKConstraintData}(e);t.IKConstraintData=i;var n=function(t){function PathConstraintData(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return o(PathConstraintData,t),PathConstraintData.toString=function(){return"[class dragonBones.PathConstraintData]"},PathConstraintData.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},PathConstraintData.prototype.AddBone=function(t){this.bones.push(t)},PathConstraintData}(e);t.PathConstraintData=n}(c||(c={})),function(t){var e=function(t){function CanvasData(){return null!==t&&t.apply(this,arguments)||this}return o(CanvasData,t),CanvasData.toString=function(){return"[class dragonBones.CanvasData]"},CanvasData.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},CanvasData}(t.BaseObject);t.CanvasData=e}(c||(c={})),function(t){var e=function(t){function SkinData(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return o(SkinData,t),SkinData.toString=function(){return"[class dragonBones.SkinData]"},SkinData.prototype._onClear=function(){for(var t in this.displays){for(var e=0,i=this.displays[t];e<i.length;e++){var n=i[e];null!==n&&n.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},SkinData.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},SkinData.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(null!==i)for(var n=0,o=i;n<o.length;n++){var a=o[n];if(null!==a&&a.name===e)return a}return null},SkinData.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},SkinData}(t.BaseObject);t.SkinData=e}(c||(c={})),function(t){var e=function(){function GeometryData(){this.weight=null}return GeometryData.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},GeometryData.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},Object.defineProperty(GeometryData.prototype,"vertexCount",{get:function(){return this.data.intArray[this.offset+0]},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryData.prototype,"triangleCount",{get:function(){return this.data.intArray[this.offset+1]},enumerable:!0,configurable:!0}),GeometryData}();t.GeometryData=e;var i=function(e){function DisplayData(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i}return o(DisplayData,e),DisplayData.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},DisplayData}(t.BaseObject);t.DisplayData=i;var n=function(e){function ImageDisplayData(){var i=null!==e&&e.apply(this,arguments)||this;return i.pivot=new t.Point,i}return o(ImageDisplayData,e),ImageDisplayData.toString=function(){return"[class dragonBones.ImageDisplayData]"},ImageDisplayData.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},ImageDisplayData}(i);t.ImageDisplayData=n;var a=function(t){function ArmatureDisplayData(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return o(ArmatureDisplayData,t),ArmatureDisplayData.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},ArmatureDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions;e<i.length;e++){i[e].returnToPool()}this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},ArmatureDisplayData.prototype.addAction=function(t){this.actions.push(t)},ArmatureDisplayData}(i);t.ArmatureDisplayData=a;var s=function(t){function MeshDisplayData(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i}return o(MeshDisplayData,t),MeshDisplayData.toString=function(){return"[class dragonBones.MeshDisplayData]"},MeshDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.geometry.clear(),this.texture=null},MeshDisplayData}(i);t.MeshDisplayData=s;var h=function(t){function BoundingBoxDisplayData(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return o(BoundingBoxDisplayData,t),BoundingBoxDisplayData.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},BoundingBoxDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},BoundingBoxDisplayData}(i);t.BoundingBoxDisplayData=h;var l=function(t){function PathDisplayData(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i.curveLengths=[],i}return o(PathDisplayData,t),PathDisplayData.toString=function(){return"[class dragonBones.PathDisplayData]"},PathDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.geometry.clear(),this.curveLengths.length=0},PathDisplayData}(i);t.PathDisplayData=l;var c=function(t){function WeightData(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return o(WeightData,t),WeightData.toString=function(){return"[class dragonBones.WeightData]"},WeightData.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},WeightData.prototype.addBone=function(t){this.bones.push(t)},WeightData}(t.BaseObject);t.WeightData=c}(c||(c={})),function(t){var e=function(t){function BoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return o(BoundingBoxData,t),BoundingBoxData.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},BoundingBoxData}(t.BaseObject);t.BoundingBoxData=e;var i=function(t){function RectangleBoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return o(RectangleBoundingBoxData,t),RectangleBoundingBoxData.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},RectangleBoundingBoxData._computeOutCode=function(t,e,i,n,o,a){var s=0;return t<i?s|=1:t>o&&(s|=2),e<n?s|=4:e>a&&(s|=8),s},RectangleBoundingBoxData.rectangleIntersectsSegment=function(t,e,i,n,o,a,s,h,l,c,p){void 0===l&&(l=null),void 0===c&&(c=null),void 0===p&&(p=null);var u=t>o&&t<s&&e>a&&e<h,m=i>o&&i<s&&n>a&&n<h;if(u&&m)return-1;for(var d=0,f=RectangleBoundingBoxData._computeOutCode(t,e,o,a,s,h),y=RectangleBoundingBoxData._computeOutCode(i,n,o,a,s,h);;){if(0==(f|y)){d=2;break}if(0!=(f&y))break;var g=0,_=0,v=0,b=0!==f?f:y;0!=(4&b)?(g=t+(i-t)*(a-e)/(n-e),_=a,null!==p&&(v=.5*-Math.PI)):0!=(8&b)?(g=t+(i-t)*(h-e)/(n-e),_=h,null!==p&&(v=.5*Math.PI)):0!=(2&b)?(_=e+(n-e)*(s-t)/(i-t),g=s,null!==p&&(v=0)):0!=(1&b)&&(_=e+(n-e)*(o-t)/(i-t),g=o,null!==p&&(v=Math.PI)),b===f?(t=g,e=_,f=RectangleBoundingBoxData._computeOutCode(t,e,o,a,s,h),null!==p&&(p.x=v)):(i=g,n=_,y=RectangleBoundingBoxData._computeOutCode(i,n,o,a,s,h),null!==p&&(p.y=v))}return d&&(u?(d=2,null!==l&&(l.x=i,l.y=n),null!==c&&(c.x=i,c.y=i),null!==p&&(p.x=p.y+Math.PI)):m?(d=1,null!==l&&(l.x=t,l.y=e),null!==c&&(c.x=t,c.y=e),null!==p&&(p.y=p.x+Math.PI)):(d=3,null!==l&&(l.x=t,l.y=e),null!==c&&(c.x=i,c.y=n))),d},RectangleBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},RectangleBoundingBoxData.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var n=.5*this.height;if(e>=-n&&e<=n)return!0}return!1},RectangleBoundingBoxData.prototype.intersectsSegment=function(t,e,i,n,o,a,s){void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null);var h=.5*this.width,l=.5*this.height;return RectangleBoundingBoxData.rectangleIntersectsSegment(t,e,i,n,-h,-l,h,l,o,a,s)},RectangleBoundingBoxData}(e);t.RectangleBoundingBoxData=i;var n=function(t){function EllipseBoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return o(EllipseBoundingBoxData,t),EllipseBoundingBoxData.toString=function(){return"[class dragonBones.EllipseData]"},EllipseBoundingBoxData.ellipseIntersectsSegment=function(t,e,i,n,o,a,s,h,l,c,p){void 0===l&&(l=null),void 0===c&&(c=null),void 0===p&&(p=null);var u=s/h,m=u*u,d=i-t,f=(n*=u)-(e*=u),y=Math.sqrt(d*d+f*f),g=d/y,_=f/y,v=(o-t)*g+(a-e)*_,b=s*s,P=b-(t*t+e*e)+v*v,S=0;if(P>=0){var w=Math.sqrt(P),T=v-w,C=v+w,D=T<0?-1:T<=y?0:1,M=C<0?-1:C<=y?0:1,O=D*M;if(O<0)return-1;0===O&&(-1===D?(S=2,i=t+C*g,n=(e+C*_)/u,null!==l&&(l.x=i,l.y=n),null!==c&&(c.x=i,c.y=n),null!==p&&(p.x=Math.atan2(n/b*m,i/b),p.y=p.x+Math.PI)):1===M?(S=1,t+=T*g,e=(e+T*_)/u,null!==l&&(l.x=t,l.y=e),null!==c&&(c.x=t,c.y=e),null!==p&&(p.x=Math.atan2(e/b*m,t/b),p.y=p.x+Math.PI)):(S=3,null!==l&&(l.x=t+T*g,l.y=(e+T*_)/u,null!==p&&(p.x=Math.atan2(l.y/b*m,l.x/b))),null!==c&&(c.x=t+C*g,c.y=(e+C*_)/u,null!==p&&(p.y=Math.atan2(c.y/b*m,c.x/b)))))}return S},EllipseBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},EllipseBoundingBoxData.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var n=.5*this.height;if(e>=-n&&e<=n)return e*=i/n,Math.sqrt(t*t+e*e)<=i}return!1},EllipseBoundingBoxData.prototype.intersectsSegment=function(t,e,i,n,o,a,s){return void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),EllipseBoundingBoxData.ellipseIntersectsSegment(t,e,i,n,0,0,.5*this.width,.5*this.height,o,a,s)},EllipseBoundingBoxData}(e);t.EllipseBoundingBoxData=n;var a=function(t){function PolygonBoundingBoxData(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return o(PolygonBoundingBoxData,t),PolygonBoundingBoxData.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},PolygonBoundingBoxData.polygonIntersectsSegment=function(t,e,i,n,o,a,s,h){void 0===a&&(a=null),void 0===s&&(s=null),void 0===h&&(h=null),t===i&&(t=i+1e-6),e===n&&(e=n+1e-6);for(var l=o.length,c=t-i,p=e-n,u=t*n-e*i,m=0,d=o[l-2],f=o[l-1],y=0,g=0,_=0,v=0,b=0,P=0,S=0;S<l;S+=2){var w=o[S],T=o[S+1];d===w&&(d=w+1e-4),f===T&&(f=T+1e-4);var C=d-w,D=f-T,M=d*T-f*w,O=c*D-p*C,x=(u*C-c*M)/O;if((x>=d&&x<=w||x>=w&&x<=d)&&(0===c||x>=t&&x<=i||x>=i&&x<=t)){var E=(u*D-p*M)/O;if((E>=f&&E<=T||E>=T&&E<=f)&&(0===p||E>=e&&E<=n||E>=n&&E<=e)){if(null===s){_=x,v=E,b=x,P=E,m++,null!==h&&(h.x=Math.atan2(T-f,w-d)-.5*Math.PI,h.y=h.x);break}var B=x-t;B<0&&(B=-B),0===m?(y=B,g=B,_=x,v=E,b=x,P=E,null!==h&&(h.x=Math.atan2(T-f,w-d)-.5*Math.PI,h.y=h.x)):(B<y&&(y=B,_=x,v=E,null!==h&&(h.x=Math.atan2(T-f,w-d)-.5*Math.PI)),B>g&&(g=B,b=x,P=E,null!==h&&(h.y=Math.atan2(T-f,w-d)-.5*Math.PI))),m++}}d=w,f=T}return 1===m?(null!==a&&(a.x=_,a.y=v),null!==s&&(s.x=_,s.y=v),null!==h&&(h.y=h.x+Math.PI)):m>1&&(m++,null!==a&&(a.x=_,a.y=v),null!==s&&(s.x=b,s.y=P)),m},PolygonBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},PolygonBoundingBoxData.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var n=0,o=this.vertices.length,a=o-2;n<o;n+=2){var s=this.vertices[a+1],h=this.vertices[n+1];if(h<e&&s>=e||s<e&&h>=e){var l=this.vertices[a],c=this.vertices[n];(e-h)*(l-c)/(s-h)+c<t&&(i=!i)}a=n}return i},PolygonBoundingBoxData.prototype.intersectsSegment=function(t,e,n,o,a,s,h){void 0===a&&(a=null),void 0===s&&(s=null),void 0===h&&(h=null);var l=0;return 0!==i.rectangleIntersectsSegment(t,e,n,o,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(l=PolygonBoundingBoxData.polygonIntersectsSegment(t,e,n,o,this.vertices,a,s,h)),l},PolygonBoundingBoxData}(e);t.PolygonBoundingBoxData=a}(c||(c={})),function(t){var e=function(t){function AnimationData(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return o(AnimationData,t),AnimationData.toString=function(){return"[class dragonBones.AnimationData]"},AnimationData.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++){i[e].returnToPool()}delete this.boneTimelines[t]}for(var t in this.slotTimelines){for(var n=0,o=this.slotTimelines[t];n<o.length;n++){o[n].returnToPool()}delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var a=0,s=this.constraintTimelines[t];a<s.length;a++){s[a].returnToPool()}delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var h=0,l=this.animationTimelines[t];h<l.length;h++){l[h].returnToPool()}delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.blendType=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},AnimationData.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,n=this.cacheFrames.length;i<n;++i)this.cachedFrames[i]=!1;for(var o=0,a=this.parent.sortedBones;o<a.length;o++){var s=a[o];for(i=0,n=(c=new Array(e)).length;i<n;++i)c[i]=-1;this.boneCachedFrameIndices[s.name]=c}for(var h=0,l=this.parent.sortedSlots;h<l.length;h++){var c,p=l[h];for(i=0,n=(c=new Array(e)).length;i<n;++i)c[i]=-1;this.slotCachedFrameIndices[p.name]=c}}},AnimationData.prototype.addBoneTimeline=function(t,e){var i=t in this.boneTimelines?this.boneTimelines[t]:this.boneTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addSlotTimeline=function(t,e){var i=t in this.slotTimelines?this.slotTimelines[t]:this.slotTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addConstraintTimeline=function(t,e){var i=t in this.constraintTimelines?this.constraintTimelines[t]:this.constraintTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addAnimationTimeline=function(t,e){var i=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},AnimationData.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},AnimationData.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},AnimationData.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},AnimationData.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},AnimationData.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},AnimationData}(t.BaseObject);t.AnimationData=e;var i=function(t){function TimelineData(){return null!==t&&t.apply(this,arguments)||this}return o(TimelineData,t),TimelineData.toString=function(){return"[class dragonBones.TimelineData]"},TimelineData.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},TimelineData}(t.BaseObject);t.TimelineData=i;var n=function(t){function AnimationTimelineData(){return null!==t&&t.apply(this,arguments)||this}return o(AnimationTimelineData,t),AnimationTimelineData.toString=function(){return"[class dragonBones.AnimationTimelineData]"},AnimationTimelineData.prototype._onClear=function(){t.prototype._onClear.call(this),this.x=0,this.y=0},AnimationTimelineData}(i);t.AnimationTimelineData=n}(c||(c={})),function(t){var e=function(t){function AnimationConfig(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return o(AnimationConfig,t),AnimationConfig.toString=function(){return"[class dragonBones.AnimationConfig]"},AnimationConfig.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additive=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},AnimationConfig.prototype.clear=function(){this._onClear()},AnimationConfig.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additive=t.additive,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},AnimationConfig}(t.BaseObject);t.AnimationConfig=e}(c||(c={})),function(t){var e=function(t){function TextureAtlasData(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return o(TextureAtlasData,t),TextureAtlasData.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},TextureAtlasData.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},TextureAtlasData.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},TextureAtlasData.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},TextureAtlasData}(t.BaseObject);t.TextureAtlasData=e;var i=function(e){function TextureData(){var i=null!==e&&e.apply(this,arguments)||this;return i.region=new t.Rectangle,i.frame=null,i}return o(TextureData,e),TextureData.createRectangle=function(){return new t.Rectangle},TextureData.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},TextureData.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=TextureData.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},TextureData}(t.BaseObject);t.TextureData=i}(c||(c={})),a=c||(c={}),s=function(t){function Armature(){var e=null!==t&&t.apply(this,arguments)||this;return e._bones=[],e._slots=[],e._constraints=[],e._actions=[],e._animation=null,e._proxy=null,e._replaceTextureAtlasData=null,e._clock=null,e}return o(Armature,t),Armature.toString=function(){return"[class dragonBones.Armature]"},Armature._onSortSlots=function(t,e){return 1e3*t._zIndex+t._zOrder>1e3*e._zIndex+e._zOrder?1:-1},Armature.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var i=0,n=this._slots;i<n.length;i++)n[i].returnToPool();for(var o=0,a=this._constraints;o<a.length;o++)a[o].returnToPool();for(var s=0,h=this._actions;s<h.length;s++)h[s].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._zIndexDirty=!1,this._alphaDirty=!0,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._alpha=1,this._globalAlpha=1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},Armature.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,n=null===t;if(this._zOrderDirty||!n){for(var o=0,a=i.length;o<a;++o){var s=n?o:t[e+o];if(!(s<0||s>=a)){var h=i[s],l=this.getSlot(h.name);null!==l&&l._setZOrder(o)}}this._slotsDirty=!0,this._zOrderDirty=!n}},Armature.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},Armature.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},Armature.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},Armature.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},Armature.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},Armature.prototype.init=function(t,e,i,n){null===this._armatureData&&(this._armatureData=t,this._animation=a.BaseObject.borrowObject(a.Animation),this._proxy=e,this._display=i,this._dragonBones=n,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},Armature.prototype.advanceTime=function(t){if(!this._lockUpdate)if(this._lockUpdate=!0,null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty||this._zIndexDirty){if(this._slots.sort(Armature._onSortSlots),this._zIndexDirty)for(var i=0,n=this._slots.length;i<n;++i)this._slots[i]._setZOrder(i);this._slotsDirty=!1,this._zIndexDirty=!1}if(this._alphaDirty){this._alphaDirty=!1,this._globalAlpha=this._alpha*(null!==this._parent?this._parent._globalAlpha:1);for(var o=0,a=this._bones;o<a.length;o++)a[o]._updateAlpha();for(var s=0,h=this._slots;s<h.length;s++)(f=h[s])._updateAlpha()}if(this._cacheFrameIndex<0||this._cacheFrameIndex!==e){for(i=0,n=0,i=0,n=this._bones.length;i<n;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,n=this._slots.length;i<n;++i)this._slots[i].update(this._cacheFrameIndex)}if(this._actions.length>0){for(var l=0,c=this._actions;l<c.length;l++){var p=c[l],u=p.actionData;if(null!==u&&0===u.type)if(null!==p.slot)null!==(y=p.slot.childArmature)&&y.animation.fadeIn(u.name);else if(null!==p.bone)for(var m=0,d=this.getSlots();m<d.length;m++){var f,y;(f=d[m]).parent===p.bone&&null!==(y=f.childArmature)&&y.animation.fadeIn(u.name)}else this._animation.fadeIn(u.name);p.returnToPool()}this._actions.length=0}this._lockUpdate=!1,this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},Armature.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(s=this.getBone(t))&&(s.invalidUpdate(),e))for(var i=0,n=this._slots;i<n.length;i++)(c=n[i]).parent===s&&c.invalidUpdate()}else{for(var o=0,a=this._bones;o<a.length;o++){var s;(s=a[o]).invalidUpdate()}if(e)for(var h=0,l=this._slots;h<l.length;h++){var c;(c=l[h]).invalidUpdate()}}},Armature.prototype.containsPoint=function(t,e){for(var i=0,n=this._slots;i<n.length;i++){var o=n[i];if(o.containsPoint(t,e))return o}return null},Armature.prototype.intersectsSegment=function(t,e,i,n,o,a,s){void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null);for(var h=t===i,l=0,c=0,p=0,u=0,m=0,d=0,f=0,y=0,g=null,_=null,v=0,b=this._slots;v<b.length;v++){var P=b[v];if(P.intersectsSegment(t,e,i,n,o,a,s)>0){if(null===o&&null===a){g=P;break}var S;null!==o&&((S=h?o.y-e:o.x-t)<0&&(S=-S),(null===g||S<l)&&(l=S,p=o.x,u=o.y,g=P,s&&(f=s.x))),null!==a&&((S=a.x-t)<0&&(S=-S),(null===_||S>c)&&(c=S,m=a.x,d=a.y,_=P,null!==s&&(y=s.y)))}}return null!==g&&null!==o&&(o.x=p,o.y=u,null!==s&&(s.x=f)),null!==_&&null!==a&&(a.x=m,a.y=d,null!==s&&(s.y=y)),g},Armature.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},Armature.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},Armature.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},Armature.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];if(n.display===t)return n}return null},Armature.prototype.getBones=function(){return this._bones},Armature.prototype.getSlots=function(){return this._slots},Object.defineProperty(Armature.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var n=i[e].childArmature;null!==n&&(n.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var n=i[e];n.invalidUpdate(),n.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var n=i[e].childArmature;null!==n&&(n.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Armature.prototype.getDisplay=function(){return this._display},Armature}(a.BaseObject),a.Armature=s,function(t){var e=function(e){function TransformObject(){var i=null!==e&&e.apply(this,arguments)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return o(TransformObject,e),TransformObject.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._alpha=1,this._globalAlpha=1,this._armature=null},TransformObject.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(TransformObject.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),TransformObject._helpMatrix=new t.Matrix,TransformObject._helpTransform=new t.Transform,TransformObject._helpPoint=new t.Point,TransformObject}(t.BaseObject);t.TransformObject=e}(c||(c={})),function(t){var e=function(e){function Bone(){var i=null!==e&&e.apply(this,arguments)||this;return i.animationPose=new t.Transform,i}return o(Bone,e),Bone.toString=function(){return"[class dragonBones.Bone]"},Bone.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._boneData=null,this._parent=null,this._cachedFrameIndices=null},Bone.prototype._updateGlobalTransformMatrix=function(e){var i=this._boneData,n=this.global,o=this.globalTransformMatrix,a=this.origin,s=this.offset,h=this.animationPose,l=this._parent,c=this._armature.flipX,p=this._armature.flipY===t.DragonBones.yDown,u=null!==l,m=0;if(1===this.offsetMode?null!==a?(n.x=a.x+s.x+h.x,n.scaleX=a.scaleX*s.scaleX*h.scaleX,n.scaleY=a.scaleY*s.scaleY*h.scaleY,t.DragonBones.yDown?(n.y=a.y+s.y+h.y,n.skew=a.skew+s.skew+h.skew,n.rotation=a.rotation+s.rotation+h.rotation):(n.y=a.y-s.y+h.y,n.skew=a.skew-s.skew+h.skew,n.rotation=a.rotation-s.rotation+h.rotation)):(n.copyFrom(s),t.DragonBones.yDown||(n.y=-n.y,n.skew=-n.skew,n.rotation=-n.rotation),n.add(h)):0===this.offsetMode?null!==a?n.copyFrom(a).add(h):n.copyFrom(h):(u=!1,n.copyFrom(s),t.DragonBones.yDown||(n.y=-n.y,n.skew=-n.skew,n.rotation=-n.rotation)),u){var d=1===l._boneData.type,f=d?l._bone:null,y=d?l._getGlobalTransformMatrix(n.x,n.y):l.globalTransformMatrix;if(!i.inheritScale||d&&null===f){if(i.inheritTranslation){var g=n.x,_=n.y;n.x=y.a*g+y.c*_+y.tx,n.y=y.b*g+y.d*_+y.ty}else c&&(n.x=-n.x),p&&(n.y=-n.y);i.inheritRotation?(l.updateGlobalTransform(),m=l.global.scaleX<0?n.rotation+l.global.rotation+Math.PI:n.rotation+l.global.rotation,y.a*y.d-y.b*y.c<0&&(m-=2*n.rotation,(c!==p||i.inheritReflection)&&(n.skew+=Math.PI),t.DragonBones.yDown||(n.skew=-n.skew)),n.rotation=m):(c||p)&&(c&&p?m=n.rotation+Math.PI:(m=c?Math.PI-n.rotation:-n.rotation,n.skew+=Math.PI),n.rotation=m),n.toMatrix(o)}else d?(i.inheritRotation&&(n.rotation+=l.global.rotation),f.updateGlobalTransform(),n.scaleX*=f.global.scaleX,n.scaleY*=f.global.scaleY,y.transformPoint(n.x,n.y,n),n.toMatrix(o),i.inheritTranslation?(n.x=o.tx,n.y=o.ty):(o.tx=n.x,o.ty=n.y)):(i.inheritRotation||(l.updateGlobalTransform(),m=c&&p?n.rotation-(l.global.rotation+Math.PI):c?n.rotation+l.global.rotation+Math.PI:p?n.rotation+l.global.rotation:n.rotation-l.global.rotation,n.rotation=m),n.toMatrix(o),o.concat(y),i.inheritTranslation?(n.x=o.tx,n.y=o.ty):(o.tx=n.x,o.ty=n.y),e?n.fromMatrix(o):this._globalDirty=!0)}else(c||p)&&(c&&(n.x=-n.x),p&&(n.y=-n.y),c&&p?m=n.rotation+Math.PI:(m=c?Math.PI-n.rotation:-n.rotation,n.skew+=Math.PI),n.rotation=m),n.toMatrix(o)},Bone.prototype._updateAlpha=function(){null!==this._parent?this._globalAlpha=this._alpha*this._parent._globalAlpha:this._globalAlpha=this._alpha*this._armature._globalAlpha},Bone.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,this._alpha=this._boneData.alpha,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},Bone.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,n=this._armature._constraints;i<n.length;i++){(s=n[i])._root===this&&s.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var o=0,a=this._armature._constraints;o<a.length;o++){var s;(s=a[o])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var h=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(h),h&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},Bone.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},Bone.prototype.invalidUpdate=function(){this._transformDirty=!0},Bone.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(Bone.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var n=i[e];n.parent===this&&n._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Bone}(t.TransformObject);t.Bone=e}(c||(c={})),function(t){var e=function(t){function Surface(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return o(Surface,t),Surface.toString=function(){return"[class dragonBones.Surface]"},Surface.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0,this._bone=null},Surface.prototype._getAffineTransform=function(t,e,i,n,o,a,s,h,l,c,p,u,m){var d=s-o,f=h-a,y=l-o,g=c-a;p.rotation=Math.atan2(f,d),p.skew=Math.atan2(g,y)-.5*Math.PI-p.rotation,m&&(p.rotation+=Math.PI),p.scaleX=Math.sqrt(d*d+f*f)/i,p.scaleY=Math.sqrt(y*y+g*g)/n,p.toMatrix(u),p.x=u.tx=o-(u.a*t+u.c*e),p.y=u.ty=a-(u.b*t+u.d*e)},Surface.prototype._updateVertices=function(){var t=this._armature.armatureData.parent,e=this._boneData.geometry,i=t.intArray,n=t.floatArray,o=i[e.offset+0],a=i[e.offset+2],s=this._vertices,h=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var l=0,c=o;l<c;++l){var p=n[a+(f=2*l)]+h[f],u=n[a+f+1]+h[f+1],m=this._parent._getGlobalTransformMatrix(p,u);s[f]=m.a*p+m.c*u+m.tx,s[f+1]=m.b*p+m.d*u+m.ty}else{var d=this._parent.globalTransformMatrix;for(l=0,c=o;l<c;++l){p=n[a+(f=2*l)]+h[f],u=n[a+f+1]+h[f+1];s[f]=d.a*p+d.c*u+d.tx,s[f+1]=d.b*p+d.d*u+d.ty}}else for(l=0,c=o;l<c;++l){var f;s[f=2*l]=n[a+f]+h[f],s[f+1]=n[a+f+1]+h[f+1]}},Surface.prototype._updateGlobalTransformMatrix=function(t){var e=2*this._boneData.segmentX,i=this._vertices.length-2,n=this._vertices[0],o=this._vertices[1],a=this._vertices[e],s=this._vertices[e+1],h=this._vertices[i],l=this._vertices[i+1],c=this._vertices[i-e],p=this._vertices[i-e+1],u=n+.5*(h-n),m=o+.5*(l-o),d=u+.5*(a+.5*(c-a)-u),f=m+.5*(s+.5*(p-s)-m),y=a+.5*(h-a),g=s+.5*(l-s),_=c+.5*(h-c),v=p+.5*(l-p);this._getAffineTransform(0,0,200,200,d,f,y,g,_,v,this.global,this.globalTransformMatrix,!1),this._globalDirty=!1},Surface.prototype._getGlobalTransformMatrix=function(t,e){var i=200,n=1e3;if(t<-n||n<t||e<-n||n<e)return this.globalTransformMatrix;var o=!1,a=this._boneData,s=a.segmentX,h=a.segmentY,l=2*a.segmentX,c=this._dX,p=this._dY,u=Math.floor((t+i)/c),m=Math.floor((e+i)/p),d=0,f=u*c-i,y=m*p-i,g=this._matrixCahce,_=Surface._helpMatrix;if(t<-i){if(e<-i||e>=i)return this.globalTransformMatrix;if(g[d=7*(2*(s*h+s+h+h+m)+((o=e>this._kX*(t+i)+y)?1:0))]>0)_.copyFromArray(g,d+1);else{var v=m*(l+2),b=this._hullCache[4],P=this._hullCache[5],S=this._hullCache[2]-(h-m)*b,w=this._hullCache[3]-(h-m)*P,T=this._vertices;o?this._getAffineTransform(-i,y+p,800,p,T[v+l+2],T[v+l+3],S+b,w+P,T[v],T[v+1],Surface._helpTransform,_,!0):this._getAffineTransform(-n,y,800,p,S,w,T[v],T[v+1],S+b,w+P,Surface._helpTransform,_,!1),g[d]=1,g[d+1]=_.a,g[d+2]=_.b,g[d+3]=_.c,g[d+4]=_.d,g[d+5]=_.tx,g[d+6]=_.ty}}else if(t>=i){if(e<-i||e>=i)return this.globalTransformMatrix;if(g[d=7*(2*(s*h+s+m)+((o=e>this._kX*(t-n)+y)?1:0))]>0)_.copyFromArray(g,d+1);else{v=(m+1)*(l+2)-2,b=this._hullCache[4],P=this._hullCache[5],S=this._hullCache[0]+m*b,w=this._hullCache[1]+m*P,T=this._vertices;o?this._getAffineTransform(n,y+p,800,p,S+b,w+P,T[v+l+2],T[v+l+3],S,w,Surface._helpTransform,_,!0):this._getAffineTransform(i,y,800,p,T[v],T[v+1],S,w,T[v+l+2],T[v+l+3],Surface._helpTransform,_,!1),g[d]=1,g[d+1]=_.a,g[d+2]=_.b,g[d+3]=_.c,g[d+4]=_.d,g[d+5]=_.tx,g[d+6]=_.ty}}else if(e<-i){if(t<-i||t>=i)return this.globalTransformMatrix;if(g[d=7*(2*(s*h+u)+((o=e>this._kY*(t-f-c)-n)?1:0))]>0)_.copyFromArray(g,d+1);else{v=2*u,b=this._hullCache[10],P=this._hullCache[11],S=this._hullCache[8]+u*b,w=this._hullCache[9]+u*P,T=this._vertices;o?this._getAffineTransform(f+c,-i,c,800,T[v+2],T[v+3],T[v],T[v+1],S+b,w+P,Surface._helpTransform,_,!0):this._getAffineTransform(f,-n,c,800,S,w,S+b,w+P,T[v],T[v+1],Surface._helpTransform,_,!1),g[d]=1,g[d+1]=_.a,g[d+2]=_.b,g[d+3]=_.c,g[d+4]=_.d,g[d+5]=_.tx,g[d+6]=_.ty}}else if(e>=i){if(t<-i||t>=i)return this.globalTransformMatrix;if(g[d=7*(2*(s*h+s+h+u)+((o=e>this._kY*(t-f-c)+i)?1:0))]>0)_.copyFromArray(g,d+1);else{v=h*(l+2)+2*u,b=this._hullCache[10],P=this._hullCache[11],S=this._hullCache[6]-(s-u)*b,w=this._hullCache[7]-(s-u)*P,T=this._vertices;o?this._getAffineTransform(f+c,n,c,800,S+b,w+P,S,w,T[v+2],T[v+3],Surface._helpTransform,_,!0):this._getAffineTransform(f,i,c,800,T[v],T[v+1],T[v+2],T[v+3],S,w,Surface._helpTransform,_,!1),g[d]=1,g[d+1]=_.a,g[d+2]=_.b,g[d+3]=_.c,g[d+4]=_.d,g[d+5]=_.tx,g[d+6]=_.ty}}else if(g[d=7*(2*(s*m+u)+((o=e>this._k*(t-f-c)+y)?1:0))]>0)_.copyFromArray(g,d+1);else{v=2*u+m*(l+2),T=this._vertices;o?this._getAffineTransform(f+c,y+p,c,p,T[v+l+4],T[v+l+5],T[v+l+2],T[v+l+3],T[v+2],T[v+3],Surface._helpTransform,_,!0):this._getAffineTransform(f,y,c,p,T[v],T[v+1],T[v+2],T[v+3],T[v+l+2],T[v+l+3],Surface._helpTransform,_,!1),g[d]=1,g[d+1]=_.a,g[d+2]=_.b,g[d+3]=_.c,g[d+4]=_.d,g[d+5]=_.tx,g[d+6]=_.ty}return _},Surface.prototype.init=function(e,i){if(null===this._boneData){t.prototype.init.call(this,e,i);var n=e.segmentX,o=e.segmentY,a=this._armature.armatureData.parent.intArray[e.geometry.offset+0];this._dX=400/n,this._dY=400/o,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=2*a,this._deformVertices.length=2*a,this._matrixCahce.length=2*(n*o+2*n+2*o)*7,this._hullCache.length=10;for(var s=0;s<2*a;++s)this._deformVertices[s]=0;null!==this._parent&&(0===this._parent.boneData.type?this._bone=this._parent:this._bone=this._parent._bone)}},Surface.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,n=this._armature._constraints;i<n.length;i++){(s=n[i])._root===this&&s.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var o=0,a=this._armature._constraints;o<a.length;o++){var s;(s=a[o])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var h=0,l=this._matrixCahce.length;h<l;h+=7)this._matrixCahce[h]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var c=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(c),c&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var p=2*this.global.x,u=2*this.global.y,m=Surface._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,m),this._hullCache[0]=m.x,this._hullCache[1]=m.y,this._hullCache[2]=p-m.x,this._hullCache[3]=u-m.y,this.globalTransformMatrix.transformPoint(0,this._dY,m,!0),this._hullCache[4]=m.x,this._hullCache[5]=m.y,this.globalTransformMatrix.transformPoint(200,1e3,m),this._hullCache[6]=m.x,this._hullCache[7]=m.y,this._hullCache[8]=p-m.x,this._hullCache[9]=u-m.y,this.globalTransformMatrix.transformPoint(this._dX,0,m,!0),this._hullCache[10]=m.x,this._hullCache[11]=m.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},Surface}(t.Bone);t.Surface=e}(c||(c={})),function(t){var e=function(t){function DisplayFrame(){var e=null!==t&&t.apply(this,arguments)||this;return e.deformVertices=[],e}return o(DisplayFrame,t),DisplayFrame.toString=function(){return"[class dragonBones.DisplayFrame]"},DisplayFrame.prototype._onClear=function(){this.rawDisplayData=null,this.displayData=null,this.textureData=null,this.display=null,this.deformVertices.length=0},DisplayFrame.prototype.updateDeformVertices=function(){if(null!==this.rawDisplayData&&0===this.deformVertices.length){var t;if(2===this.rawDisplayData.type)t=this.rawDisplayData.geometry;else{if(4!==this.rawDisplayData.type)return;t=this.rawDisplayData.geometry}var e=0;e=null!==t.weight?2*t.weight.count:2*t.data.intArray[t.offset+0],this.deformVertices.length=e;for(var i=0,n=this.deformVertices.length;i<n;++i)this.deformVertices[i]=0}},DisplayFrame.prototype.getGeometryData=function(){if(null!==this.displayData){if(2===this.displayData.type)return this.displayData.geometry;if(4===this.displayData.type)return this.displayData.geometry}if(null!==this.rawDisplayData){if(2===this.rawDisplayData.type)return this.rawDisplayData.geometry;if(4===this.rawDisplayData.type)return this.rawDisplayData.geometry}return null},DisplayFrame.prototype.getBoundingBox=function(){return null!==this.displayData&&3===this.displayData.type?this.displayData.boundingBox:null!==this.rawDisplayData&&3===this.rawDisplayData.type?this.rawDisplayData.boundingBox:null},DisplayFrame.prototype.getTextureData=function(){if(null!==this.displayData){if(0===this.displayData.type)return this.displayData.texture;if(2===this.displayData.type)return this.displayData.texture}if(null!==this.textureData)return this.textureData;if(null!==this.rawDisplayData){if(0===this.rawDisplayData.type)return this.rawDisplayData.texture;if(2===this.rawDisplayData.type)return this.rawDisplayData.texture}return null},DisplayFrame}(t.BaseObject);t.DisplayFrame=e;var i=function(i){function Slot(){var e=null!==i&&i.apply(this,arguments)||this;return e._localMatrix=new t.Matrix,e._colorTransform=new t.ColorTransform,e._displayFrames=[],e._geometryBones=[],e._rawDisplay=null,e._meshDisplay=null,e._display=null,e}return o(Slot,i),Slot.prototype._onClear=function(){i.prototype._onClear.call(this);for(var e=[],n=0,o=this._displayFrames;n<o.length;n++){var a=o[n],s=a.display;s!==this._rawDisplay&&s!==this._meshDisplay&&e.indexOf(s)<0&&e.push(s),a.returnToPool()}for(var h=0,l=e;h<l.length;h++){var c=l[h];c instanceof t.Armature?c.dispose():this._disposeDisplay(c,!0)}null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDataDirty=!1,this._displayDirty=!1,this._geometryDirty=!1,this._textureDirty=!1,this._visibleDirty=!1,this._blendModeDirty=!1,this._zOrderDirty=!1,this._colorDirty=!1,this._verticesDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._zIndex=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayFrames.length=0,this._geometryBones.length=0,this._slotData=null,this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},Slot.prototype._hasDisplay=function(t){for(var e=0,i=this._displayFrames;e<i.length;e++){if(i[e].display===t)return!0}return!1},Slot.prototype._isBonesUpdate=function(){for(var t=0,e=this._geometryBones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},Slot.prototype._updateAlpha=function(){var t=this._alpha*this._parent._globalAlpha;this._globalAlpha!==t&&(this._globalAlpha=t,this._colorDirty=!0)},Slot.prototype._updateDisplayData=function(){var e=this._displayFrame,i=this._geometryData,n=this._textureData,o=null,a=null;if(this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&this._displayIndex<this._displayFrames.length&&(this._displayFrame=this._displayFrames[this._displayIndex],o=this._displayFrame.rawDisplayData,a=this._displayFrame.displayData,this._geometryData=this._displayFrame.getGeometryData(),this._boundingBoxData=this._displayFrame.getBoundingBox(),this._textureData=this._displayFrame.getTextureData()),this._displayFrame!==e||this._geometryData!==i||this._textureData!==n){if(null===this._geometryData&&null!==this._textureData){var s=null!==a&&0===a.type?a:o,h=this._textureData.parent.scale*this._armature._armatureData.scale,l=this._textureData.frame;this._pivotX=s.pivot.x,this._pivotY=s.pivot.y;var c=null!==l?l:this._textureData.region,p=c.width,u=c.height;this._textureData.rotated&&null===l&&(p=c.height,u=c.width),this._pivotX*=p*h,this._pivotY*=u*h,null!==l&&(this._pivotX+=l.x*h,this._pivotY+=l.y*h),null!==o&&s!==o&&(o.transform.toMatrix(Slot._helpMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(0,0,Slot._helpPoint),this._pivotX-=Slot._helpPoint.x,this._pivotY-=Slot._helpPoint.y,s.transform.toMatrix(Slot._helpMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(0,0,Slot._helpPoint),this._pivotX+=Slot._helpPoint.x,this._pivotY+=Slot._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*h-this._pivotY)}else this._pivotX=0,this._pivotY=0;if(this.origin=null!==o?o.transform:null!==a?a.transform:null,null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix),this._geometryData!==i)if(this._geometryDirty=!0,this._verticesDirty=!0,null!==this._geometryData){if(this._geometryBones.length=0,null!==this._geometryData.weight)for(var m=0,d=this._geometryData.weight.bones.length;m<d;++m){var f=this._armature.getBone(this._geometryData.weight.bones[m].name);this._geometryBones.push(f)}}else this._geometryBones.length=0,this._geometryData=null;this._textureDirty=this._textureData!==n,this._transformDirty=!0}},Slot.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,i=this._childArmature;if(null!==this._displayFrame?(this._display=this._displayFrame.display,null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null),(null!==this._display?this._display:this._rawDisplay)!==e&&(this._textureDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._transformDirty=!0,this._onUpdateDisplay(),this._replaceDisplay(e)),this._childArmature!==i&&(null!==i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var n=this._armature.cacheFrameRate;0!==n&&(this._childArmature.cacheFrameRate=n)}if(null!==this._displayFrame){var o=null,a=null!==this._displayFrame.displayData?this._displayFrame.displayData:this._displayFrame.rawDisplayData;if(null!==a&&1===a.type&&(o=a.actions),null!==o&&o.length>0)for(var s=0,h=o;s<h.length;s++){var l=h[s],c=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(l,c,this._armature),c.slot=this,this._armature._bufferAction(c,!1)}else this._childArmature.animation.play()}}},Slot.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},Slot.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return;this._animationDisplayIndex=t}this._displayIndex!==t&&(this._displayIndex=t<this._displayFrames.length?t:this._displayFrames.length-1,this._displayDataDirty=!0,this._displayDirty=this._displayIndex<0||this._display!==this._displayFrames[this._displayIndex].display)},Slot.prototype._setZOrder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},Slot.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0},Slot.prototype.init=function(t,e,i,n){if(null===this._slotData){this._slotData=t,this._colorDirty=!0,this._blendModeDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._zIndex=this._slotData.zIndex,this._alpha=this._slotData.alpha,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=n,this._armature=e;var o=this._armature.getBone(this._slotData.parent.name);null!==o&&(this._parent=o),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},Slot.prototype.update=function(t){if(this._displayDataDirty&&(this._updateDisplayData(),this._displayDataDirty=!1),this._displayDirty&&(this._updateDisplay(),this._displayDirty=!1),(this._geometryDirty||this._textureDirty)&&(null!==this._display&&this._display!==this._rawDisplay&&this._display!==this._meshDisplay||this._updateFrame(),this._geometryDirty=!1,this._textureDirty=!1),null!==this._display){if(this._visibleDirty&&(this._updateVisible(),this._visibleDirty=!1),this._blendModeDirty&&(this._updateBlendMode(),this._blendModeDirty=!1),this._colorDirty&&(this._updateColor(),this._colorDirty=!1),this._zOrderDirty&&(this._updateZOrder(),this._zOrderDirty=!1),null!==this._geometryData&&this._display===this._meshDisplay){var e=null!==this._geometryData.weight,i=0!==this._parent._boneData.type;if((this._verticesDirty||e&&this._isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._verticesDirty=!1,this._updateMesh()),e||i)return}if(t>=0&&null!==this._cachedFrameIndices){var n=this._cachedFrameIndices[t];n>=0&&this._cachedFrameIndex===n?this._transformDirty=!1:n>=0?(this._transformDirty=!0,this._cachedFrameIndex=n):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(this._transformDirty){if(this._cachedFrameIndex<0){var o=t>=0;this._updateGlobalTransformMatrix(o),o&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform(),this._transformDirty=!1}}},Slot.prototype.invalidUpdate=function(){this._displayDataDirty=!0,this._displayDirty=!0,this._transformDirty=!0},Slot.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._updateGlobalTransformMatrix(!1),this._transformDirty=!1)},Slot.prototype.replaceRawDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];if(i.rawDisplayData!==t){if(i.deformVertices.length=0,i.rawDisplayData=t,null===i.rawDisplayData){var n=this._armature._armatureData.defaultSkin;if(null!==n){var o=n.getDisplays(this._slotData.name);null!==o&&e<o.length&&(i.rawDisplayData=o[e])}}e===this._displayIndex&&(this._displayDataDirty=!0)}},Slot.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.displayData!==t&&i.rawDisplayData!==t&&(i.displayData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},Slot.prototype.replaceTextureData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.textureData!==t&&(i.textureData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},Slot.prototype.replaceDisplay=function(e,i){if(void 0===i&&(i=-1),i<0)i=this._displayIndex<0?0:this._displayIndex;else if(i>=this._displayFrames.length)return;var n=this._displayFrames[i];if(n.display!==e){var o=n.display;n.display=e,null===o||o===this._rawDisplay||o===this._meshDisplay||this._hasDisplay(o)||o instanceof t.Armature||this._disposeDisplay(o,!0),null===e||e===this._rawDisplay||e===this._meshDisplay||this._hasDisplay(o)||e instanceof t.Armature||this._initDisplay(e,!0),i===this._displayIndex&&(this._displayDirty=!0)}},Slot.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),Slot._helpMatrix.copyFrom(this.globalTransformMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(t,e,Slot._helpPoint),this._boundingBoxData.containsPoint(Slot._helpPoint.x,Slot._helpPoint.y))},Slot.prototype.intersectsSegment=function(t,e,i,n,o,a,s){if(void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),Slot._helpMatrix.copyFrom(this.globalTransformMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(t,e,Slot._helpPoint),t=Slot._helpPoint.x,e=Slot._helpPoint.y,Slot._helpMatrix.transformPoint(i,n,Slot._helpPoint),i=Slot._helpPoint.x,n=Slot._helpPoint.y;var h=this._boundingBoxData.intersectsSegment(t,e,i,n,o,a,s);return h>0&&(1===h||2===h?null!==o?(this.globalTransformMatrix.transformPoint(o.x,o.y,o),null!==a&&(a.x=o.x,a.y=o.y)):null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a):(null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o),null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a)),null!==s&&(this.globalTransformMatrix.transformPoint(Math.cos(s.x),Math.sin(s.x),Slot._helpPoint,!0),s.x=Math.atan2(Slot._helpPoint.y,Slot._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(s.y),Math.sin(s.y),Slot._helpPoint,!0),s.y=Math.atan2(Slot._helpPoint.y,Slot._helpPoint.x))),h},Slot.prototype.getDisplayFrameAt=function(t){return this._displayFrames[t]},Object.defineProperty(Slot.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayFrameCount",{get:function(){return this._displayFrames.length},set:function(i){var n=this._displayFrames.length;if(n<i){this._displayFrames.length=i;for(var o=n;o<i;++o)this._displayFrames[o]=t.BaseObject.borrowObject(e)}else if(n>i){for(o=n-1;o<i;--o)this.replaceDisplay(null,o),this._displayFrames[o].returnToPool();this._displayFrames.length=i}},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t),this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayList",{get:function(){for(var t=new Array,e=0,i=this._displayFrames;e<i.length;e++){var n=i[e];t.push(n.display)}return t},set:function(t){this.displayFrameCount=t.length;for(var e=0,i=0,n=t;i<n.length;i++){var o=n[i];this.replaceDisplay(o,e++)}},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"display",{get:function(){return this._display},set:function(t){this._display!==t&&(0===this._displayFrames.length&&(this.displayFrameCount=1,this._displayIndex=0),this.replaceDisplay(t,this._displayIndex))},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Slot.prototype.getDisplay=function(){return this._display},Slot.prototype.setDisplay=function(t){this.display=t},Slot}(t.TransformObject);t.Slot=i}(c||(c={})),function(t){var e=function(e){function Constraint(){return null!==e&&e.apply(this,arguments)||this}return o(Constraint,e),Constraint.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(Constraint.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),Constraint._helpMatrix=new t.Matrix,Constraint._helpTransform=new t.Transform,Constraint._helpPoint=new t.Point,Constraint}(t.BaseObject);t.Constraint=e;var i=function(e){function IKConstraint(){return null!==e&&e.apply(this,arguments)||this}return o(IKConstraint,e),IKConstraint.toString=function(){return"[class dragonBones.IKConstraint]"},IKConstraint.prototype._onClear=function(){e.prototype._onClear.call(this),this._bendPositive=!1,this._weight=1,this._constraintData=null},IKConstraint.prototype._computeA=function(){var e=this._target.global,i=this._root.global,n=this._root.globalTransformMatrix,o=Math.atan2(e.y-i.y,e.x-i.x);i.scaleX<0&&(o+=Math.PI),i.rotation+=t.Transform.normalizeRadian(o-i.rotation)*this._weight,i.toMatrix(n)},IKConstraint.prototype._computeB=function(){var e=this._bone._boneData.length,i=this._root,n=this._target.global,o=i.global,a=this._bone.global,s=this._bone.globalTransformMatrix,h=s.a*e,l=s.b*e,c=h*h+l*l,p=Math.sqrt(c),u=a.x-o.x,m=a.y-o.y,d=u*u+m*m,f=Math.sqrt(d),y=a.rotation,g=o.rotation,_=Math.atan2(m,u),v=(u=n.x-o.x)*u+(m=n.y-o.y)*m,b=Math.sqrt(v),P=0;if(p+f<=b||b+p<=f||b+f<=p)P=Math.atan2(n.y-o.y,n.x-o.x),p+f<=b||f<p&&(P+=Math.PI);else{var S=(d-c+v)/(2*v),w=Math.sqrt(d-S*S*v)/b,T=o.x+u*S,C=o.y+m*S,D=-m*w,M=u*w,O=!1,x=i.parent;if(null!==x){var E=x.globalTransformMatrix;O=E.a*E.d-E.b*E.c<0}O!==this._bendPositive?(a.x=T-D,a.y=C-M):(a.x=T+D,a.y=C+M),P=Math.atan2(a.y-o.y,a.x-o.x)}var B=t.Transform.normalizeRadian(P-_);o.rotation=g+B*this._weight,o.toMatrix(i.globalTransformMatrix);var I=_+B*this._weight;a.x=o.x+Math.cos(I)*f,a.y=o.y+Math.sin(I)*f;var A=Math.atan2(n.y-a.y,n.x-a.x);a.scaleX<0&&(A+=Math.PI),a.rotation=o.rotation+y-g+t.Transform.normalizeRadian(A-B-y)*this._weight,a.toMatrix(s)},IKConstraint.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var i=this._constraintData;this._bendPositive=i.bendPositive,this._weight=i.weight,this._root._hasConstraint=!0}},IKConstraint.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},IKConstraint.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},IKConstraint}(e);t.IKConstraint=i;var n=function(e){function PathConstraint(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return o(PathConstraint,e),PathConstraint.toString=function(){return"[class dragonBones.PathConstraint]"},PathConstraint.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},PathConstraint.prototype._updatePathVertices=function(t){var e=this._armature,i=e.armatureData.parent,n=e.armatureData.scale,o=i.intArray,a=i.floatArray,s=t.offset,h=o[s+0],l=o[s+2];this._pathGlobalVertices.length=2*h;var c=t.weight;if(null!==c)for(var p=this._pathSlot._geometryBones,u=c.bones.length,m=c.offset,d=o[m+1],f=m+2+u,y=(C=0,0);C<h;C++){for(var g=0,_=0,v=0,b=o[f++];v<b;v++){var P=p[o[f++]];if(null!==P){P.updateByConstraint();T=P.globalTransformMatrix;var S=a[d++];M=a[d++]*n,O=a[d++]*n;g+=(T.a*M+T.c*O+T.tx)*S,_+=(T.b*M+T.d*O+T.ty)*S}}this._pathGlobalVertices[y++]=g,this._pathGlobalVertices[y++]=_}else{var w=this._pathSlot.parent;w.updateByConstraint();for(var T=w.globalTransformMatrix,C=0,D=l;C<h;C+=2){var M=a[D++]*n,O=a[D++]*n,x=T.a*M+T.c*O+T.tx,E=T.b*M+T.d*O+T.ty;this._pathGlobalVertices[C]=x,this._pathGlobalVertices[C+1]=E}}},PathConstraint.prototype._computeVertices=function(t,e,i,n){for(var o=i,a=t;o<e;o+=2)n[o]=this._pathGlobalVertices[a++],n[o+1]=this._pathGlobalVertices[a++]},PathConstraint.prototype._computeBezierCurve=function(t,e,i,n,o){var a=this._armature.armatureData.parent.intArray[t.geometry.offset+0],s=this._positions,h=this._spaces,l=t.closed,c=Array(),p=2*a,u=p/6,m=-1,d=this.position;s.length=3*e+2;var f=0;if(t.constantSpeed){l?(p+=2,c.length=a,this._computeVertices(2,p-4,0,c),this._computeVertices(0,2,p-4,c),c[p-2]=c[0],c[p-1]=c[1]):(u--,p-=4,c.length=p,this._computeVertices(2,p,0,c));var y=new Array(u);f=0;for(var g,_,v,b,P,S,w,T,C=c[0],D=c[1],M=0,O=0,x=0,E=0,B=0,I=0,A=(V=0,2);V<u;V++,A+=6)M=c[A],O=c[A+1],x=c[A+2],E=c[A+3],P=2*(g=.1875*(C-2*M+x))+(v=.09375*(3*(M-x)-C+(B=c[A+4]))),S=2*(_=.1875*(D-2*O+E))+(b=.09375*(3*(O-E)-D+(I=c[A+5]))),w=.75*(M-C)+g+.16666667*v,T=.75*(O-D)+_+.16666667*b,f+=Math.sqrt(w*w+T*T),w+=P,T+=S,P+=v,S+=b,f+=Math.sqrt(w*w+T*T),w+=P,T+=S,f+=Math.sqrt(w*w+T*T),w+=P+v,T+=S+b,f+=Math.sqrt(w*w+T*T),y[V]=f,C=B,D=I;if(n&&(d*=f),o)for(V=0;V<e;V++)h[V]*=f;for(var R=this._segments,k=0,L=(V=0,W=0,z=0,0);V<e;V++,W+=3){var F=d+=h[V];if(l)(F%=f)<0&&(F+=f),z=0;else{if(F<0)continue;if(F>f)continue}for(;;z++){var N=y[z];if(!(F>N)){if(0===z)F/=N;else F=(F-(U=y[z-1]))/(N-U);break}}if(z!==m){m=z;var j=6*z;for(C=c[j],D=c[j+1],M=c[j+2],O=c[j+3],x=c[j+4],E=c[j+5],P=2*(g=.03*(C-2*M+x))+(v=.006*(3*(M-x)-C+(B=c[j+6]))),S=2*(_=.03*(D-2*O+E))+(b=.006*(3*(O-E)-D+(I=c[j+7]))),w=.3*(M-C)+g+.16666667*v,T=.3*(O-D)+_+.16666667*b,k=Math.sqrt(w*w+T*T),R[0]=k,j=1;j<8;j++)w+=P,T+=S,P+=v,S+=b,k+=Math.sqrt(w*w+T*T),R[j]=k;w+=P,T+=S,k+=Math.sqrt(w*w+T*T),R[8]=k,w+=P+v,T+=S+b,k+=Math.sqrt(w*w+T*T),R[9]=k,L=0}for(F*=k;;L++){var H=R[L];if(!(F>H)){var U;if(0===L)F/=H;else F=L+(F-(U=R[L-1]))/(H-U);break}}this.addCurvePosition(.1*F,C,D,M,O,x,E,B,I,s,W,i)}}else{var G=t.curveLengths;if(f=G[u-=l?1:2],n&&(d*=f),o)for(var V=0;V<e;V++)h[V]*=f;c.length=8;for(var V=0,W=0,z=0;V<e;V++,W+=3){if(d+=h[V],l)(d%=f)<0&&(d+=f),z=0;else{if(d<0)continue;if(d>f)continue}for(var Y=0;;z++){var X=G[z];if(!(d>X)){if(0===z)Y=d/X;else{var K=G[z-1];Y=(d-K)/(X-K)}break}}z!==m&&(m=z,l&&z===u?(this._computeVertices(p-4,4,0,c),this._computeVertices(0,4,4,c)):this._computeVertices(6*z+2,8,0,c)),this.addCurvePosition(Y,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],s,W,i)}}},PathConstraint.prototype.addCurvePosition=function(t,e,i,n,o,a,s,h,l,c,p,u){if(0===t)return c[p]=e,c[p+1]=i,void(c[p+2]=0);if(1===t)return c[p]=h,c[p+1]=l,void(c[p+2]=0);var m=1-t,d=m*m,f=t*t,y=d*m,g=d*t*3,_=m*f*3,v=t*f,b=y*e+g*n+_*a+v*h,P=y*i+g*o+_*s+v*l;c[p]=b,c[p+1]=P,c[p+2]=u?Math.atan2(P-(y*i+g*o+_*s),b-(y*e+g*n+_*a)):0},PathConstraint.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.geometry.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var n=0,o=i.bones.length;n<o;n++){var a=this._armature.getBone(i.bones[n].name);null!==a&&this._bones.push(a)}2===i.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},PathConstraint.prototype.update=function(){var e=this._pathSlot;if(null!==e._geometryData&&e._geometryData.offset===this.pathOffset){var i=this._constraintData,n=!1;if(this._root._childrenTransformDirty?(this._updatePathVertices(e._geometryData),n=!0):(e._verticesDirty||e._isBonesUpdate())&&(this._updatePathVertices(e._geometryData),e._verticesDirty=!1,n=!0),n||this.dirty){var o=i.positionMode,a=i.spacingMode,s=i.rotateMode,h=this._bones,l=0===a,c=2===s,p=0===s,u=h.length,m=p?u:u+1,d=this.spacing,f=this._spaces;if(f.length=m,c||l){f[0]=0;for(var y=0,g=m-1;y<g;y++){(E=h[y]).updateByConstraint();var _=E._boneData.length,v=_*(B=E.globalTransformMatrix).a,b=_*B.b,P=Math.sqrt(v*v+b*b);c&&(this._boneLengths[y]=P),f[y+1]=(_+d)*P/_}}else for(y=0;y<m;y++)f[y]=d;this._computeBezierCurve(e._displayFrame.rawDisplayData,m,p,1===o,2===a);var S,w=this._positions,T=this.rotateOffset,C=w[0],D=w[1];if(0===T)S=1===s;else if(S=!1,null!==(E=e.parent))T*=(B=E.globalTransformMatrix).a*B.d-B.b*B.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD;for(var M=this.rotateMix,O=this.translateMix,x=(y=0,3);y<u;y++,x+=3){var E,B;(E=h[y]).updateByConstraint(),(B=E.globalTransformMatrix).tx+=(C-B.tx)*O,B.ty+=(D-B.ty)*O;var I=(v=w[x])-C,A=(b=w[x+1])-D;if(c){var R=this._boneLengths[y],k=(Math.sqrt(I*I+A*A)/R-1)*M+1;B.a*=k,B.b*=k}if(C=v,D=b,M>0){var L=B.a,F=B.b,N=B.c,j=B.d,H=void 0,U=void 0,G=void 0;if(H=p?w[x-1]:Math.atan2(A,I),H-=Math.atan2(F,L),S){U=Math.cos(H),G=Math.sin(H);var V=E._boneData.length;C+=(V*(U*L-G*F)-I)*M,D+=(V*(G*L+U*F)-A)*M}else H+=T;H>t.Transform.PI?H-=t.Transform.PI_D:H<-t.Transform.PI&&(H+=t.Transform.PI_D),H*=M,U=Math.cos(H),G=Math.sin(H),B.a=U*L-G*F,B.b=G*L+U*F,B.c=U*N-G*j,B.d=G*N+U*j}E.global.fromMatrix(B)}this.dirty=!1}}},PathConstraint.prototype.invalidUpdate=function(){},PathConstraint}(e);t.PathConstraint=n}(c||(c={})),function(t){var e=function(){function WorldClock(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return WorldClock.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var i=0,n=0,o=this._animatebles.length;i<o;++i){var a=this._animatebles[i];null!==a?(n>0&&(this._animatebles[i-n]=a,this._animatebles[i]=null),a.advanceTime(t)):n++}if(n>0){for(o=this._animatebles.length;i<o;++i){var s=this._animatebles[i];null!==s?this._animatebles[i-n]=s:n++}this._animatebles.length-=n}}},WorldClock.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},WorldClock.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},WorldClock.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},WorldClock.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(WorldClock.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),WorldClock}();t.WorldClock=e}(c||(c={})),function(t){var e=function(e){function Animation(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._blendStates={},t._animationConfig=null,t}return o(Animation,e),Animation.toString=function(){return"[class dragonBones.Animation]"},Animation.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}for(var i in this._animations)delete this._animations[i];for(var i in this._blendStates){var n=this._blendStates[i];for(var o in n)n[o].returnToPool();delete this._blendStates[i]}null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},Animation.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++){null===(c=i[e])._parent&&(c.layer===t.layer&&c.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 2:for(var n=0,o=this._animationStates;n<o.length;n++){null===(c=o[n])._parent&&(c.group===t.group&&c.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 3:for(var a=0,s=this._animationStates;a<s.length;a++){null===(c=s[a])._parent&&(c.layer===t.layer&&c.group===t.group&&c.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 4:for(var h=0,l=this._animationStates;h<l.length;h++){var c;null===(c=l[h])._parent&&c.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},Animation.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},Animation.prototype.advanceTime=function(t){for(var e in t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale),this._blendStates){var i=this._blendStates[e];for(var n in i)i[n].reset()}var o=this._animationStates.length;if(1===o)if((g=this._animationStates[0])._fadeState>0&&g._subFadeState>0)this._armature._dragonBones.bufferObject(g),this._animationStates.length=0,this._lastAnimationState=null;else{var a=g.animationData,s=a.cacheFrameRate;if(this._animationDirty&&s>0){this._animationDirty=!1;for(var h=0,l=this._armature.getBones();h<l.length;h++){var c=l[h];c._cachedFrameIndices=a.getBoneCachedFrameIndices(c.name)}for(var p=0,u=this._armature.getSlots();p<u.length;p++){var m=u[p];if(m.displayFrameCount>0){var d=m.getDisplayFrameAt(0).rawDisplayData;if(null!==d&&d.parent===this._armature.armatureData.defaultSkin){m._cachedFrameIndices=a.getSlotCachedFrameIndices(m.name);continue}}m._cachedFrameIndices=null}}g.advanceTime(t,s)}else if(o>1){for(var f=0,y=0;f<o;++f){var g;(g=this._animationStates[f])._fadeState>0&&g._subFadeState>0?(y++,this._armature._dragonBones.bufferObject(g),this._animationDirty=!0,this._lastAnimationState===g&&(this._lastAnimationState=null)):(y>0&&(this._animationStates[f-y]=g),g.advanceTime(t,0)),f===o-1&&y>0&&(this._animationStates.length-=y,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},Animation.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},Animation.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(n=this.getState(t))&&n.stop();else for(var e=0,i=this._animationStates;e<i.length;e++){var n;(n=i[e]).stop()}},Animation.prototype.playConfig=function(e){var i=e.animation;if(!(i in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+i),null;var n=this._animations[i];if(5===e.fadeOutMode)for(var o=0,a=this._animationStates;o<a.length;o++){var s=a[o];if(s._fadeState<1&&s.layer===e.layer&&s.animationData===n)return s}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=n.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/n.scale),n.frameCount>0?(e.position<0?(e.position%=n.duration,e.position=n.duration-e.position):e.position===n.duration?e.position-=1e-6:e.position>n.duration&&(e.position%=n.duration),e.duration>0&&e.position+e.duration>n.duration&&(e.duration=n.duration-e.position),e.playTimes<0&&(e.playTimes=n.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var h=t.BaseObject.borrowObject(t.AnimationState);if(h.init(this._armature,n,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var l=!1,c=0,p=this._animationStates.length;c<p;++c){if(h.layer>this._animationStates[c].layer){l=!0,this._animationStates.splice(c,0,h);break}if(c!==p-1&&h.layer>this._animationStates[c+1].layer){l=!0,this._animationStates.splice(c+1,0,h);break}}l||this._animationStates.push(h)}else this._animationStates.push(h);for(var u=0,m=this._armature.getSlots();u<m.length;u++){var d=m[u].childArmature;null!==d&&d.inheritAnimation&&d.animation.hasAnimation(i)&&null===d.animation.getState(i)&&d.animation.fadeIn(i)}for(var f in n.animationTimelines){var y=this.fadeIn(f,0,1,h.layer,"",5);if(null!==y){var g=n.animationTimelines[f];y.actionEnabled=!1,y.resetToPose=!1,y.stop(),h.addState(y,g);var _=this._animationStates.indexOf(h),v=this._animationStates.indexOf(y);v<_&&(this._animationStates.splice(_,1),this._animationStates.splice(v,0,h))}}return this._lastAnimationState=h,h},Animation.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;null!==i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},Animation.prototype.fadeIn=function(t,e,i,n,o,a){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===n&&(n=0),void 0===o&&(o=null),void 0===a&&(a=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=a,this._animationConfig.playTimes=i,this._animationConfig.layer=n,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==o?o:"",this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var n=t in this._animations?this._animations[t]:null;return null!==n&&(this._animationConfig.position=n.frameCount>0?n.duration*e/n.frameCount:0),this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var n=t in this._animations?this._animations[t]:null;return null!==n&&(this._animationConfig.position=n.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},Animation.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.getBlendState=function(e,i,n){e in this._blendStates||(this._blendStates[e]={});var o=this._blendStates[e];i in o||((o[i]=t.BaseObject.borrowObject(t.BlendState)).target=n);return o[i]},Animation.prototype.getState=function(t,e){void 0===e&&(e=-1);for(var i=this._animationStates.length;i--;){var n=this._animationStates[i];if(n.name===t&&(e<0||n.layer===e))return n}return null},Animation.prototype.hasAnimation=function(t){return t in this._animations},Animation.prototype.getStates=function(){return this._animationStates},Object.defineProperty(Animation.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(e[t].isPlaying)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(!e[t].isCompleted)return!1}return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),Animation}(t.BaseObject);t.Animation=e}(c||(c={})),function(t){var e=function(e){function AnimationState(){var t=null!==e&&e.apply(this,arguments)||this;return t._boneMask=[],t._boneTimelines=[],t._boneBlendTimelines=[],t._slotTimelines=[],t._slotBlendTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._actionTimeline=null,t._zOrderTimeline=null,t}return o(AnimationState,e),AnimationState.toString=function(){return"[class dragonBones.AnimationState]"},AnimationState.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++){(m=e[t]).returnToPool()}for(var i=0,n=this._boneBlendTimelines;i<n.length;i++){(m=n[i]).returnToPool()}for(var o=0,a=this._slotTimelines;o<a.length;o++){(m=a[o]).returnToPool()}for(var s=0,h=this._slotBlendTimelines;s<h.length;s++){(m=h[s]).returnToPool()}for(var l=0,c=this._constraintTimelines;l<c.length;l++){(m=c[l]).returnToPool()}for(var p=0,u=this._animationTimelines;p<u.length;p++){var m,d=(m=u[p]).target;d._parent===this&&(d._fadeState=1,d._subFadeState=1,d._parent=null),m.returnToPool()}null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additive=!1,this.displayControl=!1,this.resetToPose=!1,this.blendType=0,this.playTimes=1,this.layer=0,this.timeScale=1,this._weight=1,this.parameterX=0,this.parameterY=0,this.positionX=0,this.positionY=0,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._boneMask.length=0,this._boneTimelines.length=0,this._boneBlendTimelines.length=0,this._slotTimelines.length=0,this._slotBlendTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._activeChildA=null,this._activeChildB=null,this._parent=null},AnimationState.prototype._updateTimelines=function(){for(var e=0,i=this._armature._constraints;e<i.length;e++){var n=i[e],o=this._animationData.getConstraintTimelines(n.name);if(null!==o)for(var a=0,s=o;a<s.length;a++){var h=s[a];switch(h.type){case 30:(l=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).target=n,l.init(this._armature,this,h),this._constraintTimelines.push(l)}}else if(this.resetToPose){var l;(l=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).target=n,l.init(this._armature,this,null),this._constraintTimelines.push(l),this._poseTimelines.push(l)}}},AnimationState.prototype._updateBoneAndSlotTimelines=function(){for(var e={},n=0,o=this._boneTimelines;n<o.length;n++){(p=(v=o[n]).target.target.name)in e||(e[p]=[]),e[p].push(v)}for(var a=0,s=this._boneBlendTimelines;a<s.length;a++){(p=(v=s[a]).target.target.name)in e||(e[p]=[]),e[p].push(v)}for(var h=0,l=this._armature.getBones();h<l.length;h++){var c=l[h],p=c.name;if(this.containsBoneMask(p))if(p in e)delete e[p];else{var u=this._animationData.getBoneTimelines(p),m=this._armature.animation.getBlendState(i.BONE_TRANSFORM,c.name,c);if(null!==u)for(var d=0,f=u;d<f.length;d++){switch((R=f[d]).type){case 10:(v=t.BaseObject.borrowObject(t.BoneAllTimelineState)).target=m,v.init(this._armature,this,R),this._boneTimelines.push(v);break;case 11:(v=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).target=m,v.init(this._armature,this,R),this._boneTimelines.push(v);break;case 12:(v=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).target=m,v.init(this._armature,this,R),this._boneTimelines.push(v);break;case 13:(v=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).target=m,v.init(this._armature,this,R),this._boneTimelines.push(v);break;case 60:(v=t.BaseObject.borrowObject(t.AlphaTimelineState)).target=this._armature.animation.getBlendState(i.BONE_ALPHA,c.name,c),v.init(this._armature,this,R),this._boneBlendTimelines.push(v);break;case 50:(v=t.BaseObject.borrowObject(t.SurfaceTimelineState)).target=this._armature.animation.getBlendState(i.SURFACE,c.name,c),v.init(this._armature,this,R),this._boneBlendTimelines.push(v)}}else if(this.resetToPose){if(0===c._boneData.type)(v=t.BaseObject.borrowObject(t.BoneAllTimelineState)).target=m,v.init(this._armature,this,null),this._boneTimelines.push(v),this._poseTimelines.push(v);else(v=t.BaseObject.borrowObject(t.SurfaceTimelineState)).target=this._armature.animation.getBlendState(i.SURFACE,c.name,c),v.init(this._armature,this,null),this._boneBlendTimelines.push(v),this._poseTimelines.push(v)}}}for(var y in e)for(var g=0,_=e[y];g<_.length;g++){var v=_[g];(z=this._boneTimelines.indexOf(v))>=0&&(this._boneTimelines.splice(z,1),v.returnToPool()),(z=this._boneBlendTimelines.indexOf(v))>=0&&(this._boneBlendTimelines.splice(z,1),v.returnToPool())}for(var b={},P=[],S=0,w=this._slotTimelines;S<w.length;S++){(p=(v=w[S]).target.name)in b||(b[p]=[]),b[p].push(v)}for(var T=0,C=this._slotBlendTimelines;T<C.length;T++){(p=(v=C[T]).target.target.name)in b||(b[p]=[]),b[p].push(v)}for(var D=0,M=this._armature.getSlots();D<M.length;D++){var O=M[D],x=O.parent.name;if(this.containsBoneMask(x))if((p=O.name)in b)delete b[p];else{var E=!1,B=!1;if(P.length=0,null!==(u=this._animationData.getSlotTimelines(p)))for(var I=0,A=u;I<A.length;I++){var R;switch((R=A[I]).type){case 20:(v=t.BaseObject.borrowObject(t.SlotDisplayTimelineState)).target=O,v.init(this._armature,this,R),this._slotTimelines.push(v),E=!0;break;case 23:(v=t.BaseObject.borrowObject(t.SlotZIndexTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_Z_INDEX,O.name,O),v.init(this._armature,this,R),this._slotBlendTimelines.push(v);break;case 21:(v=t.BaseObject.borrowObject(t.SlotColorTimelineState)).target=O,v.init(this._armature,this,R),this._slotTimelines.push(v),B=!0;break;case 22:var k=this._animationData.parent.parent,L=k.timelineArray,F=this._animationData.frameIntOffset+L[R.offset+3],N=k.frameIntArray[F+0];N<0&&(N+=65536);for(var j=0,H=O.displayFrameCount;j<H;++j){if(null!==(G=(U=O.getDisplayFrameAt(j)).getGeometryData())&&G.offset===N){(v=t.BaseObject.borrowObject(t.DeformTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_DEFORM,U.rawDisplayData.name,O),v.displayFrame=U,v.init(this._armature,this,R),this._slotBlendTimelines.push(v),U.updateDeformVertices(),P.push(N);break}}break;case 24:(v=t.BaseObject.borrowObject(t.AlphaTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_ALPHA,O.name,O),v.init(this._armature,this,R),this._slotBlendTimelines.push(v)}}if(this.resetToPose){if(!E)(v=t.BaseObject.borrowObject(t.SlotDisplayTimelineState)).target=O,v.init(this._armature,this,null),this._slotTimelines.push(v),this._poseTimelines.push(v);if(!B)(v=t.BaseObject.borrowObject(t.SlotColorTimelineState)).target=O,v.init(this._armature,this,null),this._slotTimelines.push(v),this._poseTimelines.push(v);for(j=0,H=O.displayFrameCount;j<H;++j){var U,G;if(0!==(U=O.getDisplayFrameAt(j)).deformVertices.length)if(null!==(G=U.getGeometryData())&&P.indexOf(G.offset)<0)(v=t.BaseObject.borrowObject(t.DeformTimelineState)).displayFrame=U,v.target=this._armature.animation.getBlendState(i.SLOT_DEFORM,O.name,O),v.init(this._armature,this,null),this._slotBlendTimelines.push(v),this._poseTimelines.push(v)}}}}for(var y in b)for(var V=0,W=b[y];V<W.length;V++){var z;v=W[V];(z=this._slotTimelines.indexOf(v))>=0&&(this._slotTimelines.splice(z,1),v.returnToPool()),(z=this._slotBlendTimelines.indexOf(v))>=0&&(this._slotBlendTimelines.splice(z,1),v.returnToPool())}},AnimationState.prototype._advanceFadeTime=function(e){var i=this._fadeState>0;if(this._subFadeState<0&&(this._subFadeState=0,null===this._parent&&this.actionEnabled)){var n=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasDBEventListener(n))(o=t.BaseObject.borrowObject(t.EventObject)).type=n,o.armature=this._armature,o.animationState=this,this._armature._dragonBones.bufferEvent(o)}if((e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0)&&(i||(this._playheadState|=1,this._fadeState=0),null===this._parent&&this.actionEnabled)){var o;n=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasDBEventListener(n))(o=t.BaseObject.borrowObject(t.EventObject)).type=n,o.armature=this._armature,o.animationState=this,this._armature._dragonBones.bufferEvent(o)}},AnimationState.prototype.init=function(e,i,n){if(null===this._armature){if(this._armature=e,this._animationData=i,this.resetToPose=n.resetToPose,this.additive=n.additive,this.displayControl=n.displayControl,this.actionEnabled=n.actionEnabled,this.blendType=i.blendType,this.layer=n.layer,this.playTimes=n.playTimes,this.timeScale=n.timeScale,this.fadeTotalTime=n.fadeInTime,this.autoFadeOutTime=n.autoFadeOutTime,this.name=n.name.length>0?n.name:n.animation,this.group=n.group,this._weight=n.weight,n.pauseFadeIn?this._playheadState=2:this._playheadState=3,n.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==n.position?this.timeScale>=0?this._time=n.position:this._time=n.position-this._duration:this._time=0):(this._position=n.position,this._duration=n.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),n.boneMask.length>0){this._boneMask.length=n.boneMask.length;for(var o=0,a=this._boneMask.length;o<a;++o)this._boneMask[o]=n.boneMask[o]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},AnimationState.prototype.advanceTime=function(t,e){0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines());var i=0!==this._fadeState||0===this._subFadeState,n=0===this._fadeState&&e>0,o=!0,a=!0,s=this._time;if(this._weightResult=this._weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult),this._actionTimeline.playState<=0&&this._actionTimeline.update(s),0!==this._weight){if(n){var h=2*e;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*h)/h}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(s),n){var l=Math.floor(this._actionTimeline.currentTime*e);this._armature._cacheFrameIndex===l?(o=!1,a=!1):(this._armature._cacheFrameIndex=l,this._animationData.cachedFrames[l]?a=!1:this._animationData.cachedFrames[l]=!0)}if(o){var c=!1,p=null;if(a)for(var u=0,m=this._boneTimelines.length;u<m;++u){if((C=this._boneTimelines[u]).playState<=0&&C.update(s),C.target!==p)if(c=(y=C.target).update(this),p=y,1===y.dirty){var d=y.target.animationPose;d.x=0,d.y=0,d.rotation=0,d.skew=0,d.scaleX=1,d.scaleY=1}c&&C.blend(i)}for(u=0,m=this._boneBlendTimelines.length;u<m;++u){(C=this._boneBlendTimelines[u]).playState<=0&&C.update(s),C.target.update(this)&&C.blend(i)}if(this.displayControl)for(u=0,m=this._slotTimelines.length;u<m;++u){if((C=this._slotTimelines[u]).playState<=0){var f=C.target.displayController;null!==f&&f!==this.name&&f!==this.group||C.update(s)}}for(u=0,m=this._slotBlendTimelines.length;u<m;++u){if((C=this._slotBlendTimelines[u]).playState<=0){var y=C.target;C.update(s),y.update(this)&&C.blend(i)}}for(u=0,m=this._constraintTimelines.length;u<m;++u){(C=this._constraintTimelines[u]).playState<=0&&C.update(s)}if(this._animationTimelines.length>0){var g=100,_=100,v=null,b=null;for(u=0,m=this._animationTimelines.length;u<m;++u){if((C=this._animationTimelines[u]).playState<=0&&C.update(s),1===this.blendType){var P=C.target,S=this.parameterX-P.positionX;S>=0?S<g&&(g=S,v=P):-S<_&&(_=-S,b=P)}}null!==v&&(this._activeChildA!==v&&(null!==this._activeChildA&&(this._activeChildA.weight=0),this._activeChildA=v,this._activeChildA.activeTimeline()),this._activeChildB!==b&&(null!==this._activeChildB&&(this._activeChildB.weight=0),this._activeChildB=b),v.weight=_/(g+_),b&&(b.weight=1-v.weight))}}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var w=0,T=this._poseTimelines;w<T.length;w++){var C=T[w],D=this._boneTimelines.indexOf(C);D>=0?(this._boneTimelines.splice(D,1),C.returnToPool()):(D=this._boneBlendTimelines.indexOf(C))>=0?(this._boneBlendTimelines.splice(D,1),C.returnToPool()):(D=this._slotTimelines.indexOf(C))>=0?(this._slotTimelines.splice(D,1),C.returnToPool()):(D=this._slotBlendTimelines.indexOf(C))>=0?(this._slotBlendTimelines.splice(D,1),C.returnToPool()):(D=this._constraintTimelines.indexOf(C))>=0&&(this._constraintTimelines.splice(D,1),C.returnToPool())}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},AnimationState.prototype.play=function(){this._playheadState=3},AnimationState.prototype.stop=function(){this._playheadState&=1},AnimationState.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,n=this._boneTimelines;i<n.length;i++){(f=n[i]).fadeOut()}for(var o=0,a=this._boneBlendTimelines;o<a.length;o++){(f=a[o]).fadeOut()}for(var s=0,h=this._slotTimelines;s<h.length;s++){(f=h[s]).fadeOut()}for(var l=0,c=this._slotBlendTimelines;l<c.length;l++){(f=c[l]).fadeOut()}for(var p=0,u=this._constraintTimelines;p<u.length;p++){(f=u[p]).fadeOut()}for(var m=0,d=this._animationTimelines;m<d.length;m++){var f;(f=d[m]).fadeOut(),f.target.fadeOut(999999,!0)}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},AnimationState.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},AnimationState.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var n=0,o=this._armature.getBones();n<o.length;n++){var a=o[n];this._boneMask.indexOf(a.name)<0&&i.contains(a)&&this._boneMask.push(a.name)}this._timelineDirty=1}},AnimationState.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var n=this._armature.getBone(t);if(null!==n){var o=this._armature.getBones();if(this._boneMask.length>0)for(var a=0,s=o;a<s.length;a++){var h=s[a],l=this._boneMask.indexOf(h.name);l>=0&&n.contains(h)&&this._boneMask.splice(l,1)}else for(var c=0,p=o;c<p.length;c++){(h=p[c])!==n&&(n.contains(h)||this._boneMask.push(h.name))}}}this._timelineDirty=1},AnimationState.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},AnimationState.prototype.addState=function(e,i){if(void 0===i&&(i=null),null!==i)for(var n=0,o=i;n<o.length;n++){var a=o[n];switch(a.type){case 40:if((h=t.BaseObject.borrowObject(t.AnimationProgressTimelineState)).target=e,h.init(this._armature,this,a),this._animationTimelines.push(h),0!==this.blendType){var s=a;e.positionX=s.x,e.positionY=s.y,e.weight=0}e._parent=this,this.resetToPose=!1;break;case 41:(h=t.BaseObject.borrowObject(t.AnimationWeightTimelineState)).target=e,h.init(this._armature,this,a),this._animationTimelines.push(h);break;case 42:var h;(h=t.BaseObject.borrowObject(t.AnimationParametersTimelineState)).target=e,h.init(this._armature,this,a),this._animationTimelines.push(h)}}null===e._parent&&(e._parent=this)},AnimationState.prototype.activeTimeline=function(){for(var t=0,e=this._slotTimelines;t<e.length;t++){var i=e[t];i.dirty=!0,i.currentTime=-1}},Object.defineProperty(AnimationState.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&null===this._parent&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,n=this._boneTimelines;i<n.length;i++){n[i].playState=-1}for(var o=0,a=this._slotTimelines;o<a.length;o++){a[o].playState=-1}}},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"weight",{get:function(){return this._weight},set:function(t){if(this._weight!==t){this._weight=t;for(var e=0,i=this._boneTimelines;e<i.length;e++){i[e].dirty=!0}for(var n=0,o=this._boneBlendTimelines;n<o.length;n++){o[n].dirty=!0}for(var a=0,s=this._slotBlendTimelines;a<s.length;a++){s[a].dirty=!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),AnimationState}(t.BaseObject);t.AnimationState=e;var i=function(t){function BlendState(){return null!==t&&t.apply(this,arguments)||this}return o(BlendState,t),BlendState.toString=function(){return"[class dragonBones.BlendState]"},BlendState.prototype._onClear=function(){this.reset(),this.target=null},BlendState.prototype.update=function(t){var e=t.layer,i=t._weightResult;if(this.dirty>0){if(this.leftWeight>0){if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.dirty++,this.layer=e,this.leftWeight=0,this.blendWeight=0,!1;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return i*=this.leftWeight,this.dirty++,this.blendWeight=i,this.layerWeight+=this.blendWeight,!0}return!1}return this.dirty++,this.layer=e,this.leftWeight=1,this.blendWeight=i,this.layerWeight=i,!0},BlendState.prototype.reset=function(){this.dirty=0,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},BlendState.BONE_TRANSFORM="boneTransform",BlendState.BONE_ALPHA="boneAlpha",BlendState.SURFACE="surface",BlendState.SLOT_DEFORM="slotDeform",BlendState.SLOT_ALPHA="slotAlpha",BlendState.SLOT_Z_INDEX="slotZIndex",BlendState}(t.BaseObject);t.BlendState=i}(c||(c={})),function(t){var e=function(t){function TimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(TimelineState,t),TimelineState.prototype._onClear=function(){this.dirty=!1,this.playState=-1,this.currentPlayTimes=0,this.currentTime=-1,this.target=null,this._isTween=!1,this._valueOffset=0,this._frameValueOffset=0,this._frameOffset=0,this._frameRate=0,this._frameCount=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._valueArray=null,this._timelineArray=null,this._frameIndices=null},TimelineState.prototype._setCurrentTime=function(t){var e=this.playState,i=this.currentPlayTimes,n=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var o=this._animationState.playTimes,a=o*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),o>0&&(t>=a||t<=-a)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=o,this.currentTime=t<0?0:1===this.playState?this._duration+1e-6:this._duration):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==i||this.currentTime!==n)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i)&&(this._frameIndex=-1),!0)},TimelineState.prototype.init=function(t,e,i){if(this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState.animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,null!==this._timelineData){var n=this._animationData.parent.parent;this._frameArray=n.frameArray,this._timelineArray=n.timelineArray,this._frameIndices=n.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1]}},TimelineState.prototype.fadeOut=function(){this.dirty=!1},TimelineState.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),i=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==i&&(this._frameIndex=i,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());(this._isTween||this.dirty)&&this._onUpdateFrame()}},TimelineState.prototype.blend=function(t){},TimelineState}(t.BaseObject);t.TimelineState=e;var i=function(t){function TweenTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(TweenTimelineState,t),TweenTimelineState._getEasingValue=function(t,e,i){var n=e;switch(t){case 3:n=Math.pow(e,2);break;case 4:n=1-Math.pow(1-e,2);break;case 5:n=.5*(1-Math.cos(e*Math.PI))}return(n-e)*i+e},TweenTimelineState._getEasingCurveValue=function(t,e,i,n){if(t<=0)return 0;if(t>=1)return 1;var o=i>0,a=i+1,s=Math.floor(t*a),h=0,l=0;return o?(h=0===s?0:e[n+s-1],l=s===a-1?1e4:e[n+s]):(h=e[n+s-1],l=e[n+s]),1e-4*(h+(l-h)*(t*a-s))},TweenTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenEasing=0,this._tweenProgress=0,this._valueScale=1},TweenTimelineState.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._isTween=0!==this._tweenType,this._isTween?2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]):this.dirty=!0,this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this.dirty=!0,this._isTween=!1},TweenTimelineState.prototype._onUpdateFrame=function(){this._isTween&&(this.dirty=!0,this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=TweenTimelineState._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=TweenTimelineState._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing)))},TweenTimelineState}(e);t.TweenTimelineState=i;var n=function(t){function SingleValueTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(SingleValueTimelineState,t),SingleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._difference=0,this._result=0},SingleValueTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,n=this._valueOffset+this._frameValueOffset+this._frameIndex;if(this._isTween){var o=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:n+1;1===e?(this._current=i[n],this._difference=i[o]-this._current):(this._current=i[n]*e,this._difference=i[o]*e-this._current)}else this._result=i[n]*e}else this._result=0},SingleValueTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result=this._current+this._difference*this._tweenProgress)},SingleValueTimelineState}(i);t.SingleValueTimelineState=n;var a=function(t){function DoubleValueTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(DoubleValueTimelineState,t),DoubleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._currentA=0,this._currentB=0,this._differenceA=0,this._differenceB=0,this._resultA=0,this._resultB=0},DoubleValueTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,n=this._valueOffset+this._frameValueOffset+2*this._frameIndex;if(this._isTween){var o=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:n+2;1===e?(this._currentA=i[n],this._currentB=i[n+1],this._differenceA=i[o]-this._currentA,this._differenceB=i[o+1]-this._currentB):(this._currentA=i[n]*e,this._currentB=i[n+1]*e,this._differenceA=i[o]*e-this._currentA,this._differenceB=i[o+1]*e-this._currentB)}else this._resultA=i[n]*e,this._resultB=i[n+1]*e}else this._resultA=0,this._resultB=0},DoubleValueTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._resultA=this._currentA+this._differenceA*this._tweenProgress,this._resultB=this._currentB+this._differenceB*this._tweenProgress)},DoubleValueTimelineState}(i);t.DoubleValueTimelineState=a;var s=function(t){function MutilpleValueTimelineState(){var e=null!==t&&t.apply(this,arguments)||this;return e._rd=[],e}return o(MutilpleValueTimelineState,t),MutilpleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._valueCount=0,this._rd.length=0},MutilpleValueTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this._valueCount,i=this._rd;if(null!==this._timelineData){var n=this._valueScale,o=this._valueArray,a=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(this._isTween){var s=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:a+e;if(1===n)for(var h=0;h<e;++h)i[e+h]=o[s+h]-o[a+h];else for(h=0;h<e;++h)i[e+h]=(o[s+h]-o[a+h])*n}else if(1===n)for(h=0;h<e;++h)i[h]=o[a+h];else for(h=0;h<e;++h)i[h]=o[a+h]*n}else for(h=0;h<e;++h)i[h]=0},MutilpleValueTimelineState.prototype._onUpdateFrame=function(){if(t.prototype._onUpdateFrame.call(this),this._isTween){var e=this._valueCount,i=this._valueScale,n=this._tweenProgress,o=this._valueArray,a=this._rd,s=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(1===i)for(var h=0;h<e;++h)a[h]=o[s+h]+a[e+h]*n;else for(h=0;h<e;++h)a[h]=o[s+h]*i+a[e+h]*n}},MutilpleValueTimelineState}(i);t.MutilpleValueTimelineState=s}(c||(c={})),function(t){var e=function(e){function ActionTimelineState(){return null!==e&&e.apply(this,arguments)||this}return o(ActionTimelineState,e),ActionTimelineState.toString=function(){return"[class dragonBones.ActionTimelineState]"},ActionTimelineState.prototype._onCrossFrame=function(e){var i=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var n=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],o=this._frameArray[n+1],a=this._animationData.parent.actions,s=0;s<o;++s){var h=a[this._frameArray[n+2+s]];if(0===h.type){(l=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[n]/this._frameRate,l.animationState=this._animationState,t.EventObject.actionDataToInstance(h,l,this._armature),this._armature._bufferAction(l,!0)}else{var l,c=10===h.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;if(11===h.type||i.hasDBEventListener(c))(l=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[n]/this._frameRate,l.animationState=this._animationState,t.EventObject.actionDataToInstance(h,l,this._armature),this._armature._dragonBones.bufferEvent(l)}}},ActionTimelineState.prototype._onArriveAtFrame=function(){},ActionTimelineState.prototype._onUpdateFrame=function(){},ActionTimelineState.prototype.update=function(e){var i=this.playState,n=this.currentPlayTimes,o=this.currentTime;if(this._setCurrentTime(e)){var a=null===this._animationState._parent&&this._animationState.actionEnabled,s=this._armature.eventDispatcher;if(i<0){if(this.playState===i)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),a&&s.hasDBEventListener(t.EventObject.START)){var h=t.BaseObject.borrowObject(t.EventObject);h.type=t.EventObject.START,h.armature=this._armature,h.animationState=this._animationState,this._armature._dragonBones.bufferEvent(h)}}var l=this._animationState.timeScale<0,c=null,p=null;if(a&&this.currentPlayTimes!==n&&(s.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((c=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,c.armature=this._armature,c.animationState=this._animationState),this.playState>0&&s.hasDBEventListener(t.EventObject.COMPLETE)&&((p=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,p.armature=this._armature,p.animationState=this._animationState)),this._frameCount>1){var u=this._timelineData,m=Math.floor(this.currentTime*this._frameRate),d=this._frameIndices[u.frameIndicesOffset+m];if(this._frameIndex!==d){var f=this._frameIndex;if(this._frameIndex=d,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[u.offset+5+this._frameIndex],l){if(f<0){var y=Math.floor(o*this._frameRate);f=this._frameIndices[u.frameIndicesOffset+y],this.currentPlayTimes===n&&f===d&&(f=-1)}for(;f>=0;){var g=this._animationData.frameOffset+this._timelineArray[u.offset+5+f],_=this._frameArray[g]/this._frameRate;if(this._position<=_&&_<=this._position+this._duration&&this._onCrossFrame(f),null!==c&&0===f&&(this._armature._dragonBones.bufferEvent(c),c=null),f>0?f--:f=this._frameCount-1,f===d)break}}else{if(f<0){y=Math.floor(o*this._frameRate);f=this._frameIndices[u.frameIndicesOffset+y];g=this._animationData.frameOffset+this._timelineArray[u.offset+5+f],_=this._frameArray[g]/this._frameRate;this.currentPlayTimes===n&&(o<=_?f>0?f--:f=this._frameCount-1:f===d&&(f=-1))}for(;f>=0;){f<this._frameCount-1?f++:f=0;g=this._animationData.frameOffset+this._timelineArray[u.offset+5+f],_=this._frameArray[g]/this._frameRate;if(this._position<=_&&_<=this._position+this._duration&&this._onCrossFrame(f),null!==c&&0===f&&(this._armature._dragonBones.bufferEvent(c),c=null),f===d)break}}}}else if(this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];_=this._frameArray[this._frameOffset]/this._frameRate;this.currentPlayTimes===n?o<=_&&this._onCrossFrame(this._frameIndex):this._position<=_&&(l||null===c||(this._armature._dragonBones.bufferEvent(c),c=null),this._onCrossFrame(this._frameIndex))}null!==c&&this._armature._dragonBones.bufferEvent(c),null!==p&&this._armature._dragonBones.bufferEvent(p)}},ActionTimelineState.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},ActionTimelineState}(t.TimelineState);t.ActionTimelineState=e;var i=function(t){function ZOrderTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(ZOrderTimelineState,t),ZOrderTimelineState.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},ZOrderTimelineState.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},ZOrderTimelineState.prototype._onUpdateFrame=function(){},ZOrderTimelineState}(t.TimelineState);t.ZOrderTimelineState=i;var n=function(e){function BoneAllTimelineState(){return null!==e&&e.apply(this,arguments)||this}return o(BoneAllTimelineState,e),BoneAllTimelineState.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},BoneAllTimelineState.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])),null===this._timelineData&&(this._rd[4]=1,this._rd[5]=1)},BoneAllTimelineState.prototype.init=function(t,i,n){e.prototype.init.call(this,t,i,n),this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=6,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneAllTimelineState.prototype.fadeOut=function(){this.dirty=!1,this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])},BoneAllTimelineState.prototype.blend=function(t){var e=this._armature.armatureData.scale,i=this._rd,n=this.target,o=n.target,a=n.blendWeight,s=o.animationPose;n.dirty>1?(s.x+=i[0]*a*e,s.y+=i[1]*a*e,s.rotation+=i[2]*a,s.skew+=i[3]*a,s.scaleX+=(i[4]-1)*a,s.scaleY+=(i[5]-1)*a):(s.x=i[0]*a*e,s.y=i[1]*a*e,s.rotation=i[2]*a,s.skew=i[3]*a,s.scaleX=(i[4]-1)*a+1,s.scaleY=(i[5]-1)*a+1),(t||this.dirty)&&(this.dirty=!1,o._transformDirty=!0)},BoneAllTimelineState}(t.MutilpleValueTimelineState);t.BoneAllTimelineState=n;var a=function(t){function BoneTranslateTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(BoneTranslateTimelineState,t),BoneTranslateTimelineState.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},BoneTranslateTimelineState.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n),this._valueOffset=this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneTranslateTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,n=e.blendWeight,o=i.animationPose;e.dirty>1?(o.x+=this._resultA*n,o.y+=this._resultB*n):1!==n?(o.x=this._resultA*n,o.y=this._resultB*n):(o.x=this._resultA,o.y=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneTranslateTimelineState}(t.DoubleValueTimelineState);t.BoneTranslateTimelineState=a;var s=function(e){function BoneRotateTimelineState(){return null!==e&&e.apply(this,arguments)||this}return o(BoneRotateTimelineState,e),BoneRotateTimelineState.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},BoneRotateTimelineState.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._differenceA=t.Transform.normalizeRadian(this._differenceA),this._differenceB=t.Transform.normalizeRadian(this._differenceB))},BoneRotateTimelineState.prototype.init=function(t,i,n){e.prototype.init.call(this,t,i,n),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneRotateTimelineState.prototype.fadeOut=function(){this.dirty=!1,this._resultA=t.Transform.normalizeRadian(this._resultA),this._resultB=t.Transform.normalizeRadian(this._resultB)},BoneRotateTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,n=e.blendWeight,o=i.animationPose;e.dirty>1?(o.rotation+=this._resultA*n,o.skew+=this._resultB*n):1!==n?(o.rotation=this._resultA*n,o.skew=this._resultB*n):(o.rotation=this._resultA,o.skew=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneRotateTimelineState}(t.DoubleValueTimelineState);t.BoneRotateTimelineState=s;var h=function(t){function BoneScaleTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(BoneScaleTimelineState,t),BoneScaleTimelineState.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},BoneScaleTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._resultA=1,this._resultB=1)},BoneScaleTimelineState.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneScaleTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,n=e.blendWeight,o=i.animationPose;e.dirty>1?(o.scaleX+=(this._resultA-1)*n,o.scaleY+=(this._resultB-1)*n):1!==n?(o.scaleX=(this._resultA-1)*n+1,o.scaleY=(this._resultB-1)*n+1):(o.scaleX=this._resultA,o.scaleY=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneScaleTimelineState}(t.DoubleValueTimelineState);t.BoneScaleTimelineState=h;var l=function(t){function SurfaceTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(SurfaceTimelineState,t),SurfaceTimelineState.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},SurfaceTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},SurfaceTimelineState.prototype.init=function(e,i,n){if(t.prototype.init.call(this,e,i,n),null!==this._timelineData){var o=this._animationData.parent.parent,a=o.frameIntArray,s=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=a[s+2],this._deformCount=a[s+1],this._deformOffset=a[s+3],this._sameValueOffset=a[s+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=o.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.target.target._deformVertices.length},SurfaceTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,n=e.blendWeight,o=i._deformVertices,a=this._valueArray;if(null!==a)for(var s=this._valueCount,h=this._deformOffset,l=this._sameValueOffset,c=this._rd,p=0;p<this._deformCount;++p){var u=0;u=p<h?a[l+p]:p<h+s?c[p-h]:a[l+p-s],e.dirty>1?o[p]+=u*n:o[p]=u*n}else if(1===e.dirty)for(p=0;p<this._deformCount;++p)o[p]=0;(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},SurfaceTimelineState}(t.MutilpleValueTimelineState);t.SurfaceTimelineState=l;var c=function(t){function AlphaTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(AlphaTimelineState,t),AlphaTimelineState.toString=function(){return"[class dragonBones.AlphaTimelineState]"},AlphaTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._result=1)},AlphaTimelineState.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},AlphaTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,n=e.blendWeight;e.dirty>1?(i._alpha+=this._result*n,i._alpha>1&&(i._alpha=1)):i._alpha=this._result*n,(t||this.dirty)&&(this.dirty=!1,this._armature._alphaDirty=!0)},AlphaTimelineState}(t.SingleValueTimelineState);t.AlphaTimelineState=c;var p=function(t){function SlotDisplayTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(SlotDisplayTimelineState,t),SlotDisplayTimelineState.toString=function(){return"[class dragonBones.SlotDisplayTimelineState]"},SlotDisplayTimelineState.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this.target,e=null!==this._timelineData?this._frameArray[this._frameOffset+1]:t._slotData.displayIndex;t.displayIndex!==e&&t._setDisplayIndex(e,!0)}},SlotDisplayTimelineState.prototype._onUpdateFrame=function(){},SlotDisplayTimelineState}(t.TimelineState);t.SlotDisplayTimelineState=p;var u=function(t){function SlotColorTimelineState(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._difference=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return o(SlotColorTimelineState,t),SlotColorTimelineState.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},SlotColorTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.parent.parent,i=e.colorArray,n=e.frameIntArray,o=this._animationData.frameIntOffset+this._frameValueOffset+this._frameIndex,a=n[o];a<0&&(a+=65536),this._isTween?(this._current[0]=i[a++],this._current[1]=i[a++],this._current[2]=i[a++],this._current[3]=i[a++],this._current[4]=i[a++],this._current[5]=i[a++],this._current[6]=i[a++],this._current[7]=i[a++],(a=this._frameIndex===this._frameCount-1?n[this._animationData.frameIntOffset+this._frameValueOffset]:n[o+1])<0&&(a+=65536),this._difference[0]=i[a++]-this._current[0],this._difference[1]=i[a++]-this._current[1],this._difference[2]=i[a++]-this._current[2],this._difference[3]=i[a++]-this._current[3],this._difference[4]=i[a++]-this._current[4],this._difference[5]=i[a++]-this._current[5],this._difference[6]=i[a++]-this._current[6],this._difference[7]=i[a++]-this._current[7]):(this._result[0]=.01*i[a++],this._result[1]=.01*i[a++],this._result[2]=.01*i[a++],this._result[3]=.01*i[a++],this._result[4]=i[a++],this._result[5]=i[a++],this._result[6]=i[a++],this._result[7]=i[a++])}else{var s=this.target.slotData.color;this._result[0]=s.alphaMultiplier,this._result[1]=s.redMultiplier,this._result[2]=s.greenMultiplier,this._result[3]=s.blueMultiplier,this._result[4]=s.alphaOffset,this._result[5]=s.redOffset,this._result[6]=s.greenOffset,this._result[7]=s.blueOffset}},SlotColorTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result[0]=.01*(this._current[0]+this._difference[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._difference[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._difference[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._difference[3]*this._tweenProgress),this._result[4]=this._current[4]+this._difference[4]*this._tweenProgress,this._result[5]=this._current[5]+this._difference[5]*this._tweenProgress,this._result[6]=this._current[6]+this._difference[6]*this._tweenProgress,this._result[7]=this._current[7]+this._difference[7]*this._tweenProgress)},SlotColorTimelineState.prototype.fadeOut=function(){this._isTween=!1},SlotColorTimelineState.prototype.update=function(e){if(t.prototype.update.call(this,e),this._isTween||this.dirty){var i=this.target,n=i._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(n.alphaMultiplier!==this._result[0]||n.redMultiplier!==this._result[1]||n.greenMultiplier!==this._result[2]||n.blueMultiplier!==this._result[3]||n.alphaOffset!==this._result[4]||n.redOffset!==this._result[5]||n.greenOffset!==this._result[6]||n.blueOffset!==this._result[7]){var o=Math.pow(this._animationState._fadeProgress,4);n.alphaMultiplier+=(this._result[0]-n.alphaMultiplier)*o,n.redMultiplier+=(this._result[1]-n.redMultiplier)*o,n.greenMultiplier+=(this._result[2]-n.greenMultiplier)*o,n.blueMultiplier+=(this._result[3]-n.blueMultiplier)*o,n.alphaOffset+=(this._result[4]-n.alphaOffset)*o,n.redOffset+=(this._result[5]-n.redOffset)*o,n.greenOffset+=(this._result[6]-n.greenOffset)*o,n.blueOffset+=(this._result[7]-n.blueOffset)*o,i._colorDirty=!0}}else this.dirty&&(this.dirty=!1,n.alphaMultiplier===this._result[0]&&n.redMultiplier===this._result[1]&&n.greenMultiplier===this._result[2]&&n.blueMultiplier===this._result[3]&&n.alphaOffset===this._result[4]&&n.redOffset===this._result[5]&&n.greenOffset===this._result[6]&&n.blueOffset===this._result[7]||(n.alphaMultiplier=this._result[0],n.redMultiplier=this._result[1],n.greenMultiplier=this._result[2],n.blueMultiplier=this._result[3],n.alphaOffset=this._result[4],n.redOffset=this._result[5],n.greenOffset=this._result[6],n.blueOffset=this._result[7],i._colorDirty=!0))}},SlotColorTimelineState}(t.TweenTimelineState);t.SlotColorTimelineState=u;var m=function(t){function SlotZIndexTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(SlotZIndexTimelineState,t),SlotZIndexTimelineState.toString=function(){return"[class dragonBones.SlotZIndexTimelineState]"},SlotZIndexTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null===this._timelineData){var e=this.target.target;this._result=e.slotData.zIndex}},SlotZIndexTimelineState.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n),this._valueOffset=this._animationData.frameIntOffset,this._valueArray=this._animationData.parent.parent.frameIntArray},SlotZIndexTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,n=e.blendWeight;e.dirty>1?i._zIndex+=this._result*n:i._zIndex=this._result*n,(t||this.dirty)&&(this.dirty=!1,this._armature._zIndexDirty=!0)},SlotZIndexTimelineState}(t.SingleValueTimelineState);t.SlotZIndexTimelineState=m;var d=function(t){function DeformTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(DeformTimelineState,t),DeformTimelineState.toString=function(){return"[class dragonBones.DeformTimelineState]"},DeformTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this.displayFrame=null,this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},DeformTimelineState.prototype.init=function(e,i,n){if(t.prototype.init.call(this,e,i,n),null!==this._timelineData){var o=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],a=this._animationData.parent.parent,s=a.frameIntArray;this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=s[o+2],this._deformCount=s[o+1],this._deformOffset=s[o+3],this._sameValueOffset=s[o+4],this._sameValueOffset<0&&(this._sameValueOffset+=65536),this._sameValueOffset+=this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=a.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.displayFrame.deformVertices.length},DeformTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,n=e.blendWeight,o=this.displayFrame.deformVertices,a=this._valueArray;if(null!==a)for(var s=this._valueCount,h=this._deformOffset,l=this._sameValueOffset,c=this._rd,p=0;p<this._deformCount;++p){var u=0;u=p<h?a[l+p]:p<h+s?c[p-h]:a[l+p-s],e.dirty>1?o[p]+=u*n:o[p]=u*n}else if(1===e.dirty)for(p=0;p<this._deformCount;++p)o[p]=0;(t||this.dirty)&&(this.dirty=!1,i._geometryData===this.displayFrame.getGeometryData()&&(i._verticesDirty=!0))},DeformTimelineState}(t.MutilpleValueTimelineState);t.DeformTimelineState=d;var f=function(t){function IKConstraintTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(IKConstraintTimelineState,t),IKConstraintTimelineState.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},IKConstraintTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;if(null!==this._timelineData)e._bendPositive=this._currentA>0,e._weight=this._currentB;else{var i=e._constraintData;e._bendPositive=i.bendPositive,e._weight=i.weight}e.invalidUpdate(),this.dirty=!1},IKConstraintTimelineState.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},IKConstraintTimelineState}(t.DoubleValueTimelineState);t.IKConstraintTimelineState=f;var y=function(t){function AnimationProgressTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(AnimationProgressTimelineState,t),AnimationProgressTimelineState.toString=function(){return"[class dragonBones.AnimationProgressTimelineState]"},AnimationProgressTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.currentTime=this._result*e.totalTime),this.dirty=!1},AnimationProgressTimelineState.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationProgressTimelineState}(t.SingleValueTimelineState);t.AnimationProgressTimelineState=y;var g=function(t){function AnimationWeightTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(AnimationWeightTimelineState,t),AnimationWeightTimelineState.toString=function(){return"[class dragonBones.AnimationWeightTimelineState]"},AnimationWeightTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.weight=this._result),this.dirty=!1},AnimationWeightTimelineState.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationWeightTimelineState}(t.SingleValueTimelineState);t.AnimationWeightTimelineState=g;var _=function(t){function AnimationParametersTimelineState(){return null!==t&&t.apply(this,arguments)||this}return o(AnimationParametersTimelineState,t),AnimationParametersTimelineState.toString=function(){return"[class dragonBones.AnimationParametersTimelineState]"},AnimationParametersTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.parameterX=this._resultA,e.parameterY=this._resultB),this.dirty=!1},AnimationParametersTimelineState.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationParametersTimelineState}(t.DoubleValueTimelineState);t.AnimationParametersTimelineState=_}(c||(c={})),function(t){var e=function(t){function EventObject(){return null!==t&&t.apply(this,arguments)||this}return o(EventObject,t),EventObject.actionDataToInstance=function(t,e,i){0===t.type?e.type=EventObject.FRAME_EVENT:e.type=10===t.type?EventObject.FRAME_EVENT:EventObject.SOUND_EVENT,e.name=t.name,e.armature=i,e.actionData=t,e.data=t.data,null!==t.bone&&(e.bone=i.getBone(t.bone.name)),null!==t.slot&&(e.slot=i.getSlot(t.slot.name))},EventObject.toString=function(){return"[class dragonBones.EventObject]"},EventObject.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},EventObject.START="start",EventObject.LOOP_COMPLETE="loopComplete",EventObject.COMPLETE="complete",EventObject.FADE_IN="fadeIn",EventObject.FADE_IN_COMPLETE="fadeInComplete",EventObject.FADE_OUT="fadeOut",EventObject.FADE_OUT_COMPLETE="fadeOutComplete",EventObject.FRAME_EVENT="frameEvent",EventObject.SOUND_EVENT="soundEvent",EventObject}(t.BaseObject);t.EventObject=e}(c||(c={})),function(t){var e=function(){function DataParser(){}return DataParser._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},DataParser._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},DataParser._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},DataParser._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},DataParser._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},DataParser._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},DataParser._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},DataParser._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},DataParser._getAnimationBlendType=function(t){switch(t.toLowerCase()){case"none":return 0;case"1d":return 1;default:return 0}},DataParser._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},DataParser.DATA_VERSION_2_3="2.3",DataParser.DATA_VERSION_3_0="3.0",DataParser.DATA_VERSION_4_0="4.0",DataParser.DATA_VERSION_4_5="4.5",DataParser.DATA_VERSION_5_0="5.0",DataParser.DATA_VERSION_5_5="5.5",DataParser.DATA_VERSION_5_6="5.6",DataParser.DATA_VERSION=DataParser.DATA_VERSION_5_6,DataParser.DATA_VERSIONS=[DataParser.DATA_VERSION_4_0,DataParser.DATA_VERSION_4_5,DataParser.DATA_VERSION_5_0,DataParser.DATA_VERSION_5_5,DataParser.DATA_VERSION_5_6],DataParser.TEXTURE_ATLAS="textureAtlas",DataParser.SUB_TEXTURE="SubTexture",DataParser.FORMAT="format",DataParser.IMAGE_PATH="imagePath",DataParser.WIDTH="width",DataParser.HEIGHT="height",DataParser.ROTATED="rotated",DataParser.FRAME_X="frameX",DataParser.FRAME_Y="frameY",DataParser.FRAME_WIDTH="frameWidth",DataParser.FRAME_HEIGHT="frameHeight",DataParser.DRADON_BONES="dragonBones",DataParser.USER_DATA="userData",DataParser.ARMATURE="armature",DataParser.CANVAS="canvas",DataParser.BONE="bone",DataParser.SURFACE="surface",DataParser.SLOT="slot",DataParser.CONSTRAINT="constraint",DataParser.SKIN="skin",DataParser.DISPLAY="display",DataParser.FRAME="frame",DataParser.IK="ik",DataParser.PATH_CONSTRAINT="path",DataParser.ANIMATION="animation",DataParser.TIMELINE="timeline",DataParser.FFD="ffd",DataParser.TRANSLATE_FRAME="translateFrame",DataParser.ROTATE_FRAME="rotateFrame",DataParser.SCALE_FRAME="scaleFrame",DataParser.DISPLAY_FRAME="displayFrame",DataParser.COLOR_FRAME="colorFrame",DataParser.DEFAULT_ACTIONS="defaultActions",DataParser.ACTIONS="actions",DataParser.EVENTS="events",DataParser.INTS="ints",DataParser.FLOATS="floats",DataParser.STRINGS="strings",DataParser.TRANSFORM="transform",DataParser.PIVOT="pivot",DataParser.AABB="aabb",DataParser.COLOR="color",DataParser.VERSION="version",DataParser.COMPATIBLE_VERSION="compatibleVersion",DataParser.FRAME_RATE="frameRate",DataParser.TYPE="type",DataParser.SUB_TYPE="subType",DataParser.NAME="name",DataParser.PARENT="parent",DataParser.TARGET="target",DataParser.STAGE="stage",DataParser.SHARE="share",DataParser.PATH="path",DataParser.LENGTH="length",DataParser.DISPLAY_INDEX="displayIndex",DataParser.Z_ORDER="zOrder",DataParser.Z_INDEX="zIndex",DataParser.BLEND_MODE="blendMode",DataParser.INHERIT_TRANSLATION="inheritTranslation",DataParser.INHERIT_ROTATION="inheritRotation",DataParser.INHERIT_SCALE="inheritScale",DataParser.INHERIT_REFLECTION="inheritReflection",DataParser.INHERIT_ANIMATION="inheritAnimation",DataParser.INHERIT_DEFORM="inheritDeform",DataParser.SEGMENT_X="segmentX",DataParser.SEGMENT_Y="segmentY",DataParser.BEND_POSITIVE="bendPositive",DataParser.CHAIN="chain",DataParser.WEIGHT="weight",DataParser.BLEND_TYPE="blendType",DataParser.FADE_IN_TIME="fadeInTime",DataParser.PLAY_TIMES="playTimes",DataParser.SCALE="scale",DataParser.OFFSET="offset",DataParser.POSITION="position",DataParser.DURATION="duration",DataParser.TWEEN_EASING="tweenEasing",DataParser.TWEEN_ROTATE="tweenRotate",DataParser.TWEEN_SCALE="tweenScale",DataParser.CLOCK_WISE="clockwise",DataParser.CURVE="curve",DataParser.SOUND="sound",DataParser.EVENT="event",DataParser.ACTION="action",DataParser.X="x",DataParser.Y="y",DataParser.SKEW_X="skX",DataParser.SKEW_Y="skY",DataParser.SCALE_X="scX",DataParser.SCALE_Y="scY",DataParser.VALUE="value",DataParser.ROTATE="rotate",DataParser.SKEW="skew",DataParser.ALPHA="alpha",DataParser.ALPHA_OFFSET="aO",DataParser.RED_OFFSET="rO",DataParser.GREEN_OFFSET="gO",DataParser.BLUE_OFFSET="bO",DataParser.ALPHA_MULTIPLIER="aM",DataParser.RED_MULTIPLIER="rM",DataParser.GREEN_MULTIPLIER="gM",DataParser.BLUE_MULTIPLIER="bM",DataParser.UVS="uvs",DataParser.VERTICES="vertices",DataParser.TRIANGLES="triangles",DataParser.WEIGHTS="weights",DataParser.SLOT_POSE="slotPose",DataParser.BONE_POSE="bonePose",DataParser.BONES="bones",DataParser.POSITION_MODE="positionMode",DataParser.SPACING_MODE="spacingMode",DataParser.ROTATE_MODE="rotateMode",DataParser.SPACING="spacing",DataParser.ROTATE_OFFSET="rotateOffset",DataParser.ROTATE_MIX="rotateMix",DataParser.TRANSLATE_MIX="translateMix",DataParser.TARGET_DISPLAY="targetDisplay",DataParser.CLOSED="closed",DataParser.CONSTANT_SPEED="constantSpeed",DataParser.VERTEX_COUNT="vertexCount",DataParser.LENGTHS="lengths",DataParser.GOTO_AND_PLAY="gotoAndPlay",DataParser.DEFAULT_NAME="default",DataParser}();t.DataParser=e}(c||(c={})),function(t){var e=function(e){function ObjectDataParser(){var i=null!==e&&e.apply(this,arguments)||this;return i._rawTextureAtlasIndex=0,i._rawBones=[],i._data=null,i._armature=null,i._bone=null,i._geometry=null,i._slot=null,i._skin=null,i._mesh=null,i._animation=null,i._timeline=null,i._rawTextureAtlases=null,i._frameValueType=0,i._defaultColorOffset=-1,i._prevClockwise=0,i._prevRotation=0,i._frameDefaultValue=0,i._frameValueScale=1,i._helpMatrixA=new t.Matrix,i._helpMatrixB=new t.Matrix,i._helpTransform=new t.Transform,i._helpColorTransform=new t.ColorTransform,i._helpPoint=new t.Point,i._helpArray=[],i._intArray=[],i._floatArray=[],i._frameIntArray=[],i._frameFloatArray=[],i._frameArray=[],i._timelineArray=[],i._colorArray=[],i._cacheRawMeshes=[],i._cacheMeshes=[],i._actionFrames=[],i._weightSlotPose={},i._weightBonePoses={},i._cacheBones={},i._slotChildActions={},i}return o(ObjectDataParser,e),ObjectDataParser._getBoolean=function(t,e,i){if(e in t){var n=t[e],o=typeof n;if("boolean"===o)return n;if("string"!==o)return!!n;switch(n){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},ObjectDataParser._getNumber=function(t,e,i){if(e in t){var n=t[e];return null===n||"NaN"===n?i:+n||0}return i},ObjectDataParser._getString=function(t,e,i){if(e in t){var n=t[e];return"string"===typeof n?n:String(n)}return i},ObjectDataParser.prototype._getCurvePoint=function(t,e,i,n,o,a,s,h,l,c){var p=1-l,u=p*p,m=l*l,d=p*u,f=3*l*u,y=3*p*m,g=l*m;c.x=d*t+f*i+y*o+g*s,c.y=d*e+f*n+y*a+g*h},ObjectDataParser.prototype._samplingEasingCurve=function(t,e){var i=t.length;if(i%3==1){for(var n=-2,o=0,a=e.length;o<a;++o){for(var s=(o+1)/(a+1);(n+6<i?t[n+6]:1)<s;)n+=6;for(var h=n>=0&&n+6<i,l=h?t[n]:0,c=h?t[n+1]:0,p=t[n+2],u=t[n+3],m=t[n+4],d=t[n+5],f=h?t[n+6]:1,y=h?t[n+7]:1,g=0,_=1;_-g>1e-4;){var v=.5*(_+g);this._getCurvePoint(l,c,p,u,m,d,f,y,v,this._helpPoint),s-this._helpPoint.x>0?g=v:_=v}e[o]=this._helpPoint.y}return!0}for(n=0,o=0,a=e.length;o<a;++o){for(s=(o+1)/(a+1);t[n+6]<s;)n+=6;for(l=t[n],c=t[n+1],p=t[n+2],u=t[n+3],m=t[n+4],d=t[n+5],f=t[n+6],y=t[n+7],g=0,_=1;_-g>1e-4;){v=.5*(_+g);this._getCurvePoint(l,c,p,u,m,d,f,y,v,this._helpPoint),s-this._helpPoint.x>0?g=v:_=v}e[o]=this._helpPoint.y}return!1},ObjectDataParser.prototype._parseActionDataInFrame=function(e,i,n,o){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],i,10,n,o),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],i,11,n,o),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],i,0,n,o),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],i,10,n,o),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],i,0,n,o)},ObjectDataParser.prototype._mergeActionFrame=function(t,e,n,o,a){for(var s=this._armature.actions.length,h=this._parseActionData(t,n,o,a),l=0,c=null,p=0,u=h;p<u.length;p++){var m=u[p];this._armature.addAction(m,!1)}0===this._actionFrames.length&&((c=new i).frameStart=0,this._actionFrames.push(c),c=null);for(var d=0,f=this._actionFrames;d<f.length;d++){var y=f[d];if(y.frameStart===e){c=y;break}if(y.frameStart>e)break;l++}null===c&&((c=new i).frameStart=e,this._actionFrames.splice(l,0,c));for(var g=0;g<h.length;++g)c.actions.push(s+g)},ObjectDataParser.prototype._parseArmature=function(e,i){var n=t.BaseObject.borrowObject(t.ArmatureData);if(n.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),n.frameRate=ObjectDataParser._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),n.scale=i,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?n.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):n.type=ObjectDataParser._getNumber(e,t.DataParser.TYPE,0),0===n.frameRate&&(n.frameRate=24),this._armature=n,t.DataParser.CANVAS in e){var o=e[t.DataParser.CANVAS],a=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in o?a.hasBackground=!0:a.hasBackground=!1,a.color=ObjectDataParser._getNumber(o,t.DataParser.COLOR,0),a.x=ObjectDataParser._getNumber(o,t.DataParser.X,0)*n.scale,a.y=ObjectDataParser._getNumber(o,t.DataParser.Y,0)*n.scale,a.width=ObjectDataParser._getNumber(o,t.DataParser.WIDTH,0)*n.scale,a.height=ObjectDataParser._getNumber(o,t.DataParser.HEIGHT,0)*n.scale,n.canvas=a}if(t.DataParser.AABB in e){var s=e[t.DataParser.AABB];n.aabb.x=ObjectDataParser._getNumber(s,t.DataParser.X,0)*n.scale,n.aabb.y=ObjectDataParser._getNumber(s,t.DataParser.Y,0)*n.scale,n.aabb.width=ObjectDataParser._getNumber(s,t.DataParser.WIDTH,0)*n.scale,n.aabb.height=ObjectDataParser._getNumber(s,t.DataParser.HEIGHT,0)*n.scale}if(t.DataParser.BONE in e)for(var h=0,l=e[t.DataParser.BONE];h<l.length;h++){var c=l[h],p=ObjectDataParser._getString(c,t.DataParser.PARENT,""),u=this._parseBone(c);if(p.length>0){var m=n.getBone(p);null!==m?u.parent=m:(p in this._cacheBones||(this._cacheBones[p]=[]),this._cacheBones[p].push(u))}if(u.name in this._cacheBones){for(var d=0,f=this._cacheBones[u.name];d<f.length;d++){f[d].parent=u}delete this._cacheBones[u.name]}n.addBone(u),this._rawBones.push(u)}if(t.DataParser.IK in e)for(var y=0,g=e[t.DataParser.IK];y<g.length;y++){var _=g[y];(O=this._parseIKConstraint(_))&&n.addConstraint(O)}if(n.sortBones(),t.DataParser.SLOT in e)for(var v=0,b=0,P=e[t.DataParser.SLOT];b<P.length;b++){var S=P[b];n.addSlot(this._parseSlot(S,v++))}if(t.DataParser.SKIN in e)for(var w=0,T=e[t.DataParser.SKIN];w<T.length;w++){var C=T[w];n.addSkin(this._parseSkin(C))}if(t.DataParser.PATH_CONSTRAINT in e)for(var D=0,M=e[t.DataParser.PATH_CONSTRAINT];D<M.length;D++){var O,x=M[D];(O=this._parsePathConstraint(x))&&n.addConstraint(O)}for(var E=0,B=this._cacheRawMeshes.length;E<B;++E){var I=this._cacheRawMeshes[E],A=ObjectDataParser._getString(I,t.DataParser.SHARE,"");if(0!==A.length){var R=ObjectDataParser._getString(I,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===R.length&&(R=t.DataParser.DEFAULT_NAME);var k=n.getMesh(R,"",A);if(null!==k)this._cacheMeshes[E].geometry.shareFrom(k.geometry)}}if(t.DataParser.ANIMATION in e)for(var L=0,F=e[t.DataParser.ANIMATION];L<F.length;L++){var N=F[L],j=this._parseAnimation(N);n.addAnimation(j)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var H=0,U=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);H<U.length;H++){var G=U[H];if(n.addAction(G,!0),0===G.type)null!==(j=n.getAnimation(G.name))&&(n.defaultAnimation=j)}if(t.DataParser.ACTIONS in e)for(var V=0,W=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);V<W.length;V++){G=W[V];n.addAction(G,!1)}for(var z in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[z];for(var z in this._weightBonePoses)delete this._weightBonePoses[z];for(var z in this._cacheBones)delete this._cacheBones[z];for(var z in this._slotChildActions)delete this._slotChildActions[z];return n},ObjectDataParser.prototype._parseBone=function(e){if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):ObjectDataParser._getNumber(e,t.DataParser.TYPE,0))){var i=this._armature.scale,n=t.BaseObject.borrowObject(t.BoneData);return n.inheritTranslation=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),n.inheritRotation=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),n.inheritScale=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),n.inheritReflection=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),n.length=ObjectDataParser._getNumber(e,t.DataParser.LENGTH,0)*i,n.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),n.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],n.transform,i),n}var o=t.BaseObject.borrowObject(t.SurfaceData);return o.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),o.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),o.segmentX=ObjectDataParser._getNumber(e,t.DataParser.SEGMENT_X,0),o.segmentY=ObjectDataParser._getNumber(e,t.DataParser.SEGMENT_Y,0),this._parseGeometry(e,o.geometry),o},ObjectDataParser.prototype._parseIKConstraint=function(e){var i=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.BONE,""));if(null===i)return null;var n=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.TARGET,""));if(null===n)return null;var o=ObjectDataParser._getNumber(e,t.DataParser.CHAIN,0),a=t.BaseObject.borrowObject(t.IKConstraintData);return a.scaleEnabled=ObjectDataParser._getBoolean(e,t.DataParser.SCALE,!1),a.bendPositive=ObjectDataParser._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),a.weight=ObjectDataParser._getNumber(e,t.DataParser.WEIGHT,1),a.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),a.type=0,a.target=n,o>0&&null!==i.parent?(a.root=i.parent,a.bone=i):(a.root=i,a.bone=null),a},ObjectDataParser.prototype._parsePathConstraint=function(e){var i=this._armature.getSlot(ObjectDataParser._getString(e,t.DataParser.TARGET,""));if(null===i)return null;var n=this._armature.defaultSkin;if(null===n)return null;var o=n.getDisplay(i.name,ObjectDataParser._getString(e,t.DataParser.TARGET_DISPLAY,i.name));if(null===o||!(o instanceof t.PathDisplayData))return null;var a=e[t.DataParser.BONES];if(null===a||0===a.length)return null;var s=t.BaseObject.borrowObject(t.PathConstraintData);s.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),s.type=1,s.pathSlot=i,s.pathDisplayData=o,s.target=i.parent,s.positionMode=t.DataParser._getPositionMode(ObjectDataParser._getString(e,t.DataParser.POSITION_MODE,"")),s.spacingMode=t.DataParser._getSpacingMode(ObjectDataParser._getString(e,t.DataParser.SPACING_MODE,"")),s.rotateMode=t.DataParser._getRotateMode(ObjectDataParser._getString(e,t.DataParser.ROTATE_MODE,"")),s.position=ObjectDataParser._getNumber(e,t.DataParser.POSITION,0),s.spacing=ObjectDataParser._getNumber(e,t.DataParser.SPACING,0),s.rotateOffset=ObjectDataParser._getNumber(e,t.DataParser.ROTATE_OFFSET,0),s.rotateMix=ObjectDataParser._getNumber(e,t.DataParser.ROTATE_MIX,1),s.translateMix=ObjectDataParser._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var h=0,l=a;h<l.length;h++){var c=l[h],p=this._armature.getBone(c);null!==p&&(s.AddBone(p),null===s.root&&(s.root=p))}return s},ObjectDataParser.prototype._parseSlot=function(e,i){var n=t.BaseObject.borrowObject(t.SlotData);return n.displayIndex=ObjectDataParser._getNumber(e,t.DataParser.DISPLAY_INDEX,0),n.zOrder=i,n.zIndex=ObjectDataParser._getNumber(e,t.DataParser.Z_INDEX,0),n.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),n.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),n.parent=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?n.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):n.blendMode=ObjectDataParser._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(n.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],n.color)):n.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[n.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),n},ObjectDataParser.prototype._parseSkin=function(e){var i=t.BaseObject.borrowObject(t.SkinData);if(i.name=ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var n=e[t.DataParser.SLOT];this._skin=i;for(var o=0,a=n;o<a.length;o++){var s=a[o],h=ObjectDataParser._getString(s,t.DataParser.NAME,""),l=this._armature.getSlot(h);if(null!==l){if(this._slot=l,t.DataParser.DISPLAY in s)for(var c=0,p=s[t.DataParser.DISPLAY];c<p.length;c++){var u=p[c];u?i.addDisplay(h,this._parseDisplay(u)):i.addDisplay(h,null)}this._slot=null}}this._skin=null}return i},ObjectDataParser.prototype._parseDisplay=function(e){var i=ObjectDataParser._getString(e,t.DataParser.NAME,""),n=ObjectDataParser._getString(e,t.DataParser.PATH,""),o=0,a=null;switch(o=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):ObjectDataParser._getNumber(e,t.DataParser.TYPE,o)){case 0:var s=a=t.BaseObject.borrowObject(t.ImageDisplayData);s.name=i,s.path=n.length>0?n:i,this._parsePivot(e,s);break;case 1:var h=a=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(h.name=i,h.path=n.length>0?n:i,h.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var l=0,c=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);l<c.length;l++){var p=c[l];h.addAction(p)}else if(this._slot.name in this._slotChildActions){var u=this._skin.getDisplays(this._slot.name);if(null===u?0===this._slot.displayIndex:this._slot.displayIndex===u.length){for(var m=0,d=this._slotChildActions[this._slot.name];m<d.length;m++){p=d[m];h.addAction(p)}delete this._slotChildActions[this._slot.name]}}break;case 2:var f=a=t.BaseObject.borrowObject(t.MeshDisplayData);f.geometry.inheritDeform=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),f.name=i,f.path=n.length>0?n:i,t.DataParser.SHARE in e?(f.geometry.data=this._data,this._cacheRawMeshes.push(e),this._cacheMeshes.push(f)):this._parseMesh(e,f);break;case 3:var y=this._parseBoundingBox(e);if(null!==y){var g=a=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);g.name=i,g.path=n.length>0?n:i,g.boundingBox=y}break;case 4:var _=e[t.DataParser.LENGTHS],v=a=t.BaseObject.borrowObject(t.PathDisplayData);v.closed=ObjectDataParser._getBoolean(e,t.DataParser.CLOSED,!1),v.constantSpeed=ObjectDataParser._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),v.name=i,v.path=n.length>0?n:i,v.curveLengths.length=_.length;for(var b=0,P=_.length;b<P;++b)v.curveLengths[b]=_[b];this._parsePath(e,v)}return null!==a&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],a.transform,this._armature.scale),a},ObjectDataParser.prototype._parsePath=function(t,e){this._parseGeometry(t,e.geometry)},ObjectDataParser.prototype._parsePivot=function(e,i){if(t.DataParser.PIVOT in e){var n=e[t.DataParser.PIVOT];i.pivot.x=ObjectDataParser._getNumber(n,t.DataParser.X,0),i.pivot.y=ObjectDataParser._getNumber(n,t.DataParser.Y,0)}else i.pivot.x=.5,i.pivot.y=.5},ObjectDataParser.prototype._parseMesh=function(e,i){if(this._parseGeometry(e,i.geometry),t.DataParser.WEIGHTS in e){var n=e[t.DataParser.SLOT_POSE],o=e[t.DataParser.BONE_POSE],a=this._skin.name+"_"+this._slot.name+"_"+i.name;this._weightSlotPose[a]=n,this._weightBonePoses[a]=o}},ObjectDataParser.prototype._parseBoundingBox=function(e){var i=null,n=0;switch(n=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):ObjectDataParser._getNumber(e,t.DataParser.SUB_TYPE,n)){case 0:i=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:i=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(e)}return null!==i&&(i.color=ObjectDataParser._getNumber(e,t.DataParser.COLOR,0),0!==i.type&&1!==i.type||(i.width=ObjectDataParser._getNumber(e,t.DataParser.WIDTH,0),i.height=ObjectDataParser._getNumber(e,t.DataParser.HEIGHT,0))),i},ObjectDataParser.prototype._parsePolygonBoundingBox=function(e){var i=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var n=this._armature.scale,o=e[t.DataParser.VERTICES],a=i.vertices;a.length=o.length;for(var s=0,h=o.length;s<h;s+=2){var l=o[s]*n,c=o[s+1]*n;a[s]=l,a[s+1]=c,0===s?(i.x=l,i.y=c,i.width=l,i.height=c):(l<i.x?i.x=l:l>i.width&&(i.width=l),c<i.y?i.y=c:c>i.height&&(i.height=c))}i.width-=i.x,i.height-=i.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return i},ObjectDataParser.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);if(i.blendType=t.DataParser._getAnimationBlendType(ObjectDataParser._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=ObjectDataParser._getNumber(e,t.DataParser.DURATION,0),i.playTimes=ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),i.frameIntOffset=this._frameIntArray.length,i.frameFloatOffset=this._frameFloatArray.length,i.frameOffset=this._frameArray.length,this._animation=i,t.DataParser.FRAME in e){var n=e[t.DataParser.FRAME],o=n.length;if(o>0)for(var a=0,s=0;a<o;++a){var h=n[a];this._parseActionDataInFrame(h,s,null,null),s+=ObjectDataParser._getNumber(h,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,0,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var l=0,c=e[t.DataParser.BONE];l<c.length;l++){var p=c[l];this._parseBoneTimeline(p)}if(t.DataParser.SLOT in e)for(var u=0,m=e[t.DataParser.SLOT];u<m.length;u++){p=m[u];this._parseSlotTimeline(p)}if(t.DataParser.FFD in e)for(var d=0,f=e[t.DataParser.FFD];d<f.length;d++){p=f[d];var y=ObjectDataParser._getString(p,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),g=ObjectDataParser._getString(p,t.DataParser.SLOT,""),_=ObjectDataParser._getString(p,t.DataParser.NAME,"");if(0===y.length&&(y=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(g),this._mesh=this._armature.getMesh(y,g,_),null!==this._slot&&null!==this._mesh)null!==(D=this._parseTimeline(p,null,t.DataParser.FRAME,22,2,0,this._parseSlotDeformFrame))&&this._animation.addSlotTimeline(g,D),this._slot=null,this._mesh=null}if(t.DataParser.IK in e)for(var v=0,b=e[t.DataParser.IK];v<b.length;v++){p=b[v];var P=ObjectDataParser._getString(p,t.DataParser.NAME,"");if(null!==this._armature.getConstraint(P))null!==(D=this._parseTimeline(p,null,t.DataParser.FRAME,30,1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(P,D)}if(this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,0,0,this._parseActionFrame),this._actionFrames.length=0),t.DataParser.TIMELINE in e)for(var S=0,w=e[t.DataParser.TIMELINE];S<w.length;S++){p=w[S];var T=ObjectDataParser._getNumber(p,t.DataParser.TYPE,0),C=ObjectDataParser._getString(p,t.DataParser.NAME,""),D=null;switch(T){case 0:break;case 20:case 23:case 60:case 24:case 40:case 41:if(20===T?(this._frameValueType=0,this._frameValueScale=1):(this._frameValueType=1,this._frameValueScale=23===T?1:40===T||41===T?1e4:100),this._frameDefaultValue=60===T||24===T||41===T?1:0,40===T&&0!==i.blendType){var M=D=t.BaseObject.borrowObject(t.AnimationTimelineData);M.x=ObjectDataParser._getNumber(p,t.DataParser.X,0),M.y=ObjectDataParser._getNumber(p,t.DataParser.Y,0)}D=this._parseTimeline(p,null,t.DataParser.FRAME,T,this._frameValueType,1,this._parseSingleValueFrame,D);break;case 11:case 12:case 13:case 30:case 42:30===T||42===T?(this._frameValueType=1,this._frameValueScale=42===T?1e4:100):(this._frameValueScale=12===T?t.Transform.DEG_RAD:1,this._frameValueType=2),this._frameDefaultValue=13===T||30===T?1:0,D=this._parseTimeline(p,null,t.DataParser.FRAME,T,this._frameValueType,2,this._parseDoubleValueFrame);break;case 1:break;case 50:var O=this._armature.getBone(C);if(null===O)continue;this._geometry=O.geometry,D=this._parseTimeline(p,null,t.DataParser.FRAME,T,2,0,this._parseDeformFrame),this._geometry=null;break;case 22:for(var y in this._geometry=null,this._armature.skins){var x=this._armature.skins[y];for(var E in x.displays)for(var B=0,I=x.displays[E];B<I.length;B++){var A=I[B];if(null!==A&&A.name===C){this._geometry=A.geometry;break}}}if(null===this._geometry)continue;D=this._parseTimeline(p,null,t.DataParser.FRAME,T,2,0,this._parseDeformFrame),this._geometry=null;break;case 21:D=this._parseTimeline(p,null,t.DataParser.FRAME,T,1,1,this._parseSlotColorFrame)}if(null!==D)switch(T){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(C,D);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(C,D);break;case 30:this._animation.addConstraintTimeline(C,D);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(C,D)}}return this._animation=null,i},ObjectDataParser.prototype._parseTimeline=function(e,n,o,a,s,h,l,c){if(void 0===c&&(c=null),null!==e&&o.length>0&&o in e&&(n=e[o]),null===n)return null;var p=n.length;if(0===p)return null;var u=this._frameIntArray.length,m=this._frameFloatArray.length,d=this._timelineArray.length;switch(null===c&&(c=t.BaseObject.borrowObject(t.TimelineData)),c.type=a,c.offset=d,this._frameValueType=s,this._timeline=c,this._timelineArray.length+=5+p,null!==e?(this._timelineArray[d+0]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[d+1]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[d+0]=100,this._timelineArray[d+1]=0),this._timelineArray[d+2]=p,this._timelineArray[d+3]=h,this._frameValueType){case 0:this._timelineArray[d+4]=0;break;case 1:this._timelineArray[d+4]=u-this._animation.frameIntOffset;break;case 2:this._timelineArray[d+4]=m-this._animation.frameFloatOffset}if(1===p)c.frameIndicesOffset=-1,this._timelineArray[d+5+0]=l.call(this,n[0],0,0)-this._animation.frameOffset;else{var f=this._animation.frameCount+1,y=this._data.frameIndices,g=y.length;y.length+=f,c.frameIndicesOffset=g;for(var _=0,v=0,b=0,P=0;_<f;++_){if(b+P<=_&&v<p){var S=n[v];b=_,P=v===p-1?this._animation.frameCount-b:S instanceof i?this._actionFrames[v+1].frameStart-b:ObjectDataParser._getNumber(S,t.DataParser.DURATION,1),this._timelineArray[d+5+v]=l.call(this,S,b,P)-this._animation.frameOffset,v++}y[g+_]=v-1}}return this._timeline=null,c},ObjectDataParser.prototype._parseBoneTimeline=function(e){var i=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.NAME,""));if(null!==i){var n;if(this._bone=i,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e)this._frameDefaultValue=0,this._frameValueScale=1,null!==(n=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,2,2,this._parseDoubleValueFrame))&&this._animation.addBoneTimeline(i.name,n);if(t.DataParser.ROTATE_FRAME in e)this._frameDefaultValue=0,this._frameValueScale=1,null!==(n=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,2,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(i.name,n);if(t.DataParser.SCALE_FRAME in e)this._frameDefaultValue=1,this._frameValueScale=1,null!==(n=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,2,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(i.name,n);if(t.DataParser.FRAME in e)null!==(n=this._parseTimeline(e,null,t.DataParser.FRAME,10,2,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(i.name,n);this._bone=null,this._slot=null}},ObjectDataParser.prototype._parseSlotTimeline=function(e){var i=this._armature.getSlot(ObjectDataParser._getString(e,t.DataParser.NAME,""));if(null!==i){var n=null,o=null;this._slot=i,n=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,0,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,0,0,this._parseSlotDisplayFrame),o=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,1,1,this._parseSlotColorFrame),null!==n&&this._animation.addSlotTimeline(i.name,n),null!==o&&this._animation.addSlotTimeline(i.name,o),this._slot=null}},ObjectDataParser.prototype._parseFrame=function(t,e,i){var n=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[n+0]=e,n},ObjectDataParser.prototype._parseTweenFrame=function(e,i,n){var o=this._parseFrame(e,i,n);if(n>0)if(t.DataParser.CURVE in e){var a=n+1;this._helpArray.length=a;var s=this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray);this._frameArray.length+=2+this._helpArray.length,this._frameArray[o+1]=2,this._frameArray[o+2]=s?a:-a;for(var h=0;h<a;++h)this._frameArray[o+3+h]=Math.round(1e4*this._helpArray[h])}else{var l=-2;t.DataParser.TWEEN_EASING in e&&(l=ObjectDataParser._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===l?(this._frameArray.length+=1,this._frameArray[o+1]=0):0===l?(this._frameArray.length+=1,this._frameArray[o+1]=1):l<0?(this._frameArray.length+=2,this._frameArray[o+1]=3,this._frameArray[o+2]=Math.round(100*-l)):l<=1?(this._frameArray.length+=2,this._frameArray[o+1]=4,this._frameArray[o+2]=Math.round(100*l)):(this._frameArray.length+=2,this._frameArray[o+1]=5,this._frameArray[o+2]=Math.round(100*l-100))}else this._frameArray.length+=1,this._frameArray[o+1]=0;return o},ObjectDataParser.prototype._parseSingleValueFrame=function(e,i,n){var o=0;switch(this._frameValueType){case 0:o=this._parseFrame(e,i,n),this._frameArray.length+=1,this._frameArray[o+1]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue);break;case 1:o=this._parseTweenFrame(e,i,n);var a=this._frameIntArray.length;this._frameIntArray.length+=1,this._frameIntArray[a]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale);break;case 2:o=this._parseTweenFrame(e,i,n);a=this._frameFloatArray.length;this._frameFloatArray.length+=1,this._frameFloatArray[a]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale}return o},ObjectDataParser.prototype._parseDoubleValueFrame=function(e,i,n){var o=0;switch(this._frameValueType){case 0:o=this._parseFrame(e,i,n),this._frameArray.length+=2,this._frameArray[o+1]=ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue),this._frameArray[o+2]=ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue);break;case 1:o=this._parseTweenFrame(e,i,n);var a=this._frameIntArray.length;this._frameIntArray.length+=2,this._frameIntArray[a]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale),this._frameIntArray[a+1]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale);break;case 2:o=this._parseTweenFrame(e,i,n);a=this._frameFloatArray.length;this._frameFloatArray.length+=2,this._frameFloatArray[a]=ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale,this._frameFloatArray[a+1]=ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale}return o},ObjectDataParser.prototype._parseActionFrame=function(t,e,i){var n=this._frameArray.length,o=t.actions.length;this._frameArray.length+=2+o,this._frameArray[n+0]=e,this._frameArray[n+0+1]=o;for(var a=0;a<o;++a)this._frameArray[n+0+2+a]=t.actions[a];return n},ObjectDataParser.prototype._parseZOrderFrame=function(e,i,n){var o=this._parseFrame(e,i,n);if(t.DataParser.Z_ORDER in e){var a=e[t.DataParser.Z_ORDER];if(a.length>0){for(var s=this._armature.sortedSlots.length,h=new Array(s-a.length/2),l=new Array(s),c=0;c<h.length;++c)h[c]=0;for(var p=0;p<s;++p)l[p]=-1;for(var u=0,m=0,d=0,f=a.length;d<f;d+=2){for(var y=a[d],g=a[d+1];u!==y;)h[m++]=u++;l[u+g]=u++}for(;u<s;)h[m++]=u++;this._frameArray.length+=1+s,this._frameArray[o+1]=s;for(var _=s;_--;)-1===l[_]?this._frameArray[o+2+_]=h[--m]||0:this._frameArray[o+2+_]=l[_]||0;return o}}return this._frameArray.length+=1,this._frameArray[o+1]=0,o},ObjectDataParser.prototype._parseBoneAllFrame=function(e,i,n){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var o=this._helpTransform.rotation;0!==i&&(0===this._prevClockwise?o=this._prevRotation+t.Transform.normalizeRadian(o-this._prevRotation):((this._prevClockwise>0?o>=this._prevRotation:o<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),o=this._prevRotation+o-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=ObjectDataParser._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=o;var a=this._parseTweenFrame(e,i,n),s=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[s++]=this._helpTransform.x,this._frameFloatArray[s++]=this._helpTransform.y,this._frameFloatArray[s++]=o,this._frameFloatArray[s++]=this._helpTransform.skew,this._frameFloatArray[s++]=this._helpTransform.scaleX,this._frameFloatArray[s++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,i,this._bone,this._slot),a},ObjectDataParser.prototype._parseBoneTranslateFrame=function(e,i,n){var o=this._parseTweenFrame(e,i,n),a=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[a++]=ObjectDataParser._getNumber(e,t.DataParser.X,0),this._frameFloatArray[a++]=ObjectDataParser._getNumber(e,t.DataParser.Y,0),o},ObjectDataParser.prototype._parseBoneRotateFrame=function(e,i,n){var o=ObjectDataParser._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==i&&(0===this._prevClockwise?o=this._prevRotation+t.Transform.normalizeRadian(o-this._prevRotation):((this._prevClockwise>0?o>=this._prevRotation:o<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),o=this._prevRotation+o-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=ObjectDataParser._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=o;var a=this._parseTweenFrame(e,i,n),s=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[s++]=o,this._frameFloatArray[s++]=ObjectDataParser._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,a},ObjectDataParser.prototype._parseBoneScaleFrame=function(e,i,n){var o=this._parseTweenFrame(e,i,n),a=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[a++]=ObjectDataParser._getNumber(e,t.DataParser.X,1),this._frameFloatArray[a++]=ObjectDataParser._getNumber(e,t.DataParser.Y,1),o},ObjectDataParser.prototype._parseSlotDisplayFrame=function(e,i,n){var o=this._parseFrame(e,i,n);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[o+1]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,0):this._frameArray[o+1]=ObjectDataParser._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,i,this._slot.parent,this._slot),o},ObjectDataParser.prototype._parseSlotColorFrame=function(e,i,n){var o=this._parseTweenFrame(e,i,n),a=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var s=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var h in s){this._parseColorTransform(s,this._helpColorTransform),a=this._colorArray.length,this._colorArray.length+=8,this._colorArray[a++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._colorArray[a++]=Math.round(100*this._helpColorTransform.redMultiplier),this._colorArray[a++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._colorArray[a++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._colorArray[a++]=Math.round(this._helpColorTransform.alphaOffset),this._colorArray[a++]=Math.round(this._helpColorTransform.redOffset),this._colorArray[a++]=Math.round(this._helpColorTransform.greenOffset),this._colorArray[a++]=Math.round(this._helpColorTransform.blueOffset),a-=8;break}}a<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=a=this._colorArray.length,this._colorArray.length+=8,this._colorArray[a++]=100,this._colorArray[a++]=100,this._colorArray[a++]=100,this._colorArray[a++]=100,this._colorArray[a++]=0,this._colorArray[a++]=0,this._colorArray[a++]=0,this._colorArray[a++]=0),a=this._defaultColorOffset);var l=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[l]=a,o},ObjectDataParser.prototype._parseSlotDeformFrame=function(e,i,n){var o=this._frameFloatArray.length,a=this._parseTweenFrame(e,i,n),s=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,h=ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._mesh.geometry.offset+0],c=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,p=this._mesh.geometry.weight,u=0,m=0,d=0,f=0;if(null!==p){var y=this._weightSlotPose[c];this._helpMatrixA.copyFromArray(y,0),this._frameFloatArray.length+=2*p.count,d=p.offset+2+p.bones.length}else this._frameFloatArray.length+=2*l;for(var g=0;g<2*l;g+=2)if(null===s?(u=0,m=0):(u=g<h||g-h>=s.length?0:s[g-h],m=g+1<h||g+1-h>=s.length?0:s[g+1-h]),null!==p){var _=this._weightBonePoses[c],v=this._intArray[d++];this._helpMatrixA.transformPoint(u,m,this._helpPoint,!0),u=this._helpPoint.x,m=this._helpPoint.y;for(var b=0;b<v;++b){var P=this._intArray[d++];this._helpMatrixB.copyFromArray(_,7*P+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(u,m,this._helpPoint,!0),this._frameFloatArray[o+f++]=this._helpPoint.x,this._frameFloatArray[o+f++]=this._helpPoint.y}}else this._frameFloatArray[o+g]=u,this._frameFloatArray[o+g+1]=m;if(0===i){var S=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[S+0]=this._mesh.geometry.offset,this._frameIntArray[S+1]=this._frameFloatArray.length-o,this._frameIntArray[S+2]=this._frameFloatArray.length-o,this._frameIntArray[S+3]=0,this._frameIntArray[S+4]=o-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=S-this._animation.frameIntOffset}return a},ObjectDataParser.prototype._parseIKConstraintFrame=function(e,i,n){var o=this._parseTweenFrame(e,i,n),a=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[a++]=ObjectDataParser._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[a++]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.WEIGHT,1)),o},ObjectDataParser.prototype._parseActionData=function(e,i,n,o){var a=new Array;if("string"==typeof e)(c=t.BaseObject.borrowObject(t.ActionData)).type=i,c.name=e,c.bone=n,c.slot=o,a.push(c);else if(e instanceof Array)for(var s=0,h=e;s<h.length;s++){var l=h[s],c=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in l?(c.type=0,c.name=ObjectDataParser._getString(l,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in l&&"string"==typeof l[t.DataParser.TYPE]?c.type=t.DataParser._getActionType(l[t.DataParser.TYPE]):c.type=ObjectDataParser._getNumber(l,t.DataParser.TYPE,i),c.name=ObjectDataParser._getString(l,t.DataParser.NAME,"")),t.DataParser.BONE in l){var p=ObjectDataParser._getString(l,t.DataParser.BONE,"");c.bone=this._armature.getBone(p)}else c.bone=n;if(t.DataParser.SLOT in l){var u=ObjectDataParser._getString(l,t.DataParser.SLOT,"");c.slot=this._armature.getSlot(u)}else c.slot=o;var m=null;if(t.DataParser.INTS in l){null===m&&(m=t.BaseObject.borrowObject(t.UserData));for(var d=0,f=l[t.DataParser.INTS];d<f.length;d++){var y=f[d];m.addInt(y)}}if(t.DataParser.FLOATS in l){null===m&&(m=t.BaseObject.borrowObject(t.UserData));for(var g=0,_=l[t.DataParser.FLOATS];g<_.length;g++){y=_[g];m.addFloat(y)}}if(t.DataParser.STRINGS in l){null===m&&(m=t.BaseObject.borrowObject(t.UserData));for(var v=0,b=l[t.DataParser.STRINGS];v<b.length;v++){y=b[v];m.addString(y)}}c.data=m,a.push(c)}return a},ObjectDataParser.prototype._parseDeformFrame=function(e,i,n){var o=this._frameFloatArray.length,a=this._parseTweenFrame(e,i,n),s=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:t.DataParser.VALUE in e?e[t.DataParser.VALUE]:null,h=ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._geometry.offset+0],c=0,p=0;if(null!==this._geometry.weight);else{this._frameFloatArray.length+=2*l;for(var u=0;u<2*l;u+=2)null!==s?(c=u<h||u-h>=s.length?0:s[u-h],p=u+1<h||u+1-h>=s.length?0:s[u+1-h]):(c=0,p=0),this._frameFloatArray[o+u]=c,this._frameFloatArray[o+u+1]=p}if(0===i){var m=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[m+0]=this._geometry.offset,this._frameIntArray[m+1]=this._frameFloatArray.length-o,this._frameIntArray[m+2]=this._frameFloatArray.length-o,this._frameIntArray[m+3]=0,this._frameIntArray[m+4]=o-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=m-this._animation.frameIntOffset}return a},ObjectDataParser.prototype._parseTransform=function(e,i,n){i.x=ObjectDataParser._getNumber(e,t.DataParser.X,0)*n,i.y=ObjectDataParser._getNumber(e,t.DataParser.Y,0)*n,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(i.rotation=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(i.rotation=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-i.rotation),i.scaleX=ObjectDataParser._getNumber(e,t.DataParser.SCALE_X,1),i.scaleY=ObjectDataParser._getNumber(e,t.DataParser.SCALE_Y,1)},ObjectDataParser.prototype._parseColorTransform=function(e,i){i.alphaMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),i.redMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.RED_MULTIPLIER,100),i.greenMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),i.blueMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),i.alphaOffset=ObjectDataParser._getNumber(e,t.DataParser.ALPHA_OFFSET,0),i.redOffset=ObjectDataParser._getNumber(e,t.DataParser.RED_OFFSET,0),i.greenOffset=ObjectDataParser._getNumber(e,t.DataParser.GREEN_OFFSET,0),i.blueOffset=ObjectDataParser._getNumber(e,t.DataParser.BLUE_OFFSET,0)},ObjectDataParser.prototype._parseGeometry=function(e,i){var n=e[t.DataParser.VERTICES],o=Math.floor(n.length/2),a=0,s=this._intArray.length,h=this._floatArray.length;i.offset=s,i.data=this._data,this._intArray.length+=4,this._intArray[s+0]=o,this._intArray[s+2]=h,this._intArray[s+3]=-1,this._floatArray.length+=2*o;for(var l=0,c=2*o;l<c;++l)this._floatArray[h+l]=n[l];if(t.DataParser.TRIANGLES in e){var p=e[t.DataParser.TRIANGLES];a=Math.floor(p.length/3),this._intArray.length+=3*a;for(l=0,c=3*a;l<c;++l)this._intArray[s+4+l]=p[l]}if(this._intArray[s+1]=a,t.DataParser.UVS in e){var u=e[t.DataParser.UVS],m=h+2*o;this._floatArray.length+=2*o;for(l=0,c=2*o;l<c;++l)this._floatArray[m+l]=u[l]}if(t.DataParser.WEIGHTS in e){var d=e[t.DataParser.WEIGHTS],f=Math.floor(d.length-o)/2,y=this._intArray.length,g=this._floatArray.length,_=0,v=this._armature.sortedBones,b=t.BaseObject.borrowObject(t.WeightData);if(b.count=f,b.offset=y,this._intArray.length+=2+_+o+f,this._intArray[y+1]=g,t.DataParser.BONE_POSE in e){var P=e[t.DataParser.SLOT_POSE],S=e[t.DataParser.BONE_POSE],w=new Array;_=Math.floor(S.length/7),w.length=_;for(l=0;l<_;++l){var T=S[7*l],C=this._rawBones[T];b.addBone(C),w[l]=T,this._intArray[y+2+l]=v.indexOf(C)}this._floatArray.length+=3*f,this._helpMatrixA.copyFromArray(P,0);l=0;for(var D=0,M=y+2+_,O=g;l<o;++l){var x=2*l,E=this._intArray[M++]=d[D++],B=this._floatArray[h+x],I=this._floatArray[h+x+1];this._helpMatrixA.transformPoint(B,I,this._helpPoint),B=this._helpPoint.x,I=this._helpPoint.y;for(var A=0;A<E;++A){T=d[D++];var R=w.indexOf(T);this._helpMatrixB.copyFromArray(S,7*R+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(B,I,this._helpPoint),this._intArray[M++]=R,this._floatArray[O++]=d[D++],this._floatArray[O++]=this._helpPoint.x,this._floatArray[O++]=this._helpPoint.y}}}else{var k=e[t.DataParser.BONES];_=k.length;for(l=0;l<_;l++){T=k[l],C=this._rawBones[T];b.addBone(C),this._intArray[y+2+l]=v.indexOf(C)}this._floatArray.length+=3*f;l=0,D=0,O=0,M=y+2+_;for(var L=g;l<f;l++){E=d[D++];this._intArray[M++]=E;for(A=0;A<E;A++){R=d[D++];var F=d[D++];B=n[O++],I=n[O++];this._intArray[M++]=k.indexOf(R),this._floatArray[L++]=F,this._floatArray[L++]=B,this._floatArray[L++]=I}}}i.weight=b}},ObjectDataParser.prototype._parseArray=function(t){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0,this._colorArray.length=0},ObjectDataParser.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0),this._timelineArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._colorArray.push(0);for(var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,o=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,a=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,s=this._colorArray.length*Int16Array.BYTES_PER_ELEMENT,h=new ArrayBuffer(t+e+i+n+o+a+s),l=new Int16Array(h,0,this._intArray.length),c=new Float32Array(h,t,this._floatArray.length),p=new Int16Array(h,t+e,this._frameIntArray.length),u=new Float32Array(h,t+e+i,this._frameFloatArray.length),m=new Int16Array(h,t+e+i+n,this._frameArray.length),d=new Uint16Array(h,t+e+i+n+o,this._timelineArray.length),f=new Int16Array(h,t+e+i+n+o+a,this._colorArray.length),y=0,g=this._intArray.length;y<g;++y)l[y]=this._intArray[y];for(y=0,g=this._floatArray.length;y<g;++y)c[y]=this._floatArray[y];for(y=0,g=this._frameIntArray.length;y<g;++y)p[y]=this._frameIntArray[y];for(y=0,g=this._frameFloatArray.length;y<g;++y)u[y]=this._frameFloatArray[y];for(y=0,g=this._frameArray.length;y<g;++y)m[y]=this._frameArray[y];for(y=0,g=this._timelineArray.length;y<g;++y)d[y]=this._timelineArray[y];for(y=0,g=this._colorArray.length;y<g;++y)f[y]=this._colorArray[y];this._data.binary=h,this._data.intArray=l,this._data.floatArray=c,this._data.frameIntArray=p,this._data.frameFloatArray=u,this._data.frameArray=m,this._data.timelineArray=d,this._data.colorArray=f,this._defaultColorOffset=-1},ObjectDataParser.prototype.parseDragonBonesData=function(e,i){void 0===i&&(i=1),console.assert(null!=e,"Data error.");var n=ObjectDataParser._getString(e,t.DataParser.VERSION,""),o=ObjectDataParser._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(n)>=0||t.DataParser.DATA_VERSIONS.indexOf(o)>=0){var a=t.BaseObject.borrowObject(t.DragonBonesData);if(a.version=n,a.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),a.frameRate=ObjectDataParser._getNumber(e,t.DataParser.FRAME_RATE,24),0===a.frameRate&&(a.frameRate=24),t.DataParser.ARMATURE in e){this._data=a,this._parseArray(e);for(var s=0,h=e[t.DataParser.ARMATURE];s<h.length;s++){var l=h[s];a.addArmature(this._parseArmature(l,i))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?a.stage=a.getArmature(ObjectDataParser._getString(e,t.DataParser.STAGE,"")):a.armatureNames.length>0&&(a.stage=a.getArmature(a.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),a}return console.assert(!1,"Nonsupport data version: "+n+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},ObjectDataParser.prototype.parseTextureAtlasData=function(e,i,n){if(void 0===n&&(n=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var o=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(o,i,n),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(i.width=ObjectDataParser._getNumber(e,t.DataParser.WIDTH,0),i.height=ObjectDataParser._getNumber(e,t.DataParser.HEIGHT,0),i.scale=1===n?1/ObjectDataParser._getNumber(e,t.DataParser.SCALE,1):n,i.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),i.imagePath=ObjectDataParser._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var a=e[t.DataParser.SUB_TEXTURE],s=0,h=a.length;s<h;++s){var l=a[s],c=ObjectDataParser._getNumber(l,t.DataParser.FRAME_WIDTH,-1),p=ObjectDataParser._getNumber(l,t.DataParser.FRAME_HEIGHT,-1),u=i.createTexture();u.rotated=ObjectDataParser._getBoolean(l,t.DataParser.ROTATED,!1),u.name=ObjectDataParser._getString(l,t.DataParser.NAME,""),u.region.x=ObjectDataParser._getNumber(l,t.DataParser.X,0),u.region.y=ObjectDataParser._getNumber(l,t.DataParser.Y,0),u.region.width=ObjectDataParser._getNumber(l,t.DataParser.WIDTH,0),u.region.height=ObjectDataParser._getNumber(l,t.DataParser.HEIGHT,0),c>0&&p>0&&(u.frame=t.TextureData.createRectangle(),u.frame.x=ObjectDataParser._getNumber(l,t.DataParser.FRAME_X,0),u.frame.y=ObjectDataParser._getNumber(l,t.DataParser.FRAME_Y,0),u.frame.width=c,u.frame.height=p),i.addTexture(u)}return!0},ObjectDataParser.getInstance=function(){return null===ObjectDataParser._objectDataParserInstance&&(ObjectDataParser._objectDataParserInstance=new ObjectDataParser),ObjectDataParser._objectDataParserInstance},ObjectDataParser._objectDataParserInstance=null,ObjectDataParser}(t.DataParser);t.ObjectDataParser=e;var i=function i(){this.frameStart=0,this.actions=[]};t.ActionFrame=i}(c||(c={})),function(t){var e=function(e){function BinaryDataParser(){return null!==e&&e.apply(this,arguments)||this}return o(BinaryDataParser,e),BinaryDataParser.prototype._inRange=function(t,e,i){return e<=t&&t<=i},BinaryDataParser.prototype._decodeUTF8=function(t){for(var e,i=0,n="",o=0,a=0,s=0,h=0;t.length>i;){var l=t[i++];if(-1===l)e=0!==a?65533:-1;else if(0===a)this._inRange(l,0,127)?e=l:(this._inRange(l,194,223)?(a=1,h=128,o=l-192):this._inRange(l,224,239)?(a=2,h=2048,o=l-224):this._inRange(l,240,244)&&(a=3,h=65536,o=l-240),o*=Math.pow(64,a),e=null);else if(this._inRange(l,128,191))if(s+=1,o+=(l-128)*Math.pow(64,a-s),s!==a)e=null;else{var c=o,p=h;o=0,a=0,s=0,h=0,e=this._inRange(c,p,1114111)&&!this._inRange(c,55296,57343)?c:l}else o=0,a=0,s=0,h=0,i--,e=l;null!==e&&-1!==e&&(e<=65535?e>0&&(n+=String.fromCharCode(e)):(e-=65536,n+=String.fromCharCode(55296+(e>>10&1023)),n+=String.fromCharCode(56320+(1023&e))))}return n},BinaryDataParser.prototype._parseBinaryTimeline=function(e,i,n){void 0===n&&(n=null);var o=null!==n?n:t.BaseObject.borrowObject(t.TimelineData);o.type=e,o.offset=i,this._timeline=o;var a=this._timelineArrayBuffer[o.offset+2];if(1===a)o.frameIndicesOffset=-1;else{var s,h=this._animation.frameCount+1,l=this._data.frameIndices;s=l.length,l.length+=h,o.frameIndicesOffset=s;for(var c=0,p=0,u=0,m=0;c<h;++c)u+m<=c&&p<a&&(u=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[o.offset+5+p]],m=p===a-1?this._animation.frameCount-u:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[o.offset+5+p+1]]-u,p++),l[s+c]=p-1}return this._timeline=null,o},BinaryDataParser.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);i.blendType=t.DataParser._getAnimationBlendType(t.ObjectDataParser._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,0),i.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME);var n=e[t.DataParser.OFFSET];if(i.frameIntOffset=n[0],i.frameFloatOffset=n[1],i.frameOffset=n[2],this._animation=i,t.DataParser.ACTION in e&&(i.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(i.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var o=e[t.DataParser.BONE];for(var a in o){var s=o[a],h=this._armature.getBone(a);if(null!==h)for(var l=0,c=s.length;l<c;l+=2){var p=s[l],u=s[l+1],m=this._parseBinaryTimeline(p,u);this._animation.addBoneTimeline(h.name,m)}}}if(t.DataParser.SLOT in e){o=e[t.DataParser.SLOT];for(var a in o){s=o[a];var d=this._armature.getSlot(a);if(null!==d)for(l=0,c=s.length;l<c;l+=2){p=s[l],u=s[l+1],m=this._parseBinaryTimeline(p,u);this._animation.addSlotTimeline(d.name,m)}}}if(t.DataParser.CONSTRAINT in e){o=e[t.DataParser.CONSTRAINT];for(var a in o){s=o[a];var f=this._armature.getConstraint(a);if(null!==f)for(l=0,c=s.length;l<c;l+=2){p=s[l],u=s[l+1],m=this._parseBinaryTimeline(p,u);this._animation.addConstraintTimeline(f.name,m)}}}if(t.DataParser.TIMELINE in e)for(var y=0,g=s=e[t.DataParser.TIMELINE];y<g.length;y++){var _=g[y];if((u=t.ObjectDataParser._getNumber(_,t.DataParser.OFFSET,0))>=0){p=t.ObjectDataParser._getNumber(_,t.DataParser.TYPE,0);var v=t.ObjectDataParser._getString(_,t.DataParser.NAME,"");m=null;if(40===p&&0!==i.blendType){var b=m=t.BaseObject.borrowObject(t.AnimationTimelineData);b.x=t.ObjectDataParser._getNumber(_,t.DataParser.X,0),b.y=t.ObjectDataParser._getNumber(_,t.DataParser.Y,0)}switch(m=this._parseBinaryTimeline(p,u,m),p){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(v,m);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(v,m);break;case 30:this._animation.addConstraintTimeline(v,m);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(v,m)}}}return this._animation=null,i},BinaryDataParser.prototype._parseGeometry=function(e,i){i.offset=e[t.DataParser.OFFSET],i.data=this._data;var n=this._intArrayBuffer[i.offset+3];if(n<-1&&(n+=65536),n>=0){var o=t.BaseObject.borrowObject(t.WeightData),a=this._intArrayBuffer[i.offset+0],s=this._intArrayBuffer[n+0];o.offset=n;for(var h=0;h<s;++h){var l=this._intArrayBuffer[n+2+h];o.addBone(this._rawBones[l])}for(var c=n+2+s,p=0,u=(h=0,a);h<u;++h){var m=this._intArrayBuffer[c++];p+=m,c+=m}o.count=p,i.weight=o}},BinaryDataParser.prototype._parseArray=function(e){var i=e[t.DataParser.OFFSET],n=i[1],o=i[3],a=i[5],s=i[7],h=i[9],l=i[11],c=i.length>12?i[13]:0,p=new Int16Array(this._binary,this._binaryOffset+i[0],n/Int16Array.BYTES_PER_ELEMENT),u=new Float32Array(this._binary,this._binaryOffset+i[2],o/Float32Array.BYTES_PER_ELEMENT),m=new Int16Array(this._binary,this._binaryOffset+i[4],a/Int16Array.BYTES_PER_ELEMENT),d=new Float32Array(this._binary,this._binaryOffset+i[6],s/Float32Array.BYTES_PER_ELEMENT),f=new Int16Array(this._binary,this._binaryOffset+i[8],h/Int16Array.BYTES_PER_ELEMENT),y=new Uint16Array(this._binary,this._binaryOffset+i[10],l/Uint16Array.BYTES_PER_ELEMENT),g=c>0?new Int16Array(this._binary,this._binaryOffset+i[12],c/Uint16Array.BYTES_PER_ELEMENT):p;this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=p,this._data.floatArray=u,this._data.frameIntArray=m,this._data.frameFloatArray=d,this._data.frameArray=this._frameArrayBuffer=f,this._data.timelineArray=this._timelineArrayBuffer=y,this._data.colorArray=g},BinaryDataParser.prototype.parseDragonBonesData=function(t,i){void 0===i&&(i=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var n=new Uint8Array(t,0,8);if(n[0]!=="D".charCodeAt(0)||n[1]!=="B".charCodeAt(0)||n[2]!=="D".charCodeAt(0)||n[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var o=new Uint32Array(t,8,1)[0],a=new Uint8Array(t,12,o),s=this._decodeUTF8(a),h=JSON.parse(s);return this._binaryOffset=12+o,this._binary=t,e.prototype.parseDragonBonesData.call(this,h,i)},BinaryDataParser.getInstance=function(){return null===BinaryDataParser._binaryDataParserInstance&&(BinaryDataParser._binaryDataParserInstance=new BinaryDataParser),BinaryDataParser._binaryDataParserInstance},BinaryDataParser._binaryDataParserInstance=null,BinaryDataParser}(t.ObjectDataParser);t.BinaryDataParser=e}(c||(c={})),function(t){var e=function(){function BaseFactory(e){void 0===e&&(e=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===BaseFactory._objectParser&&(BaseFactory._objectParser=new t.ObjectDataParser),null===BaseFactory._binaryParser&&(BaseFactory._binaryParser=new t.BinaryDataParser),this._dataParser=null!==e?e:BaseFactory._objectParser}return BaseFactory.prototype._isSupportMesh=function(){return!0},BaseFactory.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,n=this._textureAtlasDataMap[t];i<n.length;i++){if(null!==(l=(h=n[i]).getTexture(e)))return l}if(this.autoSearch)for(var o in this._textureAtlasDataMap)for(var a=0,s=this._textureAtlasDataMap[o];a<s.length;a++){var h,l;if((h=s[a]).autoSearch)if(null!==(l=h.getTexture(e)))return l}return null},BaseFactory.prototype._fillBuildArmaturePackage=function(t,e,i,n,o){var a=null,s=null;if(e.length>0&&e in this._dragonBonesDataMap&&(s=(a=this._dragonBonesDataMap[e]).getArmature(i)),null===s&&(0===e.length||this.autoSearch))for(var h in this._dragonBonesDataMap)if(a=this._dragonBonesDataMap[h],(0===e.length||a.autoSearch)&&null!==(s=a.getArmature(i))){e=h;break}if(null!==s){if(t.dataName=e,t.textureAtlasName=o,t.data=a,t.armature=s,t.skin=null,n.length>0&&(t.skin=s.getSkin(n),null===t.skin&&this.autoSearch))for(var h in this._dragonBonesDataMap){var l=this._dragonBonesDataMap[h].getArmature(n);if(null!==l){t.skin=l.defaultSkin;break}}return null===t.skin&&(t.skin=s.defaultSkin),!0}return!1},BaseFactory.prototype._buildBones=function(e,i){for(var n=0,o=e.armature.sortedBones;n<o.length;n++){var a=o[n];t.BaseObject.borrowObject(0===a.type?t.Bone:t.Surface).init(a,i)}},BaseFactory.prototype._buildSlots=function(t,e){var i=t.skin,n=t.armature.defaultSkin;if(null!==i&&null!==n){var o={};for(var a in n.displays){var s=n.getDisplays(a);o[a]=s}if(i!==n)for(var a in i.displays){s=i.getDisplays(a);o[a]=s}for(var h=0,l=t.armature.sortedSlots;h<l.length;h++){var c=l[h],p=c.name in o?o[c.name]:null,u=this._buildSlot(t,c,e);if(null!==p){u.displayFrameCount=p.length;for(var m=0,d=u.displayFrameCount;m<d;++m){var f=p[m];if(u.replaceRawDisplayData(f,m),null!==f){if(t.textureAtlasName.length>0){var y=this._getTextureData(t.textureAtlasName,f.path);u.replaceTextureData(y,m)}var g=this._getSlotDisplay(t,f,u);u.replaceDisplay(g,m)}else u.replaceDisplay(null)}}u._setDisplayIndex(c.displayIndex,!0)}}},BaseFactory.prototype._buildConstraints=function(e,i){var n=e.armature.constraints;for(var o in n){var a=n[o];switch(a.type){case 0:var s=t.BaseObject.borrowObject(t.IKConstraint);s.init(a,i),i._addConstraint(s);break;case 1:var h=t.BaseObject.borrowObject(t.PathConstraint);h.init(a,i),i._addConstraint(h);break;default:var l=t.BaseObject.borrowObject(t.IKConstraint);l.init(a,i),i._addConstraint(l)}}},BaseFactory.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},BaseFactory.prototype._getSlotDisplay=function(e,i,n){var o=null!==e?e.dataName:i.parent.parent.parent.name,a=null;switch(i.type){case 0:var s=i;null===s.texture&&(s.texture=this._getTextureData(o,i.path)),a=n.rawDisplay;break;case 2:var h=i;null===h.texture&&(h.texture=this._getTextureData(o,h.path)),a=this._isSupportMesh()?n.meshDisplay:n.rawDisplay;break;case 1:var l=i,c=this._buildChildArmature(e,n,l);if(null!==c){if(c.inheritAnimation=l.inheritAnimation,!c.inheritAnimation){var p=l.actions.length>0?l.actions:c.armatureData.defaultActions;if(p.length>0)for(var u=0,m=p;u<m.length;u++){var d=m[u],f=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(d,f,n.armature),f.slot=n,n.armature._bufferAction(f,!1)}else c.animation.play()}l.armature=c.armatureData}a=c}return a},BaseFactory.prototype.parseDragonBonesData=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=1);for(var n=t instanceof ArrayBuffer?BaseFactory._binaryParser:this._dataParser,o=n.parseDragonBonesData(t,i);;){var a=this._buildTextureAtlasData(null,null);if(!n.parseTextureAtlasData(null,a,i)){a.returnToPool();break}this.addTextureAtlasData(a,e)}return null!==o&&this.addDragonBonesData(o,e),o},BaseFactory.prototype.parseTextureAtlasData=function(t,e,i,n){void 0===i&&(i=null),void 0===n&&(n=1);var o=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,o,n),this._buildTextureAtlasData(o,e||null),this.addTextureAtlasData(o,i),o},BaseFactory.prototype.updateTextureAtlases=function(t,e){var i=this.getTextureAtlasData(e);if(null!==i)for(var n=0,o=i.length;n<o;++n)n<t.length&&this._buildTextureAtlasData(i[n],t[n])},BaseFactory.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},BaseFactory.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},BaseFactory.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},BaseFactory.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},BaseFactory.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var i=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];i.indexOf(t)<0&&i.push(t)},BaseFactory.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var n=0,o=i;n<o.length;n++){var a=o[n];this._dragonBones.bufferObject(a)}delete this._textureAtlasDataMap[t]}},BaseFactory.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var n=new i;return this._fillBuildArmaturePackage(n,e,t,"","")?n.armature:null},BaseFactory.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=0,n=this._textureAtlasDataMap[e];i<n.length;i++){var o=n[i];this._dragonBones.bufferObject(o)}delete this._textureAtlasDataMap[e]}},BaseFactory.prototype.buildArmature=function(t,e,n,o){void 0===e&&(e=""),void 0===n&&(n=""),void 0===o&&(o="");var a=new i;if(!this._fillBuildArmaturePackage(a,e||"",t,n||"",o||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var s=this._buildArmature(a);return this._buildBones(a,s),this._buildSlots(a,s),this._buildConstraints(a,s),s.invalidUpdate(null,!0),s.advanceTime(0),s},BaseFactory.prototype.replaceDisplay=function(t,e,i){if(void 0===i&&(i=-1),i<0&&(i=t.displayIndex),i<0&&(i=0),t.replaceDisplayData(e,i),null!==e){var n=this._getSlotDisplay(null,e,t);if(0===e.type){var o=t.getDisplayFrameAt(i).rawDisplayData;null!==o&&2===o.type&&(n=t.meshDisplay)}t.replaceDisplay(n,i)}else t.replaceDisplay(null,i)},BaseFactory.prototype.replaceSlotDisplay=function(t,e,i,n,o,a){void 0===a&&(a=-1);var s=this.getArmatureData(e,t||"");if(null===s||null===s.defaultSkin)return!1;var h=s.defaultSkin.getDisplay(i,n);return this.replaceDisplay(o,h,a),!0},BaseFactory.prototype.replaceSlotDisplayList=function(t,e,i,n){var o=this.getArmatureData(e,t||"");if(!o||!o.defaultSkin)return!1;var a=o.defaultSkin.getDisplays(i);if(!a)return!1;n.displayFrameCount=a.length;for(var s=0,h=n.displayFrameCount;s<h;++s){var l=a[s];this.replaceDisplay(n,l,s)}return!0},BaseFactory.prototype.replaceSkin=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=null);for(var o=!1,a=e.parent.defaultSkin,s=0,h=t.getSlots();s<h.length;s++){var l=h[s];if(!(null!==n&&n.indexOf(l.name)>=0)){var c=e.getDisplays(l.name);if(null!==c||(null!==a&&e!==a&&(c=a.getDisplays(l.name)),null!==c)){l.displayFrameCount=c.length;for(var p=0,u=l.displayFrameCount;p<u;++p){var m=c[p];l.replaceRawDisplayData(m,p),null!==m?l.replaceDisplay(this._getSlotDisplay(null,m,l),p):l.replaceDisplay(null,p)}o=!0}else i&&(l.displayFrameCount=0)}}return o},BaseFactory.prototype.replaceAnimation=function(e,i,n){void 0===n&&(n=!0);var o=i.defaultSkin;if(null===o)return!1;if(n)e.animation.animations=i.animations;else{var a=e.animation.animations,s={};for(var h in a)s[h]=a[h];for(var h in i.animations)s[h]=i.animations[h];e.animation.animations=s}for(var l=0,c=e.getSlots();l<c.length;l++)for(var p=c[l],u=0,m=0,d=p.displayList;m<d.length;m++){var f=d[m];if(f instanceof t.Armature){var y=o.getDisplays(p.name);if(null!==y&&u<y.length){var g=y[u];if(null!==g&&1===g.type){var _=this.getArmatureData(g.path,g.parent.parent.parent.name);_&&this.replaceAnimation(f,_,n)}}}u++}return!0},BaseFactory.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},BaseFactory.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(BaseFactory.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(BaseFactory.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),BaseFactory._objectParser=null,BaseFactory._binaryParser=null,BaseFactory}();t.BaseFactory=e;var i=function i(){this.dataName="",this.textureAtlasName="",this.skin=null};t.BuildArmaturePackage=i}(c||(c={})),function(t){!function(t){!function(t){var e=function(t){function EventDispatcher(){return null!==t&&t.apply(this,arguments)||this}return o(EventDispatcher,t),EventDispatcher.prototype.hasDBEventListener=function(t){return this.listenerCount(t)>0},EventDispatcher.prototype.dispatchDBEvent=function(t,e){this.emit(t,e)},EventDispatcher.prototype.addDBEventListener=function(t,e,i){this.on(t,e,i)},EventDispatcher.prototype.removeDBEventListener=function(t,e,i){this.off(t,e,i)},EventDispatcher}(Phaser.Events.EventEmitter);t.EventDispatcher=e}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(t){t.Skew={getSkewX:function(){return this._skewX||0},setSkewX:function(t){this._skewX=t},getSkewY:function(){return this._skewY||0},setSkewY:function(t){this._skewY=t},setSkew:function(t,e){e=void 0===e?t:e,this._skewX=t,this._skewY=e}},t.extendSkew=function(e){Object.defineProperty(e.prototype,"skewX",{get:t.Skew.getSkewX,set:t.Skew.setSkewX,enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewY",{get:t.Skew.getSkewY,set:t.Skew.setSkewY,enumerable:!0,configurable:!0}),e.prototype.setSkew=t.Skew.setSkew}}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(t){var e=function(t){function TransformMatrix(e,i,n,o,a,s){var h=t.call(this,e,i,n,o,a,s)||this;return h.decomposedMatrix.skewX=0,h.decomposedMatrix.skewY=0,h}return o(TransformMatrix,t),TransformMatrix.prototype.decomposeMatrix=function(){var t=this.a,e=this.b,i=this.c,n=this.d,o=-Math.atan2(-i,n),a=Math.atan2(e,t),s=Math.abs(o+a);return s<1e-5||Math.abs(Phaser.Math.PI2-s)<1e-5?(this.decomposedMatrix.rotation=a,t<0&&n>=0&&(this.decomposedMatrix.rotation+=this.decomposedMatrix.rotation<=0?Math.PI:-Math.PI),this.decomposedMatrix.skewX=this.decomposedMatrix.skewY=0):(this.decomposedMatrix.rotation=0,this.decomposedMatrix.skewX=o,this.decomposedMatrix.skewY=a),this.decomposedMatrix.scaleX=Math.sqrt(t*t+e*e),this.decomposedMatrix.scaleY=Math.sqrt(i*i+n*n),this.decomposedMatrix.translateX=this.tx,this.decomposedMatrix.translateY=this.ty,this.decomposedMatrix},TransformMatrix.prototype.applyITRSC=function(t,e,i,n,o,a,s){return this.a=Math.cos(i-s)*n,this.b=Math.sin(i-s)*n,this.c=-Math.sin(i+a)*o,this.d=Math.cos(i+a)*o,this.tx=t,this.ty=e,this},Object.defineProperty(TransformMatrix.prototype,"skewX",{get:function(){return-Math.atan2(-this.c,this.d)},enumerable:!0,configurable:!0}),Object.defineProperty(TransformMatrix.prototype,"skewY",{get:function(){return Math.atan2(this.b,this.a)},enumerable:!0,configurable:!0}),TransformMatrix}(Phaser.GameObjects.Components.TransformMatrix);t.TransformMatrix=e}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(e){var i=function(e){function DisplayContainer(i,n,o,a){var s=e.call(this,i,n,o,a)||this;return s._skewX=0,s._skewY=0,s.tempTransformMatrix=new t.util.TransformMatrix,s}return o(DisplayContainer,e),DisplayContainer.prototype.pointToContainer=function(t,e){if(void 0===e&&(e=new Phaser.Math.Vector2),this.parentContainer)return this.parentContainer.pointToContainer(t,e);var i=this.tempTransformMatrix;return i.applyITRSC(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this._skewX,this._skewY),i.invert(),i.transformPoint(t.x,t.y,e),e},Object.defineProperty(DisplayContainer.prototype,"skewX",{get:function(){return this._skewX},set:function(t){this._skewX=t},enumerable:!0,configurable:!0}),Object.defineProperty(DisplayContainer.prototype,"skewY",{get:function(){return this._skewY},set:function(t){this._skewY=t},enumerable:!0,configurable:!0}),DisplayContainer.prototype.setSkew=function(t,e){return e=void 0===e?t:e,this.skewX=t,this.skewY=e,this},DisplayContainer}(Phaser.GameObjects.Container);e.DisplayContainer=i}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){var e,i;e=t.display||(t.display={}),i=function(t){function ArmatureDisplay(e){var i=t.call(this,e)||this;return i.debugDraw=!1,i}return o(ArmatureDisplay,t),ArmatureDisplay.prototype.dbInit=function(t){this._armature=t},ArmatureDisplay.prototype.dbClear=function(){this.removeAllListeners(),this._armature&&this._armature.dispose(),this._armature=null},ArmatureDisplay.prototype.dbUpdate=function(){this.debugDraw},ArmatureDisplay.prototype.dispose=function(e){this.dbClear(),!0===e&&t.prototype.destroy.call(this)},ArmatureDisplay.prototype.destroy=function(){this.dispose(!0)},ArmatureDisplay.prototype.dispatchDBEvent=function(t,e){this.emit(t,e)},ArmatureDisplay.prototype.hasDBEventListener=function(t){return this.listenerCount(t)>0},ArmatureDisplay.prototype.addDBEventListener=function(t,e,i){this.on(t,e,i)},ArmatureDisplay.prototype.removeDBEventListener=function(t,e,i){this.off(t,e,i)},Object.defineProperty(ArmatureDisplay.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(ArmatureDisplay.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),ArmatureDisplay.prototype.getBounds=function(t){void 0===t&&(t=new Phaser.Geom.Rectangle);for(var e=new Phaser.Geom.Rectangle,i=this.getBoundsTransformMatrix(),n=!0,o=0,a=this._armature.getSlots();o<a.length;o++){var s=a[o],h=s.display;if(h){if(h===s.meshDisplay){var l=h.fakeVertices;if(!(l&&l.length>0))continue;e.setTo(999999,999999,-999999,-999999);for(var c=0,p=l.length;c<p;c+=2){var u=l[c],m=l[c+1];e.x>u&&(e.x=u),e.width<u&&(e.width=u),e.y>m&&(e.y=m),e.height<m&&(e.height=m)}e.width-=e.x,e.height-=e.y}else if(s._displayFrame){var d=s._displayFrame.getTextureData();if(!d)continue;var f=d.parent.scale;e.width=d.region.width*f,e.height=d.region.height*f,e.x=-e.width/2,e.y=-e.height/2}e.width*=this.scaleX,e.height*=this.scaleY,i.transformPoint(e.x,e.y,e),n?(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,n=!1):Phaser.Geom.Rectangle.Union(e,t,t)}}return t},ArmatureDisplay}(e.DisplayContainer),e.ArmatureDisplay=i}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(e){var i=function(t){function SlotImage(e,i,n,o,a){var s=t.call(this,e,i,n,o,a)||this;return s.setPipeline("PhaserTextureTintPipeline"),s}return o(SlotImage,t),SlotImage}(Phaser.GameObjects.Image);e.SlotImage=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(e){var i=function(t){function SlotSprite(e,i,n,o,a){var s=t.call(this,e,i,n,o,a)||this;return s.setPipeline("PhaserTextureTintPipeline"),s}return o(SlotSprite,t),SlotSprite}(Phaser.GameObjects.Sprite);e.SlotSprite=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(e){var i=function(t){function SlotMesh(e,i,n,o,a,s,h,l,c){var p=t.call(this,e,i,n,o,a,s,h,l,c)||this;return p.setPipeline("PhaserTextureTintPipeline"),p}return o(SlotMesh,t),SlotMesh.prototype.setTint=function(t,e,i,n){},SlotMesh.prototype.updateVertices=function(){var t=this.fakeIndices,e=this.fakeVertices,i=this.fakeUvs;this.vertices=new Float32Array(2*t.length),this.uv=new Float32Array(2*t.length),this.alphas=new Uint32Array(t.length),this.colors=new Uint32Array(t.length);for(var n=0;n<t.length;n++)this.vertices[2*n]=e[2*t[n]],this.vertices[2*n+1]=e[2*t[n]+1],this.uv[2*n]=i[2*t[n]],this.uv[2*n+1]=i[2*t[n]+1],this.alphas[n]=1,this.colors[n]=16777215},SlotMesh}(Phaser.GameObjects.Mesh);e.SlotMesh=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(e){!function(e){var i=function(i){function Slot(){return null!==i&&i.apply(this,arguments)||this}return o(Slot,i),Slot.toString=function(){return"[class dragonBones.PhaserSlot]"},Slot.prototype._onClear=function(){i.prototype._onClear.call(this),this._textureScale=1,this._renderDisplay&&(this._renderDisplay.destroy(),this._renderDisplay=null)},Slot.prototype._initDisplay=function(t,e){},Slot.prototype._disposeDisplay=function(t,e){},Slot.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display||this._rawDisplay},Slot.prototype._addDisplay=function(){this.armature.display.add(this._renderDisplay)},Slot.prototype._replaceDisplay=function(t){this._renderDisplay.setSkew?(this.armature.display.replace(t,this._renderDisplay),this._renderDisplay.parentContainer=this.armature.display):console.warn("please call dragonBones.phaser.util.extendSkew to mix skew component into your display object,\n                                and set its pipeline to 'PhaserTextureTintPipeline' by calling 'setPiepline' method, more detail please refer to the 'ReplaceSlotDisplay.ts' example")},Slot.prototype._removeDisplay=function(){this._renderDisplay.parentContainer.remove(this._renderDisplay)},Slot.prototype._updateDisplayData=function(){i.prototype._updateDisplayData.call(this),null!==this.armature.replacedTexture&&(this._textureDirty=!0)},Slot.prototype._updateZOrder=function(){this._renderDisplay.depth!==this._zOrder&&this._renderDisplay.setDepth(this._zOrder)},Slot.prototype._updateVisible=function(){this._renderDisplay.setVisible(this._parent.visible&&this._visible)},Slot.prototype._updateBlendMode=function(){var t=Phaser.BlendModes.NORMAL;switch(this._blendMode){case 0:t=Phaser.BlendModes.NORMAL;break;case 1:t=Phaser.BlendModes.ADD;break;case 3:t=Phaser.BlendModes.DARKEN;break;case 4:t=Phaser.BlendModes.DIFFERENCE;break;case 6:t=Phaser.BlendModes.HARD_LIGHT;break;case 9:t=Phaser.BlendModes.LIGHTEN;break;case 10:t=Phaser.BlendModes.MULTIPLY;break;case 11:t=Phaser.BlendModes.OVERLAY;break;case 12:t=Phaser.BlendModes.SCREEN}this._renderDisplay.setBlendMode(t)},Slot.prototype._updateColor=function(){var t=this._colorTransform,i=this._globalAlpha*t.alphaMultiplier+t.alphaOffset;if(this._renderDisplay.setAlpha(i),!(this._renderDisplay instanceof e.DisplayContainer)){var n=255*t.redMultiplier+t.redOffset<<16|255*t.greenMultiplier+t.greenOffset<<8|255*t.blueMultiplier+t.blueOffset;this._renderDisplay.setTint(n)}},Slot.prototype._updateFrame=function(){if(!(this._renderDisplay instanceof e.DisplayContainer)){var i=this._textureData;if(this._displayIndex>=0&&null!==this._display&&null!==i){var n=i.parent;null!==this.armature.replacedTexture&&(null===this.armature._replaceTextureAtlasData?((n=t.BaseObject.borrowObject(e.TextureAtlasData)).copyFrom(i.parent),n.renderTexture=this.armature.replacedTexture,this.armature._replaceTextureAtlasData=n):n=this.armature._replaceTextureAtlasData,i=n.getTexture(i.name));var o=i.renderTexture;if(null!==o){if(null!==this._geometryData){var a=this._geometryData.data,s=a.intArray,h=a.floatArray,l=s[this._geometryData.offset+0],c=s[this._geometryData.offset+1],p=s[this._geometryData.offset+2];p<0&&(p+=65536);var u=p+2*l,m=this._armature._armatureData.scale,d=this._renderDisplay,f=i.region;d.fakeVertices=new Float32Array(2*l),d.fakeUvs=new Float32Array(2*l),d.fakeIndices=new Uint16Array(3*c);for(var y=0,g=2*l;y<g;++y)d.fakeVertices[y]=h[p+y]*m;for(y=0;y<3*c;++y)d.fakeIndices[y]=s[this._geometryData.offset+4+y];for(y=0,g=2*l;y<g;y+=2){var _=h[u+y],v=h[u+y+1];i.rotated?(d.fakeUvs[y]=(f.x+(1-v)*f.width)/n.width,d.fakeUvs[y+1]=(f.y+_*f.height)/n.height):(d.fakeUvs[y]=(f.x+_*f.width)/n.width,d.fakeUvs[y+1]=(f.y+v*f.height)/n.height)}this._textureScale=1,d.texture=o.texture,d.frame=o,d.updateVertices();var b=null!==this._geometryData.weight,P=0!==this._parent._boneData.type;(b||P)&&this._identityTransform()}else this._renderDisplay.texture=o.texture,this._renderDisplay.frame=o,this._renderDisplay.setDisplayOrigin(this._pivotX,this._pivotY),this._textureScale=i.parent.scale*this.armature.armatureData.scale,this._renderDisplay.setScale(this._textureScale);return void(this._visibleDirty=!0)}}else this._renderDisplay.x=0,this._renderDisplay.y=0,this._renderDisplay.setTexture(void 0)}},Slot.prototype._updateMesh=function(){var t=this._armature._armatureData.scale,e=this._displayFrame.deformVertices,i=this._geometryBones,n=this._geometryData,o=n.weight,a=e.length>0&&n.inheritDeform,s=this._renderDisplay;if(null!==o){var h=(D=n.data).intArray,l=D.floatArray,c=h[n.offset+0],p=h[o.offset+1];p<0&&(p+=65536);for(var u=0,m=0,d=o.offset+2+i.length,f=p,y=0;u<c;++u){for(var g=h[d++],_=0,v=0,b=0;b<g;++b){var P=i[h[d++]];if(null!==P){var S=P.globalTransformMatrix,w=l[f++],T=l[f++]*t,C=l[f++]*t;a&&(T+=e[y++],C+=e[y++]),_+=(S.a*T+S.c*C+S.tx)*w,v+=(S.b*T+S.d*C+S.ty)*w}}s.fakeVertices[m++]=_,s.fakeVertices[m++]=v}}else{var D,M=0!==this._parent._boneData.type,O=(h=(D=n.data).intArray,l=D.floatArray,c=h[n.offset+0],h[n.offset+2]);O<0&&(O+=65536);u=0;for(var x=2*c;u<x;u+=2){var E=l[O+u]*t,B=l[O+u+1]*t;if(a&&(E+=e[u],B+=e[u+1]),M){S=this._parent._getGlobalTransformMatrix(E,B);s.fakeVertices[u]=S.a*E+S.c*B+S.tx,s.fakeVertices[u+1]=S.b*E+S.d*B+S.ty}else s.fakeVertices[u]=E,s.fakeVertices[u+1]=B}}s.updateVertices()},Slot.prototype._updateTransform=function(){this.updateGlobalTransform();var t=this.global;this._renderDisplay.x=t.x,this._renderDisplay.y=t.y,this._renderDisplay.rotation=t.rotation,this._renderDisplay.setSkew(t.skew,0),this._renderDisplay.setScale(t.scaleX*this._textureScale,t.scaleY*this._textureScale)},Slot.prototype._identityTransform=function(){this._renderDisplay.setPosition(),this._renderDisplay.setRotation(),this._textureScale=1,this._renderDisplay.setScale(this._textureScale),this._renderDisplay.setSkew(0)},Slot}(t.Slot);e.Slot=i}(e.display||(e.display={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(e){!function(e){var i=function(e){function TextureAtlasData(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderTexture=null,t}return o(TextureAtlasData,e),TextureAtlasData.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"},TextureAtlasData.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this._renderTexture&&this._renderTexture.destroy(),this._renderTexture=null},TextureAtlasData.prototype.createTexture=function(){return t.BaseObject.borrowObject(n)},Object.defineProperty(TextureAtlasData.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(t){if(t&&this._renderTexture!==t)for(var e in this._renderTexture&&this._renderTexture.destroy(),this._renderTexture=t,this.textures){var i=this.textures[e],n=this._renderTexture.has(e)?this._renderTexture.get(e):this._renderTexture.add(e,0,i.region.x,i.region.y,i.region.width,i.region.height);i.rotated&&(n.rotated=!0,n.updateUVsInverted()),i.renderTexture=n}},enumerable:!0,configurable:!0}),TextureAtlasData}(t.TextureAtlasData);e.TextureAtlasData=i;var n=function(t){function TextureData(){var e=null!==t&&t.apply(this,arguments)||this;return e.renderTexture=null,e}return o(TextureData,t),TextureData.toString=function(){return"[class dragonBones.PhaserTextureData]"},TextureData.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.renderTexture&&this.renderTexture.destroy(),this.renderTexture=null},TextureData}(t.TextureData);e.TextureData=n}(e.display||(e.display={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(e){var i=function(e){function TextureTintPipeline(i){var n=e.call(this,i)||this;return n._tempMatrix1=new t.util.TransformMatrix,n._tempMatrix2=new t.util.TransformMatrix,n._tempMatrix3=new t.util.TransformMatrix,n}return o(TextureTintPipeline,e),TextureTintPipeline.prototype.batchSprite=function(t,e,i){this.renderer.setPipeline(this);var n=this._tempMatrix1,o=this._tempMatrix2,a=this._tempMatrix3,s=t.frame,h=s.glTexture,l=s.u0,c=s.v0,p=s.u1,u=s.v1,m=s.x,d=s.y,f=s.width,y=s.height,g=-t.displayOriginX+m,_=-t.displayOriginY+d;if(t.isCropped){var v=t._crop;v.flipX===t.flipX&&v.flipY===t.flipY||s.updateCropUVs(v,t.flipX,t.flipY),l=v.u0,c=v.v0,p=v.u1,u=v.v1,f=v.width,y=v.height,m=v.x,d=v.y,g=-t.displayOriginX+m,_=-t.displayOriginY+d}t.flipX&&(g+=f,f*=-1),t.flipY&&(_+=y,y*=-1);var b=g+f,P=_+y;o.applyITRSC(t.x,t.y,t.rotation,t.scaleX,t.scaleY,t.skewX||0,t.skewY||0),n.copyFrom(e.matrix),i?(n.multiplyWithOffset(i,-e.scrollX*t.scrollFactorX,-e.scrollY*t.scrollFactorY),o.e=t.x,o.f=t.y,n.multiply(o,a)):(o.e-=e.scrollX*t.scrollFactorX,o.f-=e.scrollY*t.scrollFactorY,n.multiply(o,a));var S=a.getX(g,_),w=a.getY(g,_),T=a.getX(g,P),C=a.getY(g,P),D=a.getX(b,P),M=a.getY(b,P),O=a.getX(b,_),x=a.getY(b,_),E=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintTL,e.alpha*t._alphaTL),B=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintTR,e.alpha*t._alphaTR),I=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintBL,e.alpha*t._alphaBL),A=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintBR,e.alpha*t._alphaBR);e.roundPixels&&(S|=0,w|=0,T|=0,C|=0,D|=0,M|=0,O|=0,x|=0),this.setTexture2D(h,0);var R=t._isTinted&&t.tintFill;this.batchQuad(S,w,T,C,D,M,O,x,l,c,p,u,E,B,I,A,R)},TextureTintPipeline}(Phaser.Renderer.WebGL.Pipelines.TextureTintPipeline);e.TextureTintPipeline=i}(t.pipeline||(t.pipeline={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(t){t.FileTypes={IMAGE:"imageFile",JSON:"jsonFile",BINARY:"binaryFile",map:{imageFile:Phaser.Loader.FileTypes.ImageFile,jsonFile:Phaser.Loader.FileTypes.JSONFile,binaryFile:Phaser.Loader.FileTypes.BinaryFile},setType:function(e,i){t.FileTypes.map[e]=i},getType:function(e){return t.FileTypes.map[e]}}}(t.plugin||(t.plugin={}))}(t.phaser||(t.phaser={}))}(c||(c={})),function(t){!function(t){!function(t){var e=function(e){function DragonBonesFile(i,n,o,a,s,h,l,c){var p,u,m,d,f=t.FileTypes.getType(t.FileTypes.BINARY),y=t.FileTypes.getType(t.FileTypes.JSON),g=t.FileTypes.getType(t.FileTypes.IMAGE),createBoneFileByType=function(t,e,i,n){var o="json";if(n&&n.responseType)switch(n.responseType){case"arraybuffer":case"blob":o="bin";break;case"json":case"text":o="json"}return"bin"===o?new f(t,e,i,n):new y(t,e,i,n)};if(Phaser.Utils.Objects.IsPlainObject(n)){var _=n;p=new g(i,{key:d=Phaser.Utils.Objects.GetFastValue(_,"key"),url:Phaser.Utils.Objects.GetFastValue(_,"textureURL"),extension:Phaser.Utils.Objects.GetFastValue(_,"textureExtension","png"),xhrSettings:Phaser.Utils.Objects.GetFastValue(_,"textureXhrSettings")}),u=new y(i,{key:d+"_atlasjson",url:Phaser.Utils.Objects.GetFastValue(_,"atlasURL"),extension:Phaser.Utils.Objects.GetFastValue(_,"atlasExtension","json"),xhrSettings:Phaser.Utils.Objects.GetFastValue(_,"atlasXhrSettings")}),m=createBoneFileByType(i,d,Phaser.Utils.Objects.GetFastValue(_,"boneURL"),Phaser.Utils.Objects.GetFastValue(_,"boneXhrSettings"))}else p=new g(i,d=n,o,h),u=new y(i,d+"_atlasjson",a,l),m=createBoneFileByType(i,d,s,c);return m.cache=i.cacheManager.custom.dragonbone,e.call(this,i,"dragonbone",d,[p,u,m])||this}return o(DragonBonesFile,e),DragonBonesFile.prototype.addToCache=function(){if(this.isReadyToProcess()){var t=this.files[0],e=this.files[1],i=this.files[2];e.addToCache(),i.addToCache(),t.addToCache(),this.complete=!0}},DragonBonesFile}(Phaser.Loader.MultiFile);t.DragonBonesFile=e}(t.plugin||(t.plugin={}))}(t.phaser||(t.phaser={}))}(c||(c={})),l=c||(c={}),function(t){var e=function(t){function DragonBonesScenePlugin(e,i){var n=t.call(this,e,i)||this,o=n.game;if(o.cache.addCustom("dragonbone"),n.game.config.renderType===Phaser.WEBGL){var a=n.game.renderer;a.hasPipeline("PhaserTextureTintPipeline")||a.addPipeline("PhaserTextureTintPipeline",new h.pipeline.TextureTintPipeline({game:o,renderer:a}))}return i.registerGameObject("dragonBones",CreateDragonBonesRegisterHandler),i.registerGameObject("armature",CreateArmatureRegisterHandler),i.registerGameObject("dragonBoneFactory",CreateDragonBoneFactoryRegisterHandler),i.registerFileType("dragonbone",DragonBoneFileRegisterHandler,e),n}return o(DragonBonesScenePlugin,t),DragonBonesScenePlugin.prototype.createArmature=function(t,e,i,n,o){void 0===o&&(o=1);var a=this.factory.buildArmatureDisplay(t,e,i,n,o);return this.systems.displayList.add(a),this._dbInst.clock.add(a.armature),a},DragonBonesScenePlugin.prototype.createDragonBones=function(t,e){return void 0===e&&(e=1),this.factory.buildDragonBonesData(t,e)},Object.defineProperty(DragonBonesScenePlugin.prototype,"factory",{get:function(){return this._factory||(this._dbInst=new c.DragonBones(new h.util.EventDispatcher),this._factory=new h.Factory(this._dbInst,this.scene)),this._factory},enumerable:!0,configurable:!0}),DragonBonesScenePlugin.prototype.createSlotDisplayPlaceholder=function(){return new h.display.SlotImage(this.scene,0,0)},DragonBonesScenePlugin.prototype.boot=function(){this.systems.events.once("destroy",this.destroy,this),this.start()},DragonBonesScenePlugin.prototype.start=function(){var t=this.systems.events;t.on("update",this.update,this),t.once("shutdown",this.shutdown,this)},DragonBonesScenePlugin.prototype.update=function(t,e){this._dbInst&&this._dbInst.advanceTime(.001*e)},DragonBonesScenePlugin.prototype.shutdown=function(){var t=this.systems.events;t.off("update",this.update,this),t.off("shutdown",this.shutdown,this)},DragonBonesScenePlugin.prototype.destroy=function(){this.shutdown(),this._factory=this._dbInst=null,this.pluginManager=this.game=this.scene=this.systems=null},DragonBonesScenePlugin.prototype.createMeshDisplayPlaceholder=function(){return new h.display.SlotMesh(this.scene,0,0,[],[],[],[],null,null)},DragonBonesScenePlugin}(Phaser.Plugins.ScenePlugin);t.DragonBonesScenePlugin=e;var CreateDragonBonesRegisterHandler=function(t,e){return void 0===e&&(e=1),this.scene.dragonbone.createDragonBones(t,e)},CreateArmatureRegisterHandler=function(t,e,i,n){return this.scene.dragonbone.createArmature(t,e,i,n)},CreateDragonBoneFactoryRegisterHandler=function(){return this.scene.dragonbone.factory},DragonBoneFileRegisterHandler=function(e,i,n,o,a,s,h){var l=new t.DragonBonesFile(this,e,i,n,o,a,s,h);return this.addFile(l.files),this}}((h=l.phaser||(l.phaser={})).plugin||(h.plugin={})),function(t){var e=function(e){function Factory(t,i,n){var o=e.call(this,n)||this;return o._scene=i,o._dragonBones=t,o}return o(Factory,e),Factory.prototype._isSupportMesh=function(){return!0},Factory.prototype._buildTextureAtlasData=function(e,i){return e?e.renderTexture=i:e=p.BaseObject.borrowObject(t.display.TextureAtlasData),e},Factory.prototype._buildArmature=function(e){var i=p.BaseObject.borrowObject(p.Armature),n=new t.display.ArmatureDisplay(this._scene);return i.init(e.armature,n,n,this._dragonBones),i},Factory.prototype._buildSlot=function(e,i,n){var o=p.BaseObject.borrowObject(t.display.Slot),a=this._scene.dragonbone.createSlotDisplayPlaceholder(),s=this._scene.dragonbone.createMeshDisplayPlaceholder();return o.init(i,n,a,s),o},Factory.prototype.buildArmatureDisplay=function(t,e,i,n,o){var a;return void 0===i&&(i=""),void 0===n&&(n=""),void 0===o&&(o=1),this.buildDragonBonesData(e,o)&&(a=this.buildArmature(t,e,i,n)),a.display},Factory.prototype.buildDragonBonesData=function(t,e){void 0===e&&(e=1);var i=this._dragonBonesDataMap[t];if(!i){var n=this._scene.cache,o=n.custom.dragonbone.get(t);if(o){i=this.parseDragonBonesData(o,t,e);var a=this._scene.textures.get(t),s=n.json.get(t+"_atlasjson");this.parseTextureAtlasData(s,a,a.key,e)}}return i},Object.defineProperty(Factory.prototype,"soundEventManager",{get:function(){return this._dragonBones.eventManager},enumerable:!0,configurable:!0}),Factory}(p.BaseFactory);t.Factory=e}((p=c||(c={})).phaser||(p.phaser={}))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var n=i(4),o=i(76),a=i(8),s=i(364),h=i.n(s),l=i(365),c=i.n(l),p=i(3);for(var u in p)n.PBpacket.addProtocol(p[u]);var m=function(){function Connection(t){this.mPacketHandlers=[],this.mReConnectCount=0,this.mListener=t}return Connection.prototype.startConnect=function(t,e){this.mCachedServerAddress=t;try{this.mHeartBeatWorker=new c.a,this.mWorker=new h.a,this._doConnect()}catch(t){throw new Error("startConnect Error: "+t)}},Connection.prototype.closeConnect=function(){this.mWorker.terminate(),this.mHeartBeatWorker.terminate(),this.mCachedServerAddress=void 0,this.mReConnectCount=0,this.mTimeout=null,this.clearPacketListeners()},Connection.prototype.clearHeartBeat=function(){this.mHeartBeatWorker&&this.mHeartBeatWorker.postMessage({method:"clearBeat"})},Connection.prototype.addPacketListener=function(t){this.mPacketHandlers.push(t)},Connection.prototype.send=function(t){if(!this.mWorker)throw new Error("NetWorker is undefined.");this.mWorker.postMessage({method:"send",buffer:t.Serialization()})},Connection.prototype.clearReconnectCount=function(){this.mHeartBeatWorker.postMessage("clearBeat")},Connection.prototype.removePacketListener=function(t){var e=this.mPacketHandlers.indexOf(t);-1!==e&&this.mPacketHandlers.splice(e,1)},Connection.prototype.clearPacketListeners=function(){if(this.mPacketHandlers&&!(this.mPacketHandlers.length<1))for(var t=this.mPacketHandlers.length,e=0;e<t;e++){var i=this.mPacketHandlers[e];i&&(this.removePacketListener(i),e--)}},Connection.prototype._doConnect=function(){var t=this;this.mWorker&&(this.mWorker.onmessage=function(e){t.onWorkerMessage(e.data)},this.mHeartBeatWorker&&(this.mHeartBeatWorker.onmessage=function(e){t.onWorkerMessage(e.data)}),this.mWorker.postMessage({method:"connect",address:t.mCachedServerAddress}))},Connection.prototype.onWorkerMessage=function(t){var e=this;switch(t.method){case"onConnected":this.mReConnectCount=0,this.mListener.onConnected(),this.mHeartBeatWorker&&this.mHeartBeatWorker.postMessage({method:"startBeat"});break;case"onDisConnected":if(!this.mTimeout){this.mReConnectCount<10&&this.mReConnectCount++;var i=Math.pow(this.mReConnectCount,2);a.a.getInstance().info("ReConnect: delay = "+1e3*i+"[c/"+this.mReConnectCount+"]"),this.mTimeout=setTimeout((function(){e.mTimeout=void 0,e._doConnect()}),1e3*i)}break;case"onConnectError":a.a.getInstance().error("error"+t.error),this.reConnect();break;case"heartBeat":this.worldStartHeartBeat();break;case"endBeat":this.endHeartBeat();break;case"reConnect":this.reConnect();break;case"onData":var n=t.buffer;n&&this._onData(n)}},Connection.prototype._onData=function(t){var e=new n.PBpacket;e.Deserialization(new o.Buffer(t)),this.mPacketHandlers.forEach((function(t){t.onPacketArrived(e)}))},Connection.prototype.reConnect=function(){this.mHeartBeatWorker.postMessage({method:"endHeartBeat"}),this.mPacketHandlers[0].reconnect()},Connection.prototype.worldStartHeartBeat=function(){this.mPacketHandlers[0].startHeartBeat()},Connection.prototype.endHeartBeat=function(){this.mHeartBeatWorker&&this.mHeartBeatWorker.terminate()},Connection}();e.a=m},function(t,e,i){t.exports=function(){return new Worker(i.p+"js/5b336c092af9bfac0f70.networker.js")}},function(t,e,i){t.exports=function(){return new Worker(i.p+"js/ccd13e2338272d6c4536.heartbeatworker.js")}},,,function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n,o=i(4),a=i(3),s=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function KeyBoardManager(e,i){var n=t.call(this)||this;return n.worldService=e,n.mInitilized=!0,n.mKeyboardListeners=[],n.mKeyList=[],n.mKeyDownList=[],n.mKeyEvents=i,n.mTmpUpKeysStr="",n.mTmpDownKeyStr="",n.mKeyEventMap=new Map,n.mConnect=n.worldService.connection,n}return s(KeyBoardManager,t),KeyBoardManager.prototype.onRoomChanged=function(t,e){var i=this;if(this.mRoom=t,this.mScene=t.scene,this.mScene){if(this.mKeyEvents){for(var n=this.mKeyEvents.length,o=void 0,a=void 0,s=0;s<n;s++)(o=this.mKeyEvents[s]).keyCodes,a=o.tqEvent,this.mKeyEventMap.get(a)||this.mKeyEventMap.set(a,o);this.mKeyEvents.length=0,this.mKeyEvents=null}this.mKeyEventMap.forEach((function(t){if(t)for(var e=t.keyCodes,n=e.length,o=void 0,a=0;a<n;a++){o=e[a];var s=i.mScene.input.keyboard.addKey(o,!1);i.addKeyEvent(s,t.tqEvent)}}))}},KeyBoardManager.prototype.getKeyCodes=function(t){if(this.mKeyEventMap.has(t))return this.mKeyEventMap.get(t).keyCodes},KeyBoardManager.prototype.resize=function(t,e){},KeyBoardManager.prototype.addListener=function(t){this.mKeyboardListeners.push(t)},KeyBoardManager.prototype.removeListener=function(t){var e=this.mKeyboardListeners.indexOf(t);e>=0&&this.mKeyboardListeners.splice(e,1)},Object.defineProperty(KeyBoardManager.prototype,"enable",{get:function(){return void 0!==this.mScene&&this.mScene.input.keyboard.enabled},set:function(t){this.mScene&&(this.mScene.input.keyboard.enabled=t)},enumerable:!1,configurable:!0}),Object.defineProperty(KeyBoardManager.prototype,"keyList",{get:function(){return this.mKeyList},enumerable:!1,configurable:!0}),KeyBoardManager.prototype.getKeyDowns=function(){return this.mInitilized&&this.mKeyList?(this.mKeyDownList=this.mKeyList.filter((function(t){return t.isDown})),this.mKeyDownList.map((function(t){return t.keyCode}))):[]},KeyBoardManager.prototype.getKeyUps=function(){var t,e=[];if(!this.mInitilized)return e;if(!this.mKeyDownList)return[];for(var i=0;i<this.mKeyDownList.length;i++)(t=this.mKeyDownList[i])&&t.isUp&&(this.mKeyDownList.splice(i,1),e.push(t.keyCode),i--);return e},KeyBoardManager.prototype.destroy=function(){this.removeKeyEvents(),this.mKeyDownList&&(this.mKeyDownList.length=0,this.mKeyDownList=null),this.mTmpDownKeyStr=null,this.mTmpUpKeysStr=null,this.mScene=null,this.mConnect=null,this.mInitilized=!1},KeyBoardManager.prototype.concatArr=function(t,e){var i,n=t.length>e.length?e.length:t.length,o=t.length>e.length?t:e,a=t.length>e.length?e:t;for(i=0;i<n;i++)o.push(a[i]);return o},KeyBoardManager.prototype.checkMoveKeyDown=function(t){for(var e,i,n=this.mKeyList,o=n.length,s=[],h=0,l=this.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_LEFT),c=this.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_DOWN),p=this.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_RIGHT),u=this.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_UP),m=0;m<o;m++)if(i=(e=n[m]).keyCode,e&&e.isDown){if(s.push(e.keyCode),l)if(l.indexOf(i)>-1){h+=-1;continue}if(p)if(p.indexOf(i)>-1){h+=1;continue}if(c)if(c.indexOf(i)>-1){h+=3;continue}if(u)if(u.indexOf(i)>-1){h+=-3;continue}}if(0===h)return!1;var d,f=t.getDirection();switch(h){case-1:d=f<=1?1:3;break;case-2:d=7;break;case-3:d=f<=3?1:7;break;case-4:d=1;break;case 1:d=f<=5?5:7;break;case 2:d=3;break;case 3:d=f<=3?3:5;break;case 4:d=5}return this.enable&&(t.setDirection(d),t.downHandler(d,s),this.mRoom&&this.mRoom.playerManager.actor&&this.mRoom.playerManager.actor.setDirection(d)),!0},KeyBoardManager.prototype.checkMoveKeyAllUp=function(){for(var t,e=this.mKeyList,i=e.length,n=0;n<i;n++)if((t=e[n])&&t.isDown)return!1;return!0},KeyBoardManager.prototype.addKeyEvent=function(t,e){t.on("down",this.keyDownHandle,this),t.on("up",this.keyUpHandle,this),this.mKeyList.push(t)},KeyBoardManager.prototype.keyDownHandle=function(t){var e=this;if(this.enable){var i=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),n=i.content,s=this.getKeyDowns();this.mTmpDownKeyStr!==s.toString()&&(this.mTmpUpKeysStr="",this.mTmpDownKeyStr=s.toString(),n.keyCodes=s,this.mConnect.send(i),this.mKeyboardListeners.forEach((function(t){e.checkMoveKeyDown(t)})))}},KeyBoardManager.prototype.keyUpHandle=function(t){var e=this;if(this.enable){var i=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_UP),n=i.content,s=this.getKeyUps();this.mTmpUpKeysStr===s.toString()||s.length<1||(this.mTmpDownKeyStr="",this.mTmpUpKeysStr=s.toString(),n.keyCodes=s,this.mConnect.send(i),this.mKeyboardListeners.forEach((function(t){e.checkMoveKeyAllUp()?t.upHandler():e.checkMoveKeyDown(t)})))}},KeyBoardManager.prototype.removeKeyEvents=function(){if(this.mScene){for(var t,e=this.mKeyList.length,i=0;i<e;i++)(t=this.mKeyList[i])&&(t.off("down",this.keyDownHandle),t.off("up",this.keyUpHandle),this.mScene.input.keyboard.removeKey(t.keyCode));this.mKeyList.length=0}},KeyBoardManager}(o.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n,o,a=i(4),s=i(3),h=i(13),l=i(78),c=i(22),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.RightMouseDown=1]="RightMouseDown",t[t.RightMouseUp=2]="RightMouseUp",t[t.LeftMouseDown=3]="LeftMouseDown",t[t.LeftMouseUp=4]="LeftMouseUp",t[t.WheelDown=5]="WheelDown",t[t.WheelUp=6]="WheelUp",t[t.RightMouseHolding=7]="RightMouseHolding",t[t.LeftMouseHolding=8]="LeftMouseHolding",t[t.Tap=9]="Tap"}(o||(o={}));var u=function(t){function MouseManager(e){var i=t.call(this)||this;return i.worldService=e,i.running=!1,i.mDownDelay=2e3,i.mGame=e.game,i.zoom=i.worldService.scaleRatio||1,i.mConnect=i.worldService.connection,i}return p(MouseManager,t),MouseManager.prototype.changeRoom=function(t){if(this.pause(),this.mScene=t.scene,this.mRoom=t,this.mScene){try{t.addMouseListen()}catch(t){}t.scene.input.on("gameobjectdown",this.groundDown,this),t.scene.input.on("pointerdown",this.pointerDownHandler,this),t.scene.input.on("pointerup",this.onPointerUpHandler,this),this.resume()}},MouseManager.prototype.resize=function(t,e){},MouseManager.prototype.pause=function(){this.running=!1},MouseManager.prototype.resume=function(){this.running=!0},MouseManager.prototype.onUpdate=function(t,e){if(!1!==this.running&&void 0!==t){var i=[];t.leftButtonDown()?i.push(o.LeftMouseDown):t.leftButtonReleased()&&i.push(o.LeftMouseUp),t.middleButtonDown()?i.push(o.WheelDown):t.middleButtonReleased()&&i.push(o.WheelUp),t.rightButtonDown()?i.push(o.RightMouseDown):t.rightButtonReleased()&&i.push(o.RightMouseUp);var n=0,h=null;if(e&&e.parentContainer&&(n=e.parentContainer.getData("id"),h=e.parentContainer),!1===t.isDown){var p=Math.abs(t.downX-t.upX),u=Math.abs(t.downY-t.upY);if(p<10&&u<10)if(this.worldService.emitter.emit("Tap",t,e),!1===t.isDown)if(h instanceof l.a)h.element instanceof c.b&&h.scaleTween()}if(0!==i.length){var m=new a.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOUSE_EVENT),d=m.content;d.id=n,d.mouseEvent=i,d.point3f={x:t.worldX/this.zoom,y:t.worldY/this.zoom},this.mConnect.send(m)}}},Object.defineProperty(MouseManager.prototype,"enable",{get:function(){return!!this.mScene&&this.mScene.input.mouse.enabled},set:function(t){this.mScene&&(this.mScene.input.mouse.enabled=t)},enumerable:!1,configurable:!0}),MouseManager.prototype.destroy=function(){this.mScene=null,this.mConnect=null,this.mGroundLayer=null,this.running=!1},MouseManager.prototype.groundDown=function(t,e){var i=this;this.mGameObject=e,this.mDownTime=setTimeout((function(){i.worldService.emitter.emit(h.a.PRESS_ELEMENT,t,e)}),this.mDownDelay)},MouseManager.prototype.groundUp=function(t,e){this.onUpdate(t,e)},MouseManager.prototype.pointerDownHandler=function(t,e){this.worldService&&this.worldService.emitter&&this.worldService.emitter.emit(h.a.SCENE_BACKGROUND_CLICK,t),this.onUpdate(t,this.mGameObject)},MouseManager.prototype.onPointerUpHandler=function(t){clearTimeout(this.mDownTime),this.onUpdate(t,this.mGameObject),this.mGameObject=null},MouseManager}(a.PacketHandler)},function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n=i(8),o=i(22),a=i(3),s=i(326),h=function(){function JoyStickManager(t,e){this.worldService=t,this.mEnabled=!1,this.mOnListener=!1,this.mJoyListeners=[],this.mScale=t.uiScale,this.mKeyEvents=e,this.mKeyEventMap=new Map,n.a.getInstance().debug("JoyStickManager "+t.uiScale)}return JoyStickManager.prototype.onRoomChanged=function(t,e){this.mJoyStick?t instanceof s.a?this.mJoyStick.offListener():this.mJoyStick.onListener():this.mOnListener=!(t instanceof s.a)},JoyStickManager.prototype.setScene=function(t){if(this.mScene=t,this.mScene&&this.mKeyEvents){for(var e,i,n=this.mKeyEvents.length,o=0;o<n;o++)(e=this.mKeyEvents[o]).keyCodes,i=e.tqEvent,this.mKeyEventMap.get(i)||this.mKeyEventMap.set(i,e);this.mKeyEvents.length=0,this.mKeyEvents=null,this.mParentcon=this.mScene.add.container(0,0);var a=this.mScale?this.mScale:1;this.mJoyStick=new l(this.mScene,this.worldService,this.mParentcon,this.mJoyListeners,a),this.mOnListener?this.mJoyStick.onListener():this.mJoyStick.offListener()}},JoyStickManager.prototype.resize=function(){this.mParentcon&&(this.mParentcon.scaleX=this.mParentcon.scaleY=this.worldService.uiScale)},JoyStickManager.prototype.tweenView=function(t){this.mParentcon.visible=t},JoyStickManager.prototype.addListener=function(t){this.mJoyListeners.push(t),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)},JoyStickManager.prototype.getKeyCodes=function(t){if(this.mKeyEventMap.has(t)){for(var e=this.mKeyEventMap.get(t).keyCodes.length,i=[],n=0;n<e;n++){var o=this.mKeyEventMap.get(t).keyCodes[n];i.push(o)}return i}},JoyStickManager.prototype.removeListener=function(t){var e=this.mJoyListeners.indexOf(t);e>=0&&this.mJoyListeners.splice(e,1),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)},JoyStickManager.prototype.getKeyDowns=function(){return[]},JoyStickManager.prototype.getKeyUps=function(){return[]},JoyStickManager.prototype.downHandler=function(){},JoyStickManager.prototype.upHandler=function(){},Object.defineProperty(JoyStickManager.prototype,"enable",{get:function(){return this.mEnabled},set:function(t){this.mEnabled=t},enumerable:!1,configurable:!0}),JoyStickManager}(),l=function(){function JoyStick(t,e,i,n,o){this.mDown=!1,this.mScene=t,this.mWorld=e,this.parentCon=i,this.mJoyListeners=n,this.mScale=o,this.mKeyCodes=[],this.load()}return JoyStick.prototype.load=function(){this.mScene.load.atlas("joystick","./resources/ui/joystick/joystick.png","./resources/ui/joystick/joystick.json"),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start()},JoyStick.prototype.onListener=function(){this.mScene.input.on("pointerdown",this.downHandler,this),this.mScene.input.on("pointerup",this.upHandler,this)},JoyStick.prototype.offListener=function(){this.parentCon.visible=!1,this.mScene.input.off("pointermove",this.pointerMove,this),this.mScene.input.off("pointerdown",this.downHandler,this),this.mScene.input.off("pointerup",this.upHandler,this)},JoyStick.prototype.changeListeners=function(t){this.mJoyListeners=t},JoyStick.prototype.onLoadCompleteHandler=function(){this.mWorld.getSize();this.bg=this.mScene.make.sprite(void 0,!1),this.bg.setTexture("joystick","joystick_bg.png"),this.bgRadius=this.bg.width+100>>1,this.btn=this.mScene.make.sprite(void 0,!1),this.btn.name="joystick_btn",this.btn.setTexture("joystick","joystick_tab.png"),this.btn.x=this.bg.x,this.btn.y=this.bg.y,this.parentCon.alpha=.5,this.parentCon.addAt(this.bg,0),this.parentCon.addAt(this.btn,1),this.btn.setInteractive(new Phaser.Geom.Rectangle(0,0,this.btn.width,this.btn.height),Phaser.Geom.Rectangle.Contains),this.parentCon.setSize(this.bg.width,this.bg.height),this.parentCon.visible=!1},JoyStick.prototype.downHandler=function(t,e){if(this.mWorld.inputManager.enable&&!this.mDown){if(e){if(e.length>1)return;if(1===e.length){if(!e[0].name)return;if("joystick_btn"!==e[0].name)return}}this.mDown=!0,this.mScene.input.on("pointermove",this.pointerMove,this),this.parentCon.x=t.worldX,this.parentCon.y=t.worldY,this.parentCon.visible=!0}},JoyStick.prototype.pointerMove=function(t){var e=this;if(this.mWorld.inputManager.enable){var i=t.worldX-this.parentCon.x,n=t.worldY-this.parentCon.y,o=Math.sqrt(i*i+n*n);o>this.bgRadius&&(o=this.bgRadius);var a=Math.atan2(n,i);if(this.btn.x=Math.cos(a)*o,this.btn.y=Math.sin(a)*o,this.mWorld.inputManager.enable){var s=Math.acos(i/o);t.worldY>this.parentCon.y&&(s=-s),this.mJoyListeners.forEach((function(t){e.checkdragDown(t,s)}))}}},JoyStick.prototype.upHandler=function(t){var e=this;this.btn.x=this.bg.x,this.btn.y=this.bg.y,this.mDown=!1,this.parentCon.visible=!1,this.mScene.input.off("pointermove",this.pointerMove,this),this.mWorld.inputManager.enable&&this.mJoyListeners.forEach((function(t){e.checkdragUp()&&t.upHandler()}))},JoyStick.prototype.checkdragDown=function(t,e){var i,a=[],s=.125*Math.PI;if(e>-s&&e<=s?(i=o.a.east,n.a.getInstance().log("dir:Direction.east")):e>s&&e<=3*s?(i=o.a.east_north,n.a.getInstance().log("dir:Direction.east_north")):e>3*s&&e<=5*s?(i=o.a.north,n.a.getInstance().log("dir:Direction.north")):e>5*s&&e<=7*s?(i=o.a.north_west,n.a.getInstance().log("dir:Direction.nroth_west")):e>=7*s&&e<=Math.PI||e>=-Math.PI&&e<-7*s?(i=o.a.west,n.a.getInstance().log("dir:Direction.west")):e<-5*s&&e>=-7*s?(i=o.a.west_south,n.a.getInstance().log("dir:Direction.west_south")):e>-5*s&&e<=-3*s?(i=o.a.south,n.a.getInstance().log("dir:Direction.south")):e>-3*s&&e<=-s&&(i=o.a.south_east,n.a.getInstance().log("dir:Direction.south_east")),void 0!==i)return a=this.getKeys(i),this.mdownStr!==a.toString()&&(this.mdownStr=a.toString(),t.downHandler(i,a),this.mWorld.roomManager.currentRoom.playerManager.actor.setDirection(i),!0)},JoyStick.prototype.getKeys=function(t){var e=this.mKeyCodes[t];if(e)return e;switch(t){case 0:e=this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_UP);break;case 1:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_UP).concat,this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_LEFT));break;case 2:e=this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_LEFT);break;case 3:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_DOWN),this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_LEFT));break;case 4:e=this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_DOWN);break;case 5:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_DOWN),this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_RIGHT));break;case 6:e=this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_RIGHT);break;case 7:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_UP),this.mWorld.inputManager.getKeyCodes(a.op_def.TQ_EVENT.TQ_MOVE_RIGHT))}return this.mKeyCodes[t]=e,e},JoyStick.prototype.checkdragUp=function(){return this.mdownStr="",!0},JoyStick}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n=i(80),o=i(8),a=i(3),s=i(124),h=i(5),l=function(){function ElementStorage(){this.mModels=new Map,this.mElementRef=new Map,this.terrainPalette=new Map,this.terrainPaletteWithBindId=new Map,this.mossPalette=new Map,this.event=new Phaser.Events.EventEmitter}return ElementStorage.prototype.on=function(t,e,i){this.event.on(t,e,i)},ElementStorage.prototype.off=function(t,e,i){this.event.off(t,e,i)},ElementStorage.prototype.setGameConfig=function(t){if(o.a.getInstance().log("TCL: ElementStorage -> config",t),t){for(var e=null,i=0,h=t.objectsList;i<h.length;i++){var l=h[i];if(l.type===a.op_def.NodeType.ElementNodeType){if(!(e=this.mModels.get(l.id))){for(var c=[],p=l.animations,u=0,m=p.animationData;u<m.length;u++){var d=m[u];c.push(new s.a(d.createProtocolObject()))}e=new n.a({id:l.id,sn:l.sn,animations:{defaultAnimationName:p.defaultAnimationName,display:p.display,animationData:c}}),this.mModels.set(l.id,e)}var f={id:l.id,displayModel:e};this.mElementRef.set(l.id,f)}}this.updatePalette(t.root.palette),this.updateMoss(t.root.moss),this.updateAssets(t.root.assets)}},ElementStorage.prototype.updatePalette=function(t){for(var e=0,i=Array.from(t.peersDict.keys());e<i.length;e++){var o=i[e],a=t.peersDict.get(o);if(!this.terrainPalette.get(a.id)){var h=new n.a({id:a.id,sn:a.sn,animations:{defaultAnimationName:a.animations.defaultAnimationName,display:a.animations.display,animationData:a.animations.animationData.map((function(t){return new s.a(t.createProtocolObject())}))}});this.terrainPalette.set(o,h),this.terrainPaletteWithBindId.set(a.id,h)}}},ElementStorage.prototype.updateMoss=function(t){for(var e=0,i=Array.from(t.peersDict.keys());e<i.length;e++){var o=i[e],a=t.peersDict.get(o);if(!this.mossPalette.get(a.id)){var h=new n.a({id:a.id,sn:a.sn,animations:{defaultAnimationName:a.animations.defaultAnimationName,display:a.animations.display,animationData:a.animations.animationData.map((function(t){return new s.a(t.createProtocolObject())}))}});this.mossPalette.set(o,h)}}},ElementStorage.prototype.updateAssets=function(t){var e=t.getAssetList();this._assets=[];for(var i=0,n=e;i<n.length;i++){var o=n[i],a=o.media;if(a){var s=a.match(/\.([a-zA-Z0-9]+)($|\?)/);s&&s[1]&&this._assets.push({type:s[1],key:o.key,source:h.h.getOsdRes(a)})}}},ElementStorage.prototype.setSceneConfig=function(t){for(var e=null,i=0,o=t.objectsList;i<o.length;i++){var h=o[i];if(h.type===a.op_def.NodeType.ElementNodeType){if(!(e=this.mModels.get(h.id))){for(var l=[],c=h.animations,p=0,u=c.animationData;p<u.length;p++){var m=u[p];l.push(new s.a(m.createProtocolObject()))}e=new n.a({id:h.id,sn:h.sn,animations:{defaultAnimationName:c.defaultAnimationName,display:c.display,animationData:l}}),this.mModels.set(h.id,e)}var d={id:h.id,displayModel:e};this.mElementRef.set(h.id,d)}}var f=t.root.children.find((function(t){return t.type===a.op_def.NodeType.SceneNodeType}));this._terrainCollection=f.terrainCollection,this._mossCollection=f.mossCollection,this._scenerys=f.getScenerys()},ElementStorage.prototype.add=function(t){this.mModels.set(t.id,t)},ElementStorage.prototype.getDisplayModel=function(t){var e=this.mElementRef.get(t);if(e)return e.displayModel},ElementStorage.prototype.getTerrainCollection=function(){return this._terrainCollection},ElementStorage.prototype.getTerrainPalette=function(t){if(this.terrainPalette.get(t))return this.terrainPalette.get(t)},ElementStorage.prototype.getTerrainPaletteByBindId=function(t){if(this.terrainPaletteWithBindId.get(t))return this.terrainPaletteWithBindId.get(t)},ElementStorage.prototype.getMossCollection=function(){return this._mossCollection},ElementStorage.prototype.getMossPalette=function(t){if(this.mossPalette.get(t))return this.mossPalette.get(t)},ElementStorage.prototype.getScenerys=function(){return this._scenerys},ElementStorage.prototype.getAssets=function(){return this._assets},ElementStorage.prototype.destroy=function(){this.mElementRef.clear(),this.terrainPalette.clear(),this.mossPalette.clear(),this._assets=void 0},ElementStorage}()},function(t,e,i){"use strict";function load(t,e){return new Promise((function(i,n){var o=new XMLHttpRequest;o.onload=function(t){i(t.currentTarget)},o.onerror=function(){n(t+" load error")},o.open("GET",t),o.responseType=e||"",o.send()}))}i.d(e,"a",(function(){return load}))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){const i=Math.PI/180;t.exports=function(t){return t*i}},function(t,e,i){"use strict";function earcut(t,e,i){i=i||2;var n,o,a,s,h,l,c,p=e&&e.length,u=p?e[0]*i:t.length,m=linkedList(t,0,u,i,!0),d=[];if(!m||m.next===m.prev)return d;if(p&&(m=function eliminateHoles(t,e,i,n){var o,a,s,h,l,c=[];for(o=0,a=e.length;o<a;o++)s=e[o]*n,h=o<a-1?e[o+1]*n:t.length,(l=linkedList(t,s,h,n,!1))===l.next&&(l.steiner=!0),c.push(getLeftmost(l));for(c.sort(compareX),o=0;o<c.length;o++)eliminateHole(c[o],i),i=filterPoints(i,i.next);return i}(t,e,m,i)),t.length>80*i){n=a=t[0],o=s=t[1];for(var f=i;f<u;f+=i)(h=t[f])<n&&(n=h),(l=t[f+1])<o&&(o=l),h>a&&(a=h),l>s&&(s=l);c=0!==(c=Math.max(a-n,s-o))?1/c:0}return earcutLinked(m,d,i,n,o,c),d}function linkedList(t,e,i,n,o){var a,s;if(o===signedArea(t,e,i,n)>0)for(a=e;a<i;a+=n)s=insertNode(a,t[a],t[a+1],s);else for(a=i-n;a>=e;a-=n)s=insertNode(a,t[a],t[a+1],s);return s&&equals(s,s.next)&&(removeNode(s),s=s.next),s}function filterPoints(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!equals(n,n.next)&&0!==area(n.prev,n,n.next))n=n.next;else{if(removeNode(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function earcutLinked(t,e,i,n,o,a,s){if(t){!s&&a&&function indexCurve(t,e,i,n){var o=t;do{null===o.z&&(o.z=zOrder(o.x,o.y,e,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function sortLinked(t){var e,i,n,o,a,s,h,l,c=1;do{for(i=t,t=null,a=null,s=0;i;){for(s++,n=i,h=0,e=0;e<c&&(h++,n=n.nextZ);e++);for(l=c;h>0||l>0&&n;)0!==h&&(0===l||!n||i.z<=n.z)?(o=i,i=i.nextZ,h--):(o=n,n=n.nextZ,l--),a?a.nextZ=o:t=o,o.prevZ=a,a=o;i=n}a.nextZ=null,c*=2}while(s>1);return t}(o)}(t,n,o,a);for(var h,l,c=t;t.prev!==t.next;)if(h=t.prev,l=t.next,a?isEarHashed(t,n,o,a):isEar(t))e.push(h.i/i),e.push(t.i/i),e.push(l.i/i),removeNode(t),t=l.next,c=l.next;else if((t=l)===c){s?1===s?earcutLinked(t=cureLocalIntersections(t,e,i),e,i,n,o,a,2):2===s&&splitEarcut(t,e,i,n,o,a):earcutLinked(filterPoints(t),e,i,n,o,a,1);break}}}function isEar(t){var e=t.prev,i=t,n=t.next;if(area(e,i,n)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,o.x,o.y)&&area(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function isEarHashed(t,e,i,n){var o=t.prev,a=t,s=t.next;if(area(o,a,s)>=0)return!1;for(var h=o.x<a.x?o.x<s.x?o.x:s.x:a.x<s.x?a.x:s.x,l=o.y<a.y?o.y<s.y?o.y:s.y:a.y<s.y?a.y:s.y,c=o.x>a.x?o.x>s.x?o.x:s.x:a.x>s.x?a.x:s.x,p=o.y>a.y?o.y>s.y?o.y:s.y:a.y>s.y?a.y:s.y,u=zOrder(h,l,e,i,n),m=zOrder(c,p,e,i,n),d=t.prevZ,f=t.nextZ;d&&d.z>=u&&f&&f.z<=m;){if(d!==t.prev&&d!==t.next&&pointInTriangle(o.x,o.y,a.x,a.y,s.x,s.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&pointInTriangle(o.x,o.y,a.x,a.y,s.x,s.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&pointInTriangle(o.x,o.y,a.x,a.y,s.x,s.y,d.x,d.y)&&area(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=m;){if(f!==t.prev&&f!==t.next&&pointInTriangle(o.x,o.y,a.x,a.y,s.x,s.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function cureLocalIntersections(t,e,i){var n=t;do{var o=n.prev,a=n.next.next;!equals(o,a)&&intersects(o,n,n.next,a)&&locallyInside(o,a)&&locallyInside(a,o)&&(e.push(o.i/i),e.push(n.i/i),e.push(a.i/i),removeNode(n),removeNode(n.next),n=t=a),n=n.next}while(n!==t);return n}function splitEarcut(t,e,i,n,o,a){var s=t;do{for(var h=s.next.next;h!==s.prev;){if(s.i!==h.i&&isValidDiagonal(s,h)){var l=splitPolygon(s,h);return s=filterPoints(s,s.next),l=filterPoints(l,l.next),earcutLinked(s,e,i,n,o,a),void earcutLinked(l,e,i,n,o,a)}h=h.next}s=s.next}while(s!==t)}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=function findHoleBridge(t,e){var i,n=e,o=t.x,a=t.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var h=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(h<=o&&h>s){if(s=h,h===o){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(o===s)return i.prev;var l,c=i,p=i.x,u=i.y,m=1/0;n=i.next;for(;n!==c;)o>=n.x&&n.x>=p&&o!==n.x&&pointInTriangle(a<u?o:s,a,p,u,a<u?s:o,a,n.x,n.y)&&((l=Math.abs(a-n.y)/(o-n.x))<m||l===m&&n.x>i.x)&&locallyInside(n,t)&&(i=n,m=l),n=n.next;return i}(t,e)){var i=splitPolygon(e,t);filterPoints(i,i.next)}}function zOrder(t,e,i,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function pointInTriangle(t,e,i,n,o,a,s,h){return(o-s)*(e-h)-(t-s)*(a-h)>=0&&(t-s)*(n-h)-(i-s)*(e-h)>=0&&(i-s)*(a-h)-(o-s)*(n-h)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function intersectsPolygon(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&locallyInside(t,e)&&locallyInside(e,t)&&function middleInside(t,e){var i=t,n=!1,o=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&o<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)}function area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,i,n){return!!(equals(t,e)&&equals(i,n)||equals(t,n)&&equals(i,e))||area(t,e,i)>0!=area(t,e,n)>0&&area(i,n,t)>0!=area(i,n,e)>0}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function splitPolygon(t,e){var i=new Node(t.i,t.x,t.y),n=new Node(e.i,e.x,e.y),o=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function insertNode(t,e,i,n){var o=new Node(t,e,i);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,i,n){for(var o=0,a=e,s=i-n;a<i;a+=n)o+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return o}t.exports=earcut,earcut.deviation=function(t,e,i,n){var o=e&&e.length,a=o?e[0]*i:t.length,s=Math.abs(signedArea(t,0,a,i));if(o)for(var h=0,l=e.length;h<l;h++){var c=e[h]*i,p=h<l-1?e[h+1]*i:t.length;s-=Math.abs(signedArea(t,c,p,i))}var u=0;for(h=0;h<n.length;h+=3){var m=n[h]*i,d=n[h+1]*i,f=n[h+2]*i;u+=Math.abs((t[m]-t[f])*(t[d+1]-t[m+1])-(t[m]-t[d])*(t[f+1]-t[m+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},earcut.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var a=0;a<t[o].length;a++)for(var s=0;s<e;s++)i.vertices.push(t[o][a][s]);o>0&&(n+=t[o-1].length,i.holes.push(n))}return i}},function(t,e,i){var n=i(414),o=i(415);t.exports=function(t,e,i,a,s){var h=this.pipeline,l=h._tempMatrix1,c=h._tempMatrix2,p=h._tempMatrix3;t.setPipeline(h),c.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY),l.copyFrom(a.matrix),s?(l.multiplyWithOffset(s,-a.scrollX*e.scrollFactorX,-a.scrollY*e.scrollFactorY),c.e=e.x,c.f=e.y):(c.e-=a.scrollX*e.scrollFactorX,c.f-=a.scrollY*e.scrollFactorY),l.multiply(c,p);var u=e._displayOriginX,m=e._displayOriginY,d=a.alpha*e.alpha;e.isFilled&&n(h,p,e,d,u,m),e.isStroked&&o(h,e,d,u,m)}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,n,o,a,s){for(var h=i.getTintAppendFloatAlphaAndSwap(n.fillColor,n.fillAlpha*o),l=n.pathData,c=n.pathIndexes,p=0;p<c.length;p+=3){var u=2*c[p],m=2*c[p+1],d=2*c[p+2],f=l[u+0]-a,y=l[u+1]-s,g=l[m+0]-a,_=l[m+1]-s,v=l[d+0]-a,b=l[d+1]-s,P=e.getX(f,y),S=e.getY(f,y),w=e.getX(g,_),T=e.getY(g,_),C=e.getX(v,b),D=e.getY(v,b);t.setTexture2D(),t.batchTri(P,S,w,T,C,D,0,0,1,1,h,h,h,t.tintEffect)}}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,n,o,a){var s=t.strokeTint,h=i.getTintAppendFloatAlphaAndSwap(e.strokeColor,e.strokeAlpha*n);s.TL=h,s.TR=h,s.BL=h,s.BR=h;var l=e.pathData,c=l.length-1,p=e.lineWidth,u=p/2,m=l[0]-o,d=l[1]-a;e.closePath||(c-=2);for(var f=2;f<c;f+=2){var y=l[f]-o,g=l[f+1]-a;t.setTexture2D(),t.batchLine(m,d,y,g,u,u,p,f-2,!!e.closePath&&f===c-1),m=y,d=g}}},function(t,e,i){var n=i(417),o=i(418),a=Phaser.Renderer.Canvas.SetTransform;t.exports=function(t,e,i,s,h){var l=t.currentContext;if(a(t,l,e,s,h)){var c=e._displayOriginX,p=e._displayOriginY,u=e.pathData,m=u.length-1,d=u[0]-c,f=u[1]-p;l.beginPath(),l.moveTo(d,f),e.closePath||(m-=2);for(var y=2;y<m;y+=2){var g=u[y]-c,_=u[y+1]-p;l.lineTo(g,_)}l.closePath(),e.isFilled&&(n(l,e),l.fill()),e.isStroked&&(o(l,e),l.stroke()),l.restore()}}},function(t,e){t.exports=function(t,e,i,n){var o=i||e.fillColor,a=n||e.fillAlpha,s=(16711680&o)>>>16,h=(65280&o)>>>8,l=255&o;t.fillStyle="rgba("+s+","+h+","+l+","+a+")"}},function(t,e){t.exports=function(t,e,i,n){var o=i||e.strokeColor,a=n||e.strokeAlpha,s=(16711680&o)>>>16,h=(65280&o)>>>8,l=255&o;t.strokeStyle="rgba("+s+","+h+","+l+","+a+")",t.lineWidth=e.lineWidth}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,n,o,a){if(0!==e.width&&0!==e.height){var s=e.frame,h=s.width,l=s.height,c=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,s.glTexture,h,l,e.x,e.y,h/e.style.resolution,l/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,h,l,c(e._tintTL,o.alpha*e._alphaTL),c(e._tintTR,o.alpha*e._alphaTR),c(e._tintBL,o.alpha*e._alphaBL),c(e._tintBR,o.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,o,a)}}},function(t,e){t.exports=function(t,e,i,n,o){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,n,o)}},function(t,e,i){var n={"./Activity/ActivityMediator":172,"./Activity/ActivityMediator.ts":172,"./Activity/ActivityPanel":173,"./Activity/ActivityPanel.ts":173,"./Bubble/interactionbubble":249,"./Bubble/interactionbubble.container":184,"./Bubble/interactionbubble.container.ts":184,"./Bubble/interactionbubble.ts":249,"./Bubble/interactivebubble.manager":183,"./Bubble/interactivebubble.manager.ts":183,"./CharacterInfo/CharacterEditorPanel":188,"./CharacterInfo/CharacterEditorPanel.ts":188,"./CharacterInfo/CharacterInfo":192,"./CharacterInfo/CharacterInfo.ts":192,"./CharacterInfo/CharacterInfoMediator":288,"./CharacterInfo/CharacterInfoMediator.ts":288,"./CharacterInfo/CharacterInfoPanel":253,"./CharacterInfo/CharacterInfoPanel.ts":253,"./CharacterInfo/GraphicsProgressBar":292,"./CharacterInfo/GraphicsProgressBar.ts":292,"./CharacterInfo/GridLayoutGroup":199,"./CharacterInfo/GridLayoutGroup.ts":199,"./CharacterInfo/ScrollRect":293,"./CharacterInfo/ScrollRect.ts":293,"./ComponentRank/ComponentRankMediator":200,"./ComponentRank/ComponentRankMediator.ts":200,"./ComponentRank/ComponentRankPanel":201,"./ComponentRank/ComponentRankPanel.ts":201,"./Compose/Compose":202,"./Compose/Compose.ts":202,"./Compose/ComposeMediator":294,"./Compose/ComposeMediator.ts":294,"./Compose/ComposePanel":203,"./Compose/ComposePanel.ts":203,"./ControlF/ControlFMediator":125,"./ControlF/ControlFMediator.ts":125,"./ControlF/ControlFPanel":126,"./ControlF/ControlFPanel.ts":126,"./CutIn/CutInMediator":296,"./CutIn/CutInMediator.ts":296,"./CutIn/CutInPanel":205,"./CutIn/CutInPanel.ts":205,"./CutInMenu/CutInMenu":206,"./CutInMenu/CutInMenu.ts":206,"./CutInMenu/CutInMenuMediator":297,"./CutInMenu/CutInMenuMediator.ts":297,"./CutInMenu/CutInMenuPanel":207,"./CutInMenu/CutInMenuPanel.ts":207,"./DebugLogger/DebugLoggerMediator":103,"./DebugLogger/DebugLoggerMediator.ts":103,"./DebugLogger/DebugLoggerPanel":208,"./DebugLogger/DebugLoggerPanel.ts":208,"./DecorateControl/DecorateControlMediator":167,"./DecorateControl/DecorateControlMediator.ts":167,"./DecorateControl/DecorateControlPanel":168,"./DecorateControl/DecorateControlPanel.ts":168,"./ElementStorage/DragManager":298,"./ElementStorage/DragManager.ts":298,"./ElementStorage/ElementStorageMediator":95,"./ElementStorage/ElementStorageMediator.ts":95,"./ElementStorage/ElementStoragePanel":157,"./ElementStorage/ElementStoragePanel.ts":157,"./ElementStorage/ElementStorate":159,"./ElementStorage/ElementStorate.ts":159,"./ElementStorage/item/Item":158,"./ElementStorage/item/Item.ts":158,"./EquipUpgrade/EquipUpgrade":209,"./EquipUpgrade/EquipUpgrade.ts":209,"./EquipUpgrade/EquipUpgradeItem":210,"./EquipUpgrade/EquipUpgradeItem.ts":210,"./EquipUpgrade/EquipUpgradeMediator":299,"./EquipUpgrade/EquipUpgradeMediator.ts":299,"./EquipUpgrade/EquipUpgradePanel":211,"./EquipUpgrade/EquipUpgradePanel.ts":211,"./FurniBag/FurniBag":212,"./FurniBag/FurniBag.ts":212,"./FurniBag/FurniBagMediator":300,"./FurniBag/FurniBagMediator.ts":300,"./FurniBag/FurniBagPanel":213,"./FurniBag/FurniBagPanel.ts":213,"./InfoPanel/InfoPanel":214,"./InfoPanel/InfoPanel.ts":214,"./InfoPanel/InfoPanelMediator":215,"./InfoPanel/InfoPanelMediator.ts":215,"./InteractivePanel/InteractivePanel":216,"./InteractivePanel/InteractivePanel.ts":216,"./InteractivePanel/InteractivePanelMediator":217,"./InteractivePanel/InteractivePanelMediator.ts":217,"./ItemDetail/ItemDetail":218,"./ItemDetail/ItemDetail.ts":218,"./ItemDetail/ItemDetailMediator":301,"./ItemDetail/ItemDetailMediator.ts":301,"./ItemPopCard/ItemPopCardMediator":302,"./ItemPopCard/ItemPopCardMediator.ts":302,"./ItemPopCard/ItemPopCardPanel":219,"./ItemPopCard/ItemPopCardPanel.ts":219,"./Market/DetailDisplay":55,"./Market/DetailDisplay.ts":55,"./Market/ElementDetail":220,"./Market/ElementDetail.ts":220,"./Market/Market":223,"./Market/Market.ts":223,"./Market/MarketMediator":303,"./Market/MarketMediator.ts":303,"./Market/MarketPanel":255,"./Market/MarketPanel.ts":255,"./Market/NumberCounter":221,"./Market/NumberCounter.ts":221,"./Market/TextButton":104,"./Market/TextButton.ts":104,"./Market/item":224,"./Market/item.ts":224,"./MessageBox/MessageBoxMediator":304,"./MessageBox/MessageBoxMediator.ts":304,"./MessageBox/MessageBoxView":225,"./MessageBox/MessageBoxView.ts":225,"./MineCar/MineCar":182,"./MineCar/MineCar.ts":182,"./MineCar/MineCarMediator":177,"./MineCar/MineCarMediator.ts":177,"./MineCar/MineCarPanel":178,"./MineCar/MineCarPanel.ts":178,"./MineSettle/MineSettle":226,"./MineSettle/MineSettle.ts":226,"./MineSettle/MineSettleMediator":305,"./MineSettle/MineSettleMediator.ts":305,"./MineSettle/MineSettlePanel":227,"./MineSettle/MineSettlePanel.ts":227,"./Notice/Notice":151,"./Notice/Notice.ts":151,"./Notice/NoticeMediator":149,"./Notice/NoticeMediator.ts":149,"./Notice/NoticePanel":150,"./Notice/NoticePanel.ts":150,"./NpcDialogue/NpcDialogue":228,"./NpcDialogue/NpcDialogue.ts":228,"./NpcDialogue/NpcDialogueMediator":306,"./NpcDialogue/NpcDialogueMediator.ts":306,"./NpcDialogue/NpcDialoguePanel":229,"./NpcDialogue/NpcDialoguePanel.ts":229,"./PiCaMainUI/PicaMainUI":171,"./PiCaMainUI/PicaMainUI.ts":171,"./PiCaMainUI/PicaMainUIMediator":169,"./PiCaMainUI/PicaMainUIMediator.ts":169,"./PiCaMainUI/PicaMainUIPanel":170,"./PiCaMainUI/PicaMainUIPanel.ts":170,"./PicaChat/PicaChat":176,"./PicaChat/PicaChat.ts":176,"./PicaChat/PicaChatMediator":98,"./PicaChat/PicaChatMediator.ts":98,"./PicaChat/PicaChatPanel":174,"./PicaChat/PicaChatPanel.ts":174,"./PicaMessageBox/PicaMessageBoxMediator":307,"./PicaMessageBox/PicaMessageBoxMediator.ts":307,"./PicaMessageBox/PicaMessageBoxPanel":230,"./PicaMessageBox/PicaMessageBoxPanel.ts":230,"./PicaNavigate/PicaNavigateMediator":100,"./PicaNavigate/PicaNavigateMediator.ts":100,"./PicaNavigate/PicaNavigatePanel":175,"./PicaNavigate/PicaNavigatePanel.ts":175,"./PicaNotice/PicaNoticeMediator":308,"./PicaNotice/PicaNoticeMediator.ts":308,"./PicaNotice/PicaNoticePanel":231,"./PicaNotice/PicaNoticePanel.ts":231,"./PicaRoomList/PicaRoomListMediator":309,"./PicaRoomList/PicaRoomListMediator.ts":309,"./PicaRoomList/PicaRoomListPanel":256,"./PicaRoomList/PicaRoomListPanel.ts":256,"./PicaRoomList/RoomList":232,"./PicaRoomList/RoomList.ts":232,"./Rank/BasicRankPanel":92,"./Rank/BasicRankPanel.ts":92,"./Rank/RankMediator":71,"./Rank/RankMediator.ts":71,"./Rank/RankPanel":154,"./Rank/RankPanel.ts":154,"./ReAwardTips/ReAwardTip":186,"./ReAwardTips/ReAwardTip.ts":186,"./ReAwardTips/ReAwardTipsMediator":185,"./ReAwardTips/ReAwardTipsMediator.ts":185,"./ReAwardTips/ReAwardTipsPanel":187,"./ReAwardTips/ReAwardTipsPanel.ts":187,"./Shop/ShopMediator":233,"./Shop/ShopMediator.ts":233,"./Shop/ShopPanel":234,"./Shop/ShopPanel.ts":234,"./Shop/shop.itemSlot":257,"./Shop/shop.itemSlot.ts":257,"./UserInfo/UserInfoMediator":235,"./UserInfo/UserInfoMediator.ts":235,"./UserInfo/UserInfoPanel":236,"./UserInfo/UserInfoPanel.ts":236,"./UserMenu/MenuItem":237,"./UserMenu/MenuItem.ts":237,"./UserMenu/UserMenuMediator":310,"./UserMenu/UserMenuMediator.ts":310,"./UserMenu/UserMenuPanel":238,"./UserMenu/UserMenuPanel.ts":238,"./alert/PopUpTextUI":239,"./alert/PopUpTextUI.ts":239,"./bag/IListItemRender":311,"./bag/IListItemRender.ts":311,"./bag/bagView/bagMediator":39,"./bag/bagView/bagMediator.ts":39,"./bag/bagView/bagPanel":152,"./bag/bagView/bagPanel.ts":152,"./bag/basebag":312,"./bag/basebag.ts":312,"./bag/baseitem":313,"./bag/baseitem.ts":313,"./bag/dragDropIcon":69,"./bag/dragDropIcon.ts":69,"./bag/idragable":314,"./bag/idragable.ts":314,"./bag/idropable":315,"./bag/idropable.ts":315,"./bag/item.slot":40,"./bag/item.slot.ts":40,"./bag/storage/storageMediator":240,"./bag/storage/storageMediator.ts":240,"./bag/storage/storagePanel":241,"./bag/storage/storagePanel.ts":241,"./baseView/bagGroup/bag.group":164,"./baseView/bagGroup/bag.group.mediator":163,"./baseView/bagGroup/bag.group.mediator.ts":163,"./baseView/bagGroup/bag.group.ts":164,"./baseView/baseFace.mediator":41,"./baseView/baseFace.mediator.ts":41,"./baseView/bottomGroup/bottom.btn.group":156,"./baseView/bottomGroup/bottom.btn.group.ts":156,"./baseView/bottomGroup/bottom.mediator":94,"./baseView/bottomGroup/bottom.mediator.ts":94,"./baseView/icon.btn":26,"./baseView/icon.btn.ts":26,"./baseView/icon.select.btn":162,"./baseView/icon.select.btn.ts":162,"./baseView/leftGroup/left.btn.group":161,"./baseView/leftGroup/left.btn.group.ts":161,"./baseView/leftGroup/left.mediator":160,"./baseView/leftGroup/left.mediator.ts":160,"./baseView/rightGroup/right.btn.group":155,"./baseView/rightGroup/right.btn.group.ts":155,"./baseView/rightGroup/right.mediator":93,"./baseView/rightGroup/right.mediator.ts":93,"./baseView/top.menu/top.menu.container":166,"./baseView/top.menu/top.menu.container.ts":166,"./baseView/top.menu/top.menu.mediator":165,"./baseView/top.menu/top.menu.mediator.ts":165,"./baseView/topGroup/top.btn.group":242,"./baseView/topGroup/top.btn.group.ts":242,"./baseView/topGroup/top.mediator":316,"./baseView/topGroup/top.mediator.ts":316,"./chat/Chat":147,"./chat/Chat.ts":147,"./chat/base.chat.panel":89,"./chat/base.chat.panel.ts":89,"./chat/chat.mediator":64,"./chat/chat.mediator.ts":64,"./chat/chatPanel.pc":138,"./chat/chatPanel.pc.ts":138,"./chat/message":317,"./chat/message.ts":317,"./chat/mobile/chatPanel.mobile":146,"./chat/mobile/chatPanel.mobile.ts":146,"./components/BasePanel":6,"./components/BasePanel.ts":6,"./components/alert.view":179,"./components/alert.view.ts":179,"./components/check.button":88,"./components/check.button.ts":88,"./components/checkbox.group":72,"./components/checkbox.group.ts":72,"./components/dynamic.image":16,"./components/dynamic.image.ts":16,"./components/dynamic.ninepatch":120,"./components/dynamic.ninepatch.ts":120,"./components/dynamic.sprite":118,"./components/dynamic.sprite.ts":118,"./components/input.panel":99,"./components/input.panel.ts":99,"./components/inputPanel":318,"./components/inputPanel.ts":318,"./components/inputTextFactory":97,"./components/inputTextFactory.ts":97,"./components/label.input":222,"./components/label.input.ts":222,"./components/message.box":319,"./components/message.box.ts":319,"./components/nine.patch":12,"./components/nine.patch.ts":12,"./components/ninepatch.button":19,"./components/ninepatch.button.ts":19,"./components/patches.config":143,"./components/patches.config.ts":143,"./components/radio":96,"./components/radio.ts":96,"./components/tab.button":320,"./components/tab.button.ts":320,"./decorate/decorate.manager":129,"./decorate/decorate.manager.ts":129,"./decorate/decorate.panel":130,"./decorate/decorate.panel.ts":130,"./friend/friend.mediator":91,"./friend/friend.mediator.ts":91,"./friend/friend.panel":153,"./friend/friend.panel.ts":153,"./layer.manager":148,"./layer.manager.ts":148,"./loadview":321,"./loadview.ts":321,"./tips/itoolTip":322,"./tips/itoolTip.ts":322,"./tips/toolTip":90,"./tips/toolTip.ts":90,"./ui.atals.name":204,"./ui.atals.name.ts":204,"./ui.manager":137,"./ui.manager.ts":137,"./ui.mediatorType":27,"./ui.mediatorType.ts":27};function webpackContext(t){var e=webpackContextResolve(t);return i(e)}function webpackContextResolve(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}webpackContext.keys=function webpackContextKeys(){return Object.keys(n)},webpackContext.resolve=webpackContextResolve,t.exports=webpackContext,webpackContext.id=421},,,,function(t,e,i){"use strict";var n=i(289),o=i(290),a=i(21),s=i(11);class BBCodeTextPlugin extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexBBCodeText",n.a,o.a)}start(){this.game.events.on("destroy",this.destroy,this)}}Object(s.a)(window,"RexPlugins.GameObjects.BBCodeText",a.a),e.a=BBCodeTextPlugin},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function Account(){}return Account.prototype.setAccount=function(t){this.mCurAccountData={token:"",expire:0,fingerprint:""},Object.assign(this.mCurAccountData,t)},Object.defineProperty(Account.prototype,"accountData",{get:function(){return this.mCurAccountData},enumerable:!1,configurable:!0}),Account}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var n=function(){function HttpService(t){this.mWorld=t}return HttpService.prototype.follow=function(t){return this.post("user/follow",{fuid:t})},HttpService.prototype.unfollow=function(t){return this.post("user/unfollow",{fuid:t})},HttpService.prototype.checkFollowed=function(t){return this.post("user/check_followed",{uids:t})},HttpService.prototype.login=function(t,e){return fetch("http://172.18.0.100:17170/account/signin",{body:JSON.stringify({account:t,password:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(t){return t.json()}))},HttpService.prototype.requestPhoneCode=function(t){return fetch("http://172.18.0.100:17170/account/sms_code",{body:JSON.stringify({phone:t}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(t){return t.json()}))},HttpService.prototype.loginByPhoneCode=function(t,e){return fetch("http://172.18.0.100:17170/account/phone_signin",{body:JSON.stringify({phone:t,code:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then((function(t){return t.json()}))},HttpService.prototype.quickLogin=function(){return fetch("http://172.18.0.100:17170/account/quick_signin",{method:"POST"}).then((function(t){return t.json()}))},HttpService.prototype.firend=function(){return this.get("user/friends")},HttpService.prototype.userDetail=function(t){return this.get("account/"+t+"/detail")},HttpService.prototype.badgecards=function(t){return this.get("userpackage/"+t+"/badgecards")},HttpService.prototype.post=function(t,e){var i=this.mWorld.account;if(!i)return Promise.reject("account does not exist");if(!i.accountData)return Promise.reject("token does not exist");var n={body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json","X-Pixelpai-TK":i.accountData.token}};return fetch("http://172.18.0.100:17170/"+t,n).then((function(t){return t.json()}))},HttpService.prototype.get=function(t){var e=this.mWorld.account;if(!e)return Promise.reject("account does not exist");if(!e.accountData)return Promise.reject("token does not exist");var i={method:"GET",headers:{"X-Pixelpai-TK":e.accountData.token}};return fetch("http://172.18.0.100:17170/"+t,i).then((function(t){return t.json()}))},HttpService}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n,o=i(5),a=i(117),s=i(35),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function GamePauseScene(){return t.call(this,{key:GamePauseScene.name})||this}return h(GamePauseScene,t),GamePauseScene.prototype.preload=function(){this.load.image("gamepause.png",o.h.getRes("gamepause.png"))},GamePauseScene.prototype.init=function(t){this.mWorld=t.world},GamePauseScene.prototype.create=function(){var t=this.scale.gameSize.width,e=this.scale.gameSize.height;this.bg=this.add.graphics(),this.bg.fillStyle(0,.8),this.bg.fillRect(0,0,t,e),this.pauseImg=this.add.image(t>>1,e>>1,"gamepause.png"),this.tipTF=this.add.text(t-240>>1,e-50,"点击任意位置开始游戏",{font:"30px Tahoma"}),this.scale.on("resize",this.checkSize,this),this.checkSize(new a.a(t,e)),this.input.on("pointerdown",this.downHandler,this)},GamePauseScene.prototype.awake=function(){this.scale.on("resize",this.checkSize,this),this.input.on("pointerdown",this.downHandler,this),this.scene.wake()},GamePauseScene.prototype.sleep=function(){this.scale.off("resize",this.checkSize,this),this.input.off("pointerdown",this.downHandler,this),this.scene.sleep()},GamePauseScene.prototype.getKey=function(){return this.sys.config.key},GamePauseScene.prototype.downHandler=function(){this.mWorld.onFocus()},GamePauseScene.prototype.checkSize=function(t){var e=t.width,i=t.height;this.bg.clear(),this.bg.fillStyle(0,.8),this.bg.fillRect(0,0,e,i),this.pauseImg.scaleX=this.pauseImg.scaleY=.7*this.mWorld.uiScale,this.pauseImg.x=e>>1,this.pauseImg.y=i>>1,this.tipTF.scaleX=this.tipTF.scaleY=this.mWorld.uiScale,this.tipTF.x=e-280*this.mWorld.uiScale>>1,this.tipTF.y=i-50*this.mWorld.uiScale},GamePauseScene}(s.a)},,,function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var n,o,a=i(8),s=i(4),h=i(3),l=i(5),c=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});!function(t){t[t.Background=0]="Background",t[t.Element=1]="Element",t[t.Effect=2]="Effect"}(o||(o={}));var p=function(t){function SoundManager(e){var i=t.call(this)||this,n=e.connection;return n&&(n.addPacketListener(i),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SOUND_CTL,i.onPlaySoundHandler)),i}return c(SoundManager,t),SoundManager.prototype.changeRoom=function(t){this.mSoundMap&&this.mSoundMap.clear(),this.mSoundMap=new Map,this.mScene=t.scene},SoundManager.prototype.play=function(t){if(this.mScene){var e=t.key;e||(e=Array.isArray(t.urls)?t.urls.join(""):t.urls);var i=t.field||o.Background,n=this.mSoundMap.get(i);n||(n=new u(this.mScene),this.mSoundMap.set(i,n)),n.play(e,t.urls,t.soundConfig)}else a.a.getInstance().fatal(SoundManager.name+" scene does not exist. play "+t.key+" fatal")},SoundManager.prototype.stop=function(t){if(this.mScene){var e=this.mSoundMap.get(t);e&&e.stop()}else a.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't stop")},SoundManager.prototype.pause=function(t){if(this.mScene){var e=this.mSoundMap.get(t);e&&e.pause()}else a.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't pause")},SoundManager.prototype.resumes=function(t){if(this.mScene){var e=this.mSoundMap.get(t);e&&e.resume()}else a.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't resume")},SoundManager.prototype.stopAll=function(){this.mScene?this.mSoundMap.forEach((function(t){t&&t.stop()})):a.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't stopAll")},SoundManager.prototype.pauseAll=function(){this.mScene?this.mSoundMap.forEach((function(t){t&&t.pause()})):a.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't pauseAll")},SoundManager.prototype.resume=function(){this.mScene?this.mSoundMap.forEach((function(t){t&&t.resume()})):a.a.getInstance().fatal(SoundManager.name+" scene does not exist,can't resumeAll")},SoundManager.prototype.destroy=function(){this.mSoundMap&&(this.mSoundMap.forEach((function(t){t&&t.destroy()})),this.mSoundMap.clear(),this.mSoundMap=void 0)},SoundManager.prototype.onPlaySoundHandler=function(t){var e=t.content;void 0===e.loop&&(e.loop=!0),this.play({key:e.soundKey,urls:l.h.getOsdRes(e.soundKey),field:e.scope,soundConfig:{loop:e.loop}})},SoundManager}(s.PacketHandler),u=function(){function Sound(t){this.scene=t}return Sound.prototype.sound=function(){return this.mSound},Sound.prototype.play=function(t,e,i){if(this.scene)if(this.mSound&&this.mSound.key===t){if(this.mSound.isPlaying)return;this.mSound.play()}else if(this.mKey=t,this.scene.cache.audio.exists(t))this.startPlay();else{if(!e)return;this.scene.load.once("filecomplete-audio-"+t,this.onSoundCompleteHandler,this),this.scene.load.audio(t,e),this.scene.load.start()}},Sound.prototype.pause=function(){if(this.scene)if(this.mSound){if(this.mSound.isPaused)return;this.mSound.pause()}else;},Sound.prototype.stop=function(){if(this.scene)if(this.mSound){if(!this.mSound.isPlaying)return;this.mSound.stop()}else;},Sound.prototype.resume=function(){if(this.scene)if(this.mSound){if(!this.mSound.isPaused)return;this.mSound.resume()}else;},Sound.prototype.destroy=function(){this.mSound&&(this.mSound.stop(),this.mSound.destroy(),this.mSound=void 0)},Sound.prototype.onSoundCompleteHandler=function(){this.startPlay()},Sound.prototype.startPlay=function(){this.mSound&&(this.mSound.stop(),this.mSound.destroy()),this.mSound=this.scene.sound.add(this.mKey),this.mSound.play()},Sound}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i(58),__awaiter=function(t,e,i,n){return new(i||(i=Promise))((function(o,a){function fulfilled(t){try{step(n.next(t))}catch(t){a(t)}}function rejected(t){try{step(n.throw(t))}catch(t){a(t)}}function step(t){t.done?o(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((n=n.apply(t,e||[])).next())}))},__generator=function(t,e){var i,n,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function verb(a){return function(h){return function step(a){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}},o=function(){function LoadingManager(t){this.world=t,this.mResources=[]}return LoadingManager.prototype.start=function(t){return __awaiter(this,void 0,void 0,(function(){var t,e=this;return __generator(this,(function(i){return(t=this.game.scene)?(t.getScene(n.a.name)||t.add(n.a.name,n.a),t.isActive(n.a.name)?[2,Promise.resolve()]:(t.start(n.a.name,{world:this.world,callBack:function(t){return e.scene=t,e.mResources.length>0?e.addAssets(e.mResources):Promise.resolve()}}),[2])):[2,Promise.reject("start faild. SceneManager does not exist")]}))}))},LoadingManager.prototype.addAssets=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i,n;return __generator(this,(function(o){if(!this.scene)return[2];for(e=0,i=t;e<i.length;e++)n=i[e],this.loadAsset(n);return[2,this.startup(this.scene)]}))}))},LoadingManager.prototype.startup=function(t){return __awaiter(this,void 0,void 0,(function(){var e,i,n,o=this;return __generator(this,(function(a){for(this.scene=t,this.scene.load.once(Phaser.Loader.Events.COMPLETE,(function(){return o.mLoading=!1,o.mResources=[],Promise.resolve()})),e=0,i=this.mResources;e<i.length;e++)n=i[e],this.loadAsset(n);return this.scene.load.start(),this.mLoading=!0,[2]}))}))},LoadingManager.prototype.destroy=function(){this.mResources&&(this.mResources=[]),this.scene=void 0},LoadingManager.prototype.loadAsset=function(t){var e=this.getLoadType(t.type);this.scene.load[e]&&this.scene.load[e](t.key,t.source)},Object.defineProperty(LoadingManager.prototype,"game",{get:function(){if(this.world)return this.world.game},enumerable:!1,configurable:!0}),LoadingManager.prototype.getLoadType=function(t){return"mp3"===t||"wmv"===t||"ogg"===t?"audio":t},LoadingManager}()},,function(t,e,i){"use strict";i.d(e,"a",(function(){return te}));var n,o,a=i(77),s=i(4),h=i(3),l=i(8),c=i(14),p=i(28),u=i(13),m=i(22),d=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),f=function(t){function Player(e,i){var n=t.call(this,e,i)||this;return n.mElementManager=i,n.nodeType=h.op_def.NodeType.CharacterNodeType,n.mOffsetY=void 0,n.mDisplay&&e.displayBadgeCards&&e.displayBadgeCards.length>0&&n.mDisplay.setDisplayBadges(e.displayBadgeCards),n}return d(Player,t),Player.prototype.setModel=function(e){t.prototype.setModel.call(this,e),this.showNickName()},Player.prototype.move=function(e){this.getDirection()!==e.direction&&(this.roomService.world.moveStyle===h.op_def.MoveStyle.DIRECTION_MOVE_STYLE?this.mId!==this.roomService.playerManager.actor.id&&this.setDirection(e.direction):this.setDirection(e.direction)),e.destinationPoint3f.y+=this.offsetY,t.prototype.move.call(this,e)},Player.prototype.movePath=function(t){var e=this;if(this.mDisplay){var i=t.path;if(i){var n=new c.a(this.mDisplay.x,this.mDisplay.y-this.offsetY),o=[];this.mMoveData.arrivalTime=t.timestemp;for(var a=null,s=null,h=this.mElementManager.roomService.now(),l=0,p=0,u=0,m=i;u<m.length;u++){var d=m[u];(s=d.point3f).y===n.y&&s.x===n.x||(a=Math.atan2(s.y-n.y,s.x-n.x)*(180/Math.PI)),h+=l,l=d.timestemp-h,o.push({x:s.x,y:s.y+this.offsetY,duration:l,onStartParams:a,onStart:function(t,i,n){e.onCheckDirection(n)},onCompleteParams:{duration:l,index:p},onComplete:function(t,i,n){e.onMovePathPointComplete(n)}}),n=new c.a(s.x,s.y),p++}this.mMoveData.posPath=o,this.mMoveData.onCompleteParams=s,this.mMoveData.onComplete=this.mMovePathPointFinished,this._doMove()}}},Player.prototype.setDirection=function(t){t!==this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t,this.mModel.direction=t,this.mDisplay&&this.mDisplay.play(this.mModel.currentAnimation))},Player.prototype.changeState=function(t){this.mDisplay&&this.mCurState!==t&&(t||(t=m.d.IDLE),this.mCheckStateHandle(t)&&(this.mCurState=t,this.mModel.currentAnimationName=this.mCurState,this.mDisplay.play(this.mModel.currentAnimation)))},Player.prototype.setPosition=function(e){e.y+=this.offsetY,t.prototype.setPosition.call(this,e)},Player.prototype.getPosition=function(){var e=t.prototype.getPosition.call(this);return e.y-=this.offsetY,e},Player.prototype.onCheckDirection=function(t){"number"==typeof t&&(t>90?this.setDirection(3):t>=0?this.setDirection(5):t>=-90?this.setDirection(7):this.setDirection(1))},Player.prototype.onMoveStart=function(){this.changeState(m.d.WALK),this.mMoveData&&(this.mMoveData.step=0),t.prototype.onMoveStart.call(this)},Player.prototype.onMoveComplete=function(){this.preMoveComplete(),t.prototype.onMoveComplete.call(this),this.changeState(m.d.IDLE)},Player.prototype.preMoveComplete=function(){if(this.mMoveData&&this.mMoveData.posPath){var t=this.mMoveData.onComplete;t&&(t.call(this,this.mMoveData.onCompleteParams),delete this.mMoveData.onComplete,delete this.mMoveData.onCompleteParams)}},Player.prototype.onMovePathPointComplete=function(t){this.mMoveData&&(this.mMoveData.step+=1)},Player.prototype.mMovePathPointFinished=function(t){if(t&&this.mRoomService){var e=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOVE_PATH_POINT_FINISHED),i=e.content,n=h.op_def.PBPoint3f.create(),o=this.getPosition();n.x=o.x,n.y=o.y,n.z=o.z;var a=h.op_def.PBPoint3f.create();a.x=t.x,a.y=t.y,i.currentPoint=n,i.lastTargetPoint=a,i.timestemp=this.mRoomService.world.clock.unixTime,this.mRoomService.connection.send(e)}},Object.defineProperty(Player.prototype,"offsetY",{get:function(){if(void 0===this.mOffsetY){if(!this.mElementManager||!this.mElementManager.roomService||!this.mElementManager.roomService.roomSize)return 0;this.mOffsetY=this.mElementManager.roomService.roomSize.tileHeight>>2}return this.mOffsetY},enumerable:!1,configurable:!0}),Player.prototype.mCheckStateHandle=function(t){return!0},Player}(m.b),y=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),g=function(t){function Bag(e){var i=t.call(this)||this;return i.mWorld=e,i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ADD_ITEM,i.handleAddItem),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_REMOVE_ITEM,i.handleRemoveItem),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EXCHANGE_ITEM_POS,i.handleExchangeItem),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QUERY_PACKAGE,i.handleQueryPackage),i}return y(Bag,t),Bag.prototype.initialize=function(){return this.mInitialize},Bag.prototype.register=function(){this.mWorld.connection.addPacketListener(this)},Bag.prototype.unRegister=function(){this.mWorld.connection.removePacketListener(this)},Bag.prototype.destroy=function(){this.mInitialize=!1,this.mWorld.connection.removePacketListener(this)},Bag.prototype.requestVirtualWorldQueryPackage=function(t,e,i){var n=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),o=n.content;o.id=t,o.page=e,o.perPage=i,this.mWorld.connection.send(n)},Bag.prototype.handleQueryPackage=function(t){var e=t.content;this.mInitialize=!0,this.mWorld.emitter.emit(u.a.QUERY_PACKAGE,e)},Bag.prototype.handleAddItem=function(t){var e=t.content;e.nodetype===h.op_def.NodeType.ElementNodeType?this.mWorld.roomManager.currentRoom.map.addPackItems(e.id,e.item):e.nodetype===h.op_def.NodeType.CharacterNodeType&&this.mWorld.roomManager.currentRoom.playerManager.addPackItems(e.id,e.item),this.mWorld.emitter.emit(u.a.PACKAGE_ITEM_ADD,e)},Bag.prototype.handleRemoveItem=function(t){for(var e=t.content,i=e.itemId.length,n=0;n<i;n++)this.mWorld.roomManager.currentRoom.playerManager.removePackItems(e.id,e.itemId[n]);this.mWorld.emitter.emit(u.a.UPDATED_CHARACTER_PACKAGE),this.mWorld.emitter.emit(u.a.PACKAGE_ITEM_REMOVE,e)},Bag.prototype.handleExchangeItem=function(t){var e=t.content;this.mWorld.emitter.emit(u.a.PACKAGE_EXCHANGE_ITEM_POS,e)},Bag}(s.PacketHandler),_=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),v=function(t){function Interactive(e){var i=t.call(this)||this;return i.mWorld=e,i}return _(Interactive,t),Interactive.prototype.initialize=function(){return this.mInitialize},Interactive.prototype.register=function(){this.mWorld.connection.addPacketListener(this)},Interactive.prototype.unRegister=function(){this.mWorld.connection.removePacketListener(this)},Interactive.prototype.destroy=function(){this.mInitialize=!1,this.mWorld.connection.removePacketListener(this)},Interactive.prototype.requestTargetUI=function(t,e){var i=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),n=i.content;n.uiId=t,n.componentId=e,this.mWorld.connection.send(i)},Interactive}(s.PacketHandler),b=function(){function Friend(t){this.world=t,this.mFriendList=[]}return Friend.prototype.requestFriend=function(t){var e=t;this.world.httpService.firend().then((function(t){200===t.code&&e&&e(t.data)}))},Friend.prototype.friendList=function(){return this.mFriendList||[]},Friend}(),P=i(125),S=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),w=function(t){function Actor(e,i){var n=t.call(this,e,i)||this;if(n.mElementManager=i,n.mBlockable=!1,n.mRoom=n.mElementManager.roomService,n.mRoom.world.inputManager&&n.mRoom.world.inputManager.addListener(n),n.mElementManager){var o=n.mElementManager.roomService;if(o&&o.cameraService){var a=e.pos,s=n.mElementManager.scene.scale;o.cameraService.setScroll(a.x*o.world.scaleRatio-s.width/2,a.y*o.world.scaleRatio-s.height/2),o.cameraService.syncCameraScroll()}}return n.mFriend=new b(n.mRoom.world),n.mRoom.playerManager.set(n.id,n),n.mInteractive=new v(i.roomService.world),n.mInteractive.register(),n}return S(Actor,t),Actor.prototype.getBag=function(){return this.mBag},Actor.prototype.getFriend=function(){return this.mFriend},Actor.prototype.getInteractive=function(){return this.mInteractive},Actor.prototype.setRenderable=function(t){},Actor.prototype.destroy=function(){this.mBag&&(this.mBag.destroy(),this.mBag=null),this.mRoom.world.inputManager&&this.mRoom.world.inputManager.removeListener(this),t.prototype.destroy.call(this)},Actor.prototype.downHandler=function(t,e){this.mDisplay&&this.mRoom.playerManager.requestActorMove(t,e)},Actor.prototype.upHandler=function(){this.mDisplay&&this.stopMove()},Actor.prototype.startMove=function(){t.prototype.startMove.call(this);var e=this.mRoom.world.uiManager.getMediator(P.ControlFMediator.NAME);e&&e.hide()},Actor.prototype.stopMove=function(){if(t.prototype.stopMove.call(this),this.mRoom&&this.mRoom.world.moveStyle===h.op_def.MoveStyle.DIRECTION_MOVE_STYLE){var e=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_STOP_SPRITE),i=e.content;i.nodeType=this.nodeType;var n=this.getPosition();i.spritePositions={id:this.id,point3f:{x:n.x,y:n.y,z:n.z},direction:this.dir},this.mElementManager.connection.send(e)}},Actor.prototype.move=function(e){if(this.mRoom.world.moveStyle===h.op_def.MoveStyle.DIRECTION_MOVE_STYLE){if(this.mCurState!==m.d.WALK)return}else this.startMove();t.prototype.move.call(this,e)},Actor.prototype.movePath=function(e){if(this.mRoom.world.moveStyle!==h.op_def.MoveStyle.DIRECTION_MOVE_STYLE||this.mCurState===m.d.WALK){var i=e.path,n=this.mElementManager.roomService.now(),o=0;i.map((function(t){return n+=o,o=t.timestemp-n,{x:t.point3f.x,y:t.point3f.y,duration:o,timestemp:t.timestemp}}));t.prototype.movePath.call(this,e)}},Actor.prototype.onMoveComplete=function(){this.preMoveComplete(),this.mCurState===m.d.WALK?(this.mRoom.world.moveStyle!==h.op_def.MoveStyle.DIRECTION_MOVE_STYLE&&(this.changeState(m.d.IDLE),this.stopMove()),this._doMove()):this.mMoveData.tweenAnim.stop()},Actor.prototype.onMoving=function(){this.mCurState===m.d.WALK?t.prototype.onMoving.call(this):this.mMoveData.tweenLineAnim.stop()},Actor.prototype.addToBlock=function(){this.addDisplay()},Actor.prototype.drawPath=function(t){},Object.defineProperty(Actor.prototype,"model",{get:function(){return this.mModel},set:function(t){this.mModel=t,t&&(t.package&&(this.mPackage=t.package,this.mBag=new g(this.mElementManager.roomService.world),this.mBag.register()),this.load(this.mModel.displayInfo),this.mModel.pos&&this.setPosition(this.mModel.pos),this.mDisplay.changeAlpha(this.mModel.alpha),this.mModel.nickname&&this.mDisplay.showNickname(this.mModel.nickname),this.setDirection(this.mModel.direction))},enumerable:!1,configurable:!0}),Object.defineProperty(Actor.prototype,"package",{get:function(){return this.mPackage},set:function(t){this.mPackage=t},enumerable:!1,configurable:!0}),Object.defineProperty(Actor.prototype,"moveTime",{set:function(t){this.mMoveTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(Actor.prototype,"moveData",{get:function(){return this.mMoveData},enumerable:!1,configurable:!0}),Actor}(f),T=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),C=function(t){function PlayerModel(e){var i=t.call(this,e)||this;return i.mPos=new c.a(e.x,e.y,e.z),i.mAlpha=1,i.mPackage=e.package,i.mSceneId=e.sceneId,i.mUuid=e.uuid,i.mPlatformId=e.platformId,i}return T(PlayerModel,t),PlayerModel}(p.a),D=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),M=h.op_def.NodeType,O=function(t){function PlayerManager(e){var i=t.call(this)||this;return i.mRoom=e,i.hasAddComplete=!1,i.mPlayerMap=new Map,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,i.onAdd),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE_END,i.addComplete),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,i.onRemove),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,i.onAdjust),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MOVE_SPRITE,i.onMove),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_EFFECT,i.onShowEffect),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE,i.onOnlyBubbleHandler),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,i.onShowBubble),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE_CLEAN,i.onClearBubbleHandler),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SYNC_SPRITE,i.onSync),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_CHANGE_SPRITE_ANIMATION,i.onChangeAnimation),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SET_SPRITE_POSITION,i.onSetPosition),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SET_CAMERA_FOLLOW,i.onCameraFollow),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MOVE_SPRITE_BY_PATH,i.onMovePath)),i}return D(PlayerManager,t),PlayerManager.prototype.createActor=function(t){var e=new C(t);this.mActor=new w(e,this)},Object.defineProperty(PlayerManager.prototype,"actor",{get:function(){return this.mActor},enumerable:!1,configurable:!0}),PlayerManager.prototype.destroy=function(){var t=this;this.connection&&this.connection.removePacketListener(this),this.mPlayerMap&&(this.mPlayerMap.forEach((function(e){return t.removeFromMap(e.id)})),this.mPlayerMap.clear())},PlayerManager.prototype.removeFromMap=function(t){var e=this.mPlayerMap.get(t);e&&(this.mPlayerMap.delete(t),e.destroy())},PlayerManager.prototype.requestActorMove=function(t,e){if(this.startActorMove(),!this.roomService.world.game.device.os.desktop){var i=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN);i.content.keyCodes=e,this.connection.send(i)}},PlayerManager.prototype.startActorMove=function(){this.mActor?this.mActor.startMove():l.a.getInstance().error("MainHero miss")},PlayerManager.prototype.stopActorMove=function(){this.mActor?this.mActor.stopMove():l.a.getInstance().error("MainHero miss")},PlayerManager.prototype.get=function(t){if(this.mPlayerMap){var e=this.mPlayerMap.get(t);if(!e){var i=this.mActor;i&&i.id===t&&(e=i)}return e}},PlayerManager.prototype.add=function(t){},PlayerManager.prototype.remove=function(t){var e=this.mPlayerMap.get(t);return e&&(this.mPlayerMap.delete(t),e.destroy()),this.mActor&&(this.mActor.destroy(),this.mActor=null),e},PlayerManager.prototype.getElements=function(){return Array.from(this.mPlayerMap.values())},PlayerManager.prototype.set=function(t,e){this.mPlayerMap||(this.mPlayerMap=new Map),this.mPlayerMap.set(t,e)},Object.defineProperty(PlayerManager.prototype,"camera",{get:function(){return this.mRoom.cameraService.camera},enumerable:!1,configurable:!0}),PlayerManager.prototype.addPackItems=function(t,e){var i=this.mPlayerMap.get(t);i&&i.id===this.mActor.id&&(i.package||(i.package=h.op_gameconfig.Package.create()),i.package.items=i.package.items.concat(e),this.mRoom.world.emitter.emit(u.a.UPDATED_CHARACTER_PACKAGE))},PlayerManager.prototype.removePackItems=function(t,e){var i=this.mPlayerMap.get(t);if(i&&this.mActor.id)for(var n=i.package.items,o=n.length,a=0;a<o;a++)if(e===n[a].id)return n.splice(a,1),!0;return!1},PlayerManager.prototype.onSync=function(t){var e=t.content;if(e.nodeType===h.op_def.NodeType.CharacterNodeType)for(var i=null,n=e.sprites,o=e.command,a=0,s=n;a<s.length;a++){var l=s[a];(i=this.get(l.id))&&(o===h.op_def.OpCommand.OP_COMMAND_UPDATE?i.model=new p.a(l):o===h.op_def.OpCommand.OP_COMMAND_PATCH&&i.updateModel(l))}},PlayerManager.prototype.onAdjust=function(t){var e=t.content,i=e.spritePositions;if(e.nodeType===h.op_def.NodeType.CharacterNodeType&&this.mActor)for(var n=void 0,o=void 0,a=0,s=i;a<s.length;a++){var l=s[a];(n=this.mPlayerMap.get(l.id))&&(o=l.point3f,n.setPosition(new c.a(o.x||0,o.y||0,o.z||0)))}},PlayerManager.prototype.onAdd=function(t){this.mPlayerMap||(this.mPlayerMap=new Map);var e=t.content,i=e.sprites;if(e.nodeType===h.op_def.NodeType.CharacterNodeType)for(var n=0,o=i;n<o.length;n++){var a=o[n];this._add(new p.a(a))}},PlayerManager.prototype._add=function(t){if(this.mPlayerMap||(this.mPlayerMap=new Map),!this.mPlayerMap.has(t.id)){var e=new f(t,this);this.mPlayerMap.set(e.id||0,e)}},PlayerManager.prototype.addComplete=function(t){this.hasAddComplete=!0},PlayerManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,n=e.ids;if(i===h.op_def.NodeType.CharacterNodeType)for(var o=0,a=n;o<a.length;o++){var s=a[o];this.removeFromMap(s)}},PlayerManager.prototype.onMove=function(t){var e=t.content;if(e.moveData)for(var i=e.moveData,n=i.length,o=(e.nodeType,void 0),a=void 0,s=void 0,h=0;h<n;h++)a=(o=i[h]).moveObjectId,(s=this.get(a))&&s.move(o)},PlayerManager.prototype.onSetPosition=function(t){var e=t.content,i=e.nodeType,n=e.id;if(i===M.CharacterNodeType){var o=this.get(n);o&&o.setPosition(new c.a(e.position.x,e.position.y,e.position.z))}},PlayerManager.prototype.onShowBubble=function(t){var e=t.content,i=this.get(e.chatSenderid);i&&i.showBubble(e.chatContext,e.chatSetting)},PlayerManager.prototype.onOnlyBubbleHandler=function(t){var e=t.content,i=this.get(e.receiverid);i&&i.showBubble(e.context,e.chatsetting)},PlayerManager.prototype.onClearBubbleHandler=function(t){var e=t.content,i=this.get(e.receiverid);i&&i.clearBubble()},PlayerManager.prototype.onShowEffect=function(t){for(var e,i=0,n=t.content.id;i<n.length;i++){var o=n[i];(e=this.get(o))&&e.showEffected()}},PlayerManager.prototype.onChangeAnimation=function(t){var e=t.content;if(e.nodeType===M.CharacterNodeType)for(var i=null,n=0,o=e.ids;n<o.length;n++){var a=o[n];(i=this.get(a))&&i.setQueue(e.changeAnimation)}},PlayerManager.prototype.onCameraFollow=function(t){var e=t.content,i=this.get(e.id),n=this.roomService.cameraService;n&&(i?n.startFollow(i.getDisplay()):n.stopFollow())},PlayerManager.prototype.onMovePath=function(t){var e=t.content;if(e.nodeType===M.CharacterNodeType){var i=this.get(e.id);i&&i.movePath(e)}},Object.defineProperty(PlayerManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),Object.defineProperty(PlayerManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!1,configurable:!0}),Object.defineProperty(PlayerManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;l.a.getInstance().error("room is undefined")},enumerable:!1,configurable:!0}),Object.defineProperty(PlayerManager.prototype,"map",{get:function(){return[]},enumerable:!1,configurable:!0}),PlayerManager}(s.PacketHandler),x=i(251),E=i(127),B=i(47),I=i(252),A=i(112),R=i(331),k=i(58),L=i(80),F=function(){function MapModel(){this.mapId=1,this.zStart=0,this.zEnd=0,this._mapTotalWidth=0,this._bgSound=1,this._voiceChatRoomId=0,this._mapTotalHeight=0}return Object.defineProperty(MapModel.prototype,"bgSound",{get:function(){return this._bgSound},set:function(t){this._bgSound=t},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"mapTotalWidth",{get:function(){return this._mapTotalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"mapTotalHeight",{get:function(){return this._mapTotalHeight},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"tileWidth",{get:function(){return this._tileWidth},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"tileHeight",{get:function(){return this._tileHeight},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"terrainConfig",{get:function(){return this._terrainConfig},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"elementConfig",{get:function(){return this._elementConfig},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"cols",{get:function(){return this._cols},set:function(t){this._cols=t},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"rows",{get:function(){return this._rows},set:function(t){this._rows=t},enumerable:!1,configurable:!0}),Object.defineProperty(MapModel.prototype,"voiceChatRoomId",{get:function(){return this._voiceChatRoomId},set:function(t){this._voiceChatRoomId=t},enumerable:!1,configurable:!0}),MapModel.prototype.setConfig=function(t,e,i,n,o,a){this._cols=t,this._rows=e,this.zStart=i,this.zEnd=n,this._tileWidth=o,this._tileHeight=a,this._mapTotalWidth=(this._rows+this._cols)*(this._tileWidth/2),this._mapTotalHeight=(this._rows+this._cols)*(this._tileHeight/2)},MapModel.prototype.setTerrainInfo=function(t){this._terrainConfig=[];for(var e,i=t.length,n=0;n<i;n++)e=new L.a(t[n]),this._terrainConfig.push(e)},MapModel.prototype.addTerrainInfo=function(t){for(var e,i=t.length,n=0;n<i;n++)e=new L.a(t[n]),this._terrainConfig.push(e)},MapModel.prototype.setElementInfo=function(t){this._elementConfig=[];for(var e,i=t.length,n=0;n<i;n++)e=new L.a(t[n]),this._elementConfig.push(e)},MapModel.prototype.addElementInfo=function(t){for(var e,i=t.length,n=0;n<i;n++)e=new L.a(t[n]),this._elementConfig.push(e)},MapModel.prototype.addPackItems=function(t,e){var i=this.getElementInfo(t);i&&(i.package||(i.package=h.op_gameconfig.Package.create()),i.package.items=i.package.items.concat(e))},MapModel.prototype.removePackItems=function(t,e){var i=this.getElementInfo(t);if(i)for(var n=i.package.items.length,o=0;o<n;o++)if(e===i.package.items[o].id)return i.package.items.splice(o,1),!0;return!1},MapModel.prototype.getElementInfo=function(t){for(var e=this._elementConfig.length,i=0;i<e;i++)if(this._elementConfig[i].id===t)return this._elementConfig[i];return null},MapModel}(),N=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),j=function(t){function Map(e){var i=t.call(this)||this;return i.mWorld=e,i.emitter=i.mWorld.emitter,i.mMapModel=new F,i}return N(Map,t),Map.prototype.initialize=function(){return this.mInitialize},Map.prototype.getMapModel=function(){return this.mMapModel},Map.prototype.register=function(){},Map.prototype.unRegister=function(){},Map.prototype.destroy=function(){this.mInitialize=!1,this.mMapModel=null,this.emitter=null},Map.prototype.setMapInfo=function(t){this.mMapModel.mapId=t.id,this.mMapModel.voiceChatRoomId=t.voiceChatRoomId,this.mMapModel.setConfig(t.cols,t.rows,t.zStart,t.zEnd,t.tileWidth,t.tileHeight),this.mMapModel.setTerrainInfo(t.terrains),this.mMapModel.setElementInfo(t.elements),!1===this.mInitialize&&(this.mInitialize=!0,this.emitter.emit(u.a.SCENE_DATA_INITIALIZE))},Map.prototype.addPackItems=function(t,e){this.mMapModel.addPackItems(t,e)},Map.prototype.removePackItems=function(t,e){this.mMapModel.removePackItems(t,e)},Map.NAME="Map",Map}(s.PacketHandler),H=i(59),U=i(266),G=i(5),V=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),W=function(t){function FallEffect(e,i){var n=t.call(this,e)||this;return n.scale=i,n}return V(FallEffect,t),FallEffect.prototype.show=function(t){this.mStatus=t,this.load()},FallEffect.prototype.load=function(){this.scene.textures.exists("fall_effect")?this.onCompleteHandler():(this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onCompleteHandler,this),this.scene.load.atlas("fall_effect",G.h.getRes("ui/fall_effect/falleffect.png"),G.h.getRes("ui/fall_effect/falleffect.json")),this.scene.load.start())},FallEffect.prototype.showEnable=function(){this.mDisplay=new z(this.scene,"fall_effect"),this.add(this.mDisplay)},FallEffect.prototype.showDisable=function(){this.mDisplay=new Y(this.scene,"fall_effect"),this.add(this.mDisplay)},FallEffect.prototype.onCompleteHandler=function(){var t=this;this.mStatus===h.op_def.PathReachableStatus.PATH_REACHABLE_AREA||this.mStatus===h.op_def.PathReachableStatus.PATH_REACHABLE_WITH_INTERACTION_SPRITE?this.showEnable():this.showDisable(),this.scene.tweens.add({targets:this,duration:1e3,ease:"Expo",delay:1e3,props:{alpha:0},onComplete:function(){t.destroy(),t.emit("remove",t)}})},FallEffect}(Phaser.GameObjects.Container),z=function(t){function EnableDisplay(e,i){var n=t.call(this,e)||this;n.mImage=e.make.sprite({key:i,x:9,y:-20},!1).setScale(.5),n.add(n.mImage),n.mEllipse=e.make.sprite(void 0,!1),n.addAt(n.mEllipse,0);var o={key:"fill_effect_enable",frames:n.scene.anims.generateFrameNames("fall_effect",{prefix:"enable",end:6,zeroPad:2}),frameRate:16,repeat:0};n.scene.anims.create(o),n.mImage.play("fill_effect_enable");var a={key:"fill_effect_ellipse",frames:n.scene.anims.generateFrameNames("fall_effect",{prefix:"ellipse",end:7,zeroPad:2}),frameRate:10,repeat:0};return n.scene.anims.create(a),n.mEllipse.play("fill_effect_ellipse"),n}return V(EnableDisplay,t),EnableDisplay}(Phaser.GameObjects.Container),Y=function(t){function DisableDisplay(e,i){var n=t.call(this,e)||this;return n.mImage=e.make.image({key:i,y:-6,frame:"disable"},!1).setScale(.5),n.add(n.mImage),n.mEllipse=e.make.image({key:i,frame:"forbid"},!1).setScale(.5),n.add([n.mImage,n.mEllipse]),n}return V(DisableDisplay,t),DisableDisplay}(Phaser.GameObjects.Container),X=function(){function FallEffectContainer(t,e){this.scene=t,this.room=e,this.mFalls=[]}return FallEffectContainer.prototype.addFall=function(t,e){if(t){var i=new W(this.scene,this.room.world.scaleRatio);i.once("remove",this.onRemoveHandler,this),i.setPosition(t.x,t.y),this.room.addToSceneUI(i)}},FallEffectContainer.prototype.onRemoveHandler=function(t){},FallEffectContainer}(),K=i(119),q=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Q=function(t){function WallDisplay(e,i){var n=t.call(this,e,0,0,void 0)||this;return n.roomService=i,n}return q(WallDisplay,t),WallDisplay.prototype.loadDisplay=function(t,e){this.scene.textures.exists("wall")?this.onLoadCompleteHandler():(this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.scene.load.atlas("wall",t,e),this.scene.load.start())},WallDisplay.prototype.setDir=function(t){this.mImage&&(this.mImage.setTexture("wall","wall_"+t+".png"),t===o.LEFT?this.mImage.x=-this.mImage.width/2:t===o.RIGHT&&(this.mImage.x=this.mImage.width/2),this.mImage.y=-this.mImage.height/2+30)},WallDisplay.prototype.load=function(t){},WallDisplay.prototype.changeAlpha=function(t){},WallDisplay.prototype.play=function(t){},WallDisplay.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this)},WallDisplay.prototype.fadeIn=function(t){},WallDisplay.prototype.fadeOut=function(t){},WallDisplay.prototype.showNickname=function(t){},WallDisplay.prototype.setDisplayBadges=function(t){},WallDisplay.prototype.showRefernceArea=function(){},WallDisplay.prototype.hideRefernceArea=function(){},WallDisplay.prototype.showEffect=function(){},WallDisplay.prototype.onLoadCompleteHandler=function(){this.mImage=this.scene.make.image({key:"wall",frame:"wall_up.png"},!1),this.add(this.mImage),this.mImage.y=-this.mImage.height/2+10,this.emit("initialized",this)},Object.defineProperty(WallDisplay.prototype,"sortX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(WallDisplay.prototype,"sortY",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(WallDisplay.prototype,"sortZ",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(WallDisplay.prototype,"baseLoc",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(WallDisplay.prototype,"element",{get:function(){},enumerable:!1,configurable:!0}),WallDisplay}(Phaser.GameObjects.Container),J=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t.UP="up",t.LEFT="left",t.RIGHT="right",t.DOWN="down"}(o||(o={}));var Z,$,tt=function(t){function Wall(e,i,n,o){var a=t.call(this,e)||this;return a.room=e,a.mID=i,a.mDirection=o,a.mPosition=n,a.createDisplay(),a}return J(Wall,t),Wall.prototype.setPosition=function(t){this.mPosition=t,this.mDisplay&&(this.mDisplay.x=t.x,this.mDisplay.y=t.y)},Wall.prototype.createDisplay=function(){if(this.mDisplay)return this.mDisplay;var t=this.room.scene;return t&&(this.mDisplay=new Q(t,this.room),this.setPosition(this.mPosition),this.mDisplay.once("initialized",this.onInitializedHandler,this),this.mDisplay.loadDisplay(G.h.getRes("wall/wall.png"),G.h.getRes("wall/wall.json")),this.addToBlock()),this.mDisplay},Wall.prototype.onInitializedHandler=function(){this.mDisplay.setDir(this.mDirection)},Wall.prototype.addDisplay=function(){this.createDisplay(),this.mDisplay&&(this.mRoomService.addToGround(this.mDisplay,0),this.setDepth())},Wall.prototype.setDepth=function(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.y),!this.mRoomService)throw new Error("roomService is undefined");var t=this.mRoomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthGroundDirty=!0}},Object.defineProperty(Wall.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Wall}(K.a),et=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),it=function(t){function WallManager(e){var i=t.call(this)||this;return i.mRoom=e,i.mWalls=new Map,i.mRoom.connection&&(i.mRoom.connection.addPacketListener(i),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE_END,i.onDawWallHandler)),i}return et(WallManager,t),WallManager.prototype.destroy=function(){this.mRoom.connection&&this.mRoom.connection.removePacketListener(this),this.mWalls.forEach((function(t){return t.destroy()})),this.mWalls.clear()},WallManager.prototype._add=function(t,e,i){var n=this.mRoom.transformTo90(new c.a(t,e));new tt(this.mRoom,1e6*t+1e3*e,n,i)},WallManager.prototype.onDawWallHandler=function(t){var e=this.mRoom.world.elementStorage.getTerrainCollection();if(e){var i=this.mRoom.world.getConfig().game_id.split(".");if(!(i.length<2)&&"5e410ba50681ad5557b4d6e9"===i[1])for(var n=e.data,a=0;a<n.length;a++)for(var s=0;s<n[0].length;s++)0!==n[a][s]&&(this.isUp(a,s,n)?this._add(a,s,o.UP):this.isLeft(a,s,n)?this._add(a,s,o.RIGHT):this.isRight(a,s,n)?this._add(a,s,o.LEFT):this.isDown(a,s,n)&&this._add(a,s,o.DOWN))}},WallManager.prototype.isUp=function(t,e,i){return 0===t?0===e||0===i[t][e-1]:0===e?0===t||0===i[t-1][e]:0===i[t-1][e]&&0===i[t][e-1]},WallManager.prototype.isLeft=function(t,e,i){if(0===e){if(t>0)return!0}else if(t>0&&e>0&&0===i[t][e-1])return!0},WallManager.prototype.isRight=function(t,e,i){if(0===t){if(e>0)return!0}else if(e>0&&t>0&&0===i[t-1][e])return!0},WallManager.prototype.isDown=function(t,e,i){if(t>0&&e>0&&0===i[t-1][e-1]&&0!==i[t-1][e]&&0!==i[t][e-1])return!0},WallManager}(s.PacketHandler),nt=i(16),ot=i(35),rt=i(269),at=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),st=function(t){function SkyBoxScene(){return t.call(this,{})||this}return at(SkyBoxScene,t),SkyBoxScene.prototype.init=function(t){t&&(this.skyBoxManager=t)},SkyBoxScene.prototype.create=function(){var t=this.cameras.main;this.cameras.addExisting(new rt.a(0,0,this.sys.scale.width,this.sys.scale.height,this.skyBoxManager.world.scaleRatio),!0),this.cameras.remove(t),this.scene.sendToBack(),this.skyBoxManager.startPlay(this)},SkyBoxScene.prototype.update=function(t,e){this.skyBoxManager.check(t,e)},SkyBoxScene}(ot.a),ht=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),lt=function(){function BlockManager(t,e){this.mRows=1,this.mCols=1,this.mSceneName="",this.mGrids=[],this.mScenery=t,this.mUris=t.uris,this.mRoom=e,this.mWorld=e.world,this.mCameras=e.cameraService,this.mMainCamera=this.mCameras.camera,this.mScaleRatio=this.mWorld.scaleRatio,this.setSize(t.width,t.height);var i=e.scene;i?(this.mSceneName=st.name+"_"+t.id,this.mWorld.game.scene.add(this.mSceneName,st,!1),i.scene.launch(this.mSceneName,this)):l.a.getInstance().fatal(BlockManager.name+" scene does not exist")}return BlockManager.prototype.startPlay=function(t){this.scene=t,this.initBlock()},BlockManager.prototype.check=function(t,e){for(var i=this.mMainCamera.worldView,n=new Phaser.Geom.Rectangle(i.x-i.width/2,i.y-i.height/2,2*i.width,2*i.height),o=0,a=this.mGrids;o<a.length;o++){var s=a[o];s.checkCamera(Phaser.Geom.Intersects.RectangleToRectangle(n,s.rectangle))}},BlockManager.prototype.update=function(t){this.mScenery=t,this.mUris=t.uris,this.setSize(t.width,t.height),this.initBlock()},BlockManager.prototype.setSize=function(t,e,i,n){void 0===i&&(i=t),void 0===n&&(n=e),this.mRows=Math.ceil(t/i),this.mCols=Math.ceil(e/n),this.mGridWidth=i,this.mGridHeight=n},BlockManager.prototype.updatePosition=function(){var t=this.scene.cameras.main,e=this.mRoom.roomSize,i=this.mScenery,n=i.width,o=i.height,a=i.offset;t.setPosition(((e.sceneWidth-n>>1)+a.x)*this.mWorld.scaleRatio,((e.sceneHeight-o>>1)+a.y)*this.mWorld.scaleRatio)},BlockManager.prototype.destroy=function(){this.mWorld&&this.mWorld.game&&this.mWorld.game.scene.remove(this.mSceneName),this.mGrids.length=0},BlockManager.prototype.initBlock=function(){this.clear(),this.mContainer=this.scene.add.container(0,0),this.mContainer.setScale(this.mWorld.scaleRatio);for(var t=this.mUris.length,e=0;e<t;e++)for(var i=this.mUris[e].length,n=0;n<i;n++){var o=new ct(this.scene,this.mUris[e][n]);o.setRectangle(e%this.mRows*this.mGridWidth,Math.floor(e/this.mRows)*this.mGridHeight,this.mGridWidth,this.mGridHeight,this.mScaleRatio),this.mGrids.push(o)}this.mContainer.add(this.mGrids),this.initCamera()},BlockManager.prototype.initCamera=function(){var t=this.scene.cameras.main;if(this.mCameras){var e=this.mCameras.camera,i=e.getBounds();t.setBounds(i.x,i.y,i.width,i.height),this.updatePosition(),t.setScroll(e.scrollX,e.scrollY),this.mCameras.addCamera(t)}},BlockManager.prototype.clear=function(){for(var t=0,e=this.mGrids;t<e.length;t++){e[t].destroy()}this.mGrids.length=0,this.mContainer&&this.mContainer.destroy(!0)},Object.defineProperty(BlockManager.prototype,"world",{get:function(){return this.mWorld},enumerable:!1,configurable:!0}),Object.defineProperty(BlockManager.prototype,"scenery",{get:function(){return this.mScenery},enumerable:!1,configurable:!0}),BlockManager}(),ct=function(t){function Block(e,i){var n=t.call(this,e,0,0)||this;return n.mLoaded=!1,n.mInCamera=!1,n.mKey=i,n.setOrigin(0),n}return ht(Block,t),Block.prototype.checkCamera=function(t){this.mInCamera!==t&&(this.mInCamera=t,this.mLoaded||this.load(G.h.getOsdRes(this.mKey)))},Block.prototype.setRectangle=function(t,e,i,n,o){void 0===o&&(o=1),this.x=t,this.y=e,this.mRectangle=new Phaser.Geom.Rectangle(t*o,e*o,i*o,n*o)},Object.defineProperty(Block.prototype,"rectangle",{get:function(){return this.mRectangle},enumerable:!1,configurable:!0}),Block.prototype.onLoadComplete=function(e){t.prototype.onLoadComplete.call(this,e),this.texture&&(this.mLoaded=!0,this.texture.setFilter(Phaser.Textures.FilterMode.NEAREST),this.mRectangle.setSize(this.width,this.height))},Block}(nt.DynamicImage),pt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ut=function(t){function SkyBoxManager(e){var i=t.call(this)||this;return i.mRoom=e,i.mScenetys=new Map,i}return pt(SkyBoxManager,t),SkyBoxManager.prototype.add=function(t){this.mScenetys.set(t.id,new lt(t,this.mRoom))},SkyBoxManager.prototype.update=function(t){var e=this.mScenetys.get(t.id);e&&e.update(t)},SkyBoxManager.prototype.remove=function(t){var e=this.mScenetys.get(t);e&&e.destroy()},SkyBoxManager.prototype.destroy=function(){if(this.mRoom){var t=this.mRoom.connection;t&&t.removePacketListener(this)}this.mScenetys.forEach((function(t){return t.destroy()}))},SkyBoxManager}(s.PacketHandler),mt=i(48),dt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ft=function(){function HandlerDispatcher(){}return HandlerDispatcher.prototype.hasListener=function(t){return!!(this._events&&this._events[t])},HandlerDispatcher.prototype.emitter=function(t,e){if(void 0===e&&(e=null),!this._events||!this._events[t])return!1;var i=this._events[t];if(i.run)i.once&&delete this._events[t],null!=e?i.runWith(e):i.run();else{for(var n=0,o=i.length;n<o;n++){var a=i[n];a&&(null!=e?a.runWith(e):a.run()),a&&!a.once||(i.splice(n,1),n--,o--)}0===i.length&&this._events&&delete this._events[t]}return!0},HandlerDispatcher.prototype.on=function(t,e,i,n){return void 0===n&&(n=null),this._createListener(t,e,i,n,!1)},HandlerDispatcher.prototype.once=function(t,e,i,n){return void 0===n&&(n=null),this._createListener(t,e,i,n,!0)},HandlerDispatcher.prototype.off=function(t,e,i,n){if(void 0===n&&(n=!1),!this._events||!this._events[t])return this;var o=this._events[t];if(null!=i)if(o.run)e&&o.caller!==e||o.method!==i||n&&!o.once||(delete this._events[t],o.recover());else{for(var a=0,s=o.length,h=0,l=o.length;h<l;h++){var c=o[h];!c||e&&c.caller!==e||c.method!==i||n&&!c.once||(a++,o[h]=null,c.recover())}a===s&&delete this._events[t]}return this},HandlerDispatcher.prototype.offAll=function(t){void 0===t&&(t=null);var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this},HandlerDispatcher.prototype.destroy=function(){this.offAll()},HandlerDispatcher.prototype._createListener=function(t,e,i,n,o,a){void 0===a&&(a=!0),a&&this.off(t,e,i,o);var s=yt.create(e||this,i,n,o);this._events||(this._events={});var h=this._events;return h[t]?h[t].run?h[t]=[h[t],s]:h[t].push(s):h[t]=s,this},HandlerDispatcher.prototype._recoverHandlers=function(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;e>-1;e--)t[e]&&(t[e].recover(),t[e]=null)},HandlerDispatcher}(),yt=function(t){function EventHandler(e,i,n,o){return t.call(this,e,i,n,o)||this}return dt(EventHandler,t),EventHandler.create=function(t,e,i,n){return void 0===i&&(i=null),void 0===n&&(n=!0),EventHandler._mpool.length?EventHandler._mpool.pop().setTo(t,e,i,n):new EventHandler(t,e,i,n)},EventHandler.prototype.recover=function(){this._id>0&&(this._id=0,EventHandler._mpool.push(this.clear()))},EventHandler._mpool=[],EventHandler}(mt.a),gt=function(){function FollowGroup(){this.groupType=Z.Follow,this.eventDisp=new ft,this.childs=[]}return FollowGroup.prototype.addChild=function(t){this.removeChild(t),this.childs.push(t)},FollowGroup.prototype.removeChild=function(t){var e=this.childs.indexOf(t);-1!==e&&this.childs.splice(e,1)},FollowGroup.prototype.replaceOwner=function(t){this.owner=t,this.eventDisp.emitter($.REPLACE_TYPE,t)},FollowGroup.prototype.emitter=function(t,e){t||(t=$.DEFAULT_TYPE),this.eventDisp.emitter(t,e)},FollowGroup.prototype.on=function(t,e,i,n){this.eventDisp.on(t,e,i,n)},FollowGroup.prototype.off=function(t,e,i){this.eventDisp.off(t,e,i)},FollowGroup.prototype.destroy=function(){this.eventDisp.destroy(),this.childs.length=0,this.owner=null,this.data=null},FollowGroup}(),_t=function(){function GroupManager(t){this.room=t,this.map=new Map}return GroupManager.prototype.createGroup=function(t,e){if(!this.hasGroup(t,e)){var i=this.map.get(t),n=void 0;if(i||(i=[],this.map.set(t,i)),e===Z.Follow){var o=new gt;o.owner=t,i.push(o),n=o}return n}},GroupManager.prototype.getGroup=function(t,e){var i;if(this.map.has(t))for(var n=0,o=this.map.get(t);n<o.length;n++){var a=o[n];if(a.groupType===e)return i=a}return i},GroupManager.prototype.hasGroup=function(t,e){return!!this.getGroup(t,e)},GroupManager.prototype.destroy=function(){this.map.forEach((function(t,e){for(var i=0,n=t;i<n.length;i++){n[i].destroy()}t.length=0})),this.map.clear()},GroupManager}();!function(t){t[t.Follow=1]="Follow"}(Z||(Z={})),function(t){t.DEFAULT_TYPE="DEFAULT_TYPE",t.REPLACE_TYPE="REPLACE_TYPE"}($||($={}));var vt,bt=function(){function FrameManager(){this.handlers=[]}return FrameManager.prototype.add=function(t,e,i){this.remove(t,e);var n=new mt.a(t,e,i);this.handlers.push(n)},FrameManager.prototype.remove=function(t,e){for(var i=-1,n=0;n<this.handlers.length;n++){var o=this.handlers[n];if(o.caller===t&&o.method===e){i=n;break}}-1!==i&&this.handlers.splice(i,1)[0].clear()},FrameManager.prototype.update=function(t,e){for(var i=0,n=this.handlers;i<n.length;i++){n[i].runWith([t,e])}},FrameManager.prototype.destroy=function(){for(var t=0,e=this.handlers;t<e.length;t++){e[t].clear()}this.handlers.length=0},FrameManager.prototype.hasRegistered=function(t,e){for(var i=-1,n=0;n<this.handlers.length;n++){var o=this.handlers[n];if(o.caller===t&&o.method===e){i=n;break}}return-1!==i},FrameManager}(),Pt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),St=function(t){function Room(e){var i=t.call(this)||this;return i.manager=e,i.mEnableEdit=!1,i.mWorld=i.manager.world,i.moveStyle=i.mWorld.moveStyle,i.mScaleRatio=i.mWorld.scaleRatio,i.mWorld&&i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ENABLE_EDIT_MODE,i.onEnableEditModeHandler),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_UNWALKABLE_BIT_MAP,i.onShowMapTitle),i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_MOVE_SPRITE_BY_PATH,i.onMovePathHandler)),i}return Pt(Room,t),Room.prototype.enter=function(t){var e=this;this.mWorld.getSize();t&&(this.mID=t.id,this.mSize={cols:t.cols,rows:t.rows,tileHeight:t.tileHeight,tileWidth:t.tileWidth,sceneWidth:(t.rows+t.cols)*(t.tileWidth/2),sceneHeight:(t.rows+t.cols)*(t.tileHeight/2)},this.mMiniSize={cols:2*t.cols,rows:2*t.rows,tileWidth:t.tileWidth/2,tileHeight:t.tileHeight/2},this.mMap=new j(this.mWorld),this.mMap.setMapInfo(t),this.world.showLoading().then((function(){e.completeLoad()})),this.mCameraService=new I.a(this))},Room.prototype.onFullPacketReceived=function(t){h.op_def.NodeType.TerrainNodeType},Room.prototype.onClockReady=function(){},Room.prototype.startLoad=function(){},Room.prototype.completeLoad=function(){this.mWorld.game.scene.getScene(A.a.name)||this.mWorld.game.scene.add(A.a.name,A.a,!0,{room:this})},Room.prototype.startPlay=function(){var t=this;if(this.mLayManager&&this.layerManager.destroy(),this.mScene=this.world.game.scene.getScene(A.a.name),this.mTerrainManager=new E.a(this,this),this.mElementManager=new a.a(this),this.mPlayerManager=new O(this),this.mWallManager=new it(this),this.mBlocks=new R.a(this.mCameraService),this.mLayManager=new x.a(this),this.mGroupManager=new _t(this),this.mFrameManager=new bt,this.mSkyboxManager=new ut(this),this.scene){var e=this.scene.cameras.main;this.mCameraService.camera=e,this.mCameraService.setBounds(-e.width>>1,-e.height>>1,this.mSize.sceneWidth*this.mScaleRatio+e.width,this.mSize.sceneHeight*this.mScaleRatio+e.height),this.mBlocks.int(this.mSize),this.mWorld.moveStyle!==h.op_def.MoveStyle.DIRECTION_MOVE_STYLE&&(this.mFallEffectContainer=new X(this.mScene,this))}this.mPlayerManager.createActor(this.mActorData);var n=this.mWorld.game.scene.getScene(k.a.name);this.world.emitter.on(u.a.PRESS_ELEMENT,this.onPressElementHandler,this),n&&n.sleep(),this.world.changeRoom(this),this.world.uiManager&&this.world.uiManager.showMainUI(),this.connection&&(this.cameraService.syncCamera(),this.connection.send(new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED))),this.scene.input.on("pointerdown",this.onPointerDownHandler,this),this.scene.input.on("pointerup",this.onPointerUpHandler,this),this.world.emitter.on("Tap",this.onTapHandler,this);var o=this.world.elementStorage.getScenerys();if(o)for(var l=0,c=o;l<c.length;l++){var p=c[l];this.addSkyBox(p)}i.e(3).then(i.t.bind(null,443,7)).then((function(e){(new(0,e.Template)).init(t.world)}))},Room.prototype.pause=function(){this.mScene&&this.mScene.scene.pause(),this.mWorld&&this.mWorld.inputManager&&(this.mWorld.inputManager.enable=!1)},Room.prototype.resume=function(t){this.mScene&&this.mScene.scene.resume(t),this.mWorld&&this.mWorld.inputManager&&(this.mWorld.inputManager.enable=!0)},Room.prototype.addActor=function(t){this.mActorData=t},Room.prototype.addBlockObject=function(t){this.blocks&&this.blocks.add(t)},Room.prototype.removeBlockObject=function(t){this.blocks&&this.blocks.remove(t)},Room.prototype.updateBlockObject=function(t){this.blocks&&this.blocks.check(t)},Room.prototype.addToGround=function(t,e){this.layerManager.addToGround(t,e)},Room.prototype.addToSurface=function(t){this.layerManager.addToSurface(t)},Room.prototype.addToSceneUI=function(t){this.layerManager.addToSceneToUI(t)},Room.prototype.addToUI=function(t){this.layerManager.addToUI(t)},Room.prototype.resize=function(t,e){this.layerManager&&this.layerManager.resize(t,e),this.mCameraService&&this.mCameraService.resize(t,e)},Room.prototype.transformTo90=function(t){if(this.mSize)return B.a.transformTo90(t,this.mSize)},Room.prototype.transformTo45=function(t){if(this.mSize)return B.a.transformTo45(t,this.mSize)},Room.prototype.transformToMini90=function(t){if(this.mMiniSize)return B.a.transformTo90(t,this.miniSize)},Room.prototype.transformToMini45=function(t){if(this.mMiniSize)return B.a.transformTo45(t,this.mMiniSize)},Room.prototype.addMouseListen=function(){this.layerManager.addMouseListen()},Room.prototype.moveable=function(t){var e=this.transformToMini45(t),i=this.mElementManager.map;return!(e.x<0||e.x>i.length||e.y<0||e.y>i[0].length)&&0!==i[e.y][e.x]},Room.prototype.update=function(t,e){this.updateClock(t,e),this.mBlocks.update(t,e),this.layerManager&&this.layerManager.update(t,e),this.elementManager&&this.elementManager.update(t,e),this.mFrameManager&&this.frameManager.update(t,e)},Room.prototype.updateClock=function(t,e){this.mWorld.clock&&this.mWorld.clock.update(t,e)},Room.prototype.now=function(){return this.mWorld.clock.unixTime},Room.prototype.clear=function(){this.mLayManager&&this.mLayManager.destroy(),this.mTerrainManager&&this.mTerrainManager.destroy(),this.mElementManager&&this.mElementManager.destroy(),this.mPlayerManager&&this.mPlayerManager.destroy(),this.mBlocks&&this.mBlocks.destroy(),this.mSkyboxManager&&this.mSkyboxManager.destroy(),this.mWallManager&&this.mWallManager.destroy(),this.mActorData&&(this.mActorData=null)},Room.prototype.destroy=function(){this.clear(),this.world.emitter.off("Tap",this.onTapHandler,this),this.connection&&this.connection.removePacketListener(this),this.mWorld.game.scene.remove(A.a.name),this.world.emitter.off(u.a.PRESS_ELEMENT,this.onPressElementHandler,this)},Room.prototype.addSkyBox=function(t){this.mSkyboxManager.add(t)},Room.prototype.onPointerDownHandler=function(t){this.addPointerMoveHandler()},Room.prototype.onPointerUpHandler=function(t){this.removePointerMoveHandler()},Room.prototype.addPointerMoveHandler=function(){this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("gameout",this.onGameOutHandler,this)},Room.prototype.removePointerMoveHandler=function(){this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("gameout",this.onGameOutHandler,this),this.cameraService.moving&&(this.cameraService.syncCameraScroll(),this.cameraService.moving=!1)},Room.prototype.onPointerMoveHandler=function(t){this.mCameraService.targetFollow||this.cameraService.offsetScroll(t.prevPosition.x-t.position.x,t.prevPosition.y-t.position.y)},Room.prototype.onGameOutHandler=function(){this.removePointerMoveHandler()},Object.defineProperty(Room.prototype,"scene",{get:function(){return this.mScene||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"terrainManager",{get:function(){return this.mTerrainManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"elementManager",{get:function(){return this.mElementManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"playerManager",{get:function(){return this.mPlayerManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"map",{get:function(){return this.mMap},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"layerManager",{get:function(){return this.mLayManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"groupManager",{get:function(){return this.mGroupManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"frameManager",{get:function(){return this.mFrameManager||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"cameraService",{get:function(){return this.mCameraService||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"roomSize",{get:function(){return this.mSize||void 0},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"miniSize",{get:function(){return this.mMiniSize},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"blocks",{get:function(){return this.mBlocks},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"world",{get:function(){return this.mWorld},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"enableEdit",{get:function(){return this.mEnableEdit},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"connection",{get:function(){if(this.manager)return this.manager.connection},enumerable:!1,configurable:!0}),Object.defineProperty(Room.prototype,"sceneType",{get:function(){return h.op_def.SceneTypeEnum.NORMAL_SCENE_TYPE},enumerable:!1,configurable:!0}),Room.prototype.onPressElementHandler=function(t,e){if(e&&e.parentContainer){var i=e.parentContainer;if(i instanceof H.a)if(i.element instanceof m.b&&this.mEnableEdit){var n=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_EDIT_MODE_ENTER);this.connection.send(n)}}},Room.prototype.onEnableEditModeHandler=function(t){this.mEnableEdit=!0},Room.prototype.onShowMapTitle=function(t){if(this.scene){for(var e=t.content,i=new U.a(this.scene,this),n=[],o=e.intArray,a=0;a<o.length;a++){n[a]=[];for(var s=0;s<o[a].value.length;s++)n[a][s]=o[a].value[s]}i.draw(n,new Phaser.Geom.Point(0,0)),i.setAlpha(.1),i.size&&(i.setPosition(i.size.sceneWidth/2,0),this.mLayManager.addToMiddle(i))}},Room.prototype.addFillEffect=function(t,e){if(this.scene){var i=new W(this.scene,this.mScaleRatio);i.show(e),i.setPosition(t.x*this.mScaleRatio,t.y*this.mScaleRatio),this.addToSceneUI(i)}else l.a.getInstance().log("Room scene  does not exist")},Room.prototype.onMovePathHandler=function(t){var e=t.content,i=e.pathStatus;if(i){var n=e.targetPos;this.addFillEffect({x:n.x,y:n.y},i)}},Room.prototype.move=function(t,e,i){if(this.moveStyle===h.op_def.MoveStyle.PATH_MOVE_STYLE&&this.mPlayerManager){var n=this.mPlayerManager.actor;if(n){var o=n.getPosition45(),a=this.transformTo45(new c.a(t,e));if(Math.abs(o.x-a.x)>20||Math.abs(o.y-a.y)>20)this.addFillEffect({x:t,y:e},h.op_def.PathReachableStatus.PATH_UNREACHABLE_AREA);else{var l=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOVE_TO_TARGET_BY_PATH),p=l.content;if(i){var u=i.parentContainer;if(u&&u instanceof H.a){var m=u.element;m&&m.model&&(p.id=m.model.id,p.nodeType=m.model.nodeType)}}p.point3f={x:t,y:e},this.connection.send(l),this.tryMove()}}}},Room.prototype.tryMove=function(){var t=this.mPlayerManager.actor;if(t){var e=t.moveData,i=e.posPath;if(i&&!(i.length<0)){var n=e.step;if(!(n>=i.length)){var o=t.getPosition(),a=h.op_def.PBPoint3f.create();a.x=o.x,a.y=o.y;var l=h.op_def.PBPoint3f.create();l.x=i[n].x,l.y=i[n].y;var c=new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_CHECK_MOVE_PATH_NEXT_POINT),p=c.content;p.timestemp=this.now(),p.position=a,p.nextPoint=l,this.connection.send(c)}}}},Room.prototype.onTapHandler=function(t,e){this.move(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio,e)},Room.prototype.enterRoom=function(){this.mWorld.game.scene.run(A.a.name,{room:this})},Room}(s.PacketHandler);!function(t){t.MOVE="move",t.BRUSH="brush",t.SELECT="select",t.ERASER="eraser",t.FILL="FILL"}(vt||(vt={}));var wt,Tt=function(){function Brush(t){this.mEditorRoom=t,this.mMode=vt.SELECT}return Object.defineProperty(Brush.prototype,"mode",{get:function(){return this.mMode},set:function(t){this.mMode=t},enumerable:!1,configurable:!0}),Brush}(),Ct=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Dt=function(t){function EditScene(){return t.call(this,{key:EditScene.name})||this}return Ct(EditScene,t),EditScene.prototype.create=function(){this.mRoom.startPlay(),this.scene.sendToBack()},EditScene}(A.a),Mt=i(78),Ot=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),xt=h.op_def.NodeType,Et=function(){function MouseFollow(t,e){this.mScene=t,this.mRoomService=e,this.mScaleRatio=1,this.mSize=1,this.mLayerManager=this.mRoomService.layerManager,this.mScaleRatio=this.mRoomService.world.scaleRatio}return MouseFollow.prototype.setDisplay=function(t){if(this.mScene){this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null),this.mNodeType=t.nodeType,this.isMoss=t.isMoss,this.key=t.key,this.mSprite=new p.a(t.sprite,t.nodeType),this.mDisplay=new Bt(this.mScene,this.mRoomService);var e=this.mNodeType===xt.TerrainNodeType?this.mSize:1;this.mDisplay.setDisplay(this.mSprite,e),this.mDisplay.scale=this.mScaleRatio,this.mLayerManager.addToSceneToUI(this.mDisplay),this.mNodeType===xt.TerrainNodeType?this.mElementManager=this.mRoomService.terrainManager:this.mNodeType!==xt.ElementNodeType&&this.mNodeType!==xt.SpawnPointType||(this.mElementManager=this.mRoomService.elementManager),this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("wheel",this.onWheelHandler,this)}},MouseFollow.prototype.showEraserArea=function(){this.mScene&&(this.mDisplay&&this.mDisplay.destroy(),this.mDisplay=new It(this.mScene,this.mRoomService),this.mDisplay.setDisplay(null,this.mSize),this.mNodeType=xt.TerrainNodeType,this.mLayerManager.addToSceneToUI(this.mDisplay),this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("wheel",this.onWheelHandler,this))},MouseFollow.prototype.createTerrainsOrMossesData=function(){var t=this;return{locs:this.mDisplay.displays.map((function(e){return t.getPosition(e.x,e.y)})),key:this.key}},MouseFollow.prototype.createSprites=function(){if(this.mSprite){for(var t=[],e=null,i=0,n=this.mDisplay.displays;i<n.length;i++){var o=n[i];(e=Object.assign(Object.create(Object.getPrototypeOf(this.mSprite)),this.mSprite)).newID(),e.pos=this.getPosition(o.x,o.y),e.bindID=this.mSprite.id,e.sn=this.mSprite.sn,t.push(e)}return t}},MouseFollow.prototype.getEaserPosition=function(){var t=[];if(this.display){for(var e=null,i=0;i<this.mSize;i++)for(var n=0;n<this.mSize;n++)e=this.display.transformTo90(i,n),t.push(this.getPosition(e.x,e.y));return t}},MouseFollow.prototype.transitionGrid=function(t,e){var i=new c.a(t,e),n=this.mNodeType===h.op_def.NodeType.TerrainNodeType?this.mRoomService.transformTo45(i):this.mRoomService.transformToMini45(i);return!1===this.mAlignGrid?this.checkBound(n,i):this.checkBound(n)},MouseFollow.prototype.checkBound=function(t,e){var i=new c.a(t.x,t.y),n=this.mNodeType===h.op_def.NodeType.TerrainNodeType?this.mRoomService.roomSize:this.mRoomService.miniSize;return t.x<0?i.x=0:t.x>n.cols&&(i.x=n.cols),t.y<0?i.y=0:t.y>n.rows&&(i.y=n.rows),i.equal(t)&&e?e:this.mNodeType===h.op_def.NodeType.TerrainNodeType?this.mRoomService.transformTo90(i):this.mRoomService.transformToMini90(i)},MouseFollow.prototype.destroy=function(){this.mScene&&(this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("wheel",this.onWheelHandler,this)),this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null),this.mNodeType=xt.UnknownNodeType},MouseFollow.prototype.onPointerMoveHandler=function(t){this.updatePos(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio)},MouseFollow.prototype.getPosition=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.mNodeType===h.op_def.NodeType.TerrainNodeType?this.mRoomService.transformTo45(new c.a(this.mDisplay.x/this.mScaleRatio+t,this.mDisplay.y/this.mScaleRatio+e)):new c.a(this.mDisplay.x/this.mScaleRatio+t,this.mDisplay.y/this.mScaleRatio+e,this.mDisplay.z)},MouseFollow.prototype.onWheelHandler=function(t){this.mNodeType===xt.TerrainNodeType&&(t.deltaY<0?this.size--:this.size++,this.updatePos(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio))},MouseFollow.prototype.updatePos=function(t,e){if(this.mDisplay){var i=this.transitionGrid(t,e);i&&this.mDisplay.setLocation(i.x*this.mScaleRatio,i.y*this.mScaleRatio)}},Object.defineProperty(MouseFollow.prototype,"alignGrid",{set:function(t){this.mAlignGrid=t},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"display",{get:function(){return this.mDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"sprite",{get:function(){return this.mSprite},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"nodeType",{get:function(){return this.mNodeType},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"elementManager",{get:function(){return this.mElementManager},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"size",{get:function(){return this.mSize},set:function(t){t<1&&(t=1),t>20&&(t=20),this.mSize=t,this.mDisplay.setDisplay(this.mSprite,this.mSize)},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"isMoss",{get:function(){return this._isMoss},set:function(t){this._isMoss=t},enumerable:!1,configurable:!0}),Object.defineProperty(MouseFollow.prototype,"key",{get:function(){return this._key},set:function(t){this._key=t},enumerable:!1,configurable:!0}),MouseFollow}(),Bt=function(t){function MouseDisplayContainer(e,i){var n=t.call(this,e)||this;return n.mRoomService=i,n.mScaleRatio=1,n.mScaleRatio=n.mRoomService.world.scaleRatio,n.mOffset=new Phaser.Geom.Point,n}return Ot(MouseDisplayContainer,t),MouseDisplayContainer.prototype.setDisplay=function(t,e){if(this.clear(),this.mDisplay=[],t){var i,n=t.displayInfo;this.mNodeType=t.nodeType;var o=this.mRoomService.roomSize,a=o.tileWidth,s=o.tileHeight;this.mTileSize={tileWidth:a,tileHeight:s,rows:e,cols:e,sceneWidth:(e+e)*(a/2),sceneHeight:(e+e)*(s/2)},this.mOffset.x=-this.mTileSize.sceneWidth/2*this.mScaleRatio,this.mOffset.y=-(this.mTileSize.sceneHeight/this.mScaleRatio-(e%2==0?0:s))/2;for(var h=0;h<e;h++)for(var l=0;l<e;l++){(i=new Mt.a(this.scene,this.mRoomService)).setAlpha(.8),i.once("initialized",this.onInitializedHandler,this),i.load(n);var p=B.a.transformTo90(new c.a(h,l),this.mTileSize);i.x=p.x,i.y=p.y,this.add(i),this.mDisplay.push(i)}}},MouseDisplayContainer.prototype.transformTo90=function(t,e){return B.a.transformTo90(new c.a(t,e),this.mTileSize)},MouseDisplayContainer.prototype.transformTo45=function(t,e){return B.a.transformTo45(new c.a(t,e),this.mTileSize)},MouseDisplayContainer.prototype.setLocation=function(t,e){return this.x=t+this.mOffset.x,this.y=e+this.mOffset.y,this},MouseDisplayContainer.prototype.clear=function(){this.removeAll(!0),this.mDisplay=void 0},MouseDisplayContainer.prototype.destroy=function(e){this.clear(),t.prototype.destroy.call(this,e)},Object.defineProperty(MouseDisplayContainer.prototype,"displays",{get:function(){return this.mDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(MouseDisplayContainer.prototype,"tileWidth",{get:function(){var t=this.mTileSize.tileHeight;return this.mTileSize.rows%2==0&&(t=0),this.mTileSize.sceneWidth-t},enumerable:!1,configurable:!0}),Object.defineProperty(MouseDisplayContainer.prototype,"tileHeight",{get:function(){return this.mTileSize.sceneHeight},enumerable:!1,configurable:!0}),MouseDisplayContainer.prototype.onInitializedHandler=function(t){t&&this.mNodeType!==h.op_def.NodeType.TerrainNodeType&&t.showRefernceArea()},MouseDisplayContainer}(Phaser.GameObjects.Container),It=function(t){function EraserArea(e,i){return t.call(this,e,i)||this}return Ot(EraserArea,t),EraserArea.prototype.setDisplay=function(t,e){this.area&&this.area.clear();var i,n,o,a,s=this.mRoomService.roomSize,h=s.tileWidth,l=s.tileHeight;this.mTileSize={tileWidth:h,tileHeight:l,rows:e,cols:e,sceneWidth:(e+e)*(h/2),sceneHeight:(e+e)*(l/2)},this.mOffset.x=-this.mTileSize.sceneWidth/2,this.mOffset.y=-(this.mTileSize.sceneHeight-(e%2==0?0:l))/2,this.area=this.scene.make.graphics(void 0,!1);for(var p=0;p<e;p++)for(var u=0;u<e;u++)this.area.lineStyle(2,0),i=B.a.transformTo90(new c.a(u,p),this.mTileSize),n=B.a.transformTo90(new c.a(u+1,p),this.mTileSize),o=B.a.transformTo90(new c.a(u+1,p+1),this.mTileSize),a=B.a.transformTo90(new c.a(u,p+1),this.mTileSize),this.area.beginPath(),this.area.fillStyle(0,.5),this.area.strokePoints([i.toPoint(),n.toPoint(),o.toPoint(),a.toPoint()],!0,!0),this.area.fillPath();this.add(this.area)},EraserArea}(Bt),At=i(128),Rt=function(){function SelectedElement(t,e){this.mScene=t,this.mLayerManager=e,this.mEffecte=new nt.DynamicImage(this.mScene,0,0),this.mEffecte.load(G.h.getRes("ui/editor/selectFlag.png"))}return SelectedElement.prototype.setElement=function(t){this.mDisplay&&(this.mDisplay.hideRefernceArea(),this.mDisplay.showNickname(""),this.mSprite=void 0),this.mDisplay=t,t.showRefernceArea();var e=t.element;e&&(e.showNickname(),this.mSprite=e.model),this.mLayerManager.addToSceneToUI(this.mEffecte),this.mSelecting=!0,this.update()},SelectedElement.prototype.remove=function(){this.mSelecting=!1,this.mEffecte&&(this.mEffecte.parentContainer&&this.mEffecte.parentContainer.remove(this.mEffecte),this.mDisplay&&(this.mDisplay.parentContainer&&(this.mDisplay.hideRefernceArea(),this.mDisplay.showNickname("")),this.mDisplay=null,this.mSprite=void 0))},SelectedElement.prototype.update=function(){if(this.mDisplay){var t=this.mDisplay.baseLoc;this.mEffecte.x=this.mDisplay.x+t.x+(this.mDisplay.spriteWidth>>1),this.mEffecte.y=this.mDisplay.y+t.y}},SelectedElement.prototype.setDisplayPos=function(t,e){if(this.mDisplay&&(this.mDisplay.x=t,this.mDisplay.y=e,this.mSprite)){var i=this.mSprite.pos;i&&(i.x=t,i.y=e)}},SelectedElement.prototype.destroy=function(){this.mEffecte&&(this.remove(),this.mEffecte.destroy(),this.mEffecte=null)},Object.defineProperty(SelectedElement.prototype,"display",{get:function(){return this.mDisplay},enumerable:!1,configurable:!0}),Object.defineProperty(SelectedElement.prototype,"selecting",{get:function(){return this.mSelecting},set:function(t){this.mSelecting=t},enumerable:!1,configurable:!0}),Object.defineProperty(SelectedElement.prototype,"sprite",{get:function(){return this.mSprite},enumerable:!1,configurable:!0}),SelectedElement}(),kt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Lt=h.op_def.NodeType,Ft=function(t){function EditorElementManager(e){var i=t.call(this,e)||this;return i.mRoom=e,i.taskQueue=new Map,i.connection&&(i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_CREATE_SPRITE,i.handleCreateElements),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_SPRITE,i.handleDeleteElements),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SYNC_SPRITE,i.handleSyncElements)),i}return kt(EditorElementManager,t),EditorElementManager.prototype.update=function(){this.batchActionSprites()},EditorElementManager.prototype.addElements=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];this.taskQueue.set(n.id,{action:"ADD",sprite:n})}this.callEditorCreateElementData(t)},EditorElementManager.prototype.callEditorCreateElementData=function(t){var e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_CREATE_SPRITE),i=e.content;i.nodeType=t[0].nodeType,i.sprites=t.map((function(t){return t.toSprite()})),this.connection.send(e),l.a.getInstance().log("add sprites: ",i)},EditorElementManager.prototype.updateElements=function(t){this.callEditorUpdateElementData(t)},EditorElementManager.prototype.callEditorUpdateElementData=function(t){var e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_SYNC_SPRITE);e.content.sprites=t,this.connection.send(e)},EditorElementManager.prototype.deleteElements=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e];this.taskQueue.set(n,{action:"DELETE",sprite:{id:n}})}this.callEditorDeleteElementData(t)},EditorElementManager.prototype.callEditorDeleteElementData=function(t){var e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_DELETE_SPRITE),i=e.content;i.ids=t,i.nodeType=h.op_def.NodeType.ElementNodeType,this.connection.send(e)},EditorElementManager.prototype.handleCreateElements=function(t){if(this.mRoom.layerManager)for(var e=t.content,i=e.sprites,n=(e.nodeType,0),o=i;n<o.length;n++){var a=o[n];this.taskQueue.set(a.id,{action:"ADD",sprite:new p.a(a)})}else l.a.getInstance().error("layer manager does not exist")},EditorElementManager.prototype.handleDeleteElements=function(t){var e=t.content,i=e.ids,n=e.nodeType;if(n===Lt.ElementNodeType||n===Lt.SpawnPointType){for(var o=0,a=i;o<a.length;o++){var s=a[o];this.taskQueue.set(s,{action:"DELETE",sprite:{id:s}})}this.roomService.removeSelected()}},EditorElementManager.prototype.handleSyncElements=function(t){var e=t.content,i=e.sprites;if(e.nodeType===h.op_def.NodeType.ElementNodeType)for(var n=0,o=i;n<o.length;n++){var a=o[n];this.taskQueue.set(a.id,{action:"UPDATE",sprite:new p.a(a)})}},EditorElementManager.prototype.batchActionSprites=function(){if(Array.from(this.taskQueue.keys()).length)for(var t=0,e=Array.from(this.taskQueue.keys()).splice(0,200);t<e.length;t++){var i=e[t],n=this.taskQueue.get(i),o=n.action,a=n.sprite;this.taskQueue.delete(i),"ADD"===o?this.mRoom.displayObjectPool.push("elements",a.id.toString(),a,this):"DELETE"===o?this.mRoom.displayObjectPool.remove("elements",a.id.toString()):"UPDATE"===o&&this.mRoom.displayObjectPool.update("elements",a.id.toString(),a)}},Object.defineProperty(EditorElementManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),EditorElementManager}(a.a),Nt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),__assign=function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},jt=function(t){function EditorTerrainManager(e,i){var n=t.call(this,e,i)||this;return n.mRoom=e,n.taskQueue=new Map,n.mEditorTerrains=new Map,n.connection&&(n.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ADD_SPRITES_WITH_LOCS,n.handleAddTerrains),n.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_SPRITES_WITH_LOCS,n.handleDeleteTerrains)),n}return Nt(EditorTerrainManager,t),EditorTerrainManager.prototype.addTerrains=function(t){for(var e=this,i=t.locs,n=t.key,o=i.filter((function(t){return e.canPut(t,n)})),a=0,s=o;a<s.length;a++){var h=s[a],l=this.genLocId(h.x,h.y),c=this.mEditorTerrains.get(l);c&&c!==n?this.taskQueue.set(l,{action:"UPDATE",loc:__assign(__assign({},h),{key:n})}):this.taskQueue.set(l,{action:"ADD",loc:__assign(__assign({},h),{key:n})})}this.reqEditorAddTerrainsData(o,n)},EditorTerrainManager.prototype.reqEditorAddTerrainsData=function(t,e){var i=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_ADD_TERRAINS),n=i.content;n.locs=t,n.key=e,this.connection.send(i)},EditorTerrainManager.prototype.removeTerrains=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e],o=this.genLocId(n.x,n.y);this.taskQueue.set(o,{action:"DELETE",loc:{x:n.x,y:n.y}})}this.reqEditorDeleteTerrainsData(t)},EditorTerrainManager.prototype.reqEditorDeleteTerrainsData=function(t){var e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_DELETE_TERRAINS);e.content.locs=t.map((function(t){return{x:t.x,y:t.y,z:t.z}})),this.connection.send(e)},EditorTerrainManager.prototype.update=function(){this.batchActionSprites()},EditorTerrainManager.prototype.handleAddTerrains=function(t){if(this.mRoom.layerManager){var e=t.content,i=e.locs;if(e.nodeType===h.op_def.NodeType.TerrainNodeType)for(var n=0,o=i;n<o.length;n++){var a=o[n],s=this.genLocId(a.x,a.y),c=this.mEditorTerrains.get(s);c&&c===a.key||this.taskQueue.set(s,{action:"ADD",loc:a})}}else l.a.getInstance().error("layer manager does not exist")},EditorTerrainManager.prototype.handleDeleteTerrains=function(t){if(this.mRoom.layerManager){var e=t.content,i=e.locs;if(e.nodeType===h.op_def.NodeType.TerrainNodeType)for(var n=0,o=i;n<o.length;n++){var a=o[n],s=this.genLocId(a.x,a.y);this.taskQueue.set(s,{action:"DELETE",loc:a})}}else l.a.getInstance().error("layer manager does not exist")},EditorTerrainManager.prototype.canPut=function(t,e){var i=this.genLocId(t.x,t.y),n=this.roomService.roomSize;return!!n&&(!(t.x<0||t.y<0||t.x>=n.cols||t.y>=n.rows)&&this.mEditorTerrains.get(i)!==e)},EditorTerrainManager.prototype.batchActionSprites=function(){if(Array.from(this.taskQueue.keys()).length)for(var t=0,e=Array.from(this.taskQueue.keys()).splice(0,200);t<e.length;t++){var i=e[t],n=this.taskQueue.get(i),o=n.action,a=n.loc,s=this.genLocId(a.x,a.y);if(this.taskQueue.delete(i),"ADD"===o){if(!(c=this.mRoom.world.elementStorage.getTerrainPalette(a.key)))continue;var l=c.createSprite({nodeType:h.op_def.NodeType.TerrainNodeType,x:a.x,y:a.y});this.mEditorTerrains.set(s,a.key),this.mRoom.displayObjectPool.push("terrains",s,l,this)}else if("DELETE"===o)this.mEditorTerrains.delete(s),this.mRoom.displayObjectPool.remove("terrains",s);else if("UPDATE"===o){var c;if(!(c=this.mRoom.world.elementStorage.getTerrainPalette(a.key)))continue;l=c.createSprite({nodeType:h.op_def.NodeType.TerrainNodeType,x:a.x,y:a.y});this.mEditorTerrains.set(s,a.key),this.mRoom.displayObjectPool.update("terrains",s,l)}}},EditorTerrainManager.prototype.genLocId=function(t,e){return t+"_"+e},EditorTerrainManager}(E.a),Ht=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Ut=function(t){function EditorCamerasManager(){return null!==t&&t.apply(this,arguments)||this}return Ht(EditorCamerasManager,t),EditorCamerasManager.prototype.centerCameas=function(){if(this.mMain&&this.mRoomService){var t=this.mRoomService.roomSize;this.mMain.setScroll(t.sceneWidth-this.mMain.width>>1,t.sceneHeight-this.mMain.height>>1);this.mMain.worldView;var e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_RESET_CAMERA),i=e.content;i.x=this.mMain.scrollX,i.y=this.mMain.scrollY,i.width=this.mMain.width,i.height=this.mMain.height,this.connection.send(e)}},EditorCamerasManager.prototype.offsetScroll=function(t,e){if(this.mMain)for(var i=0,n=this.mCameras;i<n.length;i++){var o=n[i];o.scrollX+=t/this.zoom,o.scrollY+=e/this.zoom}},EditorCamerasManager.prototype.syncCameraScroll=function(){var t=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_RESET_CAMERA),e=t.content;e.x=this.mMain.scrollX/this.zoom,e.y=this.mMain.scrollY/this.zoom,e.width=0,e.height=0,this.connection.send(t)},EditorCamerasManager}(I.a),Gt=i(122),Vt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),editor_moss_manager_assign=function(){return(editor_moss_manager_assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Wt=function(t){function EditorMossManager(e){var i=t.call(this,e)||this;return i.mRoom=e,i.taskQueue=new Map,i.editorMosses=new Map,i.connection&&(i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ADD_MOSSES,i.handleAddMosses),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_MOSSES,i.handleDeleteMosses),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SYNC_MOSSES,i.handleUpdateMosses)),i}return Vt(EditorMossManager,t),EditorMossManager.prototype.update=function(){this.batchActionSprites()},EditorMossManager.prototype.addMosses=function(t){for(var e=[],i=t.locs,n=t.key,o=0,a=i;o<a.length;o++){var s=a[o],h=Gt.a.genId(),l={x:s.x,y:s.y,z:s.z,key:n,id:h};this.taskQueue.set(h,{action:"ADD",loc:l}),e.push(l)}this.reqEditorCreateMossData(e)},EditorMossManager.prototype.reqEditorCreateMossData=function(t){var e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_CREATE_MOSSES);e.content.locs=t,this.connection.send(e)},EditorMossManager.prototype.updateMosses=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i].display.element.model.toSprite(),a=this.editorMosses.get(o.id),s={x:o.point3f.x,y:o.point3f.y,z:o.point3f.z,id:o.id,dir:o.direction,key:a.key};this.taskQueue.set(o.id,{action:"UPDATE",loc:s}),e.push(s)}this.reqEditorUpdateMossData(e)},EditorMossManager.prototype.reqEditorUpdateMossData=function(t){var e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_SYNC_MOSSES);e.content.locs=t,this.connection.send(e)},EditorMossManager.prototype.deleteMosses=function(t){for(var e=[],i=0,n=t;i<n.length;i++){var o=n[i],a=this.editorMosses.get(o);e.push(a),this.taskQueue.set(o,{action:"DELETE",loc:a})}this.reqEditorDeleteMossData(e)},EditorMossManager.prototype.reqEditorDeleteMossData=function(t){var e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_DELETE_MOSSES);e.content.locs=t,this.connection.send(e)},EditorMossManager.prototype.handleAddMosses=function(t){for(var e=0,i=t.content.locs;e<i.length;e++){var n=i[e];this.taskQueue.set(n.id,{action:"ADD",loc:n})}},EditorMossManager.prototype.handleDeleteMosses=function(t){for(var e=0,i=t.content.ids;e<i.length;e++){var n=i[e];this.taskQueue.set(n,{action:"DELETE",loc:this.editorMosses.get(n)})}this.roomService.removeSelected()},EditorMossManager.prototype.handleUpdateMosses=function(t){for(var e=0,i=t.content.locs;e<i.length;e++){var n=i[e];this.taskQueue.set(n.id,{action:"UPDATE",loc:n})}},EditorMossManager.prototype.batchActionSprites=function(){if(Array.from(this.taskQueue.keys()).length)for(var t=0,e=Array.from(this.taskQueue.keys()).splice(0,200);t<e.length;t++){var i=e[t],n=this.taskQueue.get(i),o=n.action,a=n.loc;if(this.taskQueue.delete(i),"ADD"===o){if(!(l=this.mRoom.world.elementStorage.getMossPalette(a.key)))continue;var s=l.createSprite(editor_moss_manager_assign(editor_moss_manager_assign({},a),{nodeType:h.op_def.NodeType.ElementNodeType,isMoss:!0}));this.editorMosses.set(a.id,a),this.mRoom.displayObjectPool.push("mosses",a.id.toString(),s,this)}else if("DELETE"===o)a&&(this.editorMosses.delete(a.id),this.mRoom.displayObjectPool.remove("mosses",a.id.toString()));else if("UPDATE"===o){var l;if(!(l=this.mRoom.world.elementStorage.getMossPalette(a.key)))continue;s=l.createSprite(editor_moss_manager_assign(editor_moss_manager_assign({},a),{nodeType:h.op_def.NodeType.ElementNodeType,isMoss:!0}));this.editorMosses.set(a.id,a),this.mRoom.displayObjectPool.update("mosses",a.id.toString(),s)}}},Object.defineProperty(EditorMossManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!1,configurable:!0}),EditorMossManager}(a.a),zt=i(268),Yt=function(){function DisplayObjectPool(){this.terrains=new Map,this.mosses=new Map,this.elements=new Map,this.POOLOBJECTCONFIG={terrains:zt.a,mosses:m.b,elements:m.b}}return DisplayObjectPool.prototype.getPool=function(t){return this[t]},DisplayObjectPool.prototype.push=function(t,e,i,n){var o=this[t],a=new this.POOLOBJECTCONFIG[t](i,n);a.setBlockable(!1),a.setRenderable(!0),a instanceof m.b&&a.setInputEnable(m.c.Enable),o.set(e,a)},DisplayObjectPool.prototype.remove=function(t,e){var i=this[t].get(e);i&&(i.isUsed=!1,i.destroy()),this[t].delete(e)},DisplayObjectPool.prototype.update=function(t,e,i){var n=this[t].get(e);n&&(n.isUsed=!0,n.setModel(i))},DisplayObjectPool.prototype.destroy=function(){for(var t=0,e=Object.keys(this.POOLOBJECTCONFIG);t<e.length;t++){this[e[t]].clear()}},DisplayObjectPool}(),Xt=function(){function Scenery(t){this.mID=t.id,this.mDepth=t.depth,this.mUris=[];var e=null;(e=Array.isArray(t.uris)?t.uris:t.uris.value).length<1&&l.a.getInstance().error(Scenery.name+": scenery uris is empty");for(var i=0;i<e.length;i++){var n=e[i].value||e;this.mUris[i]=new Array(n.length);for(var o=0;o<n.length;o++)this.mUris[i][o]=n[o]}this.mSpeed=t.speed||1,t.width||l.a.getInstance().error(Scenery.name+": scenery width is "+t.width),t.height||l.a.getInstance().error(Scenery.name+": scenery height is "+t.height),this.mWidth=t.width,this.mHeight=t.height,this.mFit=t.fit,this.mOffset=t.offset||{x:0,y:0}}return Object.defineProperty(Scenery.prototype,"width",{get:function(){return this.mWidth},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"height",{get:function(){return this.mHeight},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"id",{get:function(){return this.mID},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"depth",{get:function(){return this.mDepth},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"offset",{get:function(){return this.mOffset},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"speed",{get:function(){return this.mSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"uris",{get:function(){return this.mUris},enumerable:!1,configurable:!0}),Object.defineProperty(Scenery.prototype,"fit",{get:function(){return this.mFit},enumerable:!1,configurable:!0}),Scenery}();!function(t){t[t.Center=1]="Center",t[t.Fill=2]="Fill"}(wt||(wt={}));var Kt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),qt=function(t){function EditorSkyBoxManager(e){var i=t.call(this,e)||this,n=e.connection;return n&&(n.addPacketListener(i),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ADD_SCENERY,i.onAddSceneryHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_UPDATE_SCENERY,i.onUpdateSceneryHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_SCENERY,i.onDeleteSceneryHandler)),i}return Kt(EditorSkyBoxManager,t),EditorSkyBoxManager.prototype.fetch=function(t){this.mScenetys&&(this.mSelected=this.mScenetys.get(t))},EditorSkyBoxManager.prototype.move=function(t){if(this.selected){var e=this.mSelected.scenery;if(e){var i=e.offset;i.x+=(t.x-t.prevPosition.x)/this.mRoom.world.scaleRatio,i.y+=(t.y-t.prevPosition.y)/this.mRoom.world.scaleRatio,this.mSelected.updatePosition(),this.onSyncSceneryOffset()}}},EditorSkyBoxManager.prototype.keyboardMove=function(t){if(this.mSelected){var e=this.mSelected.scenery;if(e){var i=e.offset;switch(t){case 37:case 65:i.x--;break;case 38:case 87:i.y--;break;case 39:case 68:i.x++;break;case 40:case 83:i.y++}this.mSelected.updatePosition(),this.onSyncSceneryOffset()}}},EditorSkyBoxManager.prototype.removeSelect=function(){this.mSelected&&(this.mSelected=void 0)},EditorSkyBoxManager.prototype.onAddSceneryHandler=function(t){var e=t.content;this.add(new Xt(e))},EditorSkyBoxManager.prototype.onUpdateSceneryHandler=function(t){var e=t.content;this.update(new Xt(e))},EditorSkyBoxManager.prototype.onDeleteSceneryHandler=function(t){for(var e=0,i=t.content.ids;e<i.length;e++){var n=i[e];this.remove(n)}},EditorSkyBoxManager.prototype.onSyncSceneryOffset=function(){var t=this.mSelected.scenery,e=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_UPDATE_SCENERY),i=e.content;i.id=t.id;var n=h.op_def.PBPoint2f.create();Object.assign(n,t.offset),i.offset=n,this.mRoom.connection.send(e)},Object.defineProperty(EditorSkyBoxManager.prototype,"selected",{get:function(){return this.mSelected},enumerable:!1,configurable:!0}),EditorSkyBoxManager}(ut),Qt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Jt=function(t){function EditorRoom(e){var i=t.call(this,e)||this;return i.mBrush=new Tt(i),i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SET_EDITOR_MODE,i.onSetEditorModeHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ALIGN_GRID,i.onAlignGridHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_VISIBLE_GRID,i.onVisibleGridHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_MOUSE_FOLLOW,i.onMouseFollowHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_MOUSE_SELECTED_SPRITE,i.onMouseFollowHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_FETCH_SPRITE,i.onFetchSpriteHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_FETCH_SCENERY,i.onFetchSceneryHandler)),i}return Qt(EditorRoom,t),EditorRoom.prototype.enter=function(t){if(t){this.mID=t.id;var e=t.rows,i=t.cols,n=t.tileWidth,o=t.tileHeight;this.mSize={cols:i,rows:e,tileHeight:o,tileWidth:n,sceneWidth:(e+i)*(n/2),sceneHeight:(e+i)*(o/2)},e*=2,i*=2,n/=2,o/=2,this.mNimiSize={cols:i,rows:e,tileHeight:o,tileWidth:n,sceneWidth:(e+i)*(n/2),sceneHeight:(e+i)*(o/2)},this.editorTerrainManager=new jt(this),this.editorElementManager=new Ft(this),this.editorMossManager=new Wt(this),this.editorSkyboxManager=new qt(this),this.mCameraService=new Ut(this),this.displayObjectPool=new Yt,this.mWorld.game.scene.add(Dt.name,Dt,!0,{room:this})}else l.a.getInstance().error("wrong room")},EditorRoom.prototype.startPlay=function(){this.mScene=this.mWorld.game.scene.getScene(Dt.name),this.mLayManager=new x.a(this),this.mLayManager.drawGrid(this);var t=this.scene.cameras.main;this.mCameraService.camera=t;var e=this.world.scaleRatio;this.mCameraService.setBounds(-t.width>>1,-t.height>>1,this.mSize.sceneWidth*e+t.width,this.mSize.sceneHeight*e+t.height),this.connection.send(new s.PBpacket(h.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED)),this.mCameraService.centerCameas(),this.mScene.input.on("pointerdown",this.onPointerDownHandler,this),this.mScene.input.on("pointerup",this.onPointerUpHandler,this),this.mScene.input.on("gameobjectdown",this.onGameobjectDownHandler,this),this.mScene.input.on("gameout",this.onGameOutHandler,this),this.mScene.input.keyboard.on("keydown",this.onKeyDownHandler,this)},EditorRoom.prototype.destroy=function(){this.mWorld&&this.mWorld.connection&&this.mWorld.connection.removePacketListener(this),this.editorTerrainManager&&this.editorTerrainManager.destroy(),this.editorMossManager&&this.editorMossManager.destroy(),this.editorElementManager&&this.editorElementManager.destroy(),this.displayObjectPool&&this.displayObjectPool.destroy(),this.editorSkyboxManager&&this.editorSkyboxManager.destroy(),t.prototype.destroy.call(this)},EditorRoom.prototype.update=function(t,e){this.layerManager&&this.layerManager.update(t,e),this.mSelectedElementEffect&&this.mSelectedElementEffect.update(),this.editorTerrainManager&&this.editorTerrainManager.update(),this.editorMossManager&&this.editorMossManager.update(),this.editorElementManager&&this.editorElementManager.update()},EditorRoom.prototype.transformToMini90=function(t){if(this.mNimiSize)return B.a.transformTo90(t,this.mNimiSize);l.a.getInstance().error("position object is undefined")},EditorRoom.prototype.transformToMini45=function(t){if(this.mNimiSize)return B.a.transformTo45(t,this.mNimiSize);l.a.getInstance().error("position object is undefined")},EditorRoom.prototype.removeSelected=function(){this.mSelectedElementEffect&&this.mSelectedElementEffect.remove()},EditorRoom.prototype.addPointerMoveHandler=function(){this.mScene.input.on("pointermove",this.onPointerMoveHandler,this)},EditorRoom.prototype.removePointerMoveHandler=function(){this.mScene.input.off("pointermove",this.onPointerMoveHandler,this)},EditorRoom.prototype.addPointerDownHandler=function(){this.mScene.input.on("pointerdown",this.onPointerDownHandler,this)},EditorRoom.prototype.removePointerDownHandler=function(){this.mScene.input.off("pointerdown",this.onPointerDownHandler,this)},EditorRoom.prototype.addPointerUpHandler=function(){this.mScene.input.on("pointerup",this.onPointerUpHandler,this)},EditorRoom.prototype.removePointerUpHandler=function(){this.mScene.input.off("pointerup",this.onPointerUpHandler,this)},EditorRoom.prototype.addGameObjectDownHandler=function(){this.mScene.input.on("gameobjectdown",this.onGameobjectDownHandler,this)},EditorRoom.prototype.removeGameObjectDownHandler=function(){this.mScene.input.off("gameobjectdown",this.onGameobjectDownHandler,this)},EditorRoom.prototype.addKeydownHandler=function(){this.mScene.input.keyboard.on("keydown",this.onKeyDownHandler,this)},EditorRoom.prototype.removeKeydownHandler=function(){this.mScene.input.keyboard.off("keydown",this.onKeyDownHandler,this)},EditorRoom.prototype.onPointerDownHandler=function(){var t=this.mouseFollow.nodeType;this.mouseFollow.key&&(t===h.op_def.NodeType.TerrainNodeType?this.world.elementStorage.getTerrainPalette(this.mouseFollow.key)||this.reqEditorSyncPaletteOrMoss(this.mouseFollow.key,this.mouseFollow.nodeType):t===h.op_def.NodeType.ElementNodeType&&(this.world.elementStorage.getMossPalette(this.mouseFollow.key)||this.reqEditorSyncPaletteOrMoss(this.mouseFollow.key,this.mouseFollow.nodeType))),this.addPointerMoveHandler()},EditorRoom.prototype.onPointerUpHandler=function(t){switch(this.removePointerMoveHandler(),this.brush.mode){case vt.BRUSH:this.createElements();break;case vt.SELECT:if(this.mSelectedElementEffect&&this.mSelectedElementEffect.selecting){if(t.downX!==t.upX&&t.downY!==t.upY)if(this.mSelectedElementEffect.sprite.isMoss)this.editorMossManager.updateMosses([this.mSelectedElementEffect]);else{var e=this.mSelectedElementEffect.display.element.model.toSprite();this.editorElementManager.updateElements([e])}this.mSelectedElementEffect.selecting=!1}break;case vt.ERASER:this.eraserTerrains();break;case vt.MOVE:this.mCameraService.syncCameraScroll()}},EditorRoom.prototype.onPointerMoveHandler=function(t){if(this.mScene.cameras)switch(this.mBrush.mode){case vt.BRUSH:this.mMouseFollow.nodeType===h.op_def.NodeType.TerrainNodeType&&this.createElements();break;case vt.MOVE:this.moveCameras(t);break;case vt.SELECT:this.editorSkyboxManager&&this.editorSkyboxManager.move(t),this.moveElement(t);break;case vt.ERASER:this.eraserTerrains()}},EditorRoom.prototype.moveCameras=function(t){this.cameraService.offsetScroll(t.prevPosition.x-t.position.x,t.prevPosition.y-t.position.y)},EditorRoom.prototype.reqEditorSyncPaletteOrMoss=function(t,e){var i=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_SYNC_PALETTE_MOSS),n=i.content;n.key=t,n.type=e,this.connection.send(i)},EditorRoom.prototype.createElements=function(){if(this.mMouseFollow.sprite)if(this.mMouseFollow.nodeType===h.op_def.NodeType.TerrainNodeType){var t=this.mMouseFollow.createTerrainsOrMossesData();this.editorTerrainManager&&this.editorTerrainManager.addTerrains(t)}else if(this.mMouseFollow.nodeType===h.op_def.NodeType.ElementNodeType){if(!(i=this.mMouseFollow.createSprites()))return;if(!this.editorElementManager)return;if(this.mMouseFollow.isMoss){var e=this.mMouseFollow.createTerrainsOrMossesData();this.editorMossManager.addMosses(e)}else this.editorElementManager.addElements(i)}else if(this.mMouseFollow.nodeType===h.op_def.NodeType.SpawnPointType){var i=this.mMouseFollow.createSprites();this.editorElementManager.addElements(i)}},EditorRoom.prototype.eraserTerrains=function(){var t=this.mMouseFollow.getEaserPosition();this.editorTerrainManager.removeTerrains(t)},EditorRoom.prototype.onSetEditorModeHandler=function(t){var e=t.content;this.mBrush.mode=e.mode,this.mMouseFollow&&this.mMouseFollow.destroy(),this.mBrush.mode!==vt.SELECT&&this.mSelectedElementEffect&&(this.mSelectedElementEffect.destroy(),this.mSelectedElementEffect=null),this.mBrush.mode===vt.SELECT?(this.removeGameObjectDownHandler(),this.addGameObjectDownHandler()):this.removeGameObjectDownHandler(),this.mBrush.mode===vt.ERASER&&(this.mMouseFollow||(this.mMouseFollow=new Et(this.mScene,this)),this.mMouseFollow.showEraserArea()),this.editorSkyboxManager&&this.editorSkyboxManager.removeSelect(),this.layerManager.setSurfaceInteractive(this.mBrush.mode!==vt.ERASER)},EditorRoom.prototype.onAlignGridHandler=function(t){var e=t.content;this.mouseFollow.alignGrid=e.align},EditorRoom.prototype.onVisibleGridHandler=function(t){var e=t.content;this.layerManager.setGridVisible(e.visible)},EditorRoom.prototype.onMouseFollowHandler=function(t){var e=t.content;this.mScene&&this.mouseFollow.setDisplay(e)},EditorRoom.prototype.onFetchSpriteHandler=function(t){for(var e,i=t.content,n=i.ids,o=i.nodeType,a=((e={})[h.op_def.NodeType.SpawnPointType]="elements",e[h.op_def.NodeType.ElementNodeType]="elements",e[h.op_def.NodeType.MossCollectionType]="mosses",e),s=0,l=n;s<l.length;s++){var c=l[s],p=a[o],u=this.displayObjectPool.getPool(p).get(c.toString());u&&this.selectedElement(u.getDisplay())}},EditorRoom.prototype.sendFetch=function(t,e,i){if(this.mSelectedElementEffect&&this.mSelectedElementEffect.display){var n=new s.PBpacket(h.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_FETCH_SPRITE),o=n.content;o.ids=t,o.isMoss=i,o.nodeType=e,this.connection.send(n),l.a.getInstance().log("fetch sprite",o)}},EditorRoom.prototype.onFetchSceneryHandler=function(t){if(this.mSelectedElementEffect&&(this.mSelectedElementEffect.destroy(),this.mSelectedElementEffect=null),this.editorSkyboxManager){var e=t.content;this.editorSkyboxManager.fetch(e.id)}},EditorRoom.prototype.onGameobjectDownHandler=function(t,e){var i=e.parentContainer;if(i){var n=this.selectedElement(i);n&&this.sendFetch([n.element.id],h.op_def.NodeType.ElementNodeType,n.element.model.isMoss)}},EditorRoom.prototype.selectedElement=function(t){if(t instanceof H.a&&!(t instanceof At.a))return this.mSelectedElementEffect||(this.mSelectedElementEffect=new Rt(this.mScene,this.layerManager)),this.mSelectedElementEffect.setElement(t),this.editorSkyboxManager&&this.editorSkyboxManager.removeSelect(),t},EditorRoom.prototype.onKeyDownHandler=function(t){if(this.editorSkyboxManager&&this.editorSkyboxManager.keyboardMove(t.keyCode),this.mSelectedElementEffect)switch(t.keyCode){case 37:case 38:case 39:case 40:case 65:case 87:case 83:case 68:this.keyboardMoveElement(t.keyCode)}},EditorRoom.prototype.keyboardMoveElement=function(t){var e=this.mSelectedElementEffect.display;if(e){var i=new c.a(e.x,e.y,e.z);switch(t){case 37:i.x--;break;case 38:i.y--;break;case 39:i.x++;break;case 40:i.y++}e.setPosition(i.x,i.y,i.z),this.layerManager.depthSurfaceDirty=!0}},EditorRoom.prototype.moveElement=function(t){if(this.mSelectedElementEffect&&this.mSelectedElementEffect.selecting&&this.mouseFollow){var e=this.mMouseFollow.transitionGrid(t.worldX/this.mScaleRatio,t.worldY/this.mScaleRatio);e&&(this.mSelectedElementEffect.setDisplayPos(e.x,e.y),this.mLayManager.depthSurfaceDirty=!0)}},Object.defineProperty(EditorRoom.prototype,"brush",{get:function(){return this.mBrush},enumerable:!1,configurable:!0}),Object.defineProperty(EditorRoom.prototype,"miniSize",{get:function(){return this.mNimiSize},enumerable:!1,configurable:!0}),Object.defineProperty(EditorRoom.prototype,"mouseFollow",{get:function(){return this.mMouseFollow||(this.mMouseFollow=new Et(this.mScene,this)),this.mMouseFollow},enumerable:!1,configurable:!0}),EditorRoom.prototype.removeDisplay=function(t){t.sprite.isMoss?this.editorMossManager.deleteMosses([t.sprite.id]):this.editorElementManager.deleteElements([t.sprite.id]),this.removeSelected()},EditorRoom}(St),Zt=i(326),$t=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),te=function(t){function RoomManager(e){var i=t.call(this)||this;return i.mRooms=[],i.mWorld=e,i.addHandlerFun(h.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ENTER_SCENE,i.onEnterSceneHandler),i.addHandlerFun(h.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_CHANGE_TO_EDITOR_MODE,i.onEnterEditor),i}return $t(RoomManager,t),RoomManager.prototype.addPackListener=function(){this.connection&&this.connection.addPacketListener(this)},RoomManager.prototype.removePackListener=function(){this.connection&&this.connection.removePacketListener(this)},RoomManager.prototype.getRoom=function(t){return this.mRooms.find((function(e){return e.id===t}))},RoomManager.prototype.onFocus=function(){this.mRooms.forEach((function(t){t&&t.scene&&t.resume(t.scene.scene.key)}))},RoomManager.prototype.onBlur=function(){this.mRooms.forEach((function(t){t&&t.scene&&t.pause()}))},RoomManager.prototype.pasuseRoom=function(t){var e=this.mRooms.findIndex((function(e,i){return t===e.id}));e>=0&&this.mRooms[e].pause()},RoomManager.prototype.resumeRoom=function(t){var e=this.mRooms.findIndex((function(e,i){return t===e.id}));if(e>=0){var i=this.mRooms[e];i&&i.scene&&i.resume(i.scene.scene.key)}},RoomManager.prototype.stop=function(){this.mRooms.forEach((function(t){t&&t.scene&&t.destroy()}))},RoomManager.prototype.resize=function(t,e){this.mRooms.forEach((function(i){i&&i.resize(t,e)}))},RoomManager.prototype.destroy=function(){this.removePackListener();for(var t=0,e=this.mRooms;t<e.length;t++){var i=e[t];i.destroy(),i=null}this.mRooms.length=0},RoomManager.prototype.hasRoom=function(t){return this.mRooms.findIndex((function(e,i){return t===e.id}))>=0},RoomManager.prototype.onEnterScene=function(t){var e,i=this,n=t;this.hasRoom(n.scene.id)?((e=this.getRoom(n.scene.id)).addActor(n.actor),e.enter(n.scene),this.mCurRoom=e):(this.mCurRoom&&this.leaveScene(this.mCurRoom),this.world.loadSceneConfig(n.scene.id.toString()).then((function(t){i.world.elementStorage.setSceneConfig(t),e=new St(i),i.mRooms.push(e),e.addActor(n.actor),e.enter(n.scene),i.mCurRoom=e})))},RoomManager.prototype.onEnterDecorate=function(t){this.mCurRoom&&this.leaveScene(this.mCurRoom);var e=new Zt.a(this);e.enter(t.scene);var i=t.actor;i&&e.setEnterPos(i.x,i.y),this.mRooms.push(e),this.mCurRoom=e},RoomManager.prototype.onEditRoom=function(t){var e=t.content;l.a.getInstance().log("edit: ",e)},RoomManager.prototype.onEnterEditor=function(t){var e=t.content,i=new Jt(this);i.enter(e.scene),this.mCurRoom=i,this.mRooms.push(i)},RoomManager.prototype.leaveScene=function(t){t&&(this.mRooms=this.mRooms.filter((function(e){return e.id!==t.id})),t.destroy())},RoomManager.prototype.onEnterSceneHandler=function(t){var e=t.content;switch(e.scene.sceneType){case h.op_def.SceneTypeEnum.NORMAL_SCENE_TYPE:this.onEnterScene(e);break;case h.op_def.SceneTypeEnum.EDIT_SCENE_TYPE:this.onEnterDecorate(e)}},Object.defineProperty(RoomManager.prototype,"world",{get:function(){return this.mWorld},enumerable:!1,configurable:!0}),Object.defineProperty(RoomManager.prototype,"currentRoom",{get:function(){return this.mCurRoom},enumerable:!1,configurable:!0}),Object.defineProperty(RoomManager.prototype,"connection",{get:function(){if(this.mWorld)return this.mWorld.connection;l.a.getInstance().error("world manager is undefined")},enumerable:!1,configurable:!0}),RoomManager}(s.PacketHandler)},function(t,e,i){"use strict";class ObjectFactory{constructor(t){this.scene=t}static register(t,e){ObjectFactory.prototype[t]=e}}var n=ObjectFactory,o=i(193),a=i(11);n.register("roundRectangle",(function(t,e,i,n,a,s,h){var l=new o.a(this.scene,t,e,i,n,a,s,h);return this.scene.add.existing(l),l})),Object(a.a)(window,"RexPlugins.UI.RoundRectangle",o.a);o.a;var s=i(194);n.register("BBCodeText",(function(t,e,i,n){var o=new s.a(this.scene,t,e,i,n);return this.scene.add.existing(o),o})),Object(a.a)(window,"RexPlugins.UI.BBCodeText",s.a);s.a;var h=i(250);n.register("tagText",(function(t,e,i,n){var o=new h.a(this.scene,t,e,i,n);return this.scene.add.existing(o),o})),Object(a.a)(window,"RexPlugins.UI.TagText",h.a);h.a;var l=i(83);n.register("container",(function(t,e,i,n,o){var a=new l.a(this.scene,t,e,i,n,o);return this.scene.add.existing(a),a})),Object(a.a)(window,"RexPlugins.UI.Container",l.a);l.a;var c=i(195);n.register("canvas",(function(t,e,i,n){var o=new c.a(this.scene,t,e,i,n);return this.scene.add.existing(o),o})),Object(a.a)(window,"RexPlugins.UI.Canvas",c.a);c.a;var p=i(325),ApplyCircleMask=function(t,e){t.width===t.height&&(e=0);var i=Math.floor(t.width/2),n=Math.floor(t.height/2),o=t.getContext("2d");o.save(),o.globalCompositeOperation="destination-in",o.beginPath(),0===e?o.arc(i,n,Math.min(i,n),0,2*Math.PI):o.ellipse(i,n,i,n,0,0,2*Math.PI),o.fill(),o.restore()};const u=Phaser.Utils.Objects.GetValue;class CircleMaskImage_CircleMaskImage extends p.a{constructor(t,e,i,n,o,a){super(t,e,i),this.type="rexCircleMaskImage";var s=u(a,"maskType",0);this.setTexture(n,o,s)}setTexture(t,e,i){return void 0===i?i=0:"string"==typeof i&&(i=m[i]),this._textureKey=t,this._frameName=e,this.loadTexture(t,e),null!==i&&ApplyCircleMask(this.canvas,i),this.dirty=!0,this}}const m={circle:0,ellipse:1};var d=CircleMaskImage_CircleMaskImage;n.register("circleMaskImage",(function(t,e,i,n,o){var a=new d(this.scene,t,e,i,n,o);return this.scene.add.existing(a),a})),Object(a.a)(window,"RexPlugins.UI.CircleMaskImage",d);var f=i(44).a;n.register("ninePatch",(function(t,e,i,n,o,a,s,h){var l=new f(this.scene,t,e,i,n,o,a,s,h);return this.scene.add.existing(l),l})),Object(a.a)(window,"RexPlugins.UI.NinePatch",f);var y=i(32);n.register("sizer",(function(t,e,i,n,o,a){var s=new y.a(this.scene,t,e,i,n,o,a);return this.scene.add.existing(s),s})),Object(a.a)(window,"RexPlugins.UI.Sizer",y.a);y.a;var g=i(243);n.register("gridSizer",(function(t,e,i,n,o,a,s,h){var l=new g.a(this.scene,t,e,i,n,o,a,s,h);return this.scene.add.existing(l),l})),Object(a.a)(window,"RexPlugins.UI.GridSizer",g.a);g.a;var _=i(254);n.register("label",(function(t){var e=new _.a(this.scene,t);return this.scene.add.existing(e),e})),Object(a.a)(window,"RexPlugins.UI.Label",_.a);_.a;var v=i(109);n.register("buttons",(function(t){var e=new v.a(this.scene,t);return this.scene.add.existing(e),e})),Object(a.a)(window,"RexPlugins.UI.Buttons",v.a);v.a;var b=i(108);n.register("slider",(function(t){var e=new b.a(this.scene,t);return this.scene.add.existing(e),e})),Object(a.a)(window,"RexPlugins.UI.Slider",b.a);b.a;var P=i(105);n.register("gridTable",(function(t){var e=new P.a(this.scene,t);return this.scene.add.existing(e),e})),Object(a.a)(window,"RexPlugins.UI.GridTable",P.a);P.a;var S=i(244);n.register("menu",(function(t){var e=new S.a(this.scene,t);return this.scene.add.existing(e),e})),Object(a.a)(window,"RexPlugins.UI.Menu",S.a);S.a;var w=i(107);n.register("textBlock",(function(t,e,i,n,o,a){var s=new w.a(this.scene,t,e,i,n,o,a);return this.scene.add.existing(s),s})),Object(a.a)(window,"RexPlugins.UI.TextBlock",w.a);w.a;var T=i(33);n.register("textArea",(function(t){var e=new T.a(this.scene,t);return this.scene.add.existing(e),e})),Object(a.a)(window,"RexPlugins.UI.TextArea",T.a);T.a;var C=i(110);n.register("scrollableBlock",(function(t){var e=new C.a(this.scene,t);return this.scene.add.existing(e),e})),Object(a.a)(window,"RexPlugins.UI.ScrollableBlock",C.a);C.a;var D=i(196);n.register("scrollablePanel",(function(t){var e=new D.a(this.scene,t);return this.scene.add.existing(e),e})),Object(a.a)(window,"RexPlugins.UI.ScrollablePanel",D.a);D.a;var M=i(113),O=i(66);n.register("tap",(function(t,e){return Object(O.a)(t)||(e=t,t=this.scene),new M.a(t,e)})),Object(a.a)(window,"RexPlugins.UI.Tap",M.a);M.a;var x=i(114);n.register("press",(function(t,e){return Object(O.a)(t)||(e=t,t=this.scene),new x.a(t,e)})),Object(a.a)(window,"RexPlugins.UI.Press",x.a);x.a;var E=i(327);n.register("swipe",(function(t,e){return Object(O.a)(t)||(e=t,t=this.scene),new E.a(t,e)})),Object(a.a)(window,"RexPlugins.UI.Swipe",E.a);E.a;var B=i(115),I=i(45);const A=Phaser.Utils.Objects.GetValue;class Pan_Pan extends B.a{constructor(t,e){super(t,e);var i=this,n={states:{IDLE:{},BEGIN:{enter:function(){var t=i.pointer;i.startX=t.x,i.startY=t.y,i.startWorldX=t.worldX,i.startWorldY=t.worldY}},RECOGNIZED:{enter:function(){i.emit("panstart",i,i.gameObject,i.lastPointer)},exit:function(){var t=i.lastPointer;i.endX=t.x,i.endY=t.y,i.endWorldX=t.worldX,i.endWorldY=t.worldY,i.emit("panend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=R},eventEmitter:!1};this.setRecongizedStateObject(new I.a(n))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(A(t,"threshold",10)),this}onDragStart(){this.state=0===this.dragThreshold?L:k}onDragEnd(){this.state=R}onDrag(){switch(this.state){case k:this.pointer.getDistance()>=this.dragThreshold&&(this.state=L);break;case L:var t=this.pointer.position,e=this.pointer.prevPosition;this.dx=t.x-e.x,this.dy=t.y-e.y;var i=this.pointer;self.x=i.x,self.y=i.y,self.worldX=i.worldX,self.worldY=i.worldY,this.emit("pan",this)}}get isPan(){return this.state===L}setDragThreshold(t){return this.dragThreshold=t,this}}const R="IDLE",k="BEGIN",L="RECOGNIZED";var F=Pan_Pan;n.register("pan",(function(t,e){return Object(O.a)(t)||(e=t,t=this.scene),new F(t,e)})),Object(a.a)(window,"RexPlugins.UI.Pan",F);var N=i(291);const j=Phaser.Utils.Objects.GetValue;class Pinch_Pinch extends N.a{constructor(t,e){super(t,e);var i=this,n={states:{IDLE:{enter:function(){i.prevDistance=void 0,i.scaleFactor=1}},BEGIN:{},RECOGNIZED:{enter:function(){i.emit("pinchstart",i)},exit:function(){i.emit("pinchend",i)}}},init:function(){this.state=H},eventEmitter:!1};this.setRecongizedStateObject(new I.a(n))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(j(t,"threshold",0)),this}onDrag2Start(){this.scaleFactor=1,this.prevDistance=this.distanceBetween,this.state=0===this.dragThreshold?G:U}onDrag2End(){this.state=H}onDrag2(){switch(this.state){case U:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.prevDistance=t,this.state=G}break;case G:t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.emit("pinch",this),this.prevDistance=t}}get isPinch(){return this.state===G}setDragThreshold(t){return this.dragThreshold=t,this}}const H="IDLE",U="BEGIN",G="RECOGNIZED";var V=Pinch_Pinch;n.register("pinch",(function(t){return new V(this.scene,t)})),Object(a.a)(window,"RexPlugins.UI.Pinch",V);var W=i(247);n.register("rotate",(function(t){return new W.a(this.scene,t)})),Object(a.a)(window,"RexPlugins.UI.Rotate",W.a);W.a;var z=i(248);n.register("flip",(function(t,e){return new z.a(t,e)})),Object(a.a)(window,"RexPlugins.UI.Flip",z.a);z.a;var Y=i(68),X=i(85),K=i(84),q=i(54),Q=i(197),J=i(102);class ui_plugin_UIPlugin extends Phaser.Plugins.ScenePlugin{constructor(t,e){super(t,e),this.add=new n(t)}}var Z={getParentSizer:Y.a,getTopmostSizer:X.a,hide:q.a,show:q.c,isShown:q.b,edit:Q.a,isInTouching:K.a,waitEvent:J.b,waitComplete:J.a};Object.assign(ui_plugin_UIPlugin.prototype,Z);e.a=ui_plugin_UIPlugin},,function(t,e,i){"use strict";i.d(e,"a",(function(){return w}));var n,o=i(4),a=i(58),s=i(35),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function CreateRoleScene(){return t.call(this,{key:CreateRoleScene.name})||this}return h(CreateRoleScene,t),CreateRoleScene.prototype.init=function(t){t.role&&(this.role=t.role)},CreateRoleScene.prototype.create=function(){this.role&&(this.game.scene.stop(a.a.name),this.role.start(this))},CreateRoleScene}(s.a),c=i(6),p=i(19),u=i(23),m=i(12),d=i(111),f=i(79),y=i(9),g=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),_=function(t){function CreateRolePanel(e,i){var n=t.call(this,e,i)||this;return n.key="createCharacter",n.mCurPageNum=0,n.setTween(!1),n.scene.add.container(0,0).add(n),e.scale.on("resize",n.onResize,n),n}return g(CreateRolePanel,t),CreateRolePanel.prototype.show=function(e){e&&(this.avatars=e.avatars),t.prototype.show.call(this,e)},CreateRolePanel.prototype.preload=function(){this.addAtlas(this.key,"create_role/create_role.png","create_role/create_role.json"),t.prototype.preload.call(this)},CreateRolePanel.prototype.resize=function(t,e){var i=this.mWorld.getSize();if(this.setSize(i.width,i.height),this.mBackground){var n=this.scale,o=this.scene.cameras.main.width/n,a=this.scene.cameras.main.height/n,s=this.scene.cameras.main.centerX/n;this.mBackground.x=s,this.mFoot.x=s,this.mFoot.y=a-(this.mFoot.height>>1),this.mBackgroundColor.clear(),this.mBackgroundColor.fillGradientStyle(7304703,7304703,314367,314367),this.mBackgroundColor.fillRect(0,0,o,a),this.mSubmit.x=s,this.inputText.x=s,this.mInputTextBg.x=s,this.dragonbones.x=s,this.mNextPageBtn.x=o-150,this.mRandomBtn.x=this.mInputTextBg.x+this.mInputTextBg.width/2-26*this.dpr}},CreateRolePanel.prototype.init=function(){var e=this.mWorld.getSize();this.mBackground=this.scene.make.image({key:this.key,frame:"bg.png",x:e.width>>1}),this.mBackground.y=this.mBackground.height/2+92*this.dpr,this.add(this.mBackground),this.mFoot=this.scene.make.image({key:this.key,frame:"bg_foot.png"},!1),this.add(this.mFoot),this.mBackgroundColor=this.scene.make.graphics(void 0,!1),this.mBackgroundColor.fillGradientStyle(7304703,7304703,314367,314367),this.mBackgroundColor.fillRect(0,0,e.width,e.height),this.addAt(this.mBackgroundColor,0),this.mInputTextBg=new m.NinePatch(this.scene,e.width>>1,350*this.dpr,255*this.dpr,50*this.dpr,this.key,"input_bg.png",{left:27*this.dpr,top:24*this.dpr,right:28*this.dpr,bottom:24*this.dpr}),this.add(this.mInputTextBg),this.inputText=new u.a(this.scene,e.width>>1,350*this.dpr,160*this.dpr,80,{type:"input",fontSize:18*this.dpr+"px",color:"#717171",align:"center",placeholder:"请输入昵称"}).setOrigin(.5),this.add(this.inputText);var i="提 交";this.mShowData&&this.mShowData.button&&(i=this.mShowData.button.text);var n=this.scene.textures.getFrame(this.key,"submit_button_normal"),o=42,a=43;n&&(o=n.width,a=n.height),this.mSubmit=new p.NinePatchButton(this.scene,e.width>>1,445*this.dpr,202*this.dpr,55*this.dpr,this.key,"submit_button",i,{left:19*this.dpr,top:20*this.dpr,right:o-2-19*this.dpr,bottom:a-2-20*this.dpr}),this.mSubmit.setTextStyle({color:"#976400",fontSize:18*this.dpr,fontFamily:y.a.DEFULT_FONT}),this.mSubmit.setFontStyle("bold"),this.mSubmit.on("pointerup",this.onSubmitHandler,this),this.add(this.mSubmit),this.mPrePageBtn=this.scene.make.image({x:60*this.dpr,y:216*this.dpr,key:this.key,frame:"arrow_left.png"}).setInteractive(),this.mPrePageBtn.on("pointerup",this.onPrePageHandler,this),this.mNextPageBtn=this.scene.make.image({x:e.width-60*this.dpr,y:this.mPrePageBtn.y,key:this.key,frame:"arrow.png"}).setFlipX(!0).setInteractive(),this.mNextPageBtn.on("pointerup",this.onNextPageHandler,this),this.mRandomBtn=this.scene.make.image({x:this.mInputTextBg.x,y:this.mInputTextBg.y,key:this.key,frame:"random.png"}).setInteractive(),this.add([this.mPrePageBtn,this.mNextPageBtn,this.mRandomBtn]),this.mRandomBtn.on("pointerup",this.onRandomNameHandler,this),this.mErrorBg=this.scene.make.image({key:this.key,frame:"tips_bg.png",x:220*this.dpr,y:57*this.dpr}).setVisible(!1),this.mError=this.scene.make.text({x:127*this.dpr,y:30*this.dpr,style:{color:"#26265d",font:"bold 34px YaHei",wordWrap:{width:420,useAdvancedWrap:!0}}},!1).setVisible(!1),this.add([this.mErrorBg,this.mError]),this.dragonbones=new d.a(this.scene,void 0,void 0,!0),this.dragonbones.scale=3*this.dpr,this.dragonbones.x=e.width>>1,this.dragonbones.y=this.mNextPageBtn.y+70*this.dpr,this.dragonbones.on("initialized",this.loadDragonbonesComplete,this),this.add(this.dragonbones),this.setPageNum(0),t.prototype.init.call(this),this.resize(0,0)},CreateRolePanel.prototype.setAvatars=function(t){this.avatars=t},CreateRolePanel.prototype.showError=function(t){this.mError&&(this.mError.text=t,this.mError.setVisible(!0),this.mErrorBg.setVisible(!0))},CreateRolePanel.prototype.setNickName=function(t){this.inputText&&(this.inputText.text=t)},CreateRolePanel.prototype.destroy=function(){this.scene&&this.scene.scale.off("resize",this.onResize,this),this.dragonbones&&this.dragonbones.off("initialized",this.loadDragonbonesComplete,this),t.prototype.destroy.call(this)},CreateRolePanel.prototype.onRandomNameHandler=function(){this.emit("randomName"),this.inputText.setBlur()},CreateRolePanel.prototype.onSubmitHandler=function(){this.emit("submit",this.inputText.text,this.avatars[this.mCurPageNum]),this.inputText.setBlur(),this.mError&&(this.mError.setVisible(!1),this.mErrorBg.setVisible(!1))},CreateRolePanel.prototype.onPrePageHandler=function(){this.setPageNum(this.mCurPageNum-1),this.inputText.setBlur()},CreateRolePanel.prototype.onNextPageHandler=function(){this.setPageNum(this.mCurPageNum+1),this.inputText.setBlur()},CreateRolePanel.prototype.setPageNum=function(t){this.mCurPageNum=t,this.mCurPageNum<0?this.mCurPageNum=this.avatars.length-1:this.mCurPageNum>=this.avatars.length&&(this.mCurPageNum=0),this.dragonbones.load(new f.a({id:0,avatar:this.avatars[this.mCurPageNum]}))},CreateRolePanel.prototype.onResize=function(t){this.resize(t.width,t.height)},CreateRolePanel.prototype.loadDragonbonesComplete=function(){this.dragonbones.play({animationName:"idle",flip:!1})},CreateRolePanel}(c.BasePanel),v=i(3),b=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),P=function(t){function CreateRole(e){var i=t.call(this)||this;return i.roleManager=e,i.world=i.roleManager.world,i}return b(CreateRole,t),CreateRole.prototype.enter=function(t){this.mAvatars=t.avatars,this.mParam=t,this.world.game.scene.getScene(l.name)||this.world.game.scene.add(l.name,l),this.world.game.scene.start(l.name,{world:this.world,role:this})},CreateRole.prototype.start=function(t){this.createPanel=new _(t,this.world),this.createPanel.show(this.mParam),this.createPanel.on("randomName",this.onRandomNameHandler,this),this.createPanel.on("submit",this.onSubmitHandler,this),this.world.connection&&(this.world.connection.addPacketListener(this),this.addHandlerFun(v.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CREATE_ROLE_ERROR_MESSAGE,this.onCreateErrorHandler),this.addHandlerFun(v.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CREATE_ROLE_GENERATE_NEW_NAME,this.onGenerateNameHandler))},CreateRole.prototype.destroy=function(){this.world.connection&&this.world.connection.removePacketListener(this),this.world.game.scene.remove(l.name)},CreateRole.prototype.onRandomNameHandler=function(){var t=this.world.connection,e=new o.PBpacket(v.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_CREATE_ROLE_GENERATE_NEW_NAME);t.send(e)},CreateRole.prototype.onSubmitHandler=function(t,e){var i=this.world.connection,n=new o.PBpacket(v.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_CREATE_ROLE),a=n.content;a.name=t,a.avatar=e,i.send(n)},CreateRole.prototype.onCreateErrorHandler=function(t){if(this.createPanel){var e=t.content;this.createPanel.showError(e.errorMsg)}},CreateRole.prototype.onGenerateNameHandler=function(t){if(this.createPanel){var e=t.content;this.createPanel.setNickName(e.name)}},CreateRole}(o.PacketHandler),S=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),w=function(t){function RoleManager(e){var i=t.call(this)||this;return i.world=e,i}return S(RoleManager,t),RoleManager.prototype.register=function(){if(this.world){var t=this.world.connection;t&&(t.addPacketListener(this),this.addHandlerFun(v.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_SHOW_CREATE_ROLE_UI,this.onOpenCreateCharacter),this.addHandlerFun(v.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_CLOSE_CREATE_ROLE_UI,this.onCloseCreateCharacterHandler))}},RoleManager.prototype.unregister=function(){if(this.world){var t=this.world.connection;t&&t.removePacketListener(this)}},RoleManager.prototype.onOpenCreateCharacter=function(t){this.mCreateCharacter=new P(this),this.mCreateCharacter.enter(t.content)},RoleManager.prototype.onCloseCreateCharacterHandler=function(){this.mCreateCharacter&&(this.mCreateCharacter.destroy(),this.mCreateCharacter=void 0)},RoleManager}(o.PacketHandler)},function(t,e,i){"use strict";var n=i(44),Factory=function(t,e,i,o,a,s,h,l,c){var p=new n.a(this.scene,t,e,i,o,a,s,h,l,c);return this.scene.add.existing(p),p};const o=Phaser.GameObjects.BuildGameObject;var Creator=function(t,e){void 0!==e&&(t.add=e);var i=new n.a(this.scene,t);return o(this.scene,i,t),i},a=i(11);class ninepatch_plugin_NinePatchPlugin extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexNinePatch",Factory,Creator)}start(){this.game.events.on("destroy",this.destroy,this)}}Object(a.a)(window,"RexPlugins.GameObjects.NinePatch",n.a);e.a=ninepatch_plugin_NinePatchPlugin},function(t,e,i){"use strict";var n=i(23),Factory=function(t,e,i,o,a){var s=new n.a(this.scene,t,e,i,o,a);return this.scene.add.existing(s),s};const o=Phaser.Utils.Objects.GetAdvancedValue,a=Phaser.GameObjects.BuildGameObject;var Creator=function(t,e){var i=o(t,"width",void 0),s=o(t,"height",void 0);void 0!==e&&(t.add=e);var h=new n.a(this.scene,0,0,i,s,t);return a(this.scene,h,t),h},s=i(11);class inputtext_plugin_InputTextPlugin extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexInputText",Factory,Creator)}start(){this.game.events.on("destroy",this.destroy,this)}}Object(s.a)(window,"RexPlugins.GameObjects.InputText",n.a);e.a=inputtext_plugin_InputTextPlugin},function(t,e,i){"use strict";var n=i(181).a;class button_plugin_ButtonPlugin extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.on("destroy",this.destroy,this)}add(t,e){return new n(t,e)}}e.a=button_plugin_ButtonPlugin},function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var n,o=i(23),a=i(239),s=i(8),h=i(117),l=i(35),c=i(29),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),u=function(t){function SelectCallItem(e,i,n,o,a){var s=t.call(this,e)||this;s.mSelect=!1,s.mSelectCallUI=i,s.soundGroup=a,s.mText=s.scene.make.text({x:-n>>1,y:-o>>1,style:{fill:"#F7EDED",fontSize:18}},!1);return s.mSelectBG=e.make.graphics(void 0,!1),s.mSelectBG.fillStyle(16763904,.8),s.mSelectBG.fillRect(-n>>1,-o>>1,n,o),s.mSelectBG.visible=!1,s.add([s.mSelectBG,s.mText]),s.width=n,s.height=o,s.setSize(n,o),s.setInteractive(),s}return p(SelectCallItem,t),SelectCallItem.prototype.setInteractive=function(){return t.prototype.setInteractive.call(this,new Phaser.Geom.Rectangle(0,0,this.width,this.height),Phaser.Geom.Rectangle.Contains),this},SelectCallItem.prototype.addListen=function(){this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this),this.on("pointerdown",this.selectHandler,this)},SelectCallItem.prototype.removeListen=function(){this.off("pointerover",this.overHandler,this),this.off("pointerout",this.outHandler,this),this.off("pointerdown",this.selectHandler,this)},Object.defineProperty(SelectCallItem.prototype,"itemData",{get:function(){return this.mItemData},set:function(t){this.mItemData=t,this.mText.text=this.mItemData.text,this.mText.x=-this.width/2+(this.width-this.mText.width>>1),this.mText.y=-this.height/2+(this.height-this.mText.height>>1)},enumerable:!1,configurable:!0}),SelectCallItem.prototype.destroy=function(){this.mInitialized&&(this.mText.destroy(!0),this.mSelectBG.destroy(!0),this.mItemData=null,this.mText=null,this.mSelectBG=null,this.mSelectCallUI=null,t.prototype.destroy.call(this))},Object.defineProperty(SelectCallItem.prototype,"selected",{get:function(){return this.mSelect},set:function(t){this.mSelectBG.visible=t,this.mSelect=t},enumerable:!1,configurable:!0}),Object.defineProperty(SelectCallItem.prototype,"interactive",{get:function(){return this.interactiveBoo},enumerable:!1,configurable:!0}),SelectCallItem.prototype.overHandler=function(){this.interactiveBoo&&(this.mSelectBG.visible=!0)},SelectCallItem.prototype.selectHandler=function(){this.interactiveBoo?(this.soundGroup&&this.soundGroup.down&&this.mSelectCallUI.playSound(this.soundGroup.down),this.overHandler(),this.mSelectCallUI.selectCall(this.mItemData)):this.soundGroup&&this.soundGroup.disabled&&this.mSelectCallUI.playSound(this.soundGroup.disabled)},SelectCallItem.prototype.outHandler=function(){this.interactiveBoo&&(this.mSelectBG.visible=!1)},SelectCallItem}(c.a),m=function(t){function ComboBox(e,i){var n=t.call(this,e)||this;return n.mIsopen=!1,n.mInitialize=!1,n.mConfig=i,n.soundGroup=i.boxMusic,n.init(),n}return p(ComboBox,t),ComboBox.prototype.selectCall=function(t){this.mtxt.text=t.text,this.mtxt.x=this.mConfig.wid-this.mtxt.width>>1,this.mtxt.y=this.mConfig.hei-this.mtxt.height>>1,this.showTween(!1),this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)},ComboBox.prototype.addListen=function(){t.prototype.addListen.call(this),this.on("uiClick",this.openHandler,this)},ComboBox.prototype.removeListen=function(){t.prototype.removeListen.call(this),this.off("uiClick",this.openHandler,this)},Object.defineProperty(ComboBox.prototype,"text",{set:function(t){if(this.mInitialize){if(this.itemList){for(var e=this.itemList.length,i=0;i<e;i++){(o=this.itemList[i])&&(o.destroy(),o=null)}this.itemList.length=0}this.itemList=[];var n=t.length;for(i=0;i<n;i++){var o=new u(this.scene,this,this.mConfig.wid,this.mConfig.hei,this.mConfig.itemMusic),a=t[i];o.itemData={index:i,text:a,data:{},selected:!1,enabled:!0},this.itemList.push(o)}this.selectCall(this.itemList[0].itemData)}else this.mSelectData=this.itemList[0].itemData},enumerable:!1,configurable:!0}),ComboBox.prototype.destroy=function(){if(this.itemList){for(var e=this.itemList.length,i=0;i<e;i++){var n=this.itemList[i];n&&n.destroy()}this.itemList.length=0,this.itemList=null}t.prototype.destroy.call(this)},ComboBox.prototype.init=function(){var t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mInitialize=!1,this.scene.textures.exists(t)?this.onLoadCompleteHandler():(this.scene.load.atlas(t,e,i),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.scene.load.start())},ComboBox.prototype.onLoadCompleteHandler=function(){var t=this.mConfig.resKey;this.mBg=this.scene.make.image(void 0,!1),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2,this.mBg.y=this.mConfig.hei/2,this.mBg.setSize(this.mConfig.wid,this.mConfig.hei),this.mArrow=this.scene.make.image(void 0,!1),this.mArrow.setTexture(t,this.mConfig.resArrow),this.mArrow.scaleY=this.mConfig.up?-1:1,this.mArrow.x=this.mConfig.wid-this.mArrow.width,this.mArrow.y=4+(this.mConfig.hei-this.mArrow.height>>1),this.mtxt=this.scene.make.text({x:0,y:0,style:{fill:"#F7EDED",fontSize:18}},!1),this.add([this.mBg,this.mArrow,this.mtxt]),this.mInitialize=!0,this.mSelectData&&this.selectCall(this.mSelectData)},ComboBox.prototype.openHandler=function(){this.interactiveBoo?(this.soundGroup&&this.soundGroup.expand&&this.playSound(this.soundGroup.expand),!this.itemList||this.itemList.length<1||this.showTween(this.mIsopen)):this.soundGroup&&this.soundGroup.disabled&&this.playSound(this.soundGroup.disabled)},ComboBox.prototype.showTween=function(t){t?(this.mItemBG=this.createTexture(),this.addAt(this.mItemBG,0)):this.mItemBG&&(this.mItemBG.parentContainer&&this.mItemBG.parentContainer.remove(this.mItemBG),this.mItemBG.destroy()),this.mArrow.scaleY=t?1:-1,this.showTweenItem(t),this.mIsopen=!this.mIsopen},ComboBox.prototype.showTweenItem=function(t){for(var e=this,i=this.itemList.length,_loop_1=function(i){var o=n.itemList[i];if(!o)return"continue";o.x=n.mConfig.wid>>1,n.add(o),n.scene.tweens.add({targets:o,duration:50*i,props:{y:{value:t?-n.mConfig.hei*i-n.mConfig.hei/2:-n.mConfig.hei>>1},alpha:{value:t?1:0}},onComplete:function(i,n,a){t||e.remove(o)},onCompleteParams:[n]})},n=this,o=0;o<i;o++)_loop_1(o)},ComboBox.prototype.createTexture=function(){var t=this.mConfig.hei*this.itemList.length,e=this.scene.make.graphics(void 0,!1);return e.fillStyle(4012088,.8),e.fillRect(0,-t,this.mConfig.wid,t),e},ComboBox}(c.a),d=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),f=function(t){function LoginScene(){var e=t.call(this,{key:LoginScene.name})||this;return e.mCurTabIndex=0,e.mHei=0,e}return d(LoginScene,t),LoginScene.prototype.preload=function(){this.load.atlas("login","./resources/ui/login/login.png","./resources/ui/login/login.json")},LoginScene.prototype.create=function(){var t=this.scale.gameSize.width,e=this.scale.gameSize.height;this.rect=this.add.graphics(),this.rect.fillStyle(0),this.rect.fillRect(0,0,t,e);var i=localStorage.getItem("account"),n=this.make.image(void 0,!1);n.setTexture("login","login_logo"),this.mHei+=n.height,this.mParentCon=this.add.container(t>>1,100+(e>>1)),this.mBg=this.make.image(void 0,!1),this.mHei+=this.mBg.height+10,this.mEnterBtn=this.make.image(void 0,!1),this.mEnterBtn.setTexture("login","login_loginBtn"),this.mEnterBtn.x=123,this.mQuickBtn=this.make.image(void 0,!1),this.mQuickBtn.setTexture("login","login_quickBtn"),this.mQuickBtn.x=123,this.mQuickBtn.y=-38,this.mSendCodeBtn=this.make.image(void 0,!1),this.mSendCodeBtn.setTexture("login","login_sendBtn"),this.mSendCodeBtn.x=10,this.mSendCodeBtn.y=67,this.mTab0=this.make.image(void 0,!1),this.mTab0.setTexture("login","login_tabSelect"),this.mTab0.x=-105,this.mTab0.y=-38,this.mTab1=this.make.image(void 0,!1),this.mTab1.setTexture("login","login_tabUnSelect"),this.mTab1.x=7,this.mTab1.y=-38,this.mInputBg_long0=this.make.image(void 0,!1),this.mInputBg_long0.setTexture("login","login_inputLong"),this.mInputBg_long0.x=-50,this.mInputBg_long0.y=15,this.mInputBg_long1=this.make.image(void 0,!1),this.mInputBg_long1.setTexture("login","login_inputLong"),this.mInputBg_long1.x=-50,this.mInputBg_long1.y=67,this.mInputBg_small=this.make.image(void 0,!1),this.mInputBg_small.setTexture("login","login_inputBg"),this.mInputBg_small.x=-105,this.mInputBg_small.y=67,this.mSizeTF=this.add.text(10,50,"",{style:{color:"#000000"},wordWrap:{width:800,useAdvancedWrap:!0}}),this.mSizeTF.setFontSize(20),this.mTabDic=new Map,this.mNameInputTxt=new o.a(this,0,0,190,15,{type:"input",placeholder:"用戶名",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(200,20).setOrigin(0,0),this.mPassWordInputTxt=new o.a(this,0,0,190,15,{type:"password",placeholder:"密码",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(200,20).setOrigin(0,0),this.mVerificationCodeTxt=new o.a(this,0,0,100,15,{type:"input",placeholder:"验证码",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(100,20).setOrigin(0,0),this.mNameInputTxt.x=-140,this.mNameInputTxt.y=4,this.mPassWordInputTxt.x=-140,this.mPassWordInputTxt.y=55,this.mVerificationCodeTxt.x=-140,this.mVerificationCodeTxt.y=55,this.mtxt0=this.make.text(void 0,!1),this.mtxt1=this.make.text(void 0,!1),this.mtxt2=this.make.text(void 0,!1),this.mtxt3=this.make.text(void 0,!1),this.mtxt4=this.make.text(void 0,!1),this.mtxt5=this.make.text(void 0,!1),this.mtxt0.x=-145,this.mtxt0.y=-46,this.mtxt1.x=-35,this.mtxt1.y=-46,this.mtxt2.x=90,this.mtxt2.y=-46,this.mtxt3.x=108,this.mtxt3.y=33,this.mtxt4.x=-97,this.mtxt4.y=37,this.mtxt5.x=-6,this.mtxt5.y=57,this.mtxt0.setFontFamily("YaHei"),this.mtxt0.setText("手机号登录"),this.mtxt1.setFontFamily("YaHei"),this.mtxt1.setText("用户号登录"),this.mtxt2.setFontFamily("YaHei"),this.mtxt2.setText("快速游戏"),this.mtxt3.setFontFamily("YaHei"),this.mtxt3.setText("登录"),this.mtxt4.setFontFamily("YaHei"),this.mtxt4.setText("登录其他账号"),this.mtxt5.setFontFamily("YaHei"),this.mtxt5.setText("发送");var a={wid:220,hei:36,resKey:"login",resPng:"./resources/ui/login/login.png",resJson:"./resources/ui/login/login.json",resBg:"login_inputLong",resArrow:"login_downArrow",fontStyle:{size:20,color:"#ffcc00",bold:!1},up:!0,clickCallBack:this.changeID};this.combobox=new m(this,a),this.combobox.x=-158,this.combobox.y=-28,n.x=-25,n.y=-n.height/2,this.changePanelState(i),this.mParentCon.add(n),this.mParentCon.add(this.mBg),this.mParentCon.add(this.mTab0),this.mParentCon.add(this.mTab1),this.mParentCon.add(this.mQuickBtn),this.mParentCon.add(this.mEnterBtn),this.mParentCon.add(this.mSendCodeBtn),this.mParentCon.add(this.mInputBg_long0),this.mParentCon.add(this.mInputBg_long1),this.mParentCon.add(this.mInputBg_small),this.mParentCon.add(this.mNameInputTxt),this.mParentCon.add(this.mPassWordInputTxt),this.mParentCon.add(this.mVerificationCodeTxt),this.mParentCon.add(this.mtxt0),this.mParentCon.add(this.mtxt1),this.mParentCon.add(this.mtxt2),this.mParentCon.add(this.mtxt3),this.mParentCon.add(this.mtxt4),this.mParentCon.add(this.mtxt5),this.mParentCon.add(this.combobox),this.mTab0.setInteractive(),this.mTab1.setInteractive(),this.mQuickBtn.setInteractive(),this.mEnterBtn.setInteractive(),this.mSendCodeBtn.setInteractive(),this.mtxt4.setInteractive(),this.mTab0.tabIndex=0,this.mTab1.tabIndex=1,this.mTabDic.set(this.mTab0.tabIndex,this.mTab0),this.mTabDic.set(this.mTab1.tabIndex,this.mTab1),this.mCurTabIndex=0,this.mTab0.on("pointerdown",this.tab0Handler,this),this.mTab1.on("pointerdown",this.tab1Handler,this),this.mQuickBtn.on("pointerdown",this.quickHandler,this),this.mEnterBtn.on("pointerdown",this.enterHandler,this),this.mSendCodeBtn.on("pointerdown",this.sendCodeHandler,this),this.mtxt4.on("pointerdown",this.changeAccount,this),this.scale.on("resize",this.checkSize,this),this.scale.on("orientationchange",this.onOrientationChange,this),this.checkSize(new h.a(t,e))},LoginScene.prototype.init=function(t){this.mConnect=t.connect,this.mCallBack=t.callBack,this.mWorld=t.world},LoginScene.prototype.update=function(){var t=this.mWorld.getSize().width>this.mWorld.getSize().height?"LANDSCAPE":"PORTRAIT";this.mSizeTF.text="width:"+this.mWorld.getSize().width+"\nheight:"+this.mWorld.getSize().height+"\norientation:"+t+"\ndevicePixelRatio:"+window.devicePixelRatio},LoginScene.prototype.awake=function(){this.mTab0.on("pointerdown",this.tab0Handler,this),this.mTab1.on("pointerdown",this.tab1Handler,this),this.mQuickBtn.on("pointerdown",this.quickHandler,this),this.mEnterBtn.on("pointerdown",this.enterHandler,this),this.mSendCodeBtn.on("pointerdown",this.sendCodeHandler,this),this.mtxt4.on("pointerdown",this.changeAccount,this),this.scale.on("resize",this.checkSize,this),this.scale.on("orientationchange",this.onOrientationChange,this),this.scene.wake()},LoginScene.prototype.sleep=function(){this.mTab0.off("pointerdown",this.tab0Handler,this),this.mTab1.off("pointerdown",this.tab1Handler,this),this.mQuickBtn.off("pointerdown",this.quickHandler,this),this.mEnterBtn.off("pointerdown",this.enterHandler,this),this.mSendCodeBtn.off("pointerdown",this.sendCodeHandler,this),this.mtxt4.off("pointerdown",this.changeAccount,this),this.scale.off("resize",this.checkSize,this),this.scale.off("orientationchange",this.onOrientationChange,this),this.scene.sleep()},LoginScene.prototype.remove=function(){this.mTab0.off("pointerdown",this.tab0Handler,this),this.mTab1.off("pointerdown",this.tab1Handler,this),this.mQuickBtn.off("pointerdown",this.quickHandler,this),this.mEnterBtn.off("pointerdown",this.enterHandler,this),this.mSendCodeBtn.off("pointerdown",this.sendCodeHandler,this),this.mtxt4.off("pointerdown",this.changeAccount,this),this.scale.off("resize",this.checkSize,this),this.scale.off("orientationchange",this.onOrientationChange,this),this.scene.remove()},LoginScene.prototype.getKey=function(){return this.sys.config.key},LoginScene.prototype.onOrientationChange=function(){if("app"!==this.mWorld.getConfig().platform){var t=window.screen.width,e=window.screen.height;this.game.scale.resize(t,e),this.game.canvas.style.width=window.screen.width+"",this.game.canvas.style.height=window.screen.height+"",this.mParentCon.x=t>>1,this.mWorld.game.device.os.desktop||(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE,this.mParentCon.y=50+(e>>1))}},LoginScene.prototype.checkSize=function(t){this.mParentCon.x=t.width>>1,this.mParentCon.y=50+(t.height>>1),s.a.getInstance().log("width:"+t.width)},LoginScene.prototype.changeID=function(t){},LoginScene.prototype.changeAccount=function(){this.changePanelState(void 0)},LoginScene.prototype.changePanelState=function(t){var e=!t;this.verificaHandler(e);var i=t?"login_quickLoginBg":"login_loginBgBig";this.mBg.setTexture("login",i),this.mEnterBtn.y=t?15:40,this.mInputBg_long0.visible=!t,this.mtxt3.y=t?8:35,this.mNameInputTxt.visible=!t,this.combobox.visible=!!t,this.mQuickBtn.visible=!t,this.mTab0.visible=!t,this.mTab1.visible=!t,this.mInputBg_long1.visible=!t&&0!==this.mCurTabIndex,this.mPassWordInputTxt.visible=!t&&0!==this.mCurTabIndex,this.mtxt0.visible=!t,this.mtxt1.visible=!t,this.mtxt2.visible=!t,this.mtxt4.visible=!!t;var n=void 0!==t?JSON.parse(t):void 0;this.mNameInputTxt.text=n?n.account:"",this.combobox.text=n?[n.account+""]:[""],this.mPassWordInputTxt.text=n?n.password:"",this.mParentCon.setSize(this.mBg.width,this.mHei),this.mParentCon.scale=window.devicePixelRatio},LoginScene.prototype.verificaHandler=function(t){this.mVerificationCodeTxt.visible=t,this.mtxt5.visible=t,this.mInputBg_small.visible=t,this.mSendCodeBtn.visible=t,this.mInputBg_long1.visible=!t,this.mPassWordInputTxt.visible=!t},LoginScene.prototype.quickHandler=function(){this.addTween(this.mQuickBtn),this.requestQuickLogin()},LoginScene.prototype.sendCodeHandler=function(){this.addTween(this.mSendCodeBtn),this.requestGetPhoneCode()},LoginScene.prototype.enterHandler=function(){this.addTween(this.mEnterBtn),this.mSendCodeBtn.visible?this.loginByPhoneCode():this.requestLogin()},LoginScene.prototype.addTween=function(t){this.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=t.scaleY=1},LoginScene.prototype.tab0Handler=function(t){this.mCurTabIndex=0,this.tabHandler()},LoginScene.prototype.tab1Handler=function(t){this.mCurTabIndex=1,this.tabHandler()},LoginScene.prototype.tabHandler=function(){var t=this;this.mTabDic.forEach((function(e){var i;i=e.tabIndex===t.mCurTabIndex?"login_tabSelect":"login_tabUnSelect",e.setTexture("login",i)})),this.verificaHandler(!this.mCurTabIndex)},LoginScene.prototype.requestLogin=function(){var t=this;this.mWorld.httpService.login(t.mNameInputTxt.text,t.mPassWordInputTxt.text).then((function(e){200===e.code||201===e.code?(t.mNameInputTxt.text&&t.mPassWordInputTxt.text&&localStorage.setItem("account",JSON.stringify({account:t.mNameInputTxt.text,password:t.mPassWordInputTxt.text})),t.mWorld.account.setAccount(e.data),t.mCallBack(e.data)):new a.PopUpTextUI(t.mWorld,t).show("账号密码错误")}))},LoginScene.prototype.requestGetPhoneCode=function(){var t=this;this.mWorld.httpService.requestPhoneCode(t.mNameInputTxt.text).then((function(e){200===e.code?t.mVerificationCodeTxt.setText(e.data):new a.PopUpTextUI(t.mWorld,t).show("验证码获取失败")}))},LoginScene.prototype.loginByPhoneCode=function(){var t=this;this.mWorld.httpService.loginByPhoneCode(t.mNameInputTxt.text,t.mVerificationCodeTxt.text).then((function(e){200===e.code||201===e.code?(localStorage.setItem("accountphone",JSON.stringify({account:t.mNameInputTxt.text})),t.mWorld.account.setAccount(e.data),t.mCallBack(e.data)):new a.PopUpTextUI(t.mWorld,t).show("登录失败")}))},LoginScene.prototype.requestQuickLogin=function(){var t=this;this.mWorld.httpService.quickLogin().then((function(e){200===e.code||201===e.code?(localStorage.setItem("accountphone",JSON.stringify({account:t.mNameInputTxt.text})),t.mWorld.account.setAccount(e.data),t.mCallBack(e.data)):new a.PopUpTextUI(t.mWorld,t).show("登录失败")}))},LoginScene}(l.a)},function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var n,o=i(4),a=i(3),s=function(){function Algorithm(){}return Algorithm.median=function(t){var e=t.sort((function(t,e){return e-t})),i=Math.floor(e.length/2);return e.length%2==0?(e[i-1]+e[i])/2:e[i]},Algorithm}(),h=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function Clock(e,i){var n=t.call(this)||this;return n.mClockSync=!1,n.mAutoSync=!1,n.mTimestamp=0,n.mLatency=[],n.mConn=e,n.mConn.addPacketListener(n),n.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SYNC_TIME,n.proof),n.mListener=i,n._check(),n}return h(Clock,t),Object.defineProperty(Clock.prototype,"sysUnixTime",{get:function(){return(new Date).getTime()},enumerable:!1,configurable:!0}),Object.defineProperty(Clock.prototype,"unixTime",{get:function(){return this.mTimestamp},set:function(t){this.mTimestamp=t},enumerable:!1,configurable:!0}),Clock.prototype.sync=function(t){if(void 0===t&&(t=1),this.mConn){t<0&&(t=1);for(var e=0;e<t;++e){var i=new o.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_TIME);i.content.clientStartTs=this.sysUnixTime,this.mConn.send(i)}}},Clock.prototype.update=function(t,e){this.mTimestamp?this.mTimestamp+=e:this.mTimestamp=t},Clock.prototype.clearTime=function(){this.mClockSync=!1,this.mIntervalId&&clearInterval(this.mIntervalId),this.mTimestamp=0,this._check()},Clock.prototype.destroy=function(){this.mConn&&(this.mConn.removePacketListener(this),this.mConn=void 0),this.mIntervalId&&clearInterval(this.mIntervalId),this.mLatency=void 0},Object.defineProperty(Clock.prototype,"clockSync",{get:function(){return this.mClockSync},enumerable:!1,configurable:!0}),Clock.prototype._check=function(){var t=this;this.mIntervalId=setInterval((function(){t.sync()}),8e3)},Clock.prototype.proof=function(t){var e=t.content,i=this.sysUnixTime,n=e.clientStartTs,o=e.serverReceiveTs,a=e.serverSendTs,h=a-o,l=i-n-h,c=Math.round(l/2);if(!(c<0)){this.mLatency.push(c),this.mLatency.length>7&&this.mLatency.shift();var p=a-(s.median(this.mLatency)+h);if(Math.abs(p-this.mTimestamp)>500)return this.mTimestamp=p,this.mAutoSync=!0,void this.sync(-1);this.mAutoSync=!1,this.mListener&&this.mLatency.length>=2&&!this.mAutoSync&&(this.mClockSync=!0,this.mListener.onClockReady())}},Object.defineProperty(Clock.prototype,"medianLatency",{get:function(){return s.median(this.mLatency)},enumerable:!1,configurable:!0}),Clock}(o.PacketHandler)}]]);