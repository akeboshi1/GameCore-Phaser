/*! For license information please see game_v1.0.2.js.LICENSE */
(this.webpackJsonpTooqingCore=this.webpackJsonpTooqingCore||[]).push([[0],[,,function(t,e,i){"use strict";i.r(e);var s=i(106),a=(i(162),i(7)),r=i(3),n=i(48),o=i(6),h=i(192),l=i.n(h),c=i(193),d=i.n(c);for(const t in r)a.PBpacket.addProtocol(r[t]);class m{constructor(t){this.mPacketHandlers=[],this.mReConnectCount=0,this.mListener=t}startConnect(t,e){this.mCachedServerAddress=t;try{this.mHeartBeatWorker=new d.a,this.mWorker=new l.a,this._doConnect()}catch(t){throw new Error(`startConnect Error: ${t}`)}}closeConnect(){this.mWorker.terminate(),this.mHeartBeatWorker.terminate(),this.mCachedServerAddress=void 0,this.mReConnectCount=0,this.mTimeout=null,this.clearPacketListeners()}addPacketListener(t){this.mPacketHandlers.push(t)}send(t){if(!this.mWorker)throw new Error("NetWorker is undefined.");this.mWorker.postMessage({method:"send",buffer:t.Serialization()})}clearReconnectCount(){this.mHeartBeatWorker.postMessage("clearBeat")}removePacketListener(t){const e=this.mPacketHandlers.indexOf(t);-1!==e&&this.mPacketHandlers.splice(e,1)}clearPacketListeners(){if(!this.mPacketHandlers||this.mPacketHandlers.length<1)return;const t=this.mPacketHandlers.length;for(let e=0;e<t;e++){const t=this.mPacketHandlers[e];t&&(this.removePacketListener(t),e--)}}_doConnect(){o.a.getInstance().info("_doConnect ",this.mCachedServerAddress);const t=this;this.mWorker&&(this.mWorker.onmessage=e=>{t.onWorkerMessage(e.data)},this.mWorker.postMessage({method:"connect",address:t.mCachedServerAddress}))}onWorkerMessage(t){const e=this;switch(t.method){case"onConnected":this.mReConnectCount=0,this.mListener.onConnected(),this.mHeartBeatWorker&&(this.mHeartBeatWorker.onmessage=t=>{e.onWorkerMessage(t.data),o.a.getInstance().debug("mHeartBeatWorker.onmessage",t)},this.mHeartBeatWorker.postMessage({method:"startBeat"}));break;case"onDisConnected":if(!this.mTimeout){this.mReConnectCount<10&&this.mReConnectCount++;const t=Math.pow(this.mReConnectCount,2);o.a.getInstance().info(`ReConnect: delay = ${1e3*t}[c/${this.mReConnectCount}]`),this.mTimeout=setTimeout(()=>{e.mTimeout=void 0,e._doConnect()},1e3*t)}break;case"onConnectError":o.a.getInstance().error("error"+t.error);break;case"startBeat":o.a.getInstance().error("startBeat");break;case"onData":const i=t.buffer;i&&this._onData(i)}}_onData(t){const e=new a.PBpacket;e.Deserialization(new n.Buffer(t)),this.mPacketHandlers.forEach(t=>{t.onPacketArrived(e)})}}class u extends Phaser.Structs.Size{constructor(t,e){super(t,e)}}const p=25;class g extends Phaser.Scene{constructor(){super({key:g.name})}preload(){this.load.spritesheet("rabbit00.png","./resources/rabbit00.png",{frameWidth:150,frameHeight:150})}init(t){this.mWorld=t.world,this.mRoom=t.room}create(){this.mRoom&&this.mRoom.startLoad();const t=this.scale.gameSize.width,e=this.scale.gameSize.height;this.bg=this.add.graphics(),this.bg.fillStyle(6381921),this.bg.fillRect(0,0,t,e),this.anims.create({key:"loading_rabbit00",frames:this.anims.generateFrameNumbers("rabbit00.png",{start:0,end:59}),frameRate:33,yoyo:!0,repeat:-1});const i=t-150-p,s=e-150-p;this.lo=this.add.sprite(i,s,"rabbit00.png"),this.lo.anims.play("loading_rabbit00"),this.scale.on("resize",this.checkSize,this),this.checkSize(new u(t,e))}update(t,e){this.mRoom&&(this.mRoom.clockSyncComplete&&this.mRoom.completeLoad(),this.mRoom.updateClock(t,e))}awake(){this.scene.wake()}sleep(){this.scene.sleep()}getKey(){return this.sys.config.key}checkSize(t){const e=t.width,i=t.height;this.bg.clear(),this.bg.fillStyle(6381921),this.bg.fillRect(0,0,e,i),this.lo.x=e-(150+p)*this.mWorld.uiScale,this.lo.y=i-(150+p)*this.mWorld.uiScale,this.lo.scaleX=this.lo.scaleY=this.mWorld.uiScale}}var f=i(58);class _ extends Phaser.Scene{constructor(){super({key:_.name})}preload(){}init(t){this.mRoom=t.room}create(){const t=this.mRoom.world;t.game.device.os.desktop||t.inputManager.setScene(this),t.uiManager.setScene(this),this.mRoom.world.game.scale.on("resize",this.checkSize,this)}update(){this.mDebugLoger||(this.mDebugLoger=this.mRoom.world.uiManager.getMediator(f.DebugLoggerMediator.NAME)),this.mDebugLoger&&this.mDebugLoger.isShow()&&this.mDebugLoger.update(this.game.loop.actualFps.toFixed())}getKey(){return this.sys.config.key}checkSize(t){t.width,t.height}}class v extends Phaser.Scene{constructor(t){super(t||{key:v.name})}preload(){}init(t){t&&(this.mRoom=t.room)}create(){this.mRoom&&this.mRoom.startPlay(),this.scene.launch(_.name,{room:this.mRoom}),o.a.getInstance().log("play created"),this.scene.sendToBack(),this.scale.on("orientationchange",this.checkOriention,this),this.scale.on("resize",this.checkSize,this)}update(t,e){this.mRoom&&this.mRoom.update(t,e)}getKey(){return this.sys.config.key}checkOriention(t){t===Phaser.Scale.PORTRAIT||Phaser.Scale.LANDSCAPE}checkSize(t){t.width,t.height}}var S,b,T,D,P=i(4),C=i(39),w=i(61),O=i(18),A=i(11);class B{static transformTo90(t,e){const i=e.rows*(e.tileWidth/2);return new A.a((t.x-t.y)*(e.tileWidth/2)+i,(t.x+t.y)*(e.tileHeight/2))}static transformTo45(t,e){const i=e.rows*(e.tileWidth/2);return new A.a(Math.floor((t.y+t.z)/e.tileHeight+(t.x-i)/e.tileWidth),Math.floor((t.y+t.z)/e.tileHeight-(t.x-i)/e.tileWidth))}}class E extends Phaser.GameObjects.Graphics{constructor(t,e){super(t),this.mRoomService=e}draw(t,e){if(this.clear(),0===t.length||0===t[0].length)return;let i,s,a,r;const n=t.length,o=t[0].length,h=this.mRoomService.roomSize,l=h.tileWidth/2,c=h.tileHeight/2;this.mOrigin=e,this.mSize={rows:n,cols:o,tileWidth:l,tileHeight:c,sceneWidth:(n+o)*(l/2),sceneHeight:(n+o)*(c/2)},this.beginPath();for(let e=0;e<n;e++)for(let n=0;n<o;n++)this.lineStyle(2,0),i=B.transformTo90(new A.a(n,e),this.mSize),s=B.transformTo90(new A.a(n+1,e),this.mSize),a=B.transformTo90(new A.a(n+1,e+1),this.mSize),r=B.transformTo90(new A.a(n,e+1),this.mSize),this.beginPath(),this.fillStyle(1===t[e][n]?65280:16711680),this.strokePoints([i.toPoint(),s.toPoint(),a.toPoint(),r.toPoint()],!0,!0),this.fillPath();this.setPosition(0,0)}setPosition(t,e,i,s){if(!this.mSize)return;const a=t-this.mSize.rows*(this.mSize.tileWidth>>1)-(this.mOrigin.x-this.mOrigin.y)*(this.mSize.tileWidth>>1),r=e-(this.mOrigin.x+this.mOrigin.y)*(this.mSize.tileHeight>>1);return super.setPosition(a,r,i,s)}}!function(t){t[t.BACKEND=1]="BACKEND",t[t.STAGE=2]="STAGE",t[t.FRONTEND=3]="FRONTEND",t[t.FLAG=4]="FLAG"}(S||(S={}));class I extends Phaser.GameObjects.Container{constructor(t,e,i){super(t),this.mAlpha=1,this.mElement=i,this.mRoomService=e}changeAlpha(t){this.mAlpha!==t&&(this.alpha=t,this.mAlpha=t)}removeFromParent(){this.parentContainer&&this.parentContainer.remove(this)}fadeIn(t){}fadeOut(t){}load(t,e){}play(t,e){}destroy(t){this.mFlagContainer&&(this.mNickname&&(this.mNickname.destroy(),this.mNickname=void 0),this.mBackEffect&&(this.mBackEffect.destroy(),this.mBackEffect=void 0),this.mFrontEffect&&(this.mFrontEffect.destroy(),this.mFrontEffect=void 0),this.clearBadges(),this.mFlagContainer.destroy(),this.mFlagContainer=void 0),this.mReferenceArea&&(this.mReferenceArea.destroy(),this.mReferenceArea=void 0),super.destroy(t)}showNickname(t){this.mNickname||(this.mNickname=this.scene.make.text({style:{font:C.a.YAHEI_14_BOLD}},!1).setOrigin(.5,.5),this.flagContainer.add(this.mNickname)),this.mNickname.setText(t),this.layouFlag()}setDisplayBadges(t){this.mBadges?this.clearBadges():this.mBadges=[];for(const e of t){const t=new O.DynamicImage(this.scene,0,0);t.load(P.h.getOsdRes(e.thumbnail),this,this.layouFlag),this.flagContainer.add(t),this.mBadges.push(t)}}showRefernceArea(){this.mReferenceArea||(this.mReferenceArea=new E(this.scene,this.mRoomService)),!this.mCollisionArea||this.mCollisionArea.length<=0||(this.mReferenceArea.draw(this.mCollisionArea,this.mOriginPoint),this.addAt(this.mReferenceArea,0))}hideRefernceArea(){this.mReferenceArea&&(this.mReferenceArea.destroy(),this.mReferenceArea=void 0)}showEffect(){this.addEffect(this.mBackEffect,P.h.getRes("ui/vip/vip_effect_back.png"),P.h.getRes("ui/vip/vip_effect_back.json"),!0,15,!1,!0),this.addEffect(this.mFrontEffect,P.h.getRes("ui/vip/vip_effect_front.png"),P.h.getRes("ui/vip/vip_effect_front.json"),!0,15,!1,!0)}addEffect(t,e,i,s,a,r,n){t||(t=new w.DynamicSprite(this.scene,0,0)),t.load(e,i),t.y=-20,s?this.addAt(t,S.BACKEND):this.addAt(t,S.FRONTEND),t.once(Phaser.Animations.Events.SPRITE_ANIMATION_COMPLETE,()=>{t.destroy()})}layouFlag(t=4){if(!this.mFlagContainer)return;this.mFlagContainer.y=-96,this.bringToTop(this.mNickname);const e=this.mFlagContainer.list;let i=0;for(const t of e)t.x=i,t.width&&(i=t.width)}clearBadges(){if(this.mBadges){for(const t of this.mBadges)t.destroy();this.mBadges.length=0}}get flagContainer(){return this.mFlagContainer?this.mFlagContainer:(this.mFlagContainer=this.scene.make.container(void 0,!1),this.addAt(this.mFlagContainer,S.FLAG),this.mFlagContainer)}get baseLoc(){return this.mBaseLoc||new Phaser.Geom.Point}get sortX(){return this.x}get sortY(){return this.y}get element(){return this.mElement}}!function(t){t.BodyCostDres="body_cost_$_dres",t.BodyCost="body_cost_$",t.BodyTail="body_tail_$",t.BodyWing="body_wing_$",t.BodyBase="body_base_$",t.BodySpec="body_spec_$",t.FlegSpec="fleg_spec_$",t.FlegBase="fleg_base_$",t.FlegCost="fleg_cost_$",t.BarmSpec="barm_spec_$",t.BarmBase="barm_base_$",t.BarmCost="barm_cost_$",t.WeapBarm="weap_barm_$",t.ShldBarm="shld_barm_$",t.BlegSpec="bleg_spec_$",t.BlegBase="bleg_base_$",t.BlegCost="bleg_cost_$",t.FarmSpec="farm_spec_$",t.FarmBase="farm_base_$",t.FarmCost="farm_cost_$",t.ShldFarm="shld_farm_$",t.WeapFarm="weap_farm_$",t.HeadSpec="head_spec_$",t.HeadMask="head_mask_$",t.HeadEyes="head_eyes_$",t.HeadBase="head_base_$",t.HeadHairBack="head_hair_$_back",t.HeadMous="head_mous_$",t.HeadHair="head_hair_$",t.HeadHats="head_hats_$"}(b||(b={})),function(t){t.BarmBase="barm_base_#_$",t.BarmCost="barm_cost_#_$",t.BarmSpec="barm_spec_#_$",t.BlegBase="bleg_base_#_$",t.BlegCost="bleg_cost_#_$",t.BlegSpec="bleg_spec_#_$",t.BodyBase="body_base_#_$",t.BodyCost="body_cost_#_$",t.BodyCostDres="body_cost_#_$_dres",t.BodySpec="body_spec_#_$",t.BodyTail="body_tail_#_$",t.BodyWing="body_wing_#_$",t.FarmBase="farm_base_#_$",t.FarmCost="farm_cost_#_$",t.FarmSpec="farm_spec_#_$",t.FlegBase="fleg_base_#_$",t.FlegCost="fleg_cost_#_$",t.FlegSpec="fleg_spec_#_$",t.HeadBase="head_base_#_$",t.HeadEyes="head_eyes_#_$",t.HeadHair="head_hair_#_$",t.HeadHairBack="head_hair_#_$_back",t.HeadHats="head_hats_#_$",t.HeadMask="head_mask_#_$",t.HeadMous="head_mous_#_$",t.HeadSpec="head_spec_#_$",t.ShldFarm="shld_farm_#_$",t.WeapFarm="weap_farm_#_$",t.ShldBarm="shld_barm_#_$",t.WeapBarm="weap_barm_#_$"}(T||(T={}));class M extends I{constructor(){super(...arguments),this.mAnimationName="Armature",this.mDragonbonesName="",this.mActionName="",this.replaceArr=[],this.misloading=!1,this.mloadingList=[]}get GameObject(){return this}changeAlpha(t){}load(t){this.mDisplayInfo=t,this.mDisplayInfo&&(this.dragonBonesName="bones_human01",this.scene.cache.obj.has(this.dragonBonesName))}getDisplay(){return this.mArmatureDisplay}play(t){let e=void 0!==this.mDisplayInfo?this.mDisplayInfo.avatarDir:3;if(e=0!==e?e:3,this.mActionName!==t||this.mPreDirection!==e){let i="";3===e||5===e?this.setScaleStageX(4-e):1!==e&&7!==e||(this.setScaleStageX(-1/3*e+4/3),i="_back"),this.mActionName=t+i,this.mArmatureDisplay&&this.mArmatureDisplay.animation.play(this.mActionName),o.a.getInstance().debug("play:"+e),this.mPreDirection=e}}fadeIn(t){this.clearFadeTween(),this.alpha=0,this.mFadeTween=this.scene.tweens.add({targets:this,alpha:1,duration:1200,onComplete:()=>{t&&t()}})}fadeOut(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:()=>{t&&t()}})}destroy(){this.mDisplayInfo=null,this.mArmatureDisplay&&(this.mArmatureDisplay.dispose(!0),this.mArmatureDisplay=null),this.mClickGraphics&&(this.mClickGraphics.clear(),this.mClickGraphics.destroy(!0),this.mClickGraphics=null),this.mClickCon&&(this.mClickCon.destroy(!0),this.mClickCon=null),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=null),super.destroy()}buildDragbones(){if(this.scene.cache.custom.dragonbone.get(this.mDragonbonesName))this.onLoadCompleteHandler();else{const t="./resources/dragonbones";this.scene.load.dragonbone(this.mDragonbonesName,`${t}/${this.mDragonbonesName}_tex.png`,`${t}/${this.mDragonbonesName}_tex.json`,`${t}/${this.mDragonbonesName}_ske.dbbin`,null,null,{responseType:"arraybuffer"}),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.scene.load.start()}}onLoadCompleteHandler(t,e,i){this.mArmatureDisplay&&this.mArmatureDisplay.dbClear(),this.mArmatureDisplay=this.scene.add.armature(this.mAnimationName,this.dragonBonesName),this.clearArmature(),this.getReplaceArr(),this.showReplaceArmatrue(),this.mArmatureDisplay.x=this.baseLoc.x,this.mArmatureDisplay.y=this.baseLoc.y,this.add(this.mArmatureDisplay);const s=new Phaser.Geom.Rectangle(0,0,50,70);this.mClickGraphics||(this.mClickGraphics=this.scene.add.graphics(),this.mClickGraphics.fillStyle(16711680),this.mClickGraphics.fillRectShape(s),this.mClickGraphics.visible=!1,this.add(this.mClickGraphics)),this.mClickCon||(this.mClickCon=this.scene.add.container(0,0,this.mClickGraphics),this.mClickCon.setInteractive(s,Phaser.Geom.Rectangle.Contains),this.mClickCon.x=-s.width>>1,this.mClickCon.y=-s.height),this.setData("id",this.mDisplayInfo.id),this.add(this.mClickCon),this.emit("initialized")}setScaleStage(t){this.mArmatureDisplay&&(this.mArmatureDisplay.scale=t)}setScaleStageX(t){this.mArmatureDisplay&&(this.mArmatureDisplay.scaleX=t)}clearArmature(){const t=this.mArmatureDisplay.armature.getSlots(),e=t.length;for(let i=0;i<e;i++){t[i].display.visible=!1}}clearReplaceArmature(){if(this.mArmatureDisplay.armature.animation.stop(),!this.replaceArr||0===this.replaceArr.length)return;const t=this.replaceArr.length;for(let e=0;e<t;e++){const t=this.replaceArr[e].slot.replace("$",this.replaceArr[e].dir.toString());this.mArmatureDisplay.armature.getSlot(t).replaceDisplay(null)}}showReplaceArmatrue(){for(const t of this.replaceArr){this.replacePartDisplay(t.slot,t.part,t.dir,t.skin);t.slot.replace("$",t.dir.toString())}this.replaceArr.splice(0)}getReplaceArr(){this.replaceArr.length=0;const t=this.mDisplayInfo.avatar;t.bodyBaseId&&(this.replaceArr.push({slot:b.BodyBase,part:T.BodyBase,dir:3,skin:t.bodyBaseId}),this.replaceArr.push({slot:b.BodyBase,part:T.BodyBase,dir:1,skin:t.bodyBaseId})),t.bodySpecId&&(this.replaceArr.push({slot:b.BodySpec,part:T.BodySpec,dir:3,skin:t.bodySpecId}),this.replaceArr.push({slot:b.BodySpec,part:T.BodySpec,dir:1,skin:t.bodySpecId})),t.bodyWingId&&(this.replaceArr.push({slot:b.BodyWing,part:T.BodyWing,dir:3,skin:t.bodyWingId}),this.replaceArr.push({slot:b.BodyWing,part:T.BodyWing,dir:1,skin:t.bodyWingId})),t.bodyTailId&&(this.replaceArr.push({slot:b.BodyTail,part:T.BodyTail,dir:3,skin:t.bodyTailId}),this.replaceArr.push({slot:b.BodyTail,part:T.BodyTail,dir:1,skin:t.bodyTailId})),t.bodyCostId&&(this.replaceArr.push({slot:b.BodyCost,part:T.BodyCost,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:b.BodyCost,part:T.BodyCost,dir:1,skin:t.bodyCostId}),this.replaceArr.push({slot:b.BodyCostDres,part:T.BodyCostDres,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:b.BodyCostDres,part:T.BodyCostDres,dir:1,skin:t.bodyCostId})),t.farmBaseId&&(this.replaceArr.push({slot:b.FarmBase,part:T.FarmBase,dir:3,skin:t.farmBaseId}),this.replaceArr.push({slot:b.FarmBase,part:T.FarmBase,dir:1,skin:t.farmBaseId})),t.farmSpecId&&(this.replaceArr.push({slot:b.FarmSpec,part:T.FarmSpec,dir:3,skin:t.farmSpecId}),this.replaceArr.push({slot:b.FarmSpec,part:T.FarmSpec,dir:1,skin:t.farmSpecId})),t.farmCostId&&(this.replaceArr.push({slot:b.FarmCost,part:T.FarmCost,dir:3,skin:t.farmCostId}),this.replaceArr.push({slot:b.FarmCost,part:T.FarmCost,dir:1,skin:t.farmCostId})),t.barmBaseId&&(this.replaceArr.push({slot:b.BarmBase,part:T.BarmBase,dir:3,skin:t.barmBaseId}),this.replaceArr.push({slot:b.BarmBase,part:T.BarmBase,dir:1,skin:t.barmBaseId})),t.barmSpecId&&(this.replaceArr.push({slot:b.BarmSpec,part:T.BarmSpec,dir:3,skin:t.barmSpecId}),this.replaceArr.push({slot:b.BarmSpec,part:T.BarmSpec,dir:1,skin:t.barmSpecId})),t.barmCostId&&(this.replaceArr.push({slot:b.BarmCost,part:T.BarmCost,dir:3,skin:t.barmCostId}),this.replaceArr.push({slot:b.BarmCost,part:T.BarmCost,dir:1,skin:t.barmCostId})),t.blegBaseId&&(this.replaceArr.push({slot:b.BlegBase,part:T.BlegBase,dir:3,skin:t.blegBaseId}),this.replaceArr.push({slot:b.BlegBase,part:T.BlegBase,dir:1,skin:t.blegBaseId})),t.blegSpecId&&(this.replaceArr.push({slot:b.BlegSpec,part:T.BlegSpec,dir:3,skin:t.blegSpecId}),this.replaceArr.push({slot:b.BlegSpec,part:T.BlegSpec,dir:1,skin:t.blegSpecId})),t.blegCostId&&(this.replaceArr.push({slot:b.BlegCost,part:T.BlegCost,dir:3,skin:t.blegCostId}),this.replaceArr.push({slot:b.BlegCost,part:T.BlegCost,dir:1,skin:t.blegCostId})),t.flegBaseId&&(this.replaceArr.push({slot:b.FlegBase,part:T.FlegBase,dir:3,skin:t.flegBaseId}),this.replaceArr.push({slot:b.FlegBase,part:T.FlegBase,dir:1,skin:t.flegBaseId})),t.flegSpecId&&(this.replaceArr.push({slot:b.FlegSpec,part:T.FlegSpec,dir:3,skin:t.flegSpecId}),this.replaceArr.push({slot:b.FlegSpec,part:T.FlegSpec,dir:1,skin:t.flegSpecId})),t.flegCostId&&(this.replaceArr.push({slot:b.FlegCost,part:T.FlegCost,dir:3,skin:t.flegCostId}),this.replaceArr.push({slot:b.FlegCost,part:T.FlegCost,dir:1,skin:t.flegCostId})),t.headBaseId&&(this.replaceArr.push({slot:b.HeadBase,part:T.HeadBase,dir:3,skin:t.headBaseId}),this.replaceArr.push({slot:b.HeadBase,part:T.HeadBase,dir:1,skin:t.headBaseId})),t.barmWeapId&&(this.replaceArr.push({slot:b.WeapBarm,part:T.WeapBarm,dir:3,skin:t.barmWeapId}),this.replaceArr.push({slot:b.WeapBarm,part:T.WeapBarm,dir:1,skin:t.barmWeapId})),t.headHairId&&(this.replaceArr.push({slot:b.HeadHair,part:T.HeadHair,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:b.HeadHair,part:T.HeadHair,dir:1,skin:t.headHairId}),this.replaceArr.push({slot:b.HeadHairBack,part:T.HeadHairBack,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:b.HeadHairBack,part:T.HeadHairBack,dir:1,skin:t.headHairId})),t.headHatsId&&(this.replaceArr.push({slot:b.HeadHats,part:T.HeadHats,dir:3,skin:t.headHatsId}),this.replaceArr.push({slot:b.HeadHats,part:T.HeadHats,dir:1,skin:t.headHatsId})),t.headSpecId&&(this.replaceArr.push({slot:b.HeadSpec,part:T.HeadSpec,dir:3,skin:t.headSpecId}),this.replaceArr.push({slot:b.HeadSpec,part:T.HeadSpec,dir:1,skin:t.headSpecId})),t.headEyesId&&this.replaceArr.push({slot:b.HeadEyes,part:T.HeadEyes,dir:3,skin:t.headEyesId}),t.headMousId&&this.replaceArr.push({slot:b.HeadMous,part:T.HeadMous,dir:3,skin:t.headMousId}),t.headMaskId&&this.replaceArr.push({slot:b.HeadMask,part:T.HeadMask,dir:3,skin:t.headMaskId}),t.farmShldId&&(this.replaceArr.push({slot:b.ShldFarm,part:T.ShldFarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:b.ShldFarm,part:T.ShldFarm,dir:1,skin:t.farmShldId}),this.replaceArr.push({slot:b.ShldBarm,part:T.ShldBarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:b.ShldBarm,part:T.ShldBarm,dir:1,skin:t.farmShldId})),t.farmWeapId&&(this.replaceArr.push({slot:b.WeapFarm,part:T.WeapFarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:b.WeapFarm,part:T.WeapFarm,dir:1,skin:t.farmWeapId}),this.replaceArr.push({slot:b.WeapBarm,part:T.WeapBarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:b.WeapBarm,part:T.WeapBarm,dir:1,skin:t.farmWeapId}))}replacePartDisplay(t,e,i,s){const a=t.replace("$",i.toString()),r=this.mArmatureDisplay.armature.getSlot(a),n=e.replace("#",s.toString()).replace("$",i.toString());if(this.scene.cache.custom.dragonbone.get(this.dragonBonesName)){const t=P.f.getPartName(n);if(this.scene.game.cache.obj.has(t)){const t=P.f.getPartName(n),e=new dragonBones.phaser.display.SlotImage(this.scene,0,0,t);r.replaceDisplay(e)}else this.mloadingList.push([r.name,n]),this.misloading||(this.misloading=!0,this.startLoad())}}startLoad(){const t=this.mloadingList.shift();if(t){const e=P.f.getPartUrl(t[1]),i=P.f.getPartName(t[1]);t[1];this.scene.load.once(Phaser.Loader.Events.COMPLETE,(e,i,s)=>{const a=P.f.getPartName(t[1]),r=this.mArmatureDisplay.armature.getSlot(t[0]),n=new dragonBones.phaser.display.SlotImage(this.scene,0,0,a);n.texture.key===a&&r.replaceDisplay(n),this.misloading=!1,this.startLoad()},this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,t=>{this.misloading=!1,this.startLoad()},this),this.scene.load.image(i,e),this.scene.load.start()}else this.misloading=!1}clearFadeTween(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())}set dragonBonesName(t){this.mDragonbonesName!==t&&(this.mDragonbonesName=t,this.buildDragbones())}get dragonBonesName(){return this.mDragonbonesName}}!function(t){t[t.BACKEND=1]="BACKEND",t[t.STAGE=2]="STAGE",t[t.FRONTEND=3]="FRONTEND"}(D||(D={}));class k extends I{constructor(){super(...arguments),this.mDisplayDatas=new Map,this.mSprites=new Map,this.mHasAnimation=!1}setPosition(t,e,i){return super.setPosition(t,e,i),this.setDepth(this.x+this.baseLoc.x+this.y+this.baseLoc.y),this}load(t,e){e=e||D.STAGE;const i=t;if(i&&i.gene&&!this.mSprites.get(e))if(this.mDisplayDatas.set(e,i),this.scene.cache.obj.has(i.gene))this.onLoadCompleted(e);else{const t=i.display;t||o.a.getInstance().error("display is undefined"),this.scene.load.atlas(i.gene,"https://osd.tooqing.com/"+t.texturePath,"https://osd.tooqing.com/"+t.dataPath),this.scene.load.once(Phaser.Loader.Events.COMPLETE,()=>{this.onLoadCompleted(e)},this),this.scene.load.start()}}play(t,e){if(!t)return;e=e||D.STAGE;const i=this.mDisplayDatas.get(e),s=this.mSprites.get(e);if(s&&s instanceof Phaser.GameObjects.Sprite)s.play(`${i.gene}_${t}`);else{const e=i.getAnimations(t);if(!e)return void o.a.getInstance().log(`error: ${t} not found`);s.setTexture(i.gene,e.frameName[0])}this.initBaseLoc(e,t)}fadeIn(t){0!==this.mAlpha&&(this.alpha=0,this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:this.mAlpha,duration:1200,onComplete:()=>{t&&t()}}))}fadeOut(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:()=>{t&&t()}})}setInteractive(t,e,i){return super.setInteractive(t,e,i),this.mSprites.forEach(t=>{t.setInteractive()}),this}disableInteractive(){return super.disableInteractive(),this.mSprites.forEach(t=>{t.disableInteractive()}),this}destroy(){this.mSprites.forEach(t=>t.destroy()),this.mSprites.clear(),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=void 0),this.mDisplayDatas.clear(),super.destroy()}clearFadeTween(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())}onLoadCompleted(t){this.makeAnimations(t),this.createDisplay(t)}makeAnimations(t){const e=this.mDisplayDatas.get(t);if(!e)return;const i=Array.from(e.animations.values());for(const e of i)this.makeAnimation(t,e)}makeAnimation(t,e){const i=this.mDisplayDatas.get(t);if(!e||!i||!i.gene)return;if(e.frameName.length<=1)return;const s=[];e.frameName.forEach(t=>{s.push({key:i.gene,frame:t})});const a={key:`${i.gene}_${e.name}`,frames:s,frameRate:e.frameRate,repeat:-1};this.mHasAnimation=!0,this.scene.anims.create(a)}initBaseLoc(t,e){const i=this.mDisplayDatas.get(t),s=this.mSprites.get(t);if(!s||!i||!i.animations)return;const a=i.getAnimations(e);a&&(this.mBaseLoc=a.baseLoc,this.mCollisionArea=a.collisionArea,this.mOriginPoint=a.originPoint,s.x=this.baseLoc.x,s.y=this.baseLoc.y)}createDisplay(t){const e=this.mDisplayDatas.get(t);if(!e||!e.gene)return;let i=this.mSprites.get(t);i||(this.mHasAnimation?i=this.scene.make.sprite(void 0,!1).setOrigin(0,0):(i=this.scene.make.image(void 0,!1).setOrigin(0,0)).setTexture(e.gene),this.mSprites.set(t,i),this.play(e.animationName,t),i.x=this.baseLoc.x,i.y=this.baseLoc.y,this.addAt(i,t)),i.setInteractive({pixelPerfect:!0}),this.setData("id",e.id),this.mSprites.set(t,i),this.emit("initialized",this)}}class R{constructor(t){this.discriminator="DragonbonesModel",t&&(this.id=t.id,this.avatar=t.avatar)}setInfo(t){for(const e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}destroy(){}}class L{constructor(){this.mRenderable=!1}setRenderable(t,e){if(this.mRenderable!==t){if(e=e||0,this.mRenderable=t,t)return this.addDisplay(),void(e>0&&this.fadeIn());e>0?this.fadeOut(()=>{this.removeDisplay()}):this.removeDisplay()}}getRenderable(){return this.mRenderable}fadeIn(t){this.mDisplay&&this.mDisplay.fadeIn(t)}fadeOut(t){this.mDisplay&&this.mDisplay.fadeOut(t)}fadeAlpha(t){this.mDisplay}destroy(){this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null)}addDisplay(){}removeDisplay(){this.mDisplay&&this.mDisplay.removeFromParent()}}var F=i(62);class N extends Phaser.GameObjects.Container{constructor(t){super(t),this.mMinWidth=0,this.mMinHeight=0,this.x=-60}show(t,e){this.mChatContent=this.scene.make.text({text:t,style:{x:0,y:4,fontFamily:"YaHei",fontSize:14,color:"#000000",origin:{x:0,y:0},wordWrap:{width:300,useAdvancedWrap:!0}}},!1),this.add(this.mChatContent),this.mMinHeight=this.mChatContent.height+26,this.mMinHeight=this.mMinHeight<54?54:this.mMinHeight,this.mMinWidth=this.mChatContent.width+40,this.mMinWidth=this.mMinWidth<69?69:this.mMinWidth,this.mBubbleBg=new F.DynamicNinepatch(this.scene,this);const i=P.h.getOsdRes(e.bubbleResource||"platformitem/thumbnail/bubble_01.png");this.mBubbleBg.load(i,{width:this.mMinWidth,height:this.mMinHeight,key:i,columns:[34,2,32],rows:[42,2,9]},this.onComplete,this)}tweenTo(t){this.mToY=t,this.scene.tweens.add({targets:this,y:t,alpha:1,duration:200})}durationRemove(t,e,i){this.mTweenCompleteCallback=e,this.mTweenCallContext=i,this.mRemoveDelay=setTimeout(()=>{this.removeTween()},t)}removeTween(){const t=this.mToY-30;this.scene.tweens.add({targets:this,y:t,alpha:0,duration:200,onComplete:()=>{this.mTweenCompleteCallback&&this.mTweenCompleteCallback.call(this.mTweenCallContext,this)}})}destroy(){this.mChatContent&&this.mChatContent.destroy(!0),this.mChatContent=null,this.mMinWidth=0,this.mMinHeight=0,this.mToY=0,this.mTweenCompleteCallback=null,this.mTweenCallContext=null,this.mRemoveDelay&&clearTimeout(this.mRemoveDelay),super.destroy(!0)}onComplete(t){if(t){t.setOrigin(0,0),this.addAt(t,0);this.getBounds();this.mChatContent.x=this.mMinWidth-this.mChatContent.width>>1,this.mChatContent.y=6+(this.mMinHeight-this.mChatContent.height>>1)}}get minWidth(){return this.mMinWidth}get minHeight(){return this.mMinHeight}}class j extends Phaser.GameObjects.Container{constructor(t){super(t),this.mBubbles=[],this.mArrow=new O.DynamicImage(this.scene,0,0),this.mArrow.load(P.h.getRes("ui/chat/bubble_arrow.png")),this.add(this.mArrow)}addBubble(t,e){const i=this.createBubble(e);let s=null,a=0;for(let t=this.mBubbles.length-1;t>=0;t--)a+=(s=this.mBubbles[t]).minHeight+5,s.tweenTo(-a);i.show(t,e),this.add(i),this.mArrow.y=i.minHeight+4}destroy(t){let e=null;for(let t=this.mBubbles.length-1;t>=0;t--)(e=this.mBubbles[t])&&e.destroy();this.mBubbles=null,this.removeFormParent(),super.destroy(t)}removeFormParent(){this.parentContainer&&this.parentContainer.remove(this)}createBubble(t){if(!t)return;const e=new N(this.scene);this.mBubbles.push(e);const i=t.duration?t.duration:5e3;return e.durationRemove(i,this.onRemoveBubble,this),e}onRemoveBubble(t){t&&(this.mBubbles=this.mBubbles.filter(e=>t!==e),this.remove(t),t.destroy(),0===this.mBubbles.length&&this.removeFormParent())}}class W{constructor(){}}var H,V=i(16);class z extends a.PacketHandler{constructor(t){super(),this.mWorld=t,this.mInitialize=!1,this.mConnect=this.mWorld.connection,this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QUERY_PACKAGE,this.handlerQueryPackage),this.mShopModel=new W}initialize(){return this.mInitialize}register(){this.mConnect.addPacketListener(this)}unRegister(){this.mConnect.removePacketListener(this)}destroy(){this.unRegister(),this.mShopModel=null,this.mInitialize=!1,this.mConnect=null}handlerQueryPackage(t){const e=t.content;this.mWorld.emitter.emit(V.a.QUERY_PACKAGE,e)}}z.NAME="ShopModel",function(t){t[t.up=0]="up",t[t.up_left=1]="up_left",t[t.left=2]="left",t[t.left_down=3]="left_down",t[t.down=4]="down",t[t.down_right=5]="down_right",t[t.right=6]="right",t[t.right_up=7]="right_up"}(H||(H={}));class G extends L{constructor(t,e){if(super(),this.mElementManager=e,this.mAnimationName="",this.mMoveData={},this.mId=t.id,this.mModel=t,t.avatar)this.mDisplayInfo=new R(t);else{let i=null;if(!(i=t.displayInfo?t.displayInfo:this.mElementManager.roomService.world.elementStorage.getObject(t.bindID||t.id)))return void o.a.getInstance().error("object does not exist");this.mDisplayInfo=i,i.shops&&(this.mShopEntity=new z(e.roomService.world),this.mShopEntity.register())}this.createDisplay(),this.setPosition(t.pos),this.mDisplay.changeAlpha(t.alpha),this.mDisplay.showNickname(t.nickname),this.setDirection(t.direction),this.setRenderable(!0)}get dir(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3}get roomService(){if(this.mElementManager)return this.mElementManager.roomService;o.a.getInstance().error("element manager is undefined")}get id(){return this.mId}get model(){return this.mModel}load(t){this.mDisplayInfo=t}play(t){this.mAnimationName!==t&&(this.mAnimationName=t,this.mDisplay&&this.mDisplay.play(this.mAnimationName))}setDirection(t){this.mDisplayInfo&&(this.mDisplayInfo.avatarDir=t),this.mDisplay&&(this.mDisplay.scaleX=3===t?1:-1)}getDirection(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3}changeState(t){this.mCurState=t}getRenderable(){return this.mRenderable}getDisplay(){return this.mDisplay}move(t){return this.mElementManager?this.mDisplay?(this.mMoveData.arrivalTime=t.timestemp,this.mMoveData.destPos=new A.a(Math.floor(t.destinationPoint3f.x),Math.floor(t.destinationPoint3f.y)),o.a.getInstance().log("walk has movedata"),void this._doMove()):o.a.getInstance().error("display is undefined"):o.a.getInstance().error("Element::move - Empty element-manager.")}startMove(){this.changeState("walk")}stopMove(){this.mDisplay?this.changeState("idle"):o.a.getInstance().error("can't stopMove, display does not exist")}setPosition(t){this.mDisplay&&this.mDisplay.setPosition(t.x,t.y,t.z),this.setDepth()}getPosition(){let t;return this.mDisplay&&(t=new A.a(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z)),t}getPosition45(){const t=this.getPosition();return t?this.roomService.transformTo45(t):new A.a}getRootPosition(){return new A.a(this.mDisplay.x,this.mDisplay.y,0)}showBubble(t,e){const i=this.mElementManager.scene;i&&(this.mBubble||(this.mBubble=new j(i)),this.mBubble.addBubble(t,e),this.updateBubble(),this.roomService.addToSceneUI(this.mBubble))}showEffected(){this.mDisplay&&this.mDisplay.showEffect()}removeMe(){this.mElementManager&&this.mElementManager.remove(this.id)}toSprite(){const t=r.op_client.Sprite.create();return t.id=this.id,this.mDisplay&&(t.point3f=r.op_def.PBPoint3f.create(),t.point3f.x=this.mDisplay.x,t.point3f.y=this.mDisplay.y,t.point3f.z=this.mDisplay.z),t}destroy(){this.mMoveData&&this.mMoveData.tweenAnim&&(this.mMoveData.tweenAnim.stop(),this.mMoveData.tweenAnim.remove(),this.mMoveData.tweenAnim=null,this.mMoveData=null),this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null),this.mBubble&&(this.mBubble.destroy(),this.mBubble=void 0),this.mShopEntity&&(this.mShopEntity.destroy(),this.mShopEntity=null),super.destroy()}_doMove(){if(!this.mMoveData.destPos)return void o.a.getInstance().log("stopDoMove");const t=this.mMoveData.tweenAnim;t&&(t.stop(),t.remove());const e=this.mMoveData.arrivalTime-this.roomService.now();this.mMoveData.tweenAnim=this.mElementManager.scene.tweens.add({targets:this.mDisplay,duration:e,ease:"Linear",props:{x:{value:this.mMoveData.destPos.x},y:{value:this.mMoveData.destPos.y}},onStart:()=>{this.onMoveStart()},onComplete:(t,e,i)=>{this.onMoveComplete()},onUpdate:(t,e,i)=>{this.onMoving()},onCompleteParams:[this]})}createDisplay(){if(!this.mDisplayInfo)return void o.a.getInstance().error("displayinfo does not exist, Create display failed");if(this.mDisplay)return this.mDisplay;const t=this.mElementManager.scene;return t&&("DragonbonesModel"===this.mDisplayInfo.discriminator?this.mDisplay=new M(t,this.mElementManager.roomService,this):this.mDisplay=new k(t,this.mElementManager.roomService,this),this.mDisplay.once("initialized",this.onDisplayReady,this),this.mDisplay.load(this.mDisplayInfo)),this.mDisplay}addDisplay(){this.createDisplay();const t=this.roomService;t?(t.addToSurface(this.mDisplay),this.setDepth()):o.a.getInstance().error("roomService is undefined")}setDepth(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.x+this.mDisplay.y),!this.roomService)throw new Error("roomService is undefined");const t=this.roomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthSurfaceDirty=!0}}onDisplayReady(){this.mDisplay&&(this.mDisplay.play("idle"),this.setDepth())}updateBubble(){if(!this.mBubble)return;const t=this.getPosition();t&&(this.mBubble.x=t.x,this.mBubble.y=t.y-130)}onMoveStart(){}onMoveComplete(){this.mMoveData.tweenAnim.stop()}onMoving(){const t=this.roomService.now();t-(0|this.mMoveData.tweenLastUpdate)>=50&&(this.setDepth(),this.mMoveData.tweenLastUpdate=t,this.updateBubble())}}class U{}var Y=i(194);class X{constructor(t){this.discriminator="FramesModel",this.id=t.id||0,this.type=t.sn||"";const e=t.animations;e&&(this.animationName=e.defaultAnimationName,this.setDisplay(e.display),this.setAnimationData(e.animationData))}setInfo(t){for(const e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}getAnimationData(){return this.animations}getAnimations(t){if(this.animations)return this.animations.get(t)}destroy(){this.animations&&this.animations.clear()}get gene(){return this.mGen}toClient(){const t=[];return this.animations.forEach(e=>{t.push(e.toClient())},this),t}setDisplay(t){t?(this.display={dataPath:t.dataPath,texturePath:t.texturePath},this.mGen=Y.sync(t.dataPath+t.texturePath)):o.a.getInstance().error(`${this.type} display does not exist`)}setAnimationData(t){if(t){this.animations=new Map;for(const e of t)this.animations.set(e.name,e)}else o.a.getInstance().error(`${this.id} animationData does not exist`)}}class K{constructor(t){let e=null;e="string"==typeof t.baseLoc?t.baseLoc.split(","):t.baseLoc,this.mID=t.id,this.mBaseLoc=e,this.mName=t.name,this.mFrameName=t.frameName,this.mLoop=t.loop,this.mBaseLoc=new Phaser.Geom.Point(parseInt(e[0],10),parseInt(e[1],10));const i=t.originPoint;Array.isArray(i)&&(this.mOriginPoint=new Phaser.Geom.Point(t.originPoint[0],t.originPoint[1])),"string"==typeof t.collisionArea?this.mCollisionArea=this.stringToArray(t.collisionArea,",","&"):this.mCollisionArea=t.collisionArea,"string"==typeof t.walkableArea||(this.mWalkableArea=t.walkableArea)}toClient(){const t=r.op_gameconfig.Animation.create();return t.id=this.id,t.baseLoc=`${this.baseLoc.x},${this.baseLoc.y}`,t.name=this.name,t.loop=this.loop,t.frameRate=this.frameRate,t.frameName=this.frameName,t.originPoint=[this.originPoint.x,this.originPoint.y],t.walkOriginPoint=[this.originPoint.x,this.originPoint.y],t.walkableArea=this.arrayToString(this.mWalkableArea,",","&"),t.collisionArea=this.arrayToString(this.mCollisionArea,",","&"),t}stringToArray(t,e,i){if(!t)return;const s=t.split(i),a=[];for(const t of s){const i=t.split(e);a.push(i.map(t=>parseInt(t,10)))}return a}arrayToString(t,e,i){if(!t)return"";const s=[];for(const i of t)s.push(i.join(e));return s.join(i)}get baseLoc(){return this.mBaseLoc}get id(){return this.mID}get frameName(){return this.mFrameName}get frameRate(){return this.mFrameRate}get loop(){return this.mLoop}get name(){return this.mName}get collisionArea(){return this.mCollisionArea}get originPoint(){return this.mOriginPoint}}var Q,$=i(63);class Z{static genId(){return(new $).natural({min:1e4,max:Z.MAX_ID})}}Z.MAX_ID=Math.pow(2,31);class J{constructor(t){if(this.mID=t.id,t.point3f){const e=t.point3f;this.mPos=new A.a(e.x,e.y,e.z)}if(t.avatar&&(this.mAvatar={id:t.avatar.id},this.mAvatar=Object.assign(this.mAvatar,t.avatar),this.mDisplayInfo=new R(this)),t.display){const e=[],i=t.animations;for(const t of i)e.push(new K(t));this.mDisplayInfo=new X({animations:{defaultAnimationName:t.currentAnimationName,display:t.display,animationData:e}})}this.mCurrentAnimationName=t.currentAnimationName||"idle",this.mDirection=t.direction,this.mNickname=t.nickname,this.mBindID=t.bindId,this.mAlpha=void 0===t.opacity?1:t.opacity/100,this.mDisplayBadgeCards=t.displayBadgeCards}toSprite(){const t=r.op_client.Sprite.create();if(t.id=this.id,this.mDisplayInfo instanceof X){t.display=this.mDisplayInfo.display,t.currentAnimationName=this.currentAnimationName;const e=r.op_def.PBPoint3f.create();e.x=this.pos.x,e.y=this.pos.y,e.z=this.pos.z,t.point3f=e,t.animations=this.displayInfo.toClient()}return t.direction=this.direction,t.bindId=this.bindID,t}newID(){this.mID=Z.genId()}get id(){return this.mID}get pos(){return this.mPos}set pos(t){this.mPos=t}get avatar(){return this.mAvatar}get currentAnimationName(){return this.mCurrentAnimationName}get direction(){return this.mDirection}get nickname(){return this.mNickname}get bindID(){return this.mBindID}set bindID(t){this.mBindID=t}get alpha(){return this.mAlpha}get walkableArea(){return this.mWalkableArea}get collisionArea(){return this.mCollisionArea}get originPoint(){return this.mOriginPoint}get walkOriginPoint(){return this.mWalkOriginPoint}get slot(){return this.getSlots()}get maxNum(){return this.mMaxNum}get camp(){return this.mCamp}get attributes(){return this.mAttributes}get package(){return this.mPackage}set package(t){this.mPackage=t}get sceneId(){return this.mSceneId}get uuid(){return this.mUuid}get displayBadgeCards(){return this.mDisplayBadgeCards}get platformId(){return this.mPlatformId}get displayInfo(){return this.mDisplayInfo}getSlots(){if(void 0===this.mSlot)return null;const t=this.slot.length;let e,i;const s=[];for(let a=0;a<t;a++)e=new U,i=this.getAttriByKey(this.mSlot[a].bondAttrCurkey),e.bondAttrCur=i.intVal,i=this.getAttriByKey(this.mSlot[a].bondAttrMaxkey),e.bondAttrMax=i.intVal,e.bondName=this.slot[a].bondName,e.color=this.slot[a].color,s.push(e);return s}getSlotByName(t){if(void 0===this.mSlot)return null;const e=this.slot.length;let i,s;for(let a=0;a<e;a++)if(this.slot[a].bondName===t)return i=new U,s=this.getAttriByKey(this.mSlot[a].bondAttrCurkey),i.bondAttrCur=s.intVal,s=this.getAttriByKey(this.mSlot[a].bondAttrMaxkey),i.bondAttrMax=s.intVal,i.bondName=this.slot[a].bondName,i.color=this.slot[a].color,i;return null}getAttriByKey(t){if(void 0===this.attributes)return null;const e=this.attributes.length;for(let i=0;i<e;i++)if(this.attributes[i].name===t)return this.attributes[i];return null}get originCollisionPoint(){return this._originCollisionPoint}get originWalkPoint(){return this._originWalkPoint}setOriginCollisionPoint(t){void 0===this._originCollisionPoint&&(this._originCollisionPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originCollisionPoint.x=t[0],this._originCollisionPoint.y=t[1])}setOriginWalkPoint(t){void 0===this._originWalkPoint&&(this._originWalkPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originWalkPoint.x=t[0],this._originWalkPoint.y=t[1])}}class q extends a.PacketHandler{constructor(t){super(),this.mRoom=t,this.mElements=new Map,this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,this.onAdd),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,this.onRemove),this.addHandlerFun(r.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_MOVE_ELEMENT,this.onMove),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,this.onAdjust),this.addHandlerFun(r.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_SET_ELEMENT_POSITION,this.onSetPosition)),this.mRoom&&this.mRoom.world&&(this.mGameConfig=this.mRoom.world.elementStorage)}init(){}get(t){const e=this.mElements.get(t);if(e)return e}remove(t){const e=this.mElements.get(t);e&&(this.mElements.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))}add(t){}destroy(){this.connection&&this.connection.removePacketListener(this),this.mElements&&(this.mElements.forEach(t=>this.remove(t.id)),this.mElements.clear())}get camera(){return this.mRoom.cameraService.camera}get connection(){if(this.mRoom)return this.mRoom.connection;o.a.getInstance().log("roomManager is undefined")}onAdjust(t){const e=t.content,i=e.spritePositions;if(e.nodeType!==r.op_def.NodeType.ElementNodeType)return;let s,a;for(const t of i)(s=this.mElements.get(t.id))&&(a=t.point3f,s.setPosition(new A.a(0|a.x,0|a.y,0|a.z)))}onAdd(t){if(!this.mRoom.layerManager)return void o.a.getInstance().error("layer manager does not exist");if(!this.mGameConfig)return void o.a.getInstance().error("gameConfig does not exist");const e=t.content,i=e.sprites;if(!i)return;if(e.nodeType!==r.op_def.NodeType.ElementNodeType)return;let s;for(const t of i)(s=t.point3f)&&this._add(new J(t))}_add(t){let e=this.mElements.get(t.id);e||(e=new G(t,this)),this.mElements.set(e.id||0,e),this.roomService.blocks.add(e)}get roomService(){return this.mRoom}get scene(){if(this.mRoom)return this.mRoom.scene}onRemove(t){const e=t.content,i=e.nodeType,s=e.ids;if(i===r.op_def.NodeType.ElementNodeType)for(const t of s)this.remove(t)}onMove(t){}onSetPosition(t){}}!function(t){t.IDLE="idle",t.WALK="walk",t.RUN="run",t.ATTACK="attack",t.JUMP="jump",t.INJURED="injured",t.FAILED="failed",t.DANCE01="dance01",t.DANCE02="dance02",t.FISHING="fishing",t.GREET01="greet01",t.SIT="sit",t.LIE="lit",t.EMOTION01="emotion01"}(Q||(Q={}));class tt extends G{constructor(t,e){super(t,e),this.mElementManager=e,this.nodeType=r.op_def.NodeType.CharacterNodeType,this.mDisplay&&t.displayBadgeCards&&t.displayBadgeCards.length>0&&this.mDisplay.setDisplayBadges(t.displayBadgeCards)}move(t){this.getDirection()!==t.direction&&this.mId!==this.roomService.actor.id&&this.setDirection(t.direction),o.a.getInstance().log("dir0:"+t.direction),super.move(t)}setDirection(t){t!==this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t,this.mDisplay.play(this.mCurState))}changeState(t){this.mCurState!==t&&(t||(t="idle"),this.mCheckStateHandle(t)&&(this.mCurState=t,this.mDisplay.play(t)))}removeDisplay(){super.removeDisplay()}destroy(){super.destroy()}onMoveStart(){this.changeState(Q.WALK)}mCheckStateHandle(t){return!0}}class et extends a.PacketHandler{constructor(t){super(),this.mRoom=t,this.mPlayerMap=new Map,this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,this.onAdd),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,this.onRemove),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,this.onAdjust),this.addHandlerFun(r.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_MOVE_CHARACTER,this.onMove),this.addHandlerFun(r.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_SET_CHARACTER_POSITION,this.onSetPosition),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_EFFECT,this.onShowEffect),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ONLY_BUBBLE,this.onShowBubble),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,this.onShowBubble))}destroy(){this.connection&&this.connection.removePacketListener(this),this.mPlayerMap&&(this.mPlayerMap.forEach(t=>this.removeFromMap(t.id)),this.mPlayerMap.clear())}removeFromMap(t){const e=this.mPlayerMap.get(t);e&&(this.mPlayerMap.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))}startActorMove(){this.mRoom.actor?this.mRoom.actor.startMove():o.a.getInstance().error("MainHero miss")}stopActorMove(){this.mRoom.actor?this.mRoom.actor.stopMove():o.a.getInstance().error("MainHero miss")}get(t){if(!this.mPlayerMap)return;let e=this.mPlayerMap.get(t);if(!e){const i=this.roomService.actor;i&&i.id===t&&(e=i)}return e}add(t){}remove(t){const e=this.mPlayerMap.get(t);e&&(this.mPlayerMap.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))}set(t,e){this.mPlayerMap||(this.mPlayerMap=new Map),this.mPlayerMap.set(t,e)}get camera(){return this.mRoom.cameraService.camera}addPackItems(t,e){const i=this.mPlayerMap.get(t);if(i){const t=i.model;t.package||(t.package=r.op_gameconfig.Package.create()),t.package.items=t.package.items.concat(e),i===this.mRoom.getHero()&&this.mRoom.world.emitter.emit(V.a.UPDATED_CHARACTER_PACKAGE)}}removePackItems(t,e){const i=this.mPlayerMap.get(t);if(i){const t=i.model,s=t.package.items.length;for(let i=0;i<s;i++)if(e===t.package.items[i].id)return t.package.items.splice(i,1),!0}return!1}onAdjust(t){const e=t.content,i=e.spritePositions;if(e.nodeType===r.op_def.NodeType.CharacterNodeType&&this.mRoom.actor){let t,e;for(const s of i){if(!(t=this.mPlayerMap.get(s.id))){if(s.id!==this.mRoom.actor.id)continue;t=this.mRoom.actor}e=s.point3f,t.setPosition(new A.a(0|e.x,0|e.y,0|e.z)),o.a.getInstance().debug(`adjust,x:${e.x},y:${e.y}`)}}}onAdd(t){this.mPlayerMap||(this.mPlayerMap=new Map);const e=t.content,i=e.sprites;if(e.nodeType===r.op_def.NodeType.CharacterNodeType)for(const t of i)this._add(new J(t))}_add(t){if(this.mPlayerMap||(this.mPlayerMap=new Map),!this.mPlayerMap.has(t.id)){const e=new tt(t,this);this.mPlayerMap.set(e.id||0,e),this.roomService.blocks.add(e)}}onRemove(t){const e=t.content,i=e.nodeType,s=e.ids;if(i===r.op_def.NodeType.CharacterNodeType)for(const t of s)this.removeFromMap(t)}onMove(t){const e=t.content;if(e.moveData){const t=e.moveData,i=t.length;let s,a,r;for(let e=0;e<i;e++)a=(s=t[e]).moveObjectId,(r=this.get(a))&&r.move(s)}}onSetPosition(t){}onShowBubble(t){const e=t.content,i=this.get(e.chatSenderid);i&&i.showBubble(e.chatContext,e.chatSetting)}onShowEffect(t){const e=t.content.id;let i;for(const t of e)(i=this.get(t))&&i.showEffected()}get roomService(){return this.mRoom}get scene(){if(this.mRoom)return this.mRoom.scene}get connection(){if(this.mRoom)return this.mRoom.connection;o.a.getInstance().error("room is undefined")}}class it extends Phaser.GameObjects.Graphics{constructor(t){super(t)}draw(t){if(this.clear(),!t||!t.roomSize)return;this.lineStyle(1,16777215);const e=t.roomSize.rows,i=t.roomSize.cols;for(let i=0;i<=e;i++)this.drawLine(t.transformTo90(new A.a(i,0)),t.transformTo90(new A.a(i,e)));for(let e=0;e<=i;e++)this.drawLine(t.transformTo90(new A.a(0,e)),t.transformTo90(new A.a(i,e)))}drawLine(t,e){this.lineBetween(t.x,t.y,e.x,e.y)}}class st{constructor(t){this.room=t,this.mSurfaceInteractived=!0,this.mDelta=0,this.mScene=t.scene,this.mGroundClickLayer=this.mScene.add.container(0,0),this.mUGroundLayer2=this.mScene.add.container(0,0),this.mGroundLayer=this.mScene.add.container(0,0),this.mTileLayer=new it(this.mScene),this.mScene.sys.displayList.add(this.mTileLayer),this.mSurfaceLayer=this.mScene.add.container(0,0),this.mAtmosphere=this.mScene.add.container(0,0),this.mSceneUILayer=this.mScene.add.container(0,0),this.mUILayer=this.mScene.add.container(0,0).setScrollFactor(0)}addToGround(t){const e=[].concat(t);this.mGroundLayer.add(e)}addToSurface(t){const e=[].concat(t);this.mSurfaceLayer.add(e)}addToSceneToUI(t){this.mSceneUILayer.add(t)}addToUI(t){this.mUILayer.add(t)}addToAtmosphere(t){this.mAtmosphere.add(t)}resize(t,e){}addMouseListen(){}sortSurface(){this.mSurfaceLayer.sort("depth")}changeScene(){this._clearLayer()}drawGrid(t){this.mTileLayer&&this.mTileLayer.draw(t)}setGridVisible(t){this.mTileLayer&&this.mTileLayer.setVisible(t)}update(t,e){t-this.mDelta<3e3||(this.mDelta=t,this.mDepthGround&&(this.mGroundLayer.sort("depth"),this.mDepthGround=!1),this.mDepthSurface&&(this.mDepthSurface=!1,this.mSurfaceLayer.sort("depth",(t,e)=>{return Math.atan2(t.sortY-e.sortY,t.sortX-e.sortX)*(180*Math.PI)>=70?1:-1})))}setSurfaceInteractive(t){if(this.mSurfaceInteractived===t)return;const e=this.mSurfaceLayer.list;t?e.forEach(t=>{t.setInteractive()}):e.forEach(t=>{t.disableInteractive()})}destroy(){this.mDelta=0,this._clearLayer()}_clearLayer(){this.clearLayer(this.mGroundClickLayer),this.clearLayer(this.mGroundLayer),this.clearLayer(this.mSurfaceLayer),this.clearLayer(this.mUGroundLayer2),this.clearLayer(this.mUILayer),this.clearLayer(this.mAtmosphere),this.mTileLayer.destroy(!0)}clearLayer(t,e=!1){const i=t.list;if(i){const t=i.length;let s;for(let a=0;a<t;a++)(s=i[a])&&(s.destroy(e),s=null)}t.destroy(e)}set depthSurfaceDirty(t){this.mDepthSurface=t}set depthGroundDirty(t){this.mDepthGround=t}get layer(){return this.mGroundLayer}}class at extends k{}class rt extends L{constructor(t,e){super(),this.mElementManager=e,this.mId=t.id,this.mModel=t;let i=null;(i=t.displayInfo?t.displayInfo:this.mElementManager.roomService.world.elementStorage.getObject(t.bindID||t.id))?(this.mDisplayInfo=i,this.createDisplay(),this.setPosition45(t.pos),this.mDisplay.changeAlpha(t.alpha)):o.a.getInstance().error("object does not exist")}play(t){this.mAnimationName!==t&&(this.mAnimationName=t,this.mDisplay&&this.mDisplay.play(this.mAnimationName))}setDirection(t){this.mDisplayInfo&&this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t)}getDirection(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3}setPosition(t){this.mDisplay&&this.mDisplay.setPosition(t.x,t.y,t.z),this.setDepth()}getPosition(){let t;return t=this.mDisplay?new A.a(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z):new A.a(0,0,0)}getPosition45(){const t=this.getPosition();if(t)return this.roomService.transformTo45(t)}showEffected(){}removeMe(){this.mElementManager&&this.mElementManager.remove(this.id)}toSprite(){const t=r.op_client.Sprite.create();if(t.id=this.id,this.mDisplay){const t=this.getPosition45();this.mDisplay.x=t.x,this.mDisplay.y=t.y}return t}createDisplay(){if(!this.mDisplayInfo)return void o.a.getInstance().error("displayinfo does not exist, Create display failed");if(this.mDisplay)return this.mDisplay;const t=this.mElementManager.scene;return t&&(this.mDisplay=new at(t,this.mElementManager.roomService,this)),this.mDisplay}addDisplay(){if(this.createDisplay(),!this.mDisplay)return void o.a.getInstance().error("display does not exist");if(this.mDisplay.load(this.mDisplayInfo),!this.mElementManager)return void o.a.getInstance().error("element manager does not exist");const t=this.mElementManager.roomService;t?(t.addToGround(this.mDisplay),this.setDepth()):o.a.getInstance().error("roomService does not exist")}setDepth(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.y),!this.roomService)throw new Error("roomService is undefined");const t=this.roomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthGroundDirty=!0}}setPosition45(t){if(!this.roomService)return void o.a.getInstance().error("roomService does not exist");const e=this.roomService.transformTo90(t);this.setPosition(e)}get id(){return this.mId}get dir(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3}get roomService(){if(this.mElementManager)return this.mElementManager.roomService;o.a.getInstance().error("element manager is undefined")}get model(){return this.mModel}}class nt extends a.PacketHandler{constructor(t,e){super(),this.mRoom=t,this.mTerrains=new Map,this.mPacketFrameCount=0,this.mListener=e,this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,this.onAdd),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,this.onRemove)),this.mRoom&&this.mRoom.world&&(this.mGameConfig=this.mRoom.world.elementStorage)}init(){}destroy(){this.connection&&this.connection.removePacketListener(this),this.mTerrains&&(this.mTerrains.forEach(t=>this.remove(t.id)),this.mTerrains.clear())}get(t){const e=this.mTerrains.get(t);if(e)return e}add(t){}remove(t){if(!this.mTerrains)return;const e=this.mTerrains.get(t);e&&(this.mTerrains.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))}onAdd(t){if(this.mPacketFrameCount++,!this.mGameConfig)return void o.a.getInstance().error("gameconfig is undefined");const e=t.content,i=e.sprites,s=e.nodeType,a=e.packet;if(s!==r.op_def.NodeType.TerrainNodeType)return;let n;for(const t of i)(n=t.point3f)&&this._add(new J(t));this.mListener&&this.mPacketFrameCount===a.totalFrame&&this.mListener.onFullPacketReceived(s)}_add(t){let e=this.mTerrains.get(t.id);e||((e=new rt(t,this)).setRenderable(!0),this.mTerrains.set(e.id||0,e),this.roomService.blocks.add(e))}onRemove(t){const e=t.content,i=e.nodeType,s=e.ids;if(i===r.op_def.NodeType.TerrainNodeType){for(const t of s)this.remove(t);o.a.getInstance().log("remove terrain length: ",s.length)}}get connection(){if(this.mRoom)return this.mRoom.connection;o.a.getInstance().error("room manager is undefined")}get roomService(){return this.mRoom}get scene(){if(this.mRoom)return this.mRoom.scene}get camera(){return this.camera}}var ot=Phaser.Geom.Rectangle;class ht extends ot{constructor(t,e,i,s){super(t,e,i,s),this.row=t,this.col=e,this.endRow=i,this.endCol=s}}class lt extends a.PacketHandler{constructor(t){super(),this.mRoomService=t,this.MINI_VIEW_SIZE=18,this.VIEW_PORT_SIZE=20,this.viewPort=new Phaser.Geom.Rectangle,this.miniViewPort=new Phaser.Geom.Rectangle}getViewPort(){if(!this.mCamera)return;const t=this.mCamera.worldView;return this.viewPort.x=t.x+(t.width-this.viewPort.width>>1),this.viewPort.y=t.y+(t.height-this.viewPort.height>>1),this.viewPort}getMiniViewPort(){if(!this.mCamera)return;const t=this.mCamera.worldView;this.miniViewPort.x=t.x+(t.width-this.miniViewPort.width>>1),this.miniViewPort.y=t.y+(t.height-this.miniViewPort.height>>1);const e=this.mRoomService.transformTo45(new A.a(this.miniViewPort.x+(this.miniViewPort.width>>1),this.miniViewPort.y));return new ht(e.x,e.y,this.MINI_VIEW_SIZE,this.MINI_VIEW_SIZE)}set camera(t){this.mCamera=t,this.setViewPortSize()}get camera(){return this.mCamera}resize(t,e){this.resetCameraSize(t,e)}startFollow(t){this.mCamera&&this.mCamera.startFollow(t)}setBounds(t,e,i,s,a){this.mCamera?this.mCamera.setBounds(t,e,i,s,a):o.a.getInstance().error("camera does not exist")}resetCameraSize(t,e){if(!this.connection)return void o.a.getInstance().error("connection is undefined");const i=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_RESET_CAMERA_SIZE),s=i.content;s.width=t,s.height=e,this.connection.send(i)}setViewPortSize(){if(!this.mCamera)return void o.a.getInstance().error("camera does not exist");const t=this.mRoomService.roomSize;if(!t)return void o.a.getInstance().error("room size does not exist");const e=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileWidth/2),i=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileHeight/2);this.viewPort.setSize(e,i);const s=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileWidth/2),a=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileHeight/2);this.miniViewPort.setSize(s,a)}get connection(){if(this.mRoomService)return this.mRoomService.connection;o.a.getInstance().error("room service is undefined")}}class ct{constructor(t,e){this.mRect=t,this.mElements=[],this.mIndex=e}add(t,e){this.mElements.push(t);const i=t.getPosition45();t.setRenderable(e.contains(i.x,i.y)&&this.mInCamera)}remove(t){const e=this.mElements.indexOf(t);return-1!==e&&(this.mElements.splice(e,1),!0)}check(t,e){if(!t)return;const i=Phaser.Geom.Intersects.RectangleToRectangle(t,this.rectangle);if(e){if(this.mInCamera)for(const t of this.mElements){const i=t.getPosition45();t.setRenderable(e.contains(i.x,i.y),1200)}this.mInCamera=i}}get rectangle(){return this.mRect||void 0}}class dt{constructor(t){this.mBlocks=[],this.mDelay=0,this.mCameras=t}add(t){const e=this.mCameras.getMiniViewPort();for(const i of this.mBlocks){const s=i.rectangle,a=t.getPosition();if(!a)return;if(s.contains(a.x,a.y))return void i.add(t,e)}}remove(t){if(t)for(const e of this.mBlocks)if(e.remove(t))return}int(t){if(!t)return;this.mBlocks=[];const e=t.tileWidth/2*20,i=t.tileHeight/2*20,s=t.sceneWidth/e,a=t.sceneHeight/i;let r=0;for(let t=0;t<s;t++)for(let s=0;s<a;s++){const a=new ct(new Phaser.Geom.Rectangle(t*e,s*i,e,i),r++);this.mBlocks.push(a)}}update(t,e){if(!this.mCameras)return;if(t-this.mDelay<3e3)return;this.mDelay=t;const i=this.mCameras.getViewPort(),s=this.mCameras.getMiniViewPort();for(const t of this.mBlocks)t.check(i,s)}destroy(){this.mDelay=0}}class mt{static median(t){const e=t.sort((t,e)=>e-t),i=Math.floor(e.length/2);if(e.length%2==0){return(e[i-1]+e[i])/2}return e[i]}}const ut=7,pt=2,gt=12e4,ft=100;class _t extends a.PacketHandler{constructor(t,e){super(),this.mAutoSync=!1,this.mLatency=[],this.mConn=t,this.mConn.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SYNC_TIME,this.proof),this.mListener=e,this._check()}get sysUnixTime(){return(new Date).getTime()}set unixTime(t){this.mTimestamp=t}get unixTime(){return this.mTimestamp}sync(t=1){if(this.mConn){t<0&&(this.mAutoSync=!0,t=1);for(let e=0;e<t;++e){const t=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_TIME);t.content.clientStartTs=this.sysUnixTime,this.mConn.send(t)}}}update(t,e){this.mTimestamp?this.mTimestamp+=e:this.mTimestamp=t}destroy(){this.mConn&&(this.mConn.removePacketListener(this),this.mConn=void 0),this.mIntervalId&&clearInterval(this.mIntervalId),this.mLatency=void 0}_check(){const t=this;this.mIntervalId=setInterval(()=>{t.sync()},gt)}proof(t){const e=t.content,i=this.sysUnixTime,s=e.clientStartTs,a=e.serverReceiveTs,r=e.serverSendTs,n=r-a,h=i-s-n,l=Math.round(h/2);let c=0;if(l<0)return;this.mLatency.push(l),this.mLatency.length>ut&&this.mLatency.shift();const d=r-(c=mt.median(this.mLatency)+n),m=Math.abs(d-this.mTimestamp);m>ft&&(this.mTimestamp=d,this.mAutoSync)?this.sync(-1):(this.mListener&&(this.mLatency.length>=pt||this.mAutoSync)&&this.mListener.onClockReady(),o.a.getInstance().debug(`total_delay: ${h} / latency: ${l} | timeSychronDelta: ${c} / remote_time: ${d} / mistake: ${m}`))}}class yt{constructor(){this.mapId=1,this.zStart=0,this.zEnd=0,this._mapTotalWidth=0,this._bgSound=1,this._voiceChatRoomId=0,this._mapTotalHeight=0}get bgSound(){return this._bgSound}set bgSound(t){this._bgSound=t}get mapTotalWidth(){return this._mapTotalWidth}get mapTotalHeight(){return this._mapTotalHeight}get tileWidth(){return this._tileWidth}get tileHeight(){return this._tileHeight}get terrainConfig(){return this._terrainConfig}get elementConfig(){return this._elementConfig}get cols(){return this._cols}set cols(t){this._cols=t}get rows(){return this._rows}set rows(t){this._rows=t}get voiceChatRoomId(){return this._voiceChatRoomId}set voiceChatRoomId(t){this._voiceChatRoomId=t}setConfig(t,e,i,s,a,r){this._cols=t,this._rows=e,this.zStart=i,this.zEnd=s,this._tileWidth=a,this._tileHeight=r,this._mapTotalWidth=(this._rows+this._cols)*(this._tileWidth/2),this._mapTotalHeight=(this._rows+this._cols)*(this._tileHeight/2)}setTerrainInfo(t){this._terrainConfig=[];const e=t.length;let i;for(let s=0;s<e;s++)i=new X(t[s]),this._terrainConfig.push(i)}addTerrainInfo(t){const e=t.length;let i;for(let s=0;s<e;s++)i=new X(t[s]),this._terrainConfig.push(i)}setElementInfo(t){this._elementConfig=[];const e=t.length;let i;for(let s=0;s<e;s++)i=new X(t[s]),this._elementConfig.push(i)}addElementInfo(t){const e=t.length;let i;for(let s=0;s<e;s++)i=new X(t[s]),this._elementConfig.push(i)}addPackItems(t,e){const i=this.getElementInfo(t);i&&(i.package||(i.package=r.op_gameconfig.Package.create()),i.package.items=i.package.items.concat(e))}removePackItems(t,e){const i=this.getElementInfo(t);if(i){const t=i.package.items.length;for(let s=0;s<t;s++)if(e===i.package.items[s].id)return i.package.items.splice(s,1),!0}return!1}getElementInfo(t){const e=this._elementConfig.length;for(let i=0;i<e;i++)if(this._elementConfig[i].id===t)return this._elementConfig[i];return null}}class vt extends a.PacketHandler{constructor(t){super(),this.mWorld=t,this.emitter=this.mWorld.emitter,this.mMapModel=new yt}initialize(){return this.mInitialize}getMapModel(){return this.mMapModel}register(){}unRegister(){}destroy(){this.mInitialize=!1,this.mMapModel=null,this.emitter=null}setMapInfo(t){this.mMapModel.mapId=t.id,this.mMapModel.voiceChatRoomId=t.voiceChatRoomId,this.mMapModel.setConfig(t.cols,t.rows,t.zStart,t.zEnd,t.tileWidth,t.tileHeight),this.mMapModel.setTerrainInfo(t.terrains),this.mMapModel.setElementInfo(t.elements),!1===this.mInitialize&&(this.mInitialize=!0,this.emitter.emit(V.a.SCENE_DATA_INITIALIZE))}addPackItems(t,e){this.mMapModel.addPackItems(t,e)}removePackItems(t,e){this.mMapModel.removePackItems(t,e)}}vt.NAME="Map";class St extends a.PacketHandler{constructor(t){super(),this.mWorld=t,this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ADD_ITEM,this.handleAddItem),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_REMOVE_ITEM,this.handleRemoveItem),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EXCHANGE_ITEM_POS,this.handleExchangeItem),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QUERY_PACKAGE,this.handleQueryPackage)}initialize(){return this.mInitialize}register(){this.mWorld.connection.addPacketListener(this)}unRegister(){this.mWorld.connection.removePacketListener(this)}destroy(){this.mInitialize=!1,this.mWorld.connection.removePacketListener(this)}requestVirtualWorldQueryPackage(t,e,i){const s=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),n=s.content;n.id=t,n.page=e,n.perPage=i,this.mWorld.connection.send(s)}handleQueryPackage(t){const e=t.content;this.mInitialize=!0,this.mWorld.emitter.emit(V.a.QUERY_PACKAGE,e)}handleAddItem(t){const e=t.content;e.nodetype===r.op_def.NodeType.ElementNodeType?this.mWorld.roomManager.currentRoom.map.addPackItems(e.id,e.item):e.nodetype===r.op_def.NodeType.CharacterNodeType&&this.mWorld.roomManager.currentRoom.playerManager.addPackItems(e.id,e.item),this.mWorld.emitter.emit(V.a.PACKAGE_ITEM_ADD,e)}handleRemoveItem(t){const e=t.content,i=e.itemId.length;for(let t=0;t<i;t++)this.mWorld.roomManager.currentRoom.playerManager.removePackItems(e.id,e.itemId[t]);this.mWorld.emitter.emit(V.a.UPDATED_CHARACTER_PACKAGE),this.mWorld.emitter.emit(V.a.PACKAGE_ITEM_REMOVE,e)}handleExchangeItem(t){const e=t.content;this.mWorld.emitter.emit(V.a.PACKAGE_EXCHANGE_ITEM_POS,e)}}class bt extends a.PacketHandler{constructor(t){super(),this.mWorld=t}initialize(){return this.mInitialize}register(){this.mWorld.connection.addPacketListener(this)}unRegister(){this.mWorld.connection.removePacketListener(this)}destroy(){this.mInitialize=!1,this.mWorld.connection.removePacketListener(this)}requestTargetUI(t,e){const i=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),s=i.content;s.uiId=t,s.componentId=e,this.mWorld.connection.send(i)}}class Tt extends tt{constructor(t,e){if(super(t,e),this.mElementManager=e,this.mRenderable=!0,this.addDisplay(),this.mRoom=this.mElementManager.roomService,this.mRoom.world.inputManager.addListener(this),this.mElementManager){const t=this.mElementManager.roomService;t&&t.cameraService&&t.cameraService.startFollow(this.mDisplay)}this.model&&this.model.package&&(this.mBag=new St(e.roomService.world),this.mBag.register()),this.mRoom.playerManager.set(this.id,this),this.mInteractive=new bt(e.roomService.world),this.mInteractive.register()}getBag(){return this.mBag}getInteractive(){return this.mInteractive}setRenderable(t){}destroy(){this.mBag&&(this.mBag.destroy(),this.mBag=null),super.destroy()}downHandler(t,e){this.mRoom.requestActorMove(t,e)}upHandler(){this.stopMove()}stopMove(){if(super.stopMove(),!this.mMoveData)return;delete this.mMoveData.destPos,this.mMoveData.arrivalTime=0,this.mMoveData.tweenAnim&&(this.mMoveData.tweenAnim.stop(),this.mMoveData.tweenAnim.remove());const t=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_STOP_SPRITE),e=t.content;e.nodeType=this.nodeType;const i=this.getPosition();e.spritePositions={id:this.id,point3f:{x:i.x,y:i.y,z:i.z},direction:this.dir},this.mElementManager.connection.send(t)}move(t){"walk"===this.mCurState&&super.move(t)}onMoveStart(){}onMoveComplete(){"walk"===this.mCurState?this._doMove():this.mMoveData.tweenAnim.stop()}onMoving(){"walk"===this.mCurState?super.onMoving():this.mMoveData.tweenAnim.stop()}}class Dt extends J{constructor(t){super(t),this.mPos=new A.a(t.x,t.y,t.z),this.mAlpha=1,this.mWalkableArea=t.walkableArea,this.mCollisionArea=t.collisionArea,this.mOriginPoint=t.originPoint,this.mWalkOriginPoint=t.walkOriginPoint,this.mSlot=t.slot,this.mMaxNum=t.maxNum,this.mCamp=t.camp,this.mAttributes=t.attributes,this.mPackage=t.package,this.mSceneId=t.sceneId,this.mUuid=t.uuid,this.mPlatformId=t.platformId}}var xt,Pt=i(196),Ct=i.n(Pt);class wt extends a.PacketHandler{constructor(t){if(super(),this.manager=t,this.clockSyncComplete=!1,this.mCheckBlock=!1,this.mWorld=this.manager.world,this.mCameraService=new lt(this),this.mWorld){const t=this.mWorld.getSize();if(!t)throw new Error("World::getSize undefined!");this.mCameraService.resize(t.width,t.height)}}enter(t){this.mWorld.getSize();if(t){if(this.mID=t.id,this.mSize={cols:t.rows,rows:t.cols,tileHeight:t.tileHeight,tileWidth:t.tileWidth,sceneWidth:(t.rows+t.cols)*(t.tileWidth/2),sceneHeight:(t.rows+t.cols)*(t.tileHeight/2)},this.blockCheckWorker=new Ct.a,this.mScene=this.mWorld.game.scene.getScene(v.name),this.mMap=new vt(this.mWorld),this.mMap.setMapInfo(t),this.mClock=new _t(this.mWorld.connection,this),this.mTerainManager=new nt(this,this),this.mElementManager=new q(this),this.mPlayerManager=new et(this),this.mBlocks=new dt(this.mCameraService),this.mLayManager=new st(this),this.scene){this.mCameraService.camera=this.scene.cameras.main;this.mBlocks.int(this.mSize)}this.mWorld.game.scene.getScene(g.name)||this.mWorld.game.scene.add(g.name,g),this.mWorld.game.scene.start(g.name,{world:this.world,room:this})}else o.a.getInstance().error("wrong room")}onFullPacketReceived(t){r.op_def.NodeType.TerrainNodeType}onClockReady(){o.a.getInstance().debug("onClockReady"),this.clockSyncComplete=!0}startLoad(){this.mClock.sync(-1)}completeLoad(){this.mScene.scene.isActive()?this.mWorld.changeScene():this.mWorld.game.scene.start(v.name,{room:this})}startPlay(){this.connection&&this.connection.send(new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED)),this.mActor=new Tt(new Dt(this.mActorData),this.mPlayerManager);const t=this.mWorld.game.scene.getScene(g.name);t&&t.sleep()}pause(){this.mScene.scene.pause(),this.clockSyncComplete=!1}resume(t){this.mScene.scene.resume(t),this.mClock.sync(-1)}getHero(){return this.mActor}requestActorMove(t,e){this.mActor.setDirection(t),this.playerManager.startActorMove();const i=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN);i.content.keyCodes=e,this.connection.send(i)}addActor(t){this.mActorData=t}addToGround(t){this.layerManager.addToGround(t)}addToSurface(t){this.layerManager.addToSurface(t)}addToSceneUI(t){this.layerManager.addToSceneToUI(t)}addToUI(t){this.layerManager.addToUI(t)}resize(t,e){this.layerManager.resize(t,e),this.mCameraService.resize(t,e)}transformTo90(t){if(this.mSize)return B.transformTo90(t,this.mSize);o.a.getInstance().error("position object is undefined")}transformTo45(t){if(this.mSize)return B.transformTo45(t,this.mSize);o.a.getInstance().error("position object is undefined")}addMouseListen(){this.layerManager.addMouseListen()}update(t,e){this.updateClock(t,e),this.mBlocks.update(t,e),this.layerManager&&this.layerManager.update(t,e)}updateClock(t,e){this.mClock&&this.mClock.update(t,e)}now(){return this.mClock.unixTime}get scene(){return this.mScene||void 0}get terrainManager(){return this.mTerainManager||void 0}get elementManager(){return this.mElementManager||void 0}get playerManager(){return this.mPlayerManager||void 0}get map(){return this.mMap}get layerManager(){return this.mLayManager||void 0}get cameraService(){return this.mCameraService||void 0}get id(){return this.mID}get roomSize(){return this.mSize||void 0}get blocks(){return this.mBlocks}get actor(){return this.mActor}get world(){return this.mWorld}get connection(){if(this.manager)return this.manager.connection}clear(){this.mActor.destroy(),this.mLayManager.destroy(),this.mClock.destroy(),this.mTerainManager.destroy(),this.mElementManager.destroy(),this.mPlayerManager.destroy(),this.mBlocks.destroy(),this.mCheckBlock&&this.blockCheckWorker&&this.blockCheckWorker.postMessage({method:"endCheckBlock"}),this.mActorData&&(this.mActorData=null)}destroy(){this.clear(),this.mActor&&this.mActor.destroy(),this.mScene&&(this.mScene.scene.stop(),this.mScene=null)}}!function(t){t.MOVE="move",t.BRUSH="brush",t.SELECT="select",t.ERASER="eraser",t.FILL="FILL"}(xt||(xt={}));class Ot{constructor(t){this.mEditorRoom=t,this.mMode=xt.SELECT}set mode(t){this.mMode=t}get mode(){return this.mMode}}class At extends v{constructor(){super({key:At.name})}create(){this.mRoom.startPlay(),this.scene.sendToBack()}}var Bt,Et=r.op_def.NodeType;class It{constructor(t,e){this.mScene=t,this.mRoomService=e,this.mSize=1}setDisplay(t){this.mScene&&(this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null),this.mSprite=new J(t.sprite),this.mLayerManager=this.mRoomService.layerManager,this.mDisplay=new Mt(this.mScene,this.mRoomService),this.mDisplay.setDisplay(this.mSprite.displayInfo,this.mSize),this.mLayerManager.addToSceneToUI(this.mDisplay),this.mNodeType=t.nodeType,this.mNodeType===Et.TerrainNodeType?this.mElementManager=this.mRoomService.terrainManager:this.mNodeType!==Et.ElementNodeType&&this.mNodeType!==Et.SpawnPointType||(this.mElementManager=this.mRoomService.elementManager),this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("wheel",this.onWheelHandler,this))}createSprites(){if(!this.mSprite)return;const t=[];let e=null;const i=this.mDisplay.displays;for(const s of i)(e=Object.assign(Object.create(Object.getPrototypeOf(this.mSprite)),this.mSprite)).newID(),e.pos=this.getPosition(s.x,s.y),e.bindID=this.mSprite.id,t.push(e);return t}transitionGrid(t,e){const i=new A.a(t,e),s=this.mRoomService.transformToMini45(i);return!1===this.mAlignGrid?this.checkBound(s,i):this.checkBound(s)}checkBound(t,e){const i=new A.a(t.x,t.y),s=this.mRoomService.miniSize;return t.x<0?i.x=0:t.x>s.rows&&(i.x=s.rows),t.y<0?i.y=0:t.y>s.cols&&(i.y=s.cols),i.equal(t)&&e?e:this.mRoomService.transformToMini90(i)}destroy(){this.mScene&&(this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("wheel",this.onWheelHandler,this)),this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null),this.mNodeType=Et.UnknownNodeType}onPointerMoveHandler(t){if(!this.mDisplay)return;const e=this.transitionGrid(t.worldX,t.worldY);e&&(this.mDisplay.x=e.x-(this.mDisplay.tileWidth>>1),this.mDisplay.y=e.y-(this.mDisplay.tileHeight>>1))}getPosition(t=0,e=0){if(this.mNodeType===r.op_def.NodeType.TerrainNodeType)return this.mRoomService.transformTo45(new A.a(this.mDisplay.x+t,this.mDisplay.y+e));const i=new A.a(this.mDisplay.x+t,this.mDisplay.y+e,this.mDisplay.z);return i.y+=this.mRoomService.miniSize.tileHeight>>1,i}onWheelHandler(t,e,i,s){t.deltaY<0?this.size--:this.size++}set alignGrid(t){this.mAlignGrid=t}get display(){return this.mDisplay}get sprite(){return this.mSprite}get nodeType(){return this.mNodeType}get elementManager(){return this.mElementManager}get size(){return this.mSize}set size(t){t<1&&(t=1),t>10&&(t=10),this.mSize=t,this.mDisplay.setDisplay(this.mSprite.displayInfo,this.mSize)}}class Mt extends Phaser.GameObjects.Container{constructor(t,e){super(t),this.mRoomService=e}setDisplay(t,e){let i;this.clear(),this.mDisplay=[];const{tileWidth:s,tileHeight:a}=this.mRoomService.roomSize;this.mTileSize={tileWidth:s,tileHeight:a,rows:e,cols:e,sceneWidth:(e+e)*(s/2),sceneHeight:(e+e)*(a/2)};for(let s=0;s<e;s++)for(let a=0;a<e;a++){(i=new k(this.scene,this.mRoomService)).setAlpha(.8),i.load(t),i.once("initialized",this.onInitializedHandler,this);const e=B.transformTo90(new A.a(s,a),this.mTileSize);i.x=e.x,i.y=e.y,this.add(i),this.mDisplay.push(i)}}clear(){this.removeAll(!0),this.mDisplay=void 0}destroy(t){this.clear(),super.destroy(t)}getPosition(){if(!this.parentContainer)return;new A.a(this.parentContainer.x,this.parentContainer.y)}get tileWidth(){return this.mTileSize.sceneWidth}get tileHeight(){return this.mTileSize.sceneHeight}get displays(){return this.mDisplay}onInitializedHandler(t){t&&t.showRefernceArea()}}class kt{constructor(t,e){this.mScene=t,this.mLayerManager=e,o.a.getInstance().log("scene: ",this.mScene,this),this.mEffecte=new O.DynamicImage(this.mScene,0,0),this.mEffecte.load(P.h.getRes("ui/editor/selectFlag.png"))}setElement(t){this.mDisplay&&this.mDisplay.hideRefernceArea(),this.mDisplay=t,t.showRefernceArea(),this.mLayerManager.addToSceneToUI(this.mEffecte),this.update()}remove(){this.mEffecte&&(this.mEffecte.parentContainer&&this.mEffecte.parentContainer.remove(this.mEffecte),this.mDisplay.hideRefernceArea(),this.mDisplay=null)}update(){if(!this.mDisplay)return;const t=this.mDisplay.baseLoc;this.mEffecte.x=this.mDisplay.x+t.x,this.mEffecte.y=this.mDisplay.y+t.y}setDisplayPos(t,e){this.mDisplay&&(this.mDisplay.x=t,this.mDisplay.y=e)}destroy(){this.mEffecte&&(o.a.getInstance().log("destroy"),this.remove(),this.mEffecte.destroy())}get display(){return this.mDisplay}}class Rt extends q{constructor(t){super(t),this.connection&&(this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_CREATE_SPRITE,this.onAdd),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SYNC_SPRITE,this.onSync),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_SPRITE,this.onRemove))}add(t){for(const e of t)this._add(e);const e=new a.PBpacket(r.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_CREATE_SPRITE),i=e.content;i.nodeType=r.op_def.NodeType.ElementNodeType,i.sprites=t.map(t=>t.toSprite()),this.connection.send(e),o.a.getInstance().log("add sprites: ",i)}remove(t){if(this.tryRemove(t)){const e=new a.PBpacket(r.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_DELETE_SPRITE);e.content.ids=[t],this.connection.send(e)}}tryRemove(t){const e=this.mElements.get(t);if(e)return this.mElements.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e),e}onRemove(t){const e=t.content,i=e.nodeType,s=e.ids;if(i===r.op_def.NodeType.ElementNodeType)for(const t of s)this.tryRemove(t)}onSync(t){const e=t.content;if(e.nodeType!==r.op_def.NodeType.ElementNodeType)return;const i=e.sprites;for(const t of i)this.trySync(t)}trySync(t){const e=this.mElements.get(t.id);if(!e)return void o.a.getInstance().log("can't find element",t);const i=t.point3f;i&&e.setPosition(new A.a(i.x,i.y,i.z)),t.direction&&e.setDirection(t.direction)}}class Lt extends nt{constructor(t,e){super(t,e),this.connection&&(this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_CREATE_SPRITE,this.onAdd),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SYNC_SPRITE,this.onSync),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_DELETE_SPRITE,this.onRemove))}add(t){const e=[];for(const i of t)this.canPut(i)&&(this._add(i),e.push(i.toSprite()));if(0===e.length)return;const i=new a.PBpacket(r.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_CREATE_SPRITE),s=i.content;s.nodeType=r.op_def.NodeType.TerrainNodeType,s.sprites=e,this.connection.send(i)}remove(t){if(this.mTerrains&&this.tryRemove(t)){const e=new a.PBpacket(r.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_DELETE_SPRITE);e.content.ids=[t],this.connection.send(e)}}onRemove(t){const e=t.content,i=e.nodeType,s=e.ids;if(i===r.op_def.NodeType.TerrainNodeType)for(const t of s)this.tryRemove(t)}onSync(t){const e=t.content;if(e.nodeType!==r.op_def.NodeType.TerrainNodeType)return;const i=e.sprites;for(const t of i)this.trySync(t)}trySync(t){const e=this.mTerrains.get(t.id);if(!e)return void o.a.getInstance().log("can't find terrain",t);const i=t.point3f;i&&e.setPosition(new A.a(i.x,i.y,i.z))}tryRemove(t){const e=this.mTerrains.get(t);if(e)return this.mTerrains.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e),e}canPut(t){const e=t.pos,i=this.roomService.roomSize;if(!i)return!1;if(e.x<0||e.y<0||e.x>i.rows||e.y>i.cols)return!1;const s=Array.from(this.mTerrains.values());for(const e of s){const i=e.getPosition45();if(t.pos.equal(i))return t.bindID!==e.model.bindID&&(this.remove(e.id),!0)}return!0}}class Ft extends wt{constructor(t){super(t),this.mBrush=new Ot(this),this.connection&&(this.connection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_SET_EDITOR_MODE,this.onSetEditorModeHandler),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_ALIGN_GRID,this.onAlignGridHandler),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_VISIBLE_GRID,this.onVisibleGridHandler),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_MOUSE_FOLLOW,this.onMouseFollowHandler),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_MOUSE_SELECTED_SPRITE,this.onMouseFollowHandler),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_FETCH_SPRITE,this.onFetchSpriteHandler))}enter(t){if(!t)return void o.a.getInstance().error("wrong room");this.mID=t.id;let{rows:e,cols:i,tileWidth:s,tileHeight:a}=t;this.mSize={cols:i,rows:e,tileHeight:a,tileWidth:s,sceneWidth:(e+i)*(s/2),sceneHeight:(e+i)*(a/2)},e*=2,i*=2,s/=2,a/=2,this.mNimiSize={cols:i,rows:e,tileHeight:a,tileWidth:s,sceneWidth:(e+i)*(s/2),sceneHeight:(e+i)*(a/2)},this.mTerainManager=new Lt(this),this.mElementManager=new Rt(this),this.mBlocks=new dt(this.mCameraService),this.mWorld.game.scene.start(At.name,{room:this})}startPlay(){this.mScene=this.mWorld.game.scene.getScene(At.name),this.mLayManager=new st(this),this.mLayManager.drawGrid(this),this.mScene.input.on("pointerdown",this.onPointerDownHandler,this),this.mScene.input.on("pointerup",this.onPointerUpHandler,this),this.mScene.input.on("gameobjectup",this.onGameobjectUpHandler,this),this.mScene.cameras.main.setBounds(-200,-200,this.mSize.sceneWidth+400,this.mSize.sceneHeight+400),this.connection.send(new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED)),this.mScene.input.keyboard.on("keydown",this.onKeyDownHandler,this)}destroy(){this.mWorld&&this.mWorld.connection&&this.mWorld.connection.removePacketListener(this),super.destroy()}update(t,e){this.layerManager&&this.layerManager.update(t,e),this.mSelectedElementEffect&&this.mSelectedElementEffect.update()}transformToMini90(t){if(this.mNimiSize)return B.transformTo90(t,this.mNimiSize);o.a.getInstance().error("position object is undefined")}transformToMini45(t){if(this.mNimiSize)return B.transformTo45(t,this.mNimiSize);o.a.getInstance().error("position object is undefined")}moveCameras(t){const e=this.mScene.cameras.main;e.scrollX+=t.prevPosition.x-t.position.x,e.scrollY+=t.prevPosition.y-t.position.y,this.syncCameras()}createElement(){if(!this.mMouseFollow.sprite)return;const t=this.mMouseFollow.elementManager;if(t){const e=this.mMouseFollow.createSprites();e&&t.add(e)}}onSetEditorModeHandler(t){const e=t.content;this.mBrush.mode=e.mode,this.mMouseFollow&&this.mMouseFollow.destroy(),this.mBrush.mode!==xt.SELECT&&this.mSelectedElementEffect&&(this.mSelectedElementEffect.destroy(),this.mSelectedElementEffect=null),this.layerManager.setSurfaceInteractive(this.mBrush.mode!==xt.ERASER)}onAlignGridHandler(t){const e=t.content;this.mouseFollow.alignGrid=e.align}onVisibleGridHandler(t){const e=t.content;this.layerManager.setGridVisible(e.visible)}onMouseFollowHandler(t){const e=t.content;this.mScene&&this.mouseFollow.setDisplay(e)}onFetchSpriteHandler(t){const e=t.content.ids;if(e.length>0){const t=this.elementManager.get(e[0]);t&&this.selectedElement(t.getDisplay())}}onPointerDownHandler(){this.mScene.input.on("pointermove",this.onPointerMoveHandler,this),this.mScene.input.on("gameobjectover",this.onGameobjectOverHandler,this)}onPointerUpHandler(t){switch(this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("gameobjectover",this.onGameobjectOverHandler,this),this.brush.mode){case xt.BRUSH:this.createElement();break;case xt.SELECT:t.downX!==t.upX&&t.downY!==t.upY&&this.mSelectedElementEffect&&this.syncSprite(this.mSelectedElementEffect.display)}}syncCameras(){if(!this.connection)return;if(!this.mScene||this.mScene.cameras)return;const t=this.mScene.cameras.main.worldView,e=new a.PBpacket(r.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_RESET_CAMERA),i=e.content;i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,this.connection.send(e)}sendFetch(t,e){if(!this.mSelectedElementEffect||!this.mSelectedElementEffect.display)return;const i=new a.PBpacket(r.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_FETCH_SPRITE),s=i.content;s.ids=t,s.nodeType=e,this.connection.send(i),o.a.getInstance().log("fetch sprite",s)}onGameobjectUpHandler(t,e){this.mScene.input.off("pointermove",this.onPointerMoveHandler,this),this.mScene.input.off("gameobjectover",this.onGameobjectOverHandler,this);const i=e.parentContainer;if(i)switch(this.mBrush.mode){case xt.SELECT:const t=this.selectedElement(i);t&&this.sendFetch([t.element.id],r.op_def.NodeType.ElementNodeType);break;case xt.ERASER:this.removeElement(i)}}onGameobjectOverHandler(t,e){const i=e.parentContainer;if(i)switch(this.mBrush.mode){case xt.ERASER:this.removeElement(i)}}selectedElement(t){if(t instanceof I&&!(t instanceof at))return this.mSelectedElementEffect||(this.mSelectedElementEffect=new kt(this.mScene,this.layerManager)),this.mSelectedElementEffect.setElement(t),t}removeElement(t){if(!(t instanceof I))return;if(!this.connection)return;const e=t.element;e&&(e instanceof G||e.removeMe())}syncSprite(t){if(!t)return;const e=t.element;if(!e)return;const i=new a.PBpacket(r.op_editor.OPCODE._OP_CLIENT_REQ_EDITOR_SYNC_SPRITE);i.content.sprites=[e.toSprite()],this.connection.send(i)}onPointerMoveHandler(t){if(this.mScene.cameras)switch(this.mBrush.mode){case xt.BRUSH:this.mMouseFollow.nodeType===r.op_def.NodeType.TerrainNodeType&&this.createElement();break;case xt.MOVE:this.moveCameras(t);break;case xt.SELECT:if(!this.mSelectedElementEffect)return;if(!this.mouseFollow)return;const e=this.mMouseFollow.transitionGrid(t.worldX,t.worldY);e&&(this.mSelectedElementEffect.setDisplayPos(e.x,e.y),this.mLayManager.depthSurfaceDirty=!0)}}onKeyDownHandler(t){if(!this.mSelectedElementEffect)return;const e=this.mSelectedElementEffect.display;if(!e)return;const i=new A.a(e.x,e.y,e.z);switch(t.keyCode){case 37:i.x--;break;case 38:i.y--;break;case 39:i.x++;break;case 40:i.y++}e.setPosition(i.x,i.y,i.z),this.layerManager.depthSurfaceDirty=!0}get brush(){return this.mBrush}get miniSize(){return this.mNimiSize}get mouseFollow(){return this.mMouseFollow||(this.mMouseFollow=new It(this.mScene,this)),this.mMouseFollow}}class Nt extends a.PacketHandler{constructor(t){super(),this.mRooms=[],this.mWorld=t,this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ENTER_SCENE,this.onEnterScene),this.addHandlerFun(r.op_client.OPCODE._OP_EDITOR_REQ_CLIENT_CHANGE_TO_EDITOR_MODE,this.onEnterEditor)}addPackListener(){this.connection&&this.connection.addPacketListener(this)}removePackListener(){this.connection&&this.connection.removePacketListener(this)}getRoom(t){return this.mRooms.find(e=>e.id===t)}onFocus(){this.mRooms.forEach(t=>{t&&t.resume(t.scene.scene.key)})}onBlur(){this.mRooms.forEach(t=>{t&&t.pause()})}pasuseRoom(t){const e=this.mRooms.findIndex((e,i)=>t===e.id);if(e>=0){this.mRooms[e].pause()}}resumeRoom(t){const e=this.mRooms.findIndex((e,i)=>t===e.id);if(e>=0){const t=this.mRooms[e];t.resume(t.scene.scene.key)}}stop(){this.mRooms.forEach(t=>{t&&t.destroy()})}resize(t,e){this.mRooms.forEach(i=>{i&&i.resize(t,e)})}destroy(){this.removePackListener();for(let t of this.mRooms)t.destroy(),t=null;this.mRooms.length=0}hasRoom(t){return this.mRooms.findIndex((e,i)=>t===e.id)>=0}onEnterScene(t){const e=t.content;let i;this.hasRoom(e.scene.id)?i=this.getRoom(e.scene.id):(i=new wt(this),this.mRooms.push(i)),i.addActor(e.actor),i.enter(e.scene),this.mWorld.changeRoom(i),this.mCurRoom=i}onEnterEditor(t){const e=t.content,i=new Ft(this);i.enter(e.scene),this.mCurRoom=i}get world(){return this.mWorld}get currentRoom(){return this.mCurRoom}get connection(){if(this.mWorld)return this.mWorld.connection;o.a.getInstance().error("world manager is undefined")}}class jt extends a.PacketHandler{constructor(t,e){super(),this.worldService=t,this.mInitilized=!0,this.mKeyboardListeners=[],this.mKeyList=[],this.mKeyDownList=[],this.mKeyEvents=e,this.mTmpUpKeysStr="",this.mTmpDownKeyStr="",this.mKeyEventMap=new Map,this.mConnect=this.worldService.connection}onRoomChanged(t,e){if(this.mRoom=t,this.mScene=t.scene,this.mScene){if(this.mKeyEvents){const t=this.mKeyEvents.length;let e,i,s;for(let a=0;a<t;a++)i=(e=this.mKeyEvents[a]).keyCodes,s=e.tqEvent,this.mKeyEventMap.get(s)||this.mKeyEventMap.set(s,e);this.mKeyEvents.length=0,this.mKeyEvents=null}this.mKeyEventMap.forEach(t=>{if(t){const e=t.keyCodes,i=e.length;let s;for(let a=0;a<i;a++){s=e[a];const i=this.mScene.input.keyboard.addKey(s,!1);this.addKeyEvent(i,t.tqEvent)}}})}}getKeyCodes(t){if(this.mKeyEventMap.has(t))return this.mKeyEventMap.get(t).keyCodes}resize(t,e){}addListener(t){this.mKeyboardListeners.push(t)}removeListener(t){const e=this.mKeyboardListeners.indexOf(t);e>=0&&this.mKeyboardListeners.splice(e,1)}set enable(t){this.mScene&&(this.mScene.input.keyboard.enabled=t)}get enable(){return void 0!==this.mScene&&this.mScene.input.keyboard.enabled}get keyList(){return this.mKeyList}getKeyDowns(){return this.mInitilized&&this.mKeyList?(this.mKeyDownList=this.mKeyList.filter(t=>t.isDown),this.mKeyDownList.map(t=>t.keyCode)):[]}getKeyUps(){const t=[];if(!this.mInitilized)return t;if(!this.mKeyDownList)return[];let e;for(let i=0;i<this.mKeyDownList.length;i++)(e=this.mKeyDownList[i])&&e.isUp&&(this.mKeyDownList.splice(i,1),t.push(e.keyCode),i--);return t}destroy(){this.removeKeyEvents(),this.mKeyDownList&&(this.mKeyDownList.length=0,this.mKeyDownList=null),this.mTmpDownKeyStr=null,this.mTmpUpKeysStr=null,this.mScene=null,this.mConnect=null,this.mInitilized=!1}concatArr(t,e){let i;const s=t.length>e.length?e.length:t.length,a=t.length>e.length?t:e,r=t.length>e.length?e:t;for(i=0;i<s;i++)a.push(r[i]);return a}checkMoveKeyDown(t){let e;const i=this.mKeyList,s=i.length,a=[];let n,o=0;const h=this.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_LEFT),l=this.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_DOWN),c=this.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_RIGHT),d=this.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_UP);for(let t=0;t<s;t++)if(n=(e=i[t]).keyCode,e&&e.isDown){if(a.push(e.keyCode),h.indexOf(n)>-1){o+=-1;continue}if(c.indexOf(n)>-1){o+=1;continue}if(l.indexOf(n)>-1){o+=3;continue}if(d.indexOf(n)>-1){o+=-3;continue}}if(0===o)return!1;const m=t.getDirection();let u;switch(o){case-1:u=m<=1?1:3;break;case-2:u=7;break;case-3:u=m<=3?1:7;break;case-4:u=1;break;case 1:u=m<=5?5:7;break;case 2:u=3;break;case 3:u=m<=3?3:5;break;case 4:u=5}return t.setDirection(u),t.downHandler(u,a),this.mRoom&&this.mRoom.actor&&this.mRoom.actor.setDirection(u),!0}checkMoveKeyAllUp(){let t;const e=this.mKeyList,i=e.length;for(let s=0;s<i;s++)if((t=e[s])&&t.isDown)return!1;return!0}addKeyEvent(t,e){t.on("down",this.keyDownHandle,this),t.on("up",this.keyUpHandle,this),this.mKeyList.push(t)}keyDownHandle(t){const e=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),i=e.content,s=this.getKeyDowns();this.mTmpDownKeyStr!==s.toString()&&(this.mTmpUpKeysStr="",this.mTmpDownKeyStr=s.toString(),i.keyCodes=s,this.mConnect.send(e),this.mKeyboardListeners.forEach(t=>{this.checkMoveKeyDown(t)}))}keyUpHandle(t){const e=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_UP),i=e.content,s=this.getKeyUps();this.mTmpUpKeysStr===s.toString()||s.length<1||(this.mTmpDownKeyStr="",this.mTmpUpKeysStr=s.toString(),i.keyCodes=s,this.mConnect.send(e),this.mKeyboardListeners.forEach(t=>{this.checkMoveKeyAllUp()?t.upHandler():this.checkMoveKeyDown(t)}))}removeKeyEvents(){if(!this.mScene)return;let t;const e=this.mKeyList.length;for(let i=0;i<e;i++)(t=this.mKeyList[i])&&(t.off("down",this.keyDownHandle),t.off("up",this.keyUpHandle),this.mScene.input.keyboard.removeKey(t.keyCode));this.mKeyList.length=0,this.mKeyList=null}}!function(t){t[t.RightMouseDown=1]="RightMouseDown",t[t.RightMouseUp=2]="RightMouseUp",t[t.LeftMouseDown=3]="LeftMouseDown",t[t.LeftMouseUp=4]="LeftMouseUp",t[t.WheelDown=5]="WheelDown",t[t.WheelUp=6]="WheelUp",t[t.RightMouseHolding=7]="RightMouseHolding",t[t.LeftMouseHolding=8]="LeftMouseHolding"}(Bt||(Bt={}));class Wt extends a.PacketHandler{constructor(t){super(),this.worldService=t,this.running=!1,this.mGame=t.game,this.mConnect=this.worldService.connection}changeRoom(t){if(this.pause(),this.mScene=t.scene,this.mScene){this.mActivePointer=this.mScene.input.activePointer;try{t.addMouseListen()}catch(t){}t.scene.input.on("gameobjectdown",this.groundDown,this),t.scene.input.on("gameobjectup",this.groundUp,this),t.scene.input.on("pointerdown",this.pointerDownHandler,this),this.resume()}}resize(t,e){}pause(){this.running=!1}resume(){this.running=!0}onUpdate(t,e){if(!1===this.running||void 0===this.mActivePointer)return;const i=[];if(this.mActivePointer.leftButtonDown()?i.push(Bt.LeftMouseDown):this.mActivePointer.leftButtonReleased()&&i.push(Bt.LeftMouseUp),this.mActivePointer.middleButtonDown()?i.push(Bt.WheelDown):this.mActivePointer.middleButtonReleased()&&i.push(Bt.WheelUp),this.mActivePointer.rightButtonDown()?i.push(Bt.RightMouseDown):this.mActivePointer.rightButtonReleased()&&i.push(Bt.RightMouseUp),0===i.length)return;let s=0;e.parentContainer&&(s=e.parentContainer.getData("id"));const n=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOUSE_EVENT),o=n.content;o.id=s,o.mouseEvent=i,o.point3f={x:t.x,y:t.y},this.mConnect.send(n)}set enable(t){this.mScene&&(this.mScene.input.mouse.enabled=t)}get enable(){return!!this.mScene&&this.mScene.input.mouse.enabled}destroy(){this.mActivePointer=null,this.mScene=null,this.mConnect=null,this.mGroundLayer=null,this.running=!1}groundDown(t,e){this.mActivePointer=t,this.onUpdate(t,e)}groundUp(t,e){this.mActivePointer=t,this.onUpdate(t,e)}pointerDownHandler(){this.worldService&&this.worldService.emitter&&this.worldService.emitter.emit(V.a.SCENE_BACKGROUND_CLICK)}}class Ht{constructor(t,e){this.worldService=t,this.mJoyListeners=[],this.mScale=t.uiScale,this.mKeyEvents=e,this.mKeyEventMap=new Map,o.a.getInstance().debug(`JoyStickManager ${t.uiScale}`)}onRoomChanged(t,e){}setScene(t){if(this.mScene=t,!this.mScene)return;const e=this.mKeyEvents.length;let i,s,a;for(let t=0;t<e;t++)s=(i=this.mKeyEvents[t]).keyCodes,a=i.tqEvent,this.mKeyEventMap.get(a)||this.mKeyEventMap.set(a,i);this.mKeyEvents.length=0,this.mKeyEvents=null,this.mParentcon=this.mScene.add.container(0,0);this.mScale&&this.mScale;this.mJoyStick=new Vt(this.mScene,this.worldService,this.mParentcon,this.mJoyListeners,this.mScale)}resize(){const t=this.worldService.getSize();this.mParentcon&&(this.worldService.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.mParentcon.x=100*this.mScale,this.mParentcon.y=t.height-100*this.mScale):(this.mParentcon.x=100*this.mScale,this.mParentcon.y=t.height-300*this.mScale),this.mParentcon.scaleX=this.mParentcon.scaleY=this.worldService.uiScale)}tweenView(t){const e=!0===t?1:0,i=this.worldService.getSize();let s,a;this.worldService.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(s=100*this.mScale,a=i.height-100*this.mScale):(s=100*this.mScale,a=i.height-300*this.mScale);const r=!0===t?s:s-this.mParentcon.width,n=a;this.mScene.tweens.add({targets:this.mParentcon,duration:200,ease:"Linear",props:{x:{value:r},y:{value:n},alpha:{value:e}}})}addListener(t){this.mJoyListeners.push(t),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)}getKeyCodes(t){if(!this.mKeyEventMap.has(t))return;const e=this.mKeyEventMap.get(t).keyCodes.length,i=[];for(let s=0;s<e;s++){const e=this.mKeyEventMap.get(t).keyCodes[s];i.push(e)}return i}removeListener(t){const e=this.mJoyListeners.indexOf(t);e>=0&&this.mJoyListeners.splice(e,1),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)}getKeyDowns(){return[]}getKeyUps(){return[]}downHandler(){}upHandler(){}set enable(t){}get enable(){return!0}}class Vt{constructor(t,e,i,s,a){this.mScene=t,this.mWorld=e,this.parentCon=i,this.mJoyListeners=s,this.mScale=a,this.mKeyCodes=[],this.load()}load(){this.mScene.load.atlas("joystick","./resources/ui/joystick/joystick.png","./resources/ui/joystick/joystick.json"),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start()}changeListeners(t){this.mJoyListeners=t}onLoadCompleteHandler(){this.mWorld.getSize();this.bg=this.mScene.make.sprite(void 0,!1),this.bg.setTexture("joystick","joystick_bg.png"),this.bgRadius=this.bg.width+40>>1,this.btn=this.mScene.make.sprite(void 0,!1),this.btn.setTexture("joystick","joystick_tab.png"),this.btn.x=this.bg.x,this.btn.y=this.bg.y,this.mjoystickCon=this.mScene.make.container(void 0,!1),this.mjoystickCon.alpha=.5,this.mjoystickCon.addAt(this.bg,0),this.mjoystickCon.addAt(this.btn,1),this.parentCon.add(this.mjoystickCon),this.btn.setInteractive(),this.mScene.input.setDraggable(this.btn),this.btn.on("drag",this.dragUpdate,this),this.btn.on("dragend",this.dragStop,this),this.parentCon.setSize(this.bg.width*this.mScale,this.bg.height*this.mScale),this.mWorld.inputManager.resize()}dragUpdate(t,e,i){let s=Math.sqrt(e*e+i*i);s>this.bgRadius&&(s=this.bgRadius);const a=Math.atan2(i,e);this.btn.x=Math.cos(a)*s+this.bg.x,this.btn.y=Math.sin(a)*s+this.bg.y,this.mJoyListeners.forEach(t=>{this.checkdragDown(t,a)})}dragStop(t){this.btn.x=this.bg.x,this.btn.y=this.bg.y,o.a.getInstance().log("dragEnd"),this.mJoyListeners.forEach(t=>{this.checkdragUp()&&t.upHandler()})}checkdragDown(t,e){let i,s=[];return e<=0&&e>-Math.PI/2?i=0!==e?H.right_up:H.right:e<=-Math.PI/2&&e>-Math.PI?i=e!==-Math.PI/2?H.up_left:H.up:e>Math.PI/2&&e<=Math.PI?i=e!==Math.PI?H.left_down:H.left:e>0&&e<=Math.PI/2&&(i=e!==Math.PI/2?H.down_right:H.down),s=this.getKeys(i),this.mdownStr!==s.toString()&&(this.mdownStr=s.toString(),t.downHandler(i,s),this.mWorld.roomManager.currentRoom.actor.setDirection(i),!0)}getKeys(t){let e=this.mKeyCodes[t];if(e)return e;switch(t){case 0:e=this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_UP);break;case 1:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_UP).concat,this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_LEFT));break;case 2:e=this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_LEFT);break;case 3:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_DOWN),this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_LEFT));break;case 4:e=this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_DOWN);break;case 5:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_DOWN),this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_RIGHT));break;case 6:e=this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_RIGHT);break;case 7:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_UP),this.mWorld.inputManager.getKeyCodes(r.op_def.TQ_EVENT.TQ_MOVE_RIGHT))}return this.mKeyCodes[t]=e,e}checkdragUp(){return this.mdownStr="",!0}}class zt{constructor(){this.mModels=new Map,this.mElementRef=new Map}setGameConfig(t){if(!t)return;const e=t.objectsList;let i=null;for(const t of e)if(t.type===r.op_def.NodeType.TerrainNodeType||t.type===r.op_def.NodeType.ElementNodeType){(i=this.mModels.get(t.id))||(i=new X(t),this.mModels.set(t.id,i));const e={id:t.id,displayModel:i};this.mElementRef.set(t.id,e)}}add(t){this.mModels.set(t.id,t)}getObject(t){const e=this.mElementRef.get(t);if(e)return e.displayModel;o.a.getInstance().error(`can't find element ${t}`)}}function load(t,e){return new Promise((i,s)=>{const a=new XMLHttpRequest;a.onload=t=>{i(t.currentTarget)},a.onerror=()=>{o.a.getInstance().warn(`${t} load error`),s(`${t} load error`)},a.open("GET",t),a.responseType=e||"",a.send()})}var Gt=i(197),Ut=i(70),Yt=i(50);class Xt{setScene(t){t&&(this.destroy(),this.mScene=t,this.mUILayer=t.add.container(0,0),this.mDialogLayer=t.add.container(0,0),this.mToolTipsLyaer=t.add.container(0,0))}addToUILayer(t){this.mUILayer&&this.mUILayer.add(t)}addToDialogLayer(t){this.mDialogLayer&&this.mDialogLayer.add(t)}addToToolTipsLayer(t){this.mToolTipsLyaer&&this.mToolTipsLyaer.add(t)}removeToUILayer(t){this.mUILayer.remove(t)}removeToDialogLayer(t){this.mDialogLayer.remove(t)}removeToToolTipsLayer(t){this.mToolTipsLyaer.remove(t)}destroy(){this.mUILayer&&(this.mUILayer.destroy(),this.mUILayer=null),this.mDialogLayer&&(this.mDialogLayer.destroy(),this.mDialogLayer=null),this.mToolTipsLyaer&&(this.mToolTipsLyaer.destroy(),this.mToolTipsLyaer=null)}get interactive(){return this.mInteractive}}var Kt=i(84),Qt=i(86),$t=i(44);class Zt extends a.PacketHandler{constructor(t){super(),this.worldService=t,this.mCache=[],this.mConnect=t.connection,this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_UI,this.handleShowUI),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_UPDATE_UI,this.handleUpdateUI),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CLOSE_UI,this.handleCloseUI),this.mUILayerManager=new Xt}addPackListener(){this.mConnect&&this.mConnect.addPacketListener(this)}removePackListener(){this.mConnect&&this.mConnect.removePacketListener(this)}getUILayerManager(){return this.mUILayerManager}setScene(t){if(this.mScene=t,this.mUILayerManager.setScene(t),!this.mMedMap){this.mMedMap=new Map,this.mMedMap.set(Ut.a.MainUIMediator,new $t.MainUIMediator(this.worldService,t)),this.mMedMap.set(Ut.a.BagMediator,new Qt.BagMediator(this.worldService,t)),this.worldService.game.device.os.desktop&&this.mMedMap.set(Ut.a.ChatMediator,new Yt.ChatMediator(this.worldService,t)),this.mMedMap.set(Ut.a.NOTICE,new Kt.NoticeMediator(this.mUILayerManager,t,this.worldService));for(const t of this.mCache){const e=t[0];this.showMed(e.name,e)}this.mCache.length=0}this.mMedMap.forEach(t=>{t.isSceneUI()&&t.show()})}resize(t,e){this.mMedMap&&this.mMedMap.forEach(t=>{t.isShow&&t.resize()})}setMediator(t,e){this.mMedMap.set(t,e)}getMediator(t){if(this.mMedMap)return this.mMedMap.get(t)}destroy(){this.removePackListener(),this.mMedMap&&(this.mMedMap.forEach(t=>{t.destroy(),t=null}),this.mMedMap.clear()),this.mMedMap=null}handleShowUI(t){const e=t.content;this.showMed(e.name,e)}handleUpdateUI(t){const e=t.content;this.updateMed(e.name,e)}handleCloseUI(t){const e=t.content;this.hideMed(e.name)}showMed(t,...e){if(!this.mMedMap)return void this.mCache.push(e);const s=t+"Mediator";let a=this.mMedMap.get(s);if(!a){if(!(a=new(i(246)(`./${t}/${s}`)[s])(this.mUILayerManager,this.mScene,this.worldService)))return void o.a.getInstance().error(`error ${t} no panel can show!!!`);this.mMedMap.set(t+"Mediator",a)}a.isShow()||a.show(e)}updateMed(t,...e){if(!this.mMedMap)return;const i=`${t}Mediator`,s=this.mMedMap.get(i);s?s.update(e):o.a.getInstance().error(`error ${t} no panel can show!!!`)}hideMed(t){if(!this.mMedMap)return;const e=`${t}Mediator`,i=this.mMedMap.get(e);i?i.isShow()&&i.hide():o.a.getInstance().error(`error ${t} no panel can show!!!`)}}var Jt=i(28),Factory=function(t,e,i,s,a,r,n,o){var h=new Jt.a(this.scene,t,e,i,s,a,r,n,o);return this.scene.add.existing(h),h};const qt=Phaser.GameObjects.BuildGameObject;var Creator=function(t,e){void 0!==e&&(t.add=e);var i=new Jt.a(this.scene,t);return qt(this.scene,i,t),i},isInValidKey=function(t){return null==t||""===t||0===t.length},object_SetValue=function(t,e,i){if("object"==typeof t)if(isInValidKey(e)){if(null==i)return;"object"==typeof i&&(t=i)}else{"string"==typeof e&&(e=e.split("."));var s=e.pop();(function(t,e,i){void 0===i&&(i={});var s=t;if(isInValidKey(e));else{var a;"string"==typeof e&&(e=e.split("."));for(var r=0,n=e.length;r<n;r++){var o;if(null==s[a=e[r]]||"object"!=typeof s[a])o=r===n-1?i:{},s[a]=o;s=s[a]}}return s}(t,e))[s]=i}};class te extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexNinePatch",Factory,Creator)}start(){this.game.events.once("destroy",this.destroy,this)}}object_SetValue(window,"RexPlugins.GameObjects.NinePatch",Jt.a);var ee=te,ie=i(30),inputtext_Factory=function(t,e,i,s,a){var r=new ie.a(this.scene,t,e,i,s,a);return this.scene.add.existing(r),r};const se=Phaser.Utils.Objects.GetAdvancedValue,ae=Phaser.GameObjects.BuildGameObject;var inputtext_Creator=function(t,e){var i=se(t,"width",void 0),s=se(t,"height",void 0);void 0!==e&&(t.add=e);var a=new ie.a(this.scene,0,0,i,s,t);return ae(this.scene,a,t),a};class re extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexInputText",inputtext_Factory,inputtext_Creator)}start(){this.game.events.once("destroy",this.destroy,this)}}object_SetValue(window,"RexPlugins.GameObjects.InputText",ie.a);var ne=re,oe=i(20),bbocdetext_Factory=function(t,e,i,s){var a=new oe.a(this.scene,t,e,i,s);return this.scene.add.existing(a),a};const he=Phaser.Utils.Objects.GetAdvancedValue,le=Phaser.GameObjects.BuildGameObject;var bbocdetext_Creator=function(t,e){var i=he(t,"text",""),s=he(t,"style",null),a=he(t,"padding",null);null!==a&&(s.padding=a),void 0!==e&&(t.add=e);var r=new oe.a(this.scene,0,0,i,s);return le(this.scene,r,t),r.autoRound=he(t,"autoRound",!0),r.resolution=he(t,"resolution",1),r};class ce extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexBBCodeText",bbocdetext_Factory,bbocdetext_Creator)}start(){this.game.events.once("destroy",this.destroy,this)}}object_SetValue(window,"RexPlugins.GameObjects.BBCodeText",oe.a);var de=ce,me=i(25),ue=i(15);const pe=Phaser.Utils.Objects.GetValue;class ge{constructor(t,e){this.gameObject=t,this.scene=Object(ue.a)(t),this.setEventEmitter(pe(e,"eventEmitter",void 0)),t.setInteractive(pe(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.pointer=void 0,this.lastClickTime=void 0,this.setEnable(pe(t,"enable",!0)),this.setMode(pe(t,"mode",1)),this.setClickInterval(pe(t,"clickInterval",100)),this.setDragThreshold(pe(t,"threshold",void 0)),this}boot(){this.gameObject.on("pointerdown",this.onPress,this),this.gameObject.on("pointerup",this.onRelease,this),this.gameObject.on("pointerout",this.onPointOut,this),this.gameObject.on("pointermove",this.onMove,this),this.gameObject.once("destroy",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointer=void 0,this.gameObject=void 0,this.scene=void 0}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.cancel(),this.gameObject.input.enabled=t,this)}setMode(t){return"string"==typeof t&&(t=fe[t]),this.mode=t,this}setClickInterval(t){return this.clickInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}onPress(t){void 0===this.pointer&&(this.pointer=t,0===this.mode&&this.click(t.downTime,t))}onRelease(t){this.pointer===t&&(1===this.mode&&this.click(t.upTime,t),this.pointer=void 0)}onPointOut(t){this.pointer===t&&this.cancel()}onMove(t){this.pointer===t&&void 0!==this.dragThreshold&&t.getDistance()>=this.dragThreshold&&this.cancel()}click(t,e){if(void 0===t)return this.emit("click",this,this.gameObject,e),this;this.pointer=void 0;var i=this.lastClickTime;return void 0!==i&&t-i<=this.clickInterval?this:(this.lastClickTime=t,this.emit("click",this,this.gameObject,e),this)}cancel(){return this.pointer=void 0,this}}Object.assign(ge.prototype,me.a);const fe={press:0,pointerdown:0,release:1,pointerup:1};var _e=ge,ye=_e;class ve extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.once("destroy",this.destroy,this)}add(t,e){return new ye(t,e)}}var Se=ve;class be{constructor(t){this.scene=t}static register(t,e){be.prototype[t]=e}}var Te=be,De=i(160).a;Te.register("roundRectangle",(function(t,e,i,s,a,r,n){var o=new De(this.scene,t,e,i,s,a,r,n);return this.scene.add.existing(o),o})),object_SetValue(window,"RexPlugins.UI.RoundRectangle",De);var xe=oe.a;Te.register("BBCodeText",(function(t,e,i,s){var a=new xe(this.scene,t,e,i,s);return this.scene.add.existing(a),a})),object_SetValue(window,"RexPlugins.UI.BBCodeText",xe);var Pe=i(157),Ce=i(104),we={plainText:null,prevProp:null},Oe=new Ce.a;var styleToProp=function(t){for(var e,i,s,a={},r=0,n=(t=t.split(";")).length;r<n;r++)if(i=(e=t[r].split(":"))[0],s=e[1],!isEmpty(i)&&!isEmpty(s)){switch(i){case"stroke":var o=s.split(" ");s={},(l=o.length)>=1&&(s.color=o[0]),l>=2&&(s.thinkness=parseInt(o[1].replace("px","")));break;case"shadow":var h=s.split(" ");s={},(l=h.length)>=1&&(s.color=h[0]),l>=2&&(s.offsetX=parseInt(h[1].replace("px",""))),l>=3&&(s.offsetY=parseInt(h[2].replace("px",""))),l>=4&&(s.blur=parseInt(h[3].replace("px","")));break;case"u":case"underline":var l,c=s.split(" ");s={},(l=c.length)>=1&&(s.color=c[0]),l>=2&&(s.thinkness=parseInt(c[1].replace("px",""))),l>=3&&(s.offset=parseInt(c[2].replace("px","")))}a[i]=s}return a},isEmpty=function(t){return 0===(t=t.replace(ke,"")).length},Ae=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,Be=/<\s*class=/i,Ee=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,Ie=/<\s*style=/i,Me=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,ke=/^\s+|\s+$/,Re=class{constructor(t){void 0===t&&(t={}),this.tags=t}addTag(t,e){this.tags[t]=e}splitText(t,e){for(var i,s,a,r=[],n=0,o=t.length,h=o;i=Ae.exec(t);)s=i[0],n<(h=Ae.lastIndex-s.length)&&r.push(t.substring(n,h)),void 0===e?r.push(s):1===e&&(Be.test(s)?(a=s.match(Ee),r.push(a[2])):Ie.test(s)&&(a=s.match(Me),r.push(a[2]))),n=Ae.lastIndex;return n<o&&r.push(t.substring(n,o)),r}tagTextToProp(t,e){var i,s;if(Be.test(t)){if(null!=(n=t.match(Ee))){var a=n[1],r=this.tags;(s=r.hasOwnProperty(a)?r[a]:{})._class=a,i=n[2]}}else if(Ie.test(t)){var n;if(null!=(n=t.match(Me))){var o=n[1];(s=styleToProp(o))._style=o,i=n[2]}}null==i&&(i=t),null==s&&(s={});var h=we;return h.plainText=i,h.prop=s,h}propToContextStyle(t,e){var i=Oe;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var s=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];i.fontFamily=s}else i.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var a=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof a&&(a=a.toString()+"px"),i.fontSize=a}else i.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var r=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];i.fontStyle=r}else i.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){e.hasOwnProperty("color")?e.color:e["font-color"];i.color=e.color}else i.color=t.color;if(e.hasOwnProperty("stroke")){var n=e.stroke;i.stroke=n.hasOwnProperty("color")?n.color:t.stroke,i.strokeThickness=n.hasOwnProperty("thinkness")?n.thinkness:t.strokeThickness}else i.stroke=t.stroke,i.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var o=e.shadow;i.shadowColor=o.hasOwnProperty("color")?o.color:t.shadowColor,i.shadowOffsetX=o.hasOwnProperty("offsetX")?o.offsetX:t.shadowOffsetX,i.shadowOffsetY=o.hasOwnProperty("offsetY")?o.offsetY:t.shadowOffsetY,i.shadowBlur=o.hasOwnProperty("blur")?o.blur:t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=t.shadowStroke,i.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var h=e.hasOwnProperty("u")?e.u:e.underline;i.underlineColor=h.hasOwnProperty("color")?h.color:t.underlineColor,i.underlineThickness=h.hasOwnProperty("thinkness")?h.thinkness:t.underlineThickness,i.underlineOffset=h.hasOwnProperty("offset")?h.offset:t.underlineOffset}else i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset;return i}propToTagText(t,e,i){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='"+e._class+"'>"+t+"</class>":e.hasOwnProperty("_style")?"<style='"+e._style+"'>"+t+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(t){var e=this.tags[t];return!!e&&null==e.img}};const Le=Phaser.Utils.Objects.GetValue;class Fe extends Pe.a{constructor(t,e,i,s,a){var r=Le(a,"tags",void 0),n=new Re(r);super(t,e,i,s,a,"rexTagText",n),this.parser=n}addTag(t,e){return this.parser.addTag(t,e),this.updateText(!0)}addTags(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}}var Ne=Fe;Te.register("tagText",(function(t,e,i,s){var a=new Ne(this.scene,t,e,i,s);return this.scene.add.existing(a),a})),object_SetValue(window,"RexPlugins.UI.TagText",Ne);var je=i(127);Te.register("container",(function(t,e,i,s,a){var r=new je.a(this.scene,t,e,i,s,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.Container",je.a);je.a;const We=Phaser.Renderer.WebGL.Utils;var render_WebGLRenderer=function(t,e,i,s,a){if(e.dirty&&(e.updateTexture(),e.dirty=!1),0!==e.width&&0!==e.height){var r=e.frame,n=r.width,o=r.height,h=We.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,r.glTexture,n,o,e.x,e.y,n/e.resolution,o/e.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,n,o,h(e._tintTL,s.alpha*e._alphaTL),h(e._tintTR,s.alpha*e._alphaTR),h(e._tintBL,s.alpha*e._alphaBL),h(e._tintBR,s.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,s,a)}},render_CanvasRenderer=function(t,e,i,s,a){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,s,a)},He=i(23),Ve=(He.a,He.a,{renderWebGL:render_WebGLRenderer,renderCanvas:render_CanvasRenderer});const ze=Phaser.Display.Color;var Ge={clear(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this},fill(t){return this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this},getPixel(t,e,i){void 0===i&&(i=new ze);var s=this.context.getImageData(t,e,1,1);return i.setTo(s.data[0],s.data[1],s.data[2],s.data[3]),i},setPixel(t,e,i,s,a,r){if("number"!=typeof i){var n=i;i=n.red,s=n.green,a=n.blue,r=n.alpha}void 0===r&&(r=0!==i||0!==s||0!==a?255:0);var o=this.context.createImageData(1,1);return o.data[0]=i,o.data[1]=s,o.data[2]=a,o.data[3]=r,this.context.putImageData(o,t,e),this.dirty=!0,this}},Ue={updateTexture(t,e){t&&(e?t.call(e,this.canvas,this.context):t(this.canvas,this.context)),this.canvas.width===this.frame.width&&this.canvas.height===this.frame.height||this.frame.setSize(this.canvas.width,this.canvas.height),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(this.canvas,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!1;var i=this.input;return i&&!i.customHitArea&&(i.hitArea.width=this.width,i.hitArea.height=this.height),this},generateTexture(t,e,i,s,a){var r,n=this.canvas,o=this.scene.sys,h=o.game.renderer;void 0===e&&(e=0),void 0===i&&(i=0),void 0===s?s=n.width:s*=this.resolution,void 0===a?a=n.height:a*=this.resolution;var l=(r=o.textures.exists(t)?o.textures.get(t):o.textures.createCanvas(t,s,a)).getSourceImage();l.width!==s&&(l.width=s),l.height!==a&&(l.height=a);var c=l.getContext("2d");return c.clearRect(0,0,s,a),c.drawImage(n,e,i,s,a),h.gl&&r&&h.canvasToTexture(l,r.source[0].glTexture,!0,0),this},loadTexture(t,e){var i=this.scene.textures.getFrame(t,e);return i?(this.width!==i.cutWidth||this.height!==i.cutHeight?this.resize(i.cutWidth,i.cutHeight):this.context.clearRect(0,0,i.cutWidth,i.cutHeight),this.context.drawImage(i.source.image,i.cutX,i.cutY,i.cutWidth,i.cutHeight,0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this):this}};const Ye=Phaser.Display.Canvas.CanvasPool,Xe=Phaser.GameObjects.GameObject;class Ke extends Xe{constructor(t,e,i,s,a){void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===a&&(a=1),super(t,"rexCanvas"),this.renderer=t.sys.game.renderer,this.resolution=t.sys.game.config.resolution,this.canvas=Ye.create(this,this.resolution*s,this.resolution*a),this.context=this.canvas.getContext("2d"),this.dirty=!1,this.setPosition(e,i),this.setSize(s,a),this.setOrigin(.5,.5),this.initPipeline(),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),this.dirty=!0,t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}getCanvas(t){return t||(this.dirty=!0),this.canvas}needRedraw(){return this.dirty=!0,this}preDestroy(){Ye.remove(this.canvas)}resize(t,e){return this.width===t&&this.height===e?this:(this.setSize(t,e).updateDisplayOrigin(),t*=this.resolution,e*=this.resolution,t=Math.max(Math.ceil(t),1),e=Math.max(Math.ceil(e),1),this.canvas.width=t,this.canvas.height=e,this.dirty=!0,this)}}const Qe=Phaser.GameObjects.Components;Phaser.Class.mixin(Ke,[Qe.Alpha,Qe.BlendMode,Qe.ComputedSize,Qe.Crop,Qe.Depth,Qe.Flip,Qe.GetBounds,Qe.Mask,Qe.Origin,Qe.Pipeline,Qe.ScrollFactor,Qe.Tint,Qe.Transform,Qe.Visible,Ve,Ge,Ue]);var $e=Ke,FillConfig=function(t,e){void 0===e&&(e={}),void 0===e.options&&(e.options={});var i=e.options;i.responsive=!1,i.maintainAspectRatio=!1,i.hasOwnProperty("devicePixelRatio")||(i.devicePixelRatio=1);var s=!1;void 0===i.animation?i.animation={}:!1===i.animation&&(s=!0,i.animation={});var a=i.animation;s&&(a.duration=0);var r=a.onProgress;a.onProgress=function(e){r&&r(e),t.needRedraw()};var n=a.onComplete;return a.onComplete=function(e){n&&n(e),t.needRedraw()},e};class Ze extends $e{constructor(t,e,i,s,a,r){super(t,e,i,s,a),this.type="rexChart",this.chart=void 0,void 0!==r&&this.setChart(r)}destroy(t){this.scene&&(this.chart&&(this.chart.destroy(),this.chart=void 0),super.destroy(t))}resize(t,e){if(t===this.width&&e===this.height)return this;if(super.resize(t,e),this.chart){var i=this.chart;i.height=this.canvas.height,i.width=this.canvas.width,i.aspectRatio=i.height?i.width/i.height:null,i.update()}return this}}var Je={setChart:function(t){if(!window.Chart){return console.error("Can not find chartjs! Load chartjs in preload stage.\nscene.load.script('chartjs', 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js');"),this}return this.chart&&this.chart.destroy(),this.chart=new Chart(this.context,FillConfig(this,t)),this},getChartDataset:function(t){if(void 0!==this.chart){if("string"!=typeof t)return this.chart.data.datasets[t];for(var e,i=this.chart.data.datasets,s=0,a=i.length;s<a;s++)if((e=i[s]).label===t)return e}},getChartData:function(t,e){var i=this.getChartDataset(t);if(void 0!==i){if("string"==typeof e)if(-1===(e=this.chart.data.labels.indexOf(e)))return;return i.data[e]}},setChartData:function(t,e,i){if(void 0===this.chart)return this;var s=this.getChartDataset(t);if("string"==typeof e&&-1===(e=this.chart.data.labels.indexOf(e)))return this;return s.data[e]=i,this},updateChart:function(){if(void 0===this.chart)return this;this.chart.update()}};Object.assign(Ze.prototype,Je);var qe=Ze;Te.register("chart",(function(t,e,i,s,a){var r=new qe(this.scene,t,e,i,s,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.Chart",qe);var ApplyCircleMask=function(t,e){t.width===t.height&&(e=0);var i=Math.floor(t.width/2),s=Math.floor(t.height/2),a=t.getContext("2d");a.save(),a.globalCompositeOperation="destination-in",a.beginPath(),0===e?a.arc(i,s,Math.min(i,s),0,2*Math.PI):a.ellipse(i,s,i,s,0,0,2*Math.PI),a.fill(),a.restore()};const ti=Phaser.Utils.Objects.GetValue;const ei={circle:0,ellipse:1};var ii=class extends $e{constructor(t,e,i,s,a,r){super(t,e,i),this.type="rexCircleMaskImage";var n=ti(r,"maskType",0);this.setTexture(s,a,n)}setTexture(t,e,i){return void 0===i?i=0:"string"==typeof i&&(i=ei[i]),this._textureKey=t,this._frameName=e,this.loadTexture(t,e),null!==i&&ApplyCircleMask(this.canvas,i),this.dirty=!0,this}};Te.register("circleMaskImage",(function(t,e,i,s,a){var r=new ii(this.scene,t,e,i,s,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.CircleMaskImage",ii);var si=Jt.a;Te.register("ninePatch",(function(t,e,i,s,a,r,n,o){var h=new si(this.scene,t,e,i,s,a,r,n,o);return this.scene.add.existing(h),h})),object_SetValue(window,"RexPlugins.UI.NinePatch",si);const ai=Phaser.Utils.Objects.GetValue;const ri={id:["id",void 0],width:["width",void 0],height:["height",void 0],autoPlay:["autoplay",!0],controls:["controls",!1],loop:["loop",!1],poster:["poster",void 0],preload:["preload",void 0],muted:["muted",!1],playsInline:["playsInline",!0],crossOrigin:["crossOrigin","anonymous"]},ni={canplay:"canplay",canplaythrough:"canplaythrough",ended:"ended",error:"error",loadstart:"loadstart",playing:"playing",pause:"pause",stalled:"stalled"};var videobase_CreateVideoElement=function(t){var e,i,s=document.createElement("video");for(var a in ri)e=ri[a],void 0!==(i=ai(t,a,e[1]))&&(s[e[0]]=i);var r=ai(t,"eventEmitter",void 0);if(r)for(let t in ni)s.addEventListener(ni[t],function(){r.emit(t,this)}.bind(this));return s};const oi=Phaser.Utils.Objects.IsPlainObject;const hi=["webm","ogg","mp4","h264","vp9","hls"];var videobase_Load=function(t,e,i){if(oi(e))for(var s,a=0,r=hi.length;a<r;a++)if(i[(s=hi[a])+"Video"]&&e.hasOwnProperty(s)){e=e[s];break}t.src=e,t.load()};const li=Phaser.Utils.Objects.GetValue,ci=Phaser.Math.Clamp;var videobase_VideoBase=function(t){return class extends t{createVideoElement(t){return this.video||(void 0===t&&(t={}),t.eventEmitter=this,this.video=videobase_CreateVideoElement(t),this.playbackTimeChangeEventEnable=li(t,"playbackTimeChangeEventEnable",!0)),this.video}preDestroy(){this.scene&&(this.video&&(this.video.pause(),this.video.removeAttribute("src"),this.video.load(),this.video=void 0),super.preDestroy&&super.preDestroy())}preUpdate(t,e){if(this.playbackTimeChangeEventEnable){var i=this.playbackTime;i!==this.prevT&&this.emit("playbacktimechange",this),this.prevT=i}super.preUpdate&&super.preUpdate(t,e)}get availableVideoTypes(){return this.scene.sys.game.device.video}load(t){return this.video&&videobase_Load(this.video,t,this.availableVideoTypes),this}play(){return this.video&&this.video.play(),this}get isPlaying(){if(this.video){var t=this.video;return!t.paused&&!t.ended&&t.currentTime>0}return!1}pause(){return this.video&&this.video.pause(),this}get isPaused(){return!!this.video&&this.video.paused}get playbackTime(){return this.video&&this.video.currentTime||0}set playbackTime(t){if(this.video)try{this.video.currentTime=t}catch(t){}}setPlaybackTime(t){return this.playbackTime=t,this}get duration(){return this.video&&this.video.duration||0}get t(){if(this.video){var t=this.duration;return 0===t?0:this.playbackTime/t}return 0}set t(t){this.video&&(this.playbackTime=this.duration*ci(t,0,1))}setT(t){return this.t=t,this}get hasEnded(){return!!this.video&&this.video.ended}get volume(){return this.video&&this.video.volume||0}set volume(t){this.video&&(this.video.volume=t)}setVolume(t){return this.volume=t,this}get muted(){return this.video&&this.video.muted||!1}set muted(t){this.video&&(this.video.muted=t)}setMute(t){return void 0===t&&(t=!0),this.muted=t,this}get loop(){return!!this.video&&this.video.loop}set loop(t){this.video&&(this.video.loop=t)}setLoop(t){return void 0===t&&(t=!0),this.loop=t,this}get readyState(){return this.video?this.video.readyState:void 0}}};const di=Phaser.GameObjects.DOMElement,mi=Phaser.Utils.Objects.IsPlainObject,ui=Phaser.Utils.Objects.GetValue;class pi extends(videobase_VideoBase(di)){constructor(t,e,i,s,a,r){mi(e)?(e=ui(r=e,"x",0),i=ui(r,"y",0),s=ui(r,"width",void 0),a=ui(r,"height",void 0)):mi(s)&&(s=ui(r=s,"width",void 0),a=ui(r,"height",void 0)),void 0===r&&(r={});var n=t.scale.autoRound;void 0!==s&&(n&&(s=Math.floor(s)),r.width=s),void 0!==a&&(n&&(a=Math.floor(a)),r.height=a),super(t,e,i),this.type="rexVideo",this.setElement(this.createVideoElement(r)).load(ui(r,"src",""))}resize(t,e){return this.width===t&&this.height===e?this:(this.node.width=t,this.node.height=e,this.updateSize(),this)}}var gi=pi;Te.register("video",(function(t,e,i,s,a){var r=new gi(this.scene,t,e,i,s,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.Video",gi);var loader_LoadScript=function(t,e){for(var i=document.getElementsByTagName("script"),s=!1,a=0,r=i.length;a<r;a++)if(-1!=i[a].src.indexOf(t)){s=!0;break}if(!s){var n=document.createElement("script");n.type="text/javascript",n.src=t,e&&(n.onload=e),document.getElementsByTagName("head")[0].appendChild(n)}},fi=!1,_i=[],youtubeplayer_LoadAPI=function(t){fi?t():(window.onYouTubeIframeAPIReady||(window.onYouTubeIframeAPIReady=function(){fi=!0;for(var t=0,e=_i.length;t<e;t++)_i[t]();_i=void 0},loader_LoadScript("https://www.youtube.com/iframe_api")),_i.push(t))};const yi=Phaser.GameObjects.DOMElement,vi=Phaser.Utils.Objects.IsPlainObject,Si=Phaser.Utils.Objects.GetValue,bi=Phaser.Math.Clamp;var Ti=class extends yi{constructor(t,e,i,s,a,r){vi(e)?(e=Si(r=e,"x",0),i=Si(r,"y",0),s=Si(r,"width",void 0),a=Si(r,"height",void 0)):vi(s)&&(s=Si(r=s,"width",void 0),a=Si(r,"height",void 0)),void 0===r&&(r={});var n=t.scale.autoRound;void 0!==s&&(n&&(s=Math.floor(s)),r.width=s+"px"),void 0!==a&&(n&&(a=Math.floor(a)),r.height=a+"px"),super(t,e,i),this.type="rexYoutubePlayer",this.youtubePlayer=void 0,this.videoState=void 0,this.videoId=Si(r,"videoId",""),this.loop=Si(r,"loop",!1),this.paddingCallbacks=[];var o="YT"+Date.now(),h=document.createElement("div");h.id=o,h.style.width=r.width,h.style.height=r.height,this.setElement(h);var l={autoplay:Si(r,"autoPlay",!0)?1:0,controls:Si(r,"controls",!0)?1:0,disablekb:Si(r,"keyboardControl",!0)?0:1,modestbranding:Si(r,"modestBranding",!1)?1:0},c=function(){var t=new YT.Player(o,{videoId:this.videoId,playerVars:l,events:{onStateChange:function(t){this.videoState=t.data,this.emit("statechange",this),this.emit(this.videoStateString,this),this.videoState===YT.PlayerState.ENDED&&this.loop&&this.youtubePlayer.playVideo()}.bind(this),onReady:function(e){this.youtubePlayer=t;for(var i=0,s=this.paddingCallbacks.length;i<s;i++)this.paddingCallbacks[i]();this.paddingCallbacks=void 0,this.emit("ready",this)}.bind(this),onError:function(t){this.lastError=t.data,this.emit("error",this,this.lastError)}.bind(this)}});this.setElement(document.getElementById(o))}.bind(this);youtubeplayer_LoadAPI(c)}_runCallback(t){void 0===this.youtubePlayer?this.paddingCallbacks.push(t):t()}get videoStateString(){if(void 0===this.videoState||!YT)return"";switch(this.videoState){case-1:return"unstarted";case YT.PlayerState.ENDED:return"ended";case YT.PlayerState.PLAYING:return"playing";case YT.PlayerState.PAUSED:return"pause";case YT.PlayerState.BUFFERING:return"buffering";case YT.PlayerState.CUED:return"cued"}}load(t,e){void 0===e&&(e=!0);var i=function(){this.youtubePlayer.loadVideoById(t),e?this.youtubePlayer.playVideo():this.youtubePlayer.pauseVideo()}.bind(this);return this._runCallback(i),this}play(){var t=function(){this.youtubePlayer.playVideo()}.bind(this);return this._runCallback(t),this}get isPlaying(){return 1===this.videoState}pause(){var t=function(){this.youtubePlayer.pauseVideo()}.bind(this);return this._runCallback(t),this}get isPaused(){return 2===this.videoState}get playbackTime(){return this.youtubePlayer?this.youtubePlayer.getCurrentTime():0}set playbackTime(t){var e=function(){this.youtubePlayer.seekTo(t)}.bind(this);this._runCallback(e)}setPlaybackTime(t){return this.playbackTime=t,this}get duration(){return this.youtubePlayer?this.youtubePlayer.getDuration():0}get t(){var t=this.duration;return 0===t?0:this.playbackTime/t}set t(t){var e=function(){t=bi(t,0,1),this.playbackTime=this.duration*bi(t,0,1)}.bind(this);this._runCallback(e)}setT(t){return this.t=t,this}get hasEnded(){return 0===this.videoState}get volume(){return this.youtubePlayer?this.youtubePlayer.getVolume()/100:0}set volume(t){var e=function(){this.youtubePlayer.setVolume(bi(100*t,0,100))}.bind(this);this._runCallback(e)}setVolume(t){return this.volume=t,this}get muted(){return!!this.youtubePlayer&&this.youtubePlayer.isMuted()}set muted(t){var e=function(){t?this.youtubePlayer.mute():this.youtubePlayer.unMute()}.bind(this);this._runCallback(e)}setMute(t){return void 0===t&&(t=!0),this.muted=t,this}setLoop(t){return void 0===t&&(t=!0),this.loop=t,this}resize(t,e){if(this.width===t&&this.height===e)return this;var i=this.node.style;return i.width=t+"px",i.height=e+"px",this.updateSize(),this}};Te.register("youtubePlayer",(function(t,e,i,s,a){var r=new Ti(this.scene,t,e,i,s,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.YoutubePlayer",Ti);var Di=i(19);Te.register("sizer",(function(t,e,i,s,a){var r=new Di.a(this.scene,t,e,i,s,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.Sizer",Di.a);Di.a;var xi=i(36),gridsizer_GetChildrenWidth=function(){if(this.rexSizer.hidden)return 0;for(var t,e,i,s,a,r=0,n=this.gridChildren,o=0;o<this.columnCount;o++){if(t=0,void 0===(a=this.columnProportions[o])||0===a){for(var h=0;h<this.rowCount;h++)(e=n[h*this.columnCount+o])&&(e.rexSizer.hidden||(s=e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width,s+=(i=e.rexSizer.padding).left+i.right,t=Math.max(t,s)));r+=t}this.columnWidth[o]=t}return r},gridsizer_GetChildrenHeight=function(){if(this.rexSizer.hidden)return 0;for(var t,e,i,s,a,r=0,n=this.gridChildren,o=0;o<this.rowCount;o++){if(t=0,void 0===(a=this.rowProportions[o])||0===a){for(var h=0;h<this.columnCount;h++)(e=n[o*this.columnCount+h])&&(e.rexSizer.hidden||(s=e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height,s+=(i=e.rexSizer.padding).top+i.bottom,t=Math.max(t,s)));r+=t}this.rowHeight[o]=t}return r},gridsizer_GetChildrenSizers=function(t){void 0===t&&(t=[]);for(var e,i=this.gridChildren,s=0,a=i.length;s<a;s++)(e=i[s])&&e.isRexSizer&&t.push(e);return t},gridsizer_GetExpandedChildWidth=function(t,e){var i,s=t.rexSizer;if(s.expand){var a=s.padding;i=e-a.left-a.right}return i},gridsizer_GetExpandedChildHeight=function(t,e){var i,s=t.rexSizer;if(s.expand){var a=s.padding;i=e-a.top-a.bottom}return i},Pi=i(24),Ci=i(35);const wi=Phaser.Display.Align.In.QuickSet;var Oi={getChildrenWidth:gridsizer_GetChildrenWidth,getChildrenHeight:gridsizer_GetChildrenHeight,getChildrenSizers:gridsizer_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;this.layoutInit(t);var s,a,r,n,o=this.totalColumnProportions,h=this.totalRowProportions;if(void 0===e)if(t&&o>0){var l=this.rexSizer.padding;e=t.width-l.left-l.right}else e=Math.max(this.childrenWidth,this.minWidth);if(void 0===i)if(t&&h>0){var l=this.rexSizer.padding;i=t.height-l.top-l.bottom}else i=Math.max(this.childrenHeight,this.minHeight);this.resize(e,i),s=o>0?(this.width-this.childrenWidth)/o:0,a=h>0?(this.height-this.childrenHeight)/h:0;for(var c,d,m,u,p,g,f,_,y,v,S=this.left,b=S,T=this.top,D=0;D<this.rowCount;D++){v=0===(_=this.rowProportions[D]||0)?this.rowHeight[D]:_*a,b=S;for(var x=0;x<this.columnCount;x++)y=0===(f=this.columnProportions[x]||0)?this.columnWidth[x]:f*s,(r=this.gridChildren[D*this.columnCount+x])&&!r.rexSizer.hidden?(p=gridsizer_GetExpandedChildWidth(r,y),g=gridsizer_GetExpandedChildHeight(r,v),r.isRexSizer?r.layout(this,p,g):Object(Pi.a)(r,p,g),c=b+(l=(n=r.rexSizer).padding).left,m=y-l.left-l.right,d=T+l.top,u=v-l.top-l.bottom,Ci.a.setPosition(c,d).setSize(m,u),wi(r,Ci.a,n.align),this.resetChildPositionState(r),b+=y):b+=y;T+=v}return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0}},Ai=i(42),Bi=i(73);const Ei=Phaser.Utils.Objects.IsPlainObject,Ii=Phaser.Utils.Objects.GetValue,Mi=Phaser.Utils.Array.Remove,ki=Phaser.Display.Align.CENTER;class Ri extends xi.a{constructor(t,e,i,s,a,r,n,o,h){var l;Ei(e)?(e=Ii(l=e,"x",0),i=Ii(l,"y",0),s=Ii(l,"width",void 0),a=Ii(l,"height",void 0),r=Ii(l,"column",0),n=Ii(l,"row",0),o=Ii(l,"columnProportions",void 0),h=Ii(l,"rowProportions",void 0)):Ei(s)?(s=Ii(l=s,"width",void 0),a=Ii(l,"height",void 0),r=Ii(l,"column",0),n=Ii(l,"row",0),o=Ii(l,"columnProportions",void 0),h=Ii(l,"rowProportions",void 0)):Ei(r)?(r=Ii(l=r,"column",0),n=Ii(l,"row",0),o=Ii(l,"columnProportions",void 0),h=Ii(l,"rowProportions",void 0)):Ei(o)&&(o=Ii(l=o,"columnProportions",void 0),h=Ii(l,"rowProportions",void 0)),super(t,e,i,s,a,l),this.type="rexGridSizer",this.initialGrid(r,n,o,h)}destroy(t){this.scene&&(this.gridChildren.length=0,super.destroy(t))}setColumnProportion(t,e){return t>=this.columnProportions.length?this:(this.columnProportions[t]=e,this)}setRowProportion(t,e){return t>=this.rowProportions.length?this:(this.rowProportions[t]=e,this)}add(t,e,i,s,a,r){var n;(super.add(t),Ei(e))&&(e=Ii(n=e,"column",0),i=Ii(n,"row",0),s=Ii(n,"align",ki),a=Ii(n,"padding",0),r=Ii(n,"expand",!1));return"string"==typeof s&&(s=Bi.a[s]),void 0===s&&(s=ki),void 0===a&&(a=0),void 0===r&&(r=!0),(n=this.getSizerConfig(t)).parent=this,n.align=s,n.padding=Object(Ai.a)(a),n.expand=r,this.gridChildren[i*this.columnCount+e]=t,this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,Mi(this.gridChildren,t),void 0!==this.backgroundChildren&&Mi(this.backgroundChildren,t),super.remove(t),this)}get totalColumnProportions(){for(var t,e=0,i=0;i<this.columnCount;i++)(t=this.columnProportions[i])>0&&(e+=t);return e}get totalRowProportions(){for(var t,e=0,i=0;i<this.rowCount;i++)(t=this.rowProportions[i])>0&&(e+=t);return e}initialGrid(t,e,i,s){if(this.columnCount=t,this.rowCount=e,this.gridChildren=[],this.gridChildren.length=t*e,this.columnProportions=[],this.columnProportions.length=t,this.columnWidth=[],this.columnWidth.length=t,this.rowProportions=[],this.rowProportions.length=e,this.rowHeight=[],this.rowHeight.length=e,i)for(var a="number"==typeof i,r=0;r<t;r++)if(a)this.setColumnProportion(r,i);else{var n=i[r];n>0&&this.setColumnProportion(r,n)}if(s){var o="number"==typeof s;for(r=0;r<e;r++)if(o)this.setRowProportion(r,s);else{var h=s[r];h>0&&this.setRowProportion(r,h)}}return this}}Object.assign(Ri.prototype,Oi);var Li=Ri;Te.register("gridSizer",(function(t,e,i,s,a,r,n,o){var h=new Li(this.scene,t,e,i,s,a,r,n,o);return this.scene.add.existing(h),h})),object_SetValue(window,"RexPlugins.UI.GridSizer",Li);var fixwidthsizer_GetChildrenWidth=function(){return this.rexSizer.hidden?0:(t=0===this.orientation?this.maxChildWidth:0,t=Math.max(t,this.minWidth));var t},fixwidthsizer_GetChildrenHeight=function(){return this.rexSizer.hidden?0:(t=0===this.orientation?0:this.maxChildHeight,t=Math.max(t,this.minHeight));var t},fixwidthsizer_GetChildrenSizers=function(t){void 0===t&&(t=[]);for(var e,i=this.sizerChildren,s=0,a=i.length;s<a;s++)"\n"!==(e=i[s])&&e.isRexSizer&&t.push(e);return t},fixwidthsizer_GetChildWidth=function(t){var e=t.rexSizer.padding;return t.width+e.left+e.right},fixwidthsizer_GetChildHeight=function(t){var e=t.rexSizer.padding;return t.height+e.top+e.bottom},RunChildrenWrap_GetChildWidth=function(t,e){return 0===e?fixwidthsizer_GetChildWidth(t):fixwidthsizer_GetChildHeight(t)},GeChildHeight=function(t,e){return 0===e?fixwidthsizer_GetChildHeight(t):fixwidthsizer_GetChildWidth(t)},fixwidthsizer_RunChildrenWrap=function(t){for(var e,i,s,a,r={lines:[],width:0,height:0},n=this.sizerChildren,o=0,h=r.lines,l=0,c=n.length;l<c;l++){if("\n"===(e=n[l]))e=void 0,i=0,a=!0;else{if(e.rexSizer.hidden)continue;e.isRexSizer&&e.layout(),a=o<(i=RunChildrenWrap_GetChildWidth(e,this.orientation))}if(a){if(s){var d=t-(o+this.itemSpacing);r.width=Math.max(r.width,d),r.height+=s.height+this.lineSpacing}s={children:[],remainder:0,height:0},h.push(s),o=t}o-=i+this.itemSpacing,s.remainder=o,e&&(s.children.push(e),s.height=Math.max(s.height,GeChildHeight(e,this.orientation)))}return s&&(r.height+=s.height),r};const Fi=Phaser.Display.Align.In.QuickSet;var Ni={getChildrenWidth:fixwidthsizer_GetChildrenWidth,getChildrenHeight:fixwidthsizer_GetChildrenHeight,getChildrenSizers:fixwidthsizer_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;if(this.layoutInit(t),void 0===e){var s=this.padding;e=Math.max(this.maxChildWidth+s.left+s.right,this.minWidth)}if(void 0===i){s=this.padding;i=Math.max(this.maxChildHeight+s.top+s.bottom,this.minHeight)}var a;s=this.padding;a=0===this.orientation?e-s.left-s.right:i-s.top-s.bottom;var r,n,o=fixwidthsizer_RunChildrenWrap.call(this,a);0===this.orientation?i=Math.max(i,o.height+s.top+s.bottom):e=Math.max(e,o.height+left+s.right),this.resize(e,i);var h,l,c,d,m,u,p,g,f=this.left,_=this.top,y=o.lines;0===this.orientation?(h=f,l=_+this.padding.top):(h=f+this.padding.left,l=_);for(var v=0,S=y.length;v<S;v++){for(var b=0,T=(g=(p=y[v]).children).length;b<T;b++)s=(n=(r=g[b]).rexSizer).padding,0===this.orientation?(c=h+s.left,c+=0===b?this.padding.left:this.itemSpacing,d=l+s.top,m=r.width,u=r.height,h=c+r.width+s.right):(c=h+s.left,d=l+s.top,d+=0===b?this.padding.top:this.itemSpacing,m=r.width,u=r.height,l=d+r.height+s.bottom),Ci.a.setPosition(c,d).setSize(m,u),Fi(r,Ci.a,n.align),this.resetChildPositionState(r);0===this.orientation?(h=f,l+=p.height+this.lineSpacing):(h+=p.height+this.lineSpacing,l=_)}return this.layoutBackgrounds(),this}},ji=i(130),fixwidthsizer_GetMaxChildWidth=function(t){void 0===t&&(t=this.sizerChildren);for(var e,i=0,s=0,a=t.length;s<a;s++)"\n"!==(e=t[s])&&(i=Math.max(i,fixwidthsizer_GetChildWidth(e)));return i},fixwidthsizer_GetMaxChildHeight=function(t){void 0===t&&(t=this.sizerChildren);for(var e,i=0,s=0,a=t.length;s<a;s++)"\n"!==(e=t[s])&&(i=Math.max(i,fixwidthsizer_GetChildHeight(e)));return i};const Wi=Phaser.Utils.Objects.IsPlainObject,Hi=Phaser.Utils.Objects.GetValue,Vi=Phaser.Utils.Array.Remove,zi=Phaser.Display.Align.CENTER;class Gi extends xi.a{constructor(t,e,i,s,a,r,n){var o;Wi(e)?(e=Hi(o=e,"x",0),i=Hi(o,"y",0),s=Hi(o,"width",void 0),a=Hi(o,"height",void 0)):Wi(s)?(s=Hi(o=s,"width",void 0),a=Hi(o,"height",void 0)):Wi(r)?o=r:Wi(n)&&(o=n),void 0!==o&&(r=Hi(o,"orientation",0),n=Hi(o,"space",o)),void 0===r&&(r=0),void 0===n&&(n=0),super(t,e,i,s,a,o),this.type="rexFixWidthSizer",this.sizerChildren=[],this.setOrientation(r),this.setPadding(n),this.setItemSpacing(Hi(n,"item",0)),this.setLineSpacing(Hi(n,"line",0))}destroy(t){this.scene&&(this.sizerChildren.length=0,super.destroy(t))}setOrientation(t){return"string"==typeof t&&(t=ji.a[t]),this.orientation=t,this}setPadding(t){return this.padding=Object(Ai.a)(t,this.padding),this}setItemSpacing(t){return this.itemSpacing=t,this}setLineSpacing(t){return this.lineSpacing=t,this}add(t,e){if("\n"===t)return this.addNewLine(),this;super.add(t),void 0===e&&(e=0);var i=this.getSizerConfig(t);return i.parent=this,i.align=zi,i.padding=Object(Ai.a)(e),this.sizerChildren.push(t),this}addNewLine(){return this.sizerChildren.push("\n"),this}insert(t,e,i,s){return this.add(e,i,s),this.moveTo(e,t),this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,Vi(this.sizerChildren,t),super.remove(t),this)}clear(t){for(var e,i=this.sizerChildren,s=0,a=i.length;s<a;s++)"\n"!==(e=i[s])&&(this.getSizerConfig(e).parent=void 0);return i.length=0,super.clear(t),this}get maxChildWidth(){return void 0===this._maxChildWidth&&(this._maxChildWidth=fixwidthsizer_GetMaxChildWidth.call(this)),this._maxChildWidth}get maxChildHeight(){return void 0===this._maxChildHeight&&(this._maxChildHeight=fixwidthsizer_GetMaxChildHeight.call(this)),this._maxChildHeight}}Object.assign(Gi.prototype,Ni);var Ui=Gi;Te.register("fixWidthSizer",(function(t,e,i,s,a,r){var n=new Ui(this.scene,t,e,i,s,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.FixWidthSizer",Ui);var Yi=i(43);const Xi=Phaser.Utils.Objects.GetValue;class Ki extends Di.a{constructor(t,e){super(t,e),this.type="rexLabel";var i=Xi(e,"background",void 0),s=Xi(e,"icon",void 0),a=Xi(e,"iconMask",void 0),r=Xi(e,"text",void 0),n=Xi(e,"action",void 0),o=Xi(e,"actionMask",void 0),h=Xi(e,"space.left",0),l=Xi(e,"space.right",0),c=Xi(e,"space.top",0),d=Xi(e,"space.bottom",0),m=Xi(e,"space.icon",0),u=Xi(e,"space.text",0);(i&&this.addBackground(i),s)&&(g=0===this.orientation?{left:h,right:r||n?m:l,top:c,bottom:d}:{left:h,right:l,top:c,bottom:r||n?m:d},this.add(s,0,"center",g),a&&(a=new Yi.a(s,1),s.setMask(a.createGeometryMask()),this.add(a,null)));if(r){var p,g,f,_=Xi(e,"expandTextWidth",!1),y=Xi(e,"expandTextHeight",!1);0===this.orientation?(p=_?1:0,g={left:s?0:h,right:n?u:l,top:c,bottom:d},f=y):(p=y?1:0,g={left:h,right:l,top:s?0:c,bottom:n?u:d},f=_),this.add(r,p,"center",g,f)}n&&(g=0===this.orientation?{left:s||r?0:h,right:l,top:c,bottom:d}:{left:h,right:l,top:s||r?0:c,bottom:d},this.add(n,0,"center",g),o&&(o=new Yi.a(n,1),s.setMask(o.createGeometryMask()),this.add(o,null)));this.addChildrenMap("background",i),this.addChildrenMap("icon",s),this.addChildrenMap("iconMask",a),this.addChildrenMap("text",r),this.addChildrenMap("action",n),this.addChildrenMap("actionMask",o)}get text(){var t=this.childrenMap.text;return void 0===t?"":t.text?t.text:t.getData("text")}set text(t){var e=this.childrenMap.text;void 0!==e&&(e.setText?e.setText(t):e.setData("text",t))}setText(t){return this.text=t,this}appendText(t){this.text+=t}layout(t,e,i){super.layout(t,e,i);var s=this.childrenMap.iconMask;s&&(s.setPosition(),this.resetChildPositionState(s));var a=this.childrenMap.actionMask;return a&&(a.setPosition(),this.resetChildPositionState(a)),this}resize(t,e){super.resize(t,e);var i=this.childrenMap.iconMask;i&&i.resize();var s=this.childrenMap.actionMask;return s&&s.resize(),this}}var Qi=Ki;Te.register("label",(function(t){var e=new Qi(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Label",Qi);var utils_Space=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),t.add.zone(0,0,e,i)},ButtonSetInteractive=function(t,e){t._buttonBehavior=new _e(t,e),t._buttonBehavior.on("click",(function(e,i,s){FireEvent.call(this,"button.click",t,s)}),this),t.on("pointerover",(function(e){FireEvent.call(this,"button.over",t,e)}),this).on("pointerout",(function(e){FireEvent.call(this,"button.out",t,e)}),this)},FireEvent=function(t,e,i){var s;if("number"==typeof e){if(s=e,!(e=this.childrenMap.buttons[s]))return}else if(-1===(s=this.childrenMap.buttons.indexOf(e)))return;void 0!==this.groupName?this.eventEmitter.emit(t,e,this.groupName,s,i):this.eventEmitter.emit(t,e,s,i)},$i=i(72),Show=function(t){_hide(t,!1)},Hide=function(t){_hide(t,!0)},IsShown=function(t){return!!t&&!Object($i.a)(t).hidden},_hide=function(t,e){t&&(Object($i.a)(t).hidden=e,t.setVisible(!e))},Zi={getButton(t){var e;return"number"==typeof t?e=this.childrenMap.buttons[t]:(e=t,-1===this.childrenMap.buttons.indexOf(e)&&(e=void 0)),e},emitButtonClick(t){return FireEvent.call(this,"button.click",t),this},showButton(t){return Show(this.getButton(t)),this},hideButton(t){return Hide(this.getButton(t)),this},isButtonShown(t){return IsShown(this.getButton(t)),this},forEachButtton(t,e){for(var i=this.childrenMap.buttons,s=0,a=i.length;s<a;s++)e?t.call(e,i[s],s,i):t(i[s],s,i);return this}};const Ji=Phaser.Utils.Objects.GetValue;class qi extends Di.a{constructor(t,e){void 0===e&&(e={}),super(t,e),this.type="rexButtons",this.eventEmitter=Ji(e,"eventEmitter",this),this.groupName=Ji(e,"groupName",void 0);var i=Ji(e,"background",void 0),s=Ji(e,"buttons",void 0);s&&0===s.length&&(s=void 0);var a=Ji(e,"space",0);if(i&&this.addBackground(i),s){var r,n,o=Ji(e,"align",void 0),h=Ji(e,"click",void 0);"right"!==o&&"bottom"!==o&&"center"!==o||this.add(utils_Space(t),1,"center",0,!1);for(var l=0,c=s.length;l<c;l++)r=s[l],n=0===this.orientation?{left:l>=1?a:0,right:0,top:0,bottom:0}:{left:0,right:0,top:l>=1?a:0,bottom:0},this.add(r,0,"center",n,!0),ButtonSetInteractive.call(this,r,h);"center"===o&&this.add(utils_Space(t),1,"center",0,!1)}this.addChildrenMap("background",i),this.addChildrenMap("buttons",s||[])}}Object.assign(qi.prototype,Zi);var ts=qi;Te.register("buttons",(function(t){var e=new ts(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Buttons",ts);var es={getChoice(t){return this.childrenMap.choicesSizer.getButton(t)},getAction(t){return this.childrenMap.actionsSizer.getButton(t)},emitChoiceClick(t){return this.childrenMap.choicesSizer.emitButtonClick(t),this},emitActionClick(t){return this.childrenMap.actionsSizer.emitButtonClick(t),this},showChoice(t){return this.childrenMap.choicesSizer.showButton(t),this},showAction(t){return this.childrenMap.actionsSizer.showButton(t),this},hideChoice(t){return this.childrenMap.choicesSizer.hideButton(t),this},hideAction(t){return this.childrenMap.actionsSizer.hideButton(t),this},forEachChoice(t,e){return this.childrenMap.choicesSizer.forEachButtton(t,e),this},forEachChoice(t,e){return this.childrenMap.choicesSizer.forEachButtton(t,e),this},forEachAction(t,e){return this.childrenMap.actionsSizer.forEachButtton(t,e),this}};const is=Phaser.Utils.Objects.GetValue;class ss extends Di.a{constructor(t,e){void 0===e&&(e={}),e.orientation=1,super(t,e),this.type="rexDialog",this.eventEmitter=is(e,"eventEmitter",this);var i=is(e,"background",void 0),s=is(e,"title",void 0),a=is(e,"toolbar",void 0);a&&0===a.length&&(a=void 0);var r,n,o=is(e,"content",void 0),h=is(e,"description",void 0),l=is(e,"choices",void 0);l&&0===l.length&&(l=void 0);var c=is(e,"actions",void 0);c&&0===c.length&&(c=void 0);var d,m=is(e,"click",void 0),u=is(e,"space.left",0),p=is(e,"space.right",0),g=is(e,"space.top",0),f=is(e,"space.bottom",0);if(i&&this.addBackground(i),s&&!a){var _=is(e,"align.title","center"),y=is(e,"space.title",0),v={left:u,right:p,top:g,bottom:o||h||l||c?y:f},S=is(e,"expand.title",!0);this.add(s,0,_,v,S)}if(a&&(d=new ts(t,{groupName:"toolbar",buttons:a,orientation:0,space:is(e,"space.toolbarItem",0),click:m,eventEmitter:this.eventEmitter})),a&&!s){y=is(e,"space.title",0),v={left:u,right:p,top:g,bottom:o||h||l||c?y:f},S=is(e,"expand.toolbar",!0);this.add(d,0,"center",v,S)}if(s&&a){var b=new Di.a(t,{orientation:0});_=is(e,"align.title","left");(S=is(e,"expand.title",!0))||"right"!==_&&"center"!==_||b.add(utils_Space(t),1,"center",0,!1);v={left:is(e,"space.titleLeft",0),right:is(e,"space.titleRight",0),top:0,bottom:0};b.add(s,S?1:0,"center",v,S),S||"left"!==_&&"center"!==_||b.add(utils_Space(t),1,"center",0,!1),b.add(d,0,"right",0,!1);y=is(e,"space.title",0),v={left:u,right:p,top:g,bottom:o||h||l||c?y:f};this.add(b,0,"center",v,!0)}if(o){_=is(e,"align.content","center");var T=is(e,"space.content",0);v={left:u+is(e,"space.contentLeft",0),right:p+is(e,"space.contentRight",0),top:s||a?0:g,bottom:h||l||c?T:f},S=is(e,"expand.content",!0);this.add(o,0,_,v,S)}if(h){_=is(e,"align.description","center");var D=is(e,"space.description",0);v={left:u+is(e,"space.descriptionLeft",0),right:p+is(e,"space.descriptionRight",0),top:s||a||o?0:g,bottom:l||c?D:f},S=is(e,"expand.description",!0);this.add(h,0,_,v,S)}if(l){_=is(e,"align.choices","center");r=new ts(t,{groupName:"choices",buttons:l,orientation:1,space:is(e,"space.choice",0),click:m,eventEmitter:this.eventEmitter});var x=is(e,"space.choices",0);v={left:u+is(e,"space.choicesLeft",0),right:p+is(e,"space.choicesRight",0),top:s||a||o||h?0:g,bottom:c?x:f},S=is(e,"expand.choices",!0);this.add(r,0,_,v,S)}if(c){n=new ts(t,{groupName:"actions",buttons:c,orientation:0,space:is(e,"space.action",0),align:is(e,"align.actions","center"),click:m,eventEmitter:this.eventEmitter});v={left:u+is(e,"space.actionsLeft",0),right:p+is(e,"space.actionsRight",0),top:s||a||o||h||l?0:g,bottom:f},S=is(e,"expand.actions",!0);this.add(n,0,"center",v,S)}this.addChildrenMap("background",i),this.addChildrenMap("title",s),this.addChildrenMap("toolbar",a),this.addChildrenMap("content",o),this.addChildrenMap("choices",l),this.addChildrenMap("actions",c),this.addChildrenMap("choicesSizer",r),this.addChildrenMap("actionsSizer",n)}}Object.assign(ss.prototype,es);var as=ss;Te.register("dialog",(function(t){var e=new as(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Dialog",as);var rs={getButtonsSizer(t){return this.childrenMap[t+"ButtonsSizer"]},getButton(t,e){var i=this.getButtonsSizer(t);return i?i.getButton(e):void 0},emitButtonClick(t,e){var i=this.getButtonsSizer(t);return i?(i.emitButtonClick(e),this):this},emitLeftButtonClick(t){return this.childrenMap.leftButtonsSizer.emitButtonClick(t),this},emitRightButtonClick(t){return this.childrenMap.rightButtonsSizer.emitButtonClick(t),this},emitTopButtonClick(t){return this.childrenMap.topButtonsSizer.emitButtonClick(t),this},emitBottomButtonClick(t){return this.childrenMap.bottomButtonsSizer.emitButtonClick(t),this},getLeftButton(t){return this.childrenMap.leftButtonsSizer.getButton(t)},getRightButton(t){return this.childrenMap.rightButtonsSizer.getButton(t)},getTopButton(t){return this.childrenMap.topButtonsSizer.getButton(t)},getBottomButton(t){return this.childrenMap.bottomButtonsSizer.getButton(t)},showButton(t,e){return Show(this.getButton(t,e)),this},showLeftButton(t){return Show(this.getLeftButton(t)),this},showRightButton(t){return Show(this.getRightButton(t)),this},showTopButton(t){return Show(this.getTopButton(t)),this},showBottomButton(t){return Show(this.getBottomButton(t)),this},hideButton(t,e){return Hide(this.getButton(t,e)),this},hideLeftButton(t){return Hide(this.getLeftButton(t)),this},hideRightButton(t){return Hide(this.getRightButton(t)),this},hideTopButton(t){return Hide(this.getTopButton(t)),this},hideBottomButton(t){return Hide(this.getBottomButton(t)),this},forEachLeftButton(t,e){return this.childrenMap.leftButtonsSizer.forEachButtton(t,e),this},forEachRightButton(t,e){return this.childrenMap.rightButtonsSizer.forEachButtton(t,e),this},forEachTopButton(t,e){return this.childrenMap.topButtonsSizer.forEachButtton(t,e),this},forEachBottomButton(t,e){return this.childrenMap.bottomButtonsSizer.forEachButtton(t,e),this}};const ns=Phaser.Utils.Objects.GetValue;class os extends Li{constructor(t,e){void 0===e&&(e={}),e.column=3,e.row=3,super(t,e),this.type="rexTabs",this.eventEmitter=ns(e,"eventEmitter",this);var i,s=ns(e,"background",void 0),a=ns(e,"panel",void 0),r=ns(e,"leftButtons",void 0);r&&0===r.length&&(r=void 0);var n,o=ns(e,"rightButtons",void 0);o&&0===o.length&&(o=void 0);var h,l=ns(e,"topButtons",void 0);l&&0===l.length&&(l=void 0);var c,d=ns(e,"bottomButtons",void 0);d&&0===d.length&&(d=void 0);var m=ns(e,"click",void 0),u=ns(e,"space.left",0),p=ns(e,"space.right",0),g=ns(e,"space.top",0),f=ns(e,"space.bottom",0),_=ns(e,"space.leftButtonsOffset",0),y=ns(e,"space.rightButtonsOffset",0),v=ns(e,"space.topButtonsOffset",0),S=ns(e,"space.bottomButtonsOffset",0),b=ns(e,"space.leftButton",0),T=ns(e,"space.rightButton",0),D=ns(e,"space.topButton",0),x=ns(e,"space.bottomButton",0);if(s&&this.addBackground(s),a){var P={left:r?0:u,right:o?0:p,top:l?0:g,bottom:d?0:f};this.add(a,1,1,"center",P,!0)}if(r){i=new ts(t,{groupName:"left",buttons:r,orientation:1,space:b,align:ns(e,"align.leftButtons",void 0),click:m,eventEmitter:this.eventEmitter});P={left:u,top:_};this.add(i,0,1,"top",P,!1)}if(o){n=new ts(t,{groupName:"right",buttons:o,orientation:1,space:T,align:ns(e,"align.rightButtons",void 0),click:m,eventEmitter:this.eventEmitter});P={right:p,top:y};this.add(n,2,1,"top",P,!1)}if(l){h=new ts(t,{groupName:"top",buttons:l,orientation:0,space:D,align:ns(e,"align.topButtons",void 0),click:m,eventEmitter:this.eventEmitter});P={top:g,left:v};this.add(h,1,0,"left",P,!1)}if(d){c=new ts(t,{groupName:"bottom",buttons:d,orientation:0,space:x,align:ns(e,"align.bottomButtons",void 0),click:m,eventEmitter:this.eventEmitter});P={bottom:f,left:S};this.add(c,1,2,"left",P,!1)}this.addChildrenMap("background",s),this.addChildrenMap("panel",a),this.addChildrenMap("leftButtons",r),this.addChildrenMap("rightButtons",o),this.addChildrenMap("topButtons",l),this.addChildrenMap("bottomButtons",d),this.addChildrenMap("leftButtonsSizer",i),this.addChildrenMap("rightButtonsSizer",n),this.addChildrenMap("topButtonsSizer",h),this.addChildrenMap("bottomButtonsSizer",c)}}Object.assign(os.prototype,rs);var hs=os;Te.register("tabs",(function(t){var e=new hs(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Tabs",hs);var ls=i(101);Te.register("slider",(function(t){var e=new ls.a(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Slider",ls.a);ls.a;var cs=i(103),ds=i(51),ms=i(156),us=i(74),ps=i.n(us),gs=i(76),fs={enableData(){return void 0===this.data&&(this.data={}),this},getData(t,e){return this.enableData(),void 0===t?this.data:ps()(this.data,t,e)},setData(t,e){return this.enableData(),this.data[t]=e,this},incData(t,e,i){return void 0===i&&(i=0),this.enableData(),this.setData(t,this.getData(t,i)+e),this},mulData(t,e,i){return void 0===i&&(i=0),this.enableData(),this.setData(t,this.getData(t,i)*e),this},clearData(){return this.data&&Object(gs.a)(this.data),this}};class _s{constructor(t,e){this.container=null,this.setParent(t),this._deltaHeight=0}setParent(t){this.parent=t,this.parentContainer=t.getParentContainer()}destroy(t){if(void 0===t&&(t=!1),!t){var e=this.parent;0!==this.deltaHeight&&e.nonZeroDeltaHeightCount--,this.destroyContainer()}this.data=void 0,this.container=null,this.parent=void 0,this.parentContainer=void 0}get table(){return this.parent}get scrollMode(){return this.parentContainer.scrollMode}get colIndx(){return this.parent.cellIndxeToColIndex(this.index)}get rowIndx(){return this.parent.cellIndxeToRowIndex(this.index)}getContainer(){return this.container}setContainer(t){return this.container&&this.container.destroy(),this.container=t,this.parentContainer.add(t),this}destroyContainer(){return this.container&&(this.container.destroy(),this.container=null),this}popContainer(){if(this.container){var t=this.container;return this.container=null,this.parentContainer.remove(t),t}return null}setXY(t,e){return this.container&&this.parentContainer.setChildLocalPosition(this.container,t,e),this}get deltaHeight(){return this._deltaHeight}set deltaHeight(t){null==t&&(t=0);var e=this.parent;0===this._deltaHeight&&0!==t?e.nonZeroDeltaHeightCount++:0!==this._deltaHeight&&0===t&&e.nonZeroDeltaHeightCount--,this._deltaHeight=t}setDeltaHeight(t){return this.deltaHeight=t,this}get height(){return 0===this.scrollMode?this.deltaHeight+this.parent.defaultCellHeight:this.parent.defaultCellWidth}set height(t){1!==this.scrollMode&&this.setDeltaHeight(t-this.parent.defaultCellHeight)}setHeight(t){return this.height=t,this}get width(){return 0===this.scrollMode?this.parent.defaultCellWidth:this.deltaHeight+this.parent.defaultCellHeight}set width(t){0!==this.scrollMode&&this.setDeltaHeight(t-this.parent.defaultCellHeight)}setWidth(t){return this.width=t,this}get scene(){return this.parentContainer.scene}}Object.assign(_s.prototype,fs);var ys=_s,vs=i(47);const Ss=Phaser.Utils.Objects.GetValue,bs=Phaser.Utils.Array.SpliceOne;var Ts=new vs.a;var Ds=class{constructor(t,e){this.parent=t,this.cells=[],this.resetFromJSON(e)}resetFromJSON(t){return this.colCount=void 0,this._nonZeroDeltaHeightCount=0,this.resetTotalRowsHeight(),this.setDefaultCellHeight(Ss(t,"cellHeight",30)),this.setDefaultCellWidth(Ss(t,"cellWidth",30)),this.initCells(Ss(t,"cellsCount",0)),this.setColumnCount(Ss(t,"columns",1)),this}destroy(t){for(var e=0,i=this.cells.length;e<i;e++)this.freeCell(this.cells[e],t);this.cells=void 0,this.parent=void 0}get nonZeroDeltaHeightCount(){return this._nonZeroDeltaHeightCount}set nonZeroDeltaHeightCount(t){this._nonZeroDeltaHeightCount!==t&&(this._nonZeroDeltaHeightCount=t,this.resetTotalRowsHeight())}get defaultCellHeightMode(){return 0===this.nonZeroDeltaHeightCount}setDefaultCellHeight(t){return this.defaultCellHeight=t,this}setDefaultCellWidth(t){return this.defaultCellWidth=t,this}initCells(t){var e=this.cells;e.length=t;for(var i=0;i<t;i++)e[i]=null;return this}insertNewCell(t,e){var i=this.cells;if(t===i.length){var s=t+e;i.legth=s;for(var a=t;a<s;a++)i[a]=null}else{var r=[];r.length=e;for(a=0;a<e;a++)r[a]=null;this.cells.splice(t,0,...r)}return this.resetTotalRowsHeight(),this}removeCell(t,e){for(var i=t+e,s=t;s<i;s++)this.freeCell(s);return i===this.cells.length?this.cells.length=t:(1===e?bs(this.cells,t):this.cells.splice(t,e),this.buildCellIndex(t)),this.resetTotalRowsHeight(),this}setColumnCount(t){return this.colCount=t,this.resetTotalRowsHeight(),this}get rowCount(){return Math.ceil(this.cells.length/this.colCount)}get cellsCount(){return this.cells.length}isValidCellIdx(t){return t>=0&&t<this.cells.length}heightToRowIndex(t,e){if(this.defaultCellHeightMode){var i=t/this.defaultCellHeight;return i=e?Math.ceil(i):Math.floor(i)}var s,a=this.rowCount,r=t;for(i=0;;){if(s=i>=0&&i<a,!((r-=this.getRowHeight(i))>0&&s)){if(0===r)return i;if(e){var n=i;(s=(i+=1)>=0&&i<a)||(i=n)}return i}i+=1}}widthToColIndex(t,e){var i=t/this.defaultCellWidth;return i=e?Math.ceil(i):Math.floor(i)}colRowToCellIndex(t,e){return t>=this.colCount?null:e*this.colCount+t}rowIndexToHeight(t,e){if(this.defaultCellHeightMode)return(e-t+1)*this.defaultCellHeight;for(var i=0,s=t;s<=e;s++)i+=this.getRowHeight(s);return i}colIndexToWidth(t,e){return(e-t+1)*this.defaultCellWidth}getRowHeight(t){var e=this.colCount;if(e<=1)return this.getCellHeight(this.colRowToCellIndex(0,t));for(var i,s=0,a=0;a<e;a++)s<(i=this.getCellHeight(this.colRowToCellIndex(a,t)))&&(s=i);return s}getColWidth(t){return this.defaultCellWidth}getCellHeight(t){if(!this.isValidCellIdx(t))return 0;var e;if(this.defaultCellHeightMode)e=this.defaultCellHeight;else{var i=this.getCell(t,!1),s=i?i.deltaHeight:0;e=this.defaultCellHeight+s}return e}resetTotalRowsHeight(){this._totalRowsHeight=null}get totalRowsHeight(){return null===this._totalRowsHeight&&(this._totalRowsHeight=this.rowIndexToHeight(0,this.rowCount-1)),this._totalRowsHeight}get totalColumnWidth(){return this.colCount*this.defaultCellWidth}cellIndxeToColIndex(t){return t%this.colCount}cellIndxeToRowIndex(t){return Math.floor(t/this.colCount)}getCell(t,e){if(!this.isValidCellIdx(t))return null;if(void 0===e&&(e=!0),null===this.cells[t]&&e){var i=this.newCell(t);this.cells[t]=i}return this.cells[t]}newCell(t){var e=Ts.pop();return null===e?e=new ys(this):e.setParent(this),e.index=t,e}buildCellIndex(t){void 0===t&&(t=0);for(var e,i=this.cells,s=t,a=i.length;s<a;s++)(e=i[s])&&(e.index=s);return this}getParentContainer(){return this.parent}freeCell(t,e){return"number"==typeof t&&(t=this.cells[t]),t?(t.destroy(e),Ts.push(t),this):this}},mask_MaskToGameObject=function(t){return t.hasOwnProperty("geometryMask")?t.geometryMask:t.bitmapMask};const xs=Phaser.Geom.Intersects.RectangleToRectangle,Ps=Phaser.Geom.Rectangle.Overlaps;var containsPoints=function(t,e){var i=0,s=e.top,a=e.bottom,r=e.left,n=e.right;return i+=t.contains(r,s)?1:0,i+=t.contains(r,a)?1:0,i+=t.contains(n,s)?1:0,i+=t.contains(n,a)?1:0},showAll=function(t,e){t.setVisible(!0).clearMask()},showSome=function(t,e){t.setVisible(!0).setMask(e)},showNone=function(t,e){t.setVisible(!1).clearMask()},containerlite_MaskChildren=function(t,e,i){if(e){void 0===i&&(i=t.getAllChildren());for(var s,a,r=t.getBounds(),n=mask_MaskToGameObject(e),o=0,h=i.length;o<h;o++)if(!(s=i[o]).hasOwnProperty("isRexContainerLite")&&s!==n){if(s.getBounds)switch(a=s.getBounds(a),containsPoints(r,a)){case 4:showAll(s,e);break;case 0:xs(r,a)||Ps(r,a)?showSome(s,e):showNone(s,e);break;default:showSome(s,e)}else showSome(s,e);t.resetChildVisibleState(s).updateChildVisible(s)}}};const Cs=ms.a,ws=Phaser.GameObjects.Components,Os=Phaser.Structs.Set,As=Phaser.Utils.Objects.GetValue,Bs=Phaser.Math.Clamp;class Es extends Cs{constructor(t,e,i,s,a,r){void 0===r&&(r={}),super(t,e,i,s,a),this.type="rexGridTable",this._tableOX=0,this._tableOY=0,this.visibleCells=new Os,this.preVisibleCells=new Os,this.visibleStartX=null,this.visibleEndX=null,this.visibleStartY=null,this.visibleEndY=null,this.lastVisibleCellIdx=null,this.execeedTopState=!1,this.execeedBottomState=!1,this.execeedLeftState=!1,this.execeedRightState=!1;var n=As(r,"reuseCellContainer",!1);this.cellContainersPool=n?t.add.group():void 0;var o=As(r,"cellVisibleCallback",null);if(null!==o){var h=As(r,"cellVisibleCallbackScope",void 0);this.on("cellvisible",o,h)}if(null!==(o=As(r,"cellInvisibleCallback",null))){h=As(r,"cellInvisibleCallbackScope",void 0);this.on("cellinvisible",o,h)}if(this.cellsMask=void 0,this.setCellsMask(As(r,"mask",!0)),this.setScrollMode(As(r,"scrollMode",0)),this.setClampMode(As(r,"clamplTableOXY",!0)),0===this.scrollMode){var l=As(r,"cellWidth",void 0);if(this.expandCellSize=void 0===l,void 0===l){var c=As(r,"columns",1);r.cellWidth=this.width/c}}else{l=As(r,"cellHeight",void 0);var d=As(r,"cellWidth",void 0);this.expandCellSize=void 0===l,r.cellWidth=l,r.cellHeight=d}this.table=new Ds(this,r),this.updateTable()}destroy(t){this.scene&&(t||this.setCellsCount(0),this.table.destroy(t),this.table=void 0,this.cellContainersPool&&(this.cellContainersPool.destroy(!0),this.cellContainersPool=void 0),super.destroy(t))}setScrollMode(t){return"string"==typeof t&&(t=Is[t.toLowerCase()]),this.scrollMode=t,this}setClampMode(t){return this.clampTableOXYMode=t,this}setCellsCount(t){var e=this.cellsCount;return e===t?this:(e>t?this.removeCell(t,e-t):this.insertNewCell(e,t-e),this)}setColumnCount(t){return this.table.colCount===t?this:(this.table.setColumnCount(t),this)}setGridSize(t,e){return this.setCellsCount(t*e),this.table.setColumnCount(t),this}insertNewCell(t,e){return"object"==typeof t&&(t=t.index),void 0===e&&(e=1),e<=0?this:(t=Bs(t,0,this.cellsCount),this.table.insertNewCell(t,e),this)}removeCell(t,e){if("object"==typeof t&&(t=t.index),void 0===e&&(e=1),t<0&&(e+=t,t=0),e<=0)return this;if(t>this.cellsCount)return this;if(t<=this.lastVisibleCellIdx)for(var i,s=this.preVisibleCells,a=this.visibleCells,r=t,n=t+e;r<n;r++)(i=this.getCell(r,!1))&&(a.contains(i)&&(this.hideCell(i),a.delete(i)),s.delete(i));return this.table.removeCell(t,e),this}get tableOY(){return this._tableOY}get tableOX(){return this._tableOX}set tableOY(t){this.setTableOY(t).updateTable()}set tableOX(t){this.setTableOX(t).updateTable()}setTableOY(t){var e=this.table,i=this.topTableOY,s=this.bottomTableOY,a=this.tableOYExceedTop(t),r=this.tableOYExeceedBottom(t);this.clampTableOXYMode&&(e.rowCount<e.heightToRowIndex(this.instHeight,!0)?t=0:a?t=i:r&&(t=s));return this._tableOY!==t&&(this._tableOY=t),a&&(this.execeedTopState||this.emit("execeedtop",this,t,i)),this.execeedTopState=a,r&&(this.execeedBottomState||this.emit("execeedbottom",this,t,s)),this.execeedBottomState=r,this}setTableOX(t){var e=this.table,i=this.leftTableOX,s=this.rightTableOX,a=this.tableOXExeceedLeft(t),r=this.tableOXExeceedRight(t);this.clampTableOXYMode&&(e.colCount<e.widthToColIndex(this.instWidth,!0)?t=0:a?t=i:r&&(t=s));return this._tableOX!==t&&(this._tableOX=t),a&&(this.execeedLeftState||this.emit("execeedleft",this,t,i)),this.execeedLeftState=a,r&&(this.execeedRightState||this.emit("execeedright",this,t,s)),this.execeedRightState=r,this}setTableOXY(t,e){return this.setTableOY(e).setTableOX(t),this}addTableOY(t){return this.setTableOY(this.tableOY+t),this}addTableOX(t){return this.setTableOX(this.tableOX+t),this}addTableOXY(t,e){return this.addTableOY(e).addTableOX(t),this}setTableOYByPercentage(t){return this.setTableOY(-this.tableVisibleHeight*t),this}getTableOYPercentage(){var t=this.tableVisibleHeight;return 0===t?0:this.tableOY/-t}set t(t){this.setTableOYByPercentage(t).updateTable()}get t(){return this.getTableOYPercentage()}updateTable(t){return void 0===t&&(t=!1),t&&(this.clearVisibleCellIndexes(),this.hideCells()),this.clearVisibleCellIndexes(),this.showCells(),this.hideCells(),this.maskCells(),this}getCell(t){return this.table.getCell(t,!0)}getCellContainer(t){var e,i=this.table.getCell(t,!1);return i&&(e=i.getContainer()),e}get cellsCount(){return this.table.cellsCount}get columnCount(){return this.table.colCount}setCellHeight(t,e){return("number"==typeof t?this.table.getCell(t,!0):t).height=e,this}setCellWidth(t,e){return("number"==typeof t?this.table.getCell(t,!0):t).width=e,this}pointerToCellIndex(t,e){e-=this.y+this.topLeftY,t-=this.x+this.topLeftX;var i=this.tableOY-(0===this.scrollMode?e:t),s=this.tableOX-(0===this.scrollMode?t:e),a=this.table,r=a.heightToRowIndex(-i),n=a.widthToColIndex(-s),o=a.colRowToCellIndex(n,r);return null===o?null:this.cellIsVisible(o)?o:null}pointerToCellContainer(t,e){var i=this.pointerToCellIndex(t,e);if(null!==i)return this.getCellContainer(i)}cellIsVisible(t){var e=this.table.getCell(t,!1);return e&&this.visibleCells.contains(e)}eachVisibleCell(t,e){return this.visibleCells.each(t,e),this}iterateVisibleCell(t,e){return this.visibleCells.iterate(t,e),this}setCellsMask(t){var e,i;if(!0===t?(e=!0,i=0):!1===t?e=!1:(e=As(t,"mask",!0),i=As(t,"padding",0)),e){var s=new Yi.a(this,0,i);this.cellsMask=s.createGeometryMask(),this.add(s)}return this}maskCells(){for(var t,e=[],i=this.visibleCells.entries,s=0,a=i.length;s<a;s++)(t=i[s].getContainer())&&(t.isRexContainerLite?t.getAllChildren(e):e.push(t));containerlite_MaskChildren(this,this.cellsMask,e)}resize(t,e){return this.width===t&&this.height===e?this:(super.resize(t,e),this.cellsMask&&Object(Pi.a)(mask_MaskToGameObject(this.cellsMask),t,e),this.expandCellSize&&this.table.setDefaultCellWidth(this.instWidth/this.table.colCount),this.updateTable(!0),this)}clearVisibleCellIndexes(){var t=this.preVisibleCells;this.preVisibleCells=this.visibleCells,this.visibleCells=t,this.visibleCells.clear()}showCells(){if(0!==this.cellsCount){var t=this.table,e=t.heightToRowIndex(-this.tableOY);e<0&&(e=0);var i=t.widthToColIndex(-this.tableOX);i<0&&(i=0);var s=t.colRowToCellIndex(i,e),a=this.bottomBound,r=this.rightBound,n=t.cellsCount-1,o=t.colCount-1,h=this.getTLX(i),l=h,c=this.getTLY(e);for(this.visibleStartY=null,this.visibleEndY=null,this.visibleStartX=null,this.visibleEndX=null,this.lastVisibleCellIdx=null;c<a&&s<=n;){if(this.table.isValidCellIdx(s)){null===this.visibleStartY&&(this.visibleStartY=e,this.visibleEndY=e),null===this.visibleStartX&&(this.visibleStartX=i,this.visibleEndX=i),null===this.lastVisibleCellIdx&&(this.lastVisibleCellIdx=s),this.visibleEndY<e&&(this.visibleEndY=e),this.visibleEndX<i&&(this.visibleEndX=i),this.lastVisibleCellIdx<s&&(this.lastVisibleCellIdx=s);var d=t.getCell(s,!0);this.visibleCells.set(d),this.preVisibleCells.contains(d)||this.showCell(d),0===this.scrollMode?d.setXY(l,c):d.setXY(c,l)}l<r&&i<o?(l+=t.getColWidth(i),i+=1):(l=h,c+=t.getRowHeight(e),i=this.visibleStartX,e+=1),s=t.colRowToCellIndex(i,e)}}}showCell(t){var e=null;if(this.cellContainersPool&&null!==(e=this.cellContainersPool.getFirstDead())&&e.setActive(!0).setVisible(!0),this.emit("cellvisible",t,e),this.cellContainersPool){var i=t.getContainer();i?null===e?this.cellContainersPool.add(i):e!==i&&(this.cellContainersPool.add(i),this.cellContainersPool.killAndHide(e)):null!==e&&this.cellContainersPool.killAndHide(e)}}hideCells(){var t=this.preVisibleCells,e=this.visibleCells;t.iterate((function(t){e.contains(t)||this.hideCell(t)}),this)}hideCell(t){if(this.emit("cellinvisible",t),this.cellContainersPool){var e=t.popContainer();e&&this.cellContainersPool.killAndHide(e)}t.destroyContainer()}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get tableHeight(){return this.table.totalRowsHeight}get tableWidth(){return this.table.totalColumnWidth}get topTableOY(){return 0}get bottomTableOY(){return-this.tableVisibleHeight}get leftTableOX(){return 0}get rightTableOX(){return-this.tableVisibleWidth}tableOYExceedTop(t){return void 0===t&&(t=this.tableOY),t>this.topTableOY}tableOYExeceedBottom(t){return void 0===t&&(t=this.tableOY),t<this.bottomTableOY}tableOXExeceedLeft(t){return void 0===t&&(t=this.tableOX),t>this.leftTableOX}tableOXExeceedRight(t){return void 0===t&&(t=this.tableOX),t<this.rightTableOX}get tableVisibleHeight(){var t=this.tableHeight,e=this.instHeight;return t>e?t-e:0}get tableVisibleWidth(){var t=this.tableWidth,e=this.instWidth;return t>e?t-e:0}get bottomLeftY(){return-this.displayHeight*this.originY+this.displayHeight}get topRightX(){return-this.displayWidth*this.originX+this.displayWidth}get topLeftX(){return-this.displayWidth*this.originX}get topLeftY(){return-this.displayHeight*this.originY}get bottomBound(){return 0===this.scrollMode?this.bottomLeftY:this.topRightX}get rightBound(){return 0===this.scrollMode?this.topRightX:this.bottomLeftY}getTLX(t){var e=0===this.scrollMode?this.topLeftX:this.topLeftY;return this.tableOX+this.table.colIndexToWidth(0,t-1)+e}getTLY(t){var e=0===this.scrollMode?this.topLeftY:this.topLeftX;return this.tableOY+this.table.rowIndexToHeight(0,t-1)+e}}Object.assign(Es.prototype,ws.GetBounds);const Is={v:0,vertical:0,h:1,horizontal:1};var Ms=Es,gridtable_InjectProperties=function(t){Object.defineProperty(t,"childOY",{configurable:!0,get:function(){return t.tableOY},set:function(e){t.tableOY=e}}),Object.defineProperty(t,"topChildOY",{get:function(){return t.topTableOY}}),Object.defineProperty(t,"bottomChildOY",{get:function(){return t.bottomTableOY}})},gridtable_TableOnCellVisible=function(t){t.on("cellvisible",(function(t,e){var i,s=this.createCellContainerCallback,a=this.createCellContainerCallbackScope;t.item=this.items[t.index],(i=a?s.call(a,t,e):s(t,e)).setOrigin&&i.setOrigin(0),i.isRexSizer&&i.layout(),t.item=void 0,t.setContainer(i)}),this)},input_EmitCellEvent=function(t,e,i,s,a){var r;if(null!=(r=void 0===a?s:i.pointerToCellIndex(s,a))){var n=i.getCellContainer(r);t.emit(e,n,r)}},input_ClickCell=function(t){t._click=new _e(t,{threshold:10}),t._click.on("click",(function(t,e,i){input_EmitCellEvent(this.eventEmitter,"cell.click",e,i.x,i.y)}),this)},OnMove=function(t){if(!t.isDown){var e=this.childrenMap.child,i=e.pointerToCellIndex(t.x,t.y);if(i!==this._lastOverCellIndex){var s=this._lastOverCellIndex;this._lastOverCellIndex=i,input_EmitCellEvent(this.eventEmitter,"cell.out",e,s),input_EmitCellEvent(this.eventEmitter,"cell.over",e,i)}}},OnOut=function(){var t=this.childrenMap.child,e=this._lastOverCellIndex;this._lastOverCellIndex=void 0,input_EmitCellEvent(this.eventEmitter,"cell.out",t,e)},input_OverCell=function(t){t.on("pointermove",OnMove,this).on("pointerover",OnMove,this).on("pointerup",OnOut,this).on("pointerout",OnOut,this)};const ks=Phaser.Utils.Objects.GetValue;class Rs{constructor(t,e){this.parent=t,this._isRunning=!1,this.tickingState=!1,this.setEventEmitter(ks(e,"eventEmitter",void 0)),this.setTickingMode(ks(e,"tickingMode",1))}boot(){2!==this.tickingMode||this.tickingState||this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(t){"string"==typeof t&&(t=Ls[t]),this.tickingMode=t}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking()))}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(){this.isRunning=!1,this.emit("complete",this.parent,this)}}Object.assign(Rs.prototype,me.a);const Ls={no:0,lazy:1,always:2};var Fs=Rs;const Ns=Phaser.Utils.Objects.GetValue;const js=0,Ws=1,Hs="IDLE";var Vs=class extends Fs{constructor(t,e){var i=Object(ue.a)(t);i===t&&(t=void 0),super(i,e),this.scene=i,this.gameObject=t,t&&t.setInteractive(Ns(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(Ns(t,"enable",!0)),void 0===this.gameObject?this.bounds=Ns(t,"bounds",void 0):this.bounds=void 0,this.tracerState=js,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,this.isTouchingAnyObject=!1,this}boot(){super.boot(),this.gameObject?this.gameObject.on("pointerdown",this.onPointerDown,this):this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.gameObject?this.gameObject.off("pointerdown",this.onPointerDown,this):this.scene&&this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene&&(this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0,this.gameObject=void 0,this.bounds=void 0,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,super.shutdown()}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.dragCancel(),this.enable=t,this)}onPointerDown(t,e){this.enable&&(void 0===this.pointer&&(!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer!==t&&(this.pointer=t,this.lastPointer=t,this.movedState=!1,this.tracerState=Ws,void 0===this.gameObject&&(this.isTouchingAnyObject=e.length>0),this.onDragStart()))}onPointerUp(t){this.enable&&((!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer===t&&(this.pointer=void 0,this.movedState=!1,this.tracerState=js,this.onDragEnd()))}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),i=this.pointer===t;!i&&e||(i&&!e?this.onPointerUp(t):(this.movedState||(this.movedState=t.x!==t.downX||t.y!==t.downY),this.movedState&&this.onDrag()))}}dragCancel(){return this.tracerState===Ws&&this.onDragEnd(),this.pointer=void 0,this.tracerState=js,this}onDragStart(){this.emit("dragstart",this)}onDragEnd(){this.emit("dragend",this)}onDrag(){this.emit("drag",this)}preUpdate(t,e){}postUpdate(t,e){}startTicking(){super.startTicking(),this.scene.events.on("preupdate",this.preUpdate,this),this.scene.events.on("postupdate",this.postUpdate,this)}stopTicking(){super.stopTicking(),this.scene&&(this.scene.events.off("preupdate",this.preUpdate,this),this.scene.events.off("postupdate",this.postUpdate,this))}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=Hs,this}},zs=i(29);const Gs=Phaser.Utils.Objects.GetValue,Us=Phaser.Math.Distance.Between;const Ys="IDLE",Xs="BEGIN",Ks="RECOGNIZED";var Qs=class extends Vs{constructor(t,e){super(t,e);var i=this,s={states:{IDLE:{enter:function(){i.stop(),i.tapsCount=0,i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start(),i.tapsCount=0,i.emit("tappingstart",i,i.gameObject,i.lastPointer)}},RECOGNIZED:{enter:function(){i.start(),i.emit("tap",i,i.gameObject,i.lastPointer),i.emit(`${i.tapsCount}tap`,i,i.gameObject,i.lastPointer)}}},init:function(){this.state=Ys},eventEmitter:!1};this.setRecongizedStateObject(new zs.a(s))}resetFromJSON(t){super.resetFromJSON(t),this.setMaxHoldTime(Gs(t,"time",250)),this.setTapInterval(Gs(t,"tapInterval",200)),this.setDragThreshold(Gs(t,"threshold",9)),this.setTapOffset(Gs(t,"tapOffset",10));var e=Gs(t,"taps",void 0);return void 0!==e?this.setTaps(e):(this.setMaxTaps(Gs(t,"maxTaps",void 0)),this.setMinTaps(Gs(t,"minTaps",void 0))),this}onDragStart(){switch(this.state){case Ys:this.state=Xs;break;case Xs:var t=this.lastPointer;Us(t.upX,t.upY,t.x,t.y)>this.tapOffset&&(this.state=Ks,this.state=Xs);break;case Ks:this.state=Xs}}onDragEnd(){this.state===Xs&&(this.tapsCount++,this.emit("tapping",this,this.gameObject,this.lastPointer),void 0!==this.maxTaps&&this.tapsCount===this.maxTaps&&(this.state=Ks))}onDrag(){this.state!==Ys&&this.pointer.getDistance()>this.dragThreshold&&(this.state=Ys)}preUpdate(t,e){if(this.state===Xs){var i=this.lastPointer;if(i.isDown)t-i.downTime>this.holdTime&&(this.state=Ys);else t-i.upTime>this.tapInterval&&(void 0===this.minTaps||this.tapsCount>=this.minTaps?this.state=Ks:this.state=Ys)}}postUpdate(t,e){this.state===Ks&&(this.state=Ys)}get isTapped(){return this.state===Ks}setMaxHoldTime(t){return this.holdTime=t,this}setTapInterval(t){return this.tapInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setTapOffset(t){return this.tapOffset=t,this}setMaxTaps(t){return this.maxTaps=t,this}setMinTaps(t){return this.minTaps=t,this}setTaps(t,e){return void 0===e&&(e=t),this.setMinTaps(t).setMaxTaps(e),this}},input_TapCell=function(t){t._tap=new Qs(t),t._tap.on("tap",(function(t){var e=`cell.${t.tapsCount}tap`;input_EmitCellEvent(this.eventEmitter,e,t.gameObject,t.x,t.y)}),this)};const $s=Phaser.Utils.Objects.GetValue;const Zs="IDLE",Js="BEGIN",qs="RECOGNIZED";var ta=class extends Vs{constructor(t,e){super(t,e);var i=this,s={states:{IDLE:{enter:function(){i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start()},exit:function(){i.stop()}},RECOGNIZED:{enter:function(){i.emit("pressstart",i,i.gameObject,i.lastPointer)},exit:function(){i.emit("pressend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=Zs},eventEmitter:!1};this.setRecongizedStateObject(new zs.a(s))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold($s(t,"threshold",9)),this.setMinHoldTime($s(t,"time",251)),this}onDragStart(){this.state=0===this.holdTime?qs:Js}onDragEnd(){this.state=Zs}onDrag(){this.state!==Zs&&this.pointer.getDistance()>this.dragThreshold&&(this.state=Zs)}preUpdate(t,e){this.state===Js&&(t-this.pointer.downTime>=this.holdTime&&(this.state=qs))}get isPressed(){return this.state===qs}setDragThreshold(t){return this.dragThreshold=t,this}setMinHoldTime(t){return this.holdTime=t,this}},input_PressCell=function(t){t._press=new ta(t),t._press.on("pressstart",(function(t){var e=t.gameObject,i=e.pointerToCellIndex(t.x,t.y);t._cellIndex=i,input_EmitCellEvent(this.eventEmitter,"cell.pressstart",e,i)}),this).on("pressend",(function(t){var e=t.gameObject,i=t._cellIndex;t._cellIndex=void 0,input_EmitCellEvent(this.eventEmitter,"cell.pressend",e,i)}),this)},input_TableSetInteractive=function(t){t.setInteractive(),input_ClickCell.call(this,t),input_OverCell.call(this,t),input_TapCell.call(this,t),input_PressCell.call(this,t)},gridtable_SetItems=function(t){void 0===t?this.items.length=0:this.items=t;var e=this.childrenMap.child;return e.setCellsCount(this.items.length),e.updateTable(!0),this.resizeController(),this};const ea=Phaser.Utils.Objects.GetValue;class ia extends cs.a{constructor(t,e){void 0===e&&(e={});var i=Object(ds.a)(e),s=ea(e,"table",void 0);void 0===s&&(s={}),s.scrollMode=i,s.clamplTableOXY=ea(e,"clamplChildOY",!1);var a,r,n=ea(s,"width",void 0),o=ea(s,"height",void 0),h=new Ms(t,0,0,n,o,s);0===i?(a=void 0===n?1:0,r=void 0===o):(a=void 0===o?1:0,r=void 0===n),gridtable_InjectProperties(h),e.type="rexGridTable",e.child={gameObject:h,proportion:a,expand:r};var l=ea(e,"space",void 0);l&&(l.child=l.table),super(t,e),this.addChildrenMap("table",h),this.eventEmitter=ea(e,"eventEmitter",this);var c=ea(e,"createCellContainerCallback",He.a),d=ea(e,"createCellContainerCallbackScope",void 0);this.setCreateCellContainerCallback(c,d),gridtable_TableOnCellVisible.call(this,h),ea(s,"interactive",!0)&&input_TableSetInteractive.call(this,h),this.setItems(ea(e,"items",[]))}setCreateCellContainerCallback(t,e){return this.createCellContainerCallback=t,this.createCellContainerCallbackScope=e,this}refresh(){return this.childrenMap.child.updateTable(!0),this}}var sa={setItems:gridtable_SetItems};Object.assign(ia.prototype,sa);var aa=ia;Te.register("gridTable",(function(t){var e=new aa(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.GridTable",aa);var ra={expandSubMenu:function(t,e){this.collapseSubMenu();var i=new this.constructor(this.scene,{items:e,orientation:this.orientation,createButtonCallback:this.root.createButtonCallback,createButtonCallbackScope:this.root.createButtonCallbackScope,easeIn:this.root.easeIn,easeOut:this.root.easeOut,root:this.root,parent:t});return this.add(i,null),this.childrenMap.subMenu=i,this},collapse:function(){return this.root.easeOut?this.scaleDownDestroy(this.root.easeOut):this.destroy(),this.collapseSubMenu(),this},collapseSubMenu:function(){if(void 0===this.childrenMap.subMenu)return this;var t=this.childrenMap.subMenu;return this.childrenMap.subMenu=void 0,this.remove(t),t.collapse(),this}},menu_CreateButtons=function(t,e,i,s){var a,r,n=[];if(e&&i)for(var o=0,h=e.length;o<h;o++)(a=e[o]).scene=t,r=s?i.call(s,a,o):i(a,o),a.scene=void 0,n.push(r);return n},na=i(128),menu_MenuSetInteractive=function(t){t.on(t.root.expandEventName,(function(t,e){if(!this.isPassedEvent){var i=this.items[e].children;i&&this.expandSubMenu(t,i)}}),t).on("button.click",(function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.click",t,e),this.root.isPassedEvent=!1)}),t).on("button.over",(function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.over",t,e),this.root.isPassedEvent=!1)}),t).on("button.out",(function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.out",t,e),this.root.isPassedEvent=!1)}),t)};const oa=Phaser.Utils.Objects.GetValue;class ha extends ts{constructor(t,e){void 0===e&&(e={}),e.hasOwnProperty("orientation")||(e.orientation=1);var i=oa(e,"items",void 0),s=oa(e,"createButtonCallback",void 0),a=oa(e,"createButtonCallbackScope",void 0);if(e.buttons=menu_CreateButtons(t,i,s,a),super(t,e),this.type="rexMenu",this.items=i,this.root=oa(e,"root",this),this.root===this){if(this.expandEventName=oa(e,"expandEvent","button.click"),this.easeIn=oa(e,"easeIn",void 0),this.easeOut=oa(e,"easeOut",void 0),this.bounds=oa(e,"bounds",void 0),this.expandOrientation=oa(e,"expandOrientation",void 0),void 0===this.expandOrientation){var r=this.bounds;void 0===r&&(r=Object(na.a)(t)),0===this.orientation?this.expandOrientation=this.y<r.centerY?1:3:this.expandOrientation=this.x<r.centerX?0:2}this.createButtonCallback=s,this.createButtonCallbackScope=a,this.isPassedEvent=!1}this.setOrigin(0).layout();var n=oa(e,"parent",void 0);if(n)switch(this.root.expandOrientation){case 0:this.alignTop(n.top).alignLeft(n.right);break;case 1:this.alignLeft(n.left).alignTop(n.bottom);break;case 2:this.alignTop(n.top).alignRight(n.left);break;case 3:this.alignLeft(n.left).alignBottom(n.top)}this.pushIntoBounds(this.root.bounds),menu_MenuSetInteractive(this),this.root.easeIn&&this.popUp(this.root.easeIn)}isInTouching(t){return!!super.isInTouching(t)||!!this.childrenMap.subMenu&&this.childrenMap.subMenu.isInTouching(t)}}Object.assign(ha.prototype,ra);var la=ha;Te.register("menu",(function(t){var e=new la(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Menu",la);var ca=i(132);const da=Phaser.Utils.Objects.GetValue,ma=Phaser.Math.Clamp;var transferText=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t},ua=class{constructor(t,e){this.gameObject=t,this.scene=Object(ue.a)(t),this.setTextObjectType(),this.lines=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setText(da(t,"text","")),this.setStartIdx(da(t,"start",0)),this.setPageIdx(da(t,"page",-1)),this}toJSON(){return{text:this.text,start:this.startLineIdx,page:this.pageIndex,pageCount:this.pageCount}}boot(){this.gameObject.once("destroy",this.destroy,this)}shutdown(){return void 0===this.lines||(0===this.textObjectType?this.lines.length=0:this.lines.destroy()),this.gameObject=void 0,this.scene=void 0,this}destroy(){this.shutdown()}setTextObjectType(){return this.textObjectType=Object(ca.a)(this.gameObject)?0:1,this}get isFirstPage(){return this.pageIndex<=0}get isLastPage(){return this.pageIndex>=this.pageCount-1}setText(t,e){return void 0===e&&(e=!0),this.text=transferText(t),0===this.textObjectType?this.lines=this.gameObject.getWrappedText(this.text):this.lines=this.gameObject.getPenManager(this.text,this.lines),this.pageCount=Math.ceil(this.totalLinesCount/this.pageLinesCount),e&&this.resetPageIdx(),this}appendText(t){return this.setText(this.text.concat(transferText(t))),this}getPage(t){return void 0===t&&(t=this.pageIndex),this.setPageIdx(t).getLines()}getNextPage(){return this.getPage(this.pageIndex+1)}getPreviousPage(){return this.getPage(this.pageIndex-1)}showPage(t){return this.displayText(this.getPage()),this}showNextPage(){return this.displayText(this.getNextPage()),this}showPreviousPage(){return this.displayText(this.getPreviousPage()),this}show(){return this.displayText(this.getLines()),this}showNextLine(){return this.displayText(this.setStartIdx(this.startLineIdx+1).getLines()),this}showPreviousLine(){return this.displayText(this.setStartIdx(this.startLineIdx-1).getLines()),this}setStartIdx(t){return t=ma(t,0,this.totalLinesCount-1),this.startLineIdx=t,this}resetPageIdx(){this.pageIndex=-1}setPageIdx(t){return t=ma(t,0,this.pageCount-1),this.pageIndex=t,this.setStartIdx(this.pageIndex*this.pageLinesCount),this}get totalLinesCount(){return 0===this.textObjectType?this.lines.length:this.lines.linesCount}get pageLinesCount(){var t=this.gameObject.style.maxLines;return t>0?t:this.totalLinesCount}getLines(t){void 0===t&&(t=this.startLineIdx);var e,i=t+this.pageLinesCount;if(0===this.textObjectType)e=this.lines.slice(t,i).join("\n");else{var s=this.lines.getLineStartIndex(t),a=this.lines.getLineEndIndex(i-1);e=this.lines.getSliceTagText(s,a,!0)}return e}displayText(t){this.gameObject.setText(t)}};const pa=Phaser.Events.EventEmitter,ga=Phaser.Utils.Objects.GetFastValue,fa=Phaser.Utils.Objects.GetValue;var TextTyping_transferText=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t};const _a={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var ya=class extends pa{constructor(t,e){super(),this.gameObject=t,this.scene=Object(ue.a)(t),this.timer=null,this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setTypeMode(fa(t,"typeMode",0)),this.setTypeSpeed(fa(t,"speed",333)),this.setTextCallback=ga(t,"setTextCallback",null),this.setTextCallbackScope=ga(t,"setTextCallbackScope",null),this.typingIdx=ga(t,"typingIdx",0),this.text=TextTyping_transferText(ga(t,"text","")),this.textLen=ga(t,"textLen",0),this.insertIdx=ga(t,"insertIdx",null);var e=ga(t,"elapsed",null);return null!==e&&this.start(void 0,void 0,this.typingIdx,e),this}toJSON(){var t,e=this.getTimer();return t=e?e.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:t}}boot(){return this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return super.shutdown(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(t){return"string"==typeof t&&(t=_a[t]),this.typeMode=t,this}setTypeSpeed(t){return this.speed=t,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(t,e,i,s){return void 0!==t&&this.setTypingContent(t),void 0!==e&&(this.speed=e),void 0===i&&(i=0),this.typingIdx=i+1,0===this.speed?this.stop(!0):this.startTimer(s),this}appendText(t){var e=this.text.concat(TextTyping_transferText(t));return this.isTyping?this.setTypingContent(e):this.start(e,void 0,this.textLen),this}stop(t){return this.getTimer()&&this.freeTimer(),t&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var t=this.getTimer();return t&&(t.paused=!0),this}resume(){var t=this.getTimer();return t&&(t.paused=!1),this}setTypingContent(t){return this.text=TextTyping_transferText(t),this.textLen=this.getTextLength(this.text),this}onTyping(){var t=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(t),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(t,e,i,s){var a;if(0===s){var r=0,n=e;this.insertIdx=n,a=this.getSubString(t,r,n)}else if(1===s){r=(n=i)-e;this.insertIdx=0,a=this.getSubString(t,r,n)}else if(2===s){var o=i/2;n=(r=Math.floor(o-e/2))+e;this.insertIdx=e%2?e:0,a=this.getSubString(t,r,n)}else if(3===s){var h,l=Math.floor(e/2);if(l>0){r=(n=i)-l;h=this.getSubString(t,r,n)}else h="";var c,d=e-l;if(d>0){n=(r=0)+d;this.insertIdx=n,c=this.getSubString(t,r,n)}else c="",this.insertIdx=0;a=c+h}return a}startTimer(t){var e;return this.timer&&this.freeTimer(),void 0===t?(0,e=0):(this.speed,e=t),this.timer=this.scene.time.addEvent({delay:0,startAt:e,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(t){this.setTextCallback&&(t=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,t,this.isLastChar,this.insertIdx):this.setTextCallback(t,this.isLastChar,this.insertIdx)),this.gameObject.setText(t)}getTextLength(t){var e=this.gameObject;return e.getPlainText?e.getPlainText(t).length:t.length}getSubString(t,e,i){var s=this.gameObject;return s.getSubString?s.getSubString(t,e,i):t.slice(e,i)}};const va=Phaser.Utils.Objects.GetValue;var TextBox_createDefaultTextObject=function(t){return t.add.text(0,0,"",{wordWrap:{width:200},maxLines:5})},Sa=class extends Qi{constructor(t,e){void 0===e&&(e={text:TextBox_createDefaultTextObject(t)}),super(t,e),this.type="rexTextBox";var i=this.childrenMap.text;this.page=new ua(i,va(e,"page",void 0)),this.typing=new ya(i,va(e,"type",void 0)),this.typing.on("complete",this.onPageEnd,this).on("type",this.onType,this),this.textWidth=i.width,this.textHeight=i.height}start(t,e){return this.page.setText(t),void 0!==e&&this.typing.setTypeSpeed(e),this.typeNextPage(),this}typeNextPage(){if(this.page.isLastPage)this.emit("complete");else{var t=this.page.getNextPage();this.typing.start(t)}return this}pause(){return this.typing.pause(),this}resume(){return this.typing.resume(),this}stop(t){return this.typing.stop(t),this}get isTyping(){return this.typing.isTyping}get isLastPage(){return this.page.isLastPage}get isFirstPage(){return this.page.isFirstPage}get pageCount(){return this.page.pageCount}get pageIndex(){return this.page.pageIndex}onType(){var t=this.childrenMap.text;this.textWidth===t.width&&this.textHeight===t.height||(this.textWidth=t.width,this.textHeight=t.height,this.getTopmostSizer().layout()),this.emit("type")}onPageEnd(){this.emit("pageend")}};Te.register("textBox",(function(t){var e=new Sa(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.TextBox",Sa);const ba=Phaser.Utils.Objects.GetValue,Ta=Phaser.Math.Percent,Da=Phaser.Math.Linear;class xa extends Di.a{constructor(t,e){super(t,e),this.type="rexNumberBar";var i,s=ba(e,"background",void 0),a=ba(e,"icon",void 0),r=ba(e,"iconMask",void 0),n=ba(e,"slider",void 0),o=ba(e,"text",void 0),h=ba(e,"space.left",0),l=ba(e,"space.right",0),c=ba(e,"space.top",0),d=ba(e,"space.bottom",0),m=ba(e,"space.icon",0),u=ba(e,"space.slider",0);(s&&this.addBackground(s),a)&&(p=0===this.orientation?{left:h,right:n||o?m:l,top:c,bottom:d}:{left:h,right:l,top:c,bottom:n||o?m:d},this.add(a,0,"center",p),r&&(r=new Yi.a(a,1),a.setMask(r.createGeometryMask()),this.add(r,null)));if(n){var p,g;if(n.orientation=0==this.orientation?1:0,n.eventEmitter=this,n.value=null,n.hasOwnProperty("input")||(n.input=-1),i=new ls.a(t,n),p=0===this.orientation?{left:a?0:h,right:o?u:l,top:c,bottom:d}:{left:h,right:l,top:a?0:c,bottom:o?u:d},0===this.orientation)g=void 0===ba(n,"width",void 0)?1:0;else g=void 0===ba(n,"height",void 0)?1:0;this.add(i,g,"center",p)}o&&(p=0===this.orientation?{left:a||n?0:h,right:l,top:c,bottom:d}:{left:h,right:l,top:a||n?0:c,bottom:d},this.add(o,0,"center",p));this.addChildrenMap("background",s),this.addChildrenMap("icon",a),this.addChildrenMap("slider",i),this.addChildrenMap("text",o);var f=ba(e,"valuechangeCallback",null);if(null!==f){var _=ba(e,"valuechangeCallbackScope",void 0);this.on("valuechange",f,_)}this.setEnable(ba(e,"enable",void 0)),this.setValue(ba(e,"value",0))}setEnable(t){return this.childrenMap.slider?this:(void 0===t&&(t=!0),this.childrenMap.slider.enable=t,this)}get value(){return this.childrenMap.slider?this.childrenMap.slider.value:0}set value(t){this.childrenMap.slider&&(this.childrenMap.slider.value=t)}setValue(t,e,i){return void 0!==e&&(t=Ta(t,e,i)),this.value=t,this}addValue(t,e,i){return void 0!==e&&(t=Ta(t,e,i)),this.value+=t,this}getValue(t,e){var i=this.value;return void 0!==t&&(i=Da(t,e,i)),i}get text(){var t=this.childrenMap.text;return void 0===t?"":t.text?t.text:t.getData("text")}set text(t){var e=this.childrenMap.text;void 0!==e&&(e.setText?e.setText(t):e.setData("text",t))}setText(t){return this.text=t,this}}var Pa=xa;Te.register("numberBar",(function(t){var e=new Pa(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.NumberBar",Pa);const Ca=Phaser.Utils.Objects.IsPlainObject,wa=Phaser.Display.Align.TOP_LEFT;var pages_AddPage=function(t,e,i,s,a){if(Ca(e)){var r=e;e=GetValue(r,"key",0),i=GetValue(r,"align",wa),s=GetValue(r,"padding",0),a=GetValue(r,"expand",!1)}return"string"==typeof i&&(i=Bi.a[i]),void 0===i&&(i=ALIGN_CENTER),void 0===s&&(s=0),void 0===a&&(a=!0),(r=this.getSizerConfig(t)).parent=this,r.align=i,r.padding=Object(Ai.a)(s),r.expand=a,this.sizerChildren.has(e)&&this.sizerChildren.get(e).destroy(),this.sizerChildren.set(e,t),t.setVisible(!1),this.add(t),this},pages_GetPage=function(t){return void 0===t?null:this.sizerChildren.has(t)?this.sizerChildren.get(t):null},pages_SwapPage=function(t){this._previousKey=this._currentKey;var e=this.previousPage;e&&(0===this.swapMode?(e.setVisible(!1),this.resetChildVisibleState(e),this.emit("pageinvisible",e,this._previousKey,this)):e.destroy()),t&&!this.sizerChildren.has(t)&&this.emit("createpage",t,this),this._currentKey=t;var i=this.currentPage;return i&&(i.setVisible(!0),this.resetChildVisibleState(i),this.emit("pagevisible",i,this._currentKey,this)),this},pages_GetChildrenWidth=function(){if(this.rexSizer.hidden)return 0;var t,e,i,s=0,a=this.sizerChildren.entries;for(var r in a)i=(t=a[r]).isRexSizer?Math.max(t.minWidth,t.childrenWidth):t.width,i+=(e=t.rexSizer.padding).left+e.right,s=Math.max(i,s);return s},pages_GetChildrenHeight=function(){if(this.rexSizer.hidden)return 0;var t,e,i,s=0,a=this.sizerChildren.entries;for(var r in a)i=(t=a[r]).isRexSizer?Math.max(t.minHeight,t.childrenHeight):t.height,i+=(e=t.rexSizer.padding).top+e.bottom,s=Math.max(i,s);return s},pages_GetChildrenSizers=function(t){void 0===t&&(t=[]);var e,i=this.sizerChildren.entries;for(var s in i)(e=i[s]).isRexSizer&&t.push(e);return t},pages_GetExpandedChildWidth=function(t,e){var i,s=e.rexSizer,a=s.padding;return s.expand&&(i=t.width-a.left-a.right),i},pages_GetExpandedChildHeight=function(t,e){var i,s=e.rexSizer,a=s.padding;return s.expand&&(i=t.height-a.top-a.bottom),i};const Oa=Phaser.Display.Align.In.QuickSet;var Aa={addPage:pages_AddPage,getPage:pages_GetPage,swapPage:pages_SwapPage,getChildrenWidth:pages_GetChildrenWidth,getChildrenHeight:pages_GetChildrenHeight,getChildrenSizers:pages_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var s,a,r;this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i);var n,o,h,l,c,d,m=this.left,u=this.top,p=this.pages;for(var g in p)r=(a=(s=p[g]).rexSizer).padding,s.isRexSizer?s.layout(this,pages_GetExpandedChildWidth(this,s),pages_GetExpandedChildHeight(this,s)):(c=void 0,d=void 0,a.expand&&(d=this.height-r.top-r.bottom,c=this.width-r.left-r.right),Object(Pi.a)(s,c,d)),n=m+r.left,h=this.width-r.left-r.right,o=u+r.top,l=this.height-r.top-r.bottom,Ci.a.setPosition(n,o).setSize(h,l),Oa(s,Ci.a,a.align),this.resetChildPositionState(s);return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0}};const Ba=Phaser.Utils.Objects.IsPlainObject,Ea=Phaser.Utils.Objects.GetValue,Ia=Phaser.Structs.Map;class Ma extends xi.a{constructor(t,e,i,s,a,r){Ba(e)?(e=Ea(r=e,"x",0),i=Ea(r,"y",0),s=Ea(r,"width",void 0),a=Ea(r,"height",void 0)):Ba(s)&&(s=Ea(r=s,"width",void 0),a=Ea(r,"height",void 0)),super(t,e,i,s,a,r),this.type="rexPages",this._previousKey=void 0,this._currentKey=void 0,this.sizerChildren=new Ia,this.setSwapMode(Ea(r,"swapMode",0)),this.addChildrenMap("pages",this.pages)}destroy(t){this.scene&&(this.sizerChildren.clear(),super.destroy(t))}setSwapMode(t){return"string"==typeof t&&(t=ka[t]),this.swapMode=t,this}get previousKey(){return this._previousKey}get currentKey(){return this._currentKey}set currentKey(t){this.swapPage(t)}get currentPage(){return this.getPage(this.currentKey)}get previousPage(){return this.getPage(this.previousKey)}get keys(){return this.sizerChildren.keys()}get pages(){return this.sizerChildren.entries}}Object.assign(Ma.prototype,Aa);const ka={invisible:0,destroy:1};var Ra=Ma;Te.register("pages",(function(t,e,i,s,a){var r=new Ra(this.scene,t,e,i,s,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.Pages",Ra);var La=i(158);Te.register("textBlock",(function(t,e,i,s,a,r){var n=new La.a(this.scene,t,e,i,s,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.TextBlock",La.a);La.a;var Fa=i(102);Te.register("textArea",(function(t){var e=new Fa.a(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.TextArea",Fa.a);Fa.a;const Na=Phaser.Utils.Objects.GetValue,ja=Phaser.Display.Align.TOP_LEFT;var Wa={setChild:function(t,e,i){t.setOrigin&&t.setOrigin(0),this.add(t);var s,a,r=this.getSizerConfig(t);if(r.parent=this,r.align=ja,r.expand=e,this.child=t,!0===i?(s=!0,a=0):!1===i?s=!1:(s=Na(i,"mask",!0),a=Na(i,"padding",0)),s){var n=new Yi.a(this,0,a);this.childMask=n.createGeometryMask(),this.add(n)}return this},getChildrenWidth:function(){if(this.rexSizer.hidden)return 0;var t=this.child;return t.rexSizer.hidden?0:0===this.scrollMode?t.isRexSizer?Math.max(t.minWidth,t.childrenWidth):t.width:0},getChildrenHeight:function(){if(this.rexSizer.hidden)return 0;var t=this.child;return t.rexSizer.hidden?0:0===this.scrollMode?0:t.isRexSizer?Math.max(t.minHeight,t.childrenHeight):t.height},resetChildPosition:function(){var t=this.left,e=this.top;0===this.scrollMode?e+=this.childOY:t+=this.childOY,this.child.setPosition(t,e),containerlite_MaskChildren(this,this.childMask,this.child.getAllChildren()),this.resetChildPositionState(this.child)},layout:function(t,e,i){if(this.rexSizer.hidden)return this;this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i);var s,a,r=this.child;if(!r.rexSizer.hidden&&(0===this.scrollMode?s=this.width:a=this.height,r.isRexSizer?r.layout(this,s,a):Object(Pi.a)(r,s,a),this.resetChildPosition(),this.childMask)){var n=mask_MaskToGameObject(this.childMask);n.setPosition().resize(),this.resetChildPositionState(n)}return this}},Ha=i(131);const Va=Phaser.Utils.Objects.IsPlainObject,za=Phaser.Utils.Objects.GetValue;class Ga extends xi.a{constructor(t,e,i,s,a,r){Va(e)?(e=za(r=e,"x",0),i=za(r,"y",0),s=za(r,"width",void 0),a=za(r,"height",void 0)):Va(s)&&(s=za(r=s,"width",void 0),a=za(r,"height",void 0)),super(t,e,i,s,a,r),this.type="rexScrollableBlock",this.child=void 0,this.childMask=void 0,this._childOY=0,this.execeedTopState=!1,this.execeedBottomState=!1,this.setScrollMode(za(r,"scrollMode",!0)),this.setClampMode(za(r,"clamplChildOY",!0));var n=za(r,"child",void 0),o=za(r,"expand",!0),h=za(r,"mask",void 0);this.setChild(n,o,h)}destroy(t){this.scene&&(this.child=void 0,this.childMask&&(this.childMask.destroy(),this.childMask=void 0),super.destroy(t))}setScrollMode(t){return"string"==typeof t&&(t=Ha.a[t.toLowerCase()]),this.scrollMode=t,this}setClampMode(t){return this.clampChildOYMode=t,this}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get childHeight(){return 0===this.scrollMode?this.child.height:this.child.width}get childWidth(){return 0===this.scrollMode?this.child.width:this.child.height}get topChildOY(){return 0}get bottomChildOY(){return-this.visibleHeight}get visibleHeight(){var t=this.childHeight,e=this.instHeight;return t>e?t-e:0}childOYExceedTop(t){return void 0===t&&(t=this.childOY),t>this.topChildOY}childOYExeceedBottom(t){return void 0===t&&(t=this.childOY),t<this.bottomChildOY}get childOY(){return this._childOY}set childOY(t){var e=this.topChildOY,i=this.bottomChildOY,s=this.childOYExceedTop(t),a=this.childOYExeceedBottom(t);this.clampChildOYMode&&(this.instHeight>this.childHeight?t=0:s?t=e:a&&(t=i)),this._childOY!==t&&(this._childOY=t,this.resetChildPosition()),s&&(this.execeedTopState||this.emit("execeedtop",this,t,e)),this.execeedTopState=s,a&&(this.execeedBottomState||this.emit("execeedbottom",this,t,i)),this.execeedBottomState=a}setChildOY(t){return this.childOY=t,this}set t(t){this.childOY=-this.visibleHeight*t}get t(){var t=this.visibleHeight;return 0===t?0:this.childOY/-t}setChildOYByPercentage(t){return this.t=t,this}}Object.assign(Ga.prototype,Wa);var Ua=Ga;Te.register("scrollableBlock",(function(t){var e=new Ua(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.ScrollableBlock",Ua);const Ya=Phaser.Utils.Objects.GetValue;class Xa extends cs.a{constructor(t,e){void 0===e&&(e={});var i=Object(ds.a)(e),s=Ya(e,"panel",void 0);void 0===s&&(s={}),s.scrollMode=i,s.clamplChildOY=Ya(e,"clamplChildOY",!1);var a,r,n=new Ua(t,s),o=Ya(s,"width",void 0),h=Ya(s,"height",void 0);0===i?(a=void 0===o?1:0,r=void 0===h):(a=void 0===h?1:0,r=void 0===o),e.type="rexScrollablePanel",e.child={gameObject:n,proportion:a,expand:r};var l=Ya(e,"space",void 0);l&&(l.child=l.panel),super(t,e),this.addChildrenMap("panel",this.childrenMap.child.child)}}var Ka=Xa;Te.register("scrollablePanel",(function(t){var e=new Ka(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.ScrollablePanel",Ka);var Qa={popUp:0,fadeIn:1,scaleDown:0,fadeOut:1},$a={popUp:function(t,e){t.popUp(e)},scaleDown:function(t,e){t.scaleDownDestroy(e,void 0,void 0,!1)},fadeIn:function(t,e){t.fadeIn(e)},fadeOut:function(t,e){t.fadeOut(e,!1)}},array_Copy=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=e.length),t.length=s-i;for(var a=0,r=t.length;a<r;a++)t[a]=e[a+i];return t},Za=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,TypeConvert=function(t){return"string"!=typeof t?t:(""===t?t=null:Za.test(t)?t=parseFloat(t):"false"===screen?t=!1:"true"===t&&(t=!0),t)},object_IsArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)};const Ja=Phaser.Utils.Objects.GetValue;var runCommands=function(t,e,i){var s,a=Ja(i,"reverse",!1);if(object_IsArray(t[0]))if(a)for(r=(n=t.length)-1;r>=0;r--)s=runCommands(t[r],e,i);else for(var r=0,n=t.length;r<n;r++)s=runCommands(t[r],e,i);else s=runCommand(t,e,i);return s},runCommand=function(t,e,i){var s,a=Ja(i,"argsConvert",void 0),r=Ja(i,"argsConvertScope",void 0),n=t[0];if(qa=array_Copy(qa,t,1),a){!0===a&&(a=TypeConvert,r=void 0);for(var o=0,h=qa.length;o<h;o++)qa[o]=r?a.call(r,qa[o],t):a(qa[o],t)}return"string"==typeof n?null==(s=e[n])&&(s=Ja(e,n,null)):s=n,s.apply(e,qa)},qa=[],tr=runCommands,er=i(129),system_GetEventEmitter=function(t){return Object(er.a)(t)?t.events:t.on?t:void 0};var ir=[];const sr={ms:0,s:1,sec:1},ar={abs:0,absolute:0,inc:1,increment:1};var rr=class extends Fs{constructor(t,e){super(t,e),this.parent=t,this.scene=Object(ue.a)(t),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.isRunning=ps()(t,"isRunning",!1),this.state=ps()(t,"state",0),this.commands=ps()(t,"commands",[]),this.scope=ps()(t,"scope",void 0),this.setTimeUnit(ps()(t,"timeUnit",0)),this.setDtMode(ps()(t,"dtMode",0)),this.setTimeScale(ps()(t,"timeScale",1)),this.index=ps()(t,"index",0),this.nextDt=ps()(t,"nextDt",0),this.seek(ps()(t,"now",0)),this.timeScale=ps()(t,"timeScale",1),this}toJSON(){return{isRunning:this.isRunning,state:this.state,commands:this.commands,scope:this.scope,timeUnit:this.timeUnit,dtMode:this.dtMode,index:this.index,nextDt:this.nextDt,now:this.now,timeScale:this.timeScale,tickingMode:this.tickingMode}}boot(){super.boot();var t=system_GetEventEmitter(this.parent);t&&t.once("destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.scene=void 0,this.commands=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),this.scene.events.on("update",this.update,this)}stopTicking(){super.stopTicking(),this.scene&&this.scene.events.off("update",this.update,this)}load(t,e,i){this.stop();var s=ps()(i,"timeUnit",void 0);void 0!==s&&this.setTimeUnit(s);var a=ps()(i,"dtMode",void 0);return void 0!==a&&this.setDtMode(a),t=t.filter((function(t){var e=t[0];return!isNaN(e)})).map((function(t){return"string"==typeof t[0]&&(t[0]=parseFloat(t[0])),t})),0===this.dtMode&&t.sort((function(t,e){var i=t[0],s=e[0];return i>s?1:i<s?-1:0})),this.commands=t,this.scope=e,this}start(t){return void 0===t&&(t=0),this.stop(),this.index=0,this.isRunning=!0,this.state=1,this.nextDt=this.getNextDt(0),this.seek(t),this.update(),this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this.state=0,this}seek(t){return this.now=t,this}get isPlaying(){return this.isRunning}get completed(){return 2===this.state}setTimeScale(t){this.timeScale=t}update(t,e){if(!this.isRunning)return this;if(void 0!==t){if(0===this.timeScale||0===e)return this;this.now+=e*this.timeScale}if(this.nextDt>this.now)return this;for(;;){var i=this.commands[this.index],s=i[1];if(object_IsArray(s)||(s=array_Copy(ir,i,1)),tr(s,this.scope),this.emit("runcommand",s,this.scope),this.index===this.commands.length-1)return this.complete(),this;if(this.index++,this.nextDt=this.getNextDt(this.nextDt),this.nextDt>this.now)return this}}complete(){super.complete(),this.state=2}getNextDt(t){var e=this.commands[this.index][0];return 1===this.timeUnit&&(e*=1e3),1===this.dtMode&&(e+=t),e}setDtMode(t){return"string"==typeof t&&(t=ar[t]),this.dtMode=t,this}setTimeUnit(t){return"string"==typeof t&&(t=sr[t]),this.timeUnit=t,this}};const nr=Phaser.Utils.Objects.GetValue;var or=class extends Qi{constructor(t,e){void 0===e&&(e={text:createDefaultTextObject(t)}),super(t,e),this.type="rexToast",this.setTransitInTime(nr(e,"duration.in",200)),this.setDisplayTime(nr(e,"duration.hold",1200)),this.setTransitOutTime(nr(e,"duration.out",200)),this.setTransitInCallback(nr(e,"transitIn",Qa.popUp)),this.setTransitOutCallback(nr(e,"transitOut",Qa.scaleDown)),this.player=new rr(this,{dtMode:1}),this.messages=[],this.setVisible(!1)}destroy(t){this.scene&&(this.player.destroy(),this.player=void 0,this.messages=void 0,super.destroy(t))}setDisplayTime(t){return this.displayTime=t,this}setTransitOutTime(t){return this.transitOutTime=t,this}setTransitInTime(t){return this.transitInTime=t,this}setTransitInCallback(t){switch("string"==typeof t&&(t=Qa[t]),t){case Qa.popUp:t=$a.popUp;break;case Qa.fadeIn:t=$a.fadeIn}return this.transitInCallback=t,this}setTransitOutCallback(t){switch("string"==typeof t&&(t=Qa[t]),t){case Qa.scaleDown:t=$a.scaleDown;break;case Qa.fadeOut:t=$a.fadeOut}return this.transitOutCallback=t,this}show(t){if(void 0===t){if(0===this.messages.length)return this;t=this.messages.shift()}if(this.player.isPlaying)return this.messages.push(t),this;this.setScale(1,1).setVisible(!0),"string"==typeof t?this.setText(t):t(this),this.layout();var e=[[0,[this.transitInCallback,this,this.transitInTime]],[this.transitInTime,[He.a]],[this.displayTime,[this.transitOutCallback,this,this.transitOutTime]],[this.transitOutTime,[this.setVisible,!1]],[30,[He.a]]];return this.player.load(e,this).once("complete",(function(){this.show()}),this).start(),this}};Te.register("toast",(function(t){var e=new or(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Toast",or);const hr=Phaser.GameObjects.GameObject;var system_IsGameObject=function(t){return t instanceof hr};Te.register("tap",(function(t,e){return system_IsGameObject(t)||(e=t,t=this.scene),new Qs(t,e)})),object_SetValue(window,"RexPlugins.UI.Tap",Qs);Te.register("press",(function(t,e){return system_IsGameObject(t)||(e=t,t=this.scene),new ta(t,e)})),object_SetValue(window,"RexPlugins.UI.Press",ta);const lr=Phaser.Math.Distance.Between,cr=Phaser.Math.Angle.Between;var dr={getDt:function(){return this.scene.sys.game.loop.delta},getVelocity:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return lr(e.x,e.y,t.x,t.y)/(.001*this.getDt())},getVelocityX:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.x-e.x)/(.001*this.getDt())},getVelocityY:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.y-e.y)/(.001*this.getDt())},getVelocityAngle:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return cr(e.x,e.y,t.x,t.y)}},mr={"up&down":0,"left&right":1,"4dir":2,"8dir":3},ur={},angletodirections_AngleToDirections=function(t,e,i){switch(void 0===i?i={}:!0===i&&(i=ur),i.left=!1,i.right=!1,i.up=!1,i.down=!1,t=(t+360)%360,e){case 0:t<180?i.down=!0:i.up=!0;break;case 1:t>90&&t<=270?i.left=!0:i.right=!0;break;case 2:t>45&&t<=135?i.down=!0:t>135&&t<=225?i.left=!0:t>225&&t<=315?i.up=!0:i.right=!0;break;case 3:t>22.5&&t<=67.5?(i.down=!0,i.right=!0):t>67.5&&t<=112.5?i.down=!0:t>112.5&&t<=157.5?(i.down=!0,i.left=!0):t>157.5&&t<=202.5?i.left=!0:t>202.5&&t<=247.5?(i.left=!0,i.up=!0):t>247.5&&t<=292.5?i.up=!0:t>292.5&&t<=337.5?(i.up=!0,i.right=!0):i.right=!0}return i};const pr=Phaser.Utils.Objects.GetValue,gr=Phaser.Math.RadToDeg;class fr extends Vs{constructor(t,e){super(t,e);var i=this,s={states:{IDLE:{},BEGIN:{enter:function(){i.validDrag=!1}},RECOGNIZED:{enter:function(){i.start(),i.updateDirectionStates(),i.emit("swipe",i,i.gameObject,i.lastPointer)},exit:function(){i.stop(),i.clearDirectionStates()}}},init:function(){this.state=_r},eventEmitter:!1};this.setRecongizedStateObject(new zs.a(s)),this.clearDirectionStates()}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(pr(t,"threshold",10)),this.setMinDragVelocity(pr(t,"velocityThreshold",1e3)),this.setDirectionMode(pr(t,"dir","8dir")),this}onDragStart(){this.state=yr}onDragEnd(){this.state=_r}onDrag(){this.state===yr&&(this.vaildDrag||(this.vaildDrag=0===this.dragThreshold||this.pointer.getDistance()>=this.dragThreshold),this.vaildDrag&&this.dragVelocity>this.minDragVelocity&&(this.state=vr))}postUpdate(t,e){this.state===vr&&(this.state=_r)}get isSwiped(){return this.state===vr}get dragVelocity(){var t;switch(this.dirMode){case 0:t=this.getVelocityX();break;case 1:t=this.getVelocityY();break;default:t=this.getVelocity()}return t}setDragThreshold(t){return this.dragThreshold=t,this}setMinDragVelocity(t){return this.minDragVelocity=t,this}setDirectionMode(t){return"string"==typeof t&&(t=mr[t]),this.dirMode=t,this}updateDirectionStates(){var t=gr(this.getVelocityAngle());return angletodirections_AngleToDirections(t,this.dirMode,this),this}clearDirectionStates(){return this.left=!1,this.right=!1,this.up=!1,this.down=!1,this}}Object.assign(fr.prototype,dr);const _r="IDLE",yr="BEGIN",vr="RECOGNIZED";var Sr=fr;Te.register("swipe",(function(t,e){return system_IsGameObject(t)||(e=t,t=this.scene),new Sr(t,e)})),object_SetValue(window,"RexPlugins.UI.Swipe",Sr);const br=Phaser.Utils.Objects.GetValue;const Tr="IDLE",Dr="BEGIN",xr="RECOGNIZED";var Pr=class extends Vs{constructor(t,e){super(t,e);var i=this,s={states:{IDLE:{},BEGIN:{enter:function(){var t=i.pointer;i.startX=t.x,i.startY=t.y,i.startWorldX=t.worldX,i.startWorldY=t.worldY}},RECOGNIZED:{enter:function(){i.emit("panstart",i,i.gameObject,i.lastPointer)},exit:function(){var t=i.lastPointer;i.endX=t.x,i.endY=t.y,i.endWorldX=t.worldX,i.endWorldY=t.worldY,i.emit("panend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=Tr},eventEmitter:!1};this.setRecongizedStateObject(new zs.a(s))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(br(t,"threshold",10)),this}onDragStart(){this.state=0===this.dragThreshold?xr:Dr}onDragEnd(){this.state=Tr}onDrag(){switch(this.state){case Dr:this.pointer.getDistance()>=this.dragThreshold&&(this.state=xr);break;case xr:var t=this.pointer.position,e=this.pointer.prevPosition;this.dx=t.x-e.x,this.dy=t.y-e.y;var i=this.pointer;self.x=i.x,self.y=i.y,self.worldX=i.worldX,self.worldY=i.worldY,this.emit("pan",this)}}get isPan(){return this.state===xr}setDragThreshold(t){return this.dragThreshold=t,this}};Te.register("pan",(function(t,e){return system_IsGameObject(t)||(e=t,t=this.scene),new Pr(t,e)})),object_SetValue(window,"RexPlugins.UI.Pan",Pr);const Cr=Phaser.Utils.Objects.GetValue,wr=Phaser.Utils.Array.SpliceOne,Or=Phaser.Math.Distance.Between,Ar=Phaser.Math.Angle.Between;class Br{constructor(t,e){var i=t.input.manager.pointersTotal-1;i<2&&t.input.addPointer(2-i),this.scene=t,this.setEventEmitter(Cr(e,"eventEmitter",void 0)),this.pointers=[],this.movedState={},this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(Cr(t,"enable",!0)),this.bounds=Cr(t,"bounds",void 0),this.tracerState=Ir,this.pointers.length=0,Object(gs.a)(this.movedState),this}boot(){this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointers.length=0,Object(gs.a)(this.movedState),this.scene&&(this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.dragCancel(),this.enable=t,this)}onPointerDown(t){if(this.enable&&(2!==this.pointers.length&&(!this.bounds||this.bounds.contains(t.x,t.y))&&-1===this.pointers.indexOf(t)))switch(this.movedState[t.id]=!1,this.pointers.push(t),this.tracerState){case Ir:this.tracerState=Mr,this.onDrag1Start();break;case Mr:this.tracerState=kr,this.onDrag2Start()}}onPointerUp(t){if(this.enable&&(!this.bounds||this.bounds.contains(t.x,t.y))){var e=this.pointers.indexOf(t);if(-1!==e)switch(delete this.movedState[t.id],wr(this.pointers,e),this.tracerState){case Mr:this.tracerState=Ir,this.onDrag1End();break;case kr:this.tracerState=Mr,this.onDrag2End(),this.onDrag1Start()}}}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),i=-1!==this.pointers.indexOf(t);if(!i&&e);else if(i&&!e)this.onPointerUp(t);else if(this.movedState[t.id]||(this.movedState[t.id]=t.x!==t.downX||t.y!==t.downY),this.movedState[t.id])switch(this.tracerState){case Mr:this.onDrag1();break;case kr:this.onDrag2()}}}dragCancel(){return this.tracerState===kr&&this.onDrag2End(),this.pointers.length=0,Object(gs.a)(this.movedState),this.tracerState=Ir,this}onDrag1Start(){this.emit("drag1start",this)}onDrag1End(){this.emit("drag1end",this)}onDrag1(){this.emit("drag1",this)}onDrag2Start(){this.emit("drag2start",this)}onDrag2End(){this.emit("drag2end",this)}onDrag2(){this.emit("drag2",this)}get distanceBetween(){if(this.tracerState!==kr)return 0;var t=this.pointers[0],e=this.pointers[1];return Or(t.x,t.y,e.x,e.y)}get angleBetween(){if(this.tracerState!==kr)return 0;var t=this.pointers[0],e=this.pointers[1];return Ar(t.x,t.y,e.x,e.y)}get drag1Vector(){var t=this.pointers[0];if(t&&this.movedState[t.id]){var e=t.position,i=t.prevPosition;Er.x=e.x-i.x,Er.y=e.y-i.y}else Er.x=0,Er.y=0;return Er}get centerX(){if(this.tracerState!==kr)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.x+e.x)/2}get centerY(){if(this.tracerState!==kr)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.y+e.y)/2}get prevCenterX(){if(this.tracerState!==kr)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.x+e.x)/2}get prevCenterY(){if(this.tracerState!==kr)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.y+e.y)/2}get movementCenterX(){return this.centerX-this.prevCenterX}get movementCenterY(){return this.centerY-this.prevCenterY}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=Rr,this}}Object.assign(Br.prototype,me.a);var Er={};const Ir=0,Mr=1,kr=2,Rr="IDLE";var Lr=Br;const Fr=Phaser.Utils.Objects.GetValue;const Nr="IDLE",jr="BEGIN",Wr="RECOGNIZED";var Hr=class extends Lr{constructor(t,e){super(t,e);var i=this,s={states:{IDLE:{enter:function(){i.prevDistance=void 0,i.scaleFactor=1}},BEGIN:{},RECOGNIZED:{enter:function(){i.emit("pinchstart",i)},exit:function(){i.emit("pinchend",i)}}},init:function(){this.state=Nr},eventEmitter:!1};this.setRecongizedStateObject(new zs.a(s))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Fr(t,"threshold",0)),this}onDrag2Start(){this.scaleFactor=1,this.prevDistance=this.distanceBetween,this.state=0===this.dragThreshold?Wr:jr}onDrag2End(){this.state=Nr}onDrag2(){switch(this.state){case jr:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.prevDistance=t,this.state=Wr}break;case Wr:t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.emit("pinch",this),this.prevDistance=t}}get isPinch(){return this.state===Wr}setDragThreshold(t){return this.dragThreshold=t,this}};Te.register("pinch",(function(t){return new Hr(this.scene,t)})),object_SetValue(window,"RexPlugins.UI.Pinch",Hr);const Vr=Phaser.Math.RotateAround;var actions_RotateObjectAround=function(t,e,i,s){return Vr(t,e,i,s),t.rotation+=s,t},zr={},rotate_SpinObject=function(t,e){if(!this.isRotation)return this;void 0===e&&(e=this.pointers[0].camera);var i=this.movementCenterX,s=this.movementCenterY;e.getWorldPoint(this.centerX,this.centerY,zr);var a=zr.x,r=zr.y,n=this.rotation;if(Array.isArray(t))for(var o=t,h=0,l=o.length;h<l;h++)(t=o[h]).x+=i,t.y+=s,actions_RotateObjectAround(t,a,r,n);else t.x+=i,t.y+=s,actions_RotateObjectAround(t,x,y,n);return this};const Gr=Phaser.Utils.Objects.GetValue,Ur=Phaser.Math.Angle.WrapDegrees,Yr=Phaser.Math.Angle.ShortestBetween,Xr=Phaser.Math.RadToDeg,Kr=Phaser.Math.DegToRad;class Qr extends Lr{constructor(t,e){super(t,e);var i=this,s={states:{IDLE:{enter:function(){i.prevAngle=void 0,i.angle=0}},BEGIN:{},RECOGNIZED:{enter:function(){i.emit("rotatestart",i)},exit:function(){i.emit("rotateend",i)}}},init:function(){this.state=Zr},eventEmitter:!1};this.setRecongizedStateObject(new zs.a(s))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Gr(t,"threshold",0)),this}onDrag2Start(){this.prevAngle=Ur(Xr(this.angleBetween)),this.state=0===this.rotationThreshold?qr:Jr}onDrag2End(){this.state=Zr}onDrag2(){switch(this.state){case Jr:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=Ur(Xr(this.angleBetween));this.angle=Yr(this.prevAngle,t),this.prevAngle=t,this.state=qr}break;case qr:t=Ur(Xr(this.angleBetween));this.angle=Yr(this.prevAngle,t),this.prevAngle=t,this.emit("rotate",this)}}get isRotation(){return this.state===qr}get rotation(){return Kr(this.angle)}setDragThreshold(t){return this.dragThreshold=t,this}}var $r={spinObject:rotate_SpinObject};Object.assign(Qr.prototype,$r);const Zr="IDLE",Jr="BEGIN",qr="RECOGNIZED";var tn=Qr;Te.register("rotate",(function(t){return new tn(this.scene,t)})),object_SetValue(window,"RexPlugins.UI.Rotate",tn);const en=Phaser.Utils.Objects.IsPlainObject,sn=Phaser.Utils.Objects.GetValue;var flip_GetFaceUpdatingCallback=function(t,e,i){var s;if(void 0===t)t=i.texture.key,e=i.frame.name;else if(en(t)){var a=t;t=sn(a,"key",i.texture.key),e=sn(a,"frame",i.frame.name)}else"string"==typeof t||(s=t);return void 0===s&&(s=function(i){i.setTexture(t,e)}),s};const an=Phaser.Utils.Objects.GetValue,rn=Phaser.Utils.Objects.GetAdvancedValue;class nn{constructor(t,e){this.gameObject=t,this.scene=Object(ue.a)(t),this.setEventEmitter(an(e,"eventEmitter",void 0)),this.scaleStart={},this.scaleEnd={},this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setOrientation(an(t,"orientation",0)),this.setDelay(rn(t,"delay",0)),this.setDuration(rn(t,"duration",500)),this.setEase(an(t,"ease","Sine")),this.setFrontFace(an(t,"front",void 0)),this.setBackFace(an(t,"back",void 0)),this.setFace(an(t,"face",0)),this}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.destroyEventEmitter(),this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setOrientation(t){return"string"==typeof t&&(t=on[t]),this.orientation=t,this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}setEase(t){return void 0===t&&(t="Linear"),this.ease=t,this}get isRunning(){return!!this.tween}get face(){return this._face}set face(t){"string"==typeof t&&(t=hn[t]),this._face=t,0===t&&this.frontFaceCallback?this.frontFaceCallback(this.gameObject):1===t&&this.backFaceCallback&&this.backFaceCallback(this.gameObject)}setFace(t){return this.face=t,this}toggleFace(){var t=0===this.face?1:0;return this.setFace(t),this}setFrontFace(t,e){return this.frontFaceCallback=flip_GetFaceUpdatingCallback(t,e,this.gameObject),this}setBackFace(t,e){return this.backFaceCallback=flip_GetFaceUpdatingCallback(t,e,this.gameObject),this}start(){if(this.isRunning)return this;if(0===this.duration)return this.toggleFace().complete(),this;var t={targets:this.gameObject,duration:this.duration/2,ease:this.ease,yoyo:!0,repeat:0,onYoyo:this.toggleFace,onYoyoScope:this,onComplete:this.complete,onCompleteScope:this};return t[0===this.orientation?"scaleX":"scaleY"]={from:1,to:0},this.tween=this.scene.tweens.add(t),this}restart(){return this.stop().start(),this}flip(t){return this.isRunning?this:(void 0!==t&&this.setDuration(t),this.start(),this)}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),this.emit("complete",this,this.gameObject),this}}Object.assign(nn.prototype,me.a);const on={x:0,horizontal:0,y:1,vertical:1},hn={front:0,back:1};var ln=nn;Te.register("flip",(function(t,e){return new ln(t,e)})),object_SetValue(window,"RexPlugins.UI.Flip",ln);const cn=Phaser.Utils.Objects.GetValue;var textedit_CreateInputText=function(t,e){void 0===e&&(e={});var i=t.scene,s=t.style,a=cn(e,"backgroundColor",s.backgroundColor);null===a&&(a="transparent"),e.text=cn(e,"text",t.text),e.fontFamily=cn(e,"fontFamily",s.fontFamily),e.fontSize=cn(e,"fontSize",s.fontSize),e.color=cn(e,"color",s.color),e.backgroundColor=a;var r=new ie.a(i,t.x,t.y,cn(e,"width",t.width),cn(e,"height",t.height),e);return r.setOrigin(t.originX,t.originY),i.add.existing(r),r},object_IsFunction=function(t){return t&&"function"==typeof t};const dn=Phaser.Utils.Objects.GetValue;var mn=void 0,un=class{constructor(t){this.gameObject=t,this.scene=Object(ue.a)(t),this.inputText=void 0,this.onClose=void 0,this.delayCall=void 0,this.boot()}boot(){return this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return this.close(),this.gameObject=void 0,this.scene=void 0,mn===this&&(mn=void 0),this}destroy(){return this.shutdown(),this}open(t,e){void 0!==mn&&mn.close(),mn=this,object_IsFunction(t)&&(e=t,t=void 0),void 0===e&&(e=dn(t,"onClose",void 0));var i=dn(t,"onTextChanged",void 0);return this.inputText=textedit_CreateInputText(this.gameObject,t).on("textchange",(function(t){var e=t.text;i?i(this.gameObject,e):this.gameObject.text=e}),this).setFocus(),this.gameObject.setVisible(!1),this.onClose=e,this.scene.input.keyboard.once("keydown-ENTER",this.close,this),this.delayCall=this.scene.time.delayedCall(0,(function(){this.scene.input.once("pointerdown",this.close,this)}),[],this),this}close(){return mn=void 0,this.inputText?(this.gameObject.setVisible(!0),this.inputText.destroy(),this.inputText=void 0,this.delayCall&&(this.delayCall.remove(),this.delayCall=void 0),this.scene.input.keyboard.off("keydown-ENTER",this.close,this),this.scene.input.off("pointerdown",this.close,this),this.onClose&&this.onClose(this.gameObject),this):this}get isOpened(){return void 0!==this.inputText}get text(){return this.isOpened?this.inputText.text:this.gameObject.text}};class pn extends Phaser.Plugins.ScenePlugin{constructor(t,e){super(t,e),this.add=new Te(t)}}var gn={hide:Hide,show:Show,isShown:IsShown,edit:function(t,e,i){return t._edit||(t._edit=new un(t)),t._edit.open(e,i),t._edit}};Object.assign(pn.prototype,gn);var fn=pn;const _n=/\.pi$/i;var yn=i(99),vn=i(100);class Sn extends Phaser.Scene{constructor(){super({key:Sn.name}),this.mCurTabIndex=0}preload(){this.load.atlas("login","./resources/ui/login/login.png","./resources/ui/login/login.json")}create(){const t=this.scale.gameSize.width,e=this.scale.gameSize.height,i=this.add.graphics();i.fillStyle(0),i.fillRect(0,0,t,e);const s=localStorage.getItem("account"),a=this.make.image(void 0,!1);a.setTexture("login","login_logo"),this.mParentCon=this.add.container(t>>1,(e>>1)+100*this.mWorld.uiScale),this.mBg=this.make.image(void 0,!1),this.mEnterBtn=this.make.image(void 0,!1),this.mEnterBtn.setTexture("login","login_loginBtn"),this.mEnterBtn.x=123,this.mQuickBtn=this.make.image(void 0,!1),this.mQuickBtn.setTexture("login","login_quickBtn"),this.mQuickBtn.x=123,this.mQuickBtn.y=-38,this.mSendCodeBtn=this.make.image(void 0,!1),this.mSendCodeBtn.setTexture("login","login_sendBtn"),this.mSendCodeBtn.x=10,this.mSendCodeBtn.y=67,this.mTab0=this.make.image(void 0,!1),this.mTab0.setTexture("login","login_tabSelect"),this.mTab0.x=-105,this.mTab0.y=-38,this.mTab1=this.make.image(void 0,!1),this.mTab1.setTexture("login","login_tabUnSelect"),this.mTab1.x=7,this.mTab1.y=-38,this.mInputBg_long0=this.make.image(void 0,!1),this.mInputBg_long0.setTexture("login","login_inputLong"),this.mInputBg_long0.x=-50,this.mInputBg_long0.y=15,this.mInputBg_long1=this.make.image(void 0,!1),this.mInputBg_long1.setTexture("login","login_inputLong"),this.mInputBg_long1.x=-50,this.mInputBg_long1.y=67,this.mInputBg_small=this.make.image(void 0,!1),this.mInputBg_small.setTexture("login","login_inputBg"),this.mInputBg_small.x=-105,this.mInputBg_small.y=67,this.mSizeTF=this.add.text(10,50,"",{style:{color:"#000000"},wordWrap:{width:800,useAdvancedWrap:!0}}),this.mSizeTF.setFontSize(20),this.mTabDic=new Map,this.mNameInputTxt=new ie.a(this,0,0,190,15,{type:"input",placeholder:"用戶名",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(200,20).setOrigin(0,0),this.mPassWordInputTxt=new ie.a(this,0,0,190,15,{type:"password",placeholder:"密码",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(200,20).setOrigin(0,0),this.mVerificationCodeTxt=new ie.a(this,0,0,100,15,{type:"input",placeholder:"验证码",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(100,20).setOrigin(0,0),this.mNameInputTxt.x=-140,this.mNameInputTxt.y=4,this.mPassWordInputTxt.x=-140,this.mPassWordInputTxt.y=55,this.mVerificationCodeTxt.x=-140,this.mVerificationCodeTxt.y=55,this.mtxt0=this.make.text(void 0,!1),this.mtxt1=this.make.text(void 0,!1),this.mtxt2=this.make.text(void 0,!1),this.mtxt3=this.make.text(void 0,!1),this.mtxt4=this.make.text(void 0,!1),this.mtxt5=this.make.text(void 0,!1),this.mtxt0.x=-145,this.mtxt0.y=-46,this.mtxt1.x=-35,this.mtxt1.y=-46,this.mtxt2.x=90,this.mtxt2.y=-46,this.mtxt3.x=108,this.mtxt3.y=33,this.mtxt4.x=-97,this.mtxt4.y=37,this.mtxt5.x=-6,this.mtxt5.y=57,this.mtxt0.setFontFamily("YaHei"),this.mtxt0.setText("手机号登录"),this.mtxt1.setFontFamily("YaHei"),this.mtxt1.setText("用户号登录"),this.mtxt2.setFontFamily("YaHei"),this.mtxt2.setText("快速游戏"),this.mtxt3.setFontFamily("YaHei"),this.mtxt3.setText("登录"),this.mtxt4.setFontFamily("YaHei"),this.mtxt4.setText("登录其他账号"),this.mtxt5.setFontFamily("YaHei"),this.mtxt5.setText("发送");const r={wid:220,hei:36,resKey:"login",resPng:"./resources/ui/login/login.png",resJson:"./resources/ui/login/login.json",resBg:"login_inputLong",resArrow:"login_downArrow",fontStyle:{size:20,color:"#ffcc00",bold:!1},up:!0,clickCallBack:this.changeID};this.combobox=new vn.ComboBox(this,r),this.combobox.x=-158,this.combobox.y=-28,this.changePanelState(s),this.mParentCon.add(a),this.mParentCon.add(this.mBg),this.mParentCon.add(this.mTab0),this.mParentCon.add(this.mTab1),this.mParentCon.add(this.mQuickBtn),this.mParentCon.add(this.mEnterBtn),this.mParentCon.add(this.mSendCodeBtn),this.mParentCon.add(this.mInputBg_long0),this.mParentCon.add(this.mInputBg_long1),this.mParentCon.add(this.mInputBg_small),this.mParentCon.add(this.mNameInputTxt),this.mParentCon.add(this.mPassWordInputTxt),this.mParentCon.add(this.mVerificationCodeTxt),this.mParentCon.add(this.mtxt0),this.mParentCon.add(this.mtxt1),this.mParentCon.add(this.mtxt2),this.mParentCon.add(this.mtxt3),this.mParentCon.add(this.mtxt4),this.mParentCon.add(this.mtxt5),this.mParentCon.add(this.combobox),this.mParentCon.scaleX=this.mParentCon.scaleY=this.mWorld.uiScale,a.x=-30*this.mWorld.uiScale,a.y=-a.height/2-80*this.mWorld.uiScale,this.mTab0.setInteractive(),this.mTab1.setInteractive(),this.mQuickBtn.setInteractive(),this.mEnterBtn.setInteractive(),this.mSendCodeBtn.setInteractive(),this.mtxt4.setInteractive(),this.mTab0.tabIndex=0,this.mTab1.tabIndex=1,this.mTabDic.set(this.mTab0.tabIndex,this.mTab0),this.mTabDic.set(this.mTab1.tabIndex,this.mTab1),this.mCurTabIndex=0,this.mTab0.on("pointerdown",this.tab0Handler,this),this.mTab1.on("pointerdown",this.tab1Handler,this),this.mQuickBtn.on("pointerdown",this.quickHandler,this),this.mEnterBtn.on("pointerdown",this.enterHandler,this),this.mSendCodeBtn.on("pointerdown",this.sendCodeHandler,this),this.mtxt4.on("pointerdown",this.changeAccount,this),this.scale.on("resize",this.checkSize,this),this.checkSize(new u(t,e))}init(t){this.mConnect=t.connect,this.mCallBack=t.callBack,this.mWorld=t.world}update(){const t=this.mWorld.getSize().width>this.mWorld.getSize().height?"LANDSCAPE":"PORTRAIT";this.mSizeTF.text="width:"+this.mWorld.getSize().width+"\nheight:"+this.mWorld.getSize().height+"\norientation:"+t+"\ndevicePixelRatio:"+window.devicePixelRatio}awake(){this.scene.wake()}sleep(){this.scene.sleep()}remove(){this.scene.remove()}getKey(){return this.sys.config.key}checkSize(t){const e=t.width,i=t.height;this.mParentCon.x=e>>1,this.mWorld.game.device.os.desktop||(this.mParentCon.scaleX=this.mParentCon.scaleY=this.mWorld.uiScale),this.mParentCon.y=!0===this.mWorld.game.device.os.desktop?100+(i>>1):(i>>1)+100*this.mWorld.uiScale}changeID(t){}changeAccount(){this.changePanelState(void 0)}changePanelState(t){const e=!t;this.verificaHandler(e);const i=t?"login_quickLoginBg":"login_loginBgBig";this.mBg.setTexture("login",i),this.mEnterBtn.y=t?15:40,this.mInputBg_long0.visible=!t,this.mtxt3.y=t?8:35,this.mNameInputTxt.visible=!t,this.combobox.visible=!!t,this.mQuickBtn.visible=!t,this.mTab0.visible=!t,this.mTab1.visible=!t,this.mInputBg_long1.visible=!t&&0!==this.mCurTabIndex,this.mPassWordInputTxt.visible=!t&&0!==this.mCurTabIndex,this.mtxt0.visible=!t,this.mtxt1.visible=!t,this.mtxt2.visible=!t,this.mtxt4.visible=!!t;const s=void 0!==t?JSON.parse(t):void 0;this.mNameInputTxt.text=s?s.account:"",this.combobox.text=s?[s.account+""]:[""],this.mPassWordInputTxt.text=s?s.password:"",this.mParentCon.setSize(this.mBg.width,this.mBg.height)}verificaHandler(t){this.mVerificationCodeTxt.visible=t,this.mtxt5.visible=t,this.mInputBg_small.visible=t,this.mSendCodeBtn.visible=t,this.mInputBg_long1.visible=!t,this.mPassWordInputTxt.visible=!t}quickHandler(){this.addTween(this.mQuickBtn),this.requestQuickLogin()}sendCodeHandler(){this.addTween(this.mSendCodeBtn),this.requestGetPhoneCode()}enterHandler(){this.addTween(this.mEnterBtn),this.mSendCodeBtn.visible?this.loginByPhoneCode():this.requestLogin()}addTween(t){this.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=t.scaleY=1}tab0Handler(t){this.mCurTabIndex=0,this.tabHandler()}tab1Handler(t){this.mCurTabIndex=1,this.tabHandler()}tabHandler(){this.mTabDic.forEach(t=>{let e="";e=t.tabIndex===this.mCurTabIndex?"login_tabSelect":"login_tabUnSelect",t.setTexture("login",e)}),this.verificaHandler(!this.mCurTabIndex)}requestLogin(){const t=this;this.mWorld.httpService.login(t.mNameInputTxt.text,t.mPassWordInputTxt.text).then(e=>{if(200===e.code||201===e.code)localStorage.setItem("account",JSON.stringify({account:t.mNameInputTxt.text,password:t.mPassWordInputTxt.text})),t.mWorld.account.setAccount(e.data),t.mCallBack(e.data);else{new yn.Alert(t.mWorld,t).show("账号密码错误")}})}requestGetPhoneCode(){const t=this;this.mWorld.httpService.requestPhoneCode(t.mNameInputTxt.text).then(e=>{if(200===e.code)t.mVerificationCodeTxt.setText(e.data);else{new yn.Alert(t.mWorld,t).show("验证码获取失败")}})}loginByPhoneCode(){const t=this;this.mWorld.httpService.loginByPhoneCode(t.mNameInputTxt.text,t.mVerificationCodeTxt.text).then(e=>{if(200===e.code||201===e.code)localStorage.setItem("accountphone",JSON.stringify({account:t.mNameInputTxt.text})),t.mWorld.account.setAccount(e.data),t.mCallBack(e.data);else{new yn.Alert(t.mWorld,t).show("登录失败")}})}requestQuickLogin(){const t=this;this.mWorld.httpService.quickLogin().then(e=>{if(200===e.code||201===e.code)localStorage.setItem("accountphone",JSON.stringify({account:t.mNameInputTxt.text})),t.mWorld.account.setAccount(e.data),t.mCallBack(e.data);else{new yn.Alert(t.mWorld,t).show("登录失败")}})}}class bn{constructor(){}setAccount(t){this.mCurAccountData={token:"",expire:0,fingerprint:""},Object.assign(this.mCurAccountData,t)}get accountData(){return this.mCurAccountData}}class Tn{constructor(t){this.mWorld=t}follow(t){return this.post("user/follow",{fuid:t})}unfollow(t){return this.post("user/unfollow",{fuid:t})}checkFollowed(t){return this.post("user/check_followed",{uids:t})}login(t,e){return fetch("https://api.tooqing.com/account/signin",{body:JSON.stringify({account:t,password:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>t.json())}requestPhoneCode(t){return fetch("https://api.tooqing.com/account/sms_code",{body:JSON.stringify({phone:t}),method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>t.json())}loginByPhoneCode(t,e){return fetch("https://api.tooqing.com/account/phone_signin",{body:JSON.stringify({phone:t,code:e}),method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>t.json())}quickLogin(){return fetch("https://api.tooqing.com/account/quick_signin",{method:"POST"}).then(t=>t.json())}firend(){return this.get("user/friends")}userDetail(t){return this.get(`account/${t}/detail`)}badgecards(t){return this.get(`userpackage/${t}/badgecards`)}post(t,e){const i=this.mWorld.account;if(!i)return Promise.reject("account does not exist");if(!i.accountData)return Promise.reject("token does not exist");const s={body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json","X-Pixelpai-TK":i.accountData.token}};return fetch(`https://api.tooqing.com/${t}`,s).then(t=>t.json())}get(t){const e=this.mWorld.account;if(!e)return Promise.reject("account does not exist");if(!e.accountData)return Promise.reject("token does not exist");const i={method:"GET",headers:{"X-Pixelpai-TK":e.accountData.token}};return fetch(`https://api.tooqing.com/${t}`,i).then(t=>t.json())}}class Dn extends Phaser.Scene{constructor(){super({key:Dn.name})}preload(){this.load.image("gamepause.png",P.h.getRes("gamepause.png"))}init(t){this.mWorld=t.world}create(){const t=this.scale.gameSize.width,e=this.scale.gameSize.height;this.bg=this.add.graphics(),this.bg.fillStyle(0,.8),this.bg.fillRect(0,0,t,e),this.pauseImg=this.add.image(t>>1,e>>1,"gamepause.png"),this.tipTF=this.add.text(t-240>>1,e-50,"点击任意位置开始游戏",{font:"30px Tahoma"}),this.scale.on("resize",this.checkSize,this),this.checkSize(new u(t,e))}awake(){this.scene.wake()}sleep(){this.scene.sleep()}getKey(){return this.sys.config.key}checkSize(t){const e=t.width,i=t.height;this.bg.clear(),this.bg.fillStyle(0,.8),this.bg.fillRect(0,0,e,i),this.pauseImg.scaleX=this.pauseImg.scaleY=.7*this.mWorld.uiScale,this.pauseImg.x=e>>1,this.pauseImg.y=i>>1,this.tipTF.scaleX=this.tipTF.scaleY=this.mWorld.uiScale,this.tipTF.x=e-280*this.mWorld.uiScale>>1,this.tipTF.y=i-50*this.mWorld.uiScale}}i.d(e,"World",(function(){return xn}));class xn extends a.PacketHandler{constructor(t,e){if(super(),this.mCallBack=e,this.mConfig=t,!t.game_id)throw new Error("Config.game_id is required.");this._newGame(),this.mConnection=t.connection||new m(this),this.mConnection.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_VIRTUAL_WORLD_INIT,this.onInitVirtualWorldPlayerInit),this.addHandlerFun(r.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_ERROR,this.onClientErrorHandler),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SELECT_CHARACTER,this.onSelectCharacter),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_GOTO_ANOTHER_GAME,this.onGotoAnotherGame),this.mGameEmitter=new Phaser.Events.EventEmitter,this.mRoomMamager=new Nt(this),this.mUiManager=new Zt(this),this.mMouseManager=new Wt(this),this.mElementStorage=new zt,this.mHttpService=new Tn(this),this.mRoomMamager.addPackListener(),this.mUiManager.addPackListener();const i=this.mConfig.server_addr||Object({host:"gdev.tooqing.com",port:11100});i&&this.mConnection.startConnect(i),t.isEditor&&this.createGame()}getConfig(){return this.mConfig}destroy(){this.mConnection.closeConnect(),this.clearGame()}onConnected(t){o.a.getInstance().info("enterVirtualWorld"),this.enterVirtualWorld()}onDisConnected(t){}onError(t){}onClientErrorHandler(t){const e=t.content;o.a.getInstance().error(`Remote Error[${e.responseStatus}]: ${e.msg}`)}changeRoom(t){this.mGame.device.os.desktop&&this.mInputManager.onRoomChanged(t),this.mMouseManager.changeRoom(t)}getSize(){if(this.mGame)return this.mGame.scale.gameSize}scaleChange(t){this.emitter.emit(xn.SCALE_CHANGE)}closeGame(){this.mConfig.closeGame&&this.mConfig.closeGame()}resize(t,e){this.mGame&&(this.mGame.device.os.desktop||(t<e?(this.mConfig.ui_scale=t/this.mConfig.baseHeight*2,this.mGame.scale.orientation=Phaser.Scale.Orientation.PORTRAIT,o.a.getInstance().debug("portrait:",t,e)):t>e&&(this.mConfig.ui_scale=t/this.mConfig.baseWidth*2,this.mGame.scale.orientation=Phaser.Scale.Orientation.LANDSCAPE,o.a.getInstance().debug("landscape:",t,e))),this.mGame.scale.resize(t,e)),this.mRoomMamager&&this.mRoomMamager.resize(t,e),this.mUiManager&&this.mUiManager.resize(t,e),this.mInputManager&&this.mInputManager.resize(t,e)}startFullscreen(){this.mGame?this.mGame.scale.startFullscreen():o.a.getInstance().warn("game does not exist!")}stopFullscreen(){this.mGame?this.mGame.scale.stopFullscreen():o.a.getInstance().warn("game does not exist!")}onGotoAnotherGame(t){const e=t.content;this.clearGame(),this.mConfig.game_id=e.gameId,this.mConfig.virtual_world_id=e.virtualWorldId,this._newGame(),this.mRoomMamager.addPackListener(),this.mUiManager.addPackListener(),this.loginEnterWorld()}changeScene(){const t=this.mConfig.game_id,e=this.mConfig.virtual_world_id;this.clearGame(),this.mConfig.game_id=t,this.mConfig.virtual_world_id=e,this._newGame(),this.mRoomMamager.addPackListener(),this.mUiManager.addPackListener(),this.loginEnterWorld()}get uiScale(){return this.mConfig?this.mConfig.ui_scale:1}get game(){return this.mGame}get roomManager(){return this.mRoomMamager}get elementStorage(){return this.mElementStorage}get uiManager(){return this.mUiManager}get inputManager(){return this.mInputManager}get connection(){return this.mConnection}get emitter(){return this.mGameEmitter}get httpService(){return this.mHttpService}get account(){return this.mAccount}getGameConfig(){return this.gameConfig}onSelectCharacter(){const t=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_CHARACTER_CREATED);this.connection.send(t)}clearGame(){this.mGame&&(this.mGame.plugins.removeGlobalPlugin("rexButton"),this.mGame.plugins.removeGlobalPlugin("rexNinePatchPlugin"),this.mGame.plugins.removeGlobalPlugin("rexInputText"),this.mGame.plugins.removeGlobalPlugin("rexBBCodeTextPlugin"),this.mGame.plugins.removeScenePlugin("DragonBones"),this.mGame.plugins.removeScenePlugin("rexUI"),this.mGameEmitter.destroy(),this.roomManager.destroy(),this.uiManager.destroy(),this.mGame.destroy(!0),this.mGame=null)}initUiScale(){const t=this.mConfig.width,e=this.mConfig.height,i=this.mConfig.baseWidth,s=this.mConfig.baseHeight;this.mGame.device.os.desktop||(t<e?(this.mConfig.ui_scale=t/s*2,this.mGame.scale.orientation=Phaser.Scale.Orientation.PORTRAIT):t>e&&(this.mConfig.ui_scale=t/i*2,this.mGame.scale.orientation=Phaser.Scale.Orientation.LANDSCAPE))}login(){this.mGame.scene.getScene(Sn.name)||this.mGame.scene.add(Sn.name,Sn),this.mGame.scene.start(Sn.name,{connect:this.mConnection,world:this,callBack:()=>{this.loginEnterWorld(),this.mGame.scene.getScene(Sn.name).remove(),this.mGame.scene.start(g.name,{world:this})}})}enterVirtualWorld(){if(this.mConfig&&this.mConnection){if(this.mAccount=new bn,this.mGame.scene.getScene(g.name)||this.mGame.scene.add(g.name,g),!this.mConfig.auth_token)return void this.login();this.mGame.scene.start(g.name,{world:this}),this.mAccount.setAccount({token:this.mConfig.auth_token,expire:this.mConfig.token_expire,fingerprint:this.mConfig.token_fingerprint}),this.loginEnterWorld()}}loginEnterWorld(){const t=new a.PBpacket(r.op_gateway.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PLAYER_INIT),e=t.content;o.a.getInstance().log(`VW_id: ${this.mConfig.virtual_world_id}`),e.virtualWorldUuid=`${this.mConfig.virtual_world_id}`,e.gameId=this.mConfig.game_id,e.userToken=this.mAccount.accountData.token,e.expire=this.mAccount.accountData.expire+"",e.fingerprint=this.mAccount.accountData.fingerprint,this.mConnection.send(t)}onInitVirtualWorldPlayerInit(t){const e=t.content,i=e.configUrls;(!i||i.length<=0)&&o.a.getInstance().error(`configUrls error: , ${i}, gameId: ${this.mConfig.game_id}`),this.loadGameConfig(e.configUrls).then(t=>{this.mElementStorage.setGameConfig(t),this.createGame(e.keyEvents),o.a.getInstance().debug("created game suc")}).catch(t=>{o.a.getInstance().log(t)})}_newGame(){return this.mGame?this.mGame:(this.gameConfig={type:Phaser.AUTO,zoom:1,parent:"game",scene:null,disableContextMenu:!0,transparent:!1,backgroundColor:0,resolution:1,fps:{target:60},dom:{createContainer:!0},plugins:{global:[{key:"rexButton",plugin:Se,start:!0},{key:"rexNinePatchPlugin",plugin:ee,start:!0},{key:"rexInputText",plugin:ne,start:!0},{key:"rexBBCodeTextPlugin",plugin:de,start:!0}],scene:[{key:"DragonBones",plugin:dragonBones.phaser.plugin.DragonBonesScenePlugin,mapping:"dragonbone"},{key:"rexUI",plugin:fn,mapping:"rexUI"}]},render:{pixelArt:!0,roundPixels:!0}},Object.assign(this.gameConfig,this.mConfig),this.gameConfig.type=Phaser.CANVAS,this.mGame=new s.Game(this.gameConfig),this.initUiScale(),this.mGame)}createGame(t){this._newGame(),this.mGame.scene.add(v.name,v),this.mGame.scene.add(_.name,_),this.mGame.scene.add(At.name,At),this.mGame.events.on(Phaser.Core.Events.FOCUS,this.onFocus,this),this.mGame.events.on(Phaser.Core.Events.BLUR,this.onBlur,this),this.mGame.device.os.desktop?this.mInputManager=new jt(this,t):this.mInputManager=new Ht(this,t),this.resize(this.mConfig.width,this.mConfig.height),this.gameCreated()}gameCreated(){if(this.connection){const t=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_GAME_CREATED);this.connection.send(t),this.mCallBack&&this.mCallBack(),this.mConfig.game_created&&this.mConfig.game_created()}else o.a.getInstance().error("connection is undefined")}loadGameConfig(t){const e=[];let i="";for(const s of t)_n.test(s)&&(i=P.f.getGameConfig(s),o.a.getInstance().log(`start download config: ${i}`),e.push(load(i,"arraybuffer")));return Promise.all(e).then(t=>(o.a.getInstance().log("start decodeConfig"),this.decodeConfigs(t)))}decodeConfigs(t){return new Promise((e,i)=>{for(const s of t){const t=s.response;if(t)try{const i=new Gt.Lite;i.deserialize(new Uint8Array(t)),e(i)}catch(t){i(t)}else i("error")}})}onFocus(){if(this.connection){const t=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=r.op_def.GameStatus.Focus,this.connection.send(t),this.resumeScene()}else o.a.getInstance().error("connection is undefined")}onBlur(){if(this.connection){const t=new a.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=r.op_def.GameStatus.Blur,this.connection.send(t),this.pauseScene()}else o.a.getInstance().error("connection is undefined")}resumeScene(){if(this.mConfig.isEditor)return;this.mRoomMamager.onFocus(),this.mGame.scene.getScene(Dn.name)&&this.mGame.scene.stop(Dn.name)}pauseScene(){this.mConfig.isEditor||(this.mRoomMamager.onBlur(),this.mGame.scene.getScene(Dn.name)||this.mGame.scene.add(Dn.name,Dn),this.mGame.scene.start(Dn.name,{world:this}))}}xn.SCALE_CHANGE="scale_change"},,function(t,e,i){"use strict";i.d(e,"h",(function(){return s})),i.d(e,"f",(function(){return a})),i.d(e,"b",(function(){return r})),i.d(e,"c",(function(){return n})),i.d(e,"i",(function(){return o})),i.d(e,"e",(function(){return h})),i.d(e,"a",(function(){return l})),i.d(e,"d",(function(){return c})),i.d(e,"g",(function(){return d}));class s{static getRes(t){return Object({api_root:"https://api.tooqing.com/",osd:"https://osd.tooqing.com/",gateway:Object({host:"gdev.tooqing.com",port:11100}),game_id:"5d28148554ae3d5c17bf1365",virtual_world_id:"0"}).BUNDLE_RESOURCES_ROOT?Object({api_root:"https://api.tooqing.com/",osd:"https://osd.tooqing.com/",gateway:Object({host:"gdev.tooqing.com",port:11100}),game_id:"5d28148554ae3d5c17bf1365",virtual_world_id:"0"}).BUNDLE_RESOURCES_ROOT+t:"./resources/"+t}static getOsdRes(t){return"https://osd.tooqing.com/"+t}}class a{static getPartName(t){return t+"_png"}static getPartUrl(t){return"https://osd.tooqing.com/avatar/part/"+t+".png"}static getGameConfig(t){return"https://osd.tooqing.com/"+t}}class r{static getName(){return"black_button"}static getPNG(){return s.getRes("ui/common/button.png")}static getColumns(){return[4,2,4]}static getRows(){return[4,2,4]}static getConfig(){return{top:4,left:4,right:4,bottom:4}}}class n{static getName(){return"button_blue"}static getPNG(){return s.getRes("ui/common/button_blue.png")}static getJSON(){return s.getRes("ui/common/button_blue.json")}static getColumns(){return[7,1,7]}static getRows(){return[7,1,7]}static getConfig(){return{left:7,top:7,right:7,bottom:7}}}class o{static getName(){return"button_white"}static getPNG(){return s.getRes("ui/common/button_white.png")}static getJSON(){return s.getRes("ui/common/button_white.json")}static getColumns(){return[7,1,7]}static getRows(){return[7,1,7]}static getConfig(){return{left:7,top:7,right:7,bottom:7}}}class h{static getName(){return"common_clsBtn"}static getPNG(){return s.getRes("ui/common/common_clsBtn.png")}static getJSON(){return s.getRes("ui/common/common_clsBtn.json")}static getFrameConfig(){return{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}}}class l{static getName(){return"common_background"}static getPNG(){return s.getRes("ui/common/common_panelBg.png")}static getColumns(){return[11,9,11]}static getRows(){return[14,13,14]}static getConfig(){return{left:10,top:15,right:10,bottom:15}}}class c{static getName(){return"common_border"}static getPNG(){return s.getRes("ui/common/common_border.png")}static getColumns(){return[4,2,4]}static getRows(){return[4,2,4]}static getConfig(){return{left:4,top:4,right:4,bottom:4}}}class d{static getName(){return"button_transparent"}static getPNG(){return s.getRes("ui/common/button_transparent.png")}static getJSON(){return s.getRes("ui/common/button_transparent.json")}static getConfig(){return{left:4,top:4,right:4,bottom:4}}}},,function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));class s{constructor(){this.mErrorList=[],this.mWarnList=[]}static getInstance(){return s._instance||(s._instance=new s),s._instance}log(t,...e){console.log(t,...e)}error(t,...e){console.error(t,...e),this.mErrorList.push(t)}warn(t,...e){console.warn(t,...e),this.mWarnList.push(t)}debug(t,...e){console.log(t,...e)}info(t,...e){console.info(t,...e)}getErrorList(){return this.mErrorList}getWarnList(){return this.mWarnList}}},,function(t,e,i){"use strict";i.r(e),i.d(e,"Panel",(function(){return a}));var s=i(6);class a extends Phaser.GameObjects.Container{constructor(t){super(t),this.mShowing=!1,this.mTweening=!1,this.mWidth=0,this.mHeight=0,this.mTweenBoo=!0,this.mScene=t,this.mInitialized=!1}isShow(){return this.mShowing}hide(){!this.mTweening&&this.mTweenBoo?this.showTween(!1):this.destroy()}destroy(){this.parentContainer&&this.parentContainer.remove(this),this.mPanelTween&&(this.mPanelTween.stop(),this.mPanelTween.remove()),this.mInitialized=!1,this.mShowing=!1,this.mWidth=0,this.mHeight=0,this.mPanelTween=null,this.scaleX=this.scaleY=0,this.mScene=null,this.removeAll(),this.removeAllListeners(),super.destroy()}resize(t){}show(t){this.mData=t,this.mInitialized?!this.mTweening&&this.mTweenBoo?this.showTween(!0):this.mShowing=!0:this.preload()}setTween(t){this.mTweenBoo=t}update(t){}showTween(t){this.mTweening=!0,this.scaleX=t?0:1,this.scaleY=t?0:1;const e=t?1:0;this.mPanelTween&&this.mPanelTween.stop(),this.mPanelTween=this.mScene.tweens.add({targets:this,duration:200,ease:"Linear",props:{scaleX:{value:e},scaleY:{value:e}},onComplete:()=>{this.tweenComplete(t)},onCompleteParams:[this]})}tweenComplete(t){this.mTweening=!1,this.mPanelTween.stop(),this.mShowing=!!t}init(){this.mInitialized=!0,this.show(this.mData)}preload(){this.mScene?(this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.loadComplete,this),this.mScene.load.start()):s.a.getInstance().error("scene does not exist")}loadComplete(t,e,i){this.mInitialized||this.init()}}},,,function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));class s{constructor(t,e,i,s){this.x=0|t,this.y=0|e,this.z=0|i,this.depth=0|s}add(t,e,i){return this.x+=t,this.x+=e,this.z+=i||0,this}equal(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.depth===this.depth}toString(){return`Pos >> x: ${this.x}, y: ${this.y}, z: ${this.z}, depth: ${this.depth}`}toPoint(){return new Phaser.Geom.Point(this.x,this.y)}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var s=i(2);class a{constructor(t){this.isShowing=!1,this.world=t,this.world.emitter.on(s.World.SCALE_CHANGE,this.scaleChange,this)}setUiScale(t){this.mView.scaleX=this.mView.scaleY=t}getView(){return this.mView}hide(){this.isShowing=!1;const t=this.getView();t&&t.hide()}isSceneUI(){return!1}isShow(){return!1}resize(){const t=this.getView();t&&t.isShow()&&t.resize()}show(t){this.setUiScale(this.world.uiScale)}update(t){const e=this.getView();e&&e.update(t)}destroy(){this.isShowing=!1,this.world.emitter.off(s.World.SCALE_CHANGE,this.scaleChange,this);let t=this.getView();t&&(t.destroy(),t=null)}scaleChange(){this.setUiScale(this.world.uiScale)}}},,function(t,e,i){"use strict";i.r(e),i.d(e,"NinePatch",(function(){return a}));var s=i(60);class a extends Phaser.GameObjects.Container{constructor(t,e,i,a,r,n,o,h){super(t,e,i),this.config=h||this.scene.cache.custom.ninePatch.get(o?`${o}`:n),Object(s.normalizePatchesConfig)(this.config),this.setSize(a,r),this.setTexture(n,o)}resize(t,e){return t=Math.round(t),e=Math.round(e),this.config?this.width===t&&this.height===e?this:(t=Math.max(t,this.config.left+this.config.right),e=Math.max(e,this.config.top+this.config.bottom),this.setSize(t,e),void this.drawPatches()):this}setTexture(t,e){return this.originTexture=this.scene.textures.get(t),this.setFrame(e),this}setFrame(t){return this.originFrame=this.originTexture.frames[t]||this.originTexture.frames[a.__BASE],this.createPatches(),this.drawPatches(),this}setSize(t,e){return super.setSize(t,e),this.finalXs=[0,this.config.left,this.width-this.config.right,this.width],this.finalYs=[0,this.config.top,this.height-this.config.bottom,this.height],this}setTint(t){return this.tint=t,this}setTintFill(t){return this.tint=t,this.tintFill=!0,this}get tintFill(){return this.first&&this.first.tintFill}set tintFill(t){this.each(e=>e.tintFill=t)}set tint(t){this.each(e=>e.setTint(t)),this.internalTint=t}get isTinted(){return this.first&&this.first.isTinted}createPatches(){const t=[0,this.config.left,this.originFrame.width-this.config.right,this.originFrame.width],e=[0,this.config.top,this.originFrame.height-this.config.bottom,this.originFrame.height];let i=0;for(let s=0;s<3;s++)for(let a=0;a<3;a++)this.createPatchFrame(this.getPatchNameByIndex(i),t[a],e[s],t[a+1]-t[a],e[s+1]-e[s]),++i}drawPatches(){const t=this.tintFill;this.removeAll(!0);let e=0;for(let i=0;i<3;i++)for(let s=0;s<3;s++){const a=this.originTexture.frames[this.getPatchNameByIndex(e)],r=new Phaser.GameObjects.Image(this.scene,0,0,a.texture.key,a.name);r.setOrigin(0),r.setPosition(this.finalXs[s]-this.width*this.originX,this.finalYs[i]-this.height*this.originY),r.setScale((this.finalXs[s+1]-this.finalXs[s])/a.width,(this.finalYs[i+1]-this.finalYs[i])/a.height),this.add(r),r.setTint(this.internalTint),r.tintFill=t,++e}}createPatchFrame(t,e,i,s,a){this.originTexture.frames.hasOwnProperty(t)||this.originTexture.add(t,this.originFrame.sourceIndex,this.originFrame.cutX+e,this.originFrame.cutY+i,s,a)}getPatchNameByIndex(t){return`${this.originFrame.name}|${a.patches[t]}`}}a.__BASE="__BASE",a.patches=["[0][0]","[1][0]","[2][0]","[0][1]","[1][1]","[2][1]","[0][2]","[1][2]","[2][2]"]},function(t,e,i){"use strict";var s=i(129);e.a=function(t){return Object(s.a)(t)?t:t.scene&&Object(s.a)(t.scene)?t.scene:t.parent&&t.parent.scene&&Object(s.a)(t.parent.scene)?t.parent.scene:void 0}},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));class s{}s.CREATE_ROLE="create_role",s.APP_START="app_start",s.EDITOR_CHANGE_MODE="editor_change_mode",s.CLIENT_RESIZE="app_client_resize",s.SCENE_INITIALIZED="SCENE_INITIALIZED",s.SCENE_CLEARED="SCENE_CLEARED",s.SCENE_CHANGE_TO="SCENE_CHANGE_TO",s.SCENE_MOVE_TO="scene_move_to",s.SCENE_MOVE_STOP="scene_move_stop",s.CHANGE_ELEMENT_ANIMATION="change_element_animation",s.CHANGE_CHARACTER_ANIMATION="change_character_animation",s.CHAT_TO="chat_to",s.SHOW_CHAT_BUBBLE="show_chat_bubble",s.REMOVE_CHAT_BUBBLE="remove_chat_bubble",s.PROMPT_ALERT="prompt_alert",s.CHARACTER_TALING="characterTaling",s.CHARACTER_SHUT_UP="characterShutUp",s.QCLOUD_AUTH="qcloud_auth",s.ENTER_SCENE="enter_scene",s.SCENE_ADD_PLAYER="scene_add_player",s.SCENE_REMOVE_PLAYER="scene_remove_player",s.SCENE_UPDATE_PLAYER="scene_update_player",s.SCENE_ADD_ELEMENT="scene_add_element",s.SCENE_ADD_TERRAIN="scene_add_terrain",s.SCENE_ADD_TERRAIN_END="scene_add_terrain_end",s.SCENE_ADD_ALL_TERRAIN="scene_add_all_terrain",s.SCENE_REMOVE_ELEMENT="scene_remove_element",s.SCENE_REMOVE_TERRAIN="scene_remove_terrain",s.SCENE_REMOVE_ALL_TERRAIN="scene_remove_all_terrain",s.SCENE_MOUSE_FOLLOW="scene_mouse_follow",s.SCENE_SELECT_ELEMENT="scene_select_element",s.SCENE_FIXED_TO_ELEMENT="scene_fixed_to_element",s.SCENE_UPDATE_ELEMENT="sceneUpdateElement",s.SCENE_SYNCHRO_PACKAGE="sceneSynchroPackage",s.SCENE_VISIBLE_GRID="sceneVisibleGrid",s.PLAYER_SELECT_CHARACTER="player_select_character",s.PLAYER_DATA_INITIALIZE="player_data_initialize",s.SCENE_DATA_INITIALIZE="scene_data_initialize",s.PACKAGE_ITEM_ADD="package_item_add",s.PACKAGE_ITEM_REMOVE="package_item_remove",s.PACKAGE_EXCHANGE_ITEM_POS="package_exchange_item_pos",s.SCENE_BACKGROUND_CLICK="SCENE_BACKGROUND_CLICK",s.CHANGE_SELF_AVATAR="CHANGE_SELF_AVATAR",s.DRAG_TO_DROP="DRAG_TO_DROP",s.DRAG_OVER_DROP="DRAG_OVER_DROP",s.QUERY_PACKAGE="query_package",s.SYNC_USER_BALANCE="syncUserBalance",s.UPDATED_CHARACTER_PACKAGE="updatedCharacterPackage",s.SHOW_EFFECT="showEffect"},function(t,e,i){"use strict";i.r(e),i.d(e,"NinePatchButton",(function(){return a}));var s=i(14);class a extends Phaser.GameObjects.Container{constructor(t,e,i,a,r,n,o,h,l){super(t,e,i),this.mScene=t,this.mKey=n,this.setSize(a,r),this.mNingBg=new s.NinePatch(this.scene,e,i,a,r,n,n+"_normal",h),this.add(this.mNingBg),l&&(this.btnData=l),this.mLabel=this.scene.make.text(void 0,!1).setOrigin(.45,.5).setSize(this.width,this.height).setAlign("center").setText(o),this.add(this.mLabel),this.setInteractive(),this.on("pointerdown",this.changeDown,this),this.on("pointerup",this.changeNormal,this),this.on("pointerout",this.changeNormal,this),this.on("pointerover",this.changeOver,this)}getBtnData(){return this.btnData}setText(t){this.mLabel.setText(t)}getText(){return this.mLabel.text}setTextStyle(t){this.mLabel.setStyle(t)}setTextOffset(t,e){this.mLabel.setPosition(t,e)}setFrame(t){return this.mNingBg.setFrame(t),this}destroy(t){this.mLabel&&this.mLabel.destroy(),super.destroy(t)}changeNormal(){this.setFrame(`${this.mKey}_normal`)}changeOver(){this.setFrame(`${this.mKey}_over`)}changeDown(){this.setFrame(`${this.mKey}_down`),this.scaleHandler()}get label(){return this.mLabel}scaleHandler(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1}}},function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicImage",(function(){return s}));class s extends Phaser.GameObjects.Image{constructor(t,e,i){super(t,e,i,void 0)}load(t,e,i,s){this.mLoadCompleteCallbak=i,this.mLoadErrorCallback=s,this.mLoadContext=e,this.mUrl=t,this.scene.cache.obj.exists(t)?this.onLoadComplete():(this.scene.load.image(t,t),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())}onLoadComplete(){if(this.mLoadCompleteCallbak){const t=this.mLoadCompleteCallbak;this.mLoadCompleteCallbak=null,t.call(this.mLoadContext),this.mLoadContext=null}this.setTexture(this.mUrl)}onLoadError(t){if(this.mUrl===t.url&&this.mLoadErrorCallback){const t=this.mLoadErrorCallback;this.mLoadErrorCallback=null,t.call(this.mLoadContext),this.mLoadContext=null}}}},function(t,e,i){"use strict";var s=i(36),sizer_GetChildrenWidth=function(t){if(this.rexSizer.hidden)return 0;void 0===t&&(t=!0);var e,i,s,a=0,r=this.sizerChildren;if(0===this.orientation)for(var n=0,o=r.length;n<o;n++)(e=r[n]).rexSizer.hidden||(s=0===e.rexSizer.proportion||t&&e.rexSizer.proportion>0?e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width:0,a+=s+=(i=e.rexSizer.padding).left+i.right);else for(n=0,o=r.length;n<o;n++)(e=r[n]).hasOwnProperty("rexSizer")&&(e.rexSizer.hidden||(s=e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width,s+=(i=e.rexSizer.padding).left+i.right,a=Math.max(s,a)));return a},sizer_GetChildrenHeight=function(t){if(this.rexSizer.hidden)return 0;void 0===t&&(t=!0);var e,i,s,a=0,r=this.sizerChildren;if(0===this.orientation)for(var n=0,o=r.length;n<o;n++)(e=r[n]).rexSizer.hidden||(s=e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height,s+=(i=e.rexSizer.padding).top+i.bottom,a=Math.max(s,a));else for(n=0,o=r.length;n<o;n++)(e=r[n]).hasOwnProperty("rexSizer")&&(e.rexSizer.hidden||(s=0===e.rexSizer.proportion||t&&e.rexSizer.proportion>0?e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height:0,a+=s+=(i=e.rexSizer.padding).top+i.bottom));return a},sizer_GetChildrenProportion=function(){for(var t,e,i=0,s=this.sizerChildren,a=0,r=s.length;a<r;a++)(t=s[a]).rexSizer.hidden||(e=t.rexSizer.proportion)>0&&(i+=e);return i},sizer_GetChildrenSizers=function(t){void 0===t&&(t=[]);for(var e,i=this.sizerChildren,s=0,a=i.length;s<a;s++)(e=i[s]).isRexSizer&&t.push(e);return t},sizer_GetExpandedChildWidth=function(t,e){var i,s=e.rexSizer,a=s.padding;return 0===t.orientation?s.proportion>0&&t.proportionLength>0&&(i=s.proportion*t.proportionLength):s.expand&&(i=t.width-a.left-a.right),i},sizer_GetExpandedChildHeight=function(t,e){var i,s=e.rexSizer,a=s.padding;return 0===t.orientation?s.expand&&(i=t.height-a.top-a.bottom):s.proportion>0&&t.proportionLength>0&&(i=s.proportion*t.proportionLength),i},a=i(24),r=i(35);const n=Phaser.Display.Align.In.QuickSet;var o={getChildrenWidth:sizer_GetChildrenWidth,getChildrenHeight:sizer_GetChildrenHeight,getChildrenProportion:sizer_GetChildrenProportion,getChildrenSizers:sizer_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var s;if(this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i),this.childrenProportion>0){var o=0===this.orientation?this.width-this.childrenWidth:this.height-this.childrenHeight;s=o>0?(o=0===this.orientation?this.width-this.getChildrenWidth(!1):this.height-this.getChildrenHeight(!1))/this.childrenProportion:0}else s=0;this.proportionLength=s;for(var h,l,c,d,m,u,p,g,f,_=this.sizerChildren,y=this.left,v=this.top,S=0,b=_.length;S<b;S++)(h=_[S]).rexSizer.hidden||(c=(l=h.rexSizer).padding,g=sizer_GetExpandedChildWidth(this,h),f=sizer_GetExpandedChildHeight(this,h),h.isRexSizer?h.layout(this,g,f):Object(a.a)(h,g,f),void 0===g&&(g=h.width),void 0===f&&(f=h.height),0===this.orientation?(d=y+c.left,u=0===l.proportion||0===s?g:l.proportion*s,m=v+c.top,p=this.height-c.top-c.bottom):(d=y+c.left,u=this.width-c.left-c.right,m=v+c.top,p=0===l.proportion||0===s?f:l.proportion*s),r.a.setPosition(d,m).setSize(u,p),n(h,r.a,l.align),this.resetChildPositionState(h),0===this.orientation?y+=u+c.left+c.right:v+=p+c.top+c.bottom);return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0,this._childrenProportion=void 0}},h=i(42),l=i(130),c=i(73);const d=Phaser.Utils.Objects.IsPlainObject,m=Phaser.Utils.Objects.GetValue,u=Phaser.Utils.Array.Remove,p=Phaser.Display.Align.CENTER;class g extends s.a{constructor(t,e,i,s,a,r){var n;d(e)?(e=m(n=e,"x",0),i=m(n,"y",0),s=m(n,"width",void 0),a=m(n,"height",void 0)):d(s)?(s=m(n=s,"width",void 0),a=m(n,"height",void 0)):d(r)&&(n=r),void 0!==n&&(r=m(n,"orientation",0)),void 0===r&&(r=0),super(t,e,i,s,a,n),this.type="rexSizer",this.sizerChildren=[],this.setOrientation(r)}destroy(t){this.scene&&(this.sizerChildren.length=0,super.destroy(t))}setOrientation(t){return"string"==typeof t&&(t=l.a[t]),this.orientation=t,this}add(t,e,i,s,a){super.add(t);var r=typeof e;if(null===e)return this;if("number"===r);else if("string"===r)e=f[e];else if(d(e)){var n;e=m(n=e,"proportion",0),i=m(n,"align",p),s=m(n,"padding",0),a=m(n,"expand",!1)}return"string"==typeof i&&(i=c.a[i]),void 0===e&&(e=0),void 0===i&&(i=p),void 0===s&&(s=0),void 0===a&&(a=!1),(n=this.getSizerConfig(t)).parent=this,n.proportion=e,n.align=i,n.padding=Object(h.a)(s),n.expand=a,this.sizerChildren.push(t),this}insert(t,e,i,s,a,r){return this.add(e,i,s,a,r),this.moveTo(e,t),this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,u(this.sizerChildren,t),super.remove(t),this)}clear(t){for(var e=0,i=this.sizerChildren.length;e<i;e++)this.getSizerConfig(this.sizerChildren[e]).parent=void 0;return this.sizerChildren.length=0,super.clear(t),this}get childrenProportion(){return void 0===this._childrenProportion&&(this._childrenProportion=this.getChildrenProportion()),this._childrenProportion}}Object.assign(g.prototype,o);const f={min:0,full:-1};e.a=g},function(t,e,i){"use strict";var s=i(157),a=i(104),r={plainText:null,prevProp:null},n=new a.a,o={},h={splitText:function(t,e){for(var i,s,a=[],r=0,n=t.length,o=n;i=l.exec(t);)s=i[0],r<(o=l.lastIndex-s.length)&&a.push(t.substring(r,o)),void 0===e&&a.push(s),r=l.lastIndex;return r<n&&a.push(t.substring(r,n)),a},tagTextToProp:function(t,e){var i,s;null==e&&(e={}),e.img&&updateProp(e,B,"img"),c.test(t)?(updateProp(e,E,"b",!0),i=""):d.test(t)?(updateProp(e,B,"b"),i=""):m.test(t)?(updateProp(e,E,"i",!0),i=""):u.test(t)?(updateProp(e,B,"i"),i=""):p.test(t)?(s=t.match(p),updateProp(e,E,"size",s[1]+"px"),i=""):g.test(t)?(updateProp(e,B,"size"),i=""):f.test(t)?(s=t.match(f),updateProp(e,E,"color",s[1]),i=""):_.test(t)?(updateProp(e,B,"color"),i=""):y.test(t)?(s=t.match(y),updateProp(e,E,"u",!0),i=""):v.test(t)?(s=t.match(v),updateProp(e,E,"u",s[1]),i=""):S.test(t)?(updateProp(e,B,"u"),i=""):b.test(t)?(updateProp(e,E,"shadow",!0),i=""):T.test(t)?(updateProp(e,B,"shadow"),i=""):D.test(t)?(updateProp(e,E,"stroke",!0),i=""):x.test(t)?(s=t.match(x),updateProp(e,E,"stroke",s[1]),i=""):P.test(t)?(updateProp(e,B,"stroke"),i=""):C.test(t)?(s=t.match(C),updateProp(e,E,"img",s[1]),i=""):w.test(t)?(updateProp(e,B,"img"),i=""):O.test(t)?(s=t.match(O),updateProp(e,E,"area",s[1]),i=""):A.test(t)?(updateProp(e,B,"area"),i=""):i=t;var a=r;return a.plainText=i,a.prop=e,a},propToContextStyle:function(t,e){var i=n;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")?i.fontFamily=e.family:i.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var s=e.size;"number"==typeof s&&(s=s.toString()+"px"),i.fontSize=s}else i.fontSize=t.fontSize;i.fontStyle=getFontStyle(e.b,e.i),e.hasOwnProperty("color")?i.color=e.color:i.color=t.color,e.hasOwnProperty("stroke")?!0===e.stroke?(i.stroke=t.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=e.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=t.stroke,i.strokeThickness=0)}return e.hasOwnProperty("shadow")?!0===e.shadow?(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor=e.shadow,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor="#000",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,i.shadowStroke=!1,i.shadowFill=!1),e.hasOwnProperty("u")?!0===e.u?(i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor=e.u,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor="#000",i.underlineThickness=0,i.underlineOffset=0),i},propToTagText:function(t,e,i){for(var s in null==i&&(i=o),i)e.hasOwnProperty(s)||(t="[/"+s+"]"+t);var a="";for(var s in e)i[s]!==e[s]&&("size"===s?a+="[size="+e[s].replace("px","")+"]":"color"===s||"stroke"===s||"img"===s?a+="["+s+"="+e[s]+"]":"u"===s?!0===e[s]?a+="[u]":a+="[u="+e[s]+"]":a+="["+s+"]");return t=a+t}},updateProp=function(t,e,i,s){return e===E?t[i]=s:t.hasOwnProperty(i)&&delete t[i],t},getFontStyle=function(t,e){return t&&e?"bold italic":t?"bold":e?"italic":""},l=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/gi,c=/\[b\]/i,d=/\[\/b\]/i,m=/\[i\]/i,u=/\[\/i\]/i,p=/\[size=(\d+)\]/i,g=/\[\/size\]/i,f=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,_=/\[\/color\]/i,y=/\[u\]/i,v=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,S=/\[\/u\]/i,b=/\[shadow\]/i,T=/\[\/shadow\]/i,D=/\[stroke\]/i,x=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,P=/\[\/stroke\]/i,C=/\[img=([^\]]+)\]/i,w=/\[\/img\]/i,O=/\[area=([^\]]+)\]/i,A=/\[\/area\]/i;const B=!1,E=!0;var I=h;class M extends s.a{constructor(t,e,i,s,a){super(t,e,i,s,a,"rexBBCodeText",I)}}e.a=M},,,function(t,e,i){"use strict";e.a=function(){}},function(t,e,i){"use strict";e.a=function(t,e,i){!t||void 0===e&&void 0===i||(t.resize?(void 0===e&&(e=t.width),void 0===i&&(i=t.height),t.resize(e,i)):(void 0!==e&&(t.displayWidth=e),void 0!==i&&(t.displayHeight=i)))}},function(t,e,i){"use strict";e.a={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown()},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(){return this._eventEmitter&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}}},function(t,e,i){"use strict";e.a={hleft:0,hcenter:1,hright:2,vtop:0,vcenter:1,vbottom:2,NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/}},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemSlot",(function(){return h}));var s=i(3),a=i(46),r=i(7),n=i(4),o=i(56);class h{constructor(t,e,i,s,a,r,n,o,h,l,c){this.minitialize=!1,this.mWid=0,this.mHei=0,this.isTipBoo=!0,this.mScene=t,this.mWorld=e,this.toolTipCon=t.make.container(void 0,!1),this.toolTipCon.x=s,this.toolTipCon.y=a,i.add(this.toolTipCon),this.mResStr=r,this.mResPng=n,this.mResJson=o,this.mResSlot=h,this.mSubScriptRes=c,this.mSelectRes=l}set hasTip(t){this.isTipBoo=t}get hasTip(){return this.isTipBoo}createUI(){this.onLoadCompleteHandler()}getView(){return this.toolTipCon}getBg(){return this.itemBG}getIcon(){return this.mIcon}dataChange(t){if(this.minitialize&&(this.mData=t,this.mIcon)){let t;if(this.mData&&this.mData.display){t=this.mData.display.texturePath;this.mData.des&&this.mData.des;this.setToolTipData(this.mData.name+this.mData.des)}if(!t)return;this.mIcon.load(t,this,()=>{this.mData})}}destroy(){this.mSubScriptSprite&&(this.mSubScriptSprite.destroy(!0),this.mSubScriptSprite=null),this.mSelectSprite&&(this.mSelectSprite.destroy(!0),this.mSelectSprite=null),this.mIcon&&this.mIcon.destroy(),this.toolTipCon&&(this.toolTipCon.destroy(),this.toolTipCon=null),this.toolTip&&(this.toolTip.destroy(),this.toolTip=null),this.mAnimationCon&&(this.mAnimationCon.destroy(!0),this.mAnimationCon=null),this.itemBG&&(this.itemBG.destroy(!0),this.itemBG=null),this.index=0,this.mData=null,this.mScene=null,this.mWorld=null,this.mResStr=null,this.mResPng=null,this.mResSlot=null,this.mResJson=null,this.mSubScriptRes=null,this.mSelectRes=null,this.mWorld=null,this.minitialize=!1,this.mWid=0,this.mHei=0,this.mData=null,this.isTipBoo=!0}setToolTipData(t){this.toolTip&&this.toolTip.setToolTipData(t)}onLoadCompleteHandler(){this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.toolTipCon.addAt(this.itemBG,0),this.toolTipCon.setSize(this.itemBG.width,this.itemBG.height),this.mIcon=new a.DragDropIcon(this.mScene,0,0),this.toolTipCon.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1),this.isTipBoo&&(this.toolTip=new o.ToolTip(this.mScene,"itemSlotTip",n.h.getRes("ui/toolTip/toolTip.json"),n.h.getRes("ui/toolTip/toolTip.png"),this.mWorld.uiScale)),this.toolTipCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.toolTipCon.on("pointerover",this.overHandler,this),this.toolTipCon.on("pointerout",this.outHandler,this),this.toolTipCon.on("pointerdown",this.downHandler,this),this.toolTipCon.on("pointerup",this.outHandler,this),this.minitialize=!0,this.mData&&this.dataChange(this.mData),this.mWid+=this.itemBG.width,this.mHei+=this.itemBG.height}downHandler(t){if(!this.mData)return;const e=this.mWorld.roomManager.currentRoom.getHero().model.package,i=new r.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),a=i.content;a.uiId=e.id,a.componentId=this.mData.id,this.mWorld.connection.send(i)}overHandler(t){this.toolTip&&this.mData&&(this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this.toolTip),this.toolTip.setToolTipData(this.mData.name+this.mData.des),this.toolTip.x=t.x,this.toolTip.y=t.y),this.mSelectRes&&this.mSelectRes.length>0&&(this.mSelectSprite=this.mScene.make.image(void 0,!1),this.mSelectSprite.setTexture(this.mResStr,this.mSelectRes),this.toolTipCon.add(this.mSelectSprite))}outHandler(t){this.toolTip&&this.toolTip.parentContainer&&this.toolTip.parentContainer.remove(this.toolTip),this.mSelectSprite&&this.mSelectSprite.parentContainer&&(this.mSelectSprite.parentContainer.remove(this.mSelectSprite),this.mSelectSprite.destroy(!0),this.mSelectSprite=null)}}},function(t,e,i){"use strict";var texture_SetTexture=function(t,e,i){this.textureKey=t,this.columns.data=e,this.columns.count=e?e.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.rows.data=i,this.rows.count=i?i.length:0,this.rows.stretch=0,this.rows.minHeight=0;var s,a,r,n,o=this.scene.textures.get(t);if(!o)return this.redraw=!0,this;if(!e||!i)return this.redraw=!0,this;for(var h=0,l=0,c=0,d=i.length;c<d;c++){"number"==typeof i[c]&&(i[c]={height:i[c],stretch:c%2}),r=(s=i[c]).height,this.rows.stretch+=0|s.stretch,this.rows.minHeight+=s.stretch>0?0:r,h=0;for(var m=0,u=e.length;m<u;m++)"number"==typeof e[m]&&(e[m]={width:e[m],stretch:m%2}),n=(a=e[m]).width,0===c&&(this.columns.stretch+=0|a.stretch,this.columns.minWidth+=a.stretch>0?0:n),n>=1&&r>=1&&this.getFrameNameCallback(m,c)&&o.add(this.getFrameNameCallback(m,c),0,h,l,n,r),h+=n;l+=r}return this.redraw=!0,this},texture_UpdateTexture=function(){if(!this.redraw)return this;this.redraw=!1,this.clear();for(var t,e,i,s,a,r=this.width-this.columns.minWidth,n=this.height-this.rows.minHeight,o=this.columns.stretch>0?r/this.columns.stretch:0,h=this.rows.stretch>0?n/this.rows.stretch:0,l=0,c=0,d=0,m=this.rows.count;d<m;d++){a=0===(i=this.rows.data[d]).stretch?i.height:h*i.stretch,l=0;for(var u=0,p=this.columns.count;u<p;u++){var g;if(s=0===(e=this.columns.data[u]).stretch?e.width:o*e.stretch,t=this.getFrameNameCallback(u,d))if(0===i.stretch&&0===e.stretch)this.drawFrame(this.textureKey,t,l,c);else 0===this.getStretchMode(u,d)?(void 0===this._image&&(this._image=this.scene.make.image({add:!1,origin:{x:0,y:0}})),(g=this._image).setTexture(this.textureKey,t).setDisplaySize(s,a)):(void 0===this._tileSprite&&(this._tileSprite=this.scene.make.tileSprite({add:!1,origin:{x:0,y:0}})),(g=this._tileSprite).setTexture(this.textureKey,t).setSize(s,a)),this.draw(g,l,c);l+=s}c+=a}};const s=Phaser.Utils.Objects.IsPlainObject,a=Phaser.Utils.Objects.GetValue;var parseMode=function(t){return"string"==typeof t&&(t=r[t]),t};const r={scale:0,repeat:1};var utils_IsEdge=function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1},n={setTexture:texture_SetTexture,updateTexture:texture_UpdateTexture,setStretchMode:function(t){return s(t)?(this.stretchMode.edge=parseMode(a(t,"edge",0)),this.stretchMode.internal=parseMode(a(t,"internal",0))):(t=parseMode(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return utils_IsEdge.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal}},DefaultGetFrameNameCallback=function(t,e){return`${t},${e}`};const o=Phaser.GameObjects.RenderTexture,h=Phaser.Utils.Objects.IsPlainObject,l=Phaser.Utils.Objects.GetValue;class c extends o{constructor(t,e,i,s,a,r,n,o,c){h(e)?(e=l(c=e,"x",0),i=l(c,"y",0),s=l(c,"width",1),a=l(c,"height",1),r=l(c,"key",void 0),n=l(c,"columns",void 0),o=l(c,"rows",void 0)):h(s)?(s=l(c=s,"width",1),a=l(c,"height",1),r=l(c,"key",void 0),n=l(c,"columns",void 0),o=l(c,"rows",void 0)):h(r)&&(r=l(c=r,"key",void 0),n=l(c,"columns",void 0),o=l(c,"rows",void 0)),super(t,e,i,s,a),this.columns={},this.rows={},this.stretchMode={},this.redraw=!1,this._image=void 0,this._tileSprite=void 0,this.setOrigin(.5,.5),this.setGetFrameNameCallback(l(c,"getFrameNameCallback",void 0)),this.setTexture(r,n,o),this.setStretchMode(l(c,"stretchMode",0))}preDestroy(){this._image&&(this._image.destroy(),this._image=void 0),this._tileSprite&&(this._tileSprite.destroy(),this._tileSprite=void 0),super.preDestroy()}setGetFrameNameCallback(t){return void 0===t&&(t=DefaultGetFrameNameCallback),this.getFrameNameCallback=t,this}get minWidth(){return this.columns.minWidth}get minHeight(){return this.rows.minHeight}resize(t,e){return this.redraw=!0,super.resize(t,e),this.updateDisplayOrigin(),this}renderWebGL(t,e,i,s,a){this.updateTexture(),super.renderWebGL(t,e,i,s,a)}renderCanvas(t,e,i,s,a){this.updateTexture(),super.renderCanvas(t,e,i,s,a)}}Object.assign(c.prototype,n);e.a=c},function(t,e,i){"use strict";var s=i(25),a=i(74),r=i.n(a);class n{constructor(t){var e=r()(t,"states",void 0);e&&this.addStates(e);var i=r()(t,"extend",void 0);if(i)for(var s in i)this.hasOwnProperty(s)&&void 0!==this[s]||(this[s]=i[s]);var a=r()(t,"eventEmitter",void 0),n=r()(t,"EventEmitterClass",void 0);this.setEventEmitter(a,n),this._stateLock=!1,this.resetFromJSON(t)}shutdown(){this.destroyEventEmitter()}destroy(){this.shutdown()}resetFromJSON(t){this.setEnable(r()(t,"enable",!0)),this.start(r()(t,"start",void 0));var e=r()(t,"init",void 0);return e&&e.call(this),this}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}set state(t){if(this.enable&&!this._stateLock&&this._state!==t){if(this._prevState=this._state,this._state=t,this._stateLock=!0,this.emit("statechange",this),null!=this._prevState){var e="exit_"+this._prevState,i=this[e];i&&i.call(this),this.emit(e,this)}if(this._stateLock=!1,null!=this._state){var s="enter_"+this._state,a=this[s];a&&a.call(this),this.emit(s,this)}}}get state(){return this._state}get prevState(){return this._prevState}start(t){return this._start=t,this._prevState=void 0,this._state=t,this}goto(t){return null!=t&&(this.state=t),this}next(){var t,e=this["next_"+this.state];return e&&(t="string"==typeof e?e:e.call(this)),this.goto(t),this}addState(t,e){var i=r()(e,"next",void 0);i&&(this["next_"+t]=i);var s=r()(e,"exit",void 0);s&&(this["exit_"+t]=s);var a=r()(e,"enter",void 0);return a&&(this["enter_"+t]=a),this}addStates(t){for(var e in t)this.addState(e,t[e]);return this}update(t,e,i){void 0===i&&(i="update");var s=this[i+"_"+this.state];s&&s.call(this,t,e)}preupdate(t,e){this.update(t,e,"preupdate")}postupdate(t,e){this.update(t,e,"postupdate")}}Object.assign(n.prototype,s.a);var o=n;e.a=o},function(t,e,i){"use strict";var callback=function(t){t.stopPropagation()},input_StopPropagationTouchEvents=function(t){t.addEventListener("touchstart",callback,!1),t.addEventListener("touchmove",callback,!1),t.addEventListener("touchend",callback,!1),t.addEventListener("mousedown",callback,!1),t.addEventListener("mouseup",callback,!1),t.addEventListener("mousemove",callback,!1)};const s=Phaser.GameObjects.DOMElement,a=Phaser.Utils.Objects.IsPlainObject,r=Phaser.Utils.Objects.GetValue;const n={id:["id",void 0],text:["value",void 0],placeholder:["placeholder",void 0],tooltip:["title",void 0],readOnly:["readonly",!1],spellCheck:["spellcheck",!1],autoComplete:["autocomplete","off"]},o={align:["text-align",void 0],width:["width",void 0],height:["height",void 0],fontFamily:["font-family",void 0],fontSize:["font-size",void 0],color:["color","#ffffff"],backgroundColor:["backgroundColor","transparent"],borderColor:["borderColor","transparent"],outline:["outline","none"]},h={textchange:"oninput",click:"onclick",dblclick:"ondblclick",focus:"onfocus",blur:"onblur"};e.a=class extends s{constructor(t,e,i,s,l,c){a(e)?(e=r(c=e,"x",0),i=r(c,"y",0),s=r(c,"width",void 0),l=r(c,"height",void 0)):a(s)&&(s=r(c=s,"width",void 0),l=r(c,"height",void 0)),void 0===c&&(c={});var d,m=t.scale.autoRound;void 0!==s&&(m&&(s=Math.floor(s)),c.width=s+"px"),void 0!==l&&(m&&(l=Math.floor(l)),c.height=l+"px");var u,p,g=r(c,"type","text");for(var f in"textarea"===g?(d=document.createElement("textarea")).style.resize="none":(d=document.createElement("input")).type=g,n)u=n[f],void 0!==(p=r(c,f,u[1]))&&(d[u[0]]=p);var _,y,v=r(c,"style",void 0);for(var f in void 0===v&&(v={}),o)_=o[f],void 0!==(y=r(c,f,_[1]))&&(v[_[0]]=y);var S=d.style;for(var f in c)f in n||f in o||f in S&&(v[f]=c[f]);v["box-sizing"]="border-box",super(t,e,i,d,v),this.type="rexInputText";for(let t in h)this.node[h[t]]=function(){this.emit(t,this)}.bind(this);input_StopPropagationTouchEvents(this.node)}resize(t,e){var i=this.node.style;return i.width=t+"px",i.height=e+"px",this.updateSize(),this}get text(){return this.node.value}set text(t){this.node.value=t}setText(t){return this.text=t,this}selectText(){return this.node.select(),this}get placeholder(){return this.node.placeholder}set placeholder(t){this.node.placeholder=t}setPlaceholder(t){return this.placeholder=t,this}get tooltip(){return this.node.title}set tooltip(t){this.node.title=t}setTooltip(t){return this.tooltip=t,this}setTextChangedCallback(t){return this.onTextChanged=t,this}get readOnly(){return this.node.readOnly}set readOnly(t){this.node.readOnly=t}setReadOnly(t){return void 0===t&&(t=!0),this.readOnly=t,this}get spellCheck(){return this.node.spellcheck}set spellCheck(t){this.node.spellcheck=t}setSpellCheck(t){return this.spellCheck=t,this}setStyle(t,e){return this.node.style[t]=e,this}getStyle(t){return this.node.style[t]}scrollToBottom(){return this.node.scrollTop=this.node.scrollHeight,this}setEnabled(t){return void 0===t&&(t=!0),this.node.disabled=!t,this}setBlur(){return this.node.blur(),this}setFocus(){return this.node.focus(),this}}},,,,,function(t,e,i){"use strict";var s=i(23),a=new Phaser.GameObjects.Zone({sys:{queueDepthSort:s.a,events:{once:s.a}}},0,0,1,1);a.setOrigin(0),e.a=a},function(t,e,i){"use strict";var s=i(127),a=i(72),r=i(128),basesizer_PushIntoBounds=function(t){return void 0===t&&(t=Object(r.a)(this.scene)),this.left=Math.max(this.left,t.left),this.right=Math.min(this.right,t.right),this.top=Math.max(this.top,t.top),this.bottom=Math.min(this.bottom,t.bottom),this},n=new Phaser.Geom.Rectangle,basesizer_DrawBounds=function(t,e){void 0===e&&(e=16777215);for(var i,s=this.getAllChildren([this]),a=0,r=s.length;a<r;a++)(i=s[a]).getBounds&&t.lineStyle(1,e).strokeRectShape(i.getBounds(n));return this},basesizer_AddChildrenMap=function(t,e){return void 0===this.childrenMap&&(this.childrenMap={}),this.childrenMap[t]=e,this},GetAllElements=function(t,e){var i;for(var s in void 0===e&&(e=[]),t)void 0!==(i=t[s]).name?e.push(i):GetAllElements(i,e);return e};const o=/(\S+)\[(\d+)\]/i;var h=[],basesizer_GetElement=function(t){if(void 0!==this.childrenMap&&("string"==typeof t&&(t=t.split(".")),0!==t.length)){var e,i=t.shift();if("#"===i.charAt(0)){i=i.substring(1);for(var s=0,a=(r=GetAllElements(this.childrenMap,h)).length;s<a;s++)if(r[s].name===i){e=r[s];break}h.length=0}else if(-1===i.indexOf("["))e=this.childrenMap[i];else{var r,n=i.match(o);if(null!=n)(r=this.childrenMap[n[1]])&&(e=r[n[2]])}return 0===t.length?e:e&&e.childrenMap?e.getElement(t):null}},basesizer_GetChildrenWidth=function(){return 0},basesizer_GetChildrenHeight=function(){return 0},basesizer_GetAllChildrenSizers=function(t){void 0===t&&(t=[]);for(var e=t.length,i=this.getChildrenSizers(t),s=t.length,a=e;a<s;a++)i[a].getAllChildrenSizers(t);return t},basesizer_GetChildrenSizers=function(t){return void 0===t&&(t=[]),t},basesizer_Layout=function(t,e,i){},basesizer_LayoutInit=function(t){if(!t)for(var e,i=this.getAllChildrenSizers([this]),s=0,a=i.length;s<a;s++)(e=i[s]).rexSizer&&e._layoutInit()},basesizer_layoutInit=function(){},l=i(15);const c=Phaser.Utils.Objects.GetValue,d=Phaser.Utils.Objects.GetAdvancedValue;const m={stop:0,destroy:1,yoyo:2};var u=class{constructor(t,e){this.gameObject=t,this.scene=Object(l.a)(t),this.scaleStart={},this.scaleEnd={},this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setMode(c(t,"mode",0)),this.setScaleRange(d(t,"start",void 0),d(t,"end",0)),this.setDelay(d(t,"delay",0)),this.setDuration(d(t,"duration",1e3)),this.setEase(c(t,"ease",void 0)),this}toJSON(){return{mode:this.mode,start:this.scaleStart,end:this.scaleEnd,delay:this.delay,duration:this.duration}}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setMode(t){return"string"==typeof t&&(t=m[t]),this.mode=t,this}setScaleRange(t,e){return"number"==typeof t?(this.scaleStart.x=t,this.scaleStart.y=t):(this.scaleStart.x=c(t,"x",this.gameObject.scaleX),this.scaleStart.y=c(t,"y",this.gameObject.scaleY)),"number"==typeof e?(this.scaleEnd.x=e,this.scaleEnd.y=e):(this.scaleEnd.x=c(e,"x",this.scaleStart.x),this.scaleEnd.y=c(e,"y",this.scaleStart.y)),this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}setEase(t){return void 0===t&&(t="Linear"),this.ease=t,this}start(){return this.tween?this:0===this.duration?(this.sound.setScale(this.scaleEnd.x,this.scaleEnd.y),this.complete(),this):(this.gameObject.setScale(this.scaleStart.x,this.scaleStart.y),this.tween=this.scene.tweens.add({targets:this.gameObject,scaleX:this.scaleEnd.x,scaleY:this.scaleEnd.y,duration:this.duration,ease:this.ease,yoyo:2==this.mode,repeat:2==this.mode?-1:0,onComplete:this.complete,onCompleteScope:this}),this)}restart(){return this.stop().start(),this}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),1===this.mode&&this.gameObject.destroy(),this}},p={},popup=function(t,e,i,s,a){switch(p.mode=0,i){case"x":p.start={x:0};break;case"y":p.start={y:0};break;default:p.start=0}return p.end=1,p.duration=e,p.ease=void 0===s?"Cubic":s,void 0===a?a=new u(t,p):a.resetFromJSON(p),a.restart(),a};const g=Phaser.Utils.Objects.IsPlainObject,f=Phaser.Utils.Objects.GetValue;var _={},scale_down_destroy=function(t,e,i,s,a,r){switch(a instanceof u&&(r=a,a=void 0),void 0===a&&(a=!0),_.mode=a?1:0,i){case"x":_.end={x:0};break;case"y":_.end={y:0};break;default:_.end=0}return _.duration=e,_.ease=void 0===s?"Linear":s,void 0===r?r=new u(t,_):r.resetFromJSON(_),r.restart(),r};const y=Phaser.Utils.Objects.IsPlainObject,v=Phaser.Utils.Objects.GetValue;const S=Phaser.Utils.Objects.GetValue,b=Phaser.Utils.Objects.GetAdvancedValue;const T={stop:0,destroy:1,yoyo:2};var D=class{constructor(t,e){this.gameObject=t,this.scene=Object(l.a)(t),this.alphaStart=void 0,this.alphaEnd=void 0,this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setMode(S(t,"mode",0)),this.setAlphaRange(b(t,"start",this.gameObject.alpha),b(t,"end",0)),this.setDelay(b(t,"delay",0)),this.setDuration(b(t,"duration",1e3)),this}toJSON(){return{mode:this.mode,start:this.alphaStart,end:this.alphaEnd,delay:this.delay,duration:this.duration}}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setMode(t){return"string"==typeof t&&(t=T[t]),this.mode=t,this}setAlphaRange(t,e){return this.alphaStart=t,this.alphaEnd=e,this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}start(){return this.tween?this:0===this.duration?(this.gameObject.setAlpha(this.alphaEnd),this.complete(),this):(this.gameObject.setAlpha(this.alphaStart),this.tween=this.scene.tweens.add({targets:this.gameObject,alpha:this.alphaEnd,delay:this.delay,duration:this.duration,ease:"Linear",yoyo:2==this.mode,repeat:2==this.mode?-1:0,onComplete:this.complete,onCompleteScope:this}),this)}restart(){return this.stop().start(),this}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),1===this.mode&&this.gameObject.destroy(),this}},x={},fade_in=function(t,e,i,s){return void 0===i&&(i=t.alpha),x.mode=0,x.start=0,x.end=i,x.duration=e,void 0===s?s=new D(t,x):s.resetFromJSON(x),s.restart(),s};const P=Phaser.Utils.Objects.IsPlainObject,C=Phaser.Utils.Objects.GetValue;var w={},fade_out_destroy=function(t,e,i,s){return i instanceof D&&(s=i,i=void 0),void 0===i&&(i=!0),w.mode=i?1:0,w.end=0,w.duration=e,void 0===s?s=new D(t,w):s.resetFromJSON(w),s.restart(),s};const O=Phaser.Utils.Objects.IsPlainObject,A=Phaser.Utils.Objects.GetValue;var B=void 0,basesizer_IsInTouching=function(t){if(void 0===B&&(B=new Phaser.Geom.Rectangle),this.getBounds(B),void 0!==t)return B.contains(t.x,t.y);for(var e=this.scene.input.manager,i=e.pointersTotal,s=e.pointers,a=0;a<i;a++)if(t=s[a],B.contains(t.x,t.y))return!0;return!1},basesizer_GetTopmostSizer=function(t){void 0===t&&(t=this);for(var e=Object(a.a)(t).parent;e;)t=e,e=Object(a.a)(t).parent;return t},E=i(24),I=i(35);const M=Phaser.Display.Align.In.QuickSet,k=Phaser.Display.Align.CENTER;var basesizer_LayoutBackgrounds=function(){if(void 0!==this.backgroundChildren)for(var t,e=this.backgroundChildren,i=this.left,s=this.top,a=this.width,r=this.height,n=0,o=e.length;n<o;n++)(t=e[n]).rexSizer.hidden||(Object(E.a)(t,a,r),I.a.setPosition(i,s).setSize(a,r),M(t,I.a,k),this.resetChildPositionState(t))},onDrag=function(t,e,i){var s=this.getTopmostSizer();s.x+=e-this.x,s.y+=i-this.y},basesizer_SetDraggable=function(t){return void 0===t&&(t=!0),this.input&&this.input.hasOwnProperty("draggable")?this.input.draggable=t:t&&(this.setInteractive(),this.scene.input.setDraggable(this),this.on("drag",onDrag,this)),this},R={getSizerConfig:a.a,pushIntoBounds:basesizer_PushIntoBounds,drawBounds:basesizer_DrawBounds,getChildrenWidth:basesizer_GetChildrenWidth,getChildrenHeight:basesizer_GetChildrenHeight,addChildrenMap:basesizer_AddChildrenMap,addElement:basesizer_AddChildrenMap,getElement:basesizer_GetElement,getAllChildrenSizers:basesizer_GetAllChildrenSizers,getChildrenSizers:basesizer_GetChildrenSizers,layout:basesizer_Layout,layoutBackgrounds:basesizer_LayoutBackgrounds,layoutInit:basesizer_LayoutInit,_layoutInit:basesizer_layoutInit,popUp:function(t,e,i){if(g(t)){var s=t;t=f(s,"duration",void 0),e=f(s,"orientation",void 0),i=f(s,"ease",void 0)}return this._scale=popup(this,t,e,i,this._scale),this},scaleDownDestroy:function(t,e,i,s){if(y(t)){var a=t;t=v(a,"duration",void 0),e=v(a,"orientation",void 0),i=v(a,"ease",void 0),s=v(a,"destroy",void 0)}return this._scale=scale_down_destroy(this,t,e,i,s,this._scale),this},fadeIn:function(t){P(t)&&(t=C(t,"duration",void 0));return this._fade=fade_in(this,t,this._fade),this},fadeOutDestroy:function(t,e){if(O(t)){var i=t;t=A(i,"duration",void 0),e=A(i,"destroy",void 0)}return this._fade=fade_out_destroy(this,t,e,this._fade),this},isInTouching:basesizer_IsInTouching,getTopmostSizer:basesizer_GetTopmostSizer,setDraggable:basesizer_SetDraggable};const L=Phaser.Geom.Rectangle;var anchor_GetViewport=function(t,e){void 0===e&&(e=new L);var i=t.canvasBounds,s=t.displayScale,a=t.autoCenter;return e.x=i.x>=0?0:-i.x*s.x,e.y=i.y>=0?0:-i.y*s.y,e.width=i.width*s.x-e.x,e.height=i.height*s.y-e.y,1!==a&&2!==a||(e.width-=e.x),1!==a&&3!==a||(e.height-=e.y),e};const F=Phaser.Utils.Objects.GetValue,N=Phaser.Geom.Rectangle;var j=class{constructor(t,e){this.gameObject=t,this.viewport=new N,this.resetFromJSON(e),this.boot()}resetFromJSON(t){var e,i;if("string"==typeof t){var s=t.split(",");e=s[0],i=s[1]}else e=F(t,"x","0%+0"),i=F(t,"y","0%+0");e=e.replace("left","0%").replace("right","100%").replace("center","50%").split("%");var a=parseFloat(e[0])/100,r=""===e[1]?0:parseFloat(e[1]);i=i.replace("top","0%").replace("bottom","100%").replace("center","50%").split("%");var n=parseFloat(i[0])/100,o=""===i[1]?0:parseFloat(i[1]);return this.setPercentage(a,n),this.setOffset(r,o),this}boot(){this.scaleManamger.on("resize",this.onResize,this),this.gameObject.once("destroy",this.destroy,this),this.onResize()}shutdown(){this.scaleManamger.off("resize",this.onResize,this),this.gameObject=void 0}destroy(){this.shutdown()}setOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.offsetX=t,this.offsetY=e,this}setPercentage(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.percentageX=t,this.percentageY=e,this}onResize(){anchor_GetViewport(this.scaleManamger,this.viewport),this.updatePosition()}updatePosition(){return this.gameObject.setPosition(this.x,this.y),this}get scaleManamger(){return this.gameObject.scene.scale}get x(){return this.viewport.x+this.viewport.width*this.percentageX+this.offsetX}get y(){return this.viewport.y+this.viewport.height*this.percentageY+this.offsetY}};const W=Phaser.Utils.Objects.GetValue;class H extends s.a{constructor(t,e,i,s,a,r){var n,o;"string"==typeof e&&(n=e,o=i,e=0,i=0),super(t,e,i,2,2),this.isRexSizer=!0,this.setMinSize(s,a),this.setName(W(r,"name","")),this.rexSizer={},this.backgroundChildren=void 0,void 0!==n&&(this._anchor=new j(this,{x:n,y:o})),this.setDraggable(W(r,"draggable",!1))}destroy(t){this.scene&&(void 0!==this.backgroundChildren&&(this.backgroundChildren.length=0),super.destroy(t))}setMinSize(t,e){return this.setMinWidth(t).setMinHeight(e),this}setMinWidth(t){return null==t&&(t=0),this.minWidth=t,this}setMinHeight(t){return null==t&&(t=0),this.minHeight=t,this}get childrenWidth(){return void 0===this._childrenWidth&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return void 0===this._childrenHeight&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}get left(){return this.x-this.displayWidth*this.originX}set left(t){this.x+=t-this.left}alignLeft(t){return this.left=t,this}get right(){return this.x-this.displayWidth*this.originX+this.displayWidth}set right(t){this.x+=t-this.right}alignRight(t){return this.right=t,this}get centerX(){return(this.left+this.right)/2}set centerX(t){this.x+=t-this.centerX}alignCenterX(t){return this.centerX=t,this}get top(){return this.y-this.displayHeight*this.originY}set top(t){this.y+=t-this.top}alignTop(t){return this.top=t,this}get bottom(){return this.y-this.displayHeight*this.originY+this.displayHeight}set bottom(t){this.y+=t-this.bottom}alignBottom(t){return this.bottom=t,this}get centerY(){return(this.top+this.bottom)/2}set centerY(t){this.y+=t-this.centerY}alignCenterY(t){return this.centerY=t,this}pin(t){return super.add(t),this}addBackground(t){return void 0===this.backgroundChildren&&(this.backgroundChildren=[]),super.add(t),this.getSizerConfig(t).parent=this,this.backgroundChildren.push(t),this}}Object.assign(H.prototype,R);e.a=H},,,function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));class s{}s.YAHEI_14_BOLD="bold 14px YaHei",s.YAHEI_16_BOLD="bold 16px YaHei",s.YAHEI_18_BOLD="bold 18px YaHei",s.YAHEI_20_BOLD="bold 20px YaHei"},,,function(t,e,i){"use strict";const s=Phaser.Utils.Objects.GetValue;e.a=function(t,e){return void 0===e&&(e={}),"number"==typeof t?(e.left=t,e.right=t,e.top=t,e.bottom=t):(e.left=s(t,"left",0),e.right=s(t,"right",0),e.top=s(t,"top",0),e.bottom=s(t,"bottom",0)),e}},function(t,e,i){"use strict";const s=Phaser.GameObjects.Graphics;const a={rectangle:0,circle:1};e.a=class extends s{constructor(t,e,i){void 0===e&&(e=0),"string"==typeof e&&(shaep=a[e]),void 0===i&&(i=0),super(t.scene),this.parent=t,this.shape=e,this.padding=i,this.setPosition().resize()}destroy(){return this.parent=void 0,super.destroy(),this}setPosition(t,e){var i=this.parent;return void 0===t&&(t=i.x),void 0===e&&(e=i.y),super.setPosition(t,e),this}resize(t,e,i){var s=this.parent;if(void 0===t&&(t=s.width),void 0===e&&(e=s.height),void 0===i&&(i=this.padding),this.widthSave===t&&this.heightSave===e&&this.paddingSave===i)return this;switch(this.clear().fillStyle(16777215),this.shape){case 1:var a=Math.min(t,e)/2;this.fillCircle(0,0,a+i);break;default:this.fillRect(-t*s.originX-i,-e*s.originY-i,t+2*i,e+2*i)}return this.widthSave=t,this.heightSave=e,this.paddingSave=i,this}}},function(t,e,i){"use strict";i.r(e),i.d(e,"MainUIMediator",(function(){return o}));var s=i(12),a=i(16),r=i(53),n=i(83);class o extends s.a{constructor(t,e){super(t),this.world=t,this.mScene=e}setUiScale(t){this.mView.scaleX=this.mView.scaleY=t}isSceneUI(){return!0}isShow(){if(this.mView)return this.mView.isShow()}resize(){this.mView&&this.mView.resize()}getView(){return this.mView}show(t){if(this.mView&&this.mView.isShow())return;const e=this.world.getSize();this.world.game.device.os.desktop?this.mView=new n.MainUIPC(this.mScene,this.world,(e.width>>1)-29,e.height-50):this.mView=new r.MainUIMobile(this.mScene,this.world),this.mView.show(t),this.world.emitter.on(a.a.QUERY_PACKAGE,this.queryPackAge,this),this.world.emitter.on(a.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.on(a.a.PACKAGE_ITEM_ADD,this.heroItemChange,this),super.show(t)}update(t){this.mView&&this.mView.update(t)}hide(){this.world.emitter.off(a.a.QUERY_PACKAGE,this.queryPackAge,this),this.world.emitter.off(a.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.world.emitter.off(a.a.PACKAGE_ITEM_ADD,this.heroItemChange,this),this.mView&&this.mView.hide()}destroy(){this.mView&&(this.mView.destroy(),this.mView=null),this.mScene=null,this.world=null}tweenView(t){this.world.game.device.os.desktop||(this.mView.tweenView(t),this.world.inputManager.tweenView(t))}heroItemChange(){const t=this.world.roomManager.currentRoom.getHero().model.package.items;this.mView&&this.world.game.device.os.desktop&&this.mView.setDataList(t)}queryPackAge(t){if(t.id!==this.world.roomManager.currentRoom.getHero().model.package.id)return;t.items.length;this.mView&&this.world.game.device.os.desktop&&this.mView.setDataList(t.items)}}o.NAME="MainUIMediator"},function(t,e,i){"use strict";i.r(e),i.d(e,"IconBtn",(function(){return a}));var s=i(11);class a extends Phaser.GameObjects.Container{constructor(t,e,i,s,a,r=28/43){super(t),this.mScene=t,this.mWorld=e,this.mBtnBg=t.make.image(void 0,!1),this.mBgTexture=s,this.mBgResKey=i,this.mBtnBg.setTexture(i,s[0]),this.mBtnBg.scaleX=this.mBtnBg.scaleY=r,this.addAt(this.mBtnBg,0),a&&a.length>0&&(this.mBtnIcon=t.make.image(void 0,!1),this.mBtnIcon.setTexture(i,a),this.add(this.mBtnIcon)),this.setSize(this.mBtnBg.width,this.mBtnBg.height),this.setInteractive(),this.on("pointerup",this.upHandler,this),this.on("pointerdown",this.downHandler,this),this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this)}setPos(t,e){this.mBasePos||(this.mBasePos=new s.a),this.mBasePos.x=t,this.mBasePos.y=e}getPos(){return this.mBasePos}setBtnData(t){this.mBtnData=t}getBtnData(){return this.mBtnData}setClick(t){this.monClick=t}destroy(){this.mBtnBg&&this.mBtnBg.destroy(!0),this.mBtnIcon&&this.mBtnIcon.destroy(!0),this.monClick=null,this.mBtnBg=null,this.mBtnIcon=null,this.mBtnData=null,this.mScene=null,super.destroy()}overHandler(t){this.mBgTexture.length<2||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[1])}outHandler(t){this.mBgTexture.length<2||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[0])}upHandler(){this.monClick&&this.monClick(),this.mBgTexture.length<3||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[2])}downHandler(){this.scaleHandler(),this.mBgTexture.length<4||this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[3])}scaleHandler(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1}}},function(t,e,i){"use strict";i.r(e),i.d(e,"DragDropIcon",(function(){return r}));var s=i(4),a=i(18);class r extends Phaser.GameObjects.Container{constructor(t,e,i,s){super(t,e,i),this.mScene=t,this.mIcon=new a.DynamicImage(this.mScene,0,0),this.add(this.mIcon)}load(t,e,i){this.mUrl=t;this.resKey;this.mIcon.load(s.h.getOsdRes(this.mUrl),()=>{}),this.mCallBack=i}dragStart(){}dragStop(t){}dragDrop(t){}dragOver(t){}getDragData(){}getDropData(){}getDragImage(){return this.mIcon}getVisualDisplay(){}getBound(){const t=this.getBounds();return new Phaser.Geom.Rectangle(t.x,t.y,t.width,t.height)}get resKey(){if(void 0===this.mUrl)return"";return s.h.getOsdRes(this.mUrl)}destroy(){this.mCallBack=null,super.destroy(!0)}get icon(){return this.mIcon}setDragType(t){this.mDragType=t}setDropType(t){this.mDropType=t}getDropType(){return this.mDropType}getDragType(){return this.mDragType}}},function(t,e,i){"use strict";var s=class{constructor(){this.items=[]}destroy(){this.items.length=0,this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}};e.a=s},,,function(t,e,i){"use strict";i.r(e),i.d(e,"ChatMediator",(function(){return l}));var s=i(7),a=i(3),r=i(6),n=i(2),o=i(71),h=i(77);class l extends s.PacketHandler{constructor(t,e){super(),this.mInRoom=!1,this.mAllMessage=[],this.mMaxMessageNum=50,this.world=t,this.mScene=e,this.world.connection&&(this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,this.handleCharacterChat),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QCLOUD_GME_AUTHBUFFER,this.handleQCLoudGME)),this.world.emitter.on(n.World.SCALE_CHANGE,this.scaleChange,this)}setUiScale(t){this.mChatPanel.scaleX=this.mChatPanel.scaleY=t}enterRoom(){if(!this.room)return;if(!this.room.actor)return;if(!this.mGMEApi)return;this.room.actor.id;const t=this.room.id;this.mGMEApi.EnterRoom(t.toString(),1,this.mQCLoudAuth),this.mInRoom=!0,this.sendVoiceRoomStatus(a.op_def.ChatChannel.CurrentScene,t,a.op_def.VoiceRoomStatus.InVoiceRoom)}exitRoom(){this.mGMEApi&&(this.mGMEApi.EnableMic(!1),this.mGMEApi.ExitRoom(),this.mInRoom=!1,this.room&&this.sendVoiceRoomStatus(a.op_def.ChatChannel.CurrentScene,this.room.id,a.op_def.VoiceRoomStatus.OutsideVoiceRoom))}isSceneUI(){return!0}getView(){return this.mChatPanel}isShow(){return!!this.mChatPanel&&this.mChatPanel.isShow()}resize(){this.mChatPanel&&this.mChatPanel.setLocation()}show(t){this.mChatPanel&&this.mChatPanel.isShow()||(this.world.connection.addPacketListener(this),this.world.game.device.os.desktop?this.mChatPanel=new o.ChatPanelPC(this.mScene,this.world):this.mChatPanel=new h.ChatPanelMobile(this.mScene,this.world),this.world.uiManager.getUILayerManager().addToUILayer(this.mChatPanel),this.mChatPanel.on("sendChat",this.onSendChatHandler,this),this.mChatPanel.on("selectedVoice",this.onSelectedVoiceHandler,this),this.mChatPanel.on("selectedMic",this.onSelectedMicHandler,this),this.mChatPanel.show(),this.setUiScale(this.world.uiScale))}update(t){this.mChatPanel.update(t)}hide(){this.world.connection.removePacketListener(this),this.mChatPanel.off("sendChat",this.onSendChatHandler,this),this.mChatPanel.off("selectedVoice",this.onSelectedVoiceHandler,this),this.mChatPanel.off("selectedMic",this.onSelectedMicHandler,this),this.mChatPanel.hide()}destroy(){this.mChatPanel&&(this.mChatPanel.destroy(),this.mChatPanel=null),this.mGMEApi&&(this.mGMEApi=null),this.world.emitter.off(n.World.SCALE_CHANGE,this.scaleChange,this),this.mScene=null,this.world=null,this.mInRoom=!1,this.mQCLoudAuth=null,this.mAllMessage.forEach(t=>{t&&(t=null)}),this.mAllMessage=null}scaleChange(){this.setUiScale(this.world.uiScale)}initGME(){if(!this.room.actor)return;const t=this.room.actor.id;this.mGMEApi=new WebGMEAPI,this.mGMEApi.Init(document,"1400209172",t.toString()),this.mGMEApi.SetTMGDelegate((t,e)=>{switch(t){case this.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ENTER_ROOM:r.a.getInstance().log(`[GME]: EnterRoom: ${e}`);break;case this.mGMEApi.event.ITMG_MAIN_EVNET_TYPE_USER_UPDATE:break;case this.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_EXIT_ROOM:r.a.getInstance().log("[GME]: ExitRoom");break;case this.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ROOM_DISCONNECT:r.a.getInstance().log("[GME]: Room Disconnect!!!");break;default:r.a.getInstance().log("[GME]: Sth wrong...")}})}appendMessage(t,e){t.push(e),t.length>this.mMaxMessageNum&&t.shift()}changeMessageChannel(){if(!this.mChatPanel)return;const t=this.mAllMessage.filter(t=>t.channel===this.mChatPanel.outChannel||t.channel===a.op_def.ChatChannel.System||null===this.mChatPanel.outChannel),e=t.length;let i=null,s="\n";for(let a=0;a<e;a++)i=t[a],a===e-1&&(s=""),this.mChatPanel.appendChat(i.chat+s)}handleCharacterChat(t){const e=t.content;if(!(this.world&&this.world.emitter&&this.room&&this.mChatPanel))return;const i=this.world.roomManager.currentRoom.playerManager.get(e.chatSenderid),s=i?`${i.model.nickname}:`:"",a=e.chatSetting.textColor?e.chatSetting.textColor:"#FFFFFF";this.appendMessage(this.mAllMessage,{chat:`[color=${a}]${s}:${e.chatContext}[/color]`,channel:e.chatChannel}),this.mChatPanel.appendChat(`[b][color=${a}]${s}${e.chatContext}[/color][/b]\n`)}onSendChatHandler(t){if(this.world.connection){const e=new s.PBpacket(a.op_virtual_world.OPCODE._OP_GATEWAY_REQ_VIRTUAL_WORLD_CHAT),i=e.content;i.chatChannel=0,i.chatContext=t,this.world.connection.send(e)}}sendVoiceRoomStatus(t,e,i){if(!this.room.connection)return;const r=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS),n=r.content;n.voiceChannel=t,n.voiceRoomId=e,n.voiceRoomStatus=i,this.room.connection.send(r)}handleQCLoudGME(t){const e=t.content;this.mQCLoudAuth=e.signature,this.initGME()}onSelectedVoiceHandler(t){t?this.enterRoom():this.exitRoom()}onSelectedMicHandler(t){if(this.mGMEApi&&(this.mInRoom&&this.mGMEApi.EnableMic(t),this.world.connection)){const t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS);this.world.connection.send(t)}}get room(){if(this.world&&this.world.roomManager)return this.world.roomManager.currentRoom}}l.NAME="ChatMediator"},function(t,e,i){"use strict";var s=i(131);const a=Phaser.Utils.Objects.GetValue;e.a=function(t,e){void 0===e&&(e="scrollMode");var i=a(t,"scrollMode",0);return"string"==typeof i&&(i=s.a[i]),i}},function(t,e,i){"use strict";i.r(e),i.d(e,"BaseChatPanel",(function(){return a}));var s=i(8);class a extends s.Panel{constructor(t){super(t)}appendChat(t){}setLocation(t,e){}get outChannel(){return 0}}},function(t,e,i){"use strict";i.r(e),i.d(e,"MainUIMobile",(function(){return h}));var s=i(8),a=i(78),r=i(79),n=i(80),o=i(81);class h extends s.Panel{constructor(t,e){super(t),this.mScene=t,this.mWorld=e,this.mTopBtnGroup=new a.TopBtnGroup(t,e),this.mRightBtnGroup=new r.RightBtnGroup(t,e),this.mBottomBtnGroup=new n.BottomBtnGroup(t,e),this.mLeftBtnGroup=new o.LeftBtnGroup(t,e)}isShow(){return this.mShowing}show(t){this.mShowing||(this.mTopBtnGroup.show(t),this.mRightBtnGroup.show(t),this.mBottomBtnGroup.show(t),this.mLeftBtnGroup.show(t),super.show(t))}hide(){this.mTopBtnGroup&&this.mTopBtnGroup.hide(),this.mRightBtnGroup&&this.mRightBtnGroup.hide(),this.mBottomBtnGroup&&this.mBottomBtnGroup.hide(),this.mLeftBtnGroup&&this.mLeftBtnGroup.hide(),super.hide()}resize(){this.mTopBtnGroup&&this.mTopBtnGroup.resize(),this.mRightBtnGroup&&this.mRightBtnGroup.resize(),this.mBottomBtnGroup&&this.mBottomBtnGroup.resize(),this.mLeftBtnGroup&&this.mLeftBtnGroup.resize(),super.resize()}destroy(){this.mTopBtnGroup&&this.mTopBtnGroup.destroy(),this.mRightBtnGroup&&this.mRightBtnGroup.destroy(),this.mBottomBtnGroup&&this.mBottomBtnGroup.destroy(),this.mLeftBtnGroup&&this.mLeftBtnGroup.destroy(),this.mLeftBtnGroup=null,this.mTopBtnGroup=null,this.mRightBtnGroup=null,this.mBottomBtnGroup=null,super.destroy()}tweenView(t){this.mTopBtnGroup&&this.mTopBtnGroup.tweenView(t),this.mRightBtnGroup&&this.mRightBtnGroup.tweenView(t),this.mBottomBtnGroup&&this.mBottomBtnGroup.tweenView(t),this.mLeftBtnGroup&&this.mLeftBtnGroup.tweenView(t)}}h.SlotMaxCount=4},function(t,e,i){"use strict";i.r(e),i.d(e,"Radio",(function(){return s})),i.d(e,"RadioItemRender",(function(){return a}));class s extends Phaser.GameObjects.Container{constructor(t,e){super(t),this.mIsShow=!1,this.mInit=!1,this.mScene=t,this.mConfig=e,this.init()}setRadioData(t){this.clearRadioData(),this.itemList=[];const e=t.length;for(let i=0;i<e;i++){const e=new a(this.mScene,this,this.mConfig.wid+10,20,this.mConfig.resKey,this.mConfig.resArrow),s=t[i];e.itemData={index:i,text:s.text,data:s.node.id},e.x=this.mConfig.wid/2+25,e.y=33*i+23,this.add(e),this.itemList.push(e)}}clearRadioData(){if(this.itemList){const t=this.itemList.length;for(let e=0;e<t;e++){let t=this.itemList[e];t&&(t.destroy(),t=null)}this.itemList.length=0}}get isShow(){return this.mIsShow}set isShow(t){this.mIsShow=t}selectCall(t){this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)}destroy(){if(this.itemList){const t=this.itemList.length;for(let e=0;e<t;e++){const t=this.itemList[e];t&&t.destroy()}this.itemList.length=0,this.itemList=null}this.removeAll(),this.removeAllListeners(),this.parentContainer&&this.parentContainer.remove(this),super.destroy(!0)}init(){const t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())}onLoadCompleteHandler(){this.mInit=!0;const t=this.mConfig.resKey;this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.width+=20,this.mBg.x=this.mConfig.wid/2-2,this.mBg.y=this.mConfig.hei/2,this.addAt(this.mBg,0),this.setSize(this.mConfig.wid,this.mConfig.hei),this.mConfig.completeBack&&this.mConfig.completeBack()}}class a extends Phaser.GameObjects.Container{constructor(t,e,i,s,a,r){super(t),this.mSelectCallUI=e,this.mText=this.scene.make.text({x:-i>>1,y:-s>>1,style:{font:"bold 20px YaHei",fill:"#F7EDED"}},!1),this.mText.style.align="left";this.mSelectBG=t.make.graphics(void 0,!1),this.mSelectBG.fillStyle(16763904,.8),this.mSelectBG.fillRect(-i>>1,-s>>1,i-36,s),this.mSelectBG.visible=!1,this.addAt(this.mSelectBG,0),this.add(this.mText),this.setSize(i,s),this.setInteractive(),this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this),this.on("pointerdown",this.selectHandler,this),this.mArrow=t.make.image(void 0,!1),this.mArrow.setTexture(a,r),this.mArrow.x=-i/2-10,this.mArrow.y=0,this.mArrow.visible=!1,this.add(this.mArrow)}set itemData(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width>>1,this.mText.y=-this.height/2+(this.height-this.mText.height>>1)}get itemData(){return this.mData}destroy(){this.mText.destroy(!0),this.mSelectBG.destroy(!0),this.mArrow.destroy(!0),this.mText=null,this.mData=null,this.mSelectCallUI=null,this.mArrow=null,super.destroy(!0)}setSelected(t){this.mSelectBG.visible=t,this.mArrow.visible=t,this.mSelectCallUI&&this.mSelectCallUI.selectCall(this.itemData)}overHandler(){this.mSelectBG.visible=!0,this.mArrow.visible=!0}outHandler(){this.mSelectBG.visible=!1,this.mArrow.visible=!1}selectHandler(){this.overHandler(),this.mSelectCallUI.selectCall(this.itemData)}}},function(t,e,i){"use strict";i.r(e),i.d(e,"BasicRankPanel",(function(){return o}));var s=i(8),a=i(4),r=i(39),n=i(14);class o extends s.Panel{constructor(t,e){super(t),this.mTexts=[],this.mWorld=e}addItem(t){if(this.setData("data",t),!this.mInitialized)return;this.clearText();const e=t.text;if(!e||e.length<1)return;this.mTitleLabel&&(this.mTitleLabel.setText(e[0].text),this.mTitleLabel.setData("node",e[0].node));const i=[12,60,238];for(let t=1;t<4;t++){const s=this.scene.make.text({x:i[t-1],y:27,text:e[t].text,style:{font:r.a.YAHEI_16_BOLD}},!1);s.setData("node",e[t].node),s.setStroke("#000000",2),this.mContentContainer.add(s),this.mTexts.push(s)}for(let t=4;t<e.length;t++){const s=e[t],a=(t-4)%3,n=27*Math.floor((t-4)/3),o=this.scene.make.text({x:i[a],y:60+n,text:s.text,style:{font:r.a.YAHEI_14_BOLD}},!1);o.setData("node",s.node),o.setStroke("#000000",2),this.mContentContainer.add(o),this.mTexts.push(o)}}update(t){this.addItem(t)}destroy(){this.mBackground&&this.mBackground.destroy();const t=this.mTexts.length;for(let e=0;e<t;e++){let t=this.mTexts[e];t&&(t.destroy(!0),t=null)}this.mTitleLabel&&this.mTitleLabel.destroy(!0),this.mContentContainer&&this.mContentContainer.destroy(!0),this.mContentContainer=null,this.mTexts=[],this.mData=null,this.mBackground=null,this.mTitleLabel=null,this.mWorld=null,super.destroy()}preload(){this.scene.load.image(a.a.getName(),a.a.getPNG()),this.scene.load.image(a.d.getName(),a.d.getPNG()),this.scene.load.atlas("rank_atlas",a.h.getRes("ui/rank/rank_atlas.png"),a.h.getRes("ui/rank/rank_atlas.json")),super.preload()}init(){if(this.mInitialized)return;this.setSize(328,361),this.mBackground=new n.NinePatch(this.scene,0,180,328,361,a.a.getName(),null,a.a.getConfig()),this.mBackground.x=this.mBackground.width>>1,this.mBackground.y=this.mBackground.height>>1,this.add(this.mBackground),this.mContentContainer=this.scene.make.container({},!1),this.add(this.mContentContainer);const t=new n.NinePatch(this.scene,8,20,315,318,a.d.getName(),null,a.d.getConfig());t.x=8+(t.width>>1),t.y=20+(t.height>>1),this.mContentContainer.add(t);const e=this.scene.make.image({x:20,y:-15,key:"rank_atlas",frame:"icon.png"},!1).setOrigin(0,0);this.add(e),this.mTitleLabel=this.scene.make.text({x:54,text:"排行榜",style:{font:r.a.YAHEI_20_BOLD}}).setOrigin(0,.5).setStroke("#000000",2),this.add(this.mTitleLabel);const i=this.getData("data");i&&this.addItem(i)}clearText(){for(const t of this.mTexts)t.destroy();this.mTexts.length=0}}},function(t,e,i){"use strict";i.r(e);class s{static formatChineseString(t,e,i){"string"==typeof e&&(e=parseInt(e,10));const s=Math.floor(i/e);return this.chunk(t,s).join(" ")}static chunk(t,e){const i=[];for(let s=0;s<t.length;s+=e)i.push(t.substr(s,e));return i}static fill(t,e,i){void 0===i&&(i=!0);const s=(t+="").length,a=e.length;return s>=a?t:i?e.substring(0,a-s)+t:t+e.substring(s)}static printf(t,...e){const i=new RegExp("(%([%]|(\\-)?(\\+| )?(0)?(\\d+)?(\\.(\\d)?)?([bcdfosxX])))","g"),s=[],a=[];let r,n=0,o=0,h=0,l=0,c="",d=i.exec(t),m=0;for(;d;)d[9]&&(n+=1),o=l,h=i.lastIndex-d[0].length,a.push(t.substring(o,h)),l=i.lastIndex,s.push({match:d[0],left:!!d[3],sign:d[4]||"",pad:d[5]||" ",min:d[6]||0,precision:d[8],code:d[9]||"%",negative:parseInt(arguments[n],16)<0,argument:String(arguments[n])}),d=i.exec(t);if(a[a.length]=t.substring(l),0===s.length)return t;if(arguments.length-1<n)return null;for(m=0;m<s.length;m++)"%"===(d=s[m]).code?r="%":"b"===d.code?(d.argument=String(Math.abs(parseInt(d.argument,16)).toString(2)),r=this.convert(d,!0)):"c"===d.code?(d.argument=String.fromCharCode(parseInt(String(Math.abs(parseInt(d.argument,16))),16)),r=this.convert(d,!0)):"d"===d.code?(d.argument=String(Math.abs(parseInt(d.argument,16))),r=this.convert(d)):"f"===d.code?(d.argument=String(Math.abs(parseFloat(d.argument)).toFixed(d.precision?d.precision:6)),r=this.convert(d)):"o"===d.code?(d.argument=String(Math.abs(parseInt(d.argument,16)).toString(8)),r=this.convert(d)):"s"===d.code?(d.argument=d.argument.substring(0,d.precision?d.precision:d.argument.length),r=this.convert(d,!0)):"x"===d.code?(d.argument=String(Math.abs(parseInt(d.argument,16)).toString(16)),r=this.convert(d)):"X"===d.code?(d.argument=String(Math.abs(parseInt(d.argument,16)).toString(16)),r=this.convert(d).toUpperCase()):r=d.match,c+=a[m],c+=r;return c+=a[m]}static convert(t,e=!1){t.sign=e?"":t.negative?"-":t.sign;const i=t.min-t.argument.length+1-t.sign.length,s=new Array(i<0?0:i).join(t.pad);return t.left?"0"===t.pad||e?t.sign+t.argument+s.replace(/0/g," "):t.sign+t.argument+s:"0"===t.pad||e?t.sign+s+t.argument:s+t.sign+t.argument}}i.d(e,"ToolTip",(function(){return a}));class a extends Phaser.GameObjects.Container{constructor(t,e,i,s,a){super(t),this.mScene=t,this.resStr=e,this.resJson=i,this.resUrl=s,this.uiScale=a,this.mWidth=0,this.mHeight=0,this.mBaseMidHeight=0,this.preLoad()}setToolTipData(t){if(!this.mText)return;const e=s.formatChineseString(t,this.mText.style.fontSize,this.mWidth-20);this.mText.setText(e),this.refreshTip()}destroy(){this.topImage&&this.topImage.destroy(!0),this.midImage&&this.midImage.destroy(!0),this.botImage&&this.botImage.destroy(!0),this.mText&&this.mText.destroy(!0),this.mWidth=0,this.mHeight=0,this.removeAllListeners(),this.removeAll(),super.destroy(!0)}preLoad(){this.scene.load.atlas(this.resStr,this.resUrl,this.resJson),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.start()}init(){this.topImage=this.scene.make.image(void 0,!1),this.topImage.setOrigin(0,0),this.topImage.setTexture(this.resStr,a.TOP),this.midImage=this.scene.make.image(void 0,!1),this.midImage.setOrigin(0,0),this.midImage.setTexture(this.resStr,a.MID),this.botImage=this.scene.make.image(void 0,!1),this.botImage.setOrigin(0,0),this.botImage.setTexture(this.resStr,a.BOT),this.mText=this.scene.make.text(void 0,!1),this.mText.setFontFamily("YaHei"),this.mText.setFontStyle("bold"),this.mText.setFontSize(14),this.mText.style.align="center",this.mText.lineSpacing=15,this.mWidth=this.topImage.width,this.mBaseMidHeight=this.midImage.height,this.mText.style.fixedWidth=this.mWidth-20,this.mText.style.setWordWrapWidth(this.mWidth-20,!0),this.add(this.topImage),this.add(this.midImage),this.add(this.botImage),this.add(this.mText)}refreshTip(){this.midImage.scaleY=(this.mText.height+20)/this.mBaseMidHeight,this.mHeight=this.topImage.height+this.midImage.height*this.midImage.scaleY+this.botImage.height,this.topImage.y=-this.topImage.height>>1,this.midImage.y=this.topImage.y+this.topImage.height,this.botImage.y=this.midImage.y+this.midImage.height*this.midImage.scaleY,this.mText.x=this.mWidth-this.mText.style.fixedWidth>>1,this.mText.y=this.mHeight-this.mText.height-10>>1,this.setSize(this.mWidth,this.mHeight)}onLoadComplete(){this.init()}}a.TOP="tip_top.png",a.MID="tip_mid.png",a.BOT="tip_bot.png"},,function(t,e,i){"use strict";i.r(e),i.d(e,"DebugLoggerMediator",(function(){return r}));var s=i(12),a=i(59);class r extends s.a{constructor(t,e){super(e),this.mScene=t}isSceneUI(){return!0}resize(){if(this.mView)return this.mView.resize()}isShow(){return void 0!==this.mView&&this.mView.isShow()}getView(){return this.mView}show(t){this.mView&&this.isShow()||(this.mView=new a.DebugLogger(this.mScene,this.world),this.mView.show(t),super.show(t))}hide(){this.mView&&(this.mView.hide(),this.mView=null)}destroy(){this.mScene=null,super.destroy()}}r.NAME="DebugLoggerMediator"},function(t,e,i){"use strict";i.r(e),i.d(e,"DebugLogger",(function(){return o}));var s=i(8),a=i(4),r=i(14),n=i(6);class o extends s.Panel{constructor(t,e){super(t),this.mDelay=0,this.mWorld=e}show(t){this.mInitialized?(this.scaleX=this.scaleY=this.mWorld.uiScale,this.mShowing=!0,this.showDescTxT()):this.preload()}resize(){this.mWorld.getSize();this.showDescTxT(),this.x=(60+(this.width>>1))*this.mWorld.uiScale,this.y=(this.height>>1)*this.mWorld.uiScale,this.scaleX=this.scaleY=this.mWorld.uiScale}update(t){const e=this.mWorld.roomManager.currentRoom.now();this.mDelay-e<3e3&&(this.showDescTxT(),this.mTimeTF.setText("FPS:"+t),this.mDescTF.setText(this.mDescTxt),this.mDelay=e)}destroy(){this.mBackground&&this.mBackground.destroy(),this.mDescTF&&this.mDescTF.destroy(),this.mDescTxt="",this.mBackground=null,this.mDescTF=null,this.mBgWidth=0,this.mBgHeight=0,this.mDelay=0,super.destroy()}preload(){this.mScene&&(this.scene.load.image("logger",a.a.getPNG()),super.preload())}init(){this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this);const t=this.mWorld.getSize();this.mBgWidth=400,this.mBgHeight=t.height>>1,this.mBackground=new r.NinePatch(this.mScene,0,0,this.mBgWidth,this.mBgHeight,"logger",null,a.a.getConfig()),this.add(this.mBackground),this.mTimeTF=this.mScene.make.text({style:{x:0,y:0,fontFamily:"YaHei",fontSize:20,origin:{x:0,y:0},wordWrap:{width:t.width-10,height:20,useAdvancedWrap:!0}}},!1),this.mDescTF=this.mScene.make.text({style:{x:0,y:0,fontFamily:"YaHei",fontSize:20,origin:{x:0,y:0},wordWrap:{width:t.width-10,height:t.height-30,useAdvancedWrap:!0}}},!1),this.mTimeTF.x=-this.mBgWidth/2+5,this.mDescTF.x=-this.mBgWidth/2+5,this.mTimeTF.y=-this.mBgHeight/2+5,this.mDescTF.y=-this.mBgHeight/2+23,this.add(this.mTimeTF),this.add(this.mDescTF),this.setSize(this.mBgWidth,this.mBgHeight),this.resize(),super.init()}showDescTxT(){const t=this.mWorld.getSize().width>this.mWorld.getSize().height?"LANDSCAPE":"PORTRAIT";let e="WEBGL";this.mWorld.game.config.renderType===Phaser.CANVAS?e="CANVAS":this.mWorld.game.config.renderType===Phaser.HEADLESS&&(e="HEADLESS"),this.mDescTxt="rendertype:"+e+"\n width: "+this.mWorld.getSize().width+"\nheight: "+this.mWorld.getSize().height+"\norientation: "+t+"\ndevicePixelRatio: "+window.devicePixelRatio,this.showErrTxt()}showErrTxt(){const t=n.a.getInstance().getErrorList();if(!t)return;let e="";t.forEach(t=>{e+="\n"+t}),this.mDescTxt+=e}}},function(t,e,i){"use strict";i.r(e),i.d(e,"normalizePatchesConfig",(function(){return normalizePatchesConfig}));const normalizePatchesConfig=t=>(t.bottom=t.bottom||t.top,t.left=t.left||t.top,t.right=t.right||t.left,t)},function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicSprite",(function(){return s}));class s extends Phaser.GameObjects.Sprite{constructor(t,e,i){super(t,e,i,void 0),t.sys.updateList.add(this)}load(t,e,i,s,a){this.mLoadCompleteCallbak=s,this.mLoadErrorCallback=a,this.mLoadContext=i,this.mUrl=t+e,this.scene.cache.obj.get(this.mUrl)?this.onLoadComplete():(this.scene.load.atlas(this.mUrl,t,e),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())}destroy(t){this.scene.sys.updateList.remove(this),super.destroy(t)}onLoadComplete(){if(this.mLoadCompleteCallbak){const t=this.mLoadCompleteCallbak;this.mLoadCompleteCallbak=null,t.call(this.mLoadContext),this.mLoadContext=null}this.scene.anims.create({key:this.mUrl,frames:this.scene.anims.generateFrameNames(this.mUrl),repeat:1}),this.play(this.mUrl)}onLoadError(t){if(this.mUrl===t.url&&this.mLoadErrorCallback){const t=this.mLoadErrorCallback;this.mLoadErrorCallback=null,t.call(this.mLoadContext),this.mLoadContext=null}}}},function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicNinepatch",(function(){return a}));var s=i(28);class a{constructor(t,e){this.mScene=t,this.mParent=e}load(t,e,i,s){this.mLoadCompleteCallBack=i,this.mLoadContext=s,this.mConfig=e,this.mUrl=t,this.mScene.cache.obj.get(t)?this.onLoadCompleteHandler():(this.mScene.load.image(this.mUrl,this.mUrl),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())}onLoadCompleteHandler(){this.mImage=new s.a(this.mScene,this.mConfig),this.mLoadCompleteCallBack&&(this.mLoadCompleteCallBack.call(this.mLoadContext,this.mImage),this.mLoadCompleteCallBack=null,this.mLoadContext=null)}get image(){return this.mImage}}},,,,,,,,function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));class s{}s.MainUIMediator="MainUIMediator",s.BagMediator="BagMediator",s.ChatMediator="ChatMediator",s.NOTICE="Notice",s.DIALOGO="DIALOGO",s.ControlF="ControlF",s.Storage="Storage",s.UserInfo="UserInfo",s.UserMenu="UserMenu",s.MessageBox="MessageBox",s.ComponentRank="ComponentRank",s.Rank="Rank",s.VoteResult="VoteResult",s.Shop="Shop"},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatPanelPC",(function(){return m}));var s=i(160),a=i(102),r=i(30),n=i(17),o=i(4),h=i(75),l=i(20),c=i(14),d=i(52);class m extends d.BaseChatPanel{constructor(t,e){super(t),this.mWorld=e,this.mPreHei=0,this.mPreWid=0}appendChat(t){this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom())}setLocation(t,e){const i=this.mWorld.getSize();this.x=0,this.y=i.height-this.mPreHei,this.mTextArea&&this.mTextArea.childrenMap.child.textMask.setPosition(void 0,i.height-this.height+30).resize()}destroy(){this.mTextArea&&this.mTextArea.destroy(),this.mInputText&&this.mInputText.destroy(),this.mVoiceBtn&&this.mVoiceBtn.destroy(),this.mMicBtn&&this.mMicBtn.destroy(),this.mTextArea=null,this.mInputText=null,this.mVoiceBtn=null,this.mMicBtn=null,this.mSendKey=null,super.destroy()}preload(){this.mScene&&(this.mScene.load.image("button",o.h.getRes("ui/common/button.png")),this.mScene.load.image("thumbTexture",o.h.getRes("ui/common/common_thumb_texture.png")),this.mScene.load.image("track",o.h.getRes("ui/common/common_track.png")),this.mScene.load.image("chat_input_bg",o.h.getRes("ui/chat/input_bg.png")),this.mScene.load.image(o.d.getName(),o.d.getPNG()),this.mScene.load.atlas("chat_atlas",o.h.getRes("ui/chat/chat_atlas.png"),o.h.getRes("ui/chat/chat_atlas.json")),super.preload())}init(){if(this.mInitialized)return;super.init();const t=this.mWorld.getSize();this.mWidth=464,this.mHeight=281,this.mPreHei=t.height,this.mPreWid=t.width,this.setSize(this.mWidth,this.mHeight);const e=new c.NinePatch(this.scene,0,0,this.width,this.height,o.d.getName(),null,o.d.getConfig());e.x=4*this.mWorld.uiScale+e.width*e.originX,e.y=t.height-260*this.mWorld.uiScale+e.height*e.originY,this.add(e),this.outPut=this.mScene.make.container(void 0,!1),this.add(this.outPut);const i=new s.a(this.mScene,0,0,2,2,3,8421504,.5);this.outPut.add(i);const d=new n.NinePatchButton(this.mScene,0,0,4,7,"track","",{left:0,top:2,right:0,bottom:2});d.x=100*this.mWorld.uiScale,d.y=10*this.mWorld.uiScale,this.outPut.add(d);const m=new l.a(this.mScene,0,0,"",{fontSize:"14px",wrap:{mode:"char",width:400*this.mWorld.uiScale}});this.outPut.add(m);const u=new n.NinePatchButton(this.mScene,0,0,20,35,"button","",{left:4,top:4,right:4,bottom:4});this.outPut.add(u),this.mTextArea=new a.a(this.mScene,{x:230*this.mWorld.uiScale,y:t.height-150*this.mWorld.uiScale,textWidth:430,textHeight:200,text:m,slider:{track:d,thumb:u}}).layout(),this.outPut.add(this.mTextArea);this.mTextArea.getElement("child");const p=this.mScene.make.container(void 0,!1);this.add(p);const g=new c.NinePatch(this.scene,0,0,370,32,"chat_input_bg",null,{left:4,top:4,right:4,bottom:4});g.x=8*this.mWorld.uiScale+g.width*g.originX,g.y=t.height-46*this.mWorld.uiScale+g.height*g.originY,p.add(g),this.mInputText=new r.a(this.mScene,0,0,10,10,{type:"input",fontSize:"14px",color:"#808080"}).resize(360,20).setOrigin(0,0).setStyle({font:"bold 16px YaHei"}).on("focus",this.onFocusHandler,this).on("blur",this.onBlurHandler,this),this.mInputText.x=12*this.mWorld.uiScale,this.mInputText.y=t.height-40*this.mWorld.uiScale,p.add(this.mInputText);const f=new n.NinePatchButton(this.mScene,0,0,60,30,"button","发送",{left:4,top:4,right:4,bottom:4});f.x=this.width-f.width+10*this.mWorld.uiScale,f.y=t.height-f.height,f.on("pointerdown",this.onSendMsgHandler,this),this.add(f),this.mSendKey=this.mScene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.mVoiceBtn=new h.CheckButton(this.mScene,0,0,"chat_atlas","voice_normal.png","voice_selected.png"),this.mVoiceBtn.x=this.width-60*this.mWorld.uiScale,this.mVoiceBtn.y=t.height-this.height,this.add(this.mVoiceBtn),this.mMicBtn=new h.CheckButton(this.mScene,0,0,"chat_atlas","mic_normal.png","mic_selected.png"),this.mMicBtn.x=this.width-20*this.mWorld.uiScale,this.mMicBtn.y=t.height-this.height,this.add(this.mMicBtn),this.mVoiceBtn.on("selected",this.onSelectedVoiceHandler,this),this.mMicBtn.on("selected",this.onSelectedMicHandler,this),this.setLocation()}onSelectedVoiceHandler(t){!1===t&&(this.mMicBtn.selected=!1),this.emit("selectedVoice",t)}onSelectedMicHandler(t){!1!==this.mVoiceBtn.selected?this.emit("selectedMic",t):this.mMicBtn.selected=!1}onSendMsgHandler(){const t=this.mInputText.text;t.length>0&&(this.emit("sendChat",t),this.mInputText.setText(""),this.mInputText.setBlur())}onFocusHandler(){this.mWorld&&this.mWorld.inputManager&&(this.mWorld.inputManager.enable=!1,this.mSendKey&&this.mSendKey.on("down",this.onDownEnter,this))}onBlurHandler(){this.mWorld&&this.mWorld.inputManager&&(this.mWorld.inputManager.enable=!0,this.mSendKey&&this.mSendKey.off("down",this.onDownEnter,this))}onDownEnter(){this.onSendMsgHandler()}get outChannel(){return 0}}},function(t,e,i){"use strict";e.a=function(t){return t.hasOwnProperty("rexSizer")||(t.rexSizer={}),t.rexSizer}},function(t,e,i){"use strict";const s=Phaser.Display.Align;e.a={center:s.CENTER,left:s.LEFT_CENTER,right:s.RIGHT_CENTER,top:s.TOP_CENTER,bottom:s.BOTTOM_CENTER,"left-top":s.TOP_LEFT,"left-center":s.LEFT_CENTER,"left-bottom":s.LEFT_BOTTOM,"center-top":s.TOP_CENTER,"center-center":s.CENTER,"center-bottom":s.BOTTOM_CENTER,"right-top":s.TOP_RIGHT,"right-center":s.RIGHT_CENTER,"right-bottom":s.RIGHT_BOTTOM}},function(t,e){t.exports=function(t,e,i){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1!==e.indexOf(".")){for(var s=e.split("."),a=t,r=i,n=0;n<s.length;n++){if(!a.hasOwnProperty(s[n])){r=i;break}r=a[s[n]],a=a[s[n]]}return r}return i}return i}},function(t,e,i){"use strict";i.r(e),i.d(e,"CheckButton",(function(){return s}));class s extends Phaser.GameObjects.Image{constructor(t,e,i,s,a,r){super(t,e,i,s,a),this.mSelected=!1,this.mNormalFrame=a,this.mSelectFrame=r,this.setInteractive(new Phaser.Geom.Rectangle(0,0,this.width,this.height),Phaser.Geom.Rectangle.Contains),this.on("pointerup",this.onSelected,this)}onSelected(){this.selected=!this.mSelected,this.emit("selected",this.mSelected)}set selected(t){if(this.mSelected!==t){this.mSelected=t;const e=t?this.mSelectFrame:this.mNormalFrame;this.setFrame(e)}}get selected(){return this.mSelected}}},function(t,e,i){"use strict";e.a=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatPanelMobile",(function(){return d}));var s=i(52),a=i(102),r=i(30),n=i(4),o=i(14),h=i(20),l=i(17),c=i(44);class d extends s.BaseChatPanel{constructor(t,e){super(t),this.mWorld=e,this.setTween(!1)}appendChat(t){this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom())}show(t){super.show(t),this.tweenView(!0)}setLocation(t,e){if(!this.mShowing)return;this.mBorder&&(this.mBorder.destroy(!0),this.mBorder=null);const i=this.mWorld.getSize();switch(this.mWorld.game.scale.orientation){case Phaser.Scale.Orientation.LANDSCAPE:this.mWidth=i.width>>1,this.mHeight=i.height,this.setSize(this.mWidth,this.mHeight),this.x=0,this.y=0,this.mTextArea.setMinSize(this.mWidth,i.height),this.clickContainer.x=this.mWidth/this.mWorld.uiScale+this.clickContainer.width/2,this.clickContainer.y=this.mHeight/(2*this.mWorld.uiScale),this.clickContainer.rotation=.5*Math.PI,this.arrow.rotation=.5*Math.PI;break;case Phaser.Scale.Orientation.PORTRAIT:this.mWidth=i.width,this.mHeight=i.height-20*this.mWorld.uiScale>>1,this.setSize(this.mWidth,this.mHeight),this.x=0,this.y=this.mHeight+20*this.mWorld.uiScale,this.mTextArea.setMinSize(this.mWidth,i.height),this.clickContainer.x=i.width/(2*this.mWorld.uiScale),this.clickContainer.y=-this.clickContainer.height>>1,this.clickContainer.rotation=Math.PI,this.arrow.rotation=1.5*Math.PI}this.mBorder=new o.NinePatch(this.scene,0,0,this.mWidth/this.mWorld.uiScale,this.mHeight/this.mWorld.uiScale,n.d.getName(),null,n.d.getConfig()),this.mBorder.x=this.mBorder.width/2,this.mBorder.y=this.mBorder.height/2,this.mTextArea.x=this.mBorder.width+100*this.mWorld.uiScale>>1,this.mTextArea.childrenMap.child.textMask.setPosition(-10,i.height-this.height).resize(),this.mInputBg.x=this.mInputBg.width>>1,this.mInputBg.y=this.mBorder.height-this.mInputBg.height/2,this.mSendBtn.x=this.mBorder.width-this.mSendBtn.width,this.mSendBtn.y=this.mInputBg.y,this.mInputText.x=2,this.mInputText.y=this.mInputBg.y-12,this.addAt(this.mBorder,0),this.scaleX=this.scaleY=this.mWorld.uiScale}destroy(){this.mSendBtn&&this.mSendBtn.destroy(!0),this.mInputBg&&this.mInputBg.destroy(!0),this.clickContainer&&this.clickContainer.destroy(!0),this.arrow&&this.arrow.destroy(!0),this.mBorder&&this.mBorder.destroy(!0),this.mTextArea&&this.mTextArea.destroy(),this.mInputText&&this.mInputText.destroy(),this.mTextArea=null,this.mInputText=null,this.mSendBtn=null,this.clickContainer=null,this.arrow=null,this.mBorder=null,this.mInputBg=null,super.destroy()}tweenView(t){const e=!0===t?1:0;this.mScene.tweens.add({targets:this,duration:200,ease:"Linear",props:{alpha:{value:e}},onComplete:(e,i,s)=>{t||this.hide()}})}preload(){this.mScene&&(this.mScene.load.image("button",n.h.getRes("ui/common/button.png")),this.mScene.load.image("thumbTexture",n.h.getRes("ui/common/common_thumb_texture.png")),this.mScene.load.image("track",n.h.getRes("ui/common/common_track.png")),this.mScene.load.image("channelSelect",n.h.getRes("ui/common/common_channelSelect.png")),this.mScene.load.image("channelUnSelect",n.h.getRes("ui/common/common_channelUnSelect.png")),this.mScene.load.image("arrow",n.h.getRes("ui/common/common_arrow.png")),this.mScene.load.image("chat_input_bg",n.h.getRes("ui/chat/input_bg.png")),this.mScene.load.image(n.d.getName(),n.d.getPNG()),this.scene.load.atlas(n.i.getName(),n.i.getPNG(),n.i.getJSON()),this.mScene.load.atlas("chat_atlas",n.h.getRes("ui/chat/chat_atlas.png"),n.h.getRes("ui/chat/chat_atlas.json")),super.preload())}init(){if(this.mInitialized)return;super.init();const t=this.mWorld.getSize();this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE?(this.mWidth=t.width>>1,this.mHeight=t.height):(this.mWidth=t.width,this.mHeight=t.height>>1),this.setSize(this.mWidth,this.mHeight);const e=new h.a(this.mScene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:this.mWidth>>1}}),i=new l.NinePatchButton(this.mScene,0,0,4,7,"track","",{left:0,top:2,right:0,bottom:2});i.x=this.mWidth/2,i.y=8*this.mWorld.uiScale;const s=new l.NinePatchButton(this.mScene,0,0,20,35,"button","",{left:4,top:4,right:4,bottom:4});this.add(e),this.add(i),this.add(s),this.mTextArea=new a.a(this.mScene,{x:this.mWidth+20*this.mWorld.uiScale>>1,y:this.mHeight+178*this.mWorld.uiScale>>1,textWidth:this.mWidth,textHeight:this.mHeight+150*this.mWorld.uiScale,text:e,slider:{track:i,thumb:s}}).layout(),this.add(this.mTextArea),this.mInputBg=new o.NinePatch(this.scene,0,0,340,30,"chat_input_bg",null,{left:4,top:4,right:4,bottom:4}),this.add(this.mInputBg),this.mInputText=new r.a(this.mScene,0,0,10,10,{type:"input",fontSize:"20px",color:"#808080"}).resize(328,26).setOrigin(0,0).setStyle({font:"bold 20px YaHei"}).on("focus",this.onFocusHandler,this).on("blur",this.onBlurHandler,this),this.add(this.mInputText),this.mSendBtn=new l.NinePatchButton(this.mScene,0,0,60,30,n.i.getName(),"发送",n.i.getConfig()),this.mSendBtn.on("pointerdown",this.onSendMsgHandler,this),this.add(this.mSendBtn),this.clickContainer=this.mScene.make.container(void 0,!1);const c=new o.NinePatch(this.scene,0,0,53/this.mWorld.uiScale,30/this.mWorld.uiScale,n.d.getName(),null,n.d.getConfig());this.arrow=this.mScene.make.image(void 0,!1),this.arrow.setTexture("arrow"),this.clickContainer.setSize(c.width+4,c.height+10),this.clickContainer.add(c),this.clickContainer.add(this.arrow),this.clickContainer.setInteractive(),this.clickContainer.on("pointerdown",this.clickHandler,this),this.add(this.clickContainer),this.setLocation()}clickHandler(){this.mScene.tweens.add({targets:this.clickContainer,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.clickContainer.scaleX=this.clickContainer.scaleY=1,this.tweenView(!1),this.mWorld.uiManager.getMediator(c.MainUIMediator.NAME).tweenView(!0)}onSendMsgHandler(){const t=this.mInputText.text;t.length>0&&(this.emit("sendChat",t),this.mInputText.setText(""),this.mInputText.setBlur())}onFocusHandler(){this.mWorld&&this.mWorld.inputManager&&(this.mWorld.inputManager.enable=!1)}onBlurHandler(){this.mWorld&&this.mWorld.inputManager&&(this.mWorld.inputManager.enable=!0)}}},function(t,e,i){"use strict";i.r(e),i.d(e,"TopBtnGroup",(function(){return n}));var s=i(8),a=i(4),r=i(45);class n extends s.Panel{constructor(t,e){super(t),this.mBtnX=0,this.mExpandBoo=!1,this.mOrientation=Phaser.Scale.Orientation.LANDSCAPE,this.mWorld=e}show(t){this.scaleX=this.scaleY=this.mWorld.uiScale,super.show(t)}resize(){const t=this.mWorld.getSize();this.x=t.width-50*this.mWorld.uiScale,this.y=this.height/2+10*this.mWorld.uiScale,this.scaleX=this.scaleY=this.mWorld.uiScale}destroy(){this.mBtnX=0,this.mTurnBtn&&this.mTurnBtn.destroy(),this.mBtnList&&this.mBtnList.forEach(t=>{t&&(t.destroy(),t=null)}),this.mResKey="",this.mBtnList=null,this.mTurnBtn=null,super.destroy()}tweenView(t){const e=this.height/2+10*this.mWorld.uiScale,i=!0===t?e:e-50,s=!0===t?1:0;this.mScene.tweens.add({targets:this,duration:200,ease:"Linear",props:{y:{value:i},alpha:{value:s}}})}preload(){this.mScene&&(this.mResKey="baseView",this.mScene.load.atlas(this.mResKey,a.h.getRes("ui/baseView/mainui_mobile.png"),a.h.getRes("ui/baseView/mainui_mobile.json")),super.preload())}init(){this.mWorld.getSize();let t=0;this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mBtnList=[],this.mBtnX=0;this.mTurnBtn=new r.IconBtn(this.mScene,this.mWorld,this.mResKey,["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],"btnGroup_top_expand.png",1),this.mTurnBtn.x=this.mBtnX,this.add(this.mTurnBtn),this.mBtnX+=-this.mTurnBtn.width>>1,this.mTurnBtn.setClick(()=>{this.mWorld.closeGame()}),t+=this.mTurnBtn.height/2+20,this.setSize(this.mTurnBtn.width,t),this.resize(),super.init()}turnHandler(){if(!this.mBtnList&&this.mBtnList.length<1)return;const t=this.mBtnList.length;for(let e=0;e<t;e++){const i=this.mBtnList[e],s=this.mExpandBoo?i.getPos().x:this.mTurnBtn.width>>1,a=this.mExpandBoo?1:0,r=this.mExpandBoo?"Sine.easeIn":"Sine.easeOut";this.mScene.tweens.add({targets:i,duration:1e3,ease:r,props:{x:{value:s},alpha:{value:a}},onComplete:(i,s,a)=>{e===t-1&&(this.mExpandBoo=!this.mExpandBoo)},onCompleteParams:[this]})}}btnDataRefresh(){this.mBtnList&&this.mBtnList.forEach(t=>{t&&(this.mBtnX+=-t.width-8,t.setPos(this.mBtnX,0),t.x=this.mBtnX,t.setBtnData({}),t.setClick(()=>{}),this.add(t))}),this.resize()}}},function(t,e,i){"use strict";i.r(e),i.d(e,"RightBtnGroup",(function(){return c}));var s=i(8),a=i(45),r=i(27),n=i(4),o=i(3),h=i(53),l=i(7);class c extends s.Panel{constructor(t,e){super(t),this.mBtnY=0,this.mWid=0,this.mHei=0,this.mWorld=e}show(t){super.show(t),this.scaleX=this.scaleY=this.mWorld.uiScale}resize(){const t=this.mWorld.getSize();switch(this.mWorld.game.scale.orientation){case Phaser.Scale.Orientation.LANDSCAPE:this.y=t.height-this.height/2-100*this.mWorld.uiScale,this.x=t.width-70*this.mWorld.uiScale;break;case Phaser.Scale.Orientation.PORTRAIT:this.y=t.height/2+100*this.mWorld.uiScale,this.x=t.width-this.width/2-50*this.mWorld.uiScale}this.refreshSlot(),this.scaleX=this.scaleY=this.mWorld.uiScale}hide(){super.hide(),this.destroy()}destroy(){this.mBtnY=0,this.mWid=0,this.mHei=0,this.mBagSlotList&&this.mBagSlotList.forEach(t=>{t&&(t.destroy(),t=null)}),this.mResKey="",this.mBagSlotList=null,super.destroy()}tweenView(t){const e=this.mWorld.getSize();let i;switch(this.mWorld.game.scale.orientation){case Phaser.Scale.Orientation.LANDSCAPE:i=e.width-70*this.mWorld.uiScale;break;case Phaser.Scale.Orientation.PORTRAIT:i=e.width-this.width/2-50*this.mWorld.uiScale}const s=!0===t?i:i+50,a=!0===t?1:0;this.mScene.tweens.add({targets:this,duration:200,ease:"Linear",props:{x:{value:s},alpha:{value:a}}})}preload(){this.mResKey="baseView",this.mScene.load.atlas(this.mResKey,n.h.getRes("ui/baseView/mainui_mobile.png"),n.h.getRes("ui/baseView/mainui_mobile.json")),super.preload()}init(){this.mWorld.getSize();this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mBtnY=0,this.handBtn=new a.IconBtn(this.mScene,this.mWorld,this.mResKey,["btnGroup_bg.png"],"btnGroup_hand.png",1),this.handBtn.x=0,this.handBtn.y=this.mBtnY+this.handBtn.height/2,this.handBtn.setClick(()=>{const t=new l.PBpacket(o.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN);t.content.keyCodes=[70],this.mWorld.connection.send(t)}),this.add(this.handBtn),this.mBagSlotList=[],this.initBagSlotData(),super.init()}refreshSlot(){if(this.mBagSlotList&&this.mBagSlotList.length>1){const t=this.mBagSlotList.length;let e=0,i=0;const s=110,a=56,r=38;for(let n=0;n<t;n++){if(this.mWorld.game.scale.orientation===Phaser.Scale.Orientation.LANDSCAPE){const o=r*(n+2)/-180*Math.PI;e=s*Math.cos(o),i=this.handBtn.y+s*Math.sin(o),n===t-1&&(this.mWid=s+this.handBtn.width+30+a/2,this.mHei=s+this.handBtn.height+30+a/2)}else e=0,i=-a*(n+1)-20*n,n===t-1&&(this.mWid=this.handBtn.width,this.mHei=a*(t-1)+5*(t-2)+this.handBtn.height+5);const o=this.mBagSlotList[n];o.toolTipCon.x=e,o.toolTipCon.y=i}}}initBagSlotData(){const t=this.mWorld.roomManager.currentRoom.getHero().model;if(t.package&&t.package.items){const e=t.package.items,i=e.length>h.MainUIMobile.SlotMaxCount?h.MainUIMobile.SlotMaxCount:e.length,s=0,a=0;for(let t=0;t<i;t++){const i=new r.ItemSlot(this.mScene,this.mWorld,this,s,a,this.mResKey,n.h.getRes("ui/baseView/mainui_mobile.png"),n.h.getRes("ui/baseView/mainui_mobile.json"),"btnGroup_bg.png");i.createUI(),i.dataChange(e[t]),i.getBg().scaleX=i.getBg().scaleY=.8,i.getIcon().scaleX=i.getIcon().scaleY=1.2,this.mBagSlotList.push(i),this.add(i.toolTipCon)}}this.setSize(this.mWid,this.mHei),this.resize()}}},function(t,e,i){"use strict";i.r(e),i.d(e,"BottomBtnGroup",(function(){return l}));var s=i(8),a=i(4),r=i(45),n=i(70),o=i(50),h=i(44);class l extends s.Panel{constructor(t,e){super(t),this.mExpandBoo=!1,this.mWorld=e}show(t){this.scaleX=this.scaleY=this.mWorld.uiScale,super.show(t)}resize(){const t=this.mWorld.getSize();switch(this.mWorld.game.scale.orientation){case Phaser.Scale.Orientation.LANDSCAPE:this.x=t.width>>1;break;case Phaser.Scale.Orientation.PORTRAIT:this.x=t.width-(this.width/2+40)*this.mWorld.uiScale}this.y=t.height-120*this.mWorld.uiScale,this.scaleX=this.scaleY=this.mWorld.uiScale,this.mChatText.setStyle({fontSize:Math.floor(30*this.mWorld.uiScale)})}tweenView(t){const e=this.mWorld.getSize().height-120*this.mWorld.uiScale,i=!0===t?e:e+50,s=!0===t?1:0;this.mScene.tweens.add({targets:this,duration:200,ease:"Linear",props:{y:{value:i},alpha:{value:s}}})}preload(){this.mScene&&(this.mResKey="baseView",this.mScene.load.atlas(this.mResKey,a.h.getRes("ui/baseView/mainui_mobile.png"),a.h.getRes("ui/baseView/mainui_mobile.json")),super.preload())}init(){this.mBtnList=[];this.mWorld.getSize();let t=0,e=0;this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this);this.mChatContainer=this.mScene.make.container(void 0,!1),this.mChatBg=this.mScene.make.image(void 0,!1),this.mChatBg.setTexture(this.mResKey,"btnGroup_chatBg.png"),this.mChatContainer.addAt(this.mChatBg,0),this.mChatText=this.mScene.make.text({width:430,height:230,style:{font:"bold YaHei",fontSize:Math.floor(30*this.mWorld.uiScale),wordWrap:{width:430,useAdvancedWrap:!0}}},!1),this.mChatText.setText("测试测试测试测试测试测试测试测试测试123123哈哈哈哈哈哈"),this.mChatContainer.addAt(this.mChatText,1),this.mChatContainer.setSize(430,230),this.mChatText.x=-this.mChatContainer.width>>1,this.mChatText.y=-this.mChatContainer.height>>1,this.mChatContainer.setInteractive(new Phaser.Geom.Rectangle(0,0,430,230),Phaser.Geom.Rectangle.Contains),this.add(this.mChatContainer),t+=this.mChatContainer.width,e+=this.mChatContainer.height,this.mTurnBtn=new r.IconBtn(this.mScene,this.mWorld,this.mResKey,["btnGroup_white_normal.png","btnGroup_white_light.png","btnGroup_white_select.png"],"btnGroup_bottom_expand.png",1),this.mTurnBtn.x=30+(t>>1),this.mTurnBtn.y=e-this.mTurnBtn.height>>1,this.mTurnBtn.setPos(this.mTurnBtn.x,this.mTurnBtn.y),this.add(this.mTurnBtn),this.mBagBtn=new r.IconBtn(this.mScene,this.mWorld,this.mResKey,["btnGroup_yellow_normal.png","btnGroup_yellow_light.png","btnGroup_yellow_select.png"],"btnGroup_bag_icon.png",1),this.mBagBtn.x=this.mTurnBtn.x,this.mBagBtn.y=this.mTurnBtn.y-this.mTurnBtn.height/2-this.mBagBtn.height/2-10,this.mBagBtn.setPos(this.mBagBtn.x,this.mBagBtn.y),t+=this.mBagBtn.width+30,this.add(this.mBagBtn),this.setSize(t,e),this.mBtnList.push(this.mBagBtn),this.mTurnBtn.setClick(()=>{this.turnHandler()}),this.mBagBtn.setClick(()=>{this.bagHandler()}),this.resize(),this.mChatContainer.on("pointerdown",this.chatHandler,this),super.init()}turnHandler(){const t=this.mExpandBoo?"Sine.easeIn":"Sine.easeOut";if(this.mChatContainer&&this.mChatContainer.parentContainer){const e=this.mExpandBoo?1:0,i=this.mExpandBoo?1:0;this.mScene.tweens.add({targets:this.mChatContainer,duration:300,ease:t,props:{scaleX:{value:e},scaleY:{value:i}}})}if(!this.mBtnList||this.mBtnList.length<1)return void(this.mExpandBoo=!this.mExpandBoo);const e=this.mBtnList.length;for(let i=0;i<e;i++){const s=this.mBtnList[i],a=(Math.PI,this.mExpandBoo?s.getPos().x:this.mChatContainer.width/2-Math.abs(s.getPos().y)-20),r=this.mExpandBoo?s.getPos().y:this.mTurnBtn.y;this.mScene.tweens.add({targets:s,duration:300,ease:t,props:{x:{value:a},y:{value:r}},onComplete:(t,s,a)=>{i===e-1&&(this.mExpandBoo=!this.mExpandBoo)},onCompleteParams:[this]})}}chatHandler(){let t=this.mWorld.uiManager.getMediator(o.ChatMediator.NAME);void 0===t&&(t=new o.ChatMediator(this.mWorld,this.mScene),this.mWorld.uiManager.setMediator(o.ChatMediator.NAME,t)),t.isShow()||t.show();const e=this.mWorld.uiManager.getMediator(h.MainUIMediator.NAME);e&&e.tweenView(!1)}bagHandler(){this.mWorld.uiManager.getMediator(n.a.BagMediator).show()}}},function(t,e,i){"use strict";i.r(e),i.d(e,"LeftBtnGroup",(function(){return n}));var s=i(8),a=i(4),r=i(82);class n extends s.Panel{constructor(t,e){super(t),this.mCollapse=!1,this.mWorld=e}show(t){this.scaleX=this.scaleY=this.mWorld.uiScale,super.show(t)}resize(){this.x=void 0!==this.mExpandBtn?this.mExpandBtn.width>>1:10*this.mWorld.uiScale,this.y=void 0!==this.mExpandBtn?this.mExpandBtn.height>>1:10*this.mWorld.uiScale,this.scaleX=this.scaleY=this.mWorld.uiScale}destroy(){this.mExpandBtn&&this.mExpandBtn.destroy(),this.mResKey="",this.mExpandBtn=null,this.mCollapse=!1,super.destroy()}tweenView(t){const e=void 0!==this.mExpandBtn?this.mExpandBtn.width>>1:10*this.mWorld.uiScale,i=!0===t?e:e-50,s=!0===t?1:0;this.mScene.tweens.add({targets:this,duration:200,ease:"Linear",props:{x:{value:i},alpha:{value:s}}})}preload(){this.mScene&&(this.mResKey="baseView",this.mScene.load.atlas(this.mResKey,a.h.getRes("ui/baseView/mainui_mobile.png"),a.h.getRes("ui/baseView/mainui_mobile.json")),super.preload())}init(){this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mExpandBtn=new r.IconSelectBtn(this.mScene,this.mWorld,this.mResKey,["btnGroup_expand.png","btnGroup_collapse.png"],1),this.add(this.mExpandBtn),this.mExpandBtn.setClick(()=>{this.mCollapse?this.mWorld.stopFullscreen():this.mWorld.startFullscreen(),this.mExpandBtn.setBgRes(Number(!this.mCollapse)),this.mCollapse=!this.mCollapse}),this.resize(),super.init()}}},function(t,e,i){"use strict";i.r(e),i.d(e,"IconSelectBtn",(function(){return a}));var s=i(11);class a extends Phaser.GameObjects.Container{constructor(t,e,i,s,a=28/43){super(t),this.mScene=t,this.mWorld=e,this.mBtnBg=t.make.image(void 0,!1),this.mBgTexture=s,this.mBgResKey=i,this.mBtnBg.setTexture(i,s[0]),this.mBtnBg.scaleX=this.mBtnBg.scaleY=a,this.addAt(this.mBtnBg,0),this.setSize(this.mBtnBg.width,this.mBtnBg.height),this.setInteractive(),this.on("pointerup",this.upHandler,this),this.on("pointerdown",this.downHandler,this),this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this)}setPos(t,e){this.mBasePos||(this.mBasePos=new s.a),this.mBasePos.x=t,this.mBasePos.y=e}getPos(){return this.mBasePos}setBtnData(t){this.mBtnData=t}getBtnData(){return this.mBtnData}setClick(t){this.monClick=t}setBgRes(t){this.mBtnBg.setTexture(this.mBgResKey,this.mBgTexture[t]||0)}destroy(){this.mBtnBg&&this.mBtnBg.destroy(!0),this.mBtnIcon&&this.mBtnIcon.destroy(!0),this.monClick=null,this.mBtnBg=null,this.mBtnIcon=null,this.mBtnData=null,this.mScene=null,super.destroy()}overHandler(t){}outHandler(t){}upHandler(){this.monClick&&this.monClick()}downHandler(){this.scaleHandler()}scaleHandler(){this.mScene.tweens.add({targets:this,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.scaleX=this.scaleY=1}}},function(t,e,i){"use strict";i.r(e),i.d(e,"MainUIPC",(function(){return h}));var s=i(27),a=i(4),r=i(8),n=i(54),o=i(70);class h extends r.Panel{constructor(t,e,i,s){super(t),this.mWid=0,this.mHei=0,this.mScene=t,this.mWorld=e,this.x=i,this.y=s,e.uiManager.getUILayerManager().addToToolTipsLayer(this),this.bagSlotList=[]}isShow(){return this.mShowing}show(t){this.mShowing||super.show(t)}resize(){const t=this.mWorld.getSize();this.x=(t.width-this.mWid)/2,this.y=t.height-50}destroy(){this.bagBtn&&(this.bagBtn.destroy(!0),this.bagBtn=null),this.mBagBg&&(this.mBagBg.destroy(!0),this.mBagBg=null),this.bagSlotList&&(this.bagSlotList.forEach(t=>{t&&t.destroy()}),this.bagSlotList.length=0,this.bagSlotList=null),this.mSubScriptSprite&&(this.mSubScriptSprite.destroy(!0),this.mSubScriptSprite=null),this.mBagSelect&&(this.mBagSelect.destroy(!0),this.mBagSelect=null),this.mBagBtnCon&&(this.mBagBtnCon.destroy(!0),this.mBagBtnCon=null),this.mShowing=!1,this.mWid=0,this.mHei=0,this.baseBagBgWid=0,this.mResStr=null,this.mResPng=null,this.mResJson=null,this.mScene=null,this.mWorld=null,super.destroy()}setDataList(t){const e=[],i=t.length>h.SlotMaxCount?h.SlotMaxCount:t.length,a=["0","b","c"];let r,n=this.baseBagBgWid+5;for(let o=0;o<i;o++){r=o>=9?"bag_SubScript"+a[o%9]:"bag_SubScript"+(o+1);let i=this.bagSlotList[o];i||((i=new s.ItemSlot(this.mScene,this.mWorld,this,0,0,this.mResStr,this.mResPng,this.mResJson,"bag_Slot","",r)).createUI(),this.bagSlotList.push(i)),e.push(i.toolTipCon),i.dataChange(t[o]),n+=61}this.mWid!==n&&(this.mWid=n,this.buttons&&(this.buttons.destroy(!0),this.buttons=null),this.buttons=this.mScene.rexUI.add.buttons({x:(n+this.mBagBg.width)/2,y:0,width:56,height:56,orientation:0,buttons:e,groupName:"bagBtn",align:"center",click:{mode:"pointerup",clickInterval:100},space:5,name:"bag"}),this.buttons.layout(),this.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mWid,this.mHei),Phaser.Geom.Rectangle.Contains),this.resize())}preload(){this.mScene&&(this.mResStr="bag",this.mResPng="ui/bag/bag.png",this.mResJson="ui/bag/bag.json",this.mScene.load.atlas(this.mResStr,a.h.getRes(this.mResPng),a.h.getRes(this.mResJson)),super.preload())}init(){this.mWid=0,this.mHei=65,this.mBagBtnCon=this.mScene.add.container(0,0),this.mBagBg=this.mScene.add.sprite(0,0,this.mResStr,"bag_BtnBg"),this.baseBagBgWid=this.mBagBg.width,this.mWid+=this.mBagBg.width+5,this.bagBtn=this.mScene.add.sprite(this.mBagBg.x,this.mBagBg.y,this.mResStr,"bag_Btn"),this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,"bag_SubScripta"),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.mBagBg.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.mBagBg.height>>1,this.mBagBtnCon.addAt(this.mBagBg,0),this.mBagBtnCon.addAt(this.bagBtn,1),this.mBagBtnCon.setSize(56,56),this.mBagBtnCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBagBg.width,this.mBagBg.height),Phaser.Geom.Rectangle.Contains),this.add(this.mBagBtnCon),this.bagBtn.setInteractive(),this.bagBtn.on("pointerdown",this.bagHandler,this),this.bagBtn.on("pointerover",this.bagBtnOver,this),this.bagBtn.on("pointerout",this.bagBtnOut,this);const t=this.mWorld.roomManager.currentRoom.getHero().model;t.package&&t.package.items&&this.setDataList(t.package.items),super.init()}bagHandler(){this.mWorld.uiManager.getMediator(o.a.BagMediator).show()}tmpLoad(){this.radio?this.radio.isShow||this.radioComplete():this.radio=new n.Radio(this.mScene,{wid:328,hei:142,resKey:"juqingRadio",resPng:"./resources/ui/juqing/juqing.png",resJson:"./resources/ui/juqing/juqing.json",resBg:"radio_bg.png",resArrow:"radio_arrow.png",fontStyle:{size:20,color:"#ffcc00",bold:!1},completeBack:()=>{this.radioComplete()},clickCallBack:()=>{this.radio&&this.radio.parentContainer&&(this.radio.clearRadioData(),this.radio.parentContainer.remove(this.radio))}})}radioComplete(){this.radio.setRadioData(["1111111111","2222222222","333333333333","444444444444"]),this.radio.x=this.bagBtn.x,this.radio.y=this.bagBtn.y-142,this.add(this.radio)}bagBtnOver(t){this.mBagSelect=this.mScene.make.sprite(void 0,!1),this.mBagSelect.setTexture(this.mResStr,"bag_BtnSelect"),this.mBagBtnCon.add(this.mBagSelect)}bagBtnOut(t){this.mBagSelect&&this.mBagSelect.parentContainer&&this.mBagSelect.parentContainer.remove(this.mBagSelect)}}h.SlotMaxCount=12},function(t,e,i){"use strict";i.r(e),i.d(e,"NoticeMediator",(function(){return o}));var s=i(85),a=i(7),r=i(3),n=i(2);class o extends a.PacketHandler{constructor(t,e,i){super(),this.world=i,this.mLayerManager=t,this.mScene=e;const s=i.connection;s&&(s.addPacketListener(this),this.addHandlerFun(r.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_NOTICE,this.noticeHandler)),this.world.emitter.on(n.World.SCALE_CHANGE,this.scaleChange,this)}setUiScale(t){this.mNoticePanel.scaleX=this.mNoticePanel.scaleY=t}getView(){return this.mNoticePanel}hide(){this.mNoticePanel&&this.mNoticePanel.hide()}destroy(){this.world.emitter.off(n.World.SCALE_CHANGE,this.scaleChange,this),this.mNoticePanel&&(this.mNoticePanel.destroy(),this.mNoticePanel=null),this.mScene=null}isSceneUI(){return!1}isShow(){return this.mNoticePanel.isShow()}resize(){this.mNoticePanel&&this.mNoticePanel.resize()}show(t){this.mNoticePanel&&this.mNoticePanel.isShow()||(this.mNoticePanel=new s.NoticePanel(this.mScene),this.mNoticePanel.show(t),this.mNoticePanel.showNotice(t),this.mLayerManager.addToDialogLayer(this.mNoticePanel),this.setUiScale(this.world.uiScale))}update(t){}scaleChange(){this.setUiScale(this.world.uiScale)}noticeHandler(t){this.show(t.content)}}},function(t,e,i){"use strict";i.r(e),i.d(e,"NoticePanel",(function(){return o}));var s=i(8),a=i(4),r=i(28),n=i(39);class o extends s.Panel{constructor(t){super(t)}show(t){super.show(t),this.setData("data",t),this.resize()}destroy(){this.mContentText&&(this.mContentText.destroy(),this.mContentText=null),this.mTween&&(this.mTween.stop(),this.mTween.remove(),this.mTween=null),super.destroy()}resize(){const t=this.scene.cameras.main.worldView;this.x=t.x+t.width>>1,this.y=180}showNotice(t){if(!this.mInitialized)return;if(!t)return;this.mTween&&(this.mTween.stop(),this.mTween.remove());const e=t.chatsetting;this.mContentText.setText(t.noticeContext),this.mContentText.setFill(e.textColor?e.textColor:"#FFFFFF"),this.mContentText.x=-(this.mContentText.width>>1),this.mContentText.y=-(this.mContentText.height>>1),this.mTween=this.scene.tweens.add({targets:this,alpha:1,duration:200});const i=e.duration?e.duration:5e3;this.mTween=this.scene.tweens.add({targets:this,alpha:0,duration:200,delay:i,onComplete:()=>{this.removeFromParent()}})}preload(){this.scene.load.image(a.d.getName(),a.d.getPNG()),super.preload()}init(){const t=new r.a(this.scene,{width:1200,height:120,key:a.d.getName(),columns:a.d.getColumns(),rows:a.d.getRows()});this.add(t),this.mContentText=this.scene.make.text({align:"center",style:{font:n.a.YAHEI_20_BOLD,wordWrap:{width:1180,useAdvancedWrap:!0}}},!1).setStroke("#000000",1),this.add(this.mContentText),super.init();const e=this.getData("data");e&&this.showNotice(e)}removeFromParent(){this.parentContainer&&this.parentContainer.remove(this),this.mTween&&(this.mTween.stop(),this.mTween.remove(),this.mTween=null)}}},function(t,e,i){"use strict";i.r(e),i.d(e,"DragType",(function(){return s})),i.d(e,"DropType",(function(){return a})),i.d(e,"BagMediator",(function(){return l}));var s,a,r=i(16),n=i(12),o=i(6),h=i(87);!function(t){t[t.DRAG_TYPE_SHORTCUT=1]="DRAG_TYPE_SHORTCUT",t[t.DRAG_TYPE_BAG=2]="DRAG_TYPE_BAG"}(s||(s={})),function(t){t[t.DROP_TYPE_SHORTCUT=1]="DROP_TYPE_SHORTCUT",t[t.DROP_TYPE_BAG=2]="DROP_TYPE_BAG"}(a||(a={}));class l extends n.a{constructor(t,e){super(t),this.mPageNum=0,this.world=t,this.mScene=e}isSceneUI(){return!1}isShow(){if(this.mView)return this.mView.isShow()}getView(){return this.mView}show(t){this.mView&&this.mView.isShow()||(this.mView||(this.mView=new h.BagPanel(this.mScene,this.world)),this.world.emitter.on(r.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.emitter.on(r.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.emitter.on(r.a.QUERY_PACKAGE,this.handleSynchroPackage,this),t?this.world.roomManager.currentRoom.getHero().getBag().requestVirtualWorldQueryPackage(t[0].id,1,h.BagPanel.PageMaxCount):this.world.roomManager.currentRoom.getHero().getBag().requestVirtualWorldQueryPackage(this.world.roomManager.currentRoom.getHero().model.package.id,1,h.BagPanel.PageMaxCount),this.mView.show(t),super.show(t))}update(t){this.mView&&this.mView.update(t)}hide(){this.world.emitter.off(r.a.DRAG_TO_DROP,this.handleDrop,this),this.world.emitter.off(r.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.emitter.off(r.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.emitter.off(r.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mView&&this.mView.hide()}destroy(){this.mView&&(this.mView.destroy(),this.mView=null),this.mPageNum=0,this.mScene=null,this.world=null}handleDrop(t){const e=t[0];t[1].getDropType()===a.DROP_TYPE_BAG&&e.getDragType()===s.DRAG_TYPE_SHORTCUT&&o.a.getInstance().debug("背包拖到快捷栏了！！！")}refrehView(t){let e;if(t)e=t;else{const t=this.world.roomManager.currentRoom.getHero().model.package;if(null==t)return;e=t.items}this.setListData(e)}setListData(t){this.mView.setDataList(t)}handleSynchroPackage(t){t.id===this.world.roomManager.currentRoom.getHero().model.package.id&&this.refrehView(t.items)}onUpdatePackageHandler(t){t.id===this.world.roomManager.currentRoom.getHero().model.package.id&&this.refrehView(t.items)}}l.NAME="BagMediator"},function(t,e,i){"use strict";i.r(e),i.d(e,"BagPanel",(function(){return o}));var s=i(27),a=i(6),r=i(8),n=i(4);class o extends r.Panel{constructor(t,e){super(t),this.mPageNum=0,this.mPageIndex=1,this.mScene=t,this.mWorld=e,this.bagSlotList=[]}resize(){const t=this.mWorld.getSize();this.x=t.width>>1,this.y=t.height-200}setDataList(t){this.mPageNum=Math.ceil(t.length/o.PageMaxCount),this.mDataList=t,this.mInitialized&&this.refreshDataList()}getPageNum(){return this.mPageNum}destroy(){this.bagSlotList&&(this.bagSlotList.forEach(t=>{t&&t.destroy()}),this.bagSlotList.length=0,this.bagSlotList=null),this.mClsBtnSprite&&(this.mClsBtnSprite.destroy(!0),this.mClsBtnSprite=null),this.mPreBtn&&(this.mPreBtn.destroy(!0),this.mPreBtn=null),this.mNextBtn&&(this.mNextBtn.destroy(!0),this.mNextBtn=null),this.mDataList&&(this.mDataList.length=0,this.mDataList=null),this.mWorld=null,this.mPageNum=0,this.mPageIndex=1,super.destroy()}getCurPageIndex(){return this.mPageIndex}init(){if(this.mInitialized)return;let t=0;const e=this.mWorld.getSize();let i;this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.x=e.width>>1,this.y=e.height-200,this.mPreBtn=this.mScene.make.sprite(void 0,!1),this.mPreBtn.setTexture(this.mResStr,"bagView_tab"),this.mPreBtn.x=-380,t+=this.mPreBtn.width,this.add(this.mPreBtn);let a=0,r=0;this.bagSlotList=[];for(let e=0;e<36;e++)a=e%12*60+32-362,r=60*Math.floor(e/12)-55,(i=new s.ItemSlot(this.mScene,this.mWorld,this,a,r,this.mResStr,this.mResPng,this.mResJson,"bagView_slot","bagView_itemSelect")).createUI(),this.bagSlotList.push(i),e<=11&&(t+=57);this.addAt(this.createTexture(),0),this.mNextBtn=this.mScene.make.sprite(void 0,!1),this.mNextBtn.setTexture(this.mResStr,"bagView_tab"),this.mNextBtn.scaleX=-1,this.mNextBtn.x=380,t+=this.mNextBtn.width;const o=this.mScene.make.sprite(void 0,!1);o.setTexture(this.mResStr,"bagView_titleBtn"),o.x=80+(-t>>1),o.y=-103,this.add(o);const h=this.mScene.make.text(void 0,!1);h.setFontFamily("Tahoma"),h.setFontStyle("bold"),h.setFontSize(20),h.setText("背包"),h.x=o.x+o.width-10,h.y=o.y-(h.height>>1),this.add(h),this.add(this.mNextBtn),this.mNextBtn.setInteractive(),this.mPreBtn.setInteractive(),this.mNextBtn.on("pointerup",this.nextHandler,this),this.mPreBtn.on("pointerup",this.preHandler,this),this.mWidth=t,this.mHeight=206,this.mScene.cache.obj.has("clsBtn")?this.onClsLoadCompleteHandler():(this.mScene.load.spritesheet("clsBtn",n.h.getRes("ui/common/common_clsBtn.png"),{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onClsLoadCompleteHandler,this),this.mScene.load.start()),this.mInitialized=!0,this.mDataList&&this.refreshDataList(),super.init()}preload(){this.mScene&&(this.mResStr="bagView",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.mScene.load.atlas(this.mResStr,n.h.getRes(this.mResPng),n.h.getRes(this.mResJson)),super.preload())}loadComplete(t,e,i){this.mInitialized||this.init()}nextHandler(t,e){this.preNextBtnScaleHandler(this.mNextBtn,-1),this.mPageIndex>=this.mPageNum||(this.mPageIndex++,this.refreshDataList())}preHandler(t,e){this.preNextBtnScaleHandler(this.mPreBtn),this.mPageIndex<=1||(this.mPageIndex--,this.refreshDataList())}preNextBtnScaleHandler(t,e=1){this.mScene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1}refreshDataList(){if(!this.mDataList)return void a.a.getInstance().error("this.mDataList is undefiend");const t=this.mDataList.slice((this.mPageIndex-1)*o.PageMaxCount,this.mPageIndex*o.PageMaxCount),e=o.PageMaxCount;let i;for(let s=0;s<e;s++)(i=this.bagSlotList[s])&&i.dataChange(t[s])}createTexture(){const t=this.mScene.add.graphics();return t.fillStyle(11184553,.5),t.fillRect(-362,-102,724,200),t.lineStyle(3,0,.8),t.strokeRect(-365,-103,730,206),t}onClsLoadCompleteHandler(){this.mClsBtnSprite=this.mScene.make.sprite(void 0,!1),this.mClsBtnSprite.setTexture("clsBtn","btn_normal"),this.mClsBtnSprite.x=(this.mWidth>>1)-65,this.mClsBtnSprite.y=-this.mHeight>>1,this.mClsBtnSprite.setInteractive(),this.mClsBtnSprite.on("pointerup",this.hide,this),this.add(this.mClsBtnSprite)}}o.PageMaxCount=36},function(t,e,i){"use strict";i.r(e),i.d(e,"ComponentRankPanel",(function(){return r}));var s=i(55),a=i(4);class r extends s.BasicRankPanel{constructor(t,e){super(t,e)}resize(){if(!this.scene)return;const t=this.scene.cameras.main.worldView;this.x=t.width-this.width>>1,this.y=t.height-this.height>>1}destroy(){this.mCloseBtn&&(this.mCloseBtn.destroy(!0),this.mCloseBtn=null),super.destroy()}preload(){this.scene.load.spritesheet(a.e.getName(),a.e.getPNG(),a.e.getFrameConfig()),super.preload()}init(){this.mCloseBtn=this.mScene.make.image({x:0,y:0,key:a.e.getName(),frame:"btn_normal"},!1),this.mCloseBtn.setTexture(a.e.getName(),"btn_normal"),this.mCloseBtn.x=(this.mWidth>>1)-65,this.mCloseBtn.y=-this.mHeight>>1,super.init(),this.add(this.mCloseBtn),this.mCloseBtn.setInteractive(),this.mCloseBtn.once("pointerup",this.onCloseHandler,this),this.resize(),this.mCloseBtn.x=this.width-18}onCloseHandler(){this.hide()}}},function(t,e,i){"use strict";i.r(e),i.d(e,"ControlFPanel",(function(){return n}));var s=i(8),a=i(4),r=i(39);class n extends s.Panel{constructor(t){super(t)}show(t){super.show(t),this.on("pointerdown",this.onMouseDownHandler,this),this.on("pointerup",this.onMouseUpHandler,this)}hide(){this.off("pointerdown",this.onMouseDownHandler,this),this.off("pointerup",this.onMouseUpHandler,this),super.hide()}resize(){if(!this.mScene)return;const t=this.scene.cameras.main.worldView;this.x=t.x+(t.width>>1),this.y=t.y+(t.height>>1)}destroy(){this.mControlText&&this.mControlText.destroy(!0),super.destroy()}preload(){this.scene.load.image("controlF_background",a.h.getRes("ui/controlf/background.png")),super.preload()}init(){const t=this.scene.make.image({key:"controlF_background"},!1);this.add(t),this.mControlText=this.scene.make.text({align:"center",text:"F",style:{font:r.a.YAHEI_20_BOLD}},!1),this.mControlText.x=-(this.mControlText.width>>1),this.mControlText.y=-(this.mControlText.height>>1),this.add(this.mControlText),this.setSize(t.width,t.height),this.setInteractive(),super.init(),this.resize()}onMouseDownHandler(){this.scale=.8}onMouseUpHandler(){this.scale=1,this.emit("control")}}},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractivePanelMediator",(function(){return r}));var s=i(12),a=i(91);class r extends s.a{constructor(t,e,i){super(i),this.mScene=e}isShow(){return!!this.mView&&this.mView.isShow()}isSceneUI(){return!1}resize(){if(this.mView)return this.mView.resize()}getView(){return this.mView}show(t){this.mView&&this.mView.isShow||(this.mParam=t,this.world.game.device.os.desktop&&(this.mView=new a.InteractivePanel(this.mScene,this.world)),this.mView.show(t),super.show(t))}update(t){this.mView&&this.mView.isShow&&(this.mParam=t,super.update(t))}hide(){this.mView&&(this.mView.hide(),this.mView=null)}destroy(){this.world=null,this.mScene=null,this.mParam=null,super.destroy()}componentClick(t){this.mParam&&this.world.roomManager.currentRoom.getHero().getInteractive().requestTargetUI(this.mParam[0].id,t)}}r.NAME="InteractivePanelMediator"},function(t,e,i){"use strict";i.r(e),i.d(e,"InteractivePanel",(function(){return c}));var s=i(8),a=i(4),r=i(14),n=i(54),o=i(3),h=i(20),l=i(90);class c extends s.Panel{constructor(t,e){super(t),this.mWorld=e}show(t){this.mWorld.getSize();if(this.mData=t,!this.mInitialized)return void this.preload();this.mShowing=!0;const e=this.mWorld.uiManager.getMediator(l.InteractivePanelMediator.NAME),i=this.mData[0];if(this.mLeftFaceIcon&&(this.mLeftFaceIcon.visible=!1),this.mRightFaceIcon&&(this.mRightFaceIcon.visible=!1),this.mMidFaceIcon&&(this.mMidFaceIcon.visible=!1),i.display&&i.display.length>0){const t=i.display[0],e=a.h.getOsdRes(t.texturePath);this.scene.cache.obj.get(e)?this.onLoadComplete():(this.scene.load.image(e,e),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,this.onLoadError,this),this.scene.load.start())}if(this.mDescTF.text="",this.mNameTF.text="",i.text&&i.text.length>0){const t=i.text[0];if(this.mDescCon.setData("nodeID",t.node.id),this.mDescTF.text=t.text,this.mDescCon.off("pointerdown",this.descConClick,this),this.mDescCon.on("pointerdown",this.descConClick,this),i.text[1]){const t=i.text[1];this.mNameCon.setData("nodeID",t.node.id),this.mNameTF.text=t.text,this.mNameTF.x=-this.mNameTF.width>>1,this.mNameCon.off("pointerdown",this.nameConClick,this),this.mNameCon.on("pointerdown",this.nameConClick,this)}}this.mRadio&&(this.mRadio.visible=!1),i.button&&i.button.length>0&&(this.mRadio||(this.mRadio=new n.Radio(this.mScene,{wid:328,hei:142,resKey:"juqing",resPng:"./resources/ui/juqing/juqing.png",resJson:"./resources/ui/juqing/juqing.json",resBg:"radio_bg.png",resArrow:"radio_arrow.png",fontStyle:{size:20,color:"#ffcc00",bold:!1},completeBack:()=>{this.radioComplete()},clickCallBack:t=>{t&&e&&e.componentClick(t.data)}}),this.radioComplete()),this.mRadio.setRadioData(i.button),this.mRadio.visible=!0),this.mShowing||super.show(t)}update(t){this.show(t)}getRadio(){return this.mRadio}setRadioData(t){this.mRadio.setRadioData(t)}resize(){const t=this.mWorld.getSize();this.x=t.width>>1,this.y=t.height/2-250}destroy(){this.mInitialized=!1,this.mNameCon&&(this.mNameCon.off("pointerdown",this.nameConClick,this),this.mNameCon.destroy(!0)),this.mDescCon&&(this.mDescCon.off("pointerdown",this.descConClick,this),this.mDescCon.destroy(!0)),this.mLeftFaceIcon&&(this.mLeftFaceIcon.off("pointerdown",this.leftFaceClick,this),this.mLeftFaceIcon.destroy(!0)),this.mMidFaceIcon&&(this.mMidFaceIcon.off("pointerdown",this.midFaceClick,this),this.mMidFaceIcon.destroy(!0)),this.mRightFaceIcon&&(this.mRightFaceIcon.off("pointerdown",this.midFaceClick,this),this.mRightFaceIcon.destroy(!0)),this.mNameTF&&this.mNameTF.destroy(!0),this.mDescTF&&this.mDescTF.destroy(!0),this.mRadio&&this.mRadio.destroy(),this.mNameCon=null,this.mDescCon=null,this.mLeftFaceIcon=null,this.mMidFaceIcon=null,this.mRightFaceIcon=null,this.mNameTF=null,this.mDescTF=null,this.mRadio=null,super.destroy()}preload(){this.mScene&&(this.scene.load.image(a.a.getName(),a.a.getPNG()),this.scene.load.image(a.d.getName(),a.d.getPNG()),this.mScene.load.atlas("juqing",a.h.getRes("ui/juqing/juqing.png"),a.h.getRes("ui/juqing/juqing.json")),super.preload())}init(){this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this);const t=this.mWorld.getSize();t.width,t.height;this.mNameCon=this.mScene.make.container(void 0,!1),this.mDescCon=this.mScene.make.container(void 0,!1);const e=new r.NinePatch(this.scene,0,0,1080,320,a.a.getName(),null,a.a.getConfig()),i=new r.NinePatch(this.scene,0,0,1040,280,a.d.getName(),null,a.d.getConfig());this.mLeftFaceIcon=this.mScene.make.image(void 0,!1),this.mMidFaceIcon=this.mScene.make.image(void 0,!1),this.mRightFaceIcon=this.mScene.make.image(void 0,!1),this.mNameTF=new h.a(this.mScene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:i.width}});const s=this.mScene.make.image(void 0,!1);s.setTexture("juqing","juqing_name.png"),this.mNameCon.add(s),this.mNameCon.add(this.mNameTF),this.mDescTF=new h.a(this.mScene,0,0,"",{fontSize:"20px",wrap:{mode:"char",width:i.width}}),this.mNameTF.y=-8,this.mDescTF.x=-i.width/2,this.mDescTF.y=-i.height/2,this.mDescCon.setSize(e.width,e.height),this.mNameCon.setSize(s.width,s.height),this.mDescCon.add(e),this.mDescCon.add(i),this.mDescCon.add(this.mDescTF),this.mDescCon.y=t.height/2+80,this.mNameCon.x=150-this.mDescCon.width/2,this.mNameCon.y=this.mDescCon.y-this.mDescCon.height/2-this.mNameCon.height/2-10,this.mDescCon.setInteractive(),this.mNameCon.setInteractive(),this.add(this.mNameCon),this.add(this.mDescCon),this.resize(),super.init()}onLoadComplete(){this.mWorld.getSize();const t=this.mData[0].display[0],e=a.h.getOsdRes(t.texturePath),i=t.scaleX,s=t.scaleY;this.mWorld.uiManager.getMediator(l.InteractivePanelMediator.NAME);switch(t.horizontal){case o.op_def.HorizontalAlignment.HORIZONTAL_LEFT:this.mLeftFaceIcon.setTexture(e),this.mLeftFaceIcon.setData("nodeID",t.node.id),this.mLeftFaceIcon.x=-300,this.mLeftFaceIcon.y=120,this.mLeftFaceIcon.scaleX=i,this.mLeftFaceIcon.scaleY=s,this.mLeftFaceIcon.setInteractive(),this.addAt(this.mLeftFaceIcon,0),this.mLeftFaceIcon.visible=!0,this.mLeftFaceIcon.off("pointerdown",this.leftFaceClick,this),this.mLeftFaceIcon.on("pointerdown",this.leftFaceClick,this);break;case o.op_def.HorizontalAlignment.HORIZONTAL_CENTER:this.mMidFaceIcon.setTexture(e),this.mMidFaceIcon.setData("nodeID",t.node.id),this.mMidFaceIcon.x=0,this.mMidFaceIcon.y=120,this.mMidFaceIcon.scaleX=i,this.mMidFaceIcon.scaleY=s,this.addAt(this.mMidFaceIcon,0),this.mMidFaceIcon.visible=!0,this.mLeftFaceIcon.off("pointerdown",this.midFaceClick,this),this.mMidFaceIcon.on("pointerdown",this.midFaceClick,this);break;case o.op_def.HorizontalAlignment.HORIZONTAL_RIGHT:this.mRightFaceIcon.setTexture(e),this.mRightFaceIcon.setData("nodeID",t.node.id),this.mRightFaceIcon.x=300,this.mRightFaceIcon.y=120,this.mRightFaceIcon.scaleX=i,this.mRightFaceIcon.scaleY=s,this.addAt(this.mRightFaceIcon,0),this.mRightFaceIcon.visible=!0,this.mRightFaceIcon.off("pointerdown",this.rightFaceClick,this),this.mRightFaceIcon.on("pointerdown",this.rightFaceClick,this)}}rightFaceClick(){const t=this.mWorld.uiManager.getMediator(l.InteractivePanelMediator.NAME);t&&t.componentClick(this.mRightFaceIcon.getData("nodeID"))}midFaceClick(){const t=this.mWorld.uiManager.getMediator(l.InteractivePanelMediator.NAME);t&&t.componentClick(this.mMidFaceIcon.getData("nodeID"))}leftFaceClick(){const t=this.mWorld.uiManager.getMediator(l.InteractivePanelMediator.NAME);t&&t.componentClick(this.mLeftFaceIcon.getData("nodeID"))}descConClick(){const t=this.mWorld.uiManager.getMediator(l.InteractivePanelMediator.NAME);this.mDescCon.getData("nodeID")&&t&&t.componentClick(this.mDescCon.getData("nodeID"))}nameConClick(){const t=this.mWorld.uiManager.getMediator(l.InteractivePanelMediator.NAME);this.mNameCon.getData("nodeID")&&t&&t.componentClick(this.mNameCon.getData("nodeID"))}onLoadError(t){}radioComplete(){this.mWorld.getSize();this.mRadio&&(this.mRadio.x=220,this.mRadio.y=this.mDescCon.height+250,this.add(this.mRadio))}}},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemDetail",(function(){return o}));var s=i(8),a=i(4),r=i(46),n=i(17);class o extends s.Panel{constructor(t,e){super(t),this.mWorld=e,this.mWid=0,this.mHei=0}getBtnList(){return this.mBtnList}resize(){const t=this.mWorld.getSize();this.x=t.width-this.width>>1,this.y=t.height-this.height>>1}show(t){if(this.mData=t,!this.mInitialized)return void this.preload();this.mShowing=!0;const e=this.mData[0];if(e.display.length>0&&this.loadIcon(e.display[0]),e.text.length>0&&this.setText(e.text[0].text),e.button.length>0){let t;this.mBtnList=[];const i=e.button.length;let s=20;const a=this.mWid+50;for(let r=0;r<i;r++){const i=e.button[r];t=new n.NinePatchButton(this.mScene,0,0,100,40,"button_blue",i.text,{left:4,top:4,right:4,bottom:4},i),this.mBtnList.push(t),t.x=a,t.y=s,s+=t.height+40,this.add(t)}}const i=this.mScene.add.graphics();i.fillStyle(0,.8),i.fillRoundedRect(0,0,this.mWid,this.mHei,6),this.addAt(i,0),this.setSize(this.mWid+120,this.mHei),this.resize(),this.setInteractive()}setText(t){this.mDescTF.setText(t),this.mHei+=this.mDescTF.y+this.mDescTF.height+10}loadIcon(t){this.mIcon&&this.mIcon.load(a.h.getOsdRes(t),()=>{this.mHei+=this.mIcon.y+this.mIcon.height})}hide(){this.removeInteractive(),super.hide()}destroy(){this.mBtnList&&(this.mBtnList.forEach(t=>{t.destroy(!0),t=null}),this.mBtnList=null),this.mResStr="",this.mResPng="",this.mResJson="",this.mNameTF&&this.mNameTF.destroy(!0),this.mDescTF&&this.mDescTF.destroy(!0),this.mIcon&&this.mIcon.destroy(),this.mNameTF=null,this.mDescTF=null,this.mIcon=null,this.mWid=0,this.mHei=0,super.destroy()}preload(){this.mResStr="itemDetail",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.mScene&&(this.mScene.load.atlas(a.c.getName(),a.c.getPNG(),a.c.getJSON()),this.mScene.load.atlas("itemDetail",a.h.getRes("ui/bag/bagView.png"),a.h.getRes("ui/bag/bagView.json")),super.preload())}init(){this.mWorld.getSize();this.mWid=290,this.mHei=0,this.mIcon=new r.DragDropIcon(this.mScene,30,25),this.add(this.mIcon),this.mNameTF=this.scene.make.text({style:{fontFamily:"YaHei",fontSize:20,origin:{x:0,y:0},wordWrap:{width:250,useAdvancedWrap:!0}}},!1),this.mNameTF.setFontStyle("bold"),this.mNameTF.setAlign("left"),this.mNameTF.x=this.mIcon.x+this.mIcon.width,this.mNameTF.y=this.mIcon.y,this.add(this.mNameTF),this.mDescTF=this.scene.make.text({style:{fontFamily:"YaHei",fontSize:25,origin:{x:0,y:0},wordWrap:{width:250,useAdvancedWrap:!0}}},!1),this.mDescTF.setFontStyle("bold"),this.mDescTF.setAlign("left"),this.mDescTF.x=this.mIcon.x-this.mIcon.width/2,this.mDescTF.y=this.mIcon.y+this.mIcon.height+20,this.add(this.mDescTF),this.mInitialized=!0,this.show(this.mData)}}},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxView",(function(){return h}));var s=i(8),a=i(17),r=i(4),n=i(14),o=i(20);class h extends s.Panel{constructor(t,e){super(t),this.mWorld=e}resize(){const t=this.mWorld.getSize();this.x=t.width-this.mWidth>>1,this.y=t.height-this.mHeight>>1}show(t){if(super.show(t),!this.mInitialized)return;this.mButtons=[],t[0]&&t[0].text&&t[0].text[0]&&this.mTxt.setText(t[0].text[0].text);const e=t[0].button;if(e){const t=46,i=24,s=this.mWidth/(e.length+1);for(let r=0;r<e.length;r++){const n=new a.NinePatchButton(this.mScene,0,0,t,i,"button_blue",e[r].text,{top:7,bottom:7,left:7,right:7},e[r]);n.x=(r+1)*s,n.y=this.mHeight-i-100,this.mButtons.push(n),this.add(n)}}this.resize()}hide(){super.hide()}destroy(){this.mTxt&&this.mTxt.destroy(!0),this.mButtons&&this.mButtons.length>0&&(this.mButtons.forEach(t=>{t&&t.destroy(!0)}),this.mButtons.length=0,this.mButtons=[]),this.mTxt=null,this.mButtons=null,super.destroy()}get buttons(){return this.mButtons}preload(){this.mScene&&(this.mScene.load.atlas(r.c.getName(),r.c.getPNG(),r.c.getJSON()),this.mScene.load.image(r.d.getName(),r.d.getPNG()),super.preload())}init(){this.mWorld.getSize();this.mWidth=300,this.mHeight=200;const t=new n.NinePatch(this.scene,0,0,this.mWidth,this.mHeight,r.d.getName(),null,r.d.getConfig());t.x=this.mWidth/2,t.y=0,this.add(t),this.mTxt=new o.a(this.mScene,0,0,"",{fontSize:"16px",wrap:{mode:"char",width:250*this.mWorld.uiScale},halign:"left"}),this.mTxt.x=10,this.mTxt.y=-this.mHeight/2+10,this.add(this.mTxt),super.init()}}},function(t,e,i){"use strict";i.r(e),i.d(e,"RankPanel",(function(){return a}));var s=i(55);class a extends s.BasicRankPanel{constructor(t,e){super(t,e)}resize(){if(!this.mWorld)return;const t=this.mWorld.getSize();this.x=t.width-this.width-150,this.y=21}destroy(){this.mZoonInBtn&&this.mZoonInBtn.destroy(!0),this.mZoonInBtn=null,this.mCurrentIndex=0,super.destroy()}init(){super.init(),this.mZoonInBtn=this.scene.make.image({x:158,y:349,key:"rank_atlas",frame:"arrow.png"},!1),this.add(this.mZoonInBtn),this.resize(),this.mZoonInBtn.setInteractive(),this.mZoonInBtn.on("pointerup",this.onZoomHandler,this)}onZoomHandler(){this.currentSizeIndex=0===this.mCurrentIndex?1:0}set currentSizeIndex(t){if(this.mCurrentIndex===t)return;this.mCurrentIndex=t;const e=a.ZoomSize[this.mCurrentIndex];this.mBackground.resize(328,e),e>300?(this.add(this.mContentContainer),this.mZoonInBtn.angle=180):(this.mZoonInBtn.angle=0,this.remove(this.mContentContainer)),this.mBackground.x=this.mBackground.width>>1,this.mBackground.y=this.mBackground.height>>1,this.mZoonInBtn.y=e-13}}a.ZoomSize=[30,362]},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopPanel",(function(){return o}));var s=i(8),a=i(4),r=i(105),n=i(6);class o extends s.Panel{constructor(t,e){super(t),this.mWorld=e}resize(){const t=this.mWorld.getSize();this.x=t.width>>1,this.y=t.height-300}setDataList(t){this.mShopData=t,this.mInitialized&&this.refreshDataList()}destroy(){this.mShopItemSlotList&&(this.mShopItemSlotList.forEach(t=>{t&&t.destroy()}),this.mShopItemSlotList.length=0,this.mShopItemSlotList=null),this.mShopData=null,this.mInitialized=!1,super.destroy()}preload(){this.mScene&&(this.mScene.load.atlas("shopView",a.h.getRes("ui/shop/shopView.png"),a.h.getRes("ui/shop/shopView.json")),super.preload())}init(){const t=this.mWorld.getSize();this.x=t.width>>1,this.y=t.height-300;const e=this.mScene.make.sprite(void 0,!1);e.setTexture("shopView","shopView_bg"),e.x=0,e.y=0,this.setSize(e.width,e.height),this.addAt(e,0);const i=this.mScene.make.sprite(void 0,!1);i.setTexture("shopView","shopView_titleIcon"),i.x=35+(-e.width>>1),i.y=-e.height>>1,this.add(i);const s=this.mScene.make.text(void 0,!1);let a,n,o;s.setFontFamily("Tahoma"),s.setFontStyle("bold"),s.setFontSize(20),s.setText("内购商城"),s.x=i.x+i.width-10,s.y=i.y-(s.height>>1),this.add(s),this.mShopItemSlotList=[];for(let t=0;t<20;t++)n=t%5*100-e.width/2+75,o=90*Math.floor(t/5)-e.height/2+80,(a=new r.ShopItemSlot(this.mScene,this.mWorld,this,n,o,"shopView","ui/shop/shopView.png","ui/shop/shopView.json","shopView_bagSlot",null,null)).createUI(),this.mShopItemSlotList.push(a);this.mScene.cache.obj.has("clsBtn")?this.onClsLoadCompleteHandler():(this.mScene.load.spritesheet("clsBtn","resources/ui/common/common_clsBtn.png",{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onClsLoadCompleteHandler,this),this.mScene.load.start()),this.mWorld.uiManager.getUILayerManager().addToToolTipsLayer(this),this.mShopData&&this.refreshDataList(),super.init()}onClsLoadCompleteHandler(){this.mClsBtnSprite=this.mScene.make.sprite(void 0,!1),this.mClsBtnSprite.setTexture("clsBtn","btn_normal"),this.mClsBtnSprite.x=(this.width>>1)-65,this.mClsBtnSprite.y=-this.height>>1,this.mClsBtnSprite.setInteractive(),this.mClsBtnSprite.on("pointerup",this.hide,this),this.add(this.mClsBtnSprite)}refreshDataList(){if(!this.mShopData)return void n.a.getInstance().error("this.mDataList is undefiend");const t=o.ShopSlotCount;let e;for(let i=0;i<t;i++)(e=this.mShopItemSlotList[i])&&e.shopDataChange(this.mShopData.items[i],this.mShopData.id)}}o.ShopSlotCount=20},function(t,e,i){"use strict";i.r(e),i.d(e,"UserInfoPanel",(function(){return l}));var s=i(8),a=i(18),r=i(4),n=i(28),o=i(39),h=i(17);class l extends s.Panel{constructor(t,e){super(t),this.mBadgeImages=[],this.mWorld=e}show(t){super.show(t),this.setData("data",t),this.setInfo(t)}hide(){this.clearBadge(),super.hide()}resize(){const t=this.mWorld.getSize();this.x=t.width-this.width-8,this.y=t.height-100-this.height}setInfo(t){if(!this.mInitialized||!t)return;if(0===t.actors.length)return;const e=t.actors[0];this.mWorld.httpService.userDetail(e.platformId).then(t=>{if(200===t.code){const e=t.data;e&&(this.mActor.load(r.h.getOsdRes(`show/${e.username}.png`),this,void 0,this.loadDefaultAvatar),this.mNickName.setText(e.nickname),this.mLv.setText(e.level))}}),this.mWorld.httpService.badgecards(e.platformId).then(t=>{200===t.code&&this.createBadge(t.data)}),this.updateFollwer(e.platformId)}destroy(){this.mActor&&(this.mActor.destroy(!0),this.mActor=null),this.mBadgeImages&&(this.mBadgeImages.forEach(t=>{t.destroy(!0),t=null}),this.mBadgeImages=[]),this.mNickName&&(this.mNickName.destroy(!0),this.mNickName=null),this.mLv&&(this.mLv.destroy(!0),this.mLv=null),this.mFollwerBtn&&(this.mFollwerBtn.destroy(!0),this.mFollwerBtn=null),this.mWorld=null,super.destroy()}preload(){this.scene.load.image(r.d.getName(),r.d.getPNG()),this.scene.load.image(r.a.getName(),r.a.getPNG()),this.scene.load.atlas(r.c.getName(),r.c.getPNG(),r.c.getJSON()),super.preload()}init(){this.setSize(359,199);const t=new n.a(this.scene,{width:359,height:199,key:r.a.getName(),columns:r.a.getColumns(),rows:r.a.getRows()}).setOrigin(0,0);this.add(t);const e=new n.a(this.scene,{x:7,y:19,width:345,height:173,key:r.d.getName(),columns:r.d.getColumns(),rows:r.d.getRows()}).setOrigin(0,0);this.add(e);const i=this.scene.make.text({x:20,y:-5,text:"昵称：",stroke:"#000000",strokeThickness:2,style:{color:"#b4b4b4",font:o.a.YAHEI_18_BOLD}},!1);this.add(i);const s=this.scene.make.text({x:20,y:30,text:"等级：",stroke:"#000000",strokeThickness:2,color:"#b4b4b4",style:{color:"#b4b4b4",font:o.a.YAHEI_18_BOLD}},!1);this.add(s),this.mNickName=this.scene.make.text({x:i.x+50,y:i.y,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",style:{font:o.a.YAHEI_18_BOLD}},!1),this.add(this.mNickName),this.mLv=this.scene.make.text({x:s.x+50,y:s.y,stroke:"#000000",strokeThickness:2,color:"#FFFFFF",style:{font:o.a.YAHEI_18_BOLD}}),this.add(this.mLv),this.mFollwerBtn=new h.NinePatchButton(this.scene,258,145,80,34,r.c.getName(),"关注",r.c.getConfig()),this.mFollwerBtn.x=258+(this.mFollwerBtn.width>>1),this.mFollwerBtn.y=145+(this.mFollwerBtn.height>>1),this.mFollwerBtn.setTextStyle({font:o.a.YAHEI_16_BOLD}),this.add(this.mFollwerBtn),this.mActor=new a.DynamicImage(this.scene,300,125).setOrigin(.5,1),this.mActor.scale=2,this.add(this.mActor),this.resize(),super.init(),this.setInfo(this.getData("data"))}updateFollwer(t){const e=this.mWorld.roomManager.currentRoom.getHero().model;e&&t!==e.platformId&&this.mWorld.httpService.checkFollowed([t]).then(e=>{if(200===e.code){e.data.length>0?this.mFollwerBtn.setText("取消关注"):this.mFollwerBtn.setText("关注"),this.mFollwerBtn.setData("node",{text:this.mFollwerBtn.getText(),platformId:t})}})}createBadge(t){if(t)for(let e=0;e<t.length;e++){const i=new a.DynamicImage(this.scene,70*e+60,100);i.load(r.h.getOsdRes(t[e].target_entity.thumbnail)),this.add(i),this.mBadgeImages.push(i)}}loadDefaultAvatar(){this.mActor.load(r.h.getOsdRes("show/avatar_default.png"))}clearBadge(){for(const t of this.mBadgeImages)t.destroy(),this.remove(t);this.mBadgeImages.length=0}}},function(t,e,i){"use strict";i.r(e),i.d(e,"MenuItem",(function(){return n}));var s=i(17),a=i(14),r=i(4);class n extends s.NinePatchButton{constructor(t,e,i,s,a,r,n,o){super(t,e,i,s,a,r,n,o)}appendItem(t){this.mChild||(this.mMenus=[],this.mChild=this.scene.make.container(void 0,!1),this.mChild.x=42,this.mArrow=this.scene.make.image({x:this.width*this.originX-3,key:"usermenu_arrow"}),this.add(this.mArrow),this.mBackground=new a.NinePatch(this.scene,0,0,0,0,r.d.getName(),null,r.d.getConfig()),this.mChild.add(this.mBackground)),this.mChild.add(t),this.mMenus.push(t),this.mBackground.resize(70,32*this.mMenus.length),this.mBackground.x=this.mBackground.width*this.mBackground.originX,this.mBackground.y=this.mBackground.height*this.mBackground.originY}show(){this.add(this.mChild)}destroy(t){if(this.mMenus){const t=this.mMenus.length;for(let e=0;e<t;e++){let t=this.mMenus[e];t||(t.destroy(!0),t=null)}this.mMenus=[]}this.mBackground&&(this.mBackground.destroy(),this.mBackground=null),this.mChild&&(this.mChild.destroy(!0),this.mChild=null),this.mArrow&&(this.mArrow.destroy(!0),this.mArrow=null),super.destroy(t)}get menus(){return this.mMenus||[]}}},function(t,e,i){"use strict";i.r(e),i.d(e,"UserMenuPanel",(function(){return o}));var s=i(8),a=i(4),r=i(97),n=i(14);class o extends s.Panel{constructor(t,e){super(t),this.mMenus=[],this.mWorld=e}show(t){super.show(t),this.scene&&(this.setData("data",t),this.addItem(t),this.x=this.scene.input.activePointer.x,this.y=this.scene.input.activePointer.y,this.scene.input.on("gameobjectdown",this.onClickMenu,this))}hide(){this.scene.input.off("gameobjectdown",this.onClickMenu,this),this.removeInteractive(),this.clear(),super.hide()}setSize(t,e){return super.setSize(t,e),this.setInteractive(),this.mBackground&&(this.mBackground.resize(t,e),this.mBackground.x=this.mBackground.width*this.originX,this.mBackground.y=this.mBackground.height*this.originY),this}destroy(){if(this.mBackground&&this.mBackground.destroy(),this.mMenus){const t=this.mMenus.length;for(let e=0;e<t;e++){let t=this.mMenus[e];t||(t.destroy(!0),t=null)}this.mMenus=[]}super.destroy()}addItem(t){if(!this.mInitialized)return;this.clear();const e=t.menuItem;for(let t=0;t<e.length;t++){const i=this.appendItem(e[t],0,32*t);this.add(i),this.mMenus.push(i)}this.setSize(70,30*this.mMenus.length);const i=this.mWorld.roomManager.currentRoom.getHero().model;if(!i)return;const s=t.actors[0];if(s&&i.platformId!==s.platformId){const t={text:"关注",platformid:s.platformId},e=this.appendItem({text:"关注",node:void 0},0,32*this.mMenus.length);e.setData("node",t),this.add(e),this.mMenus.push(e),this.mWorld.httpService.checkFollowed([s.platformId]).then(i=>{if(200===i.code){i.data.length>0&&e.setText("取消关注"),t.text=e.getText(),e.setData("node",t)}})}}preload(){this.scene.load.image(a.b.getName(),a.b.getPNG()),this.scene.load.image(a.d.getName(),a.d.getPNG()),this.scene.load.image("usermenu_arrow",a.h.getRes("ui/usermenu/arrow.png")),this.scene.load.atlas(a.g.getName(),a.g.getPNG(),a.g.getJSON()),super.preload()}init(){this.mBackground=new n.NinePatch(this.scene,0,0,70,30,a.d.getName(),null,a.d.getConfig()),this.add(this.mBackground),this.mBackground.x=this.mBackground.width*this.mBackground.originX,this.mBackground.y=this.mBackground.height*this.mBackground.originY,super.init(),this.addItem(this.getData("data"))}appendItem(t,e,i){const s=new r.MenuItem(this.scene,e,i,59,29,a.g.getName(),t.text,a.g.getConfig());if(s.x=e+(s.width>>1)+(this.width-s.width>>1),s.y=i+(s.height>>1),s.setData("node",t.node),t.child&&t.child.length>0){const e=t.child;for(const t of e){const e=this.appendItem(t,0,32*s.menus.length);s.appendItem(e)}}return s}onClickMenu(t,e){e instanceof r.MenuItem&&(e.menus.length>0?e.show():this.emit("menuClick",e.getData("node")))}resizeBackground(t,e){this.mBackground&&this.mBackground.resize(t,e)}clear(){for(const t of this.mMenus)this.remove(t),t.off("pointerup",this.onClickMenu),t.destroy();this.mMenus.length=0}}},function(t,e,i){"use strict";i.r(e),i.d(e,"Alert",(function(){return s}));class s{constructor(t,e){this.mWorld=t,this.mScene=e}isShow(){return this.mShowing}show(t){const e=this.mWorld.getSize();this.mParentCon=this.mScene.add.container(e.width>>1,e.height>>1);const i=this.mScene.make.text({x:0,y:0,text:t,style:{fill:"#FF0000",fontSize:20}});this.mShowing=!0,this.mParentCon.add(i),this.mParentCon.setSize(i.width,i.height),this.mParentCon.x=e.width-this.mParentCon.width>>1,this.mScene.tweens.add({targets:this.mParentCon,duration:1e3,ease:"Linear",props:{y:{value:(e.height>>1)-80},alhpa:{value:0}},onComplete:(t,e,i)=>{this.destroy()},onCompleteParams:[this]})}hide(){this.mShowing=!1}resize(){if(this.mParentCon){const t=this.mWorld.getSize();this.mParentCon.x=t.width-this.mParentCon.width>>1}}destroy(){this.mParentCon&&(this.mParentCon.destroy(!0),this.mParentCon=null),this.mShowing=!1,this.mScene=null,this.mWorld=null}update(){}}},function(t,e,i){"use strict";i.r(e),i.d(e,"ComboBox",(function(){return s})),i.d(e,"SelectCallItem",(function(){return a}));class s extends Phaser.GameObjects.Container{constructor(t,e){super(t),this.mIsopen=!1,this.mScene=t,this.mConfig=e,this.init()}selectCall(t){this.mtxt.text=t.text,this.mtxt.x=this.mConfig.wid-this.mtxt.width>>1,this.mtxt.y=this.mConfig.hei-this.mtxt.height>>1,this.showTween(!1),this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)}set text(t){if(this.itemList){const t=this.itemList.length;for(let e=0;e<t;e++){let t=this.itemList[e];t&&(t.destroy(),t=null)}this.itemList.length=0}this.itemList=[];const e=t.length;for(let i=0;i<e;i++){const e=new a(this.mScene,this,this.mConfig.wid,this.mConfig.hei),s=t[i];e.itemData={index:i,text:s,data:{}},this.itemList.push(e)}this.selectCall(this.itemList[0].itemData)}destroy(){if(this.itemList){const t=this.itemList.length;for(let e=0;e<t;e++){const t=this.itemList[e];t&&t.destroy()}this.itemList.length=0,this.itemList=null}super.destroy(!0)}init(){const t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())}onLoadCompleteHandler(){const t=this.mConfig.resKey;this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2,this.mBg.y=this.mConfig.hei/2,this.mBg.setSize(this.mConfig.wid,this.mConfig.hei),this.mArrow=this.mScene.make.image(void 0,!1),this.mArrow.setTexture(t,this.mConfig.resArrow),this.mArrow.scaleY=this.mConfig.up?-1:1,this.mArrow.x=this.mConfig.wid-this.mArrow.width,this.mArrow.y=4+(this.mConfig.hei-this.mArrow.height>>1),this.mtxt=this.mScene.make.text({x:0,y:0,style:{fill:"#F7EDED",fontSize:18}},!1),this.add(this.mBg),this.add(this.mArrow),this.add(this.mtxt),this.mBg.setInteractive(),this.mBg.on("pointerdown",this.openHandler,this)}openHandler(){!this.itemList||this.itemList.length<1||this.showTween(this.mIsopen)}showTween(t){t?(this.mItemBG=this.createTexture(),this.addAt(this.mItemBG,0)):this.mItemBG&&(this.mItemBG.parentContainer&&this.mItemBG.parentContainer.remove(this.mItemBG),this.mItemBG.destroy()),this.mArrow.scaleY=t?1:-1,this.showTweenItem(t),this.mIsopen=!this.mIsopen}showTweenItem(t){const e=this.itemList.length;for(let i=0;i<e;i++){const e=this.itemList[i];e&&(e.x=this.mConfig.wid>>1,this.add(e),this.mScene.tweens.add({targets:e,duration:50*i,props:{y:{value:t?-this.mConfig.hei*i-this.mConfig.hei/2:-this.mConfig.hei>>1},alpha:{value:t?1:0}},onComplete:(i,s,a)=>{t||this.remove(e)},onCompleteParams:[this]}))}}createTexture(){const t=this.mConfig.hei*this.itemList.length,e=this.mScene.make.graphics(void 0,!1);return e.fillStyle(4012088,.8),e.fillRect(0,-t,this.mConfig.wid,t),e}}class a extends Phaser.GameObjects.Container{constructor(t,e,i,s){super(t),this.mSelectCallUI=e,this.mText=this.scene.make.text({x:-i>>1,y:-s>>1,style:{fill:"#F7EDED",fontSize:18}},!1);this.mSelectBG=t.make.graphics(void 0,!1),this.mSelectBG.fillStyle(16763904,.8),this.mSelectBG.fillRect(-i>>1,-s>>1,i,s),this.mSelectBG.visible=!1,this.addAt(this.mSelectBG,0),this.add(this.mText),this.setSize(i,s),this.setInteractive(),this.on("pointerover",this.overHandler,this),this.on("pointerout",this.outHandler,this),this.on("pointerdown",this.selectHandler,this)}set itemData(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width/2+(this.width-this.mText.width>>1),this.mText.y=-this.height/2+(this.height-this.mText.height>>1)}get itemData(){return this.mData}destroy(){this.mText.destroy(!0),this.mSelectBG.destroy(!0),this.mData=null,this.mText=null,this.mSelectBG=null,this.mSelectCallUI=null,super.destroy(!0)}setSelected(t){this.mSelectBG.visible=t}overHandler(){this.mSelectBG.visible=!0}selectHandler(){this.overHandler(),this.mSelectCallUI.selectCall(this.itemData)}outHandler(){this.mSelectBG.visible=!1}}},function(t,e,i){"use strict";var s=i(19);const a=Phaser.Math.Percent;var slider_PositionToPercent=function(t,e,i){var s,r,n;return t.y===e.y?(s=Math.min(t.x,e.x),r=Math.max(t.x,e.x),n=a(i.x,s,r)):t.x===e.x&&(s=Math.min(t.y,e.y),r=Math.max(t.y,e.y),n=a(i.y,s,r)),n},r={},slider_OnDragThumb=function(t,e,i){this.enable&&(r.x=e,r.y=i,this.value=slider_PositionToPercent(this.getStartPoint(),this.getEndPoint(),r))},n={},slider_OnTouchTrack=function(t,e,i){this.enable&&t.isDown&&(n.x=t.worldX,n.y=t.worldY,this.value=slider_PositionToPercent(this.getStartPoint(),this.getEndPoint(),n))};const o=Phaser.Display.Align.In.QuickSet;var h={},slider_GetThumbAlignPoint=function(t,e){void 0===e&&(e=h);var i=this.childrenMap.thumb,s=i.x,a=i.y;return o(i,this,t),e.x=i.x,e.y=i.y,i.x=s,i.y=a,e};const l=Phaser.Display.Align.LEFT_CENTER,c=Phaser.Display.Align.TOP_CENTER;var d={},slider_GetStartPoint=function(t){if(void 0===t&&(t=d),this.childrenMap.thumb){var e=0===this.orientation?c:l;slider_GetThumbAlignPoint.call(this,e,t)}else 0===this.orientation?(t.x=this.centerX,t.y=this.top+1):(t.x=this.left+1,t.y=this.centerY);return t};const m=Phaser.Display.Align.RIGHT_CENTER,u=Phaser.Display.Align.BOTTOM_CENTER;var p={},GetEndPoint=function(t){if(void 0===t&&(t=p),this.childrenMap.thumb){var e=1===this.orientation?m:u;slider_GetThumbAlignPoint.call(this,e,t)}else 0===this.orientation?(t.x=this.centerX,t.y=this.bottom-1):(t.x=this.right-1,t.y=this.centerY);return t};const g=Phaser.Math.Linear;var f={},slider_PercentToPosition=function(t,e,i,s){return void 0===s&&(s=f),s.x=g(e.x,i.x,t),s.y=g(e.y,i.y,t),s},slider_UpdateThumb=function(t){var e=this.childrenMap.thumb;return void 0===e?this:(void 0===t&&(t=this.value),slider_PercentToPosition(t,this.getStartPoint(),this.getEndPoint(),e),this.resetChildPositionState(e),this)},_=i(24);const y=Phaser.Display.Align.In.QuickSet,v=Phaser.Display.Align.LEFT_CENTER,S=Phaser.Display.Align.TOP_CENTER;var slider_UpdateIndicator=function(t){var e,i,s=this.childrenMap.indicator;if(void 0===s)return this;void 0===t&&(t=this.value);var a=this.childrenMap.thumb;a?0===this.orientation?i=a.y-a.displayHeight*a.originY+a.displayHeight-this.top:e=a.x-a.displayWidth*a.originX+a.displayWidth-this.left:0===this.orientation?i=this.height*t:e=this.width*t;Object(_.a)(s,e,i);var r=1===this.orientation?v:S;y(s,this,r),this.resetChildPositionState(s)};const b=Phaser.Utils.Objects.GetValue,T=Phaser.Math.Clamp,D=Phaser.Math.Linear,x=Phaser.Math.Percent,P=Phaser.Math.Snap.To;class C extends s.a{constructor(t,e){super(t,e),this.type="rexSlider",this.eventEmitter=b(e,"eventEmitter",this);var i=b(e,"background",void 0),s=b(e,"track",void 0),a=b(e,"indicator",void 0),r=b(e,"thumb",void 0),n=b(e,"space.left",0),o=b(e,"space.right",0),h=b(e,"space.top",0),l=b(e,"space.bottom",0);if(i&&this.addBackground(i),s){var c={left:n,right:o,top:h,bottom:l};this.add(s,0,void 0,c,!0)}a&&this.add(a,null),r&&this.add(r,null);var d=b(e,"input",0);switch("string"==typeof d&&(d=w[d]),d){case 0:r&&(r.setInteractive(),this.scene.input.setDraggable(r),r.on("drag",slider_OnDragThumb,this));break;case 1:this.setInteractive().on("pointerdown",slider_OnTouchTrack,this).on("pointermove",slider_OnTouchTrack,this)}this.addChildrenMap("background",i),this.addChildrenMap("track",s),this.addChildrenMap("indicator",a),this.addChildrenMap("thumb",r);var m=b(e,"valuechangeCallback",null);if(null!==m){var u=b(e,"valuechangeCallbackScope",void 0);this.eventEmitter.on("valuechange",m,u)}this.setEnable(b(e,"enable",void 0)),this.setGap(b(e,"gap",void 0)),this.setValue(b(e,"value",0))}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}setGap(t){return this.gap=t,this}get value(){return this._value}set value(t){void 0!==this.gap&&(t=P(t,this.gap));var e=this._value;this._value=T(t,0,1),e!==this._value&&(this.updateThumb(this._value),this.updateIndicator(this._value),this.eventEmitter.emit("valuechange",this._value,e,this.eventEmitter))}setValue(t,e,i){return null==t?this:(void 0!==e&&(t=x(t,e,i)),this.value=t,this)}addValue(t,e,i){return void 0!==e&&(t=x(t,e,i)),this.value+=t,this}getValue(t,e){var i=this.value;return void 0!==t&&(i=D(t,e,i)),i}layout(t,e,i){return super.layout(t,e,i),this.updateThumb(),this.updateIndicator(),this}}const w={drag:0,click:1,none:-1};var O={getStartPoint:slider_GetStartPoint,getEndPoint:GetEndPoint,updateThumb:slider_UpdateThumb,updateIndicator:slider_UpdateIndicator};Object.assign(C.prototype,O);e.a=C},function(t,e,i){"use strict";var s=i(103),a=i(158),textarea_InjectProperties=function(t){Object.defineProperty(t,"childOY",{configurable:!0,get:function(){return t.textOY},set:function(e){t.textOY=e}}),Object.defineProperty(t,"topChildOY",{get:function(){return t.topTextOY}}),Object.defineProperty(t,"bottomChildOY",{get:function(){return t.bottomTextOY}})},textarea_SetText=function(t){return this.childrenMap.child.setText(t),this.resizeController(),this},textarea_AppendText=function(t){return this.setText(this.text+t),this};const r=Phaser.Utils.Objects.GetValue;class n extends s.a{constructor(t,e){void 0===e&&(e={});var i=r(e,"text",void 0),s=r(e,"textWidth",void 0),n=r(e,"textHeight",void 0),o=r(e,"textMask",!0),h=r(e,"content",""),l=r(e,"x"),c=r(e,"y"),d=new a.a(t,{x:l,y:c,width:s,height:n,text:i,textMask:o,content:h,clamplTextOY:r(e,"clamplChildOY",!1)}),m=void 0===s?1:0,u=void 0===n;textarea_InjectProperties(d),e.scrollMode=0,e.type="rexTextArea",e.child={gameObject:d,proportion:m,expand:u};var p=r(e,"space",void 0);p&&(p.child=p.text),super(t,e),this.addChildrenMap("text",i)}get text(){return this.childrenMap.child.text}get linesCount(){return this.childrenMap.child.linesCount}}var o={setText:textarea_SetText,appendText:textarea_AppendText};Object.assign(n.prototype,o);e.a=n},function(t,e,i){"use strict";var s=i(19),a=i(51),r=i(101),n=i(159).a;const o=Phaser.Utils.Objects.GetValue;var scrollable_CreateScrollableSizer=function(t){var e,i,h=this.scene,l=Object(a.a)(t),c=new s.a(h,{orientation:l}),d=o(t,"child.gameObject",void 0),m=o(t,"slider",void 0),u=o(t,"scroller",!0);if(d){var p=o(t,"space.child",0);if(this.childPadding={},"number"!=typeof p){var g=p;0===l?(p=o(g,"right",0),this.childPadding.top=o(g,"top",0),this.childPadding.bottom=o(g,"bottom",0)):(p=o(g,"bottom",0),this.childPadding.top=o(g,"left",0),this.childPadding.bottom=o(g,"right",0))}else this.childPadding.top=0,this.childPadding.bottom=0;var f,_=o(t,"child.proportion",1),y=o(t,"child.expand",!0);f=0===l?{right:m?p:0}:{bottom:m?p:0},c.add(d,_,"center",f,y),m&&(!0===m&&(m={}),m.orientation=c.orientation,e=new r.a(h,m),c.add(e,0,"center",0,!0)),u&&(!0===u&&(u={}),u.orientation=l,i=new n(d,u))}return e&&e.on("valuechange",(function(t){this.t=t}),this),i&&i.on("valuechange",(function(t){this.childOY=t}),this),this.addChildrenMap("child",d),this.addChildrenMap("slider",e),this.addChildrenMap("scroller",i),c};const h=Phaser.Utils.Objects.GetValue;class l extends s.a{constructor(t,e){void 0===e&&(e={});var i=Object(a.a)(e);e.orientation=0===i?1:0,super(t,e),this.type=h(e,"type","rexScrollable");var s=h(e,"background",void 0),r=scrollable_CreateScrollableSizer.call(this,e),n=h(e,"header",void 0),o=h(e,"footer",void 0),l=h(e,"space.left",0),c=h(e,"space.right",0),d=h(e,"space.top",0),m=h(e,"space.bottom",0);if(s&&this.addBackground(s),n){var u=h(e,"align.header","center"),p=h(e,"space.header",0);f=0===i?{left:l,right:c,top:d,bottom:p}:{left:l,right:p,top:d,bottom:m};var g=h(e,"expand.header",!0);this.add(n,0,u,f,g)}r&&(f=0===i?{left:l,right:c,top:n?0:d,bottom:o?0:m}:{left:n?0:l,right:o?0:c,top:d,bottom:m},this.add(r,1,"center",f,!0));if(o){u=h(e,"align.footer","center");var f,_=h(e,"space.footer",0);f=0===i?{left:l,right:c,top:_,bottom:m}:{left:_,right:c,top:d,bottom:m};g=h(e,"expand.footer",!0);this.add(o,0,u,f,g)}this.addChildrenMap("background",s),this.addChildrenMap("header",n),this.addChildrenMap("footer",o)}layout(t,e,i){return super.layout(t,e,i),this.resizeController(),this}resizeController(){var t=this.topChildOY,e=this.bottomChildOY,i=this.childrenMap.scroller,s=this.childrenMap.slider;return i&&i.setBounds(e,t),s&&s.setEnable(e!==t),this.updateController(),this}updateController(){var t=this.childrenMap.scroller,e=this.childrenMap.slider;t&&t.setValue(this.childOY),e&&e.setValue(this.t)}set t(t){var e=this.childPadding;if(0!==e.top||0!==e.bottom){var i=this.childrenMap.child,s=i.topChildOY-i.bottomChildOY;t=((s+e.top+e.bottom)*t-e.top)/s}this.childrenMap.child.t=t,this.updateController()}get t(){var t=this.childrenMap.child.t,e=this.childPadding;if(0!==e.top||0!==e.bottom){var i=this.childrenMap.child,s=i.topChildOY-i.bottomChildOY,a=s+e.top+e.bottom;t=(s*t+e.top)/a}return t}set childOY(t){this.childrenMap.child.childOY=t,this.updateController()}get childOY(){return this.childrenMap.child.childOY}get topChildOY(){return this.childrenMap.child.topChildOY+this.childPadding.top}get bottomChildOY(){return this.childrenMap.child.bottomChildOY-this.childPadding.bottom}setChildOY(t){return this.childOY=t,this}setT(t){return this.t=t,this}scrollToTop(){return this.t=0,this}scrollToBottom(){return this.t=1,this}get sliderEnable(){var t=this.childrenMap.slider;if(t)return t.enable}set sliderEnable(t){var e=this.childrenMap.slider;e&&e.setEnable(t)}setSliderEnable(t){return void 0===t&&(t=!0),this.sliderEnable=t,this}get scrollerEnable(){var t=this.childrenMap.scroller;if(t)return t.enable}set scrollerEnable(t){var e=this.childrenMap.scroller;e&&e.setEnable(t)}setScrollerEnable(t){return void 0===t&&(t=!0),this.scrollerEnable=t,this}}e.a=l},function(t,e,i){"use strict";const s=Phaser.Display.Canvas.CanvasPool;var a={},textstyle_MeasureText=function(t){var e=s.create(this),i=e.getContext("2d");t.syncFont(e,i);var r=Math.ceil(i.measureText(t.testString).width*t.baselineX),n=r,o=2*n;n=n*t.baselineY|0,e.width=r,e.height=o,i.fillStyle="#f00",i.fillRect(0,0,r,o),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,n);var h=a;if(!i.getImageData(0,0,r,o))return h.ascent=n,h.descent=n+6,h.fontSize=h.ascent+h.descent,s.remove(e),h;var l,c,d=i.getImageData(0,0,r,o).data,m=d.length,u=4*r,p=0,g=!1;for(l=0;l<n;l++){for(c=0;c<u;c+=4)if(255!==d[p+c]){g=!0;break}if(g)break;p+=u}for(h.ascent=n-l,p=m-u,g=!1,l=o;l>n;l--){for(c=0;c<u;c+=4)if(255!==d[p+c]){g=!0;break}if(g)break;p-=u}return h.descent=l-n,h.fontSize=h.ascent+h.descent,s.remove(e),h},r=i(26);const n=Phaser.Utils.Objects.GetAdvancedValue,o=Phaser.Utils.Objects.GetValue;var h={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign",0],valign:["valign",0],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const l={left:r.a.hleft,center:r.a.hcenter,right:r.a.hright},c={top:r.a.vtop,center:r.a.vcenter,bottom:r.a.vbottom},d={none:r.a.NO_WRAP,word:r.a.WORD_WRAP,char:r.a.CHAR_WRAP,character:r.a.CHAR_WRAP};e.a=class{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var i=o(e,"metrics",!1);this.metrics=i?{ascent:o(i,"ascent",0),descent:o(i,"descent",0),fontSize:o(i,"fontSize",0)}:textstyle_MeasureText(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("halign")&&"string"==typeof t.halign&&(t.halign=l[t.halign.toLowerCase()]||0),t&&t.hasOwnProperty("valign")&&"string"==typeof t.valign&&(t.valign=c[t.valign.toLowerCase()]||0),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=d[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var a in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),h)this[a]="wrapCallback"===a||"wrapCallbackScope"===a?o(t,h[a][0],h[a][1]):n(t,h[a][0],h[a][1]);var r=o(t,"font",null);this._font=null===r?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:r;var m=o(t,"fill",null);return null!==m&&(this.color=m),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=textstyle_MeasureText(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=o(t,"fontFamily","Courier"),this.fontSize=o(t,"fontSize","16px"),this.fontStyle=o(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,s,a,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===s&&(s=0),void 0===a&&(a=!1),void 0===r&&(r=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=s,this.shadowStroke=a,this.shadowFill=r,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=d[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),"string"==typeof t&&(t=l[t.toLowerCase()]||0),"string"==typeof e&&(e=l[e.toLowerCase()]||0),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t=0),"string"==typeof t&&(t=l[t.toLowerCase()]||0),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t=0),"string"==typeof t&&(t=l[t.toLowerCase()]||0),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in h)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}}},function(t,e,i){"use strict";i.r(e);var s,a=i(27),r=i(46),n=i(3),o=i(4);(s||(s={})).TuDing18=class{static getName(){return"ui_moneyIcon_tuding_18_png"}static getPNG(){return o.h.getRes("ui/moneyIcon/tuding_18.png")}};var h=i(18),l=i(56),c=i(7);i.d(e,"ShopItemSlot",(function(){return d}));class d extends a.ItemSlot{constructor(t,e,i,s,a,r,n,o,h,l,c){super(t,e,i,s,a,r,n,o,h,l)}shopDataChange(t,e){if(!t)return;this.mPackageID=e,super.dataChange(t);const i=t.price,a=i.length;for(let t=0;t<a;t++){let e,a;i[t].coinType===n.op_def.CoinType.TU_DING_COIN&&(a=s.TuDing18.getName(),e=s.TuDing18.getPNG()),this.makeCoin(i[t],20*t+30)}}destroy(){this.moneyIcon&&(this.moneyIcon.destroy(!0),this.moneyIcon=null),super.destroy()}makeCoin(t,e){let i,a;t.coinType===n.op_def.CoinType.TU_DING_COIN&&(a=s.TuDing18.getName(),i=s.TuDing18.getPNG()),this.moneyIcon=new h.DynamicImage(this.mScene,0,0),this.moneyIcon.x=15+(-this.mWid>>1),this.moneyIcon.y=e,this.toolTipCon.add(this.moneyIcon),this.moneyIcon.load(i);const r=this.mScene.make.text(void 0,!1);r.setFontFamily("Tahoma"),r.setFontSize(15),r.x=-this.mWid/2+this.moneyIcon.width+20,r.y=e-9,this.toolTipCon.add(r),r.setText(t.price.toString())}onLoadCompleteHandler(){this.mWid=80,this.mHei=88,this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.itemBG.y=-10,this.toolTipCon.setSize(this.mWid,this.mHei),this.toolTipCon.addAt(this.itemBG,0),this.mIcon=new r.DragDropIcon(this.mScene,0,-10),this.toolTipCon.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1),this.isTipBoo&&(this.toolTip=new l.ToolTip(this.mScene,"itemSlotTip",o.h.getRes("ui/toolTip/toolTip.json"),o.h.getRes("ui/toolTip/toolTip.png"),this.mWorld.uiScale)),this.toolTipCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.toolTipCon.on("pointerover",this.overHandler,this),this.toolTipCon.on("pointerout",this.outHandler,this),this.toolTipCon.on("pointerdown",this.downHandler,this),this.toolTipCon.on("pointerup",this.outHandler,this),this.minitialize=!0,this.mData&&this.dataChange(this.mData),this.mSelectSprite=this.mScene.make.sprite(void 0,!1),this.createTexture(this.mWid,this.mHei)}overHandler(t){super.overHandler(t),this.mSelectSprite=this.mScene.make.sprite(void 0,!1),this.mSelectSprite.setTexture("selectBg"),this.toolTipCon.addAt(this.mSelectSprite,0)}downHandler(t){if(!this.mData)return;const e=new c.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),i=e.content;i.uiId=this.mPackageID,i.componentId=this.mData.id,this.mWorld.connection.send(e)}outHandler(t){super.outHandler(t)}createTexture(t,e){const i=this.mScene.add.graphics();i.fillStyle(11184553,.3),i.fillRoundedRect(0,0,t,e,5),i.generateTexture("selectBg",t,e),i.clear()}}},,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var s=i(156);e.a=s.a},function(t,e,i){"use strict";var s;e.a=function(t,e){void 0===e&&(void 0===s&&(s=new Phaser.Geom.Rectangle),e=s);var i=t.game.config;return e.setTo(0,0,i.width,i.height),e}},function(t,e,i){"use strict";const s=Phaser.Scene;e.a=function(t){return t instanceof s}},function(t,e,i){"use strict";e.a={x:0,h:0,horizontal:0,"left-to-right":0,y:1,v:1,vertical:1,"top-to-bottom":1}},function(t,e,i){"use strict";e.a={v:0,vertical:0,h:1,horizontal:1}},function(t,e,i){"use strict";const s=Phaser.GameObjects.Text;e.a=function(t){return t instanceof s}},function(t,e,i){"use strict";i.r(e),i.d(e,"ComponentRankMediator",(function(){return r}));var s=i(12),a=i(88);class r extends s.a{constructor(t,e,i){super(i),this.mView=new a.ComponentRankPanel(e,i),t.addToUILayer(this.mView),this.mLayerManager=t,this.mScene=e}getName(){return""}getView(){return this.mView}hide(){this.mView.hide()}isSceneUI(){return!1}isShow(){return!1}resize(){this.mView.resize()}show(t){this.mView&&this.mView.isShow()||(this.mView=new a.ComponentRankPanel(this.mScene,this.world),this.mLayerManager.addToUILayer(this.mView),this.mView.show(),t&&t.length>0&&this.mView.addItem(t[0]),super.show(t))}destroy(){this.mView&&(this.mView.parentContainer&&this.mView.parentContainer.remove(this.mView),this.mView.destroy(),this.mView=null),this.mScene=null}update(t){t&&t.length>0&&this.mView.addItem(t[0])}}},function(t,e,i){"use strict";i.r(e),i.d(e,"ControlFMediator",(function(){return o}));var s=i(12),a=i(89),r=i(7),n=i(3);class o extends s.a{constructor(t,e,i){super(i),this.mLayerManager=t,this.world=i,this.mScene=e}getName(){return""}getView(){}hide(){this.mView&&(this.mView.off("control",this.handControlF,this),this.mView.hide(),this.mView=null)}isSceneUI(){return!1}isShow(){return!1}resize(){this.mView.resize()}show(t){this.mView&&this.mView.isShow()||this.isShowing||(this.mView=new a.ControlFPanel(this.mScene),this.mView.on("control",this.handControlF,this),this.mLayerManager.addToUILayer(this.mView),this.mView.show(t),super.show(t))}update(t){}destroy(){this.mView&&(this.mView.destroy(),this.mView=null),this.mScene=null,this.mLayerManager=null}handControlF(){if(!this.world||!this.world.connection)return;const t=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),e=t.content;let i=this.world.inputManager.getKeyDowns();i=i.concat(Phaser.Input.Keyboard.KeyCodes.F),e.keyCodes=i,this.world.connection.send(t)}}},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"ItemDetailMediator",(function(){return h}));var s=i(12),a=i(92),r=i(3),n=i(7),o=i(17);class h extends s.a{constructor(t,e,i){super(i),this.world=i,this.mScene=e,this.mLayerManager=t}isSceneUI(){return!1}isShow(){return!!this.mView&&this.mView.isShow()}show(t){this.mView&&this.isShow()||(this.mView=new a.ItemDetail(this.mScene,this.world),this.mView.show(t),this.mParam=t,this.mLayerManager.addToUILayer(this.mView),this.mScene.input.on("gameobjectdown",this.onBtnHandler,this),super.show(t))}update(t){super.update(t)}hide(){this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),super.hide()}destroy(){this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),super.destroy()}onBtnHandler(t,e){if(e&&e instanceof o.NinePatchButton){const t=this.mParam[0],i=new n.PBpacket(r.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),s=i.content;s.uiId=t.id,s.componentId=e.getBtnData().node.id,this.world.connection.send(i)}}}},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxMediator",(function(){return h}));var s=i(12),a=i(93),r=i(17),n=i(3),o=i(7);class h extends s.a{constructor(t,e,i){super(i),this.world=i,this.mScene=e,this.mLayerManager=t}isSceneUI(){return!1}isShow(){return!!this.mView&&this.mView.isShow()}show(t){this.mView&&this.isShow()||(this.mView=new a.MessageBoxView(this.mScene,this.world),this.mView.show(t),this.mParam=t,this.mLayerManager.addToUILayer(this.mView),this.mScene.input.on("gameobjectdown",this.onBtnHandler,this),super.show(t))}update(t){super.update(t)}hide(){this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),super.hide()}destroy(){this.mScene.input.off("gameobjectdown",this.onBtnHandler,this),super.destroy()}onBtnHandler(t,e){if(e&&e instanceof r.NinePatchButton){const t=this.mParam[0],i=new o.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),s=i.content;s.uiId=t.id,s.componentId=e.getBtnData().node.id,this.world.connection.send(i)}}}},function(t,e,i){"use strict";i.r(e),i.d(e,"RankMediator",(function(){return a}));var s=i(12);i(94);class a extends s.a{constructor(t,e,i){super(i),this.world=i,this.mScene=e,this.mlayerManager=t}getName(){return""}getView(){return this.mView}hide(){this.mView&&this.mView.hide()}isSceneUI(){return!1}isShow(){return!1}resize(){this.mView&&this.mView.resize()}show(t){}update(t){this.mView&&t&&t.length>0&&this.mView.update(t[0])}destroy(){this.mView&&(this.mView.parentContainer&&this.mView.parentContainer.remove(this.mView),this.mView.destroy(),this.mView=null),this.mScene=null}}},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopMediator",(function(){return h}));var s=i(12),a=i(16),r=i(7),n=i(3),o=i(95);class h extends s.a{constructor(t,e,i){super(i),this._perPage=50,this.isEnd=!1,this.world=i,this.mScene=e,this.mLayerManager=t}isSceneUI(){return!1}resize(){if(this.mView)return this.mView.resize()}getView(){return this.mView}show(t){this.mView&&this.mView.isShow()||this.isShowing||(this.mView=new o.ShopPanel(this.mScene,this.world),this.mView.show(t),this.mParam=t,this.world.emitter.on(a.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.emitter.on(a.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.requestVirtualWorldQueryPackage(t[0].id,1,o.ShopPanel.ShopSlotCount),this.mLayerManager.addToUILayer(this.mView),super.show(t))}update(t){this.mView&&this.mView.update(t)}hide(){this.world.emitter.off(a.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.emitter.off(a.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.mView&&(this.mView.hide(),this.mView=null)}destroy(){this.world=null,this.mScene=null,this._curPage=0,this.fetching=!1,this.isEnd=!1,this.mParam=null,super.destroy()}isShow(){return!!this.mView&&this.mView.isShow()}requestVirtualWorldQueryPackage(t,e,i){const s=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),a=s.content;a.id=t,a.page=e,a.perPage=i,this.world.connection.send(s)}queryShopProps(t=1,e=50){if(!1==!!this.mParam)return;this.fetching=!0;const i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),s=i.content;s.id=this.mParam[0].id,s.page=t,s.perPage=e,this.world.connection.send(i)}queryPackageHandler(t){t.items.length>0&&t.id===this.mParam[0].id?this.mView.setDataList(t):this.isEnd=!0,this.fetching=!1}onShowItemHandler(t){const e=t.price;for(const t of e)t.coinType,n.op_def.CoinType.TU_DING_COIN;const i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),s=i.content;s.uiId=this.mParam[0].id,s.componentId=t.id,this.world.connection.send(i)}syncUserBalance(){const t=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_USER_BALANCE);this.world.connection.send(t)}onChangeIndex(t){t>=.9&&!1===this.fetching&&!1===this.isEnd&&(this._curPage++,this.queryShopProps(this._curPage))}onSyncUserBalanceHandler(t){this.mView}onPayTuDingHandler(){}}h.NAME="ShopMediator"},function(t,e,i){"use strict";i.r(e),i.d(e,"UserInfoMediator",(function(){return n}));var s=i(12),a=i(96),r=i(16);class n extends s.a{constructor(t,e,i){super(i),this.mLayerManager=t,this.mScene=e,this.world=i,this.mView=new a.UserInfoPanel(this.mScene,i)}getView(){return this.mView}hide(){this.mView.hide(),this.world.emitter.off(r.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this)}isSceneUI(){return!1}isShow(){return this.mView.isShow()}resize(){this.mView.resize()}show(t){t&&0!==t.length&&(this.mView.show(t[0]),this.mLayerManager.addToUILayer(this.mView),this.world.emitter.on(r.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),super.show(t))}destroy(){this.mView&&this.mView.destroy()}update(t){}onClosePanel(){this.hide()}}},function(t,e,i){"use strict";i.r(e),i.d(e,"UserMenuMediator",(function(){return h}));var s=i(12),a=i(98),r=i(7),n=i(3),o=i(16);class h extends s.a{constructor(t,e,i){super(i),this.world=i,this.mLayerManager=t,this.mScene=e,this.mView=new a.UserMenuPanel(e,this.world)}getView(){}hide(){this.world.emitter.off(o.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView&&(this.mView.off("menuClick",this.onClickMenuHandler,this),this.mView.hide())}isSceneUI(){return!1}isShow(){return!1}resize(){this.mView.resize()}show(t){this.mView.show(t[0]),this.mLayerManager.addToUILayer(this.mView),this.world.emitter.on(o.a.SCENE_BACKGROUND_CLICK,this.onClosePanel,this),this.mView.on("menuClick",this.onClickMenuHandler,this),super.show(t)}update(t){this.mView.update(t[0])}destroy(){this.mView&&(this.mView.destroy(),this.mView=null),this.mScene=null}onClickMenuHandler(t){const e=this.mView.getData("data");if(!(t&&e&&this.world&&this.world.connection))return;if(this.hide(),t.platformid)return void("关注"===t.text?this.world.httpService.follow(t.platformid):"取消关注"===t.text&&this.world.httpService.unfollow(t.platformid));const i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),s=i.content;s.uiId=e.id,s.componentId=t.id,this.world.connection.send(i)}onClosePanel(t,e){this.hide()}}},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"StorageMediator",(function(){return a}));var s=i(12);class a extends s.a{constructor(t){super(t)}isShow(){return this.mView.isShow()}resize(){}getView(){return this.mView}show(t){this.mView&&(this.mView.show(t),super.show(t))}update(t){this.mView&&this.mView.update(t)}hide(){this.mView&&this.mView.hide()}destroy(){this.mView&&(this.mView.destroy(),this.mView=null)}}},function(t,e,i){"use strict";i.r(e),i.d(e,"StoragePanel",(function(){return n}));var s=i(8),a=i(27),r=i(4);class n extends s.Panel{constructor(t,e){super(t),this.mWorld=e}resize(){const t=this.mWorld.getSize();this.x=t.width>>1,this.y=t.height-200}show(t){super.show(t)}update(t){super.update(t)}destroy(){if(this.mBg&&(this.mBg.destroy(!0),this.mBg=null),this.mClsBtnSprite&&(this.mClsBtnSprite.destroy(!0),this.mClsBtnSprite=null),this.mBagItemSlotList){const t=this.mBagItemSlotList.length;for(let e=0;e<t;e++){let t=this.mBagItemSlotList[e];t&&(t.destroy(),t=null)}this.mBagItemSlotList=null}this.mWorld=null,super.destroy()}init(){if(this.mInitialized)return;super.init(),this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(this.mResStr,"itemBagView_bg"),this.addAt(this.mBg,0),this.mWidth=this.mBg.width,this.mHeight=this.mBg.height;const t=this.mScene.make.image(void 0,!1);t.setTexture(this.mResStr,"itemBagView_title"),t.x=80+(-this.mBg.width>>1),t.y=-this.mBg.height>>1,this.add(t);const e=this.mScene.make.text(void 0,!1);let i;e.setFontFamily("Tahoma"),e.setFontStyle("bold"),e.setFontSize(20),e.setText("书柜"),e.x=t.x+t.width-10,e.y=t.y-(e.height>>1),this.add(e);let s=0,r=0;this.mBagItemSlotList=[];for(let t=0;t<9;t++)s=t%9*60+32-362,r=60*Math.floor(t/9)-55,(i=new a.ItemSlot(this.mScene,this.mWorld,this,s,r,this.mResStr,this.mResPng,this.mResJson,"bagView_slot","bagView_itemSelect")).createUI(),this.mBagItemSlotList.push(i);this.mScene.cache.obj.has("clsBtn")?this.onClsLoadCompleteHandler():(this.mScene.load.spritesheet("clsBtn","resources/ui/common/common_clsBtn.png",{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onClsLoadCompleteHandler,this),this.mScene.load.start())}preload(){this.mScene&&(this.mResStr="bagView",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.mScene.load.atlas(this.mResStr,r.h.getRes(this.mResPng),r.h.getRes(this.mResJson)),super.preload())}onClsLoadCompleteHandler(){this.mClsBtnSprite=this.mScene.make.sprite(void 0,!1),this.mClsBtnSprite.setTexture("clsBtn","btn_normal"),this.mClsBtnSprite.x=(this.mWidth>>1)-65,this.mClsBtnSprite.y=-this.mHeight>>1,this.mClsBtnSprite.setInteractive(),this.mClsBtnSprite.on("pointerup",this.hide,this),this.add(this.mClsBtnSprite)}}},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"MessageBoxUI",(function(){return s})),i.d(e,"MessageBtn",(function(){return a}));class s extends Phaser.GameObjects.Container{constructor(t,e){super(t),this.mScene=t,this.mConfig=e,this.init()}selectCall(t){this.mtxt.text=t.text,this.mtxt.x=this.mConfig.wid-this.mtxt.width>>1,this.mtxt.y=this.mConfig.hei-this.mtxt.height>>1,this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)}init(){const t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())}onLoadCompleteHandler(){const t=this.mConfig.resKey,e=this.mConfig.resBtn;if(this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2,this.mBg.y=this.mConfig.hei/2,this.mBg.setSize(this.mConfig.wid,this.mConfig.hei),this.mBtnList=[],this.mConfig.btnData){const i=this.mConfig.btnData.length;let s;for(let r=0;r<i;r++)s=new a(this.mScene,this,t,e,this.mConfig.btnWid,this.mConfig.btnHei),this.mBtnList.push(s)}this.mtxt=this.mScene.make.text({x:0,y:0,style:{fill:"#F7EDED",fontSize:18}},!1),this.add(this.mBg),this.add(this.mtxt)}}class a extends Phaser.GameObjects.Container{constructor(t,e,i,s,a,r){super(t),this.messageBoxUI=e,this.mBtn=t.make.image(void 0,!1),this.mBtn.setTexture(i,s),this.mText=this.scene.make.text({x:-a>>1,y:-r>>1,style:{fill:"#F7EDED",fontSize:18}},!1),this.add(this.mBtn),this.add(this.mText),this.setSize(a,r),this.setInteractive(),this.on("pointerdown",this.selectHandler,this)}set itemData(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width/2+(this.width-this.mText.width>>1),this.mText.y=-this.height/2+(this.height-this.mText.height>>1)}get itemData(){return this.mData}destroy(){this.mText.destroy(!0),this.mBtn.destroy(!0),this.mData=null,super.destroy(!0)}selectHandler(){this.addTween(this.mBtn),this.messageBoxUI.selectCall(this.itemData)}addTween(t){this.scene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=t.scaleY=1}}},function(t,e,i){"use strict";i.r(e),i.d(e,"ScrollerContainer",(function(){return n}));var s=i(6),a=i(159),r=Phaser.GameObjects;class n extends a.a{constructor(t,e,i){if(super(t),!i)return void s.a.getInstance().error("scroller target does not exise");new r.Graphics(t).fillStyle(51,1).fillRect(e.x,e.y,e.width,e.height).setInteractive(e,Phaser.Geom.Rectangle.Contains);i.setMask(this.mMask.createGeometryMask()),this.mScroller=new a.a(this.mMask,{valuechangeCallback:t=>{i.y=t}})}}},function(t,e,i){"use strict";var s;i.r(e),i.d(e,"DirectionType",(function(){return s})),i.d(e,"SrollerView",(function(){return a})),function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"}(s||(s={}));class a{constructor(t,e,i,s,a,r,n,o,h,l=0){this.mScene=t,this.mWorld=e,this.mConfig={x:i,y:s,width:a,height:r,scrollMode:n,space:{left:l,right:l,top:l,bottom:l,panel:l,header:l,footer:l},itemClass:o,itemSize:h},this.mShowLen=0===n?Math.ceil(a/h):Math.ceil(r/h),this.init(t,i,s,a,r,n,o,l)}createItem(t,e,i){}setChild(t){if(this.mScrollablePanel){const e=this.mConfig.scrollMode,i=this.mConfig.width,s=this.mConfig.height,a=this.mConfig.item,r=(this.mConfig.itemSize,0===e?void 0===i:void 0===s),n=t.length>this.mShowLen?this.mShowLen:t.length;this.mItemList=[];for(let t=0;t<n;t++){const t=new a;this.mItemList.push(t)}this.mScrollablePanel.childrenMap.child.setChild(this.mItemList,r)}}init(t,e,i,s,a,r,n,o){this.mScrollablePanel=t.rexUI.add.scrollablePanel(t,{x:e,y:i,width:s,height:a,scrollMode:r,panel:{child:this.mItemList,mask:{mask:!0,padding:1}},slider:{},space:{left:10,right:10,top:10,bottom:10,panel:10,header:10,footer:10}}).layout()}}},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"Friend",(function(){return r})),i.d(e,"FriendItem",(function(){return n}));var s=i(8),a=i(4);class r extends s.Panel{constructor(t,e){super(t),this.mWorld=e}resize(){this.mWorld.getSize();this.mShowing&&(this.mBg&&(this.mBg.destroy(!0),this.mBg=null),this.mWorld.game.device.os.desktop?(this.x=0,this.y=0):(this.mWorld.game.scale.orientation,Phaser.Scale.Orientation.LANDSCAPE))}preload(){this.mScene&&(this.scene.load.image(a.a.getName(),a.a.getPNG()),this.scene.load.image(a.d.getName(),a.d.getPNG()),this.mScene.load.atlas("friend",a.h.getRes("ui/juqing/juqing.png"),a.h.getRes("ui/juqing/juqing.json")),super.preload())}init(){super.init()}}class n{constructor(){}setData(t){}}},function(t,e){},function(t,e,i){"use strict";var s={add(t){return Array.isArray(t)?this.addMultiple(t):this._add(t),this},addMultiple(t){return t.forEach(this._add,this),this},_add(t){return this.children.add(t),this.resetChildState(t).updateChildVisible(t).updateChildActive(t).updateChildScrollFactor(t).updateChildMask(t),this}},a={remove(t,e){return this.children.remove(t,!1,e),this},clear(t){return this.children.clear(!1,t),this}},r={getLocalState:t=>(t.hasOwnProperty("rexContainer")||(t.rexContainer={}),t.rexContainer),resetChildState(t){return this.resetChildPositionState(t).resetChildVisibleState(t).resetChildAlphaState(t).resetChildActiveState(t),this},resetChildrenState(t){for(var e=0,i=t.length;e<i;e++)this.resetChildState(t[e]);return this},syncProperties(){return this.syncPosition().syncVisible().syncAlpha().syncActive().syncScrollFactor().syncMask(),this}};const n=Phaser.Math.RotateAround;var o={worldToLocal(t){return t.x-=this.x,t.y-=this.y,n(t,0,0,-this.rotation),t.x/=this.scaleX,t.y/=this.scaleY,t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t},localToWorld(t){return t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t.x*=this.scaleX,t.y*=this.scaleY,n(t,0,0,this.rotation),t.x+=this.x,t.y+=this.y,t}},containerlite_Scale=function(t,e){return t===e?1:t/e},h={updateChildPosition(t){t.isRexContainerLite&&(t.syncChildrenEnable=!1);var e=this.getLocalState(t);return t.x=e.x,t.y=e.y,this.localToWorld(t),t.scaleX=e.scaleX*this.scaleX,t.scaleY=e.scaleY*this.scaleY,void 0!==t.flipX&&(t.flipX=this.flipX?!e.flipX:e.flipX,t.flipY=this.flipY?!e.flipY:e.flipY),t.rotation=e.rotation+this.rotation,t.isRexContainerLite&&(t.syncChildrenEnable=!0,t.syncPosition()),this},syncPosition(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildPosition,this),this},resetChildPositionState(t){var e=this.getLocalState(t);return e.x=t.x,e.y=t.y,this.worldToLocal(e),e.scaleX=containerlite_Scale(t.scaleX,this.scaleX),e.scaleY=containerlite_Scale(t.scaleY,this.scaleY),void 0!==t.flipX&&(e.flipX=t.flipX,e.flipY=t.flipY),e.rotation=t.rotation-this.rotation,this},setChildPosition(t,e,i){return t.x=e,t.y=i,this.resetChildPositionState(t),this},setChildLocalPosition(t,e,i){var s=this.getLocalState(t);return s.x=e,s.y=i,this.updateChildPosition(t),this}},l={updateChildVisible(t){return t.visible=this.visible&&this.getLocalState(t).visible,this},syncVisible(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildVisible,this),this},resetChildVisibleState(t){return this.getLocalState(t).visible=t.visible,this},setChildVisible(t,e){return t.visible=e,this.resetChildVisibleState(t),this},setChildLocalVisible(t,e){return void 0===e&&(e=!0),this.getLocalState(t).visible=e,this.updateChildVisible(t),this}},c={updateChildAlpha(t){return t.alpha=this.alpha*this.getLocalState(t).alpha,this},syncAlpha(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildAlpha,this),this},resetChildAlphaState(t){return this.getLocalState(t).alpha=containerlite_Scale(t.alpha,this.alpha),this},setChildAlpha(t,e){return t.alpha=e,this.resetChildAlphaState(t),this._add},setChildLocalAlpha(t,e){return this.getLocalState(t).alpha=e,this.updateChildAlpha(t),this}},d={updateChildActive(t){return t.active=this.active&&this.getLocalState(t).active,this},syncActive(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildActive,this),this},resetChildActiveState(t){return this.getLocalState(t).active=t.active,this},setChildActive(t,e){return t.active=e,this.resetChildActiveState(t),this},setChildLocalActive(t,e){return void 0===e&&(e=!0),this.getLocalState(t).active=e,this.updateChildActive(t),this}},m={updateChildScrollFactor(t){return t.setScrollFactor(this.scrollFactorX,this.scrollFactorY),this},syncScrollFactor(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildScrollFactor,this),this}},u={updateChildMask(t){return null==this.mask?this:((this.mask.hasOwnProperty("geometryMask")?this.mask.geometryMask:this.mask.bitmapMask)!==t&&(t.mask=this.mask),this)},syncMask(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildMask,this),this},setMask(t){return this.mask=t,this},clearMask(t){return void 0===t&&(t=!1),t&&this.mask&&this.mask.destroy(),this.mask=null,this}},p={setDepth(t){if(this.depth=t,this.children)for(var e=this.getAllChildren(),i=0,s=e.length;i<s;i++)e[i].depth=t;return this},swapDepth(t){var e=this.depth,i=t.depth;return this.setDepth(i),t.setDepth(e),this},incDepth(t){if(this.depth+=t,this.children)for(var e=this.getAllChildren(),i=0,s=e.length;i<s;i++)e[i].depth+=t;return this}};const g=Phaser.Utils.Array;var f={getChildren(){return this.children.getChildren()},getAllChildren(t){void 0===t&&(t=[]);for(var e,i=this.children.getChildren(),s=0,a=i.length;s<a;s++)e=i[s],t.push(e),e.hasOwnProperty("isRexContainerLite")&&t.push(...e.getAllChildren());return t},contains(t){if(this.children.contains(t))return!0;for(var e,i=this.children.getChildren(),s=0,a=i.length;s<a;s++)if((e=i[s]).isRexContainerLite&&e.contains(t))return!0;return!1},getByName(t){return g.GetFirst(this.list,"name",t)},getRandom(t,e){return g.GetRandom(this.list,t,e)},getFirst(t,e,i,s){return g.GetFirstElement(this.list,t,e,i,s)},getAll(t,e,i,s){return g.GetAll(this.list,t,e,i,s)},count(t,e,i,s){return g.CountAllMatching(this.list,t,e,i,s)},swap(t,e){return g.Swap(this.list,t,e),this},moveTo(t,e){return g.MoveTo(this.list,t,e),this},setAll(t,e,i,s){return g.SetAll(this.list,t,e,i,s),this}};const _=Phaser.GameObjects.Zone,y=Phaser.GameObjects.Components;class v extends _{constructor(t,e,i,s,a,r){Array.isArray(s)&&(r=s,s=void 0),void 0===s&&(s=1),void 0===a&&(a=1),super(t,e,i,s,a),this.children=t.add.group(),this.type="rexContainerLite",this.isRexContainerLite=!0,this.syncChildrenEnable=!0,this._flipX=!1,this._flipY=!1,this._alpha=1,this._active=!0,this._mask=null,this._scrollFactorX=1,this._scrollFactorY=1,r&&this.add(r)}destroy(t){this.scene&&(this.children.destroy(!t),this.children=void 0,super.destroy(t))}resize(t,e){return this.setSize(t,e),this}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.syncPosition())}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.syncPosition())}get rotation(){return super.rotation}set rotation(t){this.rotation!==t&&(super.rotation=t,this.syncPosition())}get scaleX(){return super.scaleX}set scaleX(t){this.scaleX!==t&&(super.scaleX=t,this.syncPosition())}get scaleY(){return super.scaleY}set scaleY(t){this.scaleY!==t&&(super.scaleY=t,this.syncPosition())}get flipX(){return this._flipX}set flipX(t){this._flipX!==t&&(this._flipX=t,this.syncPosition())}get flipY(){return this._flipY}set flipY(t){this._flipY!==t&&(this._flipY=t,this.syncPosition())}get visible(){return super.visible}set visible(t){this.visible!==t&&(super.visible=t,this.syncVisible())}get alpha(){return this._alpha}set alpha(t){this._alpha!==t&&(this._alpha=t,this.syncAlpha())}get active(){return this._active}set active(t){this._active!==t&&(this._active=t,this.syncActive())}get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t,this.syncMask())}get scrollFactorX(){return this._scrollFactorX}set scrollFactorX(t){this._scrollFactorX!==t&&(this._scrollFactorX=t,this.syncScrollFactor())}get scrollFactorY(){return this._scrollFactorY}set scrollFactorY(t){this._scrollFactorY!==t&&(this._scrollFactorY=t,this.syncScrollFactor())}get list(){return this.children.getChildren()}}Object.assign(v.prototype,s,a,r,o,h,l,c,m,d,u,p,f,y.Alpha,y.Flip);e.a=v},function(t,e,i){"use strict";var s=i(244),a=i.n(s),r=i(245),n=i.n(r),o=i(23),h=(o.a,o.a,{renderWebGL:a.a,renderCanvas:n.a}),l=i(104),c=i(26);c.a.hleft;const d=c.a.hcenter,m=c.a.hright,u=(c.a.vtop,c.a.vcenter),p=c.a.vbottom;var g={draw(t,e,i,s){var a=this.penManager;this.hitAreaManager.clear();var r=this.context;r.save(),this.drawBackground(this.defatultStyle.backgroundColor);var n=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var o,h,l,c,g,f,_=n.halign,y=n.valign,v=n.lineHeight,S=a.lines,b=S.length,T=n.maxLines;T>0&&b>T?(h=T,l=y===u?Math.floor((b-h)/2):y===p?b-h:0):(h=b,l=0),c=l+h,f=y===u?Math.max((s-h*v)/2,0):y===p?Math.max(s-h*v-2,0):0,f+=e;for(var D=l;D<c;D++)if(0!==(o=a.getLineWidth(D))){g=_===d?(i-o)/2:_===m?i-o:0,g+=t;for(var x=S[D],P=0,C=x.length;P<C;P++)this.drawPen(x[P],g,f)}r.restore()},drawPen(t,e,i){e+=t.x,i+=t.y;var s=this.canvas,a=this.context;a.save();var r=this.parser.propToContextStyle(this.defatultStyle,t.prop);r.buildFont(),r.syncFont(s,a),r.syncStyle(s,a),r.underlineThickness>0&&t.width>0&&this.drawUnderline(e,i,t.width,r),t.isTextPen&&this.drawText(e,i,t.text,r),t.isImagePen&&this.drawImage(e,i,t.prop.img,r),a.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,i-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,i,s){e+=s.underlineOffset-s.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var a=this.context,r=a.lineCap;a.lineCap="butt",a.beginPath(),a.strokeStyle=s.underlineColor,a.lineWidth=s.underlineThickness,a.moveTo(t,e),a.lineTo(t+i,e),a.stroke(),a.lineCap=r},drawText(t,e,i,s){this.autoRound&&(t=Math.round(t),e=Math.round(e));var a=this.context;s.strokeThickness&&(s.syncShadow(a,s.shadowStroke),a.strokeText(i,t,e)),s.color&&"none"!==s.color&&(s.syncShadow(a,s.shadowFill),a.fillText(i,t,e))},drawImage(t,e,i,s){var a=this.parent.imageManager,r=a.get(i),n=a.getFrame(i);t+=r.left,e+=-this.startYOffset+r.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(n.source.image,n.cutX,n.cutY,n.cutWidth,n.cutHeight,t,e,r.width,r.height)}},f=i(47);const _=Phaser.Utils.Objects.GetValue,y=c.a.NO_NEWLINE,v=c.a.RAW_NEWLINE;var S=class{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=_(t,"text",""),this.x=_(t,"x",0),this.y=_(t,"y",0),this.width=_(t,"width",0);var e=_(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=_(t,"newLineMode",0),this.startIndex=_(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===v&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==y&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===v&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},b=i(76),object_Clone=function(t,e){var i=Array.isArray(t);for(var s in void 0===e?e=i?[]:{}:Object(b.a)(e),i&&(e.length=t.length),t)e[s]=t[s];return e};const T=Phaser.Utils.Objects.GetFastValue,D=c.a.NO_NEWLINE,x=c.a.WRAPPED_NEWLINE;var P=new f.a,C=new f.a;class w{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=T(t,"pensPool",P),this.LinesPool=T(t,"linesPool",C),this.tagToText=T(t,"tagToText",o.a),this.tagToTextScope=T(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,s,a,r){var n=this.PensPool.pop();return null==n&&(n=new S),O.text=t,O.x=e,O.y=i,O.width=s,O.prop=a,O.newLineMode=r,n.resetFromJSON(O),this.addPen(n),this}addImagePen(t,e,i,s){return this.addTextPen("",t,e,i,s,D),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,s=t?object_Clone(t.prop):null;return this.addTextPen("",e,i,0,s,x),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(t),t.newLineMode!==D&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new w),t.freePens();for(var e=0,i=this.lines.length;e<i;e++)for(var s=this.lines[e],a=0,r=s.length;a<r;a++){var n=s[a];t.addPen(n.text,n.x,n.y,n.width,object_Clone(n.prop),n.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,s=!1;for(e=t;e>=0&&!(s=null!=(i=this.lines[e])&&i.length>0);e--);return s?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,s=this.lines.length;i<s;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,s=e.length;i<s;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,s=this.pens.length;i<s;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){if(void 0===t&&(t=0),void 0===e){var s=this.lastPen;if(null==s)return"";e=s.endIndex}void 0===i&&(i=!1);for(var a,r,n,o,h,l,c="",d=0,m=this.pens.length;d<m&&((o=(a=this.pens[d]).endIndex)<=t||(a=this.pens[d],r=i?a.wrapText:a.plainText,h=a.prop,(n=a.startIndex)>=t&&o<=e||(r=r.substring(t-n,e-n)),this.tagToTextScope?c+=this.tagToText.call(this.tagToTextScope,r,h,l):c+=this.tagToText(r,h,l),l=h,!(o>=e)));d++);return c}}var O={},A=w;const B=Phaser.Geom.Rectangle;var E=new f.a;var I=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return E.pushMultiple(this.hitAreas),this}add(t,e,i,s,a){var r=E.pop();return null===r?r=new B(e,i,s,a):r.setTo(e,i,s,a),r.key=t,this.hitAreas.push(r),this}contains(t,e){for(var i,s=this.hitAreas,a=0,r=s.length;a<r;a++)if((i=s[a]).contains(t,e))return i.key;return!1}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var s,a=this.hitAreas,r=0,n=a.length;r<n;r++)s=a[r],t.lineStyle(1,e).strokeRect(s.x,s.y,s.width,s.height);return i&&t.restore(),this}},FireEvent=function(t,e,i,s){var a=this.hitAreaManager.contains(i,s);!1!==a&&(this.parent.emit(`${t}-${a}`,e,i,s),this.parent.emit(t,a,e,i,s))},canvastext_SetInteractive=function(){this.parent.on("pointerdown",(function(t,e,i,s){FireEvent.call(this,"areadown",t,e,i)}),this).on("pointerup",(function(t,e,i,s){FireEvent.call(this,"areaup",t,e,i)}),this)};const M=c.a.NO_NEWLINE,k=c.a.RAW_NEWLINE,R=c.a.WRAPPED_NEWLINE,L=c.a.NO_WRAP,F=c.a.WORD_WRAP,N=(c.a.CHAR_WRAP,c.a.SPLITREGEXP);var j=[],W=new f.a;W.newline=function(t,e,i){var s=this.pop();return null===s&&(s={}),s.text=t,s.width=e,s.newLineMode=i,s};var canvastext_WrapText=function(t,e,i,s,a){s<=0&&(i=L);var r=j;if(W.pushMultiple(r),!t||!t.length)return r;for(var n,o,h,l=t.split(N),c=0,d=l.length;c<d;c++)if(n=l[c],h=c===d-1?M:k,i!==L){var m,u;if(o=0===c?s-a:s,n.length<=100)if((S=e(n))<=o){r.push(W.newline(n,S,h));continue}for(var p,g="",f="",_=0,y=0,v=(m=i===F?n.split(" "):n).length;y<v;y++)u=m[y],i===F?(g+=u,y<v-1&&(g+=" ")):g+=u,(p=e(g))>o&&(0===y?r.push(W.newline("",0,R)):(r.push(W.newline(f,_,R)),g=u,i===F&&y<v-1&&(g+=" "),p=e(g)),o=s),f=g,_=p;r.push(W.newline(f,_,h))}else{var S=e(n);r.push(W.newline(n,S,h))}return r};const H=Phaser.Utils.Objects.GetValue,V=c.a.NO_WRAP,z=c.a.NO_NEWLINE;class G{constructor(t){this.parent=t.parent,this.context=H(t,"context",null),this.canvas=this.context.canvas,this.parser=H(t,"parser",null),this.defatultStyle=H(t,"style",null),this.autoRound=!0,this.pensPool=H(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new I;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,i,s,a){if(void 0===a&&(a=this.penManager),a.freePens(),""===t)return a;for(var r,n,o,h,l,c=this.canvas,d=this.context,m=0,u=0,p=this.parser.splitText(t),g=0,f=p.length;g<f;g++)if(r=(h=this.parser.tagTextToProp(p[g],n)).plainText,(n=h.prop).img){var _=this.imageManager.getOuterWidth(n.img);i>0&&e!==V&&i<m+_&&(a.addNewLinePen(),u+=s,m=0),a.addImagePen(m,u,_,object_Clone(n)),m+=_}else if(""!==r){var y;this.context.save(),(o=this.parser.propToContextStyle(this.defatultStyle,n)).buildFont(),o.syncFont(c,d),o.syncStyle(c,d);for(var v=0,S=(l=canvastext_WrapText(r,this.getTextWidth,e,i,m)).length;v<S;v++)y=l[v],a.addTextPen(y.text,m,u,y.width,object_Clone(n),y.newLineMode),y.newLineMode!==z?(m=0,u+=s):m+=y.width;this.context.restore()}return a}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new A({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var s;if(null==t)s=this.penManager.plainText;else{var a=this.parser.splitText(t,1);s="";for(var r=0,n=a.length;r<n;r++)s+=a[r]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=s.length),s=s.substring(e,i)),s}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,s){if(null==t)return this.penManager.getSliceTagText(e,i,s);var a=this.tmpPenManager,r=this.defatultStyle;return this.updatePenManager(t,r.wrapMode,r.wrapWidth,r.lineHeight,a),a.getSliceTagText(e,i,s)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var U={setInteractive:canvastext_SetInteractive};Object.assign(G.prototype,g,U);var Y=G;const X=Phaser.Utils.Objects.GetValue;var K,Q=class{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var i=0,s=(a=t).length;i<s;i++)this._add(a[i]);else{var a=t;for(var t in a)this._add(t,a[t])}return this}_add(t,e){void 0===e&&(e={key:t});var i=e.key,s=e.frame,a=e.width,r=e.height;if(void 0===a||void 0===r){var n=this.textureManager.getFrame(i,s),o=n?n.cutWidth:0,h=n?n.cutHeight:0;void 0===a&&void 0===r?(a=o,r=h):void 0===a?a=o*(r/h):void 0===r&&(r=h*(a/o))}this.images[t]={key:i,frame:s,width:a,height:r,y:X(e,"y",0),left:X(e,"left",0),right:X(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}},GetGlobImageManager=function(t){return void 0===K&&(K=new Q(t)),K};const $=Phaser.DOM.AddToDOM,Z=Phaser.Display.Canvas.CanvasPool,J=Phaser.GameObjects.GameObject,q=Phaser.Utils.Objects.GetValue,tt=Phaser.DOM.RemoveFromDOM,et=c.a.SPLITREGEXP;var it={};class st extends J{constructor(t,e,i,s,a,r,n){if(void 0===e&&(e=0),void 0===i&&(i=0),super(t,r),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=Z.create(this),this.context=this.canvas.getContext("2d"),a&&a.hasOwnProperty("align")){var o=a.align;delete a.align,a.halign=o}this.style=new l.a(this,a),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),it.hasOwnProperty(r)||(it[r]=new f.a),this.canvasText=new Y({parent:this,context:this.context,parser:n,style:this.style,pensPool:it[r]}),a&&a.padding&&this.setPadding(a.padding),this.setText(s),t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",$(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t){return this.style.setBackgroundColor(t)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,i,s,a,r){return this.style.setShadow(t,e,i,s,a,r)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setLineSpacing(t){return this.style.setLineSpacing(t)}setPadding(t,e,i,s){if("object"==typeof t){var a=t,r=q(a,"x",null);null!==r?(t=r,i=r):(t=q(a,"left",0),i=q(a,"right",t));var n=q(a,"y",null);null!==n?(e=n,s=n):(e=q(a,"top",0),s=q(a,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===s&&(s=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=s,this.updateText(!1)}setResolution(t){return this.style.setResolution(t)}setMaxLines(t){return this.style.setMaxLines(t)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var s,a,r=this.padding;0===i.fixedWidth?(this.width=e.linesWidth+r.left+r.right,s=e.linesWidth):(this.width=i.fixedWidth,(s=this.width-r.left-r.right)<e.linesWidth&&(s=e.linesWidth)),0===i.fixedHeight?(this.height=e.linesHeight+r.top+r.bottom,a=e.linesHeight):(this.height=i.fixedHeight,(a=this.height-r.top-r.bottom)<e.linesHeight&&(a=e.linesHeight));var n=this.width,o=this.height;this.updateDisplayOrigin();var h=i.resolution;n*=h,o*=h,n=Math.max(Math.ceil(n),1),o=Math.max(Math.ceil(o),1);var l=this.canvas,c=this.context;l.width!==n||l.height!==o?(l.width=n,l.height=o,this.frame.setSize(n,o)):c.clearRect(0,0,n,o),c.save(),c.scale(h,h),e.draw(r.left,r.top,s,a),c.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var d=this.input;return d&&!d.customHitArea&&(d.hitArea.width=this.width,d.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var t=at.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}preDestroy(){this.style.rtl&&tt(this.canvas),Z.remove(this.canvas),this.canvasText.destroy()}setInteractive(t,e,i){return J.prototype.setInteractive.call(this,t,e,i),this.canvasText.setInteractive(),this}getWrappedText(t,e,i){return(t=this.canvasText.getText(t,e,i,!0)).split(et)}getPlainText(t,e,i){return this.canvasText.getPlainText(t,e,i)}getText(t,e,i){return this.canvasText.getText(t,e,i,!1)}getSubString(t,e,i){return this.getText(t,e,i)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}set lineSpacing(t){this.setLineSpacing(t)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return GetGlobImageManager(this.scene.textures)}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}const at=Phaser.GameObjects.Components;Phaser.Class.mixin(st,[at.Alpha,at.BlendMode,at.ComputedSize,at.Crop,at.Depth,at.Flip,at.GetBounds,at.Mask,at.Origin,at.Pipeline,at.ScrollFactor,at.Tint,at.Transform,at.Visible,h]);e.a=st},function(t,e,i){"use strict";var s=i(36),a=i(42),r=i(132),n=i(43);const o=Phaser.Display.Align.TOP_LEFT;var textblock_SetTextObject=function(t,e,i){void 0===i&&(i=!0),this.add(t),void 0===e&&(e=0);var s=this.getSizerConfig(t);return s.parent=this,s.align=o,s.padding=Object(a.a)(e),s.expand=!0,this.textObject=t,this.textObjectType=Object(r.a)(t)?0:1,s.preOffsetY=0,s.offsetY=0,i&&(this.textMask=new n.a(this.textObject),this.textObject.setMask(this.textMask.createGeometryMask()),this.add(this.textMask)),this},textblock_SetText=function(t){return void 0!==t&&(this.text=t),0===this.textObjectType?this.lines=this.textObject.getWrappedText(this.text):this.lines=this.textObject.getPenManager(this.text,this.lines),this.updateTextObject(),this},textblock_TextHeightToLinesCount=function(t){return(t-this.textLineSpacing)/(this.textLineHeight+this.textLineSpacing)},textblock_LinesCountToTextHeight=function(t){return t*(this.textLineHeight+this.textLineSpacing)-this.textLineSpacing},textblock_GetLines=function(t){var e,i=t+this.textObject.style.maxLines;if(0===this.textObjectType)e=this.lines.slice(t,i).join("\n");else{var s=this.lines.getLineStartIndex(t),a=this.lines.getLineEndIndex(i-1);e=this.lines.getSliceTagText(s,a,!0)}return e},textblock_ResetTextObjectPosition=function(){var t=this.textObject.rexSizer;this.textObject.y+=t.offsetY-t.preOffsetY,t.preOffsetY=t.offsetY,this.resetChildPositionState(this.textObject)},textblock_UpdateTextObject=function(){var t=Math.max(Math.floor(textblock_TextHeightToLinesCount.call(this,-this.textOY)),0),e=textblock_LinesCountToTextHeight.call(this,t)+this.textOY;return this.textObject.setText(textblock_GetLines.call(this,t)),this.textObject.rexSizer.offsetY=e,textblock_ResetTextObjectPosition.call(this),this},textblock_ResizeText=function(t,e,i){if(t.width!==e||t.height!==i){t.setFixedSize(e,i);var s=t.style,a=Math.max(e,0),r=Math.ceil(textblock_TextHeightToLinesCount.call(this,i))+1;0===this.textObjectType?(s.wordWrapWidth=a,s.maxLines=r):(s.wrapWidth=a,s.maxLines=r),this.setText()}},h=i(35);const l=Phaser.Display.Align.In.QuickSet;var c={setTextObject:textblock_SetTextObject,setText:textblock_SetText,updateTextObject:textblock_UpdateTextObject,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var s,a,r;this.layoutInit(t),void 0===e&&(e=this.minWidth),void 0===i&&(i=this.minHeight),this.resize(e,i);var n,o,c,d,m=this.left,u=this.top;return(s=this.textObject).rexSizer.hidden||(n=m+(r=(a=s.rexSizer).padding).left,o=u+r.top,c=this.width-r.left-r.right,d=this.height-r.top-r.bottom,textblock_ResizeText.call(this,s,c,d),h.a.setPosition(n,o).setSize(c,d),l(s,h.a,a.align),this.textMask&&(this.textMask.setPosition().resize(),this.resetChildPositionState(this.textMask)),a.preOffsetY=0,textblock_ResetTextObjectPosition.call(this)),this.layoutBackgrounds(),this}};const d=Phaser.Utils.Objects.IsPlainObject,m=Phaser.Utils.Objects.GetValue;class u extends s.a{constructor(t,e,i,s,a,r){d(e)?(e=m(r=e,"x",0),i=m(r,"y",0),s=m(r,"width",void 0),a=m(r,"height",void 0)):d(s)&&(s=m(r=s,"width",void 0),a=m(r,"height",void 0)),super(t,e,i,s,a,r),this.type="rexTextBlock",this.textObject=void 0,this.textMask=void 0,this.textObjectType=void 0,this.lines=void 0,this.text=m(r,"content",""),this._textOY=0,this.execeedTopState=!1,this.execeedBottomState=!1,this.setClampMode(m(r,"clamplTextOY",!0));var n=m(r,"background",void 0),o=m(r,"text",void 0);void 0===o&&(o=createDefaultTextObject(t));var h=m(r,"textMask",!0),l=m(r,"space",void 0);n&&this.addBackground(n),this.setTextObject(o,l,h)}destroy(t){this.scene&&(this.textObject=void 0,this.textMask=void 0,void 0===this.lines||(0===this.textObjectType?this.lines.length=0:this.lines.destroy()),super.destroy(t))}setClampMode(t){return this.clampTextOYMode=t,this}get textLineHeight(){var t=this.textObject.style;return t.metrics.fontSize+t.strokeThickness}get textLineSpacing(){return this.textObject.lineSpacing}get linesCount(){return void 0===this.lines?0:0===this.textObjectType?this.lines.length:this.lines.linesCount}get visibleLinesCount(){return Math.floor(textblock_TextHeightToLinesCount.call(this,this.textObject.height))}get topTextOY(){return 0}get bottomTextOY(){return-this.textVisibleHeight}get textHeight(){return textblock_LinesCountToTextHeight.call(this,this.linesCount)}get textObjectHeight(){return this.textObject.height}get textVisibleHeight(){var t=this.textHeight,e=this.textObjectHeight;return t>e?t-e:0}textOYExceedTop(t){return void 0===t&&(t=this.textOY),t>this.topTextOY}textOYExeceedBottom(t){return void 0===t&&(t=this.textOY),t<this.bottomTextOY}get textOY(){return this._textOY}set textOY(t){var e=this.topTextOY,i=this.bottomTextOY,s=this.textOYExceedTop(t),a=this.textOYExeceedBottom(t);this.clampTextOYMode&&(this.visibleLinesCount>this.linesCount?t=0:s?t=e:a&&(t=i)),this._textOY!==t&&(this._textOY=t,this.updateTextObject()),s&&(this.execeedTopState||this.emit("execeedtop",this,t,e)),this.execeedTopState=s,a&&(this.execeedBottomState||this.emit("execeedbottom",this,t,i)),this.execeedBottomState=a}setTextOY(t){return this.textOY=t,this}set t(t){this.textOY=-this.textVisibleHeight*t}get t(){var t=this.textVisibleHeight;return 0===t?0:this.textOY/-t}setTextOYByPercentage(t){return this.t=t,this}}var createDefaultTextObject=function(t){return t.add.text(0,0,"")};Object.assign(u.prototype,c);e.a=u},function(t,e,i){"use strict";var s=i(15),a=i(25),r=i(29);class n extends r.a{constructor(t,e){super(e),this.parent=t,this.init()}init(){this.start("IDLE")}next_IDLE(){var t,e=this.parent;return e.dragState.isDown&&(t=0===e.dragThreshold?"DRAG":"DRAGBEGIN"),t}update_IDLE(t,e){this.next()}next_DRAGBEGIN(){var t=this.parent,e=t.dragState;return e.isDown?e.pointer.getDistance()>=t.dragThreshold?"DRAG":"DRAGBEGIN":"IDLE"}update_DRAGBEGIN(t,e){this.next()}next_DRAG(){var t,e=this.parent;return e.dragState.isUp&&(t=e.outOfBounds?"BACK":e.slidingEnable?"SLIDE":"IDLE"),t}update_DRAG(t,e){var i=this.parent;i.dragState.justMoved&&i.dragging(),this.next()}next_SLIDE(){var t,e=this.parent;return e.dragState.isDown?t="DRAG":e.isSliding||(t="IDLE"),t}enter_SLIDE(){this.parent.onSliding()}exit_SLIDE(){this.parent.stop()}update_SLIDE(t,e){this.parent.sliding(t,e),this.next()}next_BACK(){var t,e=this.parent;return e.dragState.isDown?t="DRAG":e.isPullBack||(t="IDLE"),t}enter_BACK(){this.parent.onPullBack()}exit_BACK(){this.parent.stop()}update_BACK(t,e){this.parent.pullBack(t,e),this.next()}}var o=n;const h=Phaser.Utils.Objects.GetValue,l=Phaser.Math.Distance.Between;class c{constructor(t,e){this.gameObject=t,this.scene=Object(s.a)(t),this.setEventEmitter(h(e,"eventEmitter",void 0)),t.setInteractive(h(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.pointer=void 0,this.isInTouched=!1,this.holdStartTime=void 0,this.x=void 0,this.y=void 0,this.preX=void 0,this.preY=void 0,this.localX=void 0,this.localY=void 0,this.justMoved=!1,this.setEnable(h(t,"enable",!0)),this.holdThreshold=h(t,"holdThreshold",50),this}boot(){this.gameObject.on("pointerdown",this.onPointIn,this),this.gameObject.on("pointerover",this.onPointIn,this),this.gameObject.on("pointerup",this.onPointOut,this),this.gameObject.on("pointerout",this.onPointOut,this),this.gameObject.on("pointermove",this.onPointerMove,this),this.gameObject.once("destroy",this.destroy,this),this.scene.events.on("preupdate",this.preupdate,this)}shutdown(){this.scene&&this.scene.events.off("preupdate",this.preupdate,this),this.pointer=void 0,this.gameObject=void 0,this.scene=void 0,this.destroyEventEmitter()}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||(this.isInTouched=!1,this.pointer=void 0),this.enable=t,this.gameObject.input.enabled=t,this)}get isDown(){return this.pointer&&this.pointer.isDown}get isUp(){return!this.isDown}get dx(){return this.x-this.preX}get dy(){return this.y-this.preY}get dt(){return this.scene.sys.game.loop.delta}get speed(){return this.x===this.preX&&this.y===this.preY?0:l(this.preX,this.preY,this.x,this.y)/(.001*this.dt)}get speedX(){return this.dx/(.001*this.dt)}get speedY(){return this.dy/(.001*this.dt)}onPointIn(t,e,i){t.isDown&&void 0===this.pointer&&(this.pointer=t,this.localX=e,this.localY=i)}onPointOut(t){this.pointer===t&&(this.pointer=void 0)}onPointerMove(t,e,i){t.isDown&&this.pointer===t&&(this.localX=e,this.localY=i)}preupdate(t,e){var i=this.pointer;this.justMoved=!1,i&&!this.isInTouched?(this.x=i.x,this.y=i.y,this.preX=i.x,this.preY=i.y,this.isInTouched=!0,this.holdStartTime=void 0,this.emit("touchstart",i,this.localX,this.localY)):i&&this.isInTouched?this.x===i.x&&this.y===i.y?void 0===this.holdStartTime?this.holdStartTime=t:t-this.holdStartTime>this.holdThreshold&&(this.preX=this.x,this.preY=this.y):(this.preX=this.x,this.preY=this.y,this.x=i.x,this.y=i.y,this.holdStartTime=void 0,this.justMoved=!0,this.emit("touchmove",i,this.localX,this.localY)):!i&&this.isInTouched&&(this.isInTouched=!1,this.holdStartTime=void 0,this.emit("touchend",i))}}Object.assign(c.prototype,a.a);var d=c;const m=Phaser.Utils.Objects.GetValue;var u=class{constructor(t){this.resetFromJSON(t)}resetFromJSON(t){return this.setValue(m(t,"value",0)),this.setSpeed(m(t,"speed",0)),this.setAcceleration(m(t,"acceleration",0)),this}reset(){this.setValue(0),this.setSpeed(0),this.setAcceleration(0)}setValue(t){return this.value=t,this}setSpeed(t){return this.speed=t,this}setAcceleration(t){return this.acceleration=t,this}updateSpeed(t){return 0!==this.acceleration&&(this.speed+=this.acceleration*t,this.speed<0&&(this.speed=0)),this}getDeltaValue(t){return this.updateSpeed(t),this.speed<=0?0:this.speed*t}update(t){return this.updateSpeed(t),this.speed>0&&(this.value+=this.getDeltaValue(t)),this}get isMoving(){return this.speed>0}};var p=class{constructor(){this.value,this.dir,this.movement=new u}init(t,e,i,s,a){return this.value=t,this.end=a,this.dir=void 0!==a?t<a:e,this.movement.setSpeed(i).setAcceleration(-s),this}stop(){this.movement.reset()}update(t){var e=this.movement.getDeltaValue(t);return this.dir||(e=-e),void 0===this.end?this.value+=e:0===e?this.value=this.end:(this.value+=e,this.dir?this.value>this.end&&(this.value=this.end):this.value<this.end&&(this.value=this.end)),this}get isMoving(){return this.movement.isMoving}};const g=Phaser.Utils.Objects.GetValue;class f{constructor(t,e){this.gameObject=t,this.scene=Object(s.a)(t),this.setEventEmitter(g(e,"eventEmitter",void 0));var i=g(e,"enable",!0),a={enable:i,eventEmitter:!1};this._state=new o(this,a);var r={inputConfig:g(e,"inputConfig",void 0),enable:i,eventEmitter:!1};this.dragState=new d(t,r),this._value=void 0,this._slowDown=new p;var n=g(e,"valuechangeCallback",null);if(null!==n){var h=g(e,"valuechangeCallbackScope",void 0);this.on("valuechange",n,h)}if(null!==(n=g(e,"overmaxCallback",null))){h=g(e,"overmaxCallbackScope",void 0);this.on("overmax",n,h)}if(null!==(n=g(e,"overminCallback",null))){h=g(e,"overminCallbackScope",void 0);this.on("overmin",n,h)}this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setOrientationMode(g(t,"orientation",0)),this.setDragThreshold(g(t,"threshold",10)),this.setSlidingDeceleration(g(t,"slidingDeceleration",5e3)),this.setBackDeceleration(g(t,"backDeceleration",2e3));var e=g(t,"bounds",void 0);return e?this.setBounds(e):this.setBounds(g(t,"max",0),g(t,"min",0)),this.setValue(g(t,"value",this.maxValue||0)),this.setEnable(g(t,"enable",!0)),this}boot(){this.scene.events.on("update",this._state.update,this._state),this.gameObject.once("destroy",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.scene&&this.scene.events.off("update",this._state.update,this._state),this.gameObject=void 0,this.scene=void 0,this._state.destroy(),this.dragState.destroy()}destroy(){this.shutdown()}setOrientationMode(t){return"string"==typeof t&&(t=_[t]),this.orientationMode=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setSlidingDeceleration(t){return this.slidingDeceleration=t,this}setBackDeceleration(t){return this.backDeceleration=t,this}setBounds(t,e){if(Array.isArray(t)){var i=t;t=i[0],e=i[1]}return t<e?(this.minValue=t,this.maxValue=e):(this.minValue=e,this.maxValue=t),this}get value(){return this._value}set value(t){if(t!==this._value){var e=this._value,i=this.overMax(t),s=this.overMin(t);i&&this.emit("overmax",t,e),s&&this.emit("overmin",t,e),this.backEnable||(i&&(t=this.maxValue),s&&(t=this.minValue)),this._value=t,this.emit("valuechange",t,e)}}setValue(t){this.value=t}setEnable(t){return this._state.setEnable(t),this.dragState.setEnable(t),this}get state(){return this._state.state}get isDragging(){return this.dragState.isInTouched}get outOfMaxBound(){return this.overMax(this.value)}get outOfMinBound(){return this.overMin(this.value)}get outOfBounds(){return this.outOfMinBound||this.outOfMaxBound}overMax(t){return null!=this.maxValue&&t>this.maxValue}overMin(t){return null!=this.minValue&&t<this.minValue}get backEnable(){return"number"==typeof this.backDeceleration}get isPullBack(){return this._slowDown.isMoving}get slidingEnable(){return"number"==typeof this.slidingDeceleration}get isSliding(){return this._slowDown.isMoving}get dragDelta(){return 0===this.orientationMode?this.dragState.dy:1===this.orientationMode?this.dragState.dx:0}get dragSpeed(){return 0===this.orientationMode?this.dragState.speedY:1===this.orientationMode?this.dragState.speedX:0}dragging(){this.value+=this.dragDelta}onSliding(){var t=this.value,e=this.dragSpeed;if(0===e)return this._slowDown.stop(),void this._state.next();var i=this.slidingDeceleration;this._slowDown.init(t,e>0,Math.abs(e),i)}sliding(t,e){e*=.001;var i=this._slowDown.update(e).value;this.overMax(i)?(this.value=this.maxValue,this._slowDown.stop()):this.overMin(i)?(this.value=this.minValue,this._slowDown.stop()):this.value=i}onPullBack(){var t=this.value,e=this.outOfMinBound?this.minValue:this.maxValue,i=Math.abs(e-t),s=this.backDeceleration,a=Math.sqrt(2*s*i);this._slowDown.init(t,void 0,a,s,e)}pullBack(t,e){e*=.001,this.value=this._slowDown.update(e).value,this._slowDown.isMoving||this._state.next()}stop(){this._slowDown.stop()}}Object.assign(f.prototype,a.a);const _={y:0,v:0,vertical:0,x:1,h:1,horizontal:1};e.a=f},function(t,e,i){"use strict";const s=Phaser.Utils.Objects.GetValue;var GetRadius=function(t,e,i){return void 0===t?{x:e,y:i}:"number"==typeof t?{x:t,y:t}:t},a=class{constructor(t,e,i,s,a){this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,i,s,a)}setTo(t,e,i,s,a){return this.setPosition(t,e),this.setRadius(a),this.setSize(i,s),this}setPosition(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}setRadius(t){var e,i;void 0===t&&(t=0),"number"==typeof t?(e=t,i=t):(e=s(t,"x",0),i=s(t,"y",0));var a=this.cornerRadius;return a.tl=GetRadius(s(t,"tl",void 0),e,i),a.tr=GetRadius(s(t,"tr",void 0),e,i),a.bl=GetRadius(s(t,"bl",void 0),e,i),a.br=GetRadius(s(t,"br",void 0),e,i),this}setSize(t,e){return this.width=t,this.height=e,this}get minWidth(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}get minHeight(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}get width(){return this._width}set width(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}get height(){return this._height}set height(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}get radius(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}},utils_LineTo=function(t,e,i){var s=i.length;if(s>=2){var a=i[s-2],r=i[s-1];if(t===a&&e===r)return i}return i.push(t,e),i},r=i(236),n=i.n(r);const o=Phaser.Utils.Objects.GetValue;var utils_ArcTo=function(t,e,i,s,a,r,h,l){var c,d,m,u=o(i,"x",i),p=o(i,"y",i);r&&(a+=360),s=n()(s);for(var g=((a=n()(a))-s)/h,f=0;f<=h;f++)m=s+g*f,c=t+u*Math.cos(m),d=e+p*Math.sin(m),utils_LineTo(c,d,l);return l},h=i(237),l=i.n(h),c=i(238),d=i.n(c),m=i(241),u=i.n(m),p=i(23),g=(p.a,p.a,{renderWebGL:d.a,renderCanvas:u.a});const f=Phaser.Utils.Objects.GetValue;class _ extends Phaser.GameObjects.Shape{constructor(t,e,i,s,r,n,o,h){void 0===e&&(e=0),void 0===i&&(i=0);var l=f(n,"iteration",void 0);n=f(n,"radius",n),super(t,"RoundRectangle",new a(0,0,s,r,n)),this.setIteration(l),this.setPosition(e,i),void 0!==o&&this.setFillStyle(o,h),this.updateDisplayOrigin(),this.updateData()}updateData(){var t=this.geom,e=this.pathData;e.length=0;var i,s=t.cornerRadius,a=this.iteration+1;if(i=s.br,isArcCorner(i)){var r=t.width-i.x,n=t.height-i.y;utils_ArcTo(r,n,i,0,90,!1,a,e)}else utils_LineTo(t.width,t.height,e);if(i=s.bl,isArcCorner(i)){r=i.x,n=t.height-i.y;utils_ArcTo(r,n,i,90,180,!1,a,e)}else utils_LineTo(0,t.height,e);if(i=s.tl,isArcCorner(i)){r=i.x,n=i.y;utils_ArcTo(r,n,i,180,270,!1,a,e)}else utils_LineTo(0,0,e);if(i=s.tr,isArcCorner(i)){r=t.width-i.x,n=i.y;utils_ArcTo(r,n,i,270,360,!1,a,e)}else utils_LineTo(t.width,0,e);return e.push(e[0],e[1]),this.pathIndexes=l()(e),this}get width(){return this.geom.width}set width(t){this.width!==t&&(this.geom.width=t,this.updateDisplayOrigin(),this.updateData())}get height(){return this.geom.height}set height(t){this.height!==t&&(this.geom.height=t,this.updateDisplayOrigin(),this.updateData())}resize(t,e){return void 0===e&&(e=t),this.geom.width===t&&this.geom.height===e?this:(this.geom.height=e,this.geom.width=t,this.updateDisplayOrigin(),this.updateData(),this)}get iteration(){return this._iteration}set iteration(t){void 0!==this._iteration?this._iteration!==t&&(this._iteration=t,this.updateData()):this._iteration=t}setIteration(t){return void 0===t&&(t=6),this.iteration=t,this}get radius(){return this.geom.radius}set radius(t){this.geom.setRadius(t),this.updateDisplayOrigin(),this.updateData()}setRadius(t){return void 0===t&&(t=0),this.radius=t,this}get cornerRadius(){return this.geom.cornerRadius}set cornerRadius(t){this.radius=t}setCornerRadius(t){return this.setRadius(t)}}var isArcCorner=function(t){return 0!==t.x&&0!==t.y};Object.assign(_.prototype,g);e.a=_},,function(t,e,i){(function(e){t.exports=e.dragonBones=i(163)}).call(this,i(37))},function(t,e,i){"use strict";var s,a=this&&this.__extends||(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])});!function(t){var e=function(){function DragonBones(e){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=e,console.info("DragonBones: "+DragonBones.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return DragonBones.prototype.advanceTime=function(e){if(this._objects.length>0){for(var i=0,s=this._objects;i<s.length;i++){s[i].returnToPool()}this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var a=0;a<this._events.length;++a){var r=this._events[a],n=r.armature;null!==n._armatureData&&(n.eventDispatcher.dispatchDBEvent(r.type,r),r.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(r.type,r)),this.bufferObject(r)}this._events.length=0}},DragonBones.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},DragonBones.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(DragonBones.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(DragonBones.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),DragonBones.VERSION="5.7.000",DragonBones.yDown=!0,DragonBones.debug=!1,DragonBones.debugDraw=!1,DragonBones}();t.DragonBones=e}(l||(l={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function now(){return(new Date).getTime()});var r,n,o,h,l,c;a=function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r};if(void 0===d&&"undefined"!=typeof window)var d=window;t.exports=l,function(t){var e=function(){function BaseObject(){this.hashCode=BaseObject._hashCode++,this._isInPool=!1}return BaseObject._returnObject=function(t){var e=String(t.constructor),i=e in BaseObject._maxCountMap?BaseObject._maxCountMap[e]:BaseObject._defaultMaxCount,s=BaseObject._poolsMap[e]=BaseObject._poolsMap[e]||[];s.length<i&&(t._isInPool?console.warn("The object is already in the pool."):(t._isInPool=!0,s.push(t)))},BaseObject.toString=function(){throw new Error},BaseObject.setMaxCount=function(t,e){if((e<0||e!=e)&&(e=0),null!==t)null!==(s=(i=String(t))in BaseObject._poolsMap?BaseObject._poolsMap[i]:null)&&s.length>e&&(s.length=e),BaseObject._maxCountMap[i]=e;else for(var i in BaseObject._defaultMaxCount=e,BaseObject._poolsMap){var s;(s=BaseObject._poolsMap[i]).length>e&&(s.length=e),i in BaseObject._maxCountMap&&(BaseObject._maxCountMap[i]=e)}},BaseObject.clearPool=function(t){if(void 0===t&&(t=null),null!==t){var e=String(t);null!==(s=e in BaseObject._poolsMap?BaseObject._poolsMap[e]:null)&&s.length>0&&(s.length=0)}else for(var i in BaseObject._poolsMap){var s;(s=BaseObject._poolsMap[i]).length=0}},BaseObject.borrowObject=function(t){var e=String(t),i=e in BaseObject._poolsMap?BaseObject._poolsMap[e]:null;if(null!==i&&i.length>0){var s=i.pop();return s._isInPool=!1,s}var a=new t;return a._onClear(),a},BaseObject.prototype.returnToPool=function(){this._onClear(),BaseObject._returnObject(this)},BaseObject._hashCode=0,BaseObject._defaultMaxCount=3e3,BaseObject._maxCountMap={},BaseObject._poolsMap={},BaseObject}();t.BaseObject=e}(l||(l={})),function(t){var e=function(){function Matrix(t,e,i,s,a,r){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===a&&(a=0),void 0===r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=s,this.tx=a,this.ty=r}return Matrix.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},Matrix.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Matrix.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},Matrix.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},Matrix.prototype.concat=function(t){var e=this.a*t.a,i=0,s=0,a=this.d*t.d,r=this.tx*t.a+t.tx,n=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,s+=this.c*t.a,a+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,s+=this.d*t.c,r+=this.ty*t.c,n+=this.tx*t.b),this.a=e,this.b=i,this.c=s,this.d=a,this.tx=r,this.ty=n,this},Matrix.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,s=this.d,a=this.tx,r=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===s?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,s=this.d=1/s,this.tx=-t*a,this.ty=-s*r),this;var n=t*s-e*i;if(0===n)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;n=1/n;var o=this.a=s*n;return e=this.b=-e*n,i=this.c=-i*n,s=this.d=t*n,this.tx=-(o*a+i*r),this.ty=-(e*a+s*r),this},Matrix.prototype.transformPoint=function(t,e,i,s){void 0===s&&(s=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,s||(i.x+=this.tx,i.y+=this.ty)},Matrix.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var i=this.a,s=this.b,a=this.c,r=this.d,n=e?0:this.tx,o=e?0:this.ty,h=t.x,l=t.y,c=h+t.width,d=l+t.height,m=i*h+a*l+n,u=s*h+r*l+o,p=i*c+a*l+n,g=s*c+r*l+o,f=i*c+a*d+n,_=s*c+r*d+o,y=i*h+a*d+n,v=s*h+r*d+o,S=0;m>p&&(S=m,m=p,p=S),f>y&&(S=f,f=y,y=S),t.x=Math.floor(m<f?m:f),t.width=Math.ceil((p>y?p:y)-t.x),u>g&&(S=u,u=g,g=S),_>v&&(S=_,_=v,v=S),t.y=Math.floor(u<_?u:_),t.height=Math.ceil((g>v?g:v)-t.y)},Matrix}();t.Matrix=e}(l||(l={})),function(t){var e=function(){function Transform(t,e,i,s,a,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===a&&(a=1),void 0===r&&(r=1),this.x=t,this.y=e,this.skew=i,this.rotation=s,this.scaleX=a,this.scaleY=r}return Transform.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI},Transform.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},Transform.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},Transform.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},Transform.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},Transform.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},Transform.prototype.fromMatrix=function(t){var e=this.scaleX,i=this.scaleY,s=Transform.PI_Q;this.x=t.tx,this.y=t.ty,this.rotation=Math.atan(t.b/t.a);var a=Math.atan(-t.c/t.d);return this.scaleX=this.rotation>-s&&this.rotation<s?t.a/Math.cos(this.rotation):t.b/Math.sin(this.rotation),this.scaleY=a>-s&&a<s?t.d/Math.cos(a):-t.c/Math.sin(a),e>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),i>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,a-=Math.PI),this.skew=a-this.rotation,this},Transform.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},Transform.PI=Math.PI,Transform.PI_D=2*Math.PI,Transform.PI_H=Math.PI/2,Transform.PI_Q=Math.PI/4,Transform.RAD_DEG=180/Math.PI,Transform.DEG_RAD=Math.PI/180,Transform}();t.Transform=e}(l||(l={})),function(t){var e=function(){function ColorTransform(t,e,i,s,a,r,n,o){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===s&&(s=1),void 0===a&&(a=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=s,this.alphaOffset=a,this.redOffset=r,this.greenOffset=n,this.blueOffset=o}return ColorTransform.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},ColorTransform.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},ColorTransform}();t.ColorTransform=e}(l||(l={})),function(t){var e=function(){function Point(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return Point.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},Point.prototype.clear=function(){this.x=this.y=0},Point}();t.Point=e}(l||(l={})),function(t){var e=function(){function Rectangle(t,e,i,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.x=t,this.y=e,this.width=i,this.height=s}return Rectangle.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},Rectangle.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},Rectangle}();t.Rectangle=e}(l||(l={})),function(t){var e=function(t){function UserData(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return a(UserData,t),UserData.toString=function(){return"[class dragonBones.UserData]"},UserData.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},UserData.prototype.addInt=function(t){this.ints.push(t)},UserData.prototype.addFloat=function(t){this.floats.push(t)},UserData.prototype.addString=function(t){this.strings.push(t)},UserData.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},UserData.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},UserData.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},UserData}(t.BaseObject);t.UserData=e;var i=function(t){function ActionData(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return a(ActionData,t),ActionData.toString=function(){return"[class dragonBones.ActionData]"},ActionData.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},ActionData}(t.BaseObject);t.ActionData=i}(l||(l={})),function(t){var e=function(t){function DragonBonesData(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return a(DragonBonesData,t),DragonBonesData.toString=function(){return"[class dragonBones.DragonBonesData]"},DragonBonesData.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.colorArray=null,this.userData=null},DragonBonesData.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},DragonBonesData.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},DragonBonesData}(t.BaseObject);t.DragonBonesData=e}(l||(l={})),function(t){var e=function(e){function ArmatureData(){var i=null!==e&&e.apply(this,arguments)||this;return i.aabb=new t.Rectangle,i.animationNames=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.constraints={},i.skins={},i.animations={},i.canvas=null,i.userData=null,i}return a(ArmatureData,e),ArmatureData.toString=function(){return"[class dragonBones.ArmatureData]"},ArmatureData.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++){e[t].returnToPool()}for(var i=0,s=this.actions;i<s.length;i++){s[i].returnToPool()}for(var a in this.bones)this.bones[a].returnToPool(),delete this.bones[a];for(var a in this.slots)this.slots[a].returnToPool(),delete this.slots[a];for(var a in this.constraints)this.constraints[a].returnToPool(),delete this.constraints[a];for(var a in this.skins)this.skins[a].returnToPool(),delete this.skins[a];for(var a in this.animations)this.animations[a].returnToPool(),delete this.animations[a];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},ArmatureData.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,s=0;for(this.sortedBones.length=0;s<t;){var a=e[i++];if(i>=t&&(i=0),!(this.sortedBones.indexOf(a)>=0)){var r=!1;for(var n in this.constraints){var o=this.constraints[n];if(o.root===a&&this.sortedBones.indexOf(o.target)<0){r=!0;break}}r||null!==a.parent&&this.sortedBones.indexOf(a.parent)<0||(this.sortedBones.push(a),s++)}}}},ArmatureData.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},ArmatureData.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,s=i.length;return i.length+=10,i[s]=t.a,i[s+1]=t.b,i[s+2]=t.c,i[s+3]=t.d,i[s+4]=t.tx,i[s+5]=t.ty,i[s+6]=e.rotation,i[s+7]=e.skew,i[s+8]=e.scaleX,i[s+9]=e.scaleY,s},ArmatureData.prototype.getCacheFrame=function(t,e,i){var s=this.parent.cachedFrames;t.a=s[i],t.b=s[i+1],t.c=s[i+2],t.d=s[i+3],t.tx=s[i+4],t.ty=s[i+5],e.rotation=s[i+6],e.skew=s[i+7],e.scaleX=s[i+8],e.scaleY=s[i+9],e.x=t.tx,e.y=t.ty},ArmatureData.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},ArmatureData.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},ArmatureData.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},ArmatureData.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},ArmatureData.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},ArmatureData.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},ArmatureData.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},ArmatureData.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},ArmatureData.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},ArmatureData.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},ArmatureData.prototype.getMesh=function(t,e,i){var s=this.getSkin(t);return null===s?null:s.getDisplay(e,i)},ArmatureData.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},ArmatureData}(t.BaseObject);t.ArmatureData=e;var i=function(e){function BoneData(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.userData=null,i}return a(BoneData,e),BoneData.toString=function(){return"[class dragonBones.BoneData]"},BoneData.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.alpha=1,this.name="",this.transform.identity(),this.userData=null,this.parent=null},BoneData}(t.BaseObject);t.BoneData=i;var s=function(e){function SurfaceData(){var i=null!==e&&e.apply(this,arguments)||this;return i.geometry=new t.GeometryData,i}return a(SurfaceData,e),SurfaceData.toString=function(){return"[class dragonBones.SurfaceData]"},SurfaceData.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.geometry.clear()},SurfaceData}(i);t.SurfaceData=s;var r=function(e){function SlotData(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return a(SlotData,e),SlotData.createColor=function(){return new t.ColorTransform},SlotData.toString=function(){return"[class dragonBones.SlotData]"},SlotData.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.zIndex=0,this.alpha=1,this.name="",this.color=null,this.userData=null,this.parent=null},SlotData.DEFAULT_COLOR=new t.ColorTransform,SlotData}(t.BaseObject);t.SlotData=r}(l||(l={})),function(t){var e=function(t){function ConstraintData(){return null!==t&&t.apply(this,arguments)||this}return a(ConstraintData,t),ConstraintData.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},ConstraintData}(t.BaseObject);t.ConstraintData=e;var i=function(t){function IKConstraintData(){return null!==t&&t.apply(this,arguments)||this}return a(IKConstraintData,t),IKConstraintData.toString=function(){return"[class dragonBones.IKConstraintData]"},IKConstraintData.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},IKConstraintData}(e);t.IKConstraintData=i;var s=function(t){function PathConstraintData(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return a(PathConstraintData,t),PathConstraintData.toString=function(){return"[class dragonBones.PathConstraintData]"},PathConstraintData.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},PathConstraintData.prototype.AddBone=function(t){this.bones.push(t)},PathConstraintData}(e);t.PathConstraintData=s}(l||(l={})),function(t){var e=function(t){function CanvasData(){return null!==t&&t.apply(this,arguments)||this}return a(CanvasData,t),CanvasData.toString=function(){return"[class dragonBones.CanvasData]"},CanvasData.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},CanvasData}(t.BaseObject);t.CanvasData=e}(l||(l={})),function(t){var e=function(t){function SkinData(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return a(SkinData,t),SkinData.toString=function(){return"[class dragonBones.SkinData]"},SkinData.prototype._onClear=function(){for(var t in this.displays){for(var e=0,i=this.displays[t];e<i.length;e++){var s=i[e];null!==s&&s.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},SkinData.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},SkinData.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(null!==i)for(var s=0,a=i;s<a.length;s++){var r=a[s];if(null!==r&&r.name===e)return r}return null},SkinData.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},SkinData}(t.BaseObject);t.SkinData=e}(l||(l={})),function(t){var e=function(){function GeometryData(){this.weight=null}return GeometryData.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},GeometryData.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},Object.defineProperty(GeometryData.prototype,"vertexCount",{get:function(){return this.data.intArray[this.offset+0]},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryData.prototype,"triangleCount",{get:function(){return this.data.intArray[this.offset+1]},enumerable:!0,configurable:!0}),GeometryData}();t.GeometryData=e;var i=function(e){function DisplayData(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i}return a(DisplayData,e),DisplayData.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},DisplayData}(t.BaseObject);t.DisplayData=i;var s=function(e){function ImageDisplayData(){var i=null!==e&&e.apply(this,arguments)||this;return i.pivot=new t.Point,i}return a(ImageDisplayData,e),ImageDisplayData.toString=function(){return"[class dragonBones.ImageDisplayData]"},ImageDisplayData.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},ImageDisplayData}(i);t.ImageDisplayData=s;var r=function(t){function ArmatureDisplayData(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return a(ArmatureDisplayData,t),ArmatureDisplayData.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},ArmatureDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions;e<i.length;e++){i[e].returnToPool()}this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},ArmatureDisplayData.prototype.addAction=function(t){this.actions.push(t)},ArmatureDisplayData}(i);t.ArmatureDisplayData=r;var n=function(t){function MeshDisplayData(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i}return a(MeshDisplayData,t),MeshDisplayData.toString=function(){return"[class dragonBones.MeshDisplayData]"},MeshDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.geometry.clear(),this.texture=null},MeshDisplayData}(i);t.MeshDisplayData=n;var o=function(t){function BoundingBoxDisplayData(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return a(BoundingBoxDisplayData,t),BoundingBoxDisplayData.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},BoundingBoxDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},BoundingBoxDisplayData}(i);t.BoundingBoxDisplayData=o;var h=function(t){function PathDisplayData(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i.curveLengths=[],i}return a(PathDisplayData,t),PathDisplayData.toString=function(){return"[class dragonBones.PathDisplayData]"},PathDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.geometry.clear(),this.curveLengths.length=0},PathDisplayData}(i);t.PathDisplayData=h;var l=function(t){function WeightData(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return a(WeightData,t),WeightData.toString=function(){return"[class dragonBones.WeightData]"},WeightData.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},WeightData.prototype.addBone=function(t){this.bones.push(t)},WeightData}(t.BaseObject);t.WeightData=l}(l||(l={})),function(t){var e=function(t){function BoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return a(BoundingBoxData,t),BoundingBoxData.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},BoundingBoxData}(t.BaseObject);t.BoundingBoxData=e;var i=function(t){function RectangleBoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return a(RectangleBoundingBoxData,t),RectangleBoundingBoxData.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},RectangleBoundingBoxData._computeOutCode=function(t,e,i,s,a,r){var n=0;return t<i?n|=1:t>a&&(n|=2),e<s?n|=4:e>r&&(n|=8),n},RectangleBoundingBoxData.rectangleIntersectsSegment=function(t,e,i,s,a,r,n,o,h,l,c){void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=null);var d=t>a&&t<n&&e>r&&e<o,m=i>a&&i<n&&s>r&&s<o;if(d&&m)return-1;for(var u=0,p=RectangleBoundingBoxData._computeOutCode(t,e,a,r,n,o),g=RectangleBoundingBoxData._computeOutCode(i,s,a,r,n,o);;){if(0==(p|g)){u=2;break}if(0!=(p&g))break;var f=0,_=0,y=0,v=0!==p?p:g;0!=(4&v)?(f=t+(i-t)*(r-e)/(s-e),_=r,null!==c&&(y=.5*-Math.PI)):0!=(8&v)?(f=t+(i-t)*(o-e)/(s-e),_=o,null!==c&&(y=.5*Math.PI)):0!=(2&v)?(_=e+(s-e)*(n-t)/(i-t),f=n,null!==c&&(y=0)):0!=(1&v)&&(_=e+(s-e)*(a-t)/(i-t),f=a,null!==c&&(y=Math.PI)),v===p?(t=f,e=_,p=RectangleBoundingBoxData._computeOutCode(t,e,a,r,n,o),null!==c&&(c.x=y)):(i=f,s=_,g=RectangleBoundingBoxData._computeOutCode(i,s,a,r,n,o),null!==c&&(c.y=y))}return u&&(d?(u=2,null!==h&&(h.x=i,h.y=s),null!==l&&(l.x=i,l.y=i),null!==c&&(c.x=c.y+Math.PI)):m?(u=1,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=t,l.y=e),null!==c&&(c.y=c.x+Math.PI)):(u=3,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=i,l.y=s))),u},RectangleBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},RectangleBoundingBoxData.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var s=.5*this.height;if(e>=-s&&e<=s)return!0}return!1},RectangleBoundingBoxData.prototype.intersectsSegment=function(t,e,i,s,a,r,n){void 0===a&&(a=null),void 0===r&&(r=null),void 0===n&&(n=null);var o=.5*this.width,h=.5*this.height;return RectangleBoundingBoxData.rectangleIntersectsSegment(t,e,i,s,-o,-h,o,h,a,r,n)},RectangleBoundingBoxData}(e);t.RectangleBoundingBoxData=i;var s=function(t){function EllipseBoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return a(EllipseBoundingBoxData,t),EllipseBoundingBoxData.toString=function(){return"[class dragonBones.EllipseData]"},EllipseBoundingBoxData.ellipseIntersectsSegment=function(t,e,i,s,a,r,n,o,h,l,c){void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=null);var d=n/o,m=d*d,u=i-t,p=(s*=d)-(e*=d),g=Math.sqrt(u*u+p*p),f=u/g,_=p/g,y=(a-t)*f+(r-e)*_,v=n*n,S=v-(t*t+e*e)+y*y,b=0;if(S>=0){var T=Math.sqrt(S),D=y-T,x=y+T,P=D<0?-1:D<=g?0:1,C=x<0?-1:x<=g?0:1,w=P*C;if(w<0)return-1;0===w&&(-1===P?(b=2,i=t+x*f,s=(e+x*_)/d,null!==h&&(h.x=i,h.y=s),null!==l&&(l.x=i,l.y=s),null!==c&&(c.x=Math.atan2(s/v*m,i/v),c.y=c.x+Math.PI)):1===C?(b=1,t+=D*f,e=(e+D*_)/d,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=t,l.y=e),null!==c&&(c.x=Math.atan2(e/v*m,t/v),c.y=c.x+Math.PI)):(b=3,null!==h&&(h.x=t+D*f,h.y=(e+D*_)/d,null!==c&&(c.x=Math.atan2(h.y/v*m,h.x/v))),null!==l&&(l.x=t+x*f,l.y=(e+x*_)/d,null!==c&&(c.y=Math.atan2(l.y/v*m,l.x/v)))))}return b},EllipseBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},EllipseBoundingBoxData.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var s=.5*this.height;if(e>=-s&&e<=s)return e*=i/s,Math.sqrt(t*t+e*e)<=i}return!1},EllipseBoundingBoxData.prototype.intersectsSegment=function(t,e,i,s,a,r,n){return void 0===a&&(a=null),void 0===r&&(r=null),void 0===n&&(n=null),EllipseBoundingBoxData.ellipseIntersectsSegment(t,e,i,s,0,0,.5*this.width,.5*this.height,a,r,n)},EllipseBoundingBoxData}(e);t.EllipseBoundingBoxData=s;var r=function(t){function PolygonBoundingBoxData(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return a(PolygonBoundingBoxData,t),PolygonBoundingBoxData.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},PolygonBoundingBoxData.polygonIntersectsSegment=function(t,e,i,s,a,r,n,o){void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null),t===i&&(t=i+1e-6),e===s&&(e=s+1e-6);for(var h=a.length,l=t-i,c=e-s,d=t*s-e*i,m=0,u=a[h-2],p=a[h-1],g=0,f=0,_=0,y=0,v=0,S=0,b=0;b<h;b+=2){var T=a[b],D=a[b+1];u===T&&(u=T+1e-4),p===D&&(p=D+1e-4);var x=u-T,P=p-D,C=u*D-p*T,w=l*P-c*x,O=(d*x-l*C)/w;if((O>=u&&O<=T||O>=T&&O<=u)&&(0===l||O>=t&&O<=i||O>=i&&O<=t)){var A=(d*P-c*C)/w;if((A>=p&&A<=D||A>=D&&A<=p)&&(0===c||A>=e&&A<=s||A>=s&&A<=e)){if(null===n){_=O,y=A,v=O,S=A,m++,null!==o&&(o.x=Math.atan2(D-p,T-u)-.5*Math.PI,o.y=o.x);break}var B=O-t;B<0&&(B=-B),0===m?(g=B,f=B,_=O,y=A,v=O,S=A,null!==o&&(o.x=Math.atan2(D-p,T-u)-.5*Math.PI,o.y=o.x)):(B<g&&(g=B,_=O,y=A,null!==o&&(o.x=Math.atan2(D-p,T-u)-.5*Math.PI)),B>f&&(f=B,v=O,S=A,null!==o&&(o.y=Math.atan2(D-p,T-u)-.5*Math.PI))),m++}}u=T,p=D}return 1===m?(null!==r&&(r.x=_,r.y=y),null!==n&&(n.x=_,n.y=y),null!==o&&(o.y=o.x+Math.PI)):m>1&&(m++,null!==r&&(r.x=_,r.y=y),null!==n&&(n.x=v,n.y=S)),m},PolygonBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},PolygonBoundingBoxData.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var s=0,a=this.vertices.length,r=a-2;s<a;s+=2){var n=this.vertices[r+1],o=this.vertices[s+1];if(o<e&&n>=e||n<e&&o>=e){var h=this.vertices[r],l=this.vertices[s];(e-o)*(h-l)/(n-o)+l<t&&(i=!i)}r=s}return i},PolygonBoundingBoxData.prototype.intersectsSegment=function(t,e,s,a,r,n,o){void 0===r&&(r=null),void 0===n&&(n=null),void 0===o&&(o=null);var h=0;return 0!==i.rectangleIntersectsSegment(t,e,s,a,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(h=PolygonBoundingBoxData.polygonIntersectsSegment(t,e,s,a,this.vertices,r,n,o)),h},PolygonBoundingBoxData}(e);t.PolygonBoundingBoxData=r}(l||(l={})),function(t){var e=function(t){function AnimationData(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return a(AnimationData,t),AnimationData.toString=function(){return"[class dragonBones.AnimationData]"},AnimationData.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++){i[e].returnToPool()}delete this.boneTimelines[t]}for(var t in this.slotTimelines){for(var s=0,a=this.slotTimelines[t];s<a.length;s++){a[s].returnToPool()}delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var r=0,n=this.constraintTimelines[t];r<n.length;r++){n[r].returnToPool()}delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var o=0,h=this.animationTimelines[t];o<h.length;o++){h[o].returnToPool()}delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.blendType=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},AnimationData.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,s=this.cacheFrames.length;i<s;++i)this.cachedFrames[i]=!1;for(var a=0,r=this.parent.sortedBones;a<r.length;a++){var n=r[a];for(i=0,s=(l=new Array(e)).length;i<s;++i)l[i]=-1;this.boneCachedFrameIndices[n.name]=l}for(var o=0,h=this.parent.sortedSlots;o<h.length;o++){var l,c=h[o];for(i=0,s=(l=new Array(e)).length;i<s;++i)l[i]=-1;this.slotCachedFrameIndices[c.name]=l}}},AnimationData.prototype.addBoneTimeline=function(t,e){var i=t in this.boneTimelines?this.boneTimelines[t]:this.boneTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addSlotTimeline=function(t,e){var i=t in this.slotTimelines?this.slotTimelines[t]:this.slotTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addConstraintTimeline=function(t,e){var i=t in this.constraintTimelines?this.constraintTimelines[t]:this.constraintTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addAnimationTimeline=function(t,e){var i=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},AnimationData.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},AnimationData.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},AnimationData.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},AnimationData.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},AnimationData.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},AnimationData}(t.BaseObject);t.AnimationData=e;var i=function(t){function TimelineData(){return null!==t&&t.apply(this,arguments)||this}return a(TimelineData,t),TimelineData.toString=function(){return"[class dragonBones.TimelineData]"},TimelineData.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},TimelineData}(t.BaseObject);t.TimelineData=i;var s=function(t){function AnimationTimelineData(){return null!==t&&t.apply(this,arguments)||this}return a(AnimationTimelineData,t),AnimationTimelineData.toString=function(){return"[class dragonBones.AnimationTimelineData]"},AnimationTimelineData.prototype._onClear=function(){t.prototype._onClear.call(this),this.x=0,this.y=0},AnimationTimelineData}(i);t.AnimationTimelineData=s}(l||(l={})),function(t){var e=function(t){function AnimationConfig(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return a(AnimationConfig,t),AnimationConfig.toString=function(){return"[class dragonBones.AnimationConfig]"},AnimationConfig.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additive=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},AnimationConfig.prototype.clear=function(){this._onClear()},AnimationConfig.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additive=t.additive,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},AnimationConfig}(t.BaseObject);t.AnimationConfig=e}(l||(l={})),function(t){var e=function(t){function TextureAtlasData(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return a(TextureAtlasData,t),TextureAtlasData.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},TextureAtlasData.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},TextureAtlasData.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},TextureAtlasData.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},TextureAtlasData}(t.BaseObject);t.TextureAtlasData=e;var i=function(e){function TextureData(){var i=null!==e&&e.apply(this,arguments)||this;return i.region=new t.Rectangle,i.frame=null,i}return a(TextureData,e),TextureData.createRectangle=function(){return new t.Rectangle},TextureData.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},TextureData.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=TextureData.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},TextureData}(t.BaseObject);t.TextureData=i}(l||(l={})),r=l||(l={}),n=function(t){function Armature(){var e=null!==t&&t.apply(this,arguments)||this;return e._bones=[],e._slots=[],e._constraints=[],e._actions=[],e._animation=null,e._proxy=null,e._replaceTextureAtlasData=null,e._clock=null,e}return a(Armature,t),Armature.toString=function(){return"[class dragonBones.Armature]"},Armature._onSortSlots=function(t,e){return 1e3*t._zIndex+t._zOrder>1e3*e._zIndex+e._zOrder?1:-1},Armature.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var i=0,s=this._slots;i<s.length;i++)s[i].returnToPool();for(var a=0,r=this._constraints;a<r.length;a++)r[a].returnToPool();for(var n=0,o=this._actions;n<o.length;n++)o[n].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._zIndexDirty=!1,this._alphaDirty=!0,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._alpha=1,this._globalAlpha=1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},Armature.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,s=null===t;if(this._zOrderDirty||!s){for(var a=0,r=i.length;a<r;++a){var n=s?a:t[e+a];if(!(n<0||n>=r)){var o=i[n],h=this.getSlot(o.name);null!==h&&h._setZOrder(a)}}this._slotsDirty=!0,this._zOrderDirty=!s}},Armature.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},Armature.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},Armature.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},Armature.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},Armature.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},Armature.prototype.init=function(t,e,i,s){null===this._armatureData&&(this._armatureData=t,this._animation=r.BaseObject.borrowObject(r.Animation),this._proxy=e,this._display=i,this._dragonBones=s,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},Armature.prototype.advanceTime=function(t){if(!this._lockUpdate)if(this._lockUpdate=!0,null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty||this._zIndexDirty){if(this._slots.sort(Armature._onSortSlots),this._zIndexDirty)for(var i=0,s=this._slots.length;i<s;++i)this._slots[i]._setZOrder(i);this._slotsDirty=!1,this._zIndexDirty=!1}if(this._alphaDirty){this._alphaDirty=!1,this._globalAlpha=this._alpha*(null!==this._parent?this._parent._globalAlpha:1);for(var a=0,r=this._bones;a<r.length;a++)r[a]._updateAlpha();for(var n=0,o=this._slots;n<o.length;n++)(p=o[n])._updateAlpha()}if(this._cacheFrameIndex<0||this._cacheFrameIndex!==e){for(i=0,s=0,i=0,s=this._bones.length;i<s;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,s=this._slots.length;i<s;++i)this._slots[i].update(this._cacheFrameIndex)}if(this._actions.length>0){for(var h=0,l=this._actions;h<l.length;h++){var c=l[h],d=c.actionData;if(null!==d&&0===d.type)if(null!==c.slot)null!==(g=c.slot.childArmature)&&g.animation.fadeIn(d.name);else if(null!==c.bone)for(var m=0,u=this.getSlots();m<u.length;m++){var p,g;(p=u[m]).parent===c.bone&&null!==(g=p.childArmature)&&g.animation.fadeIn(d.name)}else this._animation.fadeIn(d.name);c.returnToPool()}this._actions.length=0}this._lockUpdate=!1,this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},Armature.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(n=this.getBone(t))&&(n.invalidUpdate(),e))for(var i=0,s=this._slots;i<s.length;i++)(l=s[i]).parent===n&&l.invalidUpdate()}else{for(var a=0,r=this._bones;a<r.length;a++){var n;(n=r[a]).invalidUpdate()}if(e)for(var o=0,h=this._slots;o<h.length;o++){var l;(l=h[o]).invalidUpdate()}}},Armature.prototype.containsPoint=function(t,e){for(var i=0,s=this._slots;i<s.length;i++){var a=s[i];if(a.containsPoint(t,e))return a}return null},Armature.prototype.intersectsSegment=function(t,e,i,s,a,r,n){void 0===a&&(a=null),void 0===r&&(r=null),void 0===n&&(n=null);for(var o=t===i,h=0,l=0,c=0,d=0,m=0,u=0,p=0,g=0,f=null,_=null,y=0,v=this._slots;y<v.length;y++){var S=v[y];if(S.intersectsSegment(t,e,i,s,a,r,n)>0){if(null===a&&null===r){f=S;break}var b;null!==a&&((b=o?a.y-e:a.x-t)<0&&(b=-b),(null===f||b<h)&&(h=b,c=a.x,d=a.y,f=S,n&&(p=n.x))),null!==r&&((b=r.x-t)<0&&(b=-b),(null===_||b>l)&&(l=b,m=r.x,u=r.y,_=S,null!==n&&(g=n.y)))}}return null!==f&&null!==a&&(a.x=c,a.y=d,null!==n&&(n.x=p)),null!==_&&null!==r&&(r.x=m,r.y=u,null!==n&&(n.y=g)),f},Armature.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var s=i[e];if(s.name===t)return s}return null},Armature.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},Armature.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var s=i[e];if(s.name===t)return s}return null},Armature.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var s=i[e];if(s.display===t)return s}return null},Armature.prototype.getBones=function(){return this._bones},Armature.prototype.getSlots=function(){return this._slots},Object.defineProperty(Armature.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var s=i[e].childArmature;null!==s&&(s.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var s=i[e];s.invalidUpdate(),s.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var s=i[e].childArmature;null!==s&&(s.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Armature.prototype.getDisplay=function(){return this._display},Armature}(r.BaseObject),r.Armature=n,function(t){var e=function(e){function TransformObject(){var i=null!==e&&e.apply(this,arguments)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return a(TransformObject,e),TransformObject.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._alpha=1,this._globalAlpha=1,this._armature=null},TransformObject.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(TransformObject.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),TransformObject._helpMatrix=new t.Matrix,TransformObject._helpTransform=new t.Transform,TransformObject._helpPoint=new t.Point,TransformObject}(t.BaseObject);t.TransformObject=e}(l||(l={})),function(t){var e=function(e){function Bone(){var i=null!==e&&e.apply(this,arguments)||this;return i.animationPose=new t.Transform,i}return a(Bone,e),Bone.toString=function(){return"[class dragonBones.Bone]"},Bone.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._boneData=null,this._parent=null,this._cachedFrameIndices=null},Bone.prototype._updateGlobalTransformMatrix=function(e){var i=this._boneData,s=this.global,a=this.globalTransformMatrix,r=this.origin,n=this.offset,o=this.animationPose,h=this._parent,l=this._armature.flipX,c=this._armature.flipY===t.DragonBones.yDown,d=null!==h,m=0;if(1===this.offsetMode?null!==r?(s.x=r.x+n.x+o.x,s.scaleX=r.scaleX*n.scaleX*o.scaleX,s.scaleY=r.scaleY*n.scaleY*o.scaleY,t.DragonBones.yDown?(s.y=r.y+n.y+o.y,s.skew=r.skew+n.skew+o.skew,s.rotation=r.rotation+n.rotation+o.rotation):(s.y=r.y-n.y+o.y,s.skew=r.skew-n.skew+o.skew,s.rotation=r.rotation-n.rotation+o.rotation)):(s.copyFrom(n),t.DragonBones.yDown||(s.y=-s.y,s.skew=-s.skew,s.rotation=-s.rotation),s.add(o)):0===this.offsetMode?null!==r?s.copyFrom(r).add(o):s.copyFrom(o):(d=!1,s.copyFrom(n),t.DragonBones.yDown||(s.y=-s.y,s.skew=-s.skew,s.rotation=-s.rotation)),d){var u=1===h._boneData.type,p=u?h._bone:null,g=u?h._getGlobalTransformMatrix(s.x,s.y):h.globalTransformMatrix;if(!i.inheritScale||u&&null===p){if(i.inheritTranslation){var f=s.x,_=s.y;s.x=g.a*f+g.c*_+g.tx,s.y=g.b*f+g.d*_+g.ty}else l&&(s.x=-s.x),c&&(s.y=-s.y);i.inheritRotation?(h.updateGlobalTransform(),m=h.global.scaleX<0?s.rotation+h.global.rotation+Math.PI:s.rotation+h.global.rotation,g.a*g.d-g.b*g.c<0&&(m-=2*s.rotation,(l!==c||i.inheritReflection)&&(s.skew+=Math.PI),t.DragonBones.yDown||(s.skew=-s.skew)),s.rotation=m):(l||c)&&(l&&c?m=s.rotation+Math.PI:(m=l?Math.PI-s.rotation:-s.rotation,s.skew+=Math.PI),s.rotation=m),s.toMatrix(a)}else u?(i.inheritRotation&&(s.rotation+=h.global.rotation),p.updateGlobalTransform(),s.scaleX*=p.global.scaleX,s.scaleY*=p.global.scaleY,g.transformPoint(s.x,s.y,s),s.toMatrix(a),i.inheritTranslation?(s.x=a.tx,s.y=a.ty):(a.tx=s.x,a.ty=s.y)):(i.inheritRotation||(h.updateGlobalTransform(),m=l&&c?s.rotation-(h.global.rotation+Math.PI):l?s.rotation+h.global.rotation+Math.PI:c?s.rotation+h.global.rotation:s.rotation-h.global.rotation,s.rotation=m),s.toMatrix(a),a.concat(g),i.inheritTranslation?(s.x=a.tx,s.y=a.ty):(a.tx=s.x,a.ty=s.y),e?s.fromMatrix(a):this._globalDirty=!0)}else(l||c)&&(l&&(s.x=-s.x),c&&(s.y=-s.y),l&&c?m=s.rotation+Math.PI:(m=l?Math.PI-s.rotation:-s.rotation,s.skew+=Math.PI),s.rotation=m),s.toMatrix(a)},Bone.prototype._updateAlpha=function(){null!==this._parent?this._globalAlpha=this._alpha*this._parent._globalAlpha:this._globalAlpha=this._alpha*this._armature._globalAlpha},Bone.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,this._alpha=this._boneData.alpha,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},Bone.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,s=this._armature._constraints;i<s.length;i++){(n=s[i])._root===this&&n.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var a=0,r=this._armature._constraints;a<r.length;a++){var n;(n=r[a])._root===this&&n.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var o=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(o),o&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},Bone.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},Bone.prototype.invalidUpdate=function(){this._transformDirty=!0},Bone.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(Bone.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var s=i[e];s.parent===this&&s._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Bone}(t.TransformObject);t.Bone=e}(l||(l={})),function(t){var e=function(t){function Surface(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return a(Surface,t),Surface.toString=function(){return"[class dragonBones.Surface]"},Surface.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0,this._bone=null},Surface.prototype._getAffineTransform=function(t,e,i,s,a,r,n,o,h,l,c,d,m){var u=n-a,p=o-r,g=h-a,f=l-r;c.rotation=Math.atan2(p,u),c.skew=Math.atan2(f,g)-.5*Math.PI-c.rotation,m&&(c.rotation+=Math.PI),c.scaleX=Math.sqrt(u*u+p*p)/i,c.scaleY=Math.sqrt(g*g+f*f)/s,c.toMatrix(d),c.x=d.tx=a-(d.a*t+d.c*e),c.y=d.ty=r-(d.b*t+d.d*e)},Surface.prototype._updateVertices=function(){var t=this._armature.armatureData.parent,e=this._boneData.geometry,i=t.intArray,s=t.floatArray,a=i[e.offset+0],r=i[e.offset+2],n=this._vertices,o=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var h=0,l=a;h<l;++h){var c=s[r+(p=2*h)]+o[p],d=s[r+p+1]+o[p+1],m=this._parent._getGlobalTransformMatrix(c,d);n[p]=m.a*c+m.c*d+m.tx,n[p+1]=m.b*c+m.d*d+m.ty}else{var u=this._parent.globalTransformMatrix;for(h=0,l=a;h<l;++h){c=s[r+(p=2*h)]+o[p],d=s[r+p+1]+o[p+1];n[p]=u.a*c+u.c*d+u.tx,n[p+1]=u.b*c+u.d*d+u.ty}}else for(h=0,l=a;h<l;++h){var p;n[p=2*h]=s[r+p]+o[p],n[p+1]=s[r+p+1]+o[p+1]}},Surface.prototype._updateGlobalTransformMatrix=function(t){var e=2*this._boneData.segmentX,i=this._vertices.length-2,s=this._vertices[0],a=this._vertices[1],r=this._vertices[e],n=this._vertices[e+1],o=this._vertices[i],h=this._vertices[i+1],l=this._vertices[i-e],c=this._vertices[i-e+1],d=s+.5*(o-s),m=a+.5*(h-a),u=d+.5*(r+.5*(l-r)-d),p=m+.5*(n+.5*(c-n)-m),g=r+.5*(o-r),f=n+.5*(h-n),_=l+.5*(o-l),y=c+.5*(h-c);this._getAffineTransform(0,0,200,200,u,p,g,f,_,y,this.global,this.globalTransformMatrix,!1),this._globalDirty=!1},Surface.prototype._getGlobalTransformMatrix=function(t,e){var i=200,s=1e3;if(t<-s||s<t||e<-s||s<e)return this.globalTransformMatrix;var a=!1,r=this._boneData,n=r.segmentX,o=r.segmentY,h=2*r.segmentX,l=this._dX,c=this._dY,d=Math.floor((t+i)/l),m=Math.floor((e+i)/c),u=0,p=d*l-i,g=m*c-i,f=this._matrixCahce,_=Surface._helpMatrix;if(t<-i){if(e<-i||e>=i)return this.globalTransformMatrix;if(f[u=7*(2*(n*o+n+o+o+m)+((a=e>this._kX*(t+i)+g)?1:0))]>0)_.copyFromArray(f,u+1);else{var y=m*(h+2),v=this._hullCache[4],S=this._hullCache[5],b=this._hullCache[2]-(o-m)*v,T=this._hullCache[3]-(o-m)*S,D=this._vertices;a?this._getAffineTransform(-i,g+c,800,c,D[y+h+2],D[y+h+3],b+v,T+S,D[y],D[y+1],Surface._helpTransform,_,!0):this._getAffineTransform(-s,g,800,c,b,T,D[y],D[y+1],b+v,T+S,Surface._helpTransform,_,!1),f[u]=1,f[u+1]=_.a,f[u+2]=_.b,f[u+3]=_.c,f[u+4]=_.d,f[u+5]=_.tx,f[u+6]=_.ty}}else if(t>=i){if(e<-i||e>=i)return this.globalTransformMatrix;if(f[u=7*(2*(n*o+n+m)+((a=e>this._kX*(t-s)+g)?1:0))]>0)_.copyFromArray(f,u+1);else{y=(m+1)*(h+2)-2,v=this._hullCache[4],S=this._hullCache[5],b=this._hullCache[0]+m*v,T=this._hullCache[1]+m*S,D=this._vertices;a?this._getAffineTransform(s,g+c,800,c,b+v,T+S,D[y+h+2],D[y+h+3],b,T,Surface._helpTransform,_,!0):this._getAffineTransform(i,g,800,c,D[y],D[y+1],b,T,D[y+h+2],D[y+h+3],Surface._helpTransform,_,!1),f[u]=1,f[u+1]=_.a,f[u+2]=_.b,f[u+3]=_.c,f[u+4]=_.d,f[u+5]=_.tx,f[u+6]=_.ty}}else if(e<-i){if(t<-i||t>=i)return this.globalTransformMatrix;if(f[u=7*(2*(n*o+d)+((a=e>this._kY*(t-p-l)-s)?1:0))]>0)_.copyFromArray(f,u+1);else{y=2*d,v=this._hullCache[10],S=this._hullCache[11],b=this._hullCache[8]+d*v,T=this._hullCache[9]+d*S,D=this._vertices;a?this._getAffineTransform(p+l,-i,l,800,D[y+2],D[y+3],D[y],D[y+1],b+v,T+S,Surface._helpTransform,_,!0):this._getAffineTransform(p,-s,l,800,b,T,b+v,T+S,D[y],D[y+1],Surface._helpTransform,_,!1),f[u]=1,f[u+1]=_.a,f[u+2]=_.b,f[u+3]=_.c,f[u+4]=_.d,f[u+5]=_.tx,f[u+6]=_.ty}}else if(e>=i){if(t<-i||t>=i)return this.globalTransformMatrix;if(f[u=7*(2*(n*o+n+o+d)+((a=e>this._kY*(t-p-l)+i)?1:0))]>0)_.copyFromArray(f,u+1);else{y=o*(h+2)+2*d,v=this._hullCache[10],S=this._hullCache[11],b=this._hullCache[6]-(n-d)*v,T=this._hullCache[7]-(n-d)*S,D=this._vertices;a?this._getAffineTransform(p+l,s,l,800,b+v,T+S,b,T,D[y+2],D[y+3],Surface._helpTransform,_,!0):this._getAffineTransform(p,i,l,800,D[y],D[y+1],D[y+2],D[y+3],b,T,Surface._helpTransform,_,!1),f[u]=1,f[u+1]=_.a,f[u+2]=_.b,f[u+3]=_.c,f[u+4]=_.d,f[u+5]=_.tx,f[u+6]=_.ty}}else if(f[u=7*(2*(n*m+d)+((a=e>this._k*(t-p-l)+g)?1:0))]>0)_.copyFromArray(f,u+1);else{y=2*d+m*(h+2),D=this._vertices;a?this._getAffineTransform(p+l,g+c,l,c,D[y+h+4],D[y+h+5],D[y+h+2],D[y+h+3],D[y+2],D[y+3],Surface._helpTransform,_,!0):this._getAffineTransform(p,g,l,c,D[y],D[y+1],D[y+2],D[y+3],D[y+h+2],D[y+h+3],Surface._helpTransform,_,!1),f[u]=1,f[u+1]=_.a,f[u+2]=_.b,f[u+3]=_.c,f[u+4]=_.d,f[u+5]=_.tx,f[u+6]=_.ty}return _},Surface.prototype.init=function(e,i){if(null===this._boneData){t.prototype.init.call(this,e,i);var s=e.segmentX,a=e.segmentY,r=this._armature.armatureData.parent.intArray[e.geometry.offset+0];this._dX=400/s,this._dY=400/a,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=2*r,this._deformVertices.length=2*r,this._matrixCahce.length=2*(s*a+2*s+2*a)*7,this._hullCache.length=10;for(var n=0;n<2*r;++n)this._deformVertices[n]=0;null!==this._parent&&(0===this._parent.boneData.type?this._bone=this._parent:this._bone=this._parent._bone)}},Surface.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,s=this._armature._constraints;i<s.length;i++){(n=s[i])._root===this&&n.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var a=0,r=this._armature._constraints;a<r.length;a++){var n;(n=r[a])._root===this&&n.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var o=0,h=this._matrixCahce.length;o<h;o+=7)this._matrixCahce[o]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var l=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(l),l&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var c=2*this.global.x,d=2*this.global.y,m=Surface._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,m),this._hullCache[0]=m.x,this._hullCache[1]=m.y,this._hullCache[2]=c-m.x,this._hullCache[3]=d-m.y,this.globalTransformMatrix.transformPoint(0,this._dY,m,!0),this._hullCache[4]=m.x,this._hullCache[5]=m.y,this.globalTransformMatrix.transformPoint(200,1e3,m),this._hullCache[6]=m.x,this._hullCache[7]=m.y,this._hullCache[8]=c-m.x,this._hullCache[9]=d-m.y,this.globalTransformMatrix.transformPoint(this._dX,0,m,!0),this._hullCache[10]=m.x,this._hullCache[11]=m.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},Surface}(t.Bone);t.Surface=e}(l||(l={})),function(t){var e=function(t){function DisplayFrame(){var e=null!==t&&t.apply(this,arguments)||this;return e.deformVertices=[],e}return a(DisplayFrame,t),DisplayFrame.toString=function(){return"[class dragonBones.DisplayFrame]"},DisplayFrame.prototype._onClear=function(){this.rawDisplayData=null,this.displayData=null,this.textureData=null,this.display=null,this.deformVertices.length=0},DisplayFrame.prototype.updateDeformVertices=function(){if(null!==this.rawDisplayData&&0===this.deformVertices.length){var t;if(2===this.rawDisplayData.type)t=this.rawDisplayData.geometry;else{if(4!==this.rawDisplayData.type)return;t=this.rawDisplayData.geometry}var e=0;e=null!==t.weight?2*t.weight.count:2*t.data.intArray[t.offset+0],this.deformVertices.length=e;for(var i=0,s=this.deformVertices.length;i<s;++i)this.deformVertices[i]=0}},DisplayFrame.prototype.getGeometryData=function(){if(null!==this.displayData){if(2===this.displayData.type)return this.displayData.geometry;if(4===this.displayData.type)return this.displayData.geometry}if(null!==this.rawDisplayData){if(2===this.rawDisplayData.type)return this.rawDisplayData.geometry;if(4===this.rawDisplayData.type)return this.rawDisplayData.geometry}return null},DisplayFrame.prototype.getBoundingBox=function(){return null!==this.displayData&&3===this.displayData.type?this.displayData.boundingBox:null!==this.rawDisplayData&&3===this.rawDisplayData.type?this.rawDisplayData.boundingBox:null},DisplayFrame.prototype.getTextureData=function(){if(null!==this.displayData){if(0===this.displayData.type)return this.displayData.texture;if(2===this.displayData.type)return this.displayData.texture}if(null!==this.textureData)return this.textureData;if(null!==this.rawDisplayData){if(0===this.rawDisplayData.type)return this.rawDisplayData.texture;if(2===this.rawDisplayData.type)return this.rawDisplayData.texture}return null},DisplayFrame}(t.BaseObject);t.DisplayFrame=e;var i=function(i){function Slot(){var e=null!==i&&i.apply(this,arguments)||this;return e._localMatrix=new t.Matrix,e._colorTransform=new t.ColorTransform,e._displayFrames=[],e._geometryBones=[],e._rawDisplay=null,e._meshDisplay=null,e._display=null,e}return a(Slot,i),Slot.prototype._onClear=function(){i.prototype._onClear.call(this);for(var e=[],s=0,a=this._displayFrames;s<a.length;s++){var r=a[s],n=r.display;n!==this._rawDisplay&&n!==this._meshDisplay&&e.indexOf(n)<0&&e.push(n),r.returnToPool()}for(var o=0,h=e;o<h.length;o++){var l=h[o];l instanceof t.Armature?l.dispose():this._disposeDisplay(l,!0)}null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDataDirty=!1,this._displayDirty=!1,this._geometryDirty=!1,this._textureDirty=!1,this._visibleDirty=!1,this._blendModeDirty=!1,this._zOrderDirty=!1,this._colorDirty=!1,this._verticesDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._zIndex=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayFrames.length=0,this._geometryBones.length=0,this._slotData=null,this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},Slot.prototype._hasDisplay=function(t){for(var e=0,i=this._displayFrames;e<i.length;e++){if(i[e].display===t)return!0}return!1},Slot.prototype._isBonesUpdate=function(){for(var t=0,e=this._geometryBones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},Slot.prototype._updateAlpha=function(){var t=this._alpha*this._parent._globalAlpha;this._globalAlpha!==t&&(this._globalAlpha=t,this._colorDirty=!0)},Slot.prototype._updateDisplayData=function(){var e=this._displayFrame,i=this._geometryData,s=this._textureData,a=null,r=null;if(this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&this._displayIndex<this._displayFrames.length&&(this._displayFrame=this._displayFrames[this._displayIndex],a=this._displayFrame.rawDisplayData,r=this._displayFrame.displayData,this._geometryData=this._displayFrame.getGeometryData(),this._boundingBoxData=this._displayFrame.getBoundingBox(),this._textureData=this._displayFrame.getTextureData()),this._displayFrame!==e||this._geometryData!==i||this._textureData!==s){if(null===this._geometryData&&null!==this._textureData){var n=null!==r&&0===r.type?r:a,o=this._textureData.parent.scale*this._armature._armatureData.scale,h=this._textureData.frame;this._pivotX=n.pivot.x,this._pivotY=n.pivot.y;var l=null!==h?h:this._textureData.region,c=l.width,d=l.height;this._textureData.rotated&&null===h&&(c=l.height,d=l.width),this._pivotX*=c*o,this._pivotY*=d*o,null!==h&&(this._pivotX+=h.x*o,this._pivotY+=h.y*o),null!==a&&n!==a&&(a.transform.toMatrix(Slot._helpMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(0,0,Slot._helpPoint),this._pivotX-=Slot._helpPoint.x,this._pivotY-=Slot._helpPoint.y,n.transform.toMatrix(Slot._helpMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(0,0,Slot._helpPoint),this._pivotX+=Slot._helpPoint.x,this._pivotY+=Slot._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*o-this._pivotY)}else this._pivotX=0,this._pivotY=0;if(this.origin=null!==a?a.transform:null!==r?r.transform:null,null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix),this._geometryData!==i)if(this._geometryDirty=!0,this._verticesDirty=!0,null!==this._geometryData){if(this._geometryBones.length=0,null!==this._geometryData.weight)for(var m=0,u=this._geometryData.weight.bones.length;m<u;++m){var p=this._armature.getBone(this._geometryData.weight.bones[m].name);this._geometryBones.push(p)}}else this._geometryBones.length=0,this._geometryData=null;this._textureDirty=this._textureData!==s,this._transformDirty=!0}},Slot.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,i=this._childArmature;if(null!==this._displayFrame?(this._display=this._displayFrame.display,null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null),(null!==this._display?this._display:this._rawDisplay)!==e&&(this._textureDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._transformDirty=!0,this._onUpdateDisplay(),this._replaceDisplay(e)),this._childArmature!==i&&(null!==i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var s=this._armature.cacheFrameRate;0!==s&&(this._childArmature.cacheFrameRate=s)}if(null!==this._displayFrame){var a=null,r=null!==this._displayFrame.displayData?this._displayFrame.displayData:this._displayFrame.rawDisplayData;if(null!==r&&1===r.type&&(a=r.actions),null!==a&&a.length>0)for(var n=0,o=a;n<o.length;n++){var h=o[n],l=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(h,l,this._armature),l.slot=this,this._armature._bufferAction(l,!1)}else this._childArmature.animation.play()}}},Slot.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},Slot.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return;this._animationDisplayIndex=t}this._displayIndex!==t&&(this._displayIndex=t<this._displayFrames.length?t:this._displayFrames.length-1,this._displayDataDirty=!0,this._displayDirty=this._displayIndex<0||this._display!==this._displayFrames[this._displayIndex].display)},Slot.prototype._setZOrder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},Slot.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0},Slot.prototype.init=function(t,e,i,s){if(null===this._slotData){this._slotData=t,this._colorDirty=!0,this._blendModeDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._zIndex=this._slotData.zIndex,this._alpha=this._slotData.alpha,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=s,this._armature=e;var a=this._armature.getBone(this._slotData.parent.name);null!==a&&(this._parent=a),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},Slot.prototype.update=function(t){if(this._displayDataDirty&&(this._updateDisplayData(),this._displayDataDirty=!1),this._displayDirty&&(this._updateDisplay(),this._displayDirty=!1),(this._geometryDirty||this._textureDirty)&&(null!==this._display&&this._display!==this._rawDisplay&&this._display!==this._meshDisplay||this._updateFrame(),this._geometryDirty=!1,this._textureDirty=!1),null!==this._display){if(this._visibleDirty&&(this._updateVisible(),this._visibleDirty=!1),this._blendModeDirty&&(this._updateBlendMode(),this._blendModeDirty=!1),this._colorDirty&&(this._updateColor(),this._colorDirty=!1),this._zOrderDirty&&(this._updateZOrder(),this._zOrderDirty=!1),null!==this._geometryData&&this._display===this._meshDisplay){var e=null!==this._geometryData.weight,i=0!==this._parent._boneData.type;if((this._verticesDirty||e&&this._isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._verticesDirty=!1,this._updateMesh()),e||i)return}if(t>=0&&null!==this._cachedFrameIndices){var s=this._cachedFrameIndices[t];s>=0&&this._cachedFrameIndex===s?this._transformDirty=!1:s>=0?(this._transformDirty=!0,this._cachedFrameIndex=s):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(this._transformDirty){if(this._cachedFrameIndex<0){var a=t>=0;this._updateGlobalTransformMatrix(a),a&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform(),this._transformDirty=!1}}},Slot.prototype.invalidUpdate=function(){this._displayDataDirty=!0,this._displayDirty=!0,this._transformDirty=!0},Slot.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._updateGlobalTransformMatrix(!1),this._transformDirty=!1)},Slot.prototype.replaceRawDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];if(i.rawDisplayData!==t){if(i.deformVertices.length=0,i.rawDisplayData=t,null===i.rawDisplayData){var s=this._armature._armatureData.defaultSkin;if(null!==s){var a=s.getDisplays(this._slotData.name);null!==a&&e<a.length&&(i.rawDisplayData=a[e])}}e===this._displayIndex&&(this._displayDataDirty=!0)}},Slot.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.displayData!==t&&i.rawDisplayData!==t&&(i.displayData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},Slot.prototype.replaceTextureData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.textureData!==t&&(i.textureData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},Slot.prototype.replaceDisplay=function(e,i){if(void 0===i&&(i=-1),i<0)i=this._displayIndex<0?0:this._displayIndex;else if(i>=this._displayFrames.length)return;var s=this._displayFrames[i];if(s.display!==e){var a=s.display;s.display=e,null===a||a===this._rawDisplay||a===this._meshDisplay||this._hasDisplay(a)||a instanceof t.Armature||this._disposeDisplay(a,!0),null===e||e===this._rawDisplay||e===this._meshDisplay||this._hasDisplay(a)||e instanceof t.Armature||this._initDisplay(e,!0),i===this._displayIndex&&(this._displayDirty=!0)}},Slot.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),Slot._helpMatrix.copyFrom(this.globalTransformMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(t,e,Slot._helpPoint),this._boundingBoxData.containsPoint(Slot._helpPoint.x,Slot._helpPoint.y))},Slot.prototype.intersectsSegment=function(t,e,i,s,a,r,n){if(void 0===a&&(a=null),void 0===r&&(r=null),void 0===n&&(n=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),Slot._helpMatrix.copyFrom(this.globalTransformMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(t,e,Slot._helpPoint),t=Slot._helpPoint.x,e=Slot._helpPoint.y,Slot._helpMatrix.transformPoint(i,s,Slot._helpPoint),i=Slot._helpPoint.x,s=Slot._helpPoint.y;var o=this._boundingBoxData.intersectsSegment(t,e,i,s,a,r,n);return o>0&&(1===o||2===o?null!==a?(this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==r&&(r.x=a.x,r.y=a.y)):null!==r&&this.globalTransformMatrix.transformPoint(r.x,r.y,r):(null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==r&&this.globalTransformMatrix.transformPoint(r.x,r.y,r)),null!==n&&(this.globalTransformMatrix.transformPoint(Math.cos(n.x),Math.sin(n.x),Slot._helpPoint,!0),n.x=Math.atan2(Slot._helpPoint.y,Slot._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(n.y),Math.sin(n.y),Slot._helpPoint,!0),n.y=Math.atan2(Slot._helpPoint.y,Slot._helpPoint.x))),o},Slot.prototype.getDisplayFrameAt=function(t){return this._displayFrames[t]},Object.defineProperty(Slot.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayFrameCount",{get:function(){return this._displayFrames.length},set:function(i){var s=this._displayFrames.length;if(s<i){this._displayFrames.length=i;for(var a=s;a<i;++a)this._displayFrames[a]=t.BaseObject.borrowObject(e)}else if(s>i){for(a=s-1;a<i;--a)this.replaceDisplay(null,a),this._displayFrames[a].returnToPool();this._displayFrames.length=i}},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t),this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayList",{get:function(){for(var t=new Array,e=0,i=this._displayFrames;e<i.length;e++){var s=i[e];t.push(s.display)}return t},set:function(t){this.displayFrameCount=t.length;for(var e=0,i=0,s=t;i<s.length;i++){var a=s[i];this.replaceDisplay(a,e++)}},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"display",{get:function(){return this._display},set:function(t){this._display!==t&&(0===this._displayFrames.length&&(this.displayFrameCount=1,this._displayIndex=0),this.replaceDisplay(t,this._displayIndex))},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Slot.prototype.getDisplay=function(){return this._display},Slot.prototype.setDisplay=function(t){this.display=t},Slot}(t.TransformObject);t.Slot=i}(l||(l={})),function(t){var e=function(e){function Constraint(){return null!==e&&e.apply(this,arguments)||this}return a(Constraint,e),Constraint.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(Constraint.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),Constraint._helpMatrix=new t.Matrix,Constraint._helpTransform=new t.Transform,Constraint._helpPoint=new t.Point,Constraint}(t.BaseObject);t.Constraint=e;var i=function(e){function IKConstraint(){return null!==e&&e.apply(this,arguments)||this}return a(IKConstraint,e),IKConstraint.toString=function(){return"[class dragonBones.IKConstraint]"},IKConstraint.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},IKConstraint.prototype._computeA=function(){var e=this._target.global,i=this._root.global,s=this._root.globalTransformMatrix,a=Math.atan2(e.y-i.y,e.x-i.x);i.scaleX<0&&(a+=Math.PI),i.rotation+=t.Transform.normalizeRadian(a-i.rotation)*this._weight,i.toMatrix(s)},IKConstraint.prototype._computeB=function(){var e=this._bone._boneData.length,i=this._root,s=this._target.global,a=i.global,r=this._bone.global,n=this._bone.globalTransformMatrix,o=n.a*e,h=n.b*e,l=o*o+h*h,c=Math.sqrt(l),d=r.x-a.x,m=r.y-a.y,u=d*d+m*m,p=Math.sqrt(u),g=r.rotation,f=a.rotation,_=Math.atan2(m,d),y=(d=s.x-a.x)*d+(m=s.y-a.y)*m,v=Math.sqrt(y),S=0;if(c+p<=v||v+c<=p||v+p<=c)S=Math.atan2(s.y-a.y,s.x-a.x),c+p<=v||p<c&&(S+=Math.PI);else{var b=(u-l+y)/(2*y),T=Math.sqrt(u-b*b*y)/v,D=a.x+d*b,x=a.y+m*b,P=-m*T,C=d*T,w=!1,O=i.parent;if(null!==O){var A=O.globalTransformMatrix;w=A.a*A.d-A.b*A.c<0}w!==this._bendPositive?(r.x=D-P,r.y=x-C):(r.x=D+P,r.y=x+C),S=Math.atan2(r.y-a.y,r.x-a.x)}var B=t.Transform.normalizeRadian(S-_);a.rotation=f+B*this._weight,a.toMatrix(i.globalTransformMatrix);var E=_+B*this._weight;r.x=a.x+Math.cos(E)*p,r.y=a.y+Math.sin(E)*p;var I=Math.atan2(s.y-r.y,s.x-r.x);r.scaleX<0&&(I+=Math.PI),r.rotation=a.rotation+g-f+t.Transform.normalizeRadian(I-B-g)*this._weight,r.toMatrix(n)},IKConstraint.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var i=this._constraintData;this._scaleEnabled=i.scaleEnabled,this._bendPositive=i.bendPositive,this._weight=i.weight,this._root._hasConstraint=!0}},IKConstraint.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},IKConstraint.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},IKConstraint}(e);t.IKConstraint=i;var s=function(e){function PathConstraint(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return a(PathConstraint,e),PathConstraint.toString=function(){return"[class dragonBones.PathConstraint]"},PathConstraint.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},PathConstraint.prototype._updatePathVertices=function(t){var e=this._armature,i=e.armatureData.parent,s=e.armatureData.scale,a=i.intArray,r=i.floatArray,n=t.offset,o=a[n+0],h=a[n+2];this._pathGlobalVertices.length=2*o;var l=t.weight;if(null!==l)for(var c=this._pathSlot._geometryBones,d=l.bones.length,m=l.offset,u=a[m+1],p=m+2+d,g=(x=0,0);x<o;x++){for(var f=0,_=0,y=0,v=a[p++];y<v;y++){var S=c[a[p++]];if(null!==S){S.updateByConstraint();D=S.globalTransformMatrix;var b=r[u++];C=r[u++]*s,w=r[u++]*s;f+=(D.a*C+D.c*w+D.tx)*b,_+=(D.b*C+D.d*w+D.ty)*b}}this._pathGlobalVertices[g++]=f,this._pathGlobalVertices[g++]=_}else{var T=this._pathSlot.parent;T.updateByConstraint();for(var D=T.globalTransformMatrix,x=0,P=h;x<o;x+=2){var C=r[P++]*s,w=r[P++]*s,O=D.a*C+D.c*w+D.tx,A=D.b*C+D.d*w+D.ty;this._pathGlobalVertices[x]=O,this._pathGlobalVertices[x+1]=A}}},PathConstraint.prototype._computeVertices=function(t,e,i,s){for(var a=i,r=t;a<e;a+=2)s[a]=this._pathGlobalVertices[r++],s[a+1]=this._pathGlobalVertices[r++]},PathConstraint.prototype._computeBezierCurve=function(t,e,i,s,a){var r=this._armature.armatureData.parent.intArray[t.geometry.offset+0],n=this._positions,o=this._spaces,h=t.closed,l=Array(),c=2*r,d=c/6,m=-1,u=this.position;n.length=3*e+2;var p=0;if(t.constantSpeed){h?(c+=2,l.length=r,this._computeVertices(2,c-4,0,l),this._computeVertices(0,2,c-4,l),l[c-2]=l[0],l[c-1]=l[1]):(d--,c-=4,l.length=c,this._computeVertices(2,c,0,l));var g=new Array(d);p=0;for(var f,_,y,v,S,b,T,D,x=l[0],P=l[1],C=0,w=0,O=0,A=0,B=0,E=0,I=(V=0,2);V<d;V++,I+=6)C=l[I],w=l[I+1],O=l[I+2],A=l[I+3],S=2*(f=.1875*(x-2*C+O))+(y=.09375*(3*(C-O)-x+(B=l[I+4]))),b=2*(_=.1875*(P-2*w+A))+(v=.09375*(3*(w-A)-P+(E=l[I+5]))),T=.75*(C-x)+f+.16666667*y,D=.75*(w-P)+_+.16666667*v,p+=Math.sqrt(T*T+D*D),T+=S,D+=b,S+=y,b+=v,p+=Math.sqrt(T*T+D*D),T+=S,D+=b,p+=Math.sqrt(T*T+D*D),T+=S+y,D+=b+v,p+=Math.sqrt(T*T+D*D),g[V]=p,x=B,P=E;if(s&&(u*=p),a)for(V=0;V<e;V++)o[V]*=p;for(var M=this._segments,k=0,R=(V=0,z=0,G=0,0);V<e;V++,z+=3){var L=u+=o[V];if(h)(L%=p)<0&&(L+=p),G=0;else{if(L<0)continue;if(L>p)continue}for(;;G++){var F=g[G];if(!(L>F)){if(0===G)L/=F;else L=(L-(W=g[G-1]))/(F-W);break}}if(G!==m){m=G;var N=6*G;for(x=l[N],P=l[N+1],C=l[N+2],w=l[N+3],O=l[N+4],A=l[N+5],S=2*(f=.03*(x-2*C+O))+(y=.006*(3*(C-O)-x+(B=l[N+6]))),b=2*(_=.03*(P-2*w+A))+(v=.006*(3*(w-A)-P+(E=l[N+7]))),T=.3*(C-x)+f+.16666667*y,D=.3*(w-P)+_+.16666667*v,k=Math.sqrt(T*T+D*D),M[0]=k,N=1;N<8;N++)T+=S,D+=b,S+=y,b+=v,k+=Math.sqrt(T*T+D*D),M[N]=k;T+=S,D+=b,k+=Math.sqrt(T*T+D*D),M[8]=k,T+=S+y,D+=b+v,k+=Math.sqrt(T*T+D*D),M[9]=k,R=0}for(L*=k;;R++){var j=M[R];if(!(L>j)){var W;if(0===R)L/=j;else L=R+(L-(W=M[R-1]))/(j-W);break}}this.addCurvePosition(.1*L,x,P,C,w,O,A,B,E,n,z,i)}}else{var H=t.curveLengths;if(p=H[d-=h?1:2],s&&(u*=p),a)for(var V=0;V<e;V++)o[V]*=p;l.length=8;for(var V=0,z=0,G=0;V<e;V++,z+=3){if(u+=o[V],h)(u%=p)<0&&(u+=p),G=0;else{if(u<0)continue;if(u>p)continue}for(var U=0;;G++){var Y=H[G];if(!(u>Y)){if(0===G)U=u/Y;else{var X=H[G-1];U=(u-X)/(Y-X)}break}}G!==m&&(m=G,h&&G===d?(this._computeVertices(c-4,4,0,l),this._computeVertices(0,4,4,l)):this._computeVertices(6*G+2,8,0,l)),this.addCurvePosition(U,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],n,z,i)}}},PathConstraint.prototype.addCurvePosition=function(t,e,i,s,a,r,n,o,h,l,c,d){if(0===t)return l[c]=e,l[c+1]=i,void(l[c+2]=0);if(1===t)return l[c]=o,l[c+1]=h,void(l[c+2]=0);var m=1-t,u=m*m,p=t*t,g=u*m,f=u*t*3,_=m*p*3,y=t*p,v=g*e+f*s+_*r+y*o,S=g*i+f*a+_*n+y*h;l[c]=v,l[c+1]=S,l[c+2]=d?Math.atan2(S-(g*i+f*a+_*n),v-(g*e+f*s+_*r)):0},PathConstraint.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.geometry.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var s=0,a=i.bones.length;s<a;s++){var r=this._armature.getBone(i.bones[s].name);null!==r&&this._bones.push(r)}2===i.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},PathConstraint.prototype.update=function(){var e=this._pathSlot;if(null!==e._geometryData&&e._geometryData.offset===this.pathOffset){var i=this._constraintData,s=!1;if(this._root._childrenTransformDirty?(this._updatePathVertices(e._geometryData),s=!0):(e._verticesDirty||e._isBonesUpdate())&&(this._updatePathVertices(e._geometryData),e._verticesDirty=!1,s=!0),s||this.dirty){var a=i.positionMode,r=i.spacingMode,n=i.rotateMode,o=this._bones,h=0===r,l=2===n,c=0===n,d=o.length,m=c?d:d+1,u=this.spacing,p=this._spaces;if(p.length=m,l||h){p[0]=0;for(var g=0,f=m-1;g<f;g++){(A=o[g]).updateByConstraint();var _=A._boneData.length,y=_*(B=A.globalTransformMatrix).a,v=_*B.b,S=Math.sqrt(y*y+v*v);l&&(this._boneLengths[g]=S),p[g+1]=(_+u)*S/_}}else for(g=0;g<m;g++)p[g]=u;this._computeBezierCurve(e._displayFrame.rawDisplayData,m,c,1===a,2===r);var b,T=this._positions,D=this.rotateOffset,x=T[0],P=T[1];if(0===D)b=1===n;else if(b=!1,null!==(A=e.parent))D*=(B=A.globalTransformMatrix).a*B.d-B.b*B.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD;for(var C=this.rotateMix,w=this.translateMix,O=(g=0,3);g<d;g++,O+=3){var A,B;(A=o[g]).updateByConstraint(),(B=A.globalTransformMatrix).tx+=(x-B.tx)*w,B.ty+=(P-B.ty)*w;var E=(y=T[O])-x,I=(v=T[O+1])-P;if(l){var M=this._boneLengths[g],k=(Math.sqrt(E*E+I*I)/M-1)*C+1;B.a*=k,B.b*=k}if(x=y,P=v,C>0){var R=B.a,L=B.b,F=B.c,N=B.d,j=void 0,W=void 0,H=void 0;if(j=c?T[O-1]:Math.atan2(I,E),j-=Math.atan2(L,R),b){W=Math.cos(j),H=Math.sin(j);var V=A._boneData.length;x+=(V*(W*R-H*L)-E)*C,P+=(V*(H*R+W*L)-I)*C}else j+=D;j>t.Transform.PI?j-=t.Transform.PI_D:j<-t.Transform.PI&&(j+=t.Transform.PI_D),j*=C,W=Math.cos(j),H=Math.sin(j),B.a=W*R-H*L,B.b=H*R+W*L,B.c=W*F-H*N,B.d=H*F+W*N}A.global.fromMatrix(B)}this.dirty=!1}}},PathConstraint.prototype.invalidUpdate=function(){},PathConstraint}(e);t.PathConstraint=s}(l||(l={})),function(t){var e=function(){function WorldClock(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return WorldClock.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var i=0,s=0,a=this._animatebles.length;i<a;++i){var r=this._animatebles[i];null!==r?(s>0&&(this._animatebles[i-s]=r,this._animatebles[i]=null),r.advanceTime(t)):s++}if(s>0){for(a=this._animatebles.length;i<a;++i){var n=this._animatebles[i];null!==n?this._animatebles[i-s]=n:s++}this._animatebles.length-=s}}},WorldClock.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},WorldClock.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},WorldClock.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},WorldClock.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(WorldClock.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),WorldClock}();t.WorldClock=e}(l||(l={})),function(t){var e=function(e){function Animation(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._blendStates={},t._animationConfig=null,t}return a(Animation,e),Animation.toString=function(){return"[class dragonBones.Animation]"},Animation.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}for(var i in this._animations)delete this._animations[i];for(var i in this._blendStates){var s=this._blendStates[i];for(var a in s)s[a].returnToPool();delete this._blendStates[i]}null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},Animation.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++){null===(l=i[e])._parent&&(l.layer===t.layer&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 2:for(var s=0,a=this._animationStates;s<a.length;s++){null===(l=a[s])._parent&&(l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 3:for(var r=0,n=this._animationStates;r<n.length;r++){null===(l=n[r])._parent&&(l.layer===t.layer&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 4:for(var o=0,h=this._animationStates;o<h.length;o++){var l;null===(l=h[o])._parent&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},Animation.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},Animation.prototype.advanceTime=function(t){for(var e in t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale),this._blendStates){var i=this._blendStates[e];for(var s in i)i[s].reset()}var a=this._animationStates.length;if(1===a)if((f=this._animationStates[0])._fadeState>0&&f._subFadeState>0)this._armature._dragonBones.bufferObject(f),this._animationStates.length=0,this._lastAnimationState=null;else{var r=f.animationData,n=r.cacheFrameRate;if(this._animationDirty&&n>0){this._animationDirty=!1;for(var o=0,h=this._armature.getBones();o<h.length;o++){var l=h[o];l._cachedFrameIndices=r.getBoneCachedFrameIndices(l.name)}for(var c=0,d=this._armature.getSlots();c<d.length;c++){var m=d[c];if(m.displayFrameCount>0){var u=m.getDisplayFrameAt(0).rawDisplayData;if(null!==u&&u.parent===this._armature.armatureData.defaultSkin){m._cachedFrameIndices=r.getSlotCachedFrameIndices(m.name);continue}}m._cachedFrameIndices=null}}f.advanceTime(t,n)}else if(a>1){for(var p=0,g=0;p<a;++p){var f;(f=this._animationStates[p])._fadeState>0&&f._subFadeState>0?(g++,this._armature._dragonBones.bufferObject(f),this._animationDirty=!0,this._lastAnimationState===f&&(this._lastAnimationState=null)):(g>0&&(this._animationStates[p-g]=f),f.advanceTime(t,0)),p===a-1&&g>0&&(this._animationStates.length-=g,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},Animation.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},Animation.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(s=this.getState(t))&&s.stop();else for(var e=0,i=this._animationStates;e<i.length;e++){var s;(s=i[e]).stop()}},Animation.prototype.playConfig=function(e){var i=e.animation;if(!(i in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+i),null;var s=this._animations[i];if(5===e.fadeOutMode)for(var a=0,r=this._animationStates;a<r.length;a++){var n=r[a];if(n._fadeState<1&&n.layer===e.layer&&n.animationData===s)return n}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=s.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/s.scale),s.frameCount>0?(e.position<0?(e.position%=s.duration,e.position=s.duration-e.position):e.position===s.duration?e.position-=1e-6:e.position>s.duration&&(e.position%=s.duration),e.duration>0&&e.position+e.duration>s.duration&&(e.duration=s.duration-e.position),e.playTimes<0&&(e.playTimes=s.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var o=t.BaseObject.borrowObject(t.AnimationState);if(o.init(this._armature,s,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var h=!1,l=0,c=this._animationStates.length;l<c;++l){if(o.layer>this._animationStates[l].layer){h=!0,this._animationStates.splice(l,0,o);break}if(l!==c-1&&o.layer>this._animationStates[l+1].layer){h=!0,this._animationStates.splice(l+1,0,o);break}}h||this._animationStates.push(o)}else this._animationStates.push(o);for(var d=0,m=this._armature.getSlots();d<m.length;d++){var u=m[d].childArmature;null!==u&&u.inheritAnimation&&u.animation.hasAnimation(i)&&null===u.animation.getState(i)&&u.animation.fadeIn(i)}for(var p in s.animationTimelines){var g=this.fadeIn(p,0,1,o.layer,"",5);if(null!==g){var f=s.animationTimelines[p];g.actionEnabled=!1,g.resetToPose=!1,g.stop(),o.addState(g,f);var _=this._animationStates.indexOf(o),y=this._animationStates.indexOf(g);y<_&&(this._animationStates.splice(_,1),this._animationStates.splice(y,0,o))}}return this._lastAnimationState=o,o},Animation.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;null!==i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},Animation.prototype.fadeIn=function(t,e,i,s,a,r){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===s&&(s=0),void 0===a&&(a=null),void 0===r&&(r=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=r,this._animationConfig.playTimes=i,this._animationConfig.layer=s,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==a?a:"",this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var s=t in this._animations?this._animations[t]:null;return null!==s&&(this._animationConfig.position=s.frameCount>0?s.duration*e/s.frameCount:0),this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var s=t in this._animations?this._animations[t]:null;return null!==s&&(this._animationConfig.position=s.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},Animation.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.getBlendState=function(e,i,s){e in this._blendStates||(this._blendStates[e]={});var a=this._blendStates[e];i in a||((a[i]=t.BaseObject.borrowObject(t.BlendState)).target=s);return a[i]},Animation.prototype.getState=function(t,e){void 0===e&&(e=-1);for(var i=this._animationStates.length;i--;){var s=this._animationStates[i];if(s.name===t&&(e<0||s.layer===e))return s}return null},Animation.prototype.hasAnimation=function(t){return t in this._animations},Animation.prototype.getStates=function(){return this._animationStates},Object.defineProperty(Animation.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(e[t].isPlaying)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(!e[t].isCompleted)return!1}return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),Animation}(t.BaseObject);t.Animation=e}(l||(l={})),function(t){var e=function(e){function AnimationState(){var t=null!==e&&e.apply(this,arguments)||this;return t._boneMask=[],t._boneTimelines=[],t._boneBlendTimelines=[],t._slotTimelines=[],t._slotBlendTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._actionTimeline=null,t._zOrderTimeline=null,t}return a(AnimationState,e),AnimationState.toString=function(){return"[class dragonBones.AnimationState]"},AnimationState.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++){(m=e[t]).returnToPool()}for(var i=0,s=this._boneBlendTimelines;i<s.length;i++){(m=s[i]).returnToPool()}for(var a=0,r=this._slotTimelines;a<r.length;a++){(m=r[a]).returnToPool()}for(var n=0,o=this._slotBlendTimelines;n<o.length;n++){(m=o[n]).returnToPool()}for(var h=0,l=this._constraintTimelines;h<l.length;h++){(m=l[h]).returnToPool()}for(var c=0,d=this._animationTimelines;c<d.length;c++){var m,u=(m=d[c]).target;u._parent===this&&(u._fadeState=1,u._subFadeState=1,u._parent=null),m.returnToPool()}null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additive=!1,this.displayControl=!1,this.resetToPose=!1,this.blendType=0,this.playTimes=1,this.layer=0,this.timeScale=1,this._weight=1,this.parameterX=0,this.parameterY=0,this.positionX=0,this.positionY=0,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._boneMask.length=0,this._boneTimelines.length=0,this._boneBlendTimelines.length=0,this._slotTimelines.length=0,this._slotBlendTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._activeChildA=null,this._activeChildB=null,this._parent=null},AnimationState.prototype._updateTimelines=function(){for(var e=0,i=this._armature._constraints;e<i.length;e++){var s=i[e],a=this._animationData.getConstraintTimelines(s.name);if(null!==a)for(var r=0,n=a;r<n.length;r++){var o=n[r];switch(o.type){case 30:(h=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).target=s,h.init(this._armature,this,o),this._constraintTimelines.push(h)}}else if(this.resetToPose){var h;(h=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).target=s,h.init(this._armature,this,null),this._constraintTimelines.push(h),this._poseTimelines.push(h)}}},AnimationState.prototype._updateBoneAndSlotTimelines=function(){for(var e={},s=0,a=this._boneTimelines;s<a.length;s++){(c=(y=a[s]).target.target.name)in e||(e[c]=[]),e[c].push(y)}for(var r=0,n=this._boneBlendTimelines;r<n.length;r++){(c=(y=n[r]).target.target.name)in e||(e[c]=[]),e[c].push(y)}for(var o=0,h=this._armature.getBones();o<h.length;o++){var l=h[o],c=l.name;if(this.containsBoneMask(c))if(c in e)delete e[c];else{var d=this._animationData.getBoneTimelines(c),m=this._armature.animation.getBlendState(i.BONE_TRANSFORM,l.name,l);if(null!==d)for(var u=0,p=d;u<p.length;u++){switch((M=p[u]).type){case 10:(y=t.BaseObject.borrowObject(t.BoneAllTimelineState)).target=m,y.init(this._armature,this,M),this._boneTimelines.push(y);break;case 11:(y=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).target=m,y.init(this._armature,this,M),this._boneTimelines.push(y);break;case 12:(y=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).target=m,y.init(this._armature,this,M),this._boneTimelines.push(y);break;case 13:(y=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).target=m,y.init(this._armature,this,M),this._boneTimelines.push(y);break;case 60:(y=t.BaseObject.borrowObject(t.AlphaTimelineState)).target=this._armature.animation.getBlendState(i.BONE_ALPHA,l.name,l),y.init(this._armature,this,M),this._boneBlendTimelines.push(y);break;case 50:(y=t.BaseObject.borrowObject(t.SurfaceTimelineState)).target=this._armature.animation.getBlendState(i.SURFACE,l.name,l),y.init(this._armature,this,M),this._boneBlendTimelines.push(y)}}else if(this.resetToPose){if(0===l._boneData.type)(y=t.BaseObject.borrowObject(t.BoneAllTimelineState)).target=m,y.init(this._armature,this,null),this._boneTimelines.push(y),this._poseTimelines.push(y);else(y=t.BaseObject.borrowObject(t.SurfaceTimelineState)).target=this._armature.animation.getBlendState(i.SURFACE,l.name,l),y.init(this._armature,this,null),this._boneBlendTimelines.push(y),this._poseTimelines.push(y)}}}for(var g in e)for(var f=0,_=e[g];f<_.length;f++){var y=_[f];(W=this._boneTimelines.indexOf(y))>=0&&(this._boneTimelines.splice(W,1),y.returnToPool()),(W=this._boneBlendTimelines.indexOf(y))>=0&&(this._boneBlendTimelines.splice(W,1),y.returnToPool())}for(var v={},S=[],b=0,T=this._slotTimelines;b<T.length;b++){(c=(y=T[b]).target.name)in v||(v[c]=[]),v[c].push(y)}for(var D=0,x=this._slotBlendTimelines;D<x.length;D++){(c=(y=x[D]).target.target.name)in v||(v[c]=[]),v[c].push(y)}for(var P=0,C=this._armature.getSlots();P<C.length;P++){var w=C[P],O=w.parent.name;if(this.containsBoneMask(O))if((c=w.name)in v)delete v[c];else{var A=!1,B=!1;if(S.length=0,null!==(d=this._animationData.getSlotTimelines(c)))for(var E=0,I=d;E<I.length;E++){var M;switch((M=I[E]).type){case 20:(y=t.BaseObject.borrowObject(t.SlotDisplayTimelineState)).target=w,y.init(this._armature,this,M),this._slotTimelines.push(y),A=!0;break;case 23:(y=t.BaseObject.borrowObject(t.SlotZIndexTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_Z_INDEX,w.name,w),y.init(this._armature,this,M),this._slotBlendTimelines.push(y);break;case 21:(y=t.BaseObject.borrowObject(t.SlotColorTimelineState)).target=w,y.init(this._armature,this,M),this._slotTimelines.push(y),B=!0;break;case 22:(y=t.BaseObject.borrowObject(t.DeformTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_DEFORM,w.name,w),y.init(this._armature,this,M),null!==y.target?(this._slotBlendTimelines.push(y),S.push(y.geometryOffset)):y.returnToPool();break;case 24:(y=t.BaseObject.borrowObject(t.AlphaTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_ALPHA,w.name,w),y.init(this._armature,this,M),this._slotBlendTimelines.push(y)}}if(this.resetToPose){if(!A)(y=t.BaseObject.borrowObject(t.SlotDisplayTimelineState)).target=w,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y);if(!B)(y=t.BaseObject.borrowObject(t.SlotColorTimelineState)).target=w,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y);for(var k=0,R=w.displayFrameCount;k<R;++k){var L=w.getDisplayFrameAt(k);if(0!==L.deformVertices.length){var F=L.getGeometryData();if(null!==F&&S.indexOf(F.offset)<0)(y=t.BaseObject.borrowObject(t.DeformTimelineState)).geometryOffset=F.offset,y.displayFrame=L,y.target=this._armature.animation.getBlendState(i.SLOT_DEFORM,w.name,w),y.init(this._armature,this,null),this._slotBlendTimelines.push(y),this._poseTimelines.push(y)}}}}}for(var g in v)for(var N=0,j=v[g];N<j.length;N++){var W;y=j[N];(W=this._slotTimelines.indexOf(y))>=0&&(this._slotTimelines.splice(W,1),y.returnToPool()),(W=this._slotBlendTimelines.indexOf(y))>=0&&(this._slotBlendTimelines.splice(W,1),y.returnToPool())}},AnimationState.prototype._advanceFadeTime=function(e){var i=this._fadeState>0;if(this._subFadeState<0&&(this._subFadeState=0,null===this._parent&&this.actionEnabled)){var s=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasDBEventListener(s))(a=t.BaseObject.borrowObject(t.EventObject)).type=s,a.armature=this._armature,a.animationState=this,this._armature._dragonBones.bufferEvent(a)}if((e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0)&&(i||(this._playheadState|=1,this._fadeState=0),null===this._parent&&this.actionEnabled)){var a;s=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasDBEventListener(s))(a=t.BaseObject.borrowObject(t.EventObject)).type=s,a.armature=this._armature,a.animationState=this,this._armature._dragonBones.bufferEvent(a)}},AnimationState.prototype.init=function(e,i,s){if(null===this._armature){if(this._armature=e,this._animationData=i,this.resetToPose=s.resetToPose,this.additive=s.additive,this.displayControl=s.displayControl,this.actionEnabled=s.actionEnabled,this.blendType=i.blendType,this.layer=s.layer,this.playTimes=s.playTimes,this.timeScale=s.timeScale,this.fadeTotalTime=s.fadeInTime,this.autoFadeOutTime=s.autoFadeOutTime,this.name=s.name.length>0?s.name:s.animation,this.group=s.group,this._weight=s.weight,s.pauseFadeIn?this._playheadState=2:this._playheadState=3,s.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==s.position?this.timeScale>=0?this._time=s.position:this._time=s.position-this._duration:this._time=0):(this._position=s.position,this._duration=s.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),s.boneMask.length>0){this._boneMask.length=s.boneMask.length;for(var a=0,r=this._boneMask.length;a<r;++a)this._boneMask[a]=s.boneMask[a]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},AnimationState.prototype.advanceTime=function(t,e){0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines());var i=0!==this._fadeState||0===this._subFadeState,s=0===this._fadeState&&e>0,a=!0,r=!0,n=this._time;if(this._weightResult=this._weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult),this._actionTimeline.playState<=0&&this._actionTimeline.update(n),0!==this._weight){if(s){var o=2*e;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*o)/o}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(n),s){var h=Math.floor(this._actionTimeline.currentTime*e);this._armature._cacheFrameIndex===h?(a=!1,r=!1):(this._armature._cacheFrameIndex=h,this._animationData.cachedFrames[h]?r=!1:this._animationData.cachedFrames[h]=!0)}if(a){var l=!1,c=null;if(r)for(var d=0,m=this._boneTimelines.length;d<m;++d){if((x=this._boneTimelines[d]).playState<=0&&x.update(n),x.target!==c)if(l=(g=x.target).update(this),c=g,1===g.dirty){var u=g.target.animationPose;u.x=0,u.y=0,u.rotation=0,u.skew=0,u.scaleX=1,u.scaleY=1}l&&x.blend(i)}for(d=0,m=this._boneBlendTimelines.length;d<m;++d){(x=this._boneBlendTimelines[d]).playState<=0&&x.update(n),x.target.update(this)&&x.blend(i)}if(this.displayControl)for(d=0,m=this._slotTimelines.length;d<m;++d){if((x=this._slotTimelines[d]).playState<=0){var p=x.target.displayController;null!==p&&p!==this.name&&p!==this.group||x.update(n)}}for(d=0,m=this._slotBlendTimelines.length;d<m;++d){if((x=this._slotBlendTimelines[d]).playState<=0){var g=x.target;x.update(n),g.update(this)&&x.blend(i)}}for(d=0,m=this._constraintTimelines.length;d<m;++d){(x=this._constraintTimelines[d]).playState<=0&&x.update(n)}if(this._animationTimelines.length>0){var f=100,_=100,y=null,v=null;for(d=0,m=this._animationTimelines.length;d<m;++d){if((x=this._animationTimelines[d]).playState<=0&&x.update(n),1===this.blendType){var S=x.target,b=this.parameterX-S.positionX;b>=0?b<f&&(f=b,y=S):-b<_&&(_=-b,v=S)}}null!==y&&(this._activeChildA!==y&&(null!==this._activeChildA&&(this._activeChildA.weight=0),this._activeChildA=y,this._activeChildA.activeTimeline()),this._activeChildB!==v&&(null!==this._activeChildB&&(this._activeChildB.weight=0),this._activeChildB=v),y.weight=_/(f+_),v&&(v.weight=1-y.weight))}}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var T=0,D=this._poseTimelines;T<D.length;T++){var x=D[T],P=this._boneTimelines.indexOf(x);P>=0?(this._boneTimelines.splice(P,1),x.returnToPool()):(P=this._boneBlendTimelines.indexOf(x))>=0?(this._boneBlendTimelines.splice(P,1),x.returnToPool()):(P=this._slotTimelines.indexOf(x))>=0?(this._slotTimelines.splice(P,1),x.returnToPool()):(P=this._slotBlendTimelines.indexOf(x))>=0?(this._slotBlendTimelines.splice(P,1),x.returnToPool()):(P=this._constraintTimelines.indexOf(x))>=0&&(this._constraintTimelines.splice(P,1),x.returnToPool())}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},AnimationState.prototype.play=function(){this._playheadState=3},AnimationState.prototype.stop=function(){this._playheadState&=1},AnimationState.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,s=this._boneTimelines;i<s.length;i++){(p=s[i]).fadeOut()}for(var a=0,r=this._boneBlendTimelines;a<r.length;a++){(p=r[a]).fadeOut()}for(var n=0,o=this._slotTimelines;n<o.length;n++){(p=o[n]).fadeOut()}for(var h=0,l=this._slotBlendTimelines;h<l.length;h++){(p=l[h]).fadeOut()}for(var c=0,d=this._constraintTimelines;c<d.length;c++){(p=d[c]).fadeOut()}for(var m=0,u=this._animationTimelines;m<u.length;m++){var p;(p=u[m]).fadeOut(),p.target.fadeOut(999999,!0)}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},AnimationState.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},AnimationState.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var s=0,a=this._armature.getBones();s<a.length;s++){var r=a[s];this._boneMask.indexOf(r.name)<0&&i.contains(r)&&this._boneMask.push(r.name)}this._timelineDirty=1}},AnimationState.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var s=this._armature.getBone(t);if(null!==s){var a=this._armature.getBones();if(this._boneMask.length>0)for(var r=0,n=a;r<n.length;r++){var o=n[r],h=this._boneMask.indexOf(o.name);h>=0&&s.contains(o)&&this._boneMask.splice(h,1)}else for(var l=0,c=a;l<c.length;l++){(o=c[l])!==s&&(s.contains(o)||this._boneMask.push(o.name))}}}this._timelineDirty=1},AnimationState.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},AnimationState.prototype.addState=function(e,i){if(void 0===i&&(i=null),null!==i)for(var s=0,a=i;s<a.length;s++){var r=a[s];switch(r.type){case 40:if((o=t.BaseObject.borrowObject(t.AnimationProgressTimelineState)).target=e,o.init(this._armature,this,r),this._animationTimelines.push(o),0!==this.blendType){var n=r;e.positionX=n.x,e.positionY=n.y,e.weight=0}e._parent=this,this.resetToPose=!1;break;case 41:(o=t.BaseObject.borrowObject(t.AnimationWeightTimelineState)).target=e,o.init(this._armature,this,r),this._animationTimelines.push(o);break;case 42:var o;(o=t.BaseObject.borrowObject(t.AnimationParametersTimelineState)).target=e,o.init(this._armature,this,r),this._animationTimelines.push(o)}}null===e._parent&&(e._parent=this)},AnimationState.prototype.activeTimeline=function(){for(var t=0,e=this._slotTimelines;t<e.length;t++){var i=e[t];i.dirty=!0,i.currentTime=-1}},Object.defineProperty(AnimationState.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&null===this._parent&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,s=this._boneTimelines;i<s.length;i++){s[i].playState=-1}for(var a=0,r=this._slotTimelines;a<r.length;a++){r[a].playState=-1}}},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"weight",{get:function(){return this._weight},set:function(t){if(this._weight!==t){this._weight=t;for(var e=0,i=this._boneTimelines;e<i.length;e++){i[e].dirty=!0}for(var s=0,a=this._boneBlendTimelines;s<a.length;s++){a[s].dirty=!0}for(var r=0,n=this._slotBlendTimelines;r<n.length;r++){n[r].dirty=!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),AnimationState}(t.BaseObject);t.AnimationState=e;var i=function(t){function BlendState(){return null!==t&&t.apply(this,arguments)||this}return a(BlendState,t),BlendState.toString=function(){return"[class dragonBones.BlendState]"},BlendState.prototype._onClear=function(){this.reset(),this.target=null},BlendState.prototype.update=function(t){var e=t.layer,i=t._weightResult;if(this.dirty>0){if(this.leftWeight>0){if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.dirty++,this.layer=e,this.leftWeight=0,this.blendWeight=0,!1;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return i*=this.leftWeight,this.dirty++,this.blendWeight=i,this.layerWeight+=this.blendWeight,!0}return!1}return this.dirty++,this.layer=e,this.leftWeight=1,this.blendWeight=i,this.layerWeight=i,!0},BlendState.prototype.reset=function(){this.dirty=0,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},BlendState.BONE_TRANSFORM="boneTransform",BlendState.BONE_ALPHA="boneAlpha",BlendState.SURFACE="surface",BlendState.SLOT_DEFORM="slotDeform",BlendState.SLOT_ALPHA="slotAlpha",BlendState.SLOT_Z_INDEX="slotZIndex",BlendState}(t.BaseObject);t.BlendState=i}(l||(l={})),function(t){var e=function(t){function TimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(TimelineState,t),TimelineState.prototype._onClear=function(){this.dirty=!1,this.playState=-1,this.currentPlayTimes=0,this.currentTime=-1,this.target=null,this._isTween=!1,this._valueOffset=0,this._frameValueOffset=0,this._frameOffset=0,this._frameRate=0,this._frameCount=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._valueArray=null,this._timelineArray=null,this._frameIndices=null},TimelineState.prototype._setCurrentTime=function(t){var e=this.playState,i=this.currentPlayTimes,s=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var a=this._animationState.playTimes,r=a*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),a>0&&(t>=r||t<=-r)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=a,this.currentTime=t<0?0:1===this.playState?this._duration+1e-6:this._duration):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==i||this.currentTime!==s)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i)&&(this._frameIndex=-1),!0)},TimelineState.prototype.init=function(t,e,i){if(this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState.animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,null!==this._timelineData){var s=this._animationData.parent.parent;this._frameArray=s.frameArray,this._timelineArray=s.timelineArray,this._frameIndices=s.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1]}},TimelineState.prototype.fadeOut=function(){this.dirty=!1},TimelineState.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),i=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==i&&(this._frameIndex=i,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());(this._isTween||this.dirty)&&this._onUpdateFrame()}},TimelineState.prototype.blend=function(t){},TimelineState}(t.BaseObject);t.TimelineState=e;var i=function(t){function TweenTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(TweenTimelineState,t),TweenTimelineState._getEasingValue=function(t,e,i){var s=e;switch(t){case 3:s=Math.pow(e,2);break;case 4:s=1-Math.pow(1-e,2);break;case 5:s=.5*(1-Math.cos(e*Math.PI))}return(s-e)*i+e},TweenTimelineState._getEasingCurveValue=function(t,e,i,s){if(t<=0)return 0;if(t>=1)return 1;var a=i>0,r=i+1,n=Math.floor(t*r),o=0,h=0;return a?(o=0===n?0:e[s+n-1],h=n===r-1?1e4:e[s+n]):(o=e[s+n-1],h=e[s+n]),1e-4*(o+(h-o)*(t*r-n))},TweenTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenEasing=0,this._tweenProgress=0,this._valueScale=1},TweenTimelineState.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._isTween=0!==this._tweenType,this._isTween?2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]):this.dirty=!0,this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this.dirty=!0,this._isTween=!1},TweenTimelineState.prototype._onUpdateFrame=function(){this._isTween&&(this.dirty=!0,this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=TweenTimelineState._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=TweenTimelineState._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing)))},TweenTimelineState}(e);t.TweenTimelineState=i;var s=function(t){function SingleValueTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(SingleValueTimelineState,t),SingleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._difference=0,this._result=0},SingleValueTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,s=this._valueOffset+this._frameValueOffset+this._frameIndex;if(this._isTween){var a=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:s+1;1===e?(this._current=i[s],this._difference=i[a]-this._current):(this._current=i[s]*e,this._difference=i[a]*e-this._current)}else this._result=i[s]*e}else this._result=0},SingleValueTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result=this._current+this._difference*this._tweenProgress)},SingleValueTimelineState}(i);t.SingleValueTimelineState=s;var r=function(t){function DoubleValueTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(DoubleValueTimelineState,t),DoubleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._currentA=0,this._currentB=0,this._differenceA=0,this._differenceB=0,this._resultA=0,this._resultB=0},DoubleValueTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,s=this._valueOffset+this._frameValueOffset+2*this._frameIndex;if(this._isTween){var a=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:s+2;1===e?(this._currentA=i[s],this._currentB=i[s+1],this._differenceA=i[a]-this._currentA,this._differenceB=i[a+1]-this._currentB):(this._currentA=i[s]*e,this._currentB=i[s+1]*e,this._differenceA=i[a]*e-this._currentA,this._differenceB=i[a+1]*e-this._currentB)}else this._resultA=i[s]*e,this._resultB=i[s+1]*e}else this._resultA=0,this._resultB=0},DoubleValueTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._resultA=this._currentA+this._differenceA*this._tweenProgress,this._resultB=this._currentB+this._differenceB*this._tweenProgress)},DoubleValueTimelineState}(i);t.DoubleValueTimelineState=r;var n=function(t){function MutilpleValueTimelineState(){var e=null!==t&&t.apply(this,arguments)||this;return e._rd=[],e}return a(MutilpleValueTimelineState,t),MutilpleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._valueCount=0,this._rd.length=0},MutilpleValueTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this._valueCount,i=this._rd;if(null!==this._timelineData){var s=this._valueScale,a=this._valueArray,r=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(this._isTween){var n=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:r+e;if(1===s)for(var o=0;o<e;++o)i[e+o]=a[n+o]-a[r+o];else for(o=0;o<e;++o)i[e+o]=(a[n+o]-a[r+o])*s}else if(1===s)for(o=0;o<e;++o)i[o]=a[r+o];else for(o=0;o<e;++o)i[o]=a[r+o]*s}else for(o=0;o<e;++o)i[o]=0},MutilpleValueTimelineState.prototype._onUpdateFrame=function(){if(t.prototype._onUpdateFrame.call(this),this._isTween){var e=this._valueCount,i=this._valueScale,s=this._tweenProgress,a=this._valueArray,r=this._rd,n=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(1===i)for(var o=0;o<e;++o)r[o]=a[n+o]+r[e+o]*s;else for(o=0;o<e;++o)r[o]=a[n+o]*i+r[e+o]*s}},MutilpleValueTimelineState}(i);t.MutilpleValueTimelineState=n}(l||(l={})),function(t){var e=function(e){function ActionTimelineState(){return null!==e&&e.apply(this,arguments)||this}return a(ActionTimelineState,e),ActionTimelineState.toString=function(){return"[class dragonBones.ActionTimelineState]"},ActionTimelineState.prototype._onCrossFrame=function(e){var i=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var s=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],a=this._frameArray[s+1],r=this._animationData.parent.actions,n=0;n<a;++n){var o=r[this._frameArray[s+2+n]];if(0===o.type){(h=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[s]/this._frameRate,h.animationState=this._animationState,t.EventObject.actionDataToInstance(o,h,this._armature),this._armature._bufferAction(h,!0)}else{var h,l=10===o.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;if(11===o.type||i.hasDBEventListener(l))(h=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[s]/this._frameRate,h.animationState=this._animationState,t.EventObject.actionDataToInstance(o,h,this._armature),this._armature._dragonBones.bufferEvent(h)}}},ActionTimelineState.prototype._onArriveAtFrame=function(){},ActionTimelineState.prototype._onUpdateFrame=function(){},ActionTimelineState.prototype.update=function(e){var i=this.playState,s=this.currentPlayTimes,a=this.currentTime;if(this._setCurrentTime(e)){var r=null===this._animationState._parent&&this._animationState.actionEnabled,n=this._armature.eventDispatcher;if(i<0){if(this.playState===i)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),r&&n.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var h=this._animationState.timeScale<0,l=null,c=null;if(r&&this.currentPlayTimes!==s&&(n.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((l=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,l.armature=this._armature,l.animationState=this._animationState),this.playState>0&&n.hasDBEventListener(t.EventObject.COMPLETE)&&((c=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,c.armature=this._armature,c.animationState=this._animationState)),this._frameCount>1){var d=this._timelineData,m=Math.floor(this.currentTime*this._frameRate),u=this._frameIndices[d.frameIndicesOffset+m];if(this._frameIndex!==u){var p=this._frameIndex;if(this._frameIndex=u,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[d.offset+5+this._frameIndex],h){if(p<0){var g=Math.floor(a*this._frameRate);p=this._frameIndices[d.frameIndicesOffset+g],this.currentPlayTimes===s&&p===u&&(p=-1)}for(;p>=0;){var f=this._animationData.frameOffset+this._timelineArray[d.offset+5+p],_=this._frameArray[f]/this._frameRate;if(this._position<=_&&_<=this._position+this._duration&&this._onCrossFrame(p),null!==l&&0===p&&(this._armature._dragonBones.bufferEvent(l),l=null),p>0?p--:p=this._frameCount-1,p===u)break}}else{if(p<0){g=Math.floor(a*this._frameRate);p=this._frameIndices[d.frameIndicesOffset+g];f=this._animationData.frameOffset+this._timelineArray[d.offset+5+p],_=this._frameArray[f]/this._frameRate;this.currentPlayTimes===s&&(a<=_?p>0?p--:p=this._frameCount-1:p===u&&(p=-1))}for(;p>=0;){p<this._frameCount-1?p++:p=0;f=this._animationData.frameOffset+this._timelineArray[d.offset+5+p],_=this._frameArray[f]/this._frameRate;if(this._position<=_&&_<=this._position+this._duration&&this._onCrossFrame(p),null!==l&&0===p&&(this._armature._dragonBones.bufferEvent(l),l=null),p===u)break}}}}else if(this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];_=this._frameArray[this._frameOffset]/this._frameRate;this.currentPlayTimes===s?a<=_&&this._onCrossFrame(this._frameIndex):this._position<=_&&(h||null===l||(this._armature._dragonBones.bufferEvent(l),l=null),this._onCrossFrame(this._frameIndex))}null!==l&&this._armature._dragonBones.bufferEvent(l),null!==c&&this._armature._dragonBones.bufferEvent(c)}},ActionTimelineState.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},ActionTimelineState}(t.TimelineState);t.ActionTimelineState=e;var i=function(t){function ZOrderTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(ZOrderTimelineState,t),ZOrderTimelineState.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},ZOrderTimelineState.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},ZOrderTimelineState.prototype._onUpdateFrame=function(){},ZOrderTimelineState}(t.TimelineState);t.ZOrderTimelineState=i;var s=function(e){function BoneAllTimelineState(){return null!==e&&e.apply(this,arguments)||this}return a(BoneAllTimelineState,e),BoneAllTimelineState.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},BoneAllTimelineState.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])),null===this._timelineData&&(this._rd[4]=1,this._rd[5]=1)},BoneAllTimelineState.prototype.init=function(t,i,s){e.prototype.init.call(this,t,i,s),this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=6,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneAllTimelineState.prototype.fadeOut=function(){this.dirty=!1,this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])},BoneAllTimelineState.prototype.blend=function(t){var e=this._armature.armatureData.scale,i=this._rd,s=this.target,a=s.target,r=s.blendWeight,n=a.animationPose;s.dirty>1?(n.x+=i[0]*r*e,n.y+=i[1]*r*e,n.rotation+=i[2]*r,n.skew+=i[3]*r,n.scaleX+=(i[4]-1)*r,n.scaleY+=(i[5]-1)*r):(n.x=i[0]*r*e,n.y=i[1]*r*e,n.rotation=i[2]*r,n.skew=i[3]*r,n.scaleX=(i[4]-1)*r+1,n.scaleY=(i[5]-1)*r+1),(t||this.dirty)&&(this.dirty=!1,a._transformDirty=!0)},BoneAllTimelineState}(t.MutilpleValueTimelineState);t.BoneAllTimelineState=s;var r=function(t){function BoneTranslateTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(BoneTranslateTimelineState,t),BoneTranslateTimelineState.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},BoneTranslateTimelineState.prototype.init=function(e,i,s){t.prototype.init.call(this,e,i,s),this._valueOffset=this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneTranslateTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,s=e.blendWeight,a=i.animationPose;e.dirty>1?(a.x+=this._resultA*s,a.y+=this._resultB*s):1!==s?(a.x=this._resultA*s,a.y=this._resultB*s):(a.x=this._resultA,a.y=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneTranslateTimelineState}(t.DoubleValueTimelineState);t.BoneTranslateTimelineState=r;var n=function(e){function BoneRotateTimelineState(){return null!==e&&e.apply(this,arguments)||this}return a(BoneRotateTimelineState,e),BoneRotateTimelineState.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},BoneRotateTimelineState.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._differenceA=t.Transform.normalizeRadian(this._differenceA),this._differenceB=t.Transform.normalizeRadian(this._differenceB))},BoneRotateTimelineState.prototype.init=function(t,i,s){e.prototype.init.call(this,t,i,s),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneRotateTimelineState.prototype.fadeOut=function(){this.dirty=!1,this._resultA=t.Transform.normalizeRadian(this._resultA),this._resultB=t.Transform.normalizeRadian(this._resultB)},BoneRotateTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,s=e.blendWeight,a=i.animationPose;e.dirty>1?(a.rotation+=this._resultA*s,a.skew+=this._resultB*s):1!==s?(a.rotation=this._resultA*s,a.skew=this._resultB*s):(a.rotation=this._resultA,a.skew=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneRotateTimelineState}(t.DoubleValueTimelineState);t.BoneRotateTimelineState=n;var o=function(t){function BoneScaleTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(BoneScaleTimelineState,t),BoneScaleTimelineState.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},BoneScaleTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._resultA=1,this._resultB=1)},BoneScaleTimelineState.prototype.init=function(e,i,s){t.prototype.init.call(this,e,i,s),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneScaleTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,s=e.blendWeight,a=i.animationPose;e.dirty>1?(a.scaleX+=(this._resultA-1)*s,a.scaleY+=(this._resultB-1)*s):1!==s?(a.scaleX=(this._resultA-1)*s+1,a.scaleY=(this._resultB-1)*s+1):(a.scaleX=this._resultA,a.scaleY=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneScaleTimelineState}(t.DoubleValueTimelineState);t.BoneScaleTimelineState=o;var h=function(t){function SurfaceTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(SurfaceTimelineState,t),SurfaceTimelineState.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},SurfaceTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},SurfaceTimelineState.prototype.init=function(e,i,s){if(t.prototype.init.call(this,e,i,s),null!==this._timelineData){var a=this._animationData.parent.parent,r=a.frameIntArray,n=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=r[n+2],this._deformCount=r[n+1],this._deformOffset=r[n+3],this._sameValueOffset=r[n+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=a.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.target.target._deformVertices.length},SurfaceTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,s=e.blendWeight,a=i._deformVertices,r=this._valueArray;if(null!==r)for(var n=this._valueCount,o=this._deformOffset,h=this._sameValueOffset,l=this._rd,c=0;c<this._deformCount;++c){var d=0;d=c<o?r[h+c]:c<o+n?l[c-o]:r[h+c-n],e.dirty>1?a[c]+=d*s:a[c]=d*s}else if(1===e.dirty)for(c=0;c<this._deformCount;++c)a[c]=0;(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},SurfaceTimelineState}(t.MutilpleValueTimelineState);t.SurfaceTimelineState=h;var l=function(t){function AlphaTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(AlphaTimelineState,t),AlphaTimelineState.toString=function(){return"[class dragonBones.AlphaTimelineState]"},AlphaTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._result=1)},AlphaTimelineState.prototype.init=function(e,i,s){t.prototype.init.call(this,e,i,s),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},AlphaTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,s=e.blendWeight;e.dirty>1?(i._alpha+=this._result*s,i._alpha>1&&(i._alpha=1)):i._alpha=this._result*s,(t||this.dirty)&&(this.dirty=!1,this._armature._alphaDirty=!0)},AlphaTimelineState}(t.SingleValueTimelineState);t.AlphaTimelineState=l;var c=function(t){function SlotDisplayTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(SlotDisplayTimelineState,t),SlotDisplayTimelineState.toString=function(){return"[class dragonBones.SlotDisplayTimelineState]"},SlotDisplayTimelineState.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this.target,e=null!==this._timelineData?this._frameArray[this._frameOffset+1]:t._slotData.displayIndex;t.displayIndex!==e&&t._setDisplayIndex(e,!0)}},SlotDisplayTimelineState.prototype._onUpdateFrame=function(){},SlotDisplayTimelineState}(t.TimelineState);t.SlotDisplayTimelineState=c;var d=function(t){function SlotColorTimelineState(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._difference=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return a(SlotColorTimelineState,t),SlotColorTimelineState.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},SlotColorTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.parent.parent,i=e.colorArray,s=e.frameIntArray,a=this._animationData.frameIntOffset+this._frameValueOffset+this._frameIndex,r=s[a];r<0&&(r+=65536),this._isTween?(this._current[0]=i[r++],this._current[1]=i[r++],this._current[2]=i[r++],this._current[3]=i[r++],this._current[4]=i[r++],this._current[5]=i[r++],this._current[6]=i[r++],this._current[7]=i[r++],(r=this._frameIndex===this._frameCount-1?s[this._animationData.frameIntOffset+this._frameValueOffset]:s[a+1])<0&&(r+=65536),this._difference[0]=i[r++]-this._current[0],this._difference[1]=i[r++]-this._current[1],this._difference[2]=i[r++]-this._current[2],this._difference[3]=i[r++]-this._current[3],this._difference[4]=i[r++]-this._current[4],this._difference[5]=i[r++]-this._current[5],this._difference[6]=i[r++]-this._current[6],this._difference[7]=i[r++]-this._current[7]):(this._result[0]=.01*i[r++],this._result[1]=.01*i[r++],this._result[2]=.01*i[r++],this._result[3]=.01*i[r++],this._result[4]=i[r++],this._result[5]=i[r++],this._result[6]=i[r++],this._result[7]=i[r++])}else{var n=this.target.slotData.color;this._result[0]=n.alphaMultiplier,this._result[1]=n.redMultiplier,this._result[2]=n.greenMultiplier,this._result[3]=n.blueMultiplier,this._result[4]=n.alphaOffset,this._result[5]=n.redOffset,this._result[6]=n.greenOffset,this._result[7]=n.blueOffset}},SlotColorTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result[0]=.01*(this._current[0]+this._difference[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._difference[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._difference[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._difference[3]*this._tweenProgress),this._result[4]=this._current[4]+this._difference[4]*this._tweenProgress,this._result[5]=this._current[5]+this._difference[5]*this._tweenProgress,this._result[6]=this._current[6]+this._difference[6]*this._tweenProgress,this._result[7]=this._current[7]+this._difference[7]*this._tweenProgress)},SlotColorTimelineState.prototype.fadeOut=function(){this._isTween=!1},SlotColorTimelineState.prototype.update=function(e){if(t.prototype.update.call(this,e),this._isTween||this.dirty){var i=this.target,s=i._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(s.alphaMultiplier!==this._result[0]||s.redMultiplier!==this._result[1]||s.greenMultiplier!==this._result[2]||s.blueMultiplier!==this._result[3]||s.alphaOffset!==this._result[4]||s.redOffset!==this._result[5]||s.greenOffset!==this._result[6]||s.blueOffset!==this._result[7]){var a=Math.pow(this._animationState._fadeProgress,4);s.alphaMultiplier+=(this._result[0]-s.alphaMultiplier)*a,s.redMultiplier+=(this._result[1]-s.redMultiplier)*a,s.greenMultiplier+=(this._result[2]-s.greenMultiplier)*a,s.blueMultiplier+=(this._result[3]-s.blueMultiplier)*a,s.alphaOffset+=(this._result[4]-s.alphaOffset)*a,s.redOffset+=(this._result[5]-s.redOffset)*a,s.greenOffset+=(this._result[6]-s.greenOffset)*a,s.blueOffset+=(this._result[7]-s.blueOffset)*a,i._colorDirty=!0}}else this.dirty&&(this.dirty=!1,s.alphaMultiplier===this._result[0]&&s.redMultiplier===this._result[1]&&s.greenMultiplier===this._result[2]&&s.blueMultiplier===this._result[3]&&s.alphaOffset===this._result[4]&&s.redOffset===this._result[5]&&s.greenOffset===this._result[6]&&s.blueOffset===this._result[7]||(s.alphaMultiplier=this._result[0],s.redMultiplier=this._result[1],s.greenMultiplier=this._result[2],s.blueMultiplier=this._result[3],s.alphaOffset=this._result[4],s.redOffset=this._result[5],s.greenOffset=this._result[6],s.blueOffset=this._result[7],i._colorDirty=!0))}},SlotColorTimelineState}(t.TweenTimelineState);t.SlotColorTimelineState=d;var m=function(t){function SlotZIndexTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(SlotZIndexTimelineState,t),SlotZIndexTimelineState.toString=function(){return"[class dragonBones.SlotZIndexTimelineState]"},SlotZIndexTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null===this._timelineData){var e=this.target.target;this._result=e.slotData.zIndex}},SlotZIndexTimelineState.prototype.init=function(e,i,s){t.prototype.init.call(this,e,i,s),this._valueOffset=this._animationData.frameIntOffset,this._valueArray=this._animationData.parent.parent.frameIntArray},SlotZIndexTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,s=e.blendWeight;e.dirty>1?i._zIndex+=this._result*s:i._zIndex=this._result*s,(t||this.dirty)&&(this.dirty=!1,this._armature._zIndexDirty=!0)},SlotZIndexTimelineState}(t.SingleValueTimelineState);t.SlotZIndexTimelineState=m;var u=function(t){function DeformTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(DeformTimelineState,t),DeformTimelineState.toString=function(){return"[class dragonBones.DeformTimelineState]"},DeformTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this.geometryOffset=0,this.displayFrame=null,this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},DeformTimelineState.prototype.init=function(e,i,s){if(t.prototype.init.call(this,e,i,s),null!==this._timelineData){var a=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],r=this._animationData.parent.parent,n=r.frameIntArray,o=this.target.target;this.geometryOffset=n[a+0],this.geometryOffset<0&&(this.geometryOffset+=65536);for(var h=0,l=o.displayFrameCount;h<l;++h){var c=o.getDisplayFrameAt(h),d=c.getGeometryData();if(null!==d&&d.offset===this.geometryOffset){this.displayFrame=c,this.displayFrame.updateDeformVertices();break}}if(null===this.displayFrame)return void this.returnToPool();this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=n[a+2],this._deformCount=n[a+1],this._deformOffset=n[a+3],this._sameValueOffset=n[a+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=r.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.displayFrame.deformVertices.length},DeformTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,s=e.blendWeight,a=this.displayFrame.deformVertices,r=this._valueArray;if(null!==r)for(var n=this._valueCount,o=this._deformOffset,h=this._sameValueOffset,l=this._rd,c=0;c<this._deformCount;++c){var d=0;d=c<o?r[h+c]:c<o+n?l[c-o]:r[h+c-n],e.dirty>1?a[c]+=d*s:a[c]=d*s}else if(1===e.dirty)for(c=0;c<this._deformCount;++c)a[c]=0;(t||this.dirty)&&(this.dirty=!1,i._geometryData===this.displayFrame.getGeometryData()&&(i._verticesDirty=!0))},DeformTimelineState}(t.MutilpleValueTimelineState);t.DeformTimelineState=u;var p=function(t){function IKConstraintTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(IKConstraintTimelineState,t),IKConstraintTimelineState.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},IKConstraintTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;if(null!==this._timelineData)e._bendPositive=this._currentA>0,e._weight=this._currentB;else{var i=e._constraintData;e._bendPositive=i.bendPositive,e._weight=i.weight}e.invalidUpdate(),this.dirty=!1},IKConstraintTimelineState.prototype.init=function(e,i,s){t.prototype.init.call(this,e,i,s),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},IKConstraintTimelineState}(t.DoubleValueTimelineState);t.IKConstraintTimelineState=p;var g=function(t){function AnimationProgressTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(AnimationProgressTimelineState,t),AnimationProgressTimelineState.toString=function(){return"[class dragonBones.AnimationProgressTimelineState]"},AnimationProgressTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.currentTime=this._result*e.totalTime),this.dirty=!1},AnimationProgressTimelineState.prototype.init=function(e,i,s){t.prototype.init.call(this,e,i,s),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationProgressTimelineState}(t.SingleValueTimelineState);t.AnimationProgressTimelineState=g;var f=function(t){function AnimationWeightTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(AnimationWeightTimelineState,t),AnimationWeightTimelineState.toString=function(){return"[class dragonBones.AnimationWeightTimelineState]"},AnimationWeightTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.weight=this._result),this.dirty=!1},AnimationWeightTimelineState.prototype.init=function(e,i,s){t.prototype.init.call(this,e,i,s),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationWeightTimelineState}(t.SingleValueTimelineState);t.AnimationWeightTimelineState=f;var _=function(t){function AnimationParametersTimelineState(){return null!==t&&t.apply(this,arguments)||this}return a(AnimationParametersTimelineState,t),AnimationParametersTimelineState.toString=function(){return"[class dragonBones.AnimationParametersTimelineState]"},AnimationParametersTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.parameterX=this._resultA,e.parameterY=this._resultB),this.dirty=!1},AnimationParametersTimelineState.prototype.init=function(e,i,s){t.prototype.init.call(this,e,i,s),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationParametersTimelineState}(t.DoubleValueTimelineState);t.AnimationParametersTimelineState=_}(l||(l={})),function(t){var e=function(t){function EventObject(){return null!==t&&t.apply(this,arguments)||this}return a(EventObject,t),EventObject.actionDataToInstance=function(t,e,i){0===t.type?e.type=EventObject.FRAME_EVENT:e.type=10===t.type?EventObject.FRAME_EVENT:EventObject.SOUND_EVENT,e.name=t.name,e.armature=i,e.actionData=t,e.data=t.data,null!==t.bone&&(e.bone=i.getBone(t.bone.name)),null!==t.slot&&(e.slot=i.getSlot(t.slot.name))},EventObject.toString=function(){return"[class dragonBones.EventObject]"},EventObject.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},EventObject.START="start",EventObject.LOOP_COMPLETE="loopComplete",EventObject.COMPLETE="complete",EventObject.FADE_IN="fadeIn",EventObject.FADE_IN_COMPLETE="fadeInComplete",EventObject.FADE_OUT="fadeOut",EventObject.FADE_OUT_COMPLETE="fadeOutComplete",EventObject.FRAME_EVENT="frameEvent",EventObject.SOUND_EVENT="soundEvent",EventObject}(t.BaseObject);t.EventObject=e}(l||(l={})),function(t){var e=function(){function DataParser(){}return DataParser._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},DataParser._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},DataParser._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},DataParser._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},DataParser._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},DataParser._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},DataParser._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},DataParser._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},DataParser._getAnimationBlendType=function(t){switch(t.toLowerCase()){case"none":return 0;case"1d":return 1;default:return 0}},DataParser._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},DataParser.DATA_VERSION_2_3="2.3",DataParser.DATA_VERSION_3_0="3.0",DataParser.DATA_VERSION_4_0="4.0",DataParser.DATA_VERSION_4_5="4.5",DataParser.DATA_VERSION_5_0="5.0",DataParser.DATA_VERSION_5_5="5.5",DataParser.DATA_VERSION_5_6="5.6",DataParser.DATA_VERSION=DataParser.DATA_VERSION_5_6,DataParser.DATA_VERSIONS=[DataParser.DATA_VERSION_4_0,DataParser.DATA_VERSION_4_5,DataParser.DATA_VERSION_5_0,DataParser.DATA_VERSION_5_5,DataParser.DATA_VERSION_5_6],DataParser.TEXTURE_ATLAS="textureAtlas",DataParser.SUB_TEXTURE="SubTexture",DataParser.FORMAT="format",DataParser.IMAGE_PATH="imagePath",DataParser.WIDTH="width",DataParser.HEIGHT="height",DataParser.ROTATED="rotated",DataParser.FRAME_X="frameX",DataParser.FRAME_Y="frameY",DataParser.FRAME_WIDTH="frameWidth",DataParser.FRAME_HEIGHT="frameHeight",DataParser.DRADON_BONES="dragonBones",DataParser.USER_DATA="userData",DataParser.ARMATURE="armature",DataParser.CANVAS="canvas",DataParser.BONE="bone",DataParser.SURFACE="surface",DataParser.SLOT="slot",DataParser.CONSTRAINT="constraint",DataParser.SKIN="skin",DataParser.DISPLAY="display",DataParser.FRAME="frame",DataParser.IK="ik",DataParser.PATH_CONSTRAINT="path",DataParser.ANIMATION="animation",DataParser.TIMELINE="timeline",DataParser.FFD="ffd",DataParser.TRANSLATE_FRAME="translateFrame",DataParser.ROTATE_FRAME="rotateFrame",DataParser.SCALE_FRAME="scaleFrame",DataParser.DISPLAY_FRAME="displayFrame",DataParser.COLOR_FRAME="colorFrame",DataParser.DEFAULT_ACTIONS="defaultActions",DataParser.ACTIONS="actions",DataParser.EVENTS="events",DataParser.INTS="ints",DataParser.FLOATS="floats",DataParser.STRINGS="strings",DataParser.TRANSFORM="transform",DataParser.PIVOT="pivot",DataParser.AABB="aabb",DataParser.COLOR="color",DataParser.VERSION="version",DataParser.COMPATIBLE_VERSION="compatibleVersion",DataParser.FRAME_RATE="frameRate",DataParser.TYPE="type",DataParser.SUB_TYPE="subType",DataParser.NAME="name",DataParser.PARENT="parent",DataParser.TARGET="target",DataParser.STAGE="stage",DataParser.SHARE="share",DataParser.PATH="path",DataParser.LENGTH="length",DataParser.DISPLAY_INDEX="displayIndex",DataParser.Z_ORDER="zOrder",DataParser.Z_INDEX="zIndex",DataParser.BLEND_MODE="blendMode",DataParser.INHERIT_TRANSLATION="inheritTranslation",DataParser.INHERIT_ROTATION="inheritRotation",DataParser.INHERIT_SCALE="inheritScale",DataParser.INHERIT_REFLECTION="inheritReflection",DataParser.INHERIT_ANIMATION="inheritAnimation",DataParser.INHERIT_DEFORM="inheritDeform",DataParser.SEGMENT_X="segmentX",DataParser.SEGMENT_Y="segmentY",DataParser.BEND_POSITIVE="bendPositive",DataParser.CHAIN="chain",DataParser.WEIGHT="weight",DataParser.BLEND_TYPE="blendType",DataParser.FADE_IN_TIME="fadeInTime",DataParser.PLAY_TIMES="playTimes",DataParser.SCALE="scale",DataParser.OFFSET="offset",DataParser.POSITION="position",DataParser.DURATION="duration",DataParser.TWEEN_EASING="tweenEasing",DataParser.TWEEN_ROTATE="tweenRotate",DataParser.TWEEN_SCALE="tweenScale",DataParser.CLOCK_WISE="clockwise",DataParser.CURVE="curve",DataParser.SOUND="sound",DataParser.EVENT="event",DataParser.ACTION="action",DataParser.X="x",DataParser.Y="y",DataParser.SKEW_X="skX",DataParser.SKEW_Y="skY",DataParser.SCALE_X="scX",DataParser.SCALE_Y="scY",DataParser.VALUE="value",DataParser.ROTATE="rotate",DataParser.SKEW="skew",DataParser.ALPHA="alpha",DataParser.ALPHA_OFFSET="aO",DataParser.RED_OFFSET="rO",DataParser.GREEN_OFFSET="gO",DataParser.BLUE_OFFSET="bO",DataParser.ALPHA_MULTIPLIER="aM",DataParser.RED_MULTIPLIER="rM",DataParser.GREEN_MULTIPLIER="gM",DataParser.BLUE_MULTIPLIER="bM",DataParser.UVS="uvs",DataParser.VERTICES="vertices",DataParser.TRIANGLES="triangles",DataParser.WEIGHTS="weights",DataParser.SLOT_POSE="slotPose",DataParser.BONE_POSE="bonePose",DataParser.BONES="bones",DataParser.POSITION_MODE="positionMode",DataParser.SPACING_MODE="spacingMode",DataParser.ROTATE_MODE="rotateMode",DataParser.SPACING="spacing",DataParser.ROTATE_OFFSET="rotateOffset",DataParser.ROTATE_MIX="rotateMix",DataParser.TRANSLATE_MIX="translateMix",DataParser.TARGET_DISPLAY="targetDisplay",DataParser.CLOSED="closed",DataParser.CONSTANT_SPEED="constantSpeed",DataParser.VERTEX_COUNT="vertexCount",DataParser.LENGTHS="lengths",DataParser.GOTO_AND_PLAY="gotoAndPlay",DataParser.DEFAULT_NAME="default",DataParser}();t.DataParser=e}(l||(l={})),function(t){var e=function(e){function ObjectDataParser(){var i=null!==e&&e.apply(this,arguments)||this;return i._rawTextureAtlasIndex=0,i._rawBones=[],i._data=null,i._armature=null,i._bone=null,i._geometry=null,i._slot=null,i._skin=null,i._mesh=null,i._animation=null,i._timeline=null,i._rawTextureAtlases=null,i._frameValueType=0,i._defaultColorOffset=-1,i._prevClockwise=0,i._prevRotation=0,i._frameDefaultValue=0,i._frameValueScale=1,i._helpMatrixA=new t.Matrix,i._helpMatrixB=new t.Matrix,i._helpTransform=new t.Transform,i._helpColorTransform=new t.ColorTransform,i._helpPoint=new t.Point,i._helpArray=[],i._intArray=[],i._floatArray=[],i._frameIntArray=[],i._frameFloatArray=[],i._frameArray=[],i._timelineArray=[],i._colorArray=[],i._cacheRawMeshes=[],i._cacheMeshes=[],i._actionFrames=[],i._weightSlotPose={},i._weightBonePoses={},i._cacheBones={},i._slotChildActions={},i}return a(ObjectDataParser,e),ObjectDataParser._getBoolean=function(t,e,i){if(e in t){var s=t[e],a=typeof s;if("boolean"===a)return s;if("string"!==a)return!!s;switch(s){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},ObjectDataParser._getNumber=function(t,e,i){if(e in t){var s=t[e];return null===s||"NaN"===s?i:+s||0}return i},ObjectDataParser._getString=function(t,e,i){if(e in t){var s=t[e];return"string"===typeof s?s:String(s)}return i},ObjectDataParser.prototype._getCurvePoint=function(t,e,i,s,a,r,n,o,h,l){var c=1-h,d=c*c,m=h*h,u=c*d,p=3*h*d,g=3*c*m,f=h*m;l.x=u*t+p*i+g*a+f*n,l.y=u*e+p*s+g*r+f*o},ObjectDataParser.prototype._samplingEasingCurve=function(t,e){var i=t.length;if(i%3==1){for(var s=-2,a=0,r=e.length;a<r;++a){for(var n=(a+1)/(r+1);(s+6<i?t[s+6]:1)<n;)s+=6;for(var o=s>=0&&s+6<i,h=o?t[s]:0,l=o?t[s+1]:0,c=t[s+2],d=t[s+3],m=t[s+4],u=t[s+5],p=o?t[s+6]:1,g=o?t[s+7]:1,f=0,_=1;_-f>1e-4;){var y=.5*(_+f);this._getCurvePoint(h,l,c,d,m,u,p,g,y,this._helpPoint),n-this._helpPoint.x>0?f=y:_=y}e[a]=this._helpPoint.y}return!0}for(s=0,a=0,r=e.length;a<r;++a){for(n=(a+1)/(r+1);t[s+6]<n;)s+=6;for(h=t[s],l=t[s+1],c=t[s+2],d=t[s+3],m=t[s+4],u=t[s+5],p=t[s+6],g=t[s+7],f=0,_=1;_-f>1e-4;){y=.5*(_+f);this._getCurvePoint(h,l,c,d,m,u,p,g,y,this._helpPoint),n-this._helpPoint.x>0?f=y:_=y}e[a]=this._helpPoint.y}return!1},ObjectDataParser.prototype._parseActionDataInFrame=function(e,i,s,a){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],i,10,s,a),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],i,11,s,a),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],i,0,s,a),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],i,10,s,a),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],i,0,s,a)},ObjectDataParser.prototype._mergeActionFrame=function(t,e,s,a,r){for(var n=this._armature.actions.length,o=this._parseActionData(t,s,a,r),h=0,l=null,c=0,d=o;c<d.length;c++){var m=d[c];this._armature.addAction(m,!1)}0===this._actionFrames.length&&((l=new i).frameStart=0,this._actionFrames.push(l),l=null);for(var u=0,p=this._actionFrames;u<p.length;u++){var g=p[u];if(g.frameStart===e){l=g;break}if(g.frameStart>e)break;h++}null===l&&((l=new i).frameStart=e,this._actionFrames.splice(h,0,l));for(var f=0;f<o.length;++f)l.actions.push(n+f)},ObjectDataParser.prototype._parseArmature=function(e,i){var s=t.BaseObject.borrowObject(t.ArmatureData);if(s.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),s.frameRate=ObjectDataParser._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),s.scale=i,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?s.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):s.type=ObjectDataParser._getNumber(e,t.DataParser.TYPE,0),0===s.frameRate&&(s.frameRate=24),this._armature=s,t.DataParser.CANVAS in e){var a=e[t.DataParser.CANVAS],r=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in a?r.hasBackground=!0:r.hasBackground=!1,r.color=ObjectDataParser._getNumber(a,t.DataParser.COLOR,0),r.x=ObjectDataParser._getNumber(a,t.DataParser.X,0)*s.scale,r.y=ObjectDataParser._getNumber(a,t.DataParser.Y,0)*s.scale,r.width=ObjectDataParser._getNumber(a,t.DataParser.WIDTH,0)*s.scale,r.height=ObjectDataParser._getNumber(a,t.DataParser.HEIGHT,0)*s.scale,s.canvas=r}if(t.DataParser.AABB in e){var n=e[t.DataParser.AABB];s.aabb.x=ObjectDataParser._getNumber(n,t.DataParser.X,0)*s.scale,s.aabb.y=ObjectDataParser._getNumber(n,t.DataParser.Y,0)*s.scale,s.aabb.width=ObjectDataParser._getNumber(n,t.DataParser.WIDTH,0)*s.scale,s.aabb.height=ObjectDataParser._getNumber(n,t.DataParser.HEIGHT,0)*s.scale}if(t.DataParser.BONE in e)for(var o=0,h=e[t.DataParser.BONE];o<h.length;o++){var l=h[o],c=ObjectDataParser._getString(l,t.DataParser.PARENT,""),d=this._parseBone(l);if(c.length>0){var m=s.getBone(c);null!==m?d.parent=m:(c in this._cacheBones||(this._cacheBones[c]=[]),this._cacheBones[c].push(d))}if(d.name in this._cacheBones){for(var u=0,p=this._cacheBones[d.name];u<p.length;u++){p[u].parent=d}delete this._cacheBones[d.name]}s.addBone(d),this._rawBones.push(d)}if(t.DataParser.IK in e)for(var g=0,f=e[t.DataParser.IK];g<f.length;g++){var _=f[g];(w=this._parseIKConstraint(_))&&s.addConstraint(w)}if(s.sortBones(),t.DataParser.SLOT in e)for(var y=0,v=0,S=e[t.DataParser.SLOT];v<S.length;v++){var b=S[v];s.addSlot(this._parseSlot(b,y++))}if(t.DataParser.SKIN in e)for(var T=0,D=e[t.DataParser.SKIN];T<D.length;T++){var x=D[T];s.addSkin(this._parseSkin(x))}if(t.DataParser.PATH_CONSTRAINT in e)for(var P=0,C=e[t.DataParser.PATH_CONSTRAINT];P<C.length;P++){var w,O=C[P];(w=this._parsePathConstraint(O))&&s.addConstraint(w)}for(var A=0,B=this._cacheRawMeshes.length;A<B;++A){var E=this._cacheRawMeshes[A],I=ObjectDataParser._getString(E,t.DataParser.SHARE,"");if(0!==I.length){var M=ObjectDataParser._getString(E,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===M.length&&(M=t.DataParser.DEFAULT_NAME);var k=s.getMesh(M,"",I);if(null!==k)this._cacheMeshes[A].geometry.shareFrom(k.geometry)}}if(t.DataParser.ANIMATION in e)for(var R=0,L=e[t.DataParser.ANIMATION];R<L.length;R++){var F=L[R],N=this._parseAnimation(F);s.addAnimation(N)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var j=0,W=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);j<W.length;j++){var H=W[j];if(s.addAction(H,!0),0===H.type)null!==(N=s.getAnimation(H.name))&&(s.defaultAnimation=N)}if(t.DataParser.ACTIONS in e)for(var V=0,z=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);V<z.length;V++){H=z[V];s.addAction(H,!1)}for(var G in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[G];for(var G in this._weightBonePoses)delete this._weightBonePoses[G];for(var G in this._cacheBones)delete this._cacheBones[G];for(var G in this._slotChildActions)delete this._slotChildActions[G];return s},ObjectDataParser.prototype._parseBone=function(e){if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):ObjectDataParser._getNumber(e,t.DataParser.TYPE,0))){var i=this._armature.scale,s=t.BaseObject.borrowObject(t.BoneData);return s.inheritTranslation=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),s.inheritRotation=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),s.inheritScale=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),s.inheritReflection=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),s.length=ObjectDataParser._getNumber(e,t.DataParser.LENGTH,0)*i,s.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),s.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],s.transform,i),s}var a=t.BaseObject.borrowObject(t.SurfaceData);return a.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),a.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),a.segmentX=ObjectDataParser._getNumber(e,t.DataParser.SEGMENT_X,0),a.segmentY=ObjectDataParser._getNumber(e,t.DataParser.SEGMENT_Y,0),this._parseGeometry(e,a.geometry),a},ObjectDataParser.prototype._parseIKConstraint=function(e){var i=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.BONE,""));if(null===i)return null;var s=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.TARGET,""));if(null===s)return null;var a=ObjectDataParser._getNumber(e,t.DataParser.CHAIN,0),r=t.BaseObject.borrowObject(t.IKConstraintData);return r.scaleEnabled=ObjectDataParser._getBoolean(e,t.DataParser.SCALE,!1),r.bendPositive=ObjectDataParser._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),r.weight=ObjectDataParser._getNumber(e,t.DataParser.WEIGHT,1),r.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),r.type=0,r.target=s,a>0&&null!==i.parent?(r.root=i.parent,r.bone=i):(r.root=i,r.bone=null),r},ObjectDataParser.prototype._parsePathConstraint=function(e){var i=this._armature.getSlot(ObjectDataParser._getString(e,t.DataParser.TARGET,""));if(null===i)return null;var s=this._armature.defaultSkin;if(null===s)return null;var a=s.getDisplay(i.name,ObjectDataParser._getString(e,t.DataParser.TARGET_DISPLAY,i.name));if(null===a||!(a instanceof t.PathDisplayData))return null;var r=e[t.DataParser.BONES];if(null===r||0===r.length)return null;var n=t.BaseObject.borrowObject(t.PathConstraintData);n.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),n.type=1,n.pathSlot=i,n.pathDisplayData=a,n.target=i.parent,n.positionMode=t.DataParser._getPositionMode(ObjectDataParser._getString(e,t.DataParser.POSITION_MODE,"")),n.spacingMode=t.DataParser._getSpacingMode(ObjectDataParser._getString(e,t.DataParser.SPACING_MODE,"")),n.rotateMode=t.DataParser._getRotateMode(ObjectDataParser._getString(e,t.DataParser.ROTATE_MODE,"")),n.position=ObjectDataParser._getNumber(e,t.DataParser.POSITION,0),n.spacing=ObjectDataParser._getNumber(e,t.DataParser.SPACING,0),n.rotateOffset=ObjectDataParser._getNumber(e,t.DataParser.ROTATE_OFFSET,0),n.rotateMix=ObjectDataParser._getNumber(e,t.DataParser.ROTATE_MIX,1),n.translateMix=ObjectDataParser._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var o=0,h=r;o<h.length;o++){var l=h[o],c=this._armature.getBone(l);null!==c&&(n.AddBone(c),null===n.root&&(n.root=c))}return n},ObjectDataParser.prototype._parseSlot=function(e,i){var s=t.BaseObject.borrowObject(t.SlotData);return s.displayIndex=ObjectDataParser._getNumber(e,t.DataParser.DISPLAY_INDEX,0),s.zOrder=i,s.zIndex=ObjectDataParser._getNumber(e,t.DataParser.Z_INDEX,0),s.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),s.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),s.parent=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?s.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):s.blendMode=ObjectDataParser._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(s.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],s.color)):s.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[s.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),s},ObjectDataParser.prototype._parseSkin=function(e){var i=t.BaseObject.borrowObject(t.SkinData);if(i.name=ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var s=e[t.DataParser.SLOT];this._skin=i;for(var a=0,r=s;a<r.length;a++){var n=r[a],o=ObjectDataParser._getString(n,t.DataParser.NAME,""),h=this._armature.getSlot(o);if(null!==h){if(this._slot=h,t.DataParser.DISPLAY in n)for(var l=0,c=n[t.DataParser.DISPLAY];l<c.length;l++){var d=c[l];d?i.addDisplay(o,this._parseDisplay(d)):i.addDisplay(o,null)}this._slot=null}}this._skin=null}return i},ObjectDataParser.prototype._parseDisplay=function(e){var i=ObjectDataParser._getString(e,t.DataParser.NAME,""),s=ObjectDataParser._getString(e,t.DataParser.PATH,""),a=0,r=null;switch(a=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):ObjectDataParser._getNumber(e,t.DataParser.TYPE,a)){case 0:var n=r=t.BaseObject.borrowObject(t.ImageDisplayData);n.name=i,n.path=s.length>0?s:i,this._parsePivot(e,n);break;case 1:var o=r=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(o.name=i,o.path=s.length>0?s:i,o.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var h=0,l=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);h<l.length;h++){var c=l[h];o.addAction(c)}else if(this._slot.name in this._slotChildActions){var d=this._skin.getDisplays(this._slot.name);if(null===d?0===this._slot.displayIndex:this._slot.displayIndex===d.length){for(var m=0,u=this._slotChildActions[this._slot.name];m<u.length;m++){c=u[m];o.addAction(c)}delete this._slotChildActions[this._slot.name]}}break;case 2:var p=r=t.BaseObject.borrowObject(t.MeshDisplayData);p.geometry.inheritDeform=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),p.name=i,p.path=s.length>0?s:i,t.DataParser.SHARE in e?(p.geometry.data=this._data,this._cacheRawMeshes.push(e),this._cacheMeshes.push(p)):this._parseMesh(e,p);break;case 3:var g=this._parseBoundingBox(e);if(null!==g){var f=r=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);f.name=i,f.path=s.length>0?s:i,f.boundingBox=g}break;case 4:var _=e[t.DataParser.LENGTHS],y=r=t.BaseObject.borrowObject(t.PathDisplayData);y.closed=ObjectDataParser._getBoolean(e,t.DataParser.CLOSED,!1),y.constantSpeed=ObjectDataParser._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),y.name=i,y.path=s.length>0?s:i,y.curveLengths.length=_.length;for(var v=0,S=_.length;v<S;++v)y.curveLengths[v]=_[v];this._parsePath(e,y)}return null!==r&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],r.transform,this._armature.scale),r},ObjectDataParser.prototype._parsePath=function(t,e){this._parseGeometry(t,e.geometry)},ObjectDataParser.prototype._parsePivot=function(e,i){if(t.DataParser.PIVOT in e){var s=e[t.DataParser.PIVOT];i.pivot.x=ObjectDataParser._getNumber(s,t.DataParser.X,0),i.pivot.y=ObjectDataParser._getNumber(s,t.DataParser.Y,0)}else i.pivot.x=.5,i.pivot.y=.5},ObjectDataParser.prototype._parseMesh=function(e,i){if(this._parseGeometry(e,i.geometry),t.DataParser.WEIGHTS in e){var s=e[t.DataParser.SLOT_POSE],a=e[t.DataParser.BONE_POSE],r=this._skin.name+"_"+this._slot.name+"_"+i.name;this._weightSlotPose[r]=s,this._weightBonePoses[r]=a}},ObjectDataParser.prototype._parseBoundingBox=function(e){var i=null,s=0;switch(s=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):ObjectDataParser._getNumber(e,t.DataParser.SUB_TYPE,s)){case 0:i=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:i=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(e)}return null!==i&&(i.color=ObjectDataParser._getNumber(e,t.DataParser.COLOR,0),0!==i.type&&1!==i.type||(i.width=ObjectDataParser._getNumber(e,t.DataParser.WIDTH,0),i.height=ObjectDataParser._getNumber(e,t.DataParser.HEIGHT,0))),i},ObjectDataParser.prototype._parsePolygonBoundingBox=function(e){var i=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var s=this._armature.scale,a=e[t.DataParser.VERTICES],r=i.vertices;r.length=a.length;for(var n=0,o=a.length;n<o;n+=2){var h=a[n]*s,l=a[n+1]*s;r[n]=h,r[n+1]=l,0===n?(i.x=h,i.y=l,i.width=h,i.height=l):(h<i.x?i.x=h:h>i.width&&(i.width=h),l<i.y?i.y=l:l>i.height&&(i.height=l))}i.width-=i.x,i.height-=i.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return i},ObjectDataParser.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);if(i.blendType=t.DataParser._getAnimationBlendType(ObjectDataParser._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=ObjectDataParser._getNumber(e,t.DataParser.DURATION,0),i.playTimes=ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),i.frameIntOffset=this._frameIntArray.length,i.frameFloatOffset=this._frameFloatArray.length,i.frameOffset=this._frameArray.length,this._animation=i,t.DataParser.FRAME in e){var s=e[t.DataParser.FRAME],a=s.length;if(a>0)for(var r=0,n=0;r<a;++r){var o=s[r];this._parseActionDataInFrame(o,n,null,null),n+=ObjectDataParser._getNumber(o,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,0,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var h=0,l=e[t.DataParser.BONE];h<l.length;h++){var c=l[h];this._parseBoneTimeline(c)}if(t.DataParser.SLOT in e)for(var d=0,m=e[t.DataParser.SLOT];d<m.length;d++){c=m[d];this._parseSlotTimeline(c)}if(t.DataParser.FFD in e)for(var u=0,p=e[t.DataParser.FFD];u<p.length;u++){c=p[u];var g=ObjectDataParser._getString(c,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),f=ObjectDataParser._getString(c,t.DataParser.SLOT,""),_=ObjectDataParser._getString(c,t.DataParser.NAME,"");if(0===g.length&&(g=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(f),this._mesh=this._armature.getMesh(g,f,_),null!==this._slot&&null!==this._mesh)null!==(P=this._parseTimeline(c,null,t.DataParser.FRAME,22,2,0,this._parseSlotDeformFrame))&&this._animation.addSlotTimeline(f,P),this._slot=null,this._mesh=null}if(t.DataParser.IK in e)for(var y=0,v=e[t.DataParser.IK];y<v.length;y++){c=v[y];var S=ObjectDataParser._getString(c,t.DataParser.NAME,"");if(null!==this._armature.getConstraint(S))null!==(P=this._parseTimeline(c,null,t.DataParser.FRAME,30,1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(S,P)}if(this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,0,0,this._parseActionFrame),this._actionFrames.length=0),t.DataParser.TIMELINE in e)for(var b=0,T=e[t.DataParser.TIMELINE];b<T.length;b++){c=T[b];var D=ObjectDataParser._getNumber(c,t.DataParser.TYPE,0),x=ObjectDataParser._getString(c,t.DataParser.NAME,""),P=null;switch(D){case 0:break;case 20:case 23:case 60:case 24:case 40:case 41:if(20===D?(this._frameValueType=0,this._frameValueScale=1):(this._frameValueType=1,this._frameValueScale=23===D?1:40===D||41===D?1e4:100),this._frameDefaultValue=60===D||24===D||41===D?1:0,40===D&&0!==i.blendType){var C=P=t.BaseObject.borrowObject(t.AnimationTimelineData);C.x=ObjectDataParser._getNumber(c,t.DataParser.X,0),C.y=ObjectDataParser._getNumber(c,t.DataParser.Y,0)}P=this._parseTimeline(c,null,t.DataParser.FRAME,D,this._frameValueType,1,this._parseSingleValueFrame,P);break;case 11:case 12:case 13:case 30:case 42:30===D||42===D?(this._frameValueType=1,this._frameValueScale=42===D?1e4:100):(this._frameValueScale=12===D?t.Transform.DEG_RAD:1,this._frameValueType=2),this._frameDefaultValue=13===D||30===D?1:0,P=this._parseTimeline(c,null,t.DataParser.FRAME,D,this._frameValueType,2,this._parseDoubleValueFrame);break;case 1:break;case 50:var w=this._armature.getBone(x);if(null===w)continue;this._geometry=w.geometry,P=this._parseTimeline(c,null,t.DataParser.FRAME,D,2,0,this._parseDeformFrame),this._geometry=null;break;case 22:for(var g in this._geometry=null,this._armature.skins){var O=this._armature.skins[g];for(var A in O.displays)for(var B=0,E=O.displays[A];B<E.length;B++){var I=E[B];if(null!==I&&I.name===x){this._geometry=I.geometry;break}}}if(null===this._geometry)continue;P=this._parseTimeline(c,null,t.DataParser.FRAME,D,2,0,this._parseDeformFrame),this._geometry=null;break;case 21:P=this._parseTimeline(c,null,t.DataParser.FRAME,D,1,1,this._parseSlotColorFrame)}if(null!==P)switch(D){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(x,P);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(x,P);break;case 30:this._animation.addConstraintTimeline(x,P);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(x,P)}}return this._animation=null,i},ObjectDataParser.prototype._parseTimeline=function(e,s,a,r,n,o,h,l){if(void 0===l&&(l=null),null!==e&&a.length>0&&a in e&&(s=e[a]),null===s)return null;var c=s.length;if(0===c)return null;var d=this._frameIntArray.length,m=this._frameFloatArray.length,u=this._timelineArray.length;switch(null===l&&(l=t.BaseObject.borrowObject(t.TimelineData)),l.type=r,l.offset=u,this._frameValueType=n,this._timeline=l,this._timelineArray.length+=5+c,null!==e?(this._timelineArray[u+0]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[u+1]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[u+0]=100,this._timelineArray[u+1]=0),this._timelineArray[u+2]=c,this._timelineArray[u+3]=o,this._frameValueType){case 0:this._timelineArray[u+4]=0;break;case 1:this._timelineArray[u+4]=d-this._animation.frameIntOffset;break;case 2:this._timelineArray[u+4]=m-this._animation.frameFloatOffset}if(1===c)l.frameIndicesOffset=-1,this._timelineArray[u+5+0]=h.call(this,s[0],0,0)-this._animation.frameOffset;else{var p=this._animation.frameCount+1,g=this._data.frameIndices,f=g.length;g.length+=p,l.frameIndicesOffset=f;for(var _=0,y=0,v=0,S=0;_<p;++_){if(v+S<=_&&y<c){var b=s[y];v=_,S=y===c-1?this._animation.frameCount-v:b instanceof i?this._actionFrames[y+1].frameStart-v:ObjectDataParser._getNumber(b,t.DataParser.DURATION,1),this._timelineArray[u+5+y]=h.call(this,b,v,S)-this._animation.frameOffset,y++}g[f+_]=y-1}}return this._timeline=null,l},ObjectDataParser.prototype._parseBoneTimeline=function(e){var i=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.NAME,""));if(null!==i){var s;if(this._bone=i,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e)this._frameDefaultValue=0,this._frameValueScale=1,null!==(s=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,2,2,this._parseDoubleValueFrame))&&this._animation.addBoneTimeline(i.name,s);if(t.DataParser.ROTATE_FRAME in e)this._frameDefaultValue=0,this._frameValueScale=1,null!==(s=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,2,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(i.name,s);if(t.DataParser.SCALE_FRAME in e)this._frameDefaultValue=1,this._frameValueScale=1,null!==(s=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,2,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(i.name,s);if(t.DataParser.FRAME in e)null!==(s=this._parseTimeline(e,null,t.DataParser.FRAME,10,2,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(i.name,s);this._bone=null,this._slot=null}},ObjectDataParser.prototype._parseSlotTimeline=function(e){var i=this._armature.getSlot(ObjectDataParser._getString(e,t.DataParser.NAME,""));if(null!==i){var s=null,a=null;this._slot=i,s=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,0,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,0,0,this._parseSlotDisplayFrame),a=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,1,1,this._parseSlotColorFrame),null!==s&&this._animation.addSlotTimeline(i.name,s),null!==a&&this._animation.addSlotTimeline(i.name,a),this._slot=null}},ObjectDataParser.prototype._parseFrame=function(t,e,i){var s=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[s+0]=e,s},ObjectDataParser.prototype._parseTweenFrame=function(e,i,s){var a=this._parseFrame(e,i,s);if(s>0)if(t.DataParser.CURVE in e){var r=s+1;this._helpArray.length=r;var n=this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray);this._frameArray.length+=2+this._helpArray.length,this._frameArray[a+1]=2,this._frameArray[a+2]=n?r:-r;for(var o=0;o<r;++o)this._frameArray[a+3+o]=Math.round(1e4*this._helpArray[o])}else{var h=-2;t.DataParser.TWEEN_EASING in e&&(h=ObjectDataParser._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===h?(this._frameArray.length+=1,this._frameArray[a+1]=0):0===h?(this._frameArray.length+=1,this._frameArray[a+1]=1):h<0?(this._frameArray.length+=2,this._frameArray[a+1]=3,this._frameArray[a+2]=Math.round(100*-h)):h<=1?(this._frameArray.length+=2,this._frameArray[a+1]=4,this._frameArray[a+2]=Math.round(100*h)):(this._frameArray.length+=2,this._frameArray[a+1]=5,this._frameArray[a+2]=Math.round(100*h-100))}else this._frameArray.length+=1,this._frameArray[a+1]=0;return a},ObjectDataParser.prototype._parseSingleValueFrame=function(e,i,s){var a=0;switch(this._frameValueType){case 0:a=this._parseFrame(e,i,s),this._frameArray.length+=1,this._frameArray[a+1]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue);break;case 1:a=this._parseTweenFrame(e,i,s);var r=this._frameIntArray.length;this._frameIntArray.length+=1,this._frameIntArray[r]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale);break;case 2:a=this._parseTweenFrame(e,i,s);r=this._frameFloatArray.length;this._frameFloatArray.length+=1,this._frameFloatArray[r]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale}return a},ObjectDataParser.prototype._parseDoubleValueFrame=function(e,i,s){var a=0;switch(this._frameValueType){case 0:a=this._parseFrame(e,i,s),this._frameArray.length+=2,this._frameArray[a+1]=ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue),this._frameArray[a+2]=ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue);break;case 1:a=this._parseTweenFrame(e,i,s);var r=this._frameIntArray.length;this._frameIntArray.length+=2,this._frameIntArray[r]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale),this._frameIntArray[r+1]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale);break;case 2:a=this._parseTweenFrame(e,i,s);r=this._frameFloatArray.length;this._frameFloatArray.length+=2,this._frameFloatArray[r]=ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale,this._frameFloatArray[r+1]=ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale}return a},ObjectDataParser.prototype._parseActionFrame=function(t,e,i){var s=this._frameArray.length,a=t.actions.length;this._frameArray.length+=2+a,this._frameArray[s+0]=e,this._frameArray[s+0+1]=a;for(var r=0;r<a;++r)this._frameArray[s+0+2+r]=t.actions[r];return s},ObjectDataParser.prototype._parseZOrderFrame=function(e,i,s){var a=this._parseFrame(e,i,s);if(t.DataParser.Z_ORDER in e){var r=e[t.DataParser.Z_ORDER];if(r.length>0){for(var n=this._armature.sortedSlots.length,o=new Array(n-r.length/2),h=new Array(n),l=0;l<o.length;++l)o[l]=0;for(var c=0;c<n;++c)h[c]=-1;for(var d=0,m=0,u=0,p=r.length;u<p;u+=2){for(var g=r[u],f=r[u+1];d!==g;)o[m++]=d++;h[d+f]=d++}for(;d<n;)o[m++]=d++;this._frameArray.length+=1+n,this._frameArray[a+1]=n;for(var _=n;_--;)-1===h[_]?this._frameArray[a+2+_]=o[--m]||0:this._frameArray[a+2+_]=h[_]||0;return a}}return this._frameArray.length+=1,this._frameArray[a+1]=0,a},ObjectDataParser.prototype._parseBoneAllFrame=function(e,i,s){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var a=this._helpTransform.rotation;0!==i&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=ObjectDataParser._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=a;var r=this._parseTweenFrame(e,i,s),n=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[n++]=this._helpTransform.x,this._frameFloatArray[n++]=this._helpTransform.y,this._frameFloatArray[n++]=a,this._frameFloatArray[n++]=this._helpTransform.skew,this._frameFloatArray[n++]=this._helpTransform.scaleX,this._frameFloatArray[n++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,i,this._bone,this._slot),r},ObjectDataParser.prototype._parseBoneTranslateFrame=function(e,i,s){var a=this._parseTweenFrame(e,i,s),r=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[r++]=ObjectDataParser._getNumber(e,t.DataParser.X,0),this._frameFloatArray[r++]=ObjectDataParser._getNumber(e,t.DataParser.Y,0),a},ObjectDataParser.prototype._parseBoneRotateFrame=function(e,i,s){var a=ObjectDataParser._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==i&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=ObjectDataParser._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=a;var r=this._parseTweenFrame(e,i,s),n=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[n++]=a,this._frameFloatArray[n++]=ObjectDataParser._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,r},ObjectDataParser.prototype._parseBoneScaleFrame=function(e,i,s){var a=this._parseTweenFrame(e,i,s),r=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[r++]=ObjectDataParser._getNumber(e,t.DataParser.X,1),this._frameFloatArray[r++]=ObjectDataParser._getNumber(e,t.DataParser.Y,1),a},ObjectDataParser.prototype._parseSlotDisplayFrame=function(e,i,s){var a=this._parseFrame(e,i,s);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[a+1]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,0):this._frameArray[a+1]=ObjectDataParser._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,i,this._slot.parent,this._slot),a},ObjectDataParser.prototype._parseSlotColorFrame=function(e,i,s){var a=this._parseTweenFrame(e,i,s),r=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var n=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var o in n){this._parseColorTransform(n,this._helpColorTransform),r=this._colorArray.length,this._colorArray.length+=8,this._colorArray[r++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._colorArray[r++]=Math.round(100*this._helpColorTransform.redMultiplier),this._colorArray[r++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._colorArray[r++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._colorArray[r++]=Math.round(this._helpColorTransform.alphaOffset),this._colorArray[r++]=Math.round(this._helpColorTransform.redOffset),this._colorArray[r++]=Math.round(this._helpColorTransform.greenOffset),this._colorArray[r++]=Math.round(this._helpColorTransform.blueOffset),r-=8;break}}r<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=r=this._colorArray.length,this._colorArray.length+=8,this._colorArray[r++]=100,this._colorArray[r++]=100,this._colorArray[r++]=100,this._colorArray[r++]=100,this._colorArray[r++]=0,this._colorArray[r++]=0,this._colorArray[r++]=0,this._colorArray[r++]=0),r=this._defaultColorOffset);var h=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[h]=r,a},ObjectDataParser.prototype._parseSlotDeformFrame=function(e,i,s){var a=this._frameFloatArray.length,r=this._parseTweenFrame(e,i,s),n=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,o=ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0),h=this._intArray[this._mesh.geometry.offset+0],l=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,c=this._mesh.geometry.weight,d=0,m=0,u=0,p=0;if(null!==c){var g=this._weightSlotPose[l];this._helpMatrixA.copyFromArray(g,0),this._frameFloatArray.length+=2*c.count,u=c.offset+2+c.bones.length}else this._frameFloatArray.length+=2*h;for(var f=0;f<2*h;f+=2)if(null===n?(d=0,m=0):(d=f<o||f-o>=n.length?0:n[f-o],m=f+1<o||f+1-o>=n.length?0:n[f+1-o]),null!==c){var _=this._weightBonePoses[l],y=this._intArray[u++];this._helpMatrixA.transformPoint(d,m,this._helpPoint,!0),d=this._helpPoint.x,m=this._helpPoint.y;for(var v=0;v<y;++v){var S=this._intArray[u++];this._helpMatrixB.copyFromArray(_,7*S+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(d,m,this._helpPoint,!0),this._frameFloatArray[a+p++]=this._helpPoint.x,this._frameFloatArray[a+p++]=this._helpPoint.y}}else this._frameFloatArray[a+f]=d,this._frameFloatArray[a+f+1]=m;if(0===i){var b=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[b+0]=this._mesh.geometry.offset,this._frameIntArray[b+1]=this._frameFloatArray.length-a,this._frameIntArray[b+2]=this._frameFloatArray.length-a,this._frameIntArray[b+3]=0,this._frameIntArray[b+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=b-this._animation.frameIntOffset}return r},ObjectDataParser.prototype._parseIKConstraintFrame=function(e,i,s){var a=this._parseTweenFrame(e,i,s),r=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[r++]=ObjectDataParser._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[r++]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.WEIGHT,1)),a},ObjectDataParser.prototype._parseActionData=function(e,i,s,a){var r=new Array;if("string"==typeof e)(l=t.BaseObject.borrowObject(t.ActionData)).type=i,l.name=e,l.bone=s,l.slot=a,r.push(l);else if(e instanceof Array)for(var n=0,o=e;n<o.length;n++){var h=o[n],l=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in h?(l.type=0,l.name=ObjectDataParser._getString(h,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in h&&"string"==typeof h[t.DataParser.TYPE]?l.type=t.DataParser._getActionType(h[t.DataParser.TYPE]):l.type=ObjectDataParser._getNumber(h,t.DataParser.TYPE,i),l.name=ObjectDataParser._getString(h,t.DataParser.NAME,"")),t.DataParser.BONE in h){var c=ObjectDataParser._getString(h,t.DataParser.BONE,"");l.bone=this._armature.getBone(c)}else l.bone=s;if(t.DataParser.SLOT in h){var d=ObjectDataParser._getString(h,t.DataParser.SLOT,"");l.slot=this._armature.getSlot(d)}else l.slot=a;var m=null;if(t.DataParser.INTS in h){null===m&&(m=t.BaseObject.borrowObject(t.UserData));for(var u=0,p=h[t.DataParser.INTS];u<p.length;u++){var g=p[u];m.addInt(g)}}if(t.DataParser.FLOATS in h){null===m&&(m=t.BaseObject.borrowObject(t.UserData));for(var f=0,_=h[t.DataParser.FLOATS];f<_.length;f++){g=_[f];m.addFloat(g)}}if(t.DataParser.STRINGS in h){null===m&&(m=t.BaseObject.borrowObject(t.UserData));for(var y=0,v=h[t.DataParser.STRINGS];y<v.length;y++){g=v[y];m.addString(g)}}l.data=m,r.push(l)}return r},ObjectDataParser.prototype._parseDeformFrame=function(e,i,s){var a=this._frameFloatArray.length,r=this._parseTweenFrame(e,i,s),n=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:t.DataParser.VALUE in e?e[t.DataParser.VALUE]:null,o=ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0),h=this._intArray[this._geometry.offset+0],l=0,c=0;if(null!==this._geometry.weight);else{this._frameFloatArray.length+=2*h;for(var d=0;d<2*h;d+=2)null!==n?(l=d<o||d-o>=n.length?0:n[d-o],c=d+1<o||d+1-o>=n.length?0:n[d+1-o]):(l=0,c=0),this._frameFloatArray[a+d]=l,this._frameFloatArray[a+d+1]=c}if(0===i){var m=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[m+0]=this._geometry.offset,this._frameIntArray[m+1]=this._frameFloatArray.length-a,this._frameIntArray[m+2]=this._frameFloatArray.length-a,this._frameIntArray[m+3]=0,this._frameIntArray[m+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=m-this._animation.frameIntOffset}return r},ObjectDataParser.prototype._parseTransform=function(e,i,s){i.x=ObjectDataParser._getNumber(e,t.DataParser.X,0)*s,i.y=ObjectDataParser._getNumber(e,t.DataParser.Y,0)*s,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(i.rotation=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(i.rotation=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-i.rotation),i.scaleX=ObjectDataParser._getNumber(e,t.DataParser.SCALE_X,1),i.scaleY=ObjectDataParser._getNumber(e,t.DataParser.SCALE_Y,1)},ObjectDataParser.prototype._parseColorTransform=function(e,i){i.alphaMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),i.redMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.RED_MULTIPLIER,100),i.greenMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),i.blueMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),i.alphaOffset=ObjectDataParser._getNumber(e,t.DataParser.ALPHA_OFFSET,0),i.redOffset=ObjectDataParser._getNumber(e,t.DataParser.RED_OFFSET,0),i.greenOffset=ObjectDataParser._getNumber(e,t.DataParser.GREEN_OFFSET,0),i.blueOffset=ObjectDataParser._getNumber(e,t.DataParser.BLUE_OFFSET,0)},ObjectDataParser.prototype._parseGeometry=function(e,i){var s=e[t.DataParser.VERTICES],a=Math.floor(s.length/2),r=0,n=this._intArray.length,o=this._floatArray.length;i.offset=n,i.data=this._data,this._intArray.length+=4,this._intArray[n+0]=a,this._intArray[n+2]=o,this._intArray[n+3]=-1,this._floatArray.length+=2*a;for(var h=0,l=2*a;h<l;++h)this._floatArray[o+h]=s[h];if(t.DataParser.TRIANGLES in e){var c=e[t.DataParser.TRIANGLES];r=Math.floor(c.length/3),this._intArray.length+=3*r;for(h=0,l=3*r;h<l;++h)this._intArray[n+4+h]=c[h]}if(this._intArray[n+1]=r,t.DataParser.UVS in e){var d=e[t.DataParser.UVS],m=o+2*a;this._floatArray.length+=2*a;for(h=0,l=2*a;h<l;++h)this._floatArray[m+h]=d[h]}if(t.DataParser.WEIGHTS in e){var u=e[t.DataParser.WEIGHTS],p=Math.floor(u.length-a)/2,g=this._intArray.length,f=this._floatArray.length,_=0,y=this._armature.sortedBones,v=t.BaseObject.borrowObject(t.WeightData);if(v.count=p,v.offset=g,this._intArray.length+=2+_+a+p,this._intArray[g+1]=f,t.DataParser.BONE_POSE in e){var S=e[t.DataParser.SLOT_POSE],b=e[t.DataParser.BONE_POSE],T=new Array;_=Math.floor(b.length/7),T.length=_;for(h=0;h<_;++h){var D=b[7*h],x=this._rawBones[D];v.addBone(x),T[h]=D,this._intArray[g+2+h]=y.indexOf(x)}this._floatArray.length+=3*p,this._helpMatrixA.copyFromArray(S,0);h=0;for(var P=0,C=g+2+_,w=f;h<a;++h){var O=2*h,A=this._intArray[C++]=u[P++],B=this._floatArray[o+O],E=this._floatArray[o+O+1];this._helpMatrixA.transformPoint(B,E,this._helpPoint),B=this._helpPoint.x,E=this._helpPoint.y;for(var I=0;I<A;++I){D=u[P++];var M=T.indexOf(D);this._helpMatrixB.copyFromArray(b,7*M+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(B,E,this._helpPoint),this._intArray[C++]=M,this._floatArray[w++]=u[P++],this._floatArray[w++]=this._helpPoint.x,this._floatArray[w++]=this._helpPoint.y}}}else{var k=e[t.DataParser.BONES];_=k.length;for(h=0;h<_;h++){D=k[h],x=this._rawBones[D];v.addBone(x),this._intArray[g+2+h]=y.indexOf(x)}this._floatArray.length+=3*p;h=0,P=0,w=0,C=g+2+_;for(var R=f;h<p;h++){A=u[P++];this._intArray[C++]=A;for(I=0;I<A;I++){M=u[P++];var L=u[P++];B=s[w++],E=s[w++];this._intArray[C++]=k.indexOf(M),this._floatArray[R++]=L,this._floatArray[R++]=B,this._floatArray[R++]=E}}}i.weight=v}},ObjectDataParser.prototype._parseArray=function(t){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0,this._colorArray.length=0},ObjectDataParser.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0),this._timelineArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._colorArray.push(0);for(var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,s=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,a=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,r=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,n=this._colorArray.length*Int16Array.BYTES_PER_ELEMENT,o=new ArrayBuffer(t+e+i+s+a+r+n),h=new Int16Array(o,0,this._intArray.length),l=new Float32Array(o,t,this._floatArray.length),c=new Int16Array(o,t+e,this._frameIntArray.length),d=new Float32Array(o,t+e+i,this._frameFloatArray.length),m=new Int16Array(o,t+e+i+s,this._frameArray.length),u=new Uint16Array(o,t+e+i+s+a,this._timelineArray.length),p=new Int16Array(o,t+e+i+s+a+r,this._colorArray.length),g=0,f=this._intArray.length;g<f;++g)h[g]=this._intArray[g];for(g=0,f=this._floatArray.length;g<f;++g)l[g]=this._floatArray[g];for(g=0,f=this._frameIntArray.length;g<f;++g)c[g]=this._frameIntArray[g];for(g=0,f=this._frameFloatArray.length;g<f;++g)d[g]=this._frameFloatArray[g];for(g=0,f=this._frameArray.length;g<f;++g)m[g]=this._frameArray[g];for(g=0,f=this._timelineArray.length;g<f;++g)u[g]=this._timelineArray[g];for(g=0,f=this._colorArray.length;g<f;++g)p[g]=this._colorArray[g];this._data.binary=o,this._data.intArray=h,this._data.floatArray=l,this._data.frameIntArray=c,this._data.frameFloatArray=d,this._data.frameArray=m,this._data.timelineArray=u,this._data.colorArray=p,this._defaultColorOffset=-1},ObjectDataParser.prototype.parseDragonBonesData=function(e,i){void 0===i&&(i=1),console.assert(null!=e,"Data error.");var s=ObjectDataParser._getString(e,t.DataParser.VERSION,""),a=ObjectDataParser._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(s)>=0||t.DataParser.DATA_VERSIONS.indexOf(a)>=0){var r=t.BaseObject.borrowObject(t.DragonBonesData);if(r.version=s,r.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),r.frameRate=ObjectDataParser._getNumber(e,t.DataParser.FRAME_RATE,24),0===r.frameRate&&(r.frameRate=24),t.DataParser.ARMATURE in e){this._data=r,this._parseArray(e);for(var n=0,o=e[t.DataParser.ARMATURE];n<o.length;n++){var h=o[n];r.addArmature(this._parseArmature(h,i))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?r.stage=r.getArmature(ObjectDataParser._getString(e,t.DataParser.STAGE,"")):r.armatureNames.length>0&&(r.stage=r.getArmature(r.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),r}return console.assert(!1,"Nonsupport data version: "+s+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},ObjectDataParser.prototype.parseTextureAtlasData=function(e,i,s){if(void 0===s&&(s=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var a=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(a,i,s),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(i.width=ObjectDataParser._getNumber(e,t.DataParser.WIDTH,0),i.height=ObjectDataParser._getNumber(e,t.DataParser.HEIGHT,0),i.scale=1===s?1/ObjectDataParser._getNumber(e,t.DataParser.SCALE,1):s,i.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),i.imagePath=ObjectDataParser._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var r=e[t.DataParser.SUB_TEXTURE],n=0,o=r.length;n<o;++n){var h=r[n],l=ObjectDataParser._getNumber(h,t.DataParser.FRAME_WIDTH,-1),c=ObjectDataParser._getNumber(h,t.DataParser.FRAME_HEIGHT,-1),d=i.createTexture();d.rotated=ObjectDataParser._getBoolean(h,t.DataParser.ROTATED,!1),d.name=ObjectDataParser._getString(h,t.DataParser.NAME,""),d.region.x=ObjectDataParser._getNumber(h,t.DataParser.X,0),d.region.y=ObjectDataParser._getNumber(h,t.DataParser.Y,0),d.region.width=ObjectDataParser._getNumber(h,t.DataParser.WIDTH,0),d.region.height=ObjectDataParser._getNumber(h,t.DataParser.HEIGHT,0),l>0&&c>0&&(d.frame=t.TextureData.createRectangle(),d.frame.x=ObjectDataParser._getNumber(h,t.DataParser.FRAME_X,0),d.frame.y=ObjectDataParser._getNumber(h,t.DataParser.FRAME_Y,0),d.frame.width=l,d.frame.height=c),i.addTexture(d)}return!0},ObjectDataParser.getInstance=function(){return null===ObjectDataParser._objectDataParserInstance&&(ObjectDataParser._objectDataParserInstance=new ObjectDataParser),ObjectDataParser._objectDataParserInstance},ObjectDataParser._objectDataParserInstance=null,ObjectDataParser}(t.DataParser);t.ObjectDataParser=e;var i=function i(){this.frameStart=0,this.actions=[]};t.ActionFrame=i}(l||(l={})),function(t){var e=function(e){function BinaryDataParser(){return null!==e&&e.apply(this,arguments)||this}return a(BinaryDataParser,e),BinaryDataParser.prototype._inRange=function(t,e,i){return e<=t&&t<=i},BinaryDataParser.prototype._decodeUTF8=function(t){for(var e,i=0,s="",a=0,r=0,n=0,o=0;t.length>i;){var h=t[i++];if(-1===h)e=0!==r?65533:-1;else if(0===r)this._inRange(h,0,127)?e=h:(this._inRange(h,194,223)?(r=1,o=128,a=h-192):this._inRange(h,224,239)?(r=2,o=2048,a=h-224):this._inRange(h,240,244)&&(r=3,o=65536,a=h-240),a*=Math.pow(64,r),e=null);else if(this._inRange(h,128,191))if(n+=1,a+=(h-128)*Math.pow(64,r-n),n!==r)e=null;else{var l=a,c=o;a=0,r=0,n=0,o=0,e=this._inRange(l,c,1114111)&&!this._inRange(l,55296,57343)?l:h}else a=0,r=0,n=0,o=0,i--,e=h;null!==e&&-1!==e&&(e<=65535?e>0&&(s+=String.fromCharCode(e)):(e-=65536,s+=String.fromCharCode(55296+(e>>10&1023)),s+=String.fromCharCode(56320+(1023&e))))}return s},BinaryDataParser.prototype._parseBinaryTimeline=function(e,i,s){void 0===s&&(s=null);var a=null!==s?s:t.BaseObject.borrowObject(t.TimelineData);a.type=e,a.offset=i,this._timeline=a;var r=this._timelineArrayBuffer[a.offset+2];if(1===r)a.frameIndicesOffset=-1;else{var n,o=this._animation.frameCount+1,h=this._data.frameIndices;n=h.length,h.length+=o,a.frameIndicesOffset=n;for(var l=0,c=0,d=0,m=0;l<o;++l)d+m<=l&&c<r&&(d=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[a.offset+5+c]],m=c===r-1?this._animation.frameCount-d:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[a.offset+5+c+1]]-d,c++),h[n+l]=c-1}return this._timeline=null,a},BinaryDataParser.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);i.blendType=t.DataParser._getAnimationBlendType(t.ObjectDataParser._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,0),i.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME);var s=e[t.DataParser.OFFSET];if(i.frameIntOffset=s[0],i.frameFloatOffset=s[1],i.frameOffset=s[2],this._animation=i,t.DataParser.ACTION in e&&(i.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(i.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var a=e[t.DataParser.BONE];for(var r in a){var n=a[r],o=this._armature.getBone(r);if(null!==o)for(var h=0,l=n.length;h<l;h+=2){var c=n[h],d=n[h+1],m=this._parseBinaryTimeline(c,d);this._animation.addBoneTimeline(o.name,m)}}}if(t.DataParser.SLOT in e){a=e[t.DataParser.SLOT];for(var r in a){n=a[r];var u=this._armature.getSlot(r);if(null!==u)for(h=0,l=n.length;h<l;h+=2){c=n[h],d=n[h+1],m=this._parseBinaryTimeline(c,d);this._animation.addSlotTimeline(u.name,m)}}}if(t.DataParser.CONSTRAINT in e){a=e[t.DataParser.CONSTRAINT];for(var r in a){n=a[r];var p=this._armature.getConstraint(r);if(null!==p)for(h=0,l=n.length;h<l;h+=2){c=n[h],d=n[h+1],m=this._parseBinaryTimeline(c,d);this._animation.addConstraintTimeline(p.name,m)}}}if(t.DataParser.TIMELINE in e)for(var g=0,f=n=e[t.DataParser.TIMELINE];g<f.length;g++){var _=f[g];if((d=t.ObjectDataParser._getNumber(_,t.DataParser.OFFSET,0))>=0){c=t.ObjectDataParser._getNumber(_,t.DataParser.TYPE,0);var y=t.ObjectDataParser._getString(_,t.DataParser.NAME,"");m=null;if(40===c&&0!==i.blendType){var v=m=t.BaseObject.borrowObject(t.AnimationTimelineData);v.x=t.ObjectDataParser._getNumber(_,t.DataParser.X,0),v.y=t.ObjectDataParser._getNumber(_,t.DataParser.Y,0)}switch(m=this._parseBinaryTimeline(c,d,m),c){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(y,m);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(y,m);break;case 30:this._animation.addConstraintTimeline(y,m);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(y,m)}}}return this._animation=null,i},BinaryDataParser.prototype._parseGeometry=function(e,i){i.offset=e[t.DataParser.OFFSET],i.data=this._data;var s=this._intArrayBuffer[i.offset+3];if(s>=0){var a=t.BaseObject.borrowObject(t.WeightData),r=this._intArrayBuffer[i.offset+0],n=this._intArrayBuffer[s+0];a.offset=s;for(var o=0;o<n;++o){var h=this._intArrayBuffer[s+2+o];a.addBone(this._rawBones[h])}for(var l=s+2+n,c=0,d=(o=0,r);o<d;++o){var m=this._intArrayBuffer[l++];c+=m,l+=m}a.count=c,i.weight=a}},BinaryDataParser.prototype._parseArray=function(e){var i=e[t.DataParser.OFFSET],s=i[1],a=i[3],r=i[5],n=i[7],o=i[9],h=i[11],l=i.length>12?i[13]:0,c=new Int16Array(this._binary,this._binaryOffset+i[0],s/Int16Array.BYTES_PER_ELEMENT),d=new Float32Array(this._binary,this._binaryOffset+i[2],a/Float32Array.BYTES_PER_ELEMENT),m=new Int16Array(this._binary,this._binaryOffset+i[4],r/Int16Array.BYTES_PER_ELEMENT),u=new Float32Array(this._binary,this._binaryOffset+i[6],n/Float32Array.BYTES_PER_ELEMENT),p=new Int16Array(this._binary,this._binaryOffset+i[8],o/Int16Array.BYTES_PER_ELEMENT),g=new Uint16Array(this._binary,this._binaryOffset+i[10],h/Uint16Array.BYTES_PER_ELEMENT),f=l>0?new Int16Array(this._binary,this._binaryOffset+i[12],l/Int16Array.BYTES_PER_ELEMENT):c;this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=c,this._data.floatArray=d,this._data.frameIntArray=m,this._data.frameFloatArray=u,this._data.frameArray=this._frameArrayBuffer=p,this._data.timelineArray=this._timelineArrayBuffer=g,this._data.colorArray=f},BinaryDataParser.prototype.parseDragonBonesData=function(t,i){void 0===i&&(i=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var s=new Uint8Array(t,0,8);if(s[0]!=="D".charCodeAt(0)||s[1]!=="B".charCodeAt(0)||s[2]!=="D".charCodeAt(0)||s[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var a=new Uint32Array(t,8,1)[0],r=new Uint8Array(t,12,a),n=this._decodeUTF8(r),o=JSON.parse(n);return this._binaryOffset=12+a,this._binary=t,e.prototype.parseDragonBonesData.call(this,o,i)},BinaryDataParser.getInstance=function(){return null===BinaryDataParser._binaryDataParserInstance&&(BinaryDataParser._binaryDataParserInstance=new BinaryDataParser),BinaryDataParser._binaryDataParserInstance},BinaryDataParser._binaryDataParserInstance=null,BinaryDataParser}(t.ObjectDataParser);t.BinaryDataParser=e}(l||(l={})),function(t){var e=function(){function BaseFactory(e){void 0===e&&(e=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===BaseFactory._objectParser&&(BaseFactory._objectParser=new t.ObjectDataParser),null===BaseFactory._binaryParser&&(BaseFactory._binaryParser=new t.BinaryDataParser),this._dataParser=null!==e?e:BaseFactory._objectParser}return BaseFactory.prototype._isSupportMesh=function(){return!0},BaseFactory.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,s=this._textureAtlasDataMap[t];i<s.length;i++){if(null!==(h=(o=s[i]).getTexture(e)))return h}if(this.autoSearch)for(var a in this._textureAtlasDataMap)for(var r=0,n=this._textureAtlasDataMap[a];r<n.length;r++){var o,h;if((o=n[r]).autoSearch)if(null!==(h=o.getTexture(e)))return h}return null},BaseFactory.prototype._fillBuildArmaturePackage=function(t,e,i,s,a){var r=null,n=null;if(e.length>0&&e in this._dragonBonesDataMap&&(n=(r=this._dragonBonesDataMap[e]).getArmature(i)),null===n&&(0===e.length||this.autoSearch))for(var o in this._dragonBonesDataMap)if(r=this._dragonBonesDataMap[o],(0===e.length||r.autoSearch)&&null!==(n=r.getArmature(i))){e=o;break}if(null!==n){if(t.dataName=e,t.textureAtlasName=a,t.data=r,t.armature=n,t.skin=null,s.length>0&&(t.skin=n.getSkin(s),null===t.skin&&this.autoSearch))for(var o in this._dragonBonesDataMap){var h=this._dragonBonesDataMap[o].getArmature(s);if(null!==h){t.skin=h.defaultSkin;break}}return null===t.skin&&(t.skin=n.defaultSkin),!0}return!1},BaseFactory.prototype._buildBones=function(e,i){for(var s=0,a=e.armature.sortedBones;s<a.length;s++){var r=a[s];t.BaseObject.borrowObject(0===r.type?t.Bone:t.Surface).init(r,i)}},BaseFactory.prototype._buildSlots=function(t,e){var i=t.skin,s=t.armature.defaultSkin;if(null!==i&&null!==s){var a={};for(var r in s.displays){var n=s.getDisplays(r);a[r]=n}if(i!==s)for(var r in i.displays){n=i.getDisplays(r);a[r]=n}for(var o=0,h=t.armature.sortedSlots;o<h.length;o++){var l=h[o],c=l.name in a?a[l.name]:null,d=this._buildSlot(t,l,e);if(null!==c){d.displayFrameCount=c.length;for(var m=0,u=d.displayFrameCount;m<u;++m){var p=c[m];if(d.replaceRawDisplayData(p,m),null!==p){if(t.textureAtlasName.length>0){var g=this._getTextureData(t.textureAtlasName,p.path);d.replaceTextureData(g,m)}var f=this._getSlotDisplay(t,p,d);d.replaceDisplay(f,m)}else d.replaceDisplay(null)}}d._setDisplayIndex(l.displayIndex,!0)}}},BaseFactory.prototype._buildConstraints=function(e,i){var s=e.armature.constraints;for(var a in s){var r=s[a];switch(r.type){case 0:var n=t.BaseObject.borrowObject(t.IKConstraint);n.init(r,i),i._addConstraint(n);break;case 1:var o=t.BaseObject.borrowObject(t.PathConstraint);o.init(r,i),i._addConstraint(o);break;default:var h=t.BaseObject.borrowObject(t.IKConstraint);h.init(r,i),i._addConstraint(h)}}},BaseFactory.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},BaseFactory.prototype._getSlotDisplay=function(e,i,s){var a=null!==e?e.dataName:i.parent.parent.parent.name,r=null;switch(i.type){case 0:var n=i;null===n.texture&&(n.texture=this._getTextureData(a,i.path)),r=s.rawDisplay;break;case 2:var o=i;null===o.texture&&(o.texture=this._getTextureData(a,o.path)),r=this._isSupportMesh()?s.meshDisplay:s.rawDisplay;break;case 1:var h=i,l=this._buildChildArmature(e,s,h);if(null!==l){if(l.inheritAnimation=h.inheritAnimation,!l.inheritAnimation){var c=h.actions.length>0?h.actions:l.armatureData.defaultActions;if(c.length>0)for(var d=0,m=c;d<m.length;d++){var u=m[d],p=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(u,p,s.armature),p.slot=s,s.armature._bufferAction(p,!1)}else l.animation.play()}h.armature=l.armatureData}r=l}return r},BaseFactory.prototype.parseDragonBonesData=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=1);for(var s=t instanceof ArrayBuffer?BaseFactory._binaryParser:this._dataParser,a=s.parseDragonBonesData(t,i);;){var r=this._buildTextureAtlasData(null,null);if(!s.parseTextureAtlasData(null,r,i)){r.returnToPool();break}this.addTextureAtlasData(r,e)}return null!==a&&this.addDragonBonesData(a,e),a},BaseFactory.prototype.parseTextureAtlasData=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=1);var a=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,a,s),this._buildTextureAtlasData(a,e||null),this.addTextureAtlasData(a,i),a},BaseFactory.prototype.updateTextureAtlases=function(t,e){var i=this.getTextureAtlasData(e);if(null!==i)for(var s=0,a=i.length;s<a;++s)s<t.length&&this._buildTextureAtlasData(i[s],t[s])},BaseFactory.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},BaseFactory.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},BaseFactory.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},BaseFactory.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},BaseFactory.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var i=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];i.indexOf(t)<0&&i.push(t)},BaseFactory.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var s=0,a=i;s<a.length;s++){var r=a[s];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[t]}},BaseFactory.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var s=new i;return this._fillBuildArmaturePackage(s,e,t,"","")?s.armature:null},BaseFactory.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=0,s=this._textureAtlasDataMap[e];i<s.length;i++){var a=s[i];this._dragonBones.bufferObject(a)}delete this._textureAtlasDataMap[e]}},BaseFactory.prototype.buildArmature=function(t,e,s,a){void 0===e&&(e=""),void 0===s&&(s=""),void 0===a&&(a="");var r=new i;if(!this._fillBuildArmaturePackage(r,e||"",t,s||"",a||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var n=this._buildArmature(r);return this._buildBones(r,n),this._buildSlots(r,n),this._buildConstraints(r,n),n.invalidUpdate(null,!0),n.advanceTime(0),n},BaseFactory.prototype.replaceDisplay=function(t,e,i){if(void 0===i&&(i=-1),i<0&&(i=t.displayIndex),i<0&&(i=0),t.replaceDisplayData(e,i),null!==e){var s=this._getSlotDisplay(null,e,t);if(0===e.type){var a=t.getDisplayFrameAt(i).rawDisplayData;null!==a&&2===a.type&&(s=t.meshDisplay)}t.replaceDisplay(s,i)}else t.replaceDisplay(null,i)},BaseFactory.prototype.replaceSlotDisplay=function(t,e,i,s,a,r){void 0===r&&(r=-1);var n=this.getArmatureData(e,t||"");if(null===n||null===n.defaultSkin)return!1;var o=n.defaultSkin.getDisplay(i,s);return this.replaceDisplay(a,o,r),!0},BaseFactory.prototype.replaceSlotDisplayList=function(t,e,i,s){var a=this.getArmatureData(e,t||"");if(!a||!a.defaultSkin)return!1;var r=a.defaultSkin.getDisplays(i);if(!r)return!1;s.displayFrameCount=r.length;for(var n=0,o=s.displayFrameCount;n<o;++n){var h=r[n];this.replaceDisplay(s,h,n)}return!0},BaseFactory.prototype.replaceSkin=function(t,e,i,s){void 0===i&&(i=!1),void 0===s&&(s=null);for(var a=!1,r=e.parent.defaultSkin,n=0,o=t.getSlots();n<o.length;n++){var h=o[n];if(!(null!==s&&s.indexOf(h.name)>=0)){var l=e.getDisplays(h.name);if(null!==l||(null!==r&&e!==r&&(l=r.getDisplays(h.name)),null!==l)){h.displayFrameCount=l.length;for(var c=0,d=h.displayFrameCount;c<d;++c){var m=l[c];h.replaceRawDisplayData(m,c),null!==m?h.replaceDisplay(this._getSlotDisplay(null,m,h),c):h.replaceDisplay(null,c)}a=!0}else i&&(h.displayFrameCount=0)}}return a},BaseFactory.prototype.replaceAnimation=function(e,i,s){void 0===s&&(s=!0);var a=i.defaultSkin;if(null===a)return!1;if(s)e.animation.animations=i.animations;else{var r=e.animation.animations,n={};for(var o in r)n[o]=r[o];for(var o in i.animations)n[o]=i.animations[o];e.animation.animations=n}for(var h=0,l=e.getSlots();h<l.length;h++)for(var c=l[h],d=0,m=0,u=c.displayList;m<u.length;m++){var p=u[m];if(p instanceof t.Armature){var g=a.getDisplays(c.name);if(null!==g&&d<g.length){var f=g[d];if(null!==f&&1===f.type){var _=this.getArmatureData(f.path,f.parent.parent.parent.name);_&&this.replaceAnimation(p,_,s)}}}d++}return!0},BaseFactory.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},BaseFactory.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(BaseFactory.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(BaseFactory.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),BaseFactory._objectParser=null,BaseFactory._binaryParser=null,BaseFactory}();t.BaseFactory=e;var i=function i(){this.dataName="",this.textureAtlasName="",this.skin=null};t.BuildArmaturePackage=i}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function EventDispatcher(){return null!==t&&t.apply(this,arguments)||this}return a(EventDispatcher,t),EventDispatcher.prototype.hasDBEventListener=function(t){return this.listenerCount(t)>0},EventDispatcher.prototype.dispatchDBEvent=function(t,e){this.emit(t,e)},EventDispatcher.prototype.addDBEventListener=function(t,e,i){this.on(t,e,i)},EventDispatcher.prototype.removeDBEventListener=function(t,e,i){this.off(t,e,i)},EventDispatcher}(Phaser.Events.EventEmitter);t.EventDispatcher=e}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){t.Skew={getSkewX:function(){return this._skewX||0},setSkewX:function(t){this._skewX=t},getSkewY:function(){return this._skewY||0},setSkewY:function(t){this._skewY=t},setSkew:function(t,e){e=void 0===e?t:e,this._skewX=t,this._skewY=e}},t.extendSkew=function(e){Object.defineProperty(e.prototype,"skewX",{get:t.Skew.getSkewX,set:t.Skew.setSkewX,enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewY",{get:t.Skew.getSkewY,set:t.Skew.setSkewY,enumerable:!0,configurable:!0}),e.prototype.setSkew=t.Skew.setSkew}}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function TransformMatrix(e,i,s,a,r,n){var o=t.call(this,e,i,s,a,r,n)||this;return o.decomposedMatrix.skewX=0,o.decomposedMatrix.skewY=0,o}return a(TransformMatrix,t),TransformMatrix.prototype.decomposeMatrix=function(){var t=this.a,e=this.b,i=this.c,s=this.d,a=-Math.atan2(-i,s),r=Math.atan2(e,t),n=Math.abs(a+r);return n<1e-5||Math.abs(Phaser.Math.PI2-n)<1e-5?(this.decomposedMatrix.rotation=r,t<0&&s>=0&&(this.decomposedMatrix.rotation+=this.decomposedMatrix.rotation<=0?Math.PI:-Math.PI),this.decomposedMatrix.skewX=this.decomposedMatrix.skewY=0):(this.decomposedMatrix.rotation=0,this.decomposedMatrix.skewX=a,this.decomposedMatrix.skewY=r),this.decomposedMatrix.scaleX=Math.sqrt(t*t+e*e),this.decomposedMatrix.scaleY=Math.sqrt(i*i+s*s),this.decomposedMatrix.translateX=this.tx,this.decomposedMatrix.translateY=this.ty,this.decomposedMatrix},TransformMatrix.prototype.applyITRSC=function(t,e,i,s,a,r,n){return this.a=Math.cos(i-n)*s,this.b=Math.sin(i-n)*s,this.c=-Math.sin(i+r)*a,this.d=Math.cos(i+r)*a,this.tx=t,this.ty=e,this},Object.defineProperty(TransformMatrix.prototype,"skewX",{get:function(){return-Math.atan2(-this.c,this.d)},enumerable:!0,configurable:!0}),Object.defineProperty(TransformMatrix.prototype,"skewY",{get:function(){return Math.atan2(this.b,this.a)},enumerable:!0,configurable:!0}),TransformMatrix}(Phaser.GameObjects.Components.TransformMatrix);t.TransformMatrix=e}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(e){function DisplayContainer(i,s,a,r){var n=e.call(this,i,s,a,r)||this;return n._skewX=0,n._skewY=0,n.tempTransformMatrix=new t.util.TransformMatrix,n}return a(DisplayContainer,e),DisplayContainer.prototype.pointToContainer=function(t,e){if(void 0===e&&(e=new Phaser.Math.Vector2),this.parentContainer)return this.parentContainer.pointToContainer(t,e);var i=this.tempTransformMatrix;return i.applyITRSC(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this._skewX,this._skewY),i.invert(),i.transformPoint(t.x,t.y,e),e},Object.defineProperty(DisplayContainer.prototype,"skewX",{get:function(){return this._skewX},set:function(t){this._skewX=t},enumerable:!0,configurable:!0}),Object.defineProperty(DisplayContainer.prototype,"skewY",{get:function(){return this._skewY},set:function(t){this._skewY=t},enumerable:!0,configurable:!0}),DisplayContainer.prototype.setSkew=function(t,e){return e=void 0===e?t:e,this.skewX=t,this.skewY=e,this},DisplayContainer}(Phaser.GameObjects.Container);e.DisplayContainer=i}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function ArmatureDisplay(e){var i=t.call(this,e)||this;return i.debugDraw=!1,i}return a(ArmatureDisplay,t),ArmatureDisplay.prototype.dbInit=function(t){this._armature=t},ArmatureDisplay.prototype.dbClear=function(){this.removeAllListeners(),this._armature&&this._armature.dispose(),this._armature=null},ArmatureDisplay.prototype.dbUpdate=function(){this.debugDraw},ArmatureDisplay.prototype.dispose=function(e){this.dbClear(),!0===e&&t.prototype.destroy.call(this)},ArmatureDisplay.prototype.destroy=function(){this.dispose(!0)},ArmatureDisplay.prototype.dispatchDBEvent=function(t,e){this.emit(t,e)},ArmatureDisplay.prototype.hasDBEventListener=function(t){return this.listenerCount(t)>0},ArmatureDisplay.prototype.addDBEventListener=function(t,e,i){this.on(t,e,i)},ArmatureDisplay.prototype.removeDBEventListener=function(t,e,i){this.off(t,e,i)},Object.defineProperty(ArmatureDisplay.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(ArmatureDisplay.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),ArmatureDisplay}(t.DisplayContainer);t.ArmatureDisplay=e}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(t){function SlotImage(e,i,s,a,r){var n=t.call(this,e,i,s,a,r)||this;return n.setPipeline("PhaserTextureTintPipeline"),n}return a(SlotImage,t),SlotImage}(Phaser.GameObjects.Image);e.SlotImage=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(t){function SlotSprite(e,i,s,a,r){var n=t.call(this,e,i,s,a,r)||this;return n.setPipeline("PhaserTextureTintPipeline"),n}return a(SlotSprite,t),SlotSprite}(Phaser.GameObjects.Sprite);e.SlotSprite=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(e){!function(e){var i=function(i){function Slot(){return null!==i&&i.apply(this,arguments)||this}return a(Slot,i),Slot.toString=function(){return"[class dragonBones.PhaserSlot]"},Slot.prototype._onClear=function(){i.prototype._onClear.call(this),this._textureScale=1,this._renderDisplay&&(this._renderDisplay.destroy(),this._renderDisplay=null)},Slot.prototype._initDisplay=function(t,e){},Slot.prototype._disposeDisplay=function(t,e){},Slot.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display||this._rawDisplay},Slot.prototype._addDisplay=function(){this.armature.display.add(this._renderDisplay)},Slot.prototype._replaceDisplay=function(t){this._renderDisplay.setSkew?(this.armature.display.replace(t,this._renderDisplay),this._renderDisplay.parentContainer=this.armature.display):console.warn("please call dragonBones.phaser.util.extendSkew to mix skew component into your display object,\n                                and set its pipeline to 'PhaserTextureTintPipeline' by calling 'setPiepline' method, more detail please refer to the 'ReplaceSlotDisplay.ts' example")},Slot.prototype._removeDisplay=function(){this._renderDisplay.parentContainer.remove(this._renderDisplay)},Slot.prototype._updateZOrder=function(){this._renderDisplay.depth!==this._zOrder&&this._renderDisplay.setDepth(this._zOrder)},Slot.prototype._updateVisible=function(){this._renderDisplay.setVisible(this._parent.visible&&this._visible)},Slot.prototype._updateBlendMode=function(){var t=Phaser.BlendModes.NORMAL;switch(this._blendMode){case 0:t=Phaser.BlendModes.NORMAL;break;case 1:t=Phaser.BlendModes.ADD;break;case 3:t=Phaser.BlendModes.DARKEN;break;case 4:t=Phaser.BlendModes.DIFFERENCE;break;case 6:t=Phaser.BlendModes.HARD_LIGHT;break;case 9:t=Phaser.BlendModes.LIGHTEN;break;case 10:t=Phaser.BlendModes.MULTIPLY;break;case 11:t=Phaser.BlendModes.OVERLAY;break;case 12:t=Phaser.BlendModes.SCREEN}this._renderDisplay.setBlendMode(t)},Slot.prototype._updateColor=function(){var t=this._colorTransform,i=this._globalAlpha*t.alphaMultiplier+t.alphaOffset;if(this._renderDisplay.setAlpha(i),!(this._renderDisplay instanceof e.DisplayContainer)){var s=255*t.redMultiplier+t.redOffset<<16|255*t.greenMultiplier+t.greenOffset<<8|255*t.blueMultiplier+t.blueOffset;this._renderDisplay.setTint(s)}},Slot.prototype._updateFrame=function(){if(!(this._renderDisplay instanceof e.DisplayContainer)){var i=this._textureData;if(this._displayIndex>=0&&null!==this._display&&null!==i){var s=i.parent;null!==this.armature.replacedTexture&&(null===this.armature._replaceTextureAtlasData?((s=t.BaseObject.borrowObject(e.TextureAtlasData)).copyFrom(i.parent),s.renderTexture=this.armature.replacedTexture,this.armature._replaceTextureAtlasData=s):s=this.armature._replaceTextureAtlasData,i=s.getTexture(i.name));var a=i.renderTexture;if(null!==a)return null!==this._geometryData||(this._renderDisplay.texture=a.texture,this._renderDisplay.frame=a,this._renderDisplay.setDisplayOrigin(this._pivotX,this._pivotY),this._textureScale=i.parent.scale*this.armature.armatureData.scale,this._renderDisplay.setScale(this._textureScale)),void(this._visibleDirty=!0)}else this._renderDisplay.x=0,this._renderDisplay.y=0,this._renderDisplay.setTexture(void 0)}},Slot.prototype._updateMesh=function(){},Slot.prototype._updateTransform=function(){this.updateGlobalTransform();var t=this.global;this._renderDisplay.x=t.x,this._renderDisplay.y=t.y,this._renderDisplay.rotation=t.rotation,this._renderDisplay.setSkew(t.skew,0),this._renderDisplay.setScale(t.scaleX*this._textureScale,t.scaleY*this._textureScale)},Slot.prototype._identityTransform=function(){this._renderDisplay.setPosition(),this._renderDisplay.setRotation(),this._textureScale=1,this._renderDisplay.setScale(this._textureScale),this._renderDisplay.setSkew(0)},Slot}(t.Slot);e.Slot=i}(e.display||(e.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(e){!function(e){var i=function(e){function TextureAtlasData(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderTexture=null,t}return a(TextureAtlasData,e),TextureAtlasData.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"},TextureAtlasData.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this._renderTexture&&this._renderTexture.destroy(),this._renderTexture=null},TextureAtlasData.prototype.createTexture=function(){return t.BaseObject.borrowObject(s)},Object.defineProperty(TextureAtlasData.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(t){if(t&&this._renderTexture!==t)for(var e in this._renderTexture&&this._renderTexture.destroy(),this._renderTexture=t,this.textures){var i=this.textures[e],s=this._renderTexture.add(e,0,i.region.x,i.region.y,i.region.width,i.region.height);i.rotated&&(s.rotated=!0,s.updateUVsInverted()),i.renderTexture=s}},enumerable:!0,configurable:!0}),TextureAtlasData}(t.TextureAtlasData);e.TextureAtlasData=i;var s=function(t){function TextureData(){var e=null!==t&&t.apply(this,arguments)||this;return e.renderTexture=null,e}return a(TextureData,t),TextureData.toString=function(){return"[class dragonBones.PhaserTextureData]"},TextureData.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.renderTexture&&this.renderTexture.destroy(),this.renderTexture=null},TextureData}(t.TextureData);e.TextureData=s}(e.display||(e.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(e){function TextureTintPipeline(i){var s=e.call(this,i)||this;return s._tempMatrix1=new t.util.TransformMatrix,s._tempMatrix2=new t.util.TransformMatrix,s._tempMatrix3=new t.util.TransformMatrix,s}return a(TextureTintPipeline,e),TextureTintPipeline.prototype.batchSprite=function(t,e,i){this.renderer.setPipeline(this);var s=this._tempMatrix1,a=this._tempMatrix2,r=this._tempMatrix3,n=t.frame,o=n.glTexture,h=n.u0,l=n.v0,c=n.u1,d=n.v1,m=n.x,u=n.y,p=n.width,g=n.height,f=-t.displayOriginX+m,_=-t.displayOriginY+u;if(t.isCropped){var y=t._crop;y.flipX===t.flipX&&y.flipY===t.flipY||n.updateCropUVs(y,t.flipX,t.flipY),h=y.u0,l=y.v0,c=y.u1,d=y.v1,p=y.width,g=y.height,m=y.x,u=y.y,f=-t.displayOriginX+m,_=-t.displayOriginY+u}t.flipX&&(f+=p,p*=-1),t.flipY&&(_+=g,g*=-1);var v=f+p,S=_+g;a.applyITRSC(t.x,t.y,t.rotation,t.scaleX,t.scaleY,t.skewX||0,t.skewY||0),s.copyFrom(e.matrix),i?(s.multiplyWithOffset(i,-e.scrollX*t.scrollFactorX,-e.scrollY*t.scrollFactorY),a.e=t.x,a.f=t.y,s.multiply(a,r)):(a.e-=e.scrollX*t.scrollFactorX,a.f-=e.scrollY*t.scrollFactorY,s.multiply(a,r));var b=r.getX(f,_),T=r.getY(f,_),D=r.getX(f,S),x=r.getY(f,S),P=r.getX(v,S),C=r.getY(v,S),w=r.getX(v,_),O=r.getY(v,_),A=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintTL,e.alpha*t._alphaTL),B=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintTR,e.alpha*t._alphaTR),E=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintBL,e.alpha*t._alphaBL),I=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintBR,e.alpha*t._alphaBR);e.roundPixels&&(b|=0,T|=0,D|=0,x|=0,P|=0,C|=0,w|=0,O|=0),this.setTexture2D(o,0);var M=t._isTinted&&t.tintFill;this.batchQuad(b,T,D,x,P,C,w,O,h,l,c,d,A,B,E,I,M)},TextureTintPipeline}(Phaser.Renderer.WebGL.Pipelines.TextureTintPipeline);e.TextureTintPipeline=i}(t.pipeline||(t.pipeline={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){t.FileTypes={IMAGE:"imageFile",JSON:"jsonFile",BINARY:"binaryFile",map:{imageFile:Phaser.Loader.FileTypes.ImageFile,jsonFile:Phaser.Loader.FileTypes.JSONFile,binaryFile:Phaser.Loader.FileTypes.BinaryFile},setType:function(e,i){t.FileTypes.map[e]=i},getType:function(e){return t.FileTypes.map[e]}}}(t.plugin||(t.plugin={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(e){function DragonBonesFile(i,s,a,r,n,o,h,l){var c,d,m,u,p=t.FileTypes.getType(t.FileTypes.BINARY),g=t.FileTypes.getType(t.FileTypes.JSON),f=t.FileTypes.getType(t.FileTypes.IMAGE),createBoneFileByType=function(t,e,i,s){var a="json";if(s&&s.responseType)switch(s.responseType){case"arraybuffer":case"blob":a="bin";break;case"json":case"text":a="json"}return"bin"===a?new p(t,e,i,s):new g(t,e,i,s)};if(Phaser.Utils.Objects.IsPlainObject(s)){var _=s;c=new f(i,{key:u=Phaser.Utils.Objects.GetFastValue(_,"key"),url:Phaser.Utils.Objects.GetFastValue(_,"textureURL"),extension:Phaser.Utils.Objects.GetFastValue(_,"textureExtension","png"),xhrSettings:Phaser.Utils.Objects.GetFastValue(_,"textureXhrSettings")}),d=new g(i,{key:u+"_atlasjson",url:Phaser.Utils.Objects.GetFastValue(_,"atlasURL"),extension:Phaser.Utils.Objects.GetFastValue(_,"atlasExtension","json"),xhrSettings:Phaser.Utils.Objects.GetFastValue(_,"atlasXhrSettings")}),m=createBoneFileByType(i,u,Phaser.Utils.Objects.GetFastValue(_,"boneURL"),Phaser.Utils.Objects.GetFastValue(_,"boneXhrSettings"))}else c=new f(i,u=s,a,o),d=new g(i,u+"_atlasjson",r,h),m=createBoneFileByType(i,u,n,l);return m.cache=i.cacheManager.custom.dragonbone,e.call(this,i,"dragonbone",u,[c,d,m])||this}return a(DragonBonesFile,e),DragonBonesFile.prototype.addToCache=function(){if(this.isReadyToProcess()){var t=this.files[0],e=this.files[1],i=this.files[2];e.addToCache(),i.addToCache(),this.loader.textureManager.addImage(t.key,t.data),this.complete=!0}},DragonBonesFile}(Phaser.Loader.MultiFile);t.DragonBonesFile=e}(t.plugin||(t.plugin={}))}(t.phaser||(t.phaser={}))}(l||(l={})),h=l||(l={}),function(t){var e=function(t){function DragonBonesScenePlugin(e,i){var s=t.call(this,e,i)||this,a=s.game;if(a.cache.addCustom("dragonbone"),s.game.config.renderType===Phaser.WEBGL){var r=s.game.renderer;r.hasPipeline("PhaserTextureTintPipeline")||r.addPipeline("PhaserTextureTintPipeline",new o.pipeline.TextureTintPipeline({game:a,renderer:r}))}return i.registerGameObject("dragonBones",CreateDragonBonesRegisterHandler),i.registerGameObject("armature",CreateArmatureRegisterHandler),i.registerFileType("dragonbone",DragonBoneFileRegisterHandler,e),s}return a(DragonBonesScenePlugin,t),DragonBonesScenePlugin.prototype.createArmature=function(t,e,i,s,a){void 0===a&&(a=1);var r=this.factory.buildArmatureDisplay(t,e,i,s,a);return this.systems.displayList.add(r),this._dbInst.clock.add(r.armature),r},DragonBonesScenePlugin.prototype.createDragonBones=function(t,e){return void 0===e&&(e=1),this.factory.buildDragonBonesData(t,e)},Object.defineProperty(DragonBonesScenePlugin.prototype,"factory",{get:function(){return this._factory||(this._dbInst=new l.DragonBones(new o.util.EventDispatcher),this._factory=new o.Factory(this._dbInst,this.scene)),this._factory},enumerable:!0,configurable:!0}),DragonBonesScenePlugin.prototype.createSlotDisplayPlaceholder=function(){return new o.display.SlotImage(this.scene,0,0)},DragonBonesScenePlugin.prototype.boot=function(){this.systems.events.once("destroy",this.destroy,this),this.start()},DragonBonesScenePlugin.prototype.start=function(){var t=this.systems.events;t.on("update",this.update,this),t.once("shutdown",this.shutdown,this)},DragonBonesScenePlugin.prototype.update=function(t,e){this._dbInst&&this._dbInst.advanceTime(.001*e)},DragonBonesScenePlugin.prototype.shutdown=function(){var t=this.systems.events;t.off("update",this.update,this),t.off("shutdown",this.shutdown,this)},DragonBonesScenePlugin.prototype.destroy=function(){this.shutdown(),this._factory=this._dbInst=null,this.pluginManager=this.game=this.scene=this.systems=null},DragonBonesScenePlugin}(Phaser.Plugins.ScenePlugin);t.DragonBonesScenePlugin=e;var CreateDragonBonesRegisterHandler=function(t,e){return void 0===e&&(e=1),this.scene.dragonbone.createDragonBones(t,e)},CreateArmatureRegisterHandler=function(t,e,i,s){return this.scene.dragonbone.createArmature(t,e,i,s)},DragonBoneFileRegisterHandler=function(e,i,s,a,r,n,o){var h=new t.DragonBonesFile(this,e,i,s,a,r,n,o);return this.addFile(h.files),this}}((o=h.phaser||(h.phaser={})).plugin||(o.plugin={})),function(t){var e=function(e){function Factory(t,i,s){var a=e.call(this,s)||this;return a._scene=i,a._dragonBones=t,a}return a(Factory,e),Factory.prototype._isSupportMesh=function(){return console.warn("Mesh is not supported yet"),!1},Factory.prototype._buildTextureAtlasData=function(e,i){return e?e.renderTexture=i:e=c.BaseObject.borrowObject(t.display.TextureAtlasData),e},Factory.prototype._buildArmature=function(e){var i=c.BaseObject.borrowObject(c.Armature),s=new t.display.ArmatureDisplay(this._scene);return i.init(e.armature,s,s,this._dragonBones),i},Factory.prototype._buildSlot=function(e,i,s){var a=c.BaseObject.borrowObject(t.display.Slot),r=this._scene.dragonbone.createSlotDisplayPlaceholder(),n=r;return a.init(i,s,r,n),a},Factory.prototype.buildArmatureDisplay=function(t,e,i,s,a){var r;return void 0===i&&(i=""),void 0===s&&(s=""),void 0===a&&(a=1),this.buildDragonBonesData(e,a)&&(r=this.buildArmature(t,e,i,s)),r.display},Factory.prototype.buildDragonBonesData=function(t,e){void 0===e&&(e=1);var i=this._dragonBonesDataMap[t];if(!i){var s=this._scene.cache,a=s.custom.dragonbone.get(t);if(a){i=this.parseDragonBonesData(a,t,e);var r=this._scene.textures.get(t),n=s.json.get(t+"_atlasjson");this.parseTextureAtlasData(n,r,r.key,e)}}return i},Factory}(c.BaseFactory);t.Factory=e}((c=l||(l={})).phaser||(c.phaser={}))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){t.exports=function(){return new Worker(i.p+"js/fe284fd9388cc2e33459.networker.js")}},function(t,e,i){t.exports=function(){return new Worker(i.p+"js/a977d8c5a5a65f35e3c7.heartbeatworker.js")}},,,function(t,e,i){t.exports=function(){return new Worker(i.p+"js/3c86a7c62034594f52e1.blockcheckworker.js")}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){const i=Math.PI/180;t.exports=function(t){return t*i}},function(t,e,i){"use strict";function earcut(t,e,i){i=i||2;var s,a,r,n,o,h,l,c=e&&e.length,d=c?e[0]*i:t.length,m=linkedList(t,0,d,i,!0),u=[];if(!m||m.next===m.prev)return u;if(c&&(m=function eliminateHoles(t,e,i,s){var a,r,n,o,h,l=[];for(a=0,r=e.length;a<r;a++)n=e[a]*s,o=a<r-1?e[a+1]*s:t.length,(h=linkedList(t,n,o,s,!1))===h.next&&(h.steiner=!0),l.push(getLeftmost(h));for(l.sort(compareX),a=0;a<l.length;a++)eliminateHole(l[a],i),i=filterPoints(i,i.next);return i}(t,e,m,i)),t.length>80*i){s=r=t[0],a=n=t[1];for(var p=i;p<d;p+=i)(o=t[p])<s&&(s=o),(h=t[p+1])<a&&(a=h),o>r&&(r=o),h>n&&(n=h);l=0!==(l=Math.max(r-s,n-a))?1/l:0}return earcutLinked(m,u,i,s,a,l),u}function linkedList(t,e,i,s,a){var r,n;if(a===signedArea(t,e,i,s)>0)for(r=e;r<i;r+=s)n=insertNode(r,t[r],t[r+1],n);else for(r=i-s;r>=e;r-=s)n=insertNode(r,t[r],t[r+1],n);return n&&equals(n,n.next)&&(removeNode(n),n=n.next),n}function filterPoints(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!equals(s,s.next)&&0!==area(s.prev,s,s.next))s=s.next;else{if(removeNode(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function earcutLinked(t,e,i,s,a,r,n){if(t){!n&&r&&function indexCurve(t,e,i,s){var a=t;do{null===a.z&&(a.z=zOrder(a.x,a.y,e,i,s)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==t);a.prevZ.nextZ=null,a.prevZ=null,function sortLinked(t){var e,i,s,a,r,n,o,h,l=1;do{for(i=t,t=null,r=null,n=0;i;){for(n++,s=i,o=0,e=0;e<l&&(o++,s=s.nextZ);e++);for(h=l;o>0||h>0&&s;)0!==o&&(0===h||!s||i.z<=s.z)?(a=i,i=i.nextZ,o--):(a=s,s=s.nextZ,h--),r?r.nextZ=a:t=a,a.prevZ=r,r=a;i=s}r.nextZ=null,l*=2}while(n>1);return t}(a)}(t,s,a,r);for(var o,h,l=t;t.prev!==t.next;)if(o=t.prev,h=t.next,r?isEarHashed(t,s,a,r):isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(h.i/i),removeNode(t),t=h.next,l=h.next;else if((t=h)===l){n?1===n?earcutLinked(t=cureLocalIntersections(t,e,i),e,i,s,a,r,2):2===n&&splitEarcut(t,e,i,s,a,r):earcutLinked(filterPoints(t),e,i,s,a,r,1);break}}}function isEar(t){var e=t.prev,i=t,s=t.next;if(area(e,i,s)>=0)return!1;for(var a=t.next.next;a!==t.prev;){if(pointInTriangle(e.x,e.y,i.x,i.y,s.x,s.y,a.x,a.y)&&area(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function isEarHashed(t,e,i,s){var a=t.prev,r=t,n=t.next;if(area(a,r,n)>=0)return!1;for(var o=a.x<r.x?a.x<n.x?a.x:n.x:r.x<n.x?r.x:n.x,h=a.y<r.y?a.y<n.y?a.y:n.y:r.y<n.y?r.y:n.y,l=a.x>r.x?a.x>n.x?a.x:n.x:r.x>n.x?r.x:n.x,c=a.y>r.y?a.y>n.y?a.y:n.y:r.y>n.y?r.y:n.y,d=zOrder(o,h,e,i,s),m=zOrder(l,c,e,i,s),u=t.prevZ,p=t.nextZ;u&&u.z>=d&&p&&p.z<=m;){if(u!==t.prev&&u!==t.next&&pointInTriangle(a.x,a.y,r.x,r.y,n.x,n.y,u.x,u.y)&&area(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,p!==t.prev&&p!==t.next&&pointInTriangle(a.x,a.y,r.x,r.y,n.x,n.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;u&&u.z>=d;){if(u!==t.prev&&u!==t.next&&pointInTriangle(a.x,a.y,r.x,r.y,n.x,n.y,u.x,u.y)&&area(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;p&&p.z<=m;){if(p!==t.prev&&p!==t.next&&pointInTriangle(a.x,a.y,r.x,r.y,n.x,n.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(t,e,i){var s=t;do{var a=s.prev,r=s.next.next;!equals(a,r)&&intersects(a,s,s.next,r)&&locallyInside(a,r)&&locallyInside(r,a)&&(e.push(a.i/i),e.push(s.i/i),e.push(r.i/i),removeNode(s),removeNode(s.next),s=t=r),s=s.next}while(s!==t);return s}function splitEarcut(t,e,i,s,a,r){var n=t;do{for(var o=n.next.next;o!==n.prev;){if(n.i!==o.i&&isValidDiagonal(n,o)){var h=splitPolygon(n,o);return n=filterPoints(n,n.next),h=filterPoints(h,h.next),earcutLinked(n,e,i,s,a,r),void earcutLinked(h,e,i,s,a,r)}o=o.next}n=n.next}while(n!==t)}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=function findHoleBridge(t,e){var i,s=e,a=t.x,r=t.y,n=-1/0;do{if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){var o=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(o<=a&&o>n){if(n=o,o===a){if(r===s.y)return s;if(r===s.next.y)return s.next}i=s.x<s.next.x?s:s.next}}s=s.next}while(s!==e);if(!i)return null;if(a===n)return i.prev;var h,l=i,c=i.x,d=i.y,m=1/0;s=i.next;for(;s!==l;)a>=s.x&&s.x>=c&&a!==s.x&&pointInTriangle(r<d?a:n,r,c,d,r<d?n:a,r,s.x,s.y)&&((h=Math.abs(r-s.y)/(a-s.x))<m||h===m&&s.x>i.x)&&locallyInside(s,t)&&(i=s,m=h),s=s.next;return i}(t,e)){var i=splitPolygon(e,t);filterPoints(i,i.next)}}function zOrder(t,e,i,s,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*a)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function pointInTriangle(t,e,i,s,a,r,n,o){return(a-n)*(e-o)-(t-n)*(r-o)>=0&&(t-n)*(s-o)-(i-n)*(e-o)>=0&&(i-n)*(r-o)-(a-n)*(s-o)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function intersectsPolygon(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&locallyInside(t,e)&&locallyInside(e,t)&&function middleInside(t,e){var i=t,s=!1,a=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&a<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)}function area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,i,s){return!!(equals(t,e)&&equals(i,s)||equals(t,s)&&equals(i,e))||area(t,e,i)>0!=area(t,e,s)>0&&area(i,s,t)>0!=area(i,s,e)>0}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function splitPolygon(t,e){var i=new Node(t.i,t.x,t.y),s=new Node(e.i,e.x,e.y),a=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,s.next=i,i.prev=s,r.next=s,s.prev=r,s}function insertNode(t,e,i,s){var a=new Node(t,e,i);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,i,s){for(var a=0,r=e,n=i-s;r<i;r+=s)a+=(t[n]-t[r])*(t[r+1]+t[n+1]),n=r;return a}t.exports=earcut,earcut.deviation=function(t,e,i,s){var a=e&&e.length,r=a?e[0]*i:t.length,n=Math.abs(signedArea(t,0,r,i));if(a)for(var o=0,h=e.length;o<h;o++){var l=e[o]*i,c=o<h-1?e[o+1]*i:t.length;n-=Math.abs(signedArea(t,l,c,i))}var d=0;for(o=0;o<s.length;o+=3){var m=s[o]*i,u=s[o+1]*i,p=s[o+2]*i;d+=Math.abs((t[m]-t[p])*(t[u+1]-t[m+1])-(t[m]-t[u])*(t[p+1]-t[m+1]))}return 0===n&&0===d?0:Math.abs((d-n)/n)},earcut.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,a=0;a<t.length;a++){for(var r=0;r<t[a].length;r++)for(var n=0;n<e;n++)i.vertices.push(t[a][r][n]);a>0&&(s+=t[a-1].length,i.holes.push(s))}return i}},function(t,e,i){var s=i(239),a=i(240);t.exports=function(t,e,i,r,n){var o=this.pipeline,h=o._tempMatrix1,l=o._tempMatrix2,c=o._tempMatrix3;t.setPipeline(o),l.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY),h.copyFrom(r.matrix),n?(h.multiplyWithOffset(n,-r.scrollX*e.scrollFactorX,-r.scrollY*e.scrollFactorY),l.e=e.x,l.f=e.y):(l.e-=r.scrollX*e.scrollFactorX,l.f-=r.scrollY*e.scrollFactorY),h.multiply(l,c);var d=e._displayOriginX,m=e._displayOriginY,u=r.alpha*e.alpha;e.isFilled&&s(o,c,e,u,d,m),e.isStroked&&a(o,e,u,d,m)}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,s,a,r,n){for(var o=i.getTintAppendFloatAlphaAndSwap(s.fillColor,s.fillAlpha*a),h=s.pathData,l=s.pathIndexes,c=0;c<l.length;c+=3){var d=2*l[c],m=2*l[c+1],u=2*l[c+2],p=h[d+0]-r,g=h[d+1]-n,f=h[m+0]-r,_=h[m+1]-n,y=h[u+0]-r,v=h[u+1]-n,S=e.getX(p,g),b=e.getY(p,g),T=e.getX(f,_),D=e.getY(f,_),x=e.getX(y,v),P=e.getY(y,v);t.setTexture2D(),t.batchTri(S,b,T,D,x,P,0,0,1,1,o,o,o,t.tintEffect)}}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,s,a,r){var n=t.strokeTint,o=i.getTintAppendFloatAlphaAndSwap(e.strokeColor,e.strokeAlpha*s);n.TL=o,n.TR=o,n.BL=o,n.BR=o;var h=e.pathData,l=h.length-1,c=e.lineWidth,d=c/2,m=h[0]-a,u=h[1]-r;e.closePath||(l-=2);for(var p=2;p<l;p+=2){var g=h[p]-a,f=h[p+1]-r;t.setTexture2D(),t.batchLine(m,u,g,f,d,d,c,p-2,!!e.closePath&&p===l-1),m=g,u=f}}},function(t,e,i){var s=i(242),a=i(243),r=Phaser.Renderer.Canvas.SetTransform;t.exports=function(t,e,i,n,o){var h=t.currentContext;if(r(t,h,e,n,o)){var l=e._displayOriginX,c=e._displayOriginY,d=e.pathData,m=d.length-1,u=d[0]-l,p=d[1]-c;h.beginPath(),h.moveTo(u,p),e.closePath||(m-=2);for(var g=2;g<m;g+=2){var f=d[g]-l,_=d[g+1]-c;h.lineTo(f,_)}h.closePath(),e.isFilled&&(s(h,e),h.fill()),e.isStroked&&(a(h,e),h.stroke()),h.restore()}}},function(t,e){t.exports=function(t,e,i,s){var a=i||e.fillColor,r=s||e.fillAlpha,n=(16711680&a)>>>16,o=(65280&a)>>>8,h=255&a;t.fillStyle="rgba("+n+","+o+","+h+","+r+")"}},function(t,e){t.exports=function(t,e,i,s){var a=i||e.strokeColor,r=s||e.strokeAlpha,n=(16711680&a)>>>16,o=(65280&a)>>>8,h=255&a;t.strokeStyle="rgba("+n+","+o+","+h+","+r+")",t.lineWidth=e.lineWidth}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,s,a,r){if(0!==e.width&&0!==e.height){var n=e.frame,o=n.width,h=n.height,l=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,n.glTexture,o,h,e.x,e.y,o/e.style.resolution,h/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,o,h,l(e._tintTL,a.alpha*e._alphaTL),l(e._tintTR,a.alpha*e._alphaTR),l(e._tintBL,a.alpha*e._alphaBL),l(e._tintBR,a.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,a,r)}}},function(t,e){t.exports=function(t,e,i,s,a){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,s,a)}},function(t,e,i){var s={"./ComponentRank/ComponentRankMediator":133,"./ComponentRank/ComponentRankMediator.ts":133,"./ComponentRank/ComponentRankPanel":88,"./ComponentRank/ComponentRankPanel.ts":88,"./ControlF/ControlFMediator":134,"./ControlF/ControlFMediator.ts":134,"./ControlF/ControlFPanel":89,"./ControlF/ControlFPanel.ts":89,"./InteractivePanel/InteractivePanelMediator":90,"./InteractivePanel/InteractivePanelMediator.ts":90,"./InteractivePanel/mobile/InteractiveMobilePanel":135,"./InteractivePanel/mobile/InteractiveMobilePanel.ts":135,"./InteractivePanel/pc/InteractivePanel":91,"./InteractivePanel/pc/InteractivePanel.ts":91,"./ItemDetail/ItemDetail":92,"./ItemDetail/ItemDetail.ts":92,"./ItemDetail/ItemDetailMediator":136,"./ItemDetail/ItemDetailMediator.ts":136,"./MessageBox/MessageBoxMediator":137,"./MessageBox/MessageBoxMediator.ts":137,"./MessageBox/MessageBoxView":93,"./MessageBox/MessageBoxView.ts":93,"./Notice/NoticeMediator":84,"./Notice/NoticeMediator.ts":84,"./Notice/NoticePanel":85,"./Notice/NoticePanel.ts":85,"./Rank/BasicRankPanel":55,"./Rank/BasicRankPanel.ts":55,"./Rank/RankMediator":138,"./Rank/RankMediator.ts":138,"./Rank/RankPanel":94,"./Rank/RankPanel.ts":94,"./Shop/ShopMediator":139,"./Shop/ShopMediator.ts":139,"./Shop/ShopPanel":95,"./Shop/ShopPanel.ts":95,"./Shop/shop.itemSlot":105,"./Shop/shop.itemSlot.ts":105,"./UserInfo/UserInfoMediator":140,"./UserInfo/UserInfoMediator.ts":140,"./UserInfo/UserInfoPanel":96,"./UserInfo/UserInfoPanel.ts":96,"./UserMenu/MenuItem":97,"./UserMenu/MenuItem.ts":97,"./UserMenu/UserMenuMediator":141,"./UserMenu/UserMenuMediator.ts":141,"./UserMenu/UserMenuPanel":98,"./UserMenu/UserMenuPanel.ts":98,"./alert/alert":99,"./alert/alert.ts":99,"./bag/IListItemRender":142,"./bag/IListItemRender.ts":142,"./bag/bagView/bagMediator":86,"./bag/bagView/bagMediator.ts":86,"./bag/bagView/bagPanel":87,"./bag/bagView/bagPanel.ts":87,"./bag/basebag":143,"./bag/basebag.ts":143,"./bag/baseitem":144,"./bag/baseitem.ts":144,"./bag/dragDropIcon":46,"./bag/dragDropIcon.ts":46,"./bag/idragable":145,"./bag/idragable.ts":145,"./bag/idropable":146,"./bag/idropable.ts":146,"./bag/item.slot":27,"./bag/item.slot.ts":27,"./bag/storage/storageMediator":147,"./bag/storage/storageMediator.ts":147,"./bag/storage/storagePanel":148,"./bag/storage/storagePanel.ts":148,"./baseView/mainUI.mediator":44,"./baseView/mainUI.mediator.ts":44,"./baseView/mobile/bottom.btn.group":80,"./baseView/mobile/bottom.btn.group.ts":80,"./baseView/mobile/icon.btn":45,"./baseView/mobile/icon.btn.ts":45,"./baseView/mobile/icon.select.btn":82,"./baseView/mobile/icon.select.btn.ts":82,"./baseView/mobile/left.btn.group":81,"./baseView/mobile/left.btn.group.ts":81,"./baseView/mobile/mainUI.mobile":53,"./baseView/mobile/mainUI.mobile.ts":53,"./baseView/mobile/right.btn.group":79,"./baseView/mobile/right.btn.group.ts":79,"./baseView/mobile/top.btn.group":78,"./baseView/mobile/top.btn.group.ts":78,"./baseView/pc/mainUI.pc":83,"./baseView/pc/mainUI.pc.ts":83,"./chat/base.chat.panel":52,"./chat/base.chat.panel.ts":52,"./chat/chat.mediator":50,"./chat/chat.mediator.ts":50,"./chat/message":149,"./chat/message.ts":149,"./chat/mobile/chatPanel.mobile":77,"./chat/mobile/chatPanel.mobile.ts":77,"./chat/pc/chatPanel.pc":71,"./chat/pc/chatPanel.pc.ts":71,"./components/check.button":75,"./components/check.button.ts":75,"./components/comboBox":100,"./components/comboBox.ts":100,"./components/dynamic.image":18,"./components/dynamic.image.ts":18,"./components/dynamic.ninepatch":62,"./components/dynamic.ninepatch.ts":62,"./components/dynamic.sprite":61,"./components/dynamic.sprite.ts":61,"./components/message.box":150,"./components/message.box.ts":150,"./components/nine.patch":14,"./components/nine.patch.ts":14,"./components/ninepatch.button":17,"./components/ninepatch.button.ts":17,"./components/panel":8,"./components/panel.ts":8,"./components/patches.config":60,"./components/patches.config.ts":60,"./components/radio":54,"./components/radio.ts":54,"./components/scroller":151,"./components/scroller.ts":151,"./components/scroller.view":152,"./components/scroller.view.ts":152,"./debuglog/debug.logger":59,"./debuglog/debug.logger.mediator":58,"./debuglog/debug.logger.mediator.ts":58,"./debuglog/debug.logger.ts":59,"./friend/friend.mediator":153,"./friend/friend.mediator.ts":153,"./friend/friend.panel":154,"./friend/friend.panel.ts":154,"./tips/itoolTip":155,"./tips/itoolTip.ts":155,"./tips/toolTip":56,"./tips/toolTip.ts":56};function webpackContext(t){var e=webpackContextResolve(t);return i(e)}function webpackContextResolve(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}webpackContext.keys=function webpackContextKeys(){return Object.keys(s)},webpackContext.resolve=webpackContextResolve,t.exports=webpackContext,webpackContext.id=246}]]);