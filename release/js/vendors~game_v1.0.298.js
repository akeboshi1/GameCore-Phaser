(this.webpackJsonpTooqingCore=this.webpackJsonpTooqingCore||[]).push([[2],{103:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=Object.prototype.hasOwnProperty;function isFunction(e){return"function"==typeof e}function isUndefined(e){return void 0===e}function isString(e){return"[object String]"===Object.prototype.toString.call(e)}i.has=function(e,i){return o.call(e,i)},i.defaultCompare=function defaultCompare(e,i){return e<i?-1:e===i?0:1},i.defaultEquals=function defaultEquals(e,i){return e===i},i.defaultToString=function defaultToString(e){return null===e?"COLLECTION_NULL":isUndefined(e)?"COLLECTION_UNDEFINED":isString(e)?"$s"+e:"$o"+e.toString()},i.makeString=function makeString(e,n){if(void 0===n&&(n=","),null===e)return"COLLECTION_NULL";if(isUndefined(e))return"COLLECTION_UNDEFINED";if(isString(e))return e.toString();var o="{",r=!0;for(var s in e)i.has(e,s)&&(r?r=!1:o+=n,o=o+s+":"+e[s]);return o+"}"},i.isFunction=isFunction,i.isUndefined=isUndefined,i.isString=isString,i.reverseCompareFunction=function reverseCompareFunction(e){return isUndefined(e)||!isFunction(e)?function(e,i){return e<i?1:e===i?0:-1}:function(i,n){return-1*e(i,n)}},i.compareToEquals=function compareToEquals(e){return function(i,n){return 0===e(i,n)}}},107:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(15),r=n(11),s=n(134);class Helpers{static genId(){return(new r).natural({min:1e4,max:s.default.MAX_ID})}static getClassName(e){return e.constructor.name}static sha1(e){return o.enc.Hex.stringify(o.SHA1(e))}static pointToString(e){return`${e.x},${e.y}`}static flipArray(e){const i=[...e],n=[];if(i.length>0){const e=i[0].length;for(let o=0;o<e;o++){n[o]=[];for(let e=0;e<i.length;e++)n[o].push(i[e][o])}}return n}static arrayToString(e,i,n){const o=[];for(const n of e)o.push(n.join(i));return o.join(n)}static stringToArray(e,i,n){const o=e.split(n),r=[];for(const e of o){const n=e.split(i);r.push(n.map(e=>parseInt(e)))}return r}static getSnAndVersion(e){let i="",n="1";const o=new RegExp(/.*\/(Terrain|Element)Node\/([a-f\d]{24})\/(\d+)\/[a-f\d]{24}\.json/),r=e.match(o);return r&&(n=r[2],i=r[1]),[i,n]}static getElementSn(e,i="1"){return`${e}#${i}`}}Helpers.ID_VOL=9e5,i.default=Helpers},123:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103),r=function(){function Dictionary(e){this.table={},this.nElements=0,this.toStr=e||o.defaultToString}return Dictionary.prototype.getValue=function(e){var i=this.table["$"+this.toStr(e)];if(!o.isUndefined(i))return i.value},Dictionary.prototype.setValue=function(e,i){if(!o.isUndefined(e)&&!o.isUndefined(i)){var n,r="$"+this.toStr(e),s=this.table[r];return o.isUndefined(s)?(this.nElements++,n=void 0):n=s.value,this.table[r]={key:e,value:i},n}},Dictionary.prototype.remove=function(e){var i="$"+this.toStr(e),n=this.table[i];if(!o.isUndefined(n))return delete this.table[i],this.nElements--,n.value},Dictionary.prototype.keys=function(){var e=[];for(var i in this.table)if(o.has(this.table,i)){var n=this.table[i];e.push(n.key)}return e},Dictionary.prototype.values=function(){var e=[];for(var i in this.table)if(o.has(this.table,i)){var n=this.table[i];e.push(n.value)}return e},Dictionary.prototype.forEach=function(e){for(var i in this.table)if(o.has(this.table,i)){var n=this.table[i];if(!1===e(n.key,n.value))return}},Dictionary.prototype.containsKey=function(e){return!o.isUndefined(this.getValue(e))},Dictionary.prototype.clear=function(){this.table={},this.nElements=0},Dictionary.prototype.size=function(){return this.nElements},Dictionary.prototype.isEmpty=function(){return this.nElements<=0},Dictionary.prototype.toString=function(){var e="{";return this.forEach((function(i,n){e+="\n\t"+i+" : "+n})),e+"\n}"},Dictionary}();i.default=r},132:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103);function indexOf(e,i,n){for(var r=n||o.defaultEquals,s=e.length,a=0;a<s;a++)if(r(e[a],i))return a;return-1}i.indexOf=indexOf,i.lastIndexOf=function lastIndexOf(e,i,n){for(var r=n||o.defaultEquals,s=e.length-1;s>=0;s--)if(r(e[s],i))return s;return-1},i.contains=function contains(e,i,n){return indexOf(e,i,n)>=0},i.remove=function remove(e,i,n){var o=indexOf(e,i,n);return!(o<0)&&(e.splice(o,1),!0)},i.frequency=function frequency(e,i,n){for(var r=n||o.defaultEquals,s=e.length,a=0,c=0;c<s;c++)r(e[c],i)&&a++;return a},i.equals=function equals(e,i,n){var r=n||o.defaultEquals;if(e.length!==i.length)return!1;for(var s=e.length,a=0;a<s;a++)if(!r(e[a],i[a]))return!1;return!0},i.copy=function copy(e){return e.concat()},i.swap=function swap(e,i,n){if(i<0||i>=e.length||n<0||n>=e.length)return!1;var o=e[i];return e[i]=e[n],e[n]=o,!0},i.toString=function toString(e){return"["+e.toString()+"]"},i.forEach=function forEach(e,i){for(var n=0,o=e;n<o.length;n++){if(!1===i(o[n]))return}}},133:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(466);i.GameNode=o.default,i.SettingsNode=o.SettingsNode,i.PaletteNode=o.PaletteNode,i.AssetsNode=o.AssetsNode,i.MossNode=o.MossNode;const r=n(204);i.ElementNode=r.default;const s=n(205);i.LocationNode=s.default;const a=n(155);i.AnimationsNode=a.default,i.AnimationDataNode=a.AnimationDataNode;const c=n(373);i.DisplayNode=c.default;const l=n(375);i.AvatarNode=l.default;const u=n(467);i.MovableNode=u.default;const h=n(374);i.AttributeNode=h.default;const d=n(468);i.FunctionNode=d.default;const p=n(469);i.EventNode=p.default;const f=n(470);i.UINode=f.default,i.ButtonNode=f.ButtonNode,i.TextNode=f.TextNode;const g=n(471);i.TimerNode=g.default;const m=n(472);i.SpawnPointNode=m.default;const y=n(376);i.AccessNode=y.AccessNode;const v=n(377);i.SceneNode=v.default,i.MapSizeNode=v.MapSizeNode,i.TerrainCollectionNode=v.TerrainCollectionNode,i.MossCollectionNode=v.MossCollectionNode;const b=n(473);i.ForkNode=b.default;const N=n(206);i.PackageNode=N.default,i.PackageItemNode=N.PackageItemNode;const k=n(93);i.BaseConfigObject=k.BaseConfigObject;const x=n(372);i.Metadata=x.default;const w=n(378);i.CharacterNode=w.default,i.CampNode=w.CampNode;const P=n(203);i.TerrainNode=P.TerrainNode;const S=n(379);i.ShopNode=S.default,i.ShopItemNode=S.ShopItemNode,i.CommodityNode=S.CommodityNode;const O=n(380);i.SceneryNode=O.default},134:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(5).op_def.NodeType;class Constants{}Constants.MAX_ID=Math.pow(2,31),Constants.NODE_T=[null,"GameNode","SceneNode","ElementNode","TerrainNode","CharacterNode","LocationNode","MovableNode","DisplayNode","AttributeNode","FunctionNode","AnimationsNode","EventNode","MapSizeNode","UINode","TimerNode","PackageNode","PackageItemNode","AvatarNode","SettingsNode","CampNode","MutexNode","AnimationDataNode","ForkNode","ButtonNode","TextNode","AccessNode","SpawnPointNode","CommodityNode","ShopNode","PaletteNode","TerrainCollectionNode","AssetsNode","MossNode","MossCollectionNode","SceneryNode","ModsNode"],Constants.NODE_T_CN_Map={GameNode:"游戏",SceneNode:"场景",ElementNode:"物件",TerrainNode:"地块",CharacterNode:"角色",LocationNode:"位置",MovableNode:"可移动",DisplayNode:"显示",AttributeNode:"属性",FunctionNode:"方法",AnimationsNode:"动画",EventNode:"事件",MapSizeNode:"场景尺寸",UINode:"交互显示",TimerNode:"计时器",PackageNode:"背包",PackageItemNode:"背包道具",AvatarNode:"装扮",SettingsNode:"游戏设置",CampNode:"阵营",MutexNode:"互斥",AnimationDataNode:"动画数据",ForkNode:"备份节点",ButtonNode:"按钮",TextNode:"文字",AccessNode:"传送点",SpawnPointNode:"出生点",ShopNode:"内购商城",CommodityNode:"商品",AssetsNode:"资源仓库",SceneryNode:"天空盒"},Constants.NODETYPEMAP={[o.GameNodeType]:"GameNode",[o.SceneNodeType]:"SceneNode",[o.ElementNodeType]:"ElementNode",[o.TerrainNodeType]:"TerrainNode",[o.CharacterNodeType]:"CharacterNode",[o.LocationType]:"LocationNode",[o.MovableType]:"MovableNode",[o.DisplayType]:"DisplayNode",[o.AttributeType]:"AttributeNode",[o.FunctionType]:"FunctionNode",[o.AnimationsType]:"AnimationsNode",[o.EventType]:"EventNode",[o.MapSizeType]:"MapSizeNode",[o.UIType]:"UINode",[o.TimerType]:"TimerNode",[o.PackageType]:"PackageNode",[o.PackageItemType]:"PackageItemNode",[o.AvatarType]:"AvatarNode",[o.SettingsType]:"SettingsNode",[o.CampType]:"CampNode",[o.MutexType]:"MutexNode",[o.AnimationDataType]:"AnimationDataNode",[o.ForkType]:"ForkNode",[o.ButtonType]:"ButtonNode",[o.TextType]:"TextNode",[o.AccessType]:"AccessNode",[o.SpawnPointType]:"SpawnPointNode",[o.CommodityType]:"CommodityNode",[o.ShopType]:"ShopNode",[o.PaletteType]:"PaletteNode",[o.TerrainCollectionType]:"TerrainCollectionNode",[o.AssetsType]:"AssetsNode",[o.MossType]:"MossNode",[o.MossCollectionType]:"MossCollectionNode",[o.SceneryType]:"SceneryNode",[o.ModsType]:"ModsNode"},i.default=Constants},155:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(6),s=n(107),a=n(5),c=n(373);class AnimationsNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._defaultAnimation="idle",this._data_map=new Map,this._editorToolType=0,this.name="动画"}get properties(){return{dir:this._dir,defaultAnimation:this._defaultAnimation}}ignore(){super.ignore(),this.cap.ignoreList.set(this.id,this.id)}findMyContainer(e){return Array.isArray(e.animations)||(e.animations=[]),e.animations}createProtocolObject(){const e=a.op_gameconfig_01.Animations.create();return e.node=super.makeNode(),e.dir=this._dir,e.defaultAnimation=this._defaultAnimation,e.scale=this._scale,e}deserialize(e){super.deserialize(e);const i=e;this._defaultAnimation=i.defaultAnimation,this._scale=i.scale,this._dir=this._scale?5:i.dir||3}importSprite(e){const i=e.display;i&&this.setDisplayPath(i.texturePath||"",i.dataPath||""),e.direction&&(this.dir=e.direction);const n=e.animations;if(n&&n.length>0){for(const e of n){const i=this._cap.add.animationdata(this);i&&(i.importAnimation(e),i.parent=this.id)}e.currentAnimationName&&(this.defaultAnimationName=e.currentAnimationName)}}syncSprite(e){e.direction&&(this.dir=e.direction)}addAnimationData(e){this._data_map.set(e.id,e)}removeAnimationData(e){this._data_map.delete(e.id)}getAnimationData(e){return this._data_map.get(e)}getDefaultAnimationData(){if(this._data_map.size>0)return this._data_map.values().next().value}setDisplayPath(e,i){const n=this.display;n.texturePath=e,n.dataPath=i}get dir(){return this._dir}set dir(e){this._dir=e}get display(){return this._display||this.cap.add.display(this)}get animationData(){return Array.from(this._data_map.values())}get defaultAnimationName(){return this._defaultAnimation}set defaultAnimationName(e){this._defaultAnimation=e}get editorToolType(){return this._editorToolType}set editorToolType(e){this._editorToolType=e}get thumbBuffer(){return this._thumbBuffer}set thumbBuffer(e){this._thumbBuffer=e}horizontalFlip(){3!==this.dir&&5!==this.dir||(this.dir=3===this.dir?5:3),this._scale=3!==this.dir}static Flip(e=3){return{3:5,5:3}[e]}get scale(){return this._scale}setSelectedAnimation(e){this._selectedAnimationID=e}get animationDataList(){return Array.from(this._data_map.values())}getSelectedAnimation(){if(this._selectedAnimationID)return this._data_map.get(this._selectedAnimationID)}appendNode(e){try{super.appendNode(e)}catch(e){console.error(e)}e instanceof AnimationDataNode&&this.addAnimationData(e),e instanceof c.default&&(this._display=e)}removeNode(e){try{super.removeNode(e)}catch(e){console.error(e)}e instanceof AnimationDataNode&&this.removeAnimationData(e),e instanceof c.default&&(this._display=void 0)}geneSelfSequence(){let e=""+this.defaultAnimationName;return this._scale&&(e+=this._scale.toString()),e}geneSequence(){let e=""+this.defaultAnimationName;this._display&&(e+=this._display.geneSequence()),this._scale&&(e+=this._scale.toString()),this._dir&&(e+=this._dir.toString());const i=this.animationDataList.sort();if(i.length>0)for(const n of i)e+=n.geneSequence();return e}duplicate(e){super.duplicate(e),e instanceof AnimationsNode&&(this._defaultAnimation=e.defaultAnimationName,this._dir=e.dir,this._scale=e.scale)}checkSameName(e){const i=this.animationData;for(const n of i)if(n.name===e)return!0;return!1}}i.default=AnimationsNode;class AnimationDataNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this.areaRows=51,this.areaCols=51,this.centerPoint={x:this.areaRows>>1,y:this.areaCols>>1},this._frameRate=5,this._frameName=[],this._loop=!0,this._baseLoc={x:0,y:0},this.layerDict=new Map,this.name="序列帧数据",this.frameDuration=[]}ignore(){super.ignore(),this.cap.ignoreList.set(this.id,this.id)}get properties(){return{frameRate:this._frameRate,frameName:this._frameName,loop:this._loop,baseLoc:`${this._baseLoc.x},${this._baseLoc.y}`,originPoint:this.collisionOriginPoint,basicWalkableArea:this._basicWalkableArea,basicCollisionArea:this._basicCollisionArea}}findMyContainer(e){return Array.isArray(e.animationdatas)||(e.animationdatas=[]),e.animationdatas}createProtocolObject(){const e=a.op_gameconfig_01.AnimationData.create();if(e.node=super.makeNode(),e.baseLoc=`${this._baseLoc.x},${this._baseLoc.y}`,e.frameName=this._frameName,e.loop=this._loop,e.frameRate=this._frameRate,this._collisionArea&&(e.collisionArea=s.default.arrayToString(this._collisionArea,",","&")),this._walkableArea&&(e.walkableArea=s.default.arrayToString(this._walkableArea,",","&")),this._collisionOriginPoint){const i=this._collisionOriginPoint;e.originPoint=[i.y,i.x]}if(this._interactiveArea){let i=null;const n=[];for(const e of this._interactiveArea)i=a.op_def.PBPoint2i.create(),i.x=e.x,i.y=e.y,n.push(i);e.interactiveArea=n}if(this._mainInteractivePoints){e.mainInteractivePoints=[];for(const i of this._mainInteractivePoints){const n=a.op_def.PBPoint2i.create();Object.assign(n,i),e.mainInteractivePoints.push(n)}}return this._frameDuration&&(e.frameDuration=this._frameDuration),this.layerDict.size>0&&(e.layer=r.orderBy(Array.from(this.layerDict.values()),["depth"],["asc"]).map(e=>e.serialize())),this._mountLayer&&(e.mountLayer=this._mountLayer.serialize()),e}deserialize(e){super.deserialize(e);const i=e;if(this._frameRate=i.frameRate,this._frameName=i.frameName||[],i.frameDuration?this.frameDuration=i.frameDuration:i.frameName&&(this.frameDuration=new Array(i.frameName.length).fill(0)),i.layer){this._layer=[];for(let e=0;e<i.layer.length;e++){const n=i.layer[e],o=new AnimationLayer;o.deserialize(n),o.initDepth(e,i.mountLayer),this._layer.push(o),this.layerDict.set(o.id,o)}}else if(!i.layer&&i.frameName&&i.frameName.length>0){this._layer=[];const e=new AnimationLayer(i.frameName);e.initDepth(0,i.mountLayer),this.frameDuration=new Array(i.frameName.length).fill(0),this._layer.push(e),this.layerDict.set(e.id,e)}if(this._loop=i.loop||!1,i.originPoint&&(this._collisionOriginPoint={x:i.originPoint[1],y:i.originPoint[0]},this._walkableOriginPoint={x:i.originPoint[1],y:i.originPoint[0]}),i.baseLoc){const e=i.baseLoc.split(",");this._baseLoc={x:parseInt(e[0]),y:parseInt(e[1])},this.layerDict.forEach(i=>{if(!i.offsetLoc){const n=a.op_def.PBPoint2f.create();n.x=parseInt(e[0]),n.y=parseInt(e[1]),i.offsetLoc=n}})}i.walkableArea&&(this._walkableArea=s.default.stringToArray(i.walkableArea,",","&"),this._basicWalkableArea=this.initlizeBasicArea(),this.originalArea(this._basicWalkableArea,this._walkableArea,this._collisionOriginPoint)),i.collisionArea&&(this._collisionArea=s.default.stringToArray(i.collisionArea,",","&"),this._basicCollisionArea=this.initlizeBasicArea(),this.originalArea(this._basicCollisionArea,this._collisionArea,this._collisionOriginPoint));const n=i.interactiveArea;if(n){const e=this.interactiveArea;for(const i of n)e.push(i)}if(i.mainInteractivePoints){this.mainInteractivePoints=[];for(const e of i.mainInteractivePoints)this.mainInteractivePoints.push(e)}if(i.mountLayer){const e=new AnimationMountLayer;e.deserialize(i.mountLayer),this._mountLayer=e}}cutBaseArea(){this._basicCollisionArea&&(this._collisionArea=[],this._collisionOriginPoint=Object.assign({},this.centerPoint),this._collisionArea=this.filterArea(this._basicCollisionArea,this._collisionOriginPoint)),this._basicWalkableArea&&(this._walkableArea=[],this._walkableArea=this.filterArea(this.basicWalkableArea))}importAnimation(e){this.frameName=e.frameName||[],this.frameRate=e.frameRate,e.loop&&(this.loop=e.loop),e.node&&(this.name=e.node.name,this.parent=e.node.Parent,this.type=e.node.type);const i=e.baseLoc;if(i){const e=i.split(",");this.baseLoc={x:parseInt(e[0],10),y:parseInt(e[1],10)}}const n=e.originPoint;n&&(this.originPoint={x:n[1],y:n[0]}),e.walkableArea&&(this._walkableArea=s.default.stringToArray(e.walkableArea,",","&")),e.collisionArea&&(this._collisionArea=s.default.stringToArray(e.collisionArea,",","&"));const o=e.interactiveArea;if(o){this.interactiveArea=[];for(const e of o)this.interactiveArea.push(e)}if(e.layer){this.layer=e.layer.map(e=>new AnimationLayer(e.frameName,e.offsetLoc,e.frameVisible));for(const e of this.layer)this.layerDict.set(e.id,e)}e.mountLayer&&(this.mountLayer=new AnimationMountLayer(e.mountLayer.index,e.mountLayer.mountPoint,e.mountLayer.frameVisible))}moveAnimationMountLayer(e){this.mountLayer&&this.mountLayer.index&&(this.mountLayer.index+=e)}initAnimationLayer(){const e=new AnimationLayer([],void 0,[]);this.layerDict.set(e.id,e)}updateAnimationLayerDepth(e){this.layerDict.forEach(i=>{const n=e.find(e=>e.id===i.id);n&&(i.depth=n.index)})}updateAnimationMountLayerDepth(e){this.mountLayer&&(this.mountLayer.index=e)}addAnimationLayer(e){if(this.layerDict.size>0){const i=Array.from(this.layerDict.values())[0].frameName.length,n=new Array(i).fill("blank"),o=new Array(i).fill(!0),r=new AnimationLayer(n,void 0,o);r.depth=this.layerDict.size,r.name=e,this.layerDict.set(r.id,r)}else{const i=new AnimationLayer([],void 0,[]);i.depth=0,i.name=e,this.layerDict.set(i.id,i)}}deleteAnimationLayer(e){this.layerDict.delete(e)}addAnimationMountLayer(e){this.mountLayer||(this.mountLayer=new AnimationMountLayer(e,[],[]))}deleteAnimationMountLayer(){this.mountLayer=void 0}addDuration(e){this._frameDuration.splice(e,0,0)}deleteDuration(e){this._frameDuration.splice(e,1)}get originPoint(){return this._collisionOriginPoint||(this._collisionOriginPoint={x:0,y:0}),this._collisionOriginPoint}set originPoint(e){this._collisionOriginPoint=e}get frameRate(){return this._frameRate}set frameRate(e){this._frameRate=e}get loop(){return this._loop}set loop(e){this._loop=e}get baseLoc(){return this._baseLoc}set baseLoc(e){this._baseLoc=e}get layer(){return this._layer}set layer(e){if(this._layer=e,e)for(const i of e)this.layerDict.set(i.id,i)}get basicCollisionArea(){return this._basicCollisionArea&&0!==this._basicCollisionArea.length||(this._basicCollisionArea=this.initlizeBasicArea()),this._basicCollisionArea}setBasicCollisionArea(e,i,n){e<0||e>this.areaRows||i<0||i>this.areaCols||this._basicCollisionArea&&(this._basicCollisionArea[e][i]=n)}get basicWalkableArea(){return this._basicWalkableArea&&0!==this._basicWalkableArea.length||(this._basicWalkableArea=this.initlizeBasicArea()),this._basicWalkableArea}get interactiveArea(){return this._interactiveArea||(this._interactiveArea=[]),this._interactiveArea}set interactiveArea(e){this._interactiveArea=e}get mainInteractivePoints(){return this._mainInteractivePoints}set mainInteractivePoints(e){this._mainInteractivePoints=e}get frameName(){return this._frameName}set frameName(e){this._frameName=e}get collisionArea(){return this._collisionArea}set collisionArea(e){this._collisionArea=e}get walkableArea(){return this._walkableArea}set walkableArea(e){this._walkableArea=e}get collisionOriginPoint(){return this._collisionOriginPoint}get walkableOriginPoint(){return this._walkableOriginPoint}get mountLayer(){return this._mountLayer}set mountLayer(e){this._mountLayer=e}get frameDuration(){return this._frameDuration}set frameDuration(e){this._frameDuration=e}setBasicWalkableArea(e,i,n){e<0||e>this.areaRows||i<0||i>this.areaCols||this._basicWalkableArea&&(this._basicWalkableArea[e][i]=n)}convertToClientObject(e){const i=a.op_gameconfig_01.AnimationData.create();return i.node=super.makeNode(),i.frameRate=this._frameRate,i.loop=this._loop||!1,i.frameName=this._frameName||[],i.baseLoc=`${this.baseLoc.x},${this.baseLoc.y}`,i.walkOriginPoint=[this.originPoint.y,this.originPoint.x],i.originPoint=[this.originPoint.y,this.originPoint.x],i.interactiveArea=this.interactiveArea,this._walkableArea?i.walkableArea=s.default.arrayToString(this._walkableArea,",","&"):i.walkableArea="",this._collisionArea?i.collisionArea=s.default.arrayToString(this._collisionArea,",","&"):i.collisionArea="",this._layer&&(i.layer=this._layer.map(e=>e.serialize())),this._mountLayer&&(i.mountLayer=this._mountLayer.serialize()),i}geneSequence(){let e=`${this.name}${this._frameRate}`;return this.layer&&this.layer.length>0&&this.layer[0].frameName&&(e+=this.layer[0].frameName.join("_")),e+=JSON.stringify(this.baseLoc),e+=JSON.stringify(this.originPoint),this._collisionArea&&(e+=JSON.stringify(this._collisionArea)),this._walkableArea&&(e+=JSON.stringify(this._walkableArea)),e}filterArea(e,i){const n=[...e];return this.removeHeadRows(n,i),this.removeHeadCols(n,i),this.removeTailRows(n),this.removeTailCols(n),n}originalArea(e,i,n){if(!e||!i)return;n=n||{x:0,y:0};const o=this.centerPoint.x-n.x,r=this.centerPoint.y-n.y;for(let n=0;n<i.length;n++)for(let s=0;s<i[0].length;s++)e.length>n+o&&e[n].length>s+r&&(e[n+o][s+r]=i[n][s])}removeHeadRows(e,i){let n=0;if(this._collisionArea&&this._collisionArea.length&&this._collisionOriginPoint)return n=this.centerPoint.x-this._collisionOriginPoint.x,void e.splice(0,n);const o=e.slice(n,this.centerPoint.x),r=o.length;for(let n=0;n<r;++n){if(o[n].find(e=>e>0))return;e.shift(),i&&(i.x-=1)}}removeTailRows(e){let i=0;this._collisionArea&&this._collisionArea.length>0&&(i=this._collisionArea.length-1);const n=e.slice(1);for(let o=n.length-1;o>=i;o--){if(n[o].find(e=>e>0)&&0===i)return;e.pop()}}removeHeadCols(e,i){let n=-1;if(this._collisionArea&&this._collisionArea.length&&this._collisionOriginPoint&&(n=this.centerPoint.y-this._collisionOriginPoint.y),n<1)for(let i=0;i<e.length;++i){const o=e[i].findIndex(e=>e>0);o>-1&&o<this.centerPoint.x&&(n<0&&(n=o),n=Math.min(n,o))}if((n<0||NaN===n)&&(n=this.centerPoint.x),n>-1){for(let i=0;i<e.length;++i)e[i]=e[i].slice(n);i&&(i.y-=n)}}removeTailCols(e){let i=0;if(this._collisionArea&&this._collisionArea.length>0)i=this._collisionArea[0].length;else for(let n=0;n<e.length;++n){const o=e[n];let r=o.slice().reverse().findIndex(e=>e>0);r>-1&&(r=o.length-r,i=Math.max(i,r))}if(i<1&&(i=1),e[0].length>i)for(let n=0;n<e.length;++n)e[n]=e[n].slice(0,i)}initlizeBasicArea(){const e=[];for(let i=0;i<this.areaRows;i++){e[i]=[];for(let n=0;n<this.areaCols;n++)e[i][n]=0}return e}duplicate(e){super.duplicate(e),e instanceof AnimationDataNode&&(this._loop=e.loop,this._baseLoc=e.baseLoc,this._frameName=e.frameName,this._frameRate=e.frameRate,this._collisionArea=e.collisionArea,this._collisionOriginPoint=e.collisionOriginPoint,this._walkableArea=e.walkableArea,this._walkableOriginPoint=e.walkableOriginPoint,this._interactiveArea=e.interactiveArea,this.layer=e._layer,this.mountLayer=e.mountLayer,this.frameDuration=e.frameDuration)}}i.AnimationDataNode=AnimationDataNode;class AnimationLayer{constructor(e,i,n){this._frameName=e,this._offsetLoc=i,this._frameVisible=n,this.depth=0,this.frames=[],this.layerVisible=!0,this.id=s.default.genId(),e&&e.length>0&&(this._frameVisible=new Array(e.length).fill(!0))}serialize(){let e=a.op_gameconfig_01.AnimationLayer.create();if(this._frameName&&(e.frameName=this._frameName),this._offsetLoc){const i=a.op_def.PBPoint2f.create();Object.assign(i,this._offsetLoc),e.offsetLoc=i}return this._frameVisible&&(e.frameVisible=this._frameVisible),this.name&&(e.name=this.name),e}deserialize(e){e.frameName||(e.frameName=[],e.frameVisible=[]),this._frameName=e.frameName,this._offsetLoc=e.offsetLoc,e.name&&(this.name=e.name),e.frameVisible?this._frameVisible=e.frameVisible:this._frameVisible=new Array(e.frameName.length).fill(!0)}initDepth(e,i){i&&i.index?i.index>e?this.depth=e:this.depth=e+1:this.depth=e}addFrame(e){this.frameName&&this.frameVisible&&(this.frameName.push(e.name),this.frameVisible.push(!0))}addFrameAt(e,i){this.frameName&&this.frameVisible&&(i<0&&(i=0),i>this.frameName.length&&(i=this.frameName.length),this.frameName.splice(i,0,e),this.frameVisible.splice(i,0,!0))}removeFrame(e){this.frameName&&this.frameVisible&&e>-1&&(this.frameName.splice(e,1),this.frameVisible.splice(e,1))}updateFrame(e){this.frameName&&this.frameVisible&&(this.frameName.splice(e.frameIndex,1,e.name),this.frameVisible.splice(e.frameIndex,1,e.visible))}setOffsetLoc(e,i){this._offsetLoc||(this._offsetLoc=a.op_def.PBPoint2f.create()),this._offsetLoc.x=e,this._offsetLoc.y=i}get frameName(){return this._frameName}get offsetLoc(){return this._offsetLoc}set offsetLoc(e){this._offsetLoc=e}get frameVisible(){return this._frameVisible}}i.AnimationLayer=AnimationLayer;class AnimationMountLayer{constructor(e,i,n){this._mountPoint=[],this._frameVisible=[],this.id=s.default.genId(),this._index=e,this._mountPoint=i,this._frameVisible=n}initMountPoints(e){this._mountPoint=[],this._frameVisible=new Array(e).fill(0)}addMountPoint(e){const i=a.op_def.PBPoint3f.create();if(i.x=0,i.y=0,this._mountPoint&&this._frameVisible){this._mountPoint.push(i),this._frameVisible=new Array(e).fill(0);for(let e=0;e<this._frameVisible.length;e++){let i=this._frameVisible[e];for(let e=0;e<this._mountPoint.length;e++)i=this.setIdx1(i,e);this._frameVisible[e]=i}}}setIdx1(e,i){return e|1<<i}setIdx0(e,i){return e&~(1<<i)}deleteIdx(e,i){let n=e%Math.pow(2,i);return Math.floor(e/Math.pow(2,i+1))<<i|n}addFrameVisible(e){if(this._frameVisible&&this._mountPoint){let i=0;for(let e=0;e<this._mountPoint.length;e++)i=this.setIdx1(i,e);this._frameVisible[e]=i}}deleteMountPoint(e){if(this._mountPoint&&this._frameVisible){this._mountPoint.splice(e,1);for(let i=0;i<this._frameVisible.length;i++){let n=this._frameVisible[i];n=this.deleteIdx(n,e),this._frameVisible[i]=n}}}serialize(){let e=a.op_gameconfig_01.AnimationMountLayer.create();if(this._index&&(e.index=this._index),this._mountPoint)for(const i of this._mountPoint){const n=a.op_def.PBPoint3f.create();Object.assign(n,i),e.mountPoint.push(n)}return this._frameVisible&&(e.frameVisible=this._frameVisible),e}deserialize(e){this._index=e.index,e.mountPoint&&(this._mountPoint=e.mountPoint),this._frameVisible=e.frameVisible}get index(){return this._index}set index(e){this._index=e}get mountPoint(){return this._mountPoint}get frameVisible(){return this._frameVisible}set frameVisble(e){if(e&&e.length>8)throw new Error("Max frames length 8");this._frameVisible=e}}i.AnimationMountLayer=AnimationMountLayer},188:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103),r=n(132),s=function(){function LinkedList(){this.firstNode=null,this.lastNode=null,this.nElements=0}return LinkedList.prototype.add=function(e,i){if(o.isUndefined(i)&&(i=this.nElements),i<0||i>this.nElements||o.isUndefined(e))return!1;var n=this.createNode(e);if(0===this.nElements||null===this.lastNode)this.firstNode=n,this.lastNode=n;else if(i===this.nElements)this.lastNode.next=n,this.lastNode=n;else if(0===i)n.next=this.firstNode,this.firstNode=n;else{var r=this.nodeAtIndex(i-1);if(null===r)return!1;n.next=r.next,r.next=n}return this.nElements++,!0},LinkedList.prototype.first=function(){if(null!==this.firstNode)return this.firstNode.element},LinkedList.prototype.last=function(){if(null!==this.lastNode)return this.lastNode.element},LinkedList.prototype.elementAtIndex=function(e){var i=this.nodeAtIndex(e);if(null!==i)return i.element},LinkedList.prototype.indexOf=function(e,i){var n=i||o.defaultEquals;if(o.isUndefined(e))return-1;for(var r=this.firstNode,s=0;null!==r;){if(n(r.element,e))return s;s++,r=r.next}return-1},LinkedList.prototype.contains=function(e,i){return this.indexOf(e,i)>=0},LinkedList.prototype.remove=function(e,i){var n=i||o.defaultEquals;if(this.nElements<1||o.isUndefined(e))return!1;for(var r=null,s=this.firstNode;null!==s;){if(n(s.element,e))return null===r?(this.firstNode=s.next,s===this.lastNode&&(this.lastNode=null)):s===this.lastNode?(this.lastNode=r,r.next=s.next,s.next=null):(r.next=s.next,s.next=null),this.nElements--,!0;r=s,s=s.next}return!1},LinkedList.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},LinkedList.prototype.equals=function(e,i){var n=i||o.defaultEquals;return e instanceof LinkedList&&(this.size()===e.size()&&this.equalsAux(this.firstNode,e.firstNode,n))},LinkedList.prototype.equalsAux=function(e,i,n){for(;null!==e&&null!==i;){if(!n(e.element,i.element))return!1;e=e.next,i=i.next}return!0},LinkedList.prototype.removeElementAtIndex=function(e){if(!(e<0||e>=this.nElements||null===this.firstNode||null===this.lastNode)){var i;if(1===this.nElements)i=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var n=this.nodeAtIndex(e-1);null===n?(i=this.firstNode.element,this.firstNode=this.firstNode.next):n.next===this.lastNode&&(i=this.lastNode.element,this.lastNode=n),null!==n&&null!==n.next&&(i=n.next.element,n.next=n.next.next)}return this.nElements--,i}},LinkedList.prototype.forEach=function(e){for(var i=this.firstNode;null!==i&&!1!==e(i.element);)i=i.next},LinkedList.prototype.reverse=function(){for(var e=null,i=this.firstNode,n=null;null!==i;)n=i.next,i.next=e,e=i,i=n;n=this.firstNode,this.firstNode=this.lastNode,this.lastNode=n},LinkedList.prototype.toArray=function(){for(var e=[],i=this.firstNode;null!==i;)e.push(i.element),i=i.next;return e},LinkedList.prototype.size=function(){return this.nElements},LinkedList.prototype.isEmpty=function(){return this.nElements<=0},LinkedList.prototype.toString=function(){return r.toString(this.toArray())},LinkedList.prototype.nodeAtIndex=function(e){if(e<0||e>=this.nElements)return null;if(e===this.nElements-1)return this.lastNode;for(var i=this.firstNode,n=0;n<e&&null!==i;n++)i=i.next;return i},LinkedList.prototype.createNode=function(e){return{element:e,next:null}},LinkedList}();i.default=s},189:function(e,i,n){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(e){return typeof e}:function _typeof(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(i,"a",(function(){return _typeof}))},190:function(e,i,n){"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}n.d(i,"a",(function(){return _classCallCheck}))},191:function(e,i,n){"use strict";function _defineProperties(e,i){for(var n=0;n<i.length;n++){var o=i[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,i,n){return i&&_defineProperties(e.prototype,i),n&&_defineProperties(e,n),e}n.d(i,"a",(function(){return _createClass}))},203:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(204);class TerrainNode extends o.default{constructor(e,i){super(e,i),this.name="地形"}}i.TerrainNode=TerrainNode},204:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(5),r=n(205),s=n(155),a=n(93),c=n(107);class ElementNode extends a.EntityNode{constructor(e,i){super(e,i),this.name="物件"}get animations(){return this._animations||(this._animations=this.cap.add.animations(this)),this._animations}get location(){return this._location||(this._location=this.cap.add.location(this)),this._location}appendNode(e){try{super.appendNode(e)}catch(e){console.error(e)}e instanceof r.default&&(this._location=e),e instanceof s.default&&(this._animations=e)}removeNode(e){try{super.removeNode(e)}catch(e){console.error(e)}e instanceof r.default&&(this._location=void 0),e instanceof s.default&&(this._animations=void 0)}getSnAndVersion(){let e="",i="1";const n=new RegExp(/.*\/.*\/([a-f\d]{24})\/(\d+)\/[a-f\d]{24}\.json/),o=this.animations.display.dataPath.match(n);return o&&(i=o[2],e=o[1]),this.sn&&(e=this.sn),this.version&&!Number.isNaN(parseInt(i))&&parseInt(this.version)>parseInt(i)&&(i=this.version),[e,i]}getSnKey(){const[e,i]=this.getSnAndVersion();return`${e}#${i}`}judgeIsMoss(){let e=!1;if(void 0!==this.isMoss&&(e=this.isMoss),this._animations){e=!(this._animations.animationData.reduce((e,i)=>e.concat(i.interactiveArea),[]).length>0)}return this.children&&this.children.length>0&&this.children.map(e=>e.type).filter(e=>e!==o.op_def.NodeType.LocationType&&e!==o.op_def.NodeType.AnimationsType).length>0&&(e=!1),e}setToMoss(e){this.isMoss=e}importSprite(e){if(this.id=e.id,this.name=e.nickname||this.name,e.point3f){const{x:i,y:n,z:o}=e.point3f;this.location&&(this.location.x=i,this.location.y=n,this.location.z=o||0)}return e.animations&&(this._animations&&this._animations.destroy(),this.animations.importSprite(e)),this}syncSprite(e){const i=e.point3f;return i&&(this.location.x=i.x,this.location.y=i.y,this.location.z=i.z||0),this.animations.syncSprite(e),this}convertToSprite(){const e=o.op_client.Sprite.create();e.id=this.id,e.nickname=this.name;const i=o.op_def.PBPoint3f.create();if(i.x=this.location.x,i.y=this.location.y,i.z=this.location.z,e.point3f=i,e.sn=this.sn,this.version?e.version=this.version:e.version=this.getSnAndVersion()[1],this._animations){e.currentAnimationName=this._animations.defaultAnimationName,e.direction=this._animations.dir||3,this._animations.animationData&&this._animations.dir&&(e.direction=this._animations.dir);const i=this._animations.display;i&&(e.display=o.op_gameconfig.Display.create(),e.display.dataPath=i.dataPath,e.display.texturePath=i.texturePath);const n=this._animations.animationData;e.animations=[];for(const i of n)e.animations.push(i.convertToClientObject(this._animations.scale))}return e}geneSequence(){let e=super.geneSequence();e+=this.parent,this._location&&(e+=this._location.geneSequence()),this._animations&&(e+=this._animations.geneSequence());const i=this.cap.getChildrenList(this.id);for(const n of i)n instanceof a.BaseConfigObject&&(e+=n.geneSequence());return c.default.sha1(e)}preSerialize(){const e=this.geneSequence();if(this.cap.families.get(e)){for(const e of this.children)e.ignore();this._fork=!0}else this.cap.families.set(e,this.id),this._fork=!1}createProtocolObject(){const e=o.op_gameconfig_01.Entity.create();e.node=this.makeNode(),e.version=this.getSnAndVersion()[1],void 0!==this.isMoss&&(e.isMoss=this.isMoss);this.cap.families.get(this.geneSequence());if(this._fork){const i=this.cap.families.get(this.geneSequence());if(!i)return;e.node.type=o.op_def.NodeType.ForkType,e.node.Parent=i}return e}}i.default=ElementNode},205:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);class LocationNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._x=0,this._y=0,this._z=0,this.name="位置"}ignore(){}get properties(){return{x:this._x,y:this._y,z:this._z}}get x(){return this._x}set x(e){this._x=e}get y(){return this._y}set y(e){this._y=e}get z(){return this._z}set z(e){this._z=e}findMyContainer(e){return Array.isArray(e.loc)||(e.loc=[]),e.loc}createProtocolObject(){const e=r.op_gameconfig_01.Location.create();return e.node=this.makeNode(),e.x=this._x,e.y=this._y,e}deserialize(e){super.deserialize(e);const i=e;this._x=i.x,this._y=i.y}geneSequence(){return""}duplicate(e){super.duplicate(e),e instanceof LocationNode&&(this._x=e.x,this._y=e.y,this._z=e.z)}}i.default=LocationNode},206:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(376);var s=n(5).op_def.NodeType;class PackageNode extends o.EntityNode{constructor(e,i){super(e,i),this._items=[],this.name="背包"}ignore(){}appendNode(e){try{super.appendNode(e)}catch(e){}e instanceof r.AccessNode&&(this._access=e),e.type===s.PackageItemType&&this._items.push(e)}removeNode(e){super.removeNode(e),e instanceof r.AccessNode&&(this._access=void 0),r.AccessNode}}i.default=PackageNode;class PackageItemNode extends o.EntityNode{constructor(e,i){super(e,i),this.name="道具"}ignore(){}}i.PackageItemNode=PackageItemNode},359:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103),r=n(132),s=n(123),a=function(){function Set(e){this.dictionary=new s.default(e)}return Set.prototype.contains=function(e){return this.dictionary.containsKey(e)},Set.prototype.add=function(e){return!this.contains(e)&&!o.isUndefined(e)&&(this.dictionary.setValue(e,e),!0)},Set.prototype.intersection=function(e){var i=this;this.forEach((function(n){return e.contains(n)||i.remove(n),!0}))},Set.prototype.union=function(e){var i=this;e.forEach((function(e){return i.add(e),!0}))},Set.prototype.difference=function(e){var i=this;e.forEach((function(e){return i.remove(e),!0}))},Set.prototype.isSubsetOf=function(e){if(this.size()>e.size())return!1;var i=!0;return this.forEach((function(n){return!!e.contains(n)||(i=!1,!1)})),i},Set.prototype.remove=function(e){return!!this.contains(e)&&(this.dictionary.remove(e),!0)},Set.prototype.forEach=function(e){this.dictionary.forEach((function(i,n){return e(n)}))},Set.prototype.toArray=function(){return this.dictionary.values()},Set.prototype.isEmpty=function(){return this.dictionary.isEmpty()},Set.prototype.size=function(){return this.dictionary.size()},Set.prototype.clear=function(){this.dictionary.clear()},Set.prototype.toString=function(){return r.toString(this.toArray())},Set}();i.default=a},360:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103),r=n(361),s=function(){function BSTreeKV(e){this.root=null,this.compare=e||o.defaultCompare,this.nElements=0}return BSTreeKV.prototype.add=function(e){return!o.isUndefined(e)&&(null!==this.insertNode(this.createNode(e))&&(this.nElements++,!0))},BSTreeKV.prototype.clear=function(){this.root=null,this.nElements=0},BSTreeKV.prototype.isEmpty=function(){return 0===this.nElements},BSTreeKV.prototype.size=function(){return this.nElements},BSTreeKV.prototype.contains=function(e){return!o.isUndefined(e)&&null!==this.searchNode(this.root,e)},BSTreeKV.prototype.search=function(e){var i=this.searchNode(this.root,e);if(null!==i)return i.element},BSTreeKV.prototype.remove=function(e){var i=this.searchNode(this.root,e);return null!==i&&(this.removeNode(i),this.nElements--,!0)},BSTreeKV.prototype.inorderTraversal=function(e){this.inorderTraversalAux(this.root,e,{stop:!1})},BSTreeKV.prototype.preorderTraversal=function(e){this.preorderTraversalAux(this.root,e,{stop:!1})},BSTreeKV.prototype.postorderTraversal=function(e){this.postorderTraversalAux(this.root,e,{stop:!1})},BSTreeKV.prototype.levelTraversal=function(e){this.levelTraversalAux(this.root,e)},BSTreeKV.prototype.minimum=function(){if(!this.isEmpty()&&null!==this.root)return this.minimumAux(this.root).element},BSTreeKV.prototype.maximum=function(){if(!this.isEmpty()&&null!==this.root)return this.maximumAux(this.root).element},BSTreeKV.prototype.forEach=function(e){this.inorderTraversal(e)},BSTreeKV.prototype.toArray=function(){var e=[];return this.inorderTraversal((function(i){return e.push(i),!0})),e},BSTreeKV.prototype.height=function(){return this.heightAux(this.root)},BSTreeKV.prototype.searchNode=function(e,i){for(var n=1;null!==e&&0!==n;)(n=this.compare(i,e.element))<0?e=e.leftCh:n>0&&(e=e.rightCh);return e},BSTreeKV.prototype.transplant=function(e,i){null===e.parent?this.root=i:e===e.parent.leftCh?e.parent.leftCh=i:e.parent.rightCh=i,null!==i&&(i.parent=e.parent)},BSTreeKV.prototype.removeNode=function(e){if(null===e.leftCh)this.transplant(e,e.rightCh);else if(null===e.rightCh)this.transplant(e,e.leftCh);else{var i=this.minimumAux(e.rightCh);i.parent!==e&&(this.transplant(i,i.rightCh),i.rightCh=e.rightCh,i.rightCh.parent=i),this.transplant(e,i),i.leftCh=e.leftCh,i.leftCh.parent=i}},BSTreeKV.prototype.inorderTraversalAux=function(e,i,n){null===e||n.stop||(this.inorderTraversalAux(e.leftCh,i,n),n.stop||(n.stop=!1===i(e.element),n.stop||this.inorderTraversalAux(e.rightCh,i,n)))},BSTreeKV.prototype.levelTraversalAux=function(e,i){var n=new r.default;for(null!==e&&n.enqueue(e),e=n.dequeue()||null;null!=e;){if(!1===i(e.element))return;null!==e.leftCh&&n.enqueue(e.leftCh),null!==e.rightCh&&n.enqueue(e.rightCh),e=n.dequeue()||null}},BSTreeKV.prototype.preorderTraversalAux=function(e,i,n){null===e||n.stop||(n.stop=!1===i(e.element),n.stop||(this.preorderTraversalAux(e.leftCh,i,n),n.stop||this.preorderTraversalAux(e.rightCh,i,n)))},BSTreeKV.prototype.postorderTraversalAux=function(e,i,n){null===e||n.stop||(this.postorderTraversalAux(e.leftCh,i,n),n.stop||(this.postorderTraversalAux(e.rightCh,i,n),n.stop||(n.stop=!1===i(e.element))))},BSTreeKV.prototype.minimumAux=function(e){for(;null!=e&&null!==e.leftCh;)e=e.leftCh;return e},BSTreeKV.prototype.maximumAux=function(e){for(;null!=e&&null!==e.rightCh;)e=e.rightCh;return e},BSTreeKV.prototype.heightAux=function(e){return null===e?-1:Math.max(this.heightAux(e.leftCh),this.heightAux(e.rightCh))+1},BSTreeKV.prototype.insertNode=function(e){for(var i=null,n=this.root;null!==n;){var o=this.compare(e.element,n.element);if(0===o)return null;o<0?(i=n,n=n.leftCh):(i=n,n=n.rightCh)}return e.parent=i,null===i?this.root=e:this.compare(e.element,i.element)<0?i.leftCh=e:i.rightCh=e,e},BSTreeKV.prototype.createNode=function(e){return{element:e,leftCh:null,rightCh:null,parent:null}},BSTreeKV}();i.default=s},361:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(188),r=function(){function Queue(){this.list=new o.default}return Queue.prototype.enqueue=function(e){return this.list.add(e)},Queue.prototype.add=function(e){return this.list.add(e)},Queue.prototype.dequeue=function(){if(0!==this.list.size()){var e=this.list.first();return this.list.removeElementAtIndex(0),e}},Queue.prototype.peek=function(){if(0!==this.list.size())return this.list.first()},Queue.prototype.size=function(){return this.list.size()},Queue.prototype.contains=function(e,i){return this.list.contains(e,i)},Queue.prototype.isEmpty=function(){return this.list.size()<=0},Queue.prototype.clear=function(){this.list.clear()},Queue.prototype.forEach=function(e){this.list.forEach(e)},Queue}();i.default=r},362:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103),r=n(132),s=function(){function Heap(e){this.data=[],this.compare=e||o.defaultCompare}return Heap.prototype.leftChildIndex=function(e){return 2*e+1},Heap.prototype.rightChildIndex=function(e){return 2*e+2},Heap.prototype.parentIndex=function(e){return Math.floor((e-1)/2)},Heap.prototype.minIndex=function(e,i){return i>=this.data.length?e>=this.data.length?-1:e:this.compare(this.data[e],this.data[i])<=0?e:i},Heap.prototype.siftUp=function(e){for(var i=this.parentIndex(e);e>0&&this.compare(this.data[i],this.data[e])>0;)r.swap(this.data,i,e),e=i,i=this.parentIndex(e)},Heap.prototype.siftDown=function(e){for(var i=this.minIndex(this.leftChildIndex(e),this.rightChildIndex(e));i>=0&&this.compare(this.data[e],this.data[i])>0;)r.swap(this.data,i,e),e=i,i=this.minIndex(this.leftChildIndex(e),this.rightChildIndex(e))},Heap.prototype.peek=function(){return this.data.length>0?this.data[0]:void 0},Heap.prototype.add=function(e){return!o.isUndefined(e)&&(this.data.push(e),this.siftUp(this.data.length-1),!0)},Heap.prototype.removeRoot=function(){if(this.data.length>0){var e=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),e}},Heap.prototype.contains=function(e){var i=o.compareToEquals(this.compare);return r.contains(this.data,e,i)},Heap.prototype.size=function(){return this.data.length},Heap.prototype.isEmpty=function(){return this.data.length<=0},Heap.prototype.clear=function(){this.data.length=0},Heap.prototype.forEach=function(e){r.forEach(this.data,e)},Heap}();i.default=s},363:function(e,i,n){"use strict";var o,r=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},function(e,i){function __(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)});Object.defineProperty(i,"__esModule",{value:!0});var s=n(123),a=n(103),c=function(e){function FactoryDictionary(i,n){var o=e.call(this,n)||this;return o.defaultFactoryFunction=i,o}return r(FactoryDictionary,e),FactoryDictionary.prototype.setDefault=function(i,n){var o=e.prototype.getValue.call(this,i);return a.isUndefined(o)?(this.setValue(i,n),n):o},FactoryDictionary.prototype.getValue=function(e){return this.setDefault(e,this.defaultFactoryFunction())},FactoryDictionary}(s.default);i.default=c},364:function(e,i,n){"use strict";function _defineProperty(e,i,n){return i in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}n.d(i,"a",(function(){return _defineProperty}))},366:function(e,i,n){!function webpackUniversalModuleDefinition(i,n){e.exports=n()}("undefined"!=typeof self&&self,(function(){return function(e){var i={};function __webpack_require__(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}return __webpack_require__.m=e,__webpack_require__.c=i,__webpack_require__.d=function(e,i,n){__webpack_require__.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},__webpack_require__.n=function(e){var i=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(i,"a",i),i},__webpack_require__.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=3)}([function(e,i,n){var o=n(5),r=n(1),s=r.toHex,a=r.ceilHeapSize,c=n(6),padlen=function(e){for(e+=9;e%64>0;e+=1);return e},getRawDigest=function(e,i){var n=new Int32Array(e,i+320,5),o=new Int32Array(5),r=new DataView(o.buffer);return r.setInt32(0,n[0],!1),r.setInt32(4,n[1],!1),r.setInt32(8,n[2],!1),r.setInt32(12,n[3],!1),r.setInt32(16,n[4],!1),o},l=function(){function Rusha(e){if(function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,Rusha),(e=e||65536)%64>0)throw new Error("Chunk size must be a multiple of 128 bit");this._offset=0,this._maxChunkLen=e,this._padMaxChunkLen=padlen(e),this._heap=new ArrayBuffer(a(this._padMaxChunkLen+320+20)),this._h32=new Int32Array(this._heap),this._h8=new Int8Array(this._heap),this._core=new o({Int32Array:Int32Array},{},this._heap)}return Rusha.prototype._initState=function _initState(e,i){this._offset=0;var n=new Int32Array(e,i+320,5);n[0]=1732584193,n[1]=-271733879,n[2]=-1732584194,n[3]=271733878,n[4]=-1009589776},Rusha.prototype._padChunk=function _padChunk(e,i){var n=padlen(e),o=new Int32Array(this._heap,0,n>>2);return function(e,i){var n=new Uint8Array(e.buffer),o=i%4,r=i-o;switch(o){case 0:n[r+3]=0;case 1:n[r+2]=0;case 2:n[r+1]=0;case 3:n[r+0]=0}for(var s=1+(i>>2);s<e.length;s++)e[s]=0}(o,e),function(e,i,n){e[i>>2]|=128<<24-(i%4<<3),e[14+(2+(i>>2)&-16)]=n/(1<<29)|0,e[15+(2+(i>>2)&-16)]=n<<3}(o,e,i),n},Rusha.prototype._write=function _write(e,i,n,o){c(e,this._h8,this._h32,i,n,o||0)},Rusha.prototype._coreCall=function _coreCall(e,i,n,o,r){var s=n;this._write(e,i,n),r&&(s=this._padChunk(n,o)),this._core.hash(s,this._padMaxChunkLen)},Rusha.prototype.rawDigest=function rawDigest(e){var i=e.byteLength||e.length||e.size||0;this._initState(this._heap,this._padMaxChunkLen);var n=0,o=this._maxChunkLen;for(n=0;i>n+o;n+=o)this._coreCall(e,n,o,i,!1);return this._coreCall(e,n,i-n,i,!0),getRawDigest(this._heap,this._padMaxChunkLen)},Rusha.prototype.digest=function digest(e){return s(this.rawDigest(e).buffer)},Rusha.prototype.digestFromString=function digestFromString(e){return this.digest(e)},Rusha.prototype.digestFromBuffer=function digestFromBuffer(e){return this.digest(e)},Rusha.prototype.digestFromArrayBuffer=function digestFromArrayBuffer(e){return this.digest(e)},Rusha.prototype.resetState=function resetState(){return this._initState(this._heap,this._padMaxChunkLen),this},Rusha.prototype.append=function append(e){var i=0,n=e.byteLength||e.length||e.size||0,o=this._offset%this._maxChunkLen,r=void 0;for(this._offset+=n;i<n;)r=Math.min(n-i,this._maxChunkLen-o),this._write(e,i,r,o),i+=r,(o+=r)===this._maxChunkLen&&(this._core.hash(this._maxChunkLen,this._padMaxChunkLen),o=0);return this},Rusha.prototype.getState=function getState(){var e=void 0;if(this._offset%this._maxChunkLen)e=this._heap.slice(0);else{var i=new Int32Array(this._heap,this._padMaxChunkLen+320,5);e=i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength)}return{offset:this._offset,heap:e}},Rusha.prototype.setState=function setState(e){(this._offset=e.offset,20===e.heap.byteLength)?new Int32Array(this._heap,this._padMaxChunkLen+320,5).set(new Int32Array(e.heap)):this._h32.set(new Int32Array(e.heap));return this},Rusha.prototype.rawEnd=function rawEnd(){var e=this._offset,i=e%this._maxChunkLen,n=this._padChunk(i,e);this._core.hash(n,this._padMaxChunkLen);var o=getRawDigest(this._heap,this._padMaxChunkLen);return this._initState(this._heap,this._padMaxChunkLen),o},Rusha.prototype.end=function end(){return s(this.rawEnd().buffer)},Rusha}();e.exports=l,e.exports._core=o},function(e,i){for(var n=new Array(256),o=0;o<256;o++)n[o]=(o<16?"0":"")+o.toString(16);e.exports.toHex=function(e){for(var i=new Uint8Array(e),o=new Array(e.byteLength),r=0;r<o.length;r++)o[r]=n[i[r]];return o.join("")},e.exports.ceilHeapSize=function(e){var i=0;if(e<=65536)return 65536;if(e<16777216)for(i=1;i<e;i<<=1);else for(i=16777216;i<e;i+=16777216);return i},e.exports.isDedicatedWorkerScope=function(e){var i="WorkerGlobalScope"in e&&e instanceof e.WorkerGlobalScope,n="SharedWorkerGlobalScope"in e&&e instanceof e.SharedWorkerGlobalScope,o="ServiceWorkerGlobalScope"in e&&e instanceof e.ServiceWorkerGlobalScope;return i&&!n&&!o}},function(e,i,n){e.exports=function(){var e=n(0),hashFile=function(e,i,n,o,r){var s=new self.FileReader;s.onloadend=function onloadend(){if(s.error)return r(s.error);var a=s.result;i+=s.result.byteLength;try{e.append(a)}catch(e){return void r(e)}i<o.size?hashFile(e,i,n,o,r):r(null,e.end())},s.readAsArrayBuffer(o.slice(i,i+n))},i=!0;return self.onmessage=function(n){if(i){var o=n.data.data,r=n.data.file,s=n.data.id;if(void 0!==s&&(r||o)){var a=n.data.blockSize||4194304,c=new e(a);c.resetState();var done=function(e,i){e?self.postMessage({id:s,error:e.name}):self.postMessage({id:s,hash:i})};o&&function(e,i,n){try{n(null,e.digest(i))}catch(e){return n(e)}}(c,o,done),r&&hashFile(c,0,a,r,done)}}},function(){i=!1}}},function(e,i,n){var o=n(4),r=n(0),s=n(7),a=n(2),c=n(1).isDedicatedWorkerScope,l="undefined"!=typeof self&&c(self);r.disableWorkerBehaviour=l?a():function(){},r.createWorker=function(){var e=o(2),i=e.terminate;return e.terminate=function(){URL.revokeObjectURL(e.objectURL),i.call(e)},e},r.createHash=s,e.exports=r},function(e,i,n){function webpackBootstrapFunc(e){var i={};function __webpack_require__(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}__webpack_require__.m=e,__webpack_require__.c=i,__webpack_require__.i=function(e){return e},__webpack_require__.d=function(e,i,n){__webpack_require__.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},__webpack_require__.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.n=function(e){var i=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(i,"a",i),i},__webpack_require__.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},__webpack_require__.p="/",__webpack_require__.oe=function(e){throw console.error(e),e};var n=__webpack_require__(__webpack_require__.s=ENTRY_MODULE);return n.default||n}function quoteRegExp(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function getModuleDependencies(e,i,o){var r={};r[o]=[];var s=i.toString(),a=s.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!a)return r;for(var c,l=a[1],u=new RegExp("(\\\\n|\\W)"+quoteRegExp(l)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");c=u.exec(s);)"dll-reference"!==c[3]&&r[o].push(c[3]);for(u=new RegExp("\\("+quoteRegExp(l)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");c=u.exec(s);)e[c[2]]||(r[o].push(c[1]),e[c[2]]=n(c[1]).m),r[c[2]]=r[c[2]]||[],r[c[2]].push(c[4]);return r}function hasValuesInQueues(e){return Object.keys(e).reduce((function(i,n){return i||e[n].length>0}),!1)}e.exports=function(e,i){i=i||{};var o={main:n.m},r=i.all?{main:Object.keys(o)}:function getRequiredModules(e,i){for(var n={main:[i]},o={main:[]},r={main:{}};hasValuesInQueues(n);)for(var s=Object.keys(n),a=0;a<s.length;a++){var c=s[a],l=n[c].pop();if(r[c]=r[c]||{},!r[c][l]&&e[c][l]){r[c][l]=!0,o[c]=o[c]||[],o[c].push(l);for(var u=getModuleDependencies(e,e[c][l],c),h=Object.keys(u),d=0;d<h.length;d++)n[h[d]]=n[h[d]]||[],n[h[d]]=n[h[d]].concat(u[h[d]])}}return o}(o,e),s="";Object.keys(r).filter((function(e){return"main"!==e})).forEach((function(e){for(var i=0;r[e][i];)i++;r[e].push(i),o[e][i]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+r[e].map((function(i){return JSON.stringify(i)+": "+o[e][i].toString()})).join(",")+"});\n"})),s=s+"("+webpackBootstrapFunc.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+r.main.map((function(e){return JSON.stringify(e)+": "+o.main[e].toString()})).join(",")+"})(self);";var a=new window.Blob([s],{type:"text/javascript"});if(i.bare)return a;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a),l=new window.Worker(c);return l.objectURL=c,l}},function(e,i){e.exports=function RushaCore(e,i,n){"use asm";var o=new e.Int32Array(n);function hash$850(e,i){e=e|0;i=i|0;var n=0,r=0,s=0,a=0,c=0,l=0,u=0,h=0,d=0,p=0,f=0,g=0,m=0,y=0;s=o[i+320>>2]|0;c=o[i+324>>2]|0;u=o[i+328>>2]|0;d=o[i+332>>2]|0;f=o[i+336>>2]|0;for(n=0;(n|0)<(e|0);n=n+64|0){a=s;l=c;h=u;p=d;g=f;for(r=0;(r|0)<64;r=r+4|0){y=o[n+r>>2]|0;m=((s<<5|s>>>27)+(c&u|~c&d)|0)+((y+f|0)+1518500249|0)|0;f=d;d=u;u=c<<30|c>>>2;c=s;s=m;o[e+r>>2]=y}for(r=e+64|0;(r|0)<(e+80|0);r=r+4|0){y=(o[r-12>>2]^o[r-32>>2]^o[r-56>>2]^o[r-64>>2])<<1|(o[r-12>>2]^o[r-32>>2]^o[r-56>>2]^o[r-64>>2])>>>31;m=((s<<5|s>>>27)+(c&u|~c&d)|0)+((y+f|0)+1518500249|0)|0;f=d;d=u;u=c<<30|c>>>2;c=s;s=m;o[r>>2]=y}for(r=e+80|0;(r|0)<(e+160|0);r=r+4|0){y=(o[r-12>>2]^o[r-32>>2]^o[r-56>>2]^o[r-64>>2])<<1|(o[r-12>>2]^o[r-32>>2]^o[r-56>>2]^o[r-64>>2])>>>31;m=((s<<5|s>>>27)+(c^u^d)|0)+((y+f|0)+1859775393|0)|0;f=d;d=u;u=c<<30|c>>>2;c=s;s=m;o[r>>2]=y}for(r=e+160|0;(r|0)<(e+240|0);r=r+4|0){y=(o[r-12>>2]^o[r-32>>2]^o[r-56>>2]^o[r-64>>2])<<1|(o[r-12>>2]^o[r-32>>2]^o[r-56>>2]^o[r-64>>2])>>>31;m=((s<<5|s>>>27)+(c&u|c&d|u&d)|0)+((y+f|0)-1894007588|0)|0;f=d;d=u;u=c<<30|c>>>2;c=s;s=m;o[r>>2]=y}for(r=e+240|0;(r|0)<(e+320|0);r=r+4|0){y=(o[r-12>>2]^o[r-32>>2]^o[r-56>>2]^o[r-64>>2])<<1|(o[r-12>>2]^o[r-32>>2]^o[r-56>>2]^o[r-64>>2])>>>31;m=((s<<5|s>>>27)+(c^u^d)|0)+((y+f|0)-899497514|0)|0;f=d;d=u;u=c<<30|c>>>2;c=s;s=m;o[r>>2]=y}s=s+a|0;c=c+l|0;u=u+h|0;d=d+p|0;f=f+g|0}o[i+320>>2]=s;o[i+324>>2]=c;o[i+328>>2]=u;o[i+332>>2]=d;o[i+336>>2]=f}return{hash:hash$850}}},function(e,i){var n=this,o=void 0;"undefined"!=typeof self&&void 0!==self.FileReaderSync&&(o=new self.FileReaderSync);var convBuf=function(e,i,n,o,r,s){var a=void 0,c=s%4,l=(r+c)%4,u=r-l;switch(c){case 0:i[s]=e[o+3];case 1:i[s+1-(c<<1)|0]=e[o+2];case 2:i[s+2-(c<<1)|0]=e[o+1];case 3:i[s+3-(c<<1)|0]=e[o]}if(!(r<l+(4-c))){for(a=4-c;a<u;a=a+4|0)n[s+a>>2|0]=e[o+a]<<24|e[o+a+1]<<16|e[o+a+2]<<8|e[o+a+3];switch(l){case 3:i[s+u+1|0]=e[o+u+2];case 2:i[s+u+2|0]=e[o+u+1];case 1:i[s+u+3|0]=e[o+u]}}};e.exports=function(e,i,r,s,a,c){if("string"==typeof e)return function(e,i,n,o,r,s){var a=void 0,c=s%4,l=(r+c)%4,u=r-l;switch(c){case 0:i[s]=e.charCodeAt(o+3);case 1:i[s+1-(c<<1)|0]=e.charCodeAt(o+2);case 2:i[s+2-(c<<1)|0]=e.charCodeAt(o+1);case 3:i[s+3-(c<<1)|0]=e.charCodeAt(o)}if(!(r<l+(4-c))){for(a=4-c;a<u;a=a+4|0)n[s+a>>2]=e.charCodeAt(o+a)<<24|e.charCodeAt(o+a+1)<<16|e.charCodeAt(o+a+2)<<8|e.charCodeAt(o+a+3);switch(l){case 3:i[s+u+1|0]=e.charCodeAt(o+u+2);case 2:i[s+u+2|0]=e.charCodeAt(o+u+1);case 1:i[s+u+3|0]=e.charCodeAt(o+u)}}}(e,i,r,s,a,c);if(e instanceof Array)return convBuf(e,i,r,s,a,c);if(n&&n.Buffer&&n.Buffer.isBuffer(e))return convBuf(e,i,r,s,a,c);if(e instanceof ArrayBuffer)return convBuf(new Uint8Array(e),i,r,s,a,c);if(e.buffer instanceof ArrayBuffer)return convBuf(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i,r,s,a,c);if(e instanceof Blob)return function(e,i,n,r,s,a){var c=void 0,l=a%4,u=(s+l)%4,h=s-u,d=new Uint8Array(o.readAsArrayBuffer(e.slice(r,r+s)));switch(l){case 0:i[a]=d[3];case 1:i[a+1-(l<<1)|0]=d[2];case 2:i[a+2-(l<<1)|0]=d[1];case 3:i[a+3-(l<<1)|0]=d[0]}if(!(s<u+(4-l))){for(c=4-l;c<h;c=c+4|0)n[a+c>>2|0]=d[c]<<24|d[c+1]<<16|d[c+2]<<8|d[c+3];switch(u){case 3:i[a+h+1|0]=d[h+2];case 2:i[a+h+2|0]=d[h+1];case 1:i[a+h+3|0]=d[h]}}}(e,i,r,s,a,c);throw new Error("Unsupported data type.")}},function(e,i,n){var o=n(0),r=n(1).toHex,s=function(){function Hash(){!function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this,Hash),this._rusha=new o,this._rusha.resetState()}return Hash.prototype.update=function update(e){return this._rusha.append(e),this},Hash.prototype.digest=function digest(e){var digest=this._rusha.rawEnd().buffer;if(!e)return digest;if("hex"===e)return r(digest);throw new Error("unsupported digest encoding")},Hash}();e.exports=function(){return new s}}])}))},371:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(6),r=n(465),s=n(5),a=n(474),c=n(133),l=n(133),u=n(134),h=n(475);var d=s.op_gameconfig_01.Game,p=s.op_def.NodeType;class Capsule extends a.default{constructor(){super(),this._families=new Map,this._ignore_serialize=new Map,this.add=new r.default(this),this._root=new l.GameNode(this)}resetPreprocessedData(){this._families.clear(),this._ignore_serialize.clear()}get families(){return this._families}get ignoreList(){return this._ignore_serialize}serialize(){if(!this._root)throw new Error("Capsule::serialize() Error: Empty root node, aka GameNode.");const e=this._bin_conf=d.create();this._root.serialize(e),this.resetPreprocessedData(),this._objects.forEach(e=>{e.preSerialize()}),this._objects.forEach(i=>{this._ignore_serialize.get(i.id)||i.serialize(e)});return d.encode(this._bin_conf).finish()}serializeScene(e){if(!this._root)throw new Error("Capsule::serialize() Error: Empty root node, aka GameNode.");const i=this._bin_conf=d.create(),n=this._objects.get(e);if(n){const e=n.parent,o=n.name;i.node=new class{constructor(){this.LockParent=null,this.Parent=0,this.id=e,this.name=o,this.type=s.op_def.NodeType.GameNodeType}};const r=this.iterateGetObjects(n);this.resetPreprocessedData(),r.forEach(e=>{e.preSerialize()}),r.forEach(e=>{this._ignore_serialize.get(e.id)||e.serialize(i)})}return d.encode(this._bin_conf).finish()}serializeRoot(){if(!this._root)throw new Error("Capsule::serialize() Error: Empty root node, aka GameNode.");const e=this._bin_conf=d.create();this._root.serialize(e),this.resetPreprocessedData();const i=Array.from(this._objects.values()).filter(e=>e.type!==s.op_def.NodeType.SceneNodeType&&e.parent===this._root.id&&!this._ignore_serialize.get(e.id));this.iterateSerialize(i,e),this._terrain_objects.forEach(i=>{this._ignore_serialize.get(i.id)||i.serialize(e)}),this._element_objects.forEach(i=>{this._ignore_serialize.get(i.id)||i.serialize(e)});return d.encode(this._bin_conf).finish()}iterateSerialize(e,i){for(const n of e)n.serialize(i),n.children&&n.children.length>0&&this.iterateSerialize(n.children,i)}iterateGetObjects(e,i=[]){if(e&&(i.push(e),e.children&&e.children.length>0))for(const n of e.children)this.iterateGetObjects(n,i);return i}deserialize(e){const i=d.decode(e),n=d.toObject(i),o=[];this._root.deserialize(i),this._root.preDeserializePalettes(i);for(const e of Object.keys(n)){if("scenes"===e)continue;"terrain"===e&&this.doDeserialize(n[e]),"mossList"===e&&this.doDeserialize(n[e]);const i=n[e];if(Array.isArray(i))for(let e of i){e.node.type==p.ForkType?o.push(e):this.doDeserialize(e)}}for(const e of o)this.doDeserialize(e);this._objects.forEach(e=>{e.link()}),this._root.deserializePalettes(i)}doDeserialize(e){if(e.hasOwnProperty("node")){const i=e.node.type,n=u.default.NODE_T[i]||"";if(c.hasOwnProperty(n)){new c[n](this).deserialize(e)}}}get root(){return this._root}getObjectBySN(e){for(const i of this.objectsList)if(e===i.sn)return i}getAllChildrenIds(e){let i=[];const walkTree=e=>{if(e.children&&e.children.length>0)for(let n of e.children)i.push(n.id),walkTree(n)};return walkTree(e),i}deduplicateNodes(e){let i={};for(let n of e)n.ids=this.getAllChildrenIds(n),i[n.id]=n;for(let n of e)for(let e of n.ids)i[e]&&delete i[e];return Object.values(i)}emptyObjectCap(e){e.forEach(e=>{e.cap.families.clear(),e.children&&e.children.length>0&&this.emptyObjectCap(e.children)})}export(e){e=this.deduplicateNodes(e),this.emptyObjectCap(e);const i=new Capsule,travel=(e,n)=>{const r=o.clone(e);n&&(r.parent=n),i.addObject(r);for(const i of e.children)travel(i)};for(const n of e)travel(n,i.root.id);return i}importScene(e){for(const i of e.objectsList)i.parent===e.root.id&&(i.parent=this.root.id),i.cap=this,this.addObject(i)}import(e,i,n,o=!1){const r=new Capsule;r.deserialize(e.serialize());for(const e of r.objectsList)e.parent===r.root.id&&(e.parent=(n||this.root).id,e.renewId(i)),e.cap=this,this.addObject(e);return this.walkTopLevelNode(r.root.children,o)}walkTopLevelNode(e,i=!1){let n=[];for(const o of e)if(n.push(o.id),o.children&&o.children.length){if(!i)continue;this.walkTopLevelNode(o.children,i)}return n}clone(e,i,n=!1){const o=this.getObject(e);if(!o)return void console.error(`Origin object[${e}] does not exist.`);const r=new c[o.className](this);r.parentObject=i,r.duplicate(o),this.addObject(r);for(const e of o.children){if(e instanceof l.ForkNode&&!n)continue;const i=this.clone(e.id,r);i&&i.link()}return r}inspect(){const e=this,printTree=function(i){const n=e.getObject(i);if(!n)return;let o={};for(const e of n.children)o[`${e.className}[${e.id}]`]=printTree(e.id);return o},i={};i[`${e.root.className}[${e.root.id}]`]=printTree(e.root.id),console.log("Capsule"),console.log(h.asTree(i,!0,!0))}destroy(){this._objects.forEach((e,i)=>{e.type!==p.ElementNodeType&&e.type!==p.TerrainNodeType&&e.type!==p.CharacterNodeType||e.destroy()})}}i.default=Capsule},372:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(11),r=n(134),s=n(107);new o;i.default=class Metadata{constructor(e){this._id=s.default.genId(),this._parent=0,this._sn="",this._version="1",this._type=0,this._cap=e,this._name="Object-"+this.id}get type(){return this._type}set type(e){this._type=e}get cap(){return this._cap}set cap(e){this._cap=e}get metaData(){return{id:this._id,name:this._name,Parent:this._parent,sn:this._sn,type:this.type}}get className(){return s.default.getClassName(this)}get id(){return this._id}set id(e){this._id=e}get name(){return this._name}set name(e){this._name=e}get parent(){return this._parent}set parent(e){this._parent=e}get parentObject(){if(this.parent)return this.cap.getObject(this.parent)}set parentObject(e){e&&(this.parent=e.id)}get sn(){return this._sn}set sn(e){this._sn=e}get version(){return this._version}set version(e){this._version=e}get isMoss(){return this._is_moss}set isMoss(e){this._is_moss=e}get nodeType(){if(r.default.NODETYPEMAP[this.type])return this.type;throw new Error("This Config object does not match any of type list in NodeType!")}makeNode(){const e=this;return new class{constructor(){this.LockParent=null,this.Parent=e.parent,this.id=e.id,this.name=e.name,this.sn=e.sn,this.type=e.nodeType}}}setNode(e){e.hasOwnProperty("Parent")&&(this._parent=e.Parent),e.hasOwnProperty("id")&&(this._id=e.id),this._sn=e.sn||"",e.hasOwnProperty("name")&&(this._name=e.name)}destroy(){}}},373:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5),s=n(107);class DisplayNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._texturePath="",this._dataPath="",this.name="显示元件"}ignore(){super.ignore(),this.cap.ignoreList.set(this.id,this.id)}get properties(){return{texturePath:this._texturePath,dataPath:this._dataPath}}findMyContainer(e){return e.display||(e.display=[]),e.display}createProtocolObject(){const e=r.op_gameconfig_01.Display.create();return e.node=this.makeNode(),e.texturePath=this._texturePath,e.dataPath=this._dataPath,e}deserialize(e){super.deserialize(e);const i=e;this._dataPath=i.dataPath||"",this._texturePath=i.texturePath||""}get texturePath(){return this._texturePath}set texturePath(e){this._texturePath=e}get dataPath(){return this._dataPath}set dataPath(e){this._dataPath=e}set dataJSON(e){this._dataJSON=e}get dataJSON(){return this._dataJSON}set textureBuffer(e){this._textureBuffer=e}get textureBuffer(){return this._textureBuffer}geneSequence(){return s.default.sha1(this._dataPath+"&"+this._texturePath)}duplicate(e){super.duplicate(e),e instanceof DisplayNode&&(this._dataPath=e.dataPath,this._texturePath=e.texturePath)}}i.default=DisplayNode},374:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5),s=n(6);class AttributeNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._key="",this.name="自定义属性"}get key(){return this._key}set key(e){this._key=e}set basicTypeVal(e){"boolean"==typeof e&&(this._boolVal=e),"number"==typeof e&&(this._intVal=e),"string"==typeof e&&(this._strVal=e)}get basicTypeVal(){return s.isUndefined(this._boolVal)?this._boolVal:s.isUndefined(this._intVal)?this._intVal:s.isUndefined(this._strVal)?this._strVal:void 0}get intVal(){return this._intVal}set intVal(e){this._intVal=e}get strVal(){return this._strVal}set strVal(e){this._strVal=e}get boolVal(){return this._boolVal}set boolVal(e){this._boolVal=e}get media(){return this._media}set media(e){this._media=e}get title(){return this._title}set title(e){this._title=e}get description(){return this._description}set description(e){this._description=e}get properties(){return{key:this._key,intVal:this._intVal,strVal:this._strVal,boolVal:this._boolVal,media:this._media,description:this._description}}findMyContainer(e){return Array.isArray(e.attr)||(e.attr=[]),e.attr}createProtocolObject(){const e=r.op_gameconfig_01.Attribute.create();return e.node=this.makeNode(),e.key=this._key,e.intVal=this._intVal,e.strVal=this._strVal,e.boolVal=this._boolVal,e.media=this._media,e.description=this._description,e}deserialize(e){super.deserialize(e);const i=e;this._key=i.key,i.hasOwnProperty("intVal")&&"number"==typeof i.intVal?this._intVal=i.intVal:this._intVal=void 0,i.hasOwnProperty("strVal")&&"string"==typeof i.strVal?this._strVal=i.strVal:this._strVal=void 0,i.hasOwnProperty("boolVal")&&"boolean"==typeof i.boolVal?this._boolVal=i.boolVal:this._boolVal=void 0,i.hasOwnProperty("media")&&"string"==typeof i.media?this._media=i.media:this._media=void 0,this._description=i.description}geneSequence(){return""+this._key}duplicate(e){if(super.duplicate(e),e instanceof AttributeNode){this._key=e.key;const i=e.basicTypeVal;this.basicTypeVal=i;const n=e.media;n&&(this._media=n),e.description&&(this._description=e.description)}}}i.default=AttributeNode},375:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5),s=n(6);class AvatarNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._sets=[],this._parts={},this._dir=a.Front,this._animations=["idle","walk","sit","run","jump","attack"],this._curAnimationIndex=0,this._dbName="bones_human01",this._armatureName="Armature",this._dircy=!1,this.name="变装",this._backMap={},this._backMap.head_hair=["head_hair","head_back"],this._backMap.body_cost=["body_cost","body_dres"],this.defaultCostume()}merge(e){for(let i=0;i<e.length;i++)for(const n in this._backMap)if(this._backMap.hasOwnProperty(n)){const o=e[i].parts;for(const e of o)e===n&&(s.remove(this._sets,i=>e===n),this._parts=s.omit(this._parts,this._backMap[n]))}this._sets=this._sets.concat(e);for(const e of this._sets)for(const i of e.parts)this._parts[i]=e;this._dircy=!0}get parts(){return this._parts}resources(e){const i=[],n=this._parts;for(const o in n)if(n.hasOwnProperty(o)){let r=n[o];r.hasOwnProperty("localImages")||1===e&&"head_eyes"===o||1===e&&"head_mous"===o||("head_back"===o?i.push(this.relativeUri("head_hair",r.id,e,"back")):"body_dres"===o?i.push(this.relativeUri("body_cost",r.id,e,"dres")):i.push(this.relativeUri(o,r.id,e)))}return i}relativeUri(e,i,n,o){return o?`/avatar/part/${e}_${i}_${n}_${o}.png`:`/avatar/part/${e}_${i}_${n}.png`}findMyContainer(e){return Array.isArray(e.avatar)||(e.avatar=[]),e.avatar}createProtocolObject(){const e=r.op_gameconfig_01.Avatar.create();e.node=this.makeNode(),e.defaultDir=this._dir;const i=/[_]\w/;for(const n in this.parts){e[n.replace(i,e=>e.length>1?e[1].toUpperCase():e)+"Id"]=this.parts[n].id}return e}deserialize(e){super.deserialize(e);const i=e;this._dir=i.defaultDir,i.backboneId&&(this._parts.head_eyes={id:i.backboneId,parts:["head_eyes"]}),i.barmBaseId&&(this._parts.barm_base={id:i.barmBaseId,parts:["barm_base"]}),i.barmCostId&&(this._parts.barm_cost={id:i.barmCostId,parts:["barm_cost"]}),i.barmShldId&&(this._parts.barm_shld={id:i.barmShldId,parts:["barm_shld"]}),i.barmSpecId&&(this._parts.barm_spec={id:i.barmSpecId,parts:["barm_spec"]}),i.barmWeapId&&(this._parts.barm_weap={id:i.barmWeapId,parts:["barm_weap"]}),i.blegBaseId&&(this._parts.bleg_base={id:i.blegBaseId,parts:["bleg_base"]}),i.blegCostId&&(this._parts.bleg_cost={id:i.blegCostId,parts:["bleg_cost"]}),i.blegSpecId&&(this._parts.bleg_spec={id:i.blegSpecId,parts:["bleg_spec"]}),i.bodyBaseId&&(this._parts.body_base={id:i.bodyBaseId,parts:["body_base"]}),i.bodyCostId&&(this._parts.body_cost={id:i.bodyCostId,parts:["body_cost"]}),i.bodyDresId&&(this._parts.body_dres={id:i.bodyDresId,parts:["body_dres"]}),i.bodySpecId&&(this._parts.body_spec={id:i.bodySpecId,parts:["body_spec"]}),i.bodyTailId&&(this._parts.body_tail={id:i.bodyTailId,parts:["body_tail"]}),i.bodyWingId&&(this._parts.body_wing={id:i.bodyWingId,parts:["body_wing"]}),i.farmBaseId&&(this._parts.farm_base={id:i.farmBaseId,parts:["farm_base"]}),i.farmCostId&&(this._parts.farm_cost={id:i.farmCostId,parts:["farm_cost"]}),i.farmShldId&&(this._parts.farm_shld={id:i.farmShldId,parts:["farm_shld"]}),i.farmWeapId&&(this._parts.farm_weap={id:i.farmWeapId,parts:["farm_weap"]}),i.flegBaseId&&(this._parts.fleg_base={id:i.flegBaseId,parts:["fleg_base"]}),i.flegCostId&&(this._parts.fleg_cost={id:i.flegCostId,parts:["fleg_cost"]}),i.flegSpecId&&(this._parts.fleg_spec={id:i.flegSpecId,parts:["fleg_spec"]}),i.headBackId&&(this._parts.head_back={id:i.headBackId,parts:["head_back"]}),i.headBaseId&&(this._parts.head_base={id:i.headBaseId,parts:["head_base"]}),i.headEyesId&&(this._parts.head_eyes={id:i.headEyesId,parts:["head_eyes"]}),i.headHairId&&(this._parts.head_hair={id:i.headHairId,parts:["head_hair"]}),i.headHatsId&&(this._parts.head_hats={id:i.headHatsId,parts:["head_hats"]}),i.headMaskId&&(this._parts.head_mask={id:i.headMaskId,parts:["head_mask"]}),i.headMousId&&(this._parts.head_mous={id:i.headMousId,parts:["head_mous"]}),i.headSpecId&&(this._parts.head_spec={id:i.headSpecId,parts:["head_spec"]})}clearParts(){this._parts={},this._sets.length=0,this.defaultCostume(),this._dircy=!0}set dir(e){this._dir=e,this._dircy=!0}get dir(){return this._dir}set dirty(e){this._dircy=e}get dirty(){return this._dircy}set curAnimationIndex(e){(e<0||e>=this._animations.length)&&(e=0),this._curAnimationIndex=e,this._dircy=!0}get curAnimationIndex(){return this._curAnimationIndex}set armatureName(e){this._armatureName=e}get armatureName(){return this._armatureName}set dbName(e){this._dbName=e}get dbName(){return this._dbName}getCurAnimation(e){return`${this._animations[this._curAnimationIndex]}_${e||this._dir}`}defaultCostume(){this.merge([{id:"0001",parts:["head_base"]},{id:"5cd28238fb073710972a73c2",parts:["head_hair"]},{id:"5cd28238fb073710972a73c2",parts:["head_eyes"]},{id:"5cd28238fb073710972a73c2",parts:["head_mous"]},{id:"0001",parts:["body_base"]},{id:"5cd28238fb073710972a73c2",parts:["body_cost"]},{id:"0001",parts:["farm_base"]},{id:"0001",parts:["barm_base"]},{id:"0001",parts:["fleg_base"]},{id:"0001",parts:["bleg_base"]},{id:"0001",parts:["farm_base"]}])}}var a;i.default=AvatarNode,function(e){e[e.Back=1]="Back",e[e.Front=3]="Front"}(a=i.AvatarDirEnum||(i.AvatarDirEnum={}))},376:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);class AccessNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._access=1,this.name="权限"}get properties(){return{access:this._access}}findMyContainer(e){return Array.isArray(e.access)||(e.access=[]),e.access}createProtocolObject(){const e=r.op_gameconfig_01.Access.create();return e.node=this.makeNode(),e.access=this._access,e}deserialize(e){super.deserialize(e);const i=e;this._access=i.access}}i.AccessNode=AccessNode},377:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(6),s=n(5),a=n(107);class SceneNode extends o.EntityNode{constructor(e,i){super(e,i),this._elements=new Map,this._terrains=new Map,this._characters=new Map,this._spawnpoints=new Map,this._scenerys=new Map,this.name="场景"}get properties(){return{}}get size(){return this._map_size}get terrainCollection(){return this._terrain_collection}set terrainCollection(e){e&&(this._terrain_collection=e)}get mossCollection(){return this._moss_collection}set mossCollection(e){e&&(this._moss_collection=e)}convertOldTerrainData(){this._terrain_collection||(this._terrain_collection=new TerrainCollectionNode(this._cap,this),this._map_size&&this._terrain_collection.initTerrainCollection(this._map_size.rows,this._map_size.cols)),Array.from(this._terrains.values()).length>0&&this._terrain_collection.convertTerrainNodes(Array.from(this._terrains.values()))}converElementsToMoss(){this._moss_collection||(this._moss_collection=new MossCollectionNode(this._cap,this)),this._moss_collection.convertElementLikeMossInScene()}appendNode(e){try{super.appendNode(e)}catch(e){console.error(e)}switch(e.type){case s.op_def.NodeType.ElementNodeType:this._elements.set(e.id,e);break;case s.op_def.NodeType.TerrainNodeType:this._terrains.set(e.id,e);break;case s.op_def.NodeType.CharacterNodeType:this._characters.set(e.id,e);break;case s.op_def.NodeType.SpawnPointType:this._spawnpoints.set(e.id,e),!1==!!this._cap.root.settings.spawnpoint&&(this._cap.root.settings.spawnpoint=e.id);break;case s.op_def.NodeType.TerrainCollectionType:this._terrain_collection=e;break;case s.op_def.NodeType.MossCollectionType:this._moss_collection=e;break;case s.op_def.NodeType.SceneryType:this._scenerys.set(e.id,e)}e instanceof MapSizeNode&&(this._map_size=e)}removeNode(e){try{super.removeNode(e)}catch(e){console.error(e)}switch(e instanceof MapSizeNode&&(this._map_size=void 0),e.type){case s.op_def.NodeType.ElementNodeType:this._elements.delete(e.id);break;case s.op_def.NodeType.TerrainNodeType:this._terrains.delete(e.id);break;case s.op_def.NodeType.CharacterNodeType:this._characters.delete(e.id);break;case s.op_def.NodeType.SpawnPointType:this._spawnpoints.delete(e.id),this._cap.root.settings.spawnpoint===e.id&&(this._cap.root.settings.spawnpoint=0)}}getElements(){return Array.from(this._elements.values())}getTerrains(){return Array.from(this._terrains.values())}getCharacterNode(){return Array.from(this._characters.values())}getSpawnPointNode(){return Array.from(this._spawnpoints.values())}getScenerys(){return Array.from(this._scenerys.values())}serialize(e){super.serialize(e),this._terrain_collection&&this._terrain_collection.serialize(e),this._moss_collection&&this._moss_collection.serialize(e)}}i.default=SceneNode;class MapSizeNode extends o.BaseConfigObject{constructor(){super(...arguments),this._cols=0,this._rows=0,this._tileWidth=60,this._tileHeight=30}get properties(){return{cols:this._cols,rows:this._rows,tileWidth:this._tileWidth,tileHeight:this._tileHeight}}get rows(){return this._rows}set rows(e){this._rows=e}get cols(){return this._cols}set cols(e){this._cols=e}get tileWidth(){return this._tileWidth}set tileWidth(e){this._tileWidth=e}get tileHeight(){return this._tileHeight}set tileHeight(e){this._tileHeight=e}findMyContainer(e){return Array.isArray(e.mapSize)||(e.mapSize=[]),e.mapSize}createProtocolObject(){const e=s.op_gameconfig_01.MapSize.create();return e.node=this.makeNode(),e.cols=this._cols,e.rows=this._rows,e.tileWidth=this._tileWidth,e.tileHeight=this._tileHeight,e}deserialize(e){super.deserialize(e);const i=e;this._rows=i.rows,this._cols=i.cols,this._tileWidth=i.tileWidth,this._tileHeight=i.tileHeight}}i.MapSizeNode=MapSizeNode;class TerrainCollectionNode extends o.BaseConfigObject{constructor(){super(...arguments),this._data=[]}get data(){return this._data}initTerrainCollection(e,i){this._data=[];for(let n=0;n<i;n++){let i=new Array(e).fill(0);this._data.push(i)}}convertTerrainNodes(e){if(e.length>0)for(const i of e){const e=i.getSnKey(),n=this.cap.root.palette.getPaletteKeyBySn(e),o=i.convertToSprite();if(n?i.destroy():this.cap.root.palette.addToPalette(i),o.point3f){const{x:i,y:n,z:r}=o.point3f,s=this.cap.root.palette.getPaletteKeyBySn(e);this._data.length>i&&this._data[i].length>n&&(this._data[i][n]=s)}}}adjustTerrainsArray(){if(this.parentObject.size){const{rows:e,cols:i}=this.parentObject.size;let n=[];for(let o=0;o<i;o++){let i=new Array(e).fill(0);if(this._data[o]){for(let n=0;n<e;n++)this._data[o][n]&&(i[n]=this._data[o][n]);n.push(i)}else n.push(i)}this._data=n}}drawTerrains(e,i){for(const n of e){const{x:e,y:o,z:r}=n;this._data[e][o]=i}}eraseTerrains(e){for(const i of e){const{x:e,y:n}=i;e<0||n<0||this._data[e]&&this._data[e][n]&&(this._data[e][n]=0)}}createProtocolObject(){const e=s.op_gameconfig_01.TerrainCollection.create();e.node=this.makeNode(),e.data=s.op_def.IntArrays.create();for(let i=0;i<this._data.length;i++){const n=this._data[i];let o=s.op_def.IntArray.create();for(let e=0;e<n.length;e++)o.value.push(n[e]);e.data.value&&e.data.value.push(o)}return e}serialize(e){e.terrain=this.createProtocolObject()}deserialize(e){super.deserialize(e);const i=e;if(i.data.value)for(let e=0;e<i.data.value.length;e++){const n=i.data.value[e];n.value&&this._data.push(n.value)}}}i.TerrainCollectionNode=TerrainCollectionNode;class MossCollectionNode extends o.BaseConfigObject{constructor(){super(...arguments),this._data=[],this._data_map=new Map}get data(){return this._data}get dataMap(){return this._data_map}placeMosses(e){for(const i of e)this._data_map.get(i.id)||this._data_map.set(i.id,i)}updateMosses(e){for(const i of e)this._data_map.get(i.id)&&this._data_map.set(i.id,i)}removeMosses(e){for(const i of e)this._data_map.delete(i)}getMoss(e){return this._data_map.get(e)}convertElementLikeMossInScene(){const e=this._cap.getChildrenList(this.parent),i=e.filter(e=>e.type===s.op_def.NodeType.ElementNodeType&&e.judgeIsMoss()).map(e=>(e.elementSn=`${e.sn}#${e.version}`,e)),n=r.groupBy(i,"elementSn");let o=[];for(const e of Object.keys(n)){const i=n[e],r=i.find(e=>!e.isFork);r?o.push(r):o.push(i.pop())}for(const e of o)e.unlink(),e.parent=0,this._cap.root.moss.addToPalette(e),this._cap.removeObjectById(e.id);const c=o.map(e=>e.id);for(const i of e)if(i.type===s.op_def.NodeType.ElementNodeType&&i.judgeIsMoss()){const[e,n]=i.getSnAndVersion(),o=a.default.getElementSn(e,n);let r=this._cap.root.moss.getPaletteKeyBySn(o);if(!r)continue;const s={key:r,x:i.location.x,y:i.location.y,z:i.location.z,dir:i.animations.dir,id:i.id};this._data_map.set(i.id,s),c.indexOf(i.id)<0&&i.destroy()}}createProtocolObject(){const e=s.op_gameconfig_01.MossCollection.create();e.node=this.makeNode(),e.data=s.op_def.LocationMap.create();for(const i of Array.from(this._data_map.keys())){const n=this._data_map.get(i),o=s.op_def.MossMetaData.create(n);e.data.locations&&e.data.locations.push(o)}return e}serialize(e){e.mossList=this.createProtocolObject()}deserialize(e){super.deserialize(e);const i=e;i.data.locations&&i.data.locations.forEach(e=>{const i=s.op_def.MossMetaData.create(e);this._data.push(i),this._data_map.set(i.id,i)})}}i.MossCollectionNode=MossCollectionNode},378:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5),s=n(375);class CharacterNode extends o.EntityNode{constructor(e,i){super(e,i),this.name="游戏角色"}get camp(){return this._camp||this.cap.add.camp(1,this)}appendNode(e){try{super.appendNode(e)}catch(e){console.error(e)}e instanceof CampNode&&(this._camp=e),e instanceof s.default&&(this._avatar=e)}removeNode(e){try{super.removeNode(e)}catch(e){console.error(e)}e instanceof CampNode&&(this._camp=void 0),e instanceof s.default&&(this._avatar=void 0)}}i.default=CharacterNode;class CampNode extends o.BaseConfigObject{get properties(){return{maxNumber:this._maxNumber}}get maxPlayers(){return this._maxNumber||0}set maxPlayers(e){this._maxNumber=e}findMyContainer(e){return Array.isArray(e.camp)||(e.camp=[]),e.camp}createProtocolObject(){const e=r.op_gameconfig_01.Camp.create();return e.node=this.makeNode(),e.maxNumber=this._maxNumber||0,e}deserialize(e){super.deserialize(e);const i=e;i.maxNumber&&(this._maxNumber=i.maxNumber)}}i.CampNode=CampNode},379:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);var s=r.op_def.NodeType;const a=n(206);class ShopNode extends o.EntityNode{constructor(e,i){super(e,i),this._items=[],this.name="内购商城"}ignore(){}appendNode(e){try{super.appendNode(e)}catch(e){}e.type===s.PackageItemType&&this._items.push(e)}}i.default=ShopNode;class ShopItemNode extends a.PackageItemNode{constructor(e,i){super(e,i),this.name="内购道具",this.type=r.op_def.NodeType.PackageItemType}appendNode(e){try{super.appendNode(e)}catch(i){e.type===s.CommodityType&&(this._commodity=e)}}}i.ShopItemNode=ShopItemNode;class CommodityNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._price=100,this._des="",this._coinType=r.op_def.CoinType.TU_DING_COIN,this.name="售价"}get properties(){return{price:this.price,description:this.description}}findMyContainer(e){return e.commodities||(e.commodities=[]),e.commodities}createProtocolObject(){const e=r.op_gameconfig_01.Commodity.create();return e.node=this.makeNode(),e.description=this._des,e.coinType=this._coinType,e.price=this._price,e}deserialize(e){super.deserialize(e);const i=e;this._price=i.price||100,this._des=i.description||"",this._coinType=i.coinType||r.op_def.CoinType.TU_DING_COIN}set price(e){if(this.coinType===r.op_def.CoinType.TU_DING_COIN&&(e<10||e>99999))throw new Error("图钉有效价格在10-99999");this._price=e}get price(){return this._price}set description(e){this._des=e}get description(){return this._des}get coinType(){return this._coinType}}i.CommodityNode=CommodityNode},380:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);class SceneryNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._uris=[],this._depth=1,this._fit=1,this.name="天空盒",this.offset=r.op_def.PBPoint2f.create(),this.offset.x=0,this.offset.y=0}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get uris(){return this._uris}set uris(e){this._uris=e}get depth(){return this._depth}set depth(e){this._depth=e}get offset(){return this._offset}set offset(e){this._offset=e}get speed(){return this._speed}set speed(e){this._speed=e}get fit(){return this._fit}set fit(e){this._fit=e}get properties(){return{uris:this.uris,depth:this.depth,offset:this.offset,speed:this.speed,fit:this.fit,width:this.width,height:this.height}}findMyContainer(e){return Array.isArray(e.seneries)||(e.seneries=[]),e.seneries}createProtocolObject(){const e=r.op_gameconfig_01.Scenery.create();e.node=this.makeNode();const i=r.op_def.StrArrays.create();for(const e of this.uris){const n=r.op_def.StrArray.create();for(const i of e)n.value.push(i);i.value.push(n)}if(e.uris=i,e.depth=this.depth,this.offset){const i=r.op_def.PBPoint2f.create();i.x=this.offset.x,i.y=this.offset.y,e.offset=i}return e.speed=this.speed,e.fit=this.fit,e.width=this.width,e.height=this.height,e}deserialize(e){super.deserialize(e);const i=e;if(i.uris.value)for(const e of i.uris.value){let i=[];if(e.value){for(const n of e.value)i.push(n);this.uris.push(i)}}this.depth=i.depth,i.offset?(this.offset=r.op_def.PBPoint2f.create(),this.offset.x=i.offset.x,this.offset.y=i.offset.y):(this.offset=r.op_def.PBPoint2f.create(),this.offset.x=0,this.offset.y=0),this.speed=i.speed,this.fit=i.fit,i.width&&(this.width=i.width),i.height&&(this.height=i.height)}}i.default=SceneryNode},442:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(443),r=function(){function PacketHandler(){this.mOnReceivedFunDict=new o.Dictionary}return PacketHandler.prototype.onPacketArrived=function(e){var i=this.mOnReceivedFunDict.getValue(e.opcode);if(i)try{return i.call(this,e),console.info("Finish handle OPCODE: 0x"+e.opcode.toString(16)+" / "+e.opcode.toString()),!0}catch(e){console.error(e)}return!1},PacketHandler.prototype.addHandlerFun=function(e,i){this.mOnReceivedFunDict.setValue(e,i)},PacketHandler}();i.PacketHandler=r},443:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(132);i.arrays=o;var r=n(444);i.Bag=r.default;var s=n(445);i.BSTree=s.default;var a=n(360);i.BSTreeKV=a.default;var c=n(123);i.Dictionary=c.default;var l=n(362);i.Heap=l.default;var u=n(446);i.LinkedDictionary=u.default;var h=n(188);i.LinkedList=h.default;var d=n(447);i.MultiDictionary=d.default;var p=n(363);i.FactoryDictionary=p.default;var f=n(363);i.DefaultDictionary=f.default;var g=n(361);i.Queue=g.default;var m=n(448);i.PriorityQueue=m.default;var y=n(359);i.Set=y.default;var v=n(449);i.Stack=v.default;var b=n(450);i.MultiRootTree=b.default;var N=n(103);i.util=N},444:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103),r=n(123),s=n(359),a=function(){function Bag(e){this.toStrF=e||o.defaultToString,this.dictionary=new r.default(this.toStrF),this.nElements=0}return Bag.prototype.add=function(e,i){if(void 0===i&&(i=1),o.isUndefined(e)||i<=0)return!1;if(this.contains(e))this.dictionary.getValue(e).copies+=i;else{var n={value:e,copies:i};this.dictionary.setValue(e,n)}return this.nElements+=i,!0},Bag.prototype.count=function(e){return this.contains(e)?this.dictionary.getValue(e).copies:0},Bag.prototype.contains=function(e){return this.dictionary.containsKey(e)},Bag.prototype.remove=function(e,i){if(void 0===i&&(i=1),o.isUndefined(e)||i<=0)return!1;if(this.contains(e)){var n=this.dictionary.getValue(e);return i>n.copies?this.nElements-=n.copies:this.nElements-=i,n.copies-=i,n.copies<=0&&this.dictionary.remove(e),!0}return!1},Bag.prototype.toArray=function(){for(var e=[],i=0,n=this.dictionary.values();i<n.length;i++)for(var o=n[i],r=o.value,s=o.copies,a=0;a<s;a++)e.push(r);return e},Bag.prototype.toSet=function(){for(var e=new s.default(this.toStrF),i=0,n=this.dictionary.values();i<n.length;i++){var o=n[i].value;e.add(o)}return e},Bag.prototype.forEach=function(e){this.dictionary.forEach((function(i,n){for(var o=n.value,r=n.copies,s=0;s<r;s++)if(!1===e(o))return!1;return!0}))},Bag.prototype.size=function(){return this.nElements},Bag.prototype.isEmpty=function(){return 0===this.nElements},Bag.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},Bag}();i.default=a},445:function(e,i,n){"use strict";var o,r=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},function(e,i){function __(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)});Object.defineProperty(i,"__esModule",{value:!0});var s=function(e){function BSTree(){return null!==e&&e.apply(this,arguments)||this}return r(BSTree,e),BSTree}(n(360).default);i.default=s},446:function(e,i,n){"use strict";var o,r=this&&this.__extends||(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},function(e,i){function __(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)});Object.defineProperty(i,"__esModule",{value:!0});var s=n(123),a=n(103),c=function(){function LinkedDictionaryPair(e,i){this.key=e,this.value=i}return LinkedDictionaryPair.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},LinkedDictionaryPair}(),l=function(){function HeadOrTailLinkedDictionaryPair(){this.key=null,this.value=null}return HeadOrTailLinkedDictionaryPair.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},HeadOrTailLinkedDictionaryPair}();var u=function(e){function LinkedDictionary(i){var n=e.call(this,i)||this;return n.head=new l,n.tail=new l,n.head.next=n.tail,n.tail.prev=n.head,n}return r(LinkedDictionary,e),LinkedDictionary.prototype.appendToTail=function(e){var i=this.tail.prev;i.next=e,e.prev=i,e.next=this.tail,this.tail.prev=e},LinkedDictionary.prototype.getLinkedDictionaryPair=function(e){if(!a.isUndefined(e)){var i="$"+this.toStr(e);return this.table[i]}},LinkedDictionary.prototype.getValue=function(e){var i=this.getLinkedDictionaryPair(e);if(!a.isUndefined(i))return i.value},LinkedDictionary.prototype.remove=function(i){var n=this.getLinkedDictionaryPair(i);if(!a.isUndefined(n))return e.prototype.remove.call(this,i),n.unlink(),n.value},LinkedDictionary.prototype.clear=function(){e.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},LinkedDictionary.prototype.replace=function(e,i){var n="$"+this.toStr(i.key);i.next=e.next,i.prev=e.prev,this.remove(e.key),i.prev.next=i,i.next.prev=i,this.table[n]=i,++this.nElements},LinkedDictionary.prototype.setValue=function(e,i){if(!a.isUndefined(e)&&!a.isUndefined(i)){var n=this.getLinkedDictionaryPair(e),o=new c(e,i),r="$"+this.toStr(e);return a.isUndefined(n)?(this.appendToTail(o),this.table[r]=o,void++this.nElements):(this.replace(n,o),n.value)}},LinkedDictionary.prototype.keys=function(){var e=[];return this.forEach((function(i,n){e.push(i)})),e},LinkedDictionary.prototype.values=function(){var e=[];return this.forEach((function(i,n){e.push(n)})),e},LinkedDictionary.prototype.forEach=function(e){for(var i=this.head.next;i.next;){if(!1===e(i.key,i.value))return;i=i.next}},LinkedDictionary}(s.default);i.default=u},447:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103),r=n(123),s=n(132),a=function(){function MultiDictionary(e,i,n){void 0===n&&(n=!1),this.dict=new r.default(e),this.equalsF=i||o.defaultEquals,this.allowDuplicate=n}return MultiDictionary.prototype.getValue=function(e){var i=this.dict.getValue(e);return o.isUndefined(i)?[]:s.copy(i)},MultiDictionary.prototype.setValue=function(e,i){if(o.isUndefined(e)||o.isUndefined(i))return!1;var n=this.dict.getValue(e);return o.isUndefined(n)?(this.dict.setValue(e,[i]),!0):!(!this.allowDuplicate&&s.contains(n,i,this.equalsF))&&(n.push(i),!0)},MultiDictionary.prototype.remove=function(e,i){if(o.isUndefined(i)){var n=this.dict.remove(e);return!o.isUndefined(n)}var r=this.dict.getValue(e);return!(o.isUndefined(r)||!s.remove(r,i,this.equalsF))&&(0===r.length&&this.dict.remove(e),!0)},MultiDictionary.prototype.keys=function(){return this.dict.keys()},MultiDictionary.prototype.values=function(){for(var e=[],i=0,n=this.dict.values();i<n.length;i++)for(var o=0,r=n[i];o<r.length;o++){var s=r[o];e.push(s)}return e},MultiDictionary.prototype.containsKey=function(e){return this.dict.containsKey(e)},MultiDictionary.prototype.clear=function(){this.dict.clear()},MultiDictionary.prototype.size=function(){return this.dict.size()},MultiDictionary.prototype.isEmpty=function(){return this.dict.isEmpty()},MultiDictionary}();i.default=a},448:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(103),r=n(362),s=function(){function PriorityQueue(e){this.heap=new r.default(o.reverseCompareFunction(e))}return PriorityQueue.prototype.enqueue=function(e){return this.heap.add(e)},PriorityQueue.prototype.add=function(e){return this.heap.add(e)},PriorityQueue.prototype.dequeue=function(){if(0!==this.heap.size()){var e=this.heap.peek();return this.heap.removeRoot(),e}},PriorityQueue.prototype.peek=function(){return this.heap.peek()},PriorityQueue.prototype.contains=function(e){return this.heap.contains(e)},PriorityQueue.prototype.isEmpty=function(){return this.heap.isEmpty()},PriorityQueue.prototype.size=function(){return this.heap.size()},PriorityQueue.prototype.clear=function(){this.heap.clear()},PriorityQueue.prototype.forEach=function(e){this.heap.forEach(e)},PriorityQueue}();i.default=s},449:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(188),r=function(){function Stack(){this.list=new o.default}return Stack.prototype.push=function(e){return this.list.add(e,0)},Stack.prototype.add=function(e){return this.list.add(e,0)},Stack.prototype.pop=function(){return this.list.removeElementAtIndex(0)},Stack.prototype.peek=function(){return this.list.first()},Stack.prototype.size=function(){return this.list.size()},Stack.prototype.contains=function(e,i){return this.list.contains(e,i)},Stack.prototype.isEmpty=function(){return this.list.isEmpty()},Stack.prototype.clear=function(){this.list.clear()},Stack.prototype.forEach=function(e){this.list.forEach(e)},Stack}();i.default=r},450:function(e,i,n){"use strict";var o;Object.defineProperty(i,"__esModule",{value:!0}),function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER",e[e.INSIDE_AT_END=2]="INSIDE_AT_END",e[e.INSIDE_AT_START=3]="INSIDE_AT_START"}(o||(o={}));var r=function(){function MultiRootTree(e,i){void 0===e&&(e=[]),void 0===i&&(i={}),this.rootIds=e,this.nodes=i,this.initRootIds(),this.initNodes()}return MultiRootTree.prototype.initRootIds=function(){for(var e=0,i=this.rootIds;e<i.length;e++){var n=i[e];this.createEmptyNodeIfNotExist(n)}},MultiRootTree.prototype.initNodes=function(){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e))for(var i=0,n=this.nodes[e];i<n.length;i++){var o=n[i];this.createEmptyNodeIfNotExist(o)}},MultiRootTree.prototype.createEmptyNodeIfNotExist=function(e){this.nodes[e]||(this.nodes[e]=[])},MultiRootTree.prototype.getRootIds=function(){return this.rootIds.slice()},MultiRootTree.prototype.getNodes=function(){var e={};for(var i in this.nodes)this.nodes.hasOwnProperty(i)&&(e[i]=this.nodes[i].slice());return e},MultiRootTree.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},MultiRootTree.prototype.toObject=function(){return this.getObject()},MultiRootTree.prototype.flatten=function(){for(var e=this,i=[],n=0;n<this.rootIds.length;n++){var o=this.rootIds[n];i.push({id:o,level:0,hasParent:!1,childrenCount:0}),traverse(o,this.nodes,i,0)}for(var r=0,s=i;r<s.length;r++){var a=s[r];a.childrenCount=countChildren(a.id)}return i;function countChildren(i){return e.nodes[i]?e.nodes[i].length:0}function traverse(e,i,n,o){if(void 0===o&&(o=0),e&&i&&n&&i[e]){o++;for(var r=i[e],s=0;s<r.length;s++){var a=r[s];n.push({id:a,level:o,hasParent:!0}),traverse(a,i,n,o)}o--}}},MultiRootTree.prototype.moveIdBeforeId=function(e,i){return this.moveId(e,i,o.BEFORE)},MultiRootTree.prototype.moveIdAfterId=function(e,i){return this.moveId(e,i,o.AFTER)},MultiRootTree.prototype.moveIdIntoId=function(e,i,n){return void 0===n&&(n=!0),n?this.moveId(e,i,o.INSIDE_AT_START):this.moveId(e,i,o.INSIDE_AT_END)},MultiRootTree.prototype.swapRootIdWithRootId=function(e,i){var n=this.findRootId(e),o=this.findRootId(i);this.swapRootPositionWithRootPosition(n,o)},MultiRootTree.prototype.swapRootPositionWithRootPosition=function(e,i){var n=this.rootIds[i];this.rootIds[i]=this.rootIds[e],this.rootIds[e]=n},MultiRootTree.prototype.deleteId=function(e){this.rootDeleteId(e),this.nodeAndSubNodesDelete(e),this.nodeRefrencesDelete(e)},MultiRootTree.prototype.insertIdBeforeId=function(e,i){var n=this.findRootId(e);for(var o in n>-1&&this.insertIdIntoRoot(i,n),this.nodes)if(this.nodes.hasOwnProperty(o)){var r=this.findNodeId(o,e);r>-1&&this.insertIdIntoNode(o,i,r)}},MultiRootTree.prototype.insertIdAfterId=function(e,i){var n=this.findRootId(e);for(var o in n>-1&&this.insertIdIntoRoot(i,n+1),this.nodes)if(this.nodes.hasOwnProperty(o)){var r=this.findNodeId(o,e);r>-1&&this.insertIdIntoNode(o,i,r+1)}},MultiRootTree.prototype.insertIdIntoId=function(e,i){this.nodeInsertAtEnd(e,i),this.nodes[i]=[]},MultiRootTree.prototype.insertIdIntoRoot=function(e,i){if(void 0===i)this.rootInsertAtEnd(e);else if(i<0){var n=this.rootIds.length;this.rootIds.splice(i+n+1,0,e)}else this.rootIds.splice(i,0,e);this.nodes[e]=this.nodes[e]||[]},MultiRootTree.prototype.insertIdIntoNode=function(e,i,n){if(this.nodes[e]=this.nodes[e]||[],this.nodes[i]=this.nodes[i]||[],void 0===n)this.nodeInsertAtEnd(e,i);else if(n<0){var o=this.nodes[e].length;this.nodes[e].splice(n+o+1,0,i)}else this.nodes[e].splice(n,0,i)},MultiRootTree.prototype.moveId=function(e,i,n){var r=e,s=this.findRootId(r);for(var a in this.nodes[i]&&i,this.nodes)if(this.nodes.hasOwnProperty(a)){this.findNodeId(a,i);break}var c=i,l=this.findRootId(c);for(var a in this.nodes[i]&&i,this.nodes)if(this.nodes.hasOwnProperty(a)){this.findNodeId(a,i);break}if(s>-1)if(l>-1)switch(this.rootDelete(s),l>s&&l--,n){case o.BEFORE:this.insertIdIntoRoot(r,l);break;case o.AFTER:this.insertIdIntoRoot(r,l+1);break;case o.INSIDE_AT_START:this.nodeInsertAtStart(c,r);break;case o.INSIDE_AT_END:this.nodeInsertAtEnd(c,r)}else for(var a in this.rootDelete(s),this.nodes){if(this.nodes.hasOwnProperty(a))if((u=this.findNodeId(a,c))>-1){switch(n){case o.BEFORE:this.insertIdIntoNode(a,r,u);break;case o.AFTER:this.insertIdIntoNode(a,r,u+1);break;case o.INSIDE_AT_START:this.nodeInsertAtStart(c,r);break;case o.INSIDE_AT_END:this.nodeInsertAtEnd(c,r)}break}}else if(l>-1){for(var a in this.nodes){if(this.nodes.hasOwnProperty(a))if((u=this.findNodeId(a,r))>-1){this.nodeDeleteAtIndex(a,u);break}}switch(n){case o.BEFORE:this.insertIdIntoRoot(r,l);break;case o.AFTER:this.insertIdIntoRoot(r,l+1);break;case o.INSIDE_AT_START:this.nodeInsertAtStart(c,r);break;case o.INSIDE_AT_END:this.nodeInsertAtEnd(c,r)}}else{for(var a in this.nodes){if(this.nodes.hasOwnProperty(a))if((u=this.findNodeId(a,r))>-1){this.nodeDeleteAtIndex(a,u);break}}for(var a in this.nodes){var u;if(this.nodes.hasOwnProperty(a))if((u=this.findNodeId(a,c))>-1){switch(n){case o.BEFORE:this.insertIdIntoNode(a,r,u);break;case o.AFTER:this.insertIdIntoNode(a,r,u+1);break;case o.INSIDE_AT_START:this.nodeInsertAtStart(c,r);break;case o.INSIDE_AT_END:this.nodeInsertAtEnd(c,r)}break}}}},MultiRootTree.prototype.swapArrayElements=function(e,i,n){var o=e[i];return e[i]=e[n],e[n]=o,e},MultiRootTree.prototype.rootDeleteId=function(e){var i=this.findRootId(e);i>-1&&this.rootDelete(i)},MultiRootTree.prototype.nodeAndSubNodesDelete=function(e){for(var i=[],n=0;n<this.nodes[e].length;n++){var o=this.nodes[e][n];this.nodeAndSubNodesDelete(o),i.push(e)}this.nodeDelete(e);for(n=0;n<i.length;n++)this.nodeDelete(i[n])},MultiRootTree.prototype.nodeRefrencesDelete=function(e){for(var i in this.nodes)if(this.nodes.hasOwnProperty(i))for(var n=0;n<this.nodes[i].length;n++){this.nodes[i][n]===e&&this.nodeDeleteAtIndex(i,n)}},MultiRootTree.prototype.nodeDelete=function(e){delete this.nodes[e]},MultiRootTree.prototype.findRootId=function(e){return this.rootIds.indexOf(e)},MultiRootTree.prototype.findNodeId=function(e,i){return this.nodes[e].indexOf(i)},MultiRootTree.prototype.findNode=function(e){return this.nodes[e]},MultiRootTree.prototype.nodeInsertAtStart=function(e,i){this.nodes[e].unshift(i)},MultiRootTree.prototype.nodeInsertAtEnd=function(e,i){this.nodes[e].push(i)},MultiRootTree.prototype.rootDelete=function(e){this.rootIds.splice(e,1)},MultiRootTree.prototype.nodeDeleteAtIndex=function(e,i){this.nodes[e].splice(i,1)},MultiRootTree.prototype.rootInsertAtStart=function(e){this.rootIds.unshift(e)},MultiRootTree.prototype.rootInsertAtEnd=function(e){this.rootIds.push(e)},MultiRootTree}();i.default=r},451:function(e,i,n){"use strict";var o,r=this&&this.__extends||(o=function(e,i){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])})(e,i)},function(e,i){function __(){this.constructor=e}o(e,i),e.prototype=null===i?Object.create(i):(__.prototype=i.prototype,new __)});Object.defineProperty(i,"__esModule",{value:!0});var s=n(25),a=[],c=new String("S").charCodeAt(0),l=new String("D").charCodeAt(0),u=(new String("C").charCodeAt(0),c<<8|l),h=function(){function PacketHeader(e,i){this._head_len=18,this._len=0,this._buf=s.Buffer.alloc(0),this._offset=0,this._opcode=0,this._param=0,this._magic=u,this._uuid=0,"number"==typeof e&&(this._opcode=e),"number"==typeof i&&(this._param=i)}return Object.defineProperty(PacketHeader.prototype,"length",{get:function(){return this._buf.length},enumerable:!0,configurable:!0}),Object.defineProperty(PacketHeader.prototype,"opcode",{get:function(){return this._opcode},set:function(e){this._opcode=e},enumerable:!0,configurable:!0}),Object.defineProperty(PacketHeader.prototype,"param",{get:function(){return this._param},set:function(e){this._param=e},enumerable:!0,configurable:!0}),Object.defineProperty(PacketHeader.prototype,"magic",{get:function(){return this._magic},set:function(e){this._magic=e},enumerable:!0,configurable:!0}),Object.defineProperty(PacketHeader.prototype,"uuid",{get:function(){return this._uuid},set:function(e){this._uuid=e},enumerable:!0,configurable:!0}),Object.defineProperty(PacketHeader.prototype,"blen",{get:function(){return this._len},set:function(e){this._len=e},enumerable:!0,configurable:!0}),PacketHeader.prototype.pack=function(){return this.clean_buf(),this._buf.writeUInt16LE(this._magic,this._offset),this._offset+=2,this._buf.writeUInt32LE(this._len,this._offset),this._offset+=4,this._buf.writeUInt32LE(this._opcode,this._offset),this._offset+=4,this._buf.writeUInt32LE(this._uuid,this._offset),this._offset+=4,this._buf.writeUInt32LE(this._param,this._offset),this._offset+=4,this._buf},PacketHeader.prototype.unpack=function(e){if(e.length<this._head_len)throw new Error("Packet header length invalid.");var i=0;return this._magic=e.readUInt16LE(i),i+=2,this._len=e.readUInt32LE(i),i+=4,this._opcode=e.readUInt32LE(i),i+=4,this._uuid=e.readUInt32LE(i),i+=4,this._param=e.readUInt32LE(i),i+=4},PacketHeader.prototype.clean_buf=function(){this._buf=s.Buffer.alloc(this._head_len),this._offset=0},PacketHeader}();i.PacketHeader=h;var d=function(){function Packet(e,i){this.mContentBuf=s.Buffer.alloc(0),this.mHeader=new h,this._init(e,i)}return Object.defineProperty(Packet.prototype,"header",{get:function(){return this.mHeader},set:function(e){this.mHeader=e},enumerable:!0,configurable:!0}),Object.defineProperty(Packet.prototype,"opcode",{get:function(){return this.mHeader.opcode},enumerable:!0,configurable:!0}),Object.defineProperty(Packet.prototype,"content",{get:function(){return this.mContent},set:function(e){this.mContent=e},enumerable:!0,configurable:!0}),Packet.prototype.Serialization=function(){this._contentEncode();var e=this._mkHead(),i=e.headBuf,n=e.headLength;return s.Buffer.concat([i,this.mContentBuf],n+this.mContentBuf.length)},Packet.prototype.Deserialization=function(e){if(e.length<18)throw new Error("Packet is smaller than header size.");var i=this.mHeader.unpack(e),n=this.mHeader.blen;return this.mContentBuf=s.Buffer.alloc(n),e.copy(this.mContentBuf,0,i),this._contentDecode(),!1},Packet.prototype._init=function(e,i){this.mHeader=void 0!==e?new h(e,i):new h},Packet.prototype._contentEncode=function(){},Packet.prototype._contentDecode=function(){},Packet.prototype._mkHead=function(){this.mHeader.blen=this.mContentBuf.length;var e=this.mHeader.pack();return{headBuf:e,headLength:e.length}},Packet}();i.Packet=d;var p=/^_(OP_.+)/,f=function(e){function PBpacket(i,n){var o=e.call(this)||this;return o._opcode_str="",o._pbClass=void 0,o._init(i,n),o}return r(PBpacket,e),Object.defineProperty(PBpacket.prototype,"pbClass",{get:function(){return this._pbClass},enumerable:!0,configurable:!0}),PBpacket.getProtocol=function(){return a},PBpacket.addProtocol=function(e){a.push(e)},PBpacket.prototype._init=function(i,n){e.prototype._init.call(this,i,n),this._reflection()},PBpacket.prototype._contentEncode=function(){if(void 0!==this._pbClass)return void 0===this.mContent?console.warn(new Error("Content is undefined.")):void(this.mContentBuf=new s.Buffer(this._pbClass.encode(this.mContent).finish()))},PBpacket.prototype._contentDecode=function(){if(this._reflection(),void 0!==this._pbClass){if(void 0===this.mContentBuf)return console.warn(new Error("Content buffer is undefined."));try{this.mContent=this._pbClass.decode(this.mContentBuf)}catch(e){console.error("_contentDecode error: "+e)}}},PBpacket.prototype._reflection=function(){var e=this,i=this.mHeader.opcode;if(void 0!==i){var n=this;a.forEach((function(o){if("OPCODE"in o&&i in o.OPCODE){n._opcode_str=o.OPCODE[i];var r=p.exec(e._opcode_str);if(r&&r.length>0){var s=r[1];s in o&&(n._pbClass=o[s])}}})),void 0!==this._pbClass&&this._buildContent()}},PBpacket.prototype._buildContent=function(){void 0!==this._pbClass&&"create"in this._pbClass&&(this.mContent=new this._pbClass.create)},PBpacket.prototype.toString=function(){return"OP["+this.mHeader.opcode+"] "+this._opcode_str+" - Content_Len: "+this.mContentBuf.length},PBpacket}(d);i.PBpacket=f},455:function(e,i,n){"use strict";var o=n(190),r=n(191),s=n(364),a=n(189),c=[],l=c.forEach,u=c.slice;function defaults(e){return l.call(u.call(arguments,1),(function(i){if(i)for(var n in i)void 0===e[n]&&(e[n]=i[n])})),e}function addQueryString(e,i){if(i&&"object"===Object(a.a)(i)){var n="",o=encodeURIComponent;for(var r in i)n+="&"+o(r)+"="+o(i[r]);if(!n)return e;e=e+(-1!==e.indexOf("?")?"&":"?")+n.slice(1)}return e}function ajax(e,i,n,o,r){o&&"object"===Object(a.a)(o)&&(r||(o._t=new Date),o=addQueryString("",o).slice(1)),i.queryStringParams&&(e=addQueryString(e,i.queryStringParams));try{var s;(s=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0")).open(o?"POST":"GET",e,1),i.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.withCredentials=!!i.withCredentials,o&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.overrideMimeType&&s.overrideMimeType("application/json");var c=i.customHeaders;if(c="function"==typeof c?c():c)for(var l in c)s.setRequestHeader(l,c[l]);s.onreadystatechange=function(){s.readyState>3&&n&&n(s.responseText,s)},s.send(o)}catch(e){console&&console.log(e)}}function getDefaults(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:JSON.parse,parsePayload:function parsePayload(e,i,n){return Object(s.a)({},i,n||"")},crossDomain:!1,ajax:ajax}}var h=function(){function Backend(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(o.a)(this,Backend),this.init(e,i),this.type="backend"}return Object(r.a)(Backend,[{key:"init",value:function init(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=e,this.options=defaults(i,this.options||{},getDefaults())}},{key:"readMulti",value:function readMulti(e,i,n){var o=this.options.loadPath;"function"==typeof this.options.loadPath&&(o=this.options.loadPath(e,i));var r=this.services.interpolator.interpolate(o,{lng:e.join("+"),ns:i.join("+")});this.loadUrl(r,n)}},{key:"read",value:function read(e,i,n){var o=this.options.loadPath;"function"==typeof this.options.loadPath&&(o=this.options.loadPath([e],[i]));var r=this.services.interpolator.interpolate(o,{lng:e,ns:i});this.loadUrl(r,n)}},{key:"loadUrl",value:function loadUrl(e,i){var n=this;this.options.ajax(e,this.options,(function(o,r){if(r.status>=500&&r.status<600)return i("failed loading "+e,!0);if(r.status>=400&&r.status<500)return i("failed loading "+e,!1);var s,a;try{s=n.options.parse(o,e)}catch(i){a="failed parsing "+e+" to json"}if(a)return i(a,!1);i(null,s)}))}},{key:"create",value:function create(e,i,n,o){var r=this;"string"==typeof e&&(e=[e]);var s=this.options.parsePayload(i,n,o);e.forEach((function(e){var n=r.services.interpolator.interpolate(r.options.addPath,{lng:e,ns:i});r.options.ajax(n,r.options,(function(e,i){}),s)}))}}]),Backend}();h.type="backend",i.a=h},456:function(e,i,n){"use strict";var o=n(190),r=n(191),s=[],a=s.forEach,c=s.slice;function defaults(e){return a.call(c.call(arguments,1),(function(i){if(i)for(var n in i)void 0===e[n]&&(e[n]=i[n])})),e}var l,u=function create(e,i,n,o){var r,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{path:"/"};if(n){var a=new Date;a.setTime(a.getTime()+60*n*1e3),r="; expires="+a.toUTCString()}else r="";o=o?"domain="+o+";":"",s=Object.keys(s).reduce((function(e,i){return e+";"+i.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()}))+"="+s[i]}),""),document.cookie=e+"="+encodeURIComponent(i)+r+";"+o+s},h=function read(e){for(var i=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(i))return r.substring(i.length,r.length)}return null},d={name:"cookie",lookup:function lookup(e){var i;if(e.lookupCookie&&"undefined"!=typeof document){var n=h(e.lookupCookie);n&&(i=n)}return i},cacheUserLanguage:function cacheUserLanguage(e,i){i.lookupCookie&&"undefined"!=typeof document&&u(i.lookupCookie,e,i.cookieMinutes,i.cookieDomain,i.cookieOptions)}},p={name:"querystring",lookup:function lookup(e){var i;if("undefined"!=typeof window)for(var n=window.location.search.substring(1).split("&"),o=0;o<n.length;o++){var r=n[o].indexOf("=");if(r>0)n[o].substring(0,r)===e.lookupQuerystring&&(i=n[o].substring(r+1))}return i}};try{l="undefined"!==window&&null!==window.localStorage;window.localStorage.setItem("i18next.translate.boo","foo"),window.localStorage.removeItem("i18next.translate.boo")}catch(e){l=!1}var f,g={name:"localStorage",lookup:function lookup(e){var i;if(e.lookupLocalStorage&&l){var n=window.localStorage.getItem(e.lookupLocalStorage);n&&(i=n)}return i},cacheUserLanguage:function cacheUserLanguage(e,i){i.lookupLocalStorage&&l&&window.localStorage.setItem(i.lookupLocalStorage,e)}};try{f="undefined"!==window&&null!==window.sessionStorage;window.sessionStorage.setItem("i18next.translate.boo","foo"),window.sessionStorage.removeItem("i18next.translate.boo")}catch(e){f=!1}var m={name:"sessionStorage",lookup:function lookup(e){var i;if(e.lookupsessionStorage&&f){var n=window.sessionStorage.getItem(e.lookupsessionStorage);n&&(i=n)}return i},cacheUserLanguage:function cacheUserLanguage(e,i){i.lookupsessionStorage&&f&&window.sessionStorage.setItem(i.lookupsessionStorage,e)}},y={name:"navigator",lookup:function lookup(e){var i=[];if("undefined"!=typeof navigator){if(navigator.languages)for(var n=0;n<navigator.languages.length;n++)i.push(navigator.languages[n]);navigator.userLanguage&&i.push(navigator.userLanguage),navigator.language&&i.push(navigator.language)}return i.length>0?i:void 0}},v={name:"htmlTag",lookup:function lookup(e){var i,n=e.htmlTag||("undefined"!=typeof document?document.documentElement:null);return n&&"function"==typeof n.getAttribute&&(i=n.getAttribute("lang")),i}},b={name:"path",lookup:function lookup(e){var i;if("undefined"!=typeof window){var n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(n instanceof Array)if("number"==typeof e.lookupFromPathIndex){if("string"!=typeof n[e.lookupFromPathIndex])return;i=n[e.lookupFromPathIndex].replace("/","")}else i=n[0].replace("/","")}return i}},N={name:"subdomain",lookup:function lookup(e){var i;if("undefined"!=typeof window){var n=window.location.href.match(/(?:http[s]*\:\/\/)*(.*?)\.(?=[^\/]*\..{2,5})/gi);n instanceof Array&&(i="number"==typeof e.lookupFromSubdomainIndex?n[e.lookupFromSubdomainIndex].replace("http://","").replace("https://","").replace(".",""):n[0].replace("http://","").replace("https://","").replace(".",""))}return i}};var k=function(){function Browser(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(o.a)(this,Browser),this.type="languageDetector",this.detectors={},this.init(e,i)}return Object(r.a)(Browser,[{key:"init",value:function init(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=defaults(i,this.options||{},{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],checkWhitelist:!0,checkForSimilarInWhitelist:!1}),this.options.checkForSimilarInWhitelist&&(this.options.checkWhitelist=!0),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(d),this.addDetector(p),this.addDetector(g),this.addDetector(m),this.addDetector(y),this.addDetector(v),this.addDetector(b),this.addDetector(N)}},{key:"addDetector",value:function addDetector(e){this.detectors[e.name]=e}},{key:"detect",value:function detect(e){var i=this;e||(e=this.options.order);var n,o=[];if(e.forEach((function(e){if(i.detectors[e]){var n=i.detectors[e].lookup(i.options);n&&"string"==typeof n&&(n=[n]),n&&(o=o.concat(n))}})),o.forEach((function(e){if(!n){var o=i.services.languageUtils.formatLanguageCode(e);i.options.checkWhitelist&&!i.services.languageUtils.isWhitelisted(o)||(n=o),!n&&i.options.checkForSimilarInWhitelist&&(n=i.getSimilarInWhitelist(o))}})),!n){var r=this.i18nOptions.fallbackLng;"string"==typeof r&&(r=[r]),r||(r=[]),n="[object Array]"===Object.prototype.toString.apply(r)?r[0]:r[0]||r.default&&r.default[0]}return n}},{key:"cacheUserLanguage",value:function cacheUserLanguage(e,i){var n=this;i||(i=this.options.caches),i&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||i.forEach((function(i){n.detectors[i]&&n.detectors[i].cacheUserLanguage(e,n.options)})))}},{key:"getSimilarInWhitelist",value:function getSimilarInWhitelist(e){var i=this;if(this.i18nOptions.whitelist){if(e.includes("-")){var n=e.split("-")[0],o=this.services.languageUtils.formatLanguageCode(n);if(this.services.languageUtils.isWhitelisted(o))return o;e=o}var r=this.i18nOptions.whitelist.find((function(n){var o=i.services.languageUtils.formatLanguageCode(n);if(o.startsWith(e))return o}));return r||void 0}}}]),Browser}();k.type="languageDetector",i.a=k},457:function(e,i,n){var o=n(366),r=n(458),s=new o,a="undefined"!=typeof window?window:self,c=a.crypto||a.msCrypto||{},l=c.subtle||c.webkitSubtle;function sha1sync(e){return s.digest(e)}try{l.digest({name:"sha-1"},new Uint8Array).catch((function(){l=!1}))}catch(e){l=!1}e.exports=function sha1(e,i){l?("string"==typeof e&&(e=function uint8array(e){for(var i=e.length,n=new Uint8Array(i),o=0;o<i;o++)n[o]=e.charCodeAt(o);return n}(e)),l.digest({name:"sha-1"},e).then((function succeed(e){i(function hex(e){for(var i=e.length,n=[],o=0;o<i;o++){var r=e[o];n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")}(new Uint8Array(e)))}),(function fail(){i(sha1sync(e))}))):"undefined"!=typeof window?r(e,(function onRushaWorkerSha1(n,o){i(n?sha1sync(e):o)})):queueMicrotask(()=>i(sha1sync(e)))},e.exports.sync=sha1sync},458:function(e,i,n){var o,r,s,a=n(366);e.exports=function sha1(e,i){o||function init(){o=a.createWorker(),r=1,s={},o.onmessage=function onRushaMessage(e){var i=e.data.id,n=s[i];delete s[i],null!=e.data.error?n(new Error("Rusha worker error: "+e.data.error)):n(null,e.data.hash)}}(),s[r]=i,o.postMessage({id:r,data:e}),r+=1}},464:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(371);i.Capsule=o.default;const r=n(134);i.Constants=r.default;const s=n(476);i.Lite=s.default;const a=n(107);i.Helpers=a.default;var c=n(155);i.AnimationLayer=c.AnimationLayer,i.AnimationMountLayer=c.AnimationMountLayer,function __export(e){for(var n in e)i.hasOwnProperty(n)||(i[n]=e[n])}(n(133))},465:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(133),r=n(377),s=n(378),a=n(203),c=n(206),l=n(205),u=n(379),h=n(380);i.default=class ConfigObjectFactory{constructor(e){this._cap=e}element(e){const i=e||this._cap.root,n=new o.ElementNode(this._cap,i);return this._cap.addObject(n),n}spawnpoint(e){const i=e||this._cap.root,n=new o.SpawnPointNode(this._cap,i);return this._cap.addObject(n),n}terrain(e){const i=e||this._cap.root,n=new a.TerrainNode(this._cap,i);return this._cap.addObject(n),n}attr(e){const i=new o.AttributeNode(this._cap,e);return this._cap.addObject(i),i}func(e){const i=new o.FunctionNode(this._cap,e);return this._cap.addObject(i),i}event(e){const i=new o.EventNode(this._cap,e);return this._cap.addObject(i),i}ui(e){const i=new o.UINode(this._cap,e);return this._cap.addObject(i),i}timer(e){const i=new o.TimerNode(this._cap,e);return this._cap.addObject(i),i}scene(e,i,n){const s=new r.default(this._cap,this._cap.root);n&&(s.name=n),this._cap.addObject(s);const a=new o.MapSizeNode(this._cap,s);a.rows=e,a.cols=i,this._cap.addObject(a);const c=new r.TerrainCollectionNode(this._cap,s);c.initTerrainCollection(e,i),this._cap.addObject(c);const l=new r.MossCollectionNode(this._cap,s);return this._cap.addObject(l),s}scenery(e){const i=new h.default(this._cap,e);return this._cap.addObject(i),i}character(){const e=new s.default(this._cap,this._cap.root);this._cap.addObject(e);const i=this.camp(1,e);this._cap.addObject(i);const n=new o.AvatarNode(this._cap,e);return this._cap.addObject(n),e}camp(e,i){const n=new o.CampNode(this._cap,i);return n.maxPlayers=e,this._cap.addObject(n),n}package(e){const i=new c.default(this._cap,e);return this._cap.addObject(i),i}packageItem(e){const i=new c.PackageItemNode(this._cap,e);return this._cap.addObject(i),i}animationdata(e,i){if(!e)return;if(i&&e.checkSameName(i))throw Error("重复的动画名称");const n=new o.AnimationDataNode(this._cap,e);return i&&(n.name=i),this._cap.addObject(n),n}animations(e){const i=new o.AnimationsNode(this._cap,e);return this._cap.addObject(i),i.link(),i}location(e){const i=new l.default(this._cap,e);return this._cap.addObject(i),i}display(e){const i=new o.DisplayNode(this._cap,e);return this._cap.addObject(i),i}shop(e){const i=new u.default(this._cap,e);return this._cap.addObject(i),i}shopItem(e){const i=new u.ShopItemNode(this._cap,e);return this._cap.addObject(i),i}commodity(e){const i=new u.CommodityNode(this._cap,e);return this._cap.addObject(i),i}}},466:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5),s=n(203),a=n(374),c=n(204),l=n(107);class GameNode extends o.BaseConfigObject{constructor(e){super(e),this._scenes=[],this.parent=0,this._settings=new SettingsNode(e,this),this._palette=new PaletteNode(e,this),this._moss=new MossNode(e,this),this._assets=new AssetsNode(e,this),this._mods=new ModsNode(e,this)}get properties(){return{}}get settings(){return this._settings}get palette(){return this._palette}get moss(){return this._moss}get assets(){return this._assets}get scenes(){return this._scenes}set scenes(e){e&&(this._scenes=e)}get mods(){return this._mods}serialize(e){e.node=this.makeNode(),e.node.name||(e.node.name="Game"),this._settings.serialize(e),this._palette.serialize(e),this._assets.serialize(e),this._moss.serialize(e),this._mods.serialize(e),this.serializeScenes(e)}serializeScenes(e){e.scenes=this.cap.root.children.filter(e=>e.type===r.op_def.NodeType.SceneNodeType).map(e=>({id:e.id,name:e.name}))}deserialize(e){this.setNode(e.node),this._settings.deserialize(e),this._assets.deserialize(e),this._mods.deserialize(e),this.scenes=e.scenes}preDeserializePalettes(e){this._palette.preDeserialize(e),this._moss.preDeserizlize(e)}deserializePalettes(e){this._palette.deserialize(),this._moss.deserialize()}destroy(){super.destroy(),this._settings.destroy(),this._palette.destroy(),this._assets.destroy(),this._moss.destroy(),this._mods.destroy()}}i.default=GameNode;class SettingsNode extends o.BaseConfigObject{constructor(){super(...arguments),this._spawn_point=0,this._max_number=10,this._sceneid=0}get spawnpoint(){return this._spawn_point}set spawnpoint(e){this._spawn_point=e}get maxNumber(){return this._max_number}set maxNumber(e){e&&(this._max_number=e)}set sceneid(e){e&&(this._sceneid=e)}get sceneid(){return this._sceneid}get properties(){return{sceneid:this._sceneid,spawnpoint:this._spawn_point,maxNumber:this._max_number}}serialize(e){const i=this;e.settings=r.op_gameconfig_01.Settings.create(),e.settings.node=i.makeNode(),i.maxNumber?e.settings.maxNumber=i.maxNumber:e.settings.maxNumber=null,i.sceneid&&(e.settings.sceneid=i.sceneid),i.spawnpoint&&(e.settings.spawnpointid=i.spawnpoint)}deserialize(e){const i=e.settings;i&&(this.setNode(i.node),i.sceneid&&(this._sceneid=i.sceneid),this._spawn_point=i.spawnpointid,i.maxNumber?this._max_number=i.maxNumber:this._max_number=null)}}i.SettingsNode=SettingsNode;class PaletteNode extends o.BaseConfigObject{constructor(){super(...arguments),this._peers=[],this._peersDict=new Map,this._sn_peers=new Map}get peers(){return this._peers}set peers(e){this._peers=e}get peersDict(){return this._peersDict}get snPeers(){return this._sn_peers}getPaletteKeyBySn(e){return this._sn_peers.get(e)}addSnPalette(e,i){this._sn_peers.set(e,i)}convertPaletteOfSnKey(){for(const e of this.peers)e.entity&&this._sn_peers.set(`${e.entity.node.sn}#${e.entity.version}`,e.key)}getTerrainPaletteKeyBySn(e){return this._sn_peers.get(e)}convertToPeerDict(){for(const e of this.peers)if(e.entity){const i=e.entity.node.id,n=this._cap.getObject(i);this._peersDict.set(e.key,n)}}convertToPeers(){const e=[];for(const i of this._cap.root.children.filter(e=>e.type===r.op_def.NodeType.SceneNodeType)){const n=i;if(n.terrainCollection)for(let i of n.terrainCollection.data)for(let n of i)e.indexOf(n)<0&&n>0&&e.push(n)}let i=[];for(const n of Array.from(this._peersDict.keys())){if(e.indexOf(n)<0)continue;const o=this._peersDict.get(n);if(o){i.push({key:n,entity:o.createProtocolObject()}),this.cap.addTerrainMaterial(o.animations),this.cap.addTerrainMaterial(o.animations.display);for(const e of o.animations.animationData)this.cap.addTerrainMaterial(e)}}return i}addToPalette(e){const[i,n]=e.getSnAndVersion(),o=`${i}#${n}`,r=this.getNextKey(e);return this.addPeer(r,e),this.addSnPalette(o,r),this._cap.getTerrainMaterial(e.id)||this._cap.addTerrainMaterial(e),r}getNextKey(e){const[i,n]=e.getSnAndVersion(),o=`${i}#${n}`;if(this.snPeers.get(o))return this.snPeers.get(o);const r=Array.from(this.peersDict.keys());let s=1;if(r.length>0){s=Math.max(...r)+1}return s}addPeer(e,i){this._peersDict.set(e,i)}getPeer(e){return this._peersDict.get(e)}getPeerThroughBindId(e){return Array.from(this._peersDict.values()).find(i=>i.id===e)}removePeer(e){this._peersDict.delete(e)}updatePeer(e,i){this._peersDict.set(e,i.createProtocolObject())}serialize(e){const i=this.convertToPeers();i&&i.length>0&&(e.palette=r.op_gameconfig_01.Palette.create(),e.palette.node=this.makeNode(),e.palette.node.name="PaletteNode",e.palette.node.Parent=this._cap.root.id,e.palette.peers=i)}preDeserialize(e){if(e.palette&&e.palette.peers){this.setNode(e.palette.node),this.peers=e.palette.peers;for(const e of this.peers){const i=new s.TerrainNode(this._cap);i.deserialize(e.entity),this._cap.addObject(i)}}}deserialize(){this.convertToPeerDict(),this.convertPaletteOfSnKey()}destroy(){super.destroy(),this._peersDict.forEach((e,i)=>{e.destroy()}),this._peersDict.clear()}}i.PaletteNode=PaletteNode;class AssetsNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._items=[],this._itemsDict=new Map,this.name="资源仓库"}get items(){return this._items}convertToItemsDict(){for(const e of this.items)this._itemsDict.set(e.id,e)}convertToItems(){return Array.from(this._itemsDict.values()).map(e=>e.createProtocolObject())}addAssets(e){this._itemsDict.set(e.id,e),this._cap.addObject(e)}deleteAsset(e){this._itemsDict.delete(e),this._cap.removeObjectById(e)}updateAsset(e){this._itemsDict.set(e.id,e)}getAsset(e){return this._itemsDict.get(e)}getAssetList(){return Array.from(this._itemsDict.values())}serialize(e){e.assets=r.op_gameconfig_01.Assets.create(),e.assets.node=this.makeNode(),e.assets.node.Parent=this._cap.root.id,e.assets.items=this.convertToItems()}deserialize(e){if(e.assets){this.setNode(e.assets.node);for(const i of e.assets.items){const e=new a.default(this._cap);e.deserialize(i),this.children.push(e),this._items.push(e)}this.convertToItemsDict()}}}i.AssetsNode=AssetsNode;class MossNode extends o.BaseConfigObject{constructor(){super(...arguments),this._peers=[],this._peersDict=new Map,this._sn_peers=new Map}get peers(){return this._peers}set peers(e){this._peers=e}get peersDict(){return this._peersDict}get snPeers(){return this._sn_peers}getPaletteKeyBySn(e){return this._sn_peers.get(e)}addSnPalette(e,i){this._sn_peers.set(e,i)}convertToPeerDict(){for(const e of this.peers)if(e.entity){const i=e.entity.node.id,n=this._cap.getObject(i);this._peersDict.set(e.key,n)}}convertPaletteOfSnKey(){for(let e of this._peers)e.entity&&this._sn_peers.set(l.default.getElementSn(e.entity.node.sn,e.entity.version),e.key)}getElementPaletteKeyBySn(e){return this._sn_peers.get(e)}convertToPeers(){let e=[];for(const i of Array.from(this._peersDict.keys())){const n=this._peersDict.get(i);if(n.isFork=!1,n){e.push({key:i,entity:n.createProtocolObject()}),this.cap.addElementMaterial(n.animations),this.cap.addElementMaterial(n.animations.display);for(const e of n.animations.animationData)this.cap.addElementMaterial(e)}}return e}addToPalette(e){this._cap.getElementMeterials().map(e=>e.id).indexOf(e.id)>=0&&e.renewId();const[i,n]=e.getSnAndVersion(),o=l.default.getElementSn(i,n),r=this.getNextKey(e);return this._peersDict.set(r,e),this.addSnPalette(o,r),this._cap.getElementMaterial(e.geneSequence())||this._cap.addElementMaterial(e),r}getNextKey(e){const[i,n]=e.getSnAndVersion(),o=l.default.getElementSn(i,n);if(this.snPeers.get(o))return this.snPeers.get(o);const r=Array.from(this.peersDict.keys());let s=1;if(r.length>0){s=Math.max(...r)+1}return s}getPeer(e){return this._peersDict.get(e)}getPeerThroughBindId(e){return Array.from(this._peersDict.values()).find(i=>i.id===e)}removePeer(e){this._peersDict.delete(e)}updatePeer(e,i){this._peersDict.set(e,i.createProtocolObject())}serialize(e){const i=this.convertToPeers();i&&i.length>0&&(e.moss=r.op_gameconfig_01.Moss.create(),e.moss.node=this.makeNode(),e.moss.node.name="MossNode",e.moss.node.Parent=this._cap.root.id,e.moss.peers=i)}preDeserizlize(e){if(e.moss&&e.moss.peers){this.setNode(e.moss.node),this.peers=e.moss.peers;for(const e of this.peers){const i=new c.default(this._cap);i.deserialize(e.entity),this._cap.addObject(i)}}}deserialize(){this.convertPaletteOfSnKey(),this.convertToPeerDict()}destroy(){super.destroy(),this._peersDict.forEach((e,i)=>{e.destroy()}),this._peersDict.clear()}}i.MossNode=MossNode;class ModsNode extends o.BaseConfigObject{constructor(){super(...arguments),this.values=[]}serialize(e){e.mods=r.op_gameconfig_01.Mods.create(),e.mods.node=this.makeNode(),e.mods.node.name="ModesNode",e.mods.node.Parent=this._cap.root.id,e.mods.data=this.values}deserialize(e){e.mods&&e.mods.data&&(this.values=e.mods.data)}checkMode(e){return this.values.findIndex(i=>i.name===e)>=0}addMod(e,i){const n=this.values.find(i=>i.name===e);n?n.version=i:this.values.push({name:e,version:i})}removeMod(e){const i=this.values.findIndex(i=>i.name===e);i>=0&&this.values.splice(i,1)}updateMod(e,i){const n=this.values.find(i=>i.name===e);n&&(n.version=i)}getModVersion(e){const i=this.values.find(i=>i.name===e);return i?i.version:""}}i.ModsNode=ModsNode},467:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);class MovableNode extends o.BaseConfigObject{constructor(){super(...arguments),this._dir=0,this._angle=0,this._speed=0}get properties(){return{dir:this._dir,angle:this._angle,speed:this._speed}}findMyContainer(e){return Array.isArray(e.movable)||(e.movable=[]),e.movable}createProtocolObject(){const e=r.op_gameconfig_01.Movable.create();return e.node=this.makeNode(),this._dir&&(e.dir=this._dir),this._angle&&(e.angle=this._angle),this._speed&&(e.speed=this._speed),e}deserialize(e){super.deserialize(e);const i=e;i.dir&&(this._dir=i.dir),i.angle&&(this._angle=i.angle),i.speed&&(this._speed=i.speed)}}i.default=MovableNode},468:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);class FunctionNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._fileName="",this._funcName="",this.name="脚本",this.newFileName()}newFileName(){this.fileName=`${this.id}-t=${(new Date).getTime()}.lua`}get properties(){return{fileName:this._fileName,funcName:this._funcName}}idToFilenmae(){return`${this.id}?t=${(new Date).getTime()}.lua`}filenameToId(){const e=this.fileName.indexOf("-t=");return e>-1?parseInt(this.fileName.substring(0,e),10):0}get fileName(){return this._fileName}set fileName(e){this._fileName=e}get funcName(){return this._funcName}set funcName(e){this._funcName=e}findMyContainer(e){return Array.isArray(e.func)||(e.func=[]),e.func}createProtocolObject(){const e=r.op_gameconfig_01.Function.create();return e.node=this.makeNode(),e.fileName=this._fileName,e.funcName=this._funcName,e}deserialize(e){super.deserialize(e);const i=e;this._fileName=i.fileName,this._funcName=i.funcName}duplicate(e){}}i.default=FunctionNode},469:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);var s=r.op_def.GameEvent;class EventNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._eventName=s.onElementActive,this.name="事件"}get properties(){return{eventName:this._eventName}}set eventName(e){this._eventName="string"==typeof e?parseInt(e):e}get eventName(){return this._eventName}findMyContainer(e){return Array.isArray(e.event)||(e.event=[]),e.event}createProtocolObject(){const e=r.op_gameconfig_01.Event.create();return e.node=this.makeNode(),e.eventName=this._eventName,e}deserialize(e){super.deserialize(e);const i=e;this._eventName=i.eventName}}i.default=EventNode},470:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);class UINode extends o.BaseConfigObject{constructor(e,i){super(e,i),this.name="界面"}get properties(){return{text:this._text}}findMyContainer(e){return Array.isArray(e.ui)||(e.ui=[]),e.ui}createProtocolObject(){const e=r.op_gameconfig_01.UI.create();return e.node=this.makeNode(),e.text=this._text,e}deserialize(e){super.deserialize(e);const i=e;this._text=i.text}}i.default=UINode;class TextNode extends o.BaseConfigObject{constructor(){super(...arguments),this._text=""}findMyContainer(e){return Array.isArray(e.text)||(e.text=[]),e.text}createProtocolObject(){const e=r.op_gameconfig_01.Text.create();return e.node=this.makeNode(),e.text=this._text,e}deserialize(e){super.deserialize(e);const i=e;this._text=i.text}}i.TextNode=TextNode;class ButtonNode extends o.BaseConfigObject{constructor(){super(...arguments),this._text=""}findMyContainer(e){return Array.isArray(e.button)||(e.button=[]),e.button}createProtocolObject(){const e=r.op_gameconfig_01.Button.create();return e.node=this.makeNode(),e.text=this._text,this._tips&&(e.tips=this._tips),e}deserialize(e){super.deserialize(e);const i=e;this._text=i.text,i.tips&&(this._tips=i.tips)}}i.ButtonNode=ButtonNode},471:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5);class TimerNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this._timeout=0,this._interval=0,this.name="计时器"}get properties(){return{timeout:this._timeout,interval:this._interval}}set timeout(e){this._timeout=e}get timeout(){return this._timeout}set interval(e){this._interval=e}get interval(){return this._interval}findMyContainer(e){return Array.isArray(e.timer)||(e.timer=[]),e.timer}createProtocolObject(){const e=r.op_gameconfig_01.Timer.create();return e.node=this.makeNode(),e.timeout=this._timeout,e.interval=this._interval,e}deserialize(e){super.deserialize(e);const i=e;this._timeout=i.timeout,this._interval=i.interval}}i.default=TimerNode},472:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(5),s=n(107);var a=r.op_def.NodeType;class SpawnPointNode extends o.BaseConfigObject{constructor(e,i){super(e,i),this.name="出生点"}findMyContainer(e){return Array.isArray(e.spawnpoint)||(e.spawnpoint=[]),e.spawnpoint}createProtocolObject(){const e=r.op_gameconfig_01.SpawnPoint.create();return e.node=this.makeNode(),this._loc&&(e.loc=this._loc),e}deserialize(e){super.deserialize(e);const i=e;this.location.node=i.loc.node,this.location.x=i.loc.x,this.location.y=i.loc.y,this.location.z=i.loc.z}importSprite(e){this.cap.removeObject(this),this.id=e.id,this.name=e.nickname||this.name;const i=e.point3f;return i&&(this.location.x=i.x,this.location.y=i.y,this.location.z=i.z||0),this.cap.addObject(this),this}syncSprite(e){const i=e.point3f;return i&&(this.location.x=i.x,this.location.y=i.y,this.location.z=i.z||0),this}convertToSprite(){const e=r.op_client.Sprite.create();e.id=this.id,e.nickname=this.name;const i=r.op_def.PBPoint3f.create();return i.x=this.location.x,i.y=this.location.y,i.z=this.location.z,e.point3f=i,e.display=this.display,e.animations=[this.animation],e.currentAnimationName=this.animation.node.name,e.direction=3,e}get display(){return this._display||(this._display=r.op_gameconfig.Display.create(),this._display.texturePath="pixelpai/SpawnPointNode/5cc42f6417553727db1d2bba/1/5cc42f6417553727db1d2bba.png",this._display.dataPath="pixelpai/SpawnPointNode/5cc42f6417553727db1d2bba/1/5cc42f6417553727db1d2bba.json"),this._display}get animation(){if(!this._animation){const e=r.op_gameconfig_01.Node.create();e.name="idle",e.Parent=this.id,this._animation=r.op_gameconfig_01.AnimationData.create(),this._animation.node=e,this._animation.frameRate=5,this._animation.collisionArea="1,1&1,1",this._animation.loop=!0,this._animation.baseLoc="-30,-30",this._animation.originPoint=[0,0],this._animation.frameName=["switch_0027_3_01.png"]}return this._animation}get location(){if(!this._loc){this._loc=r.op_gameconfig_01.Location.create();const e=this._loc.node=r.op_gameconfig_01.Node.create();e.id=s.default.genId(),e.name="位置",e.Parent=this.id,e.type=a.LocationType}return this._loc}}i.default=SpawnPointNode},473:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(93),r=n(155),s=n(133);class ForkNode extends o.EntityNode{deserialize(e){if(!e||!e.hasOwnProperty("node"))return;const i=e.node.Parent;let n;const o=this.cap.getObject(i);if(!o)return void console.error(`${this.className}: My parent[${this.parent}] does not exist.`);const a=o.className||"";if(s.hasOwnProperty(a)&&(n=new s[a](this.cap),n&&(n.isFork=!0,n.parent=o.parent,e.node.Parent=o.parent,n.deserialize(e),n.link())),n&&o){for(const e of o.children)e instanceof r.default&&this.cap.clone(e.id,n);this.parent=o.parent}}}i.default=ForkNode},474:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default=class ChildrenIndex{constructor(){this._objects=new Map,this._terrain_objects=new Map,this._element_objects=new Map,this._branch_cache=new Map}getChildrenList(e){const i=this._branch_cache.get(e);return i?Array.from(i.values()):[]}addTerrainMaterial(e){if(!e)throw new Error("Empty Object.");this._terrain_objects.set(e.id,e)}addElementMaterial(e){if(!e)throw new Error("Empty Object.");this._element_objects.set(e.geneSequence(),e)}addObject(e){if(!e)throw new Error("Empty Object.");this._objects.set(e.id,e),e.isFork||e.link(),this._branch_cache.has(e.parent)||this._branch_cache.set(e.parent,new Map);const i=this._branch_cache.get(e.parent);i&&i.set(e.id,e)}removeObject(e){if(!e)throw new Error("Empty Object.");e.unlink(),this._objects.delete(e.id);const i=this._branch_cache.get(e.parent);i&&i.delete(e.id)}removeObjectById(e){this._objects.delete(e)}setObject(e,i){this._objects.set(e,i)}getObject(e){return this._objects.get(e)}getElementMaterial(e){return this._element_objects.get(e)}getElementMeterials(){return Array.from(this._element_objects.values())}getTerrainMaterial(e){return this._terrain_objects.get(e)}get objectsList(){return Array.from(this._objects.values())}}},475:function(e,i,n){e.exports=function(){function growBranch(e,i,n,o,r,s,a){var c,l,u="",h=0,d=o.slice(0);if(d.push([i,n])&&o.length>0&&(o.forEach((function(e,n){n>0&&(u+=(e[1]?" ":"│")+"  "),l||e[0]!==i||(l=!0)})),u+=function makePrefix(e,i){var n=i?"└":"├";return n+=e?"─ ":"──┐"}(e,n)+e,r&&("object"!=typeof i||i instanceof Date)&&(u+=": "+i),l&&(u+=" (circular ref.)"),a(u)),!l&&"object"==typeof i){var p=function filterKeys(e,i){var n=[];for(var o in e)e.hasOwnProperty(o)&&(i&&"function"==typeof e[o]||n.push(o));return n}(i,s);p.forEach((function(e){c=++h===p.length,growBranch(e,i[e],c,d,r,s,a)}))}}var e={asLines:function(e,i,n,o){growBranch(".",e,!1,[],i,"function"!=typeof n&&n,o||n)},asTree:function(e,i,n){var o="";return growBranch(".",e,!1,[],i,n,(function(e){o+=e+"\n"})),o}};return e}()},476:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(371),r=n(5);var s=r.op_gameconfig_01.Game,a=r.op_def.NodeType;const c=[a.SceneNodeType,a.ElementNodeType,a.TerrainNodeType,a.PackageItemType,a.ForkType,a.CharacterNodeType,a.AvatarType,a.AnimationsType,a.AnimationDataType,a.DisplayType,a.TerrainCollectionType,a.MossCollectionType,a.SceneryType];class Lite extends o.default{constructor(){super()}deserialize(e){const i=s.decode(e),n=[];this._root.deserialize(i),this._root.preDeserializePalettes(i);const o=[].concat(i.entity,i.animations,i.animationdatas,i.avatar,i.display,i.terrain,i.mossList,i.seneries);for(let e of o){if(!e)continue;const i=e.node.type;i&&-1!==c.indexOf(i)&&(i==a.ForkType?n.push(e):this.doDeserialize(e))}for(const e of n)this.doDeserialize(e);this._objects.forEach(e=>{e.link()}),this._root.deserializePalettes(i)}serialize(){throw new Error("don't serialize")}}i.default=Lite},488:function(e,i,n){"use strict";const copyTextToClipboard=(e,{target:i=document.body}={})=>{const n=document.createElement("textarea"),o=document.activeElement;n.value=e,n.setAttribute("readonly",""),n.style.contain="strict",n.style.position="absolute",n.style.left="-9999px",n.style.fontSize="12pt";const r=document.getSelection();let s=!1;r.rangeCount>0&&(s=r.getRangeAt(0)),i.append(n),n.select(),n.selectionStart=0,n.selectionEnd=e.length;let a=!1;try{a=document.execCommand("copy")}catch(e){}return n.remove(),s&&(r.removeAllRanges(),r.addRange(s)),o&&o.focus(),a};e.exports=copyTextToClipboard,e.exports.default=copyTextToClipboard},500:function(e,i,n){"use strict";var o=n(189),r=n(364);function _objectSpread(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?Object(arguments[i]):{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(i){Object(r.a)(e,i,n[i])}))}return e}var s=n(190),a=n(191);function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,i){return!i||"object"!==Object(o.a)(i)&&"function"!=typeof i?_assertThisInitialized(e):i}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,i){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,i){return e.__proto__=i,e})(e,i)}function _inherits(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&_setPrototypeOf(e,i)}var c={type:"logger",log:function log(e){this.output("log",e)},warn:function warn(e){this.output("warn",e)},error:function error(e){this.output("error",e)},output:function output(e,i){console&&console[e]&&console[e].apply(console,i)}},l=new(function(){function Logger(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,Logger),this.init(e,i)}return Object(a.a)(Logger,[{key:"init",value:function init(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=i.prefix||"i18next:",this.logger=e||c,this.options=i,this.debug=i.debug}},{key:"setDebug",value:function setDebug(e){this.debug=e}},{key:"log",value:function log(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this.forward(i,"log","",!0)}},{key:"warn",value:function warn(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this.forward(i,"warn","",!0)}},{key:"error",value:function error(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this.forward(i,"error","")}},{key:"deprecate",value:function deprecate(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this.forward(i,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function forward(e,i,n,o){return o&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[i](e))}},{key:"create",value:function create(e){return new Logger(this.logger,_objectSpread({},{prefix:"".concat(this.prefix,":").concat(e,":")},this.options))}}]),Logger}()),u=function(){function EventEmitter(){Object(s.a)(this,EventEmitter),this.observers={}}return Object(a.a)(EventEmitter,[{key:"on",value:function on(e,i){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(i)})),this}},{key:"off",value:function off(e,i){this.observers[e]&&(i?this.observers[e]=this.observers[e].filter((function(e){return e!==i})):delete this.observers[e])}},{key:"emit",value:function emit(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];if(this.observers[e]){var r=[].concat(this.observers[e]);r.forEach((function(e){e.apply(void 0,n)}))}if(this.observers["*"]){var s=[].concat(this.observers["*"]);s.forEach((function(i){i.apply(i,[e].concat(n))}))}}}]),EventEmitter}();function defer(){var e,i,n=new Promise((function(n,o){e=n,i=o}));return n.resolve=e,n.reject=i,n}function makeString(e){return null==e?"":""+e}function copy(e,i,n){e.forEach((function(e){i[e]&&(n[e]=i[e])}))}function getLastOfPath(e,i,n){function cleanKey(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function canNotTraverseDeeper(){return!e||"string"==typeof e}for(var o="string"!=typeof i?[].concat(i):i.split(".");o.length>1;){if(canNotTraverseDeeper())return{};var r=cleanKey(o.shift());!e[r]&&n&&(e[r]=new n),e=e[r]}return canNotTraverseDeeper()?{}:{obj:e,k:cleanKey(o.shift())}}function setPath(e,i,n){var o=getLastOfPath(e,i,Object);o.obj[o.k]=n}function getPath(e,i){var n=getLastOfPath(e,i),o=n.obj,r=n.k;if(o)return o[r]}function getPathWithDefaults(e,i,n){var o=getPath(e,n);return void 0!==o?o:getPath(i,n)}function deepExtend(e,i,n){for(var o in i)"__proto__"!==o&&(o in e?"string"==typeof e[o]||e[o]instanceof String||"string"==typeof i[o]||i[o]instanceof String?n&&(e[o]=i[o]):deepExtend(e[o],i[o],n):e[o]=i[o]);return e}function regexEscape(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function i18next_escape(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return h[e]})):e}var d="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,p=function(e){function ResourceStore(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return Object(s.a)(this,ResourceStore),i=_possibleConstructorReturn(this,_getPrototypeOf(ResourceStore).call(this)),d&&u.call(_assertThisInitialized(i)),i.data=e||{},i.options=n,void 0===i.options.keySeparator&&(i.options.keySeparator="."),i}return _inherits(ResourceStore,e),Object(a.a)(ResourceStore,[{key:"addNamespaces",value:function addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function removeNamespaces(e){var i=this.options.ns.indexOf(e);i>-1&&this.options.ns.splice(i,1)}},{key:"getResource",value:function getResource(e,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator,s=[e,i];return n&&"string"!=typeof n&&(s=s.concat(n)),n&&"string"==typeof n&&(s=s.concat(r?n.split(r):n)),e.indexOf(".")>-1&&(s=e.split(".")),getPath(this.data,s)}},{key:"addResource",value:function addResource(e,i,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},s=this.options.keySeparator;void 0===s&&(s=".");var a=[e,i];n&&(a=a.concat(s?n.split(s):n)),e.indexOf(".")>-1&&(o=i,i=(a=e.split("."))[1]),this.addNamespaces(i),setPath(this.data,a,o),r.silent||this.emit("added",e,i,n,o)}},{key:"addResources",value:function addResources(e,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var r in n)"string"!=typeof n[r]&&"[object Array]"!==Object.prototype.toString.apply(n[r])||this.addResource(e,i,r,n[r],{silent:!0});o.silent||this.emit("added",e,i,n)}},{key:"addResourceBundle",value:function addResourceBundle(e,i,n,o,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},a=[e,i];e.indexOf(".")>-1&&(o=n,n=i,i=(a=e.split("."))[1]),this.addNamespaces(i);var c=getPath(this.data,a)||{};o?deepExtend(c,n,r):c=_objectSpread({},c,n),setPath(this.data,a,c),s.silent||this.emit("added",e,i,n)}},{key:"removeResourceBundle",value:function removeResourceBundle(e,i){this.hasResourceBundle(e,i)&&delete this.data[e][i],this.removeNamespaces(i),this.emit("removed",e,i)}},{key:"hasResourceBundle",value:function hasResourceBundle(e,i){return void 0!==this.getResource(e,i)}},{key:"getResourceBundle",value:function getResourceBundle(e,i){return i||(i=this.options.defaultNS),"v1"===this.options.compatibilityAPI?_objectSpread({},{},this.getResource(e,i)):this.getResource(e,i)}},{key:"getDataByLanguage",value:function getDataByLanguage(e){return this.data[e]}},{key:"toJSON",value:function toJSON(){return this.data}}]),ResourceStore}(u),f={processors:{},addPostProcessor:function addPostProcessor(e){this.processors[e.name]=e},handle:function handle(e,i,n,o,r){var s=this;return e.forEach((function(e){s.processors[e]&&(i=s.processors[e].process(i,n,o,r))})),i}},g={},m=function(e){function Translator(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,Translator),i=_possibleConstructorReturn(this,_getPrototypeOf(Translator).call(this)),d&&u.call(_assertThisInitialized(i)),copy(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,_assertThisInitialized(i)),i.options=n,void 0===i.options.keySeparator&&(i.options.keySeparator="."),i.logger=l.create("translator"),i}return _inherits(Translator,e),Object(a.a)(Translator,[{key:"changeLanguage",value:function changeLanguage(e){e&&(this.language=e)}},{key:"exists",value:function exists(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}},n=this.resolve(e,i);return n&&void 0!==n.res}},{key:"extractFromKey",value:function extractFromKey(e,i){var n=void 0!==i.nsSeparator?i.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var o=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,r=i.ns||this.options.defaultNS;if(n&&e.indexOf(n)>-1){var s=e.match(this.interpolator.nestingRegexp);if(s&&s.length>0)return{key:e,namespaces:r};var a=e.split(n);(n!==o||n===o&&this.options.ns.indexOf(a[0])>-1)&&(r=a.shift()),e=a.join(o)}return"string"==typeof r&&(r=[r]),{key:e,namespaces:r}}},{key:"translate",value:function translate(e,i,n){var r=this;if("object"!==Object(o.a)(i)&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),i||(i={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var s=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,a=this.extractFromKey(e[e.length-1],i),c=a.key,l=a.namespaces,u=l[l.length-1],h=i.lng||this.language,d=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h&&"cimode"===h.toLowerCase()){if(d){var p=i.nsSeparator||this.options.nsSeparator;return u+p+c}return c}var f=this.resolve(e,i),g=f&&f.res,m=f&&f.usedKey||c,y=f&&f.exactUsedKey||c,v=Object.prototype.toString.apply(g),b=["[object Number]","[object Function]","[object RegExp]"],N=void 0!==i.joinArrays?i.joinArrays:this.options.joinArrays,k=!this.i18nFormat||this.i18nFormat.handleAsObject,x="string"!=typeof g&&"boolean"!=typeof g&&"number"!=typeof g;if(k&&g&&x&&b.indexOf(v)<0&&("string"!=typeof N||"[object Array]"!==v)){if(!i.returnObjects&&!this.options.returnObjects)return this.logger.warn("accessing an object - but returnObjects options is not enabled!"),this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,g,i):"key '".concat(c," (").concat(this.language,")' returned an object instead of string.");if(s){var w="[object Array]"===v,P=w?[]:{},S=w?y:m;for(var O in g)if(Object.prototype.hasOwnProperty.call(g,O)){var A="".concat(S).concat(s).concat(O);P[O]=this.translate(A,_objectSpread({},i,{joinArrays:!1,ns:l})),P[O]===A&&(P[O]=g[O])}g=P}}else if(k&&"string"==typeof N&&"[object Array]"===v)(g=g.join(N))&&(g=this.extendTranslation(g,e,i,n));else{var C=!1,T=!1;if(!this.isValidLookup(g)&&void 0!==i.defaultValue){if(C=!0,void 0!==i.count){var I=this.pluralResolver.getSuffix(h,i.count);g=i["defaultValue".concat(I)]}g||(g=i.defaultValue)}this.isValidLookup(g)||(T=!0,g=c);var L=i.defaultValue&&i.defaultValue!==g&&this.options.updateMissing;if(T||C||L){if(this.logger.log(L?"updateKey":"missingKey",h,u,c,L?i.defaultValue:g),s){var j=this.resolve(c,_objectSpread({},i,{keySeparator:!1}));j&&j.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var E=[],D=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if("fallback"===this.options.saveMissingTo&&D&&D[0])for(var M=0;M<D.length;M++)E.push(D[M]);else"all"===this.options.saveMissingTo?E=this.languageUtils.toResolveHierarchy(i.lng||this.language):E.push(i.lng||this.language);var R=function send(e,n){r.options.missingKeyHandler?r.options.missingKeyHandler(e,u,n,L?i.defaultValue:g,L,i):r.backendConnector&&r.backendConnector.saveMissing&&r.backendConnector.saveMissing(e,u,n,L?i.defaultValue:g,L,i),r.emit("missingKey",e,u,n,g)};if(this.options.saveMissing){var z=void 0!==i.count&&"string"!=typeof i.count;this.options.saveMissingPlurals&&z?E.forEach((function(e){r.pluralResolver.getPluralFormsOfKey(e,c).forEach((function(i){return R([e],i)}))})):R(E,c)}}g=this.extendTranslation(g,e,i,f,n),T&&g===c&&this.options.appendNamespaceToMissingKey&&(g="".concat(u,":").concat(c)),T&&this.options.parseMissingKeyHandler&&(g=this.options.parseMissingKeyHandler(g))}return g}},{key:"extendTranslation",value:function extendTranslation(e,i,n,o,r){var s=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,n,o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(_objectSpread({},n,{interpolation:_objectSpread({},this.options.interpolation,n.interpolation)}));var a,c=n.interpolation&&n.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;if(c){var l=e.match(this.interpolator.nestingRegexp);a=l&&l.length}var u=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(u=_objectSpread({},this.options.interpolation.defaultVariables,u)),e=this.interpolator.interpolate(e,u,n.lng||this.language,n),c){var h=e.match(this.interpolator.nestingRegexp);a<(h&&h.length)&&(n.nest=!1)}!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return r&&r[0]===n[0]?(s.logger.warn("It seems you are nesting recursively key: ".concat(n[0]," in key: ").concat(i[0])),null):s.translate.apply(s,n.concat([i]))}),n)),n.interpolation&&this.interpolator.reset()}var d=n.postProcess||this.options.postProcess,p="string"==typeof d?[d]:d;return null!=e&&p&&p.length&&!1!==n.applyPostProcessor&&(e=f.handle(p,e,i,this.options&&this.options.postProcessPassResolved?_objectSpread({i18nResolved:o},n):n,this)),e}},{key:"resolve",value:function resolve(e){var i,n,o,r,s,a=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!a.isValidLookup(i)){var l=a.extractFromKey(e,c),u=l.key;n=u;var h=l.namespaces;a.options.fallbackNS&&(h=h.concat(a.options.fallbackNS));var d=void 0!==c.count&&"string"!=typeof c.count,p=void 0!==c.context&&"string"==typeof c.context&&""!==c.context,f=c.lngs?c.lngs:a.languageUtils.toResolveHierarchy(c.lng||a.language,c.fallbackLng);h.forEach((function(e){a.isValidLookup(i)||(s=e,!g["".concat(f[0],"-").concat(e)]&&a.utils&&a.utils.hasLoadedNamespace&&!a.utils.hasLoadedNamespace(s)&&(g["".concat(f[0],"-").concat(e)]=!0,a.logger.warn('key "'.concat(n,'" for languages "').concat(f.join(", "),'" won\'t get resolved as namespace "').concat(s,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((function(n){if(!a.isValidLookup(i)){r=n;var s,l,h=u,f=[h];if(a.i18nFormat&&a.i18nFormat.addLookupKeys)a.i18nFormat.addLookupKeys(f,u,n,e,c);else d&&(s=a.pluralResolver.getSuffix(n,c.count)),d&&p&&f.push(h+s),p&&f.push(h+="".concat(a.options.contextSeparator).concat(c.context)),d&&f.push(h+=s);for(;l=f.pop();)a.isValidLookup(i)||(o=l,i=a.getResource(n,e,l,c))}})))}))}})),{res:i,usedKey:n,exactUsedKey:o,usedLng:r,usedNS:s}}},{key:"isValidLookup",value:function isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function getResource(e,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,i,n,o):this.resourceStore.getResource(e,i,n,o)}}]),Translator}(u);function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}var y=function(){function LanguageUtil(e){Object(s.a)(this,LanguageUtil),this.options=e,this.whitelist=this.options.supportedLngs||!1,this.supportedLngs=this.options.supportedLngs||!1,this.logger=l.create("languageUtils")}return Object(a.a)(LanguageUtil,[{key:"getScriptPartFromCode",value:function getScriptPartFromCode(e){if(!e||e.indexOf("-")<0)return null;var i=e.split("-");return 2===i.length?null:(i.pop(),"x"===i[i.length-1].toLowerCase()?null:this.formatLanguageCode(i.join("-")))}},{key:"getLanguagePartFromCode",value:function getLanguagePartFromCode(e){if(!e||e.indexOf("-")<0)return e;var i=e.split("-");return this.formatLanguageCode(i[0])}},{key:"formatLanguageCode",value:function formatLanguageCode(e){if("string"==typeof e&&e.indexOf("-")>-1){var i=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),i.indexOf(n[1].toLowerCase())>-1&&(n[1]=capitalize(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),i.indexOf(n[1].toLowerCase())>-1&&(n[1]=capitalize(n[1].toLowerCase())),i.indexOf(n[2].toLowerCase())>-1&&(n[2]=capitalize(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isWhitelisted",value:function isWhitelisted(e){return this.logger.deprecate("languageUtils.isWhitelisted",'function "isWhitelisted" will be renamed to "isSupportedCode" in the next major - please make sure to rename it\'s usage asap.'),this.isSupportedCode(e)}},{key:"isSupportedCode",value:function isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function getBestMatchFromCodes(e){var i,n=this;return e?(e.forEach((function(e){if(!i){var o=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(o)||(i=o)}})),!i&&this.options.supportedLngs&&e.forEach((function(e){if(!i){var o=n.getLanguagePartFromCode(e);if(n.isSupportedCode(o))return i=o;i=n.options.supportedLngs.find((function(e){if(0===e.indexOf(o))return e}))}})),i||(i=this.getFallbackCodes(this.options.fallbackLng)[0]),i):null}},{key:"getFallbackCodes",value:function getFallbackCodes(e,i){if(!e)return[];if("string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!i)return e.default||[];var n=e[i];return n||(n=e[this.getScriptPartFromCode(i)]),n||(n=e[this.formatLanguageCode(i)]),n||(n=e[this.getLanguagePartFromCode(i)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function toResolveHierarchy(e,i){var n=this,o=this.getFallbackCodes(i||this.options.fallbackLng||[],e),r=[],s=function addCode(e){e&&(n.isSupportedCode(e)?r.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):"string"==typeof e&&s(this.formatLanguageCode(e)),o.forEach((function(e){r.indexOf(e)<0&&s(n.formatLanguageCode(e))})),r}}]),LanguageUtil}(),v=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","kk","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],b={1:function _(e){return Number(e>1)},2:function _(e){return Number(1!=e)},3:function _(e){return 0},4:function _(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function _(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function _(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function _(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function _(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function _(e){return Number(e>=2)},10:function _(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function _(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function _(e){return Number(e%10!=1||e%100==11)},13:function _(e){return Number(0!==e)},14:function _(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function _(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function _(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function _(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function _(e){return Number(0==e?0:1==e?1:2)},19:function _(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function _(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function _(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function _(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}};function createRules(){var e={};return v.forEach((function(i){i.lngs.forEach((function(n){e[n]={numbers:i.nr,plurals:b[i.fc]}}))})),e}var N=function(){function PluralResolver(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(s.a)(this,PluralResolver),this.languageUtils=e,this.options=i,this.logger=l.create("pluralResolver"),this.rules=createRules()}return Object(a.a)(PluralResolver,[{key:"addRule",value:function addRule(e,i){this.rules[e]=i}},{key:"getRule",value:function getRule(e){return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function needsPlural(e){var i=this.getRule(e);return i&&i.numbers.length>1}},{key:"getPluralFormsOfKey",value:function getPluralFormsOfKey(e,i){var n=this,o=[],r=this.getRule(e);return r?(r.numbers.forEach((function(r){var s=n.getSuffix(e,r);o.push("".concat(i).concat(s))})),o):o}},{key:"getSuffix",value:function getSuffix(e,i){var n=this,o=this.getRule(e);if(o){var r=o.noAbs?o.plurals(i):o.plurals(Math.abs(i)),s=o.numbers[r];this.options.simplifyPluralSuffix&&2===o.numbers.length&&1===o.numbers[0]&&(2===s?s="plural":1===s&&(s=""));var a=function returnSuffix(){return n.options.prepend&&s.toString()?n.options.prepend+s.toString():s.toString()};return"v1"===this.options.compatibilityJSON?1===s?"":"number"==typeof s?"_plural_".concat(s.toString()):a():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===o.numbers.length&&1===o.numbers[0]?a():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}return this.logger.warn("no plural rule found for: ".concat(e)),""}}]),PluralResolver}(),k=function(){function Interpolator(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,Interpolator),this.logger=l.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||function(e){return e},this.init(e)}return Object(a.a)(Interpolator,[{key:"init",value:function init(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var i=e.interpolation;this.escape=void 0!==i.escape?i.escape:i18next_escape,this.escapeValue=void 0===i.escapeValue||i.escapeValue,this.useRawValueToEscape=void 0!==i.useRawValueToEscape&&i.useRawValueToEscape,this.prefix=i.prefix?regexEscape(i.prefix):i.prefixEscaped||"{{",this.suffix=i.suffix?regexEscape(i.suffix):i.suffixEscaped||"}}",this.formatSeparator=i.formatSeparator?i.formatSeparator:i.formatSeparator||",",this.unescapePrefix=i.unescapeSuffix?"":i.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":i.unescapeSuffix||"",this.nestingPrefix=i.nestingPrefix?regexEscape(i.nestingPrefix):i.nestingPrefixEscaped||regexEscape("$t("),this.nestingSuffix=i.nestingSuffix?regexEscape(i.nestingSuffix):i.nestingSuffixEscaped||regexEscape(")"),this.nestingOptionsSeparator=i.nestingOptionsSeparator?i.nestingOptionsSeparator:i.nestingOptionsSeparator||",",this.maxReplaces=i.maxReplaces?i.maxReplaces:1e3,this.alwaysFormat=void 0!==i.alwaysFormat&&i.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function reset(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function resetRegExp(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var i="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(i,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function interpolate(e,i,n,o){var r,s,a,c=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function regexSafe(e){return e.replace(/\$/g,"$$$$")}var u=function handleFormat(e){if(e.indexOf(c.formatSeparator)<0){var r=getPathWithDefaults(i,l,e);return c.alwaysFormat?c.format(r,void 0,n):r}var s=e.split(c.formatSeparator),a=s.shift().trim(),u=s.join(c.formatSeparator).trim();return c.format(getPathWithDefaults(i,l,a),u,n,o)};this.resetRegExp();var h=o&&o.missingInterpolationHandler||this.options.missingInterpolationHandler,d=o&&o.interpolation&&o.interpolation.skipOnVariables||this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function safeValue(e){return regexSafe(e)}},{regex:this.regexp,safeValue:function safeValue(e){return c.escapeValue?regexSafe(c.escape(e)):regexSafe(e)}}].forEach((function(i){for(a=0;r=i.regex.exec(e);){if(void 0===(s=u(r[1].trim())))if("function"==typeof h){var n=h(e,r,o);s="string"==typeof n?n:""}else{if(d){s=r[0];continue}c.logger.warn("missed to pass in variable ".concat(r[1]," for interpolating ").concat(e)),s=""}else"string"==typeof s||c.useRawValueToEscape||(s=makeString(s));if(e=e.replace(r[0],i.safeValue(s)),i.regex.lastIndex=0,++a>=c.maxReplaces)break}})),e}},{key:"nest",value:function nest(e,i){var n,o,r=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=_objectSpread({},s);function handleHasOptions(e,i){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var o=e.split(new RegExp("".concat(n,"[ ]*{"))),r="{".concat(o[1]);e=o[0],r=(r=this.interpolate(r,a)).replace(/'/g,'"');try{a=JSON.parse(r),i&&(a=_objectSpread({},i,a))}catch(i){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),i),"".concat(e).concat(n).concat(r)}return delete a.defaultValue,e}for(a.applyPostProcessor=!1,delete a.defaultValue;n=this.nestingRegexp.exec(e);){var c=[],l=!1;if(n[0].includes(this.formatSeparator)&&!/{.*}/.test(n[1])){var u=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=u.shift(),c=u,l=!0}if((o=i(handleHasOptions.call(this,n[1].trim(),a),a))&&n[0]===e&&"string"!=typeof o)return o;"string"!=typeof o&&(o=makeString(o)),o||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),o=""),l&&(o=c.reduce((function(e,i){return r.format(e,i,s.lng,s)}),o.trim())),e=e.replace(n[0],o),this.regexp.lastIndex=0}return e}}]),Interpolator}();var x=function(e){function Connector(e,i,n){var o,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object(s.a)(this,Connector),o=_possibleConstructorReturn(this,_getPrototypeOf(Connector).call(this)),d&&u.call(_assertThisInitialized(o)),o.backend=e,o.store=i,o.services=n,o.languageUtils=n.languageUtils,o.options=r,o.logger=l.create("backendConnector"),o.state={},o.queue=[],o.backend&&o.backend.init&&o.backend.init(n,r.backend,r),o}return _inherits(Connector,e),Object(a.a)(Connector,[{key:"queueLoad",value:function queueLoad(e,i,n,o){var r=this,s=[],a=[],c=[],l=[];return e.forEach((function(e){var o=!0;i.forEach((function(i){var c="".concat(e,"|").concat(i);!n.reload&&r.store.hasResourceBundle(e,i)?r.state[c]=2:r.state[c]<0||(1===r.state[c]?a.indexOf(c)<0&&a.push(c):(r.state[c]=1,o=!1,a.indexOf(c)<0&&a.push(c),s.indexOf(c)<0&&s.push(c),l.indexOf(i)<0&&l.push(i)))})),o||c.push(e)})),(s.length||a.length)&&this.queue.push({pending:a,loaded:{},errors:[],callback:o}),{toLoad:s,pending:a,toLoadLanguages:c,toLoadNamespaces:l}}},{key:"loaded",value:function loaded(e,i,n){var o=e.split("|"),r=o[0],s=o[1];i&&this.emit("failedLoading",r,s,i),n&&this.store.addResourceBundle(r,s,n),this.state[e]=i?-1:2;var loaded={};this.queue.forEach((function(n){!function pushPath(e,i,n,o){var r=getLastOfPath(e,i,Object),s=r.obj,a=r.k;s[a]=s[a]||[],o&&(s[a]=s[a].concat(n)),o||s[a].push(n)}(n.loaded,[r],s),function remove(e,i){for(var n=e.indexOf(i);-1!==n;)e.splice(n,1),n=e.indexOf(i)}(n.pending,e),i&&n.errors.push(i),0!==n.pending.length||n.done||(Object.keys(n.loaded).forEach((function(e){loaded[e]||(loaded[e]=[]),n.loaded[e].length&&n.loaded[e].forEach((function(i){loaded[e].indexOf(i)<0&&loaded[e].push(i)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",loaded),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function read(e,i,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,a=arguments.length>5?arguments[5]:void 0;return e.length?this.backend[n](e,i,(function(c,l){c&&l&&r<5?setTimeout((function(){o.read.call(o,e,i,n,r+1,2*s,a)}),s):a(c,l)})):a(null,{})}},{key:"prepareLoading",value:function prepareLoading(e,i){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof i&&(i=[i]);var s=this.queueLoad(e,i,o,r);if(!s.toLoad.length)return s.pending.length||r(),null;s.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function load(e,i,n){this.prepareLoading(e,i,{},n)}},{key:"reload",value:function reload(e,i,n){this.prepareLoading(e,i,{reload:!0},n)}},{key:"loadOne",value:function loadOne(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=e.split("|"),r=o[0],s=o[1];this.read(r,s,"read",void 0,void 0,(function(o,a){o&&i.logger.warn("".concat(n,"loading namespace ").concat(s," for language ").concat(r," failed"),o),!o&&a&&i.logger.log("".concat(n,"loaded namespace ").concat(s," for language ").concat(r),a),i.loaded(e,o,a)}))}},{key:"saveMissing",value:function saveMissing(e,i,n,o,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(i)?this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(i,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=n&&""!==n&&(this.backend&&this.backend.create&&this.backend.create(e,i,n,o,null,_objectSpread({},s,{isUpdate:r})),e&&e[0]&&this.store.addResource(e[0],i,n,o))}}]),Connector}(u);function get(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,whitelist:!1,nonExplicitWhitelist:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function handle(e){var i={};if("object"===Object(o.a)(e[1])&&(i=e[1]),"string"==typeof e[1]&&(i.defaultValue=e[1]),"string"==typeof e[2]&&(i.tDescription=e[2]),"object"===Object(o.a)(e[2])||"object"===Object(o.a)(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){i[e]=n[e]}))}return i},interpolation:{escapeValue:!0,format:function format(e,i,n,o){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!1}}}function transformOptions(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.whitelist&&(e.whitelist&&e.whitelist.indexOf("cimode")<0&&(e.whitelist=e.whitelist.concat(["cimode"])),e.supportedLngs=e.whitelist),e.nonExplicitWhitelist&&(e.nonExplicitSupportedLngs=e.nonExplicitWhitelist),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function noop(){}var w=new(function(e){function I18n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(Object(s.a)(this,I18n),e=_possibleConstructorReturn(this,_getPrototypeOf(I18n).call(this)),d&&u.call(_assertThisInitialized(e)),e.options=transformOptions(i),e.services={},e.logger=l,e.modules={external:[]},n&&!e.isInitialized&&!i.isClone){if(!e.options.initImmediate)return e.init(i,n),_possibleConstructorReturn(e,_assertThisInitialized(e));setTimeout((function(){e.init(i,n)}),0)}return e}return _inherits(I18n,e),Object(a.a)(I18n,[{key:"init",value:function init(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;function createClassOnDemand(e){return e?"function"==typeof e?new e:e:null}if("function"==typeof i&&(n=i,i={}),i.whitelist&&!i.supportedLngs&&this.logger.deprecate("whitelist",'option "whitelist" will be renamed to "supportedLngs" in the next major - please make sure to rename this option asap.'),i.nonExplicitWhitelist&&!i.nonExplicitSupportedLngs&&this.logger.deprecate("whitelist",'options "nonExplicitWhitelist" will be renamed to "nonExplicitSupportedLngs" in the next major - please make sure to rename this option asap.'),this.options=_objectSpread({},get(),this.options,transformOptions(i)),this.format=this.options.interpolation.format,n||(n=noop),!this.options.isClone){this.modules.logger?l.init(createClassOnDemand(this.modules.logger),this.options):l.init(null,this.options);var o=new y(this.options);this.store=new p(this.options.resources,this.options);var r=this.services;r.logger=l,r.resourceStore=this.store,r.languageUtils=o,r.pluralResolver=new N(o,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),r.interpolator=new k(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new x(createClassOnDemand(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",(function(i){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];e.emit.apply(e,[i].concat(o))})),this.modules.languageDetector&&(r.languageDetector=createClassOnDemand(this.modules.languageDetector),r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=createClassOnDemand(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new m(this.services,this.options),this.translator.on("*",(function(i){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];e.emit.apply(e,[i].concat(o))})),this.modules.external.forEach((function(i){i.init&&i.init(e)}))}this.modules.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");var s=["getResource","addResource","addResources","addResourceBundle","removeResourceBundle","hasResourceBundle","getResourceBundle","getDataByLanguage"];s.forEach((function(i){e[i]=function(){var n;return(n=e.store)[i].apply(n,arguments)}}));var a=defer(),c=function load(){e.changeLanguage(e.options.lng,(function(i,o){e.isInitialized=!0,e.logger.log("initialized",e.options),e.emit("initialized",e.options),a.resolve(o),n(i,o)}))};return this.options.resources||!this.options.initImmediate?c():setTimeout(c,0),a}},{key:"loadResources",value:function loadResources(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:noop,o=n,r="string"==typeof e?e:this.language;if("function"==typeof e&&(o=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase())return o();var s=[],a=function append(e){e&&i.services.languageUtils.toResolveHierarchy(e).forEach((function(e){s.indexOf(e)<0&&s.push(e)}))};if(r)a(r);else{var c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.forEach((function(e){return a(e)}))}this.options.preload&&this.options.preload.forEach((function(e){return a(e)})),this.services.backendConnector.load(s,this.options.ns,o)}else o(null)}},{key:"reloadResources",value:function reloadResources(e,i,n){var o=defer();return e||(e=this.languages),i||(i=this.options.ns),n||(n=noop),this.services.backendConnector.reload(e,i,(function(e){o.resolve(),n(e)})),o}},{key:"use",value:function use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&f.addPostProcessor(e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"changeLanguage",value:function changeLanguage(e,i){var n=this;this.isLanguageChangingTo=e;var o=defer();this.emit("languageChanging",e);var r=function setLng(e){var r="string"==typeof e?e:n.services.languageUtils.getBestMatchFromCodes(e);r&&(n.language||(n.language=r,n.languages=n.services.languageUtils.toResolveHierarchy(r)),n.translator.language||n.translator.changeLanguage(r),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage(r)),n.loadResources(r,(function(e){!function done(e,r){r?(n.language=r,n.languages=n.services.languageUtils.toResolveHierarchy(r),n.translator.changeLanguage(r),n.isLanguageChangingTo=void 0,n.emit("languageChanged",r),n.logger.log("languageChanged",r)):n.isLanguageChangingTo=void 0,o.resolve((function(){return n.t.apply(n,arguments)})),i&&i(e,(function(){return n.t.apply(n,arguments)}))}(e,r)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(r):r(e):r(this.services.languageDetector.detect()),o}},{key:"getFixedT",value:function getFixedT(e,i){var n=this,r=function fixedT(e,i){var r;if("object"!==Object(o.a)(i)){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];r=n.options.overloadTranslationOptionHandler([e,i].concat(a))}else r=_objectSpread({},i);return r.lng=r.lng||fixedT.lng,r.lngs=r.lngs||fixedT.lngs,r.ns=r.ns||fixedT.ns,n.t(e,r)};return"string"==typeof e?r.lng=e:r.lngs=e,r.ns=i,r}},{key:"t",value:function t(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function exists(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function setDefaultNamespace(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function hasLoadedNamespace(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var o=this.languages[0],r=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===o.toLowerCase())return!0;var a=function loadNotPending(e,n){var o=i.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===o||2===o};if(n.precheck){var c=n.precheck(this,a);if(void 0!==c)return c}return!!this.hasResourceBundle(o,e)||(!this.services.backendConnector.backend||!(!a(o,e)||r&&!a(s,e)))}},{key:"loadNamespaces",value:function loadNamespaces(e,i){var n=this,o=defer();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){o.resolve(),i&&i(e)})),o):(i&&i(),Promise.resolve())}},{key:"loadLanguages",value:function loadLanguages(e,i){var n=defer();"string"==typeof e&&(e=[e]);var o=this.options.preload||[],r=e.filter((function(e){return o.indexOf(e)<0}));return r.length?(this.options.preload=o.concat(r),this.loadResources((function(e){n.resolve(),i&&i(e)})),n):(i&&i(),Promise.resolve())}},{key:"dir",value:function dir(e){if(e||(e=this.languages&&this.languages.length>0?this.languages[0]:this.language),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>=0?"rtl":"ltr"}},{key:"createInstance",value:function createInstance(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;return new I18n(e,i)}},{key:"cloneInstance",value:function cloneInstance(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:noop,o=_objectSpread({},this.options,i,{isClone:!0}),r=new I18n(o),s=["store","services","language"];return s.forEach((function(i){r[i]=e[i]})),r.services=_objectSpread({},this.services),r.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r.translator=new m(r.services,r.options),r.translator.on("*",(function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];r.emit.apply(r,[e].concat(n))})),r.init(o,n),r.translator.options=r.options,r.translator.backendConnector.services.utils={hasLoadedNamespace:r.hasLoadedNamespace.bind(r)},r}}]),I18n}(u));i.a=w},77:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=n(442);i.PacketHandler=o.PacketHandler;var r=n(451);i.Packet=r.Packet,i.PBpacket=r.PBpacket;var s=n(25);i.Buffer=s.Buffer},93:function(e,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});const o=n(5),r=n(372),s=n(134),a=n(107);class BaseConfigObject extends r.default{constructor(e,i){super(e),this._fork=!1,this.parentObject=i,this.type=s.default.NODE_T.indexOf(this.className)}renewId(e){const i=this.id,n=e||a.default.genId(),o=[];for(const e of this.children)o.push(e.id);this.unlink(),this.id=n,this.cap.removeObjectById(i),this.cap.getObject(this.id)||this.cap.addObject(this);for(const e of o){const i=this.cap.getObject(e);i&&(i.parent=n,i.renewId())}}copyId(e){this.id=e}get children(){return void 0===this.cap.getChildrenList&&console.log("this cap getChildrenList ===>",this),this.cap.getChildrenList(this.id)}get isFork(){return this._fork}set isFork(e){this._fork=e}ignore(){for(const e of this.children)e.ignore()}preSerialize(){}serialize(e){if(this.cap.ignoreList.get(this.id))return;this.findMyContainer(e).push(this.createProtocolObject())}deserialize(e){if(e){if(e.hasOwnProperty("node")){const i=e.node;i&&this.setNode(i)}e.version&&(this.version=e.version),e.isMoss&&(this.isMoss=e.isMoss),this.cap.addObject(this)}}findMyContainer(e){throw new Error("Subclass must override this method! BaseConfigObject::findMyContainer")}createProtocolObject(){throw new Error("Subclass must override this method! BaseConfigObject::createProtocolObject")}appendNode(e){if(e.parent!==this.id)throw new Error(`${this.className}.appendNode(): I am not parent of Object[${e.className}.${e.id}].`)}removeNode(e){if(e.parent!==this.id)throw new Error(`${this.className}.removeNode(): I am not parent of Object[${e.className}.${e.id}].`)}link(){const e=this.parentObject;e&&e.appendNode(this)}unlink(){const e=this.parentObject;e&&e.removeNode(this)}destroy(){for(const e of this.children)e&&e.destroy();this.cap.removeObject(this),super.destroy()}geneSequence(){return this.className}duplicate(e){this.name=e.name}}i.BaseConfigObject=BaseConfigObject;i.EntityNode=class EntityNode extends BaseConfigObject{findMyContainer(e){return Array.isArray(e.entity)||(e.entity=[]),e.entity}createProtocolObject(){const e=o.op_gameconfig_01.Entity.create();return e.node=this.makeNode(),e.version=this.version,e}}}}]);