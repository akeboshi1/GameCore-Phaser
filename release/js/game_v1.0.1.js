(this.webpackJsonpTooqingCore=this.webpackJsonpTooqingCore||[]).push([[0],[,,function(t,e,i){"use strict";i.r(e);var r,n=i(31),s=(i(56),i(7)),a=i(5),o=i(21);!function(t){t.log=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.log.apply(console,[t].concat(e))},t.error=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.error.apply(console,[t].concat(e))},t.warn=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.warn.apply(console,[t].concat(e))},t.debug=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.log.apply(console,[t].concat(e))},t.info=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.info.apply(console,[t].concat(e))}}(r||(r={}));var h=i(86),l=i.n(h);for(var c in a)s.PBpacket.addProtocol(a[c]);var u,p,d,f=function(){function t(t){this.mPacketHandlers=[],this.mReConnectCount=0,this.mListener=t}return t.prototype.startConnect=function(t,e){this.mCachedServerAddress=t;try{this.mWorker=new l.a,this._doConnect()}catch(t){throw new Error("startConnect Error: "+t)}},t.prototype.closeConnect=function(){},t.prototype.addPacketListener=function(t){this.mPacketHandlers.push(t)},t.prototype.send=function(t){if(!this.mWorker)throw new Error("NetWorker is undefined.");this.mWorker.postMessage({method:"send",buffer:t.Serialization()})},t.prototype.removePacketListener=function(t){var e=this.mPacketHandlers.indexOf(t);-1!==e&&this.mPacketHandlers.splice(e,1)},t.prototype._doConnect=function(){r.info("_doConnect ",this.mCachedServerAddress);var t=this;this.mWorker&&(this.mWorker.onmessage=function(e){t.onWorkerMessage(e.data)},this.mWorker.postMessage({method:"connect",address:t.mCachedServerAddress}))},t.prototype.onWorkerMessage=function(t){var e=this;switch(t.method){case"onConnected":this.mReConnectCount=0,this.mListener.onConnected();break;case"onDisConnected":if(!this.mTimeout){this.mReConnectCount<10&&this.mReConnectCount++;var i=Math.pow(this.mReConnectCount,2);r.info("ReConnect: delay = "+1e3*i+"[c/"+this.mReConnectCount+"]"),this.mTimeout=setTimeout(function(){e.mTimeout=void 0,e._doConnect()},1e3*i)}break;case"onConnectError":break;case"onData":var n=t.buffer;n&&this._onData(n)}},t.prototype._onData=function(t){var e=new s.PBpacket;e.Deserialization(new o.Buffer(t)),this.mPacketHandlers.forEach(function(t){t.onPacketArrived(e)})},t}(),m=(u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),g=function(t){function e(){return t.call(this,{key:e.name})||this}return m(e,t),e.prototype.preload=function(){this.load.spritesheet("rabbit00.png","./resources/rabbit00.png",{frameWidth:150,frameHeight:150})},e.prototype.init=function(t){this.mWorld=t.world},e.prototype.create=function(){var t=this.scale.gameSize.width,e=this.scale.gameSize.height,i=this.add.graphics();i.fillStyle(6381921),i.fillRect(0,0,t,e),this.anims.create({key:"loading_rabbit00",frames:this.anims.generateFrameNumbers("rabbit00.png",{start:0,end:59}),frameRate:33,yoyo:!0,repeat:-1});var r=t-150-25,n=e-150-25,s=this.add.sprite(r,n,"rabbit00.png");s.anims.play("loading_rabbit00"),s.scaleX=s.scaleY=this.mWorld.uiScale},e.prototype.awake=function(){this.scene.wake()},e.prototype.sleep=function(){this.scene.sleep()},e.prototype.getKey=function(){return this.sys.config.key},e}(Phaser.Scene),_=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),v=function(t){function e(){return t.call(this,{key:e.name})||this}return _(e,t),e.prototype.preload=function(){},e.prototype.init=function(t){this.mRoom=t.room},e.prototype.create=function(){this.fps=this.add.text(10,10,"");var t=this.mRoom.world;t.game.device.os.desktop||t.inputManager.setScene(this),t.uiManager.setScene(this)},e.prototype.update=function(){this.fps.setText(this.game.loop.actualFps.toFixed())},e.prototype.getKey=function(){return this.sys.config.key},e}(Phaser.Scene),b=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),P=function(t){function e(i){return t.call(this,i||{key:e.name})||this}return b(e,t),e.prototype.preload=function(){},e.prototype.init=function(t){t&&(this.mCallBack=t.callBack,this.mRoom=t.room)},e.prototype.create=function(){this.mCallBack&&this.mCallBack(),this.scene.launch(v.name,{room:this.mRoom}),r.log("play created"),this.scene.sendToBack()},e.prototype.update=function(t,e){this.mRoom&&this.mRoom.update(t,e)},e.prototype.getKey=function(){return this.sys.config.key},e}(Phaser.Scene),T=function(){function t(){}return t.getRes=function(t){return Object({api_root:"https://api.tooqing.com/",osd:"https://osd.tooqing.com/",gateway:Object({host:"115.182.75.100",port:12100}),game_id:"5d7201c785d8f75077fa0c71",virtual_world_id:0}).BUNDLE_RESOURCES_ROOT?Object({api_root:"https://api.tooqing.com/",osd:"https://osd.tooqing.com/",gateway:Object({host:"115.182.75.100",port:12100}),game_id:"5d7201c785d8f75077fa0c71",virtual_world_id:0}).BUNDLE_RESOURCES_ROOT+t:"./resources/"+t},t.getOsdRes=function(t){return"https://osd.tooqing.com/"+t},t}(),S=function(){function t(){}return t.getPartName=function(t){return t+"_png"},t.getPartUrl=function(t){return"https://osd.tooqing.com/avatar/part/"+t+".png"},t.getGameConfig=function(t){return"https://osd.tooqing.com/"+t},t}(),O=function(){function t(t,e,i,r){this.x=0|t,this.y=0|e,this.z=0|i,this.depth=0|r}return t.prototype.add=function(t,e,i){return this.x+=t,this.x+=e,this.z+=i||0,this},t.prototype.equal=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.depth===this.depth},t.prototype.toString=function(){return"Pos >> x: "+this.x+", y: "+this.y+", z: "+this.z+", depth: "+this.depth},t}(),C=function(){function t(){}return t.transformTo90=function(t,e){var i=e.sceneWidth/2;return new O((t.x-t.y)*(e.tileWidth>>1)+i,(t.x+t.y)*(e.tileHeight>>1))},t.transformTo45=function(t,e){var i=e.sceneWidth/2-e.tileWidth/2;return new O(Math.floor((t.y+t.z)/e.tileHeight+(t.x-i)/e.tileWidth),Math.floor((t.y+t.z)/e.tileHeight-(t.x-i)/e.tileWidth))},t}(),D=function(){function t(){this.mLeft=new O,this.mRight=new O,this.mTop=new O,this.mBottom=new O}return t.prototype.setArea=function(t){if(!(!t||t.length<1||t[0].length<0)){var e=t[0].length,i=t.length,r={rows:e,cols:i,tileWidth:30,tileHeight:15,sceneWidth:15*(e+i),sceneHeight:7.5*(e+i)};this.mTop=C.transformTo90(new O(0,0),r),this.mLeft=C.transformTo90(new O(0,t.length-1),r).add(-15,0),this.mRight=C.transformTo90(new O(t.length-1,0),r).add(15,0),this.mBottom=C.transformTo90(new O(t[0].length-1,t.length-1),r).add(0,7)}},Object.defineProperty(t.prototype,"left",{get:function(){return this.mLeft},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.mRight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.mTop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.mBottom},enumerable:!0,configurable:!0}),t}(),w=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){t.BodyCostDres="body_cost_$_dres",t.BodyCost="body_cost_$",t.BodyTail="body_tail_$",t.BodyWing="body_wing_$",t.BodyBase="body_base_$",t.BodySpec="body_spec_$",t.FlegSpec="fleg_spec_$",t.FlegBase="fleg_base_$",t.FlegCost="fleg_cost_$",t.BarmSpec="barm_spec_$",t.BarmBase="barm_base_$",t.BarmCost="barm_cost_$",t.WeapBarm="weap_barm_$",t.ShldBarm="shld_barm_$",t.BlegSpec="bleg_spec_$",t.BlegBase="bleg_base_$",t.BlegCost="bleg_cost_$",t.FarmSpec="farm_spec_$",t.FarmBase="farm_base_$",t.FarmCost="farm_cost_$",t.ShldFarm="shld_farm_$",t.WeapFarm="weap_farm_$",t.HeadSpec="head_spec_$",t.HeadMask="head_mask_$",t.HeadEyes="head_eyes_$",t.HeadBase="head_base_$",t.HeadHairBack="head_hair_$_back",t.HeadMous="head_mous_$",t.HeadHair="head_hair_$",t.HeadHats="head_hats_$"}(p||(p={})),function(t){t.BarmBase="barm_base_#_$",t.BarmCost="barm_cost_#_$",t.BarmSpec="barm_spec_#_$",t.BlegBase="bleg_base_#_$",t.BlegCost="bleg_cost_#_$",t.BlegSpec="bleg_spec_#_$",t.BodyBase="body_base_#_$",t.BodyCost="body_cost_#_$",t.BodyCostDres="body_cost_#_$_dres",t.BodySpec="body_spec_#_$",t.BodyTail="body_tail_#_$",t.BodyWing="body_wing_#_$",t.FarmBase="farm_base_#_$",t.FarmCost="farm_cost_#_$",t.FarmSpec="farm_spec_#_$",t.FlegBase="fleg_base_#_$",t.FlegCost="fleg_cost_#_$",t.FlegSpec="fleg_spec_#_$",t.HeadBase="head_base_#_$",t.HeadEyes="head_eyes_#_$",t.HeadHair="head_hair_#_$",t.HeadHairBack="head_hair_#_$_back",t.HeadHats="head_hats_#_$",t.HeadMask="head_mask_#_$",t.HeadMous="head_mous_#_$",t.HeadSpec="head_spec_#_$",t.ShldFarm="shld_farm_#_$",t.WeapFarm="weap_farm_#_$",t.ShldBarm="shld_barm_#_$",t.WeapBarm="weap_barm_#_$"}(d||(d={}));var A,E=function(t){function e(e){var i=t.call(this,e)||this;return i.scene=e,i.mAnimationName="Armature",i.mDragonbonesName="",i.mActionName="",i.mSortRectangle=new D,i.replaceArr=[],i.misloading=!1,i.mloadingList=[],i.mBaseLoc=new Phaser.Geom.Point,i}return w(e,t),Object.defineProperty(e.prototype,"GameObject",{get:function(){return this},enumerable:!0,configurable:!0}),e.prototype.changeAlpha=function(t){},e.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this)},e.prototype.load=function(t){this.mDisplayInfo=t,this.mDisplayInfo&&(this.dragonBonesName="bones_human01",this.scene.cache.obj.has(this.dragonBonesName))},e.prototype.loadEff=function(t,e){var i,n;if(void 0===e&&(e=!1),(i=t)&&(e?(this.backEffDisplayInfo=i,n=this.backEffKey):(this.frontEffDisplayInfo=i,n=this.frontEffKey),n))if(this.scene.cache.obj.has(n))e?this.onLoadBackEffCompleteHandler():this.onLoadFrontEffCompleteHandler();else{var s=i.display;s?(this.scene.load.atlas(n,"https://osd.tooqing.com/"+s.texturePath,"https://osd.tooqing.com/"+s.dataPath),e?this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadBackEffCompleteHandler,this):this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadFrontEffCompleteHandler,this),this.scene.load.start()):r.error("display is undefined")}},e.prototype.getDisplay=function(){return this.mArmatureDisplay},e.prototype.play=function(t){if(this.mActionName!==t){var e=void 0!==this.mDisplayInfo?this.mDisplayInfo.avatarDir:3,i="";3===(e=0!==e?e:3)||5===e?this.scaleX=4-e:1!==e&&7!==e||(this.scaleX=-1/3*e+4/3,i="_back"),this.mActionName=t+i,this.mArmatureDisplay&&this.mArmatureDisplay.animation.play(this.mActionName)}},e.prototype.playFrontEff=function(t){var e=this;this.makeEffAnimations(t,!1),this.mFrontEffSprite.on("animationcomplete",function(){e.mFrontEffSprite.destroy()}),this.mFrontEffSprite.play(this.frontEffDisplayInfo.type+"_"+t)},e.prototype.playBackEff=function(t){var e=this;this.makeEffAnimations(t,!0),this.mBackEffSprite.on("animationcomplete",function(){e.mBackEffSprite.destroy()}),this.mBackEffSprite.play(this.frontEffDisplayInfo.type+"_"+t)},e.prototype.fadeIn=function(t){this.clearFadeTween(),this.alpha=0,this.mFadeTween=this.scene.tweens.add({targets:this,alpha:1,duration:1200,onComplete:function(){t&&t()}})},e.prototype.fadeOut=function(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:function(){t&&t()}})},e.prototype.destroy=function(){this.mDisplayInfo=null,this.mArmatureDisplay&&(this.mArmatureDisplay.dispose(!0),this.mArmatureDisplay=null),this.mClickGraphics&&(this.mClickGraphics.clear(),this.mClickGraphics.destroy(!0),this.mClickGraphics=null),this.mClickCon&&(this.mClickCon.destroy(!0),this.mClickCon=null),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=null),t.prototype.destroy.call(this)},e.prototype.buildDragbones=function(){if(this.scene.cache.custom.dragonbone.get(this.mDragonbonesName))this.onLoadCompleteHandler();else{var t="./resources/dragonbones";this.scene.load.dragonbone(this.mDragonbonesName,t+"/"+this.mDragonbonesName+"_tex.png",t+"/"+this.mDragonbonesName+"_tex.json",t+"/"+this.mDragonbonesName+"_ske.dbbin",null,null,{responseType:"arraybuffer"}),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.scene.load.start()}},e.prototype.onLoadCompleteHandler=function(t,e,i){this.mArmatureDisplay&&this.mArmatureDisplay.dbClear(),this.mArmatureDisplay=this.scene.add.armature(this.mAnimationName,this.dragonBonesName),this.clearArmature(),this.getReplaceArr(),this.showReplaceArmatrue(),this.mArmatureDisplay.x=this.mBaseLoc.x,this.mArmatureDisplay.y=this.mBaseLoc.y,this.add(this.mArmatureDisplay);var r=new Phaser.Geom.Rectangle(0,0,50,70);this.mClickGraphics||(this.mClickGraphics=this.scene.add.graphics(),this.mClickGraphics.fillStyle(16711680),this.mClickGraphics.fillRectShape(r),this.mClickGraphics.visible=!1,this.add(this.mClickGraphics)),this.mClickCon||(this.mClickCon=this.scene.add.container(0,0,this.mClickGraphics),this.mClickCon.setInteractive(r,Phaser.Geom.Rectangle.Contains),this.mClickCon.x=-r.width>>1,this.mClickCon.y=-r.height),this.setData("id",this.mDisplayInfo.id),this.add(this.mClickCon),this.emit("initialized")},e.prototype.onLoadFrontEffCompleteHandler=function(){this.mFrontEffSprite?this.mFrontEffSprite.setTexture(this.frontEffKey):(this.mFrontEffSprite=this.scene.make.sprite(void 0,!1).setOrigin(0,0),this.addAt(this.mFrontEffSprite,2)),this.playFrontEff(this.frontEffDisplayInfo.animationName),this.emit("frontEffinitialized")},e.prototype.onLoadBackEffCompleteHandler=function(){this.mBackEffSprite?this.mBackEffSprite.setTexture(this.backEffKey):(this.mBackEffSprite=this.scene.make.sprite(void 0,!1).setOrigin(0,0),this.addAt(this.mBackEffSprite,0)),this.playBackEff(this.backEffDisplayInfo.animationName),this.emit("backEffinitialized")},e.prototype.clearArmature=function(){for(var t=this.mArmatureDisplay.armature.getSlots(),e=t.length,i=0;i<e;i++){t[i].display.visible=!1}},e.prototype.clearReplaceArmature=function(){if(this.mArmatureDisplay.armature.animation.stop(),this.replaceArr&&0!==this.replaceArr.length)for(var t=this.replaceArr.length,e=0;e<t;e++){var i=this.replaceArr[e].slot.replace("$",this.replaceArr[e].dir.toString());this.mArmatureDisplay.armature.getSlot(i).replaceDisplay(null)}},e.prototype.showReplaceArmatrue=function(){for(var t=0,e=this.replaceArr;t<e.length;t++){var i=e[t];this.replacePartDisplay(i.slot,i.part,i.dir,i.skin);i.slot.replace("$",i.dir.toString())}this.replaceArr.splice(0)},e.prototype.getReplaceArr=function(){this.replaceArr.length=0;var t=this.mDisplayInfo.avatar;t.bodyBaseId&&(this.replaceArr.push({slot:p.BodyBase,part:d.BodyBase,dir:3,skin:t.bodyBaseId}),this.replaceArr.push({slot:p.BodyBase,part:d.BodyBase,dir:1,skin:t.bodyBaseId})),t.bodySpecId&&(this.replaceArr.push({slot:p.BodySpec,part:d.BodySpec,dir:3,skin:t.bodySpecId}),this.replaceArr.push({slot:p.BodySpec,part:d.BodySpec,dir:1,skin:t.bodySpecId})),t.bodyWingId&&(this.replaceArr.push({slot:p.BodyWing,part:d.BodyWing,dir:3,skin:t.bodyWingId}),this.replaceArr.push({slot:p.BodyWing,part:d.BodyWing,dir:1,skin:t.bodyWingId})),t.bodyTailId&&(this.replaceArr.push({slot:p.BodyTail,part:d.BodyTail,dir:3,skin:t.bodyTailId}),this.replaceArr.push({slot:p.BodyTail,part:d.BodyTail,dir:1,skin:t.bodyTailId})),t.bodyCostId&&(this.replaceArr.push({slot:p.BodyCost,part:d.BodyCost,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:p.BodyCost,part:d.BodyCost,dir:1,skin:t.bodyCostId}),this.replaceArr.push({slot:p.BodyCostDres,part:d.BodyCostDres,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:p.BodyCostDres,part:d.BodyCostDres,dir:1,skin:t.bodyCostId})),t.farmBaseId&&(this.replaceArr.push({slot:p.FarmBase,part:d.FarmBase,dir:3,skin:t.farmBaseId}),this.replaceArr.push({slot:p.FarmBase,part:d.FarmBase,dir:1,skin:t.farmBaseId})),t.farmSpecId&&(this.replaceArr.push({slot:p.FarmSpec,part:d.FarmSpec,dir:3,skin:t.farmSpecId}),this.replaceArr.push({slot:p.FarmSpec,part:d.FarmSpec,dir:1,skin:t.farmSpecId})),t.farmCostId&&(this.replaceArr.push({slot:p.FarmCost,part:d.FarmCost,dir:3,skin:t.farmCostId}),this.replaceArr.push({slot:p.FarmCost,part:d.FarmCost,dir:1,skin:t.farmCostId})),t.barmBaseId&&(this.replaceArr.push({slot:p.BarmBase,part:d.BarmBase,dir:3,skin:t.barmBaseId}),this.replaceArr.push({slot:p.BarmBase,part:d.BarmBase,dir:1,skin:t.barmBaseId})),t.barmSpecId&&(this.replaceArr.push({slot:p.BarmSpec,part:d.BarmSpec,dir:3,skin:t.barmSpecId}),this.replaceArr.push({slot:p.BarmSpec,part:d.BarmSpec,dir:1,skin:t.barmSpecId})),t.barmCostId&&(this.replaceArr.push({slot:p.BarmCost,part:d.BarmCost,dir:3,skin:t.barmCostId}),this.replaceArr.push({slot:p.BarmCost,part:d.BarmCost,dir:1,skin:t.barmCostId})),t.blegBaseId&&(this.replaceArr.push({slot:p.BlegBase,part:d.BlegBase,dir:3,skin:t.blegBaseId}),this.replaceArr.push({slot:p.BlegBase,part:d.BlegBase,dir:1,skin:t.blegBaseId})),t.blegSpecId&&(this.replaceArr.push({slot:p.BlegSpec,part:d.BlegSpec,dir:3,skin:t.blegSpecId}),this.replaceArr.push({slot:p.BlegSpec,part:d.BlegSpec,dir:1,skin:t.blegSpecId})),t.blegCostId&&(this.replaceArr.push({slot:p.BlegCost,part:d.BlegCost,dir:3,skin:t.blegCostId}),this.replaceArr.push({slot:p.BlegCost,part:d.BlegCost,dir:1,skin:t.blegCostId})),t.flegBaseId&&(this.replaceArr.push({slot:p.FlegBase,part:d.FlegBase,dir:3,skin:t.flegBaseId}),this.replaceArr.push({slot:p.FlegBase,part:d.FlegBase,dir:1,skin:t.flegBaseId})),t.flegSpecId&&(this.replaceArr.push({slot:p.FlegSpec,part:d.FlegSpec,dir:3,skin:t.flegSpecId}),this.replaceArr.push({slot:p.FlegSpec,part:d.FlegSpec,dir:1,skin:t.flegSpecId})),t.flegCostId&&(this.replaceArr.push({slot:p.FlegCost,part:d.FlegCost,dir:3,skin:t.flegCostId}),this.replaceArr.push({slot:p.FlegCost,part:d.FlegCost,dir:1,skin:t.flegCostId})),t.headBaseId&&(this.replaceArr.push({slot:p.HeadBase,part:d.HeadBase,dir:3,skin:t.headBaseId}),this.replaceArr.push({slot:p.HeadBase,part:d.HeadBase,dir:1,skin:t.headBaseId})),t.barmWeapId&&(this.replaceArr.push({slot:p.WeapBarm,part:d.WeapBarm,dir:3,skin:t.barmWeapId}),this.replaceArr.push({slot:p.WeapBarm,part:d.WeapBarm,dir:1,skin:t.barmWeapId})),t.headHairId&&(this.replaceArr.push({slot:p.HeadHair,part:d.HeadHair,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:p.HeadHair,part:d.HeadHair,dir:1,skin:t.headHairId}),this.replaceArr.push({slot:p.HeadHairBack,part:d.HeadHairBack,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:p.HeadHairBack,part:d.HeadHairBack,dir:1,skin:t.headHairId})),t.headHatsId&&(this.replaceArr.push({slot:p.HeadHats,part:d.HeadHats,dir:3,skin:t.headHatsId}),this.replaceArr.push({slot:p.HeadHats,part:d.HeadHats,dir:1,skin:t.headHatsId})),t.headSpecId&&(this.replaceArr.push({slot:p.HeadSpec,part:d.HeadSpec,dir:3,skin:t.headSpecId}),this.replaceArr.push({slot:p.HeadSpec,part:d.HeadSpec,dir:1,skin:t.headSpecId})),t.headEyesId&&this.replaceArr.push({slot:p.HeadEyes,part:d.HeadEyes,dir:3,skin:t.headEyesId}),t.headMousId&&this.replaceArr.push({slot:p.HeadMous,part:d.HeadMous,dir:3,skin:t.headMousId}),t.headMaskId&&this.replaceArr.push({slot:p.HeadMask,part:d.HeadMask,dir:3,skin:t.headMaskId}),t.farmShldId&&(this.replaceArr.push({slot:p.ShldFarm,part:d.ShldFarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:p.ShldFarm,part:d.ShldFarm,dir:1,skin:t.farmShldId}),this.replaceArr.push({slot:p.ShldBarm,part:d.ShldBarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:p.ShldBarm,part:d.ShldBarm,dir:1,skin:t.farmShldId})),t.farmWeapId&&(this.replaceArr.push({slot:p.WeapFarm,part:d.WeapFarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:p.WeapFarm,part:d.WeapFarm,dir:1,skin:t.farmWeapId}),this.replaceArr.push({slot:p.WeapBarm,part:d.WeapBarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:p.WeapBarm,part:d.WeapBarm,dir:1,skin:t.farmWeapId}))},e.prototype.replacePartDisplay=function(t,e,i,r){var n=t.replace("$",i.toString()),s=this.mArmatureDisplay.armature.getSlot(n),a=e.replace("#",r.toString()).replace("$",i.toString());if(this.scene.cache.custom.dragonbone.get(this.dragonBonesName)){var o=S.getPartName(a);if(this.scene.game.cache.obj.has(o)){var h=S.getPartName(a),l=new dragonBones.phaser.display.SlotImage(this.scene,0,0,h);s.replaceDisplay(l)}else this.mloadingList.push([s.name,a]),this.misloading||(this.misloading=!0,this.startLoad())}},e.prototype.startLoad=function(){var t=this,e=this.mloadingList.shift();if(e){var i=S.getPartUrl(e[1]),r=S.getPartName(e[1]);e[1];this.scene.load.once(Phaser.Loader.Events.COMPLETE,function(i,r,n){var s=S.getPartName(e[1]),a=t.mArmatureDisplay.armature.getSlot(e[0]),o=new dragonBones.phaser.display.SlotImage(t.scene,0,0,s);o.texture.key===s&&a.replaceDisplay(o),t.misloading=!1,t.startLoad()},this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,function(e){t.misloading=!1,t.startLoad()},this),this.scene.load.image(r,i),this.scene.load.start()}else this.misloading=!1},e.prototype.makeEffAnimations=function(t,e){var i;if(void 0===e&&(e=!1),i=e?this.frontEffDisplayInfo:this.backEffDisplayInfo){i.animations;var r=e?this.frontEffKey:this.backEffKey,n=i.getAnimations(t);if(!n)return;var s=[];n.frameName.forEach(function(t){s.push({key:r,frame:t})});var a={key:i.type+"_"+n.name,frames:s,frameRate:n.frameRate,repeat:-1};this.scene.anims.create(a)}},e.prototype.clearFadeTween=function(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())},Object.defineProperty(e.prototype,"dragonBonesName",{get:function(){return this.mDragonbonesName},set:function(t){this.mDragonbonesName!==t&&(this.mDragonbonesName=t,this.buildDragbones())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseLoc",{get:function(){return this.mBaseLoc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontEffKey",{get:function(){if(this.frontEffDisplayInfo){var t=this.frontEffDisplayInfo.display;return t&&t.texturePath&&t.dataPath?t.texturePath+t.dataPath:void 0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backEffKey",{get:function(){if(this.backEffDisplayInfo){var t=this.backEffDisplayInfo.display;return t&&t.texturePath&&t.dataPath?t.texturePath+t.dataPath:void 0}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortRectangle",{get:function(){return this.mSortRectangle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortX",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortY",{get:function(){return this.y},enumerable:!0,configurable:!0}),e}(Phaser.GameObjects.Container),M=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){t[t.BACKEND=1]="BACKEND",t[t.STAGE=2]="STAGE",t[t.FRONTEND=3]="FRONTEND"}(A||(A={}));var I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mDisplayDatas=new Map,e.mSprites=new Map,e.mHasAnimation=!1,e.mSortRectangle=new D,e}return M(e,t),e.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this)},e.prototype.changeAlpha=function(t){this.alpha=t},e.prototype.setPosition=function(e,i,r){return t.prototype.setPosition.call(this,e,i,r),this.setDepth(this.x+this.baseLoc.x+this.y+this.baseLoc.y),this},e.prototype.load=function(t,e){var i=this;e=e||A.STAGE;var n=t;if(n&&n.gene&&!this.mSprites.get(e))if(this.mDisplayDatas.set(e,n),this.scene.cache.obj.has(n.gene))this.onLoadCompleted(e);else{var s=n.display;s||r.error("display is undefined"),this.scene.load.atlas(n.gene,"https://osd.tooqing.com/"+s.texturePath,"https://osd.tooqing.com/"+s.dataPath),this.scene.load.once(Phaser.Loader.Events.COMPLETE,function(){i.onLoadCompleted(e)},this),this.scene.load.start()}},e.prototype.play=function(t,e){if(t){e=e||A.STAGE;var i=this.mDisplayDatas.get(e),n=this.mSprites.get(e);if(n&&n instanceof Phaser.GameObjects.Sprite)n.play(i.gene+"_"+t);else{var s=i.getAnimations(t);if(!s)return void r.log("error: "+t+" not found");n.setTexture(i.gene,s.frameName[0])}this.initBaseLoc(e,t)}},e.prototype.fadeIn=function(t){this.alpha=0,this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:1,duration:1200,onComplete:function(){t&&t()}})},e.prototype.fadeOut=function(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:function(){t&&t()}})},e.prototype.destroy=function(){this.mSprites.forEach(function(t){return t.destroy()}),this.mSprites.clear(),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=void 0),this.mDisplayDatas.clear(),t.prototype.destroy.call(this)},e.prototype.clearFadeTween=function(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())},e.prototype.onLoadCompleted=function(t){this.makeAnimations(t),this.createDisplay(t)},e.prototype.makeAnimations=function(t){var e=this.mDisplayDatas.get(t);if(e)for(var i=0,r=Array.from(e.animations.values());i<r.length;i++){var n=r[i];this.makeAnimation(t,n)}},e.prototype.makeAnimation=function(t,e){var i=this.mDisplayDatas.get(t);if(e&&i&&i.gene&&!(e.frameName.length<=1)){var r=[];e.frameName.forEach(function(t){r.push({key:i.gene,frame:t})});var n={key:i.gene+"_"+e.name,frames:r,frameRate:e.frameRate,repeat:-1};this.mHasAnimation=!0,this.scene.anims.create(n)}},e.prototype.initBaseLoc=function(t,e){var i=this.mDisplayDatas.get(t),r=this.mSprites.get(t);if(r&&i&&i.animations){var n=i.getAnimations(e);n&&(this.mBaseLoc=n.baseLoc,r.x=this.baseLoc.x,r.y=this.baseLoc.y,this.mSortRectangle.setArea(n.collisionArea))}},e.prototype.createDisplay=function(t){var e=this.mDisplayDatas.get(t);if(e&&e.gene){var i=this.mSprites.get(t);i||(this.mHasAnimation?i=this.scene.make.sprite(void 0,!1).setOrigin(0,0):(i=this.scene.make.image(void 0,!1).setOrigin(0,0)).setTexture(e.gene),this.mSprites.set(t,i),this.play(e.animationName,t),i.x=this.baseLoc.x,i.y=this.baseLoc.y,this.addAt(i,t)),i.setInteractive({pixelPerfect:!0}),i.setData("id",e.id),this.mSprites.set(t,i),this.emit("initialized")}},Object.defineProperty(e.prototype,"baseLoc",{get:function(){return this.mBaseLoc||new Phaser.Geom.Point},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortRectangle",{get:function(){return this.mSortRectangle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortX",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sortY",{get:function(){return this.y},enumerable:!0,configurable:!0}),e}(Phaser.GameObjects.Container),B=function(){function t(t){this.discriminator="DragonbonesModel",t&&(this.id=t.id,this.avatar=t.avatar)}return t.prototype.setInfo=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},t.prototype.destroy=function(){},t}(),k=function(){function t(){this.mRenderable=!1}return t.prototype.setRenderable=function(t,e){var i=this;if(this.mRenderable!==t){if(e=e||0,this.mRenderable=t,t)return this.addDisplay(),void(e>0&&this.fadeIn());e>0?this.fadeOut(function(){i.removeDisplay()}):this.removeDisplay()}},t.prototype.getRenderable=function(){return this.mRenderable},t.prototype.fadeIn=function(t){this.mDisplay&&this.mDisplay.fadeIn(t)},t.prototype.fadeOut=function(t){this.mDisplay&&this.mDisplay.fadeOut(t)},t.prototype.fadeAlpha=function(t){this.mDisplay&&(this.mDisplay.alpha=t)},t.prototype.destroy=function(){this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null)},t.prototype.addDisplay=function(){},t.prototype.removeDisplay=function(){this.mDisplay&&this.mDisplay.removeFromParent()},t}(),R=function(t,e,i){this.textureKey=t,this.columns.data=e,this.columns.count=e?e.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.rows.data=i,this.rows.count=i?i.length:0,this.rows.stretch=0,this.rows.minHeight=0;var r,n,s,a,o=this.scene.textures.get(t);if(!o)return this.redraw=!0,this;if(!e||!i)return this.redraw=!0,this;for(var h=0,l=0,c=0,u=i.length;c<u;c++){"number"==typeof i[c]&&(i[c]={height:i[c],stretch:c%2}),s=(r=i[c]).height,this.rows.stretch+=0|r.stretch,this.rows.minHeight+=r.stretch>0?0:s,h=0;for(var p=0,d=e.length;p<d;p++)"number"==typeof e[p]&&(e[p]={width:e[p],stretch:p%2}),a=(n=e[p]).width,0===c&&(this.columns.stretch+=0|n.stretch,this.columns.minWidth+=n.stretch>0?0:a),a>=1&&s>=1&&this.getFrameNameCallback(p,c)&&o.add(this.getFrameNameCallback(p,c),0,h,l,a,s),h+=a;l+=s}return this.redraw=!0,this},N=function(){if(!this.redraw)return this;this.redraw=!1,this.clear();for(var t,e,i,r,n,s=this.width-this.columns.minWidth,a=this.height-this.rows.minHeight,o=this.columns.stretch>0?s/this.columns.stretch:0,h=this.rows.stretch>0?a/this.rows.stretch:0,l=0,c=0,u=0,p=this.rows.count;u<p;u++){n=0===(i=this.rows.data[u]).stretch?i.height:h*i.stretch,l=0;for(var d=0,f=this.columns.count;d<f;d++){var m;r=0===(e=this.columns.data[d]).stretch?e.width:o*e.stretch,(t=this.getFrameNameCallback(d,u))&&(0===i.stretch&&0===e.stretch?this.drawFrame(this.textureKey,t,l,c):(0===this.getStretchMode(d,u)?(void 0===this._image&&(this._image=this.scene.make.image({add:!1,origin:{x:0,y:0}})),(m=this._image).setTexture(this.textureKey,t).setDisplaySize(r,n)):(void 0===this._tileSprite&&(this._tileSprite=this.scene.make.tileSprite({add:!1,origin:{x:0,y:0}})),(m=this._tileSprite).setTexture(this.textureKey,t).setSize(r,n)),this.draw(m,l,c))),l+=r}c+=n}};const j=Phaser.Utils.Objects.IsPlainObject,L=Phaser.Utils.Objects.GetValue;var F=function(t){return"string"==typeof t&&(t=z[t]),t};const z={scale:0,repeat:1};var V=function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1},H={setTexture:R,updateTexture:N,setStretchMode:function(t){return j(t)?(this.stretchMode.edge=F(L(t,"edge",0)),this.stretchMode.internal=F(L(t,"internal",0))):(t=F(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return V.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal}},Y=function(t,e){return`${t},${e}`};const G=Phaser.GameObjects.RenderTexture,U=Phaser.Utils.Objects.IsPlainObject,W=Phaser.Utils.Objects.GetValue;class X extends G{constructor(t,e,i,r,n,s,a,o,h){U(e)?(e=W(h=e,"x",0),i=W(h,"y",0),r=W(h,"width",1),n=W(h,"height",1),s=W(h,"key",void 0),a=W(h,"columns",void 0),o=W(h,"rows",void 0)):U(r)?(r=W(h=r,"width",1),n=W(h,"height",1),s=W(h,"key",void 0),a=W(h,"columns",void 0),o=W(h,"rows",void 0)):U(s)&&(s=W(h=s,"key",void 0),a=W(h,"columns",void 0),o=W(h,"rows",void 0)),super(t,e,i,r,n),this.columns={},this.rows={},this.stretchMode={},this.redraw=!1,this._image=void 0,this._tileSprite=void 0,this.setOrigin(.5,.5),this.setGetFrameNameCallback(W(h,"getFrameNameCallback",void 0)),this.setTexture(s,a,o),this.setStretchMode(W(h,"stretchMode",0))}preDestroy(){this._image&&(this._image.destroy(),this._image=void 0),this._tileSprite&&(this._tileSprite.destroy(),this._tileSprite=void 0),super.preDestroy()}setGetFrameNameCallback(t){return void 0===t&&(t=Y),this.getFrameNameCallback=t,this}get minWidth(){return this.columns.minWidth}get minHeight(){return this.rows.minHeight}resize(t,e){return this.redraw=!0,super.resize(t,e),this.updateDisplayOrigin(),this}renderWebGL(t,e,i,r,n){this.updateTexture(),super.renderWebGL(t,e,i,r,n)}renderCanvas(t,e,i,r,n){this.updateTexture(),super.renderCanvas(t,e,i,r,n)}}Object.assign(X.prototype,H);var K,J=X,Z=function(){function t(t,e){this.mScene=t,this.mParent=e}return t.prototype.load=function(t,e,i,r){this.mLoadCompleteCallBack=i,this.mLoadContext=r,this.mConfig=e,this.mUrl=t,this.mScene.cache.obj.get(t)?this.onLoadCompleteHandler():(this.mScene.load.image(this.mUrl,this.mUrl),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},t.prototype.onLoadCompleteHandler=function(){this.mImage=new J(this.mScene,this.mConfig),this.mLoadCompleteCallBack&&(this.mLoadCompleteCallBack.call(this.mLoadContext,this.mImage),this.mLoadCompleteCallBack=null,this.mLoadContext=null)},Object.defineProperty(t.prototype,"image",{get:function(){return this.mImage},enumerable:!0,configurable:!0}),t}(),q=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),$=function(t){function e(e){var i=t.call(this,e)||this;return i.mMinWidth=0,i.mMinHeight=0,i.x=-60,i}return q(e,t),e.prototype.show=function(t,e){this.mChatContent=this.scene.make.text({text:t,style:{x:0,y:4,fontFamily:"YaHei",fontSize:14,color:"#000000",origin:{x:0,y:0},wordWrap:{width:300,useAdvancedWrap:!0}}},!1),this.add(this.mChatContent),this.mMinHeight=this.mChatContent.height+26,this.mMinHeight=this.mMinHeight<54?54:this.mMinHeight,this.mMinWidth=this.mChatContent.width+40,this.mMinWidth=this.mMinWidth<69?69:this.mMinWidth,this.mBubbleBg=new Z(this.scene,this);var i=T.getOsdRes(e.bubbleResource||"platformitem/thumbnail/bubble_01.png");this.mBubbleBg.load(i,{width:this.mMinWidth,height:this.mMinHeight,key:i,columns:[34,2,32],rows:[42,2,9]},this.onComplete,this)},e.prototype.tweenTo=function(t){this.mToY=t,this.scene.tweens.add({targets:this,y:t,alpha:1,duration:200})},e.prototype.durationRemove=function(t,e,i){var r=this;this.mTweenCompleteCallback=e,this.mTweenCallContext=i,this.mRemoveDelay=setTimeout(function(){r.removeTween()},t)},e.prototype.removeTween=function(){var t=this,e=this.mToY-30;this.scene.tweens.add({targets:this,y:e,alpha:0,duration:200,onComplete:function(){t.mTweenCompleteCallback&&t.mTweenCompleteCallback.call(t.mTweenCallContext,t)}})},e.prototype.onComplete=function(t){if(t){t.setOrigin(0,0),this.addAt(t,0);this.getBounds();this.mChatContent.x=this.mMinWidth-this.mChatContent.width>>1,this.mChatContent.y=6+(this.mMinHeight-this.mChatContent.height>>1)}},Object.defineProperty(e.prototype,"minWidth",{get:function(){return this.mMinWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minHeight",{get:function(){return this.mMinHeight},enumerable:!0,configurable:!0}),e}(Phaser.GameObjects.Container),Q=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),tt=function(t){function e(e,i,r){return t.call(this,e,i,r,void 0)||this}return Q(e,t),e.prototype.load=function(t,e,i){this.mLoadCompleteCallbak=e,this.mLoadContext=i,this.mUrl=t,this.scene.cache.obj.get(t)?this.onLoadComplete():(this.scene.load.image(t,t),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.start())},e.prototype.onLoadComplete=function(){if(this.mLoadCompleteCallbak){var t=this.mLoadCompleteCallbak;this.mLoadCompleteCallbak=null,t.call(this.mLoadContext),this.mLoadContext=null}this.setTexture(this.mUrl)},e}(Phaser.GameObjects.Image),et=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),it=function(t){function e(e){var i=t.call(this,e)||this;return i.mBubbles=[],i.mArrow=new tt(i.scene,0,0),i.mArrow.load(T.getRes("ui/chat/bubble_arrow.png")),i.add(i.mArrow),i}return et(e,t),e.prototype.addBubble=function(t,e){for(var i=this.createBubble(e),r=null,n=0,s=this.mBubbles.length-1;s>=0;s--)n+=(r=this.mBubbles[s]).minHeight+5,r.tweenTo(-n);i.show(t,e),this.add(i),this.mArrow.y=i.minHeight+4},e.prototype.destroy=function(e){this.mBubbles=null,this.removeFormParent(),t.prototype.destroy.call(this,e)},e.prototype.removeFormParent=function(){this.parentContainer&&this.parentContainer.remove(this)},e.prototype.createBubble=function(t){if(t){var e=new $(this.scene);this.mBubbles.push(e);var i=t.duration?t.duration:5e3;return e.durationRemove(i,this.onRemoveBubble,this),e}},e.prototype.onRemoveBubble=function(t){t&&(this.mBubbles=this.mBubbles.filter(function(e){return t!==e}),this.remove(t),t.destroy(),0===this.mBubbles.length&&this.removeFormParent())},e}(Phaser.GameObjects.Container),rt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){t[t.up=0]="up",t[t.up_left=1]="up_left",t[t.left=2]="left",t[t.left_down=3]="left_down",t[t.down=4]="down",t[t.down_right=5]="down_right",t[t.right=6]="right",t[t.right_up=7]="right_up"}(K||(K={}));var nt,st=function(t){function e(e,i){var n=t.call(this)||this;if(n.mElementManager=i,n.mAnimationName="",n.mMoveData={},n.mId=e.id,e.avatar)n.mDisplayInfo=new B(e);else{var s=n.mElementManager.roomService.world.elementStorage.getObject(e.bindID||e.id);if(!s)return r.error("object does not exist"),n;n.mDisplayInfo=s}return n.createDisplay(),n.setPosition(e.pos),n}return rt(e,t),Object.defineProperty(e.prototype,"dir",{get:function(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomService",{get:function(){if(this.mElementManager)return this.mElementManager.roomService;r.error("element manager is undefined")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.mId},enumerable:!0,configurable:!0}),e.prototype.load=function(t){this.mDisplayInfo=t},e.prototype.play=function(t){this.mAnimationName!==t&&(this.mAnimationName=t,this.mDisplay&&this.mDisplay.play(this.mAnimationName))},e.prototype.setDirection=function(t){this.mDisplayInfo&&this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t)},e.prototype.getDirection=function(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},e.prototype.changeState=function(t){this.mCurState=t},e.prototype.getRenderable=function(){return this.mRenderable},e.prototype.getDisplay=function(){return this.mDisplay},e.prototype.move=function(t){return this.mElementManager?this.mDisplay?(this.mMoveData.arrivalTime=t.timestemp,this.mMoveData.destPos=new O(Math.floor(t.destinationPoint3f.x),Math.floor(t.destinationPoint3f.y)),r.log("walk has movedata"),void this._doMove()):r.error("display is undefined"):r.error("Element::move - Empty element-manager.")},e.prototype.startMove=function(){this.changeState("walk")},e.prototype.stopMove=function(){this.mDisplay?this.changeState("idle"):r.error("can't stopMove, display does not exist")},e.prototype.setPosition=function(t){this.mDisplay&&this.mDisplay.setPosition(t.x,t.y,t.z),this.setDepth()},e.prototype.getPosition=function(){var t;return this.mDisplay&&(t=new O(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z)),t},e.prototype.getPosition45=function(){var t=this.getPosition();return t?this.roomService.transformTo45(t):new O},e.prototype.getRootPosition=function(){return new O(this.mDisplay.x,this.mDisplay.y,0)},e.prototype.showBubble=function(t,e){var i=this.mElementManager.scene;i&&(this.mBubble||(this.mBubble=new it(i)),this.mBubble.addBubble(t,e),this.updateBubble(),this.roomService.addToSceneUI(this.mBubble))},e.prototype.destroy=function(){this.mBubble&&(this.mBubble.destroy(),this.mBubble=void 0),t.prototype.destroy.call(this)},e.prototype._doMove=function(){var t=this;if(this.mMoveData.destPos){var e=this.mMoveData.tweenAnim;e&&(e.stop(),e.remove());var i=this.mMoveData.arrivalTime-this.roomService.now();this.mMoveData.tweenAnim=this.mElementManager.scene.tweens.add({targets:this.mDisplay,duration:i,ease:"Linear",props:{x:{value:this.mMoveData.destPos.x},y:{value:this.mMoveData.destPos.y}},onStart:function(){t.onMoveStart()},onComplete:function(e,i,r){t.onMoveComplete()},onUpdate:function(e,i,r){t.onMoving()},onCompleteParams:[this]})}else r.log("stopDoMove")},e.prototype.createDisplay=function(){if(this.mDisplayInfo){if(this.mDisplay)return this.mDisplay;var t=this.mElementManager.scene;return t&&("DragonbonesModel"===this.mDisplayInfo.discriminator?this.mDisplay=new E(t):this.mDisplay=new I(t),this.mDisplay.once("initialized",this.onDisplayReady,this),this.mDisplay.load(this.mDisplayInfo)),this.mDisplay}r.error("displayinfo does not exist, Create display failed")},e.prototype.addDisplay=function(){this.createDisplay();var t=this.roomService;t?(t.addToSurface(this.mDisplay),this.setDepth()):r.error("roomService is undefined")},e.prototype.setDepth=function(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.x+this.mDisplay.y),!this.roomService)throw new Error("roomService is undefined");var t=this.roomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthSurfaceDirty=!0}},e.prototype.onDisplayReady=function(){this.mDisplay&&(this.mDisplay.play("idle"),this.setDepth())},e.prototype.updateBubble=function(){if(this.mBubble){var t=this.getPosition();t&&(this.mBubble.x=t.x,this.mBubble.y=t.y-130)}},e.prototype.onMoveStart=function(){},e.prototype.onMoveComplete=function(){this.mMoveData.tweenAnim.stop()},e.prototype.onMoving=function(){var t=this.roomService.now();t-(0|this.mMoveData.tweenLastUpdate)>=50&&(this.setDepth(),this.mMoveData.tweenLastUpdate=t,this.updateBubble())},e}(k),at=function(){function t(t){if(this.mID=t.id,t.point3f){var e=t.point3f;this.mPos=new O(e.x,e.y,e.z)}t.avatar&&(this.mAvatar={id:t.avatar.id},this.mAvatar=Object.assign(this.mAvatar,t.avatar)),this.mCurrentAnimationName=t.currentAnimationName||"idle",this.mDirection=t.direction,this.mBindID=t.bindId}return Object.defineProperty(t.prototype,"id",{get:function(){return this.mID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return this.mPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatar",{get:function(){return this.mAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentAnimationName",{get:function(){return this.mCurrentAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this.mDirection},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindID",{get:function(){return this.mBindID},enumerable:!0,configurable:!0}),t}(),ot=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ht=function(t){function e(e){var i=t.call(this)||this;return i.mRoom=e,i.mElements=new Map,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,i.onAdd),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,i.onRemove),i.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_MOVE_ELEMENT,i.onMove),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,i.onAdjust),i.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_SET_ELEMENT_POSITION,i.onSetPosition)),i.mRoom&&i.mRoom.world&&(i.mGameConfig=i.mRoom.world.elementStorage),i}return ot(e,t),e.prototype.init=function(){this.destroy()},e.prototype.get=function(t){var e=this.mElements.get(t);if(e)return e},e.prototype.removeFromMap=function(t){var e=this.mElements.get(t);e&&(this.mElements.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))},e.prototype.destroy=function(){var t=this;this.mElements&&(this.mElements.forEach(function(e){return t.removeFromMap(e.id)}),this.mElements.clear())},Object.defineProperty(e.prototype,"camera",{get:function(){return this.mRoom.cameraService.camera},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;r.log("roomManager is undefined")},enumerable:!0,configurable:!0}),e.prototype.onAdjust=function(t){var e=t.content,i=e.spritePositions;if(e.nodeType===a.op_def.NodeType.ElementNodeType)for(var r,n,s=0,o=i;s<o.length;s++){var h=o[s];(r=this.mElements.get(h.id))&&(n=h.point3f,r.setPosition(new O(0|n.x,0|n.y,0|n.z)))}},e.prototype.onAdd=function(t){if(this.mRoom.layerManager)if(this.mGameConfig){var e=t.content,i=e.sprites;if(i)if(e.nodeType===a.op_def.NodeType.ElementNodeType)for(var n=0,s=i;n<s.length;n++){var o=s[n];o.point3f&&this._add(new at(o))}}else r.error("gameConfig does not exist");else r.error("layer manager does not exist")},e.prototype._add=function(t){var e=this.mElements.get(t.id);e||(e=new st(t,this)),this.mElements.set(e.id||0,e),this.roomService.blocks.add(e)},Object.defineProperty(e.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!0,configurable:!0}),e.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,r=e.ids;if(i===a.op_def.NodeType.ElementNodeType)for(var n=0,s=r;n<s.length;n++){var o=s[n];this.removeFromMap(o)}},e.prototype.onMove=function(t){},e.prototype.onSetPosition=function(t){},e}(s.PacketHandler),lt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){t.IDLE="idle",t.WALK="walk",t.RUN="run",t.ATTACK="attack",t.JUMP="jump",t.INJURED="injured",t.FAILED="failed",t.DANCE01="dance01",t.DANCE02="dance02",t.FISHING="fishing",t.GREET01="greet01",t.SIT="sit",t.LIE="lit",t.EMOTION01="emotion01"}(nt||(nt={}));var ct,ut=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.mElementManager=i,r.nodeType=a.op_def.NodeType.CharacterNodeType,r}return lt(e,t),e.prototype.move=function(e){this.getDirection()!==e.direction&&this.setDirection(e.direction),t.prototype.move.call(this,e)},e.prototype.setDirection=function(t){t!==this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t,this.mDisplay.play(this.mCurState))},e.prototype.changeState=function(t){this.mCurState!==t&&(t||(t="idle"),this.mCheckStateHandle(t)&&(this.mCurState=t,this.mDisplay.play(t)))},e.prototype.removeDisplay=function(){t.prototype.removeDisplay.call(this)},e.prototype.onMoveStart=function(){this.changeState(nt.WALK)},e.prototype.mCheckStateHandle=function(t){return!0},e}(st),pt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),dt=function(t){function e(e){var i=t.call(this)||this;return i.mRoom=e,i.mPlayerMap=new Map,i.connection&&i.connection.addPacketListener(i),i}return pt(e,t),e.prototype.init=function(){this.destroy(),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,this.onAdd),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,this.onRemove),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,this.onAdjust),this.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_MOVE_CHARACTER,this.onMove),this.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_SET_CHARACTER_POSITION,this.onSetPosition),this.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,this.onShowBubble)},e.prototype.destroy=function(){var t=this;this.mPlayerMap&&(this.mPlayerMap.forEach(function(e){return t.removeFromMap(e.id)}),this.mPlayerMap.clear())},e.prototype.removeFromMap=function(t){var e=this.mPlayerMap.get(t);e&&(this.mPlayerMap.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))},e.prototype.startActorMove=function(){this.mRoom.actor?this.mRoom.actor.startMove():r.error("MainHero miss")},e.prototype.stopActorMove=function(){this.mRoom.actor?this.mRoom.actor.stopMove():r.error("MainHero miss")},e.prototype.get=function(t){if(this.mPlayerMap){var e=this.mPlayerMap.get(t);if(!e){var i=this.roomService.actor;i&&i.id===t&&(e=i)}return e}},Object.defineProperty(e.prototype,"camera",{get:function(){return this.mRoom.cameraService.camera},enumerable:!0,configurable:!0}),e.prototype.onAdjust=function(t){var e=t.content,i=e.spritePositions;if(e.nodeType===a.op_def.NodeType.CharacterNodeType)for(var n,s,o=0,h=i;o<h.length;o++){var l=h[o];if(!(n=this.mPlayerMap.get(l.id))){if(l.id!==this.mRoom.actor.id)continue;n=this.mRoom.actor}s=l.point3f,n.setPosition(new O(0|s.x,0|s.y,0|s.z)),r.debug("adjust,x:"+s.x+",y:"+s.y)}},e.prototype.onAdd=function(t){this.mPlayerMap||(this.mPlayerMap=new Map);var e=t.content,i=e.sprites;if(e.nodeType===a.op_def.NodeType.CharacterNodeType)for(var r=0,n=i;r<n.length;r++){var s=n[r];s.point3f,this._add(new at(s))}},e.prototype._add=function(t){if(this.mPlayerMap||(this.mPlayerMap=new Map),!this.mPlayerMap.has(t.id)){var e=new ut(t,this);this.mPlayerMap.set(e.id||0,e),this.roomService.blocks.add(e)}},e.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,r=e.ids;if(i===a.op_def.NodeType.CharacterNodeType)for(var n=0,s=r;n<s.length;n++){var o=s[n];this.removeFromMap(o)}},e.prototype.onMove=function(t){var e=t.content;if(e.moveData)for(var i=e.moveData,r=i.length,n=void 0,s=void 0,a=void 0,o=0;o<r;o++)s=(n=i[o]).moveObjectId,(a=this.get(s))&&a.move(n)},e.prototype.onSetPosition=function(t){},e.prototype.onShowBubble=function(t){var e=t.content,i=this.get(e.chatSenderid);i&&i.showBubble(e.chatContext,e.chatSetting)},Object.defineProperty(e.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;r.error("room is undefined")},enumerable:!0,configurable:!0}),e}(s.PacketHandler),ft=function(){function t(t){this.room=t,this.mScene=t.scene,this.mGroundClickLayer=this.mScene.add.container(0,0),this.mGroundClickLayer.name="mGroundClickLayer",this.mUGroundLayer2=this.mScene.add.container(0,0),this.mUGroundLayer2.name="mUGroundLayer2",this.mGroundLayer=this.mScene.add.container(0,0),this.mGroundLayer.name="mGroundLayer",this.mSurfaceLayer=this.mScene.add.container(0,0),this.mSurfaceLayer.name="surfaceLayer",this.mAtmosphere=this.mScene.add.container(0,0),this.mAtmosphere.name="atmosphere",this.mSceneUILayer=this.mScene.add.container(0,0),this.mSceneUILayer.name="sceneUILayer",this.mUILayer=this.mScene.add.container(0,0).setScrollFactor(0),this.mUILayer.name="uiLayer"}return t.prototype.addToGround=function(t){var e=[].concat(t);this.mGroundLayer.add(e)},t.prototype.addToSurface=function(t){var e=[].concat(t);this.mSurfaceLayer.add(e)},t.prototype.addToSceneToUI=function(t){this.mSceneUILayer.add(t)},t.prototype.addToUI=function(t){this.mUILayer.add(t)},t.prototype.addToAtmosphere=function(t){this.mAtmosphere.add(t)},t.prototype.resize=function(t,e){},t.prototype.addMouseListen=function(){},t.prototype.sortSurface=function(){this.mSurfaceLayer.sort("depth")},t.prototype.changeScene=function(){this._clearLayer()},t.prototype.update=function(t,e){this.mDepthGround&&(this.mGroundLayer.sort("depth"),this.mDepthGround=!1),this.mDepthSurface&&(this.mDepthSurface=!1,this.mSurfaceLayer.sort("depth"),this.mSurfaceLayer.sort("depth",function(t,e){t.sortRectangle,e.sortRectangle;return Math.atan2(t.sortY-e.sortY,t.sortX-e.sortX)*(180*Math.PI)>=70?(t.changeAlpha(.5),1):(t.alpha=1,e.alpha=1,-1)}))},t.prototype.destroy=function(){this._clearLayer()},t.prototype._clearLayer=function(){this.clearLayer(this.mGroundClickLayer),this.clearLayer(this.mGroundLayer),this.clearLayer(this.mSurfaceLayer),this.clearLayer(this.mUGroundLayer2),this.clearLayer(this.mUILayer),this.clearLayer(this.mAtmosphere)},t.prototype.clearLayer=function(t,e){void 0===e&&(e=!1);var i=t.list;if(i)for(var r=i.length,n=0;n<r;n++)i[n].destroy(e);t.destroy(e)},Object.defineProperty(t.prototype,"depthSurfaceDirty",{set:function(t){this.mDepthSurface=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthGroundDirty",{set:function(t){this.mDepthGround=t},enumerable:!0,configurable:!0}),t}(),mt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return mt(e,t),e}(I),_t=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),yt=function(t){function e(e,i){var n=t.call(this)||this;n.mElementManager=i,n.mId=e.id;var s=n.mElementManager.roomService.world.elementStorage.getObject(e.bindID||e.id);return s?(n.mDisplayInfo=s,n.createDisplay(),n.setPosition45(e.pos),n):(r.error("object does not exist"),n)}return _t(e,t),e.prototype.play=function(t){this.mAnimationName!==t&&(this.mAnimationName=t,this.mDisplay&&this.mDisplay.play(this.mAnimationName))},e.prototype.setDirection=function(t){this.mDisplayInfo&&this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t)},e.prototype.getDirection=function(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},e.prototype.setPosition=function(t){this.mDisplay&&this.mDisplay.setPosition(t.x,t.y,t.z),this.setDepth()},e.prototype.getPosition=function(){return this.mDisplay?new O(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z):new O(0,0,0)},e.prototype.getPosition45=function(){var t=this.getPosition();if(t)return this.roomService.transformTo45(t)},e.prototype.createDisplay=function(){if(this.mDisplayInfo){if(this.mDisplay)return this.mDisplay;var t=this.mElementManager.scene;return t&&(this.mDisplay=new gt(t)),this.mDisplay}r.error("displayinfo does not exist, Create display failed")},e.prototype.addDisplay=function(){if(this.mDisplay)if(this.mDisplay.load(this.mDisplayInfo),this.mElementManager){var t=this.mElementManager.roomService;t?(t.addToGround(this.mDisplay),this.setDepth()):r.error("roomService does not exist")}else r.error("element manager does not exist");else r.error("display does not exist")},e.prototype.setDepth=function(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.y),!this.roomService)throw new Error("roomService is undefined");var t=this.roomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthGroundDirty=!0}},e.prototype.setPosition45=function(t){if(this.roomService){var e=this.roomService.transformTo90(t);this.setPosition(e)}else r.error("roomService does not exist")},Object.defineProperty(e.prototype,"id",{get:function(){return this.mId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dir",{get:function(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomService",{get:function(){if(this.mElementManager)return this.mElementManager.roomService;r.error("element manager is undefined")},enumerable:!0,configurable:!0}),e}(k),vt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),bt=function(t){function e(e,i){var r=t.call(this)||this;return r.mRoom=e,r.mTerrains=new Map,r.mPacketFrameCount=0,r.mListener=i,r.connection&&(r.connection.addPacketListener(r),r.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,r.onAdd),r.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,r.onRemove)),r.mRoom&&r.mRoom.world&&(r.mGameConfig=r.mRoom.world.elementStorage),r}return vt(e,t),e.prototype.init=function(){this.destroy()},e.prototype.destroy=function(){var t=this;this.mTerrains&&(this.mTerrains.forEach(function(e){return t.removeFromMap(e.id)}),this.mTerrains.clear())},e.prototype.get=function(t){var e=this.mTerrains.get(t);if(e)return e},e.prototype.removeFromMap=function(t){if(this.mTerrains){var e=this.mTerrains.get(t);e&&(this.mTerrains.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))}},e.prototype.onAdd=function(t){if(this.mPacketFrameCount++,this.mGameConfig){var e=t.content,i=e.sprites,n=e.nodeType,s=e.packet;if(n===a.op_def.NodeType.TerrainNodeType){for(var o=0,h=i;o<h.length;o++){var l=h[o];l.point3f&&this._add(new at(l))}this.mListener&&this.mPacketFrameCount===s.totalFrame&&this.mListener.onFullPacketReceived(n)}}else r.error("gameconfig is undefined")},e.prototype._add=function(t){var e=this.mTerrains.get(t.id);e||(e=new yt(t,this)),this.mTerrains.set(e.id||0,e),this.roomService.blocks.add(e)},e.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,n=e.ids;if(i===a.op_def.NodeType.TerrainNodeType){for(var s=0,o=n;s<o.length;s++){var h=o[s];this.removeFromMap(h)}r.log("remove terrain length: ",n.length)}},Object.defineProperty(e.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;r.error("room manager is undefined")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"camera",{get:function(){return this.camera},enumerable:!0,configurable:!0}),e}(s.PacketHandler),Pt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Tt=function(t){function e(e,i,r,n){var s=t.call(this,e,i,r,n)||this;return s.row=e,s.col=i,s.endRow=r,s.endCol=n,s}return Pt(e,t),e}(Phaser.Geom.Rectangle),xt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),St=function(t){function e(e){var i=t.call(this)||this;return i.mRoomService=e,i.MINI_VIEW_SIZE=38,i.VIEW_PORT_SIZE=40,i.viewPort=new Phaser.Geom.Rectangle,i.miniViewPort=new Phaser.Geom.Rectangle,i}return xt(e,t),e.prototype.getViewPort=function(){if(this.mCamera){var t=this.mCamera.worldView;return this.viewPort.x=t.x+(t.width-this.viewPort.width>>1),this.viewPort.y=t.y+(t.height-this.viewPort.height>>1),this.viewPort}},e.prototype.getMiniViewPort=function(){if(this.mCamera){var t=this.mCamera.worldView;this.miniViewPort.x=t.x+(t.width-this.miniViewPort.width>>1),this.miniViewPort.y=t.y+(t.height-this.miniViewPort.height>>1);var e=this.mRoomService.transformTo45(new O(this.miniViewPort.x+(this.miniViewPort.width>>1),this.miniViewPort.y));return new Tt(e.x,e.y,this.MINI_VIEW_SIZE,this.MINI_VIEW_SIZE)}},Object.defineProperty(e.prototype,"camera",{get:function(){return this.mCamera},set:function(t){this.mCamera=t,this.setViewPortSize()},enumerable:!0,configurable:!0}),e.prototype.resize=function(t,e){this.resetCameraSize(t,e)},e.prototype.startFollow=function(t){this.mCamera&&this.mCamera.startFollow(t)},e.prototype.setBounds=function(t,e,i,n,s){this.mCamera?this.mCamera.setBounds(t,e,i,n,s):r.error("camera does not exist")},e.prototype.resetCameraSize=function(t,e){if(this.connection){var i=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_RESET_CAMERA_SIZE),n=i.content;n.width=t,n.height=e,this.connection.send(i)}else r.error("connection is undefined")},e.prototype.setViewPortSize=function(){if(this.mCamera){var t=this.mRoomService.roomSize;if(t){var e=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileWidth/2),i=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileHeight/2);this.viewPort.setSize(e,i);var n=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileWidth/2),s=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileHeight/2);this.miniViewPort.setSize(n,s)}else r.error("room size does not exist")}else r.error("camera does not exist")},Object.defineProperty(e.prototype,"connection",{get:function(){if(this.mRoomService)return this.mRoomService.connection;r.error("room service is undefined")},enumerable:!0,configurable:!0}),e}(s.PacketHandler),Ot=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ct=function(t){function e(e,i){var r=t.call(this,e,i)||this;if(r.mElementManager=i,r.mRenderable=!0,r.addDisplay(),r.mRoom=r.mElementManager.roomService,r.mRoom.world.inputManager.addListener(r),r.mElementManager){var n=r.mElementManager.roomService;n&&n.cameraService&&n.cameraService.startFollow(r.mDisplay)}return r}return Ot(e,t),e.prototype.setRenderable=function(t){},e.prototype.downHandler=function(t,e){this.mRoom.requestActorMove(t,e)},e.prototype.upHandler=function(){this.stopMove()},e.prototype.stopMove=function(){t.prototype.stopMove.call(this),delete this.mMoveData.destPos,this.mMoveData.arrivalTime=0,this.mMoveData.tweenAnim&&(this.mMoveData.tweenAnim.stop(),this.mMoveData.tweenAnim.remove());var e=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_STOP_SPRITE),i=e.content;i.nodeType=this.nodeType;var r=this.getPosition();i.spritePositions={id:this.id,point3f:{x:r.x,y:r.y,z:r.z},direction:this.dir},this.mElementManager.connection.send(e)},e.prototype.move=function(e){"walk"===this.mCurState&&t.prototype.move.call(this,e)},e.prototype.onMoveStart=function(){},e.prototype.onMoveComplete=function(){"walk"===this.mCurState?this._doMove():this.mMoveData.tweenAnim.stop()},e.prototype.onMoving=function(){"walk"===this.mCurState?t.prototype.onMoving.call(this):this.mMoveData.tweenAnim.stop()},e}(ut),Dt=function(){function t(t,e){this.mRect=t,this.mElements=[],this.mIndex=e}return t.prototype.add=function(t,e){this.mElements.push(t);var i=t.getPosition45();t.setRenderable(e.contains(i.x,i.y)&&this.mInCamera)},t.prototype.remove=function(t){var e=this.mElements.indexOf(t);return-1!==e&&(this.mElements.splice(e,1),!0)},t.prototype.check=function(t,e){if(t){var i=Phaser.Geom.Intersects.RectangleToRectangle(t,this.rectangle);if(e){if(this.mInCamera)for(var r=0,n=this.mElements;r<n.length;r++){var s=n[r],a=s.getPosition45();s.setRenderable(e.contains(a.x,a.y),1200)}this.mInCamera=i}}},Object.defineProperty(t.prototype,"rectangle",{get:function(){return this.mRect||void 0},enumerable:!0,configurable:!0}),t}(),wt=function(){function t(t){this.mBlocks=[],this.mCameras=t}return t.prototype.add=function(t){for(var e=this.mCameras.getMiniViewPort(),i=0,r=this.mBlocks;i<r.length;i++){var n=r[i],s=n.rectangle,a=t.getPosition();if(!a)return;if(s.contains(a.x,a.y))return void n.add(t,e)}},t.prototype.remove=function(t){if(t)for(var e=0,i=this.mBlocks;e<i.length;e++){if(i[e].remove(t))return}},t.prototype.int=function(t){if(t){this.mBlocks=[];for(var e=t.tileWidth/2*40,i=t.tileHeight/2*40,r=t.sceneWidth/e,n=t.sceneHeight/i,s=0,a=0;a<r;a++)for(var o=0;o<n;o++){var h=new Dt(new Phaser.Geom.Rectangle(a*e,o*i,e,i),s++);this.mBlocks.push(h)}}},t.prototype.update=function(t,e){if(this.mCameras)for(var i=this.mCameras.getViewPort(),r=this.mCameras.getMiniViewPort(),n=0,s=this.mBlocks;n<s.length;n++){s[n].check(i,r)}},t}(),At=function(){function t(t){this.mID=t.id,this.mPos=new O(t.x,t.y,t.z||0),t.avatar&&(this.mAvatar={id:t.avatar.id},this.mAvatar=Object.assign(this.mAvatar,t.avatar)),this.mDirection=t.avatarDir}return Object.defineProperty(t.prototype,"id",{get:function(){return this.mID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return this.mPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatar",{get:function(){return this.mAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentAnimationName",{get:function(){return this.mCurrentAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this.mDirection},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bindID",{get:function(){return this.mBindID},enumerable:!0,configurable:!0}),t}(),Et=function(){function t(){}return t.median=function(t){var e=t.sort(function(t,e){return e-t}),i=Math.floor(e.length/2);return e.length%2==0?(e[i-1]+e[i])/2:e[i]},t}(),Mt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),It=function(t){function e(e,i){var r=t.call(this)||this;return r.mLatency=[],r.mConn=e,r.mConn.addPacketListener(r),r.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SYNC_TIME,r.proof),r.mListener=i,r._check(),r}return Mt(e,t),Object.defineProperty(e.prototype,"sysUnixTime",{get:function(){return(new Date).getTime()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unixTime",{get:function(){return this.mTimestamp},set:function(t){this.mTimestamp=t},enumerable:!0,configurable:!0}),e.prototype.sync=function(t){if(void 0===t&&(t=1),this.mConn)for(var e=0;e<t;++e){var i=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_TIME);i.content.clientStartTs=this.sysUnixTime,this.mConn.send(i)}},e.prototype.update=function(t,e){this.mTimestamp?this.mTimestamp+=e:this.mTimestamp=t},e.prototype.destroy=function(){this.mConn&&(this.mConn.removePacketListener(this),this.mConn=void 0),this.mIntervalId&&clearInterval(this.mIntervalId),this.mLatency=void 0},e.prototype._check=function(){var t=this;this.mIntervalId=setInterval(function(){t.sync()},12e4)},e.prototype.proof=function(t){var e,i=t.content,n=this.sysUnixTime,s=i.clientStartTs,a=i.serverReceiveTs,o=i.serverSendTs,h=o-a,l=n-s-h,c=Math.round(l/2);if(!(c<0)){this.mLatency.push(c),this.mLatency.length>7&&this.mLatency.shift();var u=o-(e=Et.median(this.mLatency)+h),p=Math.abs(u-this.mTimestamp);p>100&&(this.mTimestamp=u),this.mListener&&this.mLatency.length>=2&&this.mListener.onClockReady(),r.debug("total_delay: "+l+" / latency: "+c+" | timeSychronDelta: "+e+" / remote_time: "+u+" / mistake: "+p)}},e}(s.PacketHandler),Bt=function(){return function(){}}(),kt=function(){function t(){this.uuid=0}return t.prototype.setInfo=function(t){var e;for(var i in t)(e=t[i])&&(this[i]=e)},t.prototype.getSlots=function(){if(void 0===this.slot)return null;for(var t,e,i=this.slot.length,r=[],n=0;n<i;n++)t=new Bt,e=this.getAttriByKey(this.slot[n].bondAttrCurkey),t.bondAttrCur=e.intVal,e=this.getAttriByKey(this.slot[n].bondAttrMaxkey),t.bondAttrMax=e.intVal,t.bondName=this.slot[n].bondName,t.color=this.slot[n].color,r.push(t);return r},t.prototype.getSlotByName=function(t){if(void 0===this.slot)return null;for(var e,i,r=this.slot.length,n=0;n<r;n++)if(this.slot[n].bondName===t)return e=new Bt,i=this.getAttriByKey(this.slot[n].bondAttrCurkey),e.bondAttrCur=i.intVal,i=this.getAttriByKey(this.slot[n].bondAttrMaxkey),e.bondAttrMax=i.intVal,e.bondName=this.slot[n].bondName,e.color=this.slot[n].color,e;return null},t.prototype.getAttriByKey=function(t){if(void 0===this.attributes)return null;for(var e=this.attributes.length,i=0;i<e;i++)if(this.attributes[i].name===t)return this.attributes[i];return null},Object.defineProperty(t.prototype,"originCollisionPoint",{get:function(){return this._originCollisionPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originWalkPoint",{get:function(){return this._originWalkPoint},enumerable:!0,configurable:!0}),t.prototype.setOriginCollisionPoint=function(t){void 0===this._originCollisionPoint&&(this._originCollisionPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originCollisionPoint.x=t[0],this._originCollisionPoint.y=t[1])},t.prototype.setOriginWalkPoint=function(t){void 0===this._originWalkPoint&&(this._originWalkPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originWalkPoint.x=t[0],this._originWalkPoint.y=t[1])},t}(),Rt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Nt=function(t){function e(){return t.call(this)||this}return Rt(e,t),e}(kt),jt=function(){function t(){}return t.CREATE_ROLE="create_role",t.APP_START="app_start",t.EDITOR_CHANGE_MODE="editor_change_mode",t.CLIENT_RESIZE="app_client_resize",t.SCENE_INITIALIZED="SCENE_INITIALIZED",t.SCENE_CLEARED="SCENE_CLEARED",t.SCENE_CHANGE_TO="SCENE_CHANGE_TO",t.SCENE_MOVE_TO="scene_move_to",t.SCENE_MOVE_STOP="scene_move_stop",t.CHANGE_ELEMENT_ANIMATION="change_element_animation",t.CHANGE_CHARACTER_ANIMATION="change_character_animation",t.CHAT_TO="chat_to",t.SHOW_CHAT_BUBBLE="show_chat_bubble",t.REMOVE_CHAT_BUBBLE="remove_chat_bubble",t.PROMPT_ALERT="prompt_alert",t.CHARACTER_TALING="characterTaling",t.CHARACTER_SHUT_UP="characterShutUp",t.QCLOUD_AUTH="qcloud_auth",t.ENTER_SCENE="enter_scene",t.SCENE_ADD_PLAYER="scene_add_player",t.SCENE_REMOVE_PLAYER="scene_remove_player",t.SCENE_UPDATE_PLAYER="scene_update_player",t.SCENE_ADD_ELEMENT="scene_add_element",t.SCENE_ADD_TERRAIN="scene_add_terrain",t.SCENE_ADD_TERRAIN_END="scene_add_terrain_end",t.SCENE_ADD_ALL_TERRAIN="scene_add_all_terrain",t.SCENE_REMOVE_ELEMENT="scene_remove_element",t.SCENE_REMOVE_TERRAIN="scene_remove_terrain",t.SCENE_REMOVE_ALL_TERRAIN="scene_remove_all_terrain",t.SCENE_MOUSE_FOLLOW="scene_mouse_follow",t.SCENE_SELECT_ELEMENT="scene_select_element",t.SCENE_FIXED_TO_ELEMENT="scene_fixed_to_element",t.SCENE_UPDATE_ELEMENT="sceneUpdateElement",t.SCENE_SYNCHRO_PACKAGE="sceneSynchroPackage",t.SCENE_VISIBLE_GRID="sceneVisibleGrid",t.PLAYER_SELECT_CHARACTER="player_select_character",t.PLAYER_DATA_INITIALIZE="player_data_initialize",t.SCENE_DATA_INITIALIZE="scene_data_initialize",t.PACKAGE_ITEM_ADD="package_item_add",t.PACKAGE_ITEM_REMOVE="package_item_remove",t.PACKAGE_EXCHANGE_ITEM_POS="package_exchange_item_pos",t.SEFL_TARGET_START_MOVE="SEFL_TARGET_START_MOVE",t.SEFL_TARGET_PAUSE_MOVE="SEFL_TARGET_PAUSE_MOVE",t.SCENE_BACKGROUND_CLICK="SCENE_BACKGROUND_CLICK",t.ADD_SCENE_ELEMENT="ADD_SCENE_ELEMENT",t.REMOVE_SCENE_ELEMENT="REMOVE_SCENE_ELEMENT",t.CHANGE_SELF_AVATAR="CHANGE_SELF_AVATAR",t.DRAG_TO_DROP="DRAG_TO_DROP",t.DRAG_OVER_DROP="DRAG_OVER_DROP",t.GAME_GLOBALS_TICK="GAME_GLOBALS_TICK",t.GAME_GLOBALS_FRAME="GAME_GLOBALS_FRAME",t.MODULE_VIEW_ADD="module_view_add",t.MODULE_VIEW_REM="module_view_rem",t.SHOW_NOTICE="show_notice",t.USER_UPDATED_VOICE_PEER="user_updated_voice_peer",t.HIDE_VOICE="hide_voice",t.QUERY_PACKAGE="query_package",t.SYNC_USER_BALANCE="syncUserBalance",t.UPDATED_CHARACTER_PACKAGE="updatedCharacterPackage",t.SHOW_EFFECT="showEffect",t}(),Lt=function(){function t(t){this.mWorld=t,this.initialize=!1,this.mPlayerInfoList=[],this.mMainPlayerInfo=new Nt,this.mWorld.modelManager&&(this.mModelDispatch=this.mWorld.modelManager)}return t.prototype.getInitialize=function(){return this.initialize},Object.defineProperty(t.prototype,"mainPlayerInfo",{get:function(){return this.mMainPlayerInfo},enumerable:!0,configurable:!0}),t.prototype.setmainPlayerInfo=function(t){this.mMainPlayerInfo.setInfo(t),t.walkOriginPoint&&this.mMainPlayerInfo.setOriginWalkPoint(t.walkOriginPoint),t.originPoint&&this.mMainPlayerInfo.setOriginCollisionPoint(t.originPoint),!1===this.getInitialize()&&(this.initialize=!0,this.mModelDispatch.emit(jt.PLAYER_DATA_INITIALIZE))},t.prototype.addPlayer=function(t){var e=new kt;e.setInfo(t),t.walkOriginPoint&&e.setOriginWalkPoint(t.walkOriginPoint),t.originPoint&&e.setOriginCollisionPoint(t.originPoint),this.mPlayerInfoList.push(e),this.mModelDispatch.emit(jt.SCENE_ADD_PLAYER,e)},t.prototype.updatePlayer=function(t){var e;if(this.mMainPlayerInfo.uuid===t.uuid)return this.mMainPlayerInfo.setInfo(t),void this.mModelDispatch.emit(jt.SCENE_UPDATE_PLAYER,this.mMainPlayerInfo);for(var i=this.mPlayerInfoList.length-1;i>=0;i--)if((e=this.mPlayerInfoList[i]).uuid===t.uuid){e.setInfo(t),this.mModelDispatch.emit(jt.SCENE_UPDATE_PLAYER,e);break}},t.prototype.removePlayer=function(t){if(this.mMainPlayerInfo.uuid!==t){for(var e=this.mPlayerInfoList.length-1;e>=0;e--)if(this.mPlayerInfoList[e].uuid===t){this.mPlayerInfoList.splice(e,1),this.mModelDispatch.emit(jt.SCENE_REMOVE_PLAYER,t);break}}else this.mModelDispatch.emit(jt.SCENE_REMOVE_PLAYER,t)},t.prototype.addPackItems=function(t,e){var i=this.getPlayer(t);i&&(i.package||(i.package=[],i.package[0]=a.op_gameconfig.Package.create()),i.package[0].items=i.package[0].items.concat(e),i===this.mMainPlayerInfo&&this.mModelDispatch.emit(jt.UPDATED_CHARACTER_PACKAGE))},t.prototype.removePackItems=function(t,e){var i=this.getPlayer(t);if(i)for(var r=i.package[0].items.length,n=0;n<r;n++)if(e===i.package[0].items[n].id)return i.package[0].items.splice(n,1),!0;return!1},t.prototype.getPlayer=function(t){var e=this.mPlayerInfoList.find(function(e){return e.id===t});return!1==!!e&&t===this.mMainPlayerInfo.id?this.mMainPlayerInfo:e},Object.defineProperty(t.prototype,"playInfoList",{get:function(){return this.mPlayerInfoList},enumerable:!0,configurable:!0}),t.NAME="PlayerDataModel",t}(),Ft=i(87),zt=function(){function t(t){this.discriminator="FramesModel",this.id=t.id,this.type=t.sn;var e=t.animations;e&&(this.animationName=e.defaultAnimationName,this.setDisplay(e.display),this.setAnimationData(e.animationData))}return t.prototype.setInfo=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},t.prototype.getAnimationData=function(){return this.animations},t.prototype.getAnimations=function(t){if(this.animations)return this.animations.get(t)},t.prototype.destroy=function(){this.animations&&this.animations.clear()},Object.defineProperty(t.prototype,"gene",{get:function(){return this.mGen},enumerable:!0,configurable:!0}),t.prototype.setDisplay=function(t){t?(this.display={dataPath:t.dataPath,texturePath:t.texturePath},this.mGen=Ft.sync(t.dataPath+t.texturePath)):r.error(this.type+" display does not exist")},t.prototype.setAnimationData=function(t){if(t){var e;this.animations=new Map;for(var i=0,n=t;i<n.length;i++){var s=n[i],a=s.baseLoc;e={name:s.name,frameName:s.frameName,frameRate:s.frameRate,loop:s.loop,baseLoc:new Phaser.Geom.Point(a.x,a.y),walkableArea:s.walkableArea||[],collisionArea:s.collisionArea||[]},this.animations.set(e.name,e)}}else r.error(this.id+" animationData does not exist")},t}(),Vt=function(){function t(){this.mapId=1,this.zStart=0,this.zEnd=0,this._mapTotalWidth=0,this._bgSound=1,this._voiceChatRoomId=0,this._mapTotalHeight=0}return Object.defineProperty(t.prototype,"bgSound",{get:function(){return this._bgSound},set:function(t){this._bgSound=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapTotalWidth",{get:function(){return this._mapTotalWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapTotalHeight",{get:function(){return this._mapTotalHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileWidth",{get:function(){return this._tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileHeight",{get:function(){return this._tileHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"terrainConfig",{get:function(){return this._terrainConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementConfig",{get:function(){return this._elementConfig},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cols",{get:function(){return this._cols},set:function(t){this._cols=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},set:function(t){this._rows=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"voiceChatRoomId",{get:function(){return this._voiceChatRoomId},set:function(t){this._voiceChatRoomId=t},enumerable:!0,configurable:!0}),t.prototype.setConfig=function(t,e,i,r,n,s){this._cols=t,this._rows=e,this.zStart=i,this.zEnd=r,this._tileWidth=n,this._tileHeight=s,this._mapTotalWidth=(this._rows+this._cols)*(this._tileWidth/2),this._mapTotalHeight=(this._rows+this._cols)*(this._tileHeight/2)},t.prototype.setTerrainInfo=function(t){this._terrainConfig=[];for(var e,i=t.length,r=0;r<i;r++)e=new zt(t[r]),this._terrainConfig.push(e)},t.prototype.addTerrainInfo=function(t){for(var e,i=t.length,r=0;r<i;r++)e=new zt(t[r]),this._terrainConfig.push(e)},t.prototype.setElementInfo=function(t){this._elementConfig=[];for(var e,i=t.length,r=0;r<i;r++)e=new zt(t[r]),this._elementConfig.push(e)},t.prototype.addElementInfo=function(t){for(var e,i=t.length,r=0;r<i;r++)e=new zt(t[r]),this._elementConfig.push(e)},t.prototype.addPackItems=function(t,e){var i=this.getElementInfo(t);i&&(i.package||(i.package=a.op_gameconfig.Package.create()),i.package.items=i.package.items.concat(e))},t.prototype.removePackItems=function(t,e){var i=this.getElementInfo(t);if(i)for(var r=i.package.items.length,n=0;n<r;n++)if(e===i.package.items[n].id)return i.package.items.splice(n,1),!0;return!1},t.prototype.getElementInfo=function(t){for(var e=this._elementConfig.length,i=0;i<e;i++)if(this._elementConfig[i].id===t)return this._elementConfig[i];return null},t}(),Ht=function(){function t(t){this.mWorld=t,this.mWorld.modelManager&&(this.mModelDispatch=this.mWorld.modelManager),this.mMapInfo=new Vt}return t.prototype.getInitialize=function(){return this.initialize},t.prototype.geMapInfo=function(){return this.mMapInfo},t.prototype.setMapInfo=function(t){this.mMapInfo.mapId=t.id,this.mMapInfo.voiceChatRoomId=t.voiceChatRoomId,this.mMapInfo.setConfig(t.cols,t.rows,t.zStart,t.zEnd,t.tileWidth,t.tileHeight),this.mMapInfo.setTerrainInfo(t.terrains),this.mMapInfo.setElementInfo(t.elements),!1===this.initialize&&(this.initialize=!0,this.mModelDispatch.emit(jt.SCENE_DATA_INITIALIZE))},t.prototype.addPackItems=function(t,e){this.mMapInfo.addPackItems(t,e)},t.prototype.removePackItems=function(t,e){this.mMapInfo.removePackItems(t,e)},t.NAME="MapDataModel",t}(),Yt=function(){function t(t){if(this.manager=t,this.mInit=!1,this.mWorld=this.manager.world,this.mClock=new It(this.mWorld.connection,this),this.mTerainManager=new bt(this,this),this.mElementManager=new ht(this),this.mPlayerManager=new dt(this),this.mCameraService=new St(this),this.mBlocks=new wt(this.mCameraService),this.mWorld){var e=this.mWorld.getSize();if(!e)throw new Error("World::getSize undefined!");this.mCameraService.resize(e.width,e.height)}}return t.prototype.enter=function(t){var e=this;if(t){if(this.mID=t.id,this.mTerainManager.init(),this.mElementManager.init(),this.mPlayerManager.init(),this.mSize={cols:t.rows,rows:t.cols,tileHeight:t.tileHeight,tileWidth:t.tileWidth,sceneWidth:(t.rows+t.cols)*(t.tileWidth/2),sceneHeight:(t.rows+t.cols)*(t.tileHeight/2)},this.mScene=this.mWorld.game.scene.getScene(P.name),this.mWorld.modelManager.getModel(Ht.NAME).setMapInfo(t),this.mLayManager=new ft(this),this.scene){this.mCameraService.camera=this.scene.cameras.main;this.mBlocks.int(this.mSize)}this.mWorld.game.scene.start(P.name,{room:this,callBack:function(){e.connection&&e.connection.send(new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED)),e.mActor=new Ct(new At(e.mActorData),e.mPlayerManager),e.mWorld.game.scene.getScene(g.name).sleep()}})}else r.error("wrong room")},t.prototype.onFullPacketReceived=function(t){t===a.op_def.NodeType.TerrainNodeType&&this.mClock.sync(3)},t.prototype.onClockReady=function(){r.debug("onClockReady"),this.mWorld.game.scene.stop(g.name)},t.prototype.pause=function(){this.mScene.scene.pause()},t.prototype.resume=function(t){this.mScene.scene.resume(t),this.mClock.sync()},t.prototype.requestActorMove=function(t,e){this.mActor.setDirection(t),this.playerManager.startActorMove();var i=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN);i.content.keyCodes=e,this.connection.send(i)},t.prototype.addActor=function(t){this.mActorData=t,this.mWorld.modelManager.getModel(Lt.NAME).setmainPlayerInfo(t)},t.prototype.addToGround=function(t){this.layerManager.addToGround(t)},t.prototype.addToSurface=function(t){this.layerManager.addToSurface(t)},t.prototype.addToSceneUI=function(t){this.layerManager.addToSceneToUI(t)},t.prototype.addToUI=function(t){this.layerManager.addToUI(t)},t.prototype.removeElement=function(t){t&&t.removeFromParent()},t.prototype.resize=function(t,e){this.layerManager.resize(t,e),this.mCameraService.resize(t,e)},t.prototype.transformTo90=function(t){if(this.mSize)return C.transformTo90(t,this.mSize);r.error("position object is undefined")},t.prototype.transformTo45=function(t){if(this.mSize)return C.transformTo45(t,this.mSize);r.error("position object is undefined")},t.prototype.addMouseListen=function(){this.layerManager.addMouseListen()},t.prototype.update=function(t,e){this.mClock.update(t,e),this.mBlocks.update(t,e),this.layerManager&&this.layerManager.update(t,e)},t.prototype.now=function(){return this.mClock.unixTime},Object.defineProperty(t.prototype,"scene",{get:function(){return this.mScene||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"terrainManager",{get:function(){return this.mTerainManager||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementManager",{get:function(){return this.mElementManager||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playerManager",{get:function(){return this.mPlayerManager||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerManager",{get:function(){return this.mLayManager||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraService",{get:function(){return this.mCameraService||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.mID},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roomSize",{get:function(){return this.mSize||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blocks",{get:function(){return this.mBlocks},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"actor",{get:function(){return this.mActor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this.mWorld},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connection",{get:function(){if(this.manager)return this.manager.connection},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.mPlayerManager.destroy(),this.mElementManager.destroy(),this.mTerainManager.destroy()},t.prototype.destroy=function(){this.mScene&&(this.mScene.scene.stop(),this.mScene=null),this.manager=null,this.mPlayerManager.destroy(),this.mLayManager.destroy(),this.mClock.destroy()},t}(),Gt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ut=function(t){function e(e){var i=t.call(this)||this;return i.mRooms=[],i.mWorld=e,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ENTER_SCENE,i.onEnterScene)),i}return Gt(e,t),e.prototype.getRoom=function(t){var e=this.mRooms.findIndex(function(e,i){return t===e.id});if(e>=0)return this.mRooms[e]},e.prototype.onFocus=function(){this.mRooms.forEach(function(t){t&&t.resume(t.scene.scene.key)})},e.prototype.onBlur=function(){this.mRooms.forEach(function(t){t&&t.pause()})},e.prototype.pasuseRoom=function(t){var e=this.mRooms.findIndex(function(e,i){return t===e.id});e>=0&&this.mRooms[e].pause()},e.prototype.resumeRoom=function(t){var e=this.mRooms.findIndex(function(e,i){return t===e.id});if(e>=0){var i=this.mRooms[e];i.resume(i.scene.scene.key)}},e.prototype.stop=function(){this.mRooms.forEach(function(t){t&&t.destroy()})},e.prototype.resize=function(t,e){this.mRooms.forEach(function(i){i&&i.resize(t,e)})},e.prototype.hasRoom=function(t){return this.mRooms.findIndex(function(e,i){return t===e.id})>=0},e.prototype.onEnterScene=function(t){var e,i=t.content;this.mCurRoom&&this.mCurRoom.clear(),this.hasRoom(i.scene.id)?e=this.getRoom(i.scene.id):(e=new Yt(this),this.mRooms.push(e)),e.addActor(i.actor),e.enter(i.scene),this.mWorld.changeRoom(e),this.mCurRoom=e},Object.defineProperty(e.prototype,"world",{get:function(){return this.mWorld},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentRoom",{get:function(){return this.mCurRoom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connection",{get:function(){if(this.mWorld)return this.mWorld.connection;r.error("world manager is undefined")},enumerable:!0,configurable:!0}),e}(s.PacketHandler),Wt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Xt=function(t){function e(e){var i=t.call(this)||this;return i.worldService=e,i.mInitilized=!0,i.mKeyboardListeners=[],i.mCodeList=[37,38,39,40,65,87,68,83],i.mKeyList=[],i.mKeyDownList=[],i.mTmpUpKeysStr="",i.mTmpDownKeyStr="",i.mConnect=i.worldService.connection,i}return Wt(e,t),e.prototype.onRoomChanged=function(t,e){if(this.mRoom=t,this.mScene=t.scene,this.mScene)for(var i,r,n=this.mCodeList.length,s=0;s<n;s++)i=this.mCodeList[s],r=this.mScene.input.keyboard.addKey(i,!1),this.addKeyEvent(r)},e.prototype.resize=function(t,e){},e.prototype.addListener=function(t){this.mKeyboardListeners.push(t)},e.prototype.removeListener=function(t){var e=this.mKeyboardListeners.indexOf(t);e>=0&&this.mKeyboardListeners.splice(e,1)},Object.defineProperty(e.prototype,"enable",{get:function(){return void 0!==this.mScene&&this.mScene.input.keyboard.enabled},set:function(t){this.mScene&&(this.mScene.input.keyboard.enabled=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keyList",{get:function(){return this.mKeyList},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.removeKeyEvents(),this.mKeyDownList&&(this.mKeyDownList.length=0,this.mKeyDownList=null),this.mCodeList&&(this.mCodeList.length=0,this.mCodeList=null),this.mTmpDownKeyStr=null,this.mTmpUpKeysStr=null,this.mScene=null,this.mConnect=null,this.mInitilized=!1},e.prototype.checkMoveKeyDown=function(t){for(var e,i,r=this.mKeyList,n=r.length,s=[],a=0,o=0;o<n;o++)if(i=(e=r[o]).keyCode,e&&e.isDown){switch(i){case 37:case 65:a+=-1;break;case 38:case 87:a+=-3;break;case 39:case 68:a+=1;break;case 40:case 83:a+=3}s.push(e.keyCode)}if(0===a)return!1;var h,l=t.getDirection();switch(a){case-1:h=l<=1?1:3;break;case-2:h=7;break;case-3:h=l<=3?1:7;break;case-4:h=1;break;case 1:h=l<=5?5:7;break;case 2:h=3;break;case 3:h=l<=3?3:5;break;case 4:h=5}return t.setDirection(h),t.downHandler(h,s),!0},e.prototype.checkMoveKeyAllUp=function(){for(var t,e=this.mKeyList,i=e.length,r=0;r<i;r++)if((t=e[r])&&t.isDown)return!1;return!0},e.prototype.addKeyEvent=function(t){t.on("down",this.keyDownHandle,this),t.on("up",this.keyUpHandle,this),this.mKeyList.push(t)},e.prototype.keyDownHandle=function(t){var e=this,i=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),r=i.content,n=this.getKeyDowns();this.mTmpDownKeyStr!==n.toString()&&(this.mTmpUpKeysStr="",this.mTmpDownKeyStr=n.toString(),r.keyCodes=n,this.mConnect.send(i),this.mKeyboardListeners.forEach(function(t){e.checkMoveKeyDown(t)}))},e.prototype.keyUpHandle=function(t){var e=this,i=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_UP),r=i.content,n=this.getKeyUps();this.mTmpUpKeysStr===n.toString()||n.length<1||(this.mTmpDownKeyStr="",this.mTmpUpKeysStr=n.toString(),r.keyCodes=n,this.mConnect.send(i),this.mKeyboardListeners.forEach(function(t){e.checkMoveKeyAllUp()&&t.upHandler()}))},e.prototype.getKeyDowns=function(){return this.mInitilized&&this.mKeyList?(this.mKeyDownList=this.mKeyList.filter(function(t){return t.isDown}),this.mKeyDownList.map(function(t){return t.keyCode})):[]},e.prototype.getKeyUps=function(){var t,e=[];if(!this.mInitilized)return e;if(!this.mKeyDownList)return[];for(var i=0;i<this.mKeyDownList.length;i++)(t=this.mKeyDownList[i])&&t.isUp&&(this.mKeyDownList.splice(i,1),e.push(t.keyCode),i--);return e},e.prototype.removeKeyEvents=function(){if(this.mScene){for(var t,e=this.mKeyList.length,i=0;i<e;i++)(t=this.mKeyList[i])&&(t.off("down",this.keyDownHandle),t.off("up",this.keyUpHandle),this.mScene.input.keyboard.removeKey(t.keyCode));this.mKeyList.length=0,this.mKeyList=null}},e}(s.PacketHandler),Kt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){t[t.RightMouseDown=1]="RightMouseDown",t[t.RightMouseUp=2]="RightMouseUp",t[t.LeftMouseDown=3]="LeftMouseDown",t[t.LeftMouseUp=4]="LeftMouseUp",t[t.WheelDown=5]="WheelDown",t[t.WheelUp=6]="WheelUp",t[t.RightMouseHolding=7]="RightMouseHolding",t[t.LeftMouseHolding=8]="LeftMouseHolding"}(ct||(ct={}));var Jt=function(t){function e(e){var i=t.call(this)||this;return i.worldService=e,i.running=!1,i.mGame=e.game,i.mConnect=i.worldService.connection,i}return Kt(e,t),e.prototype.changeRoom=function(t){if(this.pause(),this.mScene=t.scene,this.mScene){this.mActivePointer=this.mScene.input.activePointer;try{t.addMouseListen()}catch(t){}t.scene.input.on("gameobjectdown",this.groundDown,this),t.scene.input.on("gameobjectup",this.groundUp,this),this.resume()}},e.prototype.resize=function(t,e){},e.prototype.pause=function(){this.running=!1},e.prototype.resume=function(){this.running=!0},e.prototype.onUpdate=function(t,e){if(!1!==this.running&&void 0!==this.mActivePointer){var i=[];if(this.mActivePointer.leftButtonDown?i.push(ct.LeftMouseDown):this.mActivePointer.leftButtonReleased&&i.push(ct.LeftMouseUp),this.mActivePointer.middleButtonDown?i.push(ct.WheelDown):this.mActivePointer.middleButtonReleased&&i.push(ct.WheelUp),this.mActivePointer.rightButtonDown?i.push(ct.RightMouseDown):this.mActivePointer.rightButtonReleased&&i.push(ct.RightMouseUp),0!==i.length){var r=0;e.parentContainer&&(r=e.parentContainer.getData("id"));var n=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOUSE_EVENT),o=n.content;o.id=r,o.mouseEvent=i,o.point3f={x:t.x,y:t.y},this.mConnect.send(n)}}},Object.defineProperty(e.prototype,"enable",{get:function(){return!!this.mScene&&this.mScene.input.mouse.enabled},set:function(t){this.mScene&&(this.mScene.input.mouse.enabled=t)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.mActivePointer=null,this.mScene=null,this.mConnect=null,this.mGroundLayer=null,this.running=!1},e.prototype.groundDown=function(t,e){this.mActivePointer=t,this.onUpdate(t,e)},e.prototype.groundUp=function(t,e){this.mActivePointer=t,this.onUpdate(t,e)},e}(s.PacketHandler),Zt=function(){function t(t){this.worldService=t,this.mJoyListeners=[],this.mScale=t.uiScale,r.debug("JoyStickManager "+t.uiScale)}return t.prototype.onRoomChanged=function(t,e){},t.prototype.setScene=function(t){if(this.mScene=t,this.mScene){this.worldService.getSize();this.mParentcon=this.mScene.add.container(0,0);this.mScale&&this.mScale;this.mJoyStick=new qt(this.mScene,this.worldService,this.mParentcon,this.mJoyListeners,this.mScale)}},t.prototype.resize=function(){var t=this.worldService.getSize();this.mParentcon.x=150,this.mParentcon.y=t.height-150},t.prototype.addListener=function(t){this.mJoyListeners.push(t),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)},t.prototype.removeListener=function(t){var e=this.mJoyListeners.indexOf(t);e>=0&&this.mJoyListeners.splice(e,1),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)},t.prototype.downHandler=function(){},t.prototype.upHandler=function(){},Object.defineProperty(t.prototype,"enable",{get:function(){return!0},set:function(t){},enumerable:!0,configurable:!0}),t}(),qt=function(){function t(t,e,i,r,n){this.mScene=t,this.mWorld=e,this.parentCon=i,this.mJoyListeners=r,this.mScale=n,this.load()}return t.prototype.load=function(){this.mScene.load.atlas("joystick","./resources/ui/joystick/joystick.png","./resources/ui/joystick/joystick.json"),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start()},t.prototype.changeListeners=function(t){this.mJoyListeners=t},t.prototype.resize=function(){var t=this.mWorld.getSize();this.mbtnCon&&(this.mbtnCon.x=t.width-120*this.mScale,this.mbtnCon.y=t.height-120*this.mScale),this.mjoystickCon&&(this.mjoystickCon.x=260*this.mScale,this.mjoystickCon.y=t.height-260*this.mScale)},t.prototype.onLoadCompleteHandler=function(){var t=this.mWorld.getSize();this.bg=this.mScene.make.sprite(void 0,!1),this.bg.setTexture("joystick","joystick_bg"),this.bgRadius=this.bg.width-70>>1,this.btn=this.mScene.make.sprite(void 0,!1),this.btn.setTexture("joystick","joystick_tab"),this.btn.x=this.bg.x,this.btn.y=this.bg.y,this.mjoystickCon=this.mScene.make.container(void 0,!1),this.mjoystickCon.alpha=.5,this.mjoystickCon.addAt(this.bg,0),this.mjoystickCon.addAt(this.btn,1),this.parentCon.add(this.mjoystickCon),this.btn.setInteractive(),this.mScene.input.setDraggable(this.btn),this.btn.on("drag",this.dragUpdate,this),this.btn.on("dragend",this.dragStop,this),this.mbtnCon=this.mScene.make.container(void 0,!1),this.mbtn0=this.mScene.add.sprite(0,0,"joystick","btn"),this.mbtnCon.add(this.mbtn0),this.mbtn0.setInteractive(),this.mjoystickCon.scaleX=this.mjoystickCon.scaleY=this.mScale,this.mbtnCon.scaleX=this.mbtnCon.scaleY=this.mScale,this.parentCon.add(this.mbtnCon),this.parentCon.setSize(t.width,t.height),this.mbtn0.on("pointerup",this.uiUp,this),this.resize()},t.prototype.uiUp=function(t,e){this.mScene.tweens.add({targets:this.mbtn0,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.mbtn0.scaleX=this.mbtn0.scaleY=1},t.prototype.dragUpdate=function(t,e,i){var r=this,n=Math.sqrt(e*e+i*i);n>this.bgRadius&&(n=this.bgRadius);var s=Math.atan2(i,e);this.btn.x=Math.cos(s)*n+this.bg.x,this.btn.y=Math.sin(s)*n+this.bg.y,this.mJoyListeners.forEach(function(t){r.checkdragDown(t,s)})},t.prototype.dragStop=function(t){var e=this;this.btn.x=this.bg.x,this.btn.y=this.bg.y,r.log("dragEnd"),this.mJoyListeners.forEach(function(t){e.checkdragUp()&&t.upHandler()})},t.prototype.checkdragDown=function(t,e){var i,r=[];switch(e<=0&&e>-Math.PI/2?i=0!==e?K.right_up:K.right:e<=-Math.PI/2&&e>-Math.PI?i=e!==-Math.PI/2?K.up_left:K.up:e>Math.PI/2&&e<=Math.PI?i=e!==Math.PI?K.left_down:K.left:e>0&&e<=Math.PI/2&&(i=e!==Math.PI/2?K.down_right:K.down),i){case 0:r=[38,87];break;case 1:r=[37,38,65,87];break;case 2:r=[37,65];break;case 3:r=[37,40,65,83];break;case 4:r=[40,83];break;case 5:r=[39,40,68,87];break;case 6:r=[39,68];break;case 7:r=[38,39,87,68]}return this.mdownStr!==r.toString()&&(this.mdownStr=r.toString(),t.downHandler(i,r),!0)},t.prototype.checkdragUp=function(){return this.mdownStr="",!0},t}(),$t=function(){function t(){this.mModels=new Map,this.mElementRef=new Map}return t.prototype.setGameConfig=function(t){if(t)for(var e=null,i=0,r=t.objectsList;i<r.length;i++){var n=r[i];if(n.type===a.op_def.NodeType.TerrainNodeType||n.type===a.op_def.NodeType.ElementNodeType){(e=this.mModels.get(n.sn))||(e=new zt(n),this.mModels.set(n.sn,e));var s={id:n.id,displayModel:e};this.mElementRef.set(n.id,s)}}},t.prototype.getObject=function(t){var e=this.mElementRef.get(t);if(e)return e.displayModel;r.error("can't find element "+t)},t}();function Qt(t,e){return new Promise(function(i,r){var n=new XMLHttpRequest;n.onload=function(t){i(t.currentTarget)},n.onerror=function(){r(t+" load error")},n.open("GET",t),n.responseType=e||"",n.send()})}var te,ee,ie=i(89),re=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ne=function(t){function e(e,i,r,n){var s=t.call(this,e,i,r)||this;return s.mScene=e,s.mIcon=s.mScene.make.image(void 0,!1),s.add(s.mIcon),s}return re(e,t),e.prototype.load=function(t,e,i){this.mUrl=t;var r=this.resKey;this.mScene.cache.obj.has(r)?this.onLoadCompleteHandler():(this.mScene.load.image(r,T.getRes(this.mUrl)),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},e.prototype.dragStart=function(){},e.prototype.dragStop=function(t){},e.prototype.dragDrop=function(t){},e.prototype.dragOver=function(t){},e.prototype.getDragData=function(){},e.prototype.getDropData=function(){},e.prototype.getDragImage=function(){return this.mIcon},e.prototype.getVisualDisplay=function(){},e.prototype.getBound=function(){var t=this.getBounds();return new Phaser.Geom.Rectangle(t.x,t.y,t.width,t.height)},Object.defineProperty(e.prototype,"resKey",{get:function(){return void 0===this.mUrl?"":T.getRes(this.mUrl)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this)},Object.defineProperty(e.prototype,"icon",{get:function(){return this.mIcon},enumerable:!0,configurable:!0}),e.prototype.setDragType=function(t){this.mDragType=t},e.prototype.setDropType=function(t){this.mDropType=t},e.prototype.getDropType=function(){return this.mDropType},e.prototype.getDragType=function(){return this.mDragType},e.prototype.onLoadCompleteHandler=function(){},e}(Phaser.GameObjects.Container),se=function(){function t(t,e,i,r,n,s,a,o,h,l){this.mScene=t,this.con=t.make.container(void 0,!1),this.con.x=i,this.con.y=r,e.add(this.con),this.mResStr=n,this.mResPng=s,this.mResJson=a,this.mResSlot=o,this.mSubScriptRes=l,this.mSelectRes=h,this.createUI()}return t.prototype.getView=function(){return this.con},t.prototype.dataChange=function(t){var e=this;if(this.mData=t,this.mIcon&&this.mData&&this.mData.display){this.mIcon.load(this.mData.display.texturePath,this,function(){e.mIcon.visible=!0});this.mData.des&&this.mData.des}},t.prototype.createUI=function(){this.mScene.cache.obj.has(this.mResStr)?this.onLoadCompleteHandler():(this.mScene.load.atlas(this.mResStr,this.mResPng,this.mResJson),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},t.prototype.onLoadCompleteHandler=function(){this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.con.addAt(this.itemBG,0),this.con.setSize(this.itemBG.width,this.itemBG.height),this.mIcon=new ne(this.mScene,0,0),this.mIcon.visible=!1,this.con.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1,this.con.addAt(this.mSubScriptSprite,2)),this.con.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.con.on("pointerover",this.overHandler,this),this.con.on("pointerout",this.outHandler,this)},t.prototype.overHandler=function(t){this.mSelectRes&&this.mSelectRes.length>0&&(this.mSelectSprite=this.mScene.make.sprite(void 0,!1),this.mSelectSprite.setTexture(this.mResStr,this.mSelectRes),this.con.add(this.mSelectSprite))},t.prototype.outHandler=function(t){this.mSelectSprite&&this.mSelectSprite.parentContainer&&this.mSelectSprite.parentContainer.remove(this.mSelectSprite)},t}(),ae=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),oe=function(t){function e(e){var i=t.call(this)||this;return i.mInitialized=!1,i.mScene=e,i}return ae(e,t),e.prototype.isShow=function(){return this.mShowing},e.prototype.hide=function(){this.destroy()},e.prototype.destroy=function(){},e.prototype.resize=function(){},e.prototype.show=function(t){this.mInitialized||this.preload()},e.prototype.update=function(t){},e.prototype.init=function(){this.mInitialized=!0},e.prototype.preload=function(){this.mScene?(this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.loadComplete,this),this.mScene.load.start()):r.error("scene does not exise")},e.prototype.loadComplete=function(t,e,i){0!==e&&(this.mInitialized||this.init())},e}(Phaser.Events.EventEmitter),he=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),le=function(t){function e(e,i){var r=t.call(this,e)||this;return r.mPageNum=0,r.mPageIndex=0,r.mWid=0,r.mHei=0,r.mScene=e,r.mWorld=i,r.bagSlotList=[],r}return he(e,t),e.prototype.show=function(t){this.isShow()||(this.mShowing=!0,this.createPanel())},e.prototype.update=function(t){},e.prototype.hide=function(){this.mShowing=!1,this.destroy()},e.prototype.resize=function(){var t=this.mWorld.getSize();this.mParentCon&&(this.mParentCon.x=t.width>>1,this.mParentCon.y=t.height-200)},e.prototype.setDataList=function(t){this.mPageNum=Math.ceil(t.length/e.PageMaxCount),this.mDataList=t,this.refreshDataList()},e.prototype.destroy=function(){this.mParentCon&&this.mParentCon.destroy()},e.prototype.getCurPageIndex=function(){return this.mPageIndex},e.prototype.createPanel=function(){this.mResStr="bagView",this.mResPng="./resources/ui/bag/bagView.png",this.mResJson="./resources/ui/bag/bagView.json",this.mScene.cache.obj.has(this.mResStr)?this.onLoadCompleteHandler():(this.mScene.load.atlas(this.mResStr,this.mResPng,this.mResJson),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},e.prototype.onLoadCompleteHandler=function(){var t,e=0,i=this.mWorld.getSize();this.mParentCon=this.mScene.add.container(i.width>>1,i.height-200),this.mPreBtn=this.mScene.make.sprite(void 0,!1),this.mPreBtn.setTexture(this.mResStr,"bagView_tab"),this.mPreBtn.x=-380,e+=this.mPreBtn.width,this.mParentCon.add(this.mPreBtn);var n=0,s=0,a=[],o=-1,h=this.mScene.make.container(void 0,!1);h.x=0,h.y=0,h.setSize(652,622),this.mParentCon.add(h);for(var l=0;l<36;l++)l%12==0&&(a[++o]=[]),n=l%12*52+20,t=new se(this.mScene,h,n,0,this.mResStr,this.mResPng,this.mResJson,"bagView_slot","bagView_itemSelect"),this.bagSlotList.push(t),a[o].push(t.con),l<=11&&(e+=57);for(l=0;l<=o;l++){s=60*l-52;var c=this.mScene.rexUI.add.buttons({x:0,y:s,width:52,height:52,orientation:0,buttons:a[l],groupName:"bagBtn",align:"center",click:{mode:"pointerup",clickInterval:100},space:8,name:"bag"});c.layout(),c.on("button.click",function(t,e,i,n){r.debug(t)},this)}this.mParentCon.addAt(this.createTexture(),0),this.mNextBtn=this.mScene.make.sprite(void 0,!1),this.mNextBtn.setTexture(this.mResStr,"bagView_tab"),this.mNextBtn.scaleX=-1,this.mNextBtn.x=380,e+=this.mNextBtn.width;var u=this.mScene.make.sprite(void 0,!1);u.setTexture(this.mResStr,"bagView_titleBtn"),u.x=80+(-e>>1),u.y=-103,this.mParentCon.add(u);var p=this.mScene.make.text(void 0,!1);p.setFontFamily("Tahoma"),p.setFontStyle("bold"),p.setFontSize(20),p.setText(""),p.x=u.x+u.width-10,p.y=u.y-(p.height>>1),this.mParentCon.add(p),this.mParentCon.add(this.mNextBtn),this.mNextBtn.setInteractive(),this.mPreBtn.setInteractive(),this.mNextBtn.on("pointerup",this.nextHandler,this),this.mPreBtn.on("pointerup",this.preHandler,this),this.mWid=e,this.mHei=206,this.mScene.cache.obj.has("clsBtn")?this.onClsLoadCompleteHandler():(this.mScene.load.spritesheet("clsBtn","resources/ui/common/common_clsBtn.png",{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onClsLoadCompleteHandler,this),this.mScene.load.start())},e.prototype.nextHandler=function(t,e){this.mPageIndex<this.mPageNum-1&&this.mPageIndex++,this.preNextBtnScaleHandler(this.mNextBtn,-1),this.refreshDataList()},e.prototype.preHandler=function(t,e){this.mPageIndex>0&&this.mPageIndex--,this.preNextBtnScaleHandler(this.mPreBtn),this.refreshDataList()},e.prototype.preNextBtnScaleHandler=function(t,e){void 0===e&&(e=1),this.mScene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1},e.prototype.refreshDataList=function(){if(this.mDataList)for(var t,i=this.mDataList.slice((this.mPageIndex-1)*e.PageMaxCount,this.mPageIndex*e.PageMaxCount),n=this.bagSlotList.length,s=0;s<n;s++)(t=this.bagSlotList[s])&&t.dataChange(i[s]);else r.error("this.mDataList is undefiend")},e.prototype.createTexture=function(){var t=this.mScene.add.graphics();return t.fillStyle(7367531,.8),t.fillRect(-362,-102,724,200),t.lineStyle(3,0,.8),t.strokeRect(-365,-103,730,206),t},e.prototype.onClsLoadCompleteHandler=function(){this.mClsBtnSprite=this.mScene.make.sprite(void 0,!1),this.mClsBtnSprite.setTexture("clsBtn","btn_normal"),this.mClsBtnSprite.x=(this.mWid>>1)-65,this.mClsBtnSprite.y=-this.mHei>>1,this.mClsBtnSprite.setInteractive(),this.mClsBtnSprite.on("pointerup",this.hide,this),this.mParentCon.add(this.mClsBtnSprite)},e.PageMaxCount=36,e}(oe),ce=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),ue=function(t){function e(e){var i=t.call(this)||this;return i.mWorld=e,i.initialize=!1,i.mWorld.modelManager&&(i.mModelDispatch=i.mWorld.modelManager),i.mConnect=i.mWorld.connection,i.mConnect.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ADD_ITEM,i.handleAddItem),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_REMOVE_ITEM,i.handleRemoveItem),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EXCHANGE_ITEM_POS,i.handleExchangeItem),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QUERY_PACKAGE,i.handleQueryPackage),i}return ce(e,t),e.prototype.getInitialize=function(){return this.initialize},e.prototype.requestVirtualWorldQueryPackage=function(t,e,i){var r=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),n=r.content;n.id=t,n.page=e,n.perPage=i,this.mConnect.send(r)},e.prototype.handleQueryPackage=function(t){var e=t.content;this.initialize=!0,this.mModelDispatch.emit(jt.QUERY_PACKAGE,e)},e.prototype.handleAddItem=function(t){var e=t.content;e.nodetype===a.op_def.NodeType.ElementNodeType?this.mWorld.modelManager.getModel(Ht.NAME).addPackItems(e.id,e.item):e.nodetype===a.op_def.NodeType.CharacterNodeType&&this.mWorld.modelManager.getModel(Lt.NAME).addPackItems(e.id,e.item),this.mModelDispatch.emit(jt.PACKAGE_ITEM_ADD,e)},e.prototype.handleRemoveItem=function(t){var e,i=t.content,r=i.itemId.length;i.nodetype===a.op_def.NodeType.ElementNodeType?e=this.mWorld.modelManager.getModel(Ht.NAME):i.nodetype===a.op_def.NodeType.CharacterNodeType&&(e=this.mWorld.modelManager.getModel(Lt.NAME));for(var n=0;n<r;n++)e.removePackItems(i.id,i.itemId[n]);this.mModelDispatch.emit(jt.UPDATED_CHARACTER_PACKAGE),this.mModelDispatch.emit(jt.PACKAGE_ITEM_REMOVE,i)},e.prototype.handleExchangeItem=function(t){var e=t.content;this.mModelDispatch.emit(jt.PACKAGE_EXCHANGE_ITEM_POS,e)},e.NAME="BagModel",e}(s.PacketHandler);!function(t){t[t.DRAG_TYPE_SHORTCUT=1]="DRAG_TYPE_SHORTCUT",t[t.DRAG_TYPE_BAG=2]="DRAG_TYPE_BAG"}(te||(te={})),function(t){t[t.DROP_TYPE_SHORTCUT=1]="DROP_TYPE_SHORTCUT",t[t.DROP_TYPE_BAG=2]="DROP_TYPE_BAG"}(ee||(ee={}));var pe=function(){function t(t,e){this.mPageNum=0,this.world=t,this.mPlayerModel=this.world.modelManager.getModel(Lt.NAME),this.mBagModel=this.world.modelManager.getModel(ue.NAME),this.mView=new le(e,t)}return t.prototype.isSceneUI=function(){return!1},t.prototype.isShow=function(){if(this.mView)return this.mView.isShow()},t.prototype.resize=function(){if(this.mView)return this.mView.resize()},t.prototype.setName=function(t){this.mName=t},t.prototype.getName=function(){return this.mName},t.prototype.getView=function(){return this.mView},t.prototype.show=function(t){if(this.mView){this.world.modelManager.on(jt.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage),this.world.modelManager.on(jt.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler),this.world.modelManager.on(jt.QUERY_PACKAGE,this.handleSynchroPackage),this.mView.show(t);var e=this.mPlayerModel.mainPlayerInfo.package;this.mBagModel.requestVirtualWorldQueryPackage(e[0].id,this.mView.getCurPageIndex())}},t.prototype.update=function(t){this.mView&&this.mView.update(t)},t.prototype.hide=function(){this.world.modelManager.off(jt.DRAG_TO_DROP,this.handleDrop),this.world.modelManager.off(jt.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage),this.world.modelManager.off(jt.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler),this.world.modelManager.off(jt.QUERY_PACKAGE,this.handleSynchroPackage),this.mView&&this.mView.hide()},t.prototype.handleDrop=function(t){var e=t[0];t[1].getDropType()===ee.DROP_TYPE_BAG&&e.getDragType()===te.DRAG_TYPE_SHORTCUT&&r.debug("")},t.prototype.refrehView=function(){var t=this.mPlayerModel.mainPlayerInfo.package;null!=t&&0!==t.length&&this.setListData(t[0].items)},t.prototype.setListData=function(t){Math.ceil(t.length/this.mPageNum);this.mView.setDataList(t)},t.prototype.handleSynchroPackage=function(t){this.refrehView()},t.prototype.onUpdatePackageHandler=function(t){this.refrehView()},t}(),de=function(){function t(){}return t.BagHotKey="BagHotKey",t.BagMediator="BagMediator",t.ChatMediator="ChatMediator",t.ControlF="ControlF",t.Storage="Storage",t.UserInfo="UserInfo",t.UserMenu="UserMenu",t.MessageBox="MessageBox",t.ComponentRank="ComponentRank",t.Rank="Rank",t.VoteResult="VoteResult",t.Shop="Shop",t}(),fe=function(){function t(t,e,i,r){this.mShowing=!1,this.mWid=0,this.mHei=0,this.mScene=t,this.mWorld=e,this.mParentCon=this.mScene.add.container(i,r),this.bagSlotList=[]}return t.prototype.isShow=function(){return this.mShowing},t.prototype.show=function(t){this.mShowing||(this.mShowing=!0,this.createPanel())},t.prototype.update=function(t){},t.prototype.hide=function(){this.destroy()},t.prototype.resize=function(){var t=this.mWorld.getSize();this.mParentCon.x=(t.width>>1)-29,this.mParentCon.y=t.height-50},t.prototype.destroy=function(){this.mParentCon&&this.mParentCon.destroy(!0)},t.prototype.setDataList=function(e){for(var i,r,n=[],s=e.length>t.SlotMaxCount?t.SlotMaxCount:e.length,a=["0","b","c"],o=0;o<s;o++)r=o>=9?"bag_SubScript"+a[o%9]:"bag_SubScript"+(o+1),i=new se(this.mScene,this.mParentCon,0,0,this.mResStr,this.mResPng,this.mResJson,"bag_slot","",r),this.bagSlotList.push(i),n.push(i.con),this.mWid+=61;var h=this.mScene.rexUI.add.buttons({x:0,y:0,width:56,height:56,orientation:0,buttons:n,groupName:"bagBtn",align:"center",click:{mode:"pointerup",clickInterval:100},space:5,name:"bag"});h.layout();h.on("button.click",function(t,e,i,r){},this),this.mParentCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mWid,this.mHei),Phaser.Geom.Rectangle.Contains)},t.prototype.createPanel=function(){this.mResStr="bag",this.mResPng="./resources/ui/bag/bag.png",this.mResJson="./resources/ui/bag/bag.json",this.mScene.cache.obj.has(this.mResStr)?this.onLoadCompleteHandler():(this.mScene.load.atlas(this.mResStr,this.mResPng,this.mResJson),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},t.prototype.onLoadCompleteHandler=function(){this.mWid=0,this.mHei=65,this.mBagBtnCon=this.mScene.add.container(0,0),this.mBagBg=this.mScene.add.sprite(0,0,this.mResStr,"bag_BtnBg"),this.mWid+=this.mBagBg.width+5,this.bagBtn=this.mScene.add.sprite(this.mBagBg.x,this.mBagBg.y,this.mResStr,"bag_Btn"),this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,"bag_SubScripta"),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.mBagBg.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.mBagBg.height>>1,this.mBagBtnCon.addAt(this.mBagBg,0),this.mBagBtnCon.addAt(this.bagBtn,1),this.mBagBtnCon.addAt(this.mSubScriptSprite,2),this.mBagBtnCon.setSize(56,56),this.mBagBtnCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBagBg.width,this.mBagBg.height),Phaser.Geom.Rectangle.Contains),this.mParentCon.add(this.mBagBtnCon),this.bagBtn.setInteractive(),this.bagBtn.on("pointerdown",this.bagHandler,this),this.bagBtn.on("pointerover",this.bagBtnOver,this),this.bagBtn.on("pointerout",this.bagBtnOut,this);var t=this.mWorld.modelManager.getModel(Lt.NAME).mainPlayerInfo;this.setDataList(t.package[0].items)},t.prototype.bagHandler=function(){this.mWorld.uiManager.getMediator(de.BagMediator).show();var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),e=t.content,i=this.mWorld.modelManager.getModel(Lt.NAME);e.id=i.mainPlayerInfo.package[0].id,e.page=1,e.perPage=le.PageMaxCount,this.mWorld.connection.send(t)},t.prototype.bagBtnOver=function(t){this.mBagSelect=this.mScene.make.sprite(void 0,!1),this.mBagSelect.setTexture(this.mResStr,"bag_BtnSelect"),this.mBagBtnCon.add(this.mBagSelect)},t.prototype.bagBtnOut=function(t){this.mBagSelect&&this.mBagSelect.parentContainer&&this.mBagSelect.parentContainer.remove(this.mBagSelect)},t.SlotMaxCount=12,t}(),me=function(){function t(t,e){this.mScene=t,this.mWorld=e;this.mWorld.getSize();this.mParentCon=this.mScene.add.container(0,0),this.mParentCon.scaleX=this.mParentCon.scaleY=e.uiScale}return t.prototype.isShow=function(){return this.mShowing},t.prototype.show=function(){this.mShowing||(this.mShowing=!0,this.createPanel())},t.prototype.update=function(){},t.prototype.hide=function(){this.destroy()},t.prototype.resize=function(){var t=this.mWorld.getSize();this.mParentCon.x=t.width-this.mBagBg.width,this.mParentCon.y=this.mBagBg.height>>1},t.prototype.destroy=function(){this.mParentCon.destroy(!0)},t.prototype.createPanel=function(){this.mResStr="bagMobile",this.mResPng="./resources/ui/bag/bag.png",this.mResJson="./resources/ui/bag/bag.json",this.mScene.cache.obj.has(this.mResStr)?this.onLoadCompleteHandler():(this.mScene.load.atlas(this.mResStr,this.mResPng,this.mResJson),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},t.prototype.onLoadCompleteHandler=function(){this.mBagBtnCon=this.mScene.add.container(0,0),this.mBagBg=this.mScene.add.sprite(0,0,this.mResStr,"bag_BtnBg"),this.bagBtn=this.mScene.add.sprite(this.mBagBg.x,this.mBagBg.y,this.mResStr,"bag_Btn"),this.mBagBtnCon.addAt(this.mBagBg,0),this.mBagBtnCon.addAt(this.bagBtn,1),this.mBagBtnCon.setSize(56,56),this.mBagBtnCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBagBg.width,this.mBagBg.height),Phaser.Geom.Rectangle.Contains),this.mParentCon.add(this.mBagBtnCon),this.bagBtn.setInteractive(),this.bagBtn.on("pointerdown",this.bagHandler,this),this.resize()},t.prototype.bagHandler=function(t){this.mWorld.uiManager.getMediator(de.BagMediator).show();var e=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),i=e.content,r=this.mWorld.modelManager.getModel(Lt.NAME);i.id=r.mainPlayerInfo.package[0].id,i.page=1,i.perPage=le.PageMaxCount,this.mWorld.connection.send(e),this.preNextBtnScaleHandler(this.mBagBtnCon)},t.prototype.preNextBtnScaleHandler=function(t,e){void 0===e&&(e=1),this.mScene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1},t}(),ge=function(){function t(t,e){this.world=t,this.mPlayerModel=this.world.modelManager.getModel(Lt.NAME),this.mBagModel=this.world.modelManager.getModel(ue.NAME);var i=this.world.getSize();this.world.game.device.os.desktop?this.mView=new fe(e,this.world,(i.width>>1)-29,i.height-50):this.mView=new me(e,this.world),this.mView&&this.mView.show(void 0)}return t.prototype.isSceneUI=function(){return!0},t.prototype.isShow=function(){if(this.mView)return this.mView.isShow()},t.prototype.resize=function(){this.mView&&this.mView.resize()},t.prototype.setName=function(t){this.mName=t},t.prototype.getName=function(){return this.mName},t.prototype.getView=function(){return this.mView},t.prototype.show=function(t){this.mView&&(this.mView.show(t),this.world.modelManager.on(jt.QUERY_PACKAGE,this.queryPackAge),this.world.modelManager.on(jt.UPDATED_CHARACTER_PACKAGE,this.heroItemChange))},t.prototype.update=function(t){this.mView&&this.mView.update(t)},t.prototype.hide=function(){this.world.modelManager.off(jt.QUERY_PACKAGE,this.queryPackAge),this.world.modelManager.off(jt.UPDATED_CHARACTER_PACKAGE,this.heroItemChange),this.mView&&this.mView.hide()},t.prototype.heroItemChange=function(){var t=this.world.modelManager.getModel(Lt.NAME).mainPlayerInfo.package[0].items;this.mView&&this.world.game.device.os.desktop&&this.mView.setDataList(t)},t.prototype.queryPackAge=function(t){t.items.length;this.mView&&this.world.game.device.os.desktop&&this.mView.setDataList(t.items)},t}();const _e=Phaser.Utils.Objects.GetValue;var ye=function(t,e,i){return void 0===t?{x:e,y:i}:"number"==typeof t?{x:t,y:t}:t},ve=class{constructor(t,e,i,r,n){this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,i,r,n)}setTo(t,e,i,r,n){return this.setPosition(t,e),this.setRadius(n),this.setSize(i,r),this}setPosition(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}setRadius(t){var e,i;void 0===t&&(t=0),"number"==typeof t?(e=t,i=t):(e=_e(t,"x",0),i=_e(t,"y",0));var r=this.cornerRadius;return r.tl=ye(_e(t,"tl",void 0),e,i),r.tr=ye(_e(t,"tr",void 0),e,i),r.bl=ye(_e(t,"bl",void 0),e,i),r.br=ye(_e(t,"br",void 0),e,i),this}setSize(t,e){return this.width=t,this.height=e,this}get minWidth(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}get minHeight(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}get width(){return this._width}set width(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}get height(){return this._height}set height(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}get radius(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}},be=function(t,e,i){var r=i.length;if(r>=2){var n=i[r-2],s=i[r-1];if(t===n&&e===s)return i}return i.push(t,e),i},Pe=i(143),Te=i.n(Pe);const xe=Phaser.Utils.Objects.GetValue;var Se=function(t,e,i,r,n,s,a,o){var h,l,c,u=xe(i,"x",i),p=xe(i,"y",i);s&&(n+=360),r=Te()(r);for(var d=((n=Te()(n))-r)/a,f=0;f<=a;f++)c=r+d*f,h=t+u*Math.cos(c),l=e+p*Math.sin(c),be(h,l,o);return o},Oe=i(144),Ce=i.n(Oe),De=i(145),we=i.n(De),Ae=i(148),Ee=i.n(Ae),Me=function(){},Ie={renderWebGL:we.a,renderCanvas:Ee.a};const Be=Phaser.Utils.Objects.GetValue;class ke extends Phaser.GameObjects.Shape{constructor(t,e,i,r,n,s,a,o){void 0===e&&(e=0),void 0===i&&(i=0);var h=Be(s,"iteration",void 0);s=Be(s,"radius",s),super(t,"RoundRectangle",new ve(0,0,r,n,s)),this.setIteration(h),this.setPosition(e,i),void 0!==a&&this.setFillStyle(a,o),this.updateDisplayOrigin(),this.updateData()}updateData(){var t=this.geom,e=this.pathData;e.length=0;var i,r=t.cornerRadius,n=this.iteration+1;if(i=r.br,Re(i)){var s=t.width-i.x,a=t.height-i.y;Se(s,a,i,0,90,!1,n,e)}else be(t.width,t.height,e);if(i=r.bl,Re(i)){s=i.x,a=t.height-i.y;Se(s,a,i,90,180,!1,n,e)}else be(0,t.height,e);if(i=r.tl,Re(i)){s=i.x,a=i.y;Se(s,a,i,180,270,!1,n,e)}else be(0,0,e);if(i=r.tr,Re(i)){s=t.width-i.x,a=i.y;Se(s,a,i,270,360,!1,n,e)}else be(t.width,0,e);return e.push(e[0],e[1]),this.pathIndexes=Ce()(e),this}get width(){return this.geom.width}set width(t){this.width!==t&&(this.geom.width=t,this.updateDisplayOrigin(),this.updateData())}get height(){return this.geom.height}set height(t){this.height!==t&&(this.geom.height=t,this.updateDisplayOrigin(),this.updateData())}resize(t,e){return void 0===e&&(e=t),this.geom.width===t&&this.geom.height===e?this:(this.geom.height=e,this.geom.width=t,this.updateDisplayOrigin(),this.updateData(),this)}get iteration(){return this._iteration}set iteration(t){void 0!==this._iteration?this._iteration!==t&&(this._iteration=t,this.updateData()):this._iteration=t}setIteration(t){return void 0===t&&(t=6),this.iteration=t,this}get radius(){return this.geom.radius}set radius(t){this.geom.setRadius(t),this.updateDisplayOrigin(),this.updateData()}setRadius(t){return void 0===t&&(t=0),this.radius=t,this}get cornerRadius(){return this.geom.cornerRadius}set cornerRadius(t){this.radius=t}setCornerRadius(t){return this.setRadius(t)}}var Re=function(t){return 0!==t.x&&0!==t.y};Object.assign(ke.prototype,Ie);var Ne=ke,je={add(t){return Array.isArray(t)?this.addMultiple(t):this._add(t),this},addMultiple(t){return t.forEach(this._add,this),this},_add(t){return this.children.add(t),this.resetChildState(t).updateChildVisible(t).updateChildActive(t).updateChildScrollFactor(t).updateChildMask(t),this}},Le={remove(t,e){return this.children.remove(t,!1,e),this},clear(t){return this.children.clear(!1,t),this}},Fe={getLocalState:t=>(t.hasOwnProperty("rexContainer")||(t.rexContainer={}),t.rexContainer),resetChildState(t){return this.resetChildPositionState(t).resetChildVisibleState(t).resetChildAlphaState(t).resetChildActiveState(t),this},resetChildrenState(t){for(var e=0,i=t.length;e<i;e++)this.resetChildState(t[e]);return this},syncProperties(){return this.syncPosition().syncVisible().syncAlpha().syncActive().syncScrollFactor().syncMask(),this}};const ze=Phaser.Math.RotateAround;var Ve={worldToLocal(t){return t.x-=this.x,t.y-=this.y,ze(t,0,0,-this.rotation),t.x/=this.scaleX,t.y/=this.scaleY,t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t},localToWorld(t){return t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t.x*=this.scaleX,t.y*=this.scaleY,ze(t,0,0,this.rotation),t.x+=this.x,t.y+=this.y,t}},He=function(t,e){return t===e?1:t/e},Ye={updateChildPosition(t){t.isRexContainerLite&&(t.syncChildrenEnable=!1);var e=this.getLocalState(t);return t.x=e.x,t.y=e.y,this.localToWorld(t),t.scaleX=e.scaleX*this.scaleX,t.scaleY=e.scaleY*this.scaleY,void 0!==t.flipX&&(t.flipX=this.flipX?!e.flipX:e.flipX,t.flipY=this.flipY?!e.flipY:e.flipY),t.rotation=e.rotation+this.rotation,t.isRexContainerLite&&(t.syncChildrenEnable=!0,t.syncPosition()),this},syncPosition(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildPosition,this),this},resetChildPositionState(t){var e=this.getLocalState(t);return e.x=t.x,e.y=t.y,this.worldToLocal(e),e.scaleX=He(t.scaleX,this.scaleX),e.scaleY=He(t.scaleY,this.scaleY),void 0!==t.flipX&&(e.flipX=t.flipX,e.flipY=t.flipY),e.rotation=t.rotation-this.rotation,this},setChildPosition(t,e,i){return t.x=e,t.y=i,this.resetChildPositionState(t),this},setChildLocalPosition(t,e,i){var r=this.getLocalState(t);return r.x=e,r.y=i,this.updateChildPosition(t),this}},Ge={updateChildVisible(t){return t.visible=this.visible&&this.getLocalState(t).visible,this},syncVisible(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildVisible,this),this},resetChildVisibleState(t){return this.getLocalState(t).visible=t.visible,this},setChildVisible(t,e){return t.visible=e,this.resetChildVisibleState(t),this},setChildLocalVisible(t,e){return void 0===e&&(e=!0),this.getLocalState(t).visible=e,this.updateChildVisible(t),this}},Ue={updateChildAlpha(t){return t.alpha=this.alpha*this.getLocalState(t).alpha,this},syncAlpha(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildAlpha,this),this},resetChildAlphaState(t){return this.getLocalState(t).alpha=He(t.alpha,this.alpha),this},setChildAlpha(t,e){return t.alpha=e,this.resetChildAlphaState(t),this._add},setChildLocalAlpha(t,e){return this.getLocalState(t).alpha=e,this.updateChildAlpha(t),this}},We={updateChildActive(t){return t.active=this.active&&this.getLocalState(t).active,this},syncActive(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildActive,this),this},resetChildActiveState(t){return this.getLocalState(t).active=t.active,this},setChildActive(t,e){return t.active=e,this.resetChildActiveState(t),this},setChildLocalActive(t,e){return void 0===e&&(e=!0),this.getLocalState(t).active=e,this.updateChildActive(t),this}},Xe={updateChildScrollFactor(t){return t.setScrollFactor(this.scrollFactorX,this.scrollFactorY),this},syncScrollFactor(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildScrollFactor,this),this}},Ke={updateChildMask(t){return null==this.mask?this:((this.mask.hasOwnProperty("geometryMask")?this.mask.geometryMask:this.mask.bitmapMask)!==t&&(t.mask=this.mask),this)},syncMask(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildMask,this),this},setMask(t){return this.mask=t,this},clearMask(t){return void 0===t&&(t=!1),t&&this.mask&&this.mask.destroy(),this.mask=null,this}},Je={setDepth(t){if(this.depth=t,this.children)for(var e=this.getAllChildren(),i=0,r=e.length;i<r;i++)e[i].depth=t;return this},swapDepth(t){var e=this.depth,i=t.depth;return this.setDepth(i),t.setDepth(e),this},incDepth(t){if(this.depth+=t,this.children)for(var e=this.getAllChildren(),i=0,r=e.length;i<r;i++)e[i].depth+=t;return this}};const Ze=Phaser.Utils.Array;var qe={getChildren(){return this.children.getChildren()},getAllChildren(t){void 0===t&&(t=[]);for(var e,i=this.children.getChildren(),r=0,n=i.length;r<n;r++)e=i[r],t.push(e),e.hasOwnProperty("isRexContainerLite")&&t.push(...e.getAllChildren());return t},contains(t){if(this.children.contains(t))return!0;for(var e,i=this.children.getChildren(),r=0,n=i.length;r<n;r++)if((e=i[r]).isRexContainerLite&&e.contains(t))return!0;return!1},getByName(t){return Ze.GetFirst(this.list,"name",t)},getRandom(t,e){return Ze.GetRandom(this.list,t,e)},getFirst(t,e,i,r){return Ze.GetFirstElement(this.list,t,e,i,r)},getAll(t,e,i,r){return Ze.GetAll(this.list,t,e,i,r)},count(t,e,i,r){return Ze.CountAllMatching(this.list,t,e,i,r)},swap(t,e){return Ze.Swap(this.list,t,e),this},moveTo(t,e){return Ze.MoveTo(this.list,t,e),this},setAll(t,e,i,r){return Ze.SetAll(this.list,t,e,i,r),this}};const $e=Phaser.GameObjects.Zone,Qe=Phaser.GameObjects.Components;class ti extends $e{constructor(t,e,i,r,n,s){Array.isArray(r)&&(s=r,r=void 0),void 0===r&&(r=1),void 0===n&&(n=1),super(t,e,i,r,n),this.children=t.add.group(),this.type="rexContainerLite",this.isRexContainerLite=!0,this.syncChildrenEnable=!0,this._flipX=!1,this._flipY=!1,this._alpha=1,this._active=!0,this._mask=null,this._scrollFactorX=1,this._scrollFactorY=1,s&&this.add(s)}destroy(t){this.scene&&(this.children.destroy(!t),this.children=void 0,super.destroy(t))}resize(t,e){return this.setSize(t,e),this}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.syncPosition())}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.syncPosition())}get rotation(){return super.rotation}set rotation(t){this.rotation!==t&&(super.rotation=t,this.syncPosition())}get scaleX(){return super.scaleX}set scaleX(t){this.scaleX!==t&&(super.scaleX=t,this.syncPosition())}get scaleY(){return super.scaleY}set scaleY(t){this.scaleY!==t&&(super.scaleY=t,this.syncPosition())}get flipX(){return this._flipX}set flipX(t){this._flipX!==t&&(this._flipX=t,this.syncPosition())}get flipY(){return this._flipY}set flipY(t){this._flipY!==t&&(this._flipY=t,this.syncPosition())}get visible(){return super.visible}set visible(t){this.visible!==t&&(super.visible=t,this.syncVisible())}get alpha(){return this._alpha}set alpha(t){this._alpha!==t&&(this._alpha=t,this.syncAlpha())}get active(){return this._active}set active(t){this._active!==t&&(this._active=t,this.syncActive())}get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t,this.syncMask())}get scrollFactorX(){return this._scrollFactorX}set scrollFactorX(t){this._scrollFactorX!==t&&(this._scrollFactorX=t,this.syncScrollFactor())}get scrollFactorY(){return this._scrollFactorY}set scrollFactorY(t){this._scrollFactorY!==t&&(this._scrollFactorY=t,this.syncScrollFactor())}get list(){return this.children.getChildren()}}Object.assign(ti.prototype,je,Le,Fe,Ve,Ye,Ge,Ue,Xe,We,Ke,Je,qe,Qe.Alpha,Qe.Flip);var ei,ii=ti,ri=ii,ni=function(t){return t.hasOwnProperty("rexSizer")||(t.rexSizer={}),t.rexSizer},si=function(t,e){void 0===e&&(void 0===ei&&(ei=new Phaser.Geom.Rectangle),e=ei);var i=t.game.config;return e.setTo(0,0,i.width,i.height),e},ai=function(t){return void 0===t&&(t=si(this.scene)),this.left=Math.max(this.left,t.left),this.right=Math.min(this.right,t.right),this.top=Math.max(this.top,t.top),this.bottom=Math.min(this.bottom,t.bottom),this},oi=new Phaser.Geom.Rectangle,hi=function(t,e){void 0===e&&(e=16777215);for(var i,r=this.getAllChildren([this]),n=0,s=r.length;n<s;n++)(i=r[n]).getBounds&&t.lineStyle(1,e).strokeRectShape(i.getBounds(oi));return this},li=function(t,e){return void 0===this.childrenMap&&(this.childrenMap={}),this.childrenMap[t]=e,this},ci=function(t,e){var i;for(var r in void 0===e&&(e=[]),t)void 0!==(i=t[r]).name?e.push(i):ci(i,e);return e};const ui=/(\S+)\[(\d+)\]/i;var pi=[],di=function(t){if(void 0!==this.childrenMap&&("string"==typeof t&&(t=t.split(".")),0!==t.length)){var e,i=t.shift();if("#"===i.charAt(0)){i=i.substring(1);for(var r=0,n=(s=ci(this.childrenMap,pi)).length;r<n;r++)if(s[r].name===i){e=s[r];break}pi.length=0}else if(-1===i.indexOf("["))e=this.childrenMap[i];else{var s,a=i.match(ui);null!=a&&(s=this.childrenMap[a[1]])&&(e=s[a[2]])}return 0===t.length?e:e&&e.childrenMap?e.getElement(t):null}},fi=function(){return 0},mi=function(){return 0},gi=function(t){void 0===t&&(t=[]);for(var e=t.length,i=this.getChildrenSizers(t),r=t.length,n=e;n<r;n++)i[n].getAllChildrenSizers(t);return t},_i=function(t){return void 0===t&&(t=[]),t},yi=function(t,e,i){},vi=function(t){if(!t)for(var e,i=this.getAllChildrenSizers([this]),r=0,n=i.length;r<n;r++)(e=i[r]).rexSizer&&e._layoutInit()},bi=function(){};const Pi=Phaser.Scene;var Ti=function(t){return t instanceof Pi},xi=function(t){return Ti(t)?t:t.scene&&Ti(t.scene)?t.scene:t.parent&&t.parent.scene&&Ti(t.parent.scene)?t.parent.scene:void 0};const Si=Phaser.Utils.Objects.GetValue,Oi=Phaser.Utils.Objects.GetAdvancedValue;const Ci={stop:0,destroy:1,yoyo:2};var Di=class{constructor(t,e){this.gameObject=t,this.scene=xi(t),this.scaleStart={},this.scaleEnd={},this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setMode(Si(t,"mode",0)),this.setScaleRange(Oi(t,"start",void 0),Oi(t,"end",0)),this.setDelay(Oi(t,"delay",0)),this.setDuration(Oi(t,"duration",1e3)),this.setEase(Si(t,"ease",void 0)),this}toJSON(){return{mode:this.mode,start:this.scaleStart,end:this.scaleEnd,delay:this.delay,duration:this.duration}}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setMode(t){return"string"==typeof t&&(t=Ci[t]),this.mode=t,this}setScaleRange(t,e){return"number"==typeof t?(this.scaleStart.x=t,this.scaleStart.y=t):(this.scaleStart.x=Si(t,"x",this.gameObject.scaleX),this.scaleStart.y=Si(t,"y",this.gameObject.scaleY)),"number"==typeof e?(this.scaleEnd.x=e,this.scaleEnd.y=e):(this.scaleEnd.x=Si(e,"x",this.scaleStart.x),this.scaleEnd.y=Si(e,"y",this.scaleStart.y)),this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}setEase(t){return void 0===t&&(t="Linear"),this.ease=t,this}start(){return this.tween?this:0===this.duration?(this.sound.setScale(this.scaleEnd.x,this.scaleEnd.y),this.complete(),this):(this.gameObject.setScale(this.scaleStart.x,this.scaleStart.y),this.tween=this.scene.tweens.add({targets:this.gameObject,scaleX:this.scaleEnd.x,scaleY:this.scaleEnd.y,duration:this.duration,ease:this.ease,yoyo:2==this.mode,repeat:2==this.mode?-1:0,onComplete:this.complete,onCompleteScope:this}),this)}restart(){return this.stop().start(),this}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),1===this.mode&&this.gameObject.destroy(),this}},wi={},Ai=function(t,e,i,r,n){switch(wi.mode=0,i){case"x":wi.start={x:0};break;case"y":wi.start={y:0};break;default:wi.start=0}return wi.end=1,wi.duration=e,wi.ease=void 0===r?"Cubic":r,void 0===n?n=new Di(t,wi):n.resetFromJSON(wi),n.restart(),n};const Ei=Phaser.Utils.Objects.IsPlainObject,Mi=Phaser.Utils.Objects.GetValue;var Ii={},Bi=function(t,e,i,r,n,s){switch(n instanceof Di&&(s=n,n=void 0),void 0===n&&(n=!0),Ii.mode=n?1:0,i){case"x":Ii.end={x:0};break;case"y":Ii.end={y:0};break;default:Ii.end=0}return Ii.duration=e,Ii.ease=void 0===r?"Linear":r,void 0===s?s=new Di(t,Ii):s.resetFromJSON(Ii),s.restart(),s};const ki=Phaser.Utils.Objects.IsPlainObject,Ri=Phaser.Utils.Objects.GetValue;const Ni=Phaser.Utils.Objects.GetValue,ji=Phaser.Utils.Objects.GetAdvancedValue;const Li={stop:0,destroy:1,yoyo:2};var Fi=class{constructor(t,e){this.gameObject=t,this.scene=xi(t),this.alphaStart=void 0,this.alphaEnd=void 0,this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setMode(Ni(t,"mode",0)),this.setAlphaRange(ji(t,"start",this.gameObject.alpha),ji(t,"end",0)),this.setDelay(ji(t,"delay",0)),this.setDuration(ji(t,"duration",1e3)),this}toJSON(){return{mode:this.mode,start:this.alphaStart,end:this.alphaEnd,delay:this.delay,duration:this.duration}}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setMode(t){return"string"==typeof t&&(t=Li[t]),this.mode=t,this}setAlphaRange(t,e){return this.alphaStart=t,this.alphaEnd=e,this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}start(){return this.tween?this:0===this.duration?(this.gameObject.setAlpha(this.alphaEnd),this.complete(),this):(this.gameObject.setAlpha(this.alphaStart),this.tween=this.scene.tweens.add({targets:this.gameObject,alpha:this.alphaEnd,delay:this.delay,duration:this.duration,ease:"Linear",yoyo:2==this.mode,repeat:2==this.mode?-1:0,onComplete:this.complete,onCompleteScope:this}),this)}restart(){return this.stop().start(),this}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),1===this.mode&&this.gameObject.destroy(),this}},zi={},Vi=function(t,e,i,r){return void 0===i&&(i=t.alpha),zi.mode=0,zi.start=0,zi.end=i,zi.duration=e,void 0===r?r=new Fi(t,zi):r.resetFromJSON(zi),r.restart(),r};const Hi=Phaser.Utils.Objects.IsPlainObject,Yi=Phaser.Utils.Objects.GetValue;var Gi={},Ui=function(t,e,i,r){return i instanceof Fi&&(r=i,i=void 0),void 0===i&&(i=!0),Gi.mode=i?1:0,Gi.end=0,Gi.duration=e,void 0===r?r=new Fi(t,Gi):r.resetFromJSON(Gi),r.restart(),r};const Wi=Phaser.Utils.Objects.IsPlainObject,Xi=Phaser.Utils.Objects.GetValue;var Ki=void 0,Ji=function(t){if(void 0===Ki&&(Ki=new Phaser.Geom.Rectangle),this.getBounds(Ki),void 0!==t)return Ki.contains(t.x,t.y);for(var e=this.scene.input.manager,i=e.pointersTotal,r=e.pointers,n=0;n<i;n++)if(t=r[n],Ki.contains(t.x,t.y))return!0;return!1},Zi=function(t){void 0===t&&(t=this);for(var e=ni(t).parent;e;)e=ni(t=e).parent;return t},qi=function(t,e,i){!t||void 0===e&&void 0===i||(t.resize?(void 0===e&&(e=t.width),void 0===i&&(i=t.height),t.resize(e,i)):(void 0!==e&&(t.displayWidth=e),void 0!==i&&(t.displayHeight=i)))},$i=new Phaser.GameObjects.Zone({sys:{queueDepthSort:Me,events:{once:Me}}},0,0,1,1);$i.setOrigin(0);var Qi=$i;const tr=Phaser.Display.Align.In.QuickSet,er=Phaser.Display.Align.CENTER;var ir=function(t,e,i){var r=this.getTopmostSizer();r.x+=e-this.x,r.y+=i-this.y},rr={getSizerConfig:ni,pushIntoBounds:ai,drawBounds:hi,getChildrenWidth:fi,getChildrenHeight:mi,addChildrenMap:li,addElement:li,getElement:di,getAllChildrenSizers:gi,getChildrenSizers:_i,layout:yi,layoutBackgrounds:function(){if(void 0!==this.backgroundChildren)for(var t,e=this.backgroundChildren,i=this.left,r=this.top,n=this.width,s=this.height,a=0,o=e.length;a<o;a++)(t=e[a]).rexSizer.hidden||(qi(t,n,s),Qi.setPosition(i,r).setSize(n,s),tr(t,Qi,er),this.resetChildPositionState(t))},layoutInit:vi,_layoutInit:bi,popUp:function(t,e,i){if(Ei(t)){var r=t;t=Mi(r,"duration",void 0),e=Mi(r,"orientation",void 0),i=Mi(r,"ease",void 0)}return this._scale=Ai(this,t,e,i,this._scale),this},scaleDownDestroy:function(t,e,i,r){if(ki(t)){var n=t;t=Ri(n,"duration",void 0),e=Ri(n,"orientation",void 0),i=Ri(n,"ease",void 0),r=Ri(n,"destroy",void 0)}return this._scale=Bi(this,t,e,i,r,this._scale),this},fadeIn:function(t){Hi(t)&&(t=Yi(t,"duration",void 0));return this._fade=Vi(this,t,this._fade),this},fadeOutDestroy:function(t,e){if(Wi(t)){var i=t;t=Xi(i,"duration",void 0),e=Xi(i,"destroy",void 0)}return this._fade=Ui(this,t,e,this._fade),this},isInTouching:Ji,getTopmostSizer:Zi,setDraggable:function(t){return void 0===t&&(t=!0),this.input&&this.input.hasOwnProperty("draggable")?this.input.draggable=t:t&&(this.setInteractive(),this.scene.input.setDraggable(this),this.on("drag",ir,this)),this}};const nr=Phaser.Geom.Rectangle;var sr=function(t,e){void 0===e&&(e=new nr);var i=t.canvasBounds,r=t.displayScale,n=t.autoCenter;return e.x=i.x>=0?0:-i.x*r.x,e.y=i.y>=0?0:-i.y*r.y,e.width=i.width*r.x-e.x,e.height=i.height*r.y-e.y,1!==n&&2!==n||(e.width-=e.x),1!==n&&3!==n||(e.height-=e.y),e};const ar=Phaser.Utils.Objects.GetValue,or=Phaser.Geom.Rectangle;var hr=class{constructor(t,e){this.gameObject=t,this.viewport=new or,this.resetFromJSON(e),this.boot()}resetFromJSON(t){var e,i;if("string"==typeof t){var r=t.split(",");e=r[0],i=r[1]}else e=ar(t,"x","0%+0"),i=ar(t,"y","0%+0");e=e.replace("left","0%").replace("right","100%").replace("center","50%").split("%");var n=parseFloat(e[0])/100,s=""===e[1]?0:parseFloat(e[1]);i=i.replace("top","0%").replace("bottom","100%").replace("center","50%").split("%");var a=parseFloat(i[0])/100,o=""===i[1]?0:parseFloat(i[1]);return this.setPercentage(n,a),this.setOffset(s,o),this}boot(){this.scaleManamger.on("resize",this.onResize,this),this.gameObject.once("destroy",this.destroy,this),this.onResize()}shutdown(){this.scaleManamger.off("resize",this.onResize,this),this.gameObject=void 0}destroy(){this.shutdown()}setOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.offsetX=t,this.offsetY=e,this}setPercentage(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.percentageX=t,this.percentageY=e,this}onResize(){sr(this.scaleManamger,this.viewport),this.updatePosition()}updatePosition(){return this.gameObject.setPosition(this.x,this.y),this}get scaleManamger(){return this.gameObject.scene.scale}get x(){return this.viewport.x+this.viewport.width*this.percentageX+this.offsetX}get y(){return this.viewport.y+this.viewport.height*this.percentageY+this.offsetY}};const lr=Phaser.Utils.Objects.GetValue;class cr extends ri{constructor(t,e,i,r,n,s){var a,o;"string"==typeof e&&(a=e,o=i,e=0,i=0),super(t,e,i,2,2),this.isRexSizer=!0,this.setMinSize(r,n),this.setName(lr(s,"name","")),this.rexSizer={},this.backgroundChildren=void 0,void 0!==a&&(this._anchor=new hr(this,{x:a,y:o})),this.setDraggable(lr(s,"draggable",!1))}destroy(t){this.scene&&(void 0!==this.backgroundChildren&&(this.backgroundChildren.length=0),super.destroy(t))}setMinSize(t,e){return this.setMinWidth(t).setMinHeight(e),this}setMinWidth(t){return null==t&&(t=0),this.minWidth=t,this}setMinHeight(t){return null==t&&(t=0),this.minHeight=t,this}get childrenWidth(){return void 0===this._childrenWidth&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return void 0===this._childrenHeight&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}get left(){return this.x-this.displayWidth*this.originX}set left(t){this.x+=t-this.left}alignLeft(t){return this.left=t,this}get right(){return this.x-this.displayWidth*this.originX+this.displayWidth}set right(t){this.x+=t-this.right}alignRight(t){return this.right=t,this}get centerX(){return(this.left+this.right)/2}set centerX(t){this.x+=t-this.centerX}alignCenterX(t){return this.centerX=t,this}get top(){return this.y-this.displayHeight*this.originY}set top(t){this.y+=t-this.top}alignTop(t){return this.top=t,this}get bottom(){return this.y-this.displayHeight*this.originY+this.displayHeight}set bottom(t){this.y+=t-this.bottom}alignBottom(t){return this.bottom=t,this}get centerY(){return(this.top+this.bottom)/2}set centerY(t){this.y+=t-this.centerY}alignCenterY(t){return this.centerY=t,this}pin(t){return super.add(t),this}addBackground(t){return void 0===this.backgroundChildren&&(this.backgroundChildren=[]),super.add(t),this.getSizerConfig(t).parent=this,this.backgroundChildren.push(t),this}}Object.assign(cr.prototype,rr);var ur=cr,pr=function(t){if(this.rexSizer.hidden)return 0;void 0===t&&(t=!0);var e,i,r,n=0,s=this.sizerChildren;if(0===this.orientation)for(var a=0,o=s.length;a<o;a++)(e=s[a]).rexSizer.hidden||(r=0===e.rexSizer.proportion||t&&e.rexSizer.proportion>0?e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width:0,n+=r+=(i=e.rexSizer.padding).left+i.right);else for(a=0,o=s.length;a<o;a++)(e=s[a]).hasOwnProperty("rexSizer")&&(e.rexSizer.hidden||(r=e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width,r+=(i=e.rexSizer.padding).left+i.right,n=Math.max(r,n)));return n},dr=function(t){if(this.rexSizer.hidden)return 0;void 0===t&&(t=!0);var e,i,r,n=0,s=this.sizerChildren;if(0===this.orientation)for(var a=0,o=s.length;a<o;a++)(e=s[a]).rexSizer.hidden||(r=e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height,r+=(i=e.rexSizer.padding).top+i.bottom,n=Math.max(r,n));else for(a=0,o=s.length;a<o;a++)(e=s[a]).hasOwnProperty("rexSizer")&&(e.rexSizer.hidden||(r=0===e.rexSizer.proportion||t&&e.rexSizer.proportion>0?e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height:0,n+=r+=(i=e.rexSizer.padding).top+i.bottom));return n},fr=function(){for(var t,e,i=0,r=this.sizerChildren,n=0,s=r.length;n<s;n++)(t=r[n]).rexSizer.hidden||(e=t.rexSizer.proportion)>0&&(i+=e);return i},mr=function(t){void 0===t&&(t=[]);for(var e,i=this.sizerChildren,r=0,n=i.length;r<n;r++)(e=i[r]).isRexSizer&&t.push(e);return t},gr=function(t,e){var i,r=e.rexSizer,n=r.padding;return 0===t.orientation?r.proportion>0&&t.proportionLength>0&&(i=r.proportion*t.proportionLength):r.expand&&(i=t.width-n.left-n.right),i},_r=function(t,e){var i,r=e.rexSizer,n=r.padding;return 0===t.orientation?r.expand&&(i=t.height-n.top-n.bottom):r.proportion>0&&t.proportionLength>0&&(i=r.proportion*t.proportionLength),i};const yr=Phaser.Display.Align.In.QuickSet;var vr={getChildrenWidth:pr,getChildrenHeight:dr,getChildrenProportion:fr,getChildrenSizers:mr,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var r;if(this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i),this.childrenProportion>0){var n=0===this.orientation?this.width-this.childrenWidth:this.height-this.childrenHeight;r=n>0?(n=0===this.orientation?this.width-this.getChildrenWidth(!1):this.height-this.getChildrenHeight(!1))/this.childrenProportion:0}else r=0;this.proportionLength=r;for(var s,a,o,h,l,c,u,p,d,f=this.sizerChildren,m=this.left,g=this.top,_=0,y=f.length;_<y;_++)(s=f[_]).rexSizer.hidden||(o=(a=s.rexSizer).padding,p=gr(this,s),d=_r(this,s),s.isRexSizer?s.layout(this,p,d):qi(s,p,d),void 0===p&&(p=s.width),void 0===d&&(d=s.height),0===this.orientation?(h=m+o.left,c=0===a.proportion||0===r?p:a.proportion*r,l=g+o.top,u=this.height-o.top-o.bottom):(h=m+o.left,c=this.width-o.left-o.right,l=g+o.top,u=0===a.proportion||0===r?d:a.proportion*r),Qi.setPosition(h,l).setSize(c,u),yr(s,Qi,a.align),this.resetChildPositionState(s),0===this.orientation?m+=c+o.left+o.right:g+=u+o.top+o.bottom);return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0,this._childrenProportion=void 0}};const br=Phaser.Utils.Objects.GetValue;var Pr=function(t,e){return void 0===e&&(e={}),"number"==typeof t?(e.left=t,e.right=t,e.top=t,e.bottom=t):(e.left=br(t,"left",0),e.right=br(t,"right",0),e.top=br(t,"top",0),e.bottom=br(t,"bottom",0)),e},Tr={x:0,h:0,horizontal:0,"left-to-right":0,y:1,v:1,vertical:1,"top-to-bottom":1};const xr=Phaser.Display.Align;var Sr={center:xr.CENTER,left:xr.LEFT_CENTER,right:xr.RIGHT_CENTER,top:xr.TOP_CENTER,bottom:xr.BOTTOM_CENTER,"left-top":xr.TOP_LEFT,"left-center":xr.LEFT_CENTER,"left-bottom":xr.LEFT_BOTTOM,"center-top":xr.TOP_CENTER,"center-center":xr.CENTER,"center-bottom":xr.BOTTOM_CENTER,"right-top":xr.TOP_RIGHT,"right-center":xr.RIGHT_CENTER,"right-bottom":xr.RIGHT_BOTTOM};const Or=Phaser.Utils.Objects.IsPlainObject,Cr=Phaser.Utils.Objects.GetValue,Dr=Phaser.Utils.Array.Remove,wr=Phaser.Display.Align.CENTER;class Ar extends ur{constructor(t,e,i,r,n,s){var a;Or(e)?(e=Cr(a=e,"x",0),i=Cr(a,"y",0),r=Cr(a,"width",void 0),n=Cr(a,"height",void 0)):Or(r)?(r=Cr(a=r,"width",void 0),n=Cr(a,"height",void 0)):Or(s)&&(a=s),void 0!==a&&(s=Cr(a,"orientation",0)),void 0===s&&(s=0),super(t,e,i,r,n,a),this.type="rexSizer",this.sizerChildren=[],this.setOrientation(s)}destroy(t){this.scene&&(this.sizerChildren.length=0,super.destroy(t))}setOrientation(t){return"string"==typeof t&&(t=Tr[t]),this.orientation=t,this}add(t,e,i,r,n){super.add(t);var s=typeof e;if(null===e)return this;if("number"===s);else if("string"===s)e=Er[e];else if(Or(e)){var a;e=Cr(a=e,"proportion",0),i=Cr(a,"align",wr),r=Cr(a,"padding",0),n=Cr(a,"expand",!1)}return"string"==typeof i&&(i=Sr[i]),void 0===e&&(e=0),void 0===i&&(i=wr),void 0===r&&(r=0),void 0===n&&(n=!1),(a=this.getSizerConfig(t)).parent=this,a.proportion=e,a.align=i,a.padding=Pr(r),a.expand=n,this.sizerChildren.push(t),this}insert(t,e,i,r,n,s){return this.add(e,i,r,n,s),this.moveTo(e,t),this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,Dr(this.sizerChildren,t),super.remove(t),this)}clear(t){for(var e=0,i=this.sizerChildren.length;e<i;e++)this.getSizerConfig(this.sizerChildren[e]).parent=void 0;return this.sizerChildren.length=0,super.clear(t),this}get childrenProportion(){return void 0===this._childrenProportion&&(this._childrenProportion=this.getChildrenProportion()),this._childrenProportion}}Object.assign(Ar.prototype,vr);const Er={min:0,full:-1};var Mr=Ar,Ir={v:0,vertical:0,h:1,horizontal:1};const Br=Phaser.Utils.Objects.GetValue;var kr=function(t,e){void 0===e&&(e="scrollMode");var i=Br(t,"scrollMode",0);return"string"==typeof i&&(i=Ir[i]),i};const Rr=Phaser.Math.Percent;var Nr=function(t,e,i){var r,n,s;return t.y===e.y?(r=Math.min(t.x,e.x),n=Math.max(t.x,e.x),s=Rr(i.x,r,n)):t.x===e.x&&(r=Math.min(t.y,e.y),n=Math.max(t.y,e.y),s=Rr(i.y,r,n)),s},jr={},Lr=function(t,e,i){this.enable&&(jr.x=e,jr.y=i,this.value=Nr(this.getStartPoint(),this.getEndPoint(),jr))},Fr={},zr=function(t,e,i){this.enable&&t.isDown&&(Fr.x=t.worldX,Fr.y=t.worldY,this.value=Nr(this.getStartPoint(),this.getEndPoint(),Fr))};const Vr=Phaser.Display.Align.In.QuickSet;var Hr={},Yr=function(t,e){void 0===e&&(e=Hr);var i=this.childrenMap.thumb,r=i.x,n=i.y;return Vr(i,this,t),e.x=i.x,e.y=i.y,i.x=r,i.y=n,e};const Gr=Phaser.Display.Align.LEFT_CENTER,Ur=Phaser.Display.Align.TOP_CENTER;var Wr={},Xr=function(t){if(void 0===t&&(t=Wr),this.childrenMap.thumb){var e=0===this.orientation?Ur:Gr;Yr.call(this,e,t)}else 0===this.orientation?(t.x=this.centerX,t.y=this.top+1):(t.x=this.left+1,t.y=this.centerY);return t};const Kr=Phaser.Display.Align.RIGHT_CENTER,Jr=Phaser.Display.Align.BOTTOM_CENTER;var Zr={},qr=function(t){if(void 0===t&&(t=Zr),this.childrenMap.thumb){var e=1===this.orientation?Kr:Jr;Yr.call(this,e,t)}else 0===this.orientation?(t.x=this.centerX,t.y=this.bottom-1):(t.x=this.right-1,t.y=this.centerY);return t};const $r=Phaser.Math.Linear;var Qr={},tn=function(t,e,i,r){return void 0===r&&(r=Qr),r.x=$r(e.x,i.x,t),r.y=$r(e.y,i.y,t),r},en=function(t){var e=this.childrenMap.thumb;return void 0===e?this:(void 0===t&&(t=this.value),tn(t,this.getStartPoint(),this.getEndPoint(),e),this.resetChildPositionState(e),this)};const rn=Phaser.Display.Align.In.QuickSet,nn=Phaser.Display.Align.LEFT_CENTER,sn=Phaser.Display.Align.TOP_CENTER;var an=function(t){var e,i,r=this.childrenMap.indicator;if(void 0===r)return this;void 0===t&&(t=this.value);var n=this.childrenMap.thumb;n?0===this.orientation?i=n.y-n.displayHeight*n.originY+n.displayHeight-this.top:e=n.x-n.displayWidth*n.originX+n.displayWidth-this.left:0===this.orientation?i=this.height*t:e=this.width*t;qi(r,e,i);var s=1===this.orientation?nn:sn;rn(r,this,s),this.resetChildPositionState(r)};const on=Phaser.Utils.Objects.GetValue,hn=Phaser.Math.Clamp,ln=Phaser.Math.Linear,cn=Phaser.Math.Percent,un=Phaser.Math.Snap.To;class pn extends Mr{constructor(t,e){super(t,e),this.type="rexSlider",this.eventEmitter=on(e,"eventEmitter",this);var i=on(e,"background",void 0),r=on(e,"track",void 0),n=on(e,"indicator",void 0),s=on(e,"thumb",void 0),a=on(e,"space.left",0),o=on(e,"space.right",0),h=on(e,"space.top",0),l=on(e,"space.bottom",0);if(i&&this.addBackground(i),r){var c={left:a,right:o,top:h,bottom:l};this.add(r,0,void 0,c,!0)}n&&this.add(n,null),s&&this.add(s,null);var u=on(e,"input",0);switch("string"==typeof u&&(u=dn[u]),u){case 0:s&&(s.setInteractive(),this.scene.input.setDraggable(s),s.on("drag",Lr,this));break;case 1:this.setInteractive().on("pointerdown",zr,this).on("pointermove",zr,this)}this.addChildrenMap("background",i),this.addChildrenMap("track",r),this.addChildrenMap("indicator",n),this.addChildrenMap("thumb",s);var p=on(e,"valuechangeCallback",null);if(null!==p){var d=on(e,"valuechangeCallbackScope",void 0);this.eventEmitter.on("valuechange",p,d)}this.setEnable(on(e,"enable",void 0)),this.setGap(on(e,"gap",void 0)),this.setValue(on(e,"value",0))}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}setGap(t){return this.gap=t,this}get value(){return this._value}set value(t){void 0!==this.gap&&(t=un(t,this.gap));var e=this._value;this._value=hn(t,0,1),e!==this._value&&(this.updateThumb(this._value),this.updateIndicator(this._value),this.eventEmitter.emit("valuechange",this._value,e,this.eventEmitter))}setValue(t,e,i){return null==t?this:(void 0!==e&&(t=cn(t,e,i)),this.value=t,this)}addValue(t,e,i){return void 0!==e&&(t=cn(t,e,i)),this.value+=t,this}getValue(t,e){var i=this.value;return void 0!==t&&(i=ln(t,e,i)),i}layout(t,e,i){return super.layout(t,e,i),this.updateThumb(),this.updateIndicator(),this}}const dn={drag:0,click:1,none:-1};var fn={getStartPoint:Xr,getEndPoint:qr,updateThumb:en,updateIndicator:an};Object.assign(pn.prototype,fn);var mn=pn,gn={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown()},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(){return this._eventEmitter&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}},_n=i(30),yn=i.n(_n);class vn{constructor(t){var e=yn()(t,"states",void 0);e&&this.addStates(e);var i=yn()(t,"extend",void 0);if(i)for(var r in i)this.hasOwnProperty(r)&&void 0!==this[r]||(this[r]=i[r]);var n=yn()(t,"eventEmitter",void 0),s=yn()(t,"EventEmitterClass",void 0);this.setEventEmitter(n,s),this._stateLock=!1,this.resetFromJSON(t)}shutdown(){this.destroyEventEmitter()}destroy(){this.shutdown()}resetFromJSON(t){this.setEnable(yn()(t,"enable",!0)),this.start(yn()(t,"start",void 0));var e=yn()(t,"init",void 0);return e&&e.call(this),this}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}set state(t){if(this.enable&&!this._stateLock&&this._state!==t){if(this._prevState=this._state,this._state=t,this._stateLock=!0,this.emit("statechange",this),null!=this._prevState){var e="exit_"+this._prevState,i=this[e];i&&i.call(this),this.emit(e,this)}if(this._stateLock=!1,null!=this._state){var r="enter_"+this._state,n=this[r];n&&n.call(this),this.emit(r,this)}}}get state(){return this._state}get prevState(){return this._prevState}start(t){return this._start=t,this._prevState=void 0,this._state=t,this}goto(t){return null!=t&&(this.state=t),this}next(){var t,e=this["next_"+this.state];return e&&(t="string"==typeof e?e:e.call(this)),this.goto(t),this}addState(t,e){var i=yn()(e,"next",void 0);i&&(this["next_"+t]=i);var r=yn()(e,"exit",void 0);r&&(this["exit_"+t]=r);var n=yn()(e,"enter",void 0);return n&&(this["enter_"+t]=n),this}addStates(t){for(var e in t)this.addState(e,t[e]);return this}update(t,e,i){void 0===i&&(i="update");var r=this[i+"_"+this.state];r&&r.call(this,t,e)}preupdate(t,e){this.update(t,e,"preupdate")}postupdate(t,e){this.update(t,e,"postupdate")}}Object.assign(vn.prototype,gn);var bn=vn;var Pn=class extends bn{constructor(t,e){super(e),this.parent=t,this.init()}init(){this.start("IDLE")}next_IDLE(){var t,e=this.parent;return e.dragState.isDown&&(t=0===e.dragThreshold?"DRAG":"DRAGBEGIN"),t}update_IDLE(t,e){this.next()}next_DRAGBEGIN(){var t=this.parent,e=t.dragState;return e.isDown?e.pointer.getDistance()>=t.dragThreshold?"DRAG":"DRAGBEGIN":"IDLE"}update_DRAGBEGIN(t,e){this.next()}next_DRAG(){var t,e=this.parent;return e.dragState.isUp&&(t=e.outOfBounds?"BACK":e.slidingEnable?"SLIDE":"IDLE"),t}update_DRAG(t,e){var i=this.parent;i.dragState.justMoved&&i.dragging(),this.next()}next_SLIDE(){var t,e=this.parent;return e.dragState.isDown?t="DRAG":e.isSliding||(t="IDLE"),t}enter_SLIDE(){this.parent.onSliding()}exit_SLIDE(){this.parent.stop()}update_SLIDE(t,e){this.parent.sliding(t,e),this.next()}next_BACK(){var t,e=this.parent;return e.dragState.isDown?t="DRAG":e.isPullBack||(t="IDLE"),t}enter_BACK(){this.parent.onPullBack()}exit_BACK(){this.parent.stop()}update_BACK(t,e){this.parent.pullBack(t,e),this.next()}};const Tn=Phaser.Utils.Objects.GetValue,xn=Phaser.Math.Distance.Between;class Sn{constructor(t,e){this.gameObject=t,this.scene=xi(t),this.setEventEmitter(Tn(e,"eventEmitter",void 0)),t.setInteractive(Tn(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.pointer=void 0,this.isInTouched=!1,this.holdStartTime=void 0,this.x=void 0,this.y=void 0,this.preX=void 0,this.preY=void 0,this.localX=void 0,this.localY=void 0,this.justMoved=!1,this.setEnable(Tn(t,"enable",!0)),this.holdThreshold=Tn(t,"holdThreshold",50),this}boot(){this.gameObject.on("pointerdown",this.onPointIn,this),this.gameObject.on("pointerover",this.onPointIn,this),this.gameObject.on("pointerup",this.onPointOut,this),this.gameObject.on("pointerout",this.onPointOut,this),this.gameObject.on("pointermove",this.onPointerMove,this),this.gameObject.once("destroy",this.destroy,this),this.scene.events.on("preupdate",this.preupdate,this)}shutdown(){this.scene&&this.scene.events.off("preupdate",this.preupdate,this),this.pointer=void 0,this.gameObject=void 0,this.scene=void 0,this.destroyEventEmitter()}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||(this.isInTouched=!1,this.pointer=void 0),this.enable=t,this.gameObject.input.enabled=t,this)}get isDown(){return this.pointer&&this.pointer.isDown}get isUp(){return!this.isDown}get dx(){return this.x-this.preX}get dy(){return this.y-this.preY}get dt(){return this.scene.sys.game.loop.delta}get speed(){return this.x===this.preX&&this.y===this.preY?0:xn(this.preX,this.preY,this.x,this.y)/(.001*this.dt)}get speedX(){return this.dx/(.001*this.dt)}get speedY(){return this.dy/(.001*this.dt)}onPointIn(t,e,i){t.isDown&&void 0===this.pointer&&(this.pointer=t,this.localX=e,this.localY=i)}onPointOut(t){this.pointer===t&&(this.pointer=void 0)}onPointerMove(t,e,i){t.isDown&&this.pointer===t&&(this.localX=e,this.localY=i)}preupdate(t,e){var i=this.pointer;this.justMoved=!1,i&&!this.isInTouched?(this.x=i.x,this.y=i.y,this.preX=i.x,this.preY=i.y,this.isInTouched=!0,this.holdStartTime=void 0,this.emit("touchstart",i,this.localX,this.localY)):i&&this.isInTouched?this.x===i.x&&this.y===i.y?void 0===this.holdStartTime?this.holdStartTime=t:t-this.holdStartTime>this.holdThreshold&&(this.preX=this.x,this.preY=this.y):(this.preX=this.x,this.preY=this.y,this.x=i.x,this.y=i.y,this.holdStartTime=void 0,this.justMoved=!0,this.emit("touchmove",i,this.localX,this.localY)):!i&&this.isInTouched&&(this.isInTouched=!1,this.holdStartTime=void 0,this.emit("touchend",i))}}Object.assign(Sn.prototype,gn);var On=Sn;const Cn=Phaser.Utils.Objects.GetValue;var Dn=class{constructor(t){this.resetFromJSON(t)}resetFromJSON(t){return this.setValue(Cn(t,"value",0)),this.setSpeed(Cn(t,"speed",0)),this.setAcceleration(Cn(t,"acceleration",0)),this}reset(){this.setValue(0),this.setSpeed(0),this.setAcceleration(0)}setValue(t){return this.value=t,this}setSpeed(t){return this.speed=t,this}setAcceleration(t){return this.acceleration=t,this}updateSpeed(t){return 0!==this.acceleration&&(this.speed+=this.acceleration*t,this.speed<0&&(this.speed=0)),this}getDeltaValue(t){return this.updateSpeed(t),this.speed<=0?0:this.speed*t}update(t){return this.updateSpeed(t),this.speed>0&&(this.value+=this.getDeltaValue(t)),this}get isMoving(){return this.speed>0}};var wn=class{constructor(){this.value,this.dir,this.movement=new Dn}init(t,e,i,r,n){return this.value=t,this.end=n,this.dir=void 0!==n?t<n:e,this.movement.setSpeed(i).setAcceleration(-r),this}stop(){this.movement.reset()}update(t){var e=this.movement.getDeltaValue(t);return this.dir||(e=-e),void 0===this.end?this.value+=e:0===e?this.value=this.end:(this.value+=e,this.dir?this.value>this.end&&(this.value=this.end):this.value<this.end&&(this.value=this.end)),this}get isMoving(){return this.movement.isMoving}};const An=Phaser.Utils.Objects.GetValue;class En{constructor(t,e){this.gameObject=t,this.scene=xi(t),this.setEventEmitter(An(e,"eventEmitter",void 0));var i=An(e,"enable",!0),r={enable:i,eventEmitter:!1};this._state=new Pn(this,r);var n={inputConfig:An(e,"inputConfig",void 0),enable:i,eventEmitter:!1};this.dragState=new On(t,n),this._value=void 0,this._slowDown=new wn;var s=An(e,"valuechangeCallback",null);if(null!==s){var a=An(e,"valuechangeCallbackScope",void 0);this.on("valuechange",s,a)}if(null!==(s=An(e,"overmaxCallback",null))){a=An(e,"overmaxCallbackScope",void 0);this.on("overmax",s,a)}if(null!==(s=An(e,"overminCallback",null))){a=An(e,"overminCallbackScope",void 0);this.on("overmin",s,a)}this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setOrientationMode(An(t,"orientation",0)),this.setDragThreshold(An(t,"threshold",10)),this.setSlidingDeceleration(An(t,"slidingDeceleration",5e3)),this.setBackDeceleration(An(t,"backDeceleration",2e3));var e=An(t,"bounds",void 0);return e?this.setBounds(e):this.setBounds(An(t,"max",0),An(t,"min",0)),this.setValue(An(t,"value",this.maxValue||0)),this.setEnable(An(t,"enable",!0)),this}boot(){this.scene.events.on("update",this._state.update,this._state),this.gameObject.once("destroy",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.scene&&this.scene.events.off("update",this._state.update,this._state),this.gameObject=void 0,this.scene=void 0,this._state.destroy(),this.dragState.destroy()}destroy(){this.shutdown()}setOrientationMode(t){return"string"==typeof t&&(t=Mn[t]),this.orientationMode=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setSlidingDeceleration(t){return this.slidingDeceleration=t,this}setBackDeceleration(t){return this.backDeceleration=t,this}setBounds(t,e){if(Array.isArray(t)){var i=t;t=i[0],e=i[1]}return t<e?(this.minValue=t,this.maxValue=e):(this.minValue=e,this.maxValue=t),this}get value(){return this._value}set value(t){if(t!==this._value){var e=this._value,i=this.overMax(t),r=this.overMin(t);i&&this.emit("overmax",t,e),r&&this.emit("overmin",t,e),this.backEnable||(i&&(t=this.maxValue),r&&(t=this.minValue)),this._value=t,this.emit("valuechange",t,e)}}setValue(t){this.value=t}setEnable(t){return this._state.setEnable(t),this.dragState.setEnable(t),this}get state(){return this._state.state}get isDragging(){return this.dragState.isInTouched}get outOfMaxBound(){return this.overMax(this.value)}get outOfMinBound(){return this.overMin(this.value)}get outOfBounds(){return this.outOfMinBound||this.outOfMaxBound}overMax(t){return null!=this.maxValue&&t>this.maxValue}overMin(t){return null!=this.minValue&&t<this.minValue}get backEnable(){return"number"==typeof this.backDeceleration}get isPullBack(){return this._slowDown.isMoving}get slidingEnable(){return"number"==typeof this.slidingDeceleration}get isSliding(){return this._slowDown.isMoving}get dragDelta(){return 0===this.orientationMode?this.dragState.dy:1===this.orientationMode?this.dragState.dx:0}get dragSpeed(){return 0===this.orientationMode?this.dragState.speedY:1===this.orientationMode?this.dragState.speedX:0}dragging(){this.value+=this.dragDelta}onSliding(){var t=this.value,e=this.dragSpeed;if(0===e)return this._slowDown.stop(),void this._state.next();var i=this.slidingDeceleration;this._slowDown.init(t,e>0,Math.abs(e),i)}sliding(t,e){e*=.001;var i=this._slowDown.update(e).value;this.overMax(i)?(this.value=this.maxValue,this._slowDown.stop()):this.overMin(i)?(this.value=this.minValue,this._slowDown.stop()):this.value=i}onPullBack(){var t=this.value,e=this.outOfMinBound?this.minValue:this.maxValue,i=Math.abs(e-t),r=this.backDeceleration,n=Math.sqrt(2*r*i);this._slowDown.init(t,void 0,n,r,e)}pullBack(t,e){e*=.001,this.value=this._slowDown.update(e).value,this._slowDown.isMoving||this._state.next()}stop(){this._slowDown.stop()}}Object.assign(En.prototype,gn);const Mn={y:0,v:0,vertical:0,x:1,h:1,horizontal:1};var In=En;const Bn=Phaser.Utils.Objects.GetValue;var kn=function(t){var e,i,r=this.scene,n=kr(t),s=new Mr(r,{orientation:n}),a=Bn(t,"child.gameObject",void 0),o=Bn(t,"slider",void 0),h=Bn(t,"scroller",!0);if(a){var l=Bn(t,"space.child",0);if(this.childPadding={},"number"!=typeof l){var c=l;0===n?(l=Bn(c,"right",0),this.childPadding.top=Bn(c,"top",0),this.childPadding.bottom=Bn(c,"bottom",0)):(l=Bn(c,"bottom",0),this.childPadding.top=Bn(c,"left",0),this.childPadding.bottom=Bn(c,"right",0))}else this.childPadding.top=0,this.childPadding.bottom=0;var u,p=Bn(t,"child.proportion",1),d=Bn(t,"child.expand",!0);u=0===n?{right:o?l:0}:{bottom:o?l:0},s.add(a,p,"center",u,d),o&&(!0===o&&(o={}),o.orientation=s.orientation,e=new mn(r,o),s.add(e,0,"center",0,!0)),h&&(!0===h&&(h={}),h.orientation=n,i=new In(a,h))}return e&&e.on("valuechange",function(t){this.t=t},this),i&&i.on("valuechange",function(t){this.childOY=t},this),this.addChildrenMap("child",a),this.addChildrenMap("slider",e),this.addChildrenMap("scroller",i),s};const Rn=Phaser.Utils.Objects.GetValue;var Nn=class extends Mr{constructor(t,e){void 0===e&&(e={});var i=kr(e);e.orientation=0===i?1:0,super(t,e),this.type=Rn(e,"type","rexScrollable");var r=Rn(e,"background",void 0),n=kn.call(this,e),s=Rn(e,"header",void 0),a=Rn(e,"footer",void 0),o=Rn(e,"space.left",0),h=Rn(e,"space.right",0),l=Rn(e,"space.top",0),c=Rn(e,"space.bottom",0);if(r&&this.addBackground(r),s){var u=Rn(e,"align.header","center"),p=Rn(e,"space.header",0);f=0===i?{left:o,right:h,top:l,bottom:p}:{left:o,right:p,top:l,bottom:c};var d=Rn(e,"expand.header",!0);this.add(s,0,u,f,d)}if(n&&(f=0===i?{left:o,right:h,top:s?0:l,bottom:a?0:c}:{left:s?0:o,right:a?0:h,top:l,bottom:c},this.add(n,1,"center",f,!0)),a){u=Rn(e,"align.footer","center");var f,m=Rn(e,"space.footer",0);f=0===i?{left:o,right:h,top:m,bottom:c}:{left:m,right:h,top:l,bottom:c},d=Rn(e,"expand.footer",!0),this.add(a,0,u,f,d)}this.addChildrenMap("background",r),this.addChildrenMap("header",s),this.addChildrenMap("footer",a)}layout(t,e,i){return super.layout(t,e,i),this.resizeController(),this}resizeController(){var t=this.topChildOY,e=this.bottomChildOY,i=this.childrenMap.scroller,r=this.childrenMap.slider;return i&&i.setBounds(e,t),r&&r.setEnable(e!==t),this.updateController(),this}updateController(){var t=this.childrenMap.scroller,e=this.childrenMap.slider;t&&t.setValue(this.childOY),e&&e.setValue(this.t)}set t(t){var e=this.childPadding;if(0!==e.top||0!==e.bottom){var i=this.childrenMap.child,r=i.topChildOY-i.bottomChildOY;t=((r+e.top+e.bottom)*t-e.top)/r}this.childrenMap.child.t=t,this.updateController()}get t(){var t=this.childrenMap.child.t,e=this.childPadding;if(0!==e.top||0!==e.bottom){var i=this.childrenMap.child,r=i.topChildOY-i.bottomChildOY,n=r+e.top+e.bottom;t=(r*t+e.top)/n}return t}set childOY(t){this.childrenMap.child.childOY=t,this.updateController()}get childOY(){return this.childrenMap.child.childOY}get topChildOY(){return this.childrenMap.child.topChildOY+this.childPadding.top}get bottomChildOY(){return this.childrenMap.child.bottomChildOY-this.childPadding.bottom}setChildOY(t){return this.childOY=t,this}setT(t){return this.t=t,this}scrollToTop(){return this.t=0,this}scrollToBottom(){return this.t=1,this}get sliderEnable(){var t=this.childrenMap.slider;if(t)return t.enable}set sliderEnable(t){var e=this.childrenMap.slider;e&&e.setEnable(t)}setSliderEnable(t){return void 0===t&&(t=!0),this.sliderEnable=t,this}get scrollerEnable(){var t=this.childrenMap.scroller;if(t)return t.enable}set scrollerEnable(t){var e=this.childrenMap.scroller;e&&e.setEnable(t)}setScrollerEnable(t){return void 0===t&&(t=!0),this.scrollerEnable=t,this}};const jn=Phaser.GameObjects.Text;var Ln=function(t){return t instanceof jn};const Fn=Phaser.GameObjects.Graphics;const zn={rectangle:0,circle:1};var Vn=class extends Fn{constructor(t,e,i){void 0===e&&(e=0),"string"==typeof e&&(shaep=zn[e]),void 0===i&&(i=0),super(t.scene),this.parent=t,this.shape=e,this.padding=i,this.setPosition().resize()}destroy(){return this.parent=void 0,super.destroy(),this}setPosition(t,e){var i=this.parent;return void 0===t&&(t=i.x),void 0===e&&(e=i.y),super.setPosition(t,e),this}resize(t,e,i){var r=this.parent;if(void 0===t&&(t=r.width),void 0===e&&(e=r.height),void 0===i&&(i=this.padding),this.widthSave===t&&this.heightSave===e&&this.paddingSave===i)return this;switch(this.clear().fillStyle(16777215),this.shape){case 1:var n=Math.min(t,e)/2;this.fillCircle(0,0,n+i);break;default:this.fillRect(-t*r.originX-i,-e*r.originY-i,t+2*i,e+2*i)}return this.widthSave=t,this.heightSave=e,this.paddingSave=i,this}};const Hn=Phaser.Display.Align.TOP_LEFT;var Yn=function(t,e,i){void 0===i&&(i=!0),this.add(t),void 0===e&&(e=0);var r=this.getSizerConfig(t);return r.parent=this,r.align=Hn,r.padding=Pr(e),r.expand=!0,this.textObject=t,this.textObjectType=Ln(t)?0:1,r.preOffsetY=0,r.offsetY=0,i&&(this.textMask=new Vn(this.textObject),this.textObject.setMask(this.textMask.createGeometryMask()),this.add(this.textMask)),this},Gn=function(t){return void 0!==t&&(this.text=t),0===this.textObjectType?this.lines=this.textObject.getWrappedText(this.text):this.lines=this.textObject.getPenManager(this.text,this.lines),this.updateTextObject(),this},Un=function(t){return(t-this.textLineSpacing)/(this.textLineHeight+this.textLineSpacing)},Wn=function(t){return t*(this.textLineHeight+this.textLineSpacing)-this.textLineSpacing},Xn=function(t){var e,i=t+this.textObject.style.maxLines;if(0===this.textObjectType)e=this.lines.slice(t,i).join("\n");else{var r=this.lines.getLineStartIndex(t),n=this.lines.getLineEndIndex(i-1);e=this.lines.getSliceTagText(r,n,!0)}return e},Kn=function(){var t=this.textObject.rexSizer;this.textObject.y+=t.offsetY-t.preOffsetY,t.preOffsetY=t.offsetY,this.resetChildPositionState(this.textObject)},Jn=function(){var t=Math.max(Math.floor(Un.call(this,-this.textOY)),0),e=Wn.call(this,t)+this.textOY;return this.textObject.setText(Xn.call(this,t)),this.textObject.rexSizer.offsetY=e,Kn.call(this),this},Zn=function(t,e,i){if(t.width!==e||t.height!==i){t.setFixedSize(e,i);var r=t.style,n=Math.max(e,0),s=Math.ceil(Un.call(this,i))+1;0===this.textObjectType?(r.wordWrapWidth=n,r.maxLines=s):(r.wrapWidth=n,r.maxLines=s),this.setText()}};const qn=Phaser.Display.Align.In.QuickSet;var $n={setTextObject:Yn,setText:Gn,updateTextObject:Jn,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var r,n,s;this.layoutInit(t),void 0===e&&(e=this.minWidth),void 0===i&&(i=this.minHeight),this.resize(e,i);var a,o,h,l,c=this.left,u=this.top;return(r=this.textObject).rexSizer.hidden||(a=c+(s=(n=r.rexSizer).padding).left,o=u+s.top,h=this.width-s.left-s.right,l=this.height-s.top-s.bottom,Zn.call(this,r,h,l),Qi.setPosition(a,o).setSize(h,l),qn(r,Qi,n.align),this.textMask&&(this.textMask.setPosition().resize(),this.resetChildPositionState(this.textMask)),n.preOffsetY=0,Kn.call(this)),this.layoutBackgrounds(),this}};const Qn=Phaser.Utils.Objects.IsPlainObject,ts=Phaser.Utils.Objects.GetValue;class es extends ur{constructor(t,e,i,r,n,s){Qn(e)?(e=ts(s=e,"x",0),i=ts(s,"y",0),r=ts(s,"width",void 0),n=ts(s,"height",void 0)):Qn(r)&&(r=ts(s=r,"width",void 0),n=ts(s,"height",void 0)),super(t,e,i,r,n,s),this.type="rexTextBlock",this.textObject=void 0,this.textMask=void 0,this.textObjectType=void 0,this.lines=void 0,this.text=ts(s,"content",""),this._textOY=0,this.execeedTopState=!1,this.execeedBottomState=!1,this.setClampMode(ts(s,"clamplTextOY",!0));var a=ts(s,"background",void 0),o=ts(s,"text",void 0);void 0===o&&(o=is(t));var h=ts(s,"textMask",!0),l=ts(s,"space",void 0);a&&this.addBackground(a),this.setTextObject(o,l,h)}destroy(t){this.scene&&(this.textObject=void 0,this.textMask=void 0,void 0===this.lines||(0===this.textObjectType?this.lines.length=0:this.lines.destroy()),super.destroy(t))}setClampMode(t){return this.clampTextOYMode=t,this}get textLineHeight(){var t=this.textObject.style;return t.metrics.fontSize+t.strokeThickness}get textLineSpacing(){return this.textObject.lineSpacing}get linesCount(){return void 0===this.lines?0:0===this.textObjectType?this.lines.length:this.lines.linesCount}get visibleLinesCount(){return Math.floor(Un.call(this,this.textObject.height))}get topTextOY(){return 0}get bottomTextOY(){return-this.textVisibleHeight}get textHeight(){return Wn.call(this,this.linesCount)}get textObjectHeight(){return this.textObject.height}get textVisibleHeight(){var t=this.textHeight,e=this.textObjectHeight;return t>e?t-e:0}textOYExceedTop(t){return void 0===t&&(t=this.textOY),t>this.topTextOY}textOYExeceedBottom(t){return void 0===t&&(t=this.textOY),t<this.bottomTextOY}get textOY(){return this._textOY}set textOY(t){var e=this.topTextOY,i=this.bottomTextOY,r=this.textOYExceedTop(t),n=this.textOYExeceedBottom(t);this.clampTextOYMode&&(this.visibleLinesCount>this.linesCount?t=0:r?t=e:n&&(t=i)),this._textOY!==t&&(this._textOY=t,this.updateTextObject()),r&&(this.execeedTopState||this.emit("execeedtop",this,t,e)),this.execeedTopState=r,n&&(this.execeedBottomState||this.emit("execeedbottom",this,t,i)),this.execeedBottomState=n}setTextOY(t){return this.textOY=t,this}set t(t){this.textOY=-this.textVisibleHeight*t}get t(){var t=this.textVisibleHeight;return 0===t?0:this.textOY/-t}setTextOYByPercentage(t){return this.t=t,this}}var is=function(t){return t.add.text(0,0,"")};Object.assign(es.prototype,$n);var rs=es,ns=function(t){Object.defineProperty(t,"childOY",{configurable:!0,get:function(){return t.textOY},set:function(e){t.textOY=e}}),Object.defineProperty(t,"topChildOY",{get:function(){return t.topTextOY}}),Object.defineProperty(t,"bottomChildOY",{get:function(){return t.bottomTextOY}})},ss=function(t){return this.childrenMap.child.setText(t),this.resizeController(),this},as=function(t){return this.setText(this.text+t),this};const os=Phaser.Utils.Objects.GetValue;class hs extends Nn{constructor(t,e){void 0===e&&(e={});var i=os(e,"text",void 0),r=os(e,"textWidth",void 0),n=os(e,"textHeight",void 0),s=os(e,"textMask",!0),a=os(e,"content",""),o=new rs(t,{width:r,height:n,text:i,textMask:s,content:a,clamplTextOY:os(e,"clamplChildOY",!1)}),h=void 0===r?1:0,l=void 0===n;ns(o),e.scrollMode=0,e.type="rexTextArea",e.child={gameObject:o,proportion:h,expand:l};var c=os(e,"space",void 0);c&&(c.child=c.text),super(t,e),this.addChildrenMap("text",i)}get text(){return this.childrenMap.child.text}get linesCount(){return this.childrenMap.child.linesCount}}var ls={setText:ss,appendText:as};Object.assign(hs.prototype,ls);var cs=hs,us=function(t){t.stopPropagation()},ps=function(t){t.addEventListener("touchstart",us,!1),t.addEventListener("touchmove",us,!1),t.addEventListener("touchend",us,!1),t.addEventListener("mousedown",us,!1),t.addEventListener("mouseup",us,!1),t.addEventListener("mousemove",us,!1)};const ds=Phaser.GameObjects.DOMElement,fs=Phaser.Utils.Objects.IsPlainObject,ms=Phaser.Utils.Objects.GetValue;const gs={id:["id",void 0],text:["value",void 0],placeholder:["placeholder",void 0],tooltip:["title",void 0],readOnly:["readonly",!1],spellCheck:["spellcheck",!1],autoComplete:["autocomplete","off"]},_s={align:["text-align",void 0],width:["width",void 0],height:["height",void 0],fontFamily:["font-family",void 0],fontSize:["font-size",void 0],color:["color","#ffffff"],backgroundColor:["backgroundColor","transparent"],borderColor:["borderColor","transparent"],outline:["outline","none"]},ys={textchange:"oninput",click:"onclick",dblclick:"ondblclick",focus:"onfocus",blur:"onblur"};var vs=class extends ds{constructor(t,e,i,r,n,s){fs(e)?(e=ms(s=e,"x",0),i=ms(s,"y",0),r=ms(s,"width",void 0),n=ms(s,"height",void 0)):fs(r)&&(r=ms(s=r,"width",void 0),n=ms(s,"height",void 0)),void 0===s&&(s={});var a,o=t.scale.autoRound;void 0!==r&&(o&&(r=Math.floor(r)),s.width=r+"px"),void 0!==n&&(o&&(n=Math.floor(n)),s.height=n+"px");var h,l,c=ms(s,"type","text");for(var u in"textarea"===c?(a=document.createElement("textarea")).style.resize="none":(a=document.createElement("input")).type=c,gs)h=gs[u],void 0!==(l=ms(s,u,h[1]))&&(a[h[0]]=l);var p,d,f=ms(s,"style",void 0);for(var u in void 0===f&&(f={}),_s)p=_s[u],void 0!==(d=ms(s,u,p[1]))&&(f[p[0]]=d);var m=a.style;for(var u in s)u in gs||u in _s||u in m&&(f[u]=s[u]);f["box-sizing"]="border-box",super(t,e,i,a,f),this.type="rexInputText";for(let t in ys)this.node[ys[t]]=function(){this.emit(t,this)}.bind(this);ps(this.node)}resize(t,e){var i=this.node.style;return i.width=t+"px",i.height=e+"px",this.updateSize(),this}get text(){return this.node.value}set text(t){this.node.value=t}setText(t){return this.text=t,this}selectText(){return this.node.select(),this}get placeholder(){return this.node.placeholder}set placeholder(t){this.node.placeholder=t}setPlaceholder(t){return this.placeholder=t,this}get tooltip(){return this.node.title}set tooltip(t){this.node.title=t}setTooltip(t){return this.tooltip=t,this}setTextChangedCallback(t){return this.onTextChanged=t,this}get readOnly(){return this.node.readOnly}set readOnly(t){this.node.readOnly=t}setReadOnly(t){return void 0===t&&(t=!0),this.readOnly=t,this}get spellCheck(){return this.node.spellcheck}set spellCheck(t){this.node.spellcheck=t}setSpellCheck(t){return this.spellCheck=t,this}setStyle(t,e){return this.node.style[t]=e,this}getStyle(t){return this.node.style[t]}scrollToBottom(){return this.node.scrollTop=this.node.scrollHeight,this}setEnabled(t){return void 0===t&&(t=!0),this.node.disabled=!t,this}setBlur(){return this.node.blur(),this}setFocus(){return this.node.focus(),this}},bs=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ps=function(t){function e(e,i,r,n,s){var a=t.call(this,e,i,r)||this;return a.mNingBg=new J(a.scene,0,0,n),a.add(a.mNingBg),a.mLabel=a.scene.make.text(void 0,!1).setOrigin(.45,.5).setSize(a.mNingBg.width,a.mNingBg.height).setAlign("center").setText(s),a.add(a.mLabel),a.setSize(a.mNingBg.width,a.mNingBg.height),a.setInteractive(new Phaser.Geom.Rectangle(0,0,a.mNingBg.width,a.mNingBg.height),Phaser.Geom.Rectangle.Contains),a.on("pointerdown",a.changeDown,a),a.on("pointerup",a.changeNormal,a),a.on("pointerout",a.changeNormal,a),a}return bs(e,t),e.prototype.setTextStyle=function(t){this.mLabel.setStyle(t)},e.prototype.setTextOffset=function(t,e){this.mLabel.setPosition(t,e)},e.prototype.changeNormal=function(){this.scale=1},e.prototype.changeDown=function(){this.scale=.9},Object.defineProperty(e.prototype,"label",{get:function(){return this.mLabel},enumerable:!0,configurable:!0}),e}(Phaser.GameObjects.Container),Ts=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),xs=function(t){function e(e,i,r,n,s,a){var o=t.call(this,e,i,r,n,s)||this;return o.mSelected=!1,o.mNormalFrame=s,o.mSelectFrame=a,o.setInteractive(new Phaser.Geom.Rectangle(0,0,o.width,o.height),Phaser.Geom.Rectangle.Contains),o.on("pointerup",o.onSelected,o),o}return Ts(e,t),e.prototype.onSelected=function(){this.selected=!this.mSelected,this.emit("selected",this.mSelected)},Object.defineProperty(e.prototype,"selected",{get:function(){return this.mSelected},set:function(t){if(this.mSelected!==t){this.mSelected=t;var e=t?this.mSelectFrame:this.mNormalFrame;this.setFrame(e)}},enumerable:!0,configurable:!0}),e}(Phaser.GameObjects.Image),Ss=i(151),Os=i.n(Ss),Cs=i(152),Ds=i.n(Cs),ws={renderWebGL:Os.a,renderCanvas:Ds.a};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const As=Phaser.Display.Canvas.CanvasPool;var Es={},Ms=function(t){var e=As.create(this),i=e.getContext("2d");t.syncFont(e,i);var r=Math.ceil(i.measureText(t.testString).width*t.baselineX),n=r,s=2*n;n=n*t.baselineY|0,e.width=r,e.height=s,i.fillStyle="#f00",i.fillRect(0,0,r,s),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,n);var a=Es;if(!i.getImageData(0,0,r,s))return a.ascent=n,a.descent=n+6,a.fontSize=a.ascent+a.descent,As.remove(e),a;var o,h,l=i.getImageData(0,0,r,s).data,c=l.length,u=4*r,p=0,d=!1;for(o=0;o<n;o++){for(h=0;h<u;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p+=u}for(a.ascent=n-o,p=c-u,d=!1,o=s;o>n;o--){for(h=0;h<u;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p-=u}return a.descent=o-n,a.fontSize=a.ascent+a.descent,As.remove(e),a},Is={hleft:0,hcenter:1,hright:2,vtop:0,vcenter:1,vbottom:2,NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/};
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const Bs=Phaser.Utils.Objects.GetAdvancedValue,ks=Phaser.Utils.Objects.GetValue;var Rs={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign",0],valign:["valign",0],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|Mqgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const Ns={left:Is.hleft,center:Is.hcenter,right:Is.hright},js={top:Is.vtop,center:Is.vcenter,bottom:Is.vbottom},Ls={none:Is.NO_WRAP,word:Is.WORD_WRAP,char:Is.CHAR_WRAP,character:Is.CHAR_WRAP};var Fs=class{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var i=ks(e,"metrics",!1);this.metrics=i?{ascent:ks(i,"ascent",0),descent:ks(i,"descent",0),fontSize:ks(i,"fontSize",0)}:Ms(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("halign")&&"string"==typeof t.halign&&(t.halign=Ns[t.halign.toLowerCase()]||0),t&&t.hasOwnProperty("valign")&&"string"==typeof t.valign&&(t.valign=js[t.valign.toLowerCase()]||0),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var r=i.mode;"string"==typeof r&&(i.mode=Ls[r])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var n in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),Rs)this[n]="wrapCallback"===n||"wrapCallbackScope"===n?ks(t,Rs[n][0],Rs[n][1]):Bs(t,Rs[n][0],Rs[n][1]);var s=ks(t,"font",null);this._font=null===s?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:s;var a=ks(t,"fill",null);return null!==a&&(this.color=a),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=Ms(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=ks(t,"fontFamily","Courier"),this.fontSize=ks(t,"fontSize","16px"),this.fontStyle=ks(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,r,n,s){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===r&&(r=0),void 0===n&&(n=!1),void 0===s&&(s=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=r,this.shadowStroke=n,this.shadowFill=s,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=Ls[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),"string"==typeof t&&(t=Ns[t.toLowerCase()]||0),"string"==typeof e&&(e=Ns[e.toLowerCase()]||0),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Ns[t.toLowerCase()]||0),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t=0),"string"==typeof t&&(t=Ns[t.toLowerCase()]||0),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in Rs)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}};const zs=Is.hcenter,Vs=Is.hright,Hs=Is.vcenter,Ys=Is.vbottom;var Gs={draw(t,e,i,r){var n=this.penManager;this.hitAreaManager.clear();var s=this.context;s.save(),this.drawBackground(this.defatultStyle.backgroundColor);var a=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var o,h,l,c,u,p,d=a.halign,f=a.valign,m=a.lineHeight,g=n.lines,_=g.length,y=a.maxLines;y>0&&_>y?(h=y,l=f===Hs?Math.floor((_-h)/2):f===Ys?_-h:0):(h=_,l=0),c=l+h,p=f===Hs?Math.max((r-h*m)/2,0):f===Ys?Math.max(r-h*m-2,0):0,p+=e;for(var v=l;v<c;v++)if(0!==(o=n.getLineWidth(v))){u=d===zs?(i-o)/2:d===Vs?i-o:0,u+=t;for(var b=g[v],P=0,T=b.length;P<T;P++)this.drawPen(b[P],u,p)}s.restore()},drawPen(t,e,i){e+=t.x,i+=t.y;var r=this.canvas,n=this.context;n.save();var s=this.parser.propToContextStyle(this.defatultStyle,t.prop);s.buildFont(),s.syncFont(r,n),s.syncStyle(r,n),s.underlineThickness>0&&t.width>0&&this.drawUnderline(e,i,t.width,s),t.isTextPen&&this.drawText(e,i,t.text,s),t.isImagePen&&this.drawImage(e,i,t.prop.img,s),n.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,i-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,i,r){e+=r.underlineOffset-r.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context,s=n.lineCap;n.lineCap="butt",n.beginPath(),n.strokeStyle=r.underlineColor,n.lineWidth=r.underlineThickness,n.moveTo(t,e),n.lineTo(t+i,e),n.stroke(),n.lineCap=s},drawText(t,e,i,r){this.autoRound&&(t=Math.round(t),e=Math.round(e));var n=this.context;r.strokeThickness&&(r.syncShadow(n,r.shadowStroke),n.strokeText(i,t,e)),r.color&&"none"!==r.color&&(r.syncShadow(n,r.shadowFill),n.fillText(i,t,e))},drawImage(t,e,i,r){var n=this.parent.imageManager,s=n.get(i),a=n.getFrame(i);t+=s.left,e+=-this.startYOffset+s.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,t,e,s.width,s.height)}};var Us=class{constructor(){this.items=[]}destroy(){this.items.length=0,this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}};const Ws=Phaser.Utils.Objects.GetValue,Xs=Is.NO_NEWLINE,Ks=Is.RAW_NEWLINE;var Js=class{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=Ws(t,"text",""),this.x=Ws(t,"x",0),this.y=Ws(t,"y",0),this.width=Ws(t,"width",0);var e=Ws(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=Ws(t,"newLineMode",0),this.startIndex=Ws(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===Ks&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==Xs&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===Ks&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},Zs=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]},qs=function(t,e){var i=Array.isArray(t);for(var r in void 0===e?e=i?[]:{}:Zs(e),i&&(e.length=t.length),t)e[r]=t[r];return e};const $s=Phaser.Utils.Objects.GetFastValue,Qs=Is.NO_NEWLINE,ta=Is.WRAPPED_NEWLINE;var ea=new Us,ia=new Us;class ra{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=$s(t,"pensPool",ea),this.LinesPool=$s(t,"linesPool",ia),this.tagToText=$s(t,"tagToText",Me),this.tagToTextScope=$s(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,r,n,s){var a=this.PensPool.pop();return null==a&&(a=new Js),na.text=t,na.x=e,na.y=i,na.width=r,na.prop=n,na.newLineMode=s,a.resetFromJSON(na),this.addPen(a),this}addImagePen(t,e,i,r){return this.addTextPen("",t,e,i,r,Qs),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,r=t?qs(t.prop):null;return this.addTextPen("",e,i,0,r,ta),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(t),t.newLineMode!==Qs&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new ra),t.freePens();for(var e=0,i=this.lines.length;e<i;e++)for(var r=this.lines[e],n=0,s=r.length;n<s;n++){var a=r[n];t.addPen(a.text,a.x,a.y,a.width,qs(a.prop),a.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,r=!1;for(e=t;e>=0&&!(r=null!=(i=this.lines[e])&&i.length>0);e--);return r?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,r=this.lines.length;i<r;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,r=e.length;i<r;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,r=this.pens.length;i<r;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){if(void 0===t&&(t=0),void 0===e){var r=this.lastPen;if(null==r)return"";e=r.endIndex}void 0===i&&(i=!1);for(var n,s,a,o,h,l,c="",u=0,p=this.pens.length;u<p&&((o=(n=this.pens[u]).endIndex)<=t||(n=this.pens[u],s=i?n.wrapText:n.plainText,h=n.prop,(a=n.startIndex)>=t&&o<=e||(s=s.substring(t-a,e-a)),this.tagToTextScope?c+=this.tagToText.call(this.tagToTextScope,s,h,l):c+=this.tagToText(s,h,l),l=h,!(o>=e)));u++);return c}}var na={},sa=ra;const aa=Phaser.Geom.Rectangle;var oa=new Us;var ha=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return oa.pushMultiple(this.hitAreas),this}add(t,e,i,r,n){var s=oa.pop();return null===s?s=new aa(e,i,r,n):s.setTo(e,i,r,n),s.key=t,this.hitAreas.push(s),this}contains(t,e){for(var i,r=this.hitAreas,n=0,s=r.length;n<s;n++)if((i=r[n]).contains(t,e))return i.key;return!1}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var r,n=this.hitAreas,s=0,a=n.length;s<a;s++)r=n[s],t.lineStyle(1,e).strokeRect(r.x,r.y,r.width,r.height);return i&&t.restore(),this}},la=function(t,e,i,r){var n=this.hitAreaManager.contains(i,r);!1!==n&&(this.parent.emit(`${t}-${n}`,e,i,r),this.parent.emit(t,n,e,i,r))},ca=function(){this.parent.on("pointerdown",function(t,e,i,r){la.call(this,"areadown",t,e,i)},this).on("pointerup",function(t,e,i,r){la.call(this,"areaup",t,e,i)},this)};const ua=Is.NO_NEWLINE,pa=Is.RAW_NEWLINE,da=Is.WRAPPED_NEWLINE,fa=Is.NO_WRAP,ma=Is.WORD_WRAP,ga=Is.SPLITREGEXP;var _a=[],ya=new Us;ya.newline=function(t,e,i){var r=this.pop();return null===r&&(r={}),r.text=t,r.width=e,r.newLineMode=i,r};var va=function(t,e,i,r,n){r<=0&&(i=fa);var s=_a;if(ya.pushMultiple(s),!t||!t.length)return s;for(var a,o,h,l=t.split(ga),c=0,u=l.length;c<u;c++)if(a=l[c],h=c===u-1?ua:pa,i!==fa){var p,d;if(o=0===c?r-n:r,a.length<=100&&(b=e(a))<=o){s.push(ya.newline(a,b,h));continue}for(var f,m="",g="",_=0,y=0,v=(p=i===ma?a.split(" "):a).length;y<v;y++)d=p[y],i===ma?(m+=d,y<v-1&&(m+=" ")):m+=d,(f=e(m))>o&&(0===y?s.push(ya.newline("",0,da)):(s.push(ya.newline(g,_,da)),m=d,i===ma&&y<v-1&&(m+=" "),f=e(m)),o=r),g=m,_=f;s.push(ya.newline(g,_,h))}else{var b=e(a);s.push(ya.newline(a,b,h))}return s};const ba=Phaser.Utils.Objects.GetValue,Pa=Is.NO_WRAP,Ta=Is.NO_NEWLINE;class xa{constructor(t){this.parent=t.parent,this.context=ba(t,"context",null),this.canvas=this.context.canvas,this.parser=ba(t,"parser",null),this.defatultStyle=ba(t,"style",null),this.autoRound=!0,this.pensPool=ba(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new ha;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,i,r,n){if(void 0===n&&(n=this.penManager),n.freePens(),""===t)return n;for(var s,a,o,h,l,c=this.canvas,u=this.context,p=0,d=0,f=this.parser.splitText(t),m=0,g=f.length;m<g;m++)if(s=(h=this.parser.tagTextToProp(f[m],a)).plainText,(a=h.prop).img){var _=this.imageManager.getOuterWidth(a.img);i>0&&e!==Pa&&i<p+_&&(n.addNewLinePen(),d+=r,p=0),n.addImagePen(p,d,_,qs(a)),p+=_}else if(""!==s){var y;this.context.save(),(o=this.parser.propToContextStyle(this.defatultStyle,a)).buildFont(),o.syncFont(c,u),o.syncStyle(c,u);for(var v=0,b=(l=va(s,this.getTextWidth,e,i,p)).length;v<b;v++)y=l[v],n.addTextPen(y.text,p,d,y.width,qs(a),y.newLineMode),y.newLineMode!==Ta?(p=0,d+=r):p+=y.width;this.context.restore()}return n}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new sa({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var r;if(null==t)r=this.penManager.plainText;else{var n=this.parser.splitText(t,1);r="";for(var s=0,a=n.length;s<a;s++)r+=n[s]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=r.length),r=r.substring(e,i)),r}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,r){if(null==t)return this.penManager.getSliceTagText(e,i,r);var n=this.tmpPenManager,s=this.defatultStyle;return this.updatePenManager(t,s.wrapMode,s.wrapWidth,s.lineHeight,n),n.getSliceTagText(e,i,r)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var Sa={setInteractive:ca};Object.assign(xa.prototype,Gs,Sa);var Oa=xa;const Ca=Phaser.Utils.Objects.GetValue;var Da,wa=class{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var i=0,r=(n=t).length;i<r;i++)this._add(n[i]);else{var n=t;for(var t in n)this._add(t,n[t])}return this}_add(t,e){void 0===e&&(e={key:t});var i=e.key,r=e.frame,n=e.width,s=e.height;if(void 0===n||void 0===s){var a=this.textureManager.getFrame(i,r),o=a?a.cutWidth:0,h=a?a.cutHeight:0;void 0===n&&void 0===s?(n=o,s=h):void 0===n?n=o*(s/h):void 0===s&&(s=h*(n/o))}this.images[t]={key:i,frame:r,width:n,height:s,y:Ca(e,"y",0),left:Ca(e,"left",0),right:Ca(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}},Aa=function(t){return void 0===Da&&(Da=new wa(t)),Da};const Ea=Phaser.DOM.AddToDOM,Ma=Phaser.Display.Canvas.CanvasPool,Ia=Phaser.GameObjects.GameObject,Ba=Phaser.Utils.Objects.GetValue,ka=Phaser.DOM.RemoveFromDOM,Ra=Is.SPLITREGEXP;var Na={};class ja extends Ia{constructor(t,e,i,r,n,s,a){if(void 0===e&&(e=0),void 0===i&&(i=0),super(t,s),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=Ma.create(this),this.context=this.canvas.getContext("2d"),n&&n.hasOwnProperty("align")){var o=n.align;delete n.align,n.halign=o}this.style=new Fs(this,n),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),Na.hasOwnProperty(s)||(Na[s]=new Us),this.canvasText=new Oa({parent:this,context:this.context,parser:a,style:this.style,pensPool:Na[s]}),n&&n.padding&&this.setPadding(n.padding),this.setText(r),t.sys.game.events.on("contextrestored",function(){this.dirty=!0},this)}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Ea(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t){return this.style.setBackgroundColor(t)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,i,r,n,s){return this.style.setShadow(t,e,i,r,n,s)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setLineSpacing(t){return this.style.setLineSpacing(t)}setPadding(t,e,i,r){if("object"==typeof t){var n=t,s=Ba(n,"x",null);null!==s?(t=s,i=s):(t=Ba(n,"left",0),i=Ba(n,"right",t));var a=Ba(n,"y",null);null!==a?(e=a,r=a):(e=Ba(n,"top",0),r=Ba(n,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===r&&(r=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=r,this.updateText(!1)}setResolution(t){return this.style.setResolution(t)}setMaxLines(t){return this.style.setMaxLines(t)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var r,n,s=this.padding;0===i.fixedWidth?(this.width=e.linesWidth+s.left+s.right,r=e.linesWidth):(this.width=i.fixedWidth,(r=this.width-s.left-s.right)<e.linesWidth&&(r=e.linesWidth)),0===i.fixedHeight?(this.height=e.linesHeight+s.top+s.bottom,n=e.linesHeight):(this.height=i.fixedHeight,(n=this.height-s.top-s.bottom)<e.linesHeight&&(n=e.linesHeight));var a=this.width,o=this.height;this.updateDisplayOrigin();var h=i.resolution;a*=h,o*=h,a=Math.max(Math.ceil(a),1),o=Math.max(Math.ceil(o),1);var l=this.canvas,c=this.context;l.width!==a||l.height!==o?(l.width=a,l.height=o,this.frame.setSize(a,o)):c.clearRect(0,0,a,o),c.save(),c.scale(h,h),e.draw(s.left,s.top,r,n),c.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var t=La.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}preDestroy(){this.style.rtl&&ka(this.canvas),Ma.remove(this.canvas),this.canvasText.destroy()}setInteractive(t,e,i){return Ia.prototype.setInteractive.call(this,t,e,i),this.canvasText.setInteractive(),this}getWrappedText(t,e,i){return(t=this.canvasText.getText(t,e,i,!0)).split(Ra)}getPlainText(t,e,i){return this.canvasText.getPlainText(t,e,i)}getText(t,e,i){return this.canvasText.getText(t,e,i,!1)}getSubString(t,e,i){return this.getText(t,e,i)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}set lineSpacing(t){this.setLineSpacing(t)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return Aa(this.scene.textures)}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}const La=Phaser.GameObjects.Components;Phaser.Class.mixin(ja,[La.Alpha,La.BlendMode,La.ComputedSize,La.Crop,La.Depth,La.Flip,La.GetBounds,La.Mask,La.Origin,La.Pipeline,La.ScrollFactor,La.Tint,La.Transform,La.Visible,ws]);var Fa=ja,za={plainText:null,prevProp:null},Va=new Fs,Ha={},Ya={splitText:function(t,e){for(var i,r,n=[],s=0,a=t.length,o=a;i=Wa.exec(t);)r=i[0],s<(o=Wa.lastIndex-r.length)&&n.push(t.substring(s,o)),void 0===e&&n.push(r),s=Wa.lastIndex;return s<a&&n.push(t.substring(s,a)),n},tagTextToProp:function(t,e){var i,r;null==e&&(e={}),e.img&&Ga(e,fo,"img"),Xa.test(t)?(Ga(e,mo,"b",!0),i=""):Ka.test(t)?(Ga(e,fo,"b"),i=""):Ja.test(t)?(Ga(e,mo,"i",!0),i=""):Za.test(t)?(Ga(e,fo,"i"),i=""):qa.test(t)?(r=t.match(qa),Ga(e,mo,"size",r[1]+"px"),i=""):$a.test(t)?(Ga(e,fo,"size"),i=""):Qa.test(t)?(r=t.match(Qa),Ga(e,mo,"color",r[1]),i=""):to.test(t)?(Ga(e,fo,"color"),i=""):eo.test(t)?(r=t.match(eo),Ga(e,mo,"u",!0),i=""):io.test(t)?(r=t.match(io),Ga(e,mo,"u",r[1]),i=""):ro.test(t)?(Ga(e,fo,"u"),i=""):no.test(t)?(Ga(e,mo,"shadow",!0),i=""):so.test(t)?(Ga(e,fo,"shadow"),i=""):ao.test(t)?(Ga(e,mo,"stroke",!0),i=""):oo.test(t)?(r=t.match(oo),Ga(e,mo,"stroke",r[1]),i=""):ho.test(t)?(Ga(e,fo,"stroke"),i=""):lo.test(t)?(r=t.match(lo),Ga(e,mo,"img",r[1]),i=""):co.test(t)?(Ga(e,fo,"img"),i=""):uo.test(t)?(r=t.match(uo),Ga(e,mo,"area",r[1]),i=""):po.test(t)?(Ga(e,fo,"area"),i=""):i=t;var n=za;return n.plainText=i,n.prop=e,n},propToContextStyle:function(t,e){var i=Va;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")?i.fontFamily=e.family:i.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var r=e.size;"number"==typeof r&&(r=r.toString()+"px"),i.fontSize=r}else i.fontSize=t.fontSize;i.fontStyle=Ua(e.b,e.i),e.hasOwnProperty("color")?i.color=e.color:i.color=t.color,e.hasOwnProperty("stroke")?!0===e.stroke?(i.stroke=t.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=e.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=t.stroke,i.strokeThickness=0)}return e.hasOwnProperty("shadow")?!0===e.shadow?(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor=e.shadow,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor="#000",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,i.shadowStroke=!1,i.shadowFill=!1),e.hasOwnProperty("u")?!0===e.u?(i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor=e.u,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor="#000",i.underlineThickness=0,i.underlineOffset=0),i},propToTagText:function(t,e,i){for(var r in null==i&&(i=Ha),i)e.hasOwnProperty(r)||(t="[/"+r+"]"+t);var n="";for(var r in e)i[r]!==e[r]&&("size"===r?n+="[size="+e[r].replace("px","")+"]":"color"===r||"stroke"===r||"img"===r?n+="["+r+"="+e[r]+"]":"u"===r?!0===e[r]?n+="[u]":n+="[u="+e[r]+"]":n+="["+r+"]");return t=n+t}},Ga=function(t,e,i,r){return e===mo?t[i]=r:t.hasOwnProperty(i)&&delete t[i],t},Ua=function(t,e){return t&&e?"bold italic":t?"bold":e?"italic":""},Wa=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/gi,Xa=/\[b\]/i,Ka=/\[\/b\]/i,Ja=/\[i\]/i,Za=/\[\/i\]/i,qa=/\[size=(\d+)\]/i,$a=/\[\/size\]/i,Qa=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,to=/\[\/color\]/i,eo=/\[u\]/i,io=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,ro=/\[\/u\]/i,no=/\[shadow\]/i,so=/\[\/shadow\]/i,ao=/\[stroke\]/i,oo=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,ho=/\[\/stroke\]/i,lo=/\[img=([^\]]+)\]/i,co=/\[\/img\]/i,uo=/\[area=([^\]]+)\]/i,po=/\[\/area\]/i;const fo=!1,mo=!0;var go=Ya;var _o=class extends Fa{constructor(t,e,i,r,n){super(t,e,i,r,n,"rexBBCodeText",go)}},yo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),vo=function(t){function e(e,i){var r=t.call(this,e)||this;return r.mWorldService=i,r}return yo(e,t),e.prototype.appendChat=function(t){this.mTextArea.appendText(t),this.mTextArea.scrollToBottom()},e.prototype.setSize=function(t,e){this.mParent.setSize(t,e)},e.prototype.setLocation=function(t,e){if(this.mParent);},e.prototype.preload=function(){this.mScene&&(this.mScene.load.image("button","./resources/ui/common/button.png"),this.mScene.load.image("chat_input_bg","./resources/ui/chat/input_bg.png"),this.mScene.load.image("chat_border_bg","./resources/ui/chat/bg.png"),this.mScene.load.atlas("chat_atlas",T.getRes("ui/chat/chat_atlas.png"),T.getRes("ui/chat/chat_atlas.json")),t.prototype.preload.call(this))},e.prototype.init=function(){if(!this.mInitialized){t.prototype.init.call(this),this.mParent=this.mScene.add.container(0,0);var e=this.mWorldService.getSize();this.setSize(464,281);var i=new J(this.mScene,4,e.height-260,{width:464,height:281,key:"chat_border_bg",columns:[4,2,4],rows:[4,2,4]}).setOrigin(0,0);this.mParent.add(i);var r=this.mScene.make.container(void 0,!1);this.mParent.add(r);var n=new Ne(this.mScene,0,0,2,2,3,8421504,.5);r.add(n);var s=new Ne(this.mScene,100,10,10,10,10,2493956);r.add(s);var a=new _o(this.mScene,0,0,"",{width:440,height:200,style:{font:"bold 14px YaHei"}});r.add(a);var o=new Ne(this.mScene,0,0,10,20,10,16776960);r.add(o),this.mTextArea=new cs(this.mScene,{x:230,y:e.height-150,width:440,height:200,textWidth:420,textHeight:190,text:a,slider:{track:s,thumb:o}}).layout(),r.add(this.mTextArea);this.mTextArea.getElement("child");var h=this.mScene.make.container(void 0,!1);this.mParent.add(h);var l=new J(this.mScene,8,e.height-46,{width:370,height:32,key:"chat_input_bg",columns:[4,2,4],rows:[4,2,4]}).setOrigin(0,0);h.add(l),this.mInputText=new vs(this.mScene,12,e.height-40,10,10,{type:"input",text:"hello world",fontSize:"14px",color:"#808080"}).resize(370,20).setOrigin(0,0).setStyle({font:"bold 16px YaHei"}).on("focus",this.onFocusHandler,this).on("blur",this.onBlurHandler,this),h.add(this.mInputText);var c=new Ps(this.mScene,60,e.height-30,{width:60,height:30,key:"button",columns:[4,2,4],rows:[4,2,4]},"");c.x=420,c.y=940,c.on("pointerdown",this.onSendMsgHandler,this),h.add(c),this.mSendKey=this.mScene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.mVoiceBtn=new xs(this.mScene,this.mParent.width-60,e.height-this.mParent.height,"chat_atlas","voice_normal.png","voice_selected.png"),this.mParent.add(this.mVoiceBtn),this.mMicBtn=new xs(this.mScene,this.mParent.width-20,e.height-this.mParent.height,"chat_atlas","mic_normal.png","mic_selected.png"),this.mParent.add(this.mMicBtn),this.mVoiceBtn.on("selected",this.onSelectedVoiceHandler,this),this.mMicBtn.on("selected",this.onSelectedMicHandler,this)}},e.prototype.onSelectedVoiceHandler=function(t){!1===t&&(this.mMicBtn.selected=!1),this.emit("selectedVoice",t)},e.prototype.onSelectedMicHandler=function(t){!1!==this.mVoiceBtn.selected?this.emit("selectedMic",t):this.mMicBtn.selected=!1},e.prototype.onSendMsgHandler=function(){var t=this.mInputText.text;t.length>0&&(this.emit("sendChat",t),this.mInputText.setText(""),this.mInputText.setBlur())},e.prototype.onFocusHandler=function(){this.mWorldService&&this.mWorldService.inputManager&&(this.mWorldService.inputManager.enable=!1,this.mSendKey&&this.mSendKey.on("down",this.onDownEnter,this))},e.prototype.onBlurHandler=function(){this.mWorldService&&this.mWorldService.inputManager&&(this.mWorldService.inputManager.enable=!0,this.mSendKey&&this.mSendKey.off("down",this.onDownEnter,this))},e.prototype.onDownEnter=function(){this.onSendMsgHandler()},Object.defineProperty(e.prototype,"outChannel",{get:function(){return 0},enumerable:!0,configurable:!0}),e}(oe),bo=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Po=function(t){function e(e,i){var r=t.call(this)||this;return r.mInRoom=!1,r.mAllMessage=[],r.mMaxMessageNum=50,r.world=e,r.mChatPanel=new vo(i,e),r.world.connection&&(r.world.connection.addPacketListener(r),r.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,r.handleCharacterChat),r.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QCLOUD_GME_AUTHBUFFER,r.handleQCLoudGME)),r.mChatPanel.on("sendChat",r.onSendChatHandler,r),r.mChatPanel.on("selectedVoice",r.onSelectedVoiceHandler,r),r.mChatPanel.on("selectedMic",r.onSelectedMicHandler,r),r.world=e,r}return bo(e,t),e.prototype.enterRoom=function(){if(this.room&&this.room.actor&&this.mGMEApi){this.room.actor.id;var t=this.room.id;this.mGMEApi.EnterRoom(t.toString(),1,this.mQCLoudAuth),this.mInRoom=!0,this.sendVoiceRoomStatus(a.op_def.ChatChannel.CurrentScene,t,a.op_def.VoiceRoomStatus.InVoiceRoom)}},e.prototype.exitRoom=function(){this.mGMEApi&&(this.mGMEApi.EnableMic(!1),this.mGMEApi.ExitRoom(),this.mInRoom=!1,this.room&&this.sendVoiceRoomStatus(a.op_def.ChatChannel.CurrentScene,this.room.id,a.op_def.VoiceRoomStatus.OutsideVoiceRoom))},e.prototype.isSceneUI=function(){return!0},e.prototype.getName=function(){return this.mName},e.prototype.setName=function(t){this.mName=t},e.prototype.getView=function(){return this.mChatPanel},e.prototype.isShow=function(){return this.mChatPanel.isShow()},e.prototype.resize=function(){this.mChatPanel&&this.mChatPanel.resize()},e.prototype.show=function(t){this.mChatPanel.show()},e.prototype.update=function(t){this.mChatPanel.update(t)},e.prototype.hide=function(){this.mChatPanel.hide()},e.prototype.initGME=function(){var t=this;if(this.room.actor){var e=this.room.actor.id;this.mGMEApi=new WebGMEAPI,this.mGMEApi.Init(document,"1400209172",e.toString()),this.mGMEApi.SetTMGDelegate(function(e,i){switch(e){case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ENTER_ROOM:r.log("[GME]: EnterRoom: "+i);break;case t.mGMEApi.event.ITMG_MAIN_EVNET_TYPE_USER_UPDATE:break;case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_EXIT_ROOM:r.log("[GME]: ExitRoom");break;case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ROOM_DISCONNECT:r.log("[GME]: Room Disconnect!!!");break;default:r.log("[GME]: Sth wrong...")}})}},e.prototype.appendMessage=function(t,e){t.push(e),t.length>this.mMaxMessageNum&&t.shift()},e.prototype.changeMessageChannel=function(){for(var t=this,e=this.mAllMessage.filter(function(e){return e.channel===t.mChatPanel.outChannel||e.channel===a.op_def.ChatChannel.System||null===t.mChatPanel.outChannel}),i=e.length,r=null,n="\n",s=0;s<i;s++)r=e[s],s===i-1&&(n=""),this.mChatPanel.appendChat(r.chat+n)},e.prototype.handleCharacterChat=function(t){var e=t.content;if(this.room){this.room.playerManager.get(e.chatSenderid);var i=e.chatSetting.textColor?e.chatSetting.textColor:"#FFFFFF";this.appendMessage(this.mAllMessage,{chat:"[color="+i+"]"+e.chatContext+"[/color]",channel:e.chatChannel}),this.mChatPanel.appendChat("[color="+i+"]"+e.chatContext+"[/color]\n")}},e.prototype.onSendChatHandler=function(t){if(this.world.connection){var e=new s.PBpacket(a.op_virtual_world.OPCODE._OP_GATEWAY_REQ_VIRTUAL_WORLD_CHAT),i=e.content;i.chatChannel=0,i.chatContext=t,this.world.connection.send(e)}},e.prototype.sendVoiceRoomStatus=function(t,e,i){if(this.room.connection){var r=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS),n=r.content;n.voiceChannel=t,n.voiceRoomId=e,n.voiceRoomStatus=i,this.room.connection.send(r)}},e.prototype.handleQCLoudGME=function(t){var e=t.content;this.mQCLoudAuth=e.signature,this.initGME()},e.prototype.onSelectedVoiceHandler=function(t){t?this.enterRoom():this.exitRoom()},e.prototype.onSelectedMicHandler=function(t){if(this.mGMEApi&&(this.mInRoom&&this.mGMEApi.EnableMic(t),this.world.connection)){var e=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS);this.world.connection.send(e)}},Object.defineProperty(e.prototype,"room",{get:function(){if(this.world&&this.world.roomManager)return this.world.roomManager.currentRoom},enumerable:!0,configurable:!0}),e}(s.PacketHandler),To=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),xo=function(t){function e(e){var i=t.call(this)||this;return i.worldService=e,i.mConnect=e.connection,i.mConnect&&(i.mConnect.addPacketListener(i),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_UI,i.handleShowUI),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_UPDATE_UI,i.handleUpdateUI),i.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CLOSE_UI,i.handleCloseUI)),i}return To(e,t),e.prototype.setScene=function(t){this.mMedMap||(this.mMedMap=new Map,this.mMedMap.set(de.BagHotKey,new ge(this.worldService,t)),this.mMedMap.set(de.BagMediator,new pe(this.worldService,t)),this.mMedMap.set(de.ChatMediator,new Po(this.worldService,t))),this.mMedMap.forEach(function(t){t.isSceneUI()&&t.show()})},e.prototype.resize=function(t,e){this.mBagUI&&this.mBagUI.resize(),this.mMedMap&&this.mMedMap.forEach(function(t){t.isShow&&t.resize()})},e.prototype.getMediator=function(t){return this.mMedMap.get(t)},e.prototype.handleShowUI=function(t){var e=t.content;this.showMed(e.name,e)},e.prototype.handleUpdateUI=function(t){var e=t.content;this.updateMed(e.name,e)},e.prototype.handleCloseUI=function(t){var e=t.content;this.hideMed(e.name)},e.prototype.showMed=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.mMedMap.get(t);if(!n){if(r.debug("====show===="+t),!n)return void r.error("error type no panel can show!!!");this.mMedMap.set(t,n),n.setName(t)}n.show(e)},e.prototype.updateMed=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=this.mMedMap.get(t);n?n.update(e):r.error("error type no panel can show!!!")},e.prototype.hideMed=function(t){var e=this.mMedMap.get(t);e?e.hide():r.error("error type no panel can show!!!")},e}(s.PacketHandler),So=function(t,e,i,r,n,s,a,o){var h=new J(this.scene,t,e,i,r,n,s,a,o);return this.scene.add.existing(h),h};const Oo=Phaser.GameObjects.BuildGameObject;var Co=function(t,e){void 0!==e&&(t.add=e);var i=new J(this.scene,t);return Oo(this.scene,i,t),i},Do=function(t){return null==t||""===t||0===t.length},wo=function(t,e,i){if("object"==typeof t)if(Do(e)){if(null==i)return;"object"==typeof i&&(t=i)}else{"string"==typeof e&&(e=e.split("."));var r=e.pop();(function(t,e,i){void 0===i&&(i={});var r=t;if(Do(e));else{var n;"string"==typeof e&&(e=e.split("."));for(var s=0,a=e.length;s<a;s++){var o;null!=r[n=e[s]]&&"object"==typeof r[n]||(o=s===a-1?i:{},r[n]=o),r=r[n]}}return r}(t,e))[r]=i}};wo(window,"RexPlugins.GameObjects.NinePatch",J);var Ao=class extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexNinePatch",So,Co)}start(){this.game.events.once("destroy",this.destroy,this)}},Eo=function(t,e,i,r,n){var s=new vs(this.scene,t,e,i,r,n);return this.scene.add.existing(s),s};const Mo=Phaser.Utils.Objects.GetAdvancedValue,Io=Phaser.GameObjects.BuildGameObject;var Bo=function(t,e){var i=Mo(t,"width",void 0),r=Mo(t,"height",void 0);void 0!==e&&(t.add=e);var n=new vs(this.scene,0,0,i,r,t);return Io(this.scene,n,t),n};wo(window,"RexPlugins.GameObjects.InputText",vs);var ko=class extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexInputText",Eo,Bo)}start(){this.game.events.once("destroy",this.destroy,this)}},Ro=function(t,e,i,r){var n=new _o(this.scene,t,e,i,r);return this.scene.add.existing(n),n};const No=Phaser.Utils.Objects.GetAdvancedValue,jo=Phaser.GameObjects.BuildGameObject;var Lo=function(t,e){var i=No(t,"text",""),r=No(t,"style",null),n=No(t,"padding",null);null!==n&&(r.padding=n),void 0!==e&&(t.add=e);var s=new _o(this.scene,0,0,i,r);return jo(this.scene,s,t),s.autoRound=No(t,"autoRound",!0),s.resolution=No(t,"resolution",1),s};wo(window,"RexPlugins.GameObjects.BBCodeText",_o);var Fo=class extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexBBCodeText",Ro,Lo)}start(){this.game.events.once("destroy",this.destroy,this)}};const zo=Phaser.Utils.Objects.GetValue;class Vo{constructor(t,e){this.gameObject=t,this.scene=xi(t),this.setEventEmitter(zo(e,"eventEmitter",void 0)),t.setInteractive(zo(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.pointer=void 0,this.lastClickTime=void 0,this.setEnable(zo(t,"enable",!0)),this.setMode(zo(t,"mode",1)),this.setClickInterval(zo(t,"clickInterval",100)),this.setDragThreshold(zo(t,"threshold",void 0)),this}boot(){this.gameObject.on("pointerdown",this.onPress,this),this.gameObject.on("pointerup",this.onRelease,this),this.gameObject.on("pointerout",this.onPointOut,this),this.gameObject.on("pointermove",this.onMove,this),this.gameObject.once("destroy",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointer=void 0,this.gameObject=void 0,this.scene=void 0}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.cancel(),this.enable=t,this.gameObject.input.enabled=t,this)}setMode(t){return"string"==typeof t&&(t=Ho[t]),this.mode=t,this}setClickInterval(t){return this.clickInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}onPress(t){void 0===this.pointer&&(this.pointer=t,0===this.mode&&this.click(t.downTime,t))}onRelease(t){this.pointer===t&&(1===this.mode&&this.click(t.upTime,t),this.pointer=void 0)}onPointOut(t){this.pointer===t&&this.cancel()}onMove(t){this.pointer===t&&void 0!==this.dragThreshold&&t.getDistance()>=this.dragThreshold&&this.cancel()}click(t,e){if(void 0===t)return this.emit("click",this,this.gameObject,e),this;this.pointer=void 0;var i=this.lastClickTime;return void 0!==i&&t-i<=this.clickInterval?this:(this.lastClickTime=t,this.emit("click",this,this.gameObject,e),this)}cancel(){return this.pointer=void 0,this}}Object.assign(Vo.prototype,gn);const Ho={press:0,pointerdown:0,release:1,pointerup:1};var Yo=Vo,Go=Yo;var Uo=class extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.once("destroy",this.destroy,this)}add(t,e){return new Go(t,e)}};class Wo{constructor(t){this.scene=t}static register(t,e){Wo.prototype[t]=e}}var Xo=Wo,Ko=Ne;Xo.register("roundRectangle",function(t,e,i,r,n,s,a){var o=new Ko(this.scene,t,e,i,r,n,s,a);return this.scene.add.existing(o),o}),wo(window,"RexPlugins.UI.RoundRectangle",Ko);var Jo=_o;Xo.register("BBCodeText",function(t,e,i,r){var n=new Jo(this.scene,t,e,i,r);return this.scene.add.existing(n),n}),wo(window,"RexPlugins.UI.BBCodeText",Jo);var Zo={plainText:null,prevProp:null},qo=new Fs;var $o=function(t){for(var e,i,r,n={},s=0,a=(t=t.split(";")).length;s<a;s++)if(i=(e=t[s].split(":"))[0],r=e[1],!Qo(i)&&!Qo(r)){switch(i){case"stroke":var o=r.split(" ");r={},(l=o.length)>=1&&(r.color=o[0]),l>=2&&(r.thinkness=parseInt(o[1].replace("px","")));break;case"shadow":var h=r.split(" ");r={},(l=h.length)>=1&&(r.color=h[0]),l>=2&&(r.offsetX=parseInt(h[1].replace("px",""))),l>=3&&(r.offsetY=parseInt(h[2].replace("px",""))),l>=4&&(r.blur=parseInt(h[3].replace("px","")));break;case"u":case"underline":var l,c=r.split(" ");r={},(l=c.length)>=1&&(r.color=c[0]),l>=2&&(r.thinkness=parseInt(c[1].replace("px",""))),l>=3&&(r.offset=parseInt(c[2].replace("px","")))}n[i]=r}return n},Qo=function(t){return 0===(t=t.replace(sh,"")).length},th=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,eh=/<\s*class=/i,ih=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,rh=/<\s*style=/i,nh=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,sh=/^\s+|\s+$/,ah=class{constructor(t){void 0===t&&(t={}),this.tags=t}addTag(t,e){this.tags[t]=e}splitText(t,e){for(var i,r,n,s=[],a=0,o=t.length,h=o;i=th.exec(t);)r=i[0],a<(h=th.lastIndex-r.length)&&s.push(t.substring(a,h)),void 0===e?s.push(r):1===e&&(eh.test(r)?(n=r.match(ih),s.push(n[2])):rh.test(r)&&(n=r.match(nh),s.push(n[2]))),a=th.lastIndex;return a<o&&s.push(t.substring(a,o)),s}tagTextToProp(t,e){var i,r;if(eh.test(t)){if(null!=(a=t.match(ih))){var n=a[1],s=this.tags;(r=s.hasOwnProperty(n)?s[n]:{})._class=n,i=a[2]}}else if(rh.test(t)){var a;if(null!=(a=t.match(nh))){var o=a[1];(r=$o(o))._style=o,i=a[2]}}null==i&&(i=t),null==r&&(r={});var h=Zo;return h.plainText=i,h.prop=r,h}propToContextStyle(t,e){var i=qo;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var r=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];i.fontFamily=r}else i.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var n=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof n&&(n=n.toString()+"px"),i.fontSize=n}else i.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var s=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];i.fontStyle=s}else i.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")?(e.hasOwnProperty("color")?e.color:e["font-color"],i.color=e.color):i.color=t.color,e.hasOwnProperty("stroke")){var a=e.stroke;i.stroke=a.hasOwnProperty("color")?a.color:t.stroke,i.strokeThickness=a.hasOwnProperty("thinkness")?a.thinkness:t.strokeThickness}else i.stroke=t.stroke,i.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var o=e.shadow;i.shadowColor=o.hasOwnProperty("color")?o.color:t.shadowColor,i.shadowOffsetX=o.hasOwnProperty("offsetX")?o.offsetX:t.shadowOffsetX,i.shadowOffsetY=o.hasOwnProperty("offsetY")?o.offsetY:t.shadowOffsetY,i.shadowBlur=o.hasOwnProperty("blur")?o.blur:t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=t.shadowStroke,i.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var h=e.hasOwnProperty("u")?e.u:e.underline;i.underlineColor=h.hasOwnProperty("color")?h.color:t.underlineColor,i.underlineThickness=h.hasOwnProperty("thinkness")?h.thinkness:t.underlineThickness,i.underlineOffset=h.hasOwnProperty("offset")?h.offset:t.underlineOffset}else i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset;return i}propToTagText(t,e,i){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='"+e._class+"'>"+t+"</class>":e.hasOwnProperty("_style")?"<style='"+e._style+"'>"+t+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(t){var e=this.tags[t];return!!e&&null==e.img}};const oh=Phaser.Utils.Objects.GetValue;var hh=class extends Fa{constructor(t,e,i,r,n){var s=oh(n,"tags",void 0),a=new ah(s);super(t,e,i,r,n,"rexTagText",a),this.parser=a}addTag(t,e){return this.parser.addTag(t,e),this.updateText(!0)}addTags(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}};Xo.register("tagText",function(t,e,i,r){var n=new hh(this.scene,t,e,i,r);return this.scene.add.existing(n),n}),wo(window,"RexPlugins.UI.TagText",hh);Xo.register("container",function(t,e,i,r,n){var s=new ri(this.scene,t,e,i,r,n);return this.scene.add.existing(s),s}),wo(window,"RexPlugins.UI.Container",ri);const lh=Phaser.Renderer.WebGL.Utils;var ch={renderWebGL:function(t,e,i,r,n){if(e.dirty&&(e.updateTexture(),e.dirty=!1),0!==e.width&&0!==e.height){var s=e.frame,a=s.width,o=s.height,h=lh.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,s.glTexture,a,o,e.x,e.y,a/e.resolution,o/e.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,a,o,h(e._tintTL,r.alpha*e._alphaTL),h(e._tintTR,r.alpha*e._alphaTR),h(e._tintBL,r.alpha*e._alphaBL),h(e._tintBR,r.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,r,n)}},renderCanvas:function(t,e,i,r,n){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,r,n)}};const uh=Phaser.Display.Color;var ph={clear(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this},fill(t){return this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this},getPixel(t,e,i){void 0===i&&(i=new uh);var r=this.context.getImageData(t,e,1,1);return i.setTo(r.data[0],r.data[1],r.data[2],r.data[3]),i},setPixel(t,e,i,r,n,s){if("number"!=typeof i){var a=i;i=a.red,r=a.green,n=a.blue,s=a.alpha}void 0===s&&(s=0!==i||0!==r||0!==n?255:0);var o=this.context.createImageData(1,1);return o.data[0]=i,o.data[1]=r,o.data[2]=n,o.data[3]=s,this.context.putImageData(o,t,e),this.dirty=!0,this}},dh={updateTexture(t,e){t&&(e?t.call(e,this.canvas,this.context):t(this.canvas,this.context)),this.canvas.width===this.frame.width&&this.canvas.height===this.frame.height||this.frame.setSize(this.canvas.width,this.canvas.height),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(this.canvas,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!1;var i=this.input;return i&&!i.customHitArea&&(i.hitArea.width=this.width,i.hitArea.height=this.height),this},generateTexture(t,e,i,r,n){var s,a=this.canvas,o=this.scene.sys,h=o.game.renderer;void 0===e&&(e=0),void 0===i&&(i=0),void 0===r?r=a.width:r*=this.resolution,void 0===n?n=a.height:n*=this.resolution;var l=(s=o.textures.exists(t)?o.textures.get(t):o.textures.createCanvas(t,r,n)).getSourceImage();l.width!==r&&(l.width=r),l.height!==n&&(l.height=n);var c=l.getContext("2d");return c.clearRect(0,0,r,n),c.drawImage(a,e,i,r,n),h.gl&&s&&h.canvasToTexture(l,s.source[0].glTexture,!0,0),this},loadTexture(t,e){var i=this.scene.textures.getFrame(t,e);return i?(this.width!==i.cutWidth||this.height!==i.cutHeight?this.resize(i.cutWidth,i.cutHeight):this.context.clearRect(0,0,i.cutWidth,i.cutHeight),this.context.drawImage(i.source.image,i.cutX,i.cutY,i.cutWidth,i.cutHeight,0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this):this}};const fh=Phaser.Display.Canvas.CanvasPool,mh=Phaser.GameObjects.GameObject;class gh extends mh{constructor(t,e,i,r,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=1),super(t,"rexCanvas"),this.renderer=t.sys.game.renderer,this.resolution=t.sys.game.config.resolution,this.canvas=fh.create(this,this.resolution*r,this.resolution*n),this.context=this.canvas.getContext("2d"),this.dirty=!1,this.setPosition(e,i),this.setSize(r,n),this.setOrigin(.5,.5),this.initPipeline(),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),this.dirty=!0,t.sys.game.events.on("contextrestored",function(){this.dirty=!0},this)}getCanvas(t){return t||(this.dirty=!0),this.canvas}needRedraw(){return this.dirty=!0,this}preDestroy(){fh.remove(this.canvas)}resize(t,e){return this.width===t&&this.height===e?this:(this.setSize(t,e).updateDisplayOrigin(),t*=this.resolution,e*=this.resolution,t=Math.max(Math.ceil(t),1),e=Math.max(Math.ceil(e),1),this.canvas.width=t,this.canvas.height=e,this.dirty=!0,this)}}const _h=Phaser.GameObjects.Components;Phaser.Class.mixin(gh,[_h.Alpha,_h.BlendMode,_h.ComputedSize,_h.Crop,_h.Depth,_h.Flip,_h.GetBounds,_h.Mask,_h.Origin,_h.Pipeline,_h.ScrollFactor,_h.Tint,_h.Transform,_h.Visible,ch,ph,dh]);var yh=gh,vh=function(t,e){void 0===e&&(e={}),void 0===e.options&&(e.options={});var i=e.options;i.responsive=!1,i.maintainAspectRatio=!1,i.hasOwnProperty("devicePixelRatio")||(i.devicePixelRatio=1);var r=!1;void 0===i.animation?i.animation={}:!1===i.animation&&(r=!0,i.animation={});var n=i.animation;r&&(n.duration=0);var s=n.onProgress;n.onProgress=function(e){s&&s(e),t.needRedraw()};var a=n.onComplete;return n.onComplete=function(e){a&&a(e),t.needRedraw()},e};class bh extends yh{constructor(t,e,i,r,n,s){super(t,e,i,r,n),this.type="rexChart",this.chart=void 0,void 0!==s&&this.setChart(s)}destroy(t){this.scene&&(this.chart&&(this.chart.destroy(),this.chart=void 0),super.destroy(t))}resize(t,e){if(t===this.width&&e===this.height)return this;if(super.resize(t,e),this.chart){var i=this.chart;i.height=this.canvas.height,i.width=this.canvas.width,i.aspectRatio=i.height?i.width/i.height:null,i.update()}return this}}var Ph={setChart:function(t){if(!window.Chart)return console.error("Can not find chartjs! Load chartjs in preload stage.\nscene.load.script('chartjs', 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js');"),this;return this.chart&&this.chart.destroy(),this.chart=new Chart(this.context,vh(this,t)),this},getChartDataset:function(t){if(void 0!==this.chart){if("string"!=typeof t)return this.chart.data.datasets[t];for(var e,i=this.chart.data.datasets,r=0,n=i.length;r<n;r++)if((e=i[r]).label===t)return e}},getChartData:function(t,e){var i=this.getChartDataset(t);if(void 0!==i){if("string"==typeof e&&-1===(e=this.chart.data.labels.indexOf(e)))return;return i.data[e]}},setChartData:function(t,e,i){if(void 0===this.chart)return this;var r=this.getChartDataset(t);if("string"==typeof e&&-1===(e=this.chart.data.labels.indexOf(e)))return this;return r.data[e]=i,this},updateChart:function(){if(void 0===this.chart)return this;this.chart.update()}};Object.assign(bh.prototype,Ph);var Th=bh;Xo.register("chart",function(t,e,i,r,n){var s=new Th(this.scene,t,e,i,r,n);return this.scene.add.existing(s),s}),wo(window,"RexPlugins.UI.Chart",Th);var xh=function(t,e){t.width===t.height&&(e=0);var i=Math.floor(t.width/2),r=Math.floor(t.height/2),n=t.getContext("2d");n.save(),n.globalCompositeOperation="destination-in",n.beginPath(),0===e?n.arc(i,r,Math.min(i,r),0,2*Math.PI):n.ellipse(i,r,i,r,0,0,2*Math.PI),n.fill(),n.restore()};const Sh=Phaser.Utils.Objects.GetValue;const Oh={circle:0,ellipse:1};var Ch=class extends yh{constructor(t,e,i,r,n,s){super(t,e,i),this.type="rexCircleMaskImage";var a=Sh(s,"maskType",0);this.setTexture(r,n,a)}setTexture(t,e,i){return void 0===i?i=0:"string"==typeof i&&(i=Oh[i]),this._textureKey=t,this._frameName=e,this.loadTexture(t,e),null!==i&&xh(this.canvas,i),this.dirty=!0,this}};Xo.register("circleMaskImage",function(t,e,i,r,n){var s=new Ch(this.scene,t,e,i,r,n);return this.scene.add.existing(s),s}),wo(window,"RexPlugins.UI.CircleMaskImage",Ch);var Dh=J;Xo.register("ninePatch",function(t,e,i,r,n,s,a,o){var h=new Dh(this.scene,t,e,i,r,n,s,a,o);return this.scene.add.existing(h),h}),wo(window,"RexPlugins.UI.NinePatch",Dh);const wh=Phaser.Utils.Objects.GetValue;const Ah={id:["id",void 0],width:["width",void 0],height:["height",void 0],autoPlay:["autoplay",!0],controls:["controls",!1],loop:["loop",!1],poster:["poster",void 0],preload:["preload",void 0],muted:["muted",!1],playsInline:["playsInline",!0],crossOrigin:["crossOrigin","anonymous"]},Eh={canplay:"canplay",canplaythrough:"canplaythrough",ended:"ended",error:"error",loadstart:"loadstart",playing:"playing",pause:"pause",stalled:"stalled"};var Mh=function(t){var e,i,r=document.createElement("video");for(var n in Ah)e=Ah[n],void 0!==(i=wh(t,n,e[1]))&&(r[e[0]]=i);var s=wh(t,"eventEmitter",void 0);if(s)for(let t in Eh)r.addEventListener(Eh[t],function(){s.emit(t,this)}.bind(this));return r};const Ih=Phaser.Utils.Objects.IsPlainObject;const Bh=["webm","ogg","mp4","h264","vp9","hls"];var kh=function(t,e,i){if(Ih(e))for(var r,n=0,s=Bh.length;n<s;n++)if(i[(r=Bh[n])+"Video"]&&e.hasOwnProperty(r)){e=e[r];break}t.src=e,t.load()};const Rh=Phaser.Utils.Objects.GetValue,Nh=Phaser.Math.Clamp;var jh=function(t){return class extends t{createVideoElement(t){return this.video||(void 0===t&&(t={}),t.eventEmitter=this,this.video=Mh(t),this.playbackTimeChangeEventEnable=Rh(t,"playbackTimeChangeEventEnable",!0)),this.video}preDestroy(){this.scene&&(this.video&&(this.video.pause(),this.video.removeAttribute("src"),this.video.load(),this.video=void 0),super.preDestroy&&super.preDestroy())}preUpdate(t,e){if(this.playbackTimeChangeEventEnable){var i=this.playbackTime;i!==this.prevT&&this.emit("playbacktimechange",this),this.prevT=i}super.preUpdate&&super.preUpdate(t,e)}get availableVideoTypes(){return this.scene.sys.game.device.video}load(t){return this.video&&kh(this.video,t,this.availableVideoTypes),this}play(){return this.video&&this.video.play(),this}get isPlaying(){if(this.video){var t=this.video;return!t.paused&&!t.ended&&t.currentTime>0}return!1}pause(){return this.video&&this.video.pause(),this}get isPaused(){return!!this.video&&this.video.paused}get playbackTime(){return this.video&&this.video.currentTime||0}set playbackTime(t){if(this.video)try{this.video.currentTime=t}catch(t){}}setPlaybackTime(t){return this.playbackTime=t,this}get duration(){return this.video&&this.video.duration||0}get t(){if(this.video){var t=this.duration;return 0===t?0:this.playbackTime/t}return 0}set t(t){this.video&&(this.playbackTime=this.duration*Nh(t,0,1))}setT(t){return this.t=t,this}get hasEnded(){return!!this.video&&this.video.ended}get volume(){return this.video&&this.video.volume||0}set volume(t){this.video&&(this.video.volume=t)}setVolume(t){return this.volume=t,this}get muted(){return this.video&&this.video.muted||!1}set muted(t){this.video&&(this.video.muted=t)}setMute(t){return void 0===t&&(t=!0),this.muted=t,this}get loop(){return!!this.video&&this.video.loop}set loop(t){this.video&&(this.video.loop=t)}setLoop(t){return void 0===t&&(t=!0),this.loop=t,this}get readyState(){return this.video?this.video.readyState:void 0}}};const Lh=Phaser.GameObjects.DOMElement,Fh=Phaser.Utils.Objects.IsPlainObject,zh=Phaser.Utils.Objects.GetValue;var Vh=class extends(jh(Lh)){constructor(t,e,i,r,n,s){Fh(e)?(e=zh(s=e,"x",0),i=zh(s,"y",0),r=zh(s,"width",void 0),n=zh(s,"height",void 0)):Fh(r)&&(r=zh(s=r,"width",void 0),n=zh(s,"height",void 0)),void 0===s&&(s={});var a=t.scale.autoRound;void 0!==r&&(a&&(r=Math.floor(r)),s.width=r),void 0!==n&&(a&&(n=Math.floor(n)),s.height=n),super(t,e,i),this.type="rexVideo",this.setElement(this.createVideoElement(s)).load(zh(s,"src",""))}resize(t,e){return this.width===t&&this.height===e?this:(this.node.width=t,this.node.height=e,this.updateSize(),this)}};Xo.register("video",function(t,e,i,r,n){var s=new Vh(this.scene,t,e,i,r,n);return this.scene.add.existing(s),s}),wo(window,"RexPlugins.UI.Video",Vh);var Hh=function(t,e){for(var i=document.getElementsByTagName("script"),r=!1,n=0,s=i.length;n<s;n++)if(-1!=i[n].src.indexOf(t)){r=!0;break}if(!r){var a=document.createElement("script");a.type="text/javascript",a.src=t,e&&(a.onload=e),document.getElementsByTagName("head")[0].appendChild(a)}},Yh=!1,Gh=[],Uh=function(t){Yh?t():(window.onYouTubeIframeAPIReady||(window.onYouTubeIframeAPIReady=function(){Yh=!0;for(var t=0,e=Gh.length;t<e;t++)Gh[t]();Gh=void 0},Hh("https://www.youtube.com/iframe_api")),Gh.push(t))};const Wh=Phaser.GameObjects.DOMElement,Xh=Phaser.Utils.Objects.IsPlainObject,Kh=Phaser.Utils.Objects.GetValue,Jh=Phaser.Math.Clamp;var Zh=class extends Wh{constructor(t,e,i,r,n,s){Xh(e)?(e=Kh(s=e,"x",0),i=Kh(s,"y",0),r=Kh(s,"width",void 0),n=Kh(s,"height",void 0)):Xh(r)&&(r=Kh(s=r,"width",void 0),n=Kh(s,"height",void 0)),void 0===s&&(s={});var a=t.scale.autoRound;void 0!==r&&(a&&(r=Math.floor(r)),s.width=r+"px"),void 0!==n&&(a&&(n=Math.floor(n)),s.height=n+"px"),super(t,e,i),this.type="rexYoutubePlayer",this.youtubePlayer=void 0,this.videoState=void 0,this.videoId=Kh(s,"videoId",""),this.loop=Kh(s,"loop",!1),this.paddingCallbacks=[];var o="YT"+Date.now(),h=document.createElement("div");h.id=o,h.style.width=s.width,h.style.height=s.height,this.setElement(h);var l={autoplay:Kh(s,"autoPlay",!0)?1:0,controls:Kh(s,"controls",!0)?1:0,disablekb:Kh(s,"keyboardControl",!0)?0:1,modestbranding:Kh(s,"modestBranding",!1)?1:0},c=function(){var t=new YT.Player(o,{videoId:this.videoId,playerVars:l,events:{onStateChange:function(t){this.videoState=t.data,this.emit("statechange",this),this.emit(this.videoStateString,this),this.videoState===YT.PlayerState.ENDED&&this.loop&&this.youtubePlayer.playVideo()}.bind(this),onReady:function(e){this.youtubePlayer=t;for(var i=0,r=this.paddingCallbacks.length;i<r;i++)this.paddingCallbacks[i]();this.paddingCallbacks=void 0,this.emit("ready",this)}.bind(this),onError:function(t){this.lastError=t.data,this.emit("error",this,this.lastError)}.bind(this)}});this.setElement(document.getElementById(o))}.bind(this);Uh(c)}_runCallback(t){void 0===this.youtubePlayer?this.paddingCallbacks.push(t):t()}get videoStateString(){if(void 0===this.videoState||!YT)return"";switch(this.videoState){case-1:return"unstarted";case YT.PlayerState.ENDED:return"ended";case YT.PlayerState.PLAYING:return"playing";case YT.PlayerState.PAUSED:return"pause";case YT.PlayerState.BUFFERING:return"buffering";case YT.PlayerState.CUED:return"cued"}}load(t,e){void 0===e&&(e=!0);var i=function(){this.youtubePlayer.loadVideoById(t),e?this.youtubePlayer.playVideo():this.youtubePlayer.pauseVideo()}.bind(this);return this._runCallback(i),this}play(){var t=function(){this.youtubePlayer.playVideo()}.bind(this);return this._runCallback(t),this}get isPlaying(){return 1===this.videoState}pause(){var t=function(){this.youtubePlayer.pauseVideo()}.bind(this);return this._runCallback(t),this}get isPaused(){return 2===this.videoState}get playbackTime(){return this.youtubePlayer?this.youtubePlayer.getCurrentTime():0}set playbackTime(t){var e=function(){this.youtubePlayer.seekTo(t)}.bind(this);this._runCallback(e)}setPlaybackTime(t){return this.playbackTime=t,this}get duration(){return this.youtubePlayer?this.youtubePlayer.getDuration():0}get t(){var t=this.duration;return 0===t?0:this.playbackTime/t}set t(t){var e=function(){t=Jh(t,0,1),this.playbackTime=this.duration*Jh(t,0,1)}.bind(this);this._runCallback(e)}setT(t){return this.t=t,this}get hasEnded(){return 0===this.videoState}get volume(){return this.youtubePlayer?this.youtubePlayer.getVolume()/100:0}set volume(t){var e=function(){this.youtubePlayer.setVolume(Jh(100*t,0,100))}.bind(this);this._runCallback(e)}setVolume(t){return this.volume=t,this}get muted(){return!!this.youtubePlayer&&this.youtubePlayer.isMuted()}set muted(t){var e=function(){t?this.youtubePlayer.mute():this.youtubePlayer.unMute()}.bind(this);this._runCallback(e)}setMute(t){return void 0===t&&(t=!0),this.muted=t,this}setLoop(t){return void 0===t&&(t=!0),this.loop=t,this}resize(t,e){if(this.width===t&&this.height===e)return this;var i=this.node.style;return i.width=t+"px",i.height=e+"px",this.updateSize(),this}};Xo.register("youtubePlayer",function(t,e,i,r,n){var s=new Zh(this.scene,t,e,i,r,n);return this.scene.add.existing(s),s}),wo(window,"RexPlugins.UI.YoutubePlayer",Zh);Xo.register("sizer",function(t,e,i,r,n){var s=new Mr(this.scene,t,e,i,r,n);return this.scene.add.existing(s),s}),wo(window,"RexPlugins.UI.Sizer",Mr);var qh=function(){if(this.rexSizer.hidden)return 0;for(var t,e,i,r,n,s=0,a=this.gridChildren,o=0;o<this.columnCount;o++){if(t=0,void 0===(n=this.columnProportions[o])||0===n){for(var h=0;h<this.rowCount;h++)(e=a[h*this.columnCount+o])&&(e.rexSizer.hidden||(r=e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width,r+=(i=e.rexSizer.padding).left+i.right,t=Math.max(t,r)));s+=t}this.columnWidth[o]=t}return s},$h=function(){if(this.rexSizer.hidden)return 0;for(var t,e,i,r,n,s=0,a=this.gridChildren,o=0;o<this.rowCount;o++){if(t=0,void 0===(n=this.rowProportions[o])||0===n){for(var h=0;h<this.columnCount;h++)(e=a[o*this.columnCount+h])&&(e.rexSizer.hidden||(r=e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height,r+=(i=e.rexSizer.padding).top+i.bottom,t=Math.max(t,r)));s+=t}this.rowHeight[o]=t}return s},Qh=function(t){void 0===t&&(t=[]);for(var e,i=this.gridChildren,r=0,n=i.length;r<n;r++)(e=i[r])&&e.isRexSizer&&t.push(e);return t},tl=function(t,e){var i,r=t.rexSizer;if(r.expand){var n=r.padding;i=e-n.left-n.right}return i},el=function(t,e){var i,r=t.rexSizer;if(r.expand){var n=r.padding;i=e-n.top-n.bottom}return i};const il=Phaser.Display.Align.In.QuickSet;var rl={getChildrenWidth:qh,getChildrenHeight:$h,getChildrenSizers:Qh,layout:function(t,e,i){if(this.rexSizer.hidden)return this;this.layoutInit(t);var r,n,s,a,o=this.totalColumnProportions,h=this.totalRowProportions;if(void 0===e)if(t&&o>0){var l=this.rexSizer.padding;e=t.width-l.left-l.right}else e=Math.max(this.childrenWidth,this.minWidth);if(void 0===i)if(t&&h>0){var l=this.rexSizer.padding;i=t.height-l.top-l.bottom}else i=Math.max(this.childrenHeight,this.minHeight);this.resize(e,i),r=o>0?(this.width-this.childrenWidth)/o:0,n=h>0?(this.height-this.childrenHeight)/h:0;for(var c,u,p,d,f,m,g,_,y,v,b=this.left,P=b,T=this.top,x=0;x<this.rowCount;x++){v=0===(_=this.rowProportions[x]||0)?this.rowHeight[x]:_*n,P=b;for(var S=0;S<this.columnCount;S++)y=0===(g=this.columnProportions[S]||0)?this.columnWidth[S]:g*r,(s=this.gridChildren[x*this.columnCount+S])&&!s.rexSizer.hidden?(f=tl(s,y),m=el(s,v),s.isRexSizer?s.layout(this,f,m):qi(s,f,m),c=P+(l=(a=s.rexSizer).padding).left,p=y-l.left-l.right,u=T+l.top,d=v-l.top-l.bottom,Qi.setPosition(c,u).setSize(p,d),il(s,Qi,a.align),this.resetChildPositionState(s),P+=y):P+=y;T+=v}return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0}};const nl=Phaser.Utils.Objects.IsPlainObject,sl=Phaser.Utils.Objects.GetValue,al=Phaser.Utils.Array.Remove,ol=Phaser.Display.Align.CENTER;class hl extends ur{constructor(t,e,i,r,n,s,a,o,h){var l;nl(e)?(e=sl(l=e,"x",0),i=sl(l,"y",0),r=sl(l,"width",void 0),n=sl(l,"height",void 0),s=sl(l,"column",0),a=sl(l,"row",0),o=sl(l,"columnProportions",void 0),h=sl(l,"rowProportions",void 0)):nl(r)?(r=sl(l=r,"width",void 0),n=sl(l,"height",void 0),s=sl(l,"column",0),a=sl(l,"row",0),o=sl(l,"columnProportions",void 0),h=sl(l,"rowProportions",void 0)):nl(s)?(s=sl(l=s,"column",0),a=sl(l,"row",0),o=sl(l,"columnProportions",void 0),h=sl(l,"rowProportions",void 0)):nl(o)&&(o=sl(l=o,"columnProportions",void 0),h=sl(l,"rowProportions",void 0)),super(t,e,i,r,n,l),this.type="rexGridSizer",this.initialGrid(s,a,o,h)}destroy(t){this.scene&&(this.gridChildren.length=0,super.destroy(t))}setColumnProportion(t,e){return t>=this.columnProportions.length?this:(this.columnProportions[t]=e,this)}setRowProportion(t,e){return t>=this.rowProportions.length?this:(this.rowProportions[t]=e,this)}add(t,e,i,r,n,s){var a;(super.add(t),nl(e))&&(e=sl(a=e,"column",0),i=sl(a,"row",0),r=sl(a,"align",ol),n=sl(a,"padding",0),s=sl(a,"expand",!1));return"string"==typeof r&&(r=Sr[r]),void 0===r&&(r=ol),void 0===n&&(n=0),void 0===s&&(s=!0),(a=this.getSizerConfig(t)).parent=this,a.align=r,a.padding=Pr(n),a.expand=s,this.gridChildren[i*this.columnCount+e]=t,this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,al(this.gridChildren,t),void 0!==this.backgroundChildren&&al(this.backgroundChildren,t),super.remove(t),this)}get totalColumnProportions(){for(var t,e=0,i=0;i<this.columnCount;i++)(t=this.columnProportions[i])>0&&(e+=t);return e}get totalRowProportions(){for(var t,e=0,i=0;i<this.rowCount;i++)(t=this.rowProportions[i])>0&&(e+=t);return e}initialGrid(t,e,i,r){if(this.columnCount=t,this.rowCount=e,this.gridChildren=[],this.gridChildren.length=t*e,this.columnProportions=[],this.columnProportions.length=t,this.columnWidth=[],this.columnWidth.length=t,this.rowProportions=[],this.rowProportions.length=e,this.rowHeight=[],this.rowHeight.length=e,i)for(var n="number"==typeof i,s=0;s<t;s++)if(n)this.setColumnProportion(s,i);else{var a=i[s];a>0&&this.setColumnProportion(s,a)}if(r){var o="number"==typeof r;for(s=0;s<e;s++)if(o)this.setRowProportion(s,r);else{var h=r[s];h>0&&this.setRowProportion(s,h)}}return this}}Object.assign(hl.prototype,rl);var ll=hl;Xo.register("gridSizer",function(t,e,i,r,n,s,a,o){var h=new ll(this.scene,t,e,i,r,n,s,a,o);return this.scene.add.existing(h),h}),wo(window,"RexPlugins.UI.GridSizer",ll);var cl=function(){return this.rexSizer.hidden?0:(t=0===this.orientation?this.maxChildWidth:0,t=Math.max(t,this.minWidth));var t},ul=function(){return this.rexSizer.hidden?0:(t=0===this.orientation?0:this.maxChildHeight,t=Math.max(t,this.minHeight));var t},pl=function(t){void 0===t&&(t=[]);for(var e,i=this.sizerChildren,r=0,n=i.length;r<n;r++)"\n"!==(e=i[r])&&e.isRexSizer&&t.push(e);return t},dl=function(t){var e=t.rexSizer.padding;return t.width+e.left+e.right},fl=function(t){var e=t.rexSizer.padding;return t.height+e.top+e.bottom},ml=function(t,e){return 0===e?dl(t):fl(t)},gl=function(t,e){return 0===e?fl(t):dl(t)},_l=function(t){for(var e,i,r,n,s={lines:[],width:0,height:0},a=this.sizerChildren,o=0,h=s.lines,l=0,c=a.length;l<c;l++){if("\n"===(e=a[l]))e=void 0,i=0,n=!0;else{if(e.rexSizer.hidden)continue;e.isRexSizer&&e.layout(),n=o<(i=ml(e,this.orientation))}if(n){if(r){var u=t-(o+this.itemSpacing);s.width=Math.max(s.width,u),s.height+=r.height+this.lineSpacing}r={children:[],remainder:0,height:0},h.push(r),o=t}o-=i+this.itemSpacing,r.remainder=o,e&&(r.children.push(e),r.height=Math.max(r.height,gl(e,this.orientation)))}return r&&(s.height+=r.height),s};const yl=Phaser.Display.Align.In.QuickSet;var vl={getChildrenWidth:cl,getChildrenHeight:ul,getChildrenSizers:pl,layout:function(t,e,i){if(this.rexSizer.hidden)return this;if(this.layoutInit(t),void 0===e){var r=this.padding;e=Math.max(this.maxChildWidth+r.left+r.right,this.minWidth)}void 0===i&&(r=this.padding,i=Math.max(this.maxChildHeight+r.top+r.bottom,this.minHeight));var n;r=this.padding;n=0===this.orientation?e-r.left-r.right:i-r.top-r.bottom;var s,a,o=_l.call(this,n);0===this.orientation?i=Math.max(i,o.height+r.top+r.bottom):e=Math.max(e,o.height+left+r.right),this.resize(e,i);var h,l,c,u,p,d,f,m,g=this.left,_=this.top,y=o.lines;0===this.orientation?(h=g,l=_+this.padding.top):(h=g+this.padding.left,l=_);for(var v=0,b=y.length;v<b;v++){for(var P=0,T=(m=(f=y[v]).children).length;P<T;P++)r=(a=(s=m[P]).rexSizer).padding,0===this.orientation?(c=h+r.left,c+=0===P?this.padding.left:this.itemSpacing,u=l+r.top,p=s.width,d=s.height,h=c+s.width+r.right):(c=h+r.left,u=l+r.top,u+=0===P?this.padding.top:this.itemSpacing,p=s.width,d=s.height,l=u+s.height+r.bottom),Qi.setPosition(c,u).setSize(p,d),yl(s,Qi,a.align),this.resetChildPositionState(s);0===this.orientation?(h=g,l+=f.height+this.lineSpacing):(h+=f.height+this.lineSpacing,l=_)}return this.layoutBackgrounds(),this}},bl=function(t){void 0===t&&(t=this.sizerChildren);for(var e,i=0,r=0,n=t.length;r<n;r++)"\n"!==(e=t[r])&&(i=Math.max(i,dl(e)));return i},Pl=function(t){void 0===t&&(t=this.sizerChildren);for(var e,i=0,r=0,n=t.length;r<n;r++)"\n"!==(e=t[r])&&(i=Math.max(i,fl(e)));return i};const Tl=Phaser.Utils.Objects.IsPlainObject,xl=Phaser.Utils.Objects.GetValue,Sl=Phaser.Utils.Array.Remove,Ol=Phaser.Display.Align.CENTER;class Cl extends ur{constructor(t,e,i,r,n,s,a){var o;Tl(e)?(e=xl(o=e,"x",0),i=xl(o,"y",0),r=xl(o,"width",void 0),n=xl(o,"height",void 0)):Tl(r)?(r=xl(o=r,"width",void 0),n=xl(o,"height",void 0)):Tl(s)?o=s:Tl(a)&&(o=a),void 0!==o&&(s=xl(o,"orientation",0),a=xl(o,"space",o)),void 0===s&&(s=0),void 0===a&&(a=0),super(t,e,i,r,n,o),this.type="rexFixWidthSizer",this.sizerChildren=[],this.setOrientation(s),this.setPadding(a),this.setItemSpacing(xl(a,"item",0)),this.setLineSpacing(xl(a,"line",0))}destroy(t){this.scene&&(this.sizerChildren.length=0,super.destroy(t))}setOrientation(t){return"string"==typeof t&&(t=Tr[t]),this.orientation=t,this}setPadding(t){return this.padding=Pr(t,this.padding),this}setItemSpacing(t){return this.itemSpacing=t,this}setLineSpacing(t){return this.lineSpacing=t,this}add(t,e){if("\n"===t)return this.addNewLine(),this;super.add(t),void 0===e&&(e=0);var i=this.getSizerConfig(t);return i.parent=this,i.align=Ol,i.padding=Pr(e),this.sizerChildren.push(t),this}addNewLine(){return this.sizerChildren.push("\n"),this}insert(t,e,i,r){return this.add(e,i,r),this.moveTo(e,t),this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,Sl(this.sizerChildren,t),super.remove(t),this)}clear(t){for(var e,i=this.sizerChildren,r=0,n=i.length;r<n;r++)"\n"!==(e=i[r])&&(this.getSizerConfig(e).parent=void 0);return i.length=0,super.clear(t),this}get maxChildWidth(){return void 0===this._maxChildWidth&&(this._maxChildWidth=bl.call(this)),this._maxChildWidth}get maxChildHeight(){return void 0===this._maxChildHeight&&(this._maxChildHeight=Pl.call(this)),this._maxChildHeight}}Object.assign(Cl.prototype,vl);var Dl=Cl;Xo.register("fixWidthSizer",function(t,e,i,r,n,s){var a=new Dl(this.scene,t,e,i,r,n,s);return this.scene.add.existing(a),a}),wo(window,"RexPlugins.UI.FixWidthSizer",Dl);const wl=Phaser.Utils.Objects.GetValue;var Al=class extends Mr{constructor(t,e){super(t,e),this.type="rexLabel";var i=wl(e,"background",void 0),r=wl(e,"icon",void 0),n=wl(e,"iconMask",void 0),s=wl(e,"text",void 0),a=wl(e,"action",void 0),o=wl(e,"actionMask",void 0),h=wl(e,"space.left",0),l=wl(e,"space.right",0),c=wl(e,"space.top",0),u=wl(e,"space.bottom",0),p=wl(e,"space.icon",0),d=wl(e,"space.text",0);if(i&&this.addBackground(i),r&&(m=0===this.orientation?{left:h,right:s||a?p:l,top:c,bottom:u}:{left:h,right:l,top:c,bottom:s||a?p:u},this.add(r,0,"center",m),n&&(n=new Vn(r,1),r.setMask(n.createGeometryMask()),this.add(n,null))),s){var f,m,g,_=wl(e,"expandTextWidth",!1),y=wl(e,"expandTextHeight",!1);0===this.orientation?(f=_?1:0,m={left:r?0:h,right:a?d:l,top:c,bottom:u},g=y):(f=y?1:0,m={left:h,right:l,top:r?0:c,bottom:a?d:u},g=_),this.add(s,f,"center",m,g)}a&&(m=0===this.orientation?{left:r||s?0:h,right:l,top:c,bottom:u}:{left:h,right:l,top:r||s?0:c,bottom:u},this.add(a,0,"center",m),o&&(o=new Vn(a,1),r.setMask(o.createGeometryMask()),this.add(o,null))),this.addChildrenMap("background",i),this.addChildrenMap("icon",r),this.addChildrenMap("iconMask",n),this.addChildrenMap("text",s),this.addChildrenMap("action",a),this.addChildrenMap("actionMask",o)}get text(){var t=this.childrenMap.text;return void 0===t?"":t.text?t.text:t.getData("text")}set text(t){var e=this.childrenMap.text;void 0!==e&&(e.setText?e.setText(t):e.setData("text",t))}setText(t){return this.text=t,this}appendText(t){this.text+=t}layout(t,e,i){super.layout(t,e,i);var r=this.childrenMap.iconMask;r&&(r.setPosition(),this.resetChildPositionState(r));var n=this.childrenMap.actionMask;return n&&(n.setPosition(),this.resetChildPositionState(n)),this}resize(t,e){super.resize(t,e);var i=this.childrenMap.iconMask;i&&i.resize();var r=this.childrenMap.actionMask;return r&&r.resize(),this}};Xo.register("label",function(t){var e=new Al(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.Label",Al);var El=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),t.add.zone(0,0,e,i)},Ml=function(t,e){t._buttonBehavior=new Yo(t,e),t._buttonBehavior.on("click",function(e,i,r){Il.call(this,"button.click",t,r)},this),t.on("pointerover",function(e){Il.call(this,"button.over",t,e)},this).on("pointerout",function(e){Il.call(this,"button.out",t,e)},this)},Il=function(t,e,i){var r;if("number"==typeof e){if(r=e,!(e=this.childrenMap.buttons[r]))return}else if(-1===(r=this.childrenMap.buttons.indexOf(e)))return;void 0!==this.groupName?this.eventEmitter.emit(t,e,this.groupName,r,i):this.eventEmitter.emit(t,e,r,i)},Bl=function(t){Nl(t,!1)},kl=function(t){Nl(t,!0)},Rl=function(t){return!!t&&!ni(t).hidden},Nl=function(t,e){t&&(ni(t).hidden=e,t.setVisible(!e))},jl={getButton(t){var e;return"number"==typeof t?e=this.childrenMap.buttons[t]:(e=t,-1===this.childrenMap.buttons.indexOf(e)&&(e=void 0)),e},emitButtonClick(t){return Il.call(this,"button.click",t),this},showButton(t){return Bl(this.getButton(t)),this},hideButton(t){return kl(this.getButton(t)),this},isButtonShown(t){return Rl(this.getButton(t)),this},forEachButtton(t,e){for(var i=this.childrenMap.buttons,r=0,n=i.length;r<n;r++)e?t.call(e,i[r],r,i):t(i[r],r,i);return this}};const Ll=Phaser.Utils.Objects.GetValue;class Fl extends Mr{constructor(t,e){void 0===e&&(e={}),super(t,e),this.type="rexButtons",this.eventEmitter=Ll(e,"eventEmitter",this),this.groupName=Ll(e,"groupName",void 0);var i=Ll(e,"background",void 0),r=Ll(e,"buttons",void 0);r&&0===r.length&&(r=void 0);var n=Ll(e,"space",0);if(i&&this.addBackground(i),r){var s,a,o=Ll(e,"align",void 0),h=Ll(e,"click",void 0);"right"!==o&&"bottom"!==o&&"center"!==o||this.add(El(t),1,"center",0,!1);for(var l=0,c=r.length;l<c;l++)s=r[l],a=0===this.orientation?{left:l>=1?n:0,right:0,top:0,bottom:0}:{left:0,right:0,top:l>=1?n:0,bottom:0},this.add(s,0,"center",a,!0),Ml.call(this,s,h);"center"===o&&this.add(El(t),1,"center",0,!1)}this.addChildrenMap("background",i),this.addChildrenMap("buttons",r||[])}}Object.assign(Fl.prototype,jl);var zl=Fl;Xo.register("buttons",function(t){var e=new zl(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.Buttons",zl);var Vl={getChoice(t){return this.childrenMap.choicesSizer.getButton(t)},getAction(t){return this.childrenMap.actionsSizer.getButton(t)},emitChoiceClick(t){return this.childrenMap.choicesSizer.emitButtonClick(t),this},emitActionClick(t){return this.childrenMap.actionsSizer.emitButtonClick(t),this},showChoice(t){return this.childrenMap.choicesSizer.showButton(t),this},showAction(t){return this.childrenMap.actionsSizer.showButton(t),this},hideChoice(t){return this.childrenMap.choicesSizer.hideButton(t),this},hideAction(t){return this.childrenMap.actionsSizer.hideButton(t),this},forEachChoice(t,e){return this.childrenMap.choicesSizer.forEachButtton(t,e),this},forEachChoice(t,e){return this.childrenMap.choicesSizer.forEachButtton(t,e),this},forEachAction(t,e){return this.childrenMap.actionsSizer.forEachButtton(t,e),this}};const Hl=Phaser.Utils.Objects.GetValue;class Yl extends Mr{constructor(t,e){void 0===e&&(e={}),e.orientation=1,super(t,e),this.type="rexDialog",this.eventEmitter=Hl(e,"eventEmitter",this);var i=Hl(e,"background",void 0),r=Hl(e,"title",void 0),n=Hl(e,"toolbar",void 0);n&&0===n.length&&(n=void 0);var s,a,o=Hl(e,"content",void 0),h=Hl(e,"description",void 0),l=Hl(e,"choices",void 0);l&&0===l.length&&(l=void 0);var c=Hl(e,"actions",void 0);c&&0===c.length&&(c=void 0);var u,p=Hl(e,"click",void 0),d=Hl(e,"space.left",0),f=Hl(e,"space.right",0),m=Hl(e,"space.top",0),g=Hl(e,"space.bottom",0);if(i&&this.addBackground(i),r&&!n){var _=Hl(e,"align.title","center"),y=Hl(e,"space.title",0),v={left:d,right:f,top:m,bottom:o||h||l||c?y:g},b=Hl(e,"expand.title",!0);this.add(r,0,_,v,b)}if(n&&(u=new zl(t,{groupName:"toolbar",buttons:n,orientation:0,space:Hl(e,"space.toolbarItem",0),click:p,eventEmitter:this.eventEmitter})),n&&!r){y=Hl(e,"space.title",0),v={left:d,right:f,top:m,bottom:o||h||l||c?y:g},b=Hl(e,"expand.toolbar",!0);this.add(u,0,"center",v,b)}if(r&&n){var P=new Mr(t,{orientation:0});_=Hl(e,"align.title","left");(b=Hl(e,"expand.title",!0))||"right"!==_&&"center"!==_||P.add(El(t),1,"center",0,!1);v={left:Hl(e,"space.titleLeft",0),right:Hl(e,"space.titleRight",0),top:0,bottom:0};P.add(r,b?1:0,"center",v,b),b||"left"!==_&&"center"!==_||P.add(El(t),1,"center",0,!1),P.add(u,0,"right",0,!1);y=Hl(e,"space.title",0),v={left:d,right:f,top:m,bottom:o||h||l||c?y:g};this.add(P,0,"center",v,!0)}if(o){_=Hl(e,"align.content","center");var T=Hl(e,"space.content",0);v={left:d+Hl(e,"space.contentLeft",0),right:f+Hl(e,"space.contentRight",0),top:r||n?0:m,bottom:h||l||c?T:g},b=Hl(e,"expand.content",!0);this.add(o,0,_,v,b)}if(h){_=Hl(e,"align.description","center");var x=Hl(e,"space.description",0);v={left:d+Hl(e,"space.descriptionLeft",0),right:f+Hl(e,"space.descriptionRight",0),top:r||n||o?0:m,bottom:l||c?x:g},b=Hl(e,"expand.description",!0);this.add(h,0,_,v,b)}if(l){_=Hl(e,"align.choices","center");s=new zl(t,{groupName:"choices",buttons:l,orientation:1,space:Hl(e,"space.choice",0),click:p,eventEmitter:this.eventEmitter});var S=Hl(e,"space.choices",0);v={left:d+Hl(e,"space.choicesLeft",0),right:f+Hl(e,"space.choicesRight",0),top:r||n||o||h?0:m,bottom:c?S:g},b=Hl(e,"expand.choices",!0);this.add(s,0,_,v,b)}if(c){a=new zl(t,{groupName:"actions",buttons:c,orientation:0,space:Hl(e,"space.action",0),align:Hl(e,"align.actions","center"),click:p,eventEmitter:this.eventEmitter});v={left:d+Hl(e,"space.actionsLeft",0),right:f+Hl(e,"space.actionsRight",0),top:r||n||o||h||l?0:m,bottom:g},b=Hl(e,"expand.actions",!0);this.add(a,0,"center",v,b)}this.addChildrenMap("background",i),this.addChildrenMap("title",r),this.addChildrenMap("toolbar",n),this.addChildrenMap("content",o),this.addChildrenMap("choices",l),this.addChildrenMap("actions",c),this.addChildrenMap("choicesSizer",s),this.addChildrenMap("actionsSizer",a)}}Object.assign(Yl.prototype,Vl);var Gl=Yl;Xo.register("dialog",function(t){var e=new Gl(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.Dialog",Gl);var Ul={getButtonsSizer(t){return this.childrenMap[t+"ButtonsSizer"]},getButton(t,e){var i=this.getButtonsSizer(t);return i?i.getButton(e):void 0},emitButtonClick(t,e){var i=this.getButtonsSizer(t);return i?(i.emitButtonClick(e),this):this},emitLeftButtonClick(t){return this.childrenMap.leftButtonsSizer.emitButtonClick(t),this},emitRightButtonClick(t){return this.childrenMap.rightButtonsSizer.emitButtonClick(t),this},emitTopButtonClick(t){return this.childrenMap.topButtonsSizer.emitButtonClick(t),this},emitBottomButtonClick(t){return this.childrenMap.bottomButtonsSizer.emitButtonClick(t),this},getLeftButton(t){return this.childrenMap.leftButtonsSizer.getButton(t)},getRightButton(t){return this.childrenMap.rightButtonsSizer.getButton(t)},getTopButton(t){return this.childrenMap.topButtonsSizer.getButton(t)},getBottomButton(t){return this.childrenMap.bottomButtonsSizer.getButton(t)},showButton(t,e){return Bl(this.getButton(t,e)),this},showLeftButton(t){return Bl(this.getLeftButton(t)),this},showRightButton(t){return Bl(this.getRightButton(t)),this},showTopButton(t){return Bl(this.getTopButton(t)),this},showBottomButton(t){return Bl(this.getBottomButton(t)),this},hideButton(t,e){return kl(this.getButton(t,e)),this},hideLeftButton(t){return kl(this.getLeftButton(t)),this},hideRightButton(t){return kl(this.getRightButton(t)),this},hideTopButton(t){return kl(this.getTopButton(t)),this},hideBottomButton(t){return kl(this.getBottomButton(t)),this},forEachLeftButton(t,e){return this.childrenMap.leftButtonsSizer.forEachButtton(t,e),this},forEachRightButton(t,e){return this.childrenMap.rightButtonsSizer.forEachButtton(t,e),this},forEachTopButton(t,e){return this.childrenMap.topButtonsSizer.forEachButtton(t,e),this},forEachBottomButton(t,e){return this.childrenMap.bottomButtonsSizer.forEachButtton(t,e),this}};const Wl=Phaser.Utils.Objects.GetValue;class Xl extends ll{constructor(t,e){void 0===e&&(e={}),e.column=3,e.row=3,super(t,e),this.type="rexTabs",this.eventEmitter=Wl(e,"eventEmitter",this);var i,r=Wl(e,"background",void 0),n=Wl(e,"panel",void 0),s=Wl(e,"leftButtons",void 0);s&&0===s.length&&(s=void 0);var a,o=Wl(e,"rightButtons",void 0);o&&0===o.length&&(o=void 0);var h,l=Wl(e,"topButtons",void 0);l&&0===l.length&&(l=void 0);var c,u=Wl(e,"bottomButtons",void 0);u&&0===u.length&&(u=void 0);var p=Wl(e,"click",void 0),d=Wl(e,"space.left",0),f=Wl(e,"space.right",0),m=Wl(e,"space.top",0),g=Wl(e,"space.bottom",0),_=Wl(e,"space.leftButtonsOffset",0),y=Wl(e,"space.rightButtonsOffset",0),v=Wl(e,"space.topButtonsOffset",0),b=Wl(e,"space.bottomButtonsOffset",0),P=Wl(e,"space.leftButton",0),T=Wl(e,"space.rightButton",0),x=Wl(e,"space.topButton",0),S=Wl(e,"space.bottomButton",0);if(r&&this.addBackground(r),n){var O={left:s?0:d,right:o?0:f,top:l?0:m,bottom:u?0:g};this.add(n,1,1,"center",O,!0)}if(s){i=new zl(t,{groupName:"left",buttons:s,orientation:1,space:P,align:Wl(e,"align.leftButtons",void 0),click:p,eventEmitter:this.eventEmitter});O={left:d,top:_};this.add(i,0,1,"top",O,!1)}if(o){a=new zl(t,{groupName:"right",buttons:o,orientation:1,space:T,align:Wl(e,"align.rightButtons",void 0),click:p,eventEmitter:this.eventEmitter});O={right:f,top:y};this.add(a,2,1,"top",O,!1)}if(l){h=new zl(t,{groupName:"top",buttons:l,orientation:0,space:x,align:Wl(e,"align.topButtons",void 0),click:p,eventEmitter:this.eventEmitter});O={top:m,left:v};this.add(h,1,0,"left",O,!1)}if(u){c=new zl(t,{groupName:"bottom",buttons:u,orientation:0,space:S,align:Wl(e,"align.bottomButtons",void 0),click:p,eventEmitter:this.eventEmitter});O={bottom:g,left:b};this.add(c,1,2,"left",O,!1)}this.addChildrenMap("background",r),this.addChildrenMap("panel",n),this.addChildrenMap("leftButtons",s),this.addChildrenMap("rightButtons",o),this.addChildrenMap("topButtons",l),this.addChildrenMap("bottomButtons",u),this.addChildrenMap("leftButtonsSizer",i),this.addChildrenMap("rightButtonsSizer",a),this.addChildrenMap("topButtonsSizer",h),this.addChildrenMap("bottomButtonsSizer",c)}}Object.assign(Xl.prototype,Ul);var Kl=Xl;Xo.register("tabs",function(t){var e=new Kl(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.Tabs",Kl);Xo.register("slider",function(t){var e=new mn(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.Slider",mn);var Jl={enableData(){return void 0===this.data&&(this.data={}),this},getData(t,e){return this.enableData(),void 0===t?this.data:yn()(this.data,t,e)},setData(t,e){return this.enableData(),this.data[t]=e,this},incData(t,e,i){return void 0===i&&(i=0),this.enableData(),this.setData(t,this.getData(t,i)+e),this},mulData(t,e,i){return void 0===i&&(i=0),this.enableData(),this.setData(t,this.getData(t,i)*e),this},clearData(){return this.data&&Zs(this.data),this}};class Zl{constructor(t,e){this.container=null,this.setParent(t),this._deltaHeight=0}setParent(t){this.parent=t,this.parentContainer=t.getParentContainer()}destroy(t){if(void 0===t&&(t=!1),!t){var e=this.parent;0!==this.deltaHeight&&e.nonZeroDeltaHeightCount--,this.destroyContainer()}this.data=void 0,this.container=null,this.parent=void 0,this.parentContainer=void 0}get table(){return this.parent}get scrollMode(){return this.parentContainer.scrollMode}get colIndx(){return this.parent.cellIndxeToColIndex(this.index)}get rowIndx(){return this.parent.cellIndxeToRowIndex(this.index)}getContainer(){return this.container}setContainer(t){return this.container&&this.container.destroy(),this.container=t,this.parentContainer.add(t),this}destroyContainer(){return this.container&&(this.container.destroy(),this.container=null),this}popContainer(){if(this.container){var t=this.container;return this.container=null,this.parentContainer.remove(t),t}return null}setXY(t,e){return this.container&&this.parentContainer.setChildLocalPosition(this.container,t,e),this}get deltaHeight(){return this._deltaHeight}set deltaHeight(t){null==t&&(t=0);var e=this.parent;0===this._deltaHeight&&0!==t?e.nonZeroDeltaHeightCount++:0!==this._deltaHeight&&0===t&&e.nonZeroDeltaHeightCount--,this._deltaHeight=t}setDeltaHeight(t){return this.deltaHeight=t,this}get height(){return 0===this.scrollMode?this.deltaHeight+this.parent.defaultCellHeight:this.parent.defaultCellWidth}set height(t){1!==this.scrollMode&&this.setDeltaHeight(t-this.parent.defaultCellHeight)}setHeight(t){return this.height=t,this}get width(){return 0===this.scrollMode?this.parent.defaultCellWidth:this.deltaHeight+this.parent.defaultCellHeight}set width(t){0!==this.scrollMode&&this.setDeltaHeight(t-this.parent.defaultCellHeight)}setWidth(t){return this.width=t,this}get scene(){return this.parentContainer.scene}}Object.assign(Zl.prototype,Jl);var ql=Zl;const $l=Phaser.Utils.Objects.GetValue,Ql=Phaser.Utils.Array.SpliceOne;var tc=new Us;var ec=class{constructor(t,e){this.parent=t,this.cells=[],this.resetFromJSON(e)}resetFromJSON(t){return this.colCount=void 0,this._nonZeroDeltaHeightCount=0,this.resetTotalRowsHeight(),this.setDefaultCellHeight($l(t,"cellHeight",30)),this.setDefaultCellWidth($l(t,"cellWidth",30)),this.initCells($l(t,"cellsCount",0)),this.setColumnCount($l(t,"columns",1)),this}destroy(t){for(var e=0,i=this.cells.length;e<i;e++)this.freeCell(this.cells[e],t);this.cells=void 0,this.parent=void 0}get nonZeroDeltaHeightCount(){return this._nonZeroDeltaHeightCount}set nonZeroDeltaHeightCount(t){this._nonZeroDeltaHeightCount!==t&&(this._nonZeroDeltaHeightCount=t,this.resetTotalRowsHeight())}get defaultCellHeightMode(){return 0===this.nonZeroDeltaHeightCount}setDefaultCellHeight(t){return this.defaultCellHeight=t,this}setDefaultCellWidth(t){return this.defaultCellWidth=t,this}initCells(t){var e=this.cells;e.length=t;for(var i=0;i<t;i++)e[i]=null;return this}insertNewCell(t,e){var i=this.cells;if(t===i.length){var r=t+e;i.legth=r;for(var n=t;n<r;n++)i[n]=null}else{var s=[];for(s.length=e,n=0;n<e;n++)s[n]=null;this.cells.splice(t,0,...s)}return this.resetTotalRowsHeight(),this}removeCell(t,e){for(var i=t+e,r=t;r<i;r++)this.freeCell(r);return i===this.cells.length?this.cells.length=t:(1===e?Ql(this.cells,t):this.cells.splice(t,e),this.buildCellIndex(t)),this.resetTotalRowsHeight(),this}setColumnCount(t){return this.colCount=t,this.resetTotalRowsHeight(),this}get rowCount(){return Math.ceil(this.cells.length/this.colCount)}get cellsCount(){return this.cells.length}isValidCellIdx(t){return t>=0&&t<this.cells.length}heightToRowIndex(t,e){if(this.defaultCellHeightMode){var i=t/this.defaultCellHeight;return i=e?Math.ceil(i):Math.floor(i)}var r,n=this.rowCount,s=t;for(i=0;;){if(r=i>=0&&i<n,!((s-=this.getRowHeight(i))>0&&r)){if(0===s)return i;if(e){var a=i;(r=(i+=1)>=0&&i<n)||(i=a)}return i}i+=1}}widthToColIndex(t,e){var i=t/this.defaultCellWidth;return i=e?Math.ceil(i):Math.floor(i)}colRowToCellIndex(t,e){return t>=this.colCount?null:e*this.colCount+t}rowIndexToHeight(t,e){if(this.defaultCellHeightMode)return(e-t+1)*this.defaultCellHeight;for(var i=0,r=t;r<=e;r++)i+=this.getRowHeight(r);return i}colIndexToWidth(t,e){return(e-t+1)*this.defaultCellWidth}getRowHeight(t){var e=this.colCount;if(e<=1)return this.getCellHeight(this.colRowToCellIndex(0,t));for(var i,r=0,n=0;n<e;n++)r<(i=this.getCellHeight(this.colRowToCellIndex(n,t)))&&(r=i);return r}getColWidth(t){return this.defaultCellWidth}getCellHeight(t){if(!this.isValidCellIdx(t))return 0;var e;if(this.defaultCellHeightMode)e=this.defaultCellHeight;else{var i=this.getCell(t,!1),r=i?i.deltaHeight:0;e=this.defaultCellHeight+r}return e}resetTotalRowsHeight(){this._totalRowsHeight=null}get totalRowsHeight(){return null===this._totalRowsHeight&&(this._totalRowsHeight=this.rowIndexToHeight(0,this.rowCount-1)),this._totalRowsHeight}get totalColumnWidth(){return this.colCount*this.defaultCellWidth}cellIndxeToColIndex(t){return t%this.colCount}cellIndxeToRowIndex(t){return Math.floor(t/this.colCount)}getCell(t,e){if(!this.isValidCellIdx(t))return null;if(void 0===e&&(e=!0),null===this.cells[t]&&e){var i=this.newCell(t);this.cells[t]=i}return this.cells[t]}newCell(t){var e=tc.pop();return null===e?e=new ql(this):e.setParent(this),e.index=t,e}buildCellIndex(t){void 0===t&&(t=0);for(var e,i=this.cells,r=t,n=i.length;r<n;r++)(e=i[r])&&(e.index=r);return this}getParentContainer(){return this.parent}freeCell(t,e){return"number"==typeof t&&(t=this.cells[t]),t?(t.destroy(e),tc.push(t),this):this}},ic=function(t){return t.hasOwnProperty("geometryMask")?t.geometryMask:t.bitmapMask};const rc=Phaser.Geom.Intersects.RectangleToRectangle,nc=Phaser.Geom.Rectangle.Overlaps;var sc=function(t,e){var i=0,r=e.top,n=e.bottom,s=e.left,a=e.right;return i+=t.contains(s,r)?1:0,i+=t.contains(s,n)?1:0,i+=t.contains(a,r)?1:0,i+=t.contains(a,n)?1:0},ac=function(t,e){t.setVisible(!0).clearMask()},oc=function(t,e){t.setVisible(!0).setMask(e)},hc=function(t,e){t.setVisible(!1).clearMask()},lc=function(t,e,i){if(e){void 0===i&&(i=t.getAllChildren());for(var r,n,s=t.getBounds(),a=ic(e),o=0,h=i.length;o<h;o++)if(!(r=i[o]).hasOwnProperty("isRexContainerLite")&&r!==a){if(r.getBounds)switch(n=r.getBounds(n),sc(s,n)){case 4:ac(r,e);break;case 0:rc(s,n)||nc(s,n)?oc(r,e):hc(r,e);break;default:oc(r,e)}else oc(r,e);t.resetChildVisibleState(r).updateChildVisible(r)}}};const cc=ii,uc=Phaser.GameObjects.Components,pc=Phaser.Structs.Set,dc=Phaser.Utils.Objects.GetValue,fc=Phaser.Math.Clamp;class mc extends cc{constructor(t,e,i,r,n,s){void 0===s&&(s={}),super(t,e,i,r,n),this.type="rexGridTable",this._tableOX=0,this._tableOY=0,this.visibleCells=new pc,this.preVisibleCells=new pc,this.visibleStartX=null,this.visibleEndX=null,this.visibleStartY=null,this.visibleEndY=null,this.lastVisibleCellIdx=null,this.execeedTopState=!1,this.execeedBottomState=!1,this.execeedLeftState=!1,this.execeedRightState=!1;var a=dc(s,"reuseCellContainer",!1);this.cellContainersPool=a?t.add.group():void 0;var o=dc(s,"cellVisibleCallback",null);if(null!==o){var h=dc(s,"cellVisibleCallbackScope",void 0);this.on("cellvisible",o,h)}if(null!==(o=dc(s,"cellInvisibleCallback",null))){h=dc(s,"cellInvisibleCallbackScope",void 0);this.on("cellinvisible",o,h)}if(this.cellsMask=void 0,this.setCellsMask(dc(s,"mask",!0)),this.setScrollMode(dc(s,"scrollMode",0)),this.setClampMode(dc(s,"clamplTableOXY",!0)),0===this.scrollMode){var l=dc(s,"cellWidth",void 0);if(this.expandCellSize=void 0===l,void 0===l){var c=dc(s,"columns",1);s.cellWidth=this.width/c}}else{l=dc(s,"cellHeight",void 0);var u=dc(s,"cellWidth",void 0);this.expandCellSize=void 0===l,s.cellWidth=l,s.cellHeight=u}this.table=new ec(this,s),this.updateTable()}destroy(t){this.scene&&(t||this.setCellsCount(0),this.table.destroy(t),this.table=void 0,this.cellContainersPool&&(this.cellContainersPool.destroy(!0),this.cellContainersPool=void 0),super.destroy(t))}setScrollMode(t){return"string"==typeof t&&(t=gc[t.toLowerCase()]),this.scrollMode=t,this}setClampMode(t){return this.clampTableOXYMode=t,this}setCellsCount(t){var e=this.cellsCount;return e===t?this:(e>t?this.removeCell(t,e-t):this.insertNewCell(e,t-e),this)}setColumnCount(t){return this.table.colCount===t?this:(this.table.setColumnCount(t),this)}setGridSize(t,e){return this.setCellsCount(t*e),this.table.setColumnCount(t),this}insertNewCell(t,e){return"object"==typeof t&&(t=t.index),void 0===e&&(e=1),e<=0?this:(t=fc(t,0,this.cellsCount),this.table.insertNewCell(t,e),this)}removeCell(t,e){if("object"==typeof t&&(t=t.index),void 0===e&&(e=1),t<0&&(e+=t,t=0),e<=0)return this;if(t>this.cellsCount)return this;if(t<=this.lastVisibleCellIdx)for(var i,r=this.preVisibleCells,n=this.visibleCells,s=t,a=t+e;s<a;s++)(i=this.getCell(s,!1))&&(n.contains(i)&&(this.hideCell(i),n.delete(i)),r.delete(i));return this.table.removeCell(t,e),this}get tableOY(){return this._tableOY}get tableOX(){return this._tableOX}set tableOY(t){this.setTableOY(t).updateTable()}set tableOX(t){this.setTableOX(t).updateTable()}setTableOY(t){var e=this.table,i=this.topTableOY,r=this.bottomTableOY,n=this.tableOYExceedTop(t),s=this.tableOYExeceedBottom(t);this.clampTableOXYMode&&(e.rowCount<e.heightToRowIndex(this.instHeight,!0)?t=0:n?t=i:s&&(t=r));return this._tableOY!==t&&(this._tableOY=t),n&&(this.execeedTopState||this.emit("execeedtop",this,t,i)),this.execeedTopState=n,s&&(this.execeedBottomState||this.emit("execeedbottom",this,t,r)),this.execeedBottomState=s,this}setTableOX(t){var e=this.table,i=this.leftTableOX,r=this.rightTableOX,n=this.tableOXExeceedLeft(t),s=this.tableOXExeceedRight(t);this.clampTableOXYMode&&(e.colCount<e.widthToColIndex(this.instWidth,!0)?t=0:n?t=i:s&&(t=r));return this._tableOX!==t&&(this._tableOX=t),n&&(this.execeedLeftState||this.emit("execeedleft",this,t,i)),this.execeedLeftState=n,s&&(this.execeedRightState||this.emit("execeedright",this,t,r)),this.execeedRightState=s,this}setTableOXY(t,e){return this.setTableOY(e).setTableOX(t),this}addTableOY(t){return this.setTableOY(this.tableOY+t),this}addTableOX(t){return this.setTableOX(this.tableOX+t),this}addTableOXY(t,e){return this.addTableOY(e).addTableOX(t),this}setTableOYByPercentage(t){return this.setTableOY(-this.tableVisibleHeight*t),this}getTableOYPercentage(){var t=this.tableVisibleHeight;return 0===t?0:this.tableOY/-t}set t(t){this.setTableOYByPercentage(t).updateTable()}get t(){return this.getTableOYPercentage()}updateTable(t){return void 0===t&&(t=!1),t&&(this.clearVisibleCellIndexes(),this.hideCells()),this.clearVisibleCellIndexes(),this.showCells(),this.hideCells(),this.maskCells(),this}getCell(t){return this.table.getCell(t,!0)}getCellContainer(t){var e,i=this.table.getCell(t,!1);return i&&(e=i.getContainer()),e}get cellsCount(){return this.table.cellsCount}get columnCount(){return this.table.colCount}setCellHeight(t,e){return("number"==typeof t?this.table.getCell(t,!0):t).height=e,this}setCellWidth(t,e){return("number"==typeof t?this.table.getCell(t,!0):t).width=e,this}pointerToCellIndex(t,e){e-=this.y+this.topLeftY,t-=this.x+this.topLeftX;var i=this.tableOY-(0===this.scrollMode?e:t),r=this.tableOX-(0===this.scrollMode?t:e),n=this.table,s=n.heightToRowIndex(-i),a=n.widthToColIndex(-r),o=n.colRowToCellIndex(a,s);return null===o?null:this.cellIsVisible(o)?o:null}pointerToCellContainer(t,e){var i=this.pointerToCellIndex(t,e);if(null!==i)return this.getCellContainer(i)}cellIsVisible(t){var e=this.table.getCell(t,!1);return e&&this.visibleCells.contains(e)}eachVisibleCell(t,e){return this.visibleCells.each(t,e),this}iterateVisibleCell(t,e){return this.visibleCells.iterate(t,e),this}setCellsMask(t){var e,i;if(!0===t?(e=!0,i=0):!1===t?e=!1:(e=dc(t,"mask",!0),i=dc(t,"padding",0)),e){var r=new Vn(this,0,i);this.cellsMask=r.createGeometryMask(),this.add(r)}return this}maskCells(){for(var t,e=[],i=this.visibleCells.entries,r=0,n=i.length;r<n;r++)(t=i[r].getContainer())&&(t.isRexContainerLite?t.getAllChildren(e):e.push(t));lc(this,this.cellsMask,e)}resize(t,e){return this.width===t&&this.height===e?this:(super.resize(t,e),this.cellsMask&&qi(ic(this.cellsMask),t,e),this.expandCellSize&&this.table.setDefaultCellWidth(this.instWidth/this.table.colCount),this.updateTable(!0),this)}clearVisibleCellIndexes(){var t=this.preVisibleCells;this.preVisibleCells=this.visibleCells,this.visibleCells=t,this.visibleCells.clear()}showCells(){if(0!==this.cellsCount){var t=this.table,e=t.heightToRowIndex(-this.tableOY);e<0&&(e=0);var i=t.widthToColIndex(-this.tableOX);i<0&&(i=0);var r=t.colRowToCellIndex(i,e),n=this.bottomBound,s=this.rightBound,a=t.cellsCount-1,o=t.colCount-1,h=this.getTLX(i),l=h,c=this.getTLY(e);for(this.visibleStartY=null,this.visibleEndY=null,this.visibleStartX=null,this.visibleEndX=null,this.lastVisibleCellIdx=null;c<n&&r<=a;){if(this.table.isValidCellIdx(r)){null===this.visibleStartY&&(this.visibleStartY=e,this.visibleEndY=e),null===this.visibleStartX&&(this.visibleStartX=i,this.visibleEndX=i),null===this.lastVisibleCellIdx&&(this.lastVisibleCellIdx=r),this.visibleEndY<e&&(this.visibleEndY=e),this.visibleEndX<i&&(this.visibleEndX=i),this.lastVisibleCellIdx<r&&(this.lastVisibleCellIdx=r);var u=t.getCell(r,!0);this.visibleCells.set(u),this.preVisibleCells.contains(u)||this.showCell(u),0===this.scrollMode?u.setXY(l,c):u.setXY(c,l)}l<s&&i<o?(l+=t.getColWidth(i),i+=1):(l=h,c+=t.getRowHeight(e),i=this.visibleStartX,e+=1),r=t.colRowToCellIndex(i,e)}}}showCell(t){var e=null;if(this.cellContainersPool&&null!==(e=this.cellContainersPool.getFirstDead())&&e.setActive(!0).setVisible(!0),this.emit("cellvisible",t,e),this.cellContainersPool){var i=t.getContainer();i?null===e?this.cellContainersPool.add(i):e!==i&&(this.cellContainersPool.add(i),this.cellContainersPool.killAndHide(e)):null!==e&&this.cellContainersPool.killAndHide(e)}}hideCells(){var t=this.preVisibleCells,e=this.visibleCells;t.iterate(function(t){e.contains(t)||this.hideCell(t)},this)}hideCell(t){if(this.emit("cellinvisible",t),this.cellContainersPool){var e=t.popContainer();e&&this.cellContainersPool.killAndHide(e)}t.destroyContainer()}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get tableHeight(){return this.table.totalRowsHeight}get tableWidth(){return this.table.totalColumnWidth}get topTableOY(){return 0}get bottomTableOY(){return-this.tableVisibleHeight}get leftTableOX(){return 0}get rightTableOX(){return-this.tableVisibleWidth}tableOYExceedTop(t){return void 0===t&&(t=this.tableOY),t>this.topTableOY}tableOYExeceedBottom(t){return void 0===t&&(t=this.tableOY),t<this.bottomTableOY}tableOXExeceedLeft(t){return void 0===t&&(t=this.tableOX),t>this.leftTableOX}tableOXExeceedRight(t){return void 0===t&&(t=this.tableOX),t<this.rightTableOX}get tableVisibleHeight(){var t=this.tableHeight,e=this.instHeight;return t>e?t-e:0}get tableVisibleWidth(){var t=this.tableWidth,e=this.instWidth;return t>e?t-e:0}get bottomLeftY(){return-this.displayHeight*this.originY+this.displayHeight}get topRightX(){return-this.displayWidth*this.originX+this.displayWidth}get topLeftX(){return-this.displayWidth*this.originX}get topLeftY(){return-this.displayHeight*this.originY}get bottomBound(){return 0===this.scrollMode?this.bottomLeftY:this.topRightX}get rightBound(){return 0===this.scrollMode?this.topRightX:this.bottomLeftY}getTLX(t){var e=0===this.scrollMode?this.topLeftX:this.topLeftY;return this.tableOX+this.table.colIndexToWidth(0,t-1)+e}getTLY(t){var e=0===this.scrollMode?this.topLeftY:this.topLeftX;return this.tableOY+this.table.rowIndexToHeight(0,t-1)+e}}Object.assign(mc.prototype,uc.GetBounds);const gc={v:0,vertical:0,h:1,horizontal:1};var _c=mc,yc=function(t){Object.defineProperty(t,"childOY",{configurable:!0,get:function(){return t.tableOY},set:function(e){t.tableOY=e}}),Object.defineProperty(t,"topChildOY",{get:function(){return t.topTableOY}}),Object.defineProperty(t,"bottomChildOY",{get:function(){return t.bottomTableOY}})},vc=function(t){t.on("cellvisible",function(t,e){var i,r=this.createCellContainerCallback,n=this.createCellContainerCallbackScope;t.item=this.items[t.index],(i=n?r.call(n,t,e):r(t,e)).setOrigin&&i.setOrigin(0),i.isRexSizer&&i.layout(),t.item=void 0,t.setContainer(i)},this)},bc=function(t,e,i,r,n){var s;if(null!=(s=void 0===n?r:i.pointerToCellIndex(r,n))){var a=i.getCellContainer(s);t.emit(e,a,s)}},Pc=function(t){t._click=new Yo(t,{threshold:10}),t._click.on("click",function(t,e,i){bc(this.eventEmitter,"cell.click",e,i.x,i.y)},this)},Tc=function(t){if(!t.isDown){var e=this.childrenMap.child,i=e.pointerToCellIndex(t.x,t.y);if(i!==this._lastOverCellIndex){var r=this._lastOverCellIndex;this._lastOverCellIndex=i,bc(this.eventEmitter,"cell.out",e,r),bc(this.eventEmitter,"cell.over",e,i)}}},xc=function(){var t=this.childrenMap.child,e=this._lastOverCellIndex;this._lastOverCellIndex=void 0,bc(this.eventEmitter,"cell.out",t,e)},Sc=function(t){t.on("pointermove",Tc,this).on("pointerover",Tc,this).on("pointerup",xc,this).on("pointerout",xc,this)};const Oc=Phaser.Utils.Objects.GetValue;class Cc{constructor(t,e){this.parent=t,this._isRunning=!1,this.tickingState=!1,this.setEventEmitter(Oc(e,"eventEmitter",void 0)),this.setTickingMode(Oc(e,"tickingMode",1))}boot(){2!==this.tickingMode||this.tickingState||this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(t){"string"==typeof t&&(t=Dc[t]),this.tickingMode=t}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking()))}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(){this.isRunning=!1,this.emit("complete",this.parent,this)}}Object.assign(Cc.prototype,gn);const Dc={no:0,lazy:1,always:2};var wc=Cc;const Ac=Phaser.Utils.Objects.GetValue;const Ec=0,Mc=1,Ic="IDLE";var Bc=class extends wc{constructor(t,e){var i=xi(t);i===t&&(t=void 0),super(i,e),this.scene=i,this.gameObject=t,t&&t.setInteractive(Ac(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(Ac(t,"enable",!0)),void 0===this.gameObject?this.bounds=Ac(t,"bounds",void 0):this.bounds=void 0,this.tracerState=Ec,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,this.isTouchingAnyObject=!1,this}boot(){super.boot(),this.gameObject?this.gameObject.on("pointerdown",this.onPointerDown,this):this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.gameObject?this.gameObject.off("pointerdown",this.onPointerDown,this):this.scene&&this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene&&(this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0,this.gameObject=void 0,this.bounds=void 0,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,super.shutdown()}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.dragCancel(),this.enable=t,this)}onPointerDown(t,e){this.enable&&void 0===this.pointer&&(!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer!==t&&(this.pointer=t,this.lastPointer=t,this.movedState=!1,this.tracerState=Mc,void 0===this.gameObject&&(this.isTouchingAnyObject=e.length>0),this.onDragStart())}onPointerUp(t){this.enable&&(!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer===t&&(this.pointer=void 0,this.movedState=!1,this.tracerState=Ec,this.onDragEnd())}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),i=this.pointer===t;!i&&e||(i&&!e?this.onPointerUp(t):(this.movedState||(this.movedState=t.x!==t.downX||t.y!==t.downY),this.movedState&&this.onDrag()))}}dragCancel(){return this.tracerState===Mc&&this.onDragEnd(),this.pointer=void 0,this.tracerState=Ec,this}onDragStart(){this.emit("dragstart",this)}onDragEnd(){this.emit("dragend",this)}onDrag(){this.emit("drag",this)}preUpdate(t,e){}postUpdate(t,e){}startTicking(){super.startTicking(),this.scene.events.on("preupdate",this.preUpdate,this),this.scene.events.on("postupdate",this.postUpdate,this)}stopTicking(){super.stopTicking(),this.scene&&(this.scene.events.off("preupdate",this.preUpdate,this),this.scene.events.off("postupdate",this.postUpdate,this))}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=Ic,this}};const kc=Phaser.Utils.Objects.GetValue,Rc=Phaser.Math.Distance.Between;const Nc="IDLE",jc="BEGIN",Lc="RECOGNIZED";var Fc=class extends Bc{constructor(t,e){super(t,e);var i=this,r={states:{IDLE:{enter:function(){i.stop(),i.tapsCount=0,i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start(),i.tapsCount=0,i.emit("tappingstart",i,i.gameObject,i.lastPointer)}},RECOGNIZED:{enter:function(){i.start(),i.emit("tap",i,i.gameObject,i.lastPointer),i.emit(`${i.tapsCount}tap`,i,i.gameObject,i.lastPointer)}}},init:function(){this.state=Nc},eventEmitter:!1};this.setRecongizedStateObject(new bn(r))}resetFromJSON(t){super.resetFromJSON(t),this.setMaxHoldTime(kc(t,"time",250)),this.setTapInterval(kc(t,"tapInterval",200)),this.setDragThreshold(kc(t,"threshold",9)),this.setTapOffset(kc(t,"tapOffset",10));var e=kc(t,"taps",void 0);return void 0!==e?this.setTaps(e):(this.setMaxTaps(kc(t,"maxTaps",void 0)),this.setMinTaps(kc(t,"minTaps",void 0))),this}onDragStart(){switch(this.state){case Nc:this.state=jc;break;case jc:var t=this.lastPointer;Rc(t.upX,t.upY,t.x,t.y)>this.tapOffset&&(this.state=Lc,this.state=jc);break;case Lc:this.state=jc}}onDragEnd(){this.state===jc&&(this.tapsCount++,this.emit("tapping",this,this.gameObject,this.lastPointer),void 0!==this.maxTaps&&this.tapsCount===this.maxTaps&&(this.state=Lc))}onDrag(){this.state!==Nc&&this.pointer.getDistance()>this.dragThreshold&&(this.state=Nc)}preUpdate(t,e){if(this.state===jc){var i=this.lastPointer;i.isDown?t-i.downTime>this.holdTime&&(this.state=Nc):t-i.upTime>this.tapInterval&&(void 0===this.minTaps||this.tapsCount>=this.minTaps?this.state=Lc:this.state=Nc)}}postUpdate(t,e){this.state===Lc&&(this.state=Nc)}get isTapped(){return this.state===Lc}setMaxHoldTime(t){return this.holdTime=t,this}setTapInterval(t){return this.tapInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setTapOffset(t){return this.tapOffset=t,this}setMaxTaps(t){return this.maxTaps=t,this}setMinTaps(t){return this.minTaps=t,this}setTaps(t,e){return void 0===e&&(e=t),this.setMinTaps(t).setMaxTaps(e),this}},zc=function(t){t._tap=new Fc(t),t._tap.on("tap",function(t){var e=`cell.${t.tapsCount}tap`;bc(this.eventEmitter,e,t.gameObject,t.x,t.y)},this)};const Vc=Phaser.Utils.Objects.GetValue;const Hc="IDLE",Yc="BEGIN",Gc="RECOGNIZED";var Uc=class extends Bc{constructor(t,e){super(t,e);var i=this,r={states:{IDLE:{enter:function(){i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start()},exit:function(){i.stop()}},RECOGNIZED:{enter:function(){i.emit("pressstart",i,i.gameObject,i.lastPointer)},exit:function(){i.emit("pressend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=Hc},eventEmitter:!1};this.setRecongizedStateObject(new bn(r))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Vc(t,"threshold",9)),this.setMinHoldTime(Vc(t,"time",251)),this}onDragStart(){this.state=0===this.holdTime?Gc:Yc}onDragEnd(){this.state=Hc}onDrag(){this.state!==Hc&&this.pointer.getDistance()>this.dragThreshold&&(this.state=Hc)}preUpdate(t,e){this.state===Yc&&t-this.pointer.downTime>=this.holdTime&&(this.state=Gc)}get isPressed(){return this.state===Gc}setDragThreshold(t){return this.dragThreshold=t,this}setMinHoldTime(t){return this.holdTime=t,this}},Wc=function(t){t._press=new Uc(t),t._press.on("pressstart",function(t){var e=t.gameObject,i=e.pointerToCellIndex(t.x,t.y);t._cellIndex=i,bc(this.eventEmitter,"cell.pressstart",e,i)},this).on("pressend",function(t){var e=t.gameObject,i=t._cellIndex;t._cellIndex=void 0,bc(this.eventEmitter,"cell.pressend",e,i)},this)},Xc=function(t){t.setInteractive(),Pc.call(this,t),Sc.call(this,t),zc.call(this,t),Wc.call(this,t)},Kc=function(t){void 0===t?this.items.length=0:this.items=t;var e=this.childrenMap.child;return e.setCellsCount(this.items.length),e.updateTable(!0),this.resizeController(),this};const Jc=Phaser.Utils.Objects.GetValue;class Zc extends Nn{constructor(t,e){void 0===e&&(e={});var i=kr(e),r=Jc(e,"table",void 0);void 0===r&&(r={}),r.scrollMode=i,r.clamplTableOXY=Jc(e,"clamplChildOY",!1);var n,s,a=Jc(r,"width",void 0),o=Jc(r,"height",void 0),h=new _c(t,0,0,a,o,r);0===i?(n=void 0===a?1:0,s=void 0===o):(n=void 0===o?1:0,s=void 0===a),yc(h),e.type="rexGridTable",e.child={gameObject:h,proportion:n,expand:s};var l=Jc(e,"space",void 0);l&&(l.child=l.table),super(t,e),this.addChildrenMap("table",h),this.eventEmitter=Jc(e,"eventEmitter",this);var c=Jc(e,"createCellContainerCallback",Me),u=Jc(e,"createCellContainerCallbackScope",void 0);this.setCreateCellContainerCallback(c,u),vc.call(this,h),Jc(r,"interactive",!0)&&Xc.call(this,h),this.setItems(Jc(e,"items",[]))}setCreateCellContainerCallback(t,e){return this.createCellContainerCallback=t,this.createCellContainerCallbackScope=e,this}refresh(){return this.childrenMap.child.updateTable(!0),this}}var qc={setItems:Kc};Object.assign(Zc.prototype,qc);var $c=Zc;Xo.register("gridTable",function(t){var e=new $c(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.GridTable",$c);var Qc={expandSubMenu:function(t,e){this.collapseSubMenu();var i=new this.constructor(this.scene,{items:e,orientation:this.orientation,createButtonCallback:this.root.createButtonCallback,createButtonCallbackScope:this.root.createButtonCallbackScope,easeIn:this.root.easeIn,easeOut:this.root.easeOut,root:this.root,parent:t});return this.add(i,null),this.childrenMap.subMenu=i,this},collapse:function(){return this.root.easeOut?this.scaleDownDestroy(this.root.easeOut):this.destroy(),this.collapseSubMenu(),this},collapseSubMenu:function(){if(void 0===this.childrenMap.subMenu)return this;var t=this.childrenMap.subMenu;return this.childrenMap.subMenu=void 0,this.remove(t),t.collapse(),this}},tu=function(t,e,i,r){var n,s,a=[];if(e&&i)for(var o=0,h=e.length;o<h;o++)(n=e[o]).scene=t,s=r?i.call(r,n,o):i(n,o),n.scene=void 0,a.push(s);return a},eu=function(t){t.on(t.root.expandEventName,function(t,e){if(!this.isPassedEvent){var i=this.items[e].children;i&&this.expandSubMenu(t,i)}},t).on("button.click",function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.click",t,e),this.root.isPassedEvent=!1)},t).on("button.over",function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.over",t,e),this.root.isPassedEvent=!1)},t).on("button.out",function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.out",t,e),this.root.isPassedEvent=!1)},t)};const iu=Phaser.Utils.Objects.GetValue;class ru extends zl{constructor(t,e){void 0===e&&(e={}),e.hasOwnProperty("orientation")||(e.orientation=1);var i=iu(e,"items",void 0),r=iu(e,"createButtonCallback",void 0),n=iu(e,"createButtonCallbackScope",void 0);if(e.buttons=tu(t,i,r,n),super(t,e),this.type="rexMenu",this.items=i,this.root=iu(e,"root",this),this.root===this){if(this.expandEventName=iu(e,"expandEvent","button.click"),this.easeIn=iu(e,"easeIn",void 0),this.easeOut=iu(e,"easeOut",void 0),this.bounds=iu(e,"bounds",void 0),this.expandOrientation=iu(e,"expandOrientation",void 0),void 0===this.expandOrientation){var s=this.bounds;void 0===s&&(s=si(t)),0===this.orientation?this.expandOrientation=this.y<s.centerY?1:3:this.expandOrientation=this.x<s.centerX?0:2}this.createButtonCallback=r,this.createButtonCallbackScope=n,this.isPassedEvent=!1}this.setOrigin(0).layout();var a=iu(e,"parent",void 0);if(a)switch(this.root.expandOrientation){case 0:this.alignTop(a.top).alignLeft(a.right);break;case 1:this.alignLeft(a.left).alignTop(a.bottom);break;case 2:this.alignTop(a.top).alignRight(a.left);break;case 3:this.alignLeft(a.left).alignBottom(a.top)}this.pushIntoBounds(this.root.bounds),eu(this),this.root.easeIn&&this.popUp(this.root.easeIn)}isInTouching(t){return!!super.isInTouching(t)||!!this.childrenMap.subMenu&&this.childrenMap.subMenu.isInTouching(t)}}Object.assign(ru.prototype,Qc);var nu=ru;Xo.register("menu",function(t){var e=new nu(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.Menu",nu);const su=Phaser.Utils.Objects.GetValue,au=Phaser.Math.Clamp;var ou=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t},hu=class{constructor(t,e){this.gameObject=t,this.scene=xi(t),this.setTextObjectType(),this.lines=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setText(su(t,"text","")),this.setStartIdx(su(t,"start",0)),this.setPageIdx(su(t,"page",-1)),this}toJSON(){return{text:this.text,start:this.startLineIdx,page:this.pageIndex,pageCount:this.pageCount}}boot(){this.gameObject.once("destroy",this.destroy,this)}shutdown(){return void 0===this.lines||(0===this.textObjectType?this.lines.length=0:this.lines.destroy()),this.gameObject=void 0,this.scene=void 0,this}destroy(){this.shutdown()}setTextObjectType(){return this.textObjectType=Ln(this.gameObject)?0:1,this}get isFirstPage(){return this.pageIndex<=0}get isLastPage(){return this.pageIndex>=this.pageCount-1}setText(t,e){return void 0===e&&(e=!0),this.text=ou(t),0===this.textObjectType?this.lines=this.gameObject.getWrappedText(this.text):this.lines=this.gameObject.getPenManager(this.text,this.lines),this.pageCount=Math.ceil(this.totalLinesCount/this.pageLinesCount),e&&this.resetPageIdx(),this}appendText(t){return this.setText(this.text.concat(ou(t))),this}getPage(t){return void 0===t&&(t=this.pageIndex),this.setPageIdx(t).getLines()}getNextPage(){return this.getPage(this.pageIndex+1)}getPreviousPage(){return this.getPage(this.pageIndex-1)}showPage(t){return this.displayText(this.getPage()),this}showNextPage(){return this.displayText(this.getNextPage()),this}showPreviousPage(){return this.displayText(this.getPreviousPage()),this}show(){return this.displayText(this.getLines()),this}showNextLine(){return this.displayText(this.setStartIdx(this.startLineIdx+1).getLines()),this}showPreviousLine(){return this.displayText(this.setStartIdx(this.startLineIdx-1).getLines()),this}setStartIdx(t){return t=au(t,0,this.totalLinesCount-1),this.startLineIdx=t,this}resetPageIdx(){this.pageIndex=-1}setPageIdx(t){return t=au(t,0,this.pageCount-1),this.pageIndex=t,this.setStartIdx(this.pageIndex*this.pageLinesCount),this}get totalLinesCount(){return 0===this.textObjectType?this.lines.length:this.lines.linesCount}get pageLinesCount(){var t=this.gameObject.style.maxLines;return t>0?t:this.totalLinesCount}getLines(t){void 0===t&&(t=this.startLineIdx);var e,i=t+this.pageLinesCount;if(0===this.textObjectType)e=this.lines.slice(t,i).join("\n");else{var r=this.lines.getLineStartIndex(t),n=this.lines.getLineEndIndex(i-1);e=this.lines.getSliceTagText(r,n,!0)}return e}displayText(t){this.gameObject.setText(t)}};const lu=Phaser.Events.EventEmitter,cu=Phaser.Utils.Objects.GetFastValue,uu=Phaser.Utils.Objects.GetValue;var pu=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t};const du={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var fu=class extends lu{constructor(t,e){super(),this.gameObject=t,this.scene=xi(t),this.timer=null,this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setTypeMode(uu(t,"typeMode",0)),this.setTypeSpeed(uu(t,"speed",333)),this.setTextCallback=cu(t,"setTextCallback",null),this.setTextCallbackScope=cu(t,"setTextCallbackScope",null),this.typingIdx=cu(t,"typingIdx",0),this.text=pu(cu(t,"text","")),this.textLen=cu(t,"textLen",0),this.insertIdx=cu(t,"insertIdx",null);var e=cu(t,"elapsed",null);return null!==e&&this.start(void 0,void 0,this.typingIdx,e),this}toJSON(){var t,e=this.getTimer();return t=e?e.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:t}}boot(){return this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return super.shutdown(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(t){return"string"==typeof t&&(t=du[t]),this.typeMode=t,this}setTypeSpeed(t){return this.speed=t,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(t,e,i,r){return void 0!==t&&this.setTypingContent(t),void 0!==e&&(this.speed=e),void 0===i&&(i=0),this.typingIdx=i+1,0===this.speed?this.stop(!0):this.startTimer(r),this}appendText(t){var e=this.text.concat(pu(t));return this.isTyping?this.setTypingContent(e):this.start(e,void 0,this.textLen),this}stop(t){return this.getTimer()&&this.freeTimer(),t&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var t=this.getTimer();return t&&(t.paused=!0),this}resume(){var t=this.getTimer();return t&&(t.paused=!1),this}setTypingContent(t){return this.text=pu(t),this.textLen=this.getTextLength(this.text),this}onTyping(){var t=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(t),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(t,e,i,r){var n;if(0===r){var s=0,a=e;this.insertIdx=a,n=this.getSubString(t,s,a)}else if(1===r)s=(a=i)-e,this.insertIdx=0,n=this.getSubString(t,s,a);else if(2===r){var o=i/2;a=(s=Math.floor(o-e/2))+e,this.insertIdx=e%2?e:0,n=this.getSubString(t,s,a)}else if(3===r){var h,l=Math.floor(e/2);l>0?(s=(a=i)-l,h=this.getSubString(t,s,a)):h="";var c,u=e-l;u>0?(a=(s=0)+u,this.insertIdx=a,c=this.getSubString(t,s,a)):(c="",this.insertIdx=0),n=c+h}return n}startTimer(t){var e;return this.timer&&this.freeTimer(),void 0===t?e=0:(this.speed,e=t),this.timer=this.scene.time.addEvent({delay:0,startAt:e,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(t){this.setTextCallback&&(t=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,t,this.isLastChar,this.insertIdx):this.setTextCallback(t,this.isLastChar,this.insertIdx)),this.gameObject.setText(t)}getTextLength(t){var e=this.gameObject;return e.getPlainText?e.getPlainText(t).length:t.length}getSubString(t,e,i){var r=this.gameObject;return r.getSubString?r.getSubString(t,e,i):t.slice(e,i)}};const mu=Phaser.Utils.Objects.GetValue;var gu=function(t){return t.add.text(0,0,"",{wordWrap:{width:200},maxLines:5})},_u=class extends Al{constructor(t,e){void 0===e&&(e={text:gu(t)}),super(t,e),this.type="rexTextBox";var i=this.childrenMap.text;this.page=new hu(i,mu(e,"page",void 0)),this.typing=new fu(i,mu(e,"type",void 0)),this.typing.on("complete",this.onPageEnd,this).on("type",this.onType,this),this.textWidth=i.width,this.textHeight=i.height}start(t,e){return this.page.setText(t),void 0!==e&&this.typing.setTypeSpeed(e),this.typeNextPage(),this}typeNextPage(){if(this.page.isLastPage)this.emit("complete");else{var t=this.page.getNextPage();this.typing.start(t)}return this}pause(){return this.typing.pause(),this}resume(){return this.typing.resume(),this}stop(t){return this.typing.stop(t),this}get isTyping(){return this.typing.isTyping}get isLastPage(){return this.page.isLastPage}get isFirstPage(){return this.page.isFirstPage}get pageCount(){return this.page.pageCount}get pageIndex(){return this.page.pageIndex}onType(){var t=this.childrenMap.text;this.textWidth===t.width&&this.textHeight===t.height||(this.textWidth=t.width,this.textHeight=t.height,this.getTopmostSizer().layout()),this.emit("type")}onPageEnd(){this.emit("pageend")}};Xo.register("textBox",function(t){var e=new _u(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.TextBox",_u);const yu=Phaser.Utils.Objects.GetValue,vu=Phaser.Math.Percent,bu=Phaser.Math.Linear;var Pu=class extends Mr{constructor(t,e){super(t,e),this.type="rexNumberBar";var i,r,n,s=yu(e,"background",void 0),a=yu(e,"icon",void 0),o=yu(e,"iconMask",void 0),h=yu(e,"slider",void 0),l=yu(e,"text",void 0),c=yu(e,"space.left",0),u=yu(e,"space.right",0),p=yu(e,"space.top",0),d=yu(e,"space.bottom",0),f=yu(e,"space.icon",0),m=yu(e,"space.slider",0);(s&&this.addBackground(s),a&&(r=0===this.orientation?{left:c,right:h||l?f:u,top:p,bottom:d}:{left:c,right:u,top:p,bottom:h||l?f:d},this.add(a,0,"center",r),o&&(o=new Vn(a,1),a.setMask(o.createGeometryMask()),this.add(o,null))),h)&&(h.orientation=0==this.orientation?1:0,h.eventEmitter=this,h.value=null,h.hasOwnProperty("input")||(h.input=-1),i=new mn(t,h),r=0===this.orientation?{left:a?0:c,right:l?m:u,top:p,bottom:d}:{left:c,right:u,top:a?0:p,bottom:l?m:d},n=0===this.orientation?void 0===yu(h,"width",void 0)?1:0:void 0===yu(h,"height",void 0)?1:0,this.add(i,n,"center",r));l&&(r=0===this.orientation?{left:a||h?0:c,right:u,top:p,bottom:d}:{left:c,right:u,top:a||h?0:p,bottom:d},this.add(l,0,"center",r)),this.addChildrenMap("background",s),this.addChildrenMap("icon",a),this.addChildrenMap("slider",i),this.addChildrenMap("text",l);var g=yu(e,"valuechangeCallback",null);if(null!==g){var _=yu(e,"valuechangeCallbackScope",void 0);this.on("valuechange",g,_)}this.setEnable(yu(e,"enable",void 0)),this.setValue(yu(e,"value",0))}setEnable(t){return this.childrenMap.slider?this:(void 0===t&&(t=!0),this.childrenMap.slider.enable=t,this)}get value(){return this.childrenMap.slider?this.childrenMap.slider.value:0}set value(t){this.childrenMap.slider&&(this.childrenMap.slider.value=t)}setValue(t,e,i){return void 0!==e&&(t=vu(t,e,i)),this.value=t,this}addValue(t,e,i){return void 0!==e&&(t=vu(t,e,i)),this.value+=t,this}getValue(t,e){var i=this.value;return void 0!==t&&(i=bu(t,e,i)),i}get text(){var t=this.childrenMap.text;return void 0===t?"":t.text?t.text:t.getData("text")}set text(t){var e=this.childrenMap.text;void 0!==e&&(e.setText?e.setText(t):e.setData("text",t))}setText(t){return this.text=t,this}};Xo.register("numberBar",function(t){var e=new Pu(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.NumberBar",Pu);const Tu=Phaser.Utils.Objects.IsPlainObject,xu=Phaser.Display.Align.TOP_LEFT;var Su=function(t,e,i,r,n){if(Tu(e)){var s=e;e=GetValue(s,"key",0),i=GetValue(s,"align",xu),r=GetValue(s,"padding",0),n=GetValue(s,"expand",!1)}return"string"==typeof i&&(i=Sr[i]),void 0===i&&(i=ALIGN_CENTER),void 0===r&&(r=0),void 0===n&&(n=!0),(s=this.getSizerConfig(t)).parent=this,s.align=i,s.padding=Pr(r),s.expand=n,this.sizerChildren.has(e)&&this.sizerChildren.get(e).destroy(),this.sizerChildren.set(e,t),t.setVisible(!1),this.add(t),this},Ou=function(t){return void 0===t?null:this.sizerChildren.has(t)?this.sizerChildren.get(t):null},Cu=function(t){this._previousKey=this._currentKey;var e=this.previousPage;e&&(0===this.swapMode?(e.setVisible(!1),this.resetChildVisibleState(e),this.emit("pageinvisible",e,this._previousKey,this)):e.destroy()),t&&!this.sizerChildren.has(t)&&this.emit("createpage",t,this),this._currentKey=t;var i=this.currentPage;return i&&(i.setVisible(!0),this.resetChildVisibleState(i),this.emit("pagevisible",i,this._currentKey,this)),this},Du=function(){if(this.rexSizer.hidden)return 0;var t,e,i,r=0,n=this.sizerChildren.entries;for(var s in n)i=(t=n[s]).isRexSizer?Math.max(t.minWidth,t.childrenWidth):t.width,i+=(e=t.rexSizer.padding).left+e.right,r=Math.max(i,r);return r},wu=function(){if(this.rexSizer.hidden)return 0;var t,e,i,r=0,n=this.sizerChildren.entries;for(var s in n)i=(t=n[s]).isRexSizer?Math.max(t.minHeight,t.childrenHeight):t.height,i+=(e=t.rexSizer.padding).top+e.bottom,r=Math.max(i,r);return r},Au=function(t){void 0===t&&(t=[]);var e,i=this.sizerChildren.entries;for(var r in i)(e=i[r]).isRexSizer&&t.push(e);return t},Eu=function(t,e){var i,r=e.rexSizer,n=r.padding;return r.expand&&(i=t.width-n.left-n.right),i},Mu=function(t,e){var i,r=e.rexSizer,n=r.padding;return r.expand&&(i=t.height-n.top-n.bottom),i};const Iu=Phaser.Display.Align.In.QuickSet;var Bu={addPage:Su,getPage:Ou,swapPage:Cu,getChildrenWidth:Du,getChildrenHeight:wu,getChildrenSizers:Au,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var r,n,s;this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i);var a,o,h,l,c,u,p=this.left,d=this.top,f=this.pages;for(var m in f)s=(n=(r=f[m]).rexSizer).padding,r.isRexSizer?r.layout(this,Eu(this,r),Mu(this,r)):(c=void 0,u=void 0,n.expand&&(u=this.height-s.top-s.bottom,c=this.width-s.left-s.right),qi(r,c,u)),a=p+s.left,h=this.width-s.left-s.right,o=d+s.top,l=this.height-s.top-s.bottom,Qi.setPosition(a,o).setSize(h,l),Iu(r,Qi,n.align),this.resetChildPositionState(r);return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0}};const ku=Phaser.Utils.Objects.IsPlainObject,Ru=Phaser.Utils.Objects.GetValue,Nu=Phaser.Structs.Map;class ju extends ur{constructor(t,e,i,r,n,s){ku(e)?(e=Ru(s=e,"x",0),i=Ru(s,"y",0),r=Ru(s,"width",void 0),n=Ru(s,"height",void 0)):ku(r)&&(r=Ru(s=r,"width",void 0),n=Ru(s,"height",void 0)),super(t,e,i,r,n,s),this.type="rexPages",this._previousKey=void 0,this._currentKey=void 0,this.sizerChildren=new Nu,this.setSwapMode(Ru(s,"swapMode",0)),this.addChildrenMap("pages",this.pages)}destroy(t){this.scene&&(this.sizerChildren.clear(),super.destroy(t))}setSwapMode(t){return"string"==typeof t&&(t=Lu[t]),this.swapMode=t,this}get previousKey(){return this._previousKey}get currentKey(){return this._currentKey}set currentKey(t){this.swapPage(t)}get currentPage(){return this.getPage(this.currentKey)}get previousPage(){return this.getPage(this.previousKey)}get keys(){return this.sizerChildren.keys()}get pages(){return this.sizerChildren.entries}}Object.assign(ju.prototype,Bu);const Lu={invisible:0,destroy:1};var Fu=ju;Xo.register("pages",function(t,e,i,r,n){var s=new Fu(this.scene,t,e,i,r,n);return this.scene.add.existing(s),s}),wo(window,"RexPlugins.UI.Pages",Fu);Xo.register("textBlock",function(t,e,i,r,n,s){var a=new rs(this.scene,t,e,i,r,n,s);return this.scene.add.existing(a),a}),wo(window,"RexPlugins.UI.TextBlock",rs);Xo.register("textArea",function(t){var e=new cs(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.TextArea",cs);const zu=Phaser.Utils.Objects.GetValue,Vu=Phaser.Display.Align.TOP_LEFT;var Hu={setChild:function(t,e,i){t.setOrigin&&t.setOrigin(0),this.add(t);var r,n,s=this.getSizerConfig(t);if(s.parent=this,s.align=Vu,s.expand=e,this.child=t,!0===i?(r=!0,n=0):!1===i?r=!1:(r=zu(i,"mask",!0),n=zu(i,"padding",0)),r){var a=new Vn(this,0,n);this.childMask=a.createGeometryMask(),this.add(a)}return this},getChildrenWidth:function(){if(this.rexSizer.hidden)return 0;var t=this.child;return t.rexSizer.hidden?0:0===this.scrollMode?t.isRexSizer?Math.max(t.minWidth,t.childrenWidth):t.width:0},getChildrenHeight:function(){if(this.rexSizer.hidden)return 0;var t=this.child;return t.rexSizer.hidden?0:0===this.scrollMode?0:t.isRexSizer?Math.max(t.minHeight,t.childrenHeight):t.height},resetChildPosition:function(){var t=this.left,e=this.top;0===this.scrollMode?e+=this.childOY:t+=this.childOY,this.child.setPosition(t,e),lc(this,this.childMask,this.child.getAllChildren()),this.resetChildPositionState(this.child)},layout:function(t,e,i){if(this.rexSizer.hidden)return this;this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i);var r,n,s=this.child;if(!s.rexSizer.hidden&&(0===this.scrollMode?r=this.width:n=this.height,s.isRexSizer?s.layout(this,r,n):qi(s,r,n),this.resetChildPosition(),this.childMask)){var a=ic(this.childMask);a.setPosition().resize(),this.resetChildPositionState(a)}return this}};const Yu=Phaser.Utils.Objects.IsPlainObject,Gu=Phaser.Utils.Objects.GetValue;class Uu extends ur{constructor(t,e,i,r,n,s){Yu(e)?(e=Gu(s=e,"x",0),i=Gu(s,"y",0),r=Gu(s,"width",void 0),n=Gu(s,"height",void 0)):Yu(r)&&(r=Gu(s=r,"width",void 0),n=Gu(s,"height",void 0)),super(t,e,i,r,n,s),this.type="rexScrollableBlock",this.child=void 0,this.childMask=void 0,this._childOY=0,this.execeedTopState=!1,this.execeedBottomState=!1,this.setScrollMode(Gu(s,"scrollMode",!0)),this.setClampMode(Gu(s,"clamplChildOY",!0));var a=Gu(s,"child",void 0),o=Gu(s,"expand",!0),h=Gu(s,"mask",void 0);this.setChild(a,o,h)}destroy(t){this.scene&&(this.child=void 0,this.childMask&&(this.childMask.destroy(),this.childMask=void 0),super.destroy(t))}setScrollMode(t){return"string"==typeof t&&(t=Ir[t.toLowerCase()]),this.scrollMode=t,this}setClampMode(t){return this.clampChildOYMode=t,this}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get childHeight(){return 0===this.scrollMode?this.child.height:this.child.width}get childWidth(){return 0===this.scrollMode?this.child.width:this.child.height}get topChildOY(){return 0}get bottomChildOY(){return-this.visibleHeight}get visibleHeight(){var t=this.childHeight,e=this.instHeight;return t>e?t-e:0}childOYExceedTop(t){return void 0===t&&(t=this.childOY),t>this.topChildOY}childOYExeceedBottom(t){return void 0===t&&(t=this.childOY),t<this.bottomChildOY}get childOY(){return this._childOY}set childOY(t){var e=this.topChildOY,i=this.bottomChildOY,r=this.childOYExceedTop(t),n=this.childOYExeceedBottom(t);this.clampChildOYMode&&(this.instHeight>this.childHeight?t=0:r?t=e:n&&(t=i)),this._childOY!==t&&(this._childOY=t,this.resetChildPosition()),r&&(this.execeedTopState||this.emit("execeedtop",this,t,e)),this.execeedTopState=r,n&&(this.execeedBottomState||this.emit("execeedbottom",this,t,i)),this.execeedBottomState=n}setChildOY(t){return this.childOY=t,this}set t(t){this.childOY=-this.visibleHeight*t}get t(){var t=this.visibleHeight;return 0===t?0:this.childOY/-t}setChildOYByPercentage(t){return this.t=t,this}}Object.assign(Uu.prototype,Hu);var Wu=Uu;Xo.register("scrollableBlock",function(t){var e=new Wu(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.ScrollableBlock",Wu);const Xu=Phaser.Utils.Objects.GetValue;var Ku=class extends Nn{constructor(t,e){void 0===e&&(e={});var i=kr(e),r=Xu(e,"panel",void 0);void 0===r&&(r={}),r.scrollMode=i,r.clamplChildOY=Xu(e,"clamplChildOY",!1);var n,s,a=new Wu(t,r),o=Xu(r,"width",void 0),h=Xu(r,"height",void 0);0===i?(n=void 0===o?1:0,s=void 0===h):(n=void 0===h?1:0,s=void 0===o),e.type="rexScrollablePanel",e.child={gameObject:a,proportion:n,expand:s};var l=Xu(e,"space",void 0);l&&(l.child=l.panel),super(t,e),this.addChildrenMap("panel",this.childrenMap.child.child)}};Xo.register("scrollablePanel",function(t){var e=new Ku(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.ScrollablePanel",Ku);var Ju={popUp:0,fadeIn:1,scaleDown:0,fadeOut:1},Zu={popUp:function(t,e){t.popUp(e)},scaleDown:function(t,e){t.scaleDownDestroy(e,void 0,void 0,!1)},fadeIn:function(t,e){t.fadeIn(e)},fadeOut:function(t,e){t.fadeOut(e,!1)}},qu=function(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=e.length),t.length=r-i;for(var n=0,s=t.length;n<s;n++)t[n]=e[n+i];return t},$u=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,Qu=function(t){return"string"!=typeof t?t:(""===t?t=null:$u.test(t)?t=parseFloat(t):"false"===screen?t=!1:"true"===t&&(t=!0),t)},tp=function(t){return"[object Array]"===Object.prototype.toString.call(t)};const ep=Phaser.Utils.Objects.GetValue;var ip=function(t,e,i){var r,n=ep(i,"reverse",!1);if(tp(t[0]))if(n)for(s=(a=t.length)-1;s>=0;s--)r=ip(t[s],e,i);else for(var s=0,a=t.length;s<a;s++)r=ip(t[s],e,i);else r=rp(t,e,i);return r},rp=function(t,e,i){var r,n=ep(i,"argsConvert",void 0),s=ep(i,"argsConvertScope",void 0),a=t[0];if(np=qu(np,t,1),n){!0===n&&(n=Qu,s=void 0);for(var o=0,h=np.length;o<h;o++)np[o]=s?n.call(s,np[o],t):n(np[o],t)}return"string"==typeof a?null==(r=e[a])&&(r=ep(e,a,null)):r=a,r.apply(e,np)},np=[],sp=ip,ap=function(t){return Ti(t)?t.events:t.on?t:void 0};var op=[];const hp={ms:0,s:1,sec:1},lp={abs:0,absolute:0,inc:1,increment:1};var cp=class extends wc{constructor(t,e){super(t,e),this.parent=t,this.scene=xi(t),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.isRunning=yn()(t,"isRunning",!1),this.state=yn()(t,"state",0),this.commands=yn()(t,"commands",[]),this.scope=yn()(t,"scope",void 0),this.setTimeUnit(yn()(t,"timeUnit",0)),this.setDtMode(yn()(t,"dtMode",0)),this.setTimeScale(yn()(t,"timeScale",1)),this.index=yn()(t,"index",0),this.nextDt=yn()(t,"nextDt",0),this.seek(yn()(t,"now",0)),this.timeScale=yn()(t,"timeScale",1),this}toJSON(){return{isRunning:this.isRunning,state:this.state,commands:this.commands,scope:this.scope,timeUnit:this.timeUnit,dtMode:this.dtMode,index:this.index,nextDt:this.nextDt,now:this.now,timeScale:this.timeScale,tickingMode:this.tickingMode}}boot(){super.boot();var t=ap(this.parent);t&&t.once("destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.scene=void 0,this.commands=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),this.scene.events.on("update",this.update,this)}stopTicking(){super.stopTicking(),this.scene&&this.scene.events.off("update",this.update,this)}load(t,e,i){this.stop();var r=yn()(i,"timeUnit",void 0);void 0!==r&&this.setTimeUnit(r);var n=yn()(i,"dtMode",void 0);return void 0!==n&&this.setDtMode(n),t=t.filter(function(t){var e=t[0];return!isNaN(e)}).map(function(t){return"string"==typeof t[0]&&(t[0]=parseFloat(t[0])),t}),0===this.dtMode&&t.sort(function(t,e){var i=t[0],r=e[0];return i>r?1:i<r?-1:0}),this.commands=t,this.scope=e,this}start(t){return void 0===t&&(t=0),this.stop(),this.index=0,this.isRunning=!0,this.state=1,this.nextDt=this.getNextDt(0),this.seek(t),this.update(),this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this.state=0,this}seek(t){return this.now=t,this}get isPlaying(){return this.isRunning}get completed(){return 2===this.state}setTimeScale(t){this.timeScale=t}update(t,e){if(!this.isRunning)return this;if(void 0!==t){if(0===this.timeScale||0===e)return this;this.now+=e*this.timeScale}if(this.nextDt>this.now)return this;for(;;){var i=this.commands[this.index],r=i[1];if(tp(r)||(r=qu(op,i,1)),sp(r,this.scope),this.emit("runcommand",r,this.scope),this.index===this.commands.length-1)return this.complete(),this;if(this.index++,this.nextDt=this.getNextDt(this.nextDt),this.nextDt>this.now)return this}}complete(){super.complete(),this.state=2}getNextDt(t){var e=this.commands[this.index][0];return 1===this.timeUnit&&(e*=1e3),1===this.dtMode&&(e+=t),e}setDtMode(t){return"string"==typeof t&&(t=lp[t]),this.dtMode=t,this}setTimeUnit(t){return"string"==typeof t&&(t=hp[t]),this.timeUnit=t,this}};const up=Phaser.Utils.Objects.GetValue;var pp=class extends Al{constructor(t,e){void 0===e&&(e={text:createDefaultTextObject(t)}),super(t,e),this.type="rexToast",this.setTransitInTime(up(e,"duration.in",200)),this.setDisplayTime(up(e,"duration.hold",1200)),this.setTransitOutTime(up(e,"duration.out",200)),this.setTransitInCallback(up(e,"transitIn",Ju.popUp)),this.setTransitOutCallback(up(e,"transitOut",Ju.scaleDown)),this.player=new cp(this,{dtMode:1}),this.messages=[],this.setVisible(!1)}destroy(t){this.scene&&(this.player.destroy(),this.player=void 0,this.messages=void 0,super.destroy(t))}setDisplayTime(t){return this.displayTime=t,this}setTransitOutTime(t){return this.transitOutTime=t,this}setTransitInTime(t){return this.transitInTime=t,this}setTransitInCallback(t){switch("string"==typeof t&&(t=Ju[t]),t){case Ju.popUp:t=Zu.popUp;break;case Ju.fadeIn:t=Zu.fadeIn}return this.transitInCallback=t,this}setTransitOutCallback(t){switch("string"==typeof t&&(t=Ju[t]),t){case Ju.scaleDown:t=Zu.scaleDown;break;case Ju.fadeOut:t=Zu.fadeOut}return this.transitOutCallback=t,this}show(t){if(void 0===t){if(0===this.messages.length)return this;t=this.messages.shift()}if(this.player.isPlaying)return this.messages.push(t),this;this.setScale(1,1).setVisible(!0),"string"==typeof t?this.setText(t):t(this),this.layout();var e=[[0,[this.transitInCallback,this,this.transitInTime]],[this.transitInTime,[Me]],[this.displayTime,[this.transitOutCallback,this,this.transitOutTime]],[this.transitOutTime,[this.setVisible,!1]],[30,[Me]]];return this.player.load(e,this).once("complete",function(){this.show()},this).start(),this}};Xo.register("toast",function(t){var e=new pp(this.scene,t);return this.scene.add.existing(e),e}),wo(window,"RexPlugins.UI.Toast",pp);const dp=Phaser.GameObjects.GameObject;var fp=function(t){return t instanceof dp};Xo.register("tap",function(t,e){return fp(t)||(e=t,t=this.scene),new Fc(t,e)}),wo(window,"RexPlugins.UI.Tap",Fc);Xo.register("press",function(t,e){return fp(t)||(e=t,t=this.scene),new Uc(t,e)}),wo(window,"RexPlugins.UI.Press",Uc);const mp=Phaser.Math.Distance.Between,gp=Phaser.Math.Angle.Between;var _p={getDt:function(){return this.scene.sys.game.loop.delta},getVelocity:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return mp(e.x,e.y,t.x,t.y)/(.001*this.getDt())},getVelocityX:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.x-e.x)/(.001*this.getDt())},getVelocityY:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.y-e.y)/(.001*this.getDt())},getVelocityAngle:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return gp(e.x,e.y,t.x,t.y)}},yp={"up&down":0,"left&right":1,"4dir":2,"8dir":3},vp={},bp=function(t,e,i){switch(void 0===i?i={}:!0===i&&(i=vp),i.left=!1,i.right=!1,i.up=!1,i.down=!1,t=(t+360)%360,e){case 0:t<180?i.down=!0:i.up=!0;break;case 1:t>90&&t<=270?i.left=!0:i.right=!0;break;case 2:t>45&&t<=135?i.down=!0:t>135&&t<=225?i.left=!0:t>225&&t<=315?i.up=!0:i.right=!0;break;case 3:t>22.5&&t<=67.5?(i.down=!0,i.right=!0):t>67.5&&t<=112.5?i.down=!0:t>112.5&&t<=157.5?(i.down=!0,i.left=!0):t>157.5&&t<=202.5?i.left=!0:t>202.5&&t<=247.5?(i.left=!0,i.up=!0):t>247.5&&t<=292.5?i.up=!0:t>292.5&&t<=337.5?(i.up=!0,i.right=!0):i.right=!0}return i};const Pp=Phaser.Utils.Objects.GetValue,Tp=Phaser.Math.RadToDeg;class xp extends Bc{constructor(t,e){super(t,e);var i=this,r={states:{IDLE:{},BEGIN:{enter:function(){i.validDrag=!1}},RECOGNIZED:{enter:function(){i.start(),i.updateDirectionStates(),i.emit("swipe",i,i.gameObject,i.lastPointer)},exit:function(){i.stop(),i.clearDirectionStates()}}},init:function(){this.state=Sp},eventEmitter:!1};this.setRecongizedStateObject(new bn(r)),this.clearDirectionStates()}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Pp(t,"threshold",10)),this.setMinDragVelocity(Pp(t,"velocityThreshold",1e3)),this.setDirectionMode(Pp(t,"dir","8dir")),this}onDragStart(){this.state=Op}onDragEnd(){this.state=Sp}onDrag(){this.state===Op&&(this.vaildDrag||(this.vaildDrag=0===this.dragThreshold||this.pointer.getDistance()>=this.dragThreshold),this.vaildDrag&&this.dragVelocity>this.minDragVelocity&&(this.state=Cp))}postUpdate(t,e){this.state===Cp&&(this.state=Sp)}get isSwiped(){return this.state===Cp}get dragVelocity(){var t;switch(this.dirMode){case 0:t=this.getVelocityX();break;case 1:t=this.getVelocityY();break;default:t=this.getVelocity()}return t}setDragThreshold(t){return this.dragThreshold=t,this}setMinDragVelocity(t){return this.minDragVelocity=t,this}setDirectionMode(t){return"string"==typeof t&&(t=yp[t]),this.dirMode=t,this}updateDirectionStates(){var t=Tp(this.getVelocityAngle());return bp(t,this.dirMode,this),this}clearDirectionStates(){return this.left=!1,this.right=!1,this.up=!1,this.down=!1,this}}Object.assign(xp.prototype,_p);const Sp="IDLE",Op="BEGIN",Cp="RECOGNIZED";var Dp=xp;Xo.register("swipe",function(t,e){return fp(t)||(e=t,t=this.scene),new Dp(t,e)}),wo(window,"RexPlugins.UI.Swipe",Dp);const wp=Phaser.Utils.Objects.GetValue;const Ap="IDLE",Ep="BEGIN",Mp="RECOGNIZED";var Ip=class extends Bc{constructor(t,e){super(t,e);var i=this,r={states:{IDLE:{},BEGIN:{enter:function(){var t=i.pointer;i.startX=t.x,i.startY=t.y,i.startWorldX=t.worldX,i.startWorldY=t.worldY}},RECOGNIZED:{enter:function(){i.emit("panstart",i,i.gameObject,i.lastPointer)},exit:function(){var t=i.lastPointer;i.endX=t.x,i.endY=t.y,i.endWorldX=t.worldX,i.endWorldY=t.worldY,i.emit("panend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=Ap},eventEmitter:!1};this.setRecongizedStateObject(new bn(r))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(wp(t,"threshold",10)),this}onDragStart(){this.state=0===this.dragThreshold?Mp:Ep}onDragEnd(){this.state=Ap}onDrag(){switch(this.state){case Ep:this.pointer.getDistance()>=this.dragThreshold&&(this.state=Mp);break;case Mp:var t=this.pointer.position,e=this.pointer.prevPosition;this.dx=t.x-e.x,this.dy=t.y-e.y;var i=this.pointer;self.x=i.x,self.y=i.y,self.worldX=i.worldX,self.worldY=i.worldY,this.emit("pan",this)}}get isPan(){return this.state===Mp}setDragThreshold(t){return this.dragThreshold=t,this}};Xo.register("pan",function(t,e){return fp(t)||(e=t,t=this.scene),new Ip(t,e)}),wo(window,"RexPlugins.UI.Pan",Ip);const Bp=Phaser.Utils.Objects.GetValue,kp=Phaser.Utils.Array.SpliceOne,Rp=Phaser.Math.Distance.Between,Np=Phaser.Math.Angle.Between;class jp{constructor(t,e){var i=t.input.manager.pointersTotal-1;i<2&&t.input.addPointer(2-i),this.scene=t,this.setEventEmitter(Bp(e,"eventEmitter",void 0)),this.pointers=[],this.movedState={},this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(Bp(t,"enable",!0)),this.bounds=Bp(t,"bounds",void 0),this.tracerState=Fp,this.pointers.length=0,Zs(this.movedState),this}boot(){this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointers.length=0,Zs(this.movedState),this.scene&&(this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.dragCancel(),this.enable=t,this)}onPointerDown(t){if(this.enable&&(2!==this.pointers.length&&(!this.bounds||this.bounds.contains(t.x,t.y))&&-1===this.pointers.indexOf(t)))switch(this.movedState[t.id]=!1,this.pointers.push(t),this.tracerState){case Fp:this.tracerState=zp,this.onDrag1Start();break;case zp:this.tracerState=Vp,this.onDrag2Start()}}onPointerUp(t){if(this.enable&&(!this.bounds||this.bounds.contains(t.x,t.y))){var e=this.pointers.indexOf(t);if(-1!==e)switch(delete this.movedState[t.id],kp(this.pointers,e),this.tracerState){case zp:this.tracerState=Fp,this.onDrag1End();break;case Vp:this.tracerState=zp,this.onDrag2End(),this.onDrag1Start()}}}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),i=-1!==this.pointers.indexOf(t);if(!i&&e);else if(i&&!e)this.onPointerUp(t);else if(this.movedState[t.id]||(this.movedState[t.id]=t.x!==t.downX||t.y!==t.downY),this.movedState[t.id])switch(this.tracerState){case zp:this.onDrag1();break;case Vp:this.onDrag2()}}}dragCancel(){return this.tracerState===Vp&&this.onDrag2End(),this.pointers.length=0,Zs(this.movedState),this.tracerState=Fp,this}onDrag1Start(){this.emit("drag1start",this)}onDrag1End(){this.emit("drag1end",this)}onDrag1(){this.emit("drag1",this)}onDrag2Start(){this.emit("drag2start",this)}onDrag2End(){this.emit("drag2end",this)}onDrag2(){this.emit("drag2",this)}get distanceBetween(){if(this.tracerState!==Vp)return 0;var t=this.pointers[0],e=this.pointers[1];return Rp(t.x,t.y,e.x,e.y)}get angleBetween(){if(this.tracerState!==Vp)return 0;var t=this.pointers[0],e=this.pointers[1];return Np(t.x,t.y,e.x,e.y)}get drag1Vector(){var t=this.pointers[0];if(t&&this.movedState[t.id]){var e=t.position,i=t.prevPosition;Lp.x=e.x-i.x,Lp.y=e.y-i.y}else Lp.x=0,Lp.y=0;return Lp}get centerX(){if(this.tracerState!==Vp)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.x+e.x)/2}get centerY(){if(this.tracerState!==Vp)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.y+e.y)/2}get prevCenterX(){if(this.tracerState!==Vp)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.x+e.x)/2}get prevCenterY(){if(this.tracerState!==Vp)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.y+e.y)/2}get movementCenterX(){return this.centerX-this.prevCenterX}get movementCenterY(){return this.centerY-this.prevCenterY}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=Hp,this}}Object.assign(jp.prototype,gn);var Lp={};const Fp=0,zp=1,Vp=2,Hp="IDLE";var Yp=jp;const Gp=Phaser.Utils.Objects.GetValue;const Up="IDLE",Wp="BEGIN",Xp="RECOGNIZED";var Kp=class extends Yp{constructor(t,e){super(t,e);var i=this,r={states:{IDLE:{enter:function(){i.prevDistance=void 0,i.scaleFactor=1}},BEGIN:{},RECOGNIZED:{enter:function(){i.emit("pinchstart",i)},exit:function(){i.emit("pinchend",i)}}},init:function(){this.state=Up},eventEmitter:!1};this.setRecongizedStateObject(new bn(r))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Gp(t,"threshold",0)),this}onDrag2Start(){this.scaleFactor=1,this.prevDistance=this.distanceBetween,this.state=0===this.dragThreshold?Xp:Wp}onDrag2End(){this.state=Up}onDrag2(){switch(this.state){case Wp:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.prevDistance=t,this.state=Xp}break;case Xp:t=this.distanceBetween,this.scaleFactor=t/this.prevDistance,this.emit("pinch",this),this.prevDistance=t}}get isPinch(){return this.state===Xp}setDragThreshold(t){return this.dragThreshold=t,this}};Xo.register("pinch",function(t){return new Kp(this.scene,t)}),wo(window,"RexPlugins.UI.Pinch",Kp);const Jp=Phaser.Math.RotateAround;var Zp=function(t,e,i,r){return Jp(t,e,i,r),t.rotation+=r,t},qp={},$p=function(t,e){if(!this.isRotation)return this;void 0===e&&(e=this.pointers[0].camera);var i=this.movementCenterX,r=this.movementCenterY;e.getWorldPoint(this.centerX,this.centerY,qp);var n=qp.x,s=qp.y,a=this.rotation;if(Array.isArray(t))for(var o=t,h=0,l=o.length;h<l;h++)(t=o[h]).x+=i,t.y+=r,Zp(t,n,s,a);else t.x+=i,t.y+=r,Zp(t,x,y,a);return this};const Qp=Phaser.Utils.Objects.GetValue,td=Phaser.Math.Angle.WrapDegrees,ed=Phaser.Math.Angle.ShortestBetween,id=Phaser.Math.RadToDeg,rd=Phaser.Math.DegToRad;class nd extends Yp{constructor(t,e){super(t,e);var i=this,r={states:{IDLE:{enter:function(){i.prevAngle=void 0,i.angle=0}},BEGIN:{},RECOGNIZED:{enter:function(){i.emit("rotatestart",i)},exit:function(){i.emit("rotateend",i)}}},init:function(){this.state=ad},eventEmitter:!1};this.setRecongizedStateObject(new bn(r))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Qp(t,"threshold",0)),this}onDrag2Start(){this.prevAngle=td(id(this.angleBetween)),this.state=0===this.rotationThreshold?hd:od}onDrag2End(){this.state=ad}onDrag2(){switch(this.state){case od:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=td(id(this.angleBetween));this.angle=ed(this.prevAngle,t),this.prevAngle=t,this.state=hd}break;case hd:t=td(id(this.angleBetween));this.angle=ed(this.prevAngle,t),this.prevAngle=t,this.emit("rotate",this)}}get isRotation(){return this.state===hd}get rotation(){return rd(this.angle)}setDragThreshold(t){return this.dragThreshold=t,this}}var sd={spinObject:$p};Object.assign(nd.prototype,sd);const ad="IDLE",od="BEGIN",hd="RECOGNIZED";var ld=nd;Xo.register("rotate",function(t){return new ld(this.scene,t)}),wo(window,"RexPlugins.UI.Rotate",ld);const cd=Phaser.Utils.Objects.IsPlainObject,ud=Phaser.Utils.Objects.GetValue;var pd=function(t,e,i){var r;if(void 0===t)t=i.texture.key,e=i.frame.name;else if(cd(t)){var n=t;t=ud(n,"key",i.texture.key),e=ud(n,"frame",i.frame.name)}else"string"==typeof t||(r=t);return void 0===r&&(r=function(i){i.setTexture(t,e)}),r};const dd=Phaser.Utils.Objects.GetValue,fd=Phaser.Utils.Objects.GetAdvancedValue;class md{constructor(t,e){this.gameObject=t,this.scene=xi(t),this.setEventEmitter(dd(e,"eventEmitter",void 0)),this.scaleStart={},this.scaleEnd={},this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setOrientation(dd(t,"orientation",0)),this.setDelay(fd(t,"delay",0)),this.setDuration(fd(t,"duration",500)),this.setEase(dd(t,"ease","Sine")),this.setFrontFace(dd(t,"front",void 0)),this.setBackFace(dd(t,"back",void 0)),this.setFace(dd(t,"face",0)),this}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.destroyEventEmitter(),this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setOrientation(t){return"string"==typeof t&&(t=gd[t]),this.orientation=t,this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}setEase(t){return void 0===t&&(t="Linear"),this.ease=t,this}get isRunning(){return!!this.tween}get face(){return this._face}set face(t){"string"==typeof t&&(t=_d[t]),this._face=t,0===t&&this.frontFaceCallback?this.frontFaceCallback(this.gameObject):1===t&&this.backFaceCallback&&this.backFaceCallback(this.gameObject)}setFace(t){return this.face=t,this}toggleFace(){var t=0===this.face?1:0;return this.setFace(t),this}setFrontFace(t,e){return this.frontFaceCallback=pd(t,e,this.gameObject),this}setBackFace(t,e){return this.backFaceCallback=pd(t,e,this.gameObject),this}start(){if(this.isRunning)return this;if(0===this.duration)return this.toggleFace().complete(),this;var t={targets:this.gameObject,duration:this.duration/2,ease:this.ease,yoyo:!0,repeat:0,onYoyo:this.toggleFace,onYoyoScope:this,onComplete:this.complete,onCompleteScope:this};return t[0===this.orientation?"scaleX":"scaleY"]={from:1,to:0},this.tween=this.scene.tweens.add(t),this}restart(){return this.stop().start(),this}flip(t){return this.isRunning?this:(void 0!==t&&this.setDuration(t),this.start(),this)}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),this.emit("complete",this,this.gameObject),this}}Object.assign(md.prototype,gn);const gd={x:0,horizontal:0,y:1,vertical:1},_d={front:0,back:1};var yd=md;Xo.register("flip",function(t,e){return new yd(t,e)}),wo(window,"RexPlugins.UI.Flip",yd);const vd=Phaser.Utils.Objects.GetValue;var bd=function(t,e){void 0===e&&(e={});var i=t.scene,r=t.style,n=vd(e,"backgroundColor",r.backgroundColor);null===n&&(n="transparent"),e.text=vd(e,"text",t.text),e.fontFamily=vd(e,"fontFamily",r.fontFamily),e.fontSize=vd(e,"fontSize",r.fontSize),e.color=vd(e,"color",r.color),e.backgroundColor=n;var s=new vs(i,t.x,t.y,vd(e,"width",t.width),vd(e,"height",t.height),e);return s.setOrigin(t.originX,t.originY),i.add.existing(s),s},Pd=function(t){return t&&"function"==typeof t};const Td=Phaser.Utils.Objects.GetValue;var xd=void 0,Sd=class{constructor(t){this.gameObject=t,this.scene=xi(t),this.inputText=void 0,this.onClose=void 0,this.delayCall=void 0,this.boot()}boot(){return this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return this.close(),this.gameObject=void 0,this.scene=void 0,xd===this&&(xd=void 0),this}destroy(){return this.shutdown(),this}open(t,e){void 0!==xd&&xd.close(),xd=this,Pd(t)&&(e=t,t=void 0),void 0===e&&(e=Td(t,"onClose",void 0));var i=Td(t,"onTextChanged",void 0);return this.inputText=bd(this.gameObject,t).on("textchange",function(t){var e=t.text;i?i(this.gameObject,e):this.gameObject.text=e},this).setFocus(),this.gameObject.setVisible(!1),this.onClose=e,this.scene.input.keyboard.once("keydown-ENTER",this.close,this),this.delayCall=this.scene.time.delayedCall(0,function(){this.scene.input.once("pointerdown",this.close,this)},[],this),this}close(){return xd=void 0,this.inputText?(this.gameObject.setVisible(!0),this.inputText.destroy(),this.inputText=void 0,this.delayCall&&(this.delayCall.remove(),this.delayCall=void 0),this.scene.input.keyboard.off("keydown-ENTER",this.close,this),this.scene.input.off("pointerdown",this.close,this),this.onClose&&this.onClose(this.gameObject),this):this}get isOpened(){return void 0!==this.inputText}get text(){return this.isOpened?this.inputText.text:this.gameObject.text}};class Od extends Phaser.Plugins.ScenePlugin{constructor(t,e){super(t,e),this.add=new Xo(t)}}var Cd={hide:kl,show:Bl,isShown:Rl,edit:function(t,e,i){return t._edit||(t._edit=new Sd(t)),t._edit.open(e,i),t._edit}};Object.assign(Od.prototype,Cd);var Dd=Od,wd=i(153),Ad=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),Ed=function(t){function e(e){var i=t.call(this)||this;return i.mWorld=e,i.init(),i}return Ad(e,t),e.prototype.init=function(){this.mModelClassDic={},this.mModelDic={},this.mModelClassDic[Lt.NAME]=Lt,this.mModelClassDic[Ht.NAME]=Ht,this.mModelClassDic[ue.NAME]=ue},e.prototype.getModel=function(t){var e=this.mModelDic[t];return e||(e=this.mModelDic[t]=new this.mModelClassDic[t](this.mWorld)),e},e}(wd.EventEmitter),Md=/\.pi$/i,Id=function(){function t(t,e){this.mWorld=t,this.mScene=e}return t.prototype.isShow=function(){return this.mShowing},t.prototype.show=function(t){var e=this,i=this.mWorld.getSize();this.mParentCon=this.mScene.add.container(i.width>>1,i.height>>1);var r=this.mScene.make.text({x:0,y:0,text:t,style:{fill:"#FF0000",fontSize:20}});this.mParentCon.add(r),this.mParentCon.setSize(r.width,r.height),this.mParentCon.x=i.width-this.mParentCon.width>>1,this.mScene.tweens.add({targets:this.mParentCon,duration:1e3,ease:"Linear",props:{y:{value:(i.height>>1)-80},alhpa:{value:0}},onComplete:function(t,i,r){e.destroy()},onCompleteParams:[this]})},t.prototype.hide=function(){},t.prototype.resize=function(){},t.prototype.destroy=function(){this.mParentCon&&this.mParentCon.destroy(!0)},t.prototype.update=function(){},t}(),Bd=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),kd=function(t){function e(e,i){var r=t.call(this,e)||this;return r.mIsopen=!1,r.mScene=e,r.mConfig=i,r.init(),r}return Bd(e,t),e.prototype.selectCall=function(t){this.mtxt.text=t.text,this.mtxt.x=this.mConfig.wid-this.mtxt.width>>1,this.mtxt.y=this.mConfig.hei-this.mtxt.height>>1,this.showTween(!1),this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)},Object.defineProperty(e.prototype,"text",{set:function(t){if(this.itemList){for(var e=this.itemList.length,i=0;i<e;i++){(n=this.itemList[i])&&n.destroy()}this.itemList.length=0}this.itemList=[];var r=t.length;for(i=0;i<r;i++){var n=new Rd(this.mScene,this,this.mConfig.wid,this.mConfig.hei),s=t[i];n.itemData={index:i,text:s,data:{}},this.itemList.push(n)}this.selectCall(this.itemList[0].itemData)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){if(this.itemList){for(var e=this.itemList.length,i=0;i<e;i++){var r=this.itemList[i];r&&r.destroy()}this.itemList.length=0,this.itemList=null}t.prototype.destroy.call(this,!0)},e.prototype.init=function(){var t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},e.prototype.onLoadCompleteHandler=function(){var t=this.mConfig.resKey;this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2,this.mBg.y=this.mConfig.hei/2,this.mBg.setSize(this.mConfig.wid,this.mConfig.hei),this.mArrow=this.mScene.make.image(void 0,!1),this.mArrow.setTexture(t,this.mConfig.resArrow),this.mArrow.scaleY=this.mConfig.up?-1:1,this.mArrow.x=this.mConfig.wid-this.mArrow.width,this.mArrow.y=4+(this.mConfig.hei-this.mArrow.height>>1),this.mtxt=this.mScene.make.text({x:0,y:0,style:{fill:"#F7EDED",fontSize:18}},!1),this.add(this.mBg),this.add(this.mArrow),this.add(this.mtxt),this.mBg.setInteractive(),this.mBg.on("pointerdown",this.openHandler,this)},e.prototype.openHandler=function(){!this.itemList||this.itemList.length<1||this.showTween(this.mIsopen)},e.prototype.showTween=function(t){t?(this.mItemBG=this.createTexture(),this.addAt(this.mItemBG,0)):this.mItemBG&&(this.mItemBG.parentContainer&&this.mItemBG.parentContainer.remove(this.mItemBG),this.mItemBG.destroy()),this.mArrow.scaleY=t?1:-1,this.showTweenItem(t),this.mIsopen=!this.mIsopen},e.prototype.showTweenItem=function(t){for(var e=this,i=this.itemList.length,r=function(i){var r=n.itemList[i];if(!r)return"continue";r.x=n.mConfig.wid>>1,n.add(r),n.mScene.tweens.add({targets:r,duration:50*i,props:{y:{value:t?-n.mConfig.hei*i-n.mConfig.hei/2:-n.mConfig.hei>>1},alpha:{value:t?1:0}},onComplete:function(i,n,s){t||e.remove(r)},onCompleteParams:[n]})},n=this,s=0;s<i;s++)r(s)},e.prototype.createTexture=function(){var t=this.mConfig.hei*this.itemList.length,e=this.mScene.make.graphics(void 0,!1);return e.fillStyle(4012088,.8),e.fillRect(0,-t,this.mConfig.wid,t),e},e}(Phaser.GameObjects.Container),Rd=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;s.mCombobox=i,s.mText=s.scene.make.text({x:-r>>1,y:-n>>1,style:{fill:"#F7EDED",fontSize:18}},!1);return s.mSelectBG=e.make.graphics(void 0,!1),s.mSelectBG.fillStyle(16763904,.8),s.mSelectBG.fillRect(-r>>1,-n>>1,r,n),s.mSelectBG.visible=!1,s.addAt(s.mSelectBG,0),s.add(s.mText),s.setSize(r,n),s.setInteractive(),s.on("pointerover",s.overHandler,s),s.on("pointerout",s.outHandler,s),s.on("pointerdown",s.selectHandler,s),s}return Bd(e,t),Object.defineProperty(e.prototype,"itemData",{get:function(){return this.mData},set:function(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width/2+(this.width-this.mText.width>>1),this.mText.y=-this.height/2+(this.height-this.mText.height>>1)},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){t.prototype.destroy.call(this,!0)},e.prototype.setSelected=function(t){this.mSelectBG.visible=t},e.prototype.overHandler=function(){this.mSelectBG.visible=!0},e.prototype.selectHandler=function(){this.overHandler(),this.mCombobox.selectCall(this.itemData)},e.prototype.outHandler=function(){this.mSelectBG.visible=!1},e}(Phaser.GameObjects.Container),Nd=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),jd=function(t){function e(){var i=t.call(this,{key:e.name})||this;return i.mCurTabIndex=0,i}return Nd(e,t),e.prototype.preload=function(){this.load.atlas("login","./resources/ui/login/login.png","./resources/ui/login/login.json")},e.prototype.create=function(){var t=this.scale.gameSize.width,e=this.scale.gameSize.height,i=this.add.graphics();i.fillStyle(0),i.fillRect(0,0,t,e);var r=localStorage.getItem("account"),n=this.make.image(void 0,!1);n.setTexture("login","login_logo"),this.mParentCon=this.add.container(t>>1,100+(e>>1)),this.mBg=this.make.image(void 0,!1),this.mEnterBtn=this.make.image(void 0,!1),this.mEnterBtn.setTexture("login","login_loginBtn"),this.mEnterBtn.x=123,this.mQuickBtn=this.make.image(void 0,!1),this.mQuickBtn.setTexture("login","login_quickBtn"),this.mQuickBtn.x=123,this.mQuickBtn.y=-38,this.mSendCodeBtn=this.make.image(void 0,!1),this.mSendCodeBtn.setTexture("login","login_sendBtn"),this.mSendCodeBtn.x=10,this.mSendCodeBtn.y=67,this.mTab0=this.make.image(void 0,!1),this.mTab0.setTexture("login","login_tabSelect"),this.mTab0.x=-105,this.mTab0.y=-38,this.mTab1=this.make.image(void 0,!1),this.mTab1.setTexture("login","login_tabUnSelect"),this.mTab1.x=7,this.mTab1.y=-38,this.mInputBg_long0=this.make.image(void 0,!1),this.mInputBg_long0.setTexture("login","login_inputLong"),this.mInputBg_long0.x=-50,this.mInputBg_long0.y=15,this.mInputBg_long1=this.make.image(void 0,!1),this.mInputBg_long1.setTexture("login","login_inputLong"),this.mInputBg_long1.x=-50,this.mInputBg_long1.y=67,this.mInputBg_small=this.make.image(void 0,!1),this.mInputBg_small.setTexture("login","login_inputBg"),this.mInputBg_small.x=-105,this.mInputBg_small.y=67,this.mTabDic=new Map,this.mNameInputTxt=new vs(this,-140,4,190,15,{type:"input",placeholder:"",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(200,20).setOrigin(0,0),this.mPassWordInputTxt=new vs(this,-140,55,190,15,{type:"password",placeholder:"",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(200,20).setOrigin(0,0),this.mVerificationCodeTxt=new vs(this,-140,55,100,15,{type:"input",placeholder:"",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(100,20).setOrigin(0,0),this.mtxt0=this.add.text(-145,-46,"",{fontFamily:"YaHei"}),this.mtxt1=this.add.text(-35,-46,"",{fontFamily:"YaHei"}),this.mtxt2=this.add.text(90,-46,"",{fontFamily:"YaHei"}),this.mtxt3=this.add.text(108,33,"",{fontFamily:"YaHei"}),this.mtxt4=this.add.text(-97,37,"",{fontFamily:"YaHei"}),this.mtxt5=this.add.text(-6,57,"",{fontFamily:"YaHei"});var s={wid:220,hei:36,resKey:"login",resPng:"./resources/ui/login/login.png",resJson:"./resources/ui/login/login.json",resBg:"login_inputLong",resArrow:"login_downArrow",fontStyle:{size:20,color:"#ffcc00",bold:!1},up:!0,clickCallBack:this.changeID};this.combobox=new kd(this,s),this.combobox.x=-158,this.combobox.y=-28,this.changePanelState(r),this.mParentCon.add(n),this.mParentCon.add(this.mBg),this.mParentCon.add(this.mTab0),this.mParentCon.add(this.mTab1),this.mParentCon.add(this.mQuickBtn),this.mParentCon.add(this.mEnterBtn),this.mParentCon.add(this.mSendCodeBtn),this.mParentCon.add(this.mInputBg_long0),this.mParentCon.add(this.mInputBg_long1),this.mParentCon.add(this.mInputBg_small),this.mParentCon.add(this.mNameInputTxt),this.mParentCon.add(this.mPassWordInputTxt),this.mParentCon.add(this.mVerificationCodeTxt),this.mParentCon.add(this.mtxt0),this.mParentCon.add(this.mtxt1),this.mParentCon.add(this.mtxt2),this.mParentCon.add(this.mtxt3),this.mParentCon.add(this.mtxt4),this.mParentCon.add(this.mtxt5),this.mParentCon.add(this.combobox),n.x=-30,n.y=-n.height/2-80,this.mTab0.setInteractive(),this.mTab1.setInteractive(),this.mQuickBtn.setInteractive(),this.mEnterBtn.setInteractive(),this.mSendCodeBtn.setInteractive(),this.mtxt4.setInteractive(),this.mTab0.tabIndex=0,this.mTab1.tabIndex=1,this.mTabDic.set(this.mTab0.tabIndex,this.mTab0),this.mTabDic.set(this.mTab1.tabIndex,this.mTab1),this.mCurTabIndex=0,this.mTab0.on("pointerdown",this.tab0Handler,this),this.mTab1.on("pointerdown",this.tab1Handler,this),this.mQuickBtn.on("pointerdown",this.quickHandler,this),this.mEnterBtn.on("pointerdown",this.enterHandler,this),this.mSendCodeBtn.on("pointerdown",this.sendCodeHandler,this),this.mtxt4.on("pointerdown",this.changeAccount,this),this.mParentCon.scaleX=this.mParentCon.scaleY=this.mWorld.uiScale},e.prototype.init=function(t){this.mConnect=t.connect,this.mCallBack=t.callBack,this.mWorld=t.world},e.prototype.update=function(){},e.prototype.awake=function(){this.scene.wake()},e.prototype.sleep=function(){this.scene.sleep()},e.prototype.remove=function(){this.scene.remove()},e.prototype.getKey=function(){return this.sys.config.key},e.prototype.changeID=function(t){r.debug("============combobox 123"+t.text)},e.prototype.changeAccount=function(){this.changePanelState(void 0)},e.prototype.changePanelState=function(t){var e=!t;this.verificaHandler(e);var i=t?"login_quickLoginBg":"login_loginBgBig";this.mBg.setTexture("login",i),this.mEnterBtn.y=t?15:40,this.mInputBg_long0.visible=!t,this.mtxt3.y=t?8:35,this.mNameInputTxt.visible=!t,this.combobox.visible=!!t,this.mQuickBtn.visible=!t,this.mTab0.visible=!t,this.mTab1.visible=!t,this.mInputBg_long1.visible=!t&&0!==this.mCurTabIndex,this.mPassWordInputTxt.visible=!t&&0!==this.mCurTabIndex,this.mtxt0.visible=!t,this.mtxt1.visible=!t,this.mtxt2.visible=!t,this.mtxt4.visible=!!t;var r=void 0!==t?JSON.parse(t):void 0;this.mNameInputTxt.text=r?r.account:"",this.combobox.text=r?[r.account+""]:[""],this.mPassWordInputTxt.text=r?r.password:"",this.mParentCon.setSize(this.mBg.width,this.mBg.height)},e.prototype.verificaHandler=function(t){this.mVerificationCodeTxt.visible=t,this.mtxt5.visible=t,this.mInputBg_small.visible=t,this.mSendCodeBtn.visible=t,this.mInputBg_long1.visible=!t,this.mPassWordInputTxt.visible=!t},e.prototype.quickHandler=function(){this.addTween(this.mQuickBtn)},e.prototype.sendCodeHandler=function(){this.addTween(this.mSendCodeBtn)},e.prototype.enterHandler=function(){this.addTween(this.mEnterBtn),this.requestLogin()},e.prototype.addTween=function(t){this.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=t.scaleY=1},e.prototype.tab0Handler=function(t){this.mCurTabIndex=0,this.tabHandler()},e.prototype.tab1Handler=function(t){this.mCurTabIndex=1,this.tabHandler()},e.prototype.tabHandler=function(){var t=this;this.mTabDic.forEach(function(e){var i;i=e.tabIndex===t.mCurTabIndex?"login_tabSelect":"login_tabUnSelect",e.setTexture("login",i)}),this.verificaHandler(!this.mCurTabIndex)},e.prototype.requestLogin=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){200===e.status?(localStorage.setItem("account",JSON.stringify({account:t.mNameInputTxt.text,password:t.mPassWordInputTxt.text})),t.mWorld.account.setAccount(JSON.parse(e.response)),t.mCallBack(e.responseText)):new Id(t.mWorld,t).show("")};e.open("POST","https://api.tooqing.com/account/signin"),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send(JSON.stringify({account:t.mNameInputTxt.text,password:t.mPassWordInputTxt.text}))},e.prototype.requestGetPhoneCode=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){200===e.status||new Id(t.mWorld,t).show("")};e.open("POST","https://api.tooqing.com/account/sms_code"),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send()},e.prototype.loginByPhoneCode=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){200===e.status?(localStorage.setItem("accountphone",JSON.stringify({account:t.mNameInputTxt.text})),t.mWorld.account.setAccount(JSON.parse(e.response)),t.mCallBack(e.responseText)):new Id(t.mWorld,t).show("")};e.open("POST","https://api.tooqing.com/account/phone_signin"),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send()},e.prototype.requestQuickLogin=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){200===e.status?(localStorage.setItem("accountphone",JSON.stringify({account:t.mNameInputTxt.text})),t.mWorld.account.setAccount(JSON.parse(e.response)),t.mCallBack(e.responseText)):new Id(t.mWorld,t).show("")};e.open("POST","https://api.tooqing.com/account/quick_signin"),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send()},e}(Phaser.Scene),Ld=function(){function t(){}return t.prototype.setAccount=function(t){this.mCurAccountData={token:"",expire:0,fingerprint:""},Object.assign(this.mCurAccountData,t.data)},Object.defineProperty(t.prototype,"accountData",{get:function(){return this.mCurAccountData},enumerable:!0,configurable:!0}),t}();i.d(e,"World",function(){return zd});var Fd=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),zd=function(t){function e(e,i){var r=t.call(this)||this;if(r.mCallBack=i,r.mConfig=e,!e.game_id)throw new Error("Config.game_id is required.");r._newGame(),r.mConnection=new f(r),r.mConnection.addPacketListener(r),r.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_VIRTUAL_WORLD_INIT,r.onInitVirtualWorldPlayerInit),r.addHandlerFun(a.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_ERROR,r.onClientErrorHandler),r.addHandlerFun(a.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SELECT_CHARACTER,r.onSelectCharacter),r.mRoomMamager=new Ut(r),r.mMouseManager=new Jt(r),r.mUiManager=new xo(r),r.mElementStorage=new $t;var n=r.mConfig.server_addr||Object({host:"115.182.75.100",port:12100});return n&&r.mConnection.startConnect(n),r}return Fd(e,t),e.prototype.destroy=function(){},e.prototype.onConnected=function(t){r.info("enterVirtualWorld"),this.login()},e.prototype.onDisConnected=function(t){},e.prototype.onError=function(t){},e.prototype.onClientErrorHandler=function(t){var e=t.content;r.error("Remote Error["+e.responseStatus+"]: "+e.msg)},e.prototype.changeRoom=function(t){this.mGame.device.os.desktop&&this.mInputManager.onRoomChanged(t),this.mMouseManager.changeRoom(t)},e.prototype.getSize=function(){if(this.mGame)return this.mGame.scale.gameSize},e.prototype.resize=function(t,e){this.mGame&&this.mGame.scale.resize(t,e),this.mRoomMamager&&this.mRoomMamager.resize(t,e),this.mUiManager&&this.mUiManager.resize(t,e),this.mInputManager&&this.mInputManager.resize(t,e)},Object.defineProperty(e.prototype,"uiScale",{get:function(){return this.mConfig?this.mConfig.ui_scale:1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"game",{get:function(){return this.mGame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomManager",{get:function(){return this.mRoomMamager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elementStorage",{get:function(){return this.mElementStorage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectCharacterManager",{get:function(){return this.selectCharacterManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uiManager",{get:function(){return this.mUiManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputManager",{get:function(){return this.mInputManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"connection",{get:function(){return this.mConnection},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"modelManager",{get:function(){return this.mModelManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"account",{get:function(){return this.mAccount},enumerable:!0,configurable:!0}),e.prototype.onSelectCharacter=function(){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_CHARACTER_CREATED);this.connection.send(t)},e.prototype.login=function(){var t=this;this.mAccount=new Ld,this.mGame.scene.getScene(jd.name)||this.mGame.scene.add(jd.name,jd),this.mGame.scene.getScene(g.name)||this.mGame.scene.add(g.name,g),this.mGame.scene.start(jd.name,{connect:this.mConnection,world:this,callBack:function(){t.enterVirtualWorld(),t.mGame.scene.getScene(jd.name).remove(),t.mGame.scene.start(g.name,{world:t})}})},e.prototype.enterVirtualWorld=function(){if(this.mConfig&&this.mConnection){if(!this.mConfig.auth_token)return void this.login();var t=new s.PBpacket(a.op_gateway.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PLAYER_INIT),e=t.content;r.log("VW_id: "+this.mConfig.virtual_world_id),e.virtualWorldUuid=""+this.mConfig.virtual_world_id,e.gameId=this.mConfig.game_id,e.userToken=this.mAccount.accountData.token,e.expire=this.mAccount.accountData.expire+"",e.fingerprint=this.mAccount.accountData.fingerprint,this.mConnection.send(t)}},e.prototype.onInitVirtualWorldPlayerInit=function(t){var e=this,i=t.content,n=i.configUrls;(!n||n.length<=0)&&r.error("configUrls error: , "+n+", gameId: "+this.mConfig.game_id),r.log("start download gameConfig"),this.loadGameConfig(i.configUrls).then(function(t){e.mElementStorage.setGameConfig(t),e.createGame(),r.debug("created game suc")}).catch(function(t){r.log(t)})},e.prototype._newGame=function(){if(this.mGame)return this.mGame;var t={type:Phaser.AUTO,zoom:1,parent:"game",scene:null,disableContextMenu:!0,transparent:!1,backgroundColor:0,resolution:1,fps:{target:60},dom:{createContainer:!0},plugins:{global:[{key:"rexButton",plugin:Uo,start:!0},{key:"rexNinePatchPlugin",plugin:Ao,start:!0},{key:"rexInputText",plugin:ko,start:!0},{key:"rexBBCodeTextPlugin",plugin:Fo,start:!0}],scene:[{key:"DragonBones",plugin:dragonBones.phaser.plugin.DragonBonesScenePlugin,mapping:"dragonbone"},{key:"rexUI",plugin:Dd,mapping:"rexUI"}]},render:{pixelArt:!0,roundPixels:!0}};return Object.assign(t,this.mConfig),this.mGame=new n.Game(t)},e.prototype.createGame=function(){this._newGame(),this.mGame.scene.add(P.name,P),this.mGame.scene.add(v.name,v),this.mGame.events.on(Phaser.Core.Events.FOCUS,this.onFocus,this),this.mGame.events.on(Phaser.Core.Events.BLUR,this.onBlur,this),this.mModelManager=new Ed(this),this.mGame.device.os.desktop?this.mInputManager=new Xt(this):this.mInputManager=new Zt(this),this.gameCreated()},e.prototype.gameCreated=function(){if(this.connection){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_GAME_CREATED);this.connection.send(t),this.mCallBack&&this.mCallBack()}else r.error("connection is undefined")},e.prototype.loadGameConfig=function(t){for(var e=this,i=[],n=0,s=t;n<s.length;n++){var a=s[n];Md.test(a)&&i.push(Qt(S.getGameConfig(a),"arraybuffer"))}return Promise.all(i).then(function(t){return r.log("start decodeConfig"),e.decodeConfigs(t)})},e.prototype.decodeConfigs=function(t){return new Promise(function(e,i){for(var r=0,n=t;r<n.length;r++){var s=n[r].response;if(s)try{var a=new ie.Lite;a.deserialize(new Uint8Array(s)),e(a)}catch(t){i(t)}else i("error")}})},e.prototype.onFocus=function(){if(this.connection){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=a.op_def.GameStatus.Focus,this.connection.send(t),this.mRoomMamager.onFocus()}else r.error("connection is undefined")},e.prototype.onBlur=function(){if(this.connection){var t=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=a.op_def.GameStatus.Blur,this.connection.send(t),this.mRoomMamager.onBlur()}else r.error("connection is undefined")},e}(s.PacketHandler)},,,,function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(4),a=i(43),o=i(20),h=i(15),l=function(t){function e(e,i){var r=t.call(this,e)||this;return r._fork=!1,r.parentObject=i,r.type=o.default.NODE_T.indexOf(r.className),r}return n(e,t),e.prototype.renewId=function(){for(var t=this.id,e=h.default.genId(),i=[],r=0,n=this.children;r<n.length;r++){var s=n[r];i.push(s.id)}this.unlink(),this.id=e,this.cap.removeObjectById(t),this.cap.addObject(this);for(var a=0,o=i;a<o.length;a++){var l=o[a],c=this.cap.getObject(l);c&&(c.parent=e,c.renewId())}},Object.defineProperty(e.prototype,"children",{get:function(){return this.cap.getChildrenList(this.id)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFork",{get:function(){return this._fork},set:function(t){this._fork=t},enumerable:!0,configurable:!0}),e.prototype.ignore=function(){for(var t=0,e=this.children;t<e.length;t++){e[t].ignore()}},e.prototype.preSerialize=function(){},e.prototype.serialize=function(t){this.cap.ignoreList.get(this.id)||this.findMyContainer(t).push(this.createProtocolObject())},e.prototype.deserialize=function(t){if(t&&t.hasOwnProperty("node")){var e=t.node;e&&this.setNode(e)}this.cap.addObject(this)},e.prototype.findMyContainer=function(t){throw new Error("Subclass must override this method! BaseConfigObject::findMyContainer")},e.prototype.createProtocolObject=function(){throw new Error("Subclass must override this method! BaseConfigObject::createProtocolObject")},e.prototype.appendNode=function(t){if(t.parent!==this.id)throw new Error(this.className+".appendNode(): I am not parent of Object["+t.className+"."+t.id+"].")},e.prototype.removeNode=function(t){if(t.parent!==this.id)throw new Error(this.className+".removeNode(): I am not parent of Object["+t.className+"."+t.id+"].")},e.prototype.link=function(){var t=this.parentObject;t&&t.appendNode(this)},e.prototype.unlink=function(){var t=this.parentObject;t&&t.removeNode(this)},e.prototype.destroy=function(){for(var e=0,i=this.children;e<i.length;e++){var r=i[e];r&&r.destroy()}this.cap.removeObject(this),t.prototype.destroy.call(this)},e.prototype.geneSequence=function(){return this.className},e.prototype.duplicate=function(t){this.name=t.name},e}(a.default);e.BaseConfigObject=l;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.findMyContainer=function(t){return Array.isArray(t.entity)||(t.entity=[]),t.entity},e.prototype.createProtocolObject=function(){var t=s.op_gameconfig_01.Entity.create();return t.node=this.makeNode(),t},e}(l);e.EntityNode=c},,,,,,,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(108),n=i(44),s=i(20),a=function(){function t(){}return t.genId=function(){return(new n).natural({min:1e4,max:s.default.MAX_ID})},t.getClassName=function(t){return t.constructor.name},t.sha1=function(t){return r.enc.Hex.stringify(r.SHA1(t))},t.pointToString=function(t){return t.x+","+t.y},t.flipArray=function(t){var e=t.slice(),i=[];if(e.length>0)for(var r=e[0].length,n=0;n<r;n++){i[n]=[];for(var s=0;s<e.length;s++)i[n].push(e[s][n])}return i},t.arrayToString=function(t,e,i){for(var r=[],n=0,s=t;n<s.length;n++){var a=s[n];r.push(a.join(e))}return r.join(i)},t.stringToArray=function(t,e,i){for(var r=[],n=0,s=t.split(i);n<s.length;n++){var a=s[n].split(e);r.push(a.map(function(t){return parseInt(t)}))}return r},t.ID_VOL=9e5,t}();e.default=a},,,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(92);e.GameNode=r.default;var n=i(47);e.ElementNode=n.default;var s=i(27);e.LocationNode=s.default;var a=i(28);e.AnimationsNode=a.default,e.AnimationDataNode=a.AnimationDataNode;var o=i(48);e.DisplayNode=o.default;var h=i(49);e.AvatarNode=h.default;var l=i(132);e.MovableNode=l.default;var c=i(133);e.AttributeNode=c.default;var u=i(134);e.FunctionNode=u.default;var p=i(135);e.EventNode=p.default;var d=i(136);e.UINode=d.default,e.ButtonNode=d.ButtonNode;var f=i(137);e.TimerNode=f.default;var m=i(138);e.SpawnPointNode=m.default;var g=i(50);e.AccessNode=g.AccessNode;var _=i(51);e.SceneNode=_.default,e.MapSizeNode=_.MapSizeNode;var y=i(139);e.ForkNode=y.default;var v=i(29);e.PackageNode=v.default,e.PackageItemNode=v.PackageItemNode;var b=i(6);e.BaseConfigObject=b.BaseConfigObject;var P=i(43);e.Metadata=P.default;var T=i(52);e.CharacterNode=T.default,e.CampNode=T.CampNode;var x=i(53);e.TerrainNode=x.TerrainNode;var S=i(54);e.ShopNode=S.default,e.ShopItemNode=S.ShopItemNode,e.CommodityNode=S.CommodityNode},function(t,e,i){"use strict";var r;Object.defineProperty(e,"__esModule",{value:!0});var n=i(4).op_def.NodeType,s=function(){function t(){}return t.MAX_ID=Math.pow(2,31),t.NODE_T=[null,"GameNode","SceneNode","ElementNode","TerrainNode","CharacterNode","LocationNode","MovableNode","DisplayNode","AttributeNode","FunctionNode","AnimationsNode","EventNode","MapSizeNode","UINode","TimerNode","PackageNode","PackageItemNode","AvatarNode","SettingsNode","CampNode","MutexNode","AnimationDataNode","ForkNode","ButtonNode","TextNode","AccessNode","SpawnPointNode","CommodityNode","ShopNode"],t.NODE_T_CN_Map={GameNode:"",SceneNode:"",ElementNode:"",TerrainNode:"",CharacterNode:"",LocationNode:"",MovableNode:"",DisplayNode:"",AttributeNode:"",FunctionNode:"",AnimationsNode:"",EventNode:"",MapSizeNode:"",UINode:"",TimerNode:"",PackageNode:"",PackageItemNode:"",AvatarNode:"",SettingsNode:"",CampNode:"",MutexNode:"",AnimationDataNode:"",ForkNode:"",ButtonNode:"",TextNode:"",AccessNode:"",SpawnPointNode:""},t.NODETYPEMAP=((r={})[n.GameNodeType]="GameNode",r[n.SceneNodeType]="SceneNode",r[n.ElementNodeType]="ElementNode",r[n.TerrainNodeType]="TerrainNode",r[n.CharacterNodeType]="CharacterNode",r[n.LocationType]="LocationNode",r[n.MovableType]="MovableNode",r[n.DisplayType]="DisplayNode",r[n.AttributeType]="AttributeNode",r[n.FunctionType]="FunctionNode",r[n.AnimationsType]="AnimationsNode",r[n.EventType]="EventNode",r[n.MapSizeType]="MapSizeNode",r[n.UIType]="UINode",r[n.TimerType]="TimerNode",r[n.PackageType]="PackageNode",r[n.PackageItemType]="PackageItemNode",r[n.AvatarType]="AvatarNode",r[n.SettingsType]="SettingsNode",r[n.CampType]="CampNode",r[n.MutexType]="MutexNode",r[n.AnimationDataType]="AnimationDataNode",r[n.ForkType]="ForkNode",r[n.ButtonType]="ButtonNode",r[n.TextType]="TextNode",r[n.AccessType]="AccessNode",r[n.SpawnPointType]="SpawnPointNode",r[n.CommodityType]="CommodityNode",r[n.ShopType]="ShopNode",r),t}();e.default=s},,,,,,,function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._x=0,r._y=0,r._z=0,r.name="",r}return n(e,t),e.prototype.ignore=function(){},Object.defineProperty(e.prototype,"properties",{get:function(){return{x:this._x,y:this._y,z:this._z}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.loc)||(t.loc=[]),t.loc},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Location.create();return t.node=this.makeNode(),t.x=this._x,t.y=this._y,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._x=i.x,this._y=i.y},e.prototype.geneSequence=function(){return""},e.prototype.duplicate=function(i){t.prototype.duplicate.call(this,i),i instanceof e&&(this._x=i.x,this._y=i.y,this._z=i.z)},e}(s.BaseConfigObject);e.default=o},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(15),o=i(4),h=i(48),l=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._defaultAnimation="idle",r._data_map=new Map,r._images=new Map,r._editorToolType=0,r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{dir:this._dir,defaultAnimation:this._defaultAnimation}},enumerable:!0,configurable:!0}),e.prototype.ignore=function(){t.prototype.ignore.call(this),this.cap.ignoreList.set(this.id,this.id)},e.prototype.findMyContainer=function(t){return Array.isArray(t.animations)||(t.animations=[]),t.animations},e.prototype.createProtocolObject=function(){var e=o.op_gameconfig_01.Animations.create();return e.node=t.prototype.makeNode.call(this),e.dir=this._dir,e.defaultAnimation=this._defaultAnimation,e.scale=this._scale,e},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._dir=i.dir||void 0,this._defaultAnimation=i.defaultAnimation,this._scale=i.scale},e.prototype.addAnimationData=function(t){this._data_map.set(t.id,t)},e.prototype.removeAnimationData=function(t){this._data_map.delete(t.id)},e.prototype.setDisplayPath=function(t,e){var i=this.display;i.texturePath=t,i.dataPath=e},Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"display",{get:function(){return this._display||this.cap.add.display(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationData",{get:function(){return Array.from(this._data_map.values())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultAnimationName",{get:function(){return this._defaultAnimation},set:function(t){this._defaultAnimation=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editorToolType",{get:function(){return this._editorToolType},set:function(t){this._editorToolType=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thumbBuffer",{get:function(){return this._thumbBuffer},set:function(t){this._thumbBuffer=t},enumerable:!0,configurable:!0}),e.prototype.setImages=function(t){this._images.clear();for(var e=0,i=t;e<i.length;e++){var r=i[e];this.addImage(r)}},e.prototype.addImage=function(t){"blank"===t.name&&(t.isBlank=!0),this._images.set(t.name,t)},e.prototype.getImage=function(t){return this._images.get(t)},e.prototype.removeImage=function(t){this._images.delete(t.name);for(var e=0,i=this.animationDataList;e<i.length;e++){i[e].removeFrameByName(t.name)}},e.prototype.updateFrameDataImage=function(){for(var t=this.animationDataList,e=0,i=t;e<i.length;e++){var r=i[e].frameData;if(r)for(var n=0,s=r;n<s.length;n++){var a=s[n];a.image=this.getImage(a.name)}}t.length>0&&this.setSelectedAnimation(t[0].id)},e.prototype.horizontalFlip=function(){this._scale=!this._scale},Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"images",{get:function(){return Array.from(this._images.values())},enumerable:!0,configurable:!0}),e.prototype.setSelectedAnimation=function(t){this._selectedAnimationID=t},Object.defineProperty(e.prototype,"animationDataList",{get:function(){return Array.from(this._data_map.values())},enumerable:!0,configurable:!0}),e.prototype.getSelectedAnimation=function(){if(this._selectedAnimationID)return this._data_map.get(this._selectedAnimationID)},e.prototype.appendNode=function(e){try{t.prototype.appendNode.call(this,e)}catch(t){console.error(t)}e instanceof c&&this.addAnimationData(e),e instanceof h.default&&(this._display=e)},e.prototype.removeNode=function(e){try{t.prototype.removeNode.call(this,e)}catch(t){console.error(t)}e instanceof c&&this.removeAnimationData(e),e instanceof h.default&&(this._display=void 0)},e.prototype.geneSelfSequence=function(){var t=""+this.defaultAnimationName;return this._scale&&(t+=this._scale.toString()),t},e.prototype.geneSequence=function(){var t=""+this.defaultAnimationName;this._display&&(t+=this._display.geneSequence()),this._scale&&(t+=this._scale.toString());var e=this.animationDataList.sort();if(e.length>0)for(var i=0,r=e;i<r.length;i++){t+=r[i].geneSequence()}return t},e.prototype.duplicate=function(i){t.prototype.duplicate.call(this,i),i instanceof e&&(this._defaultAnimation=i.defaultAnimationName,this._dir=i.dir,this._scale=i.scale)},e.prototype.checkSameName=function(t){for(var e=0,i=this.animationData;e<i.length;e++){if(i[e].name===t)return!0}return!1},e}(s.BaseConfigObject);e.default=l;var c=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.areaRows=15,r.areaCols=15,r.centerPoint={x:r.areaRows>>1,y:r.areaCols>>1},r._frameRate=5,r._frameName=[],r._loop=!0,r._baseLoc={x:0,y:0},r._frameData=[],r._playing=!1,r.name="",r}return n(e,t),e.prototype.ignore=function(){t.prototype.ignore.call(this),this.cap.ignoreList.set(this.id,this.id)},Object.defineProperty(e.prototype,"properties",{get:function(){return{frameRate:this._frameRate,frameName:this._frameName,loop:this._loop,baseLoc:this._baseLoc.x+","+this._baseLoc.y,originPoint:this.collisionOriginPoint,frameData:this._frameData,selectedFrame:this._selectedFrame,playing:this._playing,basicWalkableArea:this._basicWalkableArea,basicCollisionArea:this._basicCollisionArea}},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.animationdatas)||(t.animationdatas=[]),t.animationdatas},e.prototype.createProtocolObject=function(){var e=o.op_gameconfig_01.AnimationData.create();if(e.node=t.prototype.makeNode.call(this),e.baseLoc=this._baseLoc.x+","+this._baseLoc.y,e.frameName=this._frameName,e.loop=this._loop,e.frameRate=this._frameRate,this._collisionArea&&(e.collisionArea=a.default.arrayToString(this._collisionArea,",","&")),this._walkableArea&&(e.walkableArea=a.default.arrayToString(this._walkableArea,",","&")),this._collisionOriginPoint){var i=this._collisionOriginPoint;e.originPoint=[i.y,i.x]}return e},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;if(this._frameRate=i.frameRate,this._frameName=i.frameName||[],this._loop=i.loop||!1,i.originPoint&&(this._collisionOriginPoint={x:i.originPoint[1],y:i.originPoint[0]},this._walkableOriginPoint={x:i.originPoint[1],y:i.originPoint[0]}),i.baseLoc){var r=i.baseLoc.split(",");this._baseLoc={x:parseInt(r[0]),y:parseInt(r[1])}}i.walkableArea&&(this._walkableArea=a.default.stringToArray(i.walkableArea,",","&"),this._basicWalkableArea=this.initlizeBasicArea(),this.originalArea(this._basicWalkableArea,this._walkableArea,this._collisionOriginPoint)),i.collisionArea&&(this._collisionArea=a.default.stringToArray(i.collisionArea,",","&"),this._basicCollisionArea=this.initlizeBasicArea(),this.originalArea(this._basicCollisionArea,this._collisionArea,this._collisionOriginPoint));for(var n=0;n<this._frameName.length;n++)this.frameData[n]={name:this._frameName[n],image:void 0}},e.prototype.cutBaseArea=function(){this._basicCollisionArea&&(this._collisionArea=[],this._collisionOriginPoint=Object.assign({},this.centerPoint),this._collisionArea=this.filterArea(this._basicCollisionArea,this._collisionOriginPoint)),this._basicWalkableArea&&(this._walkableArea=[],this._walkableArea=this.filterArea(this.basicWalkableArea))},Object.defineProperty(e.prototype,"originPoint",{get:function(){return this._collisionOriginPoint||(this._collisionOriginPoint={x:0,y:0}),this._collisionOriginPoint},set:function(t){this._collisionOriginPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameRate",{get:function(){return this._frameRate},set:function(t){this._frameRate=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseLoc",{get:function(){return this._baseLoc},set:function(t){this._baseLoc=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameData",{get:function(){return this._frameData},enumerable:!0,configurable:!0}),e.prototype.addFrame=function(t){this._frameData.push(t)},e.prototype.addFrameAt=function(t,e){e<0&&(e=0),e>this._frameData.length&&(e=this._frameData.length),this._frameData.splice(e,0,t)},e.prototype.removeFrame=function(t){var e=this._frameData.indexOf(t);e>-1&&this._frameData.splice(e,1)},e.prototype.removeFrameByName=function(t){this._frameData=this.frameData.filter(function(e){return e.name!==t})},e.prototype.clearFrameData=function(){this._frameData.length=0},Object.defineProperty(e.prototype,"selectedFrame",{get:function(){return this._selectedFrame},set:function(t){this._selectedFrame=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},set:function(t){this._playing=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"basicCollisionArea",{get:function(){return this._basicCollisionArea&&0!==this._basicCollisionArea.length||(this._basicCollisionArea=this.initlizeBasicArea()),this._basicCollisionArea},enumerable:!0,configurable:!0}),e.prototype.setBasicCollisionArea=function(t,e,i){t<0||t>this.areaRows||e<0||e>this.areaCols||this._basicCollisionArea&&(this._basicCollisionArea[t][e]=i)},Object.defineProperty(e.prototype,"basicWalkableArea",{get:function(){return this._basicWalkableArea&&0!==this._basicWalkableArea.length||(this._basicWalkableArea=this.initlizeBasicArea()),this._basicWalkableArea},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameName",{get:function(){return this._frameName},set:function(t){this._frameName=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collisionArea",{get:function(){return this._collisionArea},set:function(t){this._collisionArea=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"walkableArea",{get:function(){return this._walkableArea},set:function(t){this._walkableArea=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collisionOriginPoint",{get:function(){return this._collisionOriginPoint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"walkableOriginPoint",{get:function(){return this._walkableOriginPoint},enumerable:!0,configurable:!0}),e.prototype.setBasicWalkableArea=function(t,e,i){t<0||t>this.areaRows||e<0||e>this.areaCols||this._basicWalkableArea&&(this._basicWalkableArea[t][e]=i)},e.prototype.convertToClientObject=function(t){var e=o.op_gameconfig.Animation.create();return e.id=this.id,e.name=this.name,e.frameRate=this._frameRate,e.loop=this._loop||!1,e.frameName=this._frameName||[],e.baseLoc=this.baseLoc.x+","+this.baseLoc.y,e.walkOriginPoint=[this.originPoint.y,this.originPoint.x],e.originPoint=[this.originPoint.y,this.originPoint.x],this._walkableArea?e.walkableArea=a.default.arrayToString(this._walkableArea,",","&"):e.walkableArea="",this._collisionArea?e.collisionArea=a.default.arrayToString(this._collisionArea,",","&"):e.collisionArea="",e},e.prototype.geneSequence=function(){var t=""+this.name+this._frameRate+this._frameName.join("");return t+=JSON.stringify(this.baseLoc),t+=JSON.stringify(this.originPoint),this._collisionArea&&(t+=JSON.stringify(this._collisionArea)),this._walkableArea&&(t+=JSON.stringify(this._walkableArea)),t},e.prototype.filterArea=function(t,e){var i=t.slice();return this.removeHeadRows(i,e),this.removeHeadCols(i,e),this.removeTailRows(i),this.removeTailCols(i),i},e.prototype.originalArea=function(t,e,i){if(t&&e){i=i||{x:0,y:0};for(var r=this.centerPoint.x-i.x,n=this.centerPoint.y-i.y,s=0;s<e.length;s++)for(var a=0;a<e[0].length;a++)t.length>s+r&&t[s].length>a+n&&(t[s+r][a+n]=e[s][a])}},e.prototype.removeHeadRows=function(t,e){var i=0;if(this._collisionArea&&this._collisionArea.length&&this._collisionOriginPoint)return i=this.centerPoint.x-this._collisionOriginPoint.x,void t.splice(0,i);for(var r=t.slice(i,this.centerPoint.x),n=r.length,s=0;s<n;++s){if(r[s].find(function(t){return t>0}))return;t.shift(),e&&(e.x-=1)}},e.prototype.removeTailRows=function(t){var e=0;this._collisionArea&&this._collisionArea.length>0&&(e=this._collisionArea.length-1);for(var i=t.slice(1),r=i.length-1;r>=e;r--){if(i[r].find(function(t){return t>0})&&0===e)return;t.pop()}},e.prototype.removeHeadCols=function(t,e){var i=-1;if(this._collisionArea&&this._collisionArea.length&&this._collisionOriginPoint&&(i=this.centerPoint.y-this._collisionOriginPoint.y),i<1)for(var r=0;r<t.length;++r){var n=t[r].findIndex(function(t){return t>0});n>-1&&n<this.centerPoint.x&&(i<0&&(i=n),i=Math.min(i,n))}if((i<0||NaN===i)&&(i=this.centerPoint.x),i>-1){for(r=0;r<t.length;++r)t[r]=t[r].slice(i);e&&(e.y-=i)}},e.prototype.removeTailCols=function(t){var e=0;if(this._collisionArea&&this._collisionArea.length>0)e=this._collisionArea[0].length;else for(var i=0;i<t.length;++i){var r=t[i],n=r.slice().reverse().findIndex(function(t){return t>0});n>-1&&(n=r.length-n,e=Math.max(e,n))}if(e<1&&(e=1),t[0].length>e)for(i=0;i<t.length;++i)t[i]=t[i].slice(0,e)},e.prototype.initlizeBasicArea=function(){for(var t=[],e=0;e<this.areaRows;e++){t[e]=[];for(var i=0;i<this.areaCols;i++)t[e][i]=0}return t},e.prototype.duplicate=function(i){t.prototype.duplicate.call(this,i),i instanceof e&&(this._loop=i.loop,this._baseLoc=i.baseLoc,this._frameName=i.frameName,this._frameRate=i.frameRate,this._collisionArea=i.collisionArea,this._collisionOriginPoint=i.collisionOriginPoint,this._walkableArea=i.walkableArea,this._walkableOriginPoint=i.walkableOriginPoint)},e}(s.BaseConfigObject);e.AnimationDataNode=c},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(50),o=i(4).op_def.NodeType,h=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._items=[],r.name="",r}return n(e,t),e.prototype.ignore=function(){},e.prototype.appendNode=function(e){try{t.prototype.appendNode.call(this,e)}catch(t){}e instanceof a.AccessNode&&(this._access=e),e.type===o.PackageItemType&&this._items.push(e)},e.prototype.removeNode=function(e){t.prototype.removeNode.call(this,e),e instanceof a.AccessNode&&(this._access=void 0),a.AccessNode},e}(s.EntityNode);e.default=h;var l=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.name="",r}return n(e,t),e.prototype.ignore=function(){},e}(s.EntityNode);e.PackageItemNode=l},function(t,e){t.exports=function(t,e,i){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1!==e.indexOf(".")){for(var r=e.split("."),n=t,s=i,a=0;a<r.length;a++){if(!n.hasOwnProperty(r[a])){s=i;break}s=n[r[a]],n=n[r[a]]}return s}return i}return i}},,,,,,,,,,function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(24),a=i(91),o=i(4),h=i(140),l=i(19),c=i(19),u=i(20),p=i(141),d=o.op_gameconfig_01.Game,f=o.op_def.NodeType,m=function(t){function e(){var e=t.call(this)||this;return e._families=new Map,e._ignore_serialize=new Map,e.add=new a.default(e),e._root=new c.GameNode(e),e}return n(e,t),e.prototype.resetPreprocessedData=function(){this._families=new Map,this._ignore_serialize=new Map},Object.defineProperty(e.prototype,"families",{get:function(){return this._families},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ignoreList",{get:function(){return this._ignore_serialize},enumerable:!0,configurable:!0}),e.prototype.serialize=function(){var t=this;if(!this._root)throw new Error("Capsule::serialize() Error: Empty root node, aka GameNode.");var e=this._bin_conf=d.create();return this._root.serialize(e),this.resetPreprocessedData(),this._objects.forEach(function(t){t.preSerialize()}),this._objects.forEach(function(i){t._ignore_serialize.get(i.id)||i.serialize(e)}),d.encode(this._bin_conf).finish()},e.prototype.deserialize=function(t){var e=d.decode(t),i=d.toObject(e),r=[];this._root.deserialize(e);for(var n=0,s=Object.keys(i);n<s.length;n++){var a=i[s[n]];if(Array.isArray(a))for(var o=0,h=a;o<h.length;o++){(u=h[o]).node.type==f.ForkType?r.push(u):this.doDeserialize(u)}}for(var l=0,c=r;l<c.length;l++){var u=c[l];this.doDeserialize(u)}this._objects.forEach(function(t){t.link()})},e.prototype.doDeserialize=function(t){if(t.hasOwnProperty("node")){var e=t.node.type,i=u.default.NODE_T[e]||"";if(l.hasOwnProperty(i))new l[i](this).deserialize(t)}},Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.getObjectBySN=function(t){for(var e=0,i=this.objectsList;e<i.length;e++){var r=i[e];if(t===r.sn)return r}},e.prototype.getAllChildrenIds=function(t){var e=[],i=function(t){if(t.children&&t.children.length>0)for(var r=0,n=t.children;r<n.length;r++){var s=n[r];e.push(s.id),i(s)}};return i(t),e},e.prototype.deduplicateNodes=function(t){for(var e={},i=0,r=t;i<r.length;i++){(a=r[i]).ids=this.getAllChildrenIds(a),e[a.id]=a}for(var n=0,s=t;n<s.length;n++)for(var a,o=0,h=(a=s[n]).ids;o<h.length;o++){var l=h[o];e[l]&&delete e[l]}return Object.values(e)},e.prototype.export=function(t){t=this.deduplicateNodes(t);for(var i=new e,r=function(t,e){var n=s.clone(t);e&&(n.parent=e),i.addObject(n);for(var a=0,o=t.children;a<o.length;a++){var h=o[a];r(h)}},n=0,a=t;n<a.length;n++){var o=a[n];r(o,i.root.id)}return i},e.prototype.import=function(t,i){var r=[],n=new e;n.deserialize(t.serialize());for(var s=0,a=n.objectsList;s<a.length;s++){(c=a[s]).parent===n.root.id&&c.renewId()}for(var o=i||this.root,h=0,l=n.objectsList;h<l.length;h++){var c;(c=l[h]).parent===n.root.id&&(c.parent=o.id),c.cap=this,this.addObject(c),r.push(c.id)}return r},e.prototype.clone=function(t,e,i){void 0===i&&(i=!1);var r=this.getObject(t);if(r){var n=new l[r.className](this);n.parentObject=e,n.duplicate(r),this.addObject(n);for(var s=0,a=r.children;s<a.length;s++){var o=a[s];if(!(o instanceof c.ForkNode)||i){var h=this.clone(o.id,n);h&&h.link()}}return n}console.error("Origin object["+t+"] does not exist.")},e.prototype.inspect=function(){var t=this,e=function(i){var r=t.getObject(i);if(r){for(var n={},s=0,a=r.children;s<a.length;s++){var o=a[s];n[o.className+"["+o.id+"]"]=e(o.id)}return n}},i={};i[t.root.className+"["+t.root.id+"]"]=e(t.root.id),console.log("Capsule"),console.log(p.asTree(i,!0,!0))},e}(h.default);e.default=m},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(44),n=i(20),s=i(15),a=(new r,function(){function t(t){this._id=s.default.genId(),this._parent=0,this._sn="",this._type=0,this._cap=t,this._name="Object-"+this.id}return Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cap",{get:function(){return this._cap},set:function(t){this._cap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metaData",{get:function(){return{id:this._id,name:this._name,Parent:this._parent,sn:this._sn,type:this.type}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return s.default.getClassName(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parentObject",{get:function(){if(this.parent)return this.cap.getObject(this.parent)},set:function(t){t&&(this.parent=t.id)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sn",{get:function(){return this._sn},set:function(t){this._sn=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeType",{get:function(){if(n.default.NODETYPEMAP[this.type])return this.type;throw new Error("This Config object does not match any of type list in NodeType!")},enumerable:!0,configurable:!0}),t.prototype.makeNode=function(){var t=this;return new(function(){return function(){this.LockParent=null,this.Parent=t.parent,this.id=t.id,this.name=t.name,this.sn=t.sn,this.type=t.nodeType}}())},t.prototype.setNode=function(t){t.hasOwnProperty("Parent")&&(this._parent=t.Parent),t.hasOwnProperty("id")&&(this._id=t.id),this._sn=t.sn||"",t.hasOwnProperty("name")&&(this._name=t.name)},t.prototype.destroy=function(){},t}());e.default=a},,,,function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(4),a=i(27),o=i(28),h=i(6),l=i(15),c=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"animations",{get:function(){return this._animations||(this._animations=this.cap.add.animations(this)),this._animations},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"location",{get:function(){return this._location||(this._location=this.cap.add.location(this)),this._location},enumerable:!0,configurable:!0}),e.prototype.appendNode=function(e){try{t.prototype.appendNode.call(this,e)}catch(t){console.error(t)}e instanceof a.default&&(this._location=e),e instanceof o.default&&(this._animations=e)},e.prototype.removeNode=function(e){try{t.prototype.removeNode.call(this,e)}catch(t){console.error(t)}e instanceof a.default&&(this._location=void 0),e instanceof o.default&&(this._animations=void 0)},e.prototype.convertToClientElement=function(){var t=s.op_client.Element.create();if(t.id=this.id,t.type=s.op_def.NodeType[this.type],this.location){var e=this.location,i=e.x,r=e.y,n=e.z;t.x=i,t.y=r,n&&(t.z=n)}if(this._animations){t.animationName=this._animations.defaultAnimationName,t.scale=this._animations.scale||!1,this._animations.animationData&&this._animations.dir&&(t.dir=this._animations.dir),this._animations.display&&(t.display=s.op_gameconfig.Display.create(),t.display.dataPath=this.animations.display.dataPath,t.display.texturePath=this.animations.display.texturePath);var a=this._animations.animationData;t.animations=[];for(var o=0,h=a;o<h.length;o++){var l=h[o];t.animations.push(l.convertToClientObject(this._animations.scale))}}return t},e.prototype.geneSequence=function(){var e=t.prototype.geneSequence.call(this);e+=this.parent,this._location&&(e+=this._location.geneSequence()),this._animations&&(e+=this._animations.geneSequence());for(var i=0,r=this.cap.getChildrenList(this.id);i<r.length;i++){var n=r[i];n instanceof h.BaseConfigObject&&(e+=n.geneSequence())}return l.default.sha1(e)},e.prototype.preSerialize=function(){var t=this.geneSequence();if(this.cap.families.get(t)){for(var e=0,i=this.children;e<i.length;e++){i[e].ignore()}this._fork=!0}else this.cap.families.set(t,this.id),this._fork=!1;(!this.animations||this.animations.animationData.length<1)&&(console.warn(this.name+" data error, has been deleted. sn: "+this.sn),this.cap.removeObject(this))},e.prototype.createProtocolObject=function(){var t=s.op_gameconfig_01.Entity.create();t.node=this.makeNode();this.cap.families.get(this.geneSequence());if(this._fork){var e=this.cap.families.get(this.geneSequence());if(!e)return;t.node.type=s.op_def.NodeType.ForkType,t.node.Parent=e}return t},Object.defineProperty(e.prototype,"thumb",{get:function(){return this._thumb},set:function(t){this._thumb=t},enumerable:!0,configurable:!0}),e}(h.EntityNode);e.default=c},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=i(15),h=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._texturePath="",r._dataPath="",r.name="",r}return n(e,t),e.prototype.ignore=function(){t.prototype.ignore.call(this),this.cap.ignoreList.set(this.id,this.id)},Object.defineProperty(e.prototype,"properties",{get:function(){return{texturePath:this._texturePath,dataPath:this._dataPath}},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return t.display||(t.display=[]),t.display},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Display.create();return t.node=this.makeNode(),t.texturePath=this._texturePath,t.dataPath=this._dataPath,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._dataPath=i.dataPath||"",this._texturePath=i.texturePath||""},Object.defineProperty(e.prototype,"texturePath",{get:function(){return this._texturePath},set:function(t){this._texturePath=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataPath",{get:function(){return this._dataPath},set:function(t){this._dataPath=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataJSON",{get:function(){return this._dataJSON},set:function(t){this._dataJSON=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureBuffer",{get:function(){return this._textureBuffer},set:function(t){this._textureBuffer=t},enumerable:!0,configurable:!0}),e.prototype.geneSequence=function(){return o.default.sha1(this._dataPath+"&"+this._texturePath)},e.prototype.duplicate=function(i){t.prototype.duplicate.call(this,i),i instanceof e&&(this._dataPath=i.dataPath,this._texturePath=i.texturePath)},e}(s.BaseConfigObject);e.default=h},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s,a=i(6),o=i(4),h=i(24),l=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._sets=[],r._parts={},r._dir=s.Front,r._animations=["stand","walk","sit","run","jump","attack"],r._curAnimationIndex=0,r._dbName="bones_allblue",r._armatureName="Armature",r._dircy=!1,r.name="",r._backMap={},r._backMap.head_hair=["head_hair","head_back"],r._backMap.body_cost=["body_cost","body_dres"],r.defaultCostume(),r}return n(e,t),e.prototype.merge=function(t){for(var e=0;e<t.length;e++){var i=function(i){if(r._backMap.hasOwnProperty(i))for(var n=function(t){t===i&&(h.remove(r._sets,function(e){return t===i}),r._parts=h.omit(r._parts,r._backMap[i]))},s=0,a=t[e].parts;s<a.length;s++){n(a[s])}},r=this;for(var n in this._backMap)i(n)}this._sets=this._sets.concat(t);for(var s=0,a=this._sets;s<a.length;s++)for(var o=a[s],l=0,c=o.parts;l<c.length;l++){var u=c[l];this._parts[u]=o}this._dircy=!0},Object.defineProperty(e.prototype,"parts",{get:function(){return this._parts},enumerable:!0,configurable:!0}),e.prototype.resources=function(t){var e=[],i=this._parts;for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];n.hasOwnProperty("localImages")||1===t&&"head_eyes"===r||1===t&&"head_mous"===r||("head_back"===r?e.push(this.relativeUri("head_hair",n.id,t,"back")):"body_dres"===r?e.push(this.relativeUri("body_cost",n.id,t,"dres")):e.push(this.relativeUri(r,n.id,t)))}return e},e.prototype.relativeUri=function(t,e,i,r){return r?"/avatar/part/"+t+"_"+e+"_"+i+"_"+r+".png":"/avatar/part/"+t+"_"+e+"_"+i+".png"},e.prototype.findMyContainer=function(t){return Array.isArray(t.avatar)||(t.avatar=[]),t.avatar},e.prototype.createProtocolObject=function(){var t=o.op_gameconfig_01.Avatar.create();t.node=this.makeNode(),t.defaultDir=this._dir;var e=/[_]\w/;for(var i in this.parts){t[i.replace(e,function(t){return t.length>1?t[1].toUpperCase():t})+"Id"]=this.parts[i].id}return t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._dir=i.defaultDir,i.backboneId&&(this._parts.head_eyes={id:i.backboneId,parts:["head_eyes"]}),i.barmBaseId&&(this._parts.barm_base={id:i.barmBaseId,parts:["barm_base"]}),i.barmCostId&&(this._parts.barm_cost={id:i.barmCostId,parts:["barm_cost"]}),i.barmShldId&&(this._parts.barm_shld={id:i.barmShldId,parts:["barm_shld"]}),i.barmSpecId&&(this._parts.barm_spec={id:i.barmSpecId,parts:["barm_spec"]}),i.barmWeapId&&(this._parts.barm_weap={id:i.barmWeapId,parts:["barm_weap"]}),i.blegBaseId&&(this._parts.bleg_base={id:i.blegBaseId,parts:["bleg_base"]}),i.blegCostId&&(this._parts.bleg_cost={id:i.blegCostId,parts:["bleg_cost"]}),i.blegSpecId&&(this._parts.bleg_spec={id:i.blegSpecId,parts:["bleg_spec"]}),i.bodyBaseId&&(this._parts.body_base={id:i.bodyBaseId,parts:["body_base"]}),i.bodyCostId&&(this._parts.body_cost={id:i.bodyCostId,parts:["body_cost"]}),i.bodyDresId&&(this._parts.body_dres={id:i.bodyDresId,parts:["body_dres"]}),i.bodySpecId&&(this._parts.body_spec={id:i.bodySpecId,parts:["body_spec"]}),i.bodyTailId&&(this._parts.body_tail={id:i.bodyTailId,parts:["body_tail"]}),i.bodyWingId&&(this._parts.body_wing={id:i.bodyWingId,parts:["body_wing"]}),i.farmBaseId&&(this._parts.farm_base={id:i.farmBaseId,parts:["farm_base"]}),i.farmCostId&&(this._parts.farm_cost={id:i.farmCostId,parts:["farm_cost"]}),i.farmShldId&&(this._parts.farm_shld={id:i.farmShldId,parts:["farm_shld"]}),i.farmWeapId&&(this._parts.farm_weap={id:i.farmWeapId,parts:["farm_weap"]}),i.flegBaseId&&(this._parts.fleg_base={id:i.flegBaseId,parts:["fleg_base"]}),i.flegCostId&&(this._parts.fleg_cost={id:i.flegCostId,parts:["fleg_cost"]}),i.flegSpecId&&(this._parts.fleg_spec={id:i.flegSpecId,parts:["fleg_spec"]}),i.headBackId&&(this._parts.head_back={id:i.headBackId,parts:["head_back"]}),i.headBaseId&&(this._parts.head_base={id:i.headBaseId,parts:["head_base"]}),i.headEyesId&&(this._parts.head_eyes={id:i.headEyesId,parts:["head_eyes"]}),i.headHairId&&(this._parts.head_hair={id:i.headHairId,parts:["head_hair"]}),i.headHatsId&&(this._parts.head_hats={id:i.headHatsId,parts:["head_hats"]}),i.headMaskId&&(this._parts.head_mask={id:i.headMaskId,parts:["head_mask"]}),i.headMousId&&(this._parts.head_mous={id:i.headMousId,parts:["head_mous"]}),i.headSpecId&&(this._parts.head_spec={id:i.headSpecId,parts:["head_spec"]})},e.prototype.clearParts=function(){this._parts={},this._sets.length=0,this.defaultCostume(),this._dircy=!0},Object.defineProperty(e.prototype,"dir",{get:function(){return this._dir},set:function(t){this._dir=t,this._dircy=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dircy},set:function(t){this._dircy=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curAnimationIndex",{get:function(){return this._curAnimationIndex},set:function(t){(t<0||t>=this._animations.length)&&(t=0),this._curAnimationIndex=t,this._dircy=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"armatureName",{get:function(){return this._armatureName},set:function(t){this._armatureName=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dbName",{get:function(){return this._dbName},set:function(t){this._dbName=t},enumerable:!0,configurable:!0}),e.prototype.getCurAnimation=function(t){return this._animations[this._curAnimationIndex]+"_"+(t||this._dir)},e.prototype.defaultCostume=function(){this.merge([{id:"0001",parts:["head_base"]},{id:"5cd28238fb073710972a73c2",parts:["head_hair"]},{id:"5cd28238fb073710972a73c2",parts:["head_eyes"]},{id:"5cd28238fb073710972a73c2",parts:["head_mous"]},{id:"0001",parts:["body_base"]},{id:"5cd28238fb073710972a73c2",parts:["body_cost"]},{id:"0001",parts:["farm_base"]},{id:"0001",parts:["barm_base"]},{id:"0001",parts:["fleg_base"]},{id:"0001",parts:["bleg_base"]},{id:"0001",parts:["farm_base"]}])},e}(a.BaseConfigObject);e.default=l,function(t){t[t.Back=1]="Back",t[t.Front=3]="Front"}(s=e.AvatarDirEnum||(e.AvatarDirEnum={}))},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._access=1,r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{access:this._access}},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.access)||(t.access=[]),t.access},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Access.create();return t.node=this.makeNode(),t.access=this._access,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._access=i.access},e}(s.BaseConfigObject);e.AccessNode=o},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._elements=new Map,r._terrains=new Map,r._characters=new Map,r._spawnpoints=new Map,r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._map_size},enumerable:!0,configurable:!0}),e.prototype.appendNode=function(e){try{t.prototype.appendNode.call(this,e)}catch(t){console.error(t)}switch(e.type){case a.op_def.NodeType.ElementNodeType:this._elements.set(e.id,e);break;case a.op_def.NodeType.TerrainNodeType:this._terrains.set(e.id,e);break;case a.op_def.NodeType.CharacterNodeType:this._characters.set(e.id,e);break;case a.op_def.NodeType.SpawnPointType:this._spawnpoints.set(e.id,e),!1==!!this._cap.root.settings.spawnpoint&&(this._cap.root.settings.spawnpoint=e.id)}e instanceof h&&(this._map_size=e)},e.prototype.removeNode=function(e){try{t.prototype.removeNode.call(this,e)}catch(t){console.error(t)}switch(e instanceof h&&(this._map_size=void 0),e.type){case a.op_def.NodeType.ElementNodeType:this._elements.delete(e.id);break;case a.op_def.NodeType.TerrainNodeType:this._terrains.delete(e.id);break;case a.op_def.NodeType.CharacterNodeType:this._characters.delete(e.id);break;case a.op_def.NodeType.SpawnPointType:this._spawnpoints.delete(e.id),this._cap.root.settings.spawnpoint===e.id&&(this._cap.root.settings.spawnpoint=0)}},e.prototype.getElements=function(){return Array.from(this._elements.values())},e.prototype.getTerrains=function(){return Array.from(this._terrains.values())},e.prototype.getTerrainByLoc=function(t,e,i){if(i)for(var r=0,n=this.getTerrains();r<n.length;r++){if((o=n[r]).location.x===t&&o.location.y===e&&o.location.z===i)return o}else for(var s=0,a=this.getTerrains();s<a.length;s++){var o;if((o=a[s]).location.x===t&&o.location.y===e)return o}},e.prototype.getCharacterNode=function(){return Array.from(this._characters.values())},e.prototype.getSpawnPointNode=function(){return Array.from(this._spawnpoints.values())},e.prototype.convertToClientScene=function(){var t=a.op_client.Scene.create();return t.id=this.id,this._map_size&&(t.cols=this._map_size.cols,t.rows=this._map_size.rows,t.tileWidth=this._map_size.tileWidth,t.tileHeight=this._map_size.tileHeight),this._elements&&(t.elements=[],this._elements.forEach(function(e){t.elements.push(e.convertToClientElement())})),this._terrains&&(t.terrains=[],this._terrains.forEach(function(e){t.terrains.push(e.convertToClientTerrain())})),this._spawnpoints&&(t.elements||(t.elements=[]),this._spawnpoints.forEach(function(e){t.elements.push(e.convertToClientElement())})),t},e}(s.EntityNode);e.default=o;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._cols=0,e._rows=0,e._tileWidth=60,e._tileHeight=30,e}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{cols:this._cols,rows:this._rows,tileWidth:this._tileWidth,tileHeight:this._tileHeight}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},set:function(t){this._rows=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cols",{get:function(){return this._cols},set:function(t){this._cols=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileWidth",{get:function(){return this._tileWidth},set:function(t){this._tileWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileHeight",{get:function(){return this._tileHeight},set:function(t){this._tileHeight=t},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.mapSize)||(t.mapSize=[]),t.mapSize},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.MapSize.create();return t.node=this.makeNode(),t.cols=this._cols,t.rows=this._rows,t.tileWidth=this._tileWidth,t.tileHeight=this._tileHeight,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._rows=i.rows,this._cols=i.cols,this._tileWidth=i.tileWidth,this._tileHeight=i.tileHeight},e}(s.BaseConfigObject);e.MapSizeNode=h},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=i(49),h=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"camp",{get:function(){return this._camp||this.cap.add.camp(1,this)},enumerable:!0,configurable:!0}),e.prototype.appendNode=function(e){try{t.prototype.appendNode.call(this,e)}catch(t){console.error(t)}e instanceof l&&(this._camp=e),e instanceof o.default&&(this._avatar=e)},e.prototype.removeNode=function(e){try{t.prototype.removeNode.call(this,e)}catch(t){console.error(t)}e instanceof l&&(this._camp=void 0),e instanceof o.default&&(this._avatar=void 0)},e}(s.EntityNode);e.default=h;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{maxNumber:this._maxNumber}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPlayers",{get:function(){return this._maxNumber||0},set:function(t){this._maxNumber=t},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.camp)||(t.camp=[]),t.camp},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Camp.create();return t.node=this.makeNode(),t.maxNumber=this._maxNumber||0,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;i.maxNumber&&(this._maxNumber=i.maxNumber)},e}(s.BaseConfigObject);e.CampNode=l},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),s=this&&this.__rest||function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&(i[r[n]]=t[r[n]])}return i};Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.name="",r}return n(e,t),e.prototype.convertToClientTerrain=function(){var e=t.prototype.convertToClientElement.call(this);e.dir;return s(e,["dir"])},e}(i(47).default);e.TerrainNode=a},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=a.op_def.NodeType,h=i(29),l=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._items=[],r.name="",r}return n(e,t),e.prototype.ignore=function(){},e.prototype.appendNode=function(e){try{t.prototype.appendNode.call(this,e)}catch(t){}e.type===o.PackageItemType&&this._items.push(e)},e}(s.EntityNode);e.default=l;var c=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.name="",r.type=a.op_def.NodeType.PackageItemType,r}return n(e,t),e.prototype.appendNode=function(e){try{t.prototype.appendNode.call(this,e)}catch(t){e.type===o.CommodityType&&(this._commodity=e)}},e}(h.PackageItemNode);e.ShopItemNode=c;var u=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._price=100,r._des="",r._coinType=a.op_def.CoinType.TU_DING_COIN,r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{price:this.price,description:this.description}},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return t.commodities||(t.commodities=[]),t.commodities},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Commodity.create();return t.node=this.makeNode(),t.description=this._des,t.coinType=this._coinType,t.price=this._price,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._price=i.price||100,this._des=i.description||"",this._coinType=i.coinType||a.op_def.CoinType.TU_DING_COIN},Object.defineProperty(e.prototype,"price",{get:function(){return this._price},set:function(t){if(this.coinType===a.op_def.CoinType.TU_DING_COIN&&(t<10||t>99999))throw new Error("10-99999");this._price=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._des},set:function(t){this._des=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"coinType",{get:function(){return this._coinType},enumerable:!0,configurable:!0}),e}(s.BaseConfigObject);e.CommodityNode=u},,function(t,e,i){(function(e){t.exports=e.dragonBones=i(57)}).call(this,i(13))},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])});!function(t){var e=function(){function e(i){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=i,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return e.prototype.advanceTime=function(e){if(this._objects.length>0){for(var i=0,r=this._objects;i<r.length;i++){r[i].returnToPool()}this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var n=0;n<this._events.length;++n){var s=this._events[n],a=s.armature;null!==a._armatureData&&(a.eventDispatcher.dispatchDBEvent(s.type,s),s.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(s.type,s)),this.bufferObject(s)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.7.000",e.yDown=!0,e.debug=!1,e.debugDraw=!1,e}();t.DragonBones=e}(l||(l={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return(new Date).getTime()});var s,a,o,h,l,c;n=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i};if(void 0===u&&"undefined"!=typeof window)var u=window;t.exports=l,function(t){var e=function(){function t(){this.hashCode=t._hashCode++,this._isInPool=!1}return t._returnObject=function(e){var i=String(e.constructor),r=i in t._maxCountMap?t._maxCountMap[i]:t._defaultMaxCount,n=t._poolsMap[i]=t._poolsMap[i]||[];n.length<r&&(e._isInPool?console.warn("The object is already in the pool."):(e._isInPool=!0,n.push(e)))},t.toString=function(){throw new Error},t.setMaxCount=function(e,i){if((i<0||i!=i)&&(i=0),null!==e)null!==(n=(r=String(e))in t._poolsMap?t._poolsMap[r]:null)&&n.length>i&&(n.length=i),t._maxCountMap[r]=i;else for(var r in t._defaultMaxCount=i,t._poolsMap){var n;(n=t._poolsMap[r]).length>i&&(n.length=i),r in t._maxCountMap&&(t._maxCountMap[r]=i)}},t.clearPool=function(e){if(void 0===e&&(e=null),null!==e){var i=String(e);null!==(n=i in t._poolsMap?t._poolsMap[i]:null)&&n.length>0&&(n.length=0)}else for(var r in t._poolsMap){var n;(n=t._poolsMap[r]).length=0}},t.borrowObject=function(e){var i=String(e),r=i in t._poolsMap?t._poolsMap[i]:null;if(null!==r&&r.length>0){var n=r.pop();return n._isInPool=!1,n}var s=new e;return s._onClear(),s},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=3e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=e}(l||(l={})),function(t){var e=function(){function t(t,e,i,r,n,s){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===n&&(n=0),void 0===s&&(s=0),this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,i=0,r=0,n=this.d*t.d,s=this.tx*t.a+t.tx,a=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,r+=this.c*t.a,n+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,r+=this.d*t.c,s+=this.ty*t.c,a+=this.tx*t.b),this.a=e,this.b=i,this.c=r,this.d=n,this.tx=s,this.ty=a,this},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,s=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===r?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,r=this.d=1/r,this.tx=-t*n,this.ty=-r*s),this;var a=t*r-e*i;if(0===a)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;a=1/a;var o=this.a=r*a;return e=this.b=-e*a,i=this.c=-i*a,r=this.d=t*a,this.tx=-(o*n+i*s),this.ty=-(e*n+r*s),this},t.prototype.transformPoint=function(t,e,i,r){void 0===r&&(r=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,r||(i.x+=this.tx,i.y+=this.ty)},t.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var i=this.a,r=this.b,n=this.c,s=this.d,a=e?0:this.tx,o=e?0:this.ty,h=t.x,l=t.y,c=h+t.width,u=l+t.height,p=i*h+n*l+a,d=r*h+s*l+o,f=i*c+n*l+a,m=r*c+s*l+o,g=i*c+n*u+a,_=r*c+s*u+o,y=i*h+n*u+a,v=r*h+s*u+o,b=0;p>f&&(b=p,p=f,f=b),g>y&&(b=g,g=y,y=b),t.x=Math.floor(p<g?p:g),t.width=Math.ceil((f>y?f:y)-t.x),d>m&&(b=d,d=m,m=b),_>v&&(b=_,_=v,v=b),t.y=Math.floor(d<_?d:_),t.height=Math.ceil((m>v?m:v)-t.y)},t}();t.Matrix=e}(l||(l={})),function(t){var e=function(){function t(t,e,i,r,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===s&&(s=1),this.x=t,this.y=e,this.skew=i,this.rotation=r,this.scaleX=n,this.scaleY=s}return t.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},t.prototype.fromMatrix=function(e){var i=this.scaleX,r=this.scaleY,n=t.PI_Q;this.x=e.tx,this.y=e.ty,this.rotation=Math.atan(e.b/e.a);var s=Math.atan(-e.c/e.d);return this.scaleX=this.rotation>-n&&this.rotation<n?e.a/Math.cos(this.rotation):e.b/Math.sin(this.rotation),this.scaleY=s>-n&&s<n?e.d/Math.cos(s):-e.c/Math.sin(s),i>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),r>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,s-=Math.PI),this.skew=s-this.rotation,this},t.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},t.PI=Math.PI,t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.RAD_DEG=180/Math.PI,t.DEG_RAD=Math.PI/180,t}();t.Transform=e}(l||(l={})),function(t){var e=function(){function t(t,e,i,r,n,s,a,o){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===r&&(r=1),void 0===n&&(n=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=r,this.alphaOffset=n,this.redOffset=s,this.greenOffset=a,this.blueOffset=o}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e}(l||(l={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e}(l||(l={})),function(t){var e=function(){function t(t,e,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===r&&(r=0),this.x=t,this.y=e,this.width=i,this.height=r}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e}(l||(l={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return n(e,t),e.toString=function(){return"[class dragonBones.UserData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.addInt=function(t){this.ints.push(t)},e.prototype.addFloat=function(t){this.floats.push(t)},e.prototype.addString=function(t){this.strings.push(t)},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},e}(t.BaseObject);t.UserData=e;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return n(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.ActionData=i}(l||(l={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return n(e,t),e.toString=function(){return"[class dragonBones.DragonBonesData]"},e.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.colorArray=null,this.userData=null},e.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},e.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},e}(t.BaseObject);t.DragonBonesData=e}(l||(l={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.aabb=new t.Rectangle,i.animationNames=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.constraints={},i.skins={},i.animations={},i.canvas=null,i.userData=null,i}return n(i,e),i.toString=function(){return"[class dragonBones.ArmatureData]"},i.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++){e[t].returnToPool()}for(var i=0,r=this.actions;i<r.length;i++){r[i].returnToPool()}for(var n in this.bones)this.bones[n].returnToPool(),delete this.bones[n];for(var n in this.slots)this.slots[n].returnToPool(),delete this.slots[n];for(var n in this.constraints)this.constraints[n].returnToPool(),delete this.constraints[n];for(var n in this.skins)this.skins[n].returnToPool(),delete this.skins[n];for(var n in this.animations)this.animations[n].returnToPool(),delete this.animations[n];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},i.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,r=0;for(this.sortedBones.length=0;r<t;){var n=e[i++];if(i>=t&&(i=0),!(this.sortedBones.indexOf(n)>=0)){var s=!1;for(var a in this.constraints){var o=this.constraints[a];if(o.root===n&&this.sortedBones.indexOf(o.target)<0){s=!0;break}}s||null!==n.parent&&this.sortedBones.indexOf(n.parent)<0||(this.sortedBones.push(n),r++)}}}},i.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},i.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,r=i.length;return i.length+=10,i[r]=t.a,i[r+1]=t.b,i[r+2]=t.c,i[r+3]=t.d,i[r+4]=t.tx,i[r+5]=t.ty,i[r+6]=e.rotation,i[r+7]=e.skew,i[r+8]=e.scaleX,i[r+9]=e.scaleY,r},i.prototype.getCacheFrame=function(t,e,i){var r=this.parent.cachedFrames;t.a=r[i],t.b=r[i+1],t.c=r[i+2],t.d=r[i+3],t.tx=r[i+4],t.ty=r[i+5],e.rotation=r[i+6],e.skew=r[i+7],e.scaleX=r[i+8],e.scaleY=r[i+9],e.x=t.tx,e.y=t.ty},i.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},i.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},i.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},i.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},i.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},i.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},i.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},i.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},i.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},i.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},i.prototype.getMesh=function(t,e,i){var r=this.getSkin(t);return null===r?null:r.getDisplay(e,i)},i.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},i}(t.BaseObject);t.ArmatureData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.userData=null,i}return n(i,e),i.toString=function(){return"[class dragonBones.BoneData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.alpha=1,this.name="",this.transform.identity(),this.userData=null,this.parent=null},i}(t.BaseObject);t.BoneData=i;var r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.geometry=new t.GeometryData,i}return n(i,e),i.toString=function(){return"[class dragonBones.SurfaceData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.geometry.clear()},i}(i);t.SurfaceData=r;var s=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return n(i,e),i.createColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.zIndex=0,this.alpha=1,this.name="",this.color=null,this.userData=null,this.parent=null},i.DEFAULT_COLOR=new t.ColorTransform,i}(t.BaseObject);t.SlotData=s}(l||(l={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},e}(t.BaseObject);t.ConstraintData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},e}(e);t.IKConstraintData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return n(e,t),e.toString=function(){return"[class dragonBones.PathConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},e.prototype.AddBone=function(t){this.bones.push(t)},e}(e);t.PathConstraintData=r}(l||(l={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.CanvasData]"},e.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},e}(t.BaseObject);t.CanvasData=e}(l||(l={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return n(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){for(var t in this.displays){for(var e=0,i=this.displays[t];e<i.length;e++){var r=i[e];null!==r&&r.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},e.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},e.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(null!==i)for(var r=0,n=i;r<n.length;r++){var s=n[r];if(null!==s&&s.name===e)return s}return null},e.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},e}(t.BaseObject);t.SkinData=e}(l||(l={})),function(t){var e=function(){function t(){this.weight=null}return t.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},t.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},Object.defineProperty(t.prototype,"vertexCount",{get:function(){return this.data.intArray[this.offset+0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"triangleCount",{get:function(){return this.data.intArray[this.offset+1]},enumerable:!0,configurable:!0}),t}();t.GeometryData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i}return n(i,e),i.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},i}(t.BaseObject);t.DisplayData=i;var r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.pivot=new t.Point,i}return n(i,e),i.toString=function(){return"[class dragonBones.ImageDisplayData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},i}(i);t.ImageDisplayData=r;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return n(e,t),e.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions;e<i.length;e++){i[e].returnToPool()}this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},e.prototype.addAction=function(t){this.actions.push(t)},e}(i);t.ArmatureDisplayData=s;var a=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i}return n(i,t),i.toString=function(){return"[class dragonBones.MeshDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.geometry.clear(),this.texture=null},i}(i);t.MeshDisplayData=a;var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return n(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},e}(i);t.BoundingBoxDisplayData=o;var h=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i.curveLengths=[],i}return n(i,t),i.toString=function(){return"[class dragonBones.PathDisplayData]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.geometry.clear(),this.curveLengths.length=0},i}(i);t.PathDisplayData=h;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return n(e,t),e.toString=function(){return"[class dragonBones.WeightData]"},e.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},e.prototype.addBone=function(t){this.bones.push(t)},e}(t.BaseObject);t.WeightData=l}(l||(l={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject);t.BoundingBoxData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},e._computeOutCode=function(t,e,i,r,n,s){var a=0;return t<i?a|=1:t>n&&(a|=2),e<r?a|=4:e>s&&(a|=8),a},e.rectangleIntersectsSegment=function(t,i,r,n,s,a,o,h,l,c,u){void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=null);var p=t>s&&t<o&&i>a&&i<h,d=r>s&&r<o&&n>a&&n<h;if(p&&d)return-1;for(var f=0,m=e._computeOutCode(t,i,s,a,o,h),g=e._computeOutCode(r,n,s,a,o,h);;){if(0==(m|g)){f=2;break}if(0!=(m&g))break;var _=0,y=0,v=0,b=0!==m?m:g;0!=(4&b)?(_=t+(r-t)*(a-i)/(n-i),y=a,null!==u&&(v=.5*-Math.PI)):0!=(8&b)?(_=t+(r-t)*(h-i)/(n-i),y=h,null!==u&&(v=.5*Math.PI)):0!=(2&b)?(y=i+(n-i)*(o-t)/(r-t),_=o,null!==u&&(v=0)):0!=(1&b)&&(y=i+(n-i)*(s-t)/(r-t),_=s,null!==u&&(v=Math.PI)),b===m?(t=_,i=y,m=e._computeOutCode(t,i,s,a,o,h),null!==u&&(u.x=v)):(r=_,n=y,g=e._computeOutCode(r,n,s,a,o,h),null!==u&&(u.y=v))}return f&&(p?(f=2,null!==l&&(l.x=r,l.y=n),null!==c&&(c.x=r,c.y=r),null!==u&&(u.x=u.y+Math.PI)):d?(f=1,null!==l&&(l.x=t,l.y=i),null!==c&&(c.x=t,c.y=i),null!==u&&(u.y=u.x+Math.PI)):(f=3,null!==l&&(l.x=t,l.y=i),null!==c&&(c.x=r,c.y=n))),f},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var r=.5*this.height;if(e>=-r&&e<=r)return!0}return!1},e.prototype.intersectsSegment=function(t,i,r,n,s,a,o){void 0===s&&(s=null),void 0===a&&(a=null),void 0===o&&(o=null);var h=.5*this.width,l=.5*this.height;return e.rectangleIntersectsSegment(t,i,r,n,-h,-l,h,l,s,a,o)},e}(e);t.RectangleBoundingBoxData=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.EllipseData]"},e.ellipseIntersectsSegment=function(t,e,i,r,n,s,a,o,h,l,c){void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=null);var u=a/o,p=u*u,d=i-t,f=(r*=u)-(e*=u),m=Math.sqrt(d*d+f*f),g=d/m,_=f/m,y=(n-t)*g+(s-e)*_,v=a*a,b=v-(t*t+e*e)+y*y,P=0;if(b>=0){var T=Math.sqrt(b),x=y-T,S=y+T,O=x<0?-1:x<=m?0:1,C=S<0?-1:S<=m?0:1,D=O*C;if(D<0)return-1;0===D&&(-1===O?(P=2,i=t+S*g,r=(e+S*_)/u,null!==h&&(h.x=i,h.y=r),null!==l&&(l.x=i,l.y=r),null!==c&&(c.x=Math.atan2(r/v*p,i/v),c.y=c.x+Math.PI)):1===C?(P=1,t+=x*g,e=(e+x*_)/u,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=t,l.y=e),null!==c&&(c.x=Math.atan2(e/v*p,t/v),c.y=c.x+Math.PI)):(P=3,null!==h&&(h.x=t+x*g,h.y=(e+x*_)/u,null!==c&&(c.x=Math.atan2(h.y/v*p,h.x/v))),null!==l&&(l.x=t+S*g,l.y=(e+S*_)/u,null!==c&&(c.y=Math.atan2(l.y/v*p,l.x/v)))))}return P},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var r=.5*this.height;if(e>=-r&&e<=r)return e*=i/r,Math.sqrt(t*t+e*e)<=i}return!1},e.prototype.intersectsSegment=function(t,i,r,n,s,a,o){return void 0===s&&(s=null),void 0===a&&(a=null),void 0===o&&(o=null),e.ellipseIntersectsSegment(t,i,r,n,0,0,.5*this.width,.5*this.height,s,a,o)},e}(e);t.EllipseBoundingBoxData=r;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return n(e,t),e.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},e.polygonIntersectsSegment=function(t,e,i,r,n,s,a,o){void 0===s&&(s=null),void 0===a&&(a=null),void 0===o&&(o=null),t===i&&(t=i+1e-6),e===r&&(e=r+1e-6);for(var h=n.length,l=t-i,c=e-r,u=t*r-e*i,p=0,d=n[h-2],f=n[h-1],m=0,g=0,_=0,y=0,v=0,b=0,P=0;P<h;P+=2){var T=n[P],x=n[P+1];d===T&&(d=T+1e-4),f===x&&(f=x+1e-4);var S=d-T,O=f-x,C=d*x-f*T,D=l*O-c*S,w=(u*S-l*C)/D;if((w>=d&&w<=T||w>=T&&w<=d)&&(0===l||w>=t&&w<=i||w>=i&&w<=t)){var A=(u*O-c*C)/D;if((A>=f&&A<=x||A>=x&&A<=f)&&(0===c||A>=e&&A<=r||A>=r&&A<=e)){if(null===a){_=w,y=A,v=w,b=A,p++,null!==o&&(o.x=Math.atan2(x-f,T-d)-.5*Math.PI,o.y=o.x);break}var E=w-t;E<0&&(E=-E),0===p?(m=E,g=E,_=w,y=A,v=w,b=A,null!==o&&(o.x=Math.atan2(x-f,T-d)-.5*Math.PI,o.y=o.x)):(E<m&&(m=E,_=w,y=A,null!==o&&(o.x=Math.atan2(x-f,T-d)-.5*Math.PI)),E>g&&(g=E,v=w,b=A,null!==o&&(o.y=Math.atan2(x-f,T-d)-.5*Math.PI))),p++}}d=T,f=x}return 1===p?(null!==s&&(s.x=_,s.y=y),null!==a&&(a.x=_,a.y=y),null!==o&&(o.y=o.x+Math.PI)):p>1&&(p++,null!==s&&(s.x=_,s.y=y),null!==a&&(a.x=v,a.y=b)),p},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},e.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var r=0,n=this.vertices.length,s=n-2;r<n;r+=2){var a=this.vertices[s+1],o=this.vertices[r+1];if(o<e&&a>=e||a<e&&o>=e){var h=this.vertices[s],l=this.vertices[r];(e-o)*(h-l)/(a-o)+l<t&&(i=!i)}s=r}return i},e.prototype.intersectsSegment=function(t,r,n,s,a,o,h){void 0===a&&(a=null),void 0===o&&(o=null),void 0===h&&(h=null);var l=0;return 0!==i.rectangleIntersectsSegment(t,r,n,s,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(l=e.polygonIntersectsSegment(t,r,n,s,this.vertices,a,o,h)),l},e}(e);t.PolygonBoundingBoxData=s}(l||(l={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return n(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++){i[e].returnToPool()}delete this.boneTimelines[t]}for(var t in this.slotTimelines){for(var r=0,n=this.slotTimelines[t];r<n.length;r++){n[r].returnToPool()}delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var s=0,a=this.constraintTimelines[t];s<a.length;s++){a[s].returnToPool()}delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var o=0,h=this.animationTimelines[t];o<h.length;o++){h[o].returnToPool()}delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.blendType=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},e.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,r=this.cacheFrames.length;i<r;++i)this.cachedFrames[i]=!1;for(var n=0,s=this.parent.sortedBones;n<s.length;n++){var a=s[n];for(i=0,r=(l=new Array(e)).length;i<r;++i)l[i]=-1;this.boneCachedFrameIndices[a.name]=l}for(var o=0,h=this.parent.sortedSlots;o<h.length;o++){var l,c=h[o];for(i=0,r=(l=new Array(e)).length;i<r;++i)l[i]=-1;this.slotCachedFrameIndices[c.name]=l}}},e.prototype.addBoneTimeline=function(t,e){var i=t in this.boneTimelines?this.boneTimelines[t]:this.boneTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addSlotTimeline=function(t,e){var i=t in this.slotTimelines?this.slotTimelines[t]:this.slotTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addConstraintTimeline=function(t,e){var i=t in this.constraintTimelines?this.constraintTimelines[t]:this.constraintTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addAnimationTimeline=function(t,e){var i=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},e.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},e.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},e.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},e.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},e.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},e}(t.BaseObject);t.AnimationData=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},e}(t.BaseObject);t.TimelineData=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.AnimationTimelineData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.x=0,this.y=0},e}(i);t.AnimationTimelineData=r}(l||(l={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return n(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additive=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additive=t.additive,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},e}(t.BaseObject);t.AnimationConfig=e}(l||(l={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return n(e,t),e.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},e.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},e.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},e.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},e}(t.BaseObject);t.TextureAtlasData=e;var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.region=new t.Rectangle,i.frame=null,i}return n(i,e),i.createRectangle=function(){return new t.Rectangle},i.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},i.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=i.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},i}(t.BaseObject);t.TextureData=i}(l||(l={})),s=l||(l={}),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._bones=[],e._slots=[],e._constraints=[],e._actions=[],e._animation=null,e._proxy=null,e._replaceTextureAtlasData=null,e._clock=null,e}return n(e,t),e.toString=function(){return"[class dragonBones.Armature]"},e._onSortSlots=function(t,e){return 1e3*t._zIndex+t._zOrder>1e3*e._zIndex+e._zOrder?1:-1},e.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++){e[t].returnToPool()}for(var i=0,r=this._slots;i<r.length;i++){r[i].returnToPool()}for(var n=0,s=this._constraints;n<s.length;n++){s[n].returnToPool()}for(var a=0,o=this._actions;a<o.length;a++){o[a].returnToPool()}null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._zIndexDirty=!1,this._alphaDirty=!0,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._alpha=1,this._globalAlpha=1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},e.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,r=null===t;if(this._zOrderDirty||!r){for(var n=0,s=i.length;n<s;++n){var a=r?n:t[e+n];if(!(a<0||a>=s)){var o=i[a],h=this.getSlot(o.name);null!==h&&h._setZOrder(n)}}this._slotsDirty=!0,this._zOrderDirty=!r}},e.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},e.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},e.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},e.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},e.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},e.prototype.init=function(t,e,i,r){null===this._armatureData&&(this._armatureData=t,this._animation=s.BaseObject.borrowObject(s.Animation),this._proxy=e,this._display=i,this._dragonBones=r,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},e.prototype.advanceTime=function(t){if(!this._lockUpdate)if(this._lockUpdate=!0,null!==this._armatureData)if(null!==this._armatureData.parent){var i=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty||this._zIndexDirty){if(this._slots.sort(e._onSortSlots),this._zIndexDirty)for(var r=0,n=this._slots.length;r<n;++r)this._slots[r]._setZOrder(r);this._slotsDirty=!1,this._zIndexDirty=!1}if(this._alphaDirty){this._alphaDirty=!1,this._globalAlpha=this._alpha*(null!==this._parent?this._parent._globalAlpha:1);for(var s=0,a=this._bones;s<a.length;s++){a[s]._updateAlpha()}for(var o=0,h=this._slots;o<h.length;o++){(m=h[o])._updateAlpha()}}if(this._cacheFrameIndex<0||this._cacheFrameIndex!==i){r=0,n=0;for(r=0,n=this._bones.length;r<n;++r)this._bones[r].update(this._cacheFrameIndex);for(r=0,n=this._slots.length;r<n;++r)this._slots[r].update(this._cacheFrameIndex)}if(this._actions.length>0){for(var l=0,c=this._actions;l<c.length;l++){var u=c[l],p=u.actionData;if(null!==p)if(0===p.type)if(null!==u.slot)null!==(g=u.slot.childArmature)&&g.animation.fadeIn(p.name);else if(null!==u.bone)for(var d=0,f=this.getSlots();d<f.length;d++){var m,g;if((m=f[d]).parent===u.bone)null!==(g=m.childArmature)&&g.animation.fadeIn(p.name)}else this._animation.fadeIn(p.name);u.returnToPool()}this._actions.length=0}this._lockUpdate=!1,this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},e.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(a=this.getBone(t))&&(a.invalidUpdate(),e))for(var i=0,r=this._slots;i<r.length;i++){(l=r[i]).parent===a&&l.invalidUpdate()}}else{for(var n=0,s=this._bones;n<s.length;n++){var a;(a=s[n]).invalidUpdate()}if(e)for(var o=0,h=this._slots;o<h.length;o++){var l;(l=h[o]).invalidUpdate()}}},e.prototype.containsPoint=function(t,e){for(var i=0,r=this._slots;i<r.length;i++){var n=r[i];if(n.containsPoint(t,e))return n}return null},e.prototype.intersectsSegment=function(t,e,i,r,n,s,a){void 0===n&&(n=null),void 0===s&&(s=null),void 0===a&&(a=null);for(var o=t===i,h=0,l=0,c=0,u=0,p=0,d=0,f=0,m=0,g=null,_=null,y=0,v=this._slots;y<v.length;y++){var b=v[y];if(b.intersectsSegment(t,e,i,r,n,s,a)>0){if(null===n&&null===s){g=b;break}var P;null!==n&&((P=o?n.y-e:n.x-t)<0&&(P=-P),(null===g||P<h)&&(h=P,c=n.x,u=n.y,g=b,a&&(f=a.x))),null!==s&&((P=s.x-t)<0&&(P=-P),(null===_||P>l)&&(l=P,p=s.x,d=s.y,_=b,null!==a&&(m=a.y)))}}return null!==g&&null!==n&&(n.x=c,n.y=u,null!==a&&(a.x=f)),null!==_&&null!==s&&(s.x=p,s.y=d,null!==a&&(a.y=m)),g},e.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},e.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},e.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];if(r.name===t)return r}return null},e.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];if(r.display===t)return r}return null},e.prototype.getBones=function(){return this._bones},e.prototype.getSlots=function(){return this._slots},Object.defineProperty(e.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var r=i[e].childArmature;null!==r&&(r.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var r=i[e];r.invalidUpdate(),r.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var r=i[e].childArmature;null!==r&&(r.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),e.prototype.getDisplay=function(){return this._display},e}(s.BaseObject),s.Armature=a,function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return n(i,e),i.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._alpha=1,this._globalAlpha=1,this._armature=null},i.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),i._helpMatrix=new t.Matrix,i._helpTransform=new t.Transform,i._helpPoint=new t.Point,i}(t.BaseObject);t.TransformObject=e}(l||(l={})),function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.animationPose=new t.Transform,i}return n(i,e),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._boneData=null,this._parent=null,this._cachedFrameIndices=null},i.prototype._updateGlobalTransformMatrix=function(e){var i=this._boneData,r=this.global,n=this.globalTransformMatrix,s=this.origin,a=this.offset,o=this.animationPose,h=this._parent,l=this._armature.flipX,c=this._armature.flipY===t.DragonBones.yDown,u=null!==h,p=0;if(1===this.offsetMode?null!==s?(r.x=s.x+a.x+o.x,r.scaleX=s.scaleX*a.scaleX*o.scaleX,r.scaleY=s.scaleY*a.scaleY*o.scaleY,t.DragonBones.yDown?(r.y=s.y+a.y+o.y,r.skew=s.skew+a.skew+o.skew,r.rotation=s.rotation+a.rotation+o.rotation):(r.y=s.y-a.y+o.y,r.skew=s.skew-a.skew+o.skew,r.rotation=s.rotation-a.rotation+o.rotation)):(r.copyFrom(a),t.DragonBones.yDown||(r.y=-r.y,r.skew=-r.skew,r.rotation=-r.rotation),r.add(o)):0===this.offsetMode?null!==s?r.copyFrom(s).add(o):r.copyFrom(o):(u=!1,r.copyFrom(a),t.DragonBones.yDown||(r.y=-r.y,r.skew=-r.skew,r.rotation=-r.rotation)),u){var d=1===h._boneData.type,f=d?h._bone:null,m=d?h._getGlobalTransformMatrix(r.x,r.y):h.globalTransformMatrix;if(!i.inheritScale||d&&null===f){if(i.inheritTranslation){var g=r.x,_=r.y;r.x=m.a*g+m.c*_+m.tx,r.y=m.b*g+m.d*_+m.ty}else l&&(r.x=-r.x),c&&(r.y=-r.y);i.inheritRotation?(h.updateGlobalTransform(),p=h.global.scaleX<0?r.rotation+h.global.rotation+Math.PI:r.rotation+h.global.rotation,m.a*m.d-m.b*m.c<0&&(p-=2*r.rotation,(l!==c||i.inheritReflection)&&(r.skew+=Math.PI),t.DragonBones.yDown||(r.skew=-r.skew)),r.rotation=p):(l||c)&&(l&&c?p=r.rotation+Math.PI:(p=l?Math.PI-r.rotation:-r.rotation,r.skew+=Math.PI),r.rotation=p),r.toMatrix(n)}else d?(i.inheritRotation&&(r.rotation+=h.global.rotation),f.updateGlobalTransform(),r.scaleX*=f.global.scaleX,r.scaleY*=f.global.scaleY,m.transformPoint(r.x,r.y,r),r.toMatrix(n),i.inheritTranslation?(r.x=n.tx,r.y=n.ty):(n.tx=r.x,n.ty=r.y)):(i.inheritRotation||(h.updateGlobalTransform(),p=l&&c?r.rotation-(h.global.rotation+Math.PI):l?r.rotation+h.global.rotation+Math.PI:c?r.rotation+h.global.rotation:r.rotation-h.global.rotation,r.rotation=p),r.toMatrix(n),n.concat(m),i.inheritTranslation?(r.x=n.tx,r.y=n.ty):(n.tx=r.x,n.ty=r.y),e?r.fromMatrix(n):this._globalDirty=!0)}else(l||c)&&(l&&(r.x=-r.x),c&&(r.y=-r.y),l&&c?p=r.rotation+Math.PI:(p=l?Math.PI-r.rotation:-r.rotation,r.skew+=Math.PI),r.rotation=p),r.toMatrix(n)},i.prototype._updateAlpha=function(){null!==this._parent?this._globalAlpha=this._alpha*this._parent._globalAlpha:this._globalAlpha=this._alpha*this._armature._globalAlpha},i.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,this._alpha=this._boneData.alpha,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},i.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,r=this._armature._constraints;i<r.length;i++){(a=r[i])._root===this&&a.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var n=0,s=this._armature._constraints;n<s.length;n++){var a;(a=s[n])._root===this&&a.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var o=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(o),o&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},i.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},i.prototype.invalidUpdate=function(){this._transformDirty=!0},i.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(i.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var r=i[e];r.parent===this&&r._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i}(t.TransformObject);t.Bone=e}(l||(l={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return n(e,t),e.toString=function(){return"[class dragonBones.Surface]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0,this._bone=null},e.prototype._getAffineTransform=function(t,e,i,r,n,s,a,o,h,l,c,u,p){var d=a-n,f=o-s,m=h-n,g=l-s;c.rotation=Math.atan2(f,d),c.skew=Math.atan2(g,m)-.5*Math.PI-c.rotation,p&&(c.rotation+=Math.PI),c.scaleX=Math.sqrt(d*d+f*f)/i,c.scaleY=Math.sqrt(m*m+g*g)/r,c.toMatrix(u),c.x=u.tx=n-(u.a*t+u.c*e),c.y=u.ty=s-(u.b*t+u.d*e)},e.prototype._updateVertices=function(){var t=this._armature.armatureData.parent,e=this._boneData.geometry,i=t.intArray,r=t.floatArray,n=i[e.offset+0],s=i[e.offset+2],a=this._vertices,o=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var h=0,l=n;h<l;++h){var c=r[s+(f=2*h)]+o[f],u=r[s+f+1]+o[f+1],p=this._parent._getGlobalTransformMatrix(c,u);a[f]=p.a*c+p.c*u+p.tx,a[f+1]=p.b*c+p.d*u+p.ty}else{var d=this._parent.globalTransformMatrix;for(h=0,l=n;h<l;++h){c=r[s+(f=2*h)]+o[f],u=r[s+f+1]+o[f+1];a[f]=d.a*c+d.c*u+d.tx,a[f+1]=d.b*c+d.d*u+d.ty}}else for(h=0,l=n;h<l;++h){var f;a[f=2*h]=r[s+f]+o[f],a[f+1]=r[s+f+1]+o[f+1]}},e.prototype._updateGlobalTransformMatrix=function(t){var e=2*this._boneData.segmentX,i=this._vertices.length-2,r=this._vertices[0],n=this._vertices[1],s=this._vertices[e],a=this._vertices[e+1],o=this._vertices[i],h=this._vertices[i+1],l=this._vertices[i-e],c=this._vertices[i-e+1],u=r+.5*(o-r),p=n+.5*(h-n),d=u+.5*(s+.5*(l-s)-u),f=p+.5*(a+.5*(c-a)-p),m=s+.5*(o-s),g=a+.5*(h-a),_=l+.5*(o-l),y=c+.5*(h-c);this._getAffineTransform(0,0,200,200,d,f,m,g,_,y,this.global,this.globalTransformMatrix,!1),this._globalDirty=!1},e.prototype._getGlobalTransformMatrix=function(t,i){var r=200,n=1e3;if(t<-n||n<t||i<-n||n<i)return this.globalTransformMatrix;var s=!1,a=this._boneData,o=a.segmentX,h=a.segmentY,l=2*a.segmentX,c=this._dX,u=this._dY,p=Math.floor((t+r)/c),d=Math.floor((i+r)/u),f=0,m=p*c-r,g=d*u-r,_=this._matrixCahce,y=e._helpMatrix;if(t<-r){if(i<-r||i>=r)return this.globalTransformMatrix;if(_[f=7*(2*(o*h+o+h+h+d)+((s=i>this._kX*(t+r)+g)?1:0))]>0)y.copyFromArray(_,f+1);else{var v=d*(l+2),b=this._hullCache[4],P=this._hullCache[5],T=this._hullCache[2]-(h-d)*b,x=this._hullCache[3]-(h-d)*P,S=this._vertices;s?this._getAffineTransform(-r,g+u,800,u,S[v+l+2],S[v+l+3],T+b,x+P,S[v],S[v+1],e._helpTransform,y,!0):this._getAffineTransform(-n,g,800,u,T,x,S[v],S[v+1],T+b,x+P,e._helpTransform,y,!1),_[f]=1,_[f+1]=y.a,_[f+2]=y.b,_[f+3]=y.c,_[f+4]=y.d,_[f+5]=y.tx,_[f+6]=y.ty}}else if(t>=r){if(i<-r||i>=r)return this.globalTransformMatrix;if(_[f=7*(2*(o*h+o+d)+((s=i>this._kX*(t-n)+g)?1:0))]>0)y.copyFromArray(_,f+1);else{v=(d+1)*(l+2)-2,b=this._hullCache[4],P=this._hullCache[5],T=this._hullCache[0]+d*b,x=this._hullCache[1]+d*P,S=this._vertices;s?this._getAffineTransform(n,g+u,800,u,T+b,x+P,S[v+l+2],S[v+l+3],T,x,e._helpTransform,y,!0):this._getAffineTransform(r,g,800,u,S[v],S[v+1],T,x,S[v+l+2],S[v+l+3],e._helpTransform,y,!1),_[f]=1,_[f+1]=y.a,_[f+2]=y.b,_[f+3]=y.c,_[f+4]=y.d,_[f+5]=y.tx,_[f+6]=y.ty}}else if(i<-r){if(t<-r||t>=r)return this.globalTransformMatrix;if(_[f=7*(2*(o*h+p)+((s=i>this._kY*(t-m-c)-n)?1:0))]>0)y.copyFromArray(_,f+1);else{v=2*p,b=this._hullCache[10],P=this._hullCache[11],T=this._hullCache[8]+p*b,x=this._hullCache[9]+p*P,S=this._vertices;s?this._getAffineTransform(m+c,-r,c,800,S[v+2],S[v+3],S[v],S[v+1],T+b,x+P,e._helpTransform,y,!0):this._getAffineTransform(m,-n,c,800,T,x,T+b,x+P,S[v],S[v+1],e._helpTransform,y,!1),_[f]=1,_[f+1]=y.a,_[f+2]=y.b,_[f+3]=y.c,_[f+4]=y.d,_[f+5]=y.tx,_[f+6]=y.ty}}else if(i>=r){if(t<-r||t>=r)return this.globalTransformMatrix;if(_[f=7*(2*(o*h+o+h+p)+((s=i>this._kY*(t-m-c)+r)?1:0))]>0)y.copyFromArray(_,f+1);else{v=h*(l+2)+2*p,b=this._hullCache[10],P=this._hullCache[11],T=this._hullCache[6]-(o-p)*b,x=this._hullCache[7]-(o-p)*P,S=this._vertices;s?this._getAffineTransform(m+c,n,c,800,T+b,x+P,T,x,S[v+2],S[v+3],e._helpTransform,y,!0):this._getAffineTransform(m,r,c,800,S[v],S[v+1],S[v+2],S[v+3],T,x,e._helpTransform,y,!1),_[f]=1,_[f+1]=y.a,_[f+2]=y.b,_[f+3]=y.c,_[f+4]=y.d,_[f+5]=y.tx,_[f+6]=y.ty}}else if(_[f=7*(2*(o*d+p)+((s=i>this._k*(t-m-c)+g)?1:0))]>0)y.copyFromArray(_,f+1);else{v=2*p+d*(l+2),S=this._vertices;s?this._getAffineTransform(m+c,g+u,c,u,S[v+l+4],S[v+l+5],S[v+l+2],S[v+l+3],S[v+2],S[v+3],e._helpTransform,y,!0):this._getAffineTransform(m,g,c,u,S[v],S[v+1],S[v+2],S[v+3],S[v+l+2],S[v+l+3],e._helpTransform,y,!1),_[f]=1,_[f+1]=y.a,_[f+2]=y.b,_[f+3]=y.c,_[f+4]=y.d,_[f+5]=y.tx,_[f+6]=y.ty}return y},e.prototype.init=function(e,i){if(null===this._boneData){t.prototype.init.call(this,e,i);var r=e.segmentX,n=e.segmentY,s=this._armature.armatureData.parent.intArray[e.geometry.offset+0];this._dX=400/r,this._dY=400/n,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=2*s,this._deformVertices.length=2*s,this._matrixCahce.length=2*(r*n+2*r+2*n)*7,this._hullCache.length=10;for(var a=0;a<2*s;++a)this._deformVertices[a]=0;null!==this._parent&&(0===this._parent.boneData.type?this._bone=this._parent:this._bone=this._parent._bone)}},e.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var i=this._cachedFrameIndices[t];if(i>=0&&this._cachedFrameIndex===i)this._transformDirty=!1;else if(i>=0)this._transformDirty=!0,this._cachedFrameIndex=i;else{if(this._hasConstraint)for(var r=0,n=this._armature._constraints;r<n.length;r++){(o=n[r])._root===this&&o.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var s=0,a=this._armature._constraints;s<a.length;s++){var o;(o=a[s])._root===this&&o.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var h=0,l=this._matrixCahce.length;h<l;h+=7)this._matrixCahce[h]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var c=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(c),c&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var u=2*this.global.x,p=2*this.global.y,d=e._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,d),this._hullCache[0]=d.x,this._hullCache[1]=d.y,this._hullCache[2]=u-d.x,this._hullCache[3]=p-d.y,this.globalTransformMatrix.transformPoint(0,this._dY,d,!0),this._hullCache[4]=d.x,this._hullCache[5]=d.y,this.globalTransformMatrix.transformPoint(200,1e3,d),this._hullCache[6]=d.x,this._hullCache[7]=d.y,this._hullCache[8]=u-d.x,this._hullCache[9]=p-d.y,this.globalTransformMatrix.transformPoint(this._dX,0,d,!0),this._hullCache[10]=d.x,this._hullCache[11]=d.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},e}(t.Bone);t.Surface=e}(l||(l={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.deformVertices=[],e}return n(e,t),e.toString=function(){return"[class dragonBones.DisplayFrame]"},e.prototype._onClear=function(){this.rawDisplayData=null,this.displayData=null,this.textureData=null,this.display=null,this.deformVertices.length=0},e.prototype.updateDeformVertices=function(){if(null!==this.rawDisplayData&&0===this.deformVertices.length){var t;if(2===this.rawDisplayData.type)t=this.rawDisplayData.geometry;else{if(4!==this.rawDisplayData.type)return;t=this.rawDisplayData.geometry}var e=0;e=null!==t.weight?2*t.weight.count:2*t.data.intArray[t.offset+0],this.deformVertices.length=e;for(var i=0,r=this.deformVertices.length;i<r;++i)this.deformVertices[i]=0}},e.prototype.getGeometryData=function(){if(null!==this.displayData){if(2===this.displayData.type)return this.displayData.geometry;if(4===this.displayData.type)return this.displayData.geometry}if(null!==this.rawDisplayData){if(2===this.rawDisplayData.type)return this.rawDisplayData.geometry;if(4===this.rawDisplayData.type)return this.rawDisplayData.geometry}return null},e.prototype.getBoundingBox=function(){return null!==this.displayData&&3===this.displayData.type?this.displayData.boundingBox:null!==this.rawDisplayData&&3===this.rawDisplayData.type?this.rawDisplayData.boundingBox:null},e.prototype.getTextureData=function(){if(null!==this.displayData){if(0===this.displayData.type)return this.displayData.texture;if(2===this.displayData.type)return this.displayData.texture}if(null!==this.textureData)return this.textureData;if(null!==this.rawDisplayData){if(0===this.rawDisplayData.type)return this.rawDisplayData.texture;if(2===this.rawDisplayData.type)return this.rawDisplayData.texture}return null},e}(t.BaseObject);t.DisplayFrame=e;var i=function(i){function r(){var e=null!==i&&i.apply(this,arguments)||this;return e._localMatrix=new t.Matrix,e._colorTransform=new t.ColorTransform,e._displayFrames=[],e._geometryBones=[],e._rawDisplay=null,e._meshDisplay=null,e._display=null,e}return n(r,i),r.prototype._onClear=function(){i.prototype._onClear.call(this);for(var e=[],r=0,n=this._displayFrames;r<n.length;r++){var s=n[r],a=s.display;a!==this._rawDisplay&&a!==this._meshDisplay&&e.indexOf(a)<0&&e.push(a),s.returnToPool()}for(var o=0,h=e;o<h.length;o++){var l=h[o];l instanceof t.Armature?l.dispose():this._disposeDisplay(l,!0)}null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDataDirty=!1,this._displayDirty=!1,this._geometryDirty=!1,this._textureDirty=!1,this._visibleDirty=!1,this._blendModeDirty=!1,this._zOrderDirty=!1,this._colorDirty=!1,this._verticesDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._zIndex=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayFrames.length=0,this._geometryBones.length=0,this._slotData=null,this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},r.prototype._hasDisplay=function(t){for(var e=0,i=this._displayFrames;e<i.length;e++){if(i[e].display===t)return!0}return!1},r.prototype._isBonesUpdate=function(){for(var t=0,e=this._geometryBones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},r.prototype._updateAlpha=function(){var t=this._alpha*this._parent._globalAlpha;this._globalAlpha!==t&&(this._globalAlpha=t,this._colorDirty=!0)},r.prototype._updateDisplayData=function(){var e=this._displayFrame,i=this._geometryData,n=this._textureData,s=null,a=null;if(this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&this._displayIndex<this._displayFrames.length&&(this._displayFrame=this._displayFrames[this._displayIndex],s=this._displayFrame.rawDisplayData,a=this._displayFrame.displayData,this._geometryData=this._displayFrame.getGeometryData(),this._boundingBoxData=this._displayFrame.getBoundingBox(),this._textureData=this._displayFrame.getTextureData()),this._displayFrame!==e||this._geometryData!==i||this._textureData!==n){if(null===this._geometryData&&null!==this._textureData){var o=null!==a&&0===a.type?a:s,h=this._textureData.parent.scale*this._armature._armatureData.scale,l=this._textureData.frame;this._pivotX=o.pivot.x,this._pivotY=o.pivot.y;var c=null!==l?l:this._textureData.region,u=c.width,p=c.height;this._textureData.rotated&&null===l&&(u=c.height,p=c.width),this._pivotX*=u*h,this._pivotY*=p*h,null!==l&&(this._pivotX+=l.x*h,this._pivotY+=l.y*h),null!==s&&o!==s&&(s.transform.toMatrix(r._helpMatrix),r._helpMatrix.invert(),r._helpMatrix.transformPoint(0,0,r._helpPoint),this._pivotX-=r._helpPoint.x,this._pivotY-=r._helpPoint.y,o.transform.toMatrix(r._helpMatrix),r._helpMatrix.invert(),r._helpMatrix.transformPoint(0,0,r._helpPoint),this._pivotX+=r._helpPoint.x,this._pivotY+=r._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*h-this._pivotY)}else this._pivotX=0,this._pivotY=0;if(this.origin=null!==s?s.transform:null!==a?a.transform:null,null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix),this._geometryData!==i)if(this._geometryDirty=!0,this._verticesDirty=!0,null!==this._geometryData){if(this._geometryBones.length=0,null!==this._geometryData.weight)for(var d=0,f=this._geometryData.weight.bones.length;d<f;++d){var m=this._armature.getBone(this._geometryData.weight.bones[d].name);this._geometryBones.push(m)}}else this._geometryBones.length=0,this._geometryData=null;this._textureDirty=this._textureData!==n,this._transformDirty=!0}},r.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,i=this._childArmature;if(null!==this._displayFrame?(this._display=this._displayFrame.display,null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null),(null!==this._display?this._display:this._rawDisplay)!==e&&(this._textureDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._transformDirty=!0,this._onUpdateDisplay(),this._replaceDisplay(e)),this._childArmature!==i&&(null!==i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var r=this._armature.cacheFrameRate;0!==r&&(this._childArmature.cacheFrameRate=r)}if(null!==this._displayFrame){var n=null,s=null!==this._displayFrame.displayData?this._displayFrame.displayData:this._displayFrame.rawDisplayData;if(null!==s&&1===s.type&&(n=s.actions),null!==n&&n.length>0)for(var a=0,o=n;a<o.length;a++){var h=o[a],l=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(h,l,this._armature),l.slot=this,this._armature._bufferAction(l,!1)}else this._childArmature.animation.play()}}},r.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},r.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return;this._animationDisplayIndex=t}this._displayIndex!==t&&(this._displayIndex=t<this._displayFrames.length?t:this._displayFrames.length-1,this._displayDataDirty=!0,this._displayDirty=this._displayIndex<0||this._display!==this._displayFrames[this._displayIndex].display)},r.prototype._setZOrder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},r.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0},r.prototype.init=function(t,e,i,r){if(null===this._slotData){this._slotData=t,this._colorDirty=!0,this._blendModeDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._zIndex=this._slotData.zIndex,this._alpha=this._slotData.alpha,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=r,this._armature=e;var n=this._armature.getBone(this._slotData.parent.name);null!==n&&(this._parent=n),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},r.prototype.update=function(t){if(this._displayDataDirty&&(this._updateDisplayData(),this._displayDataDirty=!1),this._displayDirty&&(this._updateDisplay(),this._displayDirty=!1),(this._geometryDirty||this._textureDirty)&&(null!==this._display&&this._display!==this._rawDisplay&&this._display!==this._meshDisplay||this._updateFrame(),this._geometryDirty=!1,this._textureDirty=!1),null!==this._display){if(this._visibleDirty&&(this._updateVisible(),this._visibleDirty=!1),this._blendModeDirty&&(this._updateBlendMode(),this._blendModeDirty=!1),this._colorDirty&&(this._updateColor(),this._colorDirty=!1),this._zOrderDirty&&(this._updateZOrder(),this._zOrderDirty=!1),null!==this._geometryData&&this._display===this._meshDisplay){var e=null!==this._geometryData.weight,i=0!==this._parent._boneData.type;if((this._verticesDirty||e&&this._isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._verticesDirty=!1,this._updateMesh()),e||i)return}if(t>=0&&null!==this._cachedFrameIndices){var r=this._cachedFrameIndices[t];r>=0&&this._cachedFrameIndex===r?this._transformDirty=!1:r>=0?(this._transformDirty=!0,this._cachedFrameIndex=r):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(this._transformDirty){if(this._cachedFrameIndex<0){var n=t>=0;this._updateGlobalTransformMatrix(n),n&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform(),this._transformDirty=!1}}},r.prototype.invalidUpdate=function(){this._displayDataDirty=!0,this._displayDirty=!0,this._transformDirty=!0},r.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._updateGlobalTransformMatrix(!1),this._transformDirty=!1)},r.prototype.replaceRawDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];if(i.rawDisplayData!==t){if(i.deformVertices.length=0,i.rawDisplayData=t,null===i.rawDisplayData){var r=this._armature._armatureData.defaultSkin;if(null!==r){var n=r.getDisplays(this._slotData.name);null!==n&&e<n.length&&(i.rawDisplayData=n[e])}}e===this._displayIndex&&(this._displayDataDirty=!0)}},r.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.displayData!==t&&i.rawDisplayData!==t&&(i.displayData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},r.prototype.replaceTextureData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.textureData!==t&&(i.textureData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},r.prototype.replaceDisplay=function(e,i){if(void 0===i&&(i=-1),i<0)i=this._displayIndex<0?0:this._displayIndex;else if(i>=this._displayFrames.length)return;var r=this._displayFrames[i];if(r.display!==e){var n=r.display;r.display=e,null===n||n===this._rawDisplay||n===this._meshDisplay||this._hasDisplay(n)||n instanceof t.Armature||this._disposeDisplay(n,!0),null===e||e===this._rawDisplay||e===this._meshDisplay||this._hasDisplay(n)||e instanceof t.Armature||this._initDisplay(e,!0),i===this._displayIndex&&(this._displayDirty=!0)}},r.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),r._helpMatrix.copyFrom(this.globalTransformMatrix),r._helpMatrix.invert(),r._helpMatrix.transformPoint(t,e,r._helpPoint),this._boundingBoxData.containsPoint(r._helpPoint.x,r._helpPoint.y))},r.prototype.intersectsSegment=function(t,e,i,n,s,a,o){if(void 0===s&&(s=null),void 0===a&&(a=null),void 0===o&&(o=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),r._helpMatrix.copyFrom(this.globalTransformMatrix),r._helpMatrix.invert(),r._helpMatrix.transformPoint(t,e,r._helpPoint),t=r._helpPoint.x,e=r._helpPoint.y,r._helpMatrix.transformPoint(i,n,r._helpPoint),i=r._helpPoint.x,n=r._helpPoint.y;var h=this._boundingBoxData.intersectsSegment(t,e,i,n,s,a,o);return h>0&&(1===h||2===h?null!==s?(this.globalTransformMatrix.transformPoint(s.x,s.y,s),null!==a&&(a.x=s.x,a.y=s.y)):null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a):(null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s),null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a)),null!==o&&(this.globalTransformMatrix.transformPoint(Math.cos(o.x),Math.sin(o.x),r._helpPoint,!0),o.x=Math.atan2(r._helpPoint.y,r._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(o.y),Math.sin(o.y),r._helpPoint,!0),o.y=Math.atan2(r._helpPoint.y,r._helpPoint.x))),h},r.prototype.getDisplayFrameAt=function(t){return this._displayFrames[t]},Object.defineProperty(r.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"displayFrameCount",{get:function(){return this._displayFrames.length},set:function(i){var r=this._displayFrames.length;if(r<i){this._displayFrames.length=i;for(var n=r;n<i;++n)this._displayFrames[n]=t.BaseObject.borrowObject(e)}else if(r>i){for(n=r-1;n<i;--n)this.replaceDisplay(null,n),this._displayFrames[n].returnToPool();this._displayFrames.length=i}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t),this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"displayList",{get:function(){for(var t=new Array,e=0,i=this._displayFrames;e<i.length;e++){var r=i[e];t.push(r.display)}return t},set:function(t){this.displayFrameCount=t.length;for(var e=0,i=0,r=t;i<r.length;i++){var n=r[i];this.replaceDisplay(n,e++)}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"display",{get:function(){return this._display},set:function(t){this._display!==t&&(0===this._displayFrames.length&&(this.displayFrameCount=1,this._displayIndex=0),this.replaceDisplay(t,this._displayIndex))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),r.prototype.getDisplay=function(){return this._display},r.prototype.setDisplay=function(t){this.display=t},r}(t.TransformObject);t.Slot=i}(l||(l={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(i.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),i._helpMatrix=new t.Matrix,i._helpTransform=new t.Transform,i._helpPoint=new t.Point,i}(t.BaseObject);t.Constraint=e;var i=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.toString=function(){return"[class dragonBones.IKConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},i.prototype._computeA=function(){var e=this._target.global,i=this._root.global,r=this._root.globalTransformMatrix,n=Math.atan2(e.y-i.y,e.x-i.x);i.scaleX<0&&(n+=Math.PI),i.rotation+=t.Transform.normalizeRadian(n-i.rotation)*this._weight,i.toMatrix(r)},i.prototype._computeB=function(){var e=this._bone._boneData.length,i=this._root,r=this._target.global,n=i.global,s=this._bone.global,a=this._bone.globalTransformMatrix,o=a.a*e,h=a.b*e,l=o*o+h*h,c=Math.sqrt(l),u=s.x-n.x,p=s.y-n.y,d=u*u+p*p,f=Math.sqrt(d),m=s.rotation,g=n.rotation,_=Math.atan2(p,u),y=(u=r.x-n.x)*u+(p=r.y-n.y)*p,v=Math.sqrt(y),b=0;if(c+f<=v||v+c<=f||v+f<=c)b=Math.atan2(r.y-n.y,r.x-n.x),c+f<=v||f<c&&(b+=Math.PI);else{var P=(d-l+y)/(2*y),T=Math.sqrt(d-P*P*y)/v,x=n.x+u*P,S=n.y+p*P,O=-p*T,C=u*T,D=!1,w=i.parent;if(null!==w){var A=w.globalTransformMatrix;D=A.a*A.d-A.b*A.c<0}D!==this._bendPositive?(s.x=x-O,s.y=S-C):(s.x=x+O,s.y=S+C),b=Math.atan2(s.y-n.y,s.x-n.x)}var E=t.Transform.normalizeRadian(b-_);n.rotation=g+E*this._weight,n.toMatrix(i.globalTransformMatrix);var M=_+E*this._weight;s.x=n.x+Math.cos(M)*f,s.y=n.y+Math.sin(M)*f;var I=Math.atan2(r.y-s.y,r.x-s.x);s.scaleX<0&&(I+=Math.PI),s.rotation=n.rotation+m-g+t.Transform.normalizeRadian(I-E-m)*this._weight,s.toMatrix(a)},i.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var i=this._constraintData;this._scaleEnabled=i.scaleEnabled,this._bendPositive=i.bendPositive,this._weight=i.weight,this._root._hasConstraint=!0}},i.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},i.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},i}(e);t.IKConstraint=i;var r=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return n(i,e),i.toString=function(){return"[class dragonBones.PathConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},i.prototype._updatePathVertices=function(t){var e=this._armature,i=e.armatureData.parent,r=e.armatureData.scale,n=i.intArray,s=i.floatArray,a=t.offset,o=n[a+0],h=n[a+2];this._pathGlobalVertices.length=2*o;var l=t.weight;if(null!==l)for(var c=this._pathSlot._geometryBones,u=l.bones.length,p=l.offset,d=n[p+1],f=p+2+u,m=(S=0,0);S<o;S++){for(var g=0,_=0,y=0,v=n[f++];y<v;y++){var b=c[n[f++]];if(null!==b){b.updateByConstraint();x=b.globalTransformMatrix;var P=s[d++];C=s[d++]*r,D=s[d++]*r;g+=(x.a*C+x.c*D+x.tx)*P,_+=(x.b*C+x.d*D+x.ty)*P}}this._pathGlobalVertices[m++]=g,this._pathGlobalVertices[m++]=_}else{var T=this._pathSlot.parent;T.updateByConstraint();for(var x=T.globalTransformMatrix,S=0,O=h;S<o;S+=2){var C=s[O++]*r,D=s[O++]*r,w=x.a*C+x.c*D+x.tx,A=x.b*C+x.d*D+x.ty;this._pathGlobalVertices[S]=w,this._pathGlobalVertices[S+1]=A}}},i.prototype._computeVertices=function(t,e,i,r){for(var n=i,s=t;n<e;n+=2)r[n]=this._pathGlobalVertices[s++],r[n+1]=this._pathGlobalVertices[s++]},i.prototype._computeBezierCurve=function(t,e,i,r,n){var s=this._armature.armatureData.parent.intArray[t.geometry.offset+0],a=this._positions,o=this._spaces,h=t.closed,l=Array(),c=2*s,u=c/6,p=-1,d=this.position;a.length=3*e+2;var f=0;if(t.constantSpeed){h?(c+=2,l.length=s,this._computeVertices(2,c-4,0,l),this._computeVertices(0,2,c-4,l),l[c-2]=l[0],l[c-1]=l[1]):(u--,c-=4,l.length=c,this._computeVertices(2,c,0,l));var m=new Array(u);f=0;for(var g,_,y,v,b,P,T,x,S=l[0],O=l[1],C=0,D=0,w=0,A=0,E=0,M=0,I=(H=0,2);H<u;H++,I+=6)C=l[I],D=l[I+1],w=l[I+2],A=l[I+3],b=2*(g=.1875*(S-2*C+w))+(y=.09375*(3*(C-w)-S+(E=l[I+4]))),P=2*(_=.1875*(O-2*D+A))+(v=.09375*(3*(D-A)-O+(M=l[I+5]))),T=.75*(C-S)+g+.16666667*y,x=.75*(D-O)+_+.16666667*v,f+=Math.sqrt(T*T+x*x),T+=b,x+=P,b+=y,P+=v,f+=Math.sqrt(T*T+x*x),T+=b,x+=P,f+=Math.sqrt(T*T+x*x),T+=b+y,x+=P+v,f+=Math.sqrt(T*T+x*x),m[H]=f,S=E,O=M;if(r&&(d*=f),n)for(H=0;H<e;H++)o[H]*=f;for(var B=this._segments,k=0,R=(H=0,Y=0,G=0,0);H<e;H++,Y+=3){var N=d+=o[H];if(h)(N%=f)<0&&(N+=f),G=0;else{if(N<0)continue;if(N>f)continue}for(;;G++){var j=m[G];if(!(N>j)){if(0===G)N/=j;else N=(N-(z=m[G-1]))/(j-z);break}}if(G!==p){p=G;var L=6*G;for(S=l[L],O=l[L+1],C=l[L+2],D=l[L+3],w=l[L+4],A=l[L+5],b=2*(g=.03*(S-2*C+w))+(y=.006*(3*(C-w)-S+(E=l[L+6]))),P=2*(_=.03*(O-2*D+A))+(v=.006*(3*(D-A)-O+(M=l[L+7]))),T=.3*(C-S)+g+.16666667*y,x=.3*(D-O)+_+.16666667*v,k=Math.sqrt(T*T+x*x),B[0]=k,L=1;L<8;L++)T+=b,x+=P,b+=y,P+=v,k+=Math.sqrt(T*T+x*x),B[L]=k;T+=b,x+=P,k+=Math.sqrt(T*T+x*x),B[8]=k,T+=b+y,x+=P+v,k+=Math.sqrt(T*T+x*x),B[9]=k,R=0}for(N*=k;;R++){var F=B[R];if(!(N>F)){var z;if(0===R)N/=F;else N=R+(N-(z=B[R-1]))/(F-z);break}}this.addCurvePosition(.1*N,S,O,C,D,w,A,E,M,a,Y,i)}}else{var V=t.curveLengths;if(f=V[u-=h?1:2],r&&(d*=f),n)for(var H=0;H<e;H++)o[H]*=f;l.length=8;for(var H=0,Y=0,G=0;H<e;H++,Y+=3){if(d+=o[H],h)(d%=f)<0&&(d+=f),G=0;else{if(d<0)continue;if(d>f)continue}for(var U=0;;G++){var W=V[G];if(!(d>W)){if(0===G)U=d/W;else{var X=V[G-1];U=(d-X)/(W-X)}break}}G!==p&&(p=G,h&&G===u?(this._computeVertices(c-4,4,0,l),this._computeVertices(0,4,4,l)):this._computeVertices(6*G+2,8,0,l)),this.addCurvePosition(U,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],a,Y,i)}}},i.prototype.addCurvePosition=function(t,e,i,r,n,s,a,o,h,l,c,u){if(0===t)return l[c]=e,l[c+1]=i,void(l[c+2]=0);if(1===t)return l[c]=o,l[c+1]=h,void(l[c+2]=0);var p=1-t,d=p*p,f=t*t,m=d*p,g=d*t*3,_=p*f*3,y=t*f,v=m*e+g*r+_*s+y*o,b=m*i+g*n+_*a+y*h;l[c]=v,l[c+1]=b,l[c+2]=u?Math.atan2(b-(m*i+g*n+_*a),v-(m*e+g*r+_*s)):0},i.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.geometry.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var r=0,n=i.bones.length;r<n;r++){var s=this._armature.getBone(i.bones[r].name);null!==s&&this._bones.push(s)}2===i.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},i.prototype.update=function(){var e=this._pathSlot;if(null!==e._geometryData&&e._geometryData.offset===this.pathOffset){var i=this._constraintData,r=!1;if(this._root._childrenTransformDirty?(this._updatePathVertices(e._geometryData),r=!0):(e._verticesDirty||e._isBonesUpdate())&&(this._updatePathVertices(e._geometryData),e._verticesDirty=!1,r=!0),r||this.dirty){var n=i.positionMode,s=i.spacingMode,a=i.rotateMode,o=this._bones,h=0===s,l=2===a,c=0===a,u=o.length,p=c?u:u+1,d=this.spacing,f=this._spaces;if(f.length=p,l||h){f[0]=0;for(var m=0,g=p-1;m<g;m++){(A=o[m]).updateByConstraint();var _=A._boneData.length,y=_*(E=A.globalTransformMatrix).a,v=_*E.b,b=Math.sqrt(y*y+v*v);l&&(this._boneLengths[m]=b),f[m+1]=(_+d)*b/_}}else for(m=0;m<p;m++)f[m]=d;this._computeBezierCurve(e._displayFrame.rawDisplayData,p,c,1===n,2===s);var P,T=this._positions,x=this.rotateOffset,S=T[0],O=T[1];if(0===x)P=1===a;else if(P=!1,null!==(A=e.parent))x*=(E=A.globalTransformMatrix).a*E.d-E.b*E.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD;for(var C=this.rotateMix,D=this.translateMix,w=(m=0,3);m<u;m++,w+=3){var A,E;(A=o[m]).updateByConstraint(),(E=A.globalTransformMatrix).tx+=(S-E.tx)*D,E.ty+=(O-E.ty)*D;var M=(y=T[w])-S,I=(v=T[w+1])-O;if(l){var B=this._boneLengths[m],k=(Math.sqrt(M*M+I*I)/B-1)*C+1;E.a*=k,E.b*=k}if(S=y,O=v,C>0){var R=E.a,N=E.b,j=E.c,L=E.d,F=void 0,z=void 0,V=void 0;if(F=c?T[w-1]:Math.atan2(I,M),F-=Math.atan2(N,R),P){z=Math.cos(F),V=Math.sin(F);var H=A._boneData.length;S+=(H*(z*R-V*N)-M)*C,O+=(H*(V*R+z*N)-I)*C}else F+=x;F>t.Transform.PI?F-=t.Transform.PI_D:F<-t.Transform.PI&&(F+=t.Transform.PI_D),F*=C,z=Math.cos(F),V=Math.sin(F),E.a=z*R-V*N,E.b=V*R+z*N,E.c=z*j-V*L,E.d=V*j+z*L}A.global.fromMatrix(E)}this.dirty=!1}}},i.prototype.invalidUpdate=function(){},i}(e);t.PathConstraint=r}(l||(l={})),function(t){var e=function(){function t(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return t.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var i=0,r=0,n=this._animatebles.length;i<n;++i){var s=this._animatebles[i];null!==s?(r>0&&(this._animatebles[i-r]=s,this._animatebles[i]=null),s.advanceTime(t)):r++}if(r>0){for(n=this._animatebles.length;i<n;++i){var a=this._animatebles[i];null!==a?this._animatebles[i-r]=a:r++}this._animatebles.length-=r}}},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},t.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),t}();t.WorldClock=e}(l||(l={})),function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._blendStates={},t._animationConfig=null,t}return n(i,e),i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}for(var i in this._animations)delete this._animations[i];for(var i in this._blendStates){var r=this._blendStates[i];for(var n in r)r[n].returnToPool();delete this._blendStates[i]}null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},i.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++){null===(l=i[e])._parent&&(l.layer===t.layer&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 2:for(var r=0,n=this._animationStates;r<n.length;r++){null===(l=n[r])._parent&&(l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 3:for(var s=0,a=this._animationStates;s<a.length;s++){null===(l=a[s])._parent&&(l.layer===t.layer&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 4:for(var o=0,h=this._animationStates;o<h.length;o++){var l;null===(l=h[o])._parent&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},i.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},i.prototype.advanceTime=function(t){for(var e in t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale),this._blendStates){var i=this._blendStates[e];for(var r in i)i[r].reset()}var n=this._animationStates.length;if(1===n)if((g=this._animationStates[0])._fadeState>0&&g._subFadeState>0)this._armature._dragonBones.bufferObject(g),this._animationStates.length=0,this._lastAnimationState=null;else{var s=g.animationData,a=s.cacheFrameRate;if(this._animationDirty&&a>0){this._animationDirty=!1;for(var o=0,h=this._armature.getBones();o<h.length;o++){var l=h[o];l._cachedFrameIndices=s.getBoneCachedFrameIndices(l.name)}for(var c=0,u=this._armature.getSlots();c<u.length;c++){var p=u[c];if(p.displayFrameCount>0){var d=p.getDisplayFrameAt(0).rawDisplayData;if(null!==d&&d.parent===this._armature.armatureData.defaultSkin){p._cachedFrameIndices=s.getSlotCachedFrameIndices(p.name);continue}}p._cachedFrameIndices=null}}g.advanceTime(t,a)}else if(n>1){for(var f=0,m=0;f<n;++f){var g;(g=this._animationStates[f])._fadeState>0&&g._subFadeState>0?(m++,this._armature._dragonBones.bufferObject(g),this._animationDirty=!0,this._lastAnimationState===g&&(this._lastAnimationState=null)):(m>0&&(this._animationStates[f-m]=g),g.advanceTime(t,0)),f===n-1&&m>0&&(this._animationStates.length-=m,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},i.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},i.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(r=this.getState(t))&&r.stop();else for(var e=0,i=this._animationStates;e<i.length;e++){var r;(r=i[e]).stop()}},i.prototype.playConfig=function(e){var i=e.animation;if(!(i in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+i),null;var r=this._animations[i];if(5===e.fadeOutMode)for(var n=0,s=this._animationStates;n<s.length;n++){var a=s[n];if(a._fadeState<1&&a.layer===e.layer&&a.animationData===r)return a}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=r.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/r.scale),r.frameCount>0?(e.position<0?(e.position%=r.duration,e.position=r.duration-e.position):e.position===r.duration?e.position-=1e-6:e.position>r.duration&&(e.position%=r.duration),e.duration>0&&e.position+e.duration>r.duration&&(e.duration=r.duration-e.position),e.playTimes<0&&(e.playTimes=r.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var o=t.BaseObject.borrowObject(t.AnimationState);if(o.init(this._armature,r,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var h=!1,l=0,c=this._animationStates.length;l<c;++l){if(o.layer>this._animationStates[l].layer){h=!0,this._animationStates.splice(l,0,o);break}if(l!==c-1&&o.layer>this._animationStates[l+1].layer){h=!0,this._animationStates.splice(l+1,0,o);break}}h||this._animationStates.push(o)}else this._animationStates.push(o);for(var u=0,p=this._armature.getSlots();u<p.length;u++){var d=p[u].childArmature;null!==d&&d.inheritAnimation&&d.animation.hasAnimation(i)&&null===d.animation.getState(i)&&d.animation.fadeIn(i)}for(var f in r.animationTimelines){var m=this.fadeIn(f,0,1,o.layer,"",5);if(null!==m){var g=r.animationTimelines[f];m.actionEnabled=!1,m.resetToPose=!1,m.stop(),o.addState(m,g);var _=this._animationStates.indexOf(o),y=this._animationStates.indexOf(m);y<_&&(this._animationStates.splice(_,1),this._animationStates.splice(y,0,o))}}return this._lastAnimationState=o,o},i.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;null!==i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},i.prototype.fadeIn=function(t,e,i,r,n,s){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===r&&(r=0),void 0===n&&(n=null),void 0===s&&(s=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=s,this._animationConfig.playTimes=i,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==n?n:"",this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var r=t in this._animations?this._animations[t]:null;return null!==r&&(this._animationConfig.position=r.frameCount>0?r.duration*e/r.frameCount:0),this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var r=t in this._animations?this._animations[t]:null;return null!==r&&(this._animationConfig.position=r.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},i.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return null!==i&&i.stop(),i},i.prototype.getBlendState=function(e,i,r){e in this._blendStates||(this._blendStates[e]={});var n=this._blendStates[e];i in n||((n[i]=t.BaseObject.borrowObject(t.BlendState)).target=r);return n[i]},i.prototype.getState=function(t,e){void 0===e&&(e=-1);for(var i=this._animationStates.length;i--;){var r=this._animationStates[i];if(r.name===t&&(e<0||r.layer===e))return r}return null},i.prototype.hasAnimation=function(t){return t in this._animations},i.prototype.getStates=function(){return this._animationStates},Object.defineProperty(i.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(e[t].isPlaying)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(!e[t].isCompleted)return!1}return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.Animation=e}(l||(l={})),function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._boneMask=[],t._boneTimelines=[],t._boneBlendTimelines=[],t._slotTimelines=[],t._slotBlendTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._actionTimeline=null,t._zOrderTimeline=null,t}return n(r,e),r.toString=function(){return"[class dragonBones.AnimationState]"},r.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++){(p=e[t]).returnToPool()}for(var i=0,r=this._boneBlendTimelines;i<r.length;i++){(p=r[i]).returnToPool()}for(var n=0,s=this._slotTimelines;n<s.length;n++){(p=s[n]).returnToPool()}for(var a=0,o=this._slotBlendTimelines;a<o.length;a++){(p=o[a]).returnToPool()}for(var h=0,l=this._constraintTimelines;h<l.length;h++){(p=l[h]).returnToPool()}for(var c=0,u=this._animationTimelines;c<u.length;c++){var p,d=(p=u[c]).target;d._parent===this&&(d._fadeState=1,d._subFadeState=1,d._parent=null),p.returnToPool()}null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additive=!1,this.displayControl=!1,this.resetToPose=!1,this.blendType=0,this.playTimes=1,this.layer=0,this.timeScale=1,this._weight=1,this.parameterX=0,this.parameterY=0,this.positionX=0,this.positionY=0,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._boneMask.length=0,this._boneTimelines.length=0,this._boneBlendTimelines.length=0,this._slotTimelines.length=0,this._slotBlendTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._activeChildA=null,this._activeChildB=null,this._parent=null},r.prototype._updateTimelines=function(){for(var e=0,i=this._armature._constraints;e<i.length;e++){var r=i[e],n=this._animationData.getConstraintTimelines(r.name);if(null!==n)for(var s=0,a=n;s<a.length;s++){var o=a[s];switch(o.type){case 30:(h=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).target=r,h.init(this._armature,this,o),this._constraintTimelines.push(h)}}else if(this.resetToPose){var h;(h=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).target=r,h.init(this._armature,this,null),this._constraintTimelines.push(h),this._poseTimelines.push(h)}}},r.prototype._updateBoneAndSlotTimelines=function(){for(var e={},r=0,n=this._boneTimelines;r<n.length;r++){(c=(y=n[r]).target.target.name)in e||(e[c]=[]),e[c].push(y)}for(var s=0,a=this._boneBlendTimelines;s<a.length;s++){(c=(y=a[s]).target.target.name)in e||(e[c]=[]),e[c].push(y)}for(var o=0,h=this._armature.getBones();o<h.length;o++){var l=h[o],c=l.name;if(this.containsBoneMask(c))if(c in e)delete e[c];else{var u=this._animationData.getBoneTimelines(c),p=this._armature.animation.getBlendState(i.BONE_TRANSFORM,l.name,l);if(null!==u)for(var d=0,f=u;d<f.length;d++){switch((B=f[d]).type){case 10:(y=t.BaseObject.borrowObject(t.BoneAllTimelineState)).target=p,y.init(this._armature,this,B),this._boneTimelines.push(y);break;case 11:(y=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).target=p,y.init(this._armature,this,B),this._boneTimelines.push(y);break;case 12:(y=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).target=p,y.init(this._armature,this,B),this._boneTimelines.push(y);break;case 13:(y=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).target=p,y.init(this._armature,this,B),this._boneTimelines.push(y);break;case 60:(y=t.BaseObject.borrowObject(t.AlphaTimelineState)).target=this._armature.animation.getBlendState(i.BONE_ALPHA,l.name,l),y.init(this._armature,this,B),this._boneBlendTimelines.push(y);break;case 50:(y=t.BaseObject.borrowObject(t.SurfaceTimelineState)).target=this._armature.animation.getBlendState(i.SURFACE,l.name,l),y.init(this._armature,this,B),this._boneBlendTimelines.push(y)}}else if(this.resetToPose){if(0===l._boneData.type)(y=t.BaseObject.borrowObject(t.BoneAllTimelineState)).target=p,y.init(this._armature,this,null),this._boneTimelines.push(y),this._poseTimelines.push(y);else(y=t.BaseObject.borrowObject(t.SurfaceTimelineState)).target=this._armature.animation.getBlendState(i.SURFACE,l.name,l),y.init(this._armature,this,null),this._boneBlendTimelines.push(y),this._poseTimelines.push(y)}}}for(var m in e)for(var g=0,_=e[m];g<_.length;g++){var y=_[g];(z=this._boneTimelines.indexOf(y))>=0&&(this._boneTimelines.splice(z,1),y.returnToPool()),(z=this._boneBlendTimelines.indexOf(y))>=0&&(this._boneBlendTimelines.splice(z,1),y.returnToPool())}for(var v={},b=[],P=0,T=this._slotTimelines;P<T.length;P++){(c=(y=T[P]).target.name)in v||(v[c]=[]),v[c].push(y)}for(var x=0,S=this._slotBlendTimelines;x<S.length;x++){(c=(y=S[x]).target.target.name)in v||(v[c]=[]),v[c].push(y)}for(var O=0,C=this._armature.getSlots();O<C.length;O++){var D=C[O],w=D.parent.name;if(this.containsBoneMask(w))if((c=D.name)in v)delete v[c];else{var A=!1,E=!1;if(b.length=0,null!==(u=this._animationData.getSlotTimelines(c)))for(var M=0,I=u;M<I.length;M++){var B;switch((B=I[M]).type){case 20:(y=t.BaseObject.borrowObject(t.SlotDisplayTimelineState)).target=D,y.init(this._armature,this,B),this._slotTimelines.push(y),A=!0;break;case 23:(y=t.BaseObject.borrowObject(t.SlotZIndexTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_Z_INDEX,D.name,D),y.init(this._armature,this,B),this._slotBlendTimelines.push(y);break;case 21:(y=t.BaseObject.borrowObject(t.SlotColorTimelineState)).target=D,y.init(this._armature,this,B),this._slotTimelines.push(y),E=!0;break;case 22:(y=t.BaseObject.borrowObject(t.DeformTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_DEFORM,D.name,D),y.init(this._armature,this,B),null!==y.target?(this._slotBlendTimelines.push(y),b.push(y.geometryOffset)):y.returnToPool();break;case 24:(y=t.BaseObject.borrowObject(t.AlphaTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_ALPHA,D.name,D),y.init(this._armature,this,B),this._slotBlendTimelines.push(y)}}if(this.resetToPose){if(!A)(y=t.BaseObject.borrowObject(t.SlotDisplayTimelineState)).target=D,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y);if(!E)(y=t.BaseObject.borrowObject(t.SlotColorTimelineState)).target=D,y.init(this._armature,this,null),this._slotTimelines.push(y),this._poseTimelines.push(y);for(var k=0,R=D.displayFrameCount;k<R;++k){var N=D.getDisplayFrameAt(k);if(0!==N.deformVertices.length){var j=N.getGeometryData();if(null!==j&&b.indexOf(j.offset)<0)(y=t.BaseObject.borrowObject(t.DeformTimelineState)).geometryOffset=j.offset,y.displayFrame=N,y.target=this._armature.animation.getBlendState(i.SLOT_DEFORM,D.name,D),y.init(this._armature,this,null),this._slotBlendTimelines.push(y),this._poseTimelines.push(y)}}}}}for(var m in v)for(var L=0,F=v[m];L<F.length;L++){var z;y=F[L];(z=this._slotTimelines.indexOf(y))>=0&&(this._slotTimelines.splice(z,1),y.returnToPool()),(z=this._slotBlendTimelines.indexOf(y))>=0&&(this._slotBlendTimelines.splice(z,1),y.returnToPool())}},r.prototype._advanceFadeTime=function(e){var i=this._fadeState>0;if(this._subFadeState<0&&(this._subFadeState=0,null===this._parent&&this.actionEnabled)){var r=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasDBEventListener(r))(n=t.BaseObject.borrowObject(t.EventObject)).type=r,n.armature=this._armature,n.animationState=this,this._armature._dragonBones.bufferEvent(n)}if((e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0)&&(i||(this._playheadState|=1,this._fadeState=0),null===this._parent&&this.actionEnabled)){var n;r=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasDBEventListener(r))(n=t.BaseObject.borrowObject(t.EventObject)).type=r,n.armature=this._armature,n.animationState=this,this._armature._dragonBones.bufferEvent(n)}},r.prototype.init=function(e,i,r){if(null===this._armature){if(this._armature=e,this._animationData=i,this.resetToPose=r.resetToPose,this.additive=r.additive,this.displayControl=r.displayControl,this.actionEnabled=r.actionEnabled,this.blendType=i.blendType,this.layer=r.layer,this.playTimes=r.playTimes,this.timeScale=r.timeScale,this.fadeTotalTime=r.fadeInTime,this.autoFadeOutTime=r.autoFadeOutTime,this.name=r.name.length>0?r.name:r.animation,this.group=r.group,this._weight=r.weight,r.pauseFadeIn?this._playheadState=2:this._playheadState=3,r.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==r.position?this.timeScale>=0?this._time=r.position:this._time=r.position-this._duration:this._time=0):(this._position=r.position,this._duration=r.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),r.boneMask.length>0){this._boneMask.length=r.boneMask.length;for(var n=0,s=this._boneMask.length;n<s;++n)this._boneMask[n]=r.boneMask[n]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},r.prototype.advanceTime=function(t,e){0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines());var i=0!==this._fadeState||0===this._subFadeState,r=0===this._fadeState&&e>0,n=!0,s=!0,a=this._time;if(this._weightResult=this._weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult),this._actionTimeline.playState<=0&&this._actionTimeline.update(a),0!==this._weight){if(r){var o=2*e;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*o)/o}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(a),r){var h=Math.floor(this._actionTimeline.currentTime*e);this._armature._cacheFrameIndex===h?(n=!1,s=!1):(this._armature._cacheFrameIndex=h,this._animationData.cachedFrames[h]?s=!1:this._animationData.cachedFrames[h]=!0)}if(n){var l=!1,c=null;if(s)for(var u=0,p=this._boneTimelines.length;u<p;++u){if((S=this._boneTimelines[u]).playState<=0&&S.update(a),S.target!==c)if(l=(m=S.target).update(this),c=m,1===m.dirty){var d=m.target.animationPose;d.x=0,d.y=0,d.rotation=0,d.skew=0,d.scaleX=1,d.scaleY=1}l&&S.blend(i)}for(u=0,p=this._boneBlendTimelines.length;u<p;++u){(S=this._boneBlendTimelines[u]).playState<=0&&S.update(a),S.target.update(this)&&S.blend(i)}if(this.displayControl)for(u=0,p=this._slotTimelines.length;u<p;++u){if((S=this._slotTimelines[u]).playState<=0){var f=S.target.displayController;null!==f&&f!==this.name&&f!==this.group||S.update(a)}}for(u=0,p=this._slotBlendTimelines.length;u<p;++u){if((S=this._slotBlendTimelines[u]).playState<=0){var m=S.target;S.update(a),m.update(this)&&S.blend(i)}}for(u=0,p=this._constraintTimelines.length;u<p;++u){(S=this._constraintTimelines[u]).playState<=0&&S.update(a)}if(this._animationTimelines.length>0){var g=100,_=100,y=null,v=null;for(u=0,p=this._animationTimelines.length;u<p;++u){if((S=this._animationTimelines[u]).playState<=0&&S.update(a),1===this.blendType){var b=S.target,P=this.parameterX-b.positionX;P>=0?P<g&&(g=P,y=b):-P<_&&(_=-P,v=b)}}null!==y&&(this._activeChildA!==y&&(null!==this._activeChildA&&(this._activeChildA.weight=0),this._activeChildA=y,this._activeChildA.activeTimeline()),this._activeChildB!==v&&(null!==this._activeChildB&&(this._activeChildB.weight=0),this._activeChildB=v),y.weight=_/(g+_),v&&(v.weight=1-y.weight))}}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var T=0,x=this._poseTimelines;T<x.length;T++){var S=x[T],O=this._boneTimelines.indexOf(S);O>=0?(this._boneTimelines.splice(O,1),S.returnToPool()):(O=this._boneBlendTimelines.indexOf(S))>=0?(this._boneBlendTimelines.splice(O,1),S.returnToPool()):(O=this._slotTimelines.indexOf(S))>=0?(this._slotTimelines.splice(O,1),S.returnToPool()):(O=this._slotBlendTimelines.indexOf(S))>=0?(this._slotBlendTimelines.splice(O,1),S.returnToPool()):(O=this._constraintTimelines.indexOf(S))>=0&&(this._constraintTimelines.splice(O,1),S.returnToPool())}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},r.prototype.play=function(){this._playheadState=3},r.prototype.stop=function(){this._playheadState&=1},r.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,r=this._boneTimelines;i<r.length;i++){(f=r[i]).fadeOut()}for(var n=0,s=this._boneBlendTimelines;n<s.length;n++){(f=s[n]).fadeOut()}for(var a=0,o=this._slotTimelines;a<o.length;a++){(f=o[a]).fadeOut()}for(var h=0,l=this._slotBlendTimelines;h<l.length;h++){(f=l[h]).fadeOut()}for(var c=0,u=this._constraintTimelines;c<u.length;c++){(f=u[c]).fadeOut()}for(var p=0,d=this._animationTimelines;p<d.length;p++){var f;(f=d[p]).fadeOut(),f.target.fadeOut(999999,!0)}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},r.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},r.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var r=0,n=this._armature.getBones();r<n.length;r++){var s=n[r];this._boneMask.indexOf(s.name)<0&&i.contains(s)&&this._boneMask.push(s.name)}this._timelineDirty=1}},r.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var r=this._armature.getBone(t);if(null!==r){var n=this._armature.getBones();if(this._boneMask.length>0)for(var s=0,a=n;s<a.length;s++){var o=a[s],h=this._boneMask.indexOf(o.name);h>=0&&r.contains(o)&&this._boneMask.splice(h,1)}else for(var l=0,c=n;l<c.length;l++){(o=c[l])!==r&&(r.contains(o)||this._boneMask.push(o.name))}}}this._timelineDirty=1},r.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},r.prototype.addState=function(e,i){if(void 0===i&&(i=null),null!==i)for(var r=0,n=i;r<n.length;r++){var s=n[r];switch(s.type){case 40:if((o=t.BaseObject.borrowObject(t.AnimationProgressTimelineState)).target=e,o.init(this._armature,this,s),this._animationTimelines.push(o),0!==this.blendType){var a=s;e.positionX=a.x,e.positionY=a.y,e.weight=0}e._parent=this,this.resetToPose=!1;break;case 41:(o=t.BaseObject.borrowObject(t.AnimationWeightTimelineState)).target=e,o.init(this._armature,this,s),this._animationTimelines.push(o);break;case 42:var o;(o=t.BaseObject.borrowObject(t.AnimationParametersTimelineState)).target=e,o.init(this._armature,this,s),this._animationTimelines.push(o)}}null===e._parent&&(e._parent=this)},r.prototype.activeTimeline=function(){for(var t=0,e=this._slotTimelines;t<e.length;t++){var i=e[t];i.dirty=!0,i.currentTime=-1}},Object.defineProperty(r.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&null===this._parent&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,r=this._boneTimelines;i<r.length;i++){r[i].playState=-1}for(var n=0,s=this._slotTimelines;n<s.length;n++){s[n].playState=-1}}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weight",{get:function(){return this._weight},set:function(t){if(this._weight!==t){this._weight=t;for(var e=0,i=this._boneTimelines;e<i.length;e++){i[e].dirty=!0}for(var r=0,n=this._boneBlendTimelines;r<n.length;r++){n[r].dirty=!0}for(var s=0,a=this._slotBlendTimelines;s<a.length;s++){a[s].dirty=!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),r}(t.BaseObject);t.AnimationState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.BlendState]"},e.prototype._onClear=function(){this.reset(),this.target=null},e.prototype.update=function(t){var e=t.layer,i=t._weightResult;if(this.dirty>0){if(this.leftWeight>0){if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.dirty++,this.layer=e,this.leftWeight=0,this.blendWeight=0,!1;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return i*=this.leftWeight,this.dirty++,this.blendWeight=i,this.layerWeight+=this.blendWeight,!0}return!1}return this.dirty++,this.layer=e,this.leftWeight=1,this.blendWeight=i,this.layerWeight=i,!0},e.prototype.reset=function(){this.dirty=0,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},e.BONE_TRANSFORM="boneTransform",e.BONE_ALPHA="boneAlpha",e.SURFACE="surface",e.SLOT_DEFORM="slotDeform",e.SLOT_ALPHA="slotAlpha",e.SLOT_Z_INDEX="slotZIndex",e}(t.BaseObject);t.BlendState=i}(l||(l={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._onClear=function(){this.dirty=!1,this.playState=-1,this.currentPlayTimes=0,this.currentTime=-1,this.target=null,this._isTween=!1,this._valueOffset=0,this._frameValueOffset=0,this._frameOffset=0,this._frameRate=0,this._frameCount=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._valueArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,i=this.currentPlayTimes,r=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var n=this._animationState.playTimes,s=n*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),n>0&&(t>=s||t<=-s)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=n,this.currentTime=t<0?0:1===this.playState?this._duration+1e-6:this._duration):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==i||this.currentTime!==r)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,i){if(this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState.animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,null!==this._timelineData){var r=this._animationData.parent.parent;this._frameArray=r.frameArray,this._timelineArray=r.timelineArray,this._frameIndices=r.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1]}},e.prototype.fadeOut=function(){this.dirty=!1},e.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),i=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==i&&(this._frameIndex=i,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());(this._isTween||this.dirty)&&this._onUpdateFrame()}},e.prototype.blend=function(t){},e}(t.BaseObject);t.TimelineState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e._getEasingValue=function(t,e,i){var r=e;switch(t){case 3:r=Math.pow(e,2);break;case 4:r=1-Math.pow(1-e,2);break;case 5:r=.5*(1-Math.cos(e*Math.PI))}return(r-e)*i+e},e._getEasingCurveValue=function(t,e,i,r){if(t<=0)return 0;if(t>=1)return 1;var n=i>0,s=i+1,a=Math.floor(t*s),o=0,h=0;return n?(o=0===a?0:e[r+a-1],h=a===s-1?1e4:e[r+a]):(o=e[r+a-1],h=e[r+a]),1e-4*(o+(h-o)*(t*s-a))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenEasing=0,this._tweenProgress=0,this._valueScale=1},e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._isTween=0!==this._tweenType,this._isTween?2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]):this.dirty=!0,this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this.dirty=!0,this._isTween=!1},e.prototype._onUpdateFrame=function(){this._isTween&&(this.dirty=!0,this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing)))},e}(e);t.TweenTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._difference=0,this._result=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,r=this._valueOffset+this._frameValueOffset+this._frameIndex;if(this._isTween){var n=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:r+1;1===e?(this._current=i[r],this._difference=i[n]-this._current):(this._current=i[r]*e,this._difference=i[n]*e-this._current)}else this._result=i[r]*e}else this._result=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result=this._current+this._difference*this._tweenProgress)},e}(i);t.SingleValueTimelineState=r;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this._currentA=0,this._currentB=0,this._differenceA=0,this._differenceB=0,this._resultA=0,this._resultB=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,r=this._valueOffset+this._frameValueOffset+2*this._frameIndex;if(this._isTween){var n=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:r+2;1===e?(this._currentA=i[r],this._currentB=i[r+1],this._differenceA=i[n]-this._currentA,this._differenceB=i[n+1]-this._currentB):(this._currentA=i[r]*e,this._currentB=i[r+1]*e,this._differenceA=i[n]*e-this._currentA,this._differenceB=i[n+1]*e-this._currentB)}else this._resultA=i[r]*e,this._resultB=i[r+1]*e}else this._resultA=0,this._resultB=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._resultA=this._currentA+this._differenceA*this._tweenProgress,this._resultB=this._currentB+this._differenceB*this._tweenProgress)},e}(i);t.DoubleValueTimelineState=s;var a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._rd=[],e}return n(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this._valueCount=0,this._rd.length=0},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this._valueCount,i=this._rd;if(null!==this._timelineData){var r=this._valueScale,n=this._valueArray,s=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(this._isTween){var a=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:s+e;if(1===r)for(var o=0;o<e;++o)i[e+o]=n[a+o]-n[s+o];else for(o=0;o<e;++o)i[e+o]=(n[a+o]-n[s+o])*r}else if(1===r)for(o=0;o<e;++o)i[o]=n[s+o];else for(o=0;o<e;++o)i[o]=n[s+o]*r}else for(o=0;o<e;++o)i[o]=0},e.prototype._onUpdateFrame=function(){if(t.prototype._onUpdateFrame.call(this),this._isTween){var e=this._valueCount,i=this._valueScale,r=this._tweenProgress,n=this._valueArray,s=this._rd,a=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(1===i)for(var o=0;o<e;++o)s[o]=n[a+o]+s[e+o]*r;else for(o=0;o<e;++o)s[o]=n[a+o]*i+s[e+o]*r}},e}(i);t.MutilpleValueTimelineState=a}(l||(l={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.toString=function(){return"[class dragonBones.ActionTimelineState]"},i.prototype._onCrossFrame=function(e){var i=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var r=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],n=this._frameArray[r+1],s=this._animationData.parent.actions,a=0;a<n;++a){var o=s[this._frameArray[r+2+a]];if(0===o.type){(h=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[r]/this._frameRate,h.animationState=this._animationState,t.EventObject.actionDataToInstance(o,h,this._armature),this._armature._bufferAction(h,!0)}else{var h,l=10===o.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;if(11===o.type||i.hasDBEventListener(l))(h=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[r]/this._frameRate,h.animationState=this._animationState,t.EventObject.actionDataToInstance(o,h,this._armature),this._armature._dragonBones.bufferEvent(h)}}},i.prototype._onArriveAtFrame=function(){},i.prototype._onUpdateFrame=function(){},i.prototype.update=function(e){var i=this.playState,r=this.currentPlayTimes,n=this.currentTime;if(this._setCurrentTime(e)){var s=null===this._animationState._parent&&this._animationState.actionEnabled,a=this._armature.eventDispatcher;if(i<0){if(this.playState===i)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),s&&a.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var h=this._animationState.timeScale<0,l=null,c=null;if(s&&this.currentPlayTimes!==r&&(a.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((l=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,l.armature=this._armature,l.animationState=this._animationState),this.playState>0&&a.hasDBEventListener(t.EventObject.COMPLETE)&&((c=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,c.armature=this._armature,c.animationState=this._animationState)),this._frameCount>1){var u=this._timelineData,p=Math.floor(this.currentTime*this._frameRate),d=this._frameIndices[u.frameIndicesOffset+p];if(this._frameIndex!==d){var f=this._frameIndex;if(this._frameIndex=d,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[u.offset+5+this._frameIndex],h){if(f<0){var m=Math.floor(n*this._frameRate);f=this._frameIndices[u.frameIndicesOffset+m],this.currentPlayTimes===r&&f===d&&(f=-1)}for(;f>=0;){var g=this._animationData.frameOffset+this._timelineArray[u.offset+5+f],_=this._frameArray[g]/this._frameRate;if(this._position<=_&&_<=this._position+this._duration&&this._onCrossFrame(f),null!==l&&0===f&&(this._armature._dragonBones.bufferEvent(l),l=null),f>0?f--:f=this._frameCount-1,f===d)break}}else{if(f<0){m=Math.floor(n*this._frameRate);f=this._frameIndices[u.frameIndicesOffset+m];g=this._animationData.frameOffset+this._timelineArray[u.offset+5+f],_=this._frameArray[g]/this._frameRate;this.currentPlayTimes===r&&(n<=_?f>0?f--:f=this._frameCount-1:f===d&&(f=-1))}for(;f>=0;){f<this._frameCount-1?f++:f=0;g=this._animationData.frameOffset+this._timelineArray[u.offset+5+f],_=this._frameArray[g]/this._frameRate;if(this._position<=_&&_<=this._position+this._duration&&this._onCrossFrame(f),null!==l&&0===f&&(this._armature._dragonBones.bufferEvent(l),l=null),f===d)break}}}}else if(this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];_=this._frameArray[this._frameOffset]/this._frameRate;this.currentPlayTimes===r?n<=_&&this._onCrossFrame(this._frameIndex):this._position<=_&&(h||null===l||(this._armature._dragonBones.bufferEvent(l),l=null),this._onCrossFrame(this._frameIndex))}null!==l&&this._armature._dragonBones.bufferEvent(l),null!==c&&this._armature._dragonBones.bufferEvent(c)}},i.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},i}(t.TimelineState);t.ActionTimelineState=e;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.ZOrderTimelineState=i;var r=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},i.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])),null===this._timelineData&&(this._rd[4]=1,this._rd[5]=1)},i.prototype.init=function(t,i,r){e.prototype.init.call(this,t,i,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=6,this._valueArray=this._animationData.parent.parent.frameFloatArray},i.prototype.fadeOut=function(){this.dirty=!1,this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])},i.prototype.blend=function(t){var e=this._armature.armatureData.scale,i=this._rd,r=this.target,n=r.target,s=r.blendWeight,a=n.animationPose;r.dirty>1?(a.x+=i[0]*s*e,a.y+=i[1]*s*e,a.rotation+=i[2]*s,a.skew+=i[3]*s,a.scaleX+=(i[4]-1)*s,a.scaleY+=(i[5]-1)*s):(a.x=i[0]*s*e,a.y=i[1]*s*e,a.rotation=i[2]*s,a.skew=i[3]*s,a.scaleX=(i[4]-1)*s+1,a.scaleY=(i[5]-1)*s+1),(t||this.dirty)&&(this.dirty=!1,n._transformDirty=!0)},i}(t.MutilpleValueTimelineState);t.BoneAllTimelineState=r;var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=this._animationData.parent.parent.frameFloatArray},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=i.animationPose;e.dirty>1?(n.x+=this._resultA*r,n.y+=this._resultB*r):1!==r?(n.x=this._resultA*r,n.y=this._resultB*r):(n.x=this._resultA,n.y=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},e}(t.DoubleValueTimelineState);t.BoneTranslateTimelineState=s;var a=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},i.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._differenceA=t.Transform.normalizeRadian(this._differenceA),this._differenceB=t.Transform.normalizeRadian(this._differenceB))},i.prototype.init=function(t,i,r){e.prototype.init.call(this,t,i,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},i.prototype.fadeOut=function(){this.dirty=!1,this._resultA=t.Transform.normalizeRadian(this._resultA),this._resultB=t.Transform.normalizeRadian(this._resultB)},i.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=i.animationPose;e.dirty>1?(n.rotation+=this._resultA*r,n.skew+=this._resultB*r):1!==r?(n.rotation=this._resultA*r,n.skew=this._resultB*r):(n.rotation=this._resultA,n.skew=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},i}(t.DoubleValueTimelineState);t.BoneRotateTimelineState=a;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._resultA=1,this._resultB=1)},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=i.animationPose;e.dirty>1?(n.scaleX+=(this._resultA-1)*r,n.scaleY+=(this._resultB-1)*r):1!==r?(n.scaleX=(this._resultA-1)*r+1,n.scaleY=(this._resultB-1)*r+1):(n.scaleX=this._resultA,n.scaleY=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},e}(t.DoubleValueTimelineState);t.BoneScaleTimelineState=o;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},e.prototype.init=function(e,i,r){if(t.prototype.init.call(this,e,i,r),null!==this._timelineData){var n=this._animationData.parent.parent,s=n.frameIntArray,a=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=s[a+2],this._deformCount=s[a+1],this._deformOffset=s[a+3],this._sameValueOffset=s[a+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=n.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.target.target._deformVertices.length},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=i._deformVertices,s=this._valueArray;if(null!==s)for(var a=this._valueCount,o=this._deformOffset,h=this._sameValueOffset,l=this._rd,c=0;c<this._deformCount;++c){var u=0;u=c<o?s[h+c]:c<o+a?l[c-o]:s[h+c-a],e.dirty>1?n[c]+=u*r:n[c]=u*r}else if(1===e.dirty)for(c=0;c<this._deformCount;++c)n[c]=0;(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},e}(t.MutilpleValueTimelineState);t.SurfaceTimelineState=h;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.AlphaTimelineState]"},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._result=1)},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight;e.dirty>1?(i._alpha+=this._result*r,i._alpha>1&&(i._alpha=1)):i._alpha=this._result*r,(t||this.dirty)&&(this.dirty=!1,this._armature._alphaDirty=!0)},e}(t.SingleValueTimelineState);t.AlphaTimelineState=l;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.SlotDisplayTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this.target,e=null!==this._timelineData?this._frameArray[this._frameOffset+1]:t._slotData.displayIndex;t.displayIndex!==e&&t._setDisplayIndex(e,!0)}},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.SlotDisplayTimelineState=c;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._difference=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return n(e,t),e.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.parent.parent,i=e.colorArray,r=e.frameIntArray,n=this._animationData.frameIntOffset+this._frameValueOffset+this._frameIndex,s=r[n];s<0&&(s+=65536),this._isTween?(this._current[0]=i[s++],this._current[1]=i[s++],this._current[2]=i[s++],this._current[3]=i[s++],this._current[4]=i[s++],this._current[5]=i[s++],this._current[6]=i[s++],this._current[7]=i[s++],(s=this._frameIndex===this._frameCount-1?r[this._animationData.frameIntOffset+this._frameValueOffset]:r[n+1])<0&&(s+=65536),this._difference[0]=i[s++]-this._current[0],this._difference[1]=i[s++]-this._current[1],this._difference[2]=i[s++]-this._current[2],this._difference[3]=i[s++]-this._current[3],this._difference[4]=i[s++]-this._current[4],this._difference[5]=i[s++]-this._current[5],this._difference[6]=i[s++]-this._current[6],this._difference[7]=i[s++]-this._current[7]):(this._result[0]=.01*i[s++],this._result[1]=.01*i[s++],this._result[2]=.01*i[s++],this._result[3]=.01*i[s++],this._result[4]=i[s++],this._result[5]=i[s++],this._result[6]=i[s++],this._result[7]=i[s++])}else{var a=this.target.slotData.color;this._result[0]=a.alphaMultiplier,this._result[1]=a.redMultiplier,this._result[2]=a.greenMultiplier,this._result[3]=a.blueMultiplier,this._result[4]=a.alphaOffset,this._result[5]=a.redOffset,this._result[6]=a.greenOffset,this._result[7]=a.blueOffset}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result[0]=.01*(this._current[0]+this._difference[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._difference[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._difference[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._difference[3]*this._tweenProgress),this._result[4]=this._current[4]+this._difference[4]*this._tweenProgress,this._result[5]=this._current[5]+this._difference[5]*this._tweenProgress,this._result[6]=this._current[6]+this._difference[6]*this._tweenProgress,this._result[7]=this._current[7]+this._difference[7]*this._tweenProgress)},e.prototype.fadeOut=function(){this._isTween=!1},e.prototype.update=function(e){if(t.prototype.update.call(this,e),this._isTween||this.dirty){var i=this.target,r=i._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(r.alphaMultiplier!==this._result[0]||r.redMultiplier!==this._result[1]||r.greenMultiplier!==this._result[2]||r.blueMultiplier!==this._result[3]||r.alphaOffset!==this._result[4]||r.redOffset!==this._result[5]||r.greenOffset!==this._result[6]||r.blueOffset!==this._result[7]){var n=Math.pow(this._animationState._fadeProgress,4);r.alphaMultiplier+=(this._result[0]-r.alphaMultiplier)*n,r.redMultiplier+=(this._result[1]-r.redMultiplier)*n,r.greenMultiplier+=(this._result[2]-r.greenMultiplier)*n,r.blueMultiplier+=(this._result[3]-r.blueMultiplier)*n,r.alphaOffset+=(this._result[4]-r.alphaOffset)*n,r.redOffset+=(this._result[5]-r.redOffset)*n,r.greenOffset+=(this._result[6]-r.greenOffset)*n,r.blueOffset+=(this._result[7]-r.blueOffset)*n,i._colorDirty=!0}}else this.dirty&&(this.dirty=!1,r.alphaMultiplier===this._result[0]&&r.redMultiplier===this._result[1]&&r.greenMultiplier===this._result[2]&&r.blueMultiplier===this._result[3]&&r.alphaOffset===this._result[4]&&r.redOffset===this._result[5]&&r.greenOffset===this._result[6]&&r.blueOffset===this._result[7]||(r.alphaMultiplier=this._result[0],r.redMultiplier=this._result[1],r.greenMultiplier=this._result[2],r.blueMultiplier=this._result[3],r.alphaOffset=this._result[4],r.redOffset=this._result[5],r.greenOffset=this._result[6],r.blueOffset=this._result[7],i._colorDirty=!0))}},e}(t.TweenTimelineState);t.SlotColorTimelineState=u;var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.SlotZIndexTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null===this._timelineData){var e=this.target.target;this._result=e.slotData.zIndex}},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueArray=this._animationData.parent.parent.frameIntArray},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight;e.dirty>1?i._zIndex+=this._result*r:i._zIndex=this._result*r,(t||this.dirty)&&(this.dirty=!1,this._armature._zIndexDirty=!0)},e}(t.SingleValueTimelineState);t.SlotZIndexTimelineState=p;var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.DeformTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.geometryOffset=0,this.displayFrame=null,this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},e.prototype.init=function(e,i,r){if(t.prototype.init.call(this,e,i,r),null!==this._timelineData){var n=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],s=this._animationData.parent.parent,a=s.frameIntArray,o=this.target.target;this.geometryOffset=a[n+0],this.geometryOffset<0&&(this.geometryOffset+=65536);for(var h=0,l=o.displayFrameCount;h<l;++h){var c=o.getDisplayFrameAt(h),u=c.getGeometryData();if(null!==u&&u.offset===this.geometryOffset){this.displayFrame=c,this.displayFrame.updateDeformVertices();break}}if(null===this.displayFrame)return void this.returnToPool();this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=a[n+2],this._deformCount=a[n+1],this._deformOffset=a[n+3],this._sameValueOffset=a[n+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=s.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.displayFrame.deformVertices.length},e.prototype.blend=function(t){var e=this.target,i=e.target,r=e.blendWeight,n=this.displayFrame.deformVertices,s=this._valueArray;if(null!==s)for(var a=this._valueCount,o=this._deformOffset,h=this._sameValueOffset,l=this._rd,c=0;c<this._deformCount;++c){var u=0;u=c<o?s[h+c]:c<o+a?l[c-o]:s[h+c-a],e.dirty>1?n[c]+=u*r:n[c]=u*r}else if(1===e.dirty)for(c=0;c<this._deformCount;++c)n[c]=0;(t||this.dirty)&&(this.dirty=!1,i._geometryData===this.displayFrame.getGeometryData()&&(i._verticesDirty=!0))},e}(t.MutilpleValueTimelineState);t.DeformTimelineState=d;var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;if(null!==this._timelineData)e._bendPositive=this._currentA>0,e._weight=this._currentB;else{var i=e._constraintData;e._bendPositive=i.bendPositive,e._weight=i.weight}e.invalidUpdate(),this.dirty=!1},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},e}(t.DoubleValueTimelineState);t.IKConstraintTimelineState=f;var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.AnimationProgressTimelineState]"},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.currentTime=this._result*e.totalTime),this.dirty=!1},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},e}(t.SingleValueTimelineState);t.AnimationProgressTimelineState=m;var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.AnimationWeightTimelineState]"},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.weight=this._result),this.dirty=!1},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},e}(t.SingleValueTimelineState);t.AnimationWeightTimelineState=g;var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.toString=function(){return"[class dragonBones.AnimationParametersTimelineState]"},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.parameterX=this._resultA,e.parameterY=this._resultB),this.dirty=!1},e.prototype.init=function(e,i,r){t.prototype.init.call(this,e,i,r),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},e}(t.DoubleValueTimelineState);t.AnimationParametersTimelineState=_}(l||(l={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.actionDataToInstance=function(t,i,r){0===t.type?i.type=e.FRAME_EVENT:i.type=10===t.type?e.FRAME_EVENT:e.SOUND_EVENT,i.name=t.name,i.armature=r,i.actionData=t,i.data=t.data,null!==t.bone&&(i.bone=r.getBone(t.bone.name)),null!==t.slot&&(i.slot=r.getSlot(t.slot.name))},e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e}(t.BaseObject);t.EventObject=e}(l||(l={})),function(t){var e=function(){function t(){}return t._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},t._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},t._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},t._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},t._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},t._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},t._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},t._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},t._getAnimationBlendType=function(t){switch(t.toLowerCase()){case"none":return 0;case"1d":return 1;default:return 0}},t._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},t.DATA_VERSION_2_3="2.3",t.DATA_VERSION_3_0="3.0",t.DATA_VERSION_4_0="4.0",t.DATA_VERSION_4_5="4.5",t.DATA_VERSION_5_0="5.0",t.DATA_VERSION_5_5="5.5",t.DATA_VERSION_5_6="5.6",t.DATA_VERSION=t.DATA_VERSION_5_6,t.DATA_VERSIONS=[t.DATA_VERSION_4_0,t.DATA_VERSION_4_5,t.DATA_VERSION_5_0,t.DATA_VERSION_5_5,t.DATA_VERSION_5_6],t.TEXTURE_ATLAS="textureAtlas",t.SUB_TEXTURE="SubTexture",t.FORMAT="format",t.IMAGE_PATH="imagePath",t.WIDTH="width",t.HEIGHT="height",t.ROTATED="rotated",t.FRAME_X="frameX",t.FRAME_Y="frameY",t.FRAME_WIDTH="frameWidth",t.FRAME_HEIGHT="frameHeight",t.DRADON_BONES="dragonBones",t.USER_DATA="userData",t.ARMATURE="armature",t.CANVAS="canvas",t.BONE="bone",t.SURFACE="surface",t.SLOT="slot",t.CONSTRAINT="constraint",t.SKIN="skin",t.DISPLAY="display",t.FRAME="frame",t.IK="ik",t.PATH_CONSTRAINT="path",t.ANIMATION="animation",t.TIMELINE="timeline",t.FFD="ffd",t.TRANSLATE_FRAME="translateFrame",t.ROTATE_FRAME="rotateFrame",t.SCALE_FRAME="scaleFrame",t.DISPLAY_FRAME="displayFrame",t.COLOR_FRAME="colorFrame",t.DEFAULT_ACTIONS="defaultActions",t.ACTIONS="actions",t.EVENTS="events",t.INTS="ints",t.FLOATS="floats",t.STRINGS="strings",t.TRANSFORM="transform",t.PIVOT="pivot",t.AABB="aabb",t.COLOR="color",t.VERSION="version",t.COMPATIBLE_VERSION="compatibleVersion",t.FRAME_RATE="frameRate",t.TYPE="type",t.SUB_TYPE="subType",t.NAME="name",t.PARENT="parent",t.TARGET="target",t.STAGE="stage",t.SHARE="share",t.PATH="path",t.LENGTH="length",t.DISPLAY_INDEX="displayIndex",t.Z_ORDER="zOrder",t.Z_INDEX="zIndex",t.BLEND_MODE="blendMode",t.INHERIT_TRANSLATION="inheritTranslation",t.INHERIT_ROTATION="inheritRotation",t.INHERIT_SCALE="inheritScale",t.INHERIT_REFLECTION="inheritReflection",t.INHERIT_ANIMATION="inheritAnimation",t.INHERIT_DEFORM="inheritDeform",t.SEGMENT_X="segmentX",t.SEGMENT_Y="segmentY",t.BEND_POSITIVE="bendPositive",t.CHAIN="chain",t.WEIGHT="weight",t.BLEND_TYPE="blendType",t.FADE_IN_TIME="fadeInTime",t.PLAY_TIMES="playTimes",t.SCALE="scale",t.OFFSET="offset",t.POSITION="position",t.DURATION="duration",t.TWEEN_EASING="tweenEasing",t.TWEEN_ROTATE="tweenRotate",t.TWEEN_SCALE="tweenScale",t.CLOCK_WISE="clockwise",t.CURVE="curve",t.SOUND="sound",t.EVENT="event",t.ACTION="action",t.X="x",t.Y="y",t.SKEW_X="skX",t.SKEW_Y="skY",t.SCALE_X="scX",t.SCALE_Y="scY",t.VALUE="value",t.ROTATE="rotate",t.SKEW="skew",t.ALPHA="alpha",t.ALPHA_OFFSET="aO",t.RED_OFFSET="rO",t.GREEN_OFFSET="gO",t.BLUE_OFFSET="bO",t.ALPHA_MULTIPLIER="aM",t.RED_MULTIPLIER="rM",t.GREEN_MULTIPLIER="gM",t.BLUE_MULTIPLIER="bM",t.UVS="uvs",t.VERTICES="vertices",t.TRIANGLES="triangles",t.WEIGHTS="weights",t.SLOT_POSE="slotPose",t.BONE_POSE="bonePose",t.BONES="bones",t.POSITION_MODE="positionMode",t.SPACING_MODE="spacingMode",t.ROTATE_MODE="rotateMode",t.SPACING="spacing",t.ROTATE_OFFSET="rotateOffset",t.ROTATE_MIX="rotateMix",t.TRANSLATE_MIX="translateMix",t.TARGET_DISPLAY="targetDisplay",t.CLOSED="closed",t.CONSTANT_SPEED="constantSpeed",t.VERTEX_COUNT="vertexCount",t.LENGTHS="lengths",t.GOTO_AND_PLAY="gotoAndPlay",t.DEFAULT_NAME="default",t}();t.DataParser=e}(l||(l={})),function(t){var e=function(e){function r(){var i=null!==e&&e.apply(this,arguments)||this;return i._rawTextureAtlasIndex=0,i._rawBones=[],i._data=null,i._armature=null,i._bone=null,i._geometry=null,i._slot=null,i._skin=null,i._mesh=null,i._animation=null,i._timeline=null,i._rawTextureAtlases=null,i._frameValueType=0,i._defaultColorOffset=-1,i._prevClockwise=0,i._prevRotation=0,i._frameDefaultValue=0,i._frameValueScale=1,i._helpMatrixA=new t.Matrix,i._helpMatrixB=new t.Matrix,i._helpTransform=new t.Transform,i._helpColorTransform=new t.ColorTransform,i._helpPoint=new t.Point,i._helpArray=[],i._intArray=[],i._floatArray=[],i._frameIntArray=[],i._frameFloatArray=[],i._frameArray=[],i._timelineArray=[],i._colorArray=[],i._cacheRawMeshes=[],i._cacheMeshes=[],i._actionFrames=[],i._weightSlotPose={},i._weightBonePoses={},i._cacheBones={},i._slotChildActions={},i}return n(r,e),r._getBoolean=function(t,e,i){if(e in t){var r=t[e],n=typeof r;if("boolean"===n)return r;if("string"!==n)return!!r;switch(r){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},r._getNumber=function(t,e,i){if(e in t){var r=t[e];return null===r||"NaN"===r?i:+r||0}return i},r._getString=function(t,e,i){if(e in t){var r=t[e];return"string"===typeof r?r:String(r)}return i},r.prototype._getCurvePoint=function(t,e,i,r,n,s,a,o,h,l){var c=1-h,u=c*c,p=h*h,d=c*u,f=3*h*u,m=3*c*p,g=h*p;l.x=d*t+f*i+m*n+g*a,l.y=d*e+f*r+m*s+g*o},r.prototype._samplingEasingCurve=function(t,e){var i=t.length;if(i%3==1){for(var r=-2,n=0,s=e.length;n<s;++n){for(var a=(n+1)/(s+1);(r+6<i?t[r+6]:1)<a;)r+=6;for(var o=r>=0&&r+6<i,h=o?t[r]:0,l=o?t[r+1]:0,c=t[r+2],u=t[r+3],p=t[r+4],d=t[r+5],f=o?t[r+6]:1,m=o?t[r+7]:1,g=0,_=1;_-g>1e-4;){var y=.5*(_+g);this._getCurvePoint(h,l,c,u,p,d,f,m,y,this._helpPoint),a-this._helpPoint.x>0?g=y:_=y}e[n]=this._helpPoint.y}return!0}for(r=0,n=0,s=e.length;n<s;++n){for(a=(n+1)/(s+1);t[r+6]<a;)r+=6;for(h=t[r],l=t[r+1],c=t[r+2],u=t[r+3],p=t[r+4],d=t[r+5],f=t[r+6],m=t[r+7],g=0,_=1;_-g>1e-4;){y=.5*(_+g);this._getCurvePoint(h,l,c,u,p,d,f,m,y,this._helpPoint),a-this._helpPoint.x>0?g=y:_=y}e[n]=this._helpPoint.y}return!1},r.prototype._parseActionDataInFrame=function(e,i,r,n){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],i,10,r,n),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],i,11,r,n),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],i,0,r,n),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],i,10,r,n),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],i,0,r,n)},r.prototype._mergeActionFrame=function(t,e,r,n,s){for(var a=this._armature.actions.length,o=this._parseActionData(t,r,n,s),h=0,l=null,c=0,u=o;c<u.length;c++){var p=u[c];this._armature.addAction(p,!1)}0===this._actionFrames.length&&((l=new i).frameStart=0,this._actionFrames.push(l),l=null);for(var d=0,f=this._actionFrames;d<f.length;d++){var m=f[d];if(m.frameStart===e){l=m;break}if(m.frameStart>e)break;h++}null===l&&((l=new i).frameStart=e,this._actionFrames.splice(h,0,l));for(var g=0;g<o.length;++g)l.actions.push(a+g)},r.prototype._parseArmature=function(e,i){var n=t.BaseObject.borrowObject(t.ArmatureData);if(n.name=r._getString(e,t.DataParser.NAME,""),n.frameRate=r._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),n.scale=i,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?n.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):n.type=r._getNumber(e,t.DataParser.TYPE,0),0===n.frameRate&&(n.frameRate=24),this._armature=n,t.DataParser.CANVAS in e){var s=e[t.DataParser.CANVAS],a=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in s?a.hasBackground=!0:a.hasBackground=!1,a.color=r._getNumber(s,t.DataParser.COLOR,0),a.x=r._getNumber(s,t.DataParser.X,0)*n.scale,a.y=r._getNumber(s,t.DataParser.Y,0)*n.scale,a.width=r._getNumber(s,t.DataParser.WIDTH,0)*n.scale,a.height=r._getNumber(s,t.DataParser.HEIGHT,0)*n.scale,n.canvas=a}if(t.DataParser.AABB in e){var o=e[t.DataParser.AABB];n.aabb.x=r._getNumber(o,t.DataParser.X,0)*n.scale,n.aabb.y=r._getNumber(o,t.DataParser.Y,0)*n.scale,n.aabb.width=r._getNumber(o,t.DataParser.WIDTH,0)*n.scale,n.aabb.height=r._getNumber(o,t.DataParser.HEIGHT,0)*n.scale}if(t.DataParser.BONE in e)for(var h=0,l=e[t.DataParser.BONE];h<l.length;h++){var c=l[h],u=r._getString(c,t.DataParser.PARENT,""),p=this._parseBone(c);if(u.length>0){var d=n.getBone(u);null!==d?p.parent=d:(u in this._cacheBones||(this._cacheBones[u]=[]),this._cacheBones[u].push(p))}if(p.name in this._cacheBones){for(var f=0,m=this._cacheBones[p.name];f<m.length;f++){m[f].parent=p}delete this._cacheBones[p.name]}n.addBone(p),this._rawBones.push(p)}if(t.DataParser.IK in e)for(var g=0,_=e[t.DataParser.IK];g<_.length;g++){var y=_[g];(w=this._parseIKConstraint(y))&&n.addConstraint(w)}if(n.sortBones(),t.DataParser.SLOT in e)for(var v=0,b=0,P=e[t.DataParser.SLOT];b<P.length;b++){var T=P[b];n.addSlot(this._parseSlot(T,v++))}if(t.DataParser.SKIN in e)for(var x=0,S=e[t.DataParser.SKIN];x<S.length;x++){var O=S[x];n.addSkin(this._parseSkin(O))}if(t.DataParser.PATH_CONSTRAINT in e)for(var C=0,D=e[t.DataParser.PATH_CONSTRAINT];C<D.length;C++){var w,A=D[C];(w=this._parsePathConstraint(A))&&n.addConstraint(w)}for(var E=0,M=this._cacheRawMeshes.length;E<M;++E){var I=this._cacheRawMeshes[E],B=r._getString(I,t.DataParser.SHARE,"");if(0!==B.length){var k=r._getString(I,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===k.length&&(k=t.DataParser.DEFAULT_NAME);var R=n.getMesh(k,"",B);if(null!==R)this._cacheMeshes[E].geometry.shareFrom(R.geometry)}}if(t.DataParser.ANIMATION in e)for(var N=0,j=e[t.DataParser.ANIMATION];N<j.length;N++){var L=j[N],F=this._parseAnimation(L);n.addAnimation(F)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var z=0,V=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);z<V.length;z++){var H=V[z];if(n.addAction(H,!0),0===H.type)null!==(F=n.getAnimation(H.name))&&(n.defaultAnimation=F)}if(t.DataParser.ACTIONS in e)for(var Y=0,G=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);Y<G.length;Y++){H=G[Y];n.addAction(H,!1)}for(var U in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[U];for(var U in this._weightBonePoses)delete this._weightBonePoses[U];for(var U in this._cacheBones)delete this._cacheBones[U];for(var U in this._slotChildActions)delete this._slotChildActions[U];return n},r.prototype._parseBone=function(e){if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):r._getNumber(e,t.DataParser.TYPE,0))){var i=this._armature.scale,n=t.BaseObject.borrowObject(t.BoneData);return n.inheritTranslation=r._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),n.inheritRotation=r._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),n.inheritScale=r._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),n.inheritReflection=r._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),n.length=r._getNumber(e,t.DataParser.LENGTH,0)*i,n.alpha=r._getNumber(e,t.DataParser.ALPHA,1),n.name=r._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],n.transform,i),n}var s=t.BaseObject.borrowObject(t.SurfaceData);return s.alpha=r._getNumber(e,t.DataParser.ALPHA,1),s.name=r._getString(e,t.DataParser.NAME,""),s.segmentX=r._getNumber(e,t.DataParser.SEGMENT_X,0),s.segmentY=r._getNumber(e,t.DataParser.SEGMENT_Y,0),this._parseGeometry(e,s.geometry),s},r.prototype._parseIKConstraint=function(e){var i=this._armature.getBone(r._getString(e,t.DataParser.BONE,""));if(null===i)return null;var n=this._armature.getBone(r._getString(e,t.DataParser.TARGET,""));if(null===n)return null;var s=r._getNumber(e,t.DataParser.CHAIN,0),a=t.BaseObject.borrowObject(t.IKConstraintData);return a.scaleEnabled=r._getBoolean(e,t.DataParser.SCALE,!1),a.bendPositive=r._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),a.weight=r._getNumber(e,t.DataParser.WEIGHT,1),a.name=r._getString(e,t.DataParser.NAME,""),a.type=0,a.target=n,s>0&&null!==i.parent?(a.root=i.parent,a.bone=i):(a.root=i,a.bone=null),a},r.prototype._parsePathConstraint=function(e){var i=this._armature.getSlot(r._getString(e,t.DataParser.TARGET,""));if(null===i)return null;var n=this._armature.defaultSkin;if(null===n)return null;var s=n.getDisplay(i.name,r._getString(e,t.DataParser.TARGET_DISPLAY,i.name));if(null===s||!(s instanceof t.PathDisplayData))return null;var a=e[t.DataParser.BONES];if(null===a||0===a.length)return null;var o=t.BaseObject.borrowObject(t.PathConstraintData);o.name=r._getString(e,t.DataParser.NAME,""),o.type=1,o.pathSlot=i,o.pathDisplayData=s,o.target=i.parent,o.positionMode=t.DataParser._getPositionMode(r._getString(e,t.DataParser.POSITION_MODE,"")),o.spacingMode=t.DataParser._getSpacingMode(r._getString(e,t.DataParser.SPACING_MODE,"")),o.rotateMode=t.DataParser._getRotateMode(r._getString(e,t.DataParser.ROTATE_MODE,"")),o.position=r._getNumber(e,t.DataParser.POSITION,0),o.spacing=r._getNumber(e,t.DataParser.SPACING,0),o.rotateOffset=r._getNumber(e,t.DataParser.ROTATE_OFFSET,0),o.rotateMix=r._getNumber(e,t.DataParser.ROTATE_MIX,1),o.translateMix=r._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var h=0,l=a;h<l.length;h++){var c=l[h],u=this._armature.getBone(c);null!==u&&(o.AddBone(u),null===o.root&&(o.root=u))}return o},r.prototype._parseSlot=function(e,i){var n=t.BaseObject.borrowObject(t.SlotData);return n.displayIndex=r._getNumber(e,t.DataParser.DISPLAY_INDEX,0),n.zOrder=i,n.zIndex=r._getNumber(e,t.DataParser.Z_INDEX,0),n.alpha=r._getNumber(e,t.DataParser.ALPHA,1),n.name=r._getString(e,t.DataParser.NAME,""),n.parent=this._armature.getBone(r._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?n.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):n.blendMode=r._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(n.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],n.color)):n.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[n.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),n},r.prototype._parseSkin=function(e){var i=t.BaseObject.borrowObject(t.SkinData);if(i.name=r._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var n=e[t.DataParser.SLOT];this._skin=i;for(var s=0,a=n;s<a.length;s++){var o=a[s],h=r._getString(o,t.DataParser.NAME,""),l=this._armature.getSlot(h);if(null!==l){if(this._slot=l,t.DataParser.DISPLAY in o)for(var c=0,u=o[t.DataParser.DISPLAY];c<u.length;c++){var p=u[c];p?i.addDisplay(h,this._parseDisplay(p)):i.addDisplay(h,null)}this._slot=null}}this._skin=null}return i},r.prototype._parseDisplay=function(e){var i=r._getString(e,t.DataParser.NAME,""),n=r._getString(e,t.DataParser.PATH,""),s=0,a=null;switch(s=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):r._getNumber(e,t.DataParser.TYPE,s)){case 0:var o=a=t.BaseObject.borrowObject(t.ImageDisplayData);o.name=i,o.path=n.length>0?n:i,this._parsePivot(e,o);break;case 1:var h=a=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(h.name=i,h.path=n.length>0?n:i,h.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var l=0,c=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);l<c.length;l++){var u=c[l];h.addAction(u)}else if(this._slot.name in this._slotChildActions){var p=this._skin.getDisplays(this._slot.name);if(null===p?0===this._slot.displayIndex:this._slot.displayIndex===p.length){for(var d=0,f=this._slotChildActions[this._slot.name];d<f.length;d++){u=f[d];h.addAction(u)}delete this._slotChildActions[this._slot.name]}}break;case 2:var m=a=t.BaseObject.borrowObject(t.MeshDisplayData);m.geometry.inheritDeform=r._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),m.name=i,m.path=n.length>0?n:i,t.DataParser.SHARE in e?(m.geometry.data=this._data,this._cacheRawMeshes.push(e),this._cacheMeshes.push(m)):this._parseMesh(e,m);break;case 3:var g=this._parseBoundingBox(e);if(null!==g){var _=a=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);_.name=i,_.path=n.length>0?n:i,_.boundingBox=g}break;case 4:var y=e[t.DataParser.LENGTHS],v=a=t.BaseObject.borrowObject(t.PathDisplayData);v.closed=r._getBoolean(e,t.DataParser.CLOSED,!1),v.constantSpeed=r._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),v.name=i,v.path=n.length>0?n:i,v.curveLengths.length=y.length;for(var b=0,P=y.length;b<P;++b)v.curveLengths[b]=y[b];this._parsePath(e,v)}return null!==a&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],a.transform,this._armature.scale),a},r.prototype._parsePath=function(t,e){this._parseGeometry(t,e.geometry)},r.prototype._parsePivot=function(e,i){if(t.DataParser.PIVOT in e){var n=e[t.DataParser.PIVOT];i.pivot.x=r._getNumber(n,t.DataParser.X,0),i.pivot.y=r._getNumber(n,t.DataParser.Y,0)}else i.pivot.x=.5,i.pivot.y=.5},r.prototype._parseMesh=function(e,i){if(this._parseGeometry(e,i.geometry),t.DataParser.WEIGHTS in e){var r=e[t.DataParser.SLOT_POSE],n=e[t.DataParser.BONE_POSE],s=this._skin.name+"_"+this._slot.name+"_"+i.name;this._weightSlotPose[s]=r,this._weightBonePoses[s]=n}},r.prototype._parseBoundingBox=function(e){var i=null,n=0;switch(n=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):r._getNumber(e,t.DataParser.SUB_TYPE,n)){case 0:i=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:i=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(e)}return null!==i&&(i.color=r._getNumber(e,t.DataParser.COLOR,0),0!==i.type&&1!==i.type||(i.width=r._getNumber(e,t.DataParser.WIDTH,0),i.height=r._getNumber(e,t.DataParser.HEIGHT,0))),i},r.prototype._parsePolygonBoundingBox=function(e){var i=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var r=this._armature.scale,n=e[t.DataParser.VERTICES],s=i.vertices;s.length=n.length;for(var a=0,o=n.length;a<o;a+=2){var h=n[a]*r,l=n[a+1]*r;s[a]=h,s[a+1]=l,0===a?(i.x=h,i.y=l,i.width=h,i.height=l):(h<i.x?i.x=h:h>i.width&&(i.width=h),l<i.y?i.y=l:l>i.height&&(i.height=l))}i.width-=i.x,i.height-=i.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return i},r.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);if(i.blendType=t.DataParser._getAnimationBlendType(r._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=r._getNumber(e,t.DataParser.DURATION,0),i.playTimes=r._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=r._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=r._getNumber(e,t.DataParser.SCALE,1),i.name=r._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),i.frameIntOffset=this._frameIntArray.length,i.frameFloatOffset=this._frameFloatArray.length,i.frameOffset=this._frameArray.length,this._animation=i,t.DataParser.FRAME in e){var n=e[t.DataParser.FRAME],s=n.length;if(s>0)for(var a=0,o=0;a<s;++a){var h=n[a];this._parseActionDataInFrame(h,o,null,null),o+=r._getNumber(h,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,0,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var l=0,c=e[t.DataParser.BONE];l<c.length;l++){var u=c[l];this._parseBoneTimeline(u)}if(t.DataParser.SLOT in e)for(var p=0,d=e[t.DataParser.SLOT];p<d.length;p++){u=d[p];this._parseSlotTimeline(u)}if(t.DataParser.FFD in e)for(var f=0,m=e[t.DataParser.FFD];f<m.length;f++){u=m[f];var g=r._getString(u,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),_=r._getString(u,t.DataParser.SLOT,""),y=r._getString(u,t.DataParser.NAME,"");if(0===g.length&&(g=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(_),this._mesh=this._armature.getMesh(g,_,y),null!==this._slot&&null!==this._mesh)null!==(C=this._parseTimeline(u,null,t.DataParser.FRAME,22,2,0,this._parseSlotDeformFrame))&&this._animation.addSlotTimeline(_,C),this._slot=null,this._mesh=null}if(t.DataParser.IK in e)for(var v=0,b=e[t.DataParser.IK];v<b.length;v++){u=b[v];var P=r._getString(u,t.DataParser.NAME,"");if(null!==this._armature.getConstraint(P))null!==(C=this._parseTimeline(u,null,t.DataParser.FRAME,30,1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(P,C)}if(this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,0,0,this._parseActionFrame),this._actionFrames.length=0),t.DataParser.TIMELINE in e)for(var T=0,x=e[t.DataParser.TIMELINE];T<x.length;T++){u=x[T];var S=r._getNumber(u,t.DataParser.TYPE,0),O=r._getString(u,t.DataParser.NAME,""),C=null;switch(S){case 0:break;case 20:case 23:case 60:case 24:case 40:case 41:if(20===S?(this._frameValueType=0,this._frameValueScale=1):(this._frameValueType=1,this._frameValueScale=23===S?1:40===S||41===S?1e4:100),this._frameDefaultValue=60===S||24===S||41===S?1:0,40===S&&0!==i.blendType){var D=C=t.BaseObject.borrowObject(t.AnimationTimelineData);D.x=r._getNumber(u,t.DataParser.X,0),D.y=r._getNumber(u,t.DataParser.Y,0)}C=this._parseTimeline(u,null,t.DataParser.FRAME,S,this._frameValueType,1,this._parseSingleValueFrame,C);break;case 11:case 12:case 13:case 30:case 42:30===S||42===S?(this._frameValueType=1,this._frameValueScale=42===S?1e4:100):(this._frameValueScale=12===S?t.Transform.DEG_RAD:1,this._frameValueType=2),this._frameDefaultValue=13===S||30===S?1:0,C=this._parseTimeline(u,null,t.DataParser.FRAME,S,this._frameValueType,2,this._parseDoubleValueFrame);break;case 1:break;case 50:var w=this._armature.getBone(O);if(null===w)continue;this._geometry=w.geometry,C=this._parseTimeline(u,null,t.DataParser.FRAME,S,2,0,this._parseDeformFrame),this._geometry=null;break;case 22:for(var g in this._geometry=null,this._armature.skins){var A=this._armature.skins[g];for(var E in A.displays)for(var M=0,I=A.displays[E];M<I.length;M++){var B=I[M];if(null!==B&&B.name===O){this._geometry=B.geometry;break}}}if(null===this._geometry)continue;C=this._parseTimeline(u,null,t.DataParser.FRAME,S,2,0,this._parseDeformFrame),this._geometry=null;break;case 21:C=this._parseTimeline(u,null,t.DataParser.FRAME,S,1,1,this._parseSlotColorFrame)}if(null!==C)switch(S){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(O,C);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(O,C);break;case 30:this._animation.addConstraintTimeline(O,C);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(O,C)}}return this._animation=null,i},r.prototype._parseTimeline=function(e,n,s,a,o,h,l,c){if(void 0===c&&(c=null),null!==e&&s.length>0&&s in e&&(n=e[s]),null===n)return null;var u=n.length;if(0===u)return null;var p=this._frameIntArray.length,d=this._frameFloatArray.length,f=this._timelineArray.length;switch(null===c&&(c=t.BaseObject.borrowObject(t.TimelineData)),c.type=a,c.offset=f,this._frameValueType=o,this._timeline=c,this._timelineArray.length+=5+u,null!==e?(this._timelineArray[f+0]=Math.round(100*r._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[f+1]=Math.round(100*r._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[f+0]=100,this._timelineArray[f+1]=0),this._timelineArray[f+2]=u,this._timelineArray[f+3]=h,this._frameValueType){case 0:this._timelineArray[f+4]=0;break;case 1:this._timelineArray[f+4]=p-this._animation.frameIntOffset;break;case 2:this._timelineArray[f+4]=d-this._animation.frameFloatOffset}if(1===u)c.frameIndicesOffset=-1,this._timelineArray[f+5+0]=l.call(this,n[0],0,0)-this._animation.frameOffset;else{var m=this._animation.frameCount+1,g=this._data.frameIndices,_=g.length;g.length+=m,c.frameIndicesOffset=_;for(var y=0,v=0,b=0,P=0;y<m;++y){if(b+P<=y&&v<u){var T=n[v];b=y,P=v===u-1?this._animation.frameCount-b:T instanceof i?this._actionFrames[v+1].frameStart-b:r._getNumber(T,t.DataParser.DURATION,1),this._timelineArray[f+5+v]=l.call(this,T,b,P)-this._animation.frameOffset,v++}g[_+y]=v-1}}return this._timeline=null,c},r.prototype._parseBoneTimeline=function(e){var i=this._armature.getBone(r._getString(e,t.DataParser.NAME,""));if(null!==i){var n;if(this._bone=i,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e)this._frameDefaultValue=0,this._frameValueScale=1,null!==(n=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,2,2,this._parseDoubleValueFrame))&&this._animation.addBoneTimeline(i.name,n);if(t.DataParser.ROTATE_FRAME in e)this._frameDefaultValue=0,this._frameValueScale=1,null!==(n=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,2,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(i.name,n);if(t.DataParser.SCALE_FRAME in e)this._frameDefaultValue=1,this._frameValueScale=1,null!==(n=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,2,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(i.name,n);if(t.DataParser.FRAME in e)null!==(n=this._parseTimeline(e,null,t.DataParser.FRAME,10,2,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(i.name,n);this._bone=null,this._slot=null}},r.prototype._parseSlotTimeline=function(e){var i=this._armature.getSlot(r._getString(e,t.DataParser.NAME,""));if(null!==i){var n=null,s=null;this._slot=i,n=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,0,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,0,0,this._parseSlotDisplayFrame),s=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,1,1,this._parseSlotColorFrame),null!==n&&this._animation.addSlotTimeline(i.name,n),null!==s&&this._animation.addSlotTimeline(i.name,s),this._slot=null}},r.prototype._parseFrame=function(t,e,i){var r=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[r+0]=e,r},r.prototype._parseTweenFrame=function(e,i,n){var s=this._parseFrame(e,i,n);if(n>0)if(t.DataParser.CURVE in e){var a=n+1;this._helpArray.length=a;var o=this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray);this._frameArray.length+=2+this._helpArray.length,this._frameArray[s+1]=2,this._frameArray[s+2]=o?a:-a;for(var h=0;h<a;++h)this._frameArray[s+3+h]=Math.round(1e4*this._helpArray[h])}else{var l=-2;t.DataParser.TWEEN_EASING in e&&(l=r._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===l?(this._frameArray.length+=1,this._frameArray[s+1]=0):0===l?(this._frameArray.length+=1,this._frameArray[s+1]=1):l<0?(this._frameArray.length+=2,this._frameArray[s+1]=3,this._frameArray[s+2]=Math.round(100*-l)):l<=1?(this._frameArray.length+=2,this._frameArray[s+1]=4,this._frameArray[s+2]=Math.round(100*l)):(this._frameArray.length+=2,this._frameArray[s+1]=5,this._frameArray[s+2]=Math.round(100*l-100))}else this._frameArray.length+=1,this._frameArray[s+1]=0;return s},r.prototype._parseSingleValueFrame=function(e,i,n){var s=0;switch(this._frameValueType){case 0:s=this._parseFrame(e,i,n),this._frameArray.length+=1,this._frameArray[s+1]=r._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue);break;case 1:s=this._parseTweenFrame(e,i,n);var a=this._frameIntArray.length;this._frameIntArray.length+=1,this._frameIntArray[a]=Math.round(r._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale);break;case 2:s=this._parseTweenFrame(e,i,n);a=this._frameFloatArray.length;this._frameFloatArray.length+=1,this._frameFloatArray[a]=r._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale}return s},r.prototype._parseDoubleValueFrame=function(e,i,n){var s=0;switch(this._frameValueType){case 0:s=this._parseFrame(e,i,n),this._frameArray.length+=2,this._frameArray[s+1]=r._getNumber(e,t.DataParser.X,this._frameDefaultValue),this._frameArray[s+2]=r._getNumber(e,t.DataParser.Y,this._frameDefaultValue);break;case 1:s=this._parseTweenFrame(e,i,n);var a=this._frameIntArray.length;this._frameIntArray.length+=2,this._frameIntArray[a]=Math.round(r._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale),this._frameIntArray[a+1]=Math.round(r._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale);break;case 2:s=this._parseTweenFrame(e,i,n);a=this._frameFloatArray.length;this._frameFloatArray.length+=2,this._frameFloatArray[a]=r._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale,this._frameFloatArray[a+1]=r._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale}return s},r.prototype._parseActionFrame=function(t,e,i){var r=this._frameArray.length,n=t.actions.length;this._frameArray.length+=2+n,this._frameArray[r+0]=e,this._frameArray[r+0+1]=n;for(var s=0;s<n;++s)this._frameArray[r+0+2+s]=t.actions[s];return r},r.prototype._parseZOrderFrame=function(e,i,r){var n=this._parseFrame(e,i,r);if(t.DataParser.Z_ORDER in e){var s=e[t.DataParser.Z_ORDER];if(s.length>0){for(var a=this._armature.sortedSlots.length,o=new Array(a-s.length/2),h=new Array(a),l=0;l<o.length;++l)o[l]=0;for(var c=0;c<a;++c)h[c]=-1;for(var u=0,p=0,d=0,f=s.length;d<f;d+=2){for(var m=s[d],g=s[d+1];u!==m;)o[p++]=u++;h[u+g]=u++}for(;u<a;)o[p++]=u++;this._frameArray.length+=1+a,this._frameArray[n+1]=a;for(var _=a;_--;)-1===h[_]?this._frameArray[n+2+_]=o[--p]||0:this._frameArray[n+2+_]=h[_]||0;return n}}return this._frameArray.length+=1,this._frameArray[n+1]=0,n},r.prototype._parseBoneAllFrame=function(e,i,n){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var s=this._helpTransform.rotation;0!==i&&(0===this._prevClockwise?s=this._prevRotation+t.Transform.normalizeRadian(s-this._prevRotation):((this._prevClockwise>0?s>=this._prevRotation:s<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),s=this._prevRotation+s-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=r._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=s;var a=this._parseTweenFrame(e,i,n),o=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[o++]=this._helpTransform.x,this._frameFloatArray[o++]=this._helpTransform.y,this._frameFloatArray[o++]=s,this._frameFloatArray[o++]=this._helpTransform.skew,this._frameFloatArray[o++]=this._helpTransform.scaleX,this._frameFloatArray[o++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,i,this._bone,this._slot),a},r.prototype._parseBoneTranslateFrame=function(e,i,n){var s=this._parseTweenFrame(e,i,n),a=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[a++]=r._getNumber(e,t.DataParser.X,0),this._frameFloatArray[a++]=r._getNumber(e,t.DataParser.Y,0),s},r.prototype._parseBoneRotateFrame=function(e,i,n){var s=r._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==i&&(0===this._prevClockwise?s=this._prevRotation+t.Transform.normalizeRadian(s-this._prevRotation):((this._prevClockwise>0?s>=this._prevRotation:s<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),s=this._prevRotation+s-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=r._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=s;var a=this._parseTweenFrame(e,i,n),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=s,this._frameFloatArray[o++]=r._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,a},r.prototype._parseBoneScaleFrame=function(e,i,n){var s=this._parseTweenFrame(e,i,n),a=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[a++]=r._getNumber(e,t.DataParser.X,1),this._frameFloatArray[a++]=r._getNumber(e,t.DataParser.Y,1),s},r.prototype._parseSlotDisplayFrame=function(e,i,n){var s=this._parseFrame(e,i,n);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[s+1]=r._getNumber(e,t.DataParser.VALUE,0):this._frameArray[s+1]=r._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,i,this._slot.parent,this._slot),s},r.prototype._parseSlotColorFrame=function(e,i,r){var n=this._parseTweenFrame(e,i,r),s=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var a=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var o in a){this._parseColorTransform(a,this._helpColorTransform),s=this._colorArray.length,this._colorArray.length+=8,this._colorArray[s++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._colorArray[s++]=Math.round(100*this._helpColorTransform.redMultiplier),this._colorArray[s++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._colorArray[s++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._colorArray[s++]=Math.round(this._helpColorTransform.alphaOffset),this._colorArray[s++]=Math.round(this._helpColorTransform.redOffset),this._colorArray[s++]=Math.round(this._helpColorTransform.greenOffset),this._colorArray[s++]=Math.round(this._helpColorTransform.blueOffset),s-=8;break}}s<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=s=this._colorArray.length,this._colorArray.length+=8,this._colorArray[s++]=100,this._colorArray[s++]=100,this._colorArray[s++]=100,this._colorArray[s++]=100,this._colorArray[s++]=0,this._colorArray[s++]=0,this._colorArray[s++]=0,this._colorArray[s++]=0),s=this._defaultColorOffset);var h=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[h]=s,n},r.prototype._parseSlotDeformFrame=function(e,i,n){var s=this._frameFloatArray.length,a=this._parseTweenFrame(e,i,n),o=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,h=r._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._mesh.geometry.offset+0],c=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,u=this._mesh.geometry.weight,p=0,d=0,f=0,m=0;if(null!==u){var g=this._weightSlotPose[c];this._helpMatrixA.copyFromArray(g,0),this._frameFloatArray.length+=2*u.count,f=u.offset+2+u.bones.length}else this._frameFloatArray.length+=2*l;for(var _=0;_<2*l;_+=2)if(null===o?(p=0,d=0):(p=_<h||_-h>=o.length?0:o[_-h],d=_+1<h||_+1-h>=o.length?0:o[_+1-h]),null!==u){var y=this._weightBonePoses[c],v=this._intArray[f++];this._helpMatrixA.transformPoint(p,d,this._helpPoint,!0),p=this._helpPoint.x,d=this._helpPoint.y;for(var b=0;b<v;++b){var P=this._intArray[f++];this._helpMatrixB.copyFromArray(y,7*P+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(p,d,this._helpPoint,!0),this._frameFloatArray[s+m++]=this._helpPoint.x,this._frameFloatArray[s+m++]=this._helpPoint.y}}else this._frameFloatArray[s+_]=p,this._frameFloatArray[s+_+1]=d;if(0===i){var T=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[T+0]=this._mesh.geometry.offset,this._frameIntArray[T+1]=this._frameFloatArray.length-s,this._frameIntArray[T+2]=this._frameFloatArray.length-s,this._frameIntArray[T+3]=0,this._frameIntArray[T+4]=s-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=T-this._animation.frameIntOffset}return a},r.prototype._parseIKConstraintFrame=function(e,i,n){var s=this._parseTweenFrame(e,i,n),a=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[a++]=r._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[a++]=Math.round(100*r._getNumber(e,t.DataParser.WEIGHT,1)),s},r.prototype._parseActionData=function(e,i,n,s){var a=new Array;if("string"==typeof e)(c=t.BaseObject.borrowObject(t.ActionData)).type=i,c.name=e,c.bone=n,c.slot=s,a.push(c);else if(e instanceof Array)for(var o=0,h=e;o<h.length;o++){var l=h[o],c=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in l?(c.type=0,c.name=r._getString(l,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in l&&"string"==typeof l[t.DataParser.TYPE]?c.type=t.DataParser._getActionType(l[t.DataParser.TYPE]):c.type=r._getNumber(l,t.DataParser.TYPE,i),c.name=r._getString(l,t.DataParser.NAME,"")),t.DataParser.BONE in l){var u=r._getString(l,t.DataParser.BONE,"");c.bone=this._armature.getBone(u)}else c.bone=n;if(t.DataParser.SLOT in l){var p=r._getString(l,t.DataParser.SLOT,"");c.slot=this._armature.getSlot(p)}else c.slot=s;var d=null;if(t.DataParser.INTS in l){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var f=0,m=l[t.DataParser.INTS];f<m.length;f++){var g=m[f];d.addInt(g)}}if(t.DataParser.FLOATS in l){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var _=0,y=l[t.DataParser.FLOATS];_<y.length;_++){g=y[_];d.addFloat(g)}}if(t.DataParser.STRINGS in l){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var v=0,b=l[t.DataParser.STRINGS];v<b.length;v++){g=b[v];d.addString(g)}}c.data=d,a.push(c)}return a},r.prototype._parseDeformFrame=function(e,i,n){var s=this._frameFloatArray.length,a=this._parseTweenFrame(e,i,n),o=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:t.DataParser.VALUE in e?e[t.DataParser.VALUE]:null,h=r._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._geometry.offset+0],c=0,u=0;if(null!==this._geometry.weight);else{this._frameFloatArray.length+=2*l;for(var p=0;p<2*l;p+=2)null!==o?(c=p<h||p-h>=o.length?0:o[p-h],u=p+1<h||p+1-h>=o.length?0:o[p+1-h]):(c=0,u=0),this._frameFloatArray[s+p]=c,this._frameFloatArray[s+p+1]=u}if(0===i){var d=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[d+0]=this._geometry.offset,this._frameIntArray[d+1]=this._frameFloatArray.length-s,this._frameIntArray[d+2]=this._frameFloatArray.length-s,this._frameIntArray[d+3]=0,this._frameIntArray[d+4]=s-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=d-this._animation.frameIntOffset}return a},r.prototype._parseTransform=function(e,i,n){i.x=r._getNumber(e,t.DataParser.X,0)*n,i.y=r._getNumber(e,t.DataParser.Y,0)*n,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(i.rotation=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(i.rotation=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(r._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-i.rotation),i.scaleX=r._getNumber(e,t.DataParser.SCALE_X,1),i.scaleY=r._getNumber(e,t.DataParser.SCALE_Y,1)},r.prototype._parseColorTransform=function(e,i){i.alphaMultiplier=.01*r._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),i.redMultiplier=.01*r._getNumber(e,t.DataParser.RED_MULTIPLIER,100),i.greenMultiplier=.01*r._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),i.blueMultiplier=.01*r._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),i.alphaOffset=r._getNumber(e,t.DataParser.ALPHA_OFFSET,0),i.redOffset=r._getNumber(e,t.DataParser.RED_OFFSET,0),i.greenOffset=r._getNumber(e,t.DataParser.GREEN_OFFSET,0),i.blueOffset=r._getNumber(e,t.DataParser.BLUE_OFFSET,0)},r.prototype._parseGeometry=function(e,i){var r=e[t.DataParser.VERTICES],n=Math.floor(r.length/2),s=0,a=this._intArray.length,o=this._floatArray.length;i.offset=a,i.data=this._data,this._intArray.length+=4,this._intArray[a+0]=n,this._intArray[a+2]=o,this._intArray[a+3]=-1,this._floatArray.length+=2*n;for(var h=0,l=2*n;h<l;++h)this._floatArray[o+h]=r[h];if(t.DataParser.TRIANGLES in e){var c=e[t.DataParser.TRIANGLES];s=Math.floor(c.length/3),this._intArray.length+=3*s;for(h=0,l=3*s;h<l;++h)this._intArray[a+4+h]=c[h]}if(this._intArray[a+1]=s,t.DataParser.UVS in e){var u=e[t.DataParser.UVS],p=o+2*n;this._floatArray.length+=2*n;for(h=0,l=2*n;h<l;++h)this._floatArray[p+h]=u[h]}if(t.DataParser.WEIGHTS in e){var d=e[t.DataParser.WEIGHTS],f=Math.floor(d.length-n)/2,m=this._intArray.length,g=this._floatArray.length,_=0,y=this._armature.sortedBones,v=t.BaseObject.borrowObject(t.WeightData);if(v.count=f,v.offset=m,this._intArray.length+=2+_+n+f,this._intArray[m+1]=g,t.DataParser.BONE_POSE in e){var b=e[t.DataParser.SLOT_POSE],P=e[t.DataParser.BONE_POSE],T=new Array;_=Math.floor(P.length/7),T.length=_;for(h=0;h<_;++h){var x=P[7*h],S=this._rawBones[x];v.addBone(S),T[h]=x,this._intArray[m+2+h]=y.indexOf(S)}this._floatArray.length+=3*f,this._helpMatrixA.copyFromArray(b,0);h=0;for(var O=0,C=m+2+_,D=g;h<n;++h){var w=2*h,A=this._intArray[C++]=d[O++],E=this._floatArray[o+w],M=this._floatArray[o+w+1];this._helpMatrixA.transformPoint(E,M,this._helpPoint),E=this._helpPoint.x,M=this._helpPoint.y;for(var I=0;I<A;++I){x=d[O++];var B=T.indexOf(x);this._helpMatrixB.copyFromArray(P,7*B+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(E,M,this._helpPoint),this._intArray[C++]=B,this._floatArray[D++]=d[O++],this._floatArray[D++]=this._helpPoint.x,this._floatArray[D++]=this._helpPoint.y}}}else{var k=e[t.DataParser.BONES];_=k.length;for(h=0;h<_;h++){x=k[h],S=this._rawBones[x];v.addBone(S),this._intArray[m+2+h]=y.indexOf(S)}this._floatArray.length+=3*f;h=0,O=0,D=0,C=m+2+_;for(var R=g;h<f;h++){A=d[O++];this._intArray[C++]=A;for(I=0;I<A;I++){B=d[O++];var N=d[O++];E=r[D++],M=r[D++];this._intArray[C++]=k.indexOf(B),this._floatArray[R++]=N,this._floatArray[R++]=E,this._floatArray[R++]=M}}}i.weight=v}},r.prototype._parseArray=function(t){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0,this._colorArray.length=0},r.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0),this._timelineArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._colorArray.push(0);for(var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,r=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,n=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,s=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,a=this._colorArray.length*Int16Array.BYTES_PER_ELEMENT,o=new ArrayBuffer(t+e+i+r+n+s+a),h=new Int16Array(o,0,this._intArray.length),l=new Float32Array(o,t,this._floatArray.length),c=new Int16Array(o,t+e,this._frameIntArray.length),u=new Float32Array(o,t+e+i,this._frameFloatArray.length),p=new Int16Array(o,t+e+i+r,this._frameArray.length),d=new Uint16Array(o,t+e+i+r+n,this._timelineArray.length),f=new Int16Array(o,t+e+i+r+n+s,this._colorArray.length),m=0,g=this._intArray.length;m<g;++m)h[m]=this._intArray[m];for(m=0,g=this._floatArray.length;m<g;++m)l[m]=this._floatArray[m];for(m=0,g=this._frameIntArray.length;m<g;++m)c[m]=this._frameIntArray[m];for(m=0,g=this._frameFloatArray.length;m<g;++m)u[m]=this._frameFloatArray[m];for(m=0,g=this._frameArray.length;m<g;++m)p[m]=this._frameArray[m];for(m=0,g=this._timelineArray.length;m<g;++m)d[m]=this._timelineArray[m];for(m=0,g=this._colorArray.length;m<g;++m)f[m]=this._colorArray[m];this._data.binary=o,this._data.intArray=h,this._data.floatArray=l,this._data.frameIntArray=c,this._data.frameFloatArray=u,this._data.frameArray=p,this._data.timelineArray=d,this._data.colorArray=f,this._defaultColorOffset=-1},r.prototype.parseDragonBonesData=function(e,i){void 0===i&&(i=1),console.assert(null!=e,"Data error.");var n=r._getString(e,t.DataParser.VERSION,""),s=r._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(n)>=0||t.DataParser.DATA_VERSIONS.indexOf(s)>=0){var a=t.BaseObject.borrowObject(t.DragonBonesData);if(a.version=n,a.name=r._getString(e,t.DataParser.NAME,""),a.frameRate=r._getNumber(e,t.DataParser.FRAME_RATE,24),0===a.frameRate&&(a.frameRate=24),t.DataParser.ARMATURE in e){this._data=a,this._parseArray(e);for(var o=0,h=e[t.DataParser.ARMATURE];o<h.length;o++){var l=h[o];a.addArmature(this._parseArmature(l,i))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?a.stage=a.getArmature(r._getString(e,t.DataParser.STAGE,"")):a.armatureNames.length>0&&(a.stage=a.getArmature(a.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),a}return console.assert(!1,"Nonsupport data version: "+n+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},r.prototype.parseTextureAtlasData=function(e,i,n){if(void 0===n&&(n=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var s=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(s,i,n),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(i.width=r._getNumber(e,t.DataParser.WIDTH,0),i.height=r._getNumber(e,t.DataParser.HEIGHT,0),i.scale=1===n?1/r._getNumber(e,t.DataParser.SCALE,1):n,i.name=r._getString(e,t.DataParser.NAME,""),i.imagePath=r._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var a=e[t.DataParser.SUB_TEXTURE],o=0,h=a.length;o<h;++o){var l=a[o],c=r._getNumber(l,t.DataParser.FRAME_WIDTH,-1),u=r._getNumber(l,t.DataParser.FRAME_HEIGHT,-1),p=i.createTexture();p.rotated=r._getBoolean(l,t.DataParser.ROTATED,!1),p.name=r._getString(l,t.DataParser.NAME,""),p.region.x=r._getNumber(l,t.DataParser.X,0),p.region.y=r._getNumber(l,t.DataParser.Y,0),p.region.width=r._getNumber(l,t.DataParser.WIDTH,0),p.region.height=r._getNumber(l,t.DataParser.HEIGHT,0),c>0&&u>0&&(p.frame=t.TextureData.createRectangle(),p.frame.x=r._getNumber(l,t.DataParser.FRAME_X,0),p.frame.y=r._getNumber(l,t.DataParser.FRAME_Y,0),p.frame.width=c,p.frame.height=u),i.addTexture(p)}return!0},r.getInstance=function(){return null===r._objectDataParserInstance&&(r._objectDataParserInstance=new r),r._objectDataParserInstance},r._objectDataParserInstance=null,r}(t.DataParser);t.ObjectDataParser=e;var i=function(){return function(){this.frameStart=0,this.actions=[]}}();t.ActionFrame=i}(l||(l={})),function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return n(i,e),i.prototype._inRange=function(t,e,i){return e<=t&&t<=i},i.prototype._decodeUTF8=function(t){for(var e,i=0,r="",n=0,s=0,a=0,o=0;t.length>i;){var h=t[i++];if(-1===h)e=0!==s?65533:-1;else if(0===s)this._inRange(h,0,127)?e=h:(this._inRange(h,194,223)?(s=1,o=128,n=h-192):this._inRange(h,224,239)?(s=2,o=2048,n=h-224):this._inRange(h,240,244)&&(s=3,o=65536,n=h-240),n*=Math.pow(64,s),e=null);else if(this._inRange(h,128,191))if(a+=1,n+=(h-128)*Math.pow(64,s-a),a!==s)e=null;else{var l=n,c=o;n=0,s=0,a=0,o=0,e=this._inRange(l,c,1114111)&&!this._inRange(l,55296,57343)?l:h}else n=0,s=0,a=0,o=0,i--,e=h;null!==e&&-1!==e&&(e<=65535?e>0&&(r+=String.fromCharCode(e)):(e-=65536,r+=String.fromCharCode(55296+(e>>10&1023)),r+=String.fromCharCode(56320+(1023&e))))}return r},i.prototype._parseBinaryTimeline=function(e,i,r){void 0===r&&(r=null);var n=null!==r?r:t.BaseObject.borrowObject(t.TimelineData);n.type=e,n.offset=i,this._timeline=n;var s=this._timelineArrayBuffer[n.offset+2];if(1===s)n.frameIndicesOffset=-1;else{var a,o=this._animation.frameCount+1,h=this._data.frameIndices;a=h.length,h.length+=o,n.frameIndicesOffset=a;for(var l=0,c=0,u=0,p=0;l<o;++l)u+p<=l&&c<s&&(u=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+c]],p=c===s-1?this._animation.frameCount-u:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[n.offset+5+c+1]]-u,c++),h[a+l]=c-1}return this._timeline=null,n},i.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);i.blendType=t.DataParser._getAnimationBlendType(t.ObjectDataParser._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,0),i.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME);var r=e[t.DataParser.OFFSET];if(i.frameIntOffset=r[0],i.frameFloatOffset=r[1],i.frameOffset=r[2],this._animation=i,t.DataParser.ACTION in e&&(i.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(i.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var n=e[t.DataParser.BONE];for(var s in n){var a=n[s],o=this._armature.getBone(s);if(null!==o)for(var h=0,l=a.length;h<l;h+=2){var c=a[h],u=a[h+1],p=this._parseBinaryTimeline(c,u);this._animation.addBoneTimeline(o.name,p)}}}if(t.DataParser.SLOT in e){n=e[t.DataParser.SLOT];for(var s in n){a=n[s];var d=this._armature.getSlot(s);if(null!==d)for(h=0,l=a.length;h<l;h+=2){c=a[h],u=a[h+1],p=this._parseBinaryTimeline(c,u);this._animation.addSlotTimeline(d.name,p)}}}if(t.DataParser.CONSTRAINT in e){n=e[t.DataParser.CONSTRAINT];for(var s in n){a=n[s];var f=this._armature.getConstraint(s);if(null!==f)for(h=0,l=a.length;h<l;h+=2){c=a[h],u=a[h+1],p=this._parseBinaryTimeline(c,u);this._animation.addConstraintTimeline(f.name,p)}}}if(t.DataParser.TIMELINE in e)for(var m=0,g=a=e[t.DataParser.TIMELINE];m<g.length;m++){var _=g[m];if((u=t.ObjectDataParser._getNumber(_,t.DataParser.OFFSET,0))>=0){c=t.ObjectDataParser._getNumber(_,t.DataParser.TYPE,0);var y=t.ObjectDataParser._getString(_,t.DataParser.NAME,"");p=null;if(40===c&&0!==i.blendType){var v=p=t.BaseObject.borrowObject(t.AnimationTimelineData);v.x=t.ObjectDataParser._getNumber(_,t.DataParser.X,0),v.y=t.ObjectDataParser._getNumber(_,t.DataParser.Y,0)}switch(p=this._parseBinaryTimeline(c,u,p),c){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(y,p);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(y,p);break;case 30:this._animation.addConstraintTimeline(y,p);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(y,p)}}}return this._animation=null,i},i.prototype._parseGeometry=function(e,i){i.offset=e[t.DataParser.OFFSET],i.data=this._data;var r=this._intArrayBuffer[i.offset+3];if(r>=0){var n=t.BaseObject.borrowObject(t.WeightData),s=this._intArrayBuffer[i.offset+0],a=this._intArrayBuffer[r+0];n.offset=r;for(var o=0;o<a;++o){var h=this._intArrayBuffer[r+2+o];n.addBone(this._rawBones[h])}for(var l=r+2+a,c=0,u=(o=0,s);o<u;++o){var p=this._intArrayBuffer[l++];c+=p,l+=p}n.count=c,i.weight=n}},i.prototype._parseArray=function(e){var i=e[t.DataParser.OFFSET],r=i[1],n=i[3],s=i[5],a=i[7],o=i[9],h=i[11],l=i.length>12?i[13]:0,c=new Int16Array(this._binary,this._binaryOffset+i[0],r/Int16Array.BYTES_PER_ELEMENT),u=new Float32Array(this._binary,this._binaryOffset+i[2],n/Float32Array.BYTES_PER_ELEMENT),p=new Int16Array(this._binary,this._binaryOffset+i[4],s/Int16Array.BYTES_PER_ELEMENT),d=new Float32Array(this._binary,this._binaryOffset+i[6],a/Float32Array.BYTES_PER_ELEMENT),f=new Int16Array(this._binary,this._binaryOffset+i[8],o/Int16Array.BYTES_PER_ELEMENT),m=new Uint16Array(this._binary,this._binaryOffset+i[10],h/Uint16Array.BYTES_PER_ELEMENT),g=l>0?new Int16Array(this._binary,this._binaryOffset+i[12],l/Int16Array.BYTES_PER_ELEMENT):c;this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=c,this._data.floatArray=u,this._data.frameIntArray=p,this._data.frameFloatArray=d,this._data.frameArray=this._frameArrayBuffer=f,this._data.timelineArray=this._timelineArrayBuffer=m,this._data.colorArray=g},i.prototype.parseDragonBonesData=function(t,i){void 0===i&&(i=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var r=new Uint8Array(t,0,8);if(r[0]!=="D".charCodeAt(0)||r[1]!=="B".charCodeAt(0)||r[2]!=="D".charCodeAt(0)||r[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var n=new Uint32Array(t,8,1)[0],s=new Uint8Array(t,12,n),a=this._decodeUTF8(s),o=JSON.parse(a);return this._binaryOffset=12+n,this._binary=t,e.prototype.parseDragonBonesData.call(this,o,i)},i.getInstance=function(){return null===i._binaryDataParserInstance&&(i._binaryDataParserInstance=new i),i._binaryDataParserInstance},i._binaryDataParserInstance=null,i}(t.ObjectDataParser);t.BinaryDataParser=e}(l||(l={})),function(t){var e=function(){function e(i){void 0===i&&(i=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===e._objectParser&&(e._objectParser=new t.ObjectDataParser),null===e._binaryParser&&(e._binaryParser=new t.BinaryDataParser),this._dataParser=null!==i?i:e._objectParser}return e.prototype._isSupportMesh=function(){return!0},e.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,r=this._textureAtlasDataMap[t];i<r.length;i++){if(null!==(h=(o=r[i]).getTexture(e)))return h}if(this.autoSearch)for(var n in this._textureAtlasDataMap)for(var s=0,a=this._textureAtlasDataMap[n];s<a.length;s++){var o,h;if((o=a[s]).autoSearch)if(null!==(h=o.getTexture(e)))return h}return null},e.prototype._fillBuildArmaturePackage=function(t,e,i,r,n){var s=null,a=null;if(e.length>0&&e in this._dragonBonesDataMap&&(a=(s=this._dragonBonesDataMap[e]).getArmature(i)),null===a&&(0===e.length||this.autoSearch))for(var o in this._dragonBonesDataMap)if(s=this._dragonBonesDataMap[o],(0===e.length||s.autoSearch)&&null!==(a=s.getArmature(i))){e=o;break}if(null!==a){if(t.dataName=e,t.textureAtlasName=n,t.data=s,t.armature=a,t.skin=null,r.length>0&&(t.skin=a.getSkin(r),null===t.skin&&this.autoSearch))for(var o in this._dragonBonesDataMap){var h=this._dragonBonesDataMap[o].getArmature(r);if(null!==h){t.skin=h.defaultSkin;break}}return null===t.skin&&(t.skin=a.defaultSkin),!0}return!1},e.prototype._buildBones=function(e,i){for(var r=0,n=e.armature.sortedBones;r<n.length;r++){var s=n[r];t.BaseObject.borrowObject(0===s.type?t.Bone:t.Surface).init(s,i)}},e.prototype._buildSlots=function(t,e){var i=t.skin,r=t.armature.defaultSkin;if(null!==i&&null!==r){var n={};for(var s in r.displays){var a=r.getDisplays(s);n[s]=a}if(i!==r)for(var s in i.displays){a=i.getDisplays(s);n[s]=a}for(var o=0,h=t.armature.sortedSlots;o<h.length;o++){var l=h[o],c=l.name in n?n[l.name]:null,u=this._buildSlot(t,l,e);if(null!==c){u.displayFrameCount=c.length;for(var p=0,d=u.displayFrameCount;p<d;++p){var f=c[p];if(u.replaceRawDisplayData(f,p),null!==f){if(t.textureAtlasName.length>0){var m=this._getTextureData(t.textureAtlasName,f.path);u.replaceTextureData(m,p)}var g=this._getSlotDisplay(t,f,u);u.replaceDisplay(g,p)}else u.replaceDisplay(null)}}u._setDisplayIndex(l.displayIndex,!0)}}},e.prototype._buildConstraints=function(e,i){var r=e.armature.constraints;for(var n in r){var s=r[n];switch(s.type){case 0:var a=t.BaseObject.borrowObject(t.IKConstraint);a.init(s,i),i._addConstraint(a);break;case 1:var o=t.BaseObject.borrowObject(t.PathConstraint);o.init(s,i),i._addConstraint(o);break;default:var h=t.BaseObject.borrowObject(t.IKConstraint);h.init(s,i),i._addConstraint(h)}}},e.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},e.prototype._getSlotDisplay=function(e,i,r){var n=null!==e?e.dataName:i.parent.parent.parent.name,s=null;switch(i.type){case 0:var a=i;null===a.texture&&(a.texture=this._getTextureData(n,i.path)),s=r.rawDisplay;break;case 2:var o=i;null===o.texture&&(o.texture=this._getTextureData(n,o.path)),s=this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 1:var h=i,l=this._buildChildArmature(e,r,h);if(null!==l){if(l.inheritAnimation=h.inheritAnimation,!l.inheritAnimation){var c=h.actions.length>0?h.actions:l.armatureData.defaultActions;if(c.length>0)for(var u=0,p=c;u<p.length;u++){var d=p[u],f=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(d,f,r.armature),f.slot=r,r.armature._bufferAction(f,!1)}else l.animation.play()}h.armature=l.armatureData}s=l}return s},e.prototype.parseDragonBonesData=function(t,i,r){void 0===i&&(i=null),void 0===r&&(r=1);for(var n=t instanceof ArrayBuffer?e._binaryParser:this._dataParser,s=n.parseDragonBonesData(t,r);;){var a=this._buildTextureAtlasData(null,null);if(!n.parseTextureAtlasData(null,a,r)){a.returnToPool();break}this.addTextureAtlasData(a,i)}return null!==s&&this.addDragonBonesData(s,i),s},e.prototype.parseTextureAtlasData=function(t,e,i,r){void 0===i&&(i=null),void 0===r&&(r=1);var n=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,n,r),this._buildTextureAtlasData(n,e||null),this.addTextureAtlasData(n,i),n},e.prototype.updateTextureAtlases=function(t,e){var i=this.getTextureAtlasData(e);if(null!==i)for(var r=0,n=i.length;r<n;++r)r<t.length&&this._buildTextureAtlasData(i[r],t[r])},e.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},e.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},e.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},e.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},e.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var i=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];i.indexOf(t)<0&&i.push(t)},e.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var r=0,n=i;r<n.length;r++){var s=n[r];this._dragonBones.bufferObject(s)}delete this._textureAtlasDataMap[t]}},e.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var r=new i;return this._fillBuildArmaturePackage(r,e,t,"","")?r.armature:null},e.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=0,r=this._textureAtlasDataMap[e];i<r.length;i++){var n=r[i];this._dragonBones.bufferObject(n)}delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,r,n){void 0===e&&(e=""),void 0===r&&(r=""),void 0===n&&(n="");var s=new i;if(!this._fillBuildArmaturePackage(s,e||"",t,r||"",n||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var a=this._buildArmature(s);return this._buildBones(s,a),this._buildSlots(s,a),this._buildConstraints(s,a),a.invalidUpdate(null,!0),a.advanceTime(0),a},e.prototype.replaceDisplay=function(t,e,i){if(void 0===i&&(i=-1),i<0&&(i=t.displayIndex),i<0&&(i=0),t.replaceDisplayData(e,i),null!==e){var r=this._getSlotDisplay(null,e,t);if(0===e.type){var n=t.getDisplayFrameAt(i).rawDisplayData;null!==n&&2===n.type&&(r=t.meshDisplay)}t.replaceDisplay(r,i)}else t.replaceDisplay(null,i)},e.prototype.replaceSlotDisplay=function(t,e,i,r,n,s){void 0===s&&(s=-1);var a=this.getArmatureData(e,t||"");if(null===a||null===a.defaultSkin)return!1;var o=a.defaultSkin.getDisplay(i,r);return this.replaceDisplay(n,o,s),!0},e.prototype.replaceSlotDisplayList=function(t,e,i,r){var n=this.getArmatureData(e,t||"");if(!n||!n.defaultSkin)return!1;var s=n.defaultSkin.getDisplays(i);if(!s)return!1;r.displayFrameCount=s.length;for(var a=0,o=r.displayFrameCount;a<o;++a){var h=s[a];this.replaceDisplay(r,h,a)}return!0},e.prototype.replaceSkin=function(t,e,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);for(var n=!1,s=e.parent.defaultSkin,a=0,o=t.getSlots();a<o.length;a++){var h=o[a];if(!(null!==r&&r.indexOf(h.name)>=0)){var l=e.getDisplays(h.name);if(null!==l||(null!==s&&e!==s&&(l=s.getDisplays(h.name)),null!==l)){h.displayFrameCount=l.length;for(var c=0,u=h.displayFrameCount;c<u;++c){var p=l[c];h.replaceRawDisplayData(p,c),null!==p?h.replaceDisplay(this._getSlotDisplay(null,p,h),c):h.replaceDisplay(null,c)}n=!0}else i&&(h.displayFrameCount=0)}}return n},e.prototype.replaceAnimation=function(e,i,r){void 0===r&&(r=!0);var n=i.defaultSkin;if(null===n)return!1;if(r)e.animation.animations=i.animations;else{var s=e.animation.animations,a={};for(var o in s)a[o]=s[o];for(var o in i.animations)a[o]=i.animations[o];e.animation.animations=a}for(var h=0,l=e.getSlots();h<l.length;h++)for(var c=l[h],u=0,p=0,d=c.displayList;p<d.length;p++){var f=d[p];if(f instanceof t.Armature){var m=n.getDisplays(c.name);if(null!==m&&u<m.length){var g=m[u];if(null!==g&&1===g.type){var _=this.getArmatureData(g.path,g.parent.parent.parent.name);_&&this.replaceAnimation(f,_,r)}}}u++}return!0},e.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},e.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(e.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),e._objectParser=null,e._binaryParser=null,e}();t.BaseFactory=e;var i=function(){return function(){this.dataName="",this.textureAtlasName="",this.skin=null}}();t.BuildArmaturePackage=i}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.hasDBEventListener=function(t){return this.listenerCount(t)>0},e.prototype.dispatchDBEvent=function(t,e){this.emit(t,e)},e.prototype.addDBEventListener=function(t,e,i){this.on(t,e,i)},e.prototype.removeDBEventListener=function(t,e,i){this.off(t,e,i)},e}(Phaser.Events.EventEmitter);t.EventDispatcher=e}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){t.Skew={getSkewX:function(){return this._skewX||0},setSkewX:function(t){this._skewX=t},getSkewY:function(){return this._skewY||0},setSkewY:function(t){this._skewY=t},setSkew:function(t,e){e=void 0===e?t:e,this._skewX=t,this._skewY=e}},t.extendSkew=function(e){Object.defineProperty(e.prototype,"skewX",{get:t.Skew.getSkewX,set:t.Skew.setSkewX,enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewY",{get:t.Skew.getSkewY,set:t.Skew.setSkewY,enumerable:!0,configurable:!0}),e.prototype.setSkew=t.Skew.setSkew}}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function e(e,i,r,n,s,a){var o=t.call(this,e,i,r,n,s,a)||this;return o.decomposedMatrix.skewX=0,o.decomposedMatrix.skewY=0,o}return n(e,t),e.prototype.decomposeMatrix=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=-Math.atan2(-i,r),s=Math.atan2(e,t),a=Math.abs(n+s);return a<1e-5||Math.abs(Phaser.Math.PI2-a)<1e-5?(this.decomposedMatrix.rotation=s,t<0&&r>=0&&(this.decomposedMatrix.rotation+=this.decomposedMatrix.rotation<=0?Math.PI:-Math.PI),this.decomposedMatrix.skewX=this.decomposedMatrix.skewY=0):(this.decomposedMatrix.rotation=0,this.decomposedMatrix.skewX=n,this.decomposedMatrix.skewY=s),this.decomposedMatrix.scaleX=Math.sqrt(t*t+e*e),this.decomposedMatrix.scaleY=Math.sqrt(i*i+r*r),this.decomposedMatrix.translateX=this.tx,this.decomposedMatrix.translateY=this.ty,this.decomposedMatrix},e.prototype.applyITRSC=function(t,e,i,r,n,s,a){return this.a=Math.cos(i-a)*r,this.b=Math.sin(i-a)*r,this.c=-Math.sin(i+s)*n,this.d=Math.cos(i+s)*n,this.tx=t,this.ty=e,this},Object.defineProperty(e.prototype,"skewX",{get:function(){return-Math.atan2(-this.c,this.d)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewY",{get:function(){return Math.atan2(this.b,this.a)},enumerable:!0,configurable:!0}),e}(Phaser.GameObjects.Components.TransformMatrix);t.TransformMatrix=e}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(e){function i(i,r,n,s){var a=e.call(this,i,r,n,s)||this;return a._skewX=0,a._skewY=0,a.tempTransformMatrix=new t.util.TransformMatrix,a}return n(i,e),i.prototype.pointToContainer=function(t,e){if(void 0===e&&(e=new Phaser.Math.Vector2),this.parentContainer)return this.parentContainer.pointToContainer(t,e);var i=this.tempTransformMatrix;return i.applyITRSC(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this._skewX,this._skewY),i.invert(),i.transformPoint(t.x,t.y,e),e},Object.defineProperty(i.prototype,"skewX",{get:function(){return this._skewX},set:function(t){this._skewX=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skewY",{get:function(){return this._skewY},set:function(t){this._skewY=t},enumerable:!0,configurable:!0}),i.prototype.setSkew=function(t,e){return e=void 0===e?t:e,this.skewX=t,this.skewY=e,this},i}(Phaser.GameObjects.Container);e.DisplayContainer=i}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function e(e){var i=t.call(this,e)||this;return i.debugDraw=!1,i}return n(e,t),e.prototype.dbInit=function(t){this._armature=t},e.prototype.dbClear=function(){this.removeAllListeners(),this._armature&&this._armature.dispose(),this._armature=null},e.prototype.dbUpdate=function(){this.debugDraw},e.prototype.dispose=function(e){this.dbClear(),!0===e&&t.prototype.destroy.call(this)},e.prototype.destroy=function(){this.dispose(!0)},e.prototype.dispatchDBEvent=function(t,e){this.emit(t,e)},e.prototype.hasDBEventListener=function(t){return this.listenerCount(t)>0},e.prototype.addDBEventListener=function(t,e,i){this.on(t,e,i)},e.prototype.removeDBEventListener=function(t,e,i){this.off(t,e,i)},Object.defineProperty(e.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),e}(t.DisplayContainer);t.ArmatureDisplay=e}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(t){function e(e,i,r,n,s){var a=t.call(this,e,i,r,n,s)||this;return a.setPipeline("PhaserTextureTintPipeline"),a}return n(e,t),e}(Phaser.GameObjects.Image);e.SlotImage=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(t){function e(e,i,r,n,s){var a=t.call(this,e,i,r,n,s)||this;return a.setPipeline("PhaserTextureTintPipeline"),a}return n(e,t),e}(Phaser.GameObjects.Sprite);e.SlotSprite=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(e){!function(e){var i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return n(r,i),r.toString=function(){return"[class dragonBones.PhaserSlot]"},r.prototype._onClear=function(){i.prototype._onClear.call(this),this._textureScale=1,this._renderDisplay&&(this._renderDisplay.destroy(),this._renderDisplay=null)},r.prototype._initDisplay=function(t,e){},r.prototype._disposeDisplay=function(t,e){},r.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display||this._rawDisplay},r.prototype._addDisplay=function(){this.armature.display.add(this._renderDisplay)},r.prototype._replaceDisplay=function(t){this._renderDisplay.setSkew?(this.armature.display.replace(t,this._renderDisplay),this._renderDisplay.parentContainer=this.armature.display):console.warn("please call dragonBones.phaser.util.extendSkew to mix skew component into your display object,\n                                and set its pipeline to 'PhaserTextureTintPipeline' by calling 'setPiepline' method, more detail please refer to the 'ReplaceSlotDisplay.ts' example")},r.prototype._removeDisplay=function(){this._renderDisplay.parentContainer.remove(this._renderDisplay)},r.prototype._updateZOrder=function(){this._renderDisplay.depth!==this._zOrder&&this._renderDisplay.setDepth(this._zOrder)},r.prototype._updateVisible=function(){this._renderDisplay.setVisible(this._parent.visible&&this._visible)},r.prototype._updateBlendMode=function(){var t=Phaser.BlendModes.NORMAL;switch(this._blendMode){case 0:t=Phaser.BlendModes.NORMAL;break;case 1:t=Phaser.BlendModes.ADD;break;case 3:t=Phaser.BlendModes.DARKEN;break;case 4:t=Phaser.BlendModes.DIFFERENCE;break;case 6:t=Phaser.BlendModes.HARD_LIGHT;break;case 9:t=Phaser.BlendModes.LIGHTEN;break;case 10:t=Phaser.BlendModes.MULTIPLY;break;case 11:t=Phaser.BlendModes.OVERLAY;break;case 12:t=Phaser.BlendModes.SCREEN}this._renderDisplay.setBlendMode(t)},r.prototype._updateColor=function(){var t=this._colorTransform,i=this._globalAlpha*t.alphaMultiplier+t.alphaOffset;if(this._renderDisplay.setAlpha(i),!(this._renderDisplay instanceof e.DisplayContainer)){var r=255*t.redMultiplier+t.redOffset<<16|255*t.greenMultiplier+t.greenOffset<<8|255*t.blueMultiplier+t.blueOffset;this._renderDisplay.setTint(r)}},r.prototype._updateFrame=function(){if(!(this._renderDisplay instanceof e.DisplayContainer)){var i=this._textureData;if(this._displayIndex>=0&&null!==this._display&&null!==i){var r=i.parent;null!==this.armature.replacedTexture&&(null===this.armature._replaceTextureAtlasData?((r=t.BaseObject.borrowObject(e.TextureAtlasData)).copyFrom(i.parent),r.renderTexture=this.armature.replacedTexture,this.armature._replaceTextureAtlasData=r):r=this.armature._replaceTextureAtlasData,i=r.getTexture(i.name));var n=i.renderTexture;if(null!==n)return null!==this._geometryData||(this._renderDisplay.texture=n.texture,this._renderDisplay.frame=n,this._renderDisplay.setDisplayOrigin(this._pivotX,this._pivotY),this._textureScale=i.parent.scale*this.armature.armatureData.scale,this._renderDisplay.setScale(this._textureScale)),void(this._visibleDirty=!0)}else this._renderDisplay.x=0,this._renderDisplay.y=0,this._renderDisplay.setTexture(void 0)}},r.prototype._updateMesh=function(){},r.prototype._updateTransform=function(){this.updateGlobalTransform();var t=this.global;this._renderDisplay.x=t.x,this._renderDisplay.y=t.y,this._renderDisplay.rotation=t.rotation,this._renderDisplay.setSkew(t.skew,0),this._renderDisplay.setScale(t.scaleX*this._textureScale,t.scaleY*this._textureScale)},r.prototype._identityTransform=function(){this._renderDisplay.setPosition(),this._renderDisplay.setRotation(),this._textureScale=1,this._renderDisplay.setScale(this._textureScale),this._renderDisplay.setSkew(0)},r}(t.Slot);e.Slot=i}(e.display||(e.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(e){!function(e){var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderTexture=null,t}return n(i,e),i.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this._renderTexture&&this._renderTexture.destroy(),this._renderTexture=null},i.prototype.createTexture=function(){return t.BaseObject.borrowObject(r)},Object.defineProperty(i.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(t){if(t&&this._renderTexture!==t)for(var e in this._renderTexture&&this._renderTexture.destroy(),this._renderTexture=t,this.textures){var i=this.textures[e],r=this._renderTexture.add(e,0,i.region.x,i.region.y,i.region.width,i.region.height);i.rotated&&(r.rotated=!0,r.updateUVsInverted()),i.renderTexture=r}},enumerable:!0,configurable:!0}),i}(t.TextureAtlasData);e.TextureAtlasData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.renderTexture=null,e}return n(e,t),e.toString=function(){return"[class dragonBones.PhaserTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.renderTexture&&this.renderTexture.destroy(),this.renderTexture=null},e}(t.TextureData);e.TextureData=r}(e.display||(e.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(e){function i(i){var r=e.call(this,i)||this;return r._tempMatrix1=new t.util.TransformMatrix,r._tempMatrix2=new t.util.TransformMatrix,r._tempMatrix3=new t.util.TransformMatrix,r}return n(i,e),i.prototype.batchSprite=function(t,e,i){this.renderer.setPipeline(this);var r=this._tempMatrix1,n=this._tempMatrix2,s=this._tempMatrix3,a=t.frame,o=a.glTexture,h=a.u0,l=a.v0,c=a.u1,u=a.v1,p=a.x,d=a.y,f=a.width,m=a.height,g=-t.displayOriginX+p,_=-t.displayOriginY+d;if(t.isCropped){var y=t._crop;y.flipX===t.flipX&&y.flipY===t.flipY||a.updateCropUVs(y,t.flipX,t.flipY),h=y.u0,l=y.v0,c=y.u1,u=y.v1,f=y.width,m=y.height,p=y.x,d=y.y,g=-t.displayOriginX+p,_=-t.displayOriginY+d}t.flipX&&(g+=f,f*=-1),t.flipY&&(_+=m,m*=-1);var v=g+f,b=_+m;n.applyITRSC(t.x,t.y,t.rotation,t.scaleX,t.scaleY,t.skewX||0,t.skewY||0),r.copyFrom(e.matrix),i?(r.multiplyWithOffset(i,-e.scrollX*t.scrollFactorX,-e.scrollY*t.scrollFactorY),n.e=t.x,n.f=t.y,r.multiply(n,s)):(n.e-=e.scrollX*t.scrollFactorX,n.f-=e.scrollY*t.scrollFactorY,r.multiply(n,s));var P=s.getX(g,_),T=s.getY(g,_),x=s.getX(g,b),S=s.getY(g,b),O=s.getX(v,b),C=s.getY(v,b),D=s.getX(v,_),w=s.getY(v,_),A=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintTL,e.alpha*t._alphaTL),E=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintTR,e.alpha*t._alphaTR),M=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintBL,e.alpha*t._alphaBL),I=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintBR,e.alpha*t._alphaBR);e.roundPixels&&(P|=0,T|=0,x|=0,S|=0,O|=0,C|=0,D|=0,w|=0),this.setTexture2D(o,0);var B=t._isTinted&&t.tintFill;this.batchQuad(P,T,x,S,O,C,D,w,h,l,c,u,A,E,M,I,B)},i}(Phaser.Renderer.WebGL.Pipelines.TextureTintPipeline);e.TextureTintPipeline=i}(t.pipeline||(t.pipeline={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){t.FileTypes={IMAGE:"imageFile",JSON:"jsonFile",BINARY:"binaryFile",map:{imageFile:Phaser.Loader.FileTypes.ImageFile,jsonFile:Phaser.Loader.FileTypes.JSONFile,binaryFile:Phaser.Loader.FileTypes.BinaryFile},setType:function(e,i){t.FileTypes.map[e]=i},getType:function(e){return t.FileTypes.map[e]}}}(t.plugin||(t.plugin={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(e){function i(i,r,n,s,a,o,h,l){var c,u,p,d,f=t.FileTypes.getType(t.FileTypes.BINARY),m=t.FileTypes.getType(t.FileTypes.JSON),g=t.FileTypes.getType(t.FileTypes.IMAGE),_=function(t,e,i,r){var n="json";if(r&&r.responseType)switch(r.responseType){case"arraybuffer":case"blob":n="bin";break;case"json":case"text":n="json"}return"bin"===n?new f(t,e,i,r):new m(t,e,i,r)};if(Phaser.Utils.Objects.IsPlainObject(r)){var y=r;c=new g(i,{key:d=Phaser.Utils.Objects.GetFastValue(y,"key"),url:Phaser.Utils.Objects.GetFastValue(y,"textureURL"),extension:Phaser.Utils.Objects.GetFastValue(y,"textureExtension","png"),xhrSettings:Phaser.Utils.Objects.GetFastValue(y,"textureXhrSettings")}),u=new m(i,{key:d+"_atlasjson",url:Phaser.Utils.Objects.GetFastValue(y,"atlasURL"),extension:Phaser.Utils.Objects.GetFastValue(y,"atlasExtension","json"),xhrSettings:Phaser.Utils.Objects.GetFastValue(y,"atlasXhrSettings")}),p=_(i,d,Phaser.Utils.Objects.GetFastValue(y,"boneURL"),Phaser.Utils.Objects.GetFastValue(y,"boneXhrSettings"))}else c=new g(i,d=r,n,o),u=new m(i,d+"_atlasjson",s,h),p=_(i,d,a,l);return p.cache=i.cacheManager.custom.dragonbone,e.call(this,i,"dragonbone",d,[c,u,p])||this}return n(i,e),i.prototype.addToCache=function(){if(this.isReadyToProcess()){var t=this.files[0],e=this.files[1],i=this.files[2];e.addToCache(),i.addToCache(),this.loader.textureManager.addImage(t.key,t.data),this.complete=!0}},i}(Phaser.Loader.MultiFile);t.DragonBonesFile=e}(t.plugin||(t.plugin={}))}(t.phaser||(t.phaser={}))}(l||(l={})),h=l||(l={}),function(t){var e=function(t){function e(e,n){var a=t.call(this,e,n)||this,h=a.game;if(h.cache.addCustom("dragonbone"),a.game.config.renderType===Phaser.WEBGL){var l=a.game.renderer;l.hasPipeline("PhaserTextureTintPipeline")||l.addPipeline("PhaserTextureTintPipeline",new o.pipeline.TextureTintPipeline({game:h,renderer:l}))}return n.registerGameObject("dragonBones",i),n.registerGameObject("armature",r),n.registerFileType("dragonbone",s,e),a}return n(e,t),e.prototype.createArmature=function(t,e,i,r,n){void 0===n&&(n=1);var s=this.factory.buildArmatureDisplay(t,e,i,r,n);return this.systems.displayList.add(s),this._dbInst.clock.add(s.armature),s},e.prototype.createDragonBones=function(t,e){return void 0===e&&(e=1),this.factory.buildDragonBonesData(t,e)},Object.defineProperty(e.prototype,"factory",{get:function(){return this._factory||(this._dbInst=new l.DragonBones(new o.util.EventDispatcher),this._factory=new o.Factory(this._dbInst,this.scene)),this._factory},enumerable:!0,configurable:!0}),e.prototype.createSlotDisplayPlaceholder=function(){return new o.display.SlotImage(this.scene,0,0)},e.prototype.boot=function(){this.systems.events.once("destroy",this.destroy,this),this.start()},e.prototype.start=function(){var t=this.systems.events;t.on("update",this.update,this),t.once("shutdown",this.shutdown,this)},e.prototype.update=function(t,e){this._dbInst&&this._dbInst.advanceTime(.001*e)},e.prototype.shutdown=function(){var t=this.systems.events;t.off("update",this.update,this),t.off("shutdown",this.shutdown,this)},e.prototype.destroy=function(){this.shutdown(),this._factory=this._dbInst=null,this.pluginManager=this.game=this.scene=this.systems=null},e}(Phaser.Plugins.ScenePlugin);t.DragonBonesScenePlugin=e;var i=function(t,e){return void 0===e&&(e=1),this.scene.dragonbone.createDragonBones(t,e)},r=function(t,e,i,r){return this.scene.dragonbone.createArmature(t,e,i,r)},s=function(e,i,r,n,s,a,o){var h=new t.DragonBonesFile(this,e,i,r,n,s,a,o);return this.addFile(h.files),this}}((o=h.phaser||(h.phaser={})).plugin||(o.plugin={})),function(t){var e=function(e){function i(t,i,r){var n=e.call(this,r)||this;return n._scene=i,n._dragonBones=t,n}return n(i,e),i.prototype._isSupportMesh=function(){return console.warn("Mesh is not supported yet"),!1},i.prototype._buildTextureAtlasData=function(e,i){return e?e.renderTexture=i:e=c.BaseObject.borrowObject(t.display.TextureAtlasData),e},i.prototype._buildArmature=function(e){var i=c.BaseObject.borrowObject(c.Armature),r=new t.display.ArmatureDisplay(this._scene);return i.init(e.armature,r,r,this._dragonBones),i},i.prototype._buildSlot=function(e,i,r){var n=c.BaseObject.borrowObject(t.display.Slot),s=this._scene.dragonbone.createSlotDisplayPlaceholder(),a=s;return n.init(i,r,s,a),n},i.prototype.buildArmatureDisplay=function(t,e,i,r,n){var s;return void 0===i&&(i=""),void 0===r&&(r=""),void 0===n&&(n=1),this.buildDragonBonesData(e,n)&&(s=this.buildArmature(t,e,i,r)),s.display},i.prototype.buildDragonBonesData=function(t,e){void 0===e&&(e=1);var i=this._dragonBonesDataMap[t];if(!i){var r=this._scene.cache,n=r.custom.dragonbone.get(t);if(n){i=this.parseDragonBonesData(n,t,e);var s=this._scene.textures.get(t),a=r.json.get(t+"_atlasjson");this.parseTextureAtlasData(a,s,s.key,e)}}return i},i}(c.BaseFactory);t.Factory=e}((c=l||(l={})).phaser||(c.phaser={}))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){t.exports=function(){return new Worker(i.p+"js/647fb0c5464d2b5f3314.networker.js")}},,,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(40);e.Capsule=r.default;var n=i(19);e.ConfigObjects=n;var s=i(20);e.Constants=s.default;var a=i(142);e.Lite=a.default},,function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(19),n=i(51),s=i(52),a=i(53),o=i(29),h=i(27),l=i(54),c=function(){function t(t){this._cap=t}return t.prototype.element=function(t){var e=t||this._cap.root,i=new r.ElementNode(this._cap,e);return this._cap.addObject(i),i},t.prototype.spawnpoint=function(t){var e=t||this._cap.root,i=new r.SpawnPointNode(this._cap,e);return this._cap.addObject(i),i},t.prototype.terrain=function(t){var e=t||this._cap.root,i=new a.TerrainNode(this._cap,e);return this._cap.addObject(i),i},t.prototype.attr=function(t){var e=new r.AttributeNode(this._cap,t);return this._cap.addObject(e),e},t.prototype.func=function(t){var e=new r.FunctionNode(this._cap,t);return this._cap.addObject(e),e},t.prototype.event=function(t){var e=new r.EventNode(this._cap,t);return this._cap.addObject(e),e},t.prototype.ui=function(t){var e=new r.UINode(this._cap,t);return this._cap.addObject(e),e},t.prototype.timer=function(){var t=new r.TimerNode(this._cap,this._cap.root);return this._cap.addObject(t),t},t.prototype.scene=function(t,e,i){var s=new n.default(this._cap,this._cap.root);i&&(s.name=i),this._cap.addObject(s);var a=new r.MapSizeNode(this._cap,s);return a.rows=t,a.cols=e,this._cap.addObject(a),s},t.prototype.character=function(){var t=new s.default(this._cap,this._cap.root);this._cap.addObject(t);var e=this.camp(1,t);this._cap.addObject(e);var i=new r.AvatarNode(this._cap,t);return this._cap.addObject(i),t},t.prototype.camp=function(t,e){var i=new r.CampNode(this._cap,e);return i.maxPlayers=t,this._cap.addObject(i),i},t.prototype.package=function(t){var e=new o.default(this._cap,t);return this._cap.addObject(e),e},t.prototype.packageItem=function(t){var e=new o.PackageItemNode(this._cap,t);return this._cap.addObject(e),e},t.prototype.animationdata=function(t,e){if(t){if(e&&t.checkSameName(e))throw Error("");var i=new r.AnimationDataNode(this._cap,t);return e&&(i.name=e),this._cap.addObject(i),i}},t.prototype.animations=function(t){var e=new r.AnimationsNode(this._cap,t);return this._cap.addObject(e),e},t.prototype.location=function(t){var e=new h.default(this._cap,t);return this._cap.addObject(e),e},t.prototype.display=function(t){var e=new r.DisplayNode(this._cap,t);return this._cap.addObject(e),e},t.prototype.shop=function(t){var e=new l.default(this._cap,t);return this._cap.addObject(e),e},t.prototype.shopItem=function(t){var e=new l.ShopItemNode(this._cap,t);return this._cap.addObject(e),e},t.prototype.commodity=function(t){var e=new l.CommodityNode(this._cap,t);return this._cap.addObject(e),e},t}();e.default=c},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=function(t){function e(e){var i=t.call(this,e)||this;return i.parent=0,i._settings=new h(e,i),i}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this._settings},enumerable:!0,configurable:!0}),e.prototype.serialize=function(t){t.node=this.makeNode(),t.node.name="Game",this._settings.serialize(t)},e.prototype.deserialize=function(t){this.setNode(t.node),this._settings.deserialize(t)},e}(s.BaseConfigObject);e.default=o;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._spawn_point=0,e._max_number=10,e}return n(e,t),Object.defineProperty(e.prototype,"spawnpoint",{get:function(){return this._spawn_point},set:function(t){this._spawn_point=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumber",{get:function(){return this._max_number},set:function(t){t&&(this._max_number=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"properties",{get:function(){return{spawnpoint:this._spawn_point,maxNumber:this._max_number}},enumerable:!0,configurable:!0}),e.prototype.serialize=function(t){t.settings=a.op_gameconfig_01.Settings.create(),t.settings.node=this.makeNode(),this.maxNumber?t.settings.maxNumber=this.maxNumber:t.settings.maxNumber=null,t.settings.spawnpointid=this.spawnpoint},e.prototype.deserialize=function(t){var e=t.settings;e&&(this.setNode(e.node),this._spawn_point=e.spawnpointid,e.maxNumber?this._max_number=e.maxNumber:this._max_number=null)},e}(s.BaseConfigObject);e.SettingsNode=h},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._dir=0,e._angle=0,e._speed=0,e}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{dir:this._dir,angle:this._angle,speed:this._speed}},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.movable)||(t.movable=[]),t.movable},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Movable.create();return t.node=this.makeNode(),this._dir&&(t.dir=this._dir),this._angle&&(t.angle=this._angle),this._speed&&(t.speed=this._speed),t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;i.dir&&(this._dir=i.dir),i.angle&&(this._angle=i.angle),i.speed&&(this._speed=i.speed)},e}(s.BaseConfigObject);e.default=o},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=i(24),h=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._key="",r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},set:function(t){this._key=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"basicTypeVal",{get:function(){return o.isUndefined(this._boolVal)?this._boolVal:o.isUndefined(this._intVal)?this._intVal:o.isUndefined(this._strVal)?this._strVal:void 0},set:function(t){o.isBoolean(t)&&(this._boolVal=t),o.isNumber(t)&&(this._intVal=t),o.isString(t)&&(this._strVal=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"intVal",{get:function(){return this._intVal},set:function(t){this._intVal=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strVal",{get:function(){return this._strVal},set:function(t){this._strVal=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boolVal",{get:function(){return this._boolVal},set:function(t){this._boolVal=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"media",{get:function(){return this._media},set:function(t){this._media=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"properties",{get:function(){return{key:this._key,intVal:this._intVal,strVal:this._strVal,boolVal:this._boolVal,media:this._media}},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.attr)||(t.attr=[]),t.attr},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Attribute.create();return t.node=this.makeNode(),t.key=this._key,t.intVal=this._intVal,t.strVal=this._strVal,t.boolVal=this._boolVal,t.media=this._media,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._key=i.key,"number"==typeof i.intVal?this._intVal=i.intVal:this._intVal=void 0,"string"==typeof i.strVal?this._strVal=i.strVal:this._strVal=void 0,"boolean"==typeof i.boolVal?this._boolVal=i.boolVal:this._boolVal=void 0,this._media=i.media||void 0},e.prototype.geneSequence=function(){return""+this._key},e.prototype.duplicate=function(i){if(t.prototype.duplicate.call(this,i),i instanceof e){this._key=i.key;var r=i.basicTypeVal;o.isNumber(r)&&(this._intVal=r),o.isString(r)&&(this._strVal=r),o.isBoolean(r)&&(this._boolVal=r);var n=i.media;n&&(this._media=n)}},e}(s.BaseConfigObject);e.default=h},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._fileName="",r._funcName="",r._version="",r.name="",r.newFileName(),r}return n(e,t),e.prototype.newFileName=function(){this.fileName=this.id+"-t="+(new Date).getTime()+".lua"},Object.defineProperty(e.prototype,"properties",{get:function(){return{fileName:this._fileName,funcName:this._funcName,version:this._version}},enumerable:!0,configurable:!0}),e.prototype.idToFilenmae=function(){return this.id+"?t="+(new Date).getTime()+".lua"},e.prototype.filenameToId=function(){var t=this.fileName.indexOf("-t=");return t>-1?parseInt(this.fileName.substring(0,t),10):0},Object.defineProperty(e.prototype,"fileName",{get:function(){return this._fileName},set:function(t){this._fileName=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"funcName",{get:function(){return this._funcName},set:function(t){this._funcName=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._version},set:function(t){this._version=t},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.func)||(t.func=[]),t.func},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Function.create();return t.node=this.makeNode(),t.fileName=this._fileName,t.funcName=this._funcName,t.version=this._version,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._fileName=i.fileName,this._funcName=i.funcName,this._version=i.version},e.prototype.duplicate=function(t){},e}(s.BaseConfigObject);e.default=o},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=a.op_def.GameEvent,h=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._eventName=o.onElementActive,r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{eventName:this._eventName}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventName",{get:function(){return this._eventName},set:function(t){this._eventName="string"==typeof t?parseInt(t):t},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.event)||(t.event=[]),t.event},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Event.create();return t.node=this.makeNode(),t.eventName=this._eventName,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._eventName=i.eventName},e}(s.BaseConfigObject);e.default=h},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{text:this._text}},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.ui)||(t.ui=[]),t.ui},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.UI.create();return t.node=this.makeNode(),t.text=this._text,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._text=i.text},e}(s.BaseConfigObject);e.default=o;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._text="",e}return n(e,t),e.prototype.findMyContainer=function(t){return Array.isArray(t.text)||(t.text=[]),t.text},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Text.create();return t.node=this.makeNode(),t.text=this._text,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._text=i.text},e}(s.BaseConfigObject);e.TextNode=h;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._text="",e}return n(e,t),e.prototype.findMyContainer=function(t){return Array.isArray(t.button)||(t.button=[]),t.button},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Button.create();return t.node=this.makeNode(),t.text=this._text,this._tips&&(t.tips=this._tips),t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._text=i.text,i.tips&&(this._tips=i.tips)},e}(s.BaseConfigObject);e.ButtonNode=l},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._timeout=0,r._interval=0,r.name="",r}return n(e,t),Object.defineProperty(e.prototype,"properties",{get:function(){return{timeout:this._timeout,interval:this._interval}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeout",{get:function(){return this._timeout},set:function(t){this._timeout=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"interval",{get:function(){return this._interval},set:function(t){this._interval=t},enumerable:!0,configurable:!0}),e.prototype.findMyContainer=function(t){return Array.isArray(t.timer)||(t.timer=[]),t.timer},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.Timer.create();return t.node=this.makeNode(),t.timeout=this._timeout,t.interval=this._interval,t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this._timeout=i.timeout,this._interval=i.interval},e}(s.BaseConfigObject);e.default=o},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(4),o=i(15),h=a.op_def.NodeType,l=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r.name="",r}return n(e,t),e.prototype.findMyContainer=function(t){return Array.isArray(t.spawnpoint)||(t.spawnpoint=[]),t.spawnpoint},e.prototype.createProtocolObject=function(){var t=a.op_gameconfig_01.SpawnPoint.create();return t.node=this.makeNode(),this._loc&&(t.loc=this._loc),t},e.prototype.deserialize=function(e){t.prototype.deserialize.call(this,e);var i=e;this.location.node=i.loc.node,this.location.x=i.loc.x,this.location.y=i.loc.y,this.location.z=i.loc.z},e.prototype.convertToClientElement=function(){var t=a.op_client.Element.create();return t.id=this.id,t.type="ElementNodeType",t.display=this.display,t.animations=[this.animation],t.animationName=this.animation.name,this._loc&&(t.x=this._loc.x,t.y=this._loc.y),t},Object.defineProperty(e.prototype,"display",{get:function(){return this._display||(this._display=a.op_gameconfig.Display.create(),this._display.texturePath="pixelpai/SpawnPointNode/5cc42f6417553727db1d2bba/1/5cc42f6417553727db1d2bba.png",this._display.dataPath="pixelpai/SpawnPointNode/5cc42f6417553727db1d2bba/1/5cc42f6417553727db1d2bba.json"),this._display},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animation",{get:function(){return this._animation||(this._animation=a.op_gameconfig.Animation.create(),this._animation.id=1e4,this._animation.name="idle",this._animation.frameRate=5,this._animation.collisionArea="1,1&1,1",this._animation.loop=!0,this._animation.baseLoc="-30,-30",this._animation.originPoint=[0,0],this._animation.frameName=["switch_0027_3_01.png"]),this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"location",{get:function(){if(!this._loc){this._loc=a.op_gameconfig_01.Location.create();var t=this._loc.node=a.op_gameconfig_01.Node.create();t.id=o.default.genId(),t.name="",t.Parent=this.id,t.type=h.LocationType}return this._loc},enumerable:!0,configurable:!0}),e}(s.BaseConfigObject);e.default=l},function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(6),a=i(28),o=i(19),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.deserialize=function(t){if(t&&t.hasOwnProperty("node")){var e,i=t.node.Parent,r=this.cap.getObject(i);if(r){var n=r.className||"";if(o.hasOwnProperty(n)&&(e=new o[n](this.cap))&&(e.isFork=!0,e.parent=r.parent,t.node.Parent=r.parent,e.deserialize(t),e.link()),e&&r.parentObject){for(var s=0,h=r.children;s<h.length;s++){var l=h[s];l instanceof a.default&&this.cap.clone(l.id,e)}this.parent=r.parent}}else console.error(this.className+": My parent["+this.parent+"] does not exist.")}},e}(s.EntityNode);e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._objects=new Map,this._branch_cache=new Map}return t.prototype.getChildrenList=function(t){var e=this._branch_cache.get(t);return e?Array.from(e.values()):[]},t.prototype.addObject=function(t){if(!t)throw new Error("Empty Object.");this._objects.set(t.id,t),t.isFork||t.link(),this._branch_cache.has(t.parent)||this._branch_cache.set(t.parent,new Map);var e=this._branch_cache.get(t.parent);e&&e.set(t.id,t)},t.prototype.removeObject=function(t){if(!t)throw new Error("Empty Object.");t.unlink(),this._objects.delete(t.id);var e=this._branch_cache.get(t.parent);e&&e.delete(t.id)},t.prototype.removeObjectById=function(t){this._objects.delete(t)},t.prototype.getObject=function(t){return this._objects.get(t)},Object.defineProperty(t.prototype,"objectsList",{get:function(){return Array.from(this._objects.values())},enumerable:!0,configurable:!0}),t}();e.default=r},,function(t,e,i){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var s=i(40),a=i(4),o=a.op_gameconfig_01.Game,h=a.op_def.NodeType,l=(h.ElementNodeType,h.TerrainNodeType,h.PackageItemType,h.ForkType,h.CharacterNodeType,h.AvatarType,h.AnimationsType,h.AnimationDataType,h.DisplayType,function(t){function e(){return t.call(this)||this}return n(e,t),e.prototype.deserialize=function(t){var e=o.decode(t),i=[];this._root.deserialize(e);for(var r=0,n=[].concat(e.entity,e.animations,e.animationdatas,e.avatar,e.display);r<n.length;r++){var s=(c=n[r]).node.type;s&&(s==h.ForkType?i.push(c):this.doDeserialize(c))}for(var a=0,l=i;a<l.length;a++){var c=l[a];this.doDeserialize(c)}this._objects.forEach(function(t){t.link()})},e}(s.default));e.default=l},function(t,e){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2018 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
const i=Math.PI/180;t.exports=function(t){return t*i}},function(t,e,i){"use strict";
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://opensource.org/licenses/MIT|MIT License}
 */function r(t,e,i){i=i||2;var r,o,h,l,c,d,m,g=e&&e.length,_=g?e[0]*i:t.length,y=n(t,0,_,i,!0),v=[];if(!y||y.next===y.prev)return v;if(g&&(y=function(t,e,i,r){var a,o,h,l,c,d=[];for(a=0,o=e.length;a<o;a++)h=e[a]*r,l=a<o-1?e[a+1]*r:t.length,(c=n(t,h,l,r,!1))===c.next&&(c.steiner=!0),d.push(f(c));for(d.sort(u),a=0;a<d.length;a++)p(d[a],i),i=s(i,i.next);return i}(t,e,y,i)),t.length>80*i){r=h=t[0],o=l=t[1];for(var b=i;b<_;b+=i)(c=t[b])<r&&(r=c),(d=t[b+1])<o&&(o=d),c>h&&(h=c),d>l&&(l=d);m=0!==(m=Math.max(h-r,l-o))?1/m:0}return a(y,v,i,r,o,m),v}function n(t,e,i,r,n){var s,a;if(n===O(t,e,i,r)>0)for(s=e;s<i;s+=r)a=T(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=T(s,t[s],t[s+1],a);return a&&y(a,a.next)&&(x(a),a=a.next),a}function s(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!y(r,r.next)&&0!==_(r.prev,r,r.next))r=r.next;else{if(x(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function a(t,e,i,r,n,u,p){if(t){!p&&u&&function(t,e,i,r){var n=t;do{null===n.z&&(n.z=d(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,i,r,n,s,a,o,h,l=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,r=i,o=0,e=0;e<l&&(o++,r=r.nextZ);e++);for(h=l;o>0||h>0&&r;)0!==o&&(0===h||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,h--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,l*=2}while(a>1)}(n)}(t,r,n,u);for(var f,m,g=t;t.prev!==t.next;)if(f=t.prev,m=t.next,u?h(t,r,n,u):o(t))e.push(f.i/i),e.push(t.i/i),e.push(m.i/i),x(t),t=m.next,g=m.next;else if((t=m)===g){p?1===p?a(t=l(t,e,i),e,i,r,n,u,2):2===p&&c(t,e,i,r,n,u):a(s(t),e,i,r,n,u,1);break}}}function o(t){var e=t.prev,i=t,r=t.next;if(_(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(m(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&_(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function h(t,e,i,r){var n=t.prev,s=t,a=t.next;if(_(n,s,a)>=0)return!1;for(var o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,h=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,l=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,c=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y,u=d(o,h,e,i,r),p=d(l,c,e,i,r),f=t.prevZ,g=t.nextZ;f&&f.z>=u&&g&&g.z<=p;){if(f!==t.prev&&f!==t.next&&m(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&_(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,g!==t.prev&&g!==t.next&&m(n.x,n.y,s.x,s.y,a.x,a.y,g.x,g.y)&&_(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;f&&f.z>=u;){if(f!==t.prev&&f!==t.next&&m(n.x,n.y,s.x,s.y,a.x,a.y,f.x,f.y)&&_(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;g&&g.z<=p;){if(g!==t.prev&&g!==t.next&&m(n.x,n.y,s.x,s.y,a.x,a.y,g.x,g.y)&&_(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function l(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!y(n,s)&&v(n,r,r.next,s)&&b(n,s)&&b(s,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(s.i/i),x(r),x(r.next),r=t=s),r=r.next}while(r!==t);return r}function c(t,e,i,r,n,o){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&g(h,l)){var c=P(h,l);return h=s(h,h.next),c=s(c,c.next),a(h,e,i,r,n,o),void a(c,e,i,r,n,o)}l=l.next}h=h.next}while(h!==t)}function u(t,e){return t.x-e.x}function p(t,e){if(e=function(t,e){var i,r=e,n=t.x,s=t.y,a=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var o=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=n&&o>a){if(a=o,o===n){if(s===r.y)return r;if(s===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===a)return i.prev;var h,l=i,c=i.x,u=i.y,p=1/0;r=i.next;for(;r!==l;)n>=r.x&&r.x>=c&&n!==r.x&&m(s<u?n:a,s,c,u,s<u?a:n,s,r.x,r.y)&&((h=Math.abs(s-r.y)/(n-r.x))<p||h===p&&r.x>i.x)&&b(r,t)&&(i=r,p=h),r=r.next;return i}(t,e)){var i=P(e,t);s(i,i.next)}}function d(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function f(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function m(t,e,i,r,n,s,a,o){return(n-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(n-a)*(r-o)>=0}function g(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&v(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&b(t,e)&&b(e,t)&&function(t,e){var i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}(t,e)}function _(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function y(t,e){return t.x===e.x&&t.y===e.y}function v(t,e,i,r){return!!(y(t,e)&&y(i,r)||y(t,r)&&y(i,e))||_(t,e,i)>0!=_(t,e,r)>0&&_(i,r,t)>0!=_(i,r,e)>0}function b(t,e){return _(t.prev,t,t.next)<0?_(t,e,t.next)>=0&&_(t,t.prev,e)>=0:_(t,e,t.prev)<0||_(t,t.next,e)<0}function P(t,e){var i=new S(t.i,t.x,t.y),r=new S(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function T(t,e,i,r){var n=new S(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function x(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(t,e,i,r){for(var n=0,s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}t.exports=r,r.deviation=function(t,e,i,r){var n=e&&e.length,s=n?e[0]*i:t.length,a=Math.abs(O(t,0,s,i));if(n)for(var o=0,h=e.length;o<h;o++){var l=e[o]*i,c=o<h-1?e[o+1]*i:t.length;a-=Math.abs(O(t,l,c,i))}var u=0;for(o=0;o<r.length;o+=3){var p=r[o]*i,d=r[o+1]*i,f=r[o+2]*i;u+=Math.abs((t[p]-t[f])*(t[d+1]-t[p+1])-(t[p]-t[d])*(t[f+1]-t[p+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},r.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var a=0;a<e;a++)i.vertices.push(t[n][s][a]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i}},function(t,e,i){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var r=i(146),n=i(147);t.exports=function(t,e,i,s,a){var o=this.pipeline,h=o._tempMatrix1,l=o._tempMatrix2,c=o._tempMatrix3;t.setPipeline(o),l.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY),h.copyFrom(s.matrix),a?(h.multiplyWithOffset(a,-s.scrollX*e.scrollFactorX,-s.scrollY*e.scrollFactorY),l.e=e.x,l.f=e.y):(l.e-=s.scrollX*e.scrollFactorX,l.f-=s.scrollY*e.scrollFactorY),h.multiply(l,c);var u=e._displayOriginX,p=e._displayOriginY,d=s.alpha*e.alpha;e.isFilled&&r(o,c,e,d,u,p),e.isStroked&&n(o,e,d,u,p)}},function(t,e){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,r,n,s,a){for(var o=i.getTintAppendFloatAlphaAndSwap(r.fillColor,r.fillAlpha*n),h=r.pathData,l=r.pathIndexes,c=0;c<l.length;c+=3){var u=2*l[c],p=2*l[c+1],d=2*l[c+2],f=h[u+0]-s,m=h[u+1]-a,g=h[p+0]-s,_=h[p+1]-a,y=h[d+0]-s,v=h[d+1]-a,b=e.getX(f,m),P=e.getY(f,m),T=e.getX(g,_),x=e.getY(g,_),S=e.getX(y,v),O=e.getY(y,v);t.setTexture2D(),t.batchTri(b,P,T,x,S,O,0,0,1,1,o,o,o,t.tintEffect)}}},function(t,e){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,r,n,s){var a=t.strokeTint,o=i.getTintAppendFloatAlphaAndSwap(e.strokeColor,e.strokeAlpha*r);a.TL=o,a.TR=o,a.BL=o,a.BR=o;var h=e.pathData,l=h.length-1,c=e.lineWidth,u=c/2,p=h[0]-n,d=h[1]-s;e.closePath||(l-=2);for(var f=2;f<l;f+=2){var m=h[f]-n,g=h[f+1]-s;t.setTexture2D(),t.batchLine(p,d,m,g,u,u,c,f-2,!!e.closePath&&f===l-1),p=m,d=g}}},function(t,e,i){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var r=i(149),n=i(150),s=Phaser.Renderer.Canvas.SetTransform;t.exports=function(t,e,i,a,o){var h=t.currentContext;if(s(t,h,e,a,o)){var l=e._displayOriginX,c=e._displayOriginY,u=e.pathData,p=u.length-1,d=u[0]-l,f=u[1]-c;h.beginPath(),h.moveTo(d,f),e.closePath||(p-=2);for(var m=2;m<p;m+=2){var g=u[m]-l,_=u[m+1]-c;h.lineTo(g,_)}h.closePath(),e.isFilled&&(r(h,e),h.fill()),e.isStroked&&(n(h,e),h.stroke()),h.restore()}}},function(t,e){t.exports=function(t,e,i,r){var n=i||e.fillColor,s=r||e.fillAlpha,a=(16711680&n)>>>16,o=(65280&n)>>>8,h=255&n;t.fillStyle="rgba("+a+","+o+","+h+","+s+")"}},function(t,e){t.exports=function(t,e,i,r){var n=i||e.strokeColor,s=r||e.strokeAlpha,a=(16711680&n)>>>16,o=(65280&n)>>>8,h=255&n;t.strokeStyle="rgba("+a+","+o+","+h+","+s+")",t.lineWidth=e.lineWidth}},function(t,e){
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2019 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,r,n,s){if(0!==e.width&&0!==e.height){var a=e.frame,o=a.width,h=a.height,l=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,a.glTexture,o,h,e.x,e.y,o/e.style.resolution,h/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,o,h,l(e._tintTL,n.alpha*e._alphaTL),l(e._tintTR,n.alpha*e._alphaTR),l(e._tintBL,n.alpha*e._alphaBL),l(e._tintBR,n.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,n,s)}}},function(t,e){t.exports=function(t,e,i,r,n){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,r,n)}}]]);