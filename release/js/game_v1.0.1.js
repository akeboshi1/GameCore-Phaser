/*! For license information please see game_v1.0.1.js.LICENSE */
(this.webpackJsonpTooqingCore=this.webpackJsonpTooqingCore||[]).push([[0],[,,function(t,e,i){"use strict";i.r(e);var a=i(86),r=(i(140),i(6)),n=i(3),s=i(43),o=i(5),h=i(170),l=i.n(h);for(var c in n)r.PBpacket.addProtocol(n[c]);var u,d,p,m=function(){function Connection(t){this.mPacketHandlers=[],this.mReConnectCount=0,this.mListener=t}return Connection.prototype.startConnect=function(t,e){this.mCachedServerAddress=t;try{this.mWorker=new l.a,this._doConnect()}catch(t){throw new Error("startConnect Error: "+t)}},Connection.prototype.closeConnect=function(){},Connection.prototype.addPacketListener=function(t){this.mPacketHandlers.push(t)},Connection.prototype.send=function(t){if(!this.mWorker)throw new Error("NetWorker is undefined.");this.mWorker.postMessage({method:"send",buffer:t.Serialization()})},Connection.prototype.removePacketListener=function(t){var e=this.mPacketHandlers.indexOf(t);-1!==e&&this.mPacketHandlers.splice(e,1)},Connection.prototype._doConnect=function(){o.a.info("_doConnect ",this.mCachedServerAddress);var t=this;this.mWorker&&(this.mWorker.onmessage=function(e){t.onWorkerMessage(e.data)},this.mWorker.postMessage({method:"connect",address:t.mCachedServerAddress}))},Connection.prototype.onWorkerMessage=function(t){var e=this;switch(t.method){case"onConnected":this.mReConnectCount=0,this.mListener.onConnected();break;case"onDisConnected":if(!this.mTimeout){this.mReConnectCount<10&&this.mReConnectCount++;var i=Math.pow(this.mReConnectCount,2);o.a.info("ReConnect: delay = "+1e3*i+"[c/"+this.mReConnectCount+"]"),this.mTimeout=setTimeout((function(){e.mTimeout=void 0,e._doConnect()}),1e3*i)}break;case"onConnectError":break;case"onData":var a=t.buffer;a&&this._onData(a)}},Connection.prototype._onData=function(t){var e=new r.PBpacket;e.Deserialization(new s.Buffer(t)),this.mPacketHandlers.forEach((function(t){t.onPacketArrived(e)}))},Connection}(),f=(u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),g=function(t){function LoadingScene(){return t.call(this,{key:LoadingScene.name})||this}return f(LoadingScene,t),LoadingScene.prototype.preload=function(){this.load.spritesheet("rabbit00.png","./resources/rabbit00.png",{frameWidth:150,frameHeight:150})},LoadingScene.prototype.init=function(t){this.mWorld=t.world},LoadingScene.prototype.create=function(){var t=this.scale.gameSize.width,e=this.scale.gameSize.height,i=this.add.graphics();i.fillStyle(6381921),i.fillRect(0,0,t,e),this.anims.create({key:"loading_rabbit00",frames:this.anims.generateFrameNumbers("rabbit00.png",{start:0,end:59}),frameRate:33,yoyo:!0,repeat:-1});var a=t-150-25,r=e-150-25,n=this.add.sprite(a,r,"rabbit00.png");n.anims.play("loading_rabbit00"),n.scaleX=n.scaleY=this.mWorld.uiScale},LoadingScene.prototype.awake=function(){this.scene.wake()},LoadingScene.prototype.sleep=function(){this.scene.sleep()},LoadingScene.prototype.getKey=function(){return this.sys.config.key},LoadingScene}(Phaser.Scene),_=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),v=function(t){function MainUIScene(){return t.call(this,{key:MainUIScene.name})||this}return _(MainUIScene,t),MainUIScene.prototype.preload=function(){},MainUIScene.prototype.init=function(t){this.mRoom=t.room},MainUIScene.prototype.create=function(){this.fps=this.add.text(10,10,"");var t=this.mRoom.world;t.game.device.os.desktop||t.inputManager.setScene(this),t.uiManager.setScene(this)},MainUIScene.prototype.update=function(){this.fps.setText(this.game.loop.actualFps.toFixed())},MainUIScene.prototype.getKey=function(){return this.sys.config.key},MainUIScene}(Phaser.Scene),b=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),P=function(t){function PlayScene(e){return t.call(this,e||{key:PlayScene.name})||this}return b(PlayScene,t),PlayScene.prototype.preload=function(){},PlayScene.prototype.init=function(t){t&&(this.mCallBack=t.callBack,this.mRoom=t.room)},PlayScene.prototype.create=function(){this.mCallBack&&this.mCallBack(),this.scene.launch(v.name,{room:this.mRoom}),o.a.log("play created"),this.scene.sendToBack()},PlayScene.prototype.update=function(t,e){this.mRoom&&this.mRoom.update(t,e)},PlayScene.prototype.getKey=function(){return this.sys.config.key},PlayScene}(Phaser.Scene),S=i(8),D=function(){function Pos(t,e,i,a){this.x=0|t,this.y=0|e,this.z=0|i,this.depth=0|a}return Pos.prototype.add=function(t,e,i){return this.x+=t,this.x+=e,this.z+=i||0,this},Pos.prototype.equal=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.depth===this.depth},Pos.prototype.toString=function(){return"Pos >> x: "+this.x+", y: "+this.y+", z: "+this.z+", depth: "+this.depth},Pos}(),T=function(){function Position45(){}return Position45.transformTo90=function(t,e){var i=e.sceneWidth/2;return new D((t.x-t.y)*(e.tileWidth>>1)+i,(t.x+t.y)*(e.tileHeight>>1))},Position45.transformTo45=function(t,e){var i=e.sceneWidth/2-e.tileWidth/2;return new D(Math.floor((t.y+t.z)/e.tileHeight+(t.x-i)/e.tileWidth),Math.floor((t.y+t.z)/e.tileHeight-(t.x-i)/e.tileWidth))},Position45}(),C=function(){function SortRectangle(){this.mLeft=new D,this.mRight=new D,this.mTop=new D,this.mBottom=new D}return SortRectangle.prototype.setArea=function(t){if(!(!t||t.length<1||t[0].length<0)){var e=t[0].length,i=t.length,a={rows:e,cols:i,tileWidth:30,tileHeight:15,sceneWidth:15*(e+i),sceneHeight:7.5*(e+i)};this.mTop=T.transformTo90(new D(0,0),a),this.mLeft=T.transformTo90(new D(0,t.length-1),a).add(-15,0),this.mRight=T.transformTo90(new D(t.length-1,0),a).add(15,0),this.mBottom=T.transformTo90(new D(t[0].length-1,t.length-1),a).add(0,7)}},Object.defineProperty(SortRectangle.prototype,"left",{get:function(){return this.mLeft},enumerable:!0,configurable:!0}),Object.defineProperty(SortRectangle.prototype,"right",{get:function(){return this.mRight},enumerable:!0,configurable:!0}),Object.defineProperty(SortRectangle.prototype,"top",{get:function(){return this.mTop},enumerable:!0,configurable:!0}),Object.defineProperty(SortRectangle.prototype,"bottom",{get:function(){return this.mBottom},enumerable:!0,configurable:!0}),SortRectangle}(),O=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t.BodyCostDres="body_cost_$_dres",t.BodyCost="body_cost_$",t.BodyTail="body_tail_$",t.BodyWing="body_wing_$",t.BodyBase="body_base_$",t.BodySpec="body_spec_$",t.FlegSpec="fleg_spec_$",t.FlegBase="fleg_base_$",t.FlegCost="fleg_cost_$",t.BarmSpec="barm_spec_$",t.BarmBase="barm_base_$",t.BarmCost="barm_cost_$",t.WeapBarm="weap_barm_$",t.ShldBarm="shld_barm_$",t.BlegSpec="bleg_spec_$",t.BlegBase="bleg_base_$",t.BlegCost="bleg_cost_$",t.FarmSpec="farm_spec_$",t.FarmBase="farm_base_$",t.FarmCost="farm_cost_$",t.ShldFarm="shld_farm_$",t.WeapFarm="weap_farm_$",t.HeadSpec="head_spec_$",t.HeadMask="head_mask_$",t.HeadEyes="head_eyes_$",t.HeadBase="head_base_$",t.HeadHairBack="head_hair_$_back",t.HeadMous="head_mous_$",t.HeadHair="head_hair_$",t.HeadHats="head_hats_$"}(d||(d={})),function(t){t.BarmBase="barm_base_#_$",t.BarmCost="barm_cost_#_$",t.BarmSpec="barm_spec_#_$",t.BlegBase="bleg_base_#_$",t.BlegCost="bleg_cost_#_$",t.BlegSpec="bleg_spec_#_$",t.BodyBase="body_base_#_$",t.BodyCost="body_cost_#_$",t.BodyCostDres="body_cost_#_$_dres",t.BodySpec="body_spec_#_$",t.BodyTail="body_tail_#_$",t.BodyWing="body_wing_#_$",t.FarmBase="farm_base_#_$",t.FarmCost="farm_cost_#_$",t.FarmSpec="farm_spec_#_$",t.FlegBase="fleg_base_#_$",t.FlegCost="fleg_cost_#_$",t.FlegSpec="fleg_spec_#_$",t.HeadBase="head_base_#_$",t.HeadEyes="head_eyes_#_$",t.HeadHair="head_hair_#_$",t.HeadHairBack="head_hair_#_$_back",t.HeadHats="head_hats_#_$",t.HeadMask="head_mask_#_$",t.HeadMous="head_mous_#_$",t.HeadSpec="head_spec_#_$",t.ShldFarm="shld_farm_#_$",t.WeapFarm="weap_farm_#_$",t.ShldBarm="shld_barm_#_$",t.WeapBarm="weap_barm_#_$"}(p||(p={}));var M,w=function(t){function DragonbonesDisplay(e){var i=t.call(this,e)||this;return i.scene=e,i.mAnimationName="Armature",i.mDragonbonesName="",i.mActionName="",i.mSortRectangle=new C,i.replaceArr=[],i.misloading=!1,i.mloadingList=[],i.mBaseLoc=new Phaser.Geom.Point,i}return O(DragonbonesDisplay,t),Object.defineProperty(DragonbonesDisplay.prototype,"GameObject",{get:function(){return this},enumerable:!0,configurable:!0}),DragonbonesDisplay.prototype.changeAlpha=function(t){},DragonbonesDisplay.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this)},DragonbonesDisplay.prototype.load=function(t){this.mDisplayInfo=t,this.mDisplayInfo&&(this.dragonBonesName="bones_human01",this.scene.cache.obj.has(this.dragonBonesName))},DragonbonesDisplay.prototype.loadEff=function(t,e){var i,a;if(void 0===e&&(e=!1),(i=t)&&(e?(this.backEffDisplayInfo=i,a=this.backEffKey):(this.frontEffDisplayInfo=i,a=this.frontEffKey),a))if(this.scene.cache.obj.has(a))e?this.onLoadBackEffCompleteHandler():this.onLoadFrontEffCompleteHandler();else{var r=i.display;r?(this.scene.load.atlas(a,"https://osd.tooqing.com/"+r.texturePath,"https://osd.tooqing.com/"+r.dataPath),e?this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadBackEffCompleteHandler,this):this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadFrontEffCompleteHandler,this),this.scene.load.start()):o.a.error("display is undefined")}},DragonbonesDisplay.prototype.getDisplay=function(){return this.mArmatureDisplay},DragonbonesDisplay.prototype.play=function(t){if(this.mActionName!==t){var e=void 0!==this.mDisplayInfo?this.mDisplayInfo.avatarDir:3,i="";3===(e=0!==e?e:3)||5===e?this.scaleX=4-e:1!==e&&7!==e||(this.scaleX=-1/3*e+4/3,i="_back"),this.mActionName=t+i,this.mArmatureDisplay&&this.mArmatureDisplay.animation.play(this.mActionName)}},DragonbonesDisplay.prototype.playFrontEff=function(t){var e=this;this.makeEffAnimations(t,!1),this.mFrontEffSprite.on("animationcomplete",(function(){e.mFrontEffSprite.destroy()})),this.mFrontEffSprite.play(this.frontEffDisplayInfo.type+"_"+t)},DragonbonesDisplay.prototype.playBackEff=function(t){var e=this;this.makeEffAnimations(t,!0),this.mBackEffSprite.on("animationcomplete",(function(){e.mBackEffSprite.destroy()})),this.mBackEffSprite.play(this.frontEffDisplayInfo.type+"_"+t)},DragonbonesDisplay.prototype.fadeIn=function(t){this.clearFadeTween(),this.alpha=0,this.mFadeTween=this.scene.tweens.add({targets:this,alpha:1,duration:1200,onComplete:function(){t&&t()}})},DragonbonesDisplay.prototype.fadeOut=function(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:function(){t&&t()}})},DragonbonesDisplay.prototype.destroy=function(){this.mDisplayInfo=null,this.mArmatureDisplay&&(this.mArmatureDisplay.dispose(!0),this.mArmatureDisplay=null),this.mClickGraphics&&(this.mClickGraphics.clear(),this.mClickGraphics.destroy(!0),this.mClickGraphics=null),this.mClickCon&&(this.mClickCon.destroy(!0),this.mClickCon=null),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=null),t.prototype.destroy.call(this)},DragonbonesDisplay.prototype.buildDragbones=function(){if(this.scene.cache.custom.dragonbone.get(this.mDragonbonesName))this.onLoadCompleteHandler();else{var t="./resources/dragonbones";this.scene.load.dragonbone(this.mDragonbonesName,t+"/"+this.mDragonbonesName+"_tex.png",t+"/"+this.mDragonbonesName+"_tex.json",t+"/"+this.mDragonbonesName+"_ske.dbbin",null,null,{responseType:"arraybuffer"}),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.scene.load.start()}},DragonbonesDisplay.prototype.onLoadCompleteHandler=function(t,e,i){this.mArmatureDisplay&&this.mArmatureDisplay.dbClear(),this.mArmatureDisplay=this.scene.add.armature(this.mAnimationName,this.dragonBonesName),this.clearArmature(),this.getReplaceArr(),this.showReplaceArmatrue(),this.mArmatureDisplay.x=this.mBaseLoc.x,this.mArmatureDisplay.y=this.mBaseLoc.y,this.add(this.mArmatureDisplay);var a=new Phaser.Geom.Rectangle(0,0,50,70);this.mClickGraphics||(this.mClickGraphics=this.scene.add.graphics(),this.mClickGraphics.fillStyle(16711680),this.mClickGraphics.fillRectShape(a),this.mClickGraphics.visible=!1,this.add(this.mClickGraphics)),this.mClickCon||(this.mClickCon=this.scene.add.container(0,0,this.mClickGraphics),this.mClickCon.setInteractive(a,Phaser.Geom.Rectangle.Contains),this.mClickCon.x=-a.width>>1,this.mClickCon.y=-a.height),this.setData("id",this.mDisplayInfo.id),this.add(this.mClickCon),this.emit("initialized")},DragonbonesDisplay.prototype.onLoadFrontEffCompleteHandler=function(){this.mFrontEffSprite?this.mFrontEffSprite.setTexture(this.frontEffKey):(this.mFrontEffSprite=this.scene.make.sprite(void 0,!1).setOrigin(0,0),this.addAt(this.mFrontEffSprite,2)),this.playFrontEff(this.frontEffDisplayInfo.animationName),this.emit("frontEffinitialized")},DragonbonesDisplay.prototype.onLoadBackEffCompleteHandler=function(){this.mBackEffSprite?this.mBackEffSprite.setTexture(this.backEffKey):(this.mBackEffSprite=this.scene.make.sprite(void 0,!1).setOrigin(0,0),this.addAt(this.mBackEffSprite,0)),this.playBackEff(this.backEffDisplayInfo.animationName),this.emit("backEffinitialized")},DragonbonesDisplay.prototype.clearArmature=function(){for(var t=this.mArmatureDisplay.armature.getSlots(),e=t.length,i=0;i<e;i++){t[i].display.visible=!1}},DragonbonesDisplay.prototype.clearReplaceArmature=function(){if(this.mArmatureDisplay.armature.animation.stop(),this.replaceArr&&0!==this.replaceArr.length)for(var t=this.replaceArr.length,e=0;e<t;e++){var i=this.replaceArr[e].slot.replace("$",this.replaceArr[e].dir.toString());this.mArmatureDisplay.armature.getSlot(i).replaceDisplay(null)}},DragonbonesDisplay.prototype.showReplaceArmatrue=function(){for(var t=0,e=this.replaceArr;t<e.length;t++){var i=e[t];this.replacePartDisplay(i.slot,i.part,i.dir,i.skin);i.slot.replace("$",i.dir.toString())}this.replaceArr.splice(0)},DragonbonesDisplay.prototype.getReplaceArr=function(){this.replaceArr.length=0;var t=this.mDisplayInfo.avatar;t.bodyBaseId&&(this.replaceArr.push({slot:d.BodyBase,part:p.BodyBase,dir:3,skin:t.bodyBaseId}),this.replaceArr.push({slot:d.BodyBase,part:p.BodyBase,dir:1,skin:t.bodyBaseId})),t.bodySpecId&&(this.replaceArr.push({slot:d.BodySpec,part:p.BodySpec,dir:3,skin:t.bodySpecId}),this.replaceArr.push({slot:d.BodySpec,part:p.BodySpec,dir:1,skin:t.bodySpecId})),t.bodyWingId&&(this.replaceArr.push({slot:d.BodyWing,part:p.BodyWing,dir:3,skin:t.bodyWingId}),this.replaceArr.push({slot:d.BodyWing,part:p.BodyWing,dir:1,skin:t.bodyWingId})),t.bodyTailId&&(this.replaceArr.push({slot:d.BodyTail,part:p.BodyTail,dir:3,skin:t.bodyTailId}),this.replaceArr.push({slot:d.BodyTail,part:p.BodyTail,dir:1,skin:t.bodyTailId})),t.bodyCostId&&(this.replaceArr.push({slot:d.BodyCost,part:p.BodyCost,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:d.BodyCost,part:p.BodyCost,dir:1,skin:t.bodyCostId}),this.replaceArr.push({slot:d.BodyCostDres,part:p.BodyCostDres,dir:3,skin:t.bodyCostId}),this.replaceArr.push({slot:d.BodyCostDres,part:p.BodyCostDres,dir:1,skin:t.bodyCostId})),t.farmBaseId&&(this.replaceArr.push({slot:d.FarmBase,part:p.FarmBase,dir:3,skin:t.farmBaseId}),this.replaceArr.push({slot:d.FarmBase,part:p.FarmBase,dir:1,skin:t.farmBaseId})),t.farmSpecId&&(this.replaceArr.push({slot:d.FarmSpec,part:p.FarmSpec,dir:3,skin:t.farmSpecId}),this.replaceArr.push({slot:d.FarmSpec,part:p.FarmSpec,dir:1,skin:t.farmSpecId})),t.farmCostId&&(this.replaceArr.push({slot:d.FarmCost,part:p.FarmCost,dir:3,skin:t.farmCostId}),this.replaceArr.push({slot:d.FarmCost,part:p.FarmCost,dir:1,skin:t.farmCostId})),t.barmBaseId&&(this.replaceArr.push({slot:d.BarmBase,part:p.BarmBase,dir:3,skin:t.barmBaseId}),this.replaceArr.push({slot:d.BarmBase,part:p.BarmBase,dir:1,skin:t.barmBaseId})),t.barmSpecId&&(this.replaceArr.push({slot:d.BarmSpec,part:p.BarmSpec,dir:3,skin:t.barmSpecId}),this.replaceArr.push({slot:d.BarmSpec,part:p.BarmSpec,dir:1,skin:t.barmSpecId})),t.barmCostId&&(this.replaceArr.push({slot:d.BarmCost,part:p.BarmCost,dir:3,skin:t.barmCostId}),this.replaceArr.push({slot:d.BarmCost,part:p.BarmCost,dir:1,skin:t.barmCostId})),t.blegBaseId&&(this.replaceArr.push({slot:d.BlegBase,part:p.BlegBase,dir:3,skin:t.blegBaseId}),this.replaceArr.push({slot:d.BlegBase,part:p.BlegBase,dir:1,skin:t.blegBaseId})),t.blegSpecId&&(this.replaceArr.push({slot:d.BlegSpec,part:p.BlegSpec,dir:3,skin:t.blegSpecId}),this.replaceArr.push({slot:d.BlegSpec,part:p.BlegSpec,dir:1,skin:t.blegSpecId})),t.blegCostId&&(this.replaceArr.push({slot:d.BlegCost,part:p.BlegCost,dir:3,skin:t.blegCostId}),this.replaceArr.push({slot:d.BlegCost,part:p.BlegCost,dir:1,skin:t.blegCostId})),t.flegBaseId&&(this.replaceArr.push({slot:d.FlegBase,part:p.FlegBase,dir:3,skin:t.flegBaseId}),this.replaceArr.push({slot:d.FlegBase,part:p.FlegBase,dir:1,skin:t.flegBaseId})),t.flegSpecId&&(this.replaceArr.push({slot:d.FlegSpec,part:p.FlegSpec,dir:3,skin:t.flegSpecId}),this.replaceArr.push({slot:d.FlegSpec,part:p.FlegSpec,dir:1,skin:t.flegSpecId})),t.flegCostId&&(this.replaceArr.push({slot:d.FlegCost,part:p.FlegCost,dir:3,skin:t.flegCostId}),this.replaceArr.push({slot:d.FlegCost,part:p.FlegCost,dir:1,skin:t.flegCostId})),t.headBaseId&&(this.replaceArr.push({slot:d.HeadBase,part:p.HeadBase,dir:3,skin:t.headBaseId}),this.replaceArr.push({slot:d.HeadBase,part:p.HeadBase,dir:1,skin:t.headBaseId})),t.barmWeapId&&(this.replaceArr.push({slot:d.WeapBarm,part:p.WeapBarm,dir:3,skin:t.barmWeapId}),this.replaceArr.push({slot:d.WeapBarm,part:p.WeapBarm,dir:1,skin:t.barmWeapId})),t.headHairId&&(this.replaceArr.push({slot:d.HeadHair,part:p.HeadHair,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:d.HeadHair,part:p.HeadHair,dir:1,skin:t.headHairId}),this.replaceArr.push({slot:d.HeadHairBack,part:p.HeadHairBack,dir:3,skin:t.headHairId}),this.replaceArr.push({slot:d.HeadHairBack,part:p.HeadHairBack,dir:1,skin:t.headHairId})),t.headHatsId&&(this.replaceArr.push({slot:d.HeadHats,part:p.HeadHats,dir:3,skin:t.headHatsId}),this.replaceArr.push({slot:d.HeadHats,part:p.HeadHats,dir:1,skin:t.headHatsId})),t.headSpecId&&(this.replaceArr.push({slot:d.HeadSpec,part:p.HeadSpec,dir:3,skin:t.headSpecId}),this.replaceArr.push({slot:d.HeadSpec,part:p.HeadSpec,dir:1,skin:t.headSpecId})),t.headEyesId&&this.replaceArr.push({slot:d.HeadEyes,part:p.HeadEyes,dir:3,skin:t.headEyesId}),t.headMousId&&this.replaceArr.push({slot:d.HeadMous,part:p.HeadMous,dir:3,skin:t.headMousId}),t.headMaskId&&this.replaceArr.push({slot:d.HeadMask,part:p.HeadMask,dir:3,skin:t.headMaskId}),t.farmShldId&&(this.replaceArr.push({slot:d.ShldFarm,part:p.ShldFarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:d.ShldFarm,part:p.ShldFarm,dir:1,skin:t.farmShldId}),this.replaceArr.push({slot:d.ShldBarm,part:p.ShldBarm,dir:3,skin:t.farmShldId}),this.replaceArr.push({slot:d.ShldBarm,part:p.ShldBarm,dir:1,skin:t.farmShldId})),t.farmWeapId&&(this.replaceArr.push({slot:d.WeapFarm,part:p.WeapFarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:d.WeapFarm,part:p.WeapFarm,dir:1,skin:t.farmWeapId}),this.replaceArr.push({slot:d.WeapBarm,part:p.WeapBarm,dir:3,skin:t.farmWeapId}),this.replaceArr.push({slot:d.WeapBarm,part:p.WeapBarm,dir:1,skin:t.farmWeapId}))},DragonbonesDisplay.prototype.replacePartDisplay=function(t,e,i,a){var r=t.replace("$",i.toString()),n=this.mArmatureDisplay.armature.getSlot(r),s=e.replace("#",a.toString()).replace("$",i.toString());if(this.scene.cache.custom.dragonbone.get(this.dragonBonesName)){var o=S.d.getPartName(s);if(this.scene.game.cache.obj.has(o)){var h=S.d.getPartName(s),l=new dragonBones.phaser.display.SlotImage(this.scene,0,0,h);n.replaceDisplay(l)}else this.mloadingList.push([n.name,s]),this.misloading||(this.misloading=!0,this.startLoad())}},DragonbonesDisplay.prototype.startLoad=function(){var t=this,e=this.mloadingList.shift();if(e){var i=S.d.getPartUrl(e[1]),a=S.d.getPartName(e[1]);e[1];this.scene.load.once(Phaser.Loader.Events.COMPLETE,(function(i,a,r){var n=S.d.getPartName(e[1]),s=t.mArmatureDisplay.armature.getSlot(e[0]),o=new dragonBones.phaser.display.SlotImage(t.scene,0,0,n);o.texture.key===n&&s.replaceDisplay(o),t.misloading=!1,t.startLoad()}),this),this.scene.load.once(Phaser.Loader.Events.FILE_LOAD_ERROR,(function(e){t.misloading=!1,t.startLoad()}),this),this.scene.load.image(a,i),this.scene.load.start()}else this.misloading=!1},DragonbonesDisplay.prototype.makeEffAnimations=function(t,e){var i;if(void 0===e&&(e=!1),i=e?this.frontEffDisplayInfo:this.backEffDisplayInfo){i.animations;var a=e?this.frontEffKey:this.backEffKey,r=i.getAnimations(t);if(!r)return;var n=[];r.frameName.forEach((function(t){n.push({key:a,frame:t})}));var s={key:i.type+"_"+r.name,frames:n,frameRate:r.frameRate,repeat:-1};this.scene.anims.create(s)}},DragonbonesDisplay.prototype.clearFadeTween=function(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())},Object.defineProperty(DragonbonesDisplay.prototype,"dragonBonesName",{get:function(){return this.mDragonbonesName},set:function(t){this.mDragonbonesName!==t&&(this.mDragonbonesName=t,this.buildDragbones())},enumerable:!0,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"baseLoc",{get:function(){return this.mBaseLoc},enumerable:!0,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"frontEffKey",{get:function(){if(this.frontEffDisplayInfo){var t=this.frontEffDisplayInfo.display;return t&&t.texturePath&&t.dataPath?t.texturePath+t.dataPath:void 0}},enumerable:!0,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"backEffKey",{get:function(){if(this.backEffDisplayInfo){var t=this.backEffDisplayInfo.display;return t&&t.texturePath&&t.dataPath?t.texturePath+t.dataPath:void 0}},enumerable:!0,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"sortRectangle",{get:function(){return this.mSortRectangle},enumerable:!0,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"sortX",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(DragonbonesDisplay.prototype,"sortY",{get:function(){return this.y},enumerable:!0,configurable:!0}),DragonbonesDisplay}(Phaser.GameObjects.Container),A=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t[t.BACKEND=1]="BACKEND",t[t.STAGE=2]="STAGE",t[t.FRONTEND=3]="FRONTEND"}(M||(M={}));var E,B=function(t){function FramesDisplay(){var e=null!==t&&t.apply(this,arguments)||this;return e.mDisplayDatas=new Map,e.mSprites=new Map,e.mHasAnimation=!1,e.mSortRectangle=new C,e.mAlpha=1,e}return A(FramesDisplay,t),FramesDisplay.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this)},FramesDisplay.prototype.changeAlpha=function(t){this.mAlpha!==t&&(this.alpha=t,this.mAlpha=t)},FramesDisplay.prototype.setPosition=function(e,i,a){return t.prototype.setPosition.call(this,e,i,a),this.setDepth(this.x+this.baseLoc.x+this.y+this.baseLoc.y),this},FramesDisplay.prototype.load=function(t,e){var i=this;e=e||M.STAGE;var a=t;if(a&&a.gene&&!this.mSprites.get(e))if(this.mDisplayDatas.set(e,a),this.scene.cache.obj.has(a.gene))this.onLoadCompleted(e);else{var r=a.display;r||o.a.error("display is undefined"),this.scene.load.atlas(a.gene,"https://osd.tooqing.com/"+r.texturePath,"https://osd.tooqing.com/"+r.dataPath),this.scene.load.once(Phaser.Loader.Events.COMPLETE,(function(){i.onLoadCompleted(e)}),this),this.scene.load.start()}},FramesDisplay.prototype.play=function(t,e){if(t){e=e||M.STAGE;var i=this.mDisplayDatas.get(e),a=this.mSprites.get(e);if(a&&a instanceof Phaser.GameObjects.Sprite)a.play(i.gene+"_"+t);else{var r=i.getAnimations(t);if(!r)return void o.a.log("error: "+t+" not found");a.setTexture(i.gene,r.frameName[0])}this.initBaseLoc(e,t)}},FramesDisplay.prototype.fadeIn=function(t){0!==this.mAlpha&&(this.alpha=0,this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:this.mAlpha,duration:1200,onComplete:function(){t&&t()}}))},FramesDisplay.prototype.fadeOut=function(t){this.clearFadeTween(),this.mFadeTween=this.scene.tweens.add({targets:this,alpha:0,duration:1200,onComplete:function(){t&&t()}})},FramesDisplay.prototype.destroy=function(){this.mSprites.forEach((function(t){return t.destroy()})),this.mSprites.clear(),this.mFadeTween&&(this.clearFadeTween(),this.mFadeTween=void 0),this.mDisplayDatas.clear(),t.prototype.destroy.call(this)},FramesDisplay.prototype.clearFadeTween=function(){this.mFadeTween&&(this.mFadeTween.stop(),this.mFadeTween.remove())},FramesDisplay.prototype.onLoadCompleted=function(t){this.makeAnimations(t),this.createDisplay(t)},FramesDisplay.prototype.makeAnimations=function(t){var e=this.mDisplayDatas.get(t);if(e)for(var i=0,a=Array.from(e.animations.values());i<a.length;i++){var r=a[i];this.makeAnimation(t,r)}},FramesDisplay.prototype.makeAnimation=function(t,e){var i=this.mDisplayDatas.get(t);if(e&&i&&i.gene&&!(e.frameName.length<=1)){var a=[];e.frameName.forEach((function(t){a.push({key:i.gene,frame:t})}));var r={key:i.gene+"_"+e.name,frames:a,frameRate:e.frameRate,repeat:-1};this.mHasAnimation=!0,this.scene.anims.create(r)}},FramesDisplay.prototype.initBaseLoc=function(t,e){var i=this.mDisplayDatas.get(t),a=this.mSprites.get(t);if(a&&i&&i.animations){var r=i.getAnimations(e);r&&(this.mBaseLoc=r.baseLoc,a.x=this.baseLoc.x,a.y=this.baseLoc.y,this.mSortRectangle.setArea(r.collisionArea))}},FramesDisplay.prototype.createDisplay=function(t){var e=this.mDisplayDatas.get(t);if(e&&e.gene){var i=this.mSprites.get(t);i||(this.mHasAnimation?i=this.scene.make.sprite(void 0,!1).setOrigin(0,0):(i=this.scene.make.image(void 0,!1).setOrigin(0,0)).setTexture(e.gene),this.mSprites.set(t,i),this.play(e.animationName,t),i.x=this.baseLoc.x,i.y=this.baseLoc.y,this.addAt(i,t)),i.setInteractive({pixelPerfect:!0}),this.setData("id",e.id),this.mSprites.set(t,i),this.emit("initialized")}},Object.defineProperty(FramesDisplay.prototype,"baseLoc",{get:function(){return this.mBaseLoc||new Phaser.Geom.Point},enumerable:!0,configurable:!0}),Object.defineProperty(FramesDisplay.prototype,"sortRectangle",{get:function(){return this.mSortRectangle},enumerable:!0,configurable:!0}),Object.defineProperty(FramesDisplay.prototype,"sortX",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(FramesDisplay.prototype,"sortY",{get:function(){return this.y},enumerable:!0,configurable:!0}),FramesDisplay}(Phaser.GameObjects.Container),I=function(){function DragonbonesModel(t){this.discriminator="DragonbonesModel",t&&(this.id=t.id,this.avatar=t.avatar)}return DragonbonesModel.prototype.setInfo=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},DragonbonesModel.prototype.destroy=function(){},DragonbonesModel}(),k=function(){function BlockObject(){this.mRenderable=!1}return BlockObject.prototype.setRenderable=function(t,e){var i=this;if(this.mRenderable!==t){if(e=e||0,this.mRenderable=t,t)return this.addDisplay(),void(e>0&&this.fadeIn());e>0?this.fadeOut((function(){i.removeDisplay()})):this.removeDisplay()}},BlockObject.prototype.getRenderable=function(){return this.mRenderable},BlockObject.prototype.fadeIn=function(t){this.mDisplay&&this.mDisplay.fadeIn(t)},BlockObject.prototype.fadeOut=function(t){this.mDisplay&&this.mDisplay.fadeOut(t)},BlockObject.prototype.fadeAlpha=function(t){this.mDisplay},BlockObject.prototype.destroy=function(){this.mDisplay&&(this.mDisplay.destroy(),this.mDisplay=null)},BlockObject.prototype.addDisplay=function(){},BlockObject.prototype.removeDisplay=function(){this.mDisplay&&this.mDisplay.removeFromParent()},BlockObject}(),R=i(50),j=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),L=function(t){function Bubble(e){var i=t.call(this,e)||this;return i.mMinWidth=0,i.mMinHeight=0,i.x=-60,i}return j(Bubble,t),Bubble.prototype.show=function(t,e){this.mChatContent=this.scene.make.text({text:t,style:{x:0,y:4,fontFamily:"YaHei",fontSize:14,color:"#000000",origin:{x:0,y:0},wordWrap:{width:300,useAdvancedWrap:!0}}},!1),this.add(this.mChatContent),this.mMinHeight=this.mChatContent.height+26,this.mMinHeight=this.mMinHeight<54?54:this.mMinHeight,this.mMinWidth=this.mChatContent.width+40,this.mMinWidth=this.mMinWidth<69?69:this.mMinWidth,this.mBubbleBg=new R.DynamicNinepatch(this.scene,this);var i=S.e.getOsdRes(e.bubbleResource||"platformitem/thumbnail/bubble_01.png");this.mBubbleBg.load(i,{width:this.mMinWidth,height:this.mMinHeight,key:i,columns:[34,2,32],rows:[42,2,9]},this.onComplete,this)},Bubble.prototype.tweenTo=function(t){this.mToY=t,this.scene.tweens.add({targets:this,y:t,alpha:1,duration:200})},Bubble.prototype.durationRemove=function(t,e,i){var a=this;this.mTweenCompleteCallback=e,this.mTweenCallContext=i,this.mRemoveDelay=setTimeout((function(){a.removeTween()}),t)},Bubble.prototype.removeTween=function(){var t=this,e=this.mToY-30;this.scene.tweens.add({targets:this,y:e,alpha:0,duration:200,onComplete:function(){t.mTweenCompleteCallback&&t.mTweenCompleteCallback.call(t.mTweenCallContext,t)}})},Bubble.prototype.onComplete=function(t){if(t){t.setOrigin(0,0),this.addAt(t,0);this.getBounds();this.mChatContent.x=this.mMinWidth-this.mChatContent.width>>1,this.mChatContent.y=6+(this.mMinHeight-this.mChatContent.height>>1)}},Object.defineProperty(Bubble.prototype,"minWidth",{get:function(){return this.mMinWidth},enumerable:!0,configurable:!0}),Object.defineProperty(Bubble.prototype,"minHeight",{get:function(){return this.mMinHeight},enumerable:!0,configurable:!0}),Bubble}(Phaser.GameObjects.Container),F=i(44),N=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),U=function(t){function BubbleContainer(e){var i=t.call(this,e)||this;return i.mBubbles=[],i.mArrow=new F.DynamicImage(i.scene,0,0),i.mArrow.load(S.e.getRes("ui/chat/bubble_arrow.png")),i.add(i.mArrow),i}return N(BubbleContainer,t),BubbleContainer.prototype.addBubble=function(t,e){for(var i=this.createBubble(e),a=null,r=0,n=this.mBubbles.length-1;n>=0;n--)r+=(a=this.mBubbles[n]).minHeight+5,a.tweenTo(-r);i.show(t,e),this.add(i),this.mArrow.y=i.minHeight+4},BubbleContainer.prototype.destroy=function(e){this.mBubbles=null,this.removeFormParent(),t.prototype.destroy.call(this,e)},BubbleContainer.prototype.removeFormParent=function(){this.parentContainer&&this.parentContainer.remove(this)},BubbleContainer.prototype.createBubble=function(t){if(t){var e=new L(this.scene);this.mBubbles.push(e);var i=t.duration?t.duration:5e3;return e.durationRemove(i,this.onRemoveBubble,this),e}},BubbleContainer.prototype.onRemoveBubble=function(t){t&&(this.mBubbles=this.mBubbles.filter((function(e){return t!==e})),this.remove(t),t.destroy(),0===this.mBubbles.length&&this.removeFormParent())},BubbleContainer}(Phaser.GameObjects.Container),V=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t[t.up=0]="up",t[t.up_left=1]="up_left",t[t.left=2]="left",t[t.left_down=3]="left_down",t[t.down=4]="down",t[t.down_right=5]="down_right",t[t.right=6]="right",t[t.right_up=7]="right_up"}(E||(E={}));var H,W=function(t){function Element(e,i){var a=t.call(this)||this;if(a.mElementManager=i,a.mAnimationName="",a.mMoveData={},a.mId=e.id,e.avatar)a.mDisplayInfo=new I(e);else{var r=a.mElementManager.roomService.world.elementStorage.getObject(e.bindID||e.id);if(!r)return o.a.error("object does not exist"),a;a.mDisplayInfo=r}return a.createDisplay(),a.setPosition(e.pos),a.mDisplay.changeAlpha(e.alpha),a}return V(Element,t),Object.defineProperty(Element.prototype,"dir",{get:function(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},enumerable:!0,configurable:!0}),Object.defineProperty(Element.prototype,"roomService",{get:function(){if(this.mElementManager)return this.mElementManager.roomService;o.a.error("element manager is undefined")},enumerable:!0,configurable:!0}),Object.defineProperty(Element.prototype,"id",{get:function(){return this.mId},enumerable:!0,configurable:!0}),Element.prototype.load=function(t){this.mDisplayInfo=t},Element.prototype.play=function(t){this.mAnimationName!==t&&(this.mAnimationName=t,this.mDisplay&&this.mDisplay.play(this.mAnimationName))},Element.prototype.setDirection=function(t){this.mDisplayInfo&&this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t)},Element.prototype.getDirection=function(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},Element.prototype.changeState=function(t){this.mCurState=t},Element.prototype.getRenderable=function(){return this.mRenderable},Element.prototype.getDisplay=function(){return this.mDisplay},Element.prototype.move=function(t){return this.mElementManager?this.mDisplay?(this.mMoveData.arrivalTime=t.timestemp,this.mMoveData.destPos=new D(Math.floor(t.destinationPoint3f.x),Math.floor(t.destinationPoint3f.y)),o.a.log("walk has movedata"),void this._doMove()):o.a.error("display is undefined"):o.a.error("Element::move - Empty element-manager.")},Element.prototype.startMove=function(){this.changeState("walk")},Element.prototype.stopMove=function(){this.mDisplay?this.changeState("idle"):o.a.error("can't stopMove, display does not exist")},Element.prototype.setPosition=function(t){this.mDisplay&&this.mDisplay.setPosition(t.x,t.y,t.z),this.setDepth()},Element.prototype.getPosition=function(){var t;return this.mDisplay&&(t=new D(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z)),t},Element.prototype.getPosition45=function(){var t=this.getPosition();return t?this.roomService.transformTo45(t):new D},Element.prototype.getRootPosition=function(){return new D(this.mDisplay.x,this.mDisplay.y,0)},Element.prototype.showBubble=function(t,e){var i=this.mElementManager.scene;i&&(this.mBubble||(this.mBubble=new U(i)),this.mBubble.addBubble(t,e),this.updateBubble(),this.roomService.addToSceneUI(this.mBubble))},Element.prototype.destroy=function(){this.mBubble&&(this.mBubble.destroy(),this.mBubble=void 0),t.prototype.destroy.call(this)},Element.prototype._doMove=function(){var t=this;if(this.mMoveData.destPos){var e=this.mMoveData.tweenAnim;e&&(e.stop(),e.remove());var i=this.mMoveData.arrivalTime-this.roomService.now();this.mMoveData.tweenAnim=this.mElementManager.scene.tweens.add({targets:this.mDisplay,duration:i,ease:"Linear",props:{x:{value:this.mMoveData.destPos.x},y:{value:this.mMoveData.destPos.y}},onStart:function(){t.onMoveStart()},onComplete:function(e,i,a){t.onMoveComplete()},onUpdate:function(e,i,a){t.onMoving()},onCompleteParams:[this]})}else o.a.log("stopDoMove")},Element.prototype.createDisplay=function(){if(this.mDisplayInfo){if(this.mDisplay)return this.mDisplay;var t=this.mElementManager.scene;return t&&("DragonbonesModel"===this.mDisplayInfo.discriminator?this.mDisplay=new w(t):this.mDisplay=new B(t),this.mDisplay.once("initialized",this.onDisplayReady,this),this.mDisplay.load(this.mDisplayInfo)),this.mDisplay}o.a.error("displayinfo does not exist, Create display failed")},Element.prototype.addDisplay=function(){this.createDisplay();var t=this.roomService;t?(t.addToSurface(this.mDisplay),this.setDepth()):o.a.error("roomService is undefined")},Element.prototype.setDepth=function(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.x+this.mDisplay.y),!this.roomService)throw new Error("roomService is undefined");var t=this.roomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthSurfaceDirty=!0}},Element.prototype.onDisplayReady=function(){this.mDisplay&&(this.mDisplay.play("idle"),this.setDepth())},Element.prototype.updateBubble=function(){if(this.mBubble){var t=this.getPosition();t&&(this.mBubble.x=t.x,this.mBubble.y=t.y-130)}},Element.prototype.onMoveStart=function(){},Element.prototype.onMoveComplete=function(){this.mMoveData.tweenAnim.stop()},Element.prototype.onMoving=function(){var t=this.roomService.now();t-(0|this.mMoveData.tweenLastUpdate)>=50&&(this.setDepth(),this.mMoveData.tweenLastUpdate=t,this.updateBubble())},Element}(k),z=function(){function Sprite(t){if(this.mID=t.id,t.point3f){var e=t.point3f;this.mPos=new D(e.x,e.y,e.z)}t.avatar&&(this.mAvatar={id:t.avatar.id},this.mAvatar=Object.assign(this.mAvatar,t.avatar)),this.mCurrentAnimationName=t.currentAnimationName||"idle",this.mDirection=t.direction,this.mBindID=t.bindId,this.mAlpha=void 0===t.opacity?1:t.opacity/100}return Object.defineProperty(Sprite.prototype,"id",{get:function(){return this.mID},enumerable:!0,configurable:!0}),Object.defineProperty(Sprite.prototype,"pos",{get:function(){return this.mPos},enumerable:!0,configurable:!0}),Object.defineProperty(Sprite.prototype,"avatar",{get:function(){return this.mAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(Sprite.prototype,"currentAnimationName",{get:function(){return this.mCurrentAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(Sprite.prototype,"direction",{get:function(){return this.mDirection},enumerable:!0,configurable:!0}),Object.defineProperty(Sprite.prototype,"bindID",{get:function(){return this.mBindID},enumerable:!0,configurable:!0}),Object.defineProperty(Sprite.prototype,"alpha",{get:function(){return this.mAlpha},enumerable:!0,configurable:!0}),Sprite}(),Y=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),G=function(t){function ElementManager(e){var i=t.call(this)||this;return i.mRoom=e,i.mElements=new Map,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,i.onAdd),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,i.onRemove),i.addHandlerFun(n.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_MOVE_ELEMENT,i.onMove),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,i.onAdjust),i.addHandlerFun(n.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_SET_ELEMENT_POSITION,i.onSetPosition)),i.mRoom&&i.mRoom.world&&(i.mGameConfig=i.mRoom.world.elementStorage),i}return Y(ElementManager,t),ElementManager.prototype.init=function(){this.destroy()},ElementManager.prototype.get=function(t){var e=this.mElements.get(t);if(e)return e},ElementManager.prototype.removeFromMap=function(t){var e=this.mElements.get(t);e&&(this.mElements.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))},ElementManager.prototype.destroy=function(){var t=this;this.mElements&&(this.mElements.forEach((function(e){return t.removeFromMap(e.id)})),this.mElements.clear())},Object.defineProperty(ElementManager.prototype,"camera",{get:function(){return this.mRoom.cameraService.camera},enumerable:!0,configurable:!0}),Object.defineProperty(ElementManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;o.a.log("roomManager is undefined")},enumerable:!0,configurable:!0}),ElementManager.prototype.onAdjust=function(t){var e=t.content,i=e.spritePositions;if(e.nodeType===n.op_def.NodeType.ElementNodeType)for(var a,r,s=0,o=i;s<o.length;s++){var h=o[s];(a=this.mElements.get(h.id))&&(r=h.point3f,a.setPosition(new D(0|r.x,0|r.y,0|r.z)))}},ElementManager.prototype.onAdd=function(t){if(this.mRoom.layerManager)if(this.mGameConfig){var e=t.content,i=e.sprites;if(i)if(e.nodeType===n.op_def.NodeType.ElementNodeType)for(var a=0,r=i;a<r.length;a++){var s=r[a];s.point3f&&this._add(new z(s))}}else o.a.error("gameConfig does not exist");else o.a.error("layer manager does not exist")},ElementManager.prototype._add=function(t){var e=this.mElements.get(t.id);e||(e=new W(t,this)),this.mElements.set(e.id||0,e),this.roomService.blocks.add(e)},Object.defineProperty(ElementManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!0,configurable:!0}),Object.defineProperty(ElementManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!0,configurable:!0}),ElementManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,a=e.ids;if(i===n.op_def.NodeType.ElementNodeType)for(var r=0,s=a;r<s.length;r++){var o=s[r];this.removeFromMap(o)}},ElementManager.prototype.onMove=function(t){},ElementManager.prototype.onSetPosition=function(t){},ElementManager}(r.PacketHandler),X=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t.IDLE="idle",t.WALK="walk",t.RUN="run",t.ATTACK="attack",t.JUMP="jump",t.INJURED="injured",t.FAILED="failed",t.DANCE01="dance01",t.DANCE02="dance02",t.FISHING="fishing",t.GREET01="greet01",t.SIT="sit",t.LIE="lit",t.EMOTION01="emotion01"}(H||(H={}));var K,J=function(t){function Player(e,i){var a=t.call(this,e,i)||this;return a.mElementManager=i,a.nodeType=n.op_def.NodeType.CharacterNodeType,a}return X(Player,t),Player.prototype.move=function(e){this.getDirection()!==e.direction&&this.setDirection(e.direction),t.prototype.move.call(this,e)},Player.prototype.setDirection=function(t){t!==this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t,this.mDisplay.play(this.mCurState))},Player.prototype.changeState=function(t){this.mCurState!==t&&(t||(t="idle"),this.mCheckStateHandle(t)&&(this.mCurState=t,this.mDisplay.play(t)))},Player.prototype.removeDisplay=function(){t.prototype.removeDisplay.call(this)},Player.prototype.onMoveStart=function(){this.changeState(H.WALK)},Player.prototype.mCheckStateHandle=function(t){return!0},Player}(W),Z=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Q=function(t){function PlayerManager(e){var i=t.call(this)||this;return i.mRoom=e,i.mPlayerMap=new Map,i.connection&&i.connection.addPacketListener(i),i}return Z(PlayerManager,t),PlayerManager.prototype.init=function(){this.destroy(),this.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,this.onAdd),this.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,this.onRemove),this.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADJUST_POSITION,this.onAdjust),this.addHandlerFun(n.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_MOVE_CHARACTER,this.onMove),this.addHandlerFun(n.op_client.OPCODE._OP_GATEWAY_REQ_CLIENT_SET_CHARACTER_POSITION,this.onSetPosition),this.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,this.onShowBubble)},PlayerManager.prototype.destroy=function(){var t=this;this.mPlayerMap&&(this.mPlayerMap.forEach((function(e){return t.removeFromMap(e.id)})),this.mPlayerMap.clear())},PlayerManager.prototype.removeFromMap=function(t){var e=this.mPlayerMap.get(t);e&&(this.mPlayerMap.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))},PlayerManager.prototype.startActorMove=function(){this.mRoom.actor?this.mRoom.actor.startMove():o.a.error("MainHero miss")},PlayerManager.prototype.stopActorMove=function(){this.mRoom.actor?this.mRoom.actor.stopMove():o.a.error("MainHero miss")},PlayerManager.prototype.get=function(t){if(this.mPlayerMap){var e=this.mPlayerMap.get(t);if(!e){var i=this.roomService.actor;i&&i.id===t&&(e=i)}return e}},Object.defineProperty(PlayerManager.prototype,"camera",{get:function(){return this.mRoom.cameraService.camera},enumerable:!0,configurable:!0}),PlayerManager.prototype.onAdjust=function(t){var e=t.content,i=e.spritePositions;if(e.nodeType===n.op_def.NodeType.CharacterNodeType)for(var a,r,s=0,h=i;s<h.length;s++){var l=h[s];if(!(a=this.mPlayerMap.get(l.id))){if(l.id!==this.mRoom.actor.id)continue;a=this.mRoom.actor}r=l.point3f,a.setPosition(new D(0|r.x,0|r.y,0|r.z)),o.a.debug("adjust,x:"+r.x+",y:"+r.y)}},PlayerManager.prototype.onAdd=function(t){this.mPlayerMap||(this.mPlayerMap=new Map);var e=t.content,i=e.sprites;if(e.nodeType===n.op_def.NodeType.CharacterNodeType)for(var a=0,r=i;a<r.length;a++){var s=r[a];s.point3f,this._add(new z(s))}},PlayerManager.prototype._add=function(t){if(this.mPlayerMap||(this.mPlayerMap=new Map),!this.mPlayerMap.has(t.id)){var e=new J(t,this);this.mPlayerMap.set(e.id||0,e),this.roomService.blocks.add(e)}},PlayerManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,a=e.ids;if(i===n.op_def.NodeType.CharacterNodeType)for(var r=0,s=a;r<s.length;r++){var o=s[r];this.removeFromMap(o)}},PlayerManager.prototype.onMove=function(t){var e=t.content;if(e.moveData)for(var i=e.moveData,a=i.length,r=void 0,n=void 0,s=void 0,o=0;o<a;o++)n=(r=i[o]).moveObjectId,(s=this.get(n))&&s.move(r)},PlayerManager.prototype.onSetPosition=function(t){},PlayerManager.prototype.onShowBubble=function(t){var e=t.content,i=this.get(e.chatSenderid);i&&i.showBubble(e.chatContext,e.chatSetting)},Object.defineProperty(PlayerManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!0,configurable:!0}),Object.defineProperty(PlayerManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!0,configurable:!0}),Object.defineProperty(PlayerManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;o.a.error("room is undefined")},enumerable:!0,configurable:!0}),PlayerManager}(r.PacketHandler),q=function(){function LayerManager(t){this.room=t,this.mScene=t.scene,this.mGroundClickLayer=this.mScene.add.container(0,0),this.mGroundClickLayer.name="mGroundClickLayer",this.mUGroundLayer2=this.mScene.add.container(0,0),this.mUGroundLayer2.name="mUGroundLayer2",this.mGroundLayer=this.mScene.add.container(0,0),this.mGroundLayer.name="mGroundLayer",this.mSurfaceLayer=this.mScene.add.container(0,0),this.mSurfaceLayer.name="surfaceLayer",this.mAtmosphere=this.mScene.add.container(0,0),this.mAtmosphere.name="atmosphere",this.mSceneUILayer=this.mScene.add.container(0,0),this.mSceneUILayer.name="sceneUILayer",this.mUILayer=this.mScene.add.container(0,0).setScrollFactor(0),this.mUILayer.name="uiLayer"}return LayerManager.prototype.addToGround=function(t){var e=[].concat(t);this.mGroundLayer.add(e)},LayerManager.prototype.addToSurface=function(t){var e=[].concat(t);this.mSurfaceLayer.add(e)},LayerManager.prototype.addToSceneToUI=function(t){this.mSceneUILayer.add(t)},LayerManager.prototype.addToUI=function(t){this.mUILayer.add(t)},LayerManager.prototype.addToAtmosphere=function(t){this.mAtmosphere.add(t)},LayerManager.prototype.resize=function(t,e){},LayerManager.prototype.addMouseListen=function(){},LayerManager.prototype.sortSurface=function(){this.mSurfaceLayer.sort("depth")},LayerManager.prototype.changeScene=function(){this._clearLayer()},LayerManager.prototype.update=function(t,e){this.mDepthGround&&(this.mGroundLayer.sort("depth"),this.mDepthGround=!1),this.mDepthSurface&&(this.mDepthSurface=!1,this.mSurfaceLayer.sort("depth"),this.mSurfaceLayer.sort("depth",(function(t,e){t.sortRectangle,e.sortRectangle;return Math.atan2(t.sortY-e.sortY,t.sortX-e.sortX)*(180*Math.PI)>=70?1:-1})))},LayerManager.prototype.destroy=function(){this._clearLayer()},LayerManager.prototype._clearLayer=function(){this.clearLayer(this.mGroundClickLayer),this.clearLayer(this.mGroundLayer),this.clearLayer(this.mSurfaceLayer),this.clearLayer(this.mUGroundLayer2),this.clearLayer(this.mUILayer),this.clearLayer(this.mAtmosphere)},LayerManager.prototype.clearLayer=function(t,e){void 0===e&&(e=!1);var i=t.list;if(i)for(var a=i.length,r=void 0,n=0;n<a;n++)(r=i[n])&&r.destroy(e);t.destroy(e)},Object.defineProperty(LayerManager.prototype,"depthSurfaceDirty",{set:function(t){this.mDepthSurface=t},enumerable:!0,configurable:!0}),Object.defineProperty(LayerManager.prototype,"depthGroundDirty",{set:function(t){this.mDepthGround=t},enumerable:!0,configurable:!0}),LayerManager}(),$=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),tt=function(t){function TerrainDisplay(){return null!==t&&t.apply(this,arguments)||this}return $(TerrainDisplay,t),TerrainDisplay}(B),et=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),it=function(t){function Terrain(e,i){var a=t.call(this)||this;a.mElementManager=i,a.mId=e.id;var r=a.mElementManager.roomService.world.elementStorage.getObject(e.bindID||e.id);return r?(a.mDisplayInfo=r,a.createDisplay(),a.setPosition45(e.pos),a.mDisplay.changeAlpha(e.alpha),a):(o.a.error("object does not exist"),a)}return et(Terrain,t),Terrain.prototype.play=function(t){this.mAnimationName!==t&&(this.mAnimationName=t,this.mDisplay&&this.mDisplay.play(this.mAnimationName))},Terrain.prototype.setDirection=function(t){this.mDisplayInfo&&this.mDisplayInfo.avatarDir&&(this.mDisplayInfo.avatarDir=t)},Terrain.prototype.getDirection=function(){return this.mDisplayInfo&&this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},Terrain.prototype.setPosition=function(t){this.mDisplay&&this.mDisplay.setPosition(t.x,t.y,t.z),this.setDepth()},Terrain.prototype.getPosition=function(){return this.mDisplay?new D(this.mDisplay.x,this.mDisplay.y,this.mDisplay.z):new D(0,0,0)},Terrain.prototype.getPosition45=function(){var t=this.getPosition();if(t)return this.roomService.transformTo45(t)},Terrain.prototype.createDisplay=function(){if(this.mDisplayInfo){if(this.mDisplay)return this.mDisplay;var t=this.mElementManager.scene;return t&&(this.mDisplay=new tt(t)),this.mDisplay}o.a.error("displayinfo does not exist, Create display failed")},Terrain.prototype.addDisplay=function(){if(this.mDisplay)if(this.mDisplay.load(this.mDisplayInfo),this.mElementManager){var t=this.mElementManager.roomService;t?(t.addToGround(this.mDisplay),this.setDepth()):o.a.error("roomService does not exist")}else o.a.error("element manager does not exist");else o.a.error("display does not exist")},Terrain.prototype.setDepth=function(){if(this.mDisplay){if(this.mDisplay.setDepth(this.mDisplay.y),!this.roomService)throw new Error("roomService is undefined");var t=this.roomService.layerManager;if(!t)throw new Error("layerManager is undefined");t.depthGroundDirty=!0}},Terrain.prototype.setPosition45=function(t){if(this.roomService){var e=this.roomService.transformTo90(t);this.setPosition(e)}else o.a.error("roomService does not exist")},Object.defineProperty(Terrain.prototype,"id",{get:function(){return this.mId},enumerable:!0,configurable:!0}),Object.defineProperty(Terrain.prototype,"dir",{get:function(){return void 0!==this.mDisplayInfo.avatarDir?this.mDisplayInfo.avatarDir:3},enumerable:!0,configurable:!0}),Object.defineProperty(Terrain.prototype,"roomService",{get:function(){if(this.mElementManager)return this.mElementManager.roomService;o.a.error("element manager is undefined")},enumerable:!0,configurable:!0}),Terrain}(k),at=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),rt=function(t){function TerrainManager(e,i){var a=t.call(this)||this;return a.mRoom=e,a.mTerrains=new Map,a.mPacketFrameCount=0,a.mListener=i,a.connection&&(a.connection.addPacketListener(a),a.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_ADD_SPRITE,a.onAdd),a.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_REQ_CLIENT_DELETE_SPRITE,a.onRemove)),a.mRoom&&a.mRoom.world&&(a.mGameConfig=a.mRoom.world.elementStorage),a}return at(TerrainManager,t),TerrainManager.prototype.init=function(){this.destroy()},TerrainManager.prototype.destroy=function(){var t=this;this.mTerrains&&(this.mTerrains.forEach((function(e){return t.removeFromMap(e.id)})),this.mTerrains.clear())},TerrainManager.prototype.get=function(t){var e=this.mTerrains.get(t);if(e)return e},TerrainManager.prototype.removeFromMap=function(t){if(this.mTerrains){var e=this.mTerrains.get(t);e&&(this.mTerrains.delete(t),e.destroy(),this.roomService&&this.roomService.blocks.remove(e))}},TerrainManager.prototype.onAdd=function(t){if(this.mPacketFrameCount++,this.mGameConfig){var e=t.content,i=e.sprites,a=e.nodeType,r=e.packet;if(a===n.op_def.NodeType.TerrainNodeType){for(var s=0,h=i;s<h.length;s++){var l=h[s];l.point3f&&this._add(new z(l))}this.mListener&&this.mPacketFrameCount===r.totalFrame&&this.mListener.onFullPacketReceived(a)}}else o.a.error("gameconfig is undefined")},TerrainManager.prototype._add=function(t){var e=this.mTerrains.get(t.id);e||(e=new it(t,this)),this.mTerrains.set(e.id||0,e),this.roomService.blocks.add(e)},TerrainManager.prototype.onRemove=function(t){var e=t.content,i=e.nodeType,a=e.ids;if(i===n.op_def.NodeType.TerrainNodeType){for(var r=0,s=a;r<s.length;r++){var h=s[r];this.removeFromMap(h)}o.a.log("remove terrain length: ",a.length)}},Object.defineProperty(TerrainManager.prototype,"connection",{get:function(){if(this.mRoom)return this.mRoom.connection;o.a.error("room manager is undefined")},enumerable:!0,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"roomService",{get:function(){return this.mRoom},enumerable:!0,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"scene",{get:function(){if(this.mRoom)return this.mRoom.scene},enumerable:!0,configurable:!0}),Object.defineProperty(TerrainManager.prototype,"camera",{get:function(){return this.camera},enumerable:!0,configurable:!0}),TerrainManager}(r.PacketHandler),nt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),st=function(t){function Rectangle45(e,i,a,r){var n=t.call(this,e,i,a,r)||this;return n.row=e,n.col=i,n.endRow=a,n.endCol=r,n}return nt(Rectangle45,t),Rectangle45}(Phaser.Geom.Rectangle),ot=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ht=function(t){function CamerasManager(e){var i=t.call(this)||this;return i.mRoomService=e,i.MINI_VIEW_SIZE=38,i.VIEW_PORT_SIZE=40,i.viewPort=new Phaser.Geom.Rectangle,i.miniViewPort=new Phaser.Geom.Rectangle,i}return ot(CamerasManager,t),CamerasManager.prototype.getViewPort=function(){if(this.mCamera){var t=this.mCamera.worldView;return this.viewPort.x=t.x+(t.width-this.viewPort.width>>1),this.viewPort.y=t.y+(t.height-this.viewPort.height>>1),this.viewPort}},CamerasManager.prototype.getMiniViewPort=function(){if(this.mCamera){var t=this.mCamera.worldView;this.miniViewPort.x=t.x+(t.width-this.miniViewPort.width>>1),this.miniViewPort.y=t.y+(t.height-this.miniViewPort.height>>1);var e=this.mRoomService.transformTo45(new D(this.miniViewPort.x+(this.miniViewPort.width>>1),this.miniViewPort.y));return new st(e.x,e.y,this.MINI_VIEW_SIZE,this.MINI_VIEW_SIZE)}},Object.defineProperty(CamerasManager.prototype,"camera",{get:function(){return this.mCamera},set:function(t){this.mCamera=t,this.setViewPortSize()},enumerable:!0,configurable:!0}),CamerasManager.prototype.resize=function(t,e){this.resetCameraSize(t,e)},CamerasManager.prototype.startFollow=function(t){this.mCamera&&this.mCamera.startFollow(t)},CamerasManager.prototype.setBounds=function(t,e,i,a,r){this.mCamera?this.mCamera.setBounds(t,e,i,a,r):o.a.error("camera does not exist")},CamerasManager.prototype.resetCameraSize=function(t,e){if(this.connection){var i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_RESET_CAMERA_SIZE),a=i.content;a.width=t,a.height=e,this.connection.send(i)}else o.a.error("connection is undefined")},CamerasManager.prototype.setViewPortSize=function(){if(this.mCamera){var t=this.mRoomService.roomSize;if(t){var e=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileWidth/2),i=(this.VIEW_PORT_SIZE+this.VIEW_PORT_SIZE)*(t.tileHeight/2);this.viewPort.setSize(e,i);var a=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileWidth/2),r=(this.MINI_VIEW_SIZE+this.MINI_VIEW_SIZE)*(t.tileHeight/2);this.miniViewPort.setSize(a,r)}else o.a.error("room size does not exist")}else o.a.error("camera does not exist")},Object.defineProperty(CamerasManager.prototype,"connection",{get:function(){if(this.mRoomService)return this.mRoomService.connection;o.a.error("room service is undefined")},enumerable:!0,configurable:!0}),CamerasManager}(r.PacketHandler),lt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ct=function(t){function Actor(e,i){var a=t.call(this,e,i)||this;if(a.mElementManager=i,a.mRenderable=!0,a.addDisplay(),a.mRoom=a.mElementManager.roomService,a.mRoom.world.inputManager.addListener(a),a.mElementManager){var r=a.mElementManager.roomService;r&&r.cameraService&&r.cameraService.startFollow(a.mDisplay)}return a}return lt(Actor,t),Actor.prototype.setRenderable=function(t){},Actor.prototype.downHandler=function(t,e){this.mRoom.requestActorMove(t,e)},Actor.prototype.upHandler=function(){this.stopMove()},Actor.prototype.stopMove=function(){t.prototype.stopMove.call(this),delete this.mMoveData.destPos,this.mMoveData.arrivalTime=0,this.mMoveData.tweenAnim&&(this.mMoveData.tweenAnim.stop(),this.mMoveData.tweenAnim.remove());var e=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_STOP_SPRITE),i=e.content;i.nodeType=this.nodeType;var a=this.getPosition();i.spritePositions={id:this.id,point3f:{x:a.x,y:a.y,z:a.z},direction:this.dir},this.mElementManager.connection.send(e)},Actor.prototype.move=function(e){"walk"===this.mCurState&&t.prototype.move.call(this,e)},Actor.prototype.onMoveStart=function(){},Actor.prototype.onMoveComplete=function(){"walk"===this.mCurState?this._doMove():this.mMoveData.tweenAnim.stop()},Actor.prototype.onMoving=function(){"walk"===this.mCurState?t.prototype.onMoving.call(this):this.mMoveData.tweenAnim.stop()},Actor}(J),ut=function(){function Viewblock(t,e){this.mRect=t,this.mElements=[],this.mIndex=e}return Viewblock.prototype.add=function(t,e){this.mElements.push(t);var i=t.getPosition45();t.setRenderable(e.contains(i.x,i.y)&&this.mInCamera)},Viewblock.prototype.remove=function(t){var e=this.mElements.indexOf(t);return-1!==e&&(this.mElements.splice(e,1),!0)},Viewblock.prototype.check=function(t,e){if(t){var i=Phaser.Geom.Intersects.RectangleToRectangle(t,this.rectangle);if(e){if(this.mInCamera)for(var a=0,r=this.mElements;a<r.length;a++){var n=r[a],s=n.getPosition45();n.setRenderable(e.contains(s.x,s.y),1200)}this.mInCamera=i}}},Object.defineProperty(Viewblock.prototype,"rectangle",{get:function(){return this.mRect||void 0},enumerable:!0,configurable:!0}),Viewblock}(),dt=function(){function ViewblockManager(t){this.mBlocks=[],this.mCameras=t}return ViewblockManager.prototype.add=function(t){for(var e=this.mCameras.getMiniViewPort(),i=0,a=this.mBlocks;i<a.length;i++){var r=a[i],n=r.rectangle,s=t.getPosition();if(!s)return;if(n.contains(s.x,s.y))return void r.add(t,e)}},ViewblockManager.prototype.remove=function(t){if(t)for(var e=0,i=this.mBlocks;e<i.length;e++){if(i[e].remove(t))return}},ViewblockManager.prototype.int=function(t){if(t){this.mBlocks=[];for(var e=t.tileWidth/2*40,i=t.tileHeight/2*40,a=t.sceneWidth/e,r=t.sceneHeight/i,n=0,s=0;s<a;s++)for(var o=0;o<r;o++){var h=new ut(new Phaser.Geom.Rectangle(s*e,o*i,e,i),n++);this.mBlocks.push(h)}}},ViewblockManager.prototype.update=function(t,e){if(this.mCameras)for(var i=this.mCameras.getViewPort(),a=this.mCameras.getMiniViewPort(),r=0,n=this.mBlocks;r<n.length;r++){n[r].check(i,a)}},ViewblockManager.prototype.destroy=function(){},ViewblockManager}(),pt=function(){function ActorModel(t){this.mID=t.id,this.mPos=new D(t.x,t.y,t.z||0),t.avatar&&(this.mAvatar={id:t.avatar.id},this.mAvatar=Object.assign(this.mAvatar,t.avatar)),this.mDirection=t.avatarDir,this.mAlpha=1}return Object.defineProperty(ActorModel.prototype,"id",{get:function(){return this.mID},enumerable:!0,configurable:!0}),Object.defineProperty(ActorModel.prototype,"pos",{get:function(){return this.mPos},enumerable:!0,configurable:!0}),Object.defineProperty(ActorModel.prototype,"avatar",{get:function(){return this.mAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(ActorModel.prototype,"currentAnimationName",{get:function(){return this.mCurrentAnimationName},enumerable:!0,configurable:!0}),Object.defineProperty(ActorModel.prototype,"direction",{get:function(){return this.mDirection},enumerable:!0,configurable:!0}),Object.defineProperty(ActorModel.prototype,"bindID",{get:function(){return this.mBindID},enumerable:!0,configurable:!0}),Object.defineProperty(ActorModel.prototype,"alpha",{get:function(){return this.mAlpha},enumerable:!0,configurable:!0}),ActorModel}(),mt=function(){function Algorithm(){}return Algorithm.median=function(t){var e=t.sort((function(t,e){return e-t})),i=Math.floor(e.length/2);return e.length%2==0?(e[i-1]+e[i])/2:e[i]},Algorithm}(),ft=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),gt=function(t){function Clock(e,i){var a=t.call(this)||this;return a.mLatency=[],a.mConn=e,a.mConn.addPacketListener(a),a.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SYNC_TIME,a.proof),a.mListener=i,a._check(),a}return ft(Clock,t),Object.defineProperty(Clock.prototype,"sysUnixTime",{get:function(){return(new Date).getTime()},enumerable:!0,configurable:!0}),Object.defineProperty(Clock.prototype,"unixTime",{get:function(){return this.mTimestamp},set:function(t){this.mTimestamp=t},enumerable:!0,configurable:!0}),Clock.prototype.sync=function(t){if(void 0===t&&(t=1),this.mConn)for(var e=0;e<t;++e){var i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_TIME);i.content.clientStartTs=this.sysUnixTime,this.mConn.send(i)}},Clock.prototype.update=function(t,e){this.mTimestamp?this.mTimestamp+=e:this.mTimestamp=t},Clock.prototype.destroy=function(){this.mConn&&(this.mConn.removePacketListener(this),this.mConn=void 0),this.mIntervalId&&clearInterval(this.mIntervalId),this.mLatency=void 0},Clock.prototype._check=function(){var t=this;this.mIntervalId=setInterval((function(){t.sync()}),12e4)},Clock.prototype.proof=function(t){var e,i=t.content,a=this.sysUnixTime,r=i.clientStartTs,n=i.serverReceiveTs,s=i.serverSendTs,h=s-n,l=a-r-h,c=Math.round(l/2);if(!(c<0)){this.mLatency.push(c),this.mLatency.length>7&&this.mLatency.shift();var u=s-(e=mt.median(this.mLatency)+h),d=Math.abs(u-this.mTimestamp);d>100&&(this.mTimestamp=u),this.mListener&&this.mLatency.length>=2&&this.mListener.onClockReady(),o.a.debug("total_delay: "+l+" / latency: "+c+" | timeSychronDelta: "+e+" / remote_time: "+u+" / mistake: "+d)}},Clock}(r.PacketHandler),yt=i(15),_t=i(85),vt=function(){function Room(t){if(this.manager=t,this.mInit=!1,this.mWorld=this.manager.world,this.mClock=new gt(this.mWorld.connection,this),this.mTerainManager=new rt(this,this),this.mElementManager=new G(this),this.mPlayerManager=new Q(this),this.mCameraService=new ht(this),this.mBlocks=new dt(this.mCameraService),this.mWorld){var e=this.mWorld.getSize();if(!e)throw new Error("World::getSize undefined!");this.mCameraService.resize(e.width,e.height)}}return Room.prototype.enter=function(t){var e=this;if(t){if(this.mID=t.id,this.mTerainManager.init(),this.mElementManager.init(),this.mPlayerManager.init(),this.mSize={cols:t.rows,rows:t.cols,tileHeight:t.tileHeight,tileWidth:t.tileWidth,sceneWidth:(t.rows+t.cols)*(t.tileWidth/2),sceneHeight:(t.rows+t.cols)*(t.tileHeight/2)},this.mScene=this.mWorld.game.scene.getScene(P.name),this.mWorld.modelManager.getModel(_t.a.NAME).setMapInfo(t),this.mLayManager=new q(this),this.scene){this.mCameraService.camera=this.scene.cameras.main;this.mBlocks.int(this.mSize)}this.mWorld.game.scene.start(P.name,{room:this,callBack:function(){e.connection&&e.connection.send(new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SCENE_CREATED)),e.mActor=new ct(new pt(e.mActorData),e.mPlayerManager),e.mWorld.game.scene.getScene(g.name).sleep()}})}else o.a.error("wrong room")},Room.prototype.onFullPacketReceived=function(t){t===n.op_def.NodeType.TerrainNodeType&&this.mClock.sync(3)},Room.prototype.onClockReady=function(){o.a.debug("onClockReady"),this.mWorld.game.scene.stop(g.name)},Room.prototype.pause=function(){this.mScene.scene.pause()},Room.prototype.resume=function(t){this.mScene.scene.resume(t),this.mClock.sync()},Room.prototype.requestActorMove=function(t,e){this.mActor.setDirection(t),this.playerManager.startActorMove();var i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN);i.content.keyCodes=e,this.connection.send(i)},Room.prototype.addActor=function(t){this.mActorData=t,this.mWorld.modelManager.getModel(yt.a.NAME).setmainPlayerInfo(t)},Room.prototype.addToGround=function(t){this.layerManager.addToGround(t)},Room.prototype.addToSurface=function(t){this.layerManager.addToSurface(t)},Room.prototype.addToSceneUI=function(t){this.layerManager.addToSceneToUI(t)},Room.prototype.addToUI=function(t){this.layerManager.addToUI(t)},Room.prototype.removeElement=function(t){t&&t.removeFromParent()},Room.prototype.resize=function(t,e){this.layerManager.resize(t,e),this.mCameraService.resize(t,e)},Room.prototype.transformTo90=function(t){if(this.mSize)return T.transformTo90(t,this.mSize);o.a.error("position object is undefined")},Room.prototype.transformTo45=function(t){if(this.mSize)return T.transformTo45(t,this.mSize);o.a.error("position object is undefined")},Room.prototype.addMouseListen=function(){this.layerManager.addMouseListen()},Room.prototype.update=function(t,e){this.mClock.update(t,e),this.mBlocks.update(t,e),this.layerManager&&this.layerManager.update(t,e)},Room.prototype.now=function(){return this.mClock.unixTime},Object.defineProperty(Room.prototype,"scene",{get:function(){return this.mScene||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"terrainManager",{get:function(){return this.mTerainManager||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"elementManager",{get:function(){return this.mElementManager||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"playerManager",{get:function(){return this.mPlayerManager||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"layerManager",{get:function(){return this.mLayManager||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"cameraService",{get:function(){return this.mCameraService||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"id",{get:function(){return this.mID},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"roomSize",{get:function(){return this.mSize||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"blocks",{get:function(){return this.mBlocks},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"actor",{get:function(){return this.mActor},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"world",{get:function(){return this.mWorld},enumerable:!0,configurable:!0}),Object.defineProperty(Room.prototype,"connection",{get:function(){if(this.manager)return this.manager.connection},enumerable:!0,configurable:!0}),Room.prototype.clear=function(){this.mPlayerManager.destroy(),this.mElementManager.destroy(),this.mTerainManager.destroy(),this.mBlocks.destroy()},Room.prototype.destroy=function(){this.clear(),this.mLayManager.destroy(),this.mClock.destroy(),this.mScene},Room}(),bt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Pt=function(t){function RoomManager(e){var i=t.call(this)||this;return i.mRooms=[],i.mWorld=e,i.connection&&(i.connection.addPacketListener(i),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ENTER_SCENE,i.onEnterScene)),i}return bt(RoomManager,t),RoomManager.prototype.getRoom=function(t){return this.mRooms.find((function(e){return e.id===t}))},RoomManager.prototype.onFocus=function(){this.mRooms.forEach((function(t){t&&t.resume(t.scene.scene.key)}))},RoomManager.prototype.onBlur=function(){this.mRooms.forEach((function(t){t&&t.pause()}))},RoomManager.prototype.pasuseRoom=function(t){var e=this.mRooms.findIndex((function(e,i){return t===e.id}));e>=0&&this.mRooms[e].pause()},RoomManager.prototype.resumeRoom=function(t){var e=this.mRooms.findIndex((function(e,i){return t===e.id}));if(e>=0){var i=this.mRooms[e];i.resume(i.scene.scene.key)}},RoomManager.prototype.stop=function(){this.mRooms.forEach((function(t){t&&t.destroy()}))},RoomManager.prototype.resize=function(t,e){this.mRooms.forEach((function(i){i&&i.resize(t,e)}))},RoomManager.prototype.destroy=function(){for(var t=0,e=this.mRooms;t<e.length;t++){e[t].destroy()}this.mRooms.length=0},RoomManager.prototype.hasRoom=function(t){return this.mRooms.findIndex((function(e,i){return t===e.id}))>=0},RoomManager.prototype.onEnterScene=function(t){this.destroy();var e,i=t.content;this.hasRoom(i.scene.id)?e=this.getRoom(i.scene.id):(e=new vt(this),this.mRooms.push(e)),e.addActor(i.actor),e.enter(i.scene),this.mWorld.changeRoom(e),this.mCurRoom=e},Object.defineProperty(RoomManager.prototype,"world",{get:function(){return this.mWorld},enumerable:!0,configurable:!0}),Object.defineProperty(RoomManager.prototype,"currentRoom",{get:function(){return this.mCurRoom},enumerable:!0,configurable:!0}),Object.defineProperty(RoomManager.prototype,"connection",{get:function(){if(this.mWorld)return this.mWorld.connection;o.a.error("world manager is undefined")},enumerable:!0,configurable:!0}),RoomManager}(r.PacketHandler),St=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),Dt=function(t){function KeyBoardManager(e,i){var a=t.call(this)||this;return a.worldService=e,a.mInitilized=!0,a.mKeyboardListeners=[],a.mKeyList=[],a.mKeyDownList=[],a.mKeyEvents=i,a.mTmpUpKeysStr="",a.mTmpDownKeyStr="",a.mKeyEventMap=new Map,a.mConnect=a.worldService.connection,a}return St(KeyBoardManager,t),KeyBoardManager.prototype.onRoomChanged=function(t,e){var i=this;if(this.mRoom=t,this.mScene=t.scene,this.mScene){for(var a,r,n=this.mKeyEvents.length,s=0;s<n;s++)(a=this.mKeyEvents[s]).keyCodes,r=a.tqEvent,this.mKeyEventMap.get(r)||this.mKeyEventMap.set(r,a);this.mKeyEvents.length=0,this.mKeyEvents=null,this.mKeyEventMap.forEach((function(t){if(t)for(var e=t.keyCodes,a=e.length,r=void 0,n=0;n<a;n++){r=e[n];var s=i.mScene.input.keyboard.addKey(r,!1);i.addKeyEvent(s,t.tqEvent)}}))}},KeyBoardManager.prototype.getKeyCodes=function(t){if(this.mKeyEventMap.has(t))return this.mKeyEventMap.get(t).keyCodes},KeyBoardManager.prototype.resize=function(t,e){},KeyBoardManager.prototype.addListener=function(t){this.mKeyboardListeners.push(t)},KeyBoardManager.prototype.removeListener=function(t){var e=this.mKeyboardListeners.indexOf(t);e>=0&&this.mKeyboardListeners.splice(e,1)},Object.defineProperty(KeyBoardManager.prototype,"enable",{get:function(){return void 0!==this.mScene&&this.mScene.input.keyboard.enabled},set:function(t){this.mScene&&(this.mScene.input.keyboard.enabled=t)},enumerable:!0,configurable:!0}),Object.defineProperty(KeyBoardManager.prototype,"keyList",{get:function(){return this.mKeyList},enumerable:!0,configurable:!0}),KeyBoardManager.prototype.getKeyDowns=function(){return this.mInitilized&&this.mKeyList?(this.mKeyDownList=this.mKeyList.filter((function(t){return t.isDown})),this.mKeyDownList.map((function(t){return t.keyCode}))):[]},KeyBoardManager.prototype.getKeyUps=function(){var t,e=[];if(!this.mInitilized)return e;if(!this.mKeyDownList)return[];for(var i=0;i<this.mKeyDownList.length;i++)(t=this.mKeyDownList[i])&&t.isUp&&(this.mKeyDownList.splice(i,1),e.push(t.keyCode),i--);return e},KeyBoardManager.prototype.destroy=function(){this.removeKeyEvents(),this.mKeyDownList&&(this.mKeyDownList.length=0,this.mKeyDownList=null),this.mTmpDownKeyStr=null,this.mTmpUpKeysStr=null,this.mScene=null,this.mConnect=null,this.mInitilized=!1},KeyBoardManager.prototype.concatArr=function(t,e){var i,a=t.length>e.length?e.length:t.length,r=t.length>e.length?t:e,n=t.length>e.length?e:t;for(i=0;i<a;i++)r.push(n[i]);return r},KeyBoardManager.prototype.checkMoveKeyDown=function(t){for(var e,i,a=this.mKeyList,r=a.length,s=[],o=0,h=this.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_LEFT),l=this.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_DOWN),c=this.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_RIGHT),u=this.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_UP),d=0;d<r;d++)if(i=(e=a[d]).keyCode,e&&e.isDown){if(s.push(e.keyCode),h.indexOf(i)>-1){o+=-1;continue}if(c.indexOf(i)>-1){o+=1;continue}if(l.indexOf(i)>-1){o+=3;continue}if(u.indexOf(i)>-1){o+=-3;continue}}if(0===o)return!1;var p,m=t.getDirection();switch(o){case-1:p=m<=1?1:3;break;case-2:p=7;break;case-3:p=m<=3?1:7;break;case-4:p=1;break;case 1:p=m<=5?5:7;break;case 2:p=3;break;case 3:p=m<=3?3:5;break;case 4:p=5}return t.setDirection(p),t.downHandler(p,s),!0},KeyBoardManager.prototype.checkMoveKeyAllUp=function(){for(var t,e=this.mKeyList,i=e.length,a=0;a<i;a++)if((t=e[a])&&t.isDown)return!1;return!0},KeyBoardManager.prototype.addKeyEvent=function(t,e){t.on("down",this.keyDownHandle,this),t.on("up",this.keyUpHandle,this),this.mKeyList.push(t)},KeyBoardManager.prototype.keyDownHandle=function(t){var e=this,i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),a=i.content,s=this.getKeyDowns();this.mTmpDownKeyStr!==s.toString()&&(this.mTmpUpKeysStr="",this.mTmpDownKeyStr=s.toString(),a.keyCodes=s,this.mConnect.send(i),this.mKeyboardListeners.forEach((function(t){e.checkMoveKeyDown(t)})))},KeyBoardManager.prototype.keyUpHandle=function(t){var e=this,i=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_UP),a=i.content,s=this.getKeyUps();this.mTmpUpKeysStr===s.toString()||s.length<1||(this.mTmpDownKeyStr="",this.mTmpUpKeysStr=s.toString(),a.keyCodes=s,this.mConnect.send(i),this.mKeyboardListeners.forEach((function(t){e.checkMoveKeyAllUp()&&t.upHandler()})))},KeyBoardManager.prototype.removeKeyEvents=function(){if(this.mScene){for(var t,e=this.mKeyList.length,i=0;i<e;i++)(t=this.mKeyList[i])&&(t.off("down",this.keyDownHandle),t.off("up",this.keyUpHandle),this.mScene.input.keyboard.removeKey(t.keyCode));this.mKeyList.length=0,this.mKeyList=null}},KeyBoardManager}(r.PacketHandler),Tt=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}();!function(t){t[t.RightMouseDown=1]="RightMouseDown",t[t.RightMouseUp=2]="RightMouseUp",t[t.LeftMouseDown=3]="LeftMouseDown",t[t.LeftMouseUp=4]="LeftMouseUp",t[t.WheelDown=5]="WheelDown",t[t.WheelUp=6]="WheelUp",t[t.RightMouseHolding=7]="RightMouseHolding",t[t.LeftMouseHolding=8]="LeftMouseHolding"}(K||(K={}));var xt=function(t){function MouseManager(e){var i=t.call(this)||this;return i.worldService=e,i.running=!1,i.mGame=e.game,i.mConnect=i.worldService.connection,i}return Tt(MouseManager,t),MouseManager.prototype.changeRoom=function(t){if(this.pause(),this.mScene=t.scene,this.mScene){this.mActivePointer=this.mScene.input.activePointer;try{t.addMouseListen()}catch(t){}t.scene.input.on("gameobjectdown",this.groundDown,this),t.scene.input.on("gameobjectup",this.groundUp,this),this.resume()}},MouseManager.prototype.resize=function(t,e){},MouseManager.prototype.pause=function(){this.running=!1},MouseManager.prototype.resume=function(){this.running=!0},MouseManager.prototype.onUpdate=function(t,e){if(!1!==this.running&&void 0!==this.mActivePointer){var i=[];if(this.mActivePointer.leftButtonDown()?i.push(K.LeftMouseDown):this.mActivePointer.leftButtonReleased()&&i.push(K.LeftMouseUp),this.mActivePointer.middleButtonDown()?i.push(K.WheelDown):this.mActivePointer.middleButtonReleased()&&i.push(K.WheelUp),this.mActivePointer.rightButtonDown()?i.push(K.RightMouseDown):this.mActivePointer.rightButtonReleased()&&i.push(K.RightMouseUp),0!==i.length){var a=0;e.parentContainer&&(a=e.parentContainer.getData("id"));var s=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_MOUSE_EVENT),o=s.content;o.id=a,o.mouseEvent=i,o.point3f={x:t.x,y:t.y},this.mConnect.send(s)}}},Object.defineProperty(MouseManager.prototype,"enable",{get:function(){return!!this.mScene&&this.mScene.input.mouse.enabled},set:function(t){this.mScene&&(this.mScene.input.mouse.enabled=t)},enumerable:!0,configurable:!0}),MouseManager.prototype.destroy=function(){this.mActivePointer=null,this.mScene=null,this.mConnect=null,this.mGroundLayer=null,this.running=!1},MouseManager.prototype.groundDown=function(t,e){this.mActivePointer=t,this.onUpdate(t,e)},MouseManager.prototype.groundUp=function(t,e){this.mActivePointer=t,this.onUpdate(t,e)},MouseManager}(r.PacketHandler),Ct=function(){function JoyStickManager(t,e){this.worldService=t,this.mJoyListeners=[],this.mScale=t.uiScale,this.mKeyEvents=e,this.mKeyEventMap=new Map,o.a.debug("JoyStickManager "+t.uiScale)}return JoyStickManager.prototype.onRoomChanged=function(t,e){},JoyStickManager.prototype.setScene=function(t){if(this.mScene=t,this.mScene){for(var e,i,a=this.mKeyEvents.length,r=0;r<a;r++)(e=this.mKeyEvents[r]).keyCodes,i=e.tqEvent,this.mKeyEventMap.get(i)||this.mKeyEventMap.set(i,e);this.mKeyEvents.length=0,this.mKeyEvents=null;this.worldService.getSize();this.mParentcon=this.mScene.add.container(0,0);this.mScale&&this.mScale;this.mJoyStick=new Ot(this.mScene,this.worldService,this.mParentcon,this.mJoyListeners,this.mScale)}},JoyStickManager.prototype.resize=function(){var t=this.worldService.getSize();this.mParentcon.x=150,this.mParentcon.y=t.height-150},JoyStickManager.prototype.addListener=function(t){this.mJoyListeners.push(t),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)},JoyStickManager.prototype.getKeyCodes=function(t){if(this.mKeyEventMap.has(t)){for(var e=this.mKeyEventMap.get(t).keyCodes.length,i=[],a=0;a<e;a++){var r=this.mKeyEventMap.get(t).keyCodes[a];i.push(r)}return i}},JoyStickManager.prototype.removeListener=function(t){var e=this.mJoyListeners.indexOf(t);e>=0&&this.mJoyListeners.splice(e,1),this.mJoyStick&&this.mJoyStick.changeListeners(this.mJoyListeners)},JoyStickManager.prototype.getKeyDowns=function(){return[]},JoyStickManager.prototype.getKeyUps=function(){return[]},JoyStickManager.prototype.downHandler=function(){},JoyStickManager.prototype.upHandler=function(){},Object.defineProperty(JoyStickManager.prototype,"enable",{get:function(){return!0},set:function(t){},enumerable:!0,configurable:!0}),JoyStickManager}(),Ot=function(){function JoyStick(t,e,i,a,r){this.mScene=t,this.mWorld=e,this.parentCon=i,this.mJoyListeners=a,this.mScale=r,this.mKeyCodes=[],this.load()}return JoyStick.prototype.load=function(){this.mScene.load.atlas("joystick","./resources/ui/joystick/joystick.png","./resources/ui/joystick/joystick.json"),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start()},JoyStick.prototype.changeListeners=function(t){this.mJoyListeners=t},JoyStick.prototype.resize=function(){var t=this.mWorld.getSize();this.mbtnCon&&(this.mbtnCon.x=t.width-120*this.mScale,this.mbtnCon.y=t.height-120*this.mScale),this.mjoystickCon&&(this.mjoystickCon.x=260*this.mScale,this.mjoystickCon.y=t.height-260*this.mScale)},JoyStick.prototype.onLoadCompleteHandler=function(){var t=this.mWorld.getSize();this.bg=this.mScene.make.sprite(void 0,!1),this.bg.setTexture("joystick","joystick_bg"),this.bgRadius=this.bg.width-70>>1,this.btn=this.mScene.make.sprite(void 0,!1),this.btn.setTexture("joystick","joystick_tab"),this.btn.x=this.bg.x,this.btn.y=this.bg.y,this.mjoystickCon=this.mScene.make.container(void 0,!1),this.mjoystickCon.alpha=.5,this.mjoystickCon.addAt(this.bg,0),this.mjoystickCon.addAt(this.btn,1),this.parentCon.add(this.mjoystickCon),this.btn.setInteractive(),this.mScene.input.setDraggable(this.btn),this.btn.on("drag",this.dragUpdate,this),this.btn.on("dragend",this.dragStop,this),this.mbtnCon=this.mScene.make.container(void 0,!1),this.mbtn0=this.mScene.add.sprite(0,0,"joystick","btn"),this.mbtnCon.add(this.mbtn0),this.mbtn0.setInteractive(),this.mjoystickCon.scaleX=this.mjoystickCon.scaleY=this.mScale,this.mbtnCon.scaleX=this.mbtnCon.scaleY=this.mScale,this.parentCon.add(this.mbtnCon),this.parentCon.setSize(t.width,t.height),this.mbtn0.on("pointerup",this.uiUp,this),this.resize()},JoyStick.prototype.uiUp=function(t,e){this.mScene.tweens.add({targets:this.mbtn0,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),this.mbtn0.scaleX=this.mbtn0.scaleY=1},JoyStick.prototype.dragUpdate=function(t,e,i){var a=this,r=Math.sqrt(e*e+i*i);r>this.bgRadius&&(r=this.bgRadius);var n=Math.atan2(i,e);this.btn.x=Math.cos(n)*r+this.bg.x,this.btn.y=Math.sin(n)*r+this.bg.y,this.mJoyListeners.forEach((function(t){a.checkdragDown(t,n)}))},JoyStick.prototype.dragStop=function(t){var e=this;this.btn.x=this.bg.x,this.btn.y=this.bg.y,o.a.log("dragEnd"),this.mJoyListeners.forEach((function(t){e.checkdragUp()&&t.upHandler()}))},JoyStick.prototype.checkdragDown=function(t,e){var i,a=[];return e<=0&&e>-Math.PI/2?i=0!==e?E.right_up:E.right:e<=-Math.PI/2&&e>-Math.PI?i=e!==-Math.PI/2?E.up_left:E.up:e>Math.PI/2&&e<=Math.PI?i=e!==Math.PI?E.left_down:E.left:e>0&&e<=Math.PI/2&&(i=e!==Math.PI/2?E.down_right:E.down),a=this.getKeys(i),this.mdownStr!==a.toString()&&(this.mdownStr=a.toString(),t.downHandler(i,a),!0)},JoyStick.prototype.getKeys=function(t){var e=this.mKeyCodes[t];if(e)return e;switch(t){case 0:e=this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_UP);break;case 1:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_UP).concat,this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_LEFT));break;case 2:e=this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_LEFT);break;case 3:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_DOWN),this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_LEFT));break;case 4:e=this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_DOWN);break;case 5:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_DOWN),this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_RIGHT));break;case 6:e=this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_RIGHT);break;case 7:e=Array.prototype.concat.apply(this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_UP),this.mWorld.inputManager.getKeyCodes(n.op_def.TQ_EVENT.TQ_MOVE_RIGHT))}return this.mKeyCodes[t]=e,e},JoyStick.prototype.checkdragUp=function(){return this.mdownStr="",!0},JoyStick}(),Mt=i(94),wt=function(){function ElementStorage(){this.mModels=new Map,this.mElementRef=new Map}return ElementStorage.prototype.setGameConfig=function(t){if(t)for(var e=null,i=0,a=t.objectsList;i<a.length;i++){var r=a[i];if(r.type===n.op_def.NodeType.TerrainNodeType||r.type===n.op_def.NodeType.ElementNodeType){(e=this.mModels.get(r.sn))||(e=new Mt.a(r),this.mModels.set(r.sn,e));var s={id:r.id,displayModel:e};this.mElementRef.set(r.id,s)}}},ElementStorage.prototype.getObject=function(t){var e=this.mElementRef.get(t);if(e)return e.displayModel;o.a.error("can't find element "+t)},ElementStorage}();function load(t,e){return new Promise((function(i,a){var r=new XMLHttpRequest;r.onload=function(t){i(t.currentTarget)},r.onerror=function(){o.a.warn(t+" load error"),a(t+" load error")},r.open("GET",t),r.responseType=e||"",r.send()}))}var At=i(173),Et=i(57),Bt=i(13),Factory=function(t,e,i,a,r,n,s,o){var h=new Bt.a(this.scene,t,e,i,a,r,n,s,o);return this.scene.add.existing(h),h};const It=Phaser.GameObjects.BuildGameObject;var Creator=function(t,e){void 0!==e&&(t.add=e);var i=new Bt.a(this.scene,t);return It(this.scene,i,t),i},isInValidKey=function(t){return null==t||""===t||0===t.length},object_SetValue=function(t,e,i){if("object"==typeof t)if(isInValidKey(e)){if(null==i)return;"object"==typeof i&&(t=i)}else{"string"==typeof e&&(e=e.split("."));var a=e.pop();(function(t,e,i){void 0===i&&(i={});var a=t;if(isInValidKey(e));else{var r;"string"==typeof e&&(e=e.split("."));for(var n=0,s=e.length;n<s;n++){var o;if(null==a[r=e[n]]||"object"!=typeof a[r])o=n===s-1?i:{},a[r]=o;a=a[r]}}return a}(t,e))[a]=i}};class kt extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexNinePatch",Factory,Creator)}start(){this.game.events.once("destroy",this.destroy,this)}}object_SetValue(window,"RexPlugins.GameObjects.NinePatch",Bt.a);var Rt=kt,jt=i(31),inputtext_Factory=function(t,e,i,a,r){var n=new jt.a(this.scene,t,e,i,a,r);return this.scene.add.existing(n),n};const Lt=Phaser.Utils.Objects.GetAdvancedValue,Ft=Phaser.GameObjects.BuildGameObject;var inputtext_Creator=function(t,e){var i=Lt(t,"width",void 0),a=Lt(t,"height",void 0);void 0!==e&&(t.add=e);var r=new jt.a(this.scene,0,0,i,a,t);return Ft(this.scene,r,t),r};class Nt extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexInputText",inputtext_Factory,inputtext_Creator)}start(){this.game.events.once("destroy",this.destroy,this)}}object_SetValue(window,"RexPlugins.GameObjects.InputText",jt.a);var Ut=Nt,Vt=i(41),bbocdetext_Factory=function(t,e,i,a){var r=new Vt.a(this.scene,t,e,i,a);return this.scene.add.existing(r),r};const Ht=Phaser.Utils.Objects.GetAdvancedValue,Wt=Phaser.GameObjects.BuildGameObject;var bbocdetext_Creator=function(t,e){var i=Ht(t,"text",""),a=Ht(t,"style",null),r=Ht(t,"padding",null);null!==r&&(a.padding=r),void 0!==e&&(t.add=e);var n=new Vt.a(this.scene,0,0,i,a);return Wt(this.scene,n,t),n.autoRound=Ht(t,"autoRound",!0),n.resolution=Ht(t,"resolution",1),n};class zt extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexBBCodeText",bbocdetext_Factory,bbocdetext_Creator)}start(){this.game.events.once("destroy",this.destroy,this)}}object_SetValue(window,"RexPlugins.GameObjects.BBCodeText",Vt.a);var Yt=zt,Gt=i(21),Xt=i(11);const Kt=Phaser.Utils.Objects.GetValue;class Jt{constructor(t,e){this.gameObject=t,this.scene=Object(Xt.a)(t),this.setEventEmitter(Kt(e,"eventEmitter",void 0)),t.setInteractive(Kt(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.pointer=void 0,this.lastClickTime=void 0,this.setEnable(Kt(t,"enable",!0)),this.setMode(Kt(t,"mode",1)),this.setClickInterval(Kt(t,"clickInterval",100)),this.setDragThreshold(Kt(t,"threshold",void 0)),this}boot(){this.gameObject.on("pointerdown",this.onPress,this),this.gameObject.on("pointerup",this.onRelease,this),this.gameObject.on("pointerout",this.onPointOut,this),this.gameObject.on("pointermove",this.onMove,this),this.gameObject.once("destroy",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointer=void 0,this.gameObject=void 0,this.scene=void 0}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.cancel(),this.enable=t,this.gameObject.input.enabled=t,this)}setMode(t){return"string"==typeof t&&(t=Zt[t]),this.mode=t,this}setClickInterval(t){return this.clickInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}onPress(t){void 0===this.pointer&&(this.pointer=t,0===this.mode&&this.click(t.downTime,t))}onRelease(t){this.pointer===t&&(1===this.mode&&this.click(t.upTime,t),this.pointer=void 0)}onPointOut(t){this.pointer===t&&this.cancel()}onMove(t){this.pointer===t&&void 0!==this.dragThreshold&&t.getDistance()>=this.dragThreshold&&this.cancel()}click(t,e){if(void 0===t)return this.emit("click",this,this.gameObject,e),this;this.pointer=void 0;var i=this.lastClickTime;return void 0!==i&&t-i<=this.clickInterval?this:(this.lastClickTime=t,this.emit("click",this,this.gameObject,e),this)}cancel(){return this.pointer=void 0,this}}Object.assign(Jt.prototype,Gt.a);const Zt={press:0,pointerdown:0,release:1,pointerup:1};var Qt=Jt,qt=Qt;class $t extends Phaser.Plugins.BasePlugin{constructor(t){super(t)}start(){this.game.events.once("destroy",this.destroy,this)}add(t,e){return new qt(t,e)}}var te=$t;class ee{constructor(t){this.scene=t}static register(t,e){ee.prototype[t]=e}}var ie=ee,ae=i(137).a;ie.register("roundRectangle",(function(t,e,i,a,r,n,s){var o=new ae(this.scene,t,e,i,a,r,n,s);return this.scene.add.existing(o),o})),object_SetValue(window,"RexPlugins.UI.RoundRectangle",ae);var re=Vt.a;ie.register("BBCodeText",(function(t,e,i,a){var r=new re(this.scene,t,e,i,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.BBCodeText",re);var ne=i(134),se=i(83),oe={plainText:null,prevProp:null},he=new se.a;var styleToProp=function(t){for(var e,i,a,r={},n=0,s=(t=t.split(";")).length;n<s;n++)if(i=(e=t[n].split(":"))[0],a=e[1],!isEmpty(i)&&!isEmpty(a)){switch(i){case"stroke":var o=a.split(" ");a={},(l=o.length)>=1&&(a.color=o[0]),l>=2&&(a.thinkness=parseInt(o[1].replace("px","")));break;case"shadow":var h=a.split(" ");a={},(l=h.length)>=1&&(a.color=h[0]),l>=2&&(a.offsetX=parseInt(h[1].replace("px",""))),l>=3&&(a.offsetY=parseInt(h[2].replace("px",""))),l>=4&&(a.blur=parseInt(h[3].replace("px","")));break;case"u":case"underline":var l,c=a.split(" ");a={},(l=c.length)>=1&&(a.color=c[0]),l>=2&&(a.thinkness=parseInt(c[1].replace("px",""))),l>=3&&(a.offset=parseInt(c[2].replace("px","")))}r[i]=a}return r},isEmpty=function(t){return 0===(t=t.replace(me,"")).length},le=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,ce=/<\s*class=/i,ue=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,de=/<\s*style=/i,pe=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,me=/^\s+|\s+$/,fe=class{constructor(t){void 0===t&&(t={}),this.tags=t}addTag(t,e){this.tags[t]=e}splitText(t,e){for(var i,a,r,n=[],s=0,o=t.length,h=o;i=le.exec(t);)a=i[0],s<(h=le.lastIndex-a.length)&&n.push(t.substring(s,h)),void 0===e?n.push(a):1===e&&(ce.test(a)?(r=a.match(ue),n.push(r[2])):de.test(a)&&(r=a.match(pe),n.push(r[2]))),s=le.lastIndex;return s<o&&n.push(t.substring(s,o)),n}tagTextToProp(t,e){var i,a;if(ce.test(t)){if(null!=(s=t.match(ue))){var r=s[1],n=this.tags;(a=n.hasOwnProperty(r)?n[r]:{})._class=r,i=s[2]}}else if(de.test(t)){var s;if(null!=(s=t.match(pe))){var o=s[1];(a=styleToProp(o))._style=o,i=s[2]}}null==i&&(i=t),null==a&&(a={});var h=oe;return h.plainText=i,h.prop=a,h}propToContextStyle(t,e){var i=he;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var a=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];i.fontFamily=a}else i.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var r=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof r&&(r=r.toString()+"px"),i.fontSize=r}else i.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var n=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];i.fontStyle=n}else i.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){e.hasOwnProperty("color")?e.color:e["font-color"];i.color=e.color}else i.color=t.color;if(e.hasOwnProperty("stroke")){var s=e.stroke;i.stroke=s.hasOwnProperty("color")?s.color:t.stroke,i.strokeThickness=s.hasOwnProperty("thinkness")?s.thinkness:t.strokeThickness}else i.stroke=t.stroke,i.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var o=e.shadow;i.shadowColor=o.hasOwnProperty("color")?o.color:t.shadowColor,i.shadowOffsetX=o.hasOwnProperty("offsetX")?o.offsetX:t.shadowOffsetX,i.shadowOffsetY=o.hasOwnProperty("offsetY")?o.offsetY:t.shadowOffsetY,i.shadowBlur=o.hasOwnProperty("blur")?o.blur:t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0}else i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=t.shadowStroke,i.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var h=e.hasOwnProperty("u")?e.u:e.underline;i.underlineColor=h.hasOwnProperty("color")?h.color:t.underlineColor,i.underlineThickness=h.hasOwnProperty("thinkness")?h.thinkness:t.underlineThickness,i.underlineOffset=h.hasOwnProperty("offset")?h.offset:t.underlineOffset}else i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset;return i}propToTagText(t,e,i){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='"+e._class+"'>"+t+"</class>":e.hasOwnProperty("_style")?"<style='"+e._style+"'>"+t+"</style>":void 0}destroy(){this.tags=void 0}isTextTag(t){var e=this.tags[t];return!!e&&null==e.img}};const ge=Phaser.Utils.Objects.GetValue;class ye extends ne.a{constructor(t,e,i,a,r){var n=ge(r,"tags",void 0),s=new fe(n);super(t,e,i,a,r,"rexTagText",s),this.parser=s}addTag(t,e){return this.parser.addTag(t,e),this.updateText(!0)}addTags(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}preDestroy(){super.preDestroy(),this.parser.destroy(),this.parser=void 0}}var _e=ye;ie.register("tagText",(function(t,e,i,a){var r=new _e(this.scene,t,e,i,a);return this.scene.add.existing(r),r})),object_SetValue(window,"RexPlugins.UI.TagText",_e);var ve=i(109);ie.register("container",(function(t,e,i,a,r){var n=new ve.a(this.scene,t,e,i,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.Container",ve.a);ve.a;const be=Phaser.Renderer.WebGL.Utils;var render_WebGLRenderer=function(t,e,i,a,r){if(e.dirty&&(e.updateTexture(),e.dirty=!1),0!==e.width&&0!==e.height){var n=e.frame,s=n.width,o=n.height,h=be.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,n.glTexture,s,o,e.x,e.y,s/e.resolution,o/e.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,s,o,h(e._tintTL,a.alpha*e._alphaTL),h(e._tintTR,a.alpha*e._alphaTR),h(e._tintBL,a.alpha*e._alphaBL),h(e._tintBR,a.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,a,r)}},render_CanvasRenderer=function(t,e,i,a,r){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,a,r)},Pe=i(19),Se=(Pe.a,Pe.a,{renderWebGL:render_WebGLRenderer,renderCanvas:render_CanvasRenderer});const De=Phaser.Display.Color;var Te={clear(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this},fill(t){return this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this},getPixel(t,e,i){void 0===i&&(i=new De);var a=this.context.getImageData(t,e,1,1);return i.setTo(a.data[0],a.data[1],a.data[2],a.data[3]),i},setPixel(t,e,i,a,r,n){if("number"!=typeof i){var s=i;i=s.red,a=s.green,r=s.blue,n=s.alpha}void 0===n&&(n=0!==i||0!==a||0!==r?255:0);var o=this.context.createImageData(1,1);return o.data[0]=i,o.data[1]=a,o.data[2]=r,o.data[3]=n,this.context.putImageData(o,t,e),this.dirty=!0,this}},xe={updateTexture(t,e){t&&(e?t.call(e,this.canvas,this.context):t(this.canvas,this.context)),this.canvas.width===this.frame.width&&this.canvas.height===this.frame.height||this.frame.setSize(this.canvas.width,this.canvas.height),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(this.canvas,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!1;var i=this.input;return i&&!i.customHitArea&&(i.hitArea.width=this.width,i.hitArea.height=this.height),this},generateTexture(t,e,i,a,r){var n,s=this.canvas,o=this.scene.sys,h=o.game.renderer;void 0===e&&(e=0),void 0===i&&(i=0),void 0===a?a=s.width:a*=this.resolution,void 0===r?r=s.height:r*=this.resolution;var l=(n=o.textures.exists(t)?o.textures.get(t):o.textures.createCanvas(t,a,r)).getSourceImage();l.width!==a&&(l.width=a),l.height!==r&&(l.height=r);var c=l.getContext("2d");return c.clearRect(0,0,a,r),c.drawImage(s,e,i,a,r),h.gl&&n&&h.canvasToTexture(l,n.source[0].glTexture,!0,0),this},loadTexture(t,e){var i=this.scene.textures.getFrame(t,e);return i?(this.width!==i.cutWidth||this.height!==i.cutHeight?this.resize(i.cutWidth,i.cutHeight):this.context.clearRect(0,0,i.cutWidth,i.cutHeight),this.context.drawImage(i.source.image,i.cutX,i.cutY,i.cutWidth,i.cutHeight,0,0,this.canvas.width,this.canvas.height),this.dirty=!0,this):this}};const Ce=Phaser.Display.Canvas.CanvasPool,Oe=Phaser.GameObjects.GameObject;class Me extends Oe{constructor(t,e,i,a,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=1),void 0===r&&(r=1),super(t,"rexCanvas"),this.renderer=t.sys.game.renderer,this.resolution=t.sys.game.config.resolution,this.canvas=Ce.create(this,this.resolution*a,this.resolution*r),this.context=this.canvas.getContext("2d"),this.dirty=!1,this.setPosition(e,i),this.setSize(a,r),this.setOrigin(.5,.5),this.initPipeline(),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),this.dirty=!0,t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}getCanvas(t){return t||(this.dirty=!0),this.canvas}needRedraw(){return this.dirty=!0,this}preDestroy(){Ce.remove(this.canvas)}resize(t,e){return this.width===t&&this.height===e?this:(this.setSize(t,e).updateDisplayOrigin(),t*=this.resolution,e*=this.resolution,t=Math.max(Math.ceil(t),1),e=Math.max(Math.ceil(e),1),this.canvas.width=t,this.canvas.height=e,this.dirty=!0,this)}}const we=Phaser.GameObjects.Components;Phaser.Class.mixin(Me,[we.Alpha,we.BlendMode,we.ComputedSize,we.Crop,we.Depth,we.Flip,we.GetBounds,we.Mask,we.Origin,we.Pipeline,we.ScrollFactor,we.Tint,we.Transform,we.Visible,Se,Te,xe]);var Ae=Me,FillConfig=function(t,e){void 0===e&&(e={}),void 0===e.options&&(e.options={});var i=e.options;i.responsive=!1,i.maintainAspectRatio=!1,i.hasOwnProperty("devicePixelRatio")||(i.devicePixelRatio=1);var a=!1;void 0===i.animation?i.animation={}:!1===i.animation&&(a=!0,i.animation={});var r=i.animation;a&&(r.duration=0);var n=r.onProgress;r.onProgress=function(e){n&&n(e),t.needRedraw()};var s=r.onComplete;return r.onComplete=function(e){s&&s(e),t.needRedraw()},e};class Ee extends Ae{constructor(t,e,i,a,r,n){super(t,e,i,a,r),this.type="rexChart",this.chart=void 0,void 0!==n&&this.setChart(n)}destroy(t){this.scene&&(this.chart&&(this.chart.destroy(),this.chart=void 0),super.destroy(t))}resize(t,e){if(t===this.width&&e===this.height)return this;if(super.resize(t,e),this.chart){var i=this.chart;i.height=this.canvas.height,i.width=this.canvas.width,i.aspectRatio=i.height?i.width/i.height:null,i.update()}return this}}var Be={setChart:function(t){if(!window.Chart){return console.error("Can not find chartjs! Load chartjs in preload stage.\nscene.load.script('chartjs', 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js');"),this}return this.chart&&this.chart.destroy(),this.chart=new Chart(this.context,FillConfig(this,t)),this},getChartDataset:function(t){if(void 0!==this.chart){if("string"!=typeof t)return this.chart.data.datasets[t];for(var e,i=this.chart.data.datasets,a=0,r=i.length;a<r;a++)if((e=i[a]).label===t)return e}},getChartData:function(t,e){var i=this.getChartDataset(t);if(void 0!==i){if("string"==typeof e)if(-1===(e=this.chart.data.labels.indexOf(e)))return;return i.data[e]}},setChartData:function(t,e,i){if(void 0===this.chart)return this;var a=this.getChartDataset(t);if("string"==typeof e&&-1===(e=this.chart.data.labels.indexOf(e)))return this;return a.data[e]=i,this},updateChart:function(){if(void 0===this.chart)return this;this.chart.update()}};Object.assign(Ee.prototype,Be);var Ie=Ee;ie.register("chart",(function(t,e,i,a,r){var n=new Ie(this.scene,t,e,i,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.Chart",Ie);var ApplyCircleMask=function(t,e){t.width===t.height&&(e=0);var i=Math.floor(t.width/2),a=Math.floor(t.height/2),r=t.getContext("2d");r.save(),r.globalCompositeOperation="destination-in",r.beginPath(),0===e?r.arc(i,a,Math.min(i,a),0,2*Math.PI):r.ellipse(i,a,i,a,0,0,2*Math.PI),r.fill(),r.restore()};const ke=Phaser.Utils.Objects.GetValue;const Re={circle:0,ellipse:1};var je=class extends Ae{constructor(t,e,i,a,r,n){super(t,e,i),this.type="rexCircleMaskImage";var s=ke(n,"maskType",0);this.setTexture(a,r,s)}setTexture(t,e,i){return void 0===i?i=0:"string"==typeof i&&(i=Re[i]),this._textureKey=t,this._frameName=e,this.loadTexture(t,e),null!==i&&ApplyCircleMask(this.canvas,i),this.dirty=!0,this}};ie.register("circleMaskImage",(function(t,e,i,a,r){var n=new je(this.scene,t,e,i,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.CircleMaskImage",je);var Le=Bt.a;ie.register("ninePatch",(function(t,e,i,a,r,n,s,o){var h=new Le(this.scene,t,e,i,a,r,n,s,o);return this.scene.add.existing(h),h})),object_SetValue(window,"RexPlugins.UI.NinePatch",Le);const Fe=Phaser.Utils.Objects.GetValue;const Ne={id:["id",void 0],width:["width",void 0],height:["height",void 0],autoPlay:["autoplay",!0],controls:["controls",!1],loop:["loop",!1],poster:["poster",void 0],preload:["preload",void 0],muted:["muted",!1],playsInline:["playsInline",!0],crossOrigin:["crossOrigin","anonymous"]},Ue={canplay:"canplay",canplaythrough:"canplaythrough",ended:"ended",error:"error",loadstart:"loadstart",playing:"playing",pause:"pause",stalled:"stalled"};var videobase_CreateVideoElement=function(t){var e,i,a=document.createElement("video");for(var r in Ne)e=Ne[r],void 0!==(i=Fe(t,r,e[1]))&&(a[e[0]]=i);var n=Fe(t,"eventEmitter",void 0);if(n)for(let t in Ue)a.addEventListener(Ue[t],function(){n.emit(t,this)}.bind(this));return a};const Ve=Phaser.Utils.Objects.IsPlainObject;const He=["webm","ogg","mp4","h264","vp9","hls"];var videobase_Load=function(t,e,i){if(Ve(e))for(var a,r=0,n=He.length;r<n;r++)if(i[(a=He[r])+"Video"]&&e.hasOwnProperty(a)){e=e[a];break}t.src=e,t.load()};const We=Phaser.Utils.Objects.GetValue,ze=Phaser.Math.Clamp;var videobase_VideoBase=function(t){return class extends t{createVideoElement(t){return this.video||(void 0===t&&(t={}),t.eventEmitter=this,this.video=videobase_CreateVideoElement(t),this.playbackTimeChangeEventEnable=We(t,"playbackTimeChangeEventEnable",!0)),this.video}preDestroy(){this.scene&&(this.video&&(this.video.pause(),this.video.removeAttribute("src"),this.video.load(),this.video=void 0),super.preDestroy&&super.preDestroy())}preUpdate(t,e){if(this.playbackTimeChangeEventEnable){var i=this.playbackTime;i!==this.prevT&&this.emit("playbacktimechange",this),this.prevT=i}super.preUpdate&&super.preUpdate(t,e)}get availableVideoTypes(){return this.scene.sys.game.device.video}load(t){return this.video&&videobase_Load(this.video,t,this.availableVideoTypes),this}play(){return this.video&&this.video.play(),this}get isPlaying(){if(this.video){var t=this.video;return!t.paused&&!t.ended&&t.currentTime>0}return!1}pause(){return this.video&&this.video.pause(),this}get isPaused(){return!!this.video&&this.video.paused}get playbackTime(){return this.video&&this.video.currentTime||0}set playbackTime(t){if(this.video)try{this.video.currentTime=t}catch(t){}}setPlaybackTime(t){return this.playbackTime=t,this}get duration(){return this.video&&this.video.duration||0}get t(){if(this.video){var t=this.duration;return 0===t?0:this.playbackTime/t}return 0}set t(t){this.video&&(this.playbackTime=this.duration*ze(t,0,1))}setT(t){return this.t=t,this}get hasEnded(){return!!this.video&&this.video.ended}get volume(){return this.video&&this.video.volume||0}set volume(t){this.video&&(this.video.volume=t)}setVolume(t){return this.volume=t,this}get muted(){return this.video&&this.video.muted||!1}set muted(t){this.video&&(this.video.muted=t)}setMute(t){return void 0===t&&(t=!0),this.muted=t,this}get loop(){return!!this.video&&this.video.loop}set loop(t){this.video&&(this.video.loop=t)}setLoop(t){return void 0===t&&(t=!0),this.loop=t,this}get readyState(){return this.video?this.video.readyState:void 0}}};const Ye=Phaser.GameObjects.DOMElement,Ge=Phaser.Utils.Objects.IsPlainObject,Xe=Phaser.Utils.Objects.GetValue;class Ke extends(videobase_VideoBase(Ye)){constructor(t,e,i,a,r,n){Ge(e)?(e=Xe(n=e,"x",0),i=Xe(n,"y",0),a=Xe(n,"width",void 0),r=Xe(n,"height",void 0)):Ge(a)&&(a=Xe(n=a,"width",void 0),r=Xe(n,"height",void 0)),void 0===n&&(n={});var s=t.scale.autoRound;void 0!==a&&(s&&(a=Math.floor(a)),n.width=a),void 0!==r&&(s&&(r=Math.floor(r)),n.height=r),super(t,e,i),this.type="rexVideo",this.setElement(this.createVideoElement(n)).load(Xe(n,"src",""))}resize(t,e){return this.width===t&&this.height===e?this:(this.node.width=t,this.node.height=e,this.updateSize(),this)}}var Je=Ke;ie.register("video",(function(t,e,i,a,r){var n=new Je(this.scene,t,e,i,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.Video",Je);var loader_LoadScript=function(t,e){for(var i=document.getElementsByTagName("script"),a=!1,r=0,n=i.length;r<n;r++)if(-1!=i[r].src.indexOf(t)){a=!0;break}if(!a){var s=document.createElement("script");s.type="text/javascript",s.src=t,e&&(s.onload=e),document.getElementsByTagName("head")[0].appendChild(s)}},Ze=!1,Qe=[],youtubeplayer_LoadAPI=function(t){Ze?t():(window.onYouTubeIframeAPIReady||(window.onYouTubeIframeAPIReady=function(){Ze=!0;for(var t=0,e=Qe.length;t<e;t++)Qe[t]();Qe=void 0},loader_LoadScript("https://www.youtube.com/iframe_api")),Qe.push(t))};const qe=Phaser.GameObjects.DOMElement,$e=Phaser.Utils.Objects.IsPlainObject,ti=Phaser.Utils.Objects.GetValue,ei=Phaser.Math.Clamp;var ii=class extends qe{constructor(t,e,i,a,r,n){$e(e)?(e=ti(n=e,"x",0),i=ti(n,"y",0),a=ti(n,"width",void 0),r=ti(n,"height",void 0)):$e(a)&&(a=ti(n=a,"width",void 0),r=ti(n,"height",void 0)),void 0===n&&(n={});var s=t.scale.autoRound;void 0!==a&&(s&&(a=Math.floor(a)),n.width=a+"px"),void 0!==r&&(s&&(r=Math.floor(r)),n.height=r+"px"),super(t,e,i),this.type="rexYoutubePlayer",this.youtubePlayer=void 0,this.videoState=void 0,this.videoId=ti(n,"videoId",""),this.loop=ti(n,"loop",!1),this.paddingCallbacks=[];var o="YT"+Date.now(),h=document.createElement("div");h.id=o,h.style.width=n.width,h.style.height=n.height,this.setElement(h);var l={autoplay:ti(n,"autoPlay",!0)?1:0,controls:ti(n,"controls",!0)?1:0,disablekb:ti(n,"keyboardControl",!0)?0:1,modestbranding:ti(n,"modestBranding",!1)?1:0},c=function(){var t=new YT.Player(o,{videoId:this.videoId,playerVars:l,events:{onStateChange:function(t){this.videoState=t.data,this.emit("statechange",this),this.emit(this.videoStateString,this),this.videoState===YT.PlayerState.ENDED&&this.loop&&this.youtubePlayer.playVideo()}.bind(this),onReady:function(e){this.youtubePlayer=t;for(var i=0,a=this.paddingCallbacks.length;i<a;i++)this.paddingCallbacks[i]();this.paddingCallbacks=void 0,this.emit("ready",this)}.bind(this),onError:function(t){this.lastError=t.data,this.emit("error",this,this.lastError)}.bind(this)}});this.setElement(document.getElementById(o))}.bind(this);youtubeplayer_LoadAPI(c)}_runCallback(t){void 0===this.youtubePlayer?this.paddingCallbacks.push(t):t()}get videoStateString(){if(void 0===this.videoState||!YT)return"";switch(this.videoState){case-1:return"unstarted";case YT.PlayerState.ENDED:return"ended";case YT.PlayerState.PLAYING:return"playing";case YT.PlayerState.PAUSED:return"pause";case YT.PlayerState.BUFFERING:return"buffering";case YT.PlayerState.CUED:return"cued"}}load(t,e){void 0===e&&(e=!0);var i=function(){this.youtubePlayer.loadVideoById(t),e?this.youtubePlayer.playVideo():this.youtubePlayer.pauseVideo()}.bind(this);return this._runCallback(i),this}play(){var t=function(){this.youtubePlayer.playVideo()}.bind(this);return this._runCallback(t),this}get isPlaying(){return 1===this.videoState}pause(){var t=function(){this.youtubePlayer.pauseVideo()}.bind(this);return this._runCallback(t),this}get isPaused(){return 2===this.videoState}get playbackTime(){return this.youtubePlayer?this.youtubePlayer.getCurrentTime():0}set playbackTime(t){var e=function(){this.youtubePlayer.seekTo(t)}.bind(this);this._runCallback(e)}setPlaybackTime(t){return this.playbackTime=t,this}get duration(){return this.youtubePlayer?this.youtubePlayer.getDuration():0}get t(){var t=this.duration;return 0===t?0:this.playbackTime/t}set t(t){var e=function(){t=ei(t,0,1),this.playbackTime=this.duration*ei(t,0,1)}.bind(this);this._runCallback(e)}setT(t){return this.t=t,this}get hasEnded(){return 0===this.videoState}get volume(){return this.youtubePlayer?this.youtubePlayer.getVolume()/100:0}set volume(t){var e=function(){this.youtubePlayer.setVolume(ei(100*t,0,100))}.bind(this);this._runCallback(e)}setVolume(t){return this.volume=t,this}get muted(){return!!this.youtubePlayer&&this.youtubePlayer.isMuted()}set muted(t){var e=function(){t?this.youtubePlayer.mute():this.youtubePlayer.unMute()}.bind(this);this._runCallback(e)}setMute(t){return void 0===t&&(t=!0),this.muted=t,this}setLoop(t){return void 0===t&&(t=!0),this.loop=t,this}resize(t,e){if(this.width===t&&this.height===e)return this;var i=this.node.style;return i.width=t+"px",i.height=e+"px",this.updateSize(),this}};ie.register("youtubePlayer",(function(t,e,i,a,r){var n=new ii(this.scene,t,e,i,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.YoutubePlayer",ii);var ai=i(14);ie.register("sizer",(function(t,e,i,a,r){var n=new ai.a(this.scene,t,e,i,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.Sizer",ai.a);ai.a;var ri=i(30),gridsizer_GetChildrenWidth=function(){if(this.rexSizer.hidden)return 0;for(var t,e,i,a,r,n=0,s=this.gridChildren,o=0;o<this.columnCount;o++){if(t=0,void 0===(r=this.columnProportions[o])||0===r){for(var h=0;h<this.rowCount;h++)(e=s[h*this.columnCount+o])&&(e.rexSizer.hidden||(a=e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width,a+=(i=e.rexSizer.padding).left+i.right,t=Math.max(t,a)));n+=t}this.columnWidth[o]=t}return n},gridsizer_GetChildrenHeight=function(){if(this.rexSizer.hidden)return 0;for(var t,e,i,a,r,n=0,s=this.gridChildren,o=0;o<this.rowCount;o++){if(t=0,void 0===(r=this.rowProportions[o])||0===r){for(var h=0;h<this.columnCount;h++)(e=s[o*this.columnCount+h])&&(e.rexSizer.hidden||(a=e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height,a+=(i=e.rexSizer.padding).top+i.bottom,t=Math.max(t,a)));n+=t}this.rowHeight[o]=t}return n},gridsizer_GetChildrenSizers=function(t){void 0===t&&(t=[]);for(var e,i=this.gridChildren,a=0,r=i.length;a<r;a++)(e=i[a])&&e.isRexSizer&&t.push(e);return t},gridsizer_GetExpandedChildWidth=function(t,e){var i,a=t.rexSizer;if(a.expand){var r=a.padding;i=e-r.left-r.right}return i},gridsizer_GetExpandedChildHeight=function(t,e){var i,a=t.rexSizer;if(a.expand){var r=a.padding;i=e-r.top-r.bottom}return i},ni=i(20),si=i(29);const oi=Phaser.Display.Align.In.QuickSet;var hi={getChildrenWidth:gridsizer_GetChildrenWidth,getChildrenHeight:gridsizer_GetChildrenHeight,getChildrenSizers:gridsizer_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;this.layoutInit(t);var a,r,n,s,o=this.totalColumnProportions,h=this.totalRowProportions;if(void 0===e)if(t&&o>0){var l=this.rexSizer.padding;e=t.width-l.left-l.right}else e=Math.max(this.childrenWidth,this.minWidth);if(void 0===i)if(t&&h>0){var l=this.rexSizer.padding;i=t.height-l.top-l.bottom}else i=Math.max(this.childrenHeight,this.minHeight);this.resize(e,i),a=o>0?(this.width-this.childrenWidth)/o:0,r=h>0?(this.height-this.childrenHeight)/h:0;for(var c,u,d,p,m,f,g,y,_,v,b=this.left,P=b,S=this.top,D=0;D<this.rowCount;D++){v=0===(y=this.rowProportions[D]||0)?this.rowHeight[D]:y*r,P=b;for(var T=0;T<this.columnCount;T++)_=0===(g=this.columnProportions[T]||0)?this.columnWidth[T]:g*a,(n=this.gridChildren[D*this.columnCount+T])&&!n.rexSizer.hidden?(m=gridsizer_GetExpandedChildWidth(n,_),f=gridsizer_GetExpandedChildHeight(n,v),n.isRexSizer?n.layout(this,m,f):Object(ni.a)(n,m,f),c=P+(l=(s=n.rexSizer).padding).left,d=_-l.left-l.right,u=S+l.top,p=v-l.top-l.bottom,si.a.setPosition(c,u).setSize(d,p),oi(n,si.a,s.align),this.resetChildPositionState(n),P+=_):P+=_;S+=v}return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0}},li=i(39),ci=i(65);const ui=Phaser.Utils.Objects.IsPlainObject,di=Phaser.Utils.Objects.GetValue,pi=Phaser.Utils.Array.Remove,mi=Phaser.Display.Align.CENTER;class fi extends ri.a{constructor(t,e,i,a,r,n,s,o,h){var l;ui(e)?(e=di(l=e,"x",0),i=di(l,"y",0),a=di(l,"width",void 0),r=di(l,"height",void 0),n=di(l,"column",0),s=di(l,"row",0),o=di(l,"columnProportions",void 0),h=di(l,"rowProportions",void 0)):ui(a)?(a=di(l=a,"width",void 0),r=di(l,"height",void 0),n=di(l,"column",0),s=di(l,"row",0),o=di(l,"columnProportions",void 0),h=di(l,"rowProportions",void 0)):ui(n)?(n=di(l=n,"column",0),s=di(l,"row",0),o=di(l,"columnProportions",void 0),h=di(l,"rowProportions",void 0)):ui(o)&&(o=di(l=o,"columnProportions",void 0),h=di(l,"rowProportions",void 0)),super(t,e,i,a,r,l),this.type="rexGridSizer",this.initialGrid(n,s,o,h)}destroy(t){this.scene&&(this.gridChildren.length=0,super.destroy(t))}setColumnProportion(t,e){return t>=this.columnProportions.length?this:(this.columnProportions[t]=e,this)}setRowProportion(t,e){return t>=this.rowProportions.length?this:(this.rowProportions[t]=e,this)}add(t,e,i,a,r,n){var s;(super.add(t),ui(e))&&(e=di(s=e,"column",0),i=di(s,"row",0),a=di(s,"align",mi),r=di(s,"padding",0),n=di(s,"expand",!1));return"string"==typeof a&&(a=ci.a[a]),void 0===a&&(a=mi),void 0===r&&(r=0),void 0===n&&(n=!0),(s=this.getSizerConfig(t)).parent=this,s.align=a,s.padding=Object(li.a)(r),s.expand=n,this.gridChildren[i*this.columnCount+e]=t,this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,pi(this.gridChildren,t),void 0!==this.backgroundChildren&&pi(this.backgroundChildren,t),super.remove(t),this)}get totalColumnProportions(){for(var t,e=0,i=0;i<this.columnCount;i++)(t=this.columnProportions[i])>0&&(e+=t);return e}get totalRowProportions(){for(var t,e=0,i=0;i<this.rowCount;i++)(t=this.rowProportions[i])>0&&(e+=t);return e}initialGrid(t,e,i,a){if(this.columnCount=t,this.rowCount=e,this.gridChildren=[],this.gridChildren.length=t*e,this.columnProportions=[],this.columnProportions.length=t,this.columnWidth=[],this.columnWidth.length=t,this.rowProportions=[],this.rowProportions.length=e,this.rowHeight=[],this.rowHeight.length=e,i)for(var r="number"==typeof i,n=0;n<t;n++)if(r)this.setColumnProportion(n,i);else{var s=i[n];s>0&&this.setColumnProportion(n,s)}if(a){var o="number"==typeof a;for(n=0;n<e;n++)if(o)this.setRowProportion(n,a);else{var h=a[n];h>0&&this.setRowProportion(n,h)}}return this}}Object.assign(fi.prototype,hi);var gi=fi;ie.register("gridSizer",(function(t,e,i,a,r,n,s,o){var h=new gi(this.scene,t,e,i,a,r,n,s,o);return this.scene.add.existing(h),h})),object_SetValue(window,"RexPlugins.UI.GridSizer",gi);var fixwidthsizer_GetChildrenWidth=function(){return this.rexSizer.hidden?0:(t=0===this.orientation?this.maxChildWidth:0,t=Math.max(t,this.minWidth));var t},fixwidthsizer_GetChildrenHeight=function(){return this.rexSizer.hidden?0:(t=0===this.orientation?0:this.maxChildHeight,t=Math.max(t,this.minHeight));var t},fixwidthsizer_GetChildrenSizers=function(t){void 0===t&&(t=[]);for(var e,i=this.sizerChildren,a=0,r=i.length;a<r;a++)"\n"!==(e=i[a])&&e.isRexSizer&&t.push(e);return t},fixwidthsizer_GetChildWidth=function(t){var e=t.rexSizer.padding;return t.width+e.left+e.right},fixwidthsizer_GetChildHeight=function(t){var e=t.rexSizer.padding;return t.height+e.top+e.bottom},RunChildrenWrap_GetChildWidth=function(t,e){return 0===e?fixwidthsizer_GetChildWidth(t):fixwidthsizer_GetChildHeight(t)},GeChildHeight=function(t,e){return 0===e?fixwidthsizer_GetChildHeight(t):fixwidthsizer_GetChildWidth(t)},fixwidthsizer_RunChildrenWrap=function(t){for(var e,i,a,r,n={lines:[],width:0,height:0},s=this.sizerChildren,o=0,h=n.lines,l=0,c=s.length;l<c;l++){if("\n"===(e=s[l]))e=void 0,i=0,r=!0;else{if(e.rexSizer.hidden)continue;e.isRexSizer&&e.layout(),r=o<(i=RunChildrenWrap_GetChildWidth(e,this.orientation))}if(r){if(a){var u=t-(o+this.itemSpacing);n.width=Math.max(n.width,u),n.height+=a.height+this.lineSpacing}a={children:[],remainder:0,height:0},h.push(a),o=t}o-=i+this.itemSpacing,a.remainder=o,e&&(a.children.push(e),a.height=Math.max(a.height,GeChildHeight(e,this.orientation)))}return a&&(n.height+=a.height),n};const yi=Phaser.Display.Align.In.QuickSet;var _i={getChildrenWidth:fixwidthsizer_GetChildrenWidth,getChildrenHeight:fixwidthsizer_GetChildrenHeight,getChildrenSizers:fixwidthsizer_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;if(this.layoutInit(t),void 0===e){var a=this.padding;e=Math.max(this.maxChildWidth+a.left+a.right,this.minWidth)}if(void 0===i){a=this.padding;i=Math.max(this.maxChildHeight+a.top+a.bottom,this.minHeight)}var r;a=this.padding;r=0===this.orientation?e-a.left-a.right:i-a.top-a.bottom;var n,s,o=fixwidthsizer_RunChildrenWrap.call(this,r);0===this.orientation?i=Math.max(i,o.height+a.top+a.bottom):e=Math.max(e,o.height+left+a.right),this.resize(e,i);var h,l,c,u,d,p,m,f,g=this.left,y=this.top,_=o.lines;0===this.orientation?(h=g,l=y+this.padding.top):(h=g+this.padding.left,l=y);for(var v=0,b=_.length;v<b;v++){for(var P=0,S=(f=(m=_[v]).children).length;P<S;P++)a=(s=(n=f[P]).rexSizer).padding,0===this.orientation?(c=h+a.left,c+=0===P?this.padding.left:this.itemSpacing,u=l+a.top,d=n.width,p=n.height,h=c+n.width+a.right):(c=h+a.left,u=l+a.top,u+=0===P?this.padding.top:this.itemSpacing,d=n.width,p=n.height,l=u+n.height+a.bottom),si.a.setPosition(c,u).setSize(d,p),yi(n,si.a,s.align),this.resetChildPositionState(n);0===this.orientation?(h=g,l+=m.height+this.lineSpacing):(h+=m.height+this.lineSpacing,l=y)}return this.layoutBackgrounds(),this}},vi=i(112),fixwidthsizer_GetMaxChildWidth=function(t){void 0===t&&(t=this.sizerChildren);for(var e,i=0,a=0,r=t.length;a<r;a++)"\n"!==(e=t[a])&&(i=Math.max(i,fixwidthsizer_GetChildWidth(e)));return i},fixwidthsizer_GetMaxChildHeight=function(t){void 0===t&&(t=this.sizerChildren);for(var e,i=0,a=0,r=t.length;a<r;a++)"\n"!==(e=t[a])&&(i=Math.max(i,fixwidthsizer_GetChildHeight(e)));return i};const bi=Phaser.Utils.Objects.IsPlainObject,Pi=Phaser.Utils.Objects.GetValue,Si=Phaser.Utils.Array.Remove,Di=Phaser.Display.Align.CENTER;class Ti extends ri.a{constructor(t,e,i,a,r,n,s){var o;bi(e)?(e=Pi(o=e,"x",0),i=Pi(o,"y",0),a=Pi(o,"width",void 0),r=Pi(o,"height",void 0)):bi(a)?(a=Pi(o=a,"width",void 0),r=Pi(o,"height",void 0)):bi(n)?o=n:bi(s)&&(o=s),void 0!==o&&(n=Pi(o,"orientation",0),s=Pi(o,"space",o)),void 0===n&&(n=0),void 0===s&&(s=0),super(t,e,i,a,r,o),this.type="rexFixWidthSizer",this.sizerChildren=[],this.setOrientation(n),this.setPadding(s),this.setItemSpacing(Pi(s,"item",0)),this.setLineSpacing(Pi(s,"line",0))}destroy(t){this.scene&&(this.sizerChildren.length=0,super.destroy(t))}setOrientation(t){return"string"==typeof t&&(t=vi.a[t]),this.orientation=t,this}setPadding(t){return this.padding=Object(li.a)(t,this.padding),this}setItemSpacing(t){return this.itemSpacing=t,this}setLineSpacing(t){return this.lineSpacing=t,this}add(t,e){if("\n"===t)return this.addNewLine(),this;super.add(t),void 0===e&&(e=0);var i=this.getSizerConfig(t);return i.parent=this,i.align=Di,i.padding=Object(li.a)(e),this.sizerChildren.push(t),this}addNewLine(){return this.sizerChildren.push("\n"),this}insert(t,e,i,a){return this.add(e,i,a),this.moveTo(e,t),this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,Si(this.sizerChildren,t),super.remove(t),this)}clear(t){for(var e,i=this.sizerChildren,a=0,r=i.length;a<r;a++)"\n"!==(e=i[a])&&(this.getSizerConfig(e).parent=void 0);return i.length=0,super.clear(t),this}get maxChildWidth(){return void 0===this._maxChildWidth&&(this._maxChildWidth=fixwidthsizer_GetMaxChildWidth.call(this)),this._maxChildWidth}get maxChildHeight(){return void 0===this._maxChildHeight&&(this._maxChildHeight=fixwidthsizer_GetMaxChildHeight.call(this)),this._maxChildHeight}}Object.assign(Ti.prototype,_i);var xi=Ti;ie.register("fixWidthSizer",(function(t,e,i,a,r,n){var s=new xi(this.scene,t,e,i,a,r,n);return this.scene.add.existing(s),s})),object_SetValue(window,"RexPlugins.UI.FixWidthSizer",xi);var Ci=i(40);const Oi=Phaser.Utils.Objects.GetValue;class Mi extends ai.a{constructor(t,e){super(t,e),this.type="rexLabel";var i=Oi(e,"background",void 0),a=Oi(e,"icon",void 0),r=Oi(e,"iconMask",void 0),n=Oi(e,"text",void 0),s=Oi(e,"action",void 0),o=Oi(e,"actionMask",void 0),h=Oi(e,"space.left",0),l=Oi(e,"space.right",0),c=Oi(e,"space.top",0),u=Oi(e,"space.bottom",0),d=Oi(e,"space.icon",0),p=Oi(e,"space.text",0);(i&&this.addBackground(i),a)&&(f=0===this.orientation?{left:h,right:n||s?d:l,top:c,bottom:u}:{left:h,right:l,top:c,bottom:n||s?d:u},this.add(a,0,"center",f),r&&(r=new Ci.a(a,1),a.setMask(r.createGeometryMask()),this.add(r,null)));if(n){var m,f,g,y=Oi(e,"expandTextWidth",!1),_=Oi(e,"expandTextHeight",!1);0===this.orientation?(m=y?1:0,f={left:a?0:h,right:s?p:l,top:c,bottom:u},g=_):(m=_?1:0,f={left:h,right:l,top:a?0:c,bottom:s?p:u},g=y),this.add(n,m,"center",f,g)}s&&(f=0===this.orientation?{left:a||n?0:h,right:l,top:c,bottom:u}:{left:h,right:l,top:a||n?0:c,bottom:u},this.add(s,0,"center",f),o&&(o=new Ci.a(s,1),a.setMask(o.createGeometryMask()),this.add(o,null)));this.addChildrenMap("background",i),this.addChildrenMap("icon",a),this.addChildrenMap("iconMask",r),this.addChildrenMap("text",n),this.addChildrenMap("action",s),this.addChildrenMap("actionMask",o)}get text(){var t=this.childrenMap.text;return void 0===t?"":t.text?t.text:t.getData("text")}set text(t){var e=this.childrenMap.text;void 0!==e&&(e.setText?e.setText(t):e.setData("text",t))}setText(t){return this.text=t,this}appendText(t){this.text+=t}layout(t,e,i){super.layout(t,e,i);var a=this.childrenMap.iconMask;a&&(a.setPosition(),this.resetChildPositionState(a));var r=this.childrenMap.actionMask;return r&&(r.setPosition(),this.resetChildPositionState(r)),this}resize(t,e){super.resize(t,e);var i=this.childrenMap.iconMask;i&&i.resize();var a=this.childrenMap.actionMask;return a&&a.resize(),this}}var wi=Mi;ie.register("label",(function(t){var e=new wi(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Label",wi);var utils_Space=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),t.add.zone(0,0,e,i)},ButtonSetInteractive=function(t,e){t._buttonBehavior=new Qt(t,e),t._buttonBehavior.on("click",(function(e,i,a){FireEvent.call(this,"button.click",t,a)}),this),t.on("pointerover",(function(e){FireEvent.call(this,"button.over",t,e)}),this).on("pointerout",(function(e){FireEvent.call(this,"button.out",t,e)}),this)},FireEvent=function(t,e,i){var a;if("number"==typeof e){if(a=e,!(e=this.childrenMap.buttons[a]))return}else if(-1===(a=this.childrenMap.buttons.indexOf(e)))return;void 0!==this.groupName?this.eventEmitter.emit(t,e,this.groupName,a,i):this.eventEmitter.emit(t,e,a,i)},Ai=i(64),Show=function(t){_hide(t,!1)},Hide=function(t){_hide(t,!0)},IsShown=function(t){return!!t&&!Object(Ai.a)(t).hidden},_hide=function(t,e){t&&(Object(Ai.a)(t).hidden=e,t.setVisible(!e))},Ei={getButton(t){var e;return"number"==typeof t?e=this.childrenMap.buttons[t]:(e=t,-1===this.childrenMap.buttons.indexOf(e)&&(e=void 0)),e},emitButtonClick(t){return FireEvent.call(this,"button.click",t),this},showButton(t){return Show(this.getButton(t)),this},hideButton(t){return Hide(this.getButton(t)),this},isButtonShown(t){return IsShown(this.getButton(t)),this},forEachButtton(t,e){for(var i=this.childrenMap.buttons,a=0,r=i.length;a<r;a++)e?t.call(e,i[a],a,i):t(i[a],a,i);return this}};const Bi=Phaser.Utils.Objects.GetValue;class Ii extends ai.a{constructor(t,e){void 0===e&&(e={}),super(t,e),this.type="rexButtons",this.eventEmitter=Bi(e,"eventEmitter",this),this.groupName=Bi(e,"groupName",void 0);var i=Bi(e,"background",void 0),a=Bi(e,"buttons",void 0);a&&0===a.length&&(a=void 0);var r=Bi(e,"space",0);if(i&&this.addBackground(i),a){var n,s,o=Bi(e,"align",void 0),h=Bi(e,"click",void 0);"right"!==o&&"bottom"!==o&&"center"!==o||this.add(utils_Space(t),1,"center",0,!1);for(var l=0,c=a.length;l<c;l++)n=a[l],s=0===this.orientation?{left:l>=1?r:0,right:0,top:0,bottom:0}:{left:0,right:0,top:l>=1?r:0,bottom:0},this.add(n,0,"center",s,!0),ButtonSetInteractive.call(this,n,h);"center"===o&&this.add(utils_Space(t),1,"center",0,!1)}this.addChildrenMap("background",i),this.addChildrenMap("buttons",a||[])}}Object.assign(Ii.prototype,Ei);var ki=Ii;ie.register("buttons",(function(t){var e=new ki(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Buttons",ki);var Ri={getChoice(t){return this.childrenMap.choicesSizer.getButton(t)},getAction(t){return this.childrenMap.actionsSizer.getButton(t)},emitChoiceClick(t){return this.childrenMap.choicesSizer.emitButtonClick(t),this},emitActionClick(t){return this.childrenMap.actionsSizer.emitButtonClick(t),this},showChoice(t){return this.childrenMap.choicesSizer.showButton(t),this},showAction(t){return this.childrenMap.actionsSizer.showButton(t),this},hideChoice(t){return this.childrenMap.choicesSizer.hideButton(t),this},hideAction(t){return this.childrenMap.actionsSizer.hideButton(t),this},forEachChoice(t,e){return this.childrenMap.choicesSizer.forEachButtton(t,e),this},forEachChoice(t,e){return this.childrenMap.choicesSizer.forEachButtton(t,e),this},forEachAction(t,e){return this.childrenMap.actionsSizer.forEachButtton(t,e),this}};const ji=Phaser.Utils.Objects.GetValue;class Li extends ai.a{constructor(t,e){void 0===e&&(e={}),e.orientation=1,super(t,e),this.type="rexDialog",this.eventEmitter=ji(e,"eventEmitter",this);var i=ji(e,"background",void 0),a=ji(e,"title",void 0),r=ji(e,"toolbar",void 0);r&&0===r.length&&(r=void 0);var n,s,o=ji(e,"content",void 0),h=ji(e,"description",void 0),l=ji(e,"choices",void 0);l&&0===l.length&&(l=void 0);var c=ji(e,"actions",void 0);c&&0===c.length&&(c=void 0);var u,d=ji(e,"click",void 0),p=ji(e,"space.left",0),m=ji(e,"space.right",0),f=ji(e,"space.top",0),g=ji(e,"space.bottom",0);if(i&&this.addBackground(i),a&&!r){var y=ji(e,"align.title","center"),_=ji(e,"space.title",0),v={left:p,right:m,top:f,bottom:o||h||l||c?_:g},b=ji(e,"expand.title",!0);this.add(a,0,y,v,b)}if(r&&(u=new ki(t,{groupName:"toolbar",buttons:r,orientation:0,space:ji(e,"space.toolbarItem",0),click:d,eventEmitter:this.eventEmitter})),r&&!a){_=ji(e,"space.title",0),v={left:p,right:m,top:f,bottom:o||h||l||c?_:g},b=ji(e,"expand.toolbar",!0);this.add(u,0,"center",v,b)}if(a&&r){var P=new ai.a(t,{orientation:0});y=ji(e,"align.title","left");(b=ji(e,"expand.title",!0))||"right"!==y&&"center"!==y||P.add(utils_Space(t),1,"center",0,!1);v={left:ji(e,"space.titleLeft",0),right:ji(e,"space.titleRight",0),top:0,bottom:0};P.add(a,b?1:0,"center",v,b),b||"left"!==y&&"center"!==y||P.add(utils_Space(t),1,"center",0,!1),P.add(u,0,"right",0,!1);_=ji(e,"space.title",0),v={left:p,right:m,top:f,bottom:o||h||l||c?_:g};this.add(P,0,"center",v,!0)}if(o){y=ji(e,"align.content","center");var S=ji(e,"space.content",0);v={left:p+ji(e,"space.contentLeft",0),right:m+ji(e,"space.contentRight",0),top:a||r?0:f,bottom:h||l||c?S:g},b=ji(e,"expand.content",!0);this.add(o,0,y,v,b)}if(h){y=ji(e,"align.description","center");var D=ji(e,"space.description",0);v={left:p+ji(e,"space.descriptionLeft",0),right:m+ji(e,"space.descriptionRight",0),top:a||r||o?0:f,bottom:l||c?D:g},b=ji(e,"expand.description",!0);this.add(h,0,y,v,b)}if(l){y=ji(e,"align.choices","center");n=new ki(t,{groupName:"choices",buttons:l,orientation:1,space:ji(e,"space.choice",0),click:d,eventEmitter:this.eventEmitter});var T=ji(e,"space.choices",0);v={left:p+ji(e,"space.choicesLeft",0),right:m+ji(e,"space.choicesRight",0),top:a||r||o||h?0:f,bottom:c?T:g},b=ji(e,"expand.choices",!0);this.add(n,0,y,v,b)}if(c){s=new ki(t,{groupName:"actions",buttons:c,orientation:0,space:ji(e,"space.action",0),align:ji(e,"align.actions","center"),click:d,eventEmitter:this.eventEmitter});v={left:p+ji(e,"space.actionsLeft",0),right:m+ji(e,"space.actionsRight",0),top:a||r||o||h||l?0:f,bottom:g},b=ji(e,"expand.actions",!0);this.add(s,0,"center",v,b)}this.addChildrenMap("background",i),this.addChildrenMap("title",a),this.addChildrenMap("toolbar",r),this.addChildrenMap("content",o),this.addChildrenMap("choices",l),this.addChildrenMap("actions",c),this.addChildrenMap("choicesSizer",n),this.addChildrenMap("actionsSizer",s)}}Object.assign(Li.prototype,Ri);var Fi=Li;ie.register("dialog",(function(t){var e=new Fi(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Dialog",Fi);var Ni={getButtonsSizer(t){return this.childrenMap[t+"ButtonsSizer"]},getButton(t,e){var i=this.getButtonsSizer(t);return i?i.getButton(e):void 0},emitButtonClick(t,e){var i=this.getButtonsSizer(t);return i?(i.emitButtonClick(e),this):this},emitLeftButtonClick(t){return this.childrenMap.leftButtonsSizer.emitButtonClick(t),this},emitRightButtonClick(t){return this.childrenMap.rightButtonsSizer.emitButtonClick(t),this},emitTopButtonClick(t){return this.childrenMap.topButtonsSizer.emitButtonClick(t),this},emitBottomButtonClick(t){return this.childrenMap.bottomButtonsSizer.emitButtonClick(t),this},getLeftButton(t){return this.childrenMap.leftButtonsSizer.getButton(t)},getRightButton(t){return this.childrenMap.rightButtonsSizer.getButton(t)},getTopButton(t){return this.childrenMap.topButtonsSizer.getButton(t)},getBottomButton(t){return this.childrenMap.bottomButtonsSizer.getButton(t)},showButton(t,e){return Show(this.getButton(t,e)),this},showLeftButton(t){return Show(this.getLeftButton(t)),this},showRightButton(t){return Show(this.getRightButton(t)),this},showTopButton(t){return Show(this.getTopButton(t)),this},showBottomButton(t){return Show(this.getBottomButton(t)),this},hideButton(t,e){return Hide(this.getButton(t,e)),this},hideLeftButton(t){return Hide(this.getLeftButton(t)),this},hideRightButton(t){return Hide(this.getRightButton(t)),this},hideTopButton(t){return Hide(this.getTopButton(t)),this},hideBottomButton(t){return Hide(this.getBottomButton(t)),this},forEachLeftButton(t,e){return this.childrenMap.leftButtonsSizer.forEachButtton(t,e),this},forEachRightButton(t,e){return this.childrenMap.rightButtonsSizer.forEachButtton(t,e),this},forEachTopButton(t,e){return this.childrenMap.topButtonsSizer.forEachButtton(t,e),this},forEachBottomButton(t,e){return this.childrenMap.bottomButtonsSizer.forEachButtton(t,e),this}};const Ui=Phaser.Utils.Objects.GetValue;class Vi extends gi{constructor(t,e){void 0===e&&(e={}),e.column=3,e.row=3,super(t,e),this.type="rexTabs",this.eventEmitter=Ui(e,"eventEmitter",this);var i,a=Ui(e,"background",void 0),r=Ui(e,"panel",void 0),n=Ui(e,"leftButtons",void 0);n&&0===n.length&&(n=void 0);var s,o=Ui(e,"rightButtons",void 0);o&&0===o.length&&(o=void 0);var h,l=Ui(e,"topButtons",void 0);l&&0===l.length&&(l=void 0);var c,u=Ui(e,"bottomButtons",void 0);u&&0===u.length&&(u=void 0);var d=Ui(e,"click",void 0),p=Ui(e,"space.left",0),m=Ui(e,"space.right",0),f=Ui(e,"space.top",0),g=Ui(e,"space.bottom",0),y=Ui(e,"space.leftButtonsOffset",0),_=Ui(e,"space.rightButtonsOffset",0),v=Ui(e,"space.topButtonsOffset",0),b=Ui(e,"space.bottomButtonsOffset",0),P=Ui(e,"space.leftButton",0),S=Ui(e,"space.rightButton",0),D=Ui(e,"space.topButton",0),T=Ui(e,"space.bottomButton",0);if(a&&this.addBackground(a),r){var x={left:n?0:p,right:o?0:m,top:l?0:f,bottom:u?0:g};this.add(r,1,1,"center",x,!0)}if(n){i=new ki(t,{groupName:"left",buttons:n,orientation:1,space:P,align:Ui(e,"align.leftButtons",void 0),click:d,eventEmitter:this.eventEmitter});x={left:p,top:y};this.add(i,0,1,"top",x,!1)}if(o){s=new ki(t,{groupName:"right",buttons:o,orientation:1,space:S,align:Ui(e,"align.rightButtons",void 0),click:d,eventEmitter:this.eventEmitter});x={right:m,top:_};this.add(s,2,1,"top",x,!1)}if(l){h=new ki(t,{groupName:"top",buttons:l,orientation:0,space:D,align:Ui(e,"align.topButtons",void 0),click:d,eventEmitter:this.eventEmitter});x={top:f,left:v};this.add(h,1,0,"left",x,!1)}if(u){c=new ki(t,{groupName:"bottom",buttons:u,orientation:0,space:T,align:Ui(e,"align.bottomButtons",void 0),click:d,eventEmitter:this.eventEmitter});x={bottom:g,left:b};this.add(c,1,2,"left",x,!1)}this.addChildrenMap("background",a),this.addChildrenMap("panel",r),this.addChildrenMap("leftButtons",n),this.addChildrenMap("rightButtons",o),this.addChildrenMap("topButtons",l),this.addChildrenMap("bottomButtons",u),this.addChildrenMap("leftButtonsSizer",i),this.addChildrenMap("rightButtonsSizer",s),this.addChildrenMap("topButtonsSizer",h),this.addChildrenMap("bottomButtonsSizer",c)}}Object.assign(Vi.prototype,Ni);var Hi=Vi;ie.register("tabs",(function(t){var e=new Hi(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Tabs",Hi);var Wi=i(81);ie.register("slider",(function(t){var e=new Wi.a(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Slider",Wi.a);Wi.a;var zi=i(82),Yi=i(47),Gi=i(133),Xi=i(66),Ki=i.n(Xi),Ji=i(69),Zi={enableData(){return void 0===this.data&&(this.data={}),this},getData(t,e){return this.enableData(),void 0===t?this.data:Ki()(this.data,t,e)},setData(t,e){return this.enableData(),this.data[t]=e,this},incData(t,e,i){return void 0===i&&(i=0),this.enableData(),this.setData(t,this.getData(t,i)+e),this},mulData(t,e,i){return void 0===i&&(i=0),this.enableData(),this.setData(t,this.getData(t,i)*e),this},clearData(){return this.data&&Object(Ji.a)(this.data),this}};class Qi{constructor(t,e){this.container=null,this.setParent(t),this._deltaHeight=0}setParent(t){this.parent=t,this.parentContainer=t.getParentContainer()}destroy(t){if(void 0===t&&(t=!1),!t){var e=this.parent;0!==this.deltaHeight&&e.nonZeroDeltaHeightCount--,this.destroyContainer()}this.data=void 0,this.container=null,this.parent=void 0,this.parentContainer=void 0}get table(){return this.parent}get scrollMode(){return this.parentContainer.scrollMode}get colIndx(){return this.parent.cellIndxeToColIndex(this.index)}get rowIndx(){return this.parent.cellIndxeToRowIndex(this.index)}getContainer(){return this.container}setContainer(t){return this.container&&this.container.destroy(),this.container=t,this.parentContainer.add(t),this}destroyContainer(){return this.container&&(this.container.destroy(),this.container=null),this}popContainer(){if(this.container){var t=this.container;return this.container=null,this.parentContainer.remove(t),t}return null}setXY(t,e){return this.container&&this.parentContainer.setChildLocalPosition(this.container,t,e),this}get deltaHeight(){return this._deltaHeight}set deltaHeight(t){null==t&&(t=0);var e=this.parent;0===this._deltaHeight&&0!==t?e.nonZeroDeltaHeightCount++:0!==this._deltaHeight&&0===t&&e.nonZeroDeltaHeightCount--,this._deltaHeight=t}setDeltaHeight(t){return this.deltaHeight=t,this}get height(){return 0===this.scrollMode?this.deltaHeight+this.parent.defaultCellHeight:this.parent.defaultCellWidth}set height(t){1!==this.scrollMode&&this.setDeltaHeight(t-this.parent.defaultCellHeight)}setHeight(t){return this.height=t,this}get width(){return 0===this.scrollMode?this.parent.defaultCellWidth:this.deltaHeight+this.parent.defaultCellHeight}set width(t){0!==this.scrollMode&&this.setDeltaHeight(t-this.parent.defaultCellHeight)}setWidth(t){return this.width=t,this}get scene(){return this.parentContainer.scene}}Object.assign(Qi.prototype,Zi);var qi=Qi,$i=i(42);const ta=Phaser.Utils.Objects.GetValue,ea=Phaser.Utils.Array.SpliceOne;var ia=new $i.a;var aa=class{constructor(t,e){this.parent=t,this.cells=[],this.resetFromJSON(e)}resetFromJSON(t){return this.colCount=void 0,this._nonZeroDeltaHeightCount=0,this.resetTotalRowsHeight(),this.setDefaultCellHeight(ta(t,"cellHeight",30)),this.setDefaultCellWidth(ta(t,"cellWidth",30)),this.initCells(ta(t,"cellsCount",0)),this.setColumnCount(ta(t,"columns",1)),this}destroy(t){for(var e=0,i=this.cells.length;e<i;e++)this.freeCell(this.cells[e],t);this.cells=void 0,this.parent=void 0}get nonZeroDeltaHeightCount(){return this._nonZeroDeltaHeightCount}set nonZeroDeltaHeightCount(t){this._nonZeroDeltaHeightCount!==t&&(this._nonZeroDeltaHeightCount=t,this.resetTotalRowsHeight())}get defaultCellHeightMode(){return 0===this.nonZeroDeltaHeightCount}setDefaultCellHeight(t){return this.defaultCellHeight=t,this}setDefaultCellWidth(t){return this.defaultCellWidth=t,this}initCells(t){var e=this.cells;e.length=t;for(var i=0;i<t;i++)e[i]=null;return this}insertNewCell(t,e){var i=this.cells;if(t===i.length){var a=t+e;i.legth=a;for(var r=t;r<a;r++)i[r]=null}else{var n=[];n.length=e;for(r=0;r<e;r++)n[r]=null;this.cells.splice(t,0,...n)}return this.resetTotalRowsHeight(),this}removeCell(t,e){for(var i=t+e,a=t;a<i;a++)this.freeCell(a);return i===this.cells.length?this.cells.length=t:(1===e?ea(this.cells,t):this.cells.splice(t,e),this.buildCellIndex(t)),this.resetTotalRowsHeight(),this}setColumnCount(t){return this.colCount=t,this.resetTotalRowsHeight(),this}get rowCount(){return Math.ceil(this.cells.length/this.colCount)}get cellsCount(){return this.cells.length}isValidCellIdx(t){return t>=0&&t<this.cells.length}heightToRowIndex(t,e){if(this.defaultCellHeightMode){var i=t/this.defaultCellHeight;return i=e?Math.ceil(i):Math.floor(i)}var a,r=this.rowCount,n=t;for(i=0;;){if(a=i>=0&&i<r,!((n-=this.getRowHeight(i))>0&&a)){if(0===n)return i;if(e){var s=i;(a=(i+=1)>=0&&i<r)||(i=s)}return i}i+=1}}widthToColIndex(t,e){var i=t/this.defaultCellWidth;return i=e?Math.ceil(i):Math.floor(i)}colRowToCellIndex(t,e){return t>=this.colCount?null:e*this.colCount+t}rowIndexToHeight(t,e){if(this.defaultCellHeightMode)return(e-t+1)*this.defaultCellHeight;for(var i=0,a=t;a<=e;a++)i+=this.getRowHeight(a);return i}colIndexToWidth(t,e){return(e-t+1)*this.defaultCellWidth}getRowHeight(t){var e=this.colCount;if(e<=1)return this.getCellHeight(this.colRowToCellIndex(0,t));for(var i,a=0,r=0;r<e;r++)a<(i=this.getCellHeight(this.colRowToCellIndex(r,t)))&&(a=i);return a}getColWidth(t){return this.defaultCellWidth}getCellHeight(t){if(!this.isValidCellIdx(t))return 0;var e;if(this.defaultCellHeightMode)e=this.defaultCellHeight;else{var i=this.getCell(t,!1),a=i?i.deltaHeight:0;e=this.defaultCellHeight+a}return e}resetTotalRowsHeight(){this._totalRowsHeight=null}get totalRowsHeight(){return null===this._totalRowsHeight&&(this._totalRowsHeight=this.rowIndexToHeight(0,this.rowCount-1)),this._totalRowsHeight}get totalColumnWidth(){return this.colCount*this.defaultCellWidth}cellIndxeToColIndex(t){return t%this.colCount}cellIndxeToRowIndex(t){return Math.floor(t/this.colCount)}getCell(t,e){if(!this.isValidCellIdx(t))return null;if(void 0===e&&(e=!0),null===this.cells[t]&&e){var i=this.newCell(t);this.cells[t]=i}return this.cells[t]}newCell(t){var e=ia.pop();return null===e?e=new qi(this):e.setParent(this),e.index=t,e}buildCellIndex(t){void 0===t&&(t=0);for(var e,i=this.cells,a=t,r=i.length;a<r;a++)(e=i[a])&&(e.index=a);return this}getParentContainer(){return this.parent}freeCell(t,e){return"number"==typeof t&&(t=this.cells[t]),t?(t.destroy(e),ia.push(t),this):this}},mask_MaskToGameObject=function(t){return t.hasOwnProperty("geometryMask")?t.geometryMask:t.bitmapMask};const ra=Phaser.Geom.Intersects.RectangleToRectangle,na=Phaser.Geom.Rectangle.Overlaps;var containsPoints=function(t,e){var i=0,a=e.top,r=e.bottom,n=e.left,s=e.right;return i+=t.contains(n,a)?1:0,i+=t.contains(n,r)?1:0,i+=t.contains(s,a)?1:0,i+=t.contains(s,r)?1:0},showAll=function(t,e){t.setVisible(!0).clearMask()},showSome=function(t,e){t.setVisible(!0).setMask(e)},showNone=function(t,e){t.setVisible(!1).clearMask()},containerlite_MaskChildren=function(t,e,i){if(e){void 0===i&&(i=t.getAllChildren());for(var a,r,n=t.getBounds(),s=mask_MaskToGameObject(e),o=0,h=i.length;o<h;o++)if(!(a=i[o]).hasOwnProperty("isRexContainerLite")&&a!==s){if(a.getBounds)switch(r=a.getBounds(r),containsPoints(n,r)){case 4:showAll(a,e);break;case 0:ra(n,r)||na(n,r)?showSome(a,e):showNone(a,e);break;default:showSome(a,e)}else showSome(a,e);t.resetChildVisibleState(a).updateChildVisible(a)}}};const sa=Gi.a,oa=Phaser.GameObjects.Components,ha=Phaser.Structs.Set,la=Phaser.Utils.Objects.GetValue,ca=Phaser.Math.Clamp;class ua extends sa{constructor(t,e,i,a,r,n){void 0===n&&(n={}),super(t,e,i,a,r),this.type="rexGridTable",this._tableOX=0,this._tableOY=0,this.visibleCells=new ha,this.preVisibleCells=new ha,this.visibleStartX=null,this.visibleEndX=null,this.visibleStartY=null,this.visibleEndY=null,this.lastVisibleCellIdx=null,this.execeedTopState=!1,this.execeedBottomState=!1,this.execeedLeftState=!1,this.execeedRightState=!1;var s=la(n,"reuseCellContainer",!1);this.cellContainersPool=s?t.add.group():void 0;var o=la(n,"cellVisibleCallback",null);if(null!==o){var h=la(n,"cellVisibleCallbackScope",void 0);this.on("cellvisible",o,h)}if(null!==(o=la(n,"cellInvisibleCallback",null))){h=la(n,"cellInvisibleCallbackScope",void 0);this.on("cellinvisible",o,h)}if(this.cellsMask=void 0,this.setCellsMask(la(n,"mask",!0)),this.setScrollMode(la(n,"scrollMode",0)),this.setClampMode(la(n,"clamplTableOXY",!0)),0===this.scrollMode){var l=la(n,"cellWidth",void 0);if(this.expandCellSize=void 0===l,void 0===l){var c=la(n,"columns",1);n.cellWidth=this.width/c}}else{l=la(n,"cellHeight",void 0);var u=la(n,"cellWidth",void 0);this.expandCellSize=void 0===l,n.cellWidth=l,n.cellHeight=u}this.table=new aa(this,n),this.updateTable()}destroy(t){this.scene&&(t||this.setCellsCount(0),this.table.destroy(t),this.table=void 0,this.cellContainersPool&&(this.cellContainersPool.destroy(!0),this.cellContainersPool=void 0),super.destroy(t))}setScrollMode(t){return"string"==typeof t&&(t=da[t.toLowerCase()]),this.scrollMode=t,this}setClampMode(t){return this.clampTableOXYMode=t,this}setCellsCount(t){var e=this.cellsCount;return e===t?this:(e>t?this.removeCell(t,e-t):this.insertNewCell(e,t-e),this)}setColumnCount(t){return this.table.colCount===t?this:(this.table.setColumnCount(t),this)}setGridSize(t,e){return this.setCellsCount(t*e),this.table.setColumnCount(t),this}insertNewCell(t,e){return"object"==typeof t&&(t=t.index),void 0===e&&(e=1),e<=0?this:(t=ca(t,0,this.cellsCount),this.table.insertNewCell(t,e),this)}removeCell(t,e){if("object"==typeof t&&(t=t.index),void 0===e&&(e=1),t<0&&(e+=t,t=0),e<=0)return this;if(t>this.cellsCount)return this;if(t<=this.lastVisibleCellIdx)for(var i,a=this.preVisibleCells,r=this.visibleCells,n=t,s=t+e;n<s;n++)(i=this.getCell(n,!1))&&(r.contains(i)&&(this.hideCell(i),r.delete(i)),a.delete(i));return this.table.removeCell(t,e),this}get tableOY(){return this._tableOY}get tableOX(){return this._tableOX}set tableOY(t){this.setTableOY(t).updateTable()}set tableOX(t){this.setTableOX(t).updateTable()}setTableOY(t){var e=this.table,i=this.topTableOY,a=this.bottomTableOY,r=this.tableOYExceedTop(t),n=this.tableOYExeceedBottom(t);this.clampTableOXYMode&&(e.rowCount<e.heightToRowIndex(this.instHeight,!0)?t=0:r?t=i:n&&(t=a));return this._tableOY!==t&&(this._tableOY=t),r&&(this.execeedTopState||this.emit("execeedtop",this,t,i)),this.execeedTopState=r,n&&(this.execeedBottomState||this.emit("execeedbottom",this,t,a)),this.execeedBottomState=n,this}setTableOX(t){var e=this.table,i=this.leftTableOX,a=this.rightTableOX,r=this.tableOXExeceedLeft(t),n=this.tableOXExeceedRight(t);this.clampTableOXYMode&&(e.colCount<e.widthToColIndex(this.instWidth,!0)?t=0:r?t=i:n&&(t=a));return this._tableOX!==t&&(this._tableOX=t),r&&(this.execeedLeftState||this.emit("execeedleft",this,t,i)),this.execeedLeftState=r,n&&(this.execeedRightState||this.emit("execeedright",this,t,a)),this.execeedRightState=n,this}setTableOXY(t,e){return this.setTableOY(e).setTableOX(t),this}addTableOY(t){return this.setTableOY(this.tableOY+t),this}addTableOX(t){return this.setTableOX(this.tableOX+t),this}addTableOXY(t,e){return this.addTableOY(e).addTableOX(t),this}setTableOYByPercentage(t){return this.setTableOY(-this.tableVisibleHeight*t),this}getTableOYPercentage(){var t=this.tableVisibleHeight;return 0===t?0:this.tableOY/-t}set t(t){this.setTableOYByPercentage(t).updateTable()}get t(){return this.getTableOYPercentage()}updateTable(t){return void 0===t&&(t=!1),t&&(this.clearVisibleCellIndexes(),this.hideCells()),this.clearVisibleCellIndexes(),this.showCells(),this.hideCells(),this.maskCells(),this}getCell(t){return this.table.getCell(t,!0)}getCellContainer(t){var e,i=this.table.getCell(t,!1);return i&&(e=i.getContainer()),e}get cellsCount(){return this.table.cellsCount}get columnCount(){return this.table.colCount}setCellHeight(t,e){return("number"==typeof t?this.table.getCell(t,!0):t).height=e,this}setCellWidth(t,e){return("number"==typeof t?this.table.getCell(t,!0):t).width=e,this}pointerToCellIndex(t,e){e-=this.y+this.topLeftY,t-=this.x+this.topLeftX;var i=this.tableOY-(0===this.scrollMode?e:t),a=this.tableOX-(0===this.scrollMode?t:e),r=this.table,n=r.heightToRowIndex(-i),s=r.widthToColIndex(-a),o=r.colRowToCellIndex(s,n);return null===o?null:this.cellIsVisible(o)?o:null}pointerToCellContainer(t,e){var i=this.pointerToCellIndex(t,e);if(null!==i)return this.getCellContainer(i)}cellIsVisible(t){var e=this.table.getCell(t,!1);return e&&this.visibleCells.contains(e)}eachVisibleCell(t,e){return this.visibleCells.each(t,e),this}iterateVisibleCell(t,e){return this.visibleCells.iterate(t,e),this}setCellsMask(t){var e,i;if(!0===t?(e=!0,i=0):!1===t?e=!1:(e=la(t,"mask",!0),i=la(t,"padding",0)),e){var a=new Ci.a(this,0,i);this.cellsMask=a.createGeometryMask(),this.add(a)}return this}maskCells(){for(var t,e=[],i=this.visibleCells.entries,a=0,r=i.length;a<r;a++)(t=i[a].getContainer())&&(t.isRexContainerLite?t.getAllChildren(e):e.push(t));containerlite_MaskChildren(this,this.cellsMask,e)}resize(t,e){return this.width===t&&this.height===e?this:(super.resize(t,e),this.cellsMask&&Object(ni.a)(mask_MaskToGameObject(this.cellsMask),t,e),this.expandCellSize&&this.table.setDefaultCellWidth(this.instWidth/this.table.colCount),this.updateTable(!0),this)}clearVisibleCellIndexes(){var t=this.preVisibleCells;this.preVisibleCells=this.visibleCells,this.visibleCells=t,this.visibleCells.clear()}showCells(){if(0!==this.cellsCount){var t=this.table,e=t.heightToRowIndex(-this.tableOY);e<0&&(e=0);var i=t.widthToColIndex(-this.tableOX);i<0&&(i=0);var a=t.colRowToCellIndex(i,e),r=this.bottomBound,n=this.rightBound,s=t.cellsCount-1,o=t.colCount-1,h=this.getTLX(i),l=h,c=this.getTLY(e);for(this.visibleStartY=null,this.visibleEndY=null,this.visibleStartX=null,this.visibleEndX=null,this.lastVisibleCellIdx=null;c<r&&a<=s;){if(this.table.isValidCellIdx(a)){null===this.visibleStartY&&(this.visibleStartY=e,this.visibleEndY=e),null===this.visibleStartX&&(this.visibleStartX=i,this.visibleEndX=i),null===this.lastVisibleCellIdx&&(this.lastVisibleCellIdx=a),this.visibleEndY<e&&(this.visibleEndY=e),this.visibleEndX<i&&(this.visibleEndX=i),this.lastVisibleCellIdx<a&&(this.lastVisibleCellIdx=a);var u=t.getCell(a,!0);this.visibleCells.set(u),this.preVisibleCells.contains(u)||this.showCell(u),0===this.scrollMode?u.setXY(l,c):u.setXY(c,l)}l<n&&i<o?(l+=t.getColWidth(i),i+=1):(l=h,c+=t.getRowHeight(e),i=this.visibleStartX,e+=1),a=t.colRowToCellIndex(i,e)}}}showCell(t){var e=null;if(this.cellContainersPool&&null!==(e=this.cellContainersPool.getFirstDead())&&e.setActive(!0).setVisible(!0),this.emit("cellvisible",t,e),this.cellContainersPool){var i=t.getContainer();i?null===e?this.cellContainersPool.add(i):e!==i&&(this.cellContainersPool.add(i),this.cellContainersPool.killAndHide(e)):null!==e&&this.cellContainersPool.killAndHide(e)}}hideCells(){var t=this.preVisibleCells,e=this.visibleCells;t.iterate((function(t){e.contains(t)||this.hideCell(t)}),this)}hideCell(t){if(this.emit("cellinvisible",t),this.cellContainersPool){var e=t.popContainer();e&&this.cellContainersPool.killAndHide(e)}t.destroyContainer()}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get tableHeight(){return this.table.totalRowsHeight}get tableWidth(){return this.table.totalColumnWidth}get topTableOY(){return 0}get bottomTableOY(){return-this.tableVisibleHeight}get leftTableOX(){return 0}get rightTableOX(){return-this.tableVisibleWidth}tableOYExceedTop(t){return void 0===t&&(t=this.tableOY),t>this.topTableOY}tableOYExeceedBottom(t){return void 0===t&&(t=this.tableOY),t<this.bottomTableOY}tableOXExeceedLeft(t){return void 0===t&&(t=this.tableOX),t>this.leftTableOX}tableOXExeceedRight(t){return void 0===t&&(t=this.tableOX),t<this.rightTableOX}get tableVisibleHeight(){var t=this.tableHeight,e=this.instHeight;return t>e?t-e:0}get tableVisibleWidth(){var t=this.tableWidth,e=this.instWidth;return t>e?t-e:0}get bottomLeftY(){return-this.displayHeight*this.originY+this.displayHeight}get topRightX(){return-this.displayWidth*this.originX+this.displayWidth}get topLeftX(){return-this.displayWidth*this.originX}get topLeftY(){return-this.displayHeight*this.originY}get bottomBound(){return 0===this.scrollMode?this.bottomLeftY:this.topRightX}get rightBound(){return 0===this.scrollMode?this.topRightX:this.bottomLeftY}getTLX(t){var e=0===this.scrollMode?this.topLeftX:this.topLeftY;return this.tableOX+this.table.colIndexToWidth(0,t-1)+e}getTLY(t){var e=0===this.scrollMode?this.topLeftY:this.topLeftX;return this.tableOY+this.table.rowIndexToHeight(0,t-1)+e}}Object.assign(ua.prototype,oa.GetBounds);const da={v:0,vertical:0,h:1,horizontal:1};var pa=ua,gridtable_InjectProperties=function(t){Object.defineProperty(t,"childOY",{configurable:!0,get:function(){return t.tableOY},set:function(e){t.tableOY=e}}),Object.defineProperty(t,"topChildOY",{get:function(){return t.topTableOY}}),Object.defineProperty(t,"bottomChildOY",{get:function(){return t.bottomTableOY}})},gridtable_TableOnCellVisible=function(t){t.on("cellvisible",(function(t,e){var i,a=this.createCellContainerCallback,r=this.createCellContainerCallbackScope;t.item=this.items[t.index],(i=r?a.call(r,t,e):a(t,e)).setOrigin&&i.setOrigin(0),i.isRexSizer&&i.layout(),t.item=void 0,t.setContainer(i)}),this)},input_EmitCellEvent=function(t,e,i,a,r){var n;if(null!=(n=void 0===r?a:i.pointerToCellIndex(a,r))){var s=i.getCellContainer(n);t.emit(e,s,n)}},input_ClickCell=function(t){t._click=new Qt(t,{threshold:10}),t._click.on("click",(function(t,e,i){input_EmitCellEvent(this.eventEmitter,"cell.click",e,i.x,i.y)}),this)},OnMove=function(t){if(!t.isDown){var e=this.childrenMap.child,i=e.pointerToCellIndex(t.x,t.y);if(i!==this._lastOverCellIndex){var a=this._lastOverCellIndex;this._lastOverCellIndex=i,input_EmitCellEvent(this.eventEmitter,"cell.out",e,a),input_EmitCellEvent(this.eventEmitter,"cell.over",e,i)}}},OnOut=function(){var t=this.childrenMap.child,e=this._lastOverCellIndex;this._lastOverCellIndex=void 0,input_EmitCellEvent(this.eventEmitter,"cell.out",t,e)},input_OverCell=function(t){t.on("pointermove",OnMove,this).on("pointerover",OnMove,this).on("pointerup",OnOut,this).on("pointerout",OnOut,this)};const ma=Phaser.Utils.Objects.GetValue;class fa{constructor(t,e){this.parent=t,this._isRunning=!1,this.tickingState=!1,this.setEventEmitter(ma(e,"eventEmitter",void 0)),this.setTickingMode(ma(e,"tickingMode",1))}boot(){2!==this.tickingMode||this.tickingState||this.startTicking()}shutdown(){this.destroyEventEmitter(),this.tickingState&&this.stopTicking()}setTickingMode(t){"string"==typeof t&&(t=ga[t]),this.tickingMode=t}startTicking(){this.tickingState=!0}stopTicking(){this.tickingState=!1}get isRunning(){return this._isRunning}set isRunning(t){this._isRunning!==t&&(this._isRunning=t,1===this.tickingMode&&t!=this.tickingState&&(t?this.startTicking():this.stopTicking()))}start(){return this.isRunning=!0,this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this}complete(){this.isRunning=!1,this.emit("complete",this.parent,this)}}Object.assign(fa.prototype,Gt.a);const ga={no:0,lazy:1,always:2};var ya=fa;const _a=Phaser.Utils.Objects.GetValue;const va=0,ba=1,Pa="IDLE";var Sa=class extends ya{constructor(t,e){var i=Object(Xt.a)(t);i===t&&(t=void 0),super(i,e),this.scene=i,this.gameObject=t,t&&t.setInteractive(_a(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(_a(t,"enable",!0)),void 0===this.gameObject?this.bounds=_a(t,"bounds",void 0):this.bounds=void 0,this.tracerState=va,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,this.isTouchingAnyObject=!1,this}boot(){super.boot(),this.gameObject?this.gameObject.on("pointerdown",this.onPointerDown,this):this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.gameObject?this.gameObject.off("pointerdown",this.onPointerDown,this):this.scene&&this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene&&(this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0,this.gameObject=void 0,this.bounds=void 0,this.pointer=void 0,this.lastPointer=void 0,this.movedState=!1,super.shutdown()}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.dragCancel(),this.enable=t,this)}onPointerDown(t,e){this.enable&&(void 0===this.pointer&&(!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer!==t&&(this.pointer=t,this.lastPointer=t,this.movedState=!1,this.tracerState=ba,void 0===this.gameObject&&(this.isTouchingAnyObject=e.length>0),this.onDragStart()))}onPointerUp(t){this.enable&&((!this.bounds||this.bounds.contains(t.x,t.y))&&this.pointer===t&&(this.pointer=void 0,this.movedState=!1,this.tracerState=va,this.onDragEnd()))}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),i=this.pointer===t;!i&&e||(i&&!e?this.onPointerUp(t):(this.movedState||(this.movedState=t.x!==t.downX||t.y!==t.downY),this.movedState&&this.onDrag()))}}dragCancel(){return this.tracerState===ba&&this.onDragEnd(),this.pointer=void 0,this.tracerState=va,this}onDragStart(){this.emit("dragstart",this)}onDragEnd(){this.emit("dragend",this)}onDrag(){this.emit("drag",this)}preUpdate(t,e){}postUpdate(t,e){}startTicking(){super.startTicking(),this.scene.events.on("preupdate",this.preUpdate,this),this.scene.events.on("postupdate",this.postUpdate,this)}stopTicking(){super.stopTicking(),this.scene&&(this.scene.events.off("preupdate",this.preUpdate,this),this.scene.events.off("postupdate",this.postUpdate,this))}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=Pa,this}},Da=i(23);const Ta=Phaser.Utils.Objects.GetValue,xa=Phaser.Math.Distance.Between;const Ca="IDLE",Oa="BEGIN",Ma="RECOGNIZED";var wa=class extends Sa{constructor(t,e){super(t,e);var i=this,a={states:{IDLE:{enter:function(){i.stop(),i.tapsCount=0,i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start(),i.tapsCount=0,i.emit("tappingstart",i,i.gameObject,i.lastPointer)}},RECOGNIZED:{enter:function(){i.start(),i.emit("tap",i,i.gameObject,i.lastPointer),i.emit(`${i.tapsCount}tap`,i,i.gameObject,i.lastPointer)}}},init:function(){this.state=Ca},eventEmitter:!1};this.setRecongizedStateObject(new Da.a(a))}resetFromJSON(t){super.resetFromJSON(t),this.setMaxHoldTime(Ta(t,"time",250)),this.setTapInterval(Ta(t,"tapInterval",200)),this.setDragThreshold(Ta(t,"threshold",9)),this.setTapOffset(Ta(t,"tapOffset",10));var e=Ta(t,"taps",void 0);return void 0!==e?this.setTaps(e):(this.setMaxTaps(Ta(t,"maxTaps",void 0)),this.setMinTaps(Ta(t,"minTaps",void 0))),this}onDragStart(){switch(this.state){case Ca:this.state=Oa;break;case Oa:var t=this.lastPointer;xa(t.upX,t.upY,t.x,t.y)>this.tapOffset&&(this.state=Ma,this.state=Oa);break;case Ma:this.state=Oa}}onDragEnd(){this.state===Oa&&(this.tapsCount++,this.emit("tapping",this,this.gameObject,this.lastPointer),void 0!==this.maxTaps&&this.tapsCount===this.maxTaps&&(this.state=Ma))}onDrag(){this.state!==Ca&&this.pointer.getDistance()>this.dragThreshold&&(this.state=Ca)}preUpdate(t,e){if(this.state===Oa){var i=this.lastPointer;if(i.isDown)t-i.downTime>this.holdTime&&(this.state=Ca);else t-i.upTime>this.tapInterval&&(void 0===this.minTaps||this.tapsCount>=this.minTaps?this.state=Ma:this.state=Ca)}}postUpdate(t,e){this.state===Ma&&(this.state=Ca)}get isTapped(){return this.state===Ma}setMaxHoldTime(t){return this.holdTime=t,this}setTapInterval(t){return this.tapInterval=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setTapOffset(t){return this.tapOffset=t,this}setMaxTaps(t){return this.maxTaps=t,this}setMinTaps(t){return this.minTaps=t,this}setTaps(t,e){return void 0===e&&(e=t),this.setMinTaps(t).setMaxTaps(e),this}},input_TapCell=function(t){t._tap=new wa(t),t._tap.on("tap",(function(t){var e=`cell.${t.tapsCount}tap`;input_EmitCellEvent(this.eventEmitter,e,t.gameObject,t.x,t.y)}),this)};const Aa=Phaser.Utils.Objects.GetValue;const Ea="IDLE",Ba="BEGIN",Ia="RECOGNIZED";var ka=class extends Sa{constructor(t,e){super(t,e);var i=this,a={states:{IDLE:{enter:function(){i.x=0,i.y=0,i.worldX=0,i.worldY=0},exit:function(){var t=i.lastPointer;i.x=t.x,i.y=t.y,i.worldX=t.worldX,i.worldY=t.worldY}},BEGIN:{enter:function(){i.start()},exit:function(){i.stop()}},RECOGNIZED:{enter:function(){i.emit("pressstart",i,i.gameObject,i.lastPointer)},exit:function(){i.emit("pressend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=Ea},eventEmitter:!1};this.setRecongizedStateObject(new Da.a(a))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Aa(t,"threshold",9)),this.setMinHoldTime(Aa(t,"time",251)),this}onDragStart(){this.state=0===this.holdTime?Ia:Ba}onDragEnd(){this.state=Ea}onDrag(){this.state!==Ea&&this.pointer.getDistance()>this.dragThreshold&&(this.state=Ea)}preUpdate(t,e){this.state===Ba&&(t-this.pointer.downTime>=this.holdTime&&(this.state=Ia))}get isPressed(){return this.state===Ia}setDragThreshold(t){return this.dragThreshold=t,this}setMinHoldTime(t){return this.holdTime=t,this}},input_PressCell=function(t){t._press=new ka(t),t._press.on("pressstart",(function(t){var e=t.gameObject,i=e.pointerToCellIndex(t.x,t.y);t._cellIndex=i,input_EmitCellEvent(this.eventEmitter,"cell.pressstart",e,i)}),this).on("pressend",(function(t){var e=t.gameObject,i=t._cellIndex;t._cellIndex=void 0,input_EmitCellEvent(this.eventEmitter,"cell.pressend",e,i)}),this)},input_TableSetInteractive=function(t){t.setInteractive(),input_ClickCell.call(this,t),input_OverCell.call(this,t),input_TapCell.call(this,t),input_PressCell.call(this,t)},gridtable_SetItems=function(t){void 0===t?this.items.length=0:this.items=t;var e=this.childrenMap.child;return e.setCellsCount(this.items.length),e.updateTable(!0),this.resizeController(),this};const Ra=Phaser.Utils.Objects.GetValue;class ja extends zi.a{constructor(t,e){void 0===e&&(e={});var i=Object(Yi.a)(e),a=Ra(e,"table",void 0);void 0===a&&(a={}),a.scrollMode=i,a.clamplTableOXY=Ra(e,"clamplChildOY",!1);var r,n,s=Ra(a,"width",void 0),o=Ra(a,"height",void 0),h=new pa(t,0,0,s,o,a);0===i?(r=void 0===s?1:0,n=void 0===o):(r=void 0===o?1:0,n=void 0===s),gridtable_InjectProperties(h),e.type="rexGridTable",e.child={gameObject:h,proportion:r,expand:n};var l=Ra(e,"space",void 0);l&&(l.child=l.table),super(t,e),this.addChildrenMap("table",h),this.eventEmitter=Ra(e,"eventEmitter",this);var c=Ra(e,"createCellContainerCallback",Pe.a),u=Ra(e,"createCellContainerCallbackScope",void 0);this.setCreateCellContainerCallback(c,u),gridtable_TableOnCellVisible.call(this,h),Ra(a,"interactive",!0)&&input_TableSetInteractive.call(this,h),this.setItems(Ra(e,"items",[]))}setCreateCellContainerCallback(t,e){return this.createCellContainerCallback=t,this.createCellContainerCallbackScope=e,this}refresh(){return this.childrenMap.child.updateTable(!0),this}}var La={setItems:gridtable_SetItems};Object.assign(ja.prototype,La);var Fa=ja;ie.register("gridTable",(function(t){var e=new Fa(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.GridTable",Fa);var Na={expandSubMenu:function(t,e){this.collapseSubMenu();var i=new this.constructor(this.scene,{items:e,orientation:this.orientation,createButtonCallback:this.root.createButtonCallback,createButtonCallbackScope:this.root.createButtonCallbackScope,easeIn:this.root.easeIn,easeOut:this.root.easeOut,root:this.root,parent:t});return this.add(i,null),this.childrenMap.subMenu=i,this},collapse:function(){return this.root.easeOut?this.scaleDownDestroy(this.root.easeOut):this.destroy(),this.collapseSubMenu(),this},collapseSubMenu:function(){if(void 0===this.childrenMap.subMenu)return this;var t=this.childrenMap.subMenu;return this.childrenMap.subMenu=void 0,this.remove(t),t.collapse(),this}},menu_CreateButtons=function(t,e,i,a){var r,n,s=[];if(e&&i)for(var o=0,h=e.length;o<h;o++)(r=e[o]).scene=t,n=a?i.call(a,r,o):i(r,o),r.scene=void 0,s.push(n);return s},Ua=i(110),menu_MenuSetInteractive=function(t){t.on(t.root.expandEventName,(function(t,e){if(!this.isPassedEvent){var i=this.items[e].children;i&&this.expandSubMenu(t,i)}}),t).on("button.click",(function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.click",t,e),this.root.isPassedEvent=!1)}),t).on("button.over",(function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.over",t,e),this.root.isPassedEvent=!1)}),t).on("button.out",(function(t,e){this!==this.root&&(this.root.isPassedEvent=!0,this.root.emit("button.out",t,e),this.root.isPassedEvent=!1)}),t)};const Va=Phaser.Utils.Objects.GetValue;class Ha extends ki{constructor(t,e){void 0===e&&(e={}),e.hasOwnProperty("orientation")||(e.orientation=1);var i=Va(e,"items",void 0),a=Va(e,"createButtonCallback",void 0),r=Va(e,"createButtonCallbackScope",void 0);if(e.buttons=menu_CreateButtons(t,i,a,r),super(t,e),this.type="rexMenu",this.items=i,this.root=Va(e,"root",this),this.root===this){if(this.expandEventName=Va(e,"expandEvent","button.click"),this.easeIn=Va(e,"easeIn",void 0),this.easeOut=Va(e,"easeOut",void 0),this.bounds=Va(e,"bounds",void 0),this.expandOrientation=Va(e,"expandOrientation",void 0),void 0===this.expandOrientation){var n=this.bounds;void 0===n&&(n=Object(Ua.a)(t)),0===this.orientation?this.expandOrientation=this.y<n.centerY?1:3:this.expandOrientation=this.x<n.centerX?0:2}this.createButtonCallback=a,this.createButtonCallbackScope=r,this.isPassedEvent=!1}this.setOrigin(0).layout();var s=Va(e,"parent",void 0);if(s)switch(this.root.expandOrientation){case 0:this.alignTop(s.top).alignLeft(s.right);break;case 1:this.alignLeft(s.left).alignTop(s.bottom);break;case 2:this.alignTop(s.top).alignRight(s.left);break;case 3:this.alignLeft(s.left).alignBottom(s.top)}this.pushIntoBounds(this.root.bounds),menu_MenuSetInteractive(this),this.root.easeIn&&this.popUp(this.root.easeIn)}isInTouching(t){return!!super.isInTouching(t)||!!this.childrenMap.subMenu&&this.childrenMap.subMenu.isInTouching(t)}}Object.assign(Ha.prototype,Na);var Wa=Ha;ie.register("menu",(function(t){var e=new Wa(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Menu",Wa);var za=i(114);const Ya=Phaser.Utils.Objects.GetValue,Ga=Phaser.Math.Clamp;var transferText=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t},Xa=class{constructor(t,e){this.gameObject=t,this.scene=Object(Xt.a)(t),this.setTextObjectType(),this.lines=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setText(Ya(t,"text","")),this.setStartIdx(Ya(t,"start",0)),this.setPageIdx(Ya(t,"page",-1)),this}toJSON(){return{text:this.text,start:this.startLineIdx,page:this.pageIndex,pageCount:this.pageCount}}boot(){this.gameObject.once("destroy",this.destroy,this)}shutdown(){return void 0===this.lines||(0===this.textObjectType?this.lines.length=0:this.lines.destroy()),this.gameObject=void 0,this.scene=void 0,this}destroy(){this.shutdown()}setTextObjectType(){return this.textObjectType=Object(za.a)(this.gameObject)?0:1,this}get isFirstPage(){return this.pageIndex<=0}get isLastPage(){return this.pageIndex>=this.pageCount-1}setText(t,e){return void 0===e&&(e=!0),this.text=transferText(t),0===this.textObjectType?this.lines=this.gameObject.getWrappedText(this.text):this.lines=this.gameObject.getPenManager(this.text,this.lines),this.pageCount=Math.ceil(this.totalLinesCount/this.pageLinesCount),e&&this.resetPageIdx(),this}appendText(t){return this.setText(this.text.concat(transferText(t))),this}getPage(t){return void 0===t&&(t=this.pageIndex),this.setPageIdx(t).getLines()}getNextPage(){return this.getPage(this.pageIndex+1)}getPreviousPage(){return this.getPage(this.pageIndex-1)}showPage(t){return this.displayText(this.getPage()),this}showNextPage(){return this.displayText(this.getNextPage()),this}showPreviousPage(){return this.displayText(this.getPreviousPage()),this}show(){return this.displayText(this.getLines()),this}showNextLine(){return this.displayText(this.setStartIdx(this.startLineIdx+1).getLines()),this}showPreviousLine(){return this.displayText(this.setStartIdx(this.startLineIdx-1).getLines()),this}setStartIdx(t){return t=Ga(t,0,this.totalLinesCount-1),this.startLineIdx=t,this}resetPageIdx(){this.pageIndex=-1}setPageIdx(t){return t=Ga(t,0,this.pageCount-1),this.pageIndex=t,this.setStartIdx(this.pageIndex*this.pageLinesCount),this}get totalLinesCount(){return 0===this.textObjectType?this.lines.length:this.lines.linesCount}get pageLinesCount(){var t=this.gameObject.style.maxLines;return t>0?t:this.totalLinesCount}getLines(t){void 0===t&&(t=this.startLineIdx);var e,i=t+this.pageLinesCount;if(0===this.textObjectType)e=this.lines.slice(t,i).join("\n");else{var a=this.lines.getLineStartIndex(t),r=this.lines.getLineEndIndex(i-1);e=this.lines.getSliceTagText(a,r,!0)}return e}displayText(t){this.gameObject.setText(t)}};const Ka=Phaser.Events.EventEmitter,Ja=Phaser.Utils.Objects.GetFastValue,Za=Phaser.Utils.Objects.GetValue;var TextTyping_transferText=function(t){return Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t};const Qa={"left-to-right":0,"right-to-left":1,"middle-to-sides":2,"sides-to-middle":3};var qa=class extends Ka{constructor(t,e){super(),this.gameObject=t,this.scene=Object(Xt.a)(t),this.timer=null,this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setTypeMode(Za(t,"typeMode",0)),this.setTypeSpeed(Za(t,"speed",333)),this.setTextCallback=Ja(t,"setTextCallback",null),this.setTextCallbackScope=Ja(t,"setTextCallbackScope",null),this.typingIdx=Ja(t,"typingIdx",0),this.text=TextTyping_transferText(Ja(t,"text","")),this.textLen=Ja(t,"textLen",0),this.insertIdx=Ja(t,"insertIdx",null);var e=Ja(t,"elapsed",null);return null!==e&&this.start(void 0,void 0,this.typingIdx,e),this}toJSON(){var t,e=this.getTimer();return t=e?e.elapsed:null,{typeMode:this.typeMode,speed:this.speed,setTextCallback:this.setTextCallback,setTextCallbackScope:this.setTextCallbackScope,typingIdx:this.typingIdx,text:this.text,textLen:this.textLen,insertIdx:this.insertIdx,elapsed:t}}boot(){return this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return super.shutdown(),this.freeTimer(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setTypeMode(t){return"string"==typeof t&&(t=Qa[t]),this.typeMode=t,this}setTypeSpeed(t){return this.speed=t,this}get isTyping(){return null!==this.getTimer()}get isLastChar(){return this.typingIdx===this.textLen}start(t,e,i,a){return void 0!==t&&this.setTypingContent(t),void 0!==e&&(this.speed=e),void 0===i&&(i=0),this.typingIdx=i+1,0===this.speed?this.stop(!0):this.startTimer(a),this}appendText(t){var e=this.text.concat(TextTyping_transferText(t));return this.isTyping?this.setTypingContent(e):this.start(e,void 0,this.textLen),this}stop(t){return this.getTimer()&&this.freeTimer(),t&&(this.typingIdx=this.textLen,this.setText(this.text),this.emit("type"),this.emit("complete",this,this.gameObject)),this}pause(){var t=this.getTimer();return t&&(t.paused=!0),this}resume(){var t=this.getTimer();return t&&(t.paused=!1),this}setTypingContent(t){return this.text=TextTyping_transferText(t),this.textLen=this.getTextLength(this.text),this}onTyping(){var t=this.getTypingString(this.text,this.typingIdx,this.textLen,this.typeMode);this.setText(t),this.emit("type"),this.isLastChar?(this.freeTimer(),this.emit("complete",this,this.gameObject)):(this.timer.delay=this.speed,this.typingIdx++)}getTypingString(t,e,i,a){var r;if(0===a){var n=0,s=e;this.insertIdx=s,r=this.getSubString(t,n,s)}else if(1===a){n=(s=i)-e;this.insertIdx=0,r=this.getSubString(t,n,s)}else if(2===a){var o=i/2;s=(n=Math.floor(o-e/2))+e;this.insertIdx=e%2?e:0,r=this.getSubString(t,n,s)}else if(3===a){var h,l=Math.floor(e/2);if(l>0){n=(s=i)-l;h=this.getSubString(t,n,s)}else h="";var c,u=e-l;if(u>0){s=(n=0)+u;this.insertIdx=s,c=this.getSubString(t,n,s)}else c="",this.insertIdx=0;r=c+h}return r}startTimer(t){var e;return this.timer&&this.freeTimer(),void 0===t?(0,e=0):(this.speed,e=t),this.timer=this.scene.time.addEvent({delay:0,startAt:e,loop:!0,callback:this.onTyping,callbackScope:this}),this}getTimer(){return this.timer}freeTimer(){return this.timer&&(this.timer.remove(),this.timer=null),this}setText(t){this.setTextCallback&&(t=this.setTextCallbackScope?this.setTextCallback.call(this.setTextCallbackScope,t,this.isLastChar,this.insertIdx):this.setTextCallback(t,this.isLastChar,this.insertIdx)),this.gameObject.setText(t)}getTextLength(t){var e=this.gameObject;return e.getPlainText?e.getPlainText(t).length:t.length}getSubString(t,e,i){var a=this.gameObject;return a.getSubString?a.getSubString(t,e,i):t.slice(e,i)}};const $a=Phaser.Utils.Objects.GetValue;var TextBox_createDefaultTextObject=function(t){return t.add.text(0,0,"",{wordWrap:{width:200},maxLines:5})},tr=class extends wi{constructor(t,e){void 0===e&&(e={text:TextBox_createDefaultTextObject(t)}),super(t,e),this.type="rexTextBox";var i=this.childrenMap.text;this.page=new Xa(i,$a(e,"page",void 0)),this.typing=new qa(i,$a(e,"type",void 0)),this.typing.on("complete",this.onPageEnd,this).on("type",this.onType,this),this.textWidth=i.width,this.textHeight=i.height}start(t,e){return this.page.setText(t),void 0!==e&&this.typing.setTypeSpeed(e),this.typeNextPage(),this}typeNextPage(){if(this.page.isLastPage)this.emit("complete");else{var t=this.page.getNextPage();this.typing.start(t)}return this}pause(){return this.typing.pause(),this}resume(){return this.typing.resume(),this}stop(t){return this.typing.stop(t),this}get isTyping(){return this.typing.isTyping}get isLastPage(){return this.page.isLastPage}get isFirstPage(){return this.page.isFirstPage}get pageCount(){return this.page.pageCount}get pageIndex(){return this.page.pageIndex}onType(){var t=this.childrenMap.text;this.textWidth===t.width&&this.textHeight===t.height||(this.textWidth=t.width,this.textHeight=t.height,this.getTopmostSizer().layout()),this.emit("type")}onPageEnd(){this.emit("pageend")}};ie.register("textBox",(function(t){var e=new tr(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.TextBox",tr);const er=Phaser.Utils.Objects.GetValue,ir=Phaser.Math.Percent,ar=Phaser.Math.Linear;class rr extends ai.a{constructor(t,e){super(t,e),this.type="rexNumberBar";var i,a=er(e,"background",void 0),r=er(e,"icon",void 0),n=er(e,"iconMask",void 0),s=er(e,"slider",void 0),o=er(e,"text",void 0),h=er(e,"space.left",0),l=er(e,"space.right",0),c=er(e,"space.top",0),u=er(e,"space.bottom",0),d=er(e,"space.icon",0),p=er(e,"space.slider",0);(a&&this.addBackground(a),r)&&(m=0===this.orientation?{left:h,right:s||o?d:l,top:c,bottom:u}:{left:h,right:l,top:c,bottom:s||o?d:u},this.add(r,0,"center",m),n&&(n=new Ci.a(r,1),r.setMask(n.createGeometryMask()),this.add(n,null)));if(s){var m,f;if(s.orientation=0==this.orientation?1:0,s.eventEmitter=this,s.value=null,s.hasOwnProperty("input")||(s.input=-1),i=new Wi.a(t,s),m=0===this.orientation?{left:r?0:h,right:o?p:l,top:c,bottom:u}:{left:h,right:l,top:r?0:c,bottom:o?p:u},0===this.orientation)f=void 0===er(s,"width",void 0)?1:0;else f=void 0===er(s,"height",void 0)?1:0;this.add(i,f,"center",m)}o&&(m=0===this.orientation?{left:r||s?0:h,right:l,top:c,bottom:u}:{left:h,right:l,top:r||s?0:c,bottom:u},this.add(o,0,"center",m));this.addChildrenMap("background",a),this.addChildrenMap("icon",r),this.addChildrenMap("slider",i),this.addChildrenMap("text",o);var g=er(e,"valuechangeCallback",null);if(null!==g){var y=er(e,"valuechangeCallbackScope",void 0);this.on("valuechange",g,y)}this.setEnable(er(e,"enable",void 0)),this.setValue(er(e,"value",0))}setEnable(t){return this.childrenMap.slider?this:(void 0===t&&(t=!0),this.childrenMap.slider.enable=t,this)}get value(){return this.childrenMap.slider?this.childrenMap.slider.value:0}set value(t){this.childrenMap.slider&&(this.childrenMap.slider.value=t)}setValue(t,e,i){return void 0!==e&&(t=ir(t,e,i)),this.value=t,this}addValue(t,e,i){return void 0!==e&&(t=ir(t,e,i)),this.value+=t,this}getValue(t,e){var i=this.value;return void 0!==t&&(i=ar(t,e,i)),i}get text(){var t=this.childrenMap.text;return void 0===t?"":t.text?t.text:t.getData("text")}set text(t){var e=this.childrenMap.text;void 0!==e&&(e.setText?e.setText(t):e.setData("text",t))}setText(t){return this.text=t,this}}var nr=rr;ie.register("numberBar",(function(t){var e=new nr(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.NumberBar",nr);const sr=Phaser.Utils.Objects.IsPlainObject,or=Phaser.Display.Align.TOP_LEFT;var pages_AddPage=function(t,e,i,a,r){if(sr(e)){var n=e;e=GetValue(n,"key",0),i=GetValue(n,"align",or),a=GetValue(n,"padding",0),r=GetValue(n,"expand",!1)}return"string"==typeof i&&(i=ci.a[i]),void 0===i&&(i=ALIGN_CENTER),void 0===a&&(a=0),void 0===r&&(r=!0),(n=this.getSizerConfig(t)).parent=this,n.align=i,n.padding=Object(li.a)(a),n.expand=r,this.sizerChildren.has(e)&&this.sizerChildren.get(e).destroy(),this.sizerChildren.set(e,t),t.setVisible(!1),this.add(t),this},pages_GetPage=function(t){return void 0===t?null:this.sizerChildren.has(t)?this.sizerChildren.get(t):null},pages_SwapPage=function(t){this._previousKey=this._currentKey;var e=this.previousPage;e&&(0===this.swapMode?(e.setVisible(!1),this.resetChildVisibleState(e),this.emit("pageinvisible",e,this._previousKey,this)):e.destroy()),t&&!this.sizerChildren.has(t)&&this.emit("createpage",t,this),this._currentKey=t;var i=this.currentPage;return i&&(i.setVisible(!0),this.resetChildVisibleState(i),this.emit("pagevisible",i,this._currentKey,this)),this},pages_GetChildrenWidth=function(){if(this.rexSizer.hidden)return 0;var t,e,i,a=0,r=this.sizerChildren.entries;for(var n in r)i=(t=r[n]).isRexSizer?Math.max(t.minWidth,t.childrenWidth):t.width,i+=(e=t.rexSizer.padding).left+e.right,a=Math.max(i,a);return a},pages_GetChildrenHeight=function(){if(this.rexSizer.hidden)return 0;var t,e,i,a=0,r=this.sizerChildren.entries;for(var n in r)i=(t=r[n]).isRexSizer?Math.max(t.minHeight,t.childrenHeight):t.height,i+=(e=t.rexSizer.padding).top+e.bottom,a=Math.max(i,a);return a},pages_GetChildrenSizers=function(t){void 0===t&&(t=[]);var e,i=this.sizerChildren.entries;for(var a in i)(e=i[a]).isRexSizer&&t.push(e);return t},pages_GetExpandedChildWidth=function(t,e){var i,a=e.rexSizer,r=a.padding;return a.expand&&(i=t.width-r.left-r.right),i},pages_GetExpandedChildHeight=function(t,e){var i,a=e.rexSizer,r=a.padding;return a.expand&&(i=t.height-r.top-r.bottom),i};const hr=Phaser.Display.Align.In.QuickSet;var lr={addPage:pages_AddPage,getPage:pages_GetPage,swapPage:pages_SwapPage,getChildrenWidth:pages_GetChildrenWidth,getChildrenHeight:pages_GetChildrenHeight,getChildrenSizers:pages_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var a,r,n;this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i);var s,o,h,l,c,u,d=this.left,p=this.top,m=this.pages;for(var f in m)n=(r=(a=m[f]).rexSizer).padding,a.isRexSizer?a.layout(this,pages_GetExpandedChildWidth(this,a),pages_GetExpandedChildHeight(this,a)):(c=void 0,u=void 0,r.expand&&(u=this.height-n.top-n.bottom,c=this.width-n.left-n.right),Object(ni.a)(a,c,u)),s=d+n.left,h=this.width-n.left-n.right,o=p+n.top,l=this.height-n.top-n.bottom,si.a.setPosition(s,o).setSize(h,l),hr(a,si.a,r.align),this.resetChildPositionState(a);return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0}};const cr=Phaser.Utils.Objects.IsPlainObject,ur=Phaser.Utils.Objects.GetValue,dr=Phaser.Structs.Map;class pr extends ri.a{constructor(t,e,i,a,r,n){cr(e)?(e=ur(n=e,"x",0),i=ur(n,"y",0),a=ur(n,"width",void 0),r=ur(n,"height",void 0)):cr(a)&&(a=ur(n=a,"width",void 0),r=ur(n,"height",void 0)),super(t,e,i,a,r,n),this.type="rexPages",this._previousKey=void 0,this._currentKey=void 0,this.sizerChildren=new dr,this.setSwapMode(ur(n,"swapMode",0)),this.addChildrenMap("pages",this.pages)}destroy(t){this.scene&&(this.sizerChildren.clear(),super.destroy(t))}setSwapMode(t){return"string"==typeof t&&(t=mr[t]),this.swapMode=t,this}get previousKey(){return this._previousKey}get currentKey(){return this._currentKey}set currentKey(t){this.swapPage(t)}get currentPage(){return this.getPage(this.currentKey)}get previousPage(){return this.getPage(this.previousKey)}get keys(){return this.sizerChildren.keys()}get pages(){return this.sizerChildren.entries}}Object.assign(pr.prototype,lr);const mr={invisible:0,destroy:1};var fr=pr;ie.register("pages",(function(t,e,i,a,r){var n=new fr(this.scene,t,e,i,a,r);return this.scene.add.existing(n),n})),object_SetValue(window,"RexPlugins.UI.Pages",fr);var gr=i(135);ie.register("textBlock",(function(t,e,i,a,r,n){var s=new gr.a(this.scene,t,e,i,a,r,n);return this.scene.add.existing(s),s})),object_SetValue(window,"RexPlugins.UI.TextBlock",gr.a);gr.a;var yr=i(138);ie.register("textArea",(function(t){var e=new yr.a(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.TextArea",yr.a);yr.a;const _r=Phaser.Utils.Objects.GetValue,vr=Phaser.Display.Align.TOP_LEFT;var br={setChild:function(t,e,i){t.setOrigin&&t.setOrigin(0),this.add(t);var a,r,n=this.getSizerConfig(t);if(n.parent=this,n.align=vr,n.expand=e,this.child=t,!0===i?(a=!0,r=0):!1===i?a=!1:(a=_r(i,"mask",!0),r=_r(i,"padding",0)),a){var s=new Ci.a(this,0,r);this.childMask=s.createGeometryMask(),this.add(s)}return this},getChildrenWidth:function(){if(this.rexSizer.hidden)return 0;var t=this.child;return t.rexSizer.hidden?0:0===this.scrollMode?t.isRexSizer?Math.max(t.minWidth,t.childrenWidth):t.width:0},getChildrenHeight:function(){if(this.rexSizer.hidden)return 0;var t=this.child;return t.rexSizer.hidden?0:0===this.scrollMode?0:t.isRexSizer?Math.max(t.minHeight,t.childrenHeight):t.height},resetChildPosition:function(){var t=this.left,e=this.top;0===this.scrollMode?e+=this.childOY:t+=this.childOY,this.child.setPosition(t,e),containerlite_MaskChildren(this,this.childMask,this.child.getAllChildren()),this.resetChildPositionState(this.child)},layout:function(t,e,i){if(this.rexSizer.hidden)return this;this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i);var a,r,n=this.child;if(!n.rexSizer.hidden&&(0===this.scrollMode?a=this.width:r=this.height,n.isRexSizer?n.layout(this,a,r):Object(ni.a)(n,a,r),this.resetChildPosition(),this.childMask)){var s=mask_MaskToGameObject(this.childMask);s.setPosition().resize(),this.resetChildPositionState(s)}return this}},Pr=i(113);const Sr=Phaser.Utils.Objects.IsPlainObject,Dr=Phaser.Utils.Objects.GetValue;class Tr extends ri.a{constructor(t,e,i,a,r,n){Sr(e)?(e=Dr(n=e,"x",0),i=Dr(n,"y",0),a=Dr(n,"width",void 0),r=Dr(n,"height",void 0)):Sr(a)&&(a=Dr(n=a,"width",void 0),r=Dr(n,"height",void 0)),super(t,e,i,a,r,n),this.type="rexScrollableBlock",this.child=void 0,this.childMask=void 0,this._childOY=0,this.execeedTopState=!1,this.execeedBottomState=!1,this.setScrollMode(Dr(n,"scrollMode",!0)),this.setClampMode(Dr(n,"clamplChildOY",!0));var s=Dr(n,"child",void 0),o=Dr(n,"expand",!0),h=Dr(n,"mask",void 0);this.setChild(s,o,h)}destroy(t){this.scene&&(this.child=void 0,this.childMask&&(this.childMask.destroy(),this.childMask=void 0),super.destroy(t))}setScrollMode(t){return"string"==typeof t&&(t=Pr.a[t.toLowerCase()]),this.scrollMode=t,this}setClampMode(t){return this.clampChildOYMode=t,this}get instHeight(){return 0===this.scrollMode?this.height:this.width}get instWidth(){return 0===this.scrollMode?this.width:this.height}get childHeight(){return 0===this.scrollMode?this.child.height:this.child.width}get childWidth(){return 0===this.scrollMode?this.child.width:this.child.height}get topChildOY(){return 0}get bottomChildOY(){return-this.visibleHeight}get visibleHeight(){var t=this.childHeight,e=this.instHeight;return t>e?t-e:0}childOYExceedTop(t){return void 0===t&&(t=this.childOY),t>this.topChildOY}childOYExeceedBottom(t){return void 0===t&&(t=this.childOY),t<this.bottomChildOY}get childOY(){return this._childOY}set childOY(t){var e=this.topChildOY,i=this.bottomChildOY,a=this.childOYExceedTop(t),r=this.childOYExeceedBottom(t);this.clampChildOYMode&&(this.instHeight>this.childHeight?t=0:a?t=e:r&&(t=i)),this._childOY!==t&&(this._childOY=t,this.resetChildPosition()),a&&(this.execeedTopState||this.emit("execeedtop",this,t,e)),this.execeedTopState=a,r&&(this.execeedBottomState||this.emit("execeedbottom",this,t,i)),this.execeedBottomState=r}setChildOY(t){return this.childOY=t,this}set t(t){this.childOY=-this.visibleHeight*t}get t(){var t=this.visibleHeight;return 0===t?0:this.childOY/-t}setChildOYByPercentage(t){return this.t=t,this}}Object.assign(Tr.prototype,br);var xr=Tr;ie.register("scrollableBlock",(function(t){var e=new xr(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.ScrollableBlock",xr);const Cr=Phaser.Utils.Objects.GetValue;class Or extends zi.a{constructor(t,e){void 0===e&&(e={});var i=Object(Yi.a)(e),a=Cr(e,"panel",void 0);void 0===a&&(a={}),a.scrollMode=i,a.clamplChildOY=Cr(e,"clamplChildOY",!1);var r,n,s=new xr(t,a),o=Cr(a,"width",void 0),h=Cr(a,"height",void 0);0===i?(r=void 0===o?1:0,n=void 0===h):(r=void 0===h?1:0,n=void 0===o),e.type="rexScrollablePanel",e.child={gameObject:s,proportion:r,expand:n};var l=Cr(e,"space",void 0);l&&(l.child=l.panel),super(t,e),this.addChildrenMap("panel",this.childrenMap.child.child)}}var Mr=Or;ie.register("scrollablePanel",(function(t){var e=new Mr(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.ScrollablePanel",Mr);var wr={popUp:0,fadeIn:1,scaleDown:0,fadeOut:1},Ar={popUp:function(t,e){t.popUp(e)},scaleDown:function(t,e){t.scaleDownDestroy(e,void 0,void 0,!1)},fadeIn:function(t,e){t.fadeIn(e)},fadeOut:function(t,e){t.fadeOut(e,!1)}},array_Copy=function(t,e,i,a){void 0===i&&(i=0),void 0===a&&(a=e.length),t.length=a-i;for(var r=0,n=t.length;r<n;r++)t[r]=e[r+i];return t},Er=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,TypeConvert=function(t){return"string"!=typeof t?t:(""===t?t=null:Er.test(t)?t=parseFloat(t):"false"===screen?t=!1:"true"===t&&(t=!0),t)},object_IsArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)};const Br=Phaser.Utils.Objects.GetValue;var runCommands=function(t,e,i){var a,r=Br(i,"reverse",!1);if(object_IsArray(t[0]))if(r)for(n=(s=t.length)-1;n>=0;n--)a=runCommands(t[n],e,i);else for(var n=0,s=t.length;n<s;n++)a=runCommands(t[n],e,i);else a=runCommand(t,e,i);return a},runCommand=function(t,e,i){var a,r=Br(i,"argsConvert",void 0),n=Br(i,"argsConvertScope",void 0),s=t[0];if(Ir=array_Copy(Ir,t,1),r){!0===r&&(r=TypeConvert,n=void 0);for(var o=0,h=Ir.length;o<h;o++)Ir[o]=n?r.call(n,Ir[o],t):r(Ir[o],t)}return"string"==typeof s?null==(a=e[s])&&(a=Br(e,s,null)):a=s,a.apply(e,Ir)},Ir=[],kr=runCommands,Rr=i(111),system_GetEventEmitter=function(t){return Object(Rr.a)(t)?t.events:t.on?t:void 0};var jr=[];const Lr={ms:0,s:1,sec:1},Fr={abs:0,absolute:0,inc:1,increment:1};var Nr=class extends ya{constructor(t,e){super(t,e),this.parent=t,this.scene=Object(Xt.a)(t),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.isRunning=Ki()(t,"isRunning",!1),this.state=Ki()(t,"state",0),this.commands=Ki()(t,"commands",[]),this.scope=Ki()(t,"scope",void 0),this.setTimeUnit(Ki()(t,"timeUnit",0)),this.setDtMode(Ki()(t,"dtMode",0)),this.setTimeScale(Ki()(t,"timeScale",1)),this.index=Ki()(t,"index",0),this.nextDt=Ki()(t,"nextDt",0),this.seek(Ki()(t,"now",0)),this.timeScale=Ki()(t,"timeScale",1),this}toJSON(){return{isRunning:this.isRunning,state:this.state,commands:this.commands,scope:this.scope,timeUnit:this.timeUnit,dtMode:this.dtMode,index:this.index,nextDt:this.nextDt,now:this.now,timeScale:this.timeScale,tickingMode:this.tickingMode}}boot(){super.boot();var t=system_GetEventEmitter(this.parent);t&&t.once("destroy",this.destroy,this)}shutdown(){super.shutdown(),this.parent=void 0,this.scene=void 0,this.commands=void 0}destroy(){this.shutdown()}startTicking(){super.startTicking(),this.scene.events.on("update",this.update,this)}stopTicking(){super.stopTicking(),this.scene&&this.scene.events.off("update",this.update,this)}load(t,e,i){this.stop();var a=Ki()(i,"timeUnit",void 0);void 0!==a&&this.setTimeUnit(a);var r=Ki()(i,"dtMode",void 0);return void 0!==r&&this.setDtMode(r),t=t.filter((function(t){var e=t[0];return!isNaN(e)})).map((function(t){return"string"==typeof t[0]&&(t[0]=parseFloat(t[0])),t})),0===this.dtMode&&t.sort((function(t,e){var i=t[0],a=e[0];return i>a?1:i<a?-1:0})),this.commands=t,this.scope=e,this}start(t){return void 0===t&&(t=0),this.stop(),this.index=0,this.isRunning=!0,this.state=1,this.nextDt=this.getNextDt(0),this.seek(t),this.update(),this}pause(){return this.isRunning=!1,this}resume(){return this.isRunning=!0,this}stop(){return this.isRunning=!1,this.state=0,this}seek(t){return this.now=t,this}get isPlaying(){return this.isRunning}get completed(){return 2===this.state}setTimeScale(t){this.timeScale=t}update(t,e){if(!this.isRunning)return this;if(void 0!==t){if(0===this.timeScale||0===e)return this;this.now+=e*this.timeScale}if(this.nextDt>this.now)return this;for(;;){var i=this.commands[this.index],a=i[1];if(object_IsArray(a)||(a=array_Copy(jr,i,1)),kr(a,this.scope),this.emit("runcommand",a,this.scope),this.index===this.commands.length-1)return this.complete(),this;if(this.index++,this.nextDt=this.getNextDt(this.nextDt),this.nextDt>this.now)return this}}complete(){super.complete(),this.state=2}getNextDt(t){var e=this.commands[this.index][0];return 1===this.timeUnit&&(e*=1e3),1===this.dtMode&&(e+=t),e}setDtMode(t){return"string"==typeof t&&(t=Fr[t]),this.dtMode=t,this}setTimeUnit(t){return"string"==typeof t&&(t=Lr[t]),this.timeUnit=t,this}};const Ur=Phaser.Utils.Objects.GetValue;var Vr=class extends wi{constructor(t,e){void 0===e&&(e={text:createDefaultTextObject(t)}),super(t,e),this.type="rexToast",this.setTransitInTime(Ur(e,"duration.in",200)),this.setDisplayTime(Ur(e,"duration.hold",1200)),this.setTransitOutTime(Ur(e,"duration.out",200)),this.setTransitInCallback(Ur(e,"transitIn",wr.popUp)),this.setTransitOutCallback(Ur(e,"transitOut",wr.scaleDown)),this.player=new Nr(this,{dtMode:1}),this.messages=[],this.setVisible(!1)}destroy(t){this.scene&&(this.player.destroy(),this.player=void 0,this.messages=void 0,super.destroy(t))}setDisplayTime(t){return this.displayTime=t,this}setTransitOutTime(t){return this.transitOutTime=t,this}setTransitInTime(t){return this.transitInTime=t,this}setTransitInCallback(t){switch("string"==typeof t&&(t=wr[t]),t){case wr.popUp:t=Ar.popUp;break;case wr.fadeIn:t=Ar.fadeIn}return this.transitInCallback=t,this}setTransitOutCallback(t){switch("string"==typeof t&&(t=wr[t]),t){case wr.scaleDown:t=Ar.scaleDown;break;case wr.fadeOut:t=Ar.fadeOut}return this.transitOutCallback=t,this}show(t){if(void 0===t){if(0===this.messages.length)return this;t=this.messages.shift()}if(this.player.isPlaying)return this.messages.push(t),this;this.setScale(1,1).setVisible(!0),"string"==typeof t?this.setText(t):t(this),this.layout();var e=[[0,[this.transitInCallback,this,this.transitInTime]],[this.transitInTime,[Pe.a]],[this.displayTime,[this.transitOutCallback,this,this.transitOutTime]],[this.transitOutTime,[this.setVisible,!1]],[30,[Pe.a]]];return this.player.load(e,this).once("complete",(function(){this.show()}),this).start(),this}};ie.register("toast",(function(t){var e=new Vr(this.scene,t);return this.scene.add.existing(e),e})),object_SetValue(window,"RexPlugins.UI.Toast",Vr);const Hr=Phaser.GameObjects.GameObject;var system_IsGameObject=function(t){return t instanceof Hr};ie.register("tap",(function(t,e){return system_IsGameObject(t)||(e=t,t=this.scene),new wa(t,e)})),object_SetValue(window,"RexPlugins.UI.Tap",wa);ie.register("press",(function(t,e){return system_IsGameObject(t)||(e=t,t=this.scene),new ka(t,e)})),object_SetValue(window,"RexPlugins.UI.Press",ka);const Wr=Phaser.Math.Distance.Between,zr=Phaser.Math.Angle.Between;var Yr={getDt:function(){return this.scene.sys.game.loop.delta},getVelocity:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Wr(e.x,e.y,t.x,t.y)/(.001*this.getDt())},getVelocityX:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.x-e.x)/(.001*this.getDt())},getVelocityY:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return Math.abs(t.y-e.y)/(.001*this.getDt())},getVelocityAngle:function(){var t=this.pointer.position,e=this.pointer.prevPosition;return zr(e.x,e.y,t.x,t.y)}},Gr={"up&down":0,"left&right":1,"4dir":2,"8dir":3},Xr={},angletodirections_AngleToDirections=function(t,e,i){switch(void 0===i?i={}:!0===i&&(i=Xr),i.left=!1,i.right=!1,i.up=!1,i.down=!1,t=(t+360)%360,e){case 0:t<180?i.down=!0:i.up=!0;break;case 1:t>90&&t<=270?i.left=!0:i.right=!0;break;case 2:t>45&&t<=135?i.down=!0:t>135&&t<=225?i.left=!0:t>225&&t<=315?i.up=!0:i.right=!0;break;case 3:t>22.5&&t<=67.5?(i.down=!0,i.right=!0):t>67.5&&t<=112.5?i.down=!0:t>112.5&&t<=157.5?(i.down=!0,i.left=!0):t>157.5&&t<=202.5?i.left=!0:t>202.5&&t<=247.5?(i.left=!0,i.up=!0):t>247.5&&t<=292.5?i.up=!0:t>292.5&&t<=337.5?(i.up=!0,i.right=!0):i.right=!0}return i};const Kr=Phaser.Utils.Objects.GetValue,Jr=Phaser.Math.RadToDeg;class Zr extends Sa{constructor(t,e){super(t,e);var i=this,a={states:{IDLE:{},BEGIN:{enter:function(){i.validDrag=!1}},RECOGNIZED:{enter:function(){i.start(),i.updateDirectionStates(),i.emit("swipe",i,i.gameObject,i.lastPointer)},exit:function(){i.stop(),i.clearDirectionStates()}}},init:function(){this.state=Qr},eventEmitter:!1};this.setRecongizedStateObject(new Da.a(a)),this.clearDirectionStates()}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(Kr(t,"threshold",10)),this.setMinDragVelocity(Kr(t,"velocityThreshold",1e3)),this.setDirectionMode(Kr(t,"dir","8dir")),this}onDragStart(){this.state=qr}onDragEnd(){this.state=Qr}onDrag(){this.state===qr&&(this.vaildDrag||(this.vaildDrag=0===this.dragThreshold||this.pointer.getDistance()>=this.dragThreshold),this.vaildDrag&&this.dragVelocity>this.minDragVelocity&&(this.state=$r))}postUpdate(t,e){this.state===$r&&(this.state=Qr)}get isSwiped(){return this.state===$r}get dragVelocity(){var t;switch(this.dirMode){case 0:t=this.getVelocityX();break;case 1:t=this.getVelocityY();break;default:t=this.getVelocity()}return t}setDragThreshold(t){return this.dragThreshold=t,this}setMinDragVelocity(t){return this.minDragVelocity=t,this}setDirectionMode(t){return"string"==typeof t&&(t=Gr[t]),this.dirMode=t,this}updateDirectionStates(){var t=Jr(this.getVelocityAngle());return angletodirections_AngleToDirections(t,this.dirMode,this),this}clearDirectionStates(){return this.left=!1,this.right=!1,this.up=!1,this.down=!1,this}}Object.assign(Zr.prototype,Yr);const Qr="IDLE",qr="BEGIN",$r="RECOGNIZED";var tn=Zr;ie.register("swipe",(function(t,e){return system_IsGameObject(t)||(e=t,t=this.scene),new tn(t,e)})),object_SetValue(window,"RexPlugins.UI.Swipe",tn);const en=Phaser.Utils.Objects.GetValue;const an="IDLE",rn="BEGIN",nn="RECOGNIZED";var sn=class extends Sa{constructor(t,e){super(t,e);var i=this,a={states:{IDLE:{},BEGIN:{enter:function(){var t=i.pointer;i.startX=t.x,i.startY=t.y,i.startWorldX=t.worldX,i.startWorldY=t.worldY}},RECOGNIZED:{enter:function(){i.emit("panstart",i,i.gameObject,i.lastPointer)},exit:function(){var t=i.lastPointer;i.endX=t.x,i.endY=t.y,i.endWorldX=t.worldX,i.endWorldY=t.worldY,i.emit("panend",i,i.gameObject,i.lastPointer)}}},init:function(){this.state=an},eventEmitter:!1};this.setRecongizedStateObject(new Da.a(a))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(en(t,"threshold",10)),this}onDragStart(){this.state=0===this.dragThreshold?nn:rn}onDragEnd(){this.state=an}onDrag(){switch(this.state){case rn:this.pointer.getDistance()>=this.dragThreshold&&(this.state=nn);break;case nn:var t=this.pointer.position,e=this.pointer.prevPosition;this.dx=t.x-e.x,this.dy=t.y-e.y;var i=this.pointer;self.x=i.x,self.y=i.y,self.worldX=i.worldX,self.worldY=i.worldY,this.emit("pan",this)}}get isPan(){return this.state===nn}setDragThreshold(t){return this.dragThreshold=t,this}};ie.register("pan",(function(t,e){return system_IsGameObject(t)||(e=t,t=this.scene),new sn(t,e)})),object_SetValue(window,"RexPlugins.UI.Pan",sn);const on=Phaser.Utils.Objects.GetValue,hn=Phaser.Utils.Array.SpliceOne,ln=Phaser.Math.Distance.Between,cn=Phaser.Math.Angle.Between;class un{constructor(t,e){var i=t.input.manager.pointersTotal-1;i<2&&t.input.addPointer(2-i),this.scene=t,this.setEventEmitter(on(e,"eventEmitter",void 0)),this.pointers=[],this.movedState={},this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setEnable(on(t,"enable",!0)),this.bounds=on(t,"bounds",void 0),this.tracerState=pn,this.pointers.length=0,Object(Ji.a)(this.movedState),this}boot(){this.scene.input.on("pointerdown",this.onPointerDown,this),this.scene.input.on("pointerup",this.onPointerUp,this),this.scene.input.on("pointermove",this.onPointerMove,this),this.scene.events.once("shutdown",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.pointers.length=0,Object(Ji.a)(this.movedState),this.scene&&(this.scene.input.off("pointerdown",this.onPointerDown,this),this.scene.input.off("pointerup",this.onPointerUp,this),this.scene.input.off("pointermove",this.onPointerMove,this),this.scene.events.off("destroy",this.destroy,this),this.scene=void 0),this.scene=void 0}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||this.dragCancel(),this.enable=t,this)}onPointerDown(t){if(this.enable&&(2!==this.pointers.length&&(!this.bounds||this.bounds.contains(t.x,t.y))&&-1===this.pointers.indexOf(t)))switch(this.movedState[t.id]=!1,this.pointers.push(t),this.tracerState){case pn:this.tracerState=mn,this.onDrag1Start();break;case mn:this.tracerState=fn,this.onDrag2Start()}}onPointerUp(t){if(this.enable&&(!this.bounds||this.bounds.contains(t.x,t.y))){var e=this.pointers.indexOf(t);if(-1!==e)switch(delete this.movedState[t.id],hn(this.pointers,e),this.tracerState){case mn:this.tracerState=pn,this.onDrag1End();break;case fn:this.tracerState=mn,this.onDrag2End(),this.onDrag1Start()}}}onPointerMove(t){if(this.enable&&t.isDown){var e=!this.bounds||this.bounds.contains(t.x,t.y),i=-1!==this.pointers.indexOf(t);if(!i&&e);else if(i&&!e)this.onPointerUp(t);else if(this.movedState[t.id]||(this.movedState[t.id]=t.x!==t.downX||t.y!==t.downY),this.movedState[t.id])switch(this.tracerState){case mn:this.onDrag1();break;case fn:this.onDrag2()}}}dragCancel(){return this.tracerState===fn&&this.onDrag2End(),this.pointers.length=0,Object(Ji.a)(this.movedState),this.tracerState=pn,this}onDrag1Start(){this.emit("drag1start",this)}onDrag1End(){this.emit("drag1end",this)}onDrag1(){this.emit("drag1",this)}onDrag2Start(){this.emit("drag2start",this)}onDrag2End(){this.emit("drag2end",this)}onDrag2(){this.emit("drag2",this)}get distanceBetween(){if(this.tracerState!==fn)return 0;var t=this.pointers[0],e=this.pointers[1];return ln(t.x,t.y,e.x,e.y)}get angleBetween(){if(this.tracerState!==fn)return 0;var t=this.pointers[0],e=this.pointers[1];return cn(t.x,t.y,e.x,e.y)}get drag1Vector(){var t=this.pointers[0];if(t&&this.movedState[t.id]){var e=t.position,i=t.prevPosition;dn.x=e.x-i.x,dn.y=e.y-i.y}else dn.x=0,dn.y=0;return dn}get centerX(){if(this.tracerState!==fn)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.x+e.x)/2}get centerY(){if(this.tracerState!==fn)return 0;var t=this.pointers[0].position,e=this.pointers[1].position;return(t.y+e.y)/2}get prevCenterX(){if(this.tracerState!==fn)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.x+e.x)/2}get prevCenterY(){if(this.tracerState!==fn)return 0;var t=this.movedState[this.pointers[0].id]?this.pointers[0].prevPosition:this.pointers[0].position,e=this.movedState[this.pointers[1].id]?this.pointers[1].prevPosition:this.pointers[1].position;return(t.y+e.y)/2}get movementCenterX(){return this.centerX-this.prevCenterX}get movementCenterY(){return this.centerY-this.prevCenterY}setRecongizedStateObject(t){return this.recongizedState=t,this}get state(){return this.recongizedState.state}set state(t){this.recongizedState.state=t}cancel(){return this.state=gn,this}}Object.assign(un.prototype,Gt.a);var dn={};const pn=0,mn=1,fn=2,gn="IDLE";var yn=un;const _n=Phaser.Utils.Objects.GetValue;const vn="IDLE",bn="BEGIN",Pn="RECOGNIZED";var Sn=class extends yn{constructor(t,e){super(t,e);var i=this,a={states:{IDLE:{enter:function(){i.prevDistance=void 0,i.scaleFactor=1}},BEGIN:{},RECOGNIZED:{enter:function(){i.emit("pinchstart",i)},exit:function(){i.emit("pinchend",i)}}},init:function(){this.state=vn},eventEmitter:!1};this.setRecongizedStateObject(new Da.a(a))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(_n(t,"threshold",0)),this}onDrag2Start(){this.scaleFactor=1,this.prevDistance=this.distanceBetween,this.state=0===this.dragThreshold?Pn:bn}onDrag2End(){this.state=vn}onDrag2(){switch(this.state){case bn:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.prevDistance=t,this.state=Pn}break;case Pn:t=this.distanceBetween;this.scaleFactor=t/this.prevDistance,this.emit("pinch",this),this.prevDistance=t}}get isPinch(){return this.state===Pn}setDragThreshold(t){return this.dragThreshold=t,this}};ie.register("pinch",(function(t){return new Sn(this.scene,t)})),object_SetValue(window,"RexPlugins.UI.Pinch",Sn);const Dn=Phaser.Math.RotateAround;var actions_RotateObjectAround=function(t,e,i,a){return Dn(t,e,i,a),t.rotation+=a,t},Tn={},rotate_SpinObject=function(t,e){if(!this.isRotation)return this;void 0===e&&(e=this.pointers[0].camera);var i=this.movementCenterX,a=this.movementCenterY;e.getWorldPoint(this.centerX,this.centerY,Tn);var r=Tn.x,n=Tn.y,s=this.rotation;if(Array.isArray(t))for(var o=t,h=0,l=o.length;h<l;h++)(t=o[h]).x+=i,t.y+=a,actions_RotateObjectAround(t,r,n,s);else t.x+=i,t.y+=a,actions_RotateObjectAround(t,x,y,s);return this};const xn=Phaser.Utils.Objects.GetValue,Cn=Phaser.Math.Angle.WrapDegrees,On=Phaser.Math.Angle.ShortestBetween,Mn=Phaser.Math.RadToDeg,wn=Phaser.Math.DegToRad;class An extends yn{constructor(t,e){super(t,e);var i=this,a={states:{IDLE:{enter:function(){i.prevAngle=void 0,i.angle=0}},BEGIN:{},RECOGNIZED:{enter:function(){i.emit("rotatestart",i)},exit:function(){i.emit("rotateend",i)}}},init:function(){this.state=Bn},eventEmitter:!1};this.setRecongizedStateObject(new Da.a(a))}resetFromJSON(t){return super.resetFromJSON(t),this.setDragThreshold(xn(t,"threshold",0)),this}onDrag2Start(){this.prevAngle=Cn(Mn(this.angleBetween)),this.state=0===this.rotationThreshold?kn:In}onDrag2End(){this.state=Bn}onDrag2(){switch(this.state){case In:if(this.pointers[0].getDistance()>=this.dragThreshold&&this.pointers[1].getDistance()>=this.dragThreshold){var t=Cn(Mn(this.angleBetween));this.angle=On(this.prevAngle,t),this.prevAngle=t,this.state=kn}break;case kn:t=Cn(Mn(this.angleBetween));this.angle=On(this.prevAngle,t),this.prevAngle=t,this.emit("rotate",this)}}get isRotation(){return this.state===kn}get rotation(){return wn(this.angle)}setDragThreshold(t){return this.dragThreshold=t,this}}var En={spinObject:rotate_SpinObject};Object.assign(An.prototype,En);const Bn="IDLE",In="BEGIN",kn="RECOGNIZED";var Rn=An;ie.register("rotate",(function(t){return new Rn(this.scene,t)})),object_SetValue(window,"RexPlugins.UI.Rotate",Rn);const jn=Phaser.Utils.Objects.IsPlainObject,Ln=Phaser.Utils.Objects.GetValue;var flip_GetFaceUpdatingCallback=function(t,e,i){var a;if(void 0===t)t=i.texture.key,e=i.frame.name;else if(jn(t)){var r=t;t=Ln(r,"key",i.texture.key),e=Ln(r,"frame",i.frame.name)}else"string"==typeof t||(a=t);return void 0===a&&(a=function(i){i.setTexture(t,e)}),a};const Fn=Phaser.Utils.Objects.GetValue,Nn=Phaser.Utils.Objects.GetAdvancedValue;class Un{constructor(t,e){this.gameObject=t,this.scene=Object(Xt.a)(t),this.setEventEmitter(Fn(e,"eventEmitter",void 0)),this.scaleStart={},this.scaleEnd={},this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setOrientation(Fn(t,"orientation",0)),this.setDelay(Nn(t,"delay",0)),this.setDuration(Nn(t,"duration",500)),this.setEase(Fn(t,"ease","Sine")),this.setFrontFace(Fn(t,"front",void 0)),this.setBackFace(Fn(t,"back",void 0)),this.setFace(Fn(t,"face",0)),this}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.destroyEventEmitter(),this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setOrientation(t){return"string"==typeof t&&(t=Vn[t]),this.orientation=t,this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}setEase(t){return void 0===t&&(t="Linear"),this.ease=t,this}get isRunning(){return!!this.tween}get face(){return this._face}set face(t){"string"==typeof t&&(t=Hn[t]),this._face=t,0===t&&this.frontFaceCallback?this.frontFaceCallback(this.gameObject):1===t&&this.backFaceCallback&&this.backFaceCallback(this.gameObject)}setFace(t){return this.face=t,this}toggleFace(){var t=0===this.face?1:0;return this.setFace(t),this}setFrontFace(t,e){return this.frontFaceCallback=flip_GetFaceUpdatingCallback(t,e,this.gameObject),this}setBackFace(t,e){return this.backFaceCallback=flip_GetFaceUpdatingCallback(t,e,this.gameObject),this}start(){if(this.isRunning)return this;if(0===this.duration)return this.toggleFace().complete(),this;var t={targets:this.gameObject,duration:this.duration/2,ease:this.ease,yoyo:!0,repeat:0,onYoyo:this.toggleFace,onYoyoScope:this,onComplete:this.complete,onCompleteScope:this};return t[0===this.orientation?"scaleX":"scaleY"]={from:1,to:0},this.tween=this.scene.tweens.add(t),this}restart(){return this.stop().start(),this}flip(t){return this.isRunning?this:(void 0!==t&&this.setDuration(t),this.start(),this)}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),this.emit("complete",this,this.gameObject),this}}Object.assign(Un.prototype,Gt.a);const Vn={x:0,horizontal:0,y:1,vertical:1},Hn={front:0,back:1};var Wn=Un;ie.register("flip",(function(t,e){return new Wn(t,e)})),object_SetValue(window,"RexPlugins.UI.Flip",Wn);const zn=Phaser.Utils.Objects.GetValue;var textedit_CreateInputText=function(t,e){void 0===e&&(e={});var i=t.scene,a=t.style,r=zn(e,"backgroundColor",a.backgroundColor);null===r&&(r="transparent"),e.text=zn(e,"text",t.text),e.fontFamily=zn(e,"fontFamily",a.fontFamily),e.fontSize=zn(e,"fontSize",a.fontSize),e.color=zn(e,"color",a.color),e.backgroundColor=r;var n=new jt.a(i,t.x,t.y,zn(e,"width",t.width),zn(e,"height",t.height),e);return n.setOrigin(t.originX,t.originY),i.add.existing(n),n},object_IsFunction=function(t){return t&&"function"==typeof t};const Yn=Phaser.Utils.Objects.GetValue;var Gn=void 0,Xn=class{constructor(t){this.gameObject=t,this.scene=Object(Xt.a)(t),this.inputText=void 0,this.onClose=void 0,this.delayCall=void 0,this.boot()}boot(){return this.gameObject.once("destroy",this.destroy,this),this}shutdown(){return this.close(),this.gameObject=void 0,this.scene=void 0,Gn===this&&(Gn=void 0),this}destroy(){return this.shutdown(),this}open(t,e){void 0!==Gn&&Gn.close(),Gn=this,object_IsFunction(t)&&(e=t,t=void 0),void 0===e&&(e=Yn(t,"onClose",void 0));var i=Yn(t,"onTextChanged",void 0);return this.inputText=textedit_CreateInputText(this.gameObject,t).on("textchange",(function(t){var e=t.text;i?i(this.gameObject,e):this.gameObject.text=e}),this).setFocus(),this.gameObject.setVisible(!1),this.onClose=e,this.scene.input.keyboard.once("keydown-ENTER",this.close,this),this.delayCall=this.scene.time.delayedCall(0,(function(){this.scene.input.once("pointerdown",this.close,this)}),[],this),this}close(){return Gn=void 0,this.inputText?(this.gameObject.setVisible(!0),this.inputText.destroy(),this.inputText=void 0,this.delayCall&&(this.delayCall.remove(),this.delayCall=void 0),this.scene.input.keyboard.off("keydown-ENTER",this.close,this),this.scene.input.off("pointerdown",this.close,this),this.onClose&&this.onClose(this.gameObject),this):this}get isOpened(){return void 0!==this.inputText}get text(){return this.isOpened?this.inputText.text:this.gameObject.text}};class Kn extends Phaser.Plugins.ScenePlugin{constructor(t,e){super(t,e),this.add=new ie(t)}}var Jn={hide:Hide,show:Show,isShown:IsShown,edit:function(t,e,i){return t._edit||(t._edit=new Xn(t)),t._edit.open(e,i),t._edit}};Object.assign(Kn.prototype,Jn);var Zn=Kn,Qn=i(37),qn=i(132),$n=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),ts=function(t){function StorageModel(e){var i=t.call(this)||this;return i.mWorld=e,i.initialize=!1,i.mWorld.connection.addPacketListener(i),i.mConnect=i.mWorld.connection,i}return $n(StorageModel,t),StorageModel.prototype.getInitialize=function(){return this.initialize},StorageModel.prototype.register=function(){},StorageModel.prototype.unRegister=function(){},StorageModel.NAME="StorageModel",StorageModel}(r.PacketHandler),es=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),is=function(t){function ModelManager(e){var i=t.call(this)||this;return i.mWorld=e,i.init(),i}return es(ModelManager,t),ModelManager.prototype.init=function(){this.mModelClassDic={},this.mModelDic={},this.mModelClassDic[yt.a.NAME]=yt.a,this.mModelClassDic[_t.a.NAME]=_t.a,this.mModelClassDic[Qn.a.NAME]=Qn.a,this.mModelClassDic[qn.a.NAME]=qn.a,this.mModelClassDic[ts.NAME]=ts},ModelManager.prototype.getModel=function(t){var e=this.mModelDic[t];return e||(e=this.mModelDic[t]=new this.mModelClassDic[t](this.mWorld)),e},ModelManager}(Phaser.Events.EventEmitter),as=/\.pi$/i,rs=i(78),ns=i(79),ss=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),os=function(t){function LoginScene(){var e=t.call(this,{key:LoginScene.name})||this;return e.mCurTabIndex=0,e}return ss(LoginScene,t),LoginScene.prototype.preload=function(){this.load.atlas("login","./resources/ui/login/login.png","./resources/ui/login/login.json")},LoginScene.prototype.create=function(){var t=this.scale.gameSize.width,e=this.scale.gameSize.height,i=this.add.graphics();i.fillStyle(0),i.fillRect(0,0,t,e);var a=localStorage.getItem("account"),r=this.make.image(void 0,!1);r.setTexture("login","login_logo"),this.mParentCon=this.add.container(t>>1,100+(e>>1)),this.mBg=this.make.image(void 0,!1),this.mEnterBtn=this.make.image(void 0,!1),this.mEnterBtn.setTexture("login","login_loginBtn"),this.mEnterBtn.x=123,this.mQuickBtn=this.make.image(void 0,!1),this.mQuickBtn.setTexture("login","login_quickBtn"),this.mQuickBtn.x=123,this.mQuickBtn.y=-38,this.mSendCodeBtn=this.make.image(void 0,!1),this.mSendCodeBtn.setTexture("login","login_sendBtn"),this.mSendCodeBtn.x=10,this.mSendCodeBtn.y=67,this.mTab0=this.make.image(void 0,!1),this.mTab0.setTexture("login","login_tabSelect"),this.mTab0.x=-105,this.mTab0.y=-38,this.mTab1=this.make.image(void 0,!1),this.mTab1.setTexture("login","login_tabUnSelect"),this.mTab1.x=7,this.mTab1.y=-38,this.mInputBg_long0=this.make.image(void 0,!1),this.mInputBg_long0.setTexture("login","login_inputLong"),this.mInputBg_long0.x=-50,this.mInputBg_long0.y=15,this.mInputBg_long1=this.make.image(void 0,!1),this.mInputBg_long1.setTexture("login","login_inputLong"),this.mInputBg_long1.x=-50,this.mInputBg_long1.y=67,this.mInputBg_small=this.make.image(void 0,!1),this.mInputBg_small.setTexture("login","login_inputBg"),this.mInputBg_small.x=-105,this.mInputBg_small.y=67,this.mTabDic=new Map,this.mNameInputTxt=new jt.a(this,-140,4,190,15,{type:"input",placeholder:"用戶名",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(200,20).setOrigin(0,0),this.mPassWordInputTxt=new jt.a(this,-140,55,190,15,{type:"password",placeholder:"密码",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(200,20).setOrigin(0,0),this.mVerificationCodeTxt=new jt.a(this,-140,55,100,15,{type:"input",placeholder:"验证码",fontFamily:"YaHei",fontSize:"14px",color:"#847C7C"}).resize(100,20).setOrigin(0,0),this.mtxt0=this.add.text(-145,-46,"手机号登录",{fontFamily:"YaHei"}),this.mtxt1=this.add.text(-35,-46,"用户号登录",{fontFamily:"YaHei"}),this.mtxt2=this.add.text(90,-46,"快速游戏",{fontFamily:"YaHei"}),this.mtxt3=this.add.text(108,33,"登录",{fontFamily:"YaHei"}),this.mtxt4=this.add.text(-97,37,"登录其他账号",{fontFamily:"YaHei"}),this.mtxt5=this.add.text(-6,57,"发送",{fontFamily:"YaHei"});var n={wid:220,hei:36,resKey:"login",resPng:"./resources/ui/login/login.png",resJson:"./resources/ui/login/login.json",resBg:"login_inputLong",resArrow:"login_downArrow",fontStyle:{size:20,color:"#ffcc00",bold:!1},up:!0,clickCallBack:this.changeID};this.combobox=new ns.ComboBox(this,n),this.combobox.x=-158,this.combobox.y=-28,this.changePanelState(a),this.mParentCon.add(r),this.mParentCon.add(this.mBg),this.mParentCon.add(this.mTab0),this.mParentCon.add(this.mTab1),this.mParentCon.add(this.mQuickBtn),this.mParentCon.add(this.mEnterBtn),this.mParentCon.add(this.mSendCodeBtn),this.mParentCon.add(this.mInputBg_long0),this.mParentCon.add(this.mInputBg_long1),this.mParentCon.add(this.mInputBg_small),this.mParentCon.add(this.mNameInputTxt),this.mParentCon.add(this.mPassWordInputTxt),this.mParentCon.add(this.mVerificationCodeTxt),this.mParentCon.add(this.mtxt0),this.mParentCon.add(this.mtxt1),this.mParentCon.add(this.mtxt2),this.mParentCon.add(this.mtxt3),this.mParentCon.add(this.mtxt4),this.mParentCon.add(this.mtxt5),this.mParentCon.add(this.combobox),r.x=-30,r.y=-r.height/2-80,this.mTab0.setInteractive(),this.mTab1.setInteractive(),this.mQuickBtn.setInteractive(),this.mEnterBtn.setInteractive(),this.mSendCodeBtn.setInteractive(),this.mtxt4.setInteractive(),this.mTab0.tabIndex=0,this.mTab1.tabIndex=1,this.mTabDic.set(this.mTab0.tabIndex,this.mTab0),this.mTabDic.set(this.mTab1.tabIndex,this.mTab1),this.mCurTabIndex=0,this.mTab0.on("pointerdown",this.tab0Handler,this),this.mTab1.on("pointerdown",this.tab1Handler,this),this.mQuickBtn.on("pointerdown",this.quickHandler,this),this.mEnterBtn.on("pointerdown",this.enterHandler,this),this.mSendCodeBtn.on("pointerdown",this.sendCodeHandler,this),this.mtxt4.on("pointerdown",this.changeAccount,this),this.mParentCon.scaleX=this.mParentCon.scaleY=this.mWorld.uiScale},LoginScene.prototype.init=function(t){this.mConnect=t.connect,this.mCallBack=t.callBack,this.mWorld=t.world},LoginScene.prototype.update=function(){},LoginScene.prototype.awake=function(){this.scene.wake()},LoginScene.prototype.sleep=function(){this.scene.sleep()},LoginScene.prototype.remove=function(){this.scene.remove()},LoginScene.prototype.getKey=function(){return this.sys.config.key},LoginScene.prototype.changeID=function(t){o.a.debug("============combobox 123"+t.text)},LoginScene.prototype.changeAccount=function(){this.changePanelState(void 0)},LoginScene.prototype.changePanelState=function(t){var e=!t;this.verificaHandler(e);var i=t?"login_quickLoginBg":"login_loginBgBig";this.mBg.setTexture("login",i),this.mEnterBtn.y=t?15:40,this.mInputBg_long0.visible=!t,this.mtxt3.y=t?8:35,this.mNameInputTxt.visible=!t,this.combobox.visible=!!t,this.mQuickBtn.visible=!t,this.mTab0.visible=!t,this.mTab1.visible=!t,this.mInputBg_long1.visible=!t&&0!==this.mCurTabIndex,this.mPassWordInputTxt.visible=!t&&0!==this.mCurTabIndex,this.mtxt0.visible=!t,this.mtxt1.visible=!t,this.mtxt2.visible=!t,this.mtxt4.visible=!!t;var a=void 0!==t?JSON.parse(t):void 0;this.mNameInputTxt.text=a?a.account:"",this.combobox.text=a?[a.account+""]:[""],this.mPassWordInputTxt.text=a?a.password:"",this.mParentCon.setSize(this.mBg.width,this.mBg.height)},LoginScene.prototype.verificaHandler=function(t){this.mVerificationCodeTxt.visible=t,this.mtxt5.visible=t,this.mInputBg_small.visible=t,this.mSendCodeBtn.visible=t,this.mInputBg_long1.visible=!t,this.mPassWordInputTxt.visible=!t},LoginScene.prototype.quickHandler=function(){this.addTween(this.mQuickBtn)},LoginScene.prototype.sendCodeHandler=function(){this.addTween(this.mSendCodeBtn)},LoginScene.prototype.enterHandler=function(){this.addTween(this.mEnterBtn),this.requestLogin()},LoginScene.prototype.addTween=function(t){this.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=t.scaleY=1},LoginScene.prototype.tab0Handler=function(t){this.mCurTabIndex=0,this.tabHandler()},LoginScene.prototype.tab1Handler=function(t){this.mCurTabIndex=1,this.tabHandler()},LoginScene.prototype.tabHandler=function(){var t=this;this.mTabDic.forEach((function(e){var i;i=e.tabIndex===t.mCurTabIndex?"login_tabSelect":"login_tabUnSelect",e.setTexture("login",i)})),this.verificaHandler(!this.mCurTabIndex)},LoginScene.prototype.requestLogin=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){200===e.status?(localStorage.setItem("account",JSON.stringify({account:t.mNameInputTxt.text,password:t.mPassWordInputTxt.text})),t.mWorld.account.setAccount(JSON.parse(e.response)),t.mCallBack(e.responseText)):new rs.Alert(t.mWorld,t).show("账号密码错误")};e.open("POST","https://api.tooqing.com/account/signin"),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send(JSON.stringify({account:t.mNameInputTxt.text,password:t.mPassWordInputTxt.text}))},LoginScene.prototype.requestGetPhoneCode=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){200===e.status||new rs.Alert(t.mWorld,t).show("验证码获取失败")};e.open("POST","https://api.tooqing.com/account/sms_code"),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send()},LoginScene.prototype.loginByPhoneCode=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){200===e.status?(localStorage.setItem("accountphone",JSON.stringify({account:t.mNameInputTxt.text})),t.mWorld.account.setAccount(JSON.parse(e.response)),t.mCallBack(e.responseText)):new rs.Alert(t.mWorld,t).show("登录失败")};e.open("POST","https://api.tooqing.com/account/phone_signin"),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send()},LoginScene.prototype.requestQuickLogin=function(){var t=this,e=new XMLHttpRequest;e.onload=function(){200===e.status?(localStorage.setItem("accountphone",JSON.stringify({account:t.mNameInputTxt.text})),t.mWorld.account.setAccount(JSON.parse(e.response)),t.mCallBack(e.responseText)):new rs.Alert(t.mWorld,t).show("登录失败")};e.open("POST","https://api.tooqing.com/account/quick_signin"),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send()},LoginScene}(Phaser.Scene),hs=function(){function Account(){}return Account.prototype.setAccount=function(t){this.mCurAccountData={token:"",expire:0,fingerprint:""},Object.assign(this.mCurAccountData,t.data)},Object.defineProperty(Account.prototype,"accountData",{get:function(){return this.mCurAccountData},enumerable:!0,configurable:!0}),Account}();i.d(e,"World",(function(){return cs}));var ls=function(){var extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function __(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}}(),cs=function(t){function World(e,i){var a=t.call(this)||this;if(a.mCallBack=i,a.mConfig=e,!e.game_id)throw new Error("Config.game_id is required.");a._newGame(),a.mConnection=new m(a),a.mConnection.addPacketListener(a),a.addHandlerFun(n.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_VIRTUAL_WORLD_INIT,a.onInitVirtualWorldPlayerInit),a.addHandlerFun(n.op_client.OPCODE._OP_GATEWAY_RES_CLIENT_ERROR,a.onClientErrorHandler),a.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SELECT_CHARACTER,a.onSelectCharacter),a.mRoomMamager=new Pt(a),a.mMouseManager=new xt(a),a.mUiManager=new Et.UiManager(a),a.mElementStorage=new wt;var r=a.mConfig.server_addr||Object({host:"115.182.75.100",port:12100});return r&&a.mConnection.startConnect(r),a}return ls(World,t),World.prototype.destroy=function(){},World.prototype.onConnected=function(t){o.a.info("enterVirtualWorld"),this.login()},World.prototype.onDisConnected=function(t){},World.prototype.onError=function(t){},World.prototype.onClientErrorHandler=function(t){var e=t.content;o.a.error("Remote Error["+e.responseStatus+"]: "+e.msg)},World.prototype.changeRoom=function(t){this.mGame.device.os.desktop&&this.mInputManager.onRoomChanged(t),this.mMouseManager.changeRoom(t)},World.prototype.getSize=function(){if(this.mGame)return this.mGame.scale.gameSize},World.prototype.resize=function(t,e){this.mGame&&this.mGame.scale.resize(t,e),this.mRoomMamager&&this.mRoomMamager.resize(t,e),this.mUiManager&&this.mUiManager.resize(t,e),this.mInputManager&&this.mInputManager.resize(t,e)},Object.defineProperty(World.prototype,"uiScale",{get:function(){return this.mConfig?this.mConfig.ui_scale:1},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"game",{get:function(){return this.mGame},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"roomManager",{get:function(){return this.mRoomMamager},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"elementStorage",{get:function(){return this.mElementStorage},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"selectCharacterManager",{get:function(){return this.selectCharacterManager},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"uiManager",{get:function(){return this.mUiManager},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"inputManager",{get:function(){return this.mInputManager},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"connection",{get:function(){return this.mConnection},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"modelManager",{get:function(){return this.mModelManager},enumerable:!0,configurable:!0}),Object.defineProperty(World.prototype,"account",{get:function(){return this.mAccount},enumerable:!0,configurable:!0}),World.prototype.onSelectCharacter=function(){var t=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_CHARACTER_CREATED);this.connection.send(t)},World.prototype.login=function(){var t=this;this.mAccount=new hs,this.mGame.scene.getScene(os.name)||this.mGame.scene.add(os.name,os),this.mGame.scene.getScene(g.name)||this.mGame.scene.add(g.name,g),this.mGame.scene.start(os.name,{connect:this.mConnection,world:this,callBack:function(){t.enterVirtualWorld(),t.mGame.scene.getScene(os.name).remove(),t.mGame.scene.start(g.name,{world:t})}})},World.prototype.enterVirtualWorld=function(){if(this.mConfig&&this.mConnection){if(!this.mConfig.auth_token)return void this.login();var t=new r.PBpacket(n.op_gateway.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_PLAYER_INIT),e=t.content;o.a.log("VW_id: "+this.mConfig.virtual_world_id),e.virtualWorldUuid=""+this.mConfig.virtual_world_id,e.gameId=this.mConfig.game_id,e.userToken=this.mAccount.accountData.token,e.expire=this.mAccount.accountData.expire+"",e.fingerprint=this.mAccount.accountData.fingerprint,this.mConnection.send(t)}},World.prototype.onInitVirtualWorldPlayerInit=function(t){var e=this,i=t.content,a=i.configUrls;(!a||a.length<=0)&&o.a.error("configUrls error: , "+a+", gameId: "+this.mConfig.game_id),this.loadGameConfig(i.configUrls).then((function(t){e.mElementStorage.setGameConfig(t),e.createGame(i.keyEvents),o.a.debug("created game suc")})).catch((function(t){o.a.log(t)}))},World.prototype._newGame=function(){if(this.mGame)return this.mGame;var t={type:Phaser.AUTO,zoom:1,parent:"game",scene:null,disableContextMenu:!0,transparent:!1,backgroundColor:0,resolution:1,fps:{target:60},dom:{createContainer:!0},plugins:{global:[{key:"rexButton",plugin:te,start:!0},{key:"rexNinePatchPlugin",plugin:Rt,start:!0},{key:"rexInputText",plugin:Ut,start:!0},{key:"rexBBCodeTextPlugin",plugin:Yt,start:!0}],scene:[{key:"DragonBones",plugin:dragonBones.phaser.plugin.DragonBonesScenePlugin,mapping:"dragonbone"},{key:"rexUI",plugin:Zn,mapping:"rexUI"}]},render:{pixelArt:!0,roundPixels:!0}};return Object.assign(t,this.mConfig),this.mGame=new a.Game(t)},World.prototype.createGame=function(t){this._newGame(),this.mGame.scene.add(P.name,P),this.mGame.scene.add(v.name,v),this.mGame.events.on(Phaser.Core.Events.FOCUS,this.onFocus,this),this.mGame.events.on(Phaser.Core.Events.BLUR,this.onBlur,this),this.mModelManager=new is(this),this.mGame.device.os.desktop?this.mInputManager=new Dt(this,t):this.mInputManager=new Ct(this,t),this.gameCreated()},World.prototype.gameCreated=function(){if(this.connection){var t=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_GAME_CREATED);this.connection.send(t),this.mCallBack&&this.mCallBack()}else o.a.error("connection is undefined")},World.prototype.loadGameConfig=function(t){for(var e=this,i=[],a="",r=0,n=t;r<n.length;r++){var s=n[r];as.test(s)&&(a=S.d.getGameConfig(s),o.a.log("start download config: "+a),i.push(load(a,"arraybuffer")))}return Promise.all(i).then((function(t){return o.a.log("start decodeConfig"),e.decodeConfigs(t)}))},World.prototype.decodeConfigs=function(t){return new Promise((function(e,i){for(var a=0,r=t;a<r.length;a++){var n=r[a].response;if(n)try{var s=new At.Lite;s.deserialize(new Uint8Array(n)),e(s)}catch(t){i(t)}else i("error")}}))},World.prototype.onFocus=function(){if(this.connection){var t=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=n.op_def.GameStatus.Focus,this.connection.send(t),this.mRoomMamager.onFocus()}else o.a.error("connection is undefined")},World.prototype.onBlur=function(){if(this.connection){var t=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_GAME_STATUS);t.content.gameStatus=n.op_def.GameStatus.Blur,this.connection.send(t),this.mRoomMamager.onBlur()}else o.a.error("connection is undefined")},World}(r.PacketHandler)},,,function(t,e,i){"use strict";var a;i.d(e,"a",(function(){return a})),function(t){t.log=function log(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.log.apply(console,[t].concat(e))},t.error=function error(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.error.apply(console,[t].concat(e))},t.warn=function warn(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.warn.apply(console,[t].concat(e))},t.debug=function debug(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.log.apply(console,[t].concat(e))},t.info=function info(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];console.info.apply(console,[t].concat(e))}}(a||(a={}))},,,function(t,e,i){"use strict";i.d(e,"e",(function(){return a})),i.d(e,"d",(function(){return r})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return o}));var a=function(){function Url(){}return Url.getRes=function(t){return Object({api_root:"https://api.tooqing.com/",osd:"https://osd.tooqing.com/",gateway:Object({host:"115.182.75.100",port:12100}),auth_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjVjYzQyZmI5NzBlZDc4MjExOWExZjg0MSIsImlhdCI6MTU2OTIwNjkwOSwiZXhwIjoxNTY5ODExNzA5fQ.1qu7OLM74FY5b9VDWPCsUdLvKComZ6b5rmtKAd-SBCQ",token_expire:"1569811709",token_fingerprint:"f048a3203385f15580c5a7515add9c9ca5990aef",game_id:"5d28148554ae3d5c17bf1365",virtual_world_id:"0"}).BUNDLE_RESOURCES_ROOT?Object({api_root:"https://api.tooqing.com/",osd:"https://osd.tooqing.com/",gateway:Object({host:"115.182.75.100",port:12100}),auth_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjVjYzQyZmI5NzBlZDc4MjExOWExZjg0MSIsImlhdCI6MTU2OTIwNjkwOSwiZXhwIjoxNTY5ODExNzA5fQ.1qu7OLM74FY5b9VDWPCsUdLvKComZ6b5rmtKAd-SBCQ",token_expire:"1569811709",token_fingerprint:"f048a3203385f15580c5a7515add9c9ca5990aef",game_id:"5d28148554ae3d5c17bf1365",virtual_world_id:"0"}).BUNDLE_RESOURCES_ROOT+t:"./resources/"+t},Url.getOsdRes=function(t){return"https://osd.tooqing.com/"+t},Url}(),r=function(){function ResUtils(){}return ResUtils.getPartName=function(t){return t+"_png"},ResUtils.getPartUrl=function(t){return"https://osd.tooqing.com/avatar/part/"+t+".png"},ResUtils.getGameConfig=function(t){return"https://osd.tooqing.com/"+t},ResUtils}(),n=function(){function CloseButton(){}return CloseButton.getName=function(){return"common_clsBtn"},CloseButton.getPNG=function(){return a.getRes("ui/common_clsBtn.png")},CloseButton.getFrameConfig=function(){return{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}},CloseButton}(),s=function(){function Background(){}return Background.getName=function(){return"common_background"},Background.getPNG=function(){return a.getRes("ui/common/common_panelBg.png")},Background.getColumns=function(){return[11,9,11]},Background.getRows=function(){return[14,13,14]},Background}(),o=function(){function Border(){}return Border.getName=function(){return"common_border"},Border.getPNG=function(){return a.getRes("ui/common/common_border.png")},Border.getColumns=function(){return[4,2,4]},Border.getRows=function(){return[4,2,4]},Border}()},,,function(t,e,i){"use strict";var a=i(111);e.a=function(t){return Object(a.a)(t)?t:t.scene&&Object(a.a)(t.scene)?t.scene:t.parent&&t.parent.scene&&Object(a.a)(t.parent.scene)?t.parent.scene:void 0}},function(t,e,i){"use strict";i.r(e),i.d(e,"Panel",(function(){return s}));var a,r=i(5),n=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function Panel(e){var i=t.call(this,e)||this;return i.mWidth=0,i.mHeight=0,i.mScene=e,i.mInitialized=!1,i}return n(Panel,t),Panel.prototype.isShow=function(){return this.mShowing},Panel.prototype.hide=function(){this.destroy()},Panel.prototype.destroy=function(){t.prototype.destroy.call(this),this.mInitialized=!1,this.mWidth=0,this.mHeight=0},Panel.prototype.resize=function(){},Panel.prototype.show=function(t){this.mInitialized?this.init():this.preload()},Panel.prototype.update=function(t){},Panel.prototype.init=function(){this.mInitialized=!0},Panel.prototype.preload=function(){this.scene?(this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.loadComplete,this),this.scene.load.start()):r.a.error("scene does not exist")},Panel.prototype.loadComplete=function(t,e,i){this.mInitialized||this.init()},Panel}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";var texture_SetTexture=function(t,e,i){this.textureKey=t,this.columns.data=e,this.columns.count=e?e.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.rows.data=i,this.rows.count=i?i.length:0,this.rows.stretch=0,this.rows.minHeight=0;var a,r,n,s,o=this.scene.textures.get(t);if(!o)return this.redraw=!0,this;if(!e||!i)return this.redraw=!0,this;for(var h=0,l=0,c=0,u=i.length;c<u;c++){"number"==typeof i[c]&&(i[c]={height:i[c],stretch:c%2}),n=(a=i[c]).height,this.rows.stretch+=0|a.stretch,this.rows.minHeight+=a.stretch>0?0:n,h=0;for(var d=0,p=e.length;d<p;d++)"number"==typeof e[d]&&(e[d]={width:e[d],stretch:d%2}),s=(r=e[d]).width,0===c&&(this.columns.stretch+=0|r.stretch,this.columns.minWidth+=r.stretch>0?0:s),s>=1&&n>=1&&this.getFrameNameCallback(d,c)&&o.add(this.getFrameNameCallback(d,c),0,h,l,s,n),h+=s;l+=n}return this.redraw=!0,this},texture_UpdateTexture=function(){if(!this.redraw)return this;this.redraw=!1,this.clear();for(var t,e,i,a,r,n=this.width-this.columns.minWidth,s=this.height-this.rows.minHeight,o=this.columns.stretch>0?n/this.columns.stretch:0,h=this.rows.stretch>0?s/this.rows.stretch:0,l=0,c=0,u=0,d=this.rows.count;u<d;u++){r=0===(i=this.rows.data[u]).stretch?i.height:h*i.stretch,l=0;for(var p=0,m=this.columns.count;p<m;p++){var f;if(a=0===(e=this.columns.data[p]).stretch?e.width:o*e.stretch,t=this.getFrameNameCallback(p,u))if(0===i.stretch&&0===e.stretch)this.drawFrame(this.textureKey,t,l,c);else 0===this.getStretchMode(p,u)?(void 0===this._image&&(this._image=this.scene.make.image({add:!1,origin:{x:0,y:0}})),(f=this._image).setTexture(this.textureKey,t).setDisplaySize(a,r)):(void 0===this._tileSprite&&(this._tileSprite=this.scene.make.tileSprite({add:!1,origin:{x:0,y:0}})),(f=this._tileSprite).setTexture(this.textureKey,t).setSize(a,r)),this.draw(f,l,c);l+=a}c+=r}};const a=Phaser.Utils.Objects.IsPlainObject,r=Phaser.Utils.Objects.GetValue;var parseMode=function(t){return"string"==typeof t&&(t=n[t]),t};const n={scale:0,repeat:1};var utils_IsEdge=function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1},s={setTexture:texture_SetTexture,updateTexture:texture_UpdateTexture,setStretchMode:function(t){return a(t)?(this.stretchMode.edge=parseMode(r(t,"edge",0)),this.stretchMode.internal=parseMode(r(t,"internal",0))):(t=parseMode(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return utils_IsEdge.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal}},DefaultGetFrameNameCallback=function(t,e){return`${t},${e}`};const o=Phaser.GameObjects.RenderTexture,h=Phaser.Utils.Objects.IsPlainObject,l=Phaser.Utils.Objects.GetValue;class c extends o{constructor(t,e,i,a,r,n,s,o,c){h(e)?(e=l(c=e,"x",0),i=l(c,"y",0),a=l(c,"width",1),r=l(c,"height",1),n=l(c,"key",void 0),s=l(c,"columns",void 0),o=l(c,"rows",void 0)):h(a)?(a=l(c=a,"width",1),r=l(c,"height",1),n=l(c,"key",void 0),s=l(c,"columns",void 0),o=l(c,"rows",void 0)):h(n)&&(n=l(c=n,"key",void 0),s=l(c,"columns",void 0),o=l(c,"rows",void 0)),super(t,e,i,a,r),this.columns={},this.rows={},this.stretchMode={},this.redraw=!1,this._image=void 0,this._tileSprite=void 0,this.setOrigin(.5,.5),this.setGetFrameNameCallback(l(c,"getFrameNameCallback",void 0)),this.setTexture(n,s,o),this.setStretchMode(l(c,"stretchMode",0))}preDestroy(){this._image&&(this._image.destroy(),this._image=void 0),this._tileSprite&&(this._tileSprite.destroy(),this._tileSprite=void 0),super.preDestroy()}setGetFrameNameCallback(t){return void 0===t&&(t=DefaultGetFrameNameCallback),this.getFrameNameCallback=t,this}get minWidth(){return this.columns.minWidth}get minHeight(){return this.rows.minHeight}resize(t,e){return this.redraw=!0,super.resize(t,e),this.updateDisplayOrigin(),this}renderWebGL(t,e,i,a,r){this.updateTexture(),super.renderWebGL(t,e,i,a,r)}renderCanvas(t,e,i,a,r){this.updateTexture(),super.renderCanvas(t,e,i,a,r)}}Object.assign(c.prototype,s);e.a=c},function(t,e,i){"use strict";var a=i(30),sizer_GetChildrenWidth=function(t){if(this.rexSizer.hidden)return 0;void 0===t&&(t=!0);var e,i,a,r=0,n=this.sizerChildren;if(0===this.orientation)for(var s=0,o=n.length;s<o;s++)(e=n[s]).rexSizer.hidden||(a=0===e.rexSizer.proportion||t&&e.rexSizer.proportion>0?e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width:0,r+=a+=(i=e.rexSizer.padding).left+i.right);else for(s=0,o=n.length;s<o;s++)(e=n[s]).hasOwnProperty("rexSizer")&&(e.rexSizer.hidden||(a=e.isRexSizer?Math.max(e.minWidth,e.childrenWidth):e.width,a+=(i=e.rexSizer.padding).left+i.right,r=Math.max(a,r)));return r},sizer_GetChildrenHeight=function(t){if(this.rexSizer.hidden)return 0;void 0===t&&(t=!0);var e,i,a,r=0,n=this.sizerChildren;if(0===this.orientation)for(var s=0,o=n.length;s<o;s++)(e=n[s]).rexSizer.hidden||(a=e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height,a+=(i=e.rexSizer.padding).top+i.bottom,r=Math.max(a,r));else for(s=0,o=n.length;s<o;s++)(e=n[s]).hasOwnProperty("rexSizer")&&(e.rexSizer.hidden||(a=0===e.rexSizer.proportion||t&&e.rexSizer.proportion>0?e.isRexSizer?Math.max(e.minHeight,e.childrenHeight):e.height:0,r+=a+=(i=e.rexSizer.padding).top+i.bottom));return r},sizer_GetChildrenProportion=function(){for(var t,e,i=0,a=this.sizerChildren,r=0,n=a.length;r<n;r++)(t=a[r]).rexSizer.hidden||(e=t.rexSizer.proportion)>0&&(i+=e);return i},sizer_GetChildrenSizers=function(t){void 0===t&&(t=[]);for(var e,i=this.sizerChildren,a=0,r=i.length;a<r;a++)(e=i[a]).isRexSizer&&t.push(e);return t},sizer_GetExpandedChildWidth=function(t,e){var i,a=e.rexSizer,r=a.padding;return 0===t.orientation?a.proportion>0&&t.proportionLength>0&&(i=a.proportion*t.proportionLength):a.expand&&(i=t.width-r.left-r.right),i},sizer_GetExpandedChildHeight=function(t,e){var i,a=e.rexSizer,r=a.padding;return 0===t.orientation?a.expand&&(i=t.height-r.top-r.bottom):a.proportion>0&&t.proportionLength>0&&(i=a.proportion*t.proportionLength),i},r=i(20),n=i(29);const s=Phaser.Display.Align.In.QuickSet;var o={getChildrenWidth:sizer_GetChildrenWidth,getChildrenHeight:sizer_GetChildrenHeight,getChildrenProportion:sizer_GetChildrenProportion,getChildrenSizers:sizer_GetChildrenSizers,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var a;if(this.layoutInit(t),void 0===e&&(e=Math.max(this.childrenWidth,this.minWidth)),void 0===i&&(i=Math.max(this.childrenHeight,this.minHeight)),this.resize(e,i),this.childrenProportion>0){var o=0===this.orientation?this.width-this.childrenWidth:this.height-this.childrenHeight;a=o>0?(o=0===this.orientation?this.width-this.getChildrenWidth(!1):this.height-this.getChildrenHeight(!1))/this.childrenProportion:0}else a=0;this.proportionLength=a;for(var h,l,c,u,d,p,m,f,g,y=this.sizerChildren,_=this.left,v=this.top,b=0,P=y.length;b<P;b++)(h=y[b]).rexSizer.hidden||(c=(l=h.rexSizer).padding,f=sizer_GetExpandedChildWidth(this,h),g=sizer_GetExpandedChildHeight(this,h),h.isRexSizer?h.layout(this,f,g):Object(r.a)(h,f,g),void 0===f&&(f=h.width),void 0===g&&(g=h.height),0===this.orientation?(u=_+c.left,p=0===l.proportion||0===a?f:l.proportion*a,d=v+c.top,m=this.height-c.top-c.bottom):(u=_+c.left,p=this.width-c.left-c.right,d=v+c.top,m=0===l.proportion||0===a?g:l.proportion*a),n.a.setPosition(u,d).setSize(p,m),s(h,n.a,l.align),this.resetChildPositionState(h),0===this.orientation?_+=p+c.left+c.right:v+=m+c.top+c.bottom);return this.layoutBackgrounds(),this},_layoutInit:function(){this._childrenWidth=void 0,this._childrenHeight=void 0,this._childrenProportion=void 0}},h=i(39),l=i(112),c=i(65);const u=Phaser.Utils.Objects.IsPlainObject,d=Phaser.Utils.Objects.GetValue,p=Phaser.Utils.Array.Remove,m=Phaser.Display.Align.CENTER;class f extends a.a{constructor(t,e,i,a,r,n){var s;u(e)?(e=d(s=e,"x",0),i=d(s,"y",0),a=d(s,"width",void 0),r=d(s,"height",void 0)):u(a)?(a=d(s=a,"width",void 0),r=d(s,"height",void 0)):u(n)&&(s=n),void 0!==s&&(n=d(s,"orientation",0)),void 0===n&&(n=0),super(t,e,i,a,r,s),this.type="rexSizer",this.sizerChildren=[],this.setOrientation(n)}destroy(t){this.scene&&(this.sizerChildren.length=0,super.destroy(t))}setOrientation(t){return"string"==typeof t&&(t=l.a[t]),this.orientation=t,this}add(t,e,i,a,r){super.add(t);var n=typeof e;if(null===e)return this;if("number"===n);else if("string"===n)e=g[e];else if(u(e)){var s;e=d(s=e,"proportion",0),i=d(s,"align",m),a=d(s,"padding",0),r=d(s,"expand",!1)}return"string"==typeof i&&(i=c.a[i]),void 0===e&&(e=0),void 0===i&&(i=m),void 0===a&&(a=0),void 0===r&&(r=!1),(s=this.getSizerConfig(t)).parent=this,s.proportion=e,s.align=i,s.padding=Object(h.a)(a),s.expand=r,this.sizerChildren.push(t),this}insert(t,e,i,a,r,n){return this.add(e,i,a,r,n),this.moveTo(e,t),this}remove(t){var e=this.getSizerConfig(t);return e.parent!==this?this:(e.parent=void 0,p(this.sizerChildren,t),super.remove(t),this)}clear(t){for(var e=0,i=this.sizerChildren.length;e<i;e++)this.getSizerConfig(this.sizerChildren[e]).parent=void 0;return this.sizerChildren.length=0,super.clear(t),this}get childrenProportion(){return void 0===this._childrenProportion&&(this._childrenProportion=this.getChildrenProportion()),this._childrenProportion}}Object.assign(f.prototype,o);const g={min:0,full:-1};e.a=f},function(t,e,i){"use strict";var a,r=function r(){},n=function(){function PlayerInfo(){this.uuid=0}return PlayerInfo.prototype.setInfo=function(t){var e;for(var i in t)(e=t[i])&&(this[i]=e)},PlayerInfo.prototype.getSlots=function(){if(void 0===this.slot)return null;for(var t,e,i=this.slot.length,a=[],n=0;n<i;n++)t=new r,e=this.getAttriByKey(this.slot[n].bondAttrCurkey),t.bondAttrCur=e.intVal,e=this.getAttriByKey(this.slot[n].bondAttrMaxkey),t.bondAttrMax=e.intVal,t.bondName=this.slot[n].bondName,t.color=this.slot[n].color,a.push(t);return a},PlayerInfo.prototype.getSlotByName=function(t){if(void 0===this.slot)return null;for(var e,i,a=this.slot.length,n=0;n<a;n++)if(this.slot[n].bondName===t)return e=new r,i=this.getAttriByKey(this.slot[n].bondAttrCurkey),e.bondAttrCur=i.intVal,i=this.getAttriByKey(this.slot[n].bondAttrMaxkey),e.bondAttrMax=i.intVal,e.bondName=this.slot[n].bondName,e.color=this.slot[n].color,e;return null},PlayerInfo.prototype.getAttriByKey=function(t){if(void 0===this.attributes)return null;for(var e=this.attributes.length,i=0;i<e;i++)if(this.attributes[i].name===t)return this.attributes[i];return null},Object.defineProperty(PlayerInfo.prototype,"originCollisionPoint",{get:function(){return this._originCollisionPoint},enumerable:!0,configurable:!0}),Object.defineProperty(PlayerInfo.prototype,"originWalkPoint",{get:function(){return this._originWalkPoint},enumerable:!0,configurable:!0}),PlayerInfo.prototype.setOriginCollisionPoint=function(t){void 0===this._originCollisionPoint&&(this._originCollisionPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originCollisionPoint.x=t[0],this._originCollisionPoint.y=t[1])},PlayerInfo.prototype.setOriginWalkPoint=function(t){void 0===this._originWalkPoint&&(this._originWalkPoint=new Phaser.Geom.Point),t&&t.length>1&&(this._originWalkPoint.x=t[0],this._originWalkPoint.y=t[1])},PlayerInfo}(),s=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),o=function(t){function MainPlayerInfo(){return t.call(this)||this}return s(MainPlayerInfo,t),MainPlayerInfo}(n),h=i(3),l=i(17);i.d(e,"a",(function(){return c}));var c=function(){function PlayerDataModel(t){this.mWorld=t,this.initialize=!1,this.mPlayerInfoList=[],this.mMainPlayerInfo=new o,this.mWorld.modelManager&&(this.mModelDispatch=this.mWorld.modelManager)}return PlayerDataModel.prototype.getInitialize=function(){return this.initialize},PlayerDataModel.prototype.register=function(){},PlayerDataModel.prototype.unRegister=function(){},Object.defineProperty(PlayerDataModel.prototype,"mainPlayerInfo",{get:function(){return this.mMainPlayerInfo},enumerable:!0,configurable:!0}),PlayerDataModel.prototype.setmainPlayerInfo=function(t){this.mMainPlayerInfo.setInfo(t),t.walkOriginPoint&&this.mMainPlayerInfo.setOriginWalkPoint(t.walkOriginPoint),t.originPoint&&this.mMainPlayerInfo.setOriginCollisionPoint(t.originPoint),!1===this.getInitialize()&&(this.initialize=!0,this.mModelDispatch.emit(l.a.PLAYER_DATA_INITIALIZE))},PlayerDataModel.prototype.addPlayer=function(t){var e=new n;e.setInfo(t),t.walkOriginPoint&&e.setOriginWalkPoint(t.walkOriginPoint),t.originPoint&&e.setOriginCollisionPoint(t.originPoint),this.mPlayerInfoList.push(e),this.mModelDispatch.emit(l.a.SCENE_ADD_PLAYER,e)},PlayerDataModel.prototype.updatePlayer=function(t){var e;if(this.mMainPlayerInfo.uuid===t.uuid)return this.mMainPlayerInfo.setInfo(t),void this.mModelDispatch.emit(l.a.SCENE_UPDATE_PLAYER,this.mMainPlayerInfo);for(var i=this.mPlayerInfoList.length-1;i>=0;i--)if((e=this.mPlayerInfoList[i]).uuid===t.uuid){e.setInfo(t),this.mModelDispatch.emit(l.a.SCENE_UPDATE_PLAYER,e);break}},PlayerDataModel.prototype.removePlayer=function(t){if(this.mMainPlayerInfo.uuid!==t){for(var e=this.mPlayerInfoList.length-1;e>=0;e--)if(this.mPlayerInfoList[e].uuid===t){this.mPlayerInfoList.splice(e,1),this.mModelDispatch.emit(l.a.SCENE_REMOVE_PLAYER,t);break}}else this.mModelDispatch.emit(l.a.SCENE_REMOVE_PLAYER,t)},PlayerDataModel.prototype.addPackItems=function(t,e){var i=this.getPlayer(t);i&&(i.package||(i.package=h.op_gameconfig.Package.create()),i.package.items=i.package.items.concat(e),i===this.mMainPlayerInfo&&this.mModelDispatch.emit(l.a.UPDATED_CHARACTER_PACKAGE))},PlayerDataModel.prototype.removePackItems=function(t,e){var i=this.getPlayer(t);if(i)for(var a=i.package.items.length,r=0;r<a;r++)if(e===i.package.items[r].id)return i.package.items.splice(r,1),!0;return!1},PlayerDataModel.prototype.getPlayer=function(t){var e=this.mPlayerInfoList.find((function(e){return e.id===t}));return!1==!!e&&t===this.mMainPlayerInfo.id?this.mMainPlayerInfo:e},Object.defineProperty(PlayerDataModel.prototype,"playInfoList",{get:function(){return this.mPlayerInfoList},enumerable:!0,configurable:!0}),PlayerDataModel.NAME="PlayerDataModel",PlayerDataModel}()},,function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var a=function(){function MessageType(){}return MessageType.CREATE_ROLE="create_role",MessageType.APP_START="app_start",MessageType.EDITOR_CHANGE_MODE="editor_change_mode",MessageType.CLIENT_RESIZE="app_client_resize",MessageType.SCENE_INITIALIZED="SCENE_INITIALIZED",MessageType.SCENE_CLEARED="SCENE_CLEARED",MessageType.SCENE_CHANGE_TO="SCENE_CHANGE_TO",MessageType.SCENE_MOVE_TO="scene_move_to",MessageType.SCENE_MOVE_STOP="scene_move_stop",MessageType.CHANGE_ELEMENT_ANIMATION="change_element_animation",MessageType.CHANGE_CHARACTER_ANIMATION="change_character_animation",MessageType.CHAT_TO="chat_to",MessageType.SHOW_CHAT_BUBBLE="show_chat_bubble",MessageType.REMOVE_CHAT_BUBBLE="remove_chat_bubble",MessageType.PROMPT_ALERT="prompt_alert",MessageType.CHARACTER_TALING="characterTaling",MessageType.CHARACTER_SHUT_UP="characterShutUp",MessageType.QCLOUD_AUTH="qcloud_auth",MessageType.ENTER_SCENE="enter_scene",MessageType.SCENE_ADD_PLAYER="scene_add_player",MessageType.SCENE_REMOVE_PLAYER="scene_remove_player",MessageType.SCENE_UPDATE_PLAYER="scene_update_player",MessageType.SCENE_ADD_ELEMENT="scene_add_element",MessageType.SCENE_ADD_TERRAIN="scene_add_terrain",MessageType.SCENE_ADD_TERRAIN_END="scene_add_terrain_end",MessageType.SCENE_ADD_ALL_TERRAIN="scene_add_all_terrain",MessageType.SCENE_REMOVE_ELEMENT="scene_remove_element",MessageType.SCENE_REMOVE_TERRAIN="scene_remove_terrain",MessageType.SCENE_REMOVE_ALL_TERRAIN="scene_remove_all_terrain",MessageType.SCENE_MOUSE_FOLLOW="scene_mouse_follow",MessageType.SCENE_SELECT_ELEMENT="scene_select_element",MessageType.SCENE_FIXED_TO_ELEMENT="scene_fixed_to_element",MessageType.SCENE_UPDATE_ELEMENT="sceneUpdateElement",MessageType.SCENE_SYNCHRO_PACKAGE="sceneSynchroPackage",MessageType.SCENE_VISIBLE_GRID="sceneVisibleGrid",MessageType.PLAYER_SELECT_CHARACTER="player_select_character",MessageType.PLAYER_DATA_INITIALIZE="player_data_initialize",MessageType.SCENE_DATA_INITIALIZE="scene_data_initialize",MessageType.PACKAGE_ITEM_ADD="package_item_add",MessageType.PACKAGE_ITEM_REMOVE="package_item_remove",MessageType.PACKAGE_EXCHANGE_ITEM_POS="package_exchange_item_pos",MessageType.SEFL_TARGET_START_MOVE="SEFL_TARGET_START_MOVE",MessageType.SEFL_TARGET_PAUSE_MOVE="SEFL_TARGET_PAUSE_MOVE",MessageType.SCENE_BACKGROUND_CLICK="SCENE_BACKGROUND_CLICK",MessageType.ADD_SCENE_ELEMENT="ADD_SCENE_ELEMENT",MessageType.REMOVE_SCENE_ELEMENT="REMOVE_SCENE_ELEMENT",MessageType.CHANGE_SELF_AVATAR="CHANGE_SELF_AVATAR",MessageType.DRAG_TO_DROP="DRAG_TO_DROP",MessageType.DRAG_OVER_DROP="DRAG_OVER_DROP",MessageType.GAME_GLOBALS_TICK="GAME_GLOBALS_TICK",MessageType.GAME_GLOBALS_FRAME="GAME_GLOBALS_FRAME",MessageType.MODULE_VIEW_ADD="module_view_add",MessageType.MODULE_VIEW_REM="module_view_rem",MessageType.SHOW_NOTICE="show_notice",MessageType.USER_UPDATED_VOICE_PEER="user_updated_voice_peer",MessageType.HIDE_VOICE="hide_voice",MessageType.QUERY_PACKAGE="query_package",MessageType.SYNC_USER_BALANCE="syncUserBalance",MessageType.UPDATED_CHARACTER_PACKAGE="updatedCharacterPackage",MessageType.SHOW_EFFECT="showEffect",MessageType}()},,function(t,e,i){"use strict";e.a=function(){}},function(t,e,i){"use strict";e.a=function(t,e,i){!t||void 0===e&&void 0===i||(t.resize?(void 0===e&&(e=t.width),void 0===i&&(i=t.height),t.resize(e,i)):(void 0!==e&&(t.displayWidth=e),void 0!==i&&(t.displayHeight=i)))}},function(t,e,i){"use strict";e.a={setEventEmitter(t,e){return void 0===e&&(e=Phaser.Events.EventEmitter),this._privateEE=void 0===t,this._eventEmitter=this._privateEE?new e:t,this},destroyEventEmitter(){this._eventEmitter&&this._privateEE&&this._eventEmitter.shutdown()},getEventEmitter(){return this._eventEmitter},on:function(){return this._eventEmitter&&this._eventEmitter.on.apply(this._eventEmitter,arguments),this},once:function(){return this._eventEmitter&&this._eventEmitter.once.apply(this._eventEmitter,arguments),this},off:function(){return this._eventEmitter&&this._eventEmitter.off.apply(this._eventEmitter,arguments),this},emit:function(){return this._eventEmitter&&this._eventEmitter.emit.apply(this._eventEmitter,arguments),this},addListener:function(){return this._eventEmitter&&this._eventEmitter.addListener.apply(this._eventEmitter,arguments),this},removeListener:function(){return this._eventEmitter&&this._eventEmitter.removeListener.apply(this._eventEmitter,arguments),this},removeAllListeners:function(){return this._eventEmitter&&this._eventEmitter.removeAllListeners.apply(this._eventEmitter,arguments),this},listenerCount:function(){return this._eventEmitter?this._eventEmitter.listenerCount.apply(this._eventEmitter,arguments):0},listeners:function(){return this._eventEmitter?this._eventEmitter.listeners.apply(this._eventEmitter,arguments):[]}}},function(t,e,i){"use strict";e.a={hleft:0,hcenter:1,hright:2,vtop:0,vcenter:1,vbottom:2,NO_NEWLINE:0,RAW_NEWLINE:1,WRAPPED_NEWLINE:2,NO_WRAP:0,WORD_WRAP:1,CHAR_WRAP:2,SPLITREGEXP:/(?:\r\n|\r|\n)/}},function(t,e,i){"use strict";var a=i(21),r=i(66),n=i.n(r);class s{constructor(t){var e=n()(t,"states",void 0);e&&this.addStates(e);var i=n()(t,"extend",void 0);if(i)for(var a in i)this.hasOwnProperty(a)&&void 0!==this[a]||(this[a]=i[a]);var r=n()(t,"eventEmitter",void 0),s=n()(t,"EventEmitterClass",void 0);this.setEventEmitter(r,s),this._stateLock=!1,this.resetFromJSON(t)}shutdown(){this.destroyEventEmitter()}destroy(){this.shutdown()}resetFromJSON(t){this.setEnable(n()(t,"enable",!0)),this.start(n()(t,"start",void 0));var e=n()(t,"init",void 0);return e&&e.call(this),this}toJSON(){return{curState:this.state,prevState:this.prevState,enable:this.enable,start:this._start}}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}set state(t){if(this.enable&&!this._stateLock&&this._state!==t){if(this._prevState=this._state,this._state=t,this._stateLock=!0,this.emit("statechange",this),null!=this._prevState){var e="exit_"+this._prevState,i=this[e];i&&i.call(this),this.emit(e,this)}if(this._stateLock=!1,null!=this._state){var a="enter_"+this._state,r=this[a];r&&r.call(this),this.emit(a,this)}}}get state(){return this._state}get prevState(){return this._prevState}start(t){return this._start=t,this._prevState=void 0,this._state=t,this}goto(t){return null!=t&&(this.state=t),this}next(){var t,e=this["next_"+this.state];return e&&(t="string"==typeof e?e:e.call(this)),this.goto(t),this}addState(t,e){var i=n()(e,"next",void 0);i&&(this["next_"+t]=i);var a=n()(e,"exit",void 0);a&&(this["exit_"+t]=a);var r=n()(e,"enter",void 0);return r&&(this["enter_"+t]=r),this}addStates(t){for(var e in t)this.addState(e,t[e]);return this}update(t,e,i){void 0===i&&(i="update");var a=this[i+"_"+this.state];a&&a.call(this,t,e)}preupdate(t,e){this.update(t,e,"preupdate")}postupdate(t,e){this.update(t,e,"postupdate")}}Object.assign(s.prototype,a.a);var o=s;e.a=o},,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"ItemSlot",(function(){return o}));var a=i(3),r=i(46),n=i(15),s=i(6),o=function(){function ItemSlot(t,e,i,a,r,n,s,o,h,l,c){this.minitialize=!1,this.mWid=0,this.mHei=0,this.mScene=t,this.mWorld=e,this.con=t.make.container(void 0,!1),this.con.x=a,this.con.y=r,i.add(this.con),this.mResStr=n,this.mResPng=s,this.mResJson=o,this.mResSlot=h,this.mSubScriptRes=c,this.mSelectRes=l}return ItemSlot.prototype.createUI=function(){this.onLoadCompleteHandler()},ItemSlot.prototype.getView=function(){return this.con},ItemSlot.prototype.dataChange=function(t){var e=this;if(this.minitialize&&(this.mData=t,this.mIcon)){var i=void 0;if(this.mData&&this.mData.display){i=this.mData.display.texturePath;this.mData.des&&this.mData.des}if(!i)return;this.mIcon.load(i,this,(function(){e.mData}))}},ItemSlot.prototype.destory=function(){this.mSubScriptSprite&&this.mSubScriptSprite.destroy(!0),this.mSelectSprite&&this.mSelectSprite.destroy(!0),this.mIcon&&this.mIcon.destroy(),this.mWid=0,this.mHei=0,this.mData=null},ItemSlot.prototype.onLoadCompleteHandler=function(){this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.con.addAt(this.itemBG,0),this.con.setSize(this.itemBG.width,this.itemBG.height),this.mIcon=new r.DragDropIcon(this.mScene,0,0),this.con.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1),this.con.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.con.on("pointerover",this.overHandler,this),this.con.on("pointerout",this.outHandler,this),this.con.on("pointerdown",this.downHandler,this),this.minitialize=!0,this.mData&&this.dataChange(this.mData),this.mWid+=this.itemBG.width,this.mHei+=this.itemBG.height},ItemSlot.prototype.downHandler=function(t){if(this.mData){var e=this.mWorld.modelManager.getModel(n.a.NAME).mainPlayerInfo.package,i=new s.PBpacket(a.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),r=i.content;r.uiId=e.id,r.componentId=this.mData.id,this.mWorld.connection.send(i)}},ItemSlot.prototype.overHandler=function(t){this.mSelectRes&&this.mSelectRes.length>0&&(this.mSelectSprite=this.mScene.make.image(void 0,!1),this.mSelectSprite.setTexture(this.mResStr,this.mSelectRes),this.con.add(this.mSelectSprite))},ItemSlot.prototype.outHandler=function(t){this.mSelectSprite&&this.mSelectSprite.parentContainer&&(this.mSelectSprite.parentContainer.remove(this.mSelectSprite),this.mSelectSprite.destroy(!0))},ItemSlot}()},function(t,e,i){"use strict";var a=i(19),r=new Phaser.GameObjects.Zone({sys:{queueDepthSort:a.a,events:{once:a.a}}},0,0,1,1);r.setOrigin(0),e.a=r},function(t,e,i){"use strict";var a=i(109),r=i(64),n=i(110),basesizer_PushIntoBounds=function(t){return void 0===t&&(t=Object(n.a)(this.scene)),this.left=Math.max(this.left,t.left),this.right=Math.min(this.right,t.right),this.top=Math.max(this.top,t.top),this.bottom=Math.min(this.bottom,t.bottom),this},s=new Phaser.Geom.Rectangle,basesizer_DrawBounds=function(t,e){void 0===e&&(e=16777215);for(var i,a=this.getAllChildren([this]),r=0,n=a.length;r<n;r++)(i=a[r]).getBounds&&t.lineStyle(1,e).strokeRectShape(i.getBounds(s));return this},basesizer_AddChildrenMap=function(t,e){return void 0===this.childrenMap&&(this.childrenMap={}),this.childrenMap[t]=e,this},GetAllElements=function(t,e){var i;for(var a in void 0===e&&(e=[]),t)void 0!==(i=t[a]).name?e.push(i):GetAllElements(i,e);return e};const o=/(\S+)\[(\d+)\]/i;var h=[],basesizer_GetElement=function(t){if(void 0!==this.childrenMap&&("string"==typeof t&&(t=t.split(".")),0!==t.length)){var e,i=t.shift();if("#"===i.charAt(0)){i=i.substring(1);for(var a=0,r=(n=GetAllElements(this.childrenMap,h)).length;a<r;a++)if(n[a].name===i){e=n[a];break}h.length=0}else if(-1===i.indexOf("["))e=this.childrenMap[i];else{var n,s=i.match(o);if(null!=s)(n=this.childrenMap[s[1]])&&(e=n[s[2]])}return 0===t.length?e:e&&e.childrenMap?e.getElement(t):null}},basesizer_GetChildrenWidth=function(){return 0},basesizer_GetChildrenHeight=function(){return 0},basesizer_GetAllChildrenSizers=function(t){void 0===t&&(t=[]);for(var e=t.length,i=this.getChildrenSizers(t),a=t.length,r=e;r<a;r++)i[r].getAllChildrenSizers(t);return t},basesizer_GetChildrenSizers=function(t){return void 0===t&&(t=[]),t},basesizer_Layout=function(t,e,i){},basesizer_LayoutInit=function(t){if(!t)for(var e,i=this.getAllChildrenSizers([this]),a=0,r=i.length;a<r;a++)(e=i[a]).rexSizer&&e._layoutInit()},basesizer_layoutInit=function(){},l=i(11);const c=Phaser.Utils.Objects.GetValue,u=Phaser.Utils.Objects.GetAdvancedValue;const d={stop:0,destroy:1,yoyo:2};var p=class{constructor(t,e){this.gameObject=t,this.scene=Object(l.a)(t),this.scaleStart={},this.scaleEnd={},this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setMode(c(t,"mode",0)),this.setScaleRange(u(t,"start",void 0),u(t,"end",0)),this.setDelay(u(t,"delay",0)),this.setDuration(u(t,"duration",1e3)),this.setEase(c(t,"ease",void 0)),this}toJSON(){return{mode:this.mode,start:this.scaleStart,end:this.scaleEnd,delay:this.delay,duration:this.duration}}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setMode(t){return"string"==typeof t&&(t=d[t]),this.mode=t,this}setScaleRange(t,e){return"number"==typeof t?(this.scaleStart.x=t,this.scaleStart.y=t):(this.scaleStart.x=c(t,"x",this.gameObject.scaleX),this.scaleStart.y=c(t,"y",this.gameObject.scaleY)),"number"==typeof e?(this.scaleEnd.x=e,this.scaleEnd.y=e):(this.scaleEnd.x=c(e,"x",this.scaleStart.x),this.scaleEnd.y=c(e,"y",this.scaleStart.y)),this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}setEase(t){return void 0===t&&(t="Linear"),this.ease=t,this}start(){return this.tween?this:0===this.duration?(this.sound.setScale(this.scaleEnd.x,this.scaleEnd.y),this.complete(),this):(this.gameObject.setScale(this.scaleStart.x,this.scaleStart.y),this.tween=this.scene.tweens.add({targets:this.gameObject,scaleX:this.scaleEnd.x,scaleY:this.scaleEnd.y,duration:this.duration,ease:this.ease,yoyo:2==this.mode,repeat:2==this.mode?-1:0,onComplete:this.complete,onCompleteScope:this}),this)}restart(){return this.stop().start(),this}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),1===this.mode&&this.gameObject.destroy(),this}},m={},popup=function(t,e,i,a,r){switch(m.mode=0,i){case"x":m.start={x:0};break;case"y":m.start={y:0};break;default:m.start=0}return m.end=1,m.duration=e,m.ease=void 0===a?"Cubic":a,void 0===r?r=new p(t,m):r.resetFromJSON(m),r.restart(),r};const f=Phaser.Utils.Objects.IsPlainObject,g=Phaser.Utils.Objects.GetValue;var y={},scale_down_destroy=function(t,e,i,a,r,n){switch(r instanceof p&&(n=r,r=void 0),void 0===r&&(r=!0),y.mode=r?1:0,i){case"x":y.end={x:0};break;case"y":y.end={y:0};break;default:y.end=0}return y.duration=e,y.ease=void 0===a?"Linear":a,void 0===n?n=new p(t,y):n.resetFromJSON(y),n.restart(),n};const _=Phaser.Utils.Objects.IsPlainObject,v=Phaser.Utils.Objects.GetValue;const b=Phaser.Utils.Objects.GetValue,P=Phaser.Utils.Objects.GetAdvancedValue;const S={stop:0,destroy:1,yoyo:2};var D=class{constructor(t,e){this.gameObject=t,this.scene=Object(l.a)(t),this.alphaStart=void 0,this.alphaEnd=void 0,this.tween=void 0,this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.setMode(b(t,"mode",0)),this.setAlphaRange(P(t,"start",this.gameObject.alpha),P(t,"end",0)),this.setDelay(P(t,"delay",0)),this.setDuration(P(t,"duration",1e3)),this}toJSON(){return{mode:this.mode,start:this.alphaStart,end:this.alphaEnd,delay:this.delay,duration:this.duration}}boot(){this.gameObject.once&&this.gameObject.once("destroy",this.destroy,this)}shutdown(){return this.stop(),this.gameObject=void 0,this.scene=void 0,this}destroy(){return this.shutdown(),this}setMode(t){return"string"==typeof t&&(t=S[t]),this.mode=t,this}setAlphaRange(t,e){return this.alphaStart=t,this.alphaEnd=e,this}setDelay(t){return this.delay=t,this}setDuration(t){return this.duration=t,this}start(){return this.tween?this:0===this.duration?(this.gameObject.setAlpha(this.alphaEnd),this.complete(),this):(this.gameObject.setAlpha(this.alphaStart),this.tween=this.scene.tweens.add({targets:this.gameObject,alpha:this.alphaEnd,delay:this.delay,duration:this.duration,ease:"Linear",yoyo:2==this.mode,repeat:2==this.mode?-1:0,onComplete:this.complete,onCompleteScope:this}),this)}restart(){return this.stop().start(),this}stop(){return this.tween?(this.tween.remove(),this.tween=void 0,this):this}complete(){return this.stop(),1===this.mode&&this.gameObject.destroy(),this}},T={},fade_in=function(t,e,i,a){return void 0===i&&(i=t.alpha),T.mode=0,T.start=0,T.end=i,T.duration=e,void 0===a?a=new D(t,T):a.resetFromJSON(T),a.restart(),a};const x=Phaser.Utils.Objects.IsPlainObject,C=Phaser.Utils.Objects.GetValue;var O={},fade_out_destroy=function(t,e,i,a){return i instanceof D&&(a=i,i=void 0),void 0===i&&(i=!0),O.mode=i?1:0,O.end=0,O.duration=e,void 0===a?a=new D(t,O):a.resetFromJSON(O),a.restart(),a};const M=Phaser.Utils.Objects.IsPlainObject,w=Phaser.Utils.Objects.GetValue;var A=void 0,basesizer_IsInTouching=function(t){if(void 0===A&&(A=new Phaser.Geom.Rectangle),this.getBounds(A),void 0!==t)return A.contains(t.x,t.y);for(var e=this.scene.input.manager,i=e.pointersTotal,a=e.pointers,r=0;r<i;r++)if(t=a[r],A.contains(t.x,t.y))return!0;return!1},basesizer_GetTopmostSizer=function(t){void 0===t&&(t=this);for(var e=Object(r.a)(t).parent;e;)t=e,e=Object(r.a)(t).parent;return t},E=i(20),B=i(29);const I=Phaser.Display.Align.In.QuickSet,k=Phaser.Display.Align.CENTER;var basesizer_LayoutBackgrounds=function(){if(void 0!==this.backgroundChildren)for(var t,e=this.backgroundChildren,i=this.left,a=this.top,r=this.width,n=this.height,s=0,o=e.length;s<o;s++)(t=e[s]).rexSizer.hidden||(Object(E.a)(t,r,n),B.a.setPosition(i,a).setSize(r,n),I(t,B.a,k),this.resetChildPositionState(t))},onDrag=function(t,e,i){var a=this.getTopmostSizer();a.x+=e-this.x,a.y+=i-this.y},basesizer_SetDraggable=function(t){return void 0===t&&(t=!0),this.input&&this.input.hasOwnProperty("draggable")?this.input.draggable=t:t&&(this.setInteractive(),this.scene.input.setDraggable(this),this.on("drag",onDrag,this)),this},R={getSizerConfig:r.a,pushIntoBounds:basesizer_PushIntoBounds,drawBounds:basesizer_DrawBounds,getChildrenWidth:basesizer_GetChildrenWidth,getChildrenHeight:basesizer_GetChildrenHeight,addChildrenMap:basesizer_AddChildrenMap,addElement:basesizer_AddChildrenMap,getElement:basesizer_GetElement,getAllChildrenSizers:basesizer_GetAllChildrenSizers,getChildrenSizers:basesizer_GetChildrenSizers,layout:basesizer_Layout,layoutBackgrounds:basesizer_LayoutBackgrounds,layoutInit:basesizer_LayoutInit,_layoutInit:basesizer_layoutInit,popUp:function(t,e,i){if(f(t)){var a=t;t=g(a,"duration",void 0),e=g(a,"orientation",void 0),i=g(a,"ease",void 0)}return this._scale=popup(this,t,e,i,this._scale),this},scaleDownDestroy:function(t,e,i,a){if(_(t)){var r=t;t=v(r,"duration",void 0),e=v(r,"orientation",void 0),i=v(r,"ease",void 0),a=v(r,"destroy",void 0)}return this._scale=scale_down_destroy(this,t,e,i,a,this._scale),this},fadeIn:function(t){x(t)&&(t=C(t,"duration",void 0));return this._fade=fade_in(this,t,this._fade),this},fadeOutDestroy:function(t,e){if(M(t)){var i=t;t=w(i,"duration",void 0),e=w(i,"destroy",void 0)}return this._fade=fade_out_destroy(this,t,e,this._fade),this},isInTouching:basesizer_IsInTouching,getTopmostSizer:basesizer_GetTopmostSizer,setDraggable:basesizer_SetDraggable};const j=Phaser.Geom.Rectangle;var anchor_GetViewport=function(t,e){void 0===e&&(e=new j);var i=t.canvasBounds,a=t.displayScale,r=t.autoCenter;return e.x=i.x>=0?0:-i.x*a.x,e.y=i.y>=0?0:-i.y*a.y,e.width=i.width*a.x-e.x,e.height=i.height*a.y-e.y,1!==r&&2!==r||(e.width-=e.x),1!==r&&3!==r||(e.height-=e.y),e};const L=Phaser.Utils.Objects.GetValue,F=Phaser.Geom.Rectangle;var N=class{constructor(t,e){this.gameObject=t,this.viewport=new F,this.resetFromJSON(e),this.boot()}resetFromJSON(t){var e,i;if("string"==typeof t){var a=t.split(",");e=a[0],i=a[1]}else e=L(t,"x","0%+0"),i=L(t,"y","0%+0");e=e.replace("left","0%").replace("right","100%").replace("center","50%").split("%");var r=parseFloat(e[0])/100,n=""===e[1]?0:parseFloat(e[1]);i=i.replace("top","0%").replace("bottom","100%").replace("center","50%").split("%");var s=parseFloat(i[0])/100,o=""===i[1]?0:parseFloat(i[1]);return this.setPercentage(r,s),this.setOffset(n,o),this}boot(){this.scaleManamger.on("resize",this.onResize,this),this.gameObject.once("destroy",this.destroy,this),this.onResize()}shutdown(){this.scaleManamger.off("resize",this.onResize,this),this.gameObject=void 0}destroy(){this.shutdown()}setOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.offsetX=t,this.offsetY=e,this}setPercentage(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.percentageX=t,this.percentageY=e,this}onResize(){anchor_GetViewport(this.scaleManamger,this.viewport),this.updatePosition()}updatePosition(){return this.gameObject.setPosition(this.x,this.y),this}get scaleManamger(){return this.gameObject.scene.scale}get x(){return this.viewport.x+this.viewport.width*this.percentageX+this.offsetX}get y(){return this.viewport.y+this.viewport.height*this.percentageY+this.offsetY}};const U=Phaser.Utils.Objects.GetValue;class V extends a.a{constructor(t,e,i,a,r,n){var s,o;"string"==typeof e&&(s=e,o=i,e=0,i=0),super(t,e,i,2,2),this.isRexSizer=!0,this.setMinSize(a,r),this.setName(U(n,"name","")),this.rexSizer={},this.backgroundChildren=void 0,void 0!==s&&(this._anchor=new N(this,{x:s,y:o})),this.setDraggable(U(n,"draggable",!1))}destroy(t){this.scene&&(void 0!==this.backgroundChildren&&(this.backgroundChildren.length=0),super.destroy(t))}setMinSize(t,e){return this.setMinWidth(t).setMinHeight(e),this}setMinWidth(t){return null==t&&(t=0),this.minWidth=t,this}setMinHeight(t){return null==t&&(t=0),this.minHeight=t,this}get childrenWidth(){return void 0===this._childrenWidth&&(this._childrenWidth=this.getChildrenWidth()),this._childrenWidth}get childrenHeight(){return void 0===this._childrenHeight&&(this._childrenHeight=this.getChildrenHeight()),this._childrenHeight}get left(){return this.x-this.displayWidth*this.originX}set left(t){this.x+=t-this.left}alignLeft(t){return this.left=t,this}get right(){return this.x-this.displayWidth*this.originX+this.displayWidth}set right(t){this.x+=t-this.right}alignRight(t){return this.right=t,this}get centerX(){return(this.left+this.right)/2}set centerX(t){this.x+=t-this.centerX}alignCenterX(t){return this.centerX=t,this}get top(){return this.y-this.displayHeight*this.originY}set top(t){this.y+=t-this.top}alignTop(t){return this.top=t,this}get bottom(){return this.y-this.displayHeight*this.originY+this.displayHeight}set bottom(t){this.y+=t-this.bottom}alignBottom(t){return this.bottom=t,this}get centerY(){return(this.top+this.bottom)/2}set centerY(t){this.y+=t-this.centerY}alignCenterY(t){return this.centerY=t,this}pin(t){return super.add(t),this}addBackground(t){return void 0===this.backgroundChildren&&(this.backgroundChildren=[]),super.add(t),this.getSizerConfig(t).parent=this,this.backgroundChildren.push(t),this}}Object.assign(V.prototype,R);e.a=V},function(t,e,i){"use strict";var callback=function(t){t.stopPropagation()},input_StopPropagationTouchEvents=function(t){t.addEventListener("touchstart",callback,!1),t.addEventListener("touchmove",callback,!1),t.addEventListener("touchend",callback,!1),t.addEventListener("mousedown",callback,!1),t.addEventListener("mouseup",callback,!1),t.addEventListener("mousemove",callback,!1)};const a=Phaser.GameObjects.DOMElement,r=Phaser.Utils.Objects.IsPlainObject,n=Phaser.Utils.Objects.GetValue;const s={id:["id",void 0],text:["value",void 0],placeholder:["placeholder",void 0],tooltip:["title",void 0],readOnly:["readonly",!1],spellCheck:["spellcheck",!1],autoComplete:["autocomplete","off"]},o={align:["text-align",void 0],width:["width",void 0],height:["height",void 0],fontFamily:["font-family",void 0],fontSize:["font-size",void 0],color:["color","#ffffff"],backgroundColor:["backgroundColor","transparent"],borderColor:["borderColor","transparent"],outline:["outline","none"]},h={textchange:"oninput",click:"onclick",dblclick:"ondblclick",focus:"onfocus",blur:"onblur"};e.a=class extends a{constructor(t,e,i,a,l,c){r(e)?(e=n(c=e,"x",0),i=n(c,"y",0),a=n(c,"width",void 0),l=n(c,"height",void 0)):r(a)&&(a=n(c=a,"width",void 0),l=n(c,"height",void 0)),void 0===c&&(c={});var u,d=t.scale.autoRound;void 0!==a&&(d&&(a=Math.floor(a)),c.width=a+"px"),void 0!==l&&(d&&(l=Math.floor(l)),c.height=l+"px");var p,m,f=n(c,"type","text");for(var g in"textarea"===f?(u=document.createElement("textarea")).style.resize="none":(u=document.createElement("input")).type=f,s)p=s[g],void 0!==(m=n(c,g,p[1]))&&(u[p[0]]=m);var y,_,v=n(c,"style",void 0);for(var g in void 0===v&&(v={}),o)y=o[g],void 0!==(_=n(c,g,y[1]))&&(v[y[0]]=_);var b=u.style;for(var g in c)g in s||g in o||g in b&&(v[g]=c[g]);v["box-sizing"]="border-box",super(t,e,i,u,v),this.type="rexInputText";for(let t in h)this.node[h[t]]=function(){this.emit(t,this)}.bind(this);input_StopPropagationTouchEvents(this.node)}resize(t,e){var i=this.node.style;return i.width=t+"px",i.height=e+"px",this.updateSize(),this}get text(){return this.node.value}set text(t){this.node.value=t}setText(t){return this.text=t,this}selectText(){return this.node.select(),this}get placeholder(){return this.node.placeholder}set placeholder(t){this.node.placeholder=t}setPlaceholder(t){return this.placeholder=t,this}get tooltip(){return this.node.title}set tooltip(t){this.node.title=t}setTooltip(t){return this.tooltip=t,this}setTextChangedCallback(t){return this.onTextChanged=t,this}get readOnly(){return this.node.readOnly}set readOnly(t){this.node.readOnly=t}setReadOnly(t){return void 0===t&&(t=!0),this.readOnly=t,this}get spellCheck(){return this.node.spellcheck}set spellCheck(t){this.node.spellcheck=t}setSpellCheck(t){return this.spellCheck=t,this}setStyle(t,e){return this.node.style[t]=e,this}getStyle(t){return this.node.style[t]}scrollToBottom(){return this.node.scrollTop=this.node.scrollHeight,this}setEnabled(t){return void 0===t&&(t=!0),this.node.disabled=!t,this}setBlur(){return this.node.blur(),this}setFocus(){return this.node.focus(),this}}},,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"BagPanel",(function(){return l}));var a,r=i(28),n=i(5),s=i(12),o=i(8),h=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function BagPanel(e,i){var a=t.call(this,e)||this;return a.mPageNum=0,a.mPageIndex=1,a.mScene=e,a.mWorld=i,a.bagSlotList=[],a}return h(BagPanel,t),BagPanel.prototype.update=function(t){},BagPanel.prototype.hide=function(){this.mShowing=!1,this.destroy()},BagPanel.prototype.resize=function(){var t=this.mWorld.getSize();this.mParentCon&&(this.mParentCon.x=t.width>>1,this.mParentCon.y=t.height-200)},BagPanel.prototype.setDataList=function(t){this.mPageNum=Math.ceil(t.length/BagPanel.PageMaxCount),this.mDataList=t,this.mInitialized&&this.refreshDataList()},BagPanel.prototype.getPageNum=function(){return this.mPageNum},BagPanel.prototype.destroy=function(){this.bagSlotList&&(this.bagSlotList.forEach((function(t){t&&t.destory()})),this.bagSlotList.length=0,this.bagSlotList=null),this.mDataList&&(this.mDataList.length=0,this.mDataList=null),this.mParentCon&&this.mParentCon.destroy(),this.mInitialized=!1},BagPanel.prototype.getCurPageIndex=function(){return this.mPageIndex},BagPanel.prototype.init=function(){if(!this.mInitialized){var t,e=0,i=this.mWorld.getSize();this.mParentCon=this.mScene.add.container(i.width>>1,i.height-200),this.mPreBtn=this.mScene.make.sprite(void 0,!1),this.mPreBtn.setTexture(this.mResStr,"bagView_tab"),this.mPreBtn.x=-380,e+=this.mPreBtn.width,this.mParentCon.add(this.mPreBtn);var a=0,n=0;this.bagSlotList=[];for(var s=0;s<36;s++)a=s%12*60+32-362,n=60*Math.floor(s/12)-55,(t=new r.ItemSlot(this.mScene,this.mWorld,this.mParentCon,a,n,this.mResStr,this.mResPng,this.mResJson,"bagView_slot","bagView_itemSelect")).createUI(),this.bagSlotList.push(t),s<=11&&(e+=57);this.mParentCon.addAt(this.createTexture(),0),this.mNextBtn=this.mScene.make.sprite(void 0,!1),this.mNextBtn.setTexture(this.mResStr,"bagView_tab"),this.mNextBtn.scaleX=-1,this.mNextBtn.x=380,e+=this.mNextBtn.width;var o=this.mScene.make.sprite(void 0,!1);o.setTexture(this.mResStr,"bagView_titleBtn"),o.x=80+(-e>>1),o.y=-103,this.mParentCon.add(o);var h=this.mScene.make.text(void 0,!1);h.setFontFamily("Tahoma"),h.setFontStyle("bold"),h.setFontSize(20),h.setText("背包"),h.x=o.x+o.width-10,h.y=o.y-(h.height>>1),this.mParentCon.add(h),this.mParentCon.add(this.mNextBtn),this.mNextBtn.setInteractive(),this.mPreBtn.setInteractive(),this.mNextBtn.on("pointerup",this.nextHandler,this),this.mPreBtn.on("pointerup",this.preHandler,this),this.mWidth=e,this.mHeight=206,this.mScene.cache.obj.has("clsBtn")?this.onClsLoadCompleteHandler():(this.mScene.load.spritesheet("clsBtn","resources/ui/common/common_clsBtn.png",{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onClsLoadCompleteHandler,this),this.mScene.load.start()),this.mInitialized=!0,this.mDataList&&this.refreshDataList()}},BagPanel.prototype.preload=function(){this.mScene&&(this.mResStr="bagView",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.mScene.load.atlas(this.mResStr,o.e.getRes(this.mResPng),o.e.getRes(this.mResJson)),t.prototype.preload.call(this))},BagPanel.prototype.loadComplete=function(t,e,i){this.mInitialized||this.init()},BagPanel.prototype.nextHandler=function(t,e){this.preNextBtnScaleHandler(this.mNextBtn,-1),this.mPageIndex>=this.mPageNum||(this.mPageIndex++,this.refreshDataList())},BagPanel.prototype.preHandler=function(t,e){this.preNextBtnScaleHandler(this.mPreBtn),this.mPageIndex<=1||(this.mPageIndex--,this.refreshDataList())},BagPanel.prototype.preNextBtnScaleHandler=function(t,e){void 0===e&&(e=1),this.mScene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1},BagPanel.prototype.refreshDataList=function(){if(this.mDataList)for(var t,e=this.mDataList.slice((this.mPageIndex-1)*BagPanel.PageMaxCount,this.mPageIndex*BagPanel.PageMaxCount),i=BagPanel.PageMaxCount,a=0;a<i;a++)(t=this.bagSlotList[a])&&t.dataChange(e[a]);else n.a.error("this.mDataList is undefiend")},BagPanel.prototype.createTexture=function(){var t=this.mScene.add.graphics();return t.fillStyle(11184553,.5),t.fillRect(-362,-102,724,200),t.lineStyle(3,0,.8),t.strokeRect(-365,-103,730,206),t},BagPanel.prototype.onClsLoadCompleteHandler=function(){this.mClsBtnSprite=this.mScene.make.sprite(void 0,!1),this.mClsBtnSprite.setTexture("clsBtn","btn_normal"),this.mClsBtnSprite.x=(this.mWidth>>1)-65,this.mClsBtnSprite.y=-this.mHeight>>1,this.mClsBtnSprite.setInteractive(),this.mClsBtnSprite.on("pointerup",this.hide,this),this.mParentCon.add(this.mClsBtnSprite)},BagPanel.PageMaxCount=36,BagPanel}(s.Panel)},function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var a,r=i(6),n=i(3),s=i(17),o=i(15),h=i(85),l=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),c=function(t){function BagModel(e){var i=t.call(this)||this;return i.mWorld=e,i.initialize=!1,i.mWorld.modelManager&&(i.mModelDispatch=i.mWorld.modelManager),i.mConnect=i.mWorld.connection,i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_ADD_ITEM,i.handleAddItem),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_REMOVE_ITEM,i.handleRemoveItem),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_EXCHANGE_ITEM_POS,i.handleExchangeItem),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QUERY_PACKAGE,i.handleQueryPackage),i}return l(BagModel,t),BagModel.prototype.getInitialize=function(){return this.initialize},BagModel.prototype.register=function(){this.mConnect.addPacketListener(this)},BagModel.prototype.unRegister=function(){this.mConnect.removePacketListener(this)},BagModel.prototype.requestVirtualWorldQueryPackage=function(t,e,i){var a=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),s=a.content;s.id=t,s.page=e,s.perPage=i,this.mConnect.send(a)},BagModel.prototype.handleQueryPackage=function(t){var e=t.content;this.initialize=!0,this.mModelDispatch.emit(s.a.QUERY_PACKAGE,e)},BagModel.prototype.handleAddItem=function(t){var e=t.content;e.nodetype===n.op_def.NodeType.ElementNodeType?this.mWorld.modelManager.getModel(h.a.NAME).addPackItems(e.id,e.item):e.nodetype===n.op_def.NodeType.CharacterNodeType&&this.mWorld.modelManager.getModel(o.a.NAME).addPackItems(e.id,e.item),this.mModelDispatch.emit(s.a.PACKAGE_ITEM_ADD,e)},BagModel.prototype.handleRemoveItem=function(t){var e,i=t.content,a=i.itemId.length;i.nodetype===n.op_def.NodeType.ElementNodeType?e=this.mWorld.modelManager.getModel(h.a.NAME):i.nodetype===n.op_def.NodeType.CharacterNodeType&&(e=this.mWorld.modelManager.getModel(o.a.NAME));for(var r=0;r<a;r++)e.removePackItems(i.id,i.itemId[r]);this.mModelDispatch.emit(s.a.UPDATED_CHARACTER_PACKAGE),this.mModelDispatch.emit(s.a.PACKAGE_ITEM_REMOVE,i)},BagModel.prototype.handleExchangeItem=function(t){var e=t.content;this.mModelDispatch.emit(s.a.PACKAGE_EXCHANGE_ITEM_POS,e)},BagModel.NAME="BagModel",BagModel}(r.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"UIMediatorType",(function(){return a}));var a=function(){function UIMediatorType(){}return UIMediatorType.BagHotKey="BagHotKey",UIMediatorType.BagMediator="BagMediator",UIMediatorType.ChatMediator="ChatMediator",UIMediatorType.NOTICE="Notice",UIMediatorType.ControlF="ControlF",UIMediatorType.Storage="Storage",UIMediatorType.UserInfo="UserInfo",UIMediatorType.UserMenu="UserMenu",UIMediatorType.MessageBox="MessageBox",UIMediatorType.ComponentRank="ComponentRank",UIMediatorType.Rank="Rank",UIMediatorType.VoteResult="VoteResult",UIMediatorType.Shop="Shop",UIMediatorType}()},function(t,e,i){"use strict";const a=Phaser.Utils.Objects.GetValue;e.a=function(t,e){return void 0===e&&(e={}),"number"==typeof t?(e.left=t,e.right=t,e.top=t,e.bottom=t):(e.left=a(t,"left",0),e.right=a(t,"right",0),e.top=a(t,"top",0),e.bottom=a(t,"bottom",0)),e}},function(t,e,i){"use strict";const a=Phaser.GameObjects.Graphics;const r={rectangle:0,circle:1};e.a=class extends a{constructor(t,e,i){void 0===e&&(e=0),"string"==typeof e&&(shaep=r[e]),void 0===i&&(i=0),super(t.scene),this.parent=t,this.shape=e,this.padding=i,this.setPosition().resize()}destroy(){return this.parent=void 0,super.destroy(),this}setPosition(t,e){var i=this.parent;return void 0===t&&(t=i.x),void 0===e&&(e=i.y),super.setPosition(t,e),this}resize(t,e,i){var a=this.parent;if(void 0===t&&(t=a.width),void 0===e&&(e=a.height),void 0===i&&(i=this.padding),this.widthSave===t&&this.heightSave===e&&this.paddingSave===i)return this;switch(this.clear().fillStyle(16777215),this.shape){case 1:var r=Math.min(t,e)/2;this.fillCircle(0,0,r+i);break;default:this.fillRect(-t*a.originX-i,-e*a.originY-i,t+2*i,e+2*i)}return this.widthSave=t,this.heightSave=e,this.paddingSave=i,this}}},function(t,e,i){"use strict";var a=i(134),r=i(83),n={plainText:null,prevProp:null},s=new r.a,o={},h={splitText:function(t,e){for(var i,a,r=[],n=0,s=t.length,o=s;i=l.exec(t);)a=i[0],n<(o=l.lastIndex-a.length)&&r.push(t.substring(n,o)),void 0===e&&r.push(a),n=l.lastIndex;return n<s&&r.push(t.substring(n,s)),r},tagTextToProp:function(t,e){var i,a;null==e&&(e={}),e.img&&updateProp(e,A,"img"),c.test(t)?(updateProp(e,E,"b",!0),i=""):u.test(t)?(updateProp(e,A,"b"),i=""):d.test(t)?(updateProp(e,E,"i",!0),i=""):p.test(t)?(updateProp(e,A,"i"),i=""):m.test(t)?(a=t.match(m),updateProp(e,E,"size",a[1]+"px"),i=""):f.test(t)?(updateProp(e,A,"size"),i=""):g.test(t)?(a=t.match(g),updateProp(e,E,"color",a[1]),i=""):y.test(t)?(updateProp(e,A,"color"),i=""):_.test(t)?(a=t.match(_),updateProp(e,E,"u",!0),i=""):v.test(t)?(a=t.match(v),updateProp(e,E,"u",a[1]),i=""):b.test(t)?(updateProp(e,A,"u"),i=""):P.test(t)?(updateProp(e,E,"shadow",!0),i=""):S.test(t)?(updateProp(e,A,"shadow"),i=""):D.test(t)?(updateProp(e,E,"stroke",!0),i=""):T.test(t)?(a=t.match(T),updateProp(e,E,"stroke",a[1]),i=""):x.test(t)?(updateProp(e,A,"stroke"),i=""):C.test(t)?(a=t.match(C),updateProp(e,E,"img",a[1]),i=""):O.test(t)?(updateProp(e,A,"img"),i=""):M.test(t)?(a=t.match(M),updateProp(e,E,"area",a[1]),i=""):w.test(t)?(updateProp(e,A,"area"),i=""):i=t;var r=n;return r.plainText=i,r.prop=e,r},propToContextStyle:function(t,e){var i=s;if(e.hasOwnProperty("img"))i.image=e.img;else{if(i.image=null,e.hasOwnProperty("family")?i.fontFamily=e.family:i.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var a=e.size;"number"==typeof a&&(a=a.toString()+"px"),i.fontSize=a}else i.fontSize=t.fontSize;i.fontStyle=getFontStyle(e.b,e.i),e.hasOwnProperty("color")?i.color=e.color:i.color=t.color,e.hasOwnProperty("stroke")?!0===e.stroke?(i.stroke=t.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=e.stroke,i.strokeThickness=t.strokeThickness):(i.stroke=t.stroke,i.strokeThickness=0)}return e.hasOwnProperty("shadow")?!0===e.shadow?(i.shadowColor=t.shadowColor,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor=e.shadow,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowStroke=!0,i.shadowFill=!0):(i.shadowColor="#000",i.shadowOffsetX=0,i.shadowOffsetY=0,i.shadowBlur=0,i.shadowStroke=!1,i.shadowFill=!1),e.hasOwnProperty("u")?!0===e.u?(i.underlineColor=t.underlineColor,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor=e.u,i.underlineThickness=t.underlineThickness,i.underlineOffset=t.underlineOffset):(i.underlineColor="#000",i.underlineThickness=0,i.underlineOffset=0),i},propToTagText:function(t,e,i){for(var a in null==i&&(i=o),i)e.hasOwnProperty(a)||(t="[/"+a+"]"+t);var r="";for(var a in e)i[a]!==e[a]&&("size"===a?r+="[size="+e[a].replace("px","")+"]":"color"===a||"stroke"===a||"img"===a?r+="["+a+"="+e[a]+"]":"u"===a?!0===e[a]?r+="[u]":r+="[u="+e[a]+"]":r+="["+a+"]");return t=r+t}},updateProp=function(t,e,i,a){return e===E?t[i]=a:t.hasOwnProperty(i)&&delete t[i],t},getFontStyle=function(t,e){return t&&e?"bold italic":t?"bold":e?"italic":""},l=/\[b\]|\[\/b\]|\[i\]|\[\/i\]|\[size=(\d+)\]|\[\/size\]|\[color=([a-z]+|#[0-9abcdef]+)\]|\[\/color\]|\[u\]|\[u=([a-z]+|#[0-9abcdef]+)\]|\[\/u\]|\[shadow\]|\[\/shadow\]|\[stroke\]|\[stroke=([a-z]+|#[0-9abcdef]+)\]|\[\/stroke\]|\[img=([^\]]+)\]|\[\/img\]|\[area=([^\]]+)\]|\[\/area\]/gi,c=/\[b\]/i,u=/\[\/b\]/i,d=/\[i\]/i,p=/\[\/i\]/i,m=/\[size=(\d+)\]/i,f=/\[\/size\]/i,g=/\[color=([a-z]+|#[0-9abcdef]+)\]/i,y=/\[\/color\]/i,_=/\[u\]/i,v=/\[u=([a-z]+|#[0-9abcdef]+)\]/i,b=/\[\/u\]/i,P=/\[shadow\]/i,S=/\[\/shadow\]/i,D=/\[stroke\]/i,T=/\[stroke=([a-z]+|#[0-9abcdef]+)\]/i,x=/\[\/stroke\]/i,C=/\[img=([^\]]+)\]/i,O=/\[\/img\]/i,M=/\[area=([^\]]+)\]/i,w=/\[\/area\]/i;const A=!1,E=!0;var B=h;class I extends a.a{constructor(t,e,i,a,r){super(t,e,i,a,r,"rexBBCodeText",B)}}e.a=I},function(t,e,i){"use strict";var a=class{constructor(){this.items=[]}destroy(){this.items.length=0,this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}};e.a=a},,function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicImage",(function(){return n}));var a,r=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),n=function(t){function DynamicImage(e,i,a){return t.call(this,e,i,a,void 0)||this}return r(DynamicImage,t),DynamicImage.prototype.load=function(t,e,i){this.mLoadCompleteCallbak=e,this.mLoadContext=i,this.mUrl=t,this.scene.cache.obj.get(t)?this.onLoadComplete():(this.scene.load.image(t,t),this.scene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.scene.load.start())},DynamicImage.prototype.onLoadComplete=function(){if(this.mLoadCompleteCallbak){var t=this.mLoadCompleteCallbak;this.mLoadCompleteCallbak=null,t.call(this.mLoadContext),this.mLoadContext=null}this.setTexture(this.mUrl)},DynamicImage}(Phaser.GameObjects.Image)},,function(t,e,i){"use strict";i.r(e),i.d(e,"DragDropIcon",(function(){return o}));var a,r=i(8),n=i(44),s=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),o=function(t){function DragDropIcon(e,i,a,r){var s=t.call(this,e,i,a)||this;return s.mScene=e,s.mIcon=new n.DynamicImage(s.mScene,0,0),s.add(s.mIcon),s}return s(DragDropIcon,t),DragDropIcon.prototype.load=function(t,e,i){this.mUrl=t;this.resKey;this.mIcon.load(r.e.getOsdRes(this.mUrl),(function(){})),this.mCallBack=i},DragDropIcon.prototype.dragStart=function(){},DragDropIcon.prototype.dragStop=function(t){},DragDropIcon.prototype.dragDrop=function(t){},DragDropIcon.prototype.dragOver=function(t){},DragDropIcon.prototype.getDragData=function(){},DragDropIcon.prototype.getDropData=function(){},DragDropIcon.prototype.getDragImage=function(){return this.mIcon},DragDropIcon.prototype.getVisualDisplay=function(){},DragDropIcon.prototype.getBound=function(){var t=this.getBounds();return new Phaser.Geom.Rectangle(t.x,t.y,t.width,t.height)},Object.defineProperty(DragDropIcon.prototype,"resKey",{get:function(){return void 0===this.mUrl?"":r.e.getOsdRes(this.mUrl)},enumerable:!0,configurable:!0}),DragDropIcon.prototype.destroy=function(){t.prototype.destroy.call(this)},Object.defineProperty(DragDropIcon.prototype,"icon",{get:function(){return this.mIcon},enumerable:!0,configurable:!0}),DragDropIcon.prototype.setDragType=function(t){this.mDragType=t},DragDropIcon.prototype.setDropType=function(t){this.mDropType=t},DragDropIcon.prototype.getDropType=function(){return this.mDropType},DragDropIcon.prototype.getDragType=function(){return this.mDragType},DragDropIcon}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";var a=i(113);const r=Phaser.Utils.Objects.GetValue;e.a=function(t,e){void 0===e&&(e="scrollMode");var i=r(t,"scrollMode",0);return"string"==typeof i&&(i=a.a[i]),i}},function(t,e,i){"use strict";i.r(e),i.d(e,"BasicRankPanel",(function(){return l}));var a,r=i(12),n=i(8),s=i(13),o=i(73),h=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function BasicRankPanel(e,i){var a=t.call(this,e)||this;return a.mTexts=[],a.mWorld=i,a}return h(BasicRankPanel,t),BasicRankPanel.prototype.addItem=function(t){if(this.setData("data",t),this.mInitialized){this.clearText();var e=t.text;if(e&&!(e.length<1)){this.mTitleLabel&&(this.mTitleLabel.setText(e[0].text),this.mTitleLabel.setData("node",e[0].node));for(var i=[12,60,238],a=1;a<4;a++){(r=this.scene.make.text({x:i[a-1],y:27,text:e[a].text,style:{font:o.a.YAHEI_16_BOLD}},!1)).setData("node",e[a].node),r.setStroke("#000000",2),this.mContentContainer.add(r),this.mTexts.push(r)}for(a=4;a<e.length;a++){var r,n=e[a],s=(a-4)%3,h=27*Math.floor((a-4)/3);(r=this.scene.make.text({x:i[s],y:60+h,text:n.text,style:{font:o.a.YAHEI_14_BOLD}},!1)).setData("node",n.node),r.setStroke("#000000",2),this.mContentContainer.add(r),this.mTexts.push(r)}}}},BasicRankPanel.prototype.update=function(t){this.addItem(t)},BasicRankPanel.prototype.preload=function(){this.scene.load.image(n.a.getName(),n.a.getPNG()),this.scene.load.image(n.b.getName(),n.b.getPNG()),this.scene.load.atlas("rank_atlas",n.e.getRes("ui/rank/rank_atlas.png"),n.e.getRes("ui/rank/rank_atlas.json")),t.prototype.preload.call(this)},BasicRankPanel.prototype.init=function(){if(!this.mInitialized){this.scene.make.image({key:n.a.getName()},!1).setOrigin(0,0).setScale(5,5);this.mBackground=new s.a(this.scene,{x:0,y:0,width:328,height:361,key:n.a.getName(),columns:n.a.getColumns(),rows:n.a.getRows()}).setOrigin(0,0),this.add(this.mBackground),this.mContentContainer=this.scene.make.container({},!1),this.add(this.mContentContainer);var e=new s.a(this.scene,{x:8,y:20,width:315,height:318,key:n.b.getName(),columns:n.b.getColumns(),rows:n.b.getRows()}).setOrigin(0,0);this.mContentContainer.add(e);var i=this.scene.make.image({x:20,y:-15,key:"rank_atlas",frame:"icon.png"},!1).setOrigin(0,0);this.add(i),this.mTitleLabel=this.scene.make.text({x:54,text:"排行榜",style:{font:o.a.YAHEI_20_BOLD}}).setOrigin(0,.5),this.add(this.mTitleLabel),t.prototype.init.call(this);var a=this.getData("data");a&&this.addItem(a)}},BasicRankPanel.prototype.clearText=function(){for(var t=0,e=this.mTexts;t<e.length;t++){e[t].destroy()}this.mTexts.length=0},BasicRankPanel}(r.Panel)},,function(t,e,i){"use strict";i.r(e),i.d(e,"DynamicNinepatch",(function(){return r}));var a=i(13),r=function(){function DynamicNinepatch(t,e){this.mScene=t,this.mParent=e}return DynamicNinepatch.prototype.load=function(t,e,i,a){this.mLoadCompleteCallBack=i,this.mLoadContext=a,this.mConfig=e,this.mUrl=t,this.mScene.cache.obj.get(t)?this.onLoadCompleteHandler():(this.mScene.load.image(this.mUrl,this.mUrl),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},DynamicNinepatch.prototype.onLoadCompleteHandler=function(){this.mImage=new a.a(this.mScene,this.mConfig),this.mLoadCompleteCallBack&&(this.mLoadCompleteCallBack.call(this.mLoadContext,this.mImage),this.mLoadCompleteCallBack=null,this.mLoadContext=null)},Object.defineProperty(DynamicNinepatch.prototype,"image",{get:function(){return this.mImage},enumerable:!0,configurable:!0}),DynamicNinepatch}()},,,,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"UiManager",(function(){return m}));var a,r=i(6),n=i(3),s=i(5),o=i(58),h=i(38),l=i(59),c=i(62),u=i(70),d=i(71),p=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function UiManager(e){var i=t.call(this)||this;return i.worldService=e,i.mConnect=e.connection,i.mConnect&&(i.mConnect.addPacketListener(i),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_SHOW_UI,i.handleShowUI),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_UPDATE_UI,i.handleUpdateUI),i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CLOSE_UI,i.handleCloseUI)),i.mUILayerManager=new u.LayerManager,i}return p(UiManager,t),UiManager.prototype.setScene=function(t){this.mScene=t,this.mUILayerManager.setScene(t),this.mMedMap||(this.mMedMap=new Map,this.mMedMap.set(h.UIMediatorType.BagHotKey,new l.BagUIMediator(this.worldService,t)),this.mMedMap.set(h.UIMediatorType.BagMediator,new o.BagMediator(this.worldService,t)),this.mMedMap.set(h.UIMediatorType.ChatMediator,new c.ChatMediator(this.mUILayerManager,this.worldService,t)),this.mMedMap.set(h.UIMediatorType.NOTICE,new d.NoticeMediator(this.mUILayerManager,t,this.worldService))),this.mMedMap.forEach((function(t){t.isSceneUI()&&t.show()}))},UiManager.prototype.resize=function(t,e){this.mBagUI&&this.mBagUI.resize(),this.mMedMap&&this.mMedMap.forEach((function(t){t.isShow&&t.resize()}))},UiManager.prototype.getMediator=function(t){if(this.mMedMap)return this.mMedMap.get(t)},UiManager.prototype.handleShowUI=function(t){var e=t.content;this.showMed(e.name,e)},UiManager.prototype.handleUpdateUI=function(t){var e=t.content;this.updateMed(e.name,e)},UiManager.prototype.handleCloseUI=function(t){var e=t.content;this.hideMed(e.name)},UiManager.prototype.showMed=function(t){for(var e=[],a=1;a<arguments.length;a++)e[a-1]=arguments[a];if(this.mMedMap){var r=this.mMedMap.get(t);if(!r){var n=t+"Mediator",o=i(222)("./"+t+"/"+n);if(!(r=new o[n](this.mUILayerManager,this.mScene,this.worldService)))return void s.a.error("error "+t+" no panel can show!!!");this.mMedMap.set(t,r)}r.show(e)}},UiManager.prototype.updateMed=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(this.mMedMap){var a=this.mMedMap.get(t);a?a.update(e):s.a.error("error "+t+" no panel can show!!!")}},UiManager.prototype.hideMed=function(t){if(this.mMedMap){var e=this.mMedMap.get(t);e?(e.hide(),this.mMedMap.delete(t)):s.a.error("error "+t+" no panel can show!!!")}},UiManager}(r.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"DragType",(function(){return a})),i.d(e,"DropType",(function(){return r})),i.d(e,"BagMediator",(function(){return c}));var a,r,n=i(17),s=i(5),o=i(36),h=i(15),l=i(37);!function(t){t[t.DRAG_TYPE_SHORTCUT=1]="DRAG_TYPE_SHORTCUT",t[t.DRAG_TYPE_BAG=2]="DRAG_TYPE_BAG"}(a||(a={})),function(t){t[t.DROP_TYPE_SHORTCUT=1]="DROP_TYPE_SHORTCUT",t[t.DROP_TYPE_BAG=2]="DROP_TYPE_BAG"}(r||(r={}));var c=function(){function BagMediator(t,e){this.mPageNum=0,this.world=t,this.mPlayerModel=this.world.modelManager.getModel(h.a.NAME),this.mBagModel=this.world.modelManager.getModel(l.a.NAME),this.mView=new o.BagPanel(e,t)}return BagMediator.prototype.isSceneUI=function(){return!1},BagMediator.prototype.isShow=function(){if(this.mView)return this.mView.isShow()},BagMediator.prototype.resize=function(){if(this.mView)return this.mView.resize()},BagMediator.prototype.getView=function(){return this.mView},BagMediator.prototype.show=function(t){this.mView&&(this.world.modelManager.on(n.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.modelManager.on(n.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.modelManager.on(n.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mView.show(t),this.mBagModel.register())},BagMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},BagMediator.prototype.hide=function(){this.world.modelManager.off(n.a.DRAG_TO_DROP,this.handleDrop,this),this.world.modelManager.off(n.a.SCENE_SYNCHRO_PACKAGE,this.handleSynchroPackage,this),this.world.modelManager.off(n.a.UPDATED_CHARACTER_PACKAGE,this.onUpdatePackageHandler,this),this.world.modelManager.off(n.a.QUERY_PACKAGE,this.handleSynchroPackage,this),this.mView&&this.mView.hide()},BagMediator.prototype.handleDrop=function(t){var e=t[0];t[1].getDropType()===r.DROP_TYPE_BAG&&e.getDragType()===a.DRAG_TYPE_SHORTCUT&&s.a.debug("背包拖到快捷栏了！！！")},BagMediator.prototype.refrehView=function(t){var e;if(t)e=t;else{var i=this.mPlayerModel.mainPlayerInfo.package;if(null==i)return;e=i.items}this.setListData(e)},BagMediator.prototype.setListData=function(t){this.mView.setDataList(t)},BagMediator.prototype.handleSynchroPackage=function(t){t.id===this.mPlayerModel.mainPlayerInfo.package.id&&this.refrehView(t.items)},BagMediator.prototype.onUpdatePackageHandler=function(t){t.id===this.mPlayerModel.mainPlayerInfo.package.id&&this.refrehView(t.items)},BagMediator.NAME="BagMediator",BagMediator}()},function(t,e,i){"use strict";i.r(e),i.d(e,"BagUIMediator",(function(){return h}));var a=i(15),r=i(37),n=i(60),s=i(17),o=i(61),h=function(){function BagUIMediator(t,e){this.world=t,this.mPlayerModel=this.world.modelManager.getModel(a.a.NAME),this.mBagModel=this.world.modelManager.getModel(r.a.NAME);var i=this.world.getSize();this.world.game.device.os.desktop?this.mView=new n.BagUIPC(e,this.world,(i.width>>1)-29,i.height-50):this.mView=new o.BagUIMobile(e,this.world),this.mView&&this.mView.show(void 0)}return BagUIMediator.prototype.isSceneUI=function(){return!0},BagUIMediator.prototype.isShow=function(){if(this.mView)return this.mView.isShow()},BagUIMediator.prototype.resize=function(){this.mView&&this.mView.resize()},BagUIMediator.prototype.getView=function(){return this.mView},BagUIMediator.prototype.show=function(t){this.mView&&(this.mView.show(t),this.world.modelManager.on(s.a.QUERY_PACKAGE,this.queryPackAge,this),this.world.modelManager.on(s.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this)),this.mBagModel.register()},BagUIMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},BagUIMediator.prototype.hide=function(){this.world.modelManager.off(s.a.QUERY_PACKAGE,this.queryPackAge,this),this.world.modelManager.off(s.a.UPDATED_CHARACTER_PACKAGE,this.heroItemChange,this),this.mView&&this.mView.hide()},BagUIMediator.prototype.heroItemChange=function(){var t=this.world.modelManager.getModel(a.a.NAME).mainPlayerInfo.package.items;this.mView&&this.world.game.device.os.desktop&&this.mView.setDataList(t)},BagUIMediator.prototype.queryPackAge=function(t){if(t.id===this.mPlayerModel.mainPlayerInfo.package.id){t.items.length;this.mView&&this.world.game.device.os.desktop&&this.mView.setDataList(t.items)}},BagUIMediator.NAME="BagUIMediator",BagUIMediator}()},function(t,e,i){"use strict";i.r(e),i.d(e,"BagUIPC",(function(){return l}));var a=i(28),r=i(36),n=i(15),s=i(38),o=i(37),h=i(8),l=function(){function BagUIPC(t,e,i,a){this.mShowing=!1,this.mWid=0,this.mHei=0,this.mScene=t,this.mWorld=e,this.mParentCon=this.mScene.add.container(i,a),this.bagSlotList=[]}return BagUIPC.prototype.isShow=function(){return this.mShowing},BagUIPC.prototype.show=function(t){this.mShowing||(this.mShowing=!0,this.createPanel())},BagUIPC.prototype.update=function(t){},BagUIPC.prototype.hide=function(){this.destroy()},BagUIPC.prototype.resize=function(){var t=this.mWorld.getSize();this.mParentCon.x=(t.width-this.mWid)/2,this.mParentCon.y=t.height-50},BagUIPC.prototype.destroy=function(){this.mWid=0,this.mHei=0,this.mParentCon&&this.mParentCon.destroy(!0)},BagUIPC.prototype.setDataList=function(t){for(var e,i=[],r=t.length>BagUIPC.SlotMaxCount?BagUIPC.SlotMaxCount:t.length,n=["0","b","c"],s=this.mBagBg.width+5,o=0;o<r;o++){e=o>=9?"bag_SubScript"+n[o%9]:"bag_SubScript"+(o+1);var h=this.bagSlotList[o];h||((h=new a.ItemSlot(this.mScene,this.mWorld,this.mParentCon,0,0,this.mResStr,this.mResPng,this.mResJson,"bag_Slot","",e)).createUI(),this.bagSlotList.push(h),i.push(h.con)),h.dataChange(t[o]),s+=61}if(this.mWid!==s){this.mWid=s;var l=this.mScene.rexUI.add.buttons({x:(s+this.mBagBg.width)/2,y:0,width:56,height:56,orientation:0,buttons:i,groupName:"bagBtn",align:"center",click:{mode:"pointerup",clickInterval:100},space:5,name:"bag"});l.layout(),l.on("button.click",(function(t,e,i,a){}),this),this.mParentCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mWid,this.mHei),Phaser.Geom.Rectangle.Contains),this.resize()}},BagUIPC.prototype.createPanel=function(){this.mResStr="bag",this.mResPng="ui/bag/bag.png",this.mResJson="ui/bag/bag.json",this.mScene.cache.obj.has(this.mResStr)?this.onLoadCompleteHandler():(this.mScene.load.atlas(this.mResStr,h.e.getRes(this.mResPng),h.e.getRes(this.mResJson)),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},BagUIPC.prototype.onLoadCompleteHandler=function(){this.mWid=0,this.mHei=65,this.mBagBtnCon=this.mScene.add.container(0,0),this.mBagBg=this.mScene.add.sprite(0,0,this.mResStr,"bag_BtnBg"),this.mWid+=this.mBagBg.width+5,this.bagBtn=this.mScene.add.sprite(this.mBagBg.x,this.mBagBg.y,this.mResStr,"bag_Btn"),this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,"bag_SubScripta"),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.mBagBg.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.mBagBg.height>>1,this.mBagBtnCon.addAt(this.mBagBg,0),this.mBagBtnCon.addAt(this.bagBtn,1),this.mBagBtnCon.setSize(56,56),this.mBagBtnCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBagBg.width,this.mBagBg.height),Phaser.Geom.Rectangle.Contains),this.mParentCon.add(this.mBagBtnCon),this.bagBtn.setInteractive(),this.bagBtn.on("pointerdown",this.bagHandler,this),this.bagBtn.on("pointerover",this.bagBtnOver,this),this.bagBtn.on("pointerout",this.bagBtnOut,this);var t=this.mWorld.modelManager.getModel(n.a.NAME).mainPlayerInfo;t.package&&t.package.items&&this.setDataList(t.package.items)},BagUIPC.prototype.bagHandler=function(){this.mWorld.uiManager.getMediator(s.UIMediatorType.BagMediator).show();var t=this.mWorld.modelManager.getModel(o.a.NAME),e=this.mWorld.modelManager.getModel(n.a.NAME);t.requestVirtualWorldQueryPackage(e.mainPlayerInfo.package.id,1,r.BagPanel.PageMaxCount)},BagUIPC.prototype.bagBtnOver=function(t){this.mBagSelect=this.mScene.make.sprite(void 0,!1),this.mBagSelect.setTexture(this.mResStr,"bag_BtnSelect"),this.mBagBtnCon.add(this.mBagSelect)},BagUIPC.prototype.bagBtnOut=function(t){this.mBagSelect&&this.mBagSelect.parentContainer&&this.mBagSelect.parentContainer.remove(this.mBagSelect)},BagUIPC.SlotMaxCount=12,BagUIPC}()},function(t,e,i){"use strict";i.r(e),i.d(e,"BagUIMobile",(function(){return l}));var a=i(38),r=i(6),n=i(3),s=i(15),o=i(36),h=i(8),l=function(){function BagUIMobile(t,e){this.mScene=t,this.mWorld=e;this.mWorld.getSize();this.mParentCon=this.mScene.add.container(0,0),this.mParentCon.scaleX=this.mParentCon.scaleY=e.uiScale}return BagUIMobile.prototype.isShow=function(){return this.mShowing},BagUIMobile.prototype.show=function(){this.mShowing||(this.mShowing=!0,this.createPanel())},BagUIMobile.prototype.update=function(){},BagUIMobile.prototype.hide=function(){this.destroy()},BagUIMobile.prototype.resize=function(){var t=this.mWorld.getSize();this.mParentCon.x=t.width-this.mBagBg.width,this.mParentCon.y=this.mBagBg.height>>1},BagUIMobile.prototype.destroy=function(){this.mParentCon.destroy(!0)},BagUIMobile.prototype.createPanel=function(){this.mResStr="bag",this.mResPng="ui/bag/bag.png",this.mResJson="ui/bag/bag.json",this.mScene.cache.obj.has(this.mResStr)?this.onLoadCompleteHandler():(this.mScene.load.atlas(this.mResStr,h.e.getRes(this.mResPng),h.e.getRes(this.mResJson)),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},BagUIMobile.prototype.onLoadCompleteHandler=function(){this.mBagBtnCon=this.mScene.add.container(0,0),this.mBagBg=this.mScene.add.sprite(0,0,this.mResStr,"bag_BtnBg"),this.bagBtn=this.mScene.add.sprite(this.mBagBg.x,this.mBagBg.y,this.mResStr,"bag_Btn"),this.mBagBtnCon.addAt(this.mBagBg,0),this.mBagBtnCon.addAt(this.bagBtn,1),this.mBagBtnCon.setSize(56,56),this.mBagBtnCon.setInteractive(new Phaser.Geom.Rectangle(0,0,this.mBagBg.width,this.mBagBg.height),Phaser.Geom.Rectangle.Contains),this.mParentCon.add(this.mBagBtnCon),this.bagBtn.setInteractive(),this.bagBtn.on("pointerdown",this.bagHandler,this),this.resize()},BagUIMobile.prototype.bagHandler=function(t){this.mWorld.uiManager.getMediator(a.UIMediatorType.BagMediator).show();var e=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),i=e.content,h=this.mWorld.modelManager.getModel(s.a.NAME);i.id=h.mainPlayerInfo.package.id,i.page=1,i.perPage=o.BagPanel.PageMaxCount,this.mWorld.connection.send(e),this.preNextBtnScaleHandler(this.mBagBtnCon)},BagUIMobile.prototype.preNextBtnScaleHandler=function(t,e){void 0===e&&(e=1),this.mScene.tweens.add({targets:t,duration:50,ease:"Linear",props:{scaleX:{value:.5*e},scaleY:{value:.5}},yoyo:!0,repeat:0}),t.scaleX=e,t.scaleY=1},BagUIMobile}()},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatMediator",(function(){return l}));var a,r=i(63),n=i(6),s=i(3),o=i(5),h=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ChatMediator(e,i,a){var n=t.call(this)||this;return n.mInRoom=!1,n.mAllMessage=[],n.mMaxMessageNum=50,n.world=i,n.mChatPanel=new r.ChatPanel(a,i),e.addToUILayer(n.mChatPanel),n.world.connection&&(n.world.connection.addPacketListener(n),n.addHandlerFun(s.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_CHAT,n.handleCharacterChat),n.addHandlerFun(s.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QCLOUD_GME_AUTHBUFFER,n.handleQCLoudGME)),n.mChatPanel.on("sendChat",n.onSendChatHandler,n),n.mChatPanel.on("selectedVoice",n.onSelectedVoiceHandler,n),n.mChatPanel.on("selectedMic",n.onSelectedMicHandler,n),n.world=i,n}return h(ChatMediator,t),ChatMediator.prototype.enterRoom=function(){if(this.room&&this.room.actor&&this.mGMEApi){this.room.actor.id;var t=this.room.id;this.mGMEApi.EnterRoom(t.toString(),1,this.mQCLoudAuth),this.mInRoom=!0,this.sendVoiceRoomStatus(s.op_def.ChatChannel.CurrentScene,t,s.op_def.VoiceRoomStatus.InVoiceRoom)}},ChatMediator.prototype.exitRoom=function(){this.mGMEApi&&(this.mGMEApi.EnableMic(!1),this.mGMEApi.ExitRoom(),this.mInRoom=!1,this.room&&this.sendVoiceRoomStatus(s.op_def.ChatChannel.CurrentScene,this.room.id,s.op_def.VoiceRoomStatus.OutsideVoiceRoom))},ChatMediator.prototype.isSceneUI=function(){return!0},ChatMediator.prototype.getName=function(){return this.mName},ChatMediator.prototype.setName=function(t){this.mName=t},ChatMediator.prototype.getView=function(){return this.mChatPanel},ChatMediator.prototype.isShow=function(){return this.mChatPanel.isShow()},ChatMediator.prototype.resize=function(){this.mChatPanel&&this.mChatPanel.resize()},ChatMediator.prototype.show=function(t){this.mChatPanel.show()},ChatMediator.prototype.update=function(t){this.mChatPanel.update(t)},ChatMediator.prototype.hide=function(){this.mChatPanel.hide()},ChatMediator.prototype.initGME=function(){var t=this;if(this.room.actor){var e=this.room.actor.id;this.mGMEApi=new WebGMEAPI,this.mGMEApi.Init(document,"1400209172",e.toString()),this.mGMEApi.SetTMGDelegate((function(e,i){switch(e){case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ENTER_ROOM:o.a.log("[GME]: EnterRoom: "+i);break;case t.mGMEApi.event.ITMG_MAIN_EVNET_TYPE_USER_UPDATE:break;case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_EXIT_ROOM:o.a.log("[GME]: ExitRoom");break;case t.mGMEApi.event.ITMG_MAIN_EVENT_TYPE_ROOM_DISCONNECT:o.a.log("[GME]: Room Disconnect!!!");break;default:o.a.log("[GME]: Sth wrong...")}}))}},ChatMediator.prototype.appendMessage=function(t,e){t.push(e),t.length>this.mMaxMessageNum&&t.shift()},ChatMediator.prototype.changeMessageChannel=function(){for(var t=this,e=this.mAllMessage.filter((function(e){return e.channel===t.mChatPanel.outChannel||e.channel===s.op_def.ChatChannel.System||null===t.mChatPanel.outChannel})),i=e.length,a=null,r="\n",n=0;n<i;n++)a=e[n],n===i-1&&(r=""),this.mChatPanel.appendChat(a.chat+r)},ChatMediator.prototype.handleCharacterChat=function(t){var e=t.content;if(this.room){this.room.playerManager.get(e.chatSenderid);var i=e.chatSetting.textColor?e.chatSetting.textColor:"#FFFFFF";this.appendMessage(this.mAllMessage,{chat:"[color="+i+"]"+e.chatContext+"[/color]",channel:e.chatChannel}),this.mChatPanel.appendChat("[color="+i+"]"+e.chatContext+"[/color]\n")}},ChatMediator.prototype.onSendChatHandler=function(t){if(this.world.connection){var e=new n.PBpacket(s.op_virtual_world.OPCODE._OP_GATEWAY_REQ_VIRTUAL_WORLD_CHAT),i=e.content;i.chatChannel=0,i.chatContext=t,this.world.connection.send(e)}},ChatMediator.prototype.sendVoiceRoomStatus=function(t,e,i){if(this.room.connection){var a=new n.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS),r=a.content;r.voiceChannel=t,r.voiceRoomId=e,r.voiceRoomStatus=i,this.room.connection.send(a)}},ChatMediator.prototype.handleQCLoudGME=function(t){var e=t.content;this.mQCLoudAuth=e.signature,this.initGME()},ChatMediator.prototype.onSelectedVoiceHandler=function(t){t?this.enterRoom():this.exitRoom()},ChatMediator.prototype.onSelectedMicHandler=function(t){if(this.mGMEApi&&(this.mInRoom&&this.mGMEApi.EnableMic(t),this.world.connection)){var e=new n.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_VOICE_ROOM_STATUS);this.world.connection.send(e)}},Object.defineProperty(ChatMediator.prototype,"room",{get:function(){if(this.world&&this.world.roomManager)return this.world.roomManager.currentRoom},enumerable:!0,configurable:!0}),ChatMediator}(n.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"ChatPanel",(function(){return m}));var a,r=i(137),n=i(138),s=i(31),o=i(12),h=i(67),l=i(13),c=i(8),u=i(68),d=i(41),p=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),m=function(t){function ChatPanel(e,i){var a=t.call(this,e)||this;return a.mWorldService=i,a}return p(ChatPanel,t),ChatPanel.prototype.appendChat=function(t){this.mTextArea&&(this.mTextArea.appendText(t),this.mTextArea.scrollToBottom())},ChatPanel.prototype.setLocation=function(t,e){var i=this.mWorldService.getSize();this.x=8,this.y=i.height-this.height-8},ChatPanel.prototype.preload=function(){this.mScene&&(this.mScene.load.image("button",c.e.getRes("ui/common/button.png")),this.mScene.load.image("chat_input_bg",c.e.getRes("ui/chat/input_bg.png")),this.mScene.load.image("chat_border_bg",c.e.getRes("ui/chat/bg.png")),this.mScene.load.atlas("chat_atlas",c.e.getRes("ui/chat/chat_atlas.png"),c.e.getRes("ui/chat/chat_atlas.json")),t.prototype.preload.call(this))},ChatPanel.prototype.init=function(){if(!this.mInitialized){t.prototype.init.call(this);var e=this.mWorldService.getSize();this.mWidth=464,this.mHeight=281,this.setSize(this.mWidth,this.mHeight);var i=new l.a(this.mScene,4,e.height-260,{width:this.mWidth,height:this.mHeight,key:"chat_border_bg",columns:[4,2,4],rows:[4,2,4]}).setOrigin(0,0);this.add(i);var a=this.mScene.make.container(void 0,!1);this.add(a);var o=new r.a(this.mScene,0,0,2,2,3,8421504,.5);a.add(o);var c=new r.a(this.mScene,100,10,10,10,10,2493956);a.add(c);var p=new d.a(this.mScene,0,0,"",{width:440,height:200,style:{font:"bold 14px YaHei"}});a.add(p);var m=new r.a(this.mScene,0,0,10,20,10,16776960);a.add(m),this.mTextArea=new n.a(this.mScene,{x:230,y:e.height-150,width:440,height:200,textWidth:420,textHeight:190,text:p,slider:{track:c,thumb:m}}).layout(),a.add(this.mTextArea);this.mTextArea.getElement("child");var f=this.mScene.make.container(void 0,!1);this.add(f);var g=new l.a(this.mScene,8,e.height-46,{width:370,height:32,key:"chat_input_bg",columns:[4,2,4],rows:[4,2,4]}).setOrigin(0,0);f.add(g),this.mInputText=new s.a(this.mScene,12,e.height-40,10,10,{type:"input",text:"hello world",fontSize:"14px",color:"#808080"}).resize(370,20).setOrigin(0,0).setStyle({font:"bold 16px YaHei"}).on("focus",this.onFocusHandler,this).on("blur",this.onBlurHandler,this),f.add(this.mInputText);var y=new h.Button(this.mScene,60,e.height-30,{width:60,height:30,key:"button",columns:[4,2,4],rows:[4,2,4]},"发送");y.x=420,y.y=940,y.on("pointerdown",this.onSendMsgHandler,this),f.add(y),this.mSendKey=this.mScene.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.mVoiceBtn=new u.CheckButton(this.mScene,this.width-60,e.height-this.height,"chat_atlas","voice_normal.png","voice_selected.png"),this.add(this.mVoiceBtn),this.mMicBtn=new u.CheckButton(this.mScene,this.width-20,e.height-this.height,"chat_atlas","mic_normal.png","mic_selected.png"),this.add(this.mMicBtn),this.mVoiceBtn.on("selected",this.onSelectedVoiceHandler,this),this.mMicBtn.on("selected",this.onSelectedMicHandler,this)}},ChatPanel.prototype.onSelectedVoiceHandler=function(t){!1===t&&(this.mMicBtn.selected=!1),this.emit("selectedVoice",t)},ChatPanel.prototype.onSelectedMicHandler=function(t){!1!==this.mVoiceBtn.selected?this.emit("selectedMic",t):this.mMicBtn.selected=!1},ChatPanel.prototype.onSendMsgHandler=function(){var t=this.mInputText.text;t.length>0&&(this.emit("sendChat",t),this.mInputText.setText(""),this.mInputText.setBlur())},ChatPanel.prototype.onFocusHandler=function(){this.mWorldService&&this.mWorldService.inputManager&&(this.mWorldService.inputManager.enable=!1,this.mSendKey&&this.mSendKey.on("down",this.onDownEnter,this))},ChatPanel.prototype.onBlurHandler=function(){this.mWorldService&&this.mWorldService.inputManager&&(this.mWorldService.inputManager.enable=!0,this.mSendKey&&this.mSendKey.off("down",this.onDownEnter,this))},ChatPanel.prototype.onDownEnter=function(){this.onSendMsgHandler()},Object.defineProperty(ChatPanel.prototype,"outChannel",{get:function(){return 0},enumerable:!0,configurable:!0}),ChatPanel}(o.Panel)},function(t,e,i){"use strict";e.a=function(t){return t.hasOwnProperty("rexSizer")||(t.rexSizer={}),t.rexSizer}},function(t,e,i){"use strict";const a=Phaser.Display.Align;e.a={center:a.CENTER,left:a.LEFT_CENTER,right:a.RIGHT_CENTER,top:a.TOP_CENTER,bottom:a.BOTTOM_CENTER,"left-top":a.TOP_LEFT,"left-center":a.LEFT_CENTER,"left-bottom":a.LEFT_BOTTOM,"center-top":a.TOP_CENTER,"center-center":a.CENTER,"center-bottom":a.BOTTOM_CENTER,"right-top":a.TOP_RIGHT,"right-center":a.RIGHT_CENTER,"right-bottom":a.RIGHT_BOTTOM}},function(t,e){t.exports=function(t,e,i){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1!==e.indexOf(".")){for(var a=e.split("."),r=t,n=i,s=0;s<a.length;s++){if(!r.hasOwnProperty(a[s])){n=i;break}n=r[a[s]],r=r[a[s]]}return n}return i}return i}},function(t,e,i){"use strict";i.r(e),i.d(e,"Button",(function(){return s}));var a,r=i(13),n=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function Button(e,i,a,n,s){var o=t.call(this,e,i,a)||this;return o.mNingBg=new r.a(o.scene,0,0,n),o.add(o.mNingBg),o.mLabel=o.scene.make.text(void 0,!1).setOrigin(.45,.5).setSize(o.mNingBg.width,o.mNingBg.height).setAlign("center").setText(s),o.add(o.mLabel),o.setSize(o.mNingBg.width,o.mNingBg.height),o.setInteractive(new Phaser.Geom.Rectangle(0,0,o.mNingBg.width,o.mNingBg.height),Phaser.Geom.Rectangle.Contains),o.on("pointerdown",o.changeDown,o),o.on("pointerup",o.changeNormal,o),o.on("pointerout",o.changeNormal,o),o}return n(Button,t),Button.prototype.setTextStyle=function(t){this.mLabel.setStyle(t)},Button.prototype.setTextOffset=function(t,e){this.mLabel.setPosition(t,e)},Button.prototype.changeNormal=function(){this.scale=1},Button.prototype.changeDown=function(){this.scale=.9},Object.defineProperty(Button.prototype,"label",{get:function(){return this.mLabel},enumerable:!0,configurable:!0}),Button}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"CheckButton",(function(){return n}));var a,r=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),n=function(t){function CheckButton(e,i,a,r,n,s){var o=t.call(this,e,i,a,r,n)||this;return o.mSelected=!1,o.mNormalFrame=n,o.mSelectFrame=s,o.setInteractive(new Phaser.Geom.Rectangle(0,0,o.width,o.height),Phaser.Geom.Rectangle.Contains),o.on("pointerup",o.onSelected,o),o}return r(CheckButton,t),CheckButton.prototype.onSelected=function(){this.selected=!this.mSelected,this.emit("selected",this.mSelected)},Object.defineProperty(CheckButton.prototype,"selected",{get:function(){return this.mSelected},set:function(t){if(this.mSelected!==t){this.mSelected=t;var e=t?this.mSelectFrame:this.mNormalFrame;this.setFrame(e)}},enumerable:!0,configurable:!0}),CheckButton}(Phaser.GameObjects.Image)},function(t,e,i){"use strict";e.a=function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}},function(t,e,i){"use strict";i.r(e),i.d(e,"LayerManager",(function(){return a}));var a=function(){function LayerManager(){}return LayerManager.prototype.setScene=function(t){this.destroy(),this.mScene=t,this.mUILayer=t.add.container(0,0),this.mDialogLayer=t.add.container(0,0),this.mToolTipsLyaer=t.add.container(0,0)},LayerManager.prototype.addToUILayer=function(t){this.mUILayer&&this.mUILayer.add(t)},LayerManager.prototype.addToDialogLayer=function(t){this.mDialogLayer&&this.mDialogLayer.add(t)},LayerManager.prototype.addToToolTipsLayer=function(t){this.mToolTipsLyaer&&this.mToolTipsLyaer.add(t)},LayerManager.prototype.removeToUILayer=function(t){this.mUILayer.remove(t)},LayerManager.prototype.removeToDialogLayer=function(t){this.mDialogLayer.remove(t)},LayerManager.prototype.removeToToolTipsLayer=function(t){this.mToolTipsLyaer.remove(t)},LayerManager.prototype.destroy=function(){this.mUILayer&&(this.mUILayer.destroy(),this.mUILayer=null),this.mDialogLayer&&(this.mDialogLayer.destroy(),this.mDialogLayer=null),this.mToolTipsLyaer&&(this.mToolTipsLyaer.destroy(),this.mToolTipsLyaer=null)},LayerManager}()},function(t,e,i){"use strict";i.r(e),i.d(e,"NoticeMediator",(function(){return h}));var a,r=i(72),n=i(6),s=i(3),o=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function NoticeMediator(e,i,a){var n=t.call(this)||this;n.mLayerManager=e;var o=a.connection;return o&&(o.addPacketListener(n),n.addHandlerFun(s.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_NOTICE,n.noticeHandler)),n.mNoticePanel=new r.NoticePanel(i),n}return o(NoticeMediator,t),NoticeMediator.prototype.getView=function(){return this.mNoticePanel},NoticeMediator.prototype.hide=function(){this.mNoticePanel&&this.mLayerManager.removeToDialogLayer(this.mNoticePanel)},NoticeMediator.prototype.isSceneUI=function(){return!1},NoticeMediator.prototype.isShow=function(){return!1},NoticeMediator.prototype.resize=function(){this.mNoticePanel.resize()},NoticeMediator.prototype.show=function(t){this.mNoticePanel.show(t),this.mNoticePanel.showNotice(t),this.mLayerManager.addToDialogLayer(this.mNoticePanel)},NoticeMediator.prototype.update=function(t){},NoticeMediator.prototype.noticeHandler=function(t){this.show(t.content)},NoticeMediator}(n.PacketHandler)},function(t,e,i){"use strict";i.r(e),i.d(e,"NoticePanel",(function(){return l}));var a,r=i(12),n=i(8),s=i(13),o=i(73),h=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function NoticePanel(e){return t.call(this,e)||this}return h(NoticePanel,t),NoticePanel.prototype.show=function(e){t.prototype.show.call(this,e),this.setData("data",e),this.resize()},NoticePanel.prototype.resize=function(){var t=this.scene.cameras.main.worldView;this.x=t.x+t.width>>1,this.y=180},NoticePanel.prototype.showNotice=function(t){var e=this;if(this.mInitialized&&t){this.mTween&&(this.mTween.stop(),this.mTween.remove());var i=t.chatsetting;this.mContentText.setText(t.noticeContext),this.mContentText.setFill(i.textColor?i.textColor:"#FFFFFF"),this.mContentText.x=-(this.mContentText.width>>1),this.mContentText.y=-(this.mContentText.height>>1),this.mTween=this.scene.tweens.add({targets:this,alpha:1,duration:200});var a=i.duration?i.duration:5e3;this.mTween=this.scene.tweens.add({targets:this,alpha:0,duration:200,delay:a,onComplete:function(){e.removeFromParent()}})}},NoticePanel.prototype.preload=function(){this.scene.load.image(n.b.getName(),n.b.getPNG()),t.prototype.preload.call(this)},NoticePanel.prototype.init=function(){var e=new s.a(this.scene,{width:1200,height:120,key:n.b.getName(),columns:n.b.getColumns(),rows:n.b.getRows()});this.add(e),this.mContentText=this.scene.make.text({align:"center",style:{font:o.a.YAHEI_20_BOLD,wordWrap:{width:1180,useAdvancedWrap:!0}}},!1),this.add(this.mContentText),t.prototype.init.call(this);var i=this.getData("data");i&&this.showNotice(i)},NoticePanel.prototype.removeFromParent=function(){this.parentContainer&&this.parentContainer.remove(this),this.mTween&&(this.mTween.stop(),this.mTween.remove(),this.mTween=null)},NoticePanel}(r.Panel)},function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var a=function(){function Font(){}return Font.YAHEI_14_BOLD="bold 14px YaHei",Font.YAHEI_16_BOLD="bold 16px YaHei",Font.YAHEI_18_BOLD="bold 18px YaHei",Font.YAHEI_20_BOLD="bold 20px YaHei",Font}()},function(t,e,i){"use strict";i.r(e),i.d(e,"ComponentRankPanel",(function(){return o}));var a,r=i(48),n=i(8),s=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),o=function(t){function ComponentRankPanel(e,i){return t.call(this,e,i)||this}return s(ComponentRankPanel,t),ComponentRankPanel.prototype.preload=function(){this.scene.load.spritesheet(n.c.getName(),n.c.getPNG(),n.c.getFrameConfig()),t.prototype.preload.call(this)},ComponentRankPanel.prototype.init=function(){t.prototype.init.call(this)},ComponentRankPanel}(r.BasicRankPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"ControlFPanel",(function(){return h}));var a,r=i(12),n=i(8),s=i(73),o=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ControlFPanel(e){return t.call(this,e)||this}return o(ControlFPanel,t),ControlFPanel.prototype.show=function(e){t.prototype.show.call(this,e),this.on("pointerdown",this.onMouseDownHandler,this),this.on("pointerup",this.onMouseUpHandler,this)},ControlFPanel.prototype.hide=function(){this.off("pointerdown",this.onMouseDownHandler,this),this.off("pointerup",this.onMouseUpHandler,this),t.prototype.hide.call(this)},ControlFPanel.prototype.resize=function(){if(this.mScene){var t=this.scene.cameras.main.worldView;this.x=t.x+(t.width>>1),this.y=t.y+(t.height>>1)}},ControlFPanel.prototype.preload=function(){this.scene.load.image("controlF_background",n.e.getRes("ui/controlf/background.png")),t.prototype.preload.call(this)},ControlFPanel.prototype.init=function(){var e=this.scene.make.image({key:"controlF_background"},!1);this.add(e),this.mControlText=this.scene.make.text({align:"center",text:"F",style:{font:s.a.YAHEI_20_BOLD}},!1),this.mControlText.x=-(this.mControlText.width>>1),this.mControlText.y=-(this.mControlText.height>>1),this.add(this.mControlText),this.setSize(e.width,e.height),this.setInteractive(),t.prototype.init.call(this),this.resize()},ControlFPanel.prototype.onMouseDownHandler=function(){this.scale=.8},ControlFPanel.prototype.onMouseUpHandler=function(){this.scale=1,this.emit("control")},ControlFPanel}(r.Panel)},function(t,e,i){"use strict";i.r(e),i.d(e,"RankPanel",(function(){return s}));var a,r=i(48),n=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),s=function(t){function RankPanel(e,i){var a=t.call(this,e,i)||this;return a.mZoomSize=[30,362],a}return n(RankPanel,t),RankPanel.prototype.resize=function(){if(this.mWorld){var t=this.mWorld.getSize();this.x=t.width-371-10,this.y=21}},RankPanel.prototype.init=function(){t.prototype.init.call(this),this.mZoonInBtn=this.scene.make.image({x:158,y:349,key:"rank_atlas",frame:"arrow.png"},!1),this.add(this.mZoonInBtn),this.resize(),this.mZoonInBtn.setInteractive(),this.mZoonInBtn.on("pointerup",this.onZoomHandler,this)},RankPanel.prototype.onZoomHandler=function(){this.currentSizeIndex=0===this.mCurrentIndex?1:0},Object.defineProperty(RankPanel.prototype,"currentSizeIndex",{set:function(t){if(this.mCurrentIndex!==t){this.mCurrentIndex=t;var e=this.mZoomSize[this.mCurrentIndex];this.mBackground.resize(328,e),e>300?(this.add(this.mContentContainer),this.mZoonInBtn.angle=180):(this.mZoonInBtn.angle=0,this.remove(this.mContentContainer)),this.mZoonInBtn.y=e-13}},enumerable:!0,configurable:!0}),RankPanel}(r.BasicRankPanel)},function(t,e,i){"use strict";i.r(e),i.d(e,"UserMenuPanel",(function(){return o}));var a,r=i(12),n=i(8),s=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),o=function(t){function UserMenuPanel(e){return t.call(this,e)||this}return s(UserMenuPanel,t),UserMenuPanel.prototype.preload=function(){this.scene.load.image(n.b.getName(),n.b.getPNG()),t.prototype.preload.call(this)},UserMenuPanel.prototype.init=function(){t.prototype.init.call(this)},UserMenuPanel}(r.Panel)},function(t,e,i){"use strict";i.r(e),i.d(e,"Alert",(function(){return a}));var a=function(){function Alert(t,e){this.mWorld=t,this.mScene=e}return Alert.prototype.isShow=function(){return this.mShowing},Alert.prototype.show=function(t){var e=this,i=this.mWorld.getSize();this.mParentCon=this.mScene.add.container(i.width>>1,i.height>>1);var a=this.mScene.make.text({x:0,y:0,text:t,style:{fill:"#FF0000",fontSize:20}});this.mShowing=!0,this.mParentCon.add(a),this.mParentCon.setSize(a.width,a.height),this.mParentCon.x=i.width-this.mParentCon.width>>1,this.mScene.tweens.add({targets:this.mParentCon,duration:1e3,ease:"Linear",props:{y:{value:(i.height>>1)-80},alhpa:{value:0}},onComplete:function(t,i,a){e.destroy()},onCompleteParams:[this]})},Alert.prototype.hide=function(){},Alert.prototype.resize=function(){},Alert.prototype.destroy=function(){this.mParentCon&&this.mParentCon.destroy(!0),this.mShowing=!1},Alert.prototype.update=function(){},Alert}()},function(t,e,i){"use strict";i.r(e),i.d(e,"ComboBox",(function(){return n})),i.d(e,"ComboBoxItem",(function(){return s}));var a,r=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),n=function(t){function ComboBox(e,i){var a=t.call(this,e)||this;return a.mIsopen=!1,a.mScene=e,a.mConfig=i,a.init(),a}return r(ComboBox,t),ComboBox.prototype.selectCall=function(t){this.mtxt.text=t.text,this.mtxt.x=this.mConfig.wid-this.mtxt.width>>1,this.mtxt.y=this.mConfig.hei-this.mtxt.height>>1,this.showTween(!1),this.mConfig.clickCallBack&&this.mConfig.clickCallBack.call(this,t)},Object.defineProperty(ComboBox.prototype,"text",{set:function(t){if(this.itemList){for(var e=this.itemList.length,i=0;i<e;i++){(r=this.itemList[i])&&r.destroy()}this.itemList.length=0}this.itemList=[];var a=t.length;for(i=0;i<a;i++){var r=new s(this.mScene,this,this.mConfig.wid,this.mConfig.hei),n=t[i];r.itemData={index:i,text:n,data:{}},this.itemList.push(r)}this.selectCall(this.itemList[0].itemData)},enumerable:!0,configurable:!0}),ComboBox.prototype.destroy=function(){if(this.itemList){for(var e=this.itemList.length,i=0;i<e;i++){var a=this.itemList[i];a&&a.destroy()}this.itemList.length=0,this.itemList=null}t.prototype.destroy.call(this,!0)},ComboBox.prototype.init=function(){var t=this.mConfig.resKey,e=this.mConfig.resPng,i=this.mConfig.resJson;this.mScene.cache.obj.has(t)?this.onLoadCompleteHandler():(this.mScene.load.atlas(t,e,i),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onLoadCompleteHandler,this),this.mScene.load.start())},ComboBox.prototype.onLoadCompleteHandler=function(){var t=this.mConfig.resKey;this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(t,this.mConfig.resBg),this.mBg.x=this.mConfig.wid/2,this.mBg.y=this.mConfig.hei/2,this.mBg.setSize(this.mConfig.wid,this.mConfig.hei),this.mArrow=this.mScene.make.image(void 0,!1),this.mArrow.setTexture(t,this.mConfig.resArrow),this.mArrow.scaleY=this.mConfig.up?-1:1,this.mArrow.x=this.mConfig.wid-this.mArrow.width,this.mArrow.y=4+(this.mConfig.hei-this.mArrow.height>>1),this.mtxt=this.mScene.make.text({x:0,y:0,style:{fill:"#F7EDED",fontSize:18}},!1),this.add(this.mBg),this.add(this.mArrow),this.add(this.mtxt),this.mBg.setInteractive(),this.mBg.on("pointerdown",this.openHandler,this)},ComboBox.prototype.openHandler=function(){!this.itemList||this.itemList.length<1||this.showTween(this.mIsopen)},ComboBox.prototype.showTween=function(t){t?(this.mItemBG=this.createTexture(),this.addAt(this.mItemBG,0)):this.mItemBG&&(this.mItemBG.parentContainer&&this.mItemBG.parentContainer.remove(this.mItemBG),this.mItemBG.destroy()),this.mArrow.scaleY=t?1:-1,this.showTweenItem(t),this.mIsopen=!this.mIsopen},ComboBox.prototype.showTweenItem=function(t){for(var e=this,i=this.itemList.length,_loop_1=function(i){var r=a.itemList[i];if(!r)return"continue";r.x=a.mConfig.wid>>1,a.add(r),a.mScene.tweens.add({targets:r,duration:50*i,props:{y:{value:t?-a.mConfig.hei*i-a.mConfig.hei/2:-a.mConfig.hei>>1},alpha:{value:t?1:0}},onComplete:function(i,a,n){t||e.remove(r)},onCompleteParams:[a]})},a=this,r=0;r<i;r++)_loop_1(r)},ComboBox.prototype.createTexture=function(){var t=this.mConfig.hei*this.itemList.length,e=this.mScene.make.graphics(void 0,!1);return e.fillStyle(4012088,.8),e.fillRect(0,-t,this.mConfig.wid,t),e},ComboBox}(Phaser.GameObjects.Container),s=function(t){function ComboBoxItem(e,i,a,r){var n=t.call(this,e)||this;n.mCombobox=i,n.mText=n.scene.make.text({x:-a>>1,y:-r>>1,style:{fill:"#F7EDED",fontSize:18}},!1);return n.mSelectBG=e.make.graphics(void 0,!1),n.mSelectBG.fillStyle(16763904,.8),n.mSelectBG.fillRect(-a>>1,-r>>1,a,r),n.mSelectBG.visible=!1,n.addAt(n.mSelectBG,0),n.add(n.mText),n.setSize(a,r),n.setInteractive(),n.on("pointerover",n.overHandler,n),n.on("pointerout",n.outHandler,n),n.on("pointerdown",n.selectHandler,n),n}return r(ComboBoxItem,t),Object.defineProperty(ComboBoxItem.prototype,"itemData",{get:function(){return this.mData},set:function(t){this.mData=t,this.mText.text=this.mData.text,this.mText.x=-this.width/2+(this.width-this.mText.width>>1),this.mText.y=-this.height/2+(this.height-this.mText.height>>1)},enumerable:!0,configurable:!0}),ComboBoxItem.prototype.destroy=function(){t.prototype.destroy.call(this,!0)},ComboBoxItem.prototype.setSelected=function(t){this.mSelectBG.visible=t},ComboBoxItem.prototype.overHandler=function(){this.mSelectBG.visible=!0},ComboBoxItem.prototype.selectHandler=function(){this.overHandler(),this.mCombobox.selectCall(this.itemData)},ComboBoxItem.prototype.outHandler=function(){this.mSelectBG.visible=!1},ComboBoxItem}(Phaser.GameObjects.Container)},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopPanel",(function(){return l}));var a,r=i(12),n=i(8),s=i(84),o=i(5),h=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function ShopPanel(e,i){var a=t.call(this,e)||this;return a.mWorld=i,a}return h(ShopPanel,t),ShopPanel.prototype.isShow=function(){return this.mShowing},ShopPanel.prototype.resize=function(){var t=this.mWorld.getSize();this.mParentCon&&(this.mParentCon.x=t.width>>1,this.mParentCon.y=t.height-300)},ShopPanel.prototype.setDataList=function(t){this.mDataList=t,this.mInitialized&&this.refreshDataList()},ShopPanel.prototype.destroy=function(){this.mShopItemSlotList&&(this.mShopItemSlotList.forEach((function(t){t&&t.destory()})),this.mShopItemSlotList.length=0,this.mShopItemSlotList=null),this.mDataList&&(this.mDataList.length=0,this.mDataList=null),this.mParentCon&&this.mParentCon.destroy(!0),this.mInitialized=!1},ShopPanel.prototype.preload=function(){this.mScene&&(this.mScene.load.atlas("shopView",n.e.getRes("ui/shop/shopView.png"),n.e.getRes("ui/shop/shopView.json")),t.prototype.preload.call(this))},ShopPanel.prototype.init=function(){if(!this.mInitialized){t.prototype.init.call(this);var e=this.mWorld.getSize();this.mParentCon=this.mScene.add.container(e.width>>1,e.height-300);var i=this.mScene.make.sprite(void 0,!1);i.setTexture("shopView","shopView_bg"),i.x=0,i.y=0,this.mParentCon.setSize(i.width,i.height),this.mParentCon.addAt(i,0);var a=this.mScene.make.sprite(void 0,!1);a.setTexture("shopView","shopView_titleIcon"),a.x=35+(-i.width>>1),a.y=-i.height>>1,this.mParentCon.add(a);var r,n,o,h=this.mScene.make.text(void 0,!1);h.setFontFamily("Tahoma"),h.setFontStyle("bold"),h.setFontSize(20),h.setText("内购商城"),h.x=a.x+a.width-10,h.y=a.y-(h.height>>1),this.mParentCon.add(h),this.mShopItemSlotList=[];for(var l=0;l<20;l++)n=l%5*100-i.width/2+75,o=90*Math.floor(l/5)-i.height/2+80,(r=new s.ShopItemSlot(this.mScene,this.mWorld,this.mParentCon,n,o,"shopView","ui/shop/shopView.png","ui/shop/shopView.json","shopView_bagSlot",null,null)).createUI(),this.mShopItemSlotList.push(r);this.mScene.cache.obj.has("clsBtn")?this.onClsLoadCompleteHandler():(this.mScene.load.spritesheet("clsBtn","resources/ui/common/common_clsBtn.png",{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onClsLoadCompleteHandler,this),this.mScene.load.start())}},ShopPanel.prototype.loadComplete=function(t,e,i){this.mInitialized||this.init()},ShopPanel.prototype.onClsLoadCompleteHandler=function(){this.mClsBtnSprite=this.mScene.make.sprite(void 0,!1),this.mClsBtnSprite.setTexture("clsBtn","btn_normal"),this.mClsBtnSprite.x=(this.mParentCon.width>>1)-65,this.mClsBtnSprite.y=-this.mParentCon.height>>1,this.mClsBtnSprite.setInteractive(),this.mClsBtnSprite.on("pointerup",this.hide,this),this.mParentCon.add(this.mClsBtnSprite)},ShopPanel.prototype.refreshDataList=function(){if(this.mDataList)for(var t,e=ShopPanel.ShopSlotCount,i=0;i<e;i++)(t=this.mShopItemSlotList[i])&&t.dataChange(this.mDataList[i]);else o.a.error("this.mDataList is undefiend")},ShopPanel.ShopSlotCount=20,ShopPanel}(r.Panel)},function(t,e,i){"use strict";var a=i(14);const r=Phaser.Math.Percent;var slider_PositionToPercent=function(t,e,i){var a,n,s;return t.y===e.y?(a=Math.min(t.x,e.x),n=Math.max(t.x,e.x),s=r(i.x,a,n)):t.x===e.x&&(a=Math.min(t.y,e.y),n=Math.max(t.y,e.y),s=r(i.y,a,n)),s},n={},slider_OnDragThumb=function(t,e,i){this.enable&&(n.x=e,n.y=i,this.value=slider_PositionToPercent(this.getStartPoint(),this.getEndPoint(),n))},s={},slider_OnTouchTrack=function(t,e,i){this.enable&&t.isDown&&(s.x=t.worldX,s.y=t.worldY,this.value=slider_PositionToPercent(this.getStartPoint(),this.getEndPoint(),s))};const o=Phaser.Display.Align.In.QuickSet;var h={},slider_GetThumbAlignPoint=function(t,e){void 0===e&&(e=h);var i=this.childrenMap.thumb,a=i.x,r=i.y;return o(i,this,t),e.x=i.x,e.y=i.y,i.x=a,i.y=r,e};const l=Phaser.Display.Align.LEFT_CENTER,c=Phaser.Display.Align.TOP_CENTER;var u={},slider_GetStartPoint=function(t){if(void 0===t&&(t=u),this.childrenMap.thumb){var e=0===this.orientation?c:l;slider_GetThumbAlignPoint.call(this,e,t)}else 0===this.orientation?(t.x=this.centerX,t.y=this.top+1):(t.x=this.left+1,t.y=this.centerY);return t};const d=Phaser.Display.Align.RIGHT_CENTER,p=Phaser.Display.Align.BOTTOM_CENTER;var m={},GetEndPoint=function(t){if(void 0===t&&(t=m),this.childrenMap.thumb){var e=1===this.orientation?d:p;slider_GetThumbAlignPoint.call(this,e,t)}else 0===this.orientation?(t.x=this.centerX,t.y=this.bottom-1):(t.x=this.right-1,t.y=this.centerY);return t};const f=Phaser.Math.Linear;var g={},slider_PercentToPosition=function(t,e,i,a){return void 0===a&&(a=g),a.x=f(e.x,i.x,t),a.y=f(e.y,i.y,t),a},slider_UpdateThumb=function(t){var e=this.childrenMap.thumb;return void 0===e?this:(void 0===t&&(t=this.value),slider_PercentToPosition(t,this.getStartPoint(),this.getEndPoint(),e),this.resetChildPositionState(e),this)},y=i(20);const _=Phaser.Display.Align.In.QuickSet,v=Phaser.Display.Align.LEFT_CENTER,b=Phaser.Display.Align.TOP_CENTER;var slider_UpdateIndicator=function(t){var e,i,a=this.childrenMap.indicator;if(void 0===a)return this;void 0===t&&(t=this.value);var r=this.childrenMap.thumb;r?0===this.orientation?i=r.y-r.displayHeight*r.originY+r.displayHeight-this.top:e=r.x-r.displayWidth*r.originX+r.displayWidth-this.left:0===this.orientation?i=this.height*t:e=this.width*t;Object(y.a)(a,e,i);var n=1===this.orientation?v:b;_(a,this,n),this.resetChildPositionState(a)};const P=Phaser.Utils.Objects.GetValue,S=Phaser.Math.Clamp,D=Phaser.Math.Linear,T=Phaser.Math.Percent,x=Phaser.Math.Snap.To;class C extends a.a{constructor(t,e){super(t,e),this.type="rexSlider",this.eventEmitter=P(e,"eventEmitter",this);var i=P(e,"background",void 0),a=P(e,"track",void 0),r=P(e,"indicator",void 0),n=P(e,"thumb",void 0),s=P(e,"space.left",0),o=P(e,"space.right",0),h=P(e,"space.top",0),l=P(e,"space.bottom",0);if(i&&this.addBackground(i),a){var c={left:s,right:o,top:h,bottom:l};this.add(a,0,void 0,c,!0)}r&&this.add(r,null),n&&this.add(n,null);var u=P(e,"input",0);switch("string"==typeof u&&(u=O[u]),u){case 0:n&&(n.setInteractive(),this.scene.input.setDraggable(n),n.on("drag",slider_OnDragThumb,this));break;case 1:this.setInteractive().on("pointerdown",slider_OnTouchTrack,this).on("pointermove",slider_OnTouchTrack,this)}this.addChildrenMap("background",i),this.addChildrenMap("track",a),this.addChildrenMap("indicator",r),this.addChildrenMap("thumb",n);var d=P(e,"valuechangeCallback",null);if(null!==d){var p=P(e,"valuechangeCallbackScope",void 0);this.eventEmitter.on("valuechange",d,p)}this.setEnable(P(e,"enable",void 0)),this.setGap(P(e,"gap",void 0)),this.setValue(P(e,"value",0))}setEnable(t){return void 0===t&&(t=!0),this.enable=t,this}setGap(t){return this.gap=t,this}get value(){return this._value}set value(t){void 0!==this.gap&&(t=x(t,this.gap));var e=this._value;this._value=S(t,0,1),e!==this._value&&(this.updateThumb(this._value),this.updateIndicator(this._value),this.eventEmitter.emit("valuechange",this._value,e,this.eventEmitter))}setValue(t,e,i){return null==t?this:(void 0!==e&&(t=T(t,e,i)),this.value=t,this)}addValue(t,e,i){return void 0!==e&&(t=T(t,e,i)),this.value+=t,this}getValue(t,e){var i=this.value;return void 0!==t&&(i=D(t,e,i)),i}layout(t,e,i){return super.layout(t,e,i),this.updateThumb(),this.updateIndicator(),this}}const O={drag:0,click:1,none:-1};var M={getStartPoint:slider_GetStartPoint,getEndPoint:GetEndPoint,updateThumb:slider_UpdateThumb,updateIndicator:slider_UpdateIndicator};Object.assign(C.prototype,M);e.a=C},function(t,e,i){"use strict";var a=i(14),r=i(47),n=i(81),s=i(136).a;const o=Phaser.Utils.Objects.GetValue;var scrollable_CreateScrollableSizer=function(t){var e,i,h=this.scene,l=Object(r.a)(t),c=new a.a(h,{orientation:l}),u=o(t,"child.gameObject",void 0),d=o(t,"slider",void 0),p=o(t,"scroller",!0);if(u){var m=o(t,"space.child",0);if(this.childPadding={},"number"!=typeof m){var f=m;0===l?(m=o(f,"right",0),this.childPadding.top=o(f,"top",0),this.childPadding.bottom=o(f,"bottom",0)):(m=o(f,"bottom",0),this.childPadding.top=o(f,"left",0),this.childPadding.bottom=o(f,"right",0))}else this.childPadding.top=0,this.childPadding.bottom=0;var g,y=o(t,"child.proportion",1),_=o(t,"child.expand",!0);g=0===l?{right:d?m:0}:{bottom:d?m:0},c.add(u,y,"center",g,_),d&&(!0===d&&(d={}),d.orientation=c.orientation,e=new n.a(h,d),c.add(e,0,"center",0,!0)),p&&(!0===p&&(p={}),p.orientation=l,i=new s(u,p))}return e&&e.on("valuechange",(function(t){this.t=t}),this),i&&i.on("valuechange",(function(t){this.childOY=t}),this),this.addChildrenMap("child",u),this.addChildrenMap("slider",e),this.addChildrenMap("scroller",i),c};const h=Phaser.Utils.Objects.GetValue;class l extends a.a{constructor(t,e){void 0===e&&(e={});var i=Object(r.a)(e);e.orientation=0===i?1:0,super(t,e),this.type=h(e,"type","rexScrollable");var a=h(e,"background",void 0),n=scrollable_CreateScrollableSizer.call(this,e),s=h(e,"header",void 0),o=h(e,"footer",void 0),l=h(e,"space.left",0),c=h(e,"space.right",0),u=h(e,"space.top",0),d=h(e,"space.bottom",0);if(a&&this.addBackground(a),s){var p=h(e,"align.header","center"),m=h(e,"space.header",0);g=0===i?{left:l,right:c,top:u,bottom:m}:{left:l,right:m,top:u,bottom:d};var f=h(e,"expand.header",!0);this.add(s,0,p,g,f)}n&&(g=0===i?{left:l,right:c,top:s?0:u,bottom:o?0:d}:{left:s?0:l,right:o?0:c,top:u,bottom:d},this.add(n,1,"center",g,!0));if(o){p=h(e,"align.footer","center");var g,y=h(e,"space.footer",0);g=0===i?{left:l,right:c,top:y,bottom:d}:{left:y,right:c,top:u,bottom:d};f=h(e,"expand.footer",!0);this.add(o,0,p,g,f)}this.addChildrenMap("background",a),this.addChildrenMap("header",s),this.addChildrenMap("footer",o)}layout(t,e,i){return super.layout(t,e,i),this.resizeController(),this}resizeController(){var t=this.topChildOY,e=this.bottomChildOY,i=this.childrenMap.scroller,a=this.childrenMap.slider;return i&&i.setBounds(e,t),a&&a.setEnable(e!==t),this.updateController(),this}updateController(){var t=this.childrenMap.scroller,e=this.childrenMap.slider;t&&t.setValue(this.childOY),e&&e.setValue(this.t)}set t(t){var e=this.childPadding;if(0!==e.top||0!==e.bottom){var i=this.childrenMap.child,a=i.topChildOY-i.bottomChildOY;t=((a+e.top+e.bottom)*t-e.top)/a}this.childrenMap.child.t=t,this.updateController()}get t(){var t=this.childrenMap.child.t,e=this.childPadding;if(0!==e.top||0!==e.bottom){var i=this.childrenMap.child,a=i.topChildOY-i.bottomChildOY,r=a+e.top+e.bottom;t=(a*t+e.top)/r}return t}set childOY(t){this.childrenMap.child.childOY=t,this.updateController()}get childOY(){return this.childrenMap.child.childOY}get topChildOY(){return this.childrenMap.child.topChildOY+this.childPadding.top}get bottomChildOY(){return this.childrenMap.child.bottomChildOY-this.childPadding.bottom}setChildOY(t){return this.childOY=t,this}setT(t){return this.t=t,this}scrollToTop(){return this.t=0,this}scrollToBottom(){return this.t=1,this}get sliderEnable(){var t=this.childrenMap.slider;if(t)return t.enable}set sliderEnable(t){var e=this.childrenMap.slider;e&&e.setEnable(t)}setSliderEnable(t){return void 0===t&&(t=!0),this.sliderEnable=t,this}get scrollerEnable(){var t=this.childrenMap.scroller;if(t)return t.enable}set scrollerEnable(t){var e=this.childrenMap.scroller;e&&e.setEnable(t)}setScrollerEnable(t){return void 0===t&&(t=!0),this.scrollerEnable=t,this}}e.a=l},function(t,e,i){"use strict";const a=Phaser.Display.Canvas.CanvasPool;var r={},textstyle_MeasureText=function(t){var e=a.create(this),i=e.getContext("2d");t.syncFont(e,i);var n=Math.ceil(i.measureText(t.testString).width*t.baselineX),s=n,o=2*s;s=s*t.baselineY|0,e.width=n,e.height=o,i.fillStyle="#f00",i.fillRect(0,0,n,o),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,s);var h=r;if(!i.getImageData(0,0,n,o))return h.ascent=s,h.descent=s+6,h.fontSize=h.ascent+h.descent,a.remove(e),h;var l,c,u=i.getImageData(0,0,n,o).data,d=u.length,p=4*n,m=0,f=!1;for(l=0;l<s;l++){for(c=0;c<p;c+=4)if(255!==u[m+c]){f=!0;break}if(f)break;m+=p}for(h.ascent=s-l,m=d-p,f=!1,l=o;l>s;l--){for(c=0;c<p;c+=4)if(255!==u[m+c]){f=!0;break}if(f)break;m-=p}return h.descent=l-s,h.fontSize=h.ascent+h.descent,a.remove(e),h},n=i(22);const s=Phaser.Utils.Objects.GetAdvancedValue,o=Phaser.Utils.Objects.GetValue;var h={backgroundColor:["backgroundColor",null],fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],underlineColor:["underline.color","#000"],underlineThickness:["underline.thickness",0],underlineOffset:["underline.offset",0],halign:["halign",0],valign:["valign",0],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],lineSpacing:["lineSpacing",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wrapMode:["wrap.mode",1],wrapWidth:["wrap.width",0]};const l={left:n.a.hleft,center:n.a.hcenter,right:n.a.hright},c={top:n.a.vtop,center:n.a.vcenter,bottom:n.a.vbottom},u={none:n.a.NO_WRAP,word:n.a.WORD_WRAP,char:n.a.CHAR_WRAP,character:n.a.CHAR_WRAP};e.a=class{constructor(t,e){this.parent=t,this.backgroundColor,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1);var i=o(e,"metrics",!1);this.metrics=i?{ascent:o(i,"ascent",0),descent:o(i,"descent",0),fontSize:o(i,"fontSize",0)}:textstyle_MeasureText(this)}setStyle(t,e){if(void 0===e&&(e=!0),t&&t.hasOwnProperty("halign")&&"string"==typeof t.halign&&(t.halign=l[t.halign.toLowerCase()]||0),t&&t.hasOwnProperty("valign")&&"string"==typeof t.valign&&(t.valign=c[t.valign.toLowerCase()]||0),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var a=i.mode;"string"==typeof a&&(i.mode=u[a])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var r in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),h)this[r]="wrapCallback"===r||"wrapCallbackScope"===r?o(t,h[r][0],h[r][1]):s(t,h[r][0],h[r][1]);var n=o(t,"font",null);this._font=null===n?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:n;var d=o(t,"fill",null);return null!==d&&(this.color=d),e?this.update(!0):this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=this.fontStyle+" "+this.fontSize+" "+this.fontFamily,this.metrics=textstyle_MeasureText(this)),this.parent.updateText(t)}buildFont(){var t=this.fontStyle+" "+this.fontSize+" "+this.fontFamily;return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=o(t,"fontFamily","Courier"),this.fontSize=o(t,"fontSize","16px"),this.fontStyle=o(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1)}setResolution(t){return this.resolution=t,this.update(!1)}setLineSpacing(t){return this.lineSpacing=t,this.update(!1)}setBackgroundColor(t){return this.backgroundColor=t,this.update(!1)}setFill(t){return this.color=t,this.update(!1)}setColor(t){return this.color=t,this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=t,this.strokeThickness=e),this.update(!0)}setShadow(t,e,i,a,r,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===a&&(a=0),void 0===r&&(r=!1),void 0===n&&(n=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=a,this.shadowStroke=r,this.shadowFill=n,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,i){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===i&&(i=0),this.underlineColor=t,this.underlineThickness=e,this.underlineOffset=i,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=t,this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=u[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),"string"==typeof t&&(t=l[t.toLowerCase()]||0),"string"==typeof e&&(e=l[e.toLowerCase()]||0),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t=0),"string"==typeof t&&(t=l[t.toLowerCase()]||0),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t=0),"string"==typeof t&&(t=l[t.toLowerCase()]||0),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}get lineHeight(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}toJSON(){var t={};for(var e in h)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}}},function(t,e,i){"use strict";i.r(e);var a,r,n,s=i(28),o=i(46),h=i(3),l=i(8);r=a||(a={}),n=function(){function TuDing18(){}return TuDing18.getName=function(){return"ui_moneyIcon_tuding_18_png"},TuDing18.getPNG=function(){return l.e.getRes("ui/moneyIcon/tuding_18.png")},TuDing18}(),r.TuDing18=n,i.d(e,"ShopItemSlot",(function(){return d}));var c,u=(c=function(t,e){return(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),d=function(t){function ShopItemSlot(e,i,a,r,n,s,o,h,l,c,u){return t.call(this,e,i,a,r,n,s,o,h,l,c)||this}return u(ShopItemSlot,t),ShopItemSlot.prototype.dataChange=function(e){var i=this;t.prototype.dataChange.call(this,e);for(var r=e.price,n=r.length,_loop_1=function(t){var e=void 0,n=void 0;r[t].coinType===h.op_def.CoinType.TU_DING_COIN&&(n=a.TuDing18.getName(),e=a.TuDing18.getPNG()),s.mScene.load.once(Phaser.Loader.Events.COMPLETE,(function(){i.makeCoin(r[t],20*t+30)})),s.mScene.load.image(n,e),s.mScene.load.start()},s=this,o=0;o<n;o++)_loop_1(o)},ShopItemSlot.prototype.makeCoin=function(t,e){var i,r;t.coinType===h.op_def.CoinType.TU_DING_COIN&&(r=a.TuDing18.getName(),i=a.TuDing18.getPNG());var n=this.mScene.make.image(void 0,!1);n.x=15+(-this.mWid>>1),n.y=e,this.con.add(n),n.setTexture(r,i);var s=this.mScene.make.text(void 0,!1);s.setFontFamily("Tahoma"),s.setFontStyle("bold"),s.setFontSize(15),s.x=-this.mWid/2+n.width+20,s.y=e-9,this.con.add(s),s.setText(t.price.toString())},ShopItemSlot.prototype.onLoadCompleteHandler=function(){this.mWid=80,this.mHei=88,this.itemBG=this.mScene.make.sprite(void 0,!1),this.itemBG.setTexture(this.mResStr,this.mResSlot),this.itemBG.y=-10,this.con.setSize(this.mWid,this.mHei),this.con.addAt(this.itemBG,0),this.mIcon=new o.DragDropIcon(this.mScene,0,-10),this.con.addAt(this.mIcon,1),this.mSubScriptRes&&(this.mSubScriptSprite=this.mScene.make.sprite(void 0,!1),this.mSubScriptSprite.setTexture(this.mResStr,this.mSubScriptRes),this.mSubScriptSprite.x=this.mSubScriptSprite.width-this.itemBG.width>>1,this.mSubScriptSprite.y=this.mSubScriptSprite.height-this.itemBG.height>>1),this.con.setInteractive(new Phaser.Geom.Rectangle(0,0,this.itemBG.width,56),Phaser.Geom.Rectangle.Contains),this.con.on("pointerover",this.overHandler,this),this.con.on("pointerout",this.outHandler,this),this.con.on("pointerdown",this.downHandler,this),this.minitialize=!0,this.mData&&this.dataChange(this.mData),this.mSelectSprite=this.mScene.make.sprite(void 0,!1),this.createTexture(this.mWid,this.mHei),this.mSelectSprite.setTexture("selectBg"),this.mSelectSprite.visible=!1,this.con.addAt(this.mSelectSprite,0)},ShopItemSlot.prototype.overHandler=function(t){this.mSelectSprite.visible=!0},ShopItemSlot.prototype.outHandler=function(t){this.mSelectSprite.visible=!1},ShopItemSlot.prototype.createTexture=function(t,e){var i=this.mScene.add.graphics();i.fillStyle(11184553,.3),i.fillRoundedRect(0,0,t,e,5),i.generateTexture("selectBg",t,e),i.clear()},ShopItemSlot}(s.ItemSlot)},function(t,e,i){"use strict";var a=i(94),r=i(3),n=function(){function MapInfo(){this.mapId=1,this.zStart=0,this.zEnd=0,this._mapTotalWidth=0,this._bgSound=1,this._voiceChatRoomId=0,this._mapTotalHeight=0}return Object.defineProperty(MapInfo.prototype,"bgSound",{get:function(){return this._bgSound},set:function(t){this._bgSound=t},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"mapTotalWidth",{get:function(){return this._mapTotalWidth},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"mapTotalHeight",{get:function(){return this._mapTotalHeight},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"tileWidth",{get:function(){return this._tileWidth},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"tileHeight",{get:function(){return this._tileHeight},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"terrainConfig",{get:function(){return this._terrainConfig},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"elementConfig",{get:function(){return this._elementConfig},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"cols",{get:function(){return this._cols},set:function(t){this._cols=t},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"rows",{get:function(){return this._rows},set:function(t){this._rows=t},enumerable:!0,configurable:!0}),Object.defineProperty(MapInfo.prototype,"voiceChatRoomId",{get:function(){return this._voiceChatRoomId},set:function(t){this._voiceChatRoomId=t},enumerable:!0,configurable:!0}),MapInfo.prototype.setConfig=function(t,e,i,a,r,n){this._cols=t,this._rows=e,this.zStart=i,this.zEnd=a,this._tileWidth=r,this._tileHeight=n,this._mapTotalWidth=(this._rows+this._cols)*(this._tileWidth/2),this._mapTotalHeight=(this._rows+this._cols)*(this._tileHeight/2)},MapInfo.prototype.setTerrainInfo=function(t){this._terrainConfig=[];for(var e,i=t.length,r=0;r<i;r++)e=new a.a(t[r]),this._terrainConfig.push(e)},MapInfo.prototype.addTerrainInfo=function(t){for(var e,i=t.length,r=0;r<i;r++)e=new a.a(t[r]),this._terrainConfig.push(e)},MapInfo.prototype.setElementInfo=function(t){this._elementConfig=[];for(var e,i=t.length,r=0;r<i;r++)e=new a.a(t[r]),this._elementConfig.push(e)},MapInfo.prototype.addElementInfo=function(t){for(var e,i=t.length,r=0;r<i;r++)e=new a.a(t[r]),this._elementConfig.push(e)},MapInfo.prototype.addPackItems=function(t,e){var i=this.getElementInfo(t);i&&(i.package||(i.package=r.op_gameconfig.Package.create()),i.package.items=i.package.items.concat(e))},MapInfo.prototype.removePackItems=function(t,e){var i=this.getElementInfo(t);if(i)for(var a=i.package.items.length,r=0;r<a;r++)if(e===i.package.items[r].id)return i.package.items.splice(r,1),!0;return!1},MapInfo.prototype.getElementInfo=function(t){for(var e=this._elementConfig.length,i=0;i<e;i++)if(this._elementConfig[i].id===t)return this._elementConfig[i];return null},MapInfo}(),s=i(17);i.d(e,"a",(function(){return o}));var o=function(){function MapDataModel(t){this.mWorld=t,this.mWorld.modelManager&&(this.mModelDispatch=this.mWorld.modelManager),this.mConnect=this.mWorld.connection,this.mMapInfo=new n}return MapDataModel.prototype.getInitialize=function(){return this.initialize},MapDataModel.prototype.geMapInfo=function(){return this.mMapInfo},MapDataModel.prototype.register=function(){},MapDataModel.prototype.unRegister=function(){},MapDataModel.prototype.setMapInfo=function(t){this.mMapInfo.mapId=t.id,this.mMapInfo.voiceChatRoomId=t.voiceChatRoomId,this.mMapInfo.setConfig(t.cols,t.rows,t.zStart,t.zEnd,t.tileWidth,t.tileHeight),this.mMapInfo.setTerrainInfo(t.terrains),this.mMapInfo.setElementInfo(t.elements),!1===this.initialize&&(this.initialize=!0,this.mModelDispatch.emit(s.a.SCENE_DATA_INITIALIZE))},MapDataModel.prototype.addPackItems=function(t,e){this.mMapInfo.addPackItems(t,e)},MapDataModel.prototype.removePackItems=function(t,e){this.mMapInfo.removePackItems(t,e)},MapDataModel.NAME="MapDataModel",MapDataModel}()},,,,,,,,,function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));var a=i(5),r=i(171),n=function(){function FramesModel(t){this.discriminator="FramesModel",this.id=t.id,this.type=t.sn;var e=t.animations;e&&(this.animationName=e.defaultAnimationName,this.setDisplay(e.display),this.setAnimationData(e.animationData))}return FramesModel.prototype.setInfo=function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])},FramesModel.prototype.getAnimationData=function(){return this.animations},FramesModel.prototype.getAnimations=function(t){if(this.animations)return this.animations.get(t)},FramesModel.prototype.destroy=function(){this.animations&&this.animations.clear()},Object.defineProperty(FramesModel.prototype,"gene",{get:function(){return this.mGen},enumerable:!0,configurable:!0}),FramesModel.prototype.setDisplay=function(t){t?(this.display={dataPath:t.dataPath,texturePath:t.texturePath},this.mGen=r.sync(t.dataPath+t.texturePath)):a.a.error(this.type+" display does not exist")},FramesModel.prototype.setAnimationData=function(t){if(t){var e;this.animations=new Map;for(var i=0,r=t;i<r.length;i++){var n=r[i],s=n.baseLoc;e={name:n.name,frameName:n.frameName,frameRate:n.frameRate,loop:n.loop,baseLoc:new Phaser.Geom.Point(s.x,s.y),walkableArea:n.walkableArea||[],collisionArea:n.collisionArea||[]},this.animations.set(e.name,e)}}else a.a.error(this.id+" animationData does not exist")},FramesModel}()},,,,,,,,,,,,,,,function(t,e,i){"use strict";var a=i(133);e.a=a.a},function(t,e,i){"use strict";var a;e.a=function(t,e){void 0===e&&(void 0===a&&(a=new Phaser.Geom.Rectangle),e=a);var i=t.game.config;return e.setTo(0,0,i.width,i.height),e}},function(t,e,i){"use strict";const a=Phaser.Scene;e.a=function(t){return t instanceof a}},function(t,e,i){"use strict";e.a={x:0,h:0,horizontal:0,"left-to-right":0,y:1,v:1,vertical:1,"top-to-bottom":1}},function(t,e,i){"use strict";e.a={v:0,vertical:0,h:1,horizontal:1}},function(t,e,i){"use strict";const a=Phaser.GameObjects.Text;e.a=function(t){return t instanceof a}},function(t,e,i){"use strict";i.r(e),i.d(e,"ComponentRankMediator",(function(){return r}));var a=i(74),r=function(){function ComponentRankMediator(t,e,i){this.mRank=new a.ComponentRankPanel(e,i),t.addToUILayer(this.mRank)}return ComponentRankMediator.prototype.getName=function(){return""},ComponentRankMediator.prototype.getView=function(){return this.mRank},ComponentRankMediator.prototype.hide=function(){},ComponentRankMediator.prototype.isSceneUI=function(){return!1},ComponentRankMediator.prototype.isShow=function(){return!1},ComponentRankMediator.prototype.resize=function(){},ComponentRankMediator.prototype.show=function(t){},ComponentRankMediator.prototype.update=function(t){},ComponentRankMediator}()},function(t,e,i){"use strict";i.r(e),i.d(e,"ControlFMediator",(function(){return s}));var a=i(75),r=i(6),n=i(3),s=function(){function ControlFMediator(t,e,i){this.mControlF=new a.ControlFPanel(e),this.mControlF.on("control",this.handControlF,this),t.addToUILayer(this.mControlF),this.world=i}return ControlFMediator.prototype.getName=function(){return""},ControlFMediator.prototype.getView=function(){},ControlFMediator.prototype.hide=function(){this.mControlF.hide()},ControlFMediator.prototype.isSceneUI=function(){return!1},ControlFMediator.prototype.isShow=function(){return!1},ControlFMediator.prototype.resize=function(){},ControlFMediator.prototype.show=function(t){this.mControlF.show(t)},ControlFMediator.prototype.update=function(t){},ControlFMediator.prototype.handControlF=function(){if(this.world&&this.world.connection){var t=new r.PBpacket(n.op_virtual_world.OPCODE._OP_CLIENT_REQ_GATEWAY_KEYBOARD_DOWN),e=t.content,i=this.world.inputManager.getKeyDowns();i=i.concat(Phaser.Input.Keyboard.KeyCodes.F),e.keyCodes=i,this.world.connection.send(t)}},ControlFMediator}()},function(t,e,i){"use strict";i.r(e),i.d(e,"RankMediator",(function(){return r}));var a=i(76),r=function(){function RankMediator(t,e,i){this.world=i,this.mRankPanel=new a.RankPanel(e,i),t.addToUILayer(this.mRankPanel)}return RankMediator.prototype.getName=function(){return""},RankMediator.prototype.getView=function(){},RankMediator.prototype.hide=function(){},RankMediator.prototype.isSceneUI=function(){return!1},RankMediator.prototype.isShow=function(){return!1},RankMediator.prototype.resize=function(){},RankMediator.prototype.show=function(t){this.mRankPanel.show(),t&&t.length>0&&this.mRankPanel.addItem(t[0])},RankMediator.prototype.update=function(t){t&&t.length>0&&this.mRankPanel.update(t[0])},RankMediator}()},function(t,e,i){"use strict";i.r(e),i.d(e,"UserMenuMediator",(function(){return r}));var a=i(77),r=function(){function UserMenuMediator(t,e){this.mUserMenuPanel=new a.UserMenuPanel(e),t.addToUILayer(this.mUserMenuPanel)}return UserMenuMediator.prototype.getView=function(){},UserMenuMediator.prototype.hide=function(){},UserMenuMediator.prototype.isSceneUI=function(){return!1},UserMenuMediator.prototype.isShow=function(){return!1},UserMenuMediator.prototype.resize=function(){},UserMenuMediator.prototype.show=function(t){},UserMenuMediator.prototype.update=function(t){},UserMenuMediator}()},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"StorageMediator",(function(){return a}));var a=function(){function StorageMediator(){}return StorageMediator.prototype.isSceneUI=function(){return!1},StorageMediator.prototype.isShow=function(){return this.mView.isShow()},StorageMediator.prototype.resize=function(){},StorageMediator.prototype.getView=function(){return this.mView},StorageMediator.prototype.show=function(t){this.mView&&this.mView.show(t)},StorageMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},StorageMediator.prototype.hide=function(){this.mView&&this.mView.hide()},StorageMediator}()},function(t,e,i){"use strict";i.r(e),i.d(e,"StoragePanel",(function(){return h}));var a,r=i(12),n=i(28),s=i(8),o=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function StoragePanel(e,i){var a=t.call(this,e)||this;return a.mWorld=i,a}return o(StoragePanel,t),StoragePanel.prototype.isShow=function(){return this.mShowing},StoragePanel.prototype.resize=function(){var t=this.mWorld.getSize();this.x=t.width>>1,this.y=t.height-200},StoragePanel.prototype.show=function(e){t.prototype.show.call(this,e)},StoragePanel.prototype.update=function(e){t.prototype.update.call(this,e)},StoragePanel.prototype.hide=function(){t.prototype.hide.call(this)},StoragePanel.prototype.destroy=function(){t.prototype.destroy.call(this)},StoragePanel.prototype.init=function(){if(!this.mInitialized){t.prototype.init.call(this),this.mBg=this.mScene.make.image(void 0,!1),this.mBg.setTexture(this.mResStr,"itemBagView_bg"),this.addAt(this.mBg,0),this.mWidth=this.mBg.width,this.mHeight=this.mBg.height;var e=this.mScene.make.image(void 0,!1);e.setTexture(this.mResStr,"itemBagView_title"),e.x=80+(-this.mBg.width>>1),e.y=-this.mBg.height>>1,this.add(e);var i,a=this.mScene.make.text(void 0,!1);a.setFontFamily("Tahoma"),a.setFontStyle("bold"),a.setFontSize(20),a.setText("书柜"),a.x=e.x+e.width-10,a.y=e.y-(a.height>>1),this.add(a);var r=0,s=0;this.mBagItemSlotList=[];for(var o=0;o<9;o++)r=o%9*60+32-362,s=60*Math.floor(o/9)-55,(i=new n.ItemSlot(this.mScene,this.mWorld,this,r,s,this.mResStr,this.mResPng,this.mResJson,"bagView_slot","bagView_itemSelect")).createUI(),this.mBagItemSlotList.push(i);this.mScene.cache.obj.has("clsBtn")?this.onClsLoadCompleteHandler():(this.mScene.load.spritesheet("clsBtn","resources/ui/common/common_clsBtn.png",{frameWidth:16,frameHeight:16,startFrame:1,endFrame:3}),this.mScene.load.once(Phaser.Loader.Events.COMPLETE,this.onClsLoadCompleteHandler,this),this.mScene.load.start())}},StoragePanel.prototype.preload=function(){this.mScene&&(this.mResStr="bagView",this.mResPng="ui/bag/bagView.png",this.mResJson="ui/bag/bagView.json",this.mScene.load.atlas(this.mResStr,s.e.getRes(this.mResPng),s.e.getRes(this.mResJson)),t.prototype.preload.call(this))},StoragePanel.prototype.onClsLoadCompleteHandler=function(){this.mClsBtnSprite=this.mScene.make.sprite(void 0,!1),this.mClsBtnSprite.setTexture("clsBtn","btn_normal"),this.mClsBtnSprite.x=(this.mWidth>>1)-65,this.mClsBtnSprite.y=-this.mHeight>>1,this.mClsBtnSprite.setInteractive(),this.mClsBtnSprite.on("pointerup",this.hide,this),this.add(this.mClsBtnSprite)},StoragePanel}(r.Panel)},function(t,e,i){"use strict";i.r(e),i.d(e,"BaseMediator",(function(){return a}));var a=function(){function BaseMediator(t){this.world=t}return BaseMediator.prototype.getView=function(){},BaseMediator.prototype.hide=function(){var t=this.getView();t&&t.hide()},BaseMediator.prototype.isSceneUI=function(){return!1},BaseMediator.prototype.isShow=function(){return!1},BaseMediator.prototype.resize=function(){var t=this.getView();t&&t.resize()},BaseMediator.prototype.show=function(t){var e=this.getView();e&&e.show(t)},BaseMediator.prototype.update=function(t){var e=this.getView();e&&e.update(t)},BaseMediator}()},function(t,e){},function(t,e,i){"use strict";i.r(e),i.d(e,"ScrollerContainer",(function(){return h}));var a,r=i(5),n=i(136),s=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),o=Phaser.GameObjects,h=function(t){function ScrollerContainer(e,i,a){var s=t.call(this,e)||this;if(!a)return r.a.error("scroller target does not exise"),s;new o.Graphics(e).fillStyle(51,1).fillRect(i.x,i.y,i.width,i.height).setInteractive(i,Phaser.Geom.Rectangle.Contains);return a.setMask(s.mMask.createGeometryMask()),s.mScroller=new n.a(s.mMask,{valuechangeCallback:function(t){a.y=t}}),s}return s(ScrollerContainer,t),ScrollerContainer}(n.a)},function(t,e,i){"use strict";i.r(e),i.d(e,"LoadingView",(function(){return a}));var a=function(){function LoadingView(t){this.mScene=t,this.mShowing=!1,this.createPanel()}return LoadingView.prototype.isShow=function(){return this.mShowing},LoadingView.prototype.show=function(t){this.mTween=this.mScene.tweens.add({targets:this.mBg,duration:2e6,ease:"Linear",props:{rotation:360}})},LoadingView.prototype.update=function(t){},LoadingView.prototype.hide=function(){this.mTween&&(this.mTween.stop(),this.mTween.remove())},LoadingView.prototype.resize=function(){},LoadingView.prototype.destroy=function(){this.mBg&&this.mBg.destroy()},LoadingView.prototype.createPanel=function(){var t=this.mScene.game.scale.gameSize;this.mBg=this.mScene.add.sprite(t.width>>1,t.height>>1,"stars"),this.mBg.scaleX=this.mBg.scaleY=1.3},LoadingView}()},function(t,e,i){"use strict";i.r(e),i.d(e,"ShopMediator",(function(){return l}));var a=i(132),r=i(17),n=i(6),s=i(3),o=i(80),h=i(37),l=function(){function ShopMediator(t,e,i){this._perPage=50,this.isEnd=!1,this.world=i,this.mShopModel=this.world.modelManager.getModel(a.a.NAME),this.mView=new o.ShopPanel(e,i),t.addToUILayer(this.mView)}return ShopMediator.prototype.isSceneUI=function(){return!1},ShopMediator.prototype.resize=function(){if(this.mView)return this.mView.resize()},ShopMediator.prototype.getView=function(){return this.mView},ShopMediator.prototype.show=function(t){this.mView&&this.mView.show(),this.mParam=t,this.mShopModel.register(),this.world.modelManager.on(r.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.modelManager.on(r.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this),this.world.modelManager.getModel(h.a.NAME).requestVirtualWorldQueryPackage(t[0].id,1,o.ShopPanel.ShopSlotCount)},ShopMediator.prototype.update=function(t){this.mView&&this.mView.update(t)},ShopMediator.prototype.hide=function(){this.mView&&this.mView.hide(),this.mParam=null,this.mShopModel.unRegister(),this.world.modelManager.off(r.a.QUERY_PACKAGE,this.queryPackageHandler,this),this.world.modelManager.off(r.a.SYNC_USER_BALANCE,this.onSyncUserBalanceHandler,this)},ShopMediator.prototype.isShow=function(){return!!this.mView&&this.mView.isShow()},ShopMediator.prototype.queryShopProps=function(t,e){if(void 0===t&&(t=1),void 0===e&&(e=50),!1!=!!this.mParam){this.fetching=!0;var i=new n.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_QUERY_PACKAGE),a=i.content;a.id=this.mParam[0].id,a.page=t,a.perPage=e,this.world.connection.send(i)}},ShopMediator.prototype.queryPackageHandler=function(t){t.items.length>0&&t.id===this.mParam[0].id?this.mView.setDataList(t.items):this.isEnd=!0,this.fetching=!1},ShopMediator.prototype.onBuyItemHandler=function(t){for(var e=0,i=t.price;e<i.length;e++){i[e].coinType,s.op_def.CoinType.TU_DING_COIN}var a=new n.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_TARGET_UI),r=a.content;r.uiId=this.mParam[0].id,r.componentId=t.id,this.world.connection.send(a)},ShopMediator.prototype.syncUserBalance=function(){var t=new n.PBpacket(s.op_virtual_world.OPCODE._OP_CLIENT_REQ_VIRTUAL_WORLD_SYNC_USER_BALANCE);this.world.connection.send(t)},ShopMediator.prototype.onChangeIndex=function(t){t>=.9&&!1===this.fetching&&!1===this.isEnd&&(this._curPage++,this.queryShopProps(this._curPage))},ShopMediator.prototype.onSyncUserBalanceHandler=function(t){this.mView},ShopMediator.prototype.onPayTuDingHandler=function(){},ShopMediator.NAME="ShopMediator",ShopMediator}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var a,r=i(6),n=i(3),s=i(17),o=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function __(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),h=function(t){function ShopModel(e){var i=t.call(this)||this;return i.mWorld=e,i.mWorld.connection.addPacketListener(i),i.mConnect=i.mWorld.connection,i.addHandlerFun(n.op_client.OPCODE._OP_VIRTUAL_WORLD_RES_CLIENT_QUERY_PACKAGE,i.handlerQueryPackage),i}return o(ShopModel,t),ShopModel.prototype.getInitialize=function(){return this.initialize},ShopModel.prototype.register=function(){this.mConnect.addPacketListener(this)},ShopModel.prototype.unRegister=function(){this.mConnect.removePacketListener(this)},ShopModel.prototype.handlerQueryPackage=function(t){var e=t.content;this.mWorld.modelManager.emit(s.a.QUERY_PACKAGE,e)},ShopModel}(r.PacketHandler)},function(t,e,i){"use strict";var a={add(t){return Array.isArray(t)?this.addMultiple(t):this._add(t),this},addMultiple(t){return t.forEach(this._add,this),this},_add(t){return this.children.add(t),this.resetChildState(t).updateChildVisible(t).updateChildActive(t).updateChildScrollFactor(t).updateChildMask(t),this}},r={remove(t,e){return this.children.remove(t,!1,e),this},clear(t){return this.children.clear(!1,t),this}},n={getLocalState:t=>(t.hasOwnProperty("rexContainer")||(t.rexContainer={}),t.rexContainer),resetChildState(t){return this.resetChildPositionState(t).resetChildVisibleState(t).resetChildAlphaState(t).resetChildActiveState(t),this},resetChildrenState(t){for(var e=0,i=t.length;e<i;e++)this.resetChildState(t[e]);return this},syncProperties(){return this.syncPosition().syncVisible().syncAlpha().syncActive().syncScrollFactor().syncMask(),this}};const s=Phaser.Math.RotateAround;var o={worldToLocal(t){return t.x-=this.x,t.y-=this.y,s(t,0,0,-this.rotation),t.x/=this.scaleX,t.y/=this.scaleY,t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t},localToWorld(t){return t.x*=this.flipX?-1:1,t.y*=this.flipY?-1:1,t.x*=this.scaleX,t.y*=this.scaleY,s(t,0,0,this.rotation),t.x+=this.x,t.y+=this.y,t}},containerlite_Scale=function(t,e){return t===e?1:t/e},h={updateChildPosition(t){t.isRexContainerLite&&(t.syncChildrenEnable=!1);var e=this.getLocalState(t);return t.x=e.x,t.y=e.y,this.localToWorld(t),t.scaleX=e.scaleX*this.scaleX,t.scaleY=e.scaleY*this.scaleY,void 0!==t.flipX&&(t.flipX=this.flipX?!e.flipX:e.flipX,t.flipY=this.flipY?!e.flipY:e.flipY),t.rotation=e.rotation+this.rotation,t.isRexContainerLite&&(t.syncChildrenEnable=!0,t.syncPosition()),this},syncPosition(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildPosition,this),this},resetChildPositionState(t){var e=this.getLocalState(t);return e.x=t.x,e.y=t.y,this.worldToLocal(e),e.scaleX=containerlite_Scale(t.scaleX,this.scaleX),e.scaleY=containerlite_Scale(t.scaleY,this.scaleY),void 0!==t.flipX&&(e.flipX=t.flipX,e.flipY=t.flipY),e.rotation=t.rotation-this.rotation,this},setChildPosition(t,e,i){return t.x=e,t.y=i,this.resetChildPositionState(t),this},setChildLocalPosition(t,e,i){var a=this.getLocalState(t);return a.x=e,a.y=i,this.updateChildPosition(t),this}},l={updateChildVisible(t){return t.visible=this.visible&&this.getLocalState(t).visible,this},syncVisible(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildVisible,this),this},resetChildVisibleState(t){return this.getLocalState(t).visible=t.visible,this},setChildVisible(t,e){return t.visible=e,this.resetChildVisibleState(t),this},setChildLocalVisible(t,e){return void 0===e&&(e=!0),this.getLocalState(t).visible=e,this.updateChildVisible(t),this}},c={updateChildAlpha(t){return t.alpha=this.alpha*this.getLocalState(t).alpha,this},syncAlpha(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildAlpha,this),this},resetChildAlphaState(t){return this.getLocalState(t).alpha=containerlite_Scale(t.alpha,this.alpha),this},setChildAlpha(t,e){return t.alpha=e,this.resetChildAlphaState(t),this._add},setChildLocalAlpha(t,e){return this.getLocalState(t).alpha=e,this.updateChildAlpha(t),this}},u={updateChildActive(t){return t.active=this.active&&this.getLocalState(t).active,this},syncActive(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildActive,this),this},resetChildActiveState(t){return this.getLocalState(t).active=t.active,this},setChildActive(t,e){return t.active=e,this.resetChildActiveState(t),this},setChildLocalActive(t,e){return void 0===e&&(e=!0),this.getLocalState(t).active=e,this.updateChildActive(t),this}},d={updateChildScrollFactor(t){return t.setScrollFactor(this.scrollFactorX,this.scrollFactorY),this},syncScrollFactor(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildScrollFactor,this),this}},p={updateChildMask(t){return null==this.mask?this:((this.mask.hasOwnProperty("geometryMask")?this.mask.geometryMask:this.mask.bitmapMask)!==t&&(t.mask=this.mask),this)},syncMask(){return this.children&&this.syncChildrenEnable&&this.children.getChildren().forEach(this.updateChildMask,this),this},setMask(t){return this.mask=t,this},clearMask(t){return void 0===t&&(t=!1),t&&this.mask&&this.mask.destroy(),this.mask=null,this}},m={setDepth(t){if(this.depth=t,this.children)for(var e=this.getAllChildren(),i=0,a=e.length;i<a;i++)e[i].depth=t;return this},swapDepth(t){var e=this.depth,i=t.depth;return this.setDepth(i),t.setDepth(e),this},incDepth(t){if(this.depth+=t,this.children)for(var e=this.getAllChildren(),i=0,a=e.length;i<a;i++)e[i].depth+=t;return this}};const f=Phaser.Utils.Array;var g={getChildren(){return this.children.getChildren()},getAllChildren(t){void 0===t&&(t=[]);for(var e,i=this.children.getChildren(),a=0,r=i.length;a<r;a++)e=i[a],t.push(e),e.hasOwnProperty("isRexContainerLite")&&t.push(...e.getAllChildren());return t},contains(t){if(this.children.contains(t))return!0;for(var e,i=this.children.getChildren(),a=0,r=i.length;a<r;a++)if((e=i[a]).isRexContainerLite&&e.contains(t))return!0;return!1},getByName(t){return f.GetFirst(this.list,"name",t)},getRandom(t,e){return f.GetRandom(this.list,t,e)},getFirst(t,e,i,a){return f.GetFirstElement(this.list,t,e,i,a)},getAll(t,e,i,a){return f.GetAll(this.list,t,e,i,a)},count(t,e,i,a){return f.CountAllMatching(this.list,t,e,i,a)},swap(t,e){return f.Swap(this.list,t,e),this},moveTo(t,e){return f.MoveTo(this.list,t,e),this},setAll(t,e,i,a){return f.SetAll(this.list,t,e,i,a),this}};const y=Phaser.GameObjects.Zone,_=Phaser.GameObjects.Components;class v extends y{constructor(t,e,i,a,r,n){Array.isArray(a)&&(n=a,a=void 0),void 0===a&&(a=1),void 0===r&&(r=1),super(t,e,i,a,r),this.children=t.add.group(),this.type="rexContainerLite",this.isRexContainerLite=!0,this.syncChildrenEnable=!0,this._flipX=!1,this._flipY=!1,this._alpha=1,this._active=!0,this._mask=null,this._scrollFactorX=1,this._scrollFactorY=1,n&&this.add(n)}destroy(t){this.scene&&(this.children.destroy(!t),this.children=void 0,super.destroy(t))}resize(t,e){return this.setSize(t,e),this}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.syncPosition())}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.syncPosition())}get rotation(){return super.rotation}set rotation(t){this.rotation!==t&&(super.rotation=t,this.syncPosition())}get scaleX(){return super.scaleX}set scaleX(t){this.scaleX!==t&&(super.scaleX=t,this.syncPosition())}get scaleY(){return super.scaleY}set scaleY(t){this.scaleY!==t&&(super.scaleY=t,this.syncPosition())}get flipX(){return this._flipX}set flipX(t){this._flipX!==t&&(this._flipX=t,this.syncPosition())}get flipY(){return this._flipY}set flipY(t){this._flipY!==t&&(this._flipY=t,this.syncPosition())}get visible(){return super.visible}set visible(t){this.visible!==t&&(super.visible=t,this.syncVisible())}get alpha(){return this._alpha}set alpha(t){this._alpha!==t&&(this._alpha=t,this.syncAlpha())}get active(){return this._active}set active(t){this._active!==t&&(this._active=t,this.syncActive())}get mask(){return this._mask}set mask(t){this._mask!==t&&(this._mask=t,this.syncMask())}get scrollFactorX(){return this._scrollFactorX}set scrollFactorX(t){this._scrollFactorX!==t&&(this._scrollFactorX=t,this.syncScrollFactor())}get scrollFactorY(){return this._scrollFactorY}set scrollFactorY(t){this._scrollFactorY!==t&&(this._scrollFactorY=t,this.syncScrollFactor())}get list(){return this.children.getChildren()}}Object.assign(v.prototype,a,r,n,o,h,l,c,d,u,p,m,g,_.Alpha,_.Flip);e.a=v},function(t,e,i){"use strict";var a=i(220),r=i.n(a),n=i(221),s=i.n(n),o=i(19),h=(o.a,o.a,{renderWebGL:r.a,renderCanvas:s.a}),l=i(83),c=i(22);c.a.hleft;const u=c.a.hcenter,d=c.a.hright,p=(c.a.vtop,c.a.vcenter),m=c.a.vbottom;var f={draw(t,e,i,a){var r=this.penManager;this.hitAreaManager.clear();var n=this.context;n.save(),this.drawBackground(this.defatultStyle.backgroundColor);var s=this.defatultStyle;t+=this.startXOffset,e+=this.startYOffset;var o,h,l,c,f,g,y=s.halign,_=s.valign,v=s.lineHeight,b=r.lines,P=b.length,S=s.maxLines;S>0&&P>S?(h=S,l=_===p?Math.floor((P-h)/2):_===m?P-h:0):(h=P,l=0),c=l+h,g=_===p?Math.max((a-h*v)/2,0):_===m?Math.max(a-h*v-2,0):0,g+=e;for(var D=l;D<c;D++)if(0!==(o=r.getLineWidth(D))){f=y===u?(i-o)/2:y===d?i-o:0,f+=t;for(var T=b[D],x=0,C=T.length;x<C;x++)this.drawPen(T[x],f,g)}n.restore()},drawPen(t,e,i){e+=t.x,i+=t.y;var a=this.canvas,r=this.context;r.save();var n=this.parser.propToContextStyle(this.defatultStyle,t.prop);n.buildFont(),n.syncFont(a,r),n.syncStyle(a,r),n.underlineThickness>0&&t.width>0&&this.drawUnderline(e,i,t.width,n),t.isTextPen&&this.drawText(e,i,t.text,n),t.isImagePen&&this.drawImage(e,i,t.prop.img,n),r.restore(),t.hasAreaMarker&&t.width>0&&this.hitAreaManager.add(t.prop.area,e,i-this.startYOffset,t.width,this.defatultStyle.lineHeight)},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawBackground(t){null!==t&&(this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},drawUnderline(t,e,i,a){e+=a.underlineOffset-a.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context,n=r.lineCap;r.lineCap="butt",r.beginPath(),r.strokeStyle=a.underlineColor,r.lineWidth=a.underlineThickness,r.moveTo(t,e),r.lineTo(t+i,e),r.stroke(),r.lineCap=n},drawText(t,e,i,a){this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context;a.strokeThickness&&(a.syncShadow(r,a.shadowStroke),r.strokeText(i,t,e)),a.color&&"none"!==a.color&&(a.syncShadow(r,a.shadowFill),r.fillText(i,t,e))},drawImage(t,e,i,a){var r=this.parent.imageManager,n=r.get(i),s=r.getFrame(i);t+=n.left,e+=-this.startYOffset+n.y,this.autoRound&&(t=Math.round(t),e=Math.round(e)),this.context.drawImage(s.source.image,s.cutX,s.cutY,s.cutWidth,s.cutHeight,t,e,n.width,n.height)}},g=i(42);const y=Phaser.Utils.Objects.GetValue,_=c.a.NO_NEWLINE,v=c.a.RAW_NEWLINE;var b=class{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=y(t,"text",""),this.x=y(t,"x",0),this.y=y(t,"y",0),this.width=y(t,"width",0);var e=y(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=y(t,"newLineMode",0),this.startIndex=y(t,"startIndex",0)}get plainText(){var t=this.text;return this.newLineMode===v&&(t+="\n"),t}get wrapText(){var t=this.text;return this.newLineMode!==_&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return this.newLineMode===v&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area}},P=i(69),object_Clone=function(t,e){var i=Array.isArray(t);for(var a in void 0===e?e=i?[]:{}:Object(P.a)(e),i&&(e.length=t.length),t)e[a]=t[a];return e};const S=Phaser.Utils.Objects.GetFastValue,D=c.a.NO_NEWLINE,T=c.a.WRAPPED_NEWLINE;var x=new g.a,C=new g.a;class O{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=S(t,"pensPool",x),this.LinesPool=S(t,"linesPool",C),this.tagToText=S(t,"tagToText",o.a),this.tagToTextScope=S(t,"tagToTextScope",void 0)}destroy(){this.freePens(),this.tagToText=void 0,this.tagToTextScope=void 0}freePens(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,i,a,r,n){var s=this.PensPool.pop();return null==s&&(s=new b),M.text=t,M.x=e,M.y=i,M.width=a,M.prop=r,M.newLineMode=n,s.resetFromJSON(M),this.addPen(s),this}addImagePen(t,e,i,a){return this.addTextPen("",t,e,i,a,D),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,i=t?t.y:0,a=t?object_Clone(t.prop):null;return this.addTextPen("",e,i,0,a,T),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var i=this.lastLine;null==i&&(i=this.LinesPool.pop()||[],this.lines.push(i)),i.push(t),t.newLineMode!==D&&(i=this.LinesPool.pop()||[],this.lines.push(i)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new O),t.freePens();for(var e=0,i=this.lines.length;e<i;e++)for(var a=this.lines[e],r=0,n=a.length;r<n;r++){var s=a[r];t.addPen(s.text,s.x,s.y,s.width,object_Clone(s.prop),s.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,i,a=!1;for(e=t;e>=0&&!(a=null!=(i=this.lines[e])&&i.length>0);e--);return a?i[i.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var i=e[e.length-1];return null==i?0:i.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,i=0,a=this.lines.length;i<a;i++)(t=this.getLineWidth(i))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,i=this.lines.length;e<i;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,i=0,a=e.length;i<a;i++)t+=e[i].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,i=0,a=this.pens.length;i<a;i++)t+=e[i].rawTextLength;return t}getSliceTagText(t,e,i){if(void 0===t&&(t=0),void 0===e){var a=this.lastPen;if(null==a)return"";e=a.endIndex}void 0===i&&(i=!1);for(var r,n,s,o,h,l,c="",u=0,d=this.pens.length;u<d&&((o=(r=this.pens[u]).endIndex)<=t||(r=this.pens[u],n=i?r.wrapText:r.plainText,h=r.prop,(s=r.startIndex)>=t&&o<=e||(n=n.substring(t-s,e-s)),this.tagToTextScope?c+=this.tagToText.call(this.tagToTextScope,n,h,l):c+=this.tagToText(n,h,l),l=h,!(o>=e)));u++);return c}}var M={},w=O;const A=Phaser.Geom.Rectangle;var E=new g.a;var B=class{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){return E.pushMultiple(this.hitAreas),this}add(t,e,i,a,r){var n=E.pop();return null===n?n=new A(e,i,a,r):n.setTo(e,i,a,r),n.key=t,this.hitAreas.push(n),this}contains(t,e){for(var i,a=this.hitAreas,r=0,n=a.length;r<n;r++)if((i=a[r]).contains(t,e))return i.key;return!1}drawBounds(t,e,i){void 0===e&&(e=16777215),i&&t.save().scaleCanvas(i.scaleX,i.scaleY).rotateCanvas(i.rotation).translateCanvas(i.x,i.y);for(var a,r=this.hitAreas,n=0,s=r.length;n<s;n++)a=r[n],t.lineStyle(1,e).strokeRect(a.x,a.y,a.width,a.height);return i&&t.restore(),this}},FireEvent=function(t,e,i,a){var r=this.hitAreaManager.contains(i,a);!1!==r&&(this.parent.emit(`${t}-${r}`,e,i,a),this.parent.emit(t,r,e,i,a))},canvastext_SetInteractive=function(){this.parent.on("pointerdown",(function(t,e,i,a){FireEvent.call(this,"areadown",t,e,i)}),this).on("pointerup",(function(t,e,i,a){FireEvent.call(this,"areaup",t,e,i)}),this)};const I=c.a.NO_NEWLINE,k=c.a.RAW_NEWLINE,R=c.a.WRAPPED_NEWLINE,j=c.a.NO_WRAP,L=c.a.WORD_WRAP,F=(c.a.CHAR_WRAP,c.a.SPLITREGEXP);var N=[],U=new g.a;U.newline=function(t,e,i){var a=this.pop();return null===a&&(a={}),a.text=t,a.width=e,a.newLineMode=i,a};var canvastext_WrapText=function(t,e,i,a,r){a<=0&&(i=j);var n=N;if(U.pushMultiple(n),!t||!t.length)return n;for(var s,o,h,l=t.split(F),c=0,u=l.length;c<u;c++)if(s=l[c],h=c===u-1?I:k,i!==j){var d,p;if(o=0===c?a-r:a,s.length<=100)if((b=e(s))<=o){n.push(U.newline(s,b,h));continue}for(var m,f="",g="",y=0,_=0,v=(d=i===L?s.split(" "):s).length;_<v;_++)p=d[_],i===L?(f+=p,_<v-1&&(f+=" ")):f+=p,(m=e(f))>o&&(0===_?n.push(U.newline("",0,R)):(n.push(U.newline(g,y,R)),f=p,i===L&&_<v-1&&(f+=" "),m=e(f)),o=a),g=f,y=m;n.push(U.newline(g,y,h))}else{var b=e(s);n.push(U.newline(s,b,h))}return n};const V=Phaser.Utils.Objects.GetValue,H=c.a.NO_WRAP,W=c.a.NO_NEWLINE;class z{constructor(t){this.parent=t.parent,this.context=V(t,"context",null),this.canvas=this.context.canvas,this.parser=V(t,"parser",null),this.defatultStyle=V(t,"style",null),this.autoRound=!0,this.pensPool=V(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new B;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}destroy(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defatultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}updatePenManager(t,e,i,a,r){if(void 0===r&&(r=this.penManager),r.freePens(),""===t)return r;for(var n,s,o,h,l,c=this.canvas,u=this.context,d=0,p=0,m=this.parser.splitText(t),f=0,g=m.length;f<g;f++)if(n=(h=this.parser.tagTextToProp(m[f],s)).plainText,(s=h.prop).img){var y=this.imageManager.getOuterWidth(s.img);i>0&&e!==H&&i<d+y&&(r.addNewLinePen(),p+=a,d=0),r.addImagePen(d,p,y,object_Clone(s)),d+=y}else if(""!==n){var _;this.context.save(),(o=this.parser.propToContextStyle(this.defatultStyle,s)).buildFont(),o.syncFont(c,u),o.syncStyle(c,u);for(var v=0,b=(l=canvastext_WrapText(n,this.getTextWidth,e,i,d)).length;v<b;v++)_=l[v],r.addTextPen(_.text,d,p,_.width,object_Clone(s),_.newLineMode),_.newLineMode!==W?(d=0,p+=a):d+=_.width;this.context.restore()}return r}get startXOffset(){return this.defatultStyle.strokeThickness/2}get startYOffset(){var t=this.defatultStyle;return t.strokeThickness/2+t.metrics.ascent}get lines(){return this.penManager.lines}get desplayLinesCount(){var t=this.penManager.linesCount,e=this.defatultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return this.penManager.getMaxLineWidth()}get linesHeight(){var t=this.desplayLinesCount,e=this.defatultStyle.lineHeight*t;return t>0&&(e-=this.defatultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}newPenManager(){return new w({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,i){var a;if(null==t)a=this.penManager.plainText;else{var r=this.parser.splitText(t,1);a="";for(var n=0,s=r.length;n<s;n++)a+=r[n]}return null==e&&null==i||(null==e&&(e=0),null==i&&(i=a.length),a=a.substring(e,i)),a}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var i=this.defatultStyle;return this.updatePenManager(t,i.wrapMode,i.wrapWidth,i.lineHeight,e),e}getText(t,e,i,a){if(null==t)return this.penManager.getSliceTagText(e,i,a);var r=this.tmpPenManager,n=this.defatultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,r),r.getSliceTagText(e,i,a)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var Y={setInteractive:canvastext_SetInteractive};Object.assign(z.prototype,f,Y);var G=z;const X=Phaser.Utils.Objects.GetValue;var K,J=class{constructor(t){this.textureManager=t,this.images={}}add(t,e){if("string"==typeof t)this._add(t,e);else if(Array.isArray(t))for(var i=0,a=(r=t).length;i<a;i++)this._add(r[i]);else{var r=t;for(var t in r)this._add(t,r[t])}return this}_add(t,e){void 0===e&&(e={key:t});var i=e.key,a=e.frame,r=e.width,n=e.height;if(void 0===r||void 0===n){var s=this.textureManager.getFrame(i,a),o=s?s.cutWidth:0,h=s?s.cutHeight:0;void 0===r&&void 0===n?(r=o,n=h):void 0===r?r=o*(n/h):void 0===n&&(n=h*(r/o))}this.images[t]={key:i,frame:a,width:r,height:n,y:X(e,"y",0),left:X(e,"left",0),right:X(e,"right",0)}}remove(t){return this.images.hasOwnProperty(t)&&delete this.images[t],this}get(t){return this.images.hasOwnProperty(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}},GetGlobImageManager=function(t){return void 0===K&&(K=new J(t)),K};const Z=Phaser.DOM.AddToDOM,Q=Phaser.Display.Canvas.CanvasPool,q=Phaser.GameObjects.GameObject,$=Phaser.Utils.Objects.GetValue,tt=Phaser.DOM.RemoveFromDOM,et=c.a.SPLITREGEXP;var it={};class at extends q{constructor(t,e,i,a,r,n,s){if(void 0===e&&(e=0),void 0===i&&(i=0),super(t,n),this.renderer=t.sys.game.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=Q.create(this),this.context=this.canvas.getContext("2d"),r&&r.hasOwnProperty("align")){var o=r.align;delete r.align,r.halign=o}this.style=new l.a(this,r),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=t.sys.game.config.resolution),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),it.hasOwnProperty(n)||(it[n]=new g.a),this.canvasText=new G({parent:this,context:this.context,parser:s,style:this.style,pensPool:it[n]}),r&&r.padding&&this.setPadding(r.padding),this.setText(a),t.sys.game.events.on("contextrestored",(function(){this.dirty=!0}),this)}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Z(this.canvas,this.scene.sys.canvas),this.originX=1)}setText(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t){return this.style.setBackgroundColor(t)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,i,a,r,n){return this.style.setShadow(t,e,i,a,r,n)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setLineSpacing(t){return this.style.setLineSpacing(t)}setPadding(t,e,i,a){if("object"==typeof t){var r=t,n=$(r,"x",null);null!==n?(t=n,i=n):(t=$(r,"left",0),i=$(r,"right",t));var s=$(r,"y",null);null!==s?(e=s,a=s):(e=$(r,"top",0),a=$(r,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===a&&(a=e);return this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=a,this.updateText(!1)}setResolution(t){return this.style.setResolution(t)}setMaxLines(t){return this.style.setMaxLines(t)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,i=this.style;t&&e.updatePenManager(this._text,i.wrapMode,i.wrapWidth,i.lineHeight);var a,r,n=this.padding;0===i.fixedWidth?(this.width=e.linesWidth+n.left+n.right,a=e.linesWidth):(this.width=i.fixedWidth,(a=this.width-n.left-n.right)<e.linesWidth&&(a=e.linesWidth)),0===i.fixedHeight?(this.height=e.linesHeight+n.top+n.bottom,r=e.linesHeight):(this.height=i.fixedHeight,(r=this.height-n.top-n.bottom)<e.linesHeight&&(r=e.linesHeight));var s=this.width,o=this.height;this.updateDisplayOrigin();var h=i.resolution;s*=h,o*=h,s=Math.max(Math.ceil(s),1),o=Math.max(Math.ceil(o),1);var l=this.canvas,c=this.context;l.width!==s||l.height!==o?(l.width=s,l.height=o,this.frame.setSize(s,o)):c.clearRect(0,0,s,o),c.save(),c.scale(h,h),e.draw(n.left,n.top,a,r),c.restore(),this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(l,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var u=this.input;return u&&!u.customHitArea&&(u.hitArea.width=this.width,u.hitArea.height=this.height),this}getTextMetrics(){return this.style.getTextMetrics()}toJSON(){var t=rt.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}preDestroy(){this.style.rtl&&tt(this.canvas),Q.remove(this.canvas),this.canvasText.destroy()}setInteractive(t,e,i){return q.prototype.setInteractive.call(this,t,e,i),this.canvasText.setInteractive(),this}getWrappedText(t,e,i){return(t=this.canvasText.getText(t,e,i,!0)).split(et)}getPlainText(t,e,i){return this.canvasText.getPlainText(t,e,i)}getText(t,e,i){return this.canvasText.getText(t,e,i,!1)}getSubString(t,e,i){return this.getText(t,e,i)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}set lineSpacing(t){this.setLineSpacing(t)}get lineSpacing(){return this.style.lineSpacing}get imageManager(){return GetGlobImageManager(this.scene.textures)}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}const rt=Phaser.GameObjects.Components;Phaser.Class.mixin(at,[rt.Alpha,rt.BlendMode,rt.ComputedSize,rt.Crop,rt.Depth,rt.Flip,rt.GetBounds,rt.Mask,rt.Origin,rt.Pipeline,rt.ScrollFactor,rt.Tint,rt.Transform,rt.Visible,h]);e.a=at},function(t,e,i){"use strict";var a=i(30),r=i(39),n=i(114),s=i(40);const o=Phaser.Display.Align.TOP_LEFT;var textblock_SetTextObject=function(t,e,i){void 0===i&&(i=!0),this.add(t),void 0===e&&(e=0);var a=this.getSizerConfig(t);return a.parent=this,a.align=o,a.padding=Object(r.a)(e),a.expand=!0,this.textObject=t,this.textObjectType=Object(n.a)(t)?0:1,a.preOffsetY=0,a.offsetY=0,i&&(this.textMask=new s.a(this.textObject),this.textObject.setMask(this.textMask.createGeometryMask()),this.add(this.textMask)),this},textblock_SetText=function(t){return void 0!==t&&(this.text=t),0===this.textObjectType?this.lines=this.textObject.getWrappedText(this.text):this.lines=this.textObject.getPenManager(this.text,this.lines),this.updateTextObject(),this},textblock_TextHeightToLinesCount=function(t){return(t-this.textLineSpacing)/(this.textLineHeight+this.textLineSpacing)},textblock_LinesCountToTextHeight=function(t){return t*(this.textLineHeight+this.textLineSpacing)-this.textLineSpacing},textblock_GetLines=function(t){var e,i=t+this.textObject.style.maxLines;if(0===this.textObjectType)e=this.lines.slice(t,i).join("\n");else{var a=this.lines.getLineStartIndex(t),r=this.lines.getLineEndIndex(i-1);e=this.lines.getSliceTagText(a,r,!0)}return e},textblock_ResetTextObjectPosition=function(){var t=this.textObject.rexSizer;this.textObject.y+=t.offsetY-t.preOffsetY,t.preOffsetY=t.offsetY,this.resetChildPositionState(this.textObject)},textblock_UpdateTextObject=function(){var t=Math.max(Math.floor(textblock_TextHeightToLinesCount.call(this,-this.textOY)),0),e=textblock_LinesCountToTextHeight.call(this,t)+this.textOY;return this.textObject.setText(textblock_GetLines.call(this,t)),this.textObject.rexSizer.offsetY=e,textblock_ResetTextObjectPosition.call(this),this},textblock_ResizeText=function(t,e,i){if(t.width!==e||t.height!==i){t.setFixedSize(e,i);var a=t.style,r=Math.max(e,0),n=Math.ceil(textblock_TextHeightToLinesCount.call(this,i))+1;0===this.textObjectType?(a.wordWrapWidth=r,a.maxLines=n):(a.wrapWidth=r,a.maxLines=n),this.setText()}},h=i(29);const l=Phaser.Display.Align.In.QuickSet;var c={setTextObject:textblock_SetTextObject,setText:textblock_SetText,updateTextObject:textblock_UpdateTextObject,layout:function(t,e,i){if(this.rexSizer.hidden)return this;var a,r,n;this.layoutInit(t),void 0===e&&(e=this.minWidth),void 0===i&&(i=this.minHeight),this.resize(e,i);var s,o,c,u,d=this.left,p=this.top;return(a=this.textObject).rexSizer.hidden||(s=d+(n=(r=a.rexSizer).padding).left,o=p+n.top,c=this.width-n.left-n.right,u=this.height-n.top-n.bottom,textblock_ResizeText.call(this,a,c,u),h.a.setPosition(s,o).setSize(c,u),l(a,h.a,r.align),this.textMask&&(this.textMask.setPosition().resize(),this.resetChildPositionState(this.textMask)),r.preOffsetY=0,textblock_ResetTextObjectPosition.call(this)),this.layoutBackgrounds(),this}};const u=Phaser.Utils.Objects.IsPlainObject,d=Phaser.Utils.Objects.GetValue;class p extends a.a{constructor(t,e,i,a,r,n){u(e)?(e=d(n=e,"x",0),i=d(n,"y",0),a=d(n,"width",void 0),r=d(n,"height",void 0)):u(a)&&(a=d(n=a,"width",void 0),r=d(n,"height",void 0)),super(t,e,i,a,r,n),this.type="rexTextBlock",this.textObject=void 0,this.textMask=void 0,this.textObjectType=void 0,this.lines=void 0,this.text=d(n,"content",""),this._textOY=0,this.execeedTopState=!1,this.execeedBottomState=!1,this.setClampMode(d(n,"clamplTextOY",!0));var s=d(n,"background",void 0),o=d(n,"text",void 0);void 0===o&&(o=createDefaultTextObject(t));var h=d(n,"textMask",!0),l=d(n,"space",void 0);s&&this.addBackground(s),this.setTextObject(o,l,h)}destroy(t){this.scene&&(this.textObject=void 0,this.textMask=void 0,void 0===this.lines||(0===this.textObjectType?this.lines.length=0:this.lines.destroy()),super.destroy(t))}setClampMode(t){return this.clampTextOYMode=t,this}get textLineHeight(){var t=this.textObject.style;return t.metrics.fontSize+t.strokeThickness}get textLineSpacing(){return this.textObject.lineSpacing}get linesCount(){return void 0===this.lines?0:0===this.textObjectType?this.lines.length:this.lines.linesCount}get visibleLinesCount(){return Math.floor(textblock_TextHeightToLinesCount.call(this,this.textObject.height))}get topTextOY(){return 0}get bottomTextOY(){return-this.textVisibleHeight}get textHeight(){return textblock_LinesCountToTextHeight.call(this,this.linesCount)}get textObjectHeight(){return this.textObject.height}get textVisibleHeight(){var t=this.textHeight,e=this.textObjectHeight;return t>e?t-e:0}textOYExceedTop(t){return void 0===t&&(t=this.textOY),t>this.topTextOY}textOYExeceedBottom(t){return void 0===t&&(t=this.textOY),t<this.bottomTextOY}get textOY(){return this._textOY}set textOY(t){var e=this.topTextOY,i=this.bottomTextOY,a=this.textOYExceedTop(t),r=this.textOYExeceedBottom(t);this.clampTextOYMode&&(this.visibleLinesCount>this.linesCount?t=0:a?t=e:r&&(t=i)),this._textOY!==t&&(this._textOY=t,this.updateTextObject()),a&&(this.execeedTopState||this.emit("execeedtop",this,t,e)),this.execeedTopState=a,r&&(this.execeedBottomState||this.emit("execeedbottom",this,t,i)),this.execeedBottomState=r}setTextOY(t){return this.textOY=t,this}set t(t){this.textOY=-this.textVisibleHeight*t}get t(){var t=this.textVisibleHeight;return 0===t?0:this.textOY/-t}setTextOYByPercentage(t){return this.t=t,this}}var createDefaultTextObject=function(t){return t.add.text(0,0,"")};Object.assign(p.prototype,c);e.a=p},function(t,e,i){"use strict";var a=i(11),r=i(21),n=i(23);class s extends n.a{constructor(t,e){super(e),this.parent=t,this.init()}init(){this.start("IDLE")}next_IDLE(){var t,e=this.parent;return e.dragState.isDown&&(t=0===e.dragThreshold?"DRAG":"DRAGBEGIN"),t}update_IDLE(t,e){this.next()}next_DRAGBEGIN(){var t=this.parent,e=t.dragState;return e.isDown?e.pointer.getDistance()>=t.dragThreshold?"DRAG":"DRAGBEGIN":"IDLE"}update_DRAGBEGIN(t,e){this.next()}next_DRAG(){var t,e=this.parent;return e.dragState.isUp&&(t=e.outOfBounds?"BACK":e.slidingEnable?"SLIDE":"IDLE"),t}update_DRAG(t,e){var i=this.parent;i.dragState.justMoved&&i.dragging(),this.next()}next_SLIDE(){var t,e=this.parent;return e.dragState.isDown?t="DRAG":e.isSliding||(t="IDLE"),t}enter_SLIDE(){this.parent.onSliding()}exit_SLIDE(){this.parent.stop()}update_SLIDE(t,e){this.parent.sliding(t,e),this.next()}next_BACK(){var t,e=this.parent;return e.dragState.isDown?t="DRAG":e.isPullBack||(t="IDLE"),t}enter_BACK(){this.parent.onPullBack()}exit_BACK(){this.parent.stop()}update_BACK(t,e){this.parent.pullBack(t,e),this.next()}}var o=s;const h=Phaser.Utils.Objects.GetValue,l=Phaser.Math.Distance.Between;class c{constructor(t,e){this.gameObject=t,this.scene=Object(a.a)(t),this.setEventEmitter(h(e,"eventEmitter",void 0)),t.setInteractive(h(e,"inputConfig",void 0)),this.resetFromJSON(e),this.boot()}resetFromJSON(t){return this.pointer=void 0,this.isInTouched=!1,this.holdStartTime=void 0,this.x=void 0,this.y=void 0,this.preX=void 0,this.preY=void 0,this.localX=void 0,this.localY=void 0,this.justMoved=!1,this.setEnable(h(t,"enable",!0)),this.holdThreshold=h(t,"holdThreshold",50),this}boot(){this.gameObject.on("pointerdown",this.onPointIn,this),this.gameObject.on("pointerover",this.onPointIn,this),this.gameObject.on("pointerup",this.onPointOut,this),this.gameObject.on("pointerout",this.onPointOut,this),this.gameObject.on("pointermove",this.onPointerMove,this),this.gameObject.once("destroy",this.destroy,this),this.scene.events.on("preupdate",this.preupdate,this)}shutdown(){this.scene&&this.scene.events.off("preupdate",this.preupdate,this),this.pointer=void 0,this.gameObject=void 0,this.scene=void 0,this.destroyEventEmitter()}destroy(){this.shutdown()}setEnable(t){return void 0===t&&(t=!0),this.enable===t?this:(t||(this.isInTouched=!1,this.pointer=void 0),this.enable=t,this.gameObject.input.enabled=t,this)}get isDown(){return this.pointer&&this.pointer.isDown}get isUp(){return!this.isDown}get dx(){return this.x-this.preX}get dy(){return this.y-this.preY}get dt(){return this.scene.sys.game.loop.delta}get speed(){return this.x===this.preX&&this.y===this.preY?0:l(this.preX,this.preY,this.x,this.y)/(.001*this.dt)}get speedX(){return this.dx/(.001*this.dt)}get speedY(){return this.dy/(.001*this.dt)}onPointIn(t,e,i){t.isDown&&void 0===this.pointer&&(this.pointer=t,this.localX=e,this.localY=i)}onPointOut(t){this.pointer===t&&(this.pointer=void 0)}onPointerMove(t,e,i){t.isDown&&this.pointer===t&&(this.localX=e,this.localY=i)}preupdate(t,e){var i=this.pointer;this.justMoved=!1,i&&!this.isInTouched?(this.x=i.x,this.y=i.y,this.preX=i.x,this.preY=i.y,this.isInTouched=!0,this.holdStartTime=void 0,this.emit("touchstart",i,this.localX,this.localY)):i&&this.isInTouched?this.x===i.x&&this.y===i.y?void 0===this.holdStartTime?this.holdStartTime=t:t-this.holdStartTime>this.holdThreshold&&(this.preX=this.x,this.preY=this.y):(this.preX=this.x,this.preY=this.y,this.x=i.x,this.y=i.y,this.holdStartTime=void 0,this.justMoved=!0,this.emit("touchmove",i,this.localX,this.localY)):!i&&this.isInTouched&&(this.isInTouched=!1,this.holdStartTime=void 0,this.emit("touchend",i))}}Object.assign(c.prototype,r.a);var u=c;const d=Phaser.Utils.Objects.GetValue;var p=class{constructor(t){this.resetFromJSON(t)}resetFromJSON(t){return this.setValue(d(t,"value",0)),this.setSpeed(d(t,"speed",0)),this.setAcceleration(d(t,"acceleration",0)),this}reset(){this.setValue(0),this.setSpeed(0),this.setAcceleration(0)}setValue(t){return this.value=t,this}setSpeed(t){return this.speed=t,this}setAcceleration(t){return this.acceleration=t,this}updateSpeed(t){return 0!==this.acceleration&&(this.speed+=this.acceleration*t,this.speed<0&&(this.speed=0)),this}getDeltaValue(t){return this.updateSpeed(t),this.speed<=0?0:this.speed*t}update(t){return this.updateSpeed(t),this.speed>0&&(this.value+=this.getDeltaValue(t)),this}get isMoving(){return this.speed>0}};var m=class{constructor(){this.value,this.dir,this.movement=new p}init(t,e,i,a,r){return this.value=t,this.end=r,this.dir=void 0!==r?t<r:e,this.movement.setSpeed(i).setAcceleration(-a),this}stop(){this.movement.reset()}update(t){var e=this.movement.getDeltaValue(t);return this.dir||(e=-e),void 0===this.end?this.value+=e:0===e?this.value=this.end:(this.value+=e,this.dir?this.value>this.end&&(this.value=this.end):this.value<this.end&&(this.value=this.end)),this}get isMoving(){return this.movement.isMoving}};const f=Phaser.Utils.Objects.GetValue;class g{constructor(t,e){this.gameObject=t,this.scene=Object(a.a)(t),this.setEventEmitter(f(e,"eventEmitter",void 0));var i=f(e,"enable",!0),r={enable:i,eventEmitter:!1};this._state=new o(this,r);var n={inputConfig:f(e,"inputConfig",void 0),enable:i,eventEmitter:!1};this.dragState=new u(t,n),this._value=void 0,this._slowDown=new m;var s=f(e,"valuechangeCallback",null);if(null!==s){var h=f(e,"valuechangeCallbackScope",void 0);this.on("valuechange",s,h)}if(null!==(s=f(e,"overmaxCallback",null))){h=f(e,"overmaxCallbackScope",void 0);this.on("overmax",s,h)}if(null!==(s=f(e,"overminCallback",null))){h=f(e,"overminCallbackScope",void 0);this.on("overmin",s,h)}this.resetFromJSON(e),this.boot()}resetFromJSON(t){this.setOrientationMode(f(t,"orientation",0)),this.setDragThreshold(f(t,"threshold",10)),this.setSlidingDeceleration(f(t,"slidingDeceleration",5e3)),this.setBackDeceleration(f(t,"backDeceleration",2e3));var e=f(t,"bounds",void 0);return e?this.setBounds(e):this.setBounds(f(t,"max",0),f(t,"min",0)),this.setValue(f(t,"value",this.maxValue||0)),this.setEnable(f(t,"enable",!0)),this}boot(){this.scene.events.on("update",this._state.update,this._state),this.gameObject.once("destroy",this.destroy,this)}shutdown(){this.destroyEventEmitter(),this.scene&&this.scene.events.off("update",this._state.update,this._state),this.gameObject=void 0,this.scene=void 0,this._state.destroy(),this.dragState.destroy()}destroy(){this.shutdown()}setOrientationMode(t){return"string"==typeof t&&(t=y[t]),this.orientationMode=t,this}setDragThreshold(t){return this.dragThreshold=t,this}setSlidingDeceleration(t){return this.slidingDeceleration=t,this}setBackDeceleration(t){return this.backDeceleration=t,this}setBounds(t,e){if(Array.isArray(t)){var i=t;t=i[0],e=i[1]}return t<e?(this.minValue=t,this.maxValue=e):(this.minValue=e,this.maxValue=t),this}get value(){return this._value}set value(t){if(t!==this._value){var e=this._value,i=this.overMax(t),a=this.overMin(t);i&&this.emit("overmax",t,e),a&&this.emit("overmin",t,e),this.backEnable||(i&&(t=this.maxValue),a&&(t=this.minValue)),this._value=t,this.emit("valuechange",t,e)}}setValue(t){this.value=t}setEnable(t){return this._state.setEnable(t),this.dragState.setEnable(t),this}get state(){return this._state.state}get isDragging(){return this.dragState.isInTouched}get outOfMaxBound(){return this.overMax(this.value)}get outOfMinBound(){return this.overMin(this.value)}get outOfBounds(){return this.outOfMinBound||this.outOfMaxBound}overMax(t){return null!=this.maxValue&&t>this.maxValue}overMin(t){return null!=this.minValue&&t<this.minValue}get backEnable(){return"number"==typeof this.backDeceleration}get isPullBack(){return this._slowDown.isMoving}get slidingEnable(){return"number"==typeof this.slidingDeceleration}get isSliding(){return this._slowDown.isMoving}get dragDelta(){return 0===this.orientationMode?this.dragState.dy:1===this.orientationMode?this.dragState.dx:0}get dragSpeed(){return 0===this.orientationMode?this.dragState.speedY:1===this.orientationMode?this.dragState.speedX:0}dragging(){this.value+=this.dragDelta}onSliding(){var t=this.value,e=this.dragSpeed;if(0===e)return this._slowDown.stop(),void this._state.next();var i=this.slidingDeceleration;this._slowDown.init(t,e>0,Math.abs(e),i)}sliding(t,e){e*=.001;var i=this._slowDown.update(e).value;this.overMax(i)?(this.value=this.maxValue,this._slowDown.stop()):this.overMin(i)?(this.value=this.minValue,this._slowDown.stop()):this.value=i}onPullBack(){var t=this.value,e=this.outOfMinBound?this.minValue:this.maxValue,i=Math.abs(e-t),a=this.backDeceleration,r=Math.sqrt(2*a*i);this._slowDown.init(t,void 0,r,a,e)}pullBack(t,e){e*=.001,this.value=this._slowDown.update(e).value,this._slowDown.isMoving||this._state.next()}stop(){this._slowDown.stop()}}Object.assign(g.prototype,r.a);const y={y:0,v:0,vertical:0,x:1,h:1,horizontal:1};e.a=g},function(t,e,i){"use strict";const a=Phaser.Utils.Objects.GetValue;var GetRadius=function(t,e,i){return void 0===t?{x:e,y:i}:"number"==typeof t?{x:t,y:t}:t},r=class{constructor(t,e,i,a,r){this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,i,a,r)}setTo(t,e,i,a,r){return this.setPosition(t,e),this.setRadius(r),this.setSize(i,a),this}setPosition(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}setRadius(t){var e,i;void 0===t&&(t=0),"number"==typeof t?(e=t,i=t):(e=a(t,"x",0),i=a(t,"y",0));var r=this.cornerRadius;return r.tl=GetRadius(a(t,"tl",void 0),e,i),r.tr=GetRadius(a(t,"tr",void 0),e,i),r.bl=GetRadius(a(t,"bl",void 0),e,i),r.br=GetRadius(a(t,"br",void 0),e,i),this}setSize(t,e){return this.width=t,this.height=e,this}get minWidth(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}get minHeight(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}get width(){return this._width}set width(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}get height(){return this._height}set height(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}get radius(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}},utils_LineTo=function(t,e,i){var a=i.length;if(a>=2){var r=i[a-2],n=i[a-1];if(t===r&&e===n)return i}return i.push(t,e),i},n=i(212),s=i.n(n);const o=Phaser.Utils.Objects.GetValue;var utils_ArcTo=function(t,e,i,a,r,n,h,l){var c,u,d,p=o(i,"x",i),m=o(i,"y",i);n&&(r+=360),a=s()(a);for(var f=((r=s()(r))-a)/h,g=0;g<=h;g++)d=a+f*g,c=t+p*Math.cos(d),u=e+m*Math.sin(d),utils_LineTo(c,u,l);return l},h=i(213),l=i.n(h),c=i(214),u=i.n(c),d=i(217),p=i.n(d),m=i(19),f=(m.a,m.a,{renderWebGL:u.a,renderCanvas:p.a});const g=Phaser.Utils.Objects.GetValue;class y extends Phaser.GameObjects.Shape{constructor(t,e,i,a,n,s,o,h){void 0===e&&(e=0),void 0===i&&(i=0);var l=g(s,"iteration",void 0);s=g(s,"radius",s),super(t,"RoundRectangle",new r(0,0,a,n,s)),this.setIteration(l),this.setPosition(e,i),void 0!==o&&this.setFillStyle(o,h),this.updateDisplayOrigin(),this.updateData()}updateData(){var t=this.geom,e=this.pathData;e.length=0;var i,a=t.cornerRadius,r=this.iteration+1;if(i=a.br,isArcCorner(i)){var n=t.width-i.x,s=t.height-i.y;utils_ArcTo(n,s,i,0,90,!1,r,e)}else utils_LineTo(t.width,t.height,e);if(i=a.bl,isArcCorner(i)){n=i.x,s=t.height-i.y;utils_ArcTo(n,s,i,90,180,!1,r,e)}else utils_LineTo(0,t.height,e);if(i=a.tl,isArcCorner(i)){n=i.x,s=i.y;utils_ArcTo(n,s,i,180,270,!1,r,e)}else utils_LineTo(0,0,e);if(i=a.tr,isArcCorner(i)){n=t.width-i.x,s=i.y;utils_ArcTo(n,s,i,270,360,!1,r,e)}else utils_LineTo(t.width,0,e);return e.push(e[0],e[1]),this.pathIndexes=l()(e),this}get width(){return this.geom.width}set width(t){this.width!==t&&(this.geom.width=t,this.updateDisplayOrigin(),this.updateData())}get height(){return this.geom.height}set height(t){this.height!==t&&(this.geom.height=t,this.updateDisplayOrigin(),this.updateData())}resize(t,e){return void 0===e&&(e=t),this.geom.width===t&&this.geom.height===e?this:(this.geom.height=e,this.geom.width=t,this.updateDisplayOrigin(),this.updateData(),this)}get iteration(){return this._iteration}set iteration(t){void 0!==this._iteration?this._iteration!==t&&(this._iteration=t,this.updateData()):this._iteration=t}setIteration(t){return void 0===t&&(t=6),this.iteration=t,this}get radius(){return this.geom.radius}set radius(t){this.geom.setRadius(t),this.updateDisplayOrigin(),this.updateData()}setRadius(t){return void 0===t&&(t=0),this.radius=t,this}get cornerRadius(){return this.geom.cornerRadius}set cornerRadius(t){this.radius=t}setCornerRadius(t){return this.setRadius(t)}}var isArcCorner=function(t){return 0!==t.x&&0!==t.y};Object.assign(y.prototype,f);e.a=y},function(t,e,i){"use strict";var a=i(82),r=i(135),textarea_InjectProperties=function(t){Object.defineProperty(t,"childOY",{configurable:!0,get:function(){return t.textOY},set:function(e){t.textOY=e}}),Object.defineProperty(t,"topChildOY",{get:function(){return t.topTextOY}}),Object.defineProperty(t,"bottomChildOY",{get:function(){return t.bottomTextOY}})},textarea_SetText=function(t){return this.childrenMap.child.setText(t),this.resizeController(),this},textarea_AppendText=function(t){return this.setText(this.text+t),this};const n=Phaser.Utils.Objects.GetValue;class s extends a.a{constructor(t,e){void 0===e&&(e={});var i=n(e,"text",void 0),a=n(e,"textWidth",void 0),s=n(e,"textHeight",void 0),o=n(e,"textMask",!0),h=n(e,"content",""),l=new r.a(t,{width:a,height:s,text:i,textMask:o,content:h,clamplTextOY:n(e,"clamplChildOY",!1)}),c=void 0===a?1:0,u=void 0===s;textarea_InjectProperties(l),e.scrollMode=0,e.type="rexTextArea",e.child={gameObject:l,proportion:c,expand:u};var d=n(e,"space",void 0);d&&(d.child=d.text),super(t,e),this.addChildrenMap("text",i)}get text(){return this.childrenMap.child.text}get linesCount(){return this.childrenMap.child.linesCount}}var o={setText:textarea_SetText,appendText:textarea_AppendText};Object.assign(s.prototype,o);e.a=s},,function(t,e,i){(function(e){t.exports=e.dragonBones=i(141)}).call(this,i(32))},function(t,e,i){"use strict";var a,r=this&&this.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])});!function(t){var e=function(){function DragonBones(e){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=e,console.info("DragonBones: "+DragonBones.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return DragonBones.prototype.advanceTime=function(e){if(this._objects.length>0){for(var i=0,a=this._objects;i<a.length;i++){a[i].returnToPool()}this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var r=0;r<this._events.length;++r){var n=this._events[r],s=n.armature;null!==s._armatureData&&(s.eventDispatcher.dispatchDBEvent(n.type,n),n.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(n.type,n)),this.bufferObject(n)}this._events.length=0}},DragonBones.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},DragonBones.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(DragonBones.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(DragonBones.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),DragonBones.VERSION="5.7.000",DragonBones.yDown=!0,DragonBones.debug=!1,DragonBones.debugDraw=!1,DragonBones}();t.DragonBones=e}(l||(l={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function now(){return(new Date).getTime()});var n,s,o,h,l,c;r=function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r};if(void 0===u&&"undefined"!=typeof window)var u=window;t.exports=l,function(t){var e=function(){function BaseObject(){this.hashCode=BaseObject._hashCode++,this._isInPool=!1}return BaseObject._returnObject=function(t){var e=String(t.constructor),i=e in BaseObject._maxCountMap?BaseObject._maxCountMap[e]:BaseObject._defaultMaxCount,a=BaseObject._poolsMap[e]=BaseObject._poolsMap[e]||[];a.length<i&&(t._isInPool?console.warn("The object is already in the pool."):(t._isInPool=!0,a.push(t)))},BaseObject.toString=function(){throw new Error},BaseObject.setMaxCount=function(t,e){if((e<0||e!=e)&&(e=0),null!==t)null!==(a=(i=String(t))in BaseObject._poolsMap?BaseObject._poolsMap[i]:null)&&a.length>e&&(a.length=e),BaseObject._maxCountMap[i]=e;else for(var i in BaseObject._defaultMaxCount=e,BaseObject._poolsMap){var a;(a=BaseObject._poolsMap[i]).length>e&&(a.length=e),i in BaseObject._maxCountMap&&(BaseObject._maxCountMap[i]=e)}},BaseObject.clearPool=function(t){if(void 0===t&&(t=null),null!==t){var e=String(t);null!==(a=e in BaseObject._poolsMap?BaseObject._poolsMap[e]:null)&&a.length>0&&(a.length=0)}else for(var i in BaseObject._poolsMap){var a;(a=BaseObject._poolsMap[i]).length=0}},BaseObject.borrowObject=function(t){var e=String(t),i=e in BaseObject._poolsMap?BaseObject._poolsMap[e]:null;if(null!==i&&i.length>0){var a=i.pop();return a._isInPool=!1,a}var r=new t;return r._onClear(),r},BaseObject.prototype.returnToPool=function(){this._onClear(),BaseObject._returnObject(this)},BaseObject._hashCode=0,BaseObject._defaultMaxCount=3e3,BaseObject._maxCountMap={},BaseObject._poolsMap={},BaseObject}();t.BaseObject=e}(l||(l={})),function(t){var e=function(){function Matrix(t,e,i,a,r,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=1),void 0===r&&(r=0),void 0===n&&(n=0),this.a=t,this.b=e,this.c=i,this.d=a,this.tx=r,this.ty=n}return Matrix.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},Matrix.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Matrix.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},Matrix.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},Matrix.prototype.concat=function(t){var e=this.a*t.a,i=0,a=0,r=this.d*t.d,n=this.tx*t.a+t.tx,s=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,i+=this.b*t.d,a+=this.c*t.a,r+=this.c*t.b),0===t.b&&0===t.c||(i+=this.a*t.b,a+=this.d*t.c,n+=this.ty*t.c,s+=this.tx*t.b),this.a=e,this.b=i,this.c=a,this.d=r,this.tx=n,this.ty=s,this},Matrix.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,a=this.d,r=this.tx,n=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===a?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,a=this.d=1/a,this.tx=-t*r,this.ty=-a*n),this;var s=t*a-e*i;if(0===s)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;s=1/s;var o=this.a=a*s;return e=this.b=-e*s,i=this.c=-i*s,a=this.d=t*s,this.tx=-(o*r+i*n),this.ty=-(e*r+a*n),this},Matrix.prototype.transformPoint=function(t,e,i,a){void 0===a&&(a=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,a||(i.x+=this.tx,i.y+=this.ty)},Matrix.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var i=this.a,a=this.b,r=this.c,n=this.d,s=e?0:this.tx,o=e?0:this.ty,h=t.x,l=t.y,c=h+t.width,u=l+t.height,d=i*h+r*l+s,p=a*h+n*l+o,m=i*c+r*l+s,f=a*c+n*l+o,g=i*c+r*u+s,y=a*c+n*u+o,_=i*h+r*u+s,v=a*h+n*u+o,b=0;d>m&&(b=d,d=m,m=b),g>_&&(b=g,g=_,_=b),t.x=Math.floor(d<g?d:g),t.width=Math.ceil((m>_?m:_)-t.x),p>f&&(b=p,p=f,f=b),y>v&&(b=y,y=v,v=b),t.y=Math.floor(p<y?p:y),t.height=Math.ceil((f>v?f:v)-t.y)},Matrix}();t.Matrix=e}(l||(l={})),function(t){var e=function(){function Transform(t,e,i,a,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===r&&(r=1),void 0===n&&(n=1),this.x=t,this.y=e,this.skew=i,this.rotation=a,this.scaleX=r,this.scaleY=n}return Transform.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI},Transform.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},Transform.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},Transform.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},Transform.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},Transform.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},Transform.prototype.fromMatrix=function(t){var e=this.scaleX,i=this.scaleY,a=Transform.PI_Q;this.x=t.tx,this.y=t.ty,this.rotation=Math.atan(t.b/t.a);var r=Math.atan(-t.c/t.d);return this.scaleX=this.rotation>-a&&this.rotation<a?t.a/Math.cos(this.rotation):t.b/Math.sin(this.rotation),this.scaleY=r>-a&&r<a?t.d/Math.cos(r):-t.c/Math.sin(r),e>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),i>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,r-=Math.PI),this.skew=r-this.rotation,this},Transform.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},Transform.PI=Math.PI,Transform.PI_D=2*Math.PI,Transform.PI_H=Math.PI/2,Transform.PI_Q=Math.PI/4,Transform.RAD_DEG=180/Math.PI,Transform.DEG_RAD=Math.PI/180,Transform}();t.Transform=e}(l||(l={})),function(t){var e=function(){function ColorTransform(t,e,i,a,r,n,s,o){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===a&&(a=1),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=a,this.alphaOffset=r,this.redOffset=n,this.greenOffset=s,this.blueOffset=o}return ColorTransform.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},ColorTransform.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},ColorTransform}();t.ColorTransform=e}(l||(l={})),function(t){var e=function(){function Point(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return Point.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},Point.prototype.clear=function(){this.x=this.y=0},Point}();t.Point=e}(l||(l={})),function(t){var e=function(){function Rectangle(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),this.x=t,this.y=e,this.width=i,this.height=a}return Rectangle.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},Rectangle.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},Rectangle}();t.Rectangle=e}(l||(l={})),function(t){var e=function(t){function UserData(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return r(UserData,t),UserData.toString=function(){return"[class dragonBones.UserData]"},UserData.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},UserData.prototype.addInt=function(t){this.ints.push(t)},UserData.prototype.addFloat=function(t){this.floats.push(t)},UserData.prototype.addString=function(t){this.strings.push(t)},UserData.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},UserData.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},UserData.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},UserData}(t.BaseObject);t.UserData=e;var i=function(t){function ActionData(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return r(ActionData,t),ActionData.toString=function(){return"[class dragonBones.ActionData]"},ActionData.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},ActionData}(t.BaseObject);t.ActionData=i}(l||(l={})),function(t){var e=function(t){function DragonBonesData(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return r(DragonBonesData,t),DragonBonesData.toString=function(){return"[class dragonBones.DragonBonesData]"},DragonBonesData.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.colorArray=null,this.userData=null},DragonBonesData.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},DragonBonesData.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},DragonBonesData}(t.BaseObject);t.DragonBonesData=e}(l||(l={})),function(t){var e=function(e){function ArmatureData(){var i=null!==e&&e.apply(this,arguments)||this;return i.aabb=new t.Rectangle,i.animationNames=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.constraints={},i.skins={},i.animations={},i.canvas=null,i.userData=null,i}return r(ArmatureData,e),ArmatureData.toString=function(){return"[class dragonBones.ArmatureData]"},ArmatureData.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++){e[t].returnToPool()}for(var i=0,a=this.actions;i<a.length;i++){a[i].returnToPool()}for(var r in this.bones)this.bones[r].returnToPool(),delete this.bones[r];for(var r in this.slots)this.slots[r].returnToPool(),delete this.slots[r];for(var r in this.constraints)this.constraints[r].returnToPool(),delete this.constraints[r];for(var r in this.skins)this.skins[r].returnToPool(),delete this.skins[r];for(var r in this.animations)this.animations[r].returnToPool(),delete this.animations[r];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},ArmatureData.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),i=0,a=0;for(this.sortedBones.length=0;a<t;){var r=e[i++];if(i>=t&&(i=0),!(this.sortedBones.indexOf(r)>=0)){var n=!1;for(var s in this.constraints){var o=this.constraints[s];if(o.root===r&&this.sortedBones.indexOf(o.target)<0){n=!0;break}}n||null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),a++)}}}},ArmatureData.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},ArmatureData.prototype.setCacheFrame=function(t,e){var i=this.parent.cachedFrames,a=i.length;return i.length+=10,i[a]=t.a,i[a+1]=t.b,i[a+2]=t.c,i[a+3]=t.d,i[a+4]=t.tx,i[a+5]=t.ty,i[a+6]=e.rotation,i[a+7]=e.skew,i[a+8]=e.scaleX,i[a+9]=e.scaleY,a},ArmatureData.prototype.getCacheFrame=function(t,e,i){var a=this.parent.cachedFrames;t.a=a[i],t.b=a[i+1],t.c=a[i+2],t.d=a[i+3],t.tx=a[i+4],t.ty=a[i+5],e.rotation=a[i+6],e.skew=a[i+7],e.scaleX=a[i+8],e.scaleY=a[i+9],e.x=t.tx,e.y=t.ty},ArmatureData.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},ArmatureData.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},ArmatureData.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},ArmatureData.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},ArmatureData.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},ArmatureData.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},ArmatureData.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},ArmatureData.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},ArmatureData.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},ArmatureData.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},ArmatureData.prototype.getMesh=function(t,e,i){var a=this.getSkin(t);return null===a?null:a.getDisplay(e,i)},ArmatureData.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},ArmatureData}(t.BaseObject);t.ArmatureData=e;var i=function(e){function BoneData(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.userData=null,i}return r(BoneData,e),BoneData.toString=function(){return"[class dragonBones.BoneData]"},BoneData.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.alpha=1,this.name="",this.transform.identity(),this.userData=null,this.parent=null},BoneData}(t.BaseObject);t.BoneData=i;var a=function(e){function SurfaceData(){var i=null!==e&&e.apply(this,arguments)||this;return i.geometry=new t.GeometryData,i}return r(SurfaceData,e),SurfaceData.toString=function(){return"[class dragonBones.SurfaceData]"},SurfaceData.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.geometry.clear()},SurfaceData}(i);t.SurfaceData=a;var n=function(e){function SlotData(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return r(SlotData,e),SlotData.createColor=function(){return new t.ColorTransform},SlotData.toString=function(){return"[class dragonBones.SlotData]"},SlotData.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.zIndex=0,this.alpha=1,this.name="",this.color=null,this.userData=null,this.parent=null},SlotData.DEFAULT_COLOR=new t.ColorTransform,SlotData}(t.BaseObject);t.SlotData=n}(l||(l={})),function(t){var e=function(t){function ConstraintData(){return null!==t&&t.apply(this,arguments)||this}return r(ConstraintData,t),ConstraintData.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},ConstraintData}(t.BaseObject);t.ConstraintData=e;var i=function(t){function IKConstraintData(){return null!==t&&t.apply(this,arguments)||this}return r(IKConstraintData,t),IKConstraintData.toString=function(){return"[class dragonBones.IKConstraintData]"},IKConstraintData.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},IKConstraintData}(e);t.IKConstraintData=i;var a=function(t){function PathConstraintData(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return r(PathConstraintData,t),PathConstraintData.toString=function(){return"[class dragonBones.PathConstraintData]"},PathConstraintData.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},PathConstraintData.prototype.AddBone=function(t){this.bones.push(t)},PathConstraintData}(e);t.PathConstraintData=a}(l||(l={})),function(t){var e=function(t){function CanvasData(){return null!==t&&t.apply(this,arguments)||this}return r(CanvasData,t),CanvasData.toString=function(){return"[class dragonBones.CanvasData]"},CanvasData.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},CanvasData}(t.BaseObject);t.CanvasData=e}(l||(l={})),function(t){var e=function(t){function SkinData(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return r(SkinData,t),SkinData.toString=function(){return"[class dragonBones.SkinData]"},SkinData.prototype._onClear=function(){for(var t in this.displays){for(var e=0,i=this.displays[t];e<i.length;e++){var a=i[e];null!==a&&a.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},SkinData.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},SkinData.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(null!==i)for(var a=0,r=i;a<r.length;a++){var n=r[a];if(null!==n&&n.name===e)return n}return null},SkinData.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},SkinData}(t.BaseObject);t.SkinData=e}(l||(l={})),function(t){var e=function(){function GeometryData(){this.weight=null}return GeometryData.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},GeometryData.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},Object.defineProperty(GeometryData.prototype,"vertexCount",{get:function(){return this.data.intArray[this.offset+0]},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryData.prototype,"triangleCount",{get:function(){return this.data.intArray[this.offset+1]},enumerable:!0,configurable:!0}),GeometryData}();t.GeometryData=e;var i=function(e){function DisplayData(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i}return r(DisplayData,e),DisplayData.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},DisplayData}(t.BaseObject);t.DisplayData=i;var a=function(e){function ImageDisplayData(){var i=null!==e&&e.apply(this,arguments)||this;return i.pivot=new t.Point,i}return r(ImageDisplayData,e),ImageDisplayData.toString=function(){return"[class dragonBones.ImageDisplayData]"},ImageDisplayData.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},ImageDisplayData}(i);t.ImageDisplayData=a;var n=function(t){function ArmatureDisplayData(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return r(ArmatureDisplayData,t),ArmatureDisplayData.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},ArmatureDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions;e<i.length;e++){i[e].returnToPool()}this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},ArmatureDisplayData.prototype.addAction=function(t){this.actions.push(t)},ArmatureDisplayData}(i);t.ArmatureDisplayData=n;var s=function(t){function MeshDisplayData(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i}return r(MeshDisplayData,t),MeshDisplayData.toString=function(){return"[class dragonBones.MeshDisplayData]"},MeshDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.geometry.clear(),this.texture=null},MeshDisplayData}(i);t.MeshDisplayData=s;var o=function(t){function BoundingBoxDisplayData(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return r(BoundingBoxDisplayData,t),BoundingBoxDisplayData.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},BoundingBoxDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},BoundingBoxDisplayData}(i);t.BoundingBoxDisplayData=o;var h=function(t){function PathDisplayData(){var i=null!==t&&t.apply(this,arguments)||this;return i.geometry=new e,i.curveLengths=[],i}return r(PathDisplayData,t),PathDisplayData.toString=function(){return"[class dragonBones.PathDisplayData]"},PathDisplayData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.geometry.clear(),this.curveLengths.length=0},PathDisplayData}(i);t.PathDisplayData=h;var l=function(t){function WeightData(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return r(WeightData,t),WeightData.toString=function(){return"[class dragonBones.WeightData]"},WeightData.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},WeightData.prototype.addBone=function(t){this.bones.push(t)},WeightData}(t.BaseObject);t.WeightData=l}(l||(l={})),function(t){var e=function(t){function BoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return r(BoundingBoxData,t),BoundingBoxData.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},BoundingBoxData}(t.BaseObject);t.BoundingBoxData=e;var i=function(t){function RectangleBoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return r(RectangleBoundingBoxData,t),RectangleBoundingBoxData.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},RectangleBoundingBoxData._computeOutCode=function(t,e,i,a,r,n){var s=0;return t<i?s|=1:t>r&&(s|=2),e<a?s|=4:e>n&&(s|=8),s},RectangleBoundingBoxData.rectangleIntersectsSegment=function(t,e,i,a,r,n,s,o,h,l,c){void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=null);var u=t>r&&t<s&&e>n&&e<o,d=i>r&&i<s&&a>n&&a<o;if(u&&d)return-1;for(var p=0,m=RectangleBoundingBoxData._computeOutCode(t,e,r,n,s,o),f=RectangleBoundingBoxData._computeOutCode(i,a,r,n,s,o);;){if(0==(m|f)){p=2;break}if(0!=(m&f))break;var g=0,y=0,_=0,v=0!==m?m:f;0!=(4&v)?(g=t+(i-t)*(n-e)/(a-e),y=n,null!==c&&(_=.5*-Math.PI)):0!=(8&v)?(g=t+(i-t)*(o-e)/(a-e),y=o,null!==c&&(_=.5*Math.PI)):0!=(2&v)?(y=e+(a-e)*(s-t)/(i-t),g=s,null!==c&&(_=0)):0!=(1&v)&&(y=e+(a-e)*(r-t)/(i-t),g=r,null!==c&&(_=Math.PI)),v===m?(t=g,e=y,m=RectangleBoundingBoxData._computeOutCode(t,e,r,n,s,o),null!==c&&(c.x=_)):(i=g,a=y,f=RectangleBoundingBoxData._computeOutCode(i,a,r,n,s,o),null!==c&&(c.y=_))}return p&&(u?(p=2,null!==h&&(h.x=i,h.y=a),null!==l&&(l.x=i,l.y=i),null!==c&&(c.x=c.y+Math.PI)):d?(p=1,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=t,l.y=e),null!==c&&(c.y=c.x+Math.PI)):(p=3,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=i,l.y=a))),p},RectangleBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},RectangleBoundingBoxData.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var a=.5*this.height;if(e>=-a&&e<=a)return!0}return!1},RectangleBoundingBoxData.prototype.intersectsSegment=function(t,e,i,a,r,n,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null);var o=.5*this.width,h=.5*this.height;return RectangleBoundingBoxData.rectangleIntersectsSegment(t,e,i,a,-o,-h,o,h,r,n,s)},RectangleBoundingBoxData}(e);t.RectangleBoundingBoxData=i;var a=function(t){function EllipseBoundingBoxData(){return null!==t&&t.apply(this,arguments)||this}return r(EllipseBoundingBoxData,t),EllipseBoundingBoxData.toString=function(){return"[class dragonBones.EllipseData]"},EllipseBoundingBoxData.ellipseIntersectsSegment=function(t,e,i,a,r,n,s,o,h,l,c){void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=null);var u=s/o,d=u*u,p=i-t,m=(a*=u)-(e*=u),f=Math.sqrt(p*p+m*m),g=p/f,y=m/f,_=(r-t)*g+(n-e)*y,v=s*s,b=v-(t*t+e*e)+_*_,P=0;if(b>=0){var S=Math.sqrt(b),D=_-S,T=_+S,x=D<0?-1:D<=f?0:1,C=T<0?-1:T<=f?0:1,O=x*C;if(O<0)return-1;0===O&&(-1===x?(P=2,i=t+T*g,a=(e+T*y)/u,null!==h&&(h.x=i,h.y=a),null!==l&&(l.x=i,l.y=a),null!==c&&(c.x=Math.atan2(a/v*d,i/v),c.y=c.x+Math.PI)):1===C?(P=1,t+=D*g,e=(e+D*y)/u,null!==h&&(h.x=t,h.y=e),null!==l&&(l.x=t,l.y=e),null!==c&&(c.x=Math.atan2(e/v*d,t/v),c.y=c.x+Math.PI)):(P=3,null!==h&&(h.x=t+D*g,h.y=(e+D*y)/u,null!==c&&(c.x=Math.atan2(h.y/v*d,h.x/v))),null!==l&&(l.x=t+T*g,l.y=(e+T*y)/u,null!==c&&(c.y=Math.atan2(l.y/v*d,l.x/v)))))}return P},EllipseBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},EllipseBoundingBoxData.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&t<=i){var a=.5*this.height;if(e>=-a&&e<=a)return e*=i/a,Math.sqrt(t*t+e*e)<=i}return!1},EllipseBoundingBoxData.prototype.intersectsSegment=function(t,e,i,a,r,n,s){return void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null),EllipseBoundingBoxData.ellipseIntersectsSegment(t,e,i,a,0,0,.5*this.width,.5*this.height,r,n,s)},EllipseBoundingBoxData}(e);t.EllipseBoundingBoxData=a;var n=function(t){function PolygonBoundingBoxData(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return r(PolygonBoundingBoxData,t),PolygonBoundingBoxData.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},PolygonBoundingBoxData.polygonIntersectsSegment=function(t,e,i,a,r,n,s,o){void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o=null),t===i&&(t=i+1e-6),e===a&&(e=a+1e-6);for(var h=r.length,l=t-i,c=e-a,u=t*a-e*i,d=0,p=r[h-2],m=r[h-1],f=0,g=0,y=0,_=0,v=0,b=0,P=0;P<h;P+=2){var S=r[P],D=r[P+1];p===S&&(p=S+1e-4),m===D&&(m=D+1e-4);var T=p-S,x=m-D,C=p*D-m*S,O=l*x-c*T,M=(u*T-l*C)/O;if((M>=p&&M<=S||M>=S&&M<=p)&&(0===l||M>=t&&M<=i||M>=i&&M<=t)){var w=(u*x-c*C)/O;if((w>=m&&w<=D||w>=D&&w<=m)&&(0===c||w>=e&&w<=a||w>=a&&w<=e)){if(null===s){y=M,_=w,v=M,b=w,d++,null!==o&&(o.x=Math.atan2(D-m,S-p)-.5*Math.PI,o.y=o.x);break}var A=M-t;A<0&&(A=-A),0===d?(f=A,g=A,y=M,_=w,v=M,b=w,null!==o&&(o.x=Math.atan2(D-m,S-p)-.5*Math.PI,o.y=o.x)):(A<f&&(f=A,y=M,_=w,null!==o&&(o.x=Math.atan2(D-m,S-p)-.5*Math.PI)),A>g&&(g=A,v=M,b=w,null!==o&&(o.y=Math.atan2(D-m,S-p)-.5*Math.PI))),d++}}p=S,m=D}return 1===d?(null!==n&&(n.x=y,n.y=_),null!==s&&(s.x=y,s.y=_),null!==o&&(o.y=o.x+Math.PI)):d>1&&(d++,null!==n&&(n.x=y,n.y=_),null!==s&&(s.x=v,s.y=b)),d},PolygonBoundingBoxData.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},PolygonBoundingBoxData.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var a=0,r=this.vertices.length,n=r-2;a<r;a+=2){var s=this.vertices[n+1],o=this.vertices[a+1];if(o<e&&s>=e||s<e&&o>=e){var h=this.vertices[n],l=this.vertices[a];(e-o)*(h-l)/(s-o)+l<t&&(i=!i)}n=a}return i},PolygonBoundingBoxData.prototype.intersectsSegment=function(t,e,a,r,n,s,o){void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o=null);var h=0;return 0!==i.rectangleIntersectsSegment(t,e,a,r,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(h=PolygonBoundingBoxData.polygonIntersectsSegment(t,e,a,r,this.vertices,n,s,o)),h},PolygonBoundingBoxData}(e);t.PolygonBoundingBoxData=n}(l||(l={})),function(t){var e=function(t){function AnimationData(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return r(AnimationData,t),AnimationData.toString=function(){return"[class dragonBones.AnimationData]"},AnimationData.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,i=this.boneTimelines[t];e<i.length;e++){i[e].returnToPool()}delete this.boneTimelines[t]}for(var t in this.slotTimelines){for(var a=0,r=this.slotTimelines[t];a<r.length;a++){r[a].returnToPool()}delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var n=0,s=this.constraintTimelines[t];n<s.length;n++){s[n].returnToPool()}delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var o=0,h=this.animationTimelines[t];o<h.length;o++){h[o].returnToPool()}delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.blendType=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},AnimationData.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,a=this.cacheFrames.length;i<a;++i)this.cachedFrames[i]=!1;for(var r=0,n=this.parent.sortedBones;r<n.length;r++){var s=n[r];for(i=0,a=(l=new Array(e)).length;i<a;++i)l[i]=-1;this.boneCachedFrameIndices[s.name]=l}for(var o=0,h=this.parent.sortedSlots;o<h.length;o++){var l,c=h[o];for(i=0,a=(l=new Array(e)).length;i<a;++i)l[i]=-1;this.slotCachedFrameIndices[c.name]=l}}},AnimationData.prototype.addBoneTimeline=function(t,e){var i=t in this.boneTimelines?this.boneTimelines[t]:this.boneTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addSlotTimeline=function(t,e){var i=t in this.slotTimelines?this.slotTimelines[t]:this.slotTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addConstraintTimeline=function(t,e){var i=t in this.constraintTimelines?this.constraintTimelines[t]:this.constraintTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.addAnimationTimeline=function(t,e){var i=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];i.indexOf(e)<0&&i.push(e)},AnimationData.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},AnimationData.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},AnimationData.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},AnimationData.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},AnimationData.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},AnimationData.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},AnimationData}(t.BaseObject);t.AnimationData=e;var i=function(t){function TimelineData(){return null!==t&&t.apply(this,arguments)||this}return r(TimelineData,t),TimelineData.toString=function(){return"[class dragonBones.TimelineData]"},TimelineData.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},TimelineData}(t.BaseObject);t.TimelineData=i;var a=function(t){function AnimationTimelineData(){return null!==t&&t.apply(this,arguments)||this}return r(AnimationTimelineData,t),AnimationTimelineData.toString=function(){return"[class dragonBones.AnimationTimelineData]"},AnimationTimelineData.prototype._onClear=function(){t.prototype._onClear.call(this),this.x=0,this.y=0},AnimationTimelineData}(i);t.AnimationTimelineData=a}(l||(l={})),function(t){var e=function(t){function AnimationConfig(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return r(AnimationConfig,t),AnimationConfig.toString=function(){return"[class dragonBones.AnimationConfig]"},AnimationConfig.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additive=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},AnimationConfig.prototype.clear=function(){this._onClear()},AnimationConfig.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additive=t.additive,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;e<i;++e)this.boneMask[e]=t.boneMask[e]},AnimationConfig}(t.BaseObject);t.AnimationConfig=e}(l||(l={})),function(t){var e=function(t){function TextureAtlasData(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return r(TextureAtlasData,t),TextureAtlasData.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},TextureAtlasData.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},TextureAtlasData.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},TextureAtlasData.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},TextureAtlasData}(t.BaseObject);t.TextureAtlasData=e;var i=function(e){function TextureData(){var i=null!==e&&e.apply(this,arguments)||this;return i.region=new t.Rectangle,i.frame=null,i}return r(TextureData,e),TextureData.createRectangle=function(){return new t.Rectangle},TextureData.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},TextureData.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=TextureData.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},TextureData}(t.BaseObject);t.TextureData=i}(l||(l={})),n=l||(l={}),s=function(t){function Armature(){var e=null!==t&&t.apply(this,arguments)||this;return e._bones=[],e._slots=[],e._constraints=[],e._actions=[],e._animation=null,e._proxy=null,e._replaceTextureAtlasData=null,e._clock=null,e}return r(Armature,t),Armature.toString=function(){return"[class dragonBones.Armature]"},Armature._onSortSlots=function(t,e){return 1e3*t._zIndex+t._zOrder>1e3*e._zIndex+e._zOrder?1:-1},Armature.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var i=0,a=this._slots;i<a.length;i++)a[i].returnToPool();for(var r=0,n=this._constraints;r<n.length;r++)n[r].returnToPool();for(var s=0,o=this._actions;s<o.length;s++)o[s].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._zIndexDirty=!1,this._alphaDirty=!0,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._alpha=1,this._globalAlpha=1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},Armature.prototype._sortZOrder=function(t,e){var i=this._armatureData.sortedSlots,a=null===t;if(this._zOrderDirty||!a){for(var r=0,n=i.length;r<n;++r){var s=a?r:t[e+r];if(!(s<0||s>=n)){var o=i[s],h=this.getSlot(o.name);null!==h&&h._setZOrder(r)}}this._slotsDirty=!0,this._zOrderDirty=!a}},Armature.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},Armature.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},Armature.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},Armature.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},Armature.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},Armature.prototype.init=function(t,e,i,a){null===this._armatureData&&(this._armatureData=t,this._animation=n.BaseObject.borrowObject(n.Animation),this._proxy=e,this._display=i,this._dragonBones=a,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},Armature.prototype.advanceTime=function(t){if(!this._lockUpdate)if(this._lockUpdate=!0,null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty||this._zIndexDirty){if(this._slots.sort(Armature._onSortSlots),this._zIndexDirty)for(var i=0,a=this._slots.length;i<a;++i)this._slots[i]._setZOrder(i);this._slotsDirty=!1,this._zIndexDirty=!1}if(this._alphaDirty){this._alphaDirty=!1,this._globalAlpha=this._alpha*(null!==this._parent?this._parent._globalAlpha:1);for(var r=0,n=this._bones;r<n.length;r++)n[r]._updateAlpha();for(var s=0,o=this._slots;s<o.length;s++)(m=o[s])._updateAlpha()}if(this._cacheFrameIndex<0||this._cacheFrameIndex!==e){for(i=0,a=0,i=0,a=this._bones.length;i<a;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,a=this._slots.length;i<a;++i)this._slots[i].update(this._cacheFrameIndex)}if(this._actions.length>0){for(var h=0,l=this._actions;h<l.length;h++){var c=l[h],u=c.actionData;if(null!==u&&0===u.type)if(null!==c.slot)null!==(f=c.slot.childArmature)&&f.animation.fadeIn(u.name);else if(null!==c.bone)for(var d=0,p=this.getSlots();d<p.length;d++){var m,f;(m=p[d]).parent===c.bone&&null!==(f=m.childArmature)&&f.animation.fadeIn(u.name)}else this._animation.fadeIn(u.name);c.returnToPool()}this._actions.length=0}this._lockUpdate=!1,this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},Armature.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(s=this.getBone(t))&&(s.invalidUpdate(),e))for(var i=0,a=this._slots;i<a.length;i++)(l=a[i]).parent===s&&l.invalidUpdate()}else{for(var r=0,n=this._bones;r<n.length;r++){var s;(s=n[r]).invalidUpdate()}if(e)for(var o=0,h=this._slots;o<h.length;o++){var l;(l=h[o]).invalidUpdate()}}},Armature.prototype.containsPoint=function(t,e){for(var i=0,a=this._slots;i<a.length;i++){var r=a[i];if(r.containsPoint(t,e))return r}return null},Armature.prototype.intersectsSegment=function(t,e,i,a,r,n,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null);for(var o=t===i,h=0,l=0,c=0,u=0,d=0,p=0,m=0,f=0,g=null,y=null,_=0,v=this._slots;_<v.length;_++){var b=v[_];if(b.intersectsSegment(t,e,i,a,r,n,s)>0){if(null===r&&null===n){g=b;break}var P;null!==r&&((P=o?r.y-e:r.x-t)<0&&(P=-P),(null===g||P<h)&&(h=P,c=r.x,u=r.y,g=b,s&&(m=s.x))),null!==n&&((P=n.x-t)<0&&(P=-P),(null===y||P>l)&&(l=P,d=n.x,p=n.y,y=b,null!==s&&(f=s.y)))}}return null!==g&&null!==r&&(r.x=c,r.y=u,null!==s&&(s.x=m)),null!==y&&null!==n&&(n.x=d,n.y=p,null!==s&&(s.y=f)),g},Armature.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var a=i[e];if(a.name===t)return a}return null},Armature.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},Armature.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var a=i[e];if(a.name===t)return a}return null},Armature.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var a=i[e];if(a.display===t)return a}return null},Armature.prototype.getBones=function(){return this._bones},Armature.prototype.getSlots=function(){return this._slots},Object.defineProperty(Armature.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var a=i[e].childArmature;null!==a&&(a.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var a=i[e];a.invalidUpdate(),a.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var a=i[e].childArmature;null!==a&&(a.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(Armature.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Armature.prototype.getDisplay=function(){return this._display},Armature}(n.BaseObject),n.Armature=s,function(t){var e=function(e){function TransformObject(){var i=null!==e&&e.apply(this,arguments)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return r(TransformObject,e),TransformObject.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._alpha=1,this._globalAlpha=1,this._armature=null},TransformObject.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(TransformObject.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),TransformObject._helpMatrix=new t.Matrix,TransformObject._helpTransform=new t.Transform,TransformObject._helpPoint=new t.Point,TransformObject}(t.BaseObject);t.TransformObject=e}(l||(l={})),function(t){var e=function(e){function Bone(){var i=null!==e&&e.apply(this,arguments)||this;return i.animationPose=new t.Transform,i}return r(Bone,e),Bone.toString=function(){return"[class dragonBones.Bone]"},Bone.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._boneData=null,this._parent=null,this._cachedFrameIndices=null},Bone.prototype._updateGlobalTransformMatrix=function(e){var i=this._boneData,a=this.global,r=this.globalTransformMatrix,n=this.origin,s=this.offset,o=this.animationPose,h=this._parent,l=this._armature.flipX,c=this._armature.flipY===t.DragonBones.yDown,u=null!==h,d=0;if(1===this.offsetMode?null!==n?(a.x=n.x+s.x+o.x,a.scaleX=n.scaleX*s.scaleX*o.scaleX,a.scaleY=n.scaleY*s.scaleY*o.scaleY,t.DragonBones.yDown?(a.y=n.y+s.y+o.y,a.skew=n.skew+s.skew+o.skew,a.rotation=n.rotation+s.rotation+o.rotation):(a.y=n.y-s.y+o.y,a.skew=n.skew-s.skew+o.skew,a.rotation=n.rotation-s.rotation+o.rotation)):(a.copyFrom(s),t.DragonBones.yDown||(a.y=-a.y,a.skew=-a.skew,a.rotation=-a.rotation),a.add(o)):0===this.offsetMode?null!==n?a.copyFrom(n).add(o):a.copyFrom(o):(u=!1,a.copyFrom(s),t.DragonBones.yDown||(a.y=-a.y,a.skew=-a.skew,a.rotation=-a.rotation)),u){var p=1===h._boneData.type,m=p?h._bone:null,f=p?h._getGlobalTransformMatrix(a.x,a.y):h.globalTransformMatrix;if(!i.inheritScale||p&&null===m){if(i.inheritTranslation){var g=a.x,y=a.y;a.x=f.a*g+f.c*y+f.tx,a.y=f.b*g+f.d*y+f.ty}else l&&(a.x=-a.x),c&&(a.y=-a.y);i.inheritRotation?(h.updateGlobalTransform(),d=h.global.scaleX<0?a.rotation+h.global.rotation+Math.PI:a.rotation+h.global.rotation,f.a*f.d-f.b*f.c<0&&(d-=2*a.rotation,(l!==c||i.inheritReflection)&&(a.skew+=Math.PI),t.DragonBones.yDown||(a.skew=-a.skew)),a.rotation=d):(l||c)&&(l&&c?d=a.rotation+Math.PI:(d=l?Math.PI-a.rotation:-a.rotation,a.skew+=Math.PI),a.rotation=d),a.toMatrix(r)}else p?(i.inheritRotation&&(a.rotation+=h.global.rotation),m.updateGlobalTransform(),a.scaleX*=m.global.scaleX,a.scaleY*=m.global.scaleY,f.transformPoint(a.x,a.y,a),a.toMatrix(r),i.inheritTranslation?(a.x=r.tx,a.y=r.ty):(r.tx=a.x,r.ty=a.y)):(i.inheritRotation||(h.updateGlobalTransform(),d=l&&c?a.rotation-(h.global.rotation+Math.PI):l?a.rotation+h.global.rotation+Math.PI:c?a.rotation+h.global.rotation:a.rotation-h.global.rotation,a.rotation=d),a.toMatrix(r),r.concat(f),i.inheritTranslation?(a.x=r.tx,a.y=r.ty):(r.tx=a.x,r.ty=a.y),e?a.fromMatrix(r):this._globalDirty=!0)}else(l||c)&&(l&&(a.x=-a.x),c&&(a.y=-a.y),l&&c?d=a.rotation+Math.PI:(d=l?Math.PI-a.rotation:-a.rotation,a.skew+=Math.PI),a.rotation=d),a.toMatrix(r)},Bone.prototype._updateAlpha=function(){null!==this._parent?this._globalAlpha=this._alpha*this._parent._globalAlpha:this._globalAlpha=this._alpha*this._armature._globalAlpha},Bone.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,this._alpha=this._boneData.alpha,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},Bone.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,a=this._armature._constraints;i<a.length;i++){(s=a[i])._root===this&&s.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,n=this._armature._constraints;r<n.length;r++){var s;(s=n[r])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var o=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(o),o&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},Bone.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},Bone.prototype.invalidUpdate=function(){this._transformDirty=!0},Bone.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(Bone.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var a=i[e];a.parent===this&&a._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Bone.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Bone}(t.TransformObject);t.Bone=e}(l||(l={})),function(t){var e=function(t){function Surface(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return r(Surface,t),Surface.toString=function(){return"[class dragonBones.Surface]"},Surface.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0,this._bone=null},Surface.prototype._getAffineTransform=function(t,e,i,a,r,n,s,o,h,l,c,u,d){var p=s-r,m=o-n,f=h-r,g=l-n;c.rotation=Math.atan2(m,p),c.skew=Math.atan2(g,f)-.5*Math.PI-c.rotation,d&&(c.rotation+=Math.PI),c.scaleX=Math.sqrt(p*p+m*m)/i,c.scaleY=Math.sqrt(f*f+g*g)/a,c.toMatrix(u),c.x=u.tx=r-(u.a*t+u.c*e),c.y=u.ty=n-(u.b*t+u.d*e)},Surface.prototype._updateVertices=function(){var t=this._armature.armatureData.parent,e=this._boneData.geometry,i=t.intArray,a=t.floatArray,r=i[e.offset+0],n=i[e.offset+2],s=this._vertices,o=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var h=0,l=r;h<l;++h){var c=a[n+(m=2*h)]+o[m],u=a[n+m+1]+o[m+1],d=this._parent._getGlobalTransformMatrix(c,u);s[m]=d.a*c+d.c*u+d.tx,s[m+1]=d.b*c+d.d*u+d.ty}else{var p=this._parent.globalTransformMatrix;for(h=0,l=r;h<l;++h){c=a[n+(m=2*h)]+o[m],u=a[n+m+1]+o[m+1];s[m]=p.a*c+p.c*u+p.tx,s[m+1]=p.b*c+p.d*u+p.ty}}else for(h=0,l=r;h<l;++h){var m;s[m=2*h]=a[n+m]+o[m],s[m+1]=a[n+m+1]+o[m+1]}},Surface.prototype._updateGlobalTransformMatrix=function(t){var e=2*this._boneData.segmentX,i=this._vertices.length-2,a=this._vertices[0],r=this._vertices[1],n=this._vertices[e],s=this._vertices[e+1],o=this._vertices[i],h=this._vertices[i+1],l=this._vertices[i-e],c=this._vertices[i-e+1],u=a+.5*(o-a),d=r+.5*(h-r),p=u+.5*(n+.5*(l-n)-u),m=d+.5*(s+.5*(c-s)-d),f=n+.5*(o-n),g=s+.5*(h-s),y=l+.5*(o-l),_=c+.5*(h-c);this._getAffineTransform(0,0,200,200,p,m,f,g,y,_,this.global,this.globalTransformMatrix,!1),this._globalDirty=!1},Surface.prototype._getGlobalTransformMatrix=function(t,e){var i=200,a=1e3;if(t<-a||a<t||e<-a||a<e)return this.globalTransformMatrix;var r=!1,n=this._boneData,s=n.segmentX,o=n.segmentY,h=2*n.segmentX,l=this._dX,c=this._dY,u=Math.floor((t+i)/l),d=Math.floor((e+i)/c),p=0,m=u*l-i,f=d*c-i,g=this._matrixCahce,y=Surface._helpMatrix;if(t<-i){if(e<-i||e>=i)return this.globalTransformMatrix;if(g[p=7*(2*(s*o+s+o+o+d)+((r=e>this._kX*(t+i)+f)?1:0))]>0)y.copyFromArray(g,p+1);else{var _=d*(h+2),v=this._hullCache[4],b=this._hullCache[5],P=this._hullCache[2]-(o-d)*v,S=this._hullCache[3]-(o-d)*b,D=this._vertices;r?this._getAffineTransform(-i,f+c,800,c,D[_+h+2],D[_+h+3],P+v,S+b,D[_],D[_+1],Surface._helpTransform,y,!0):this._getAffineTransform(-a,f,800,c,P,S,D[_],D[_+1],P+v,S+b,Surface._helpTransform,y,!1),g[p]=1,g[p+1]=y.a,g[p+2]=y.b,g[p+3]=y.c,g[p+4]=y.d,g[p+5]=y.tx,g[p+6]=y.ty}}else if(t>=i){if(e<-i||e>=i)return this.globalTransformMatrix;if(g[p=7*(2*(s*o+s+d)+((r=e>this._kX*(t-a)+f)?1:0))]>0)y.copyFromArray(g,p+1);else{_=(d+1)*(h+2)-2,v=this._hullCache[4],b=this._hullCache[5],P=this._hullCache[0]+d*v,S=this._hullCache[1]+d*b,D=this._vertices;r?this._getAffineTransform(a,f+c,800,c,P+v,S+b,D[_+h+2],D[_+h+3],P,S,Surface._helpTransform,y,!0):this._getAffineTransform(i,f,800,c,D[_],D[_+1],P,S,D[_+h+2],D[_+h+3],Surface._helpTransform,y,!1),g[p]=1,g[p+1]=y.a,g[p+2]=y.b,g[p+3]=y.c,g[p+4]=y.d,g[p+5]=y.tx,g[p+6]=y.ty}}else if(e<-i){if(t<-i||t>=i)return this.globalTransformMatrix;if(g[p=7*(2*(s*o+u)+((r=e>this._kY*(t-m-l)-a)?1:0))]>0)y.copyFromArray(g,p+1);else{_=2*u,v=this._hullCache[10],b=this._hullCache[11],P=this._hullCache[8]+u*v,S=this._hullCache[9]+u*b,D=this._vertices;r?this._getAffineTransform(m+l,-i,l,800,D[_+2],D[_+3],D[_],D[_+1],P+v,S+b,Surface._helpTransform,y,!0):this._getAffineTransform(m,-a,l,800,P,S,P+v,S+b,D[_],D[_+1],Surface._helpTransform,y,!1),g[p]=1,g[p+1]=y.a,g[p+2]=y.b,g[p+3]=y.c,g[p+4]=y.d,g[p+5]=y.tx,g[p+6]=y.ty}}else if(e>=i){if(t<-i||t>=i)return this.globalTransformMatrix;if(g[p=7*(2*(s*o+s+o+u)+((r=e>this._kY*(t-m-l)+i)?1:0))]>0)y.copyFromArray(g,p+1);else{_=o*(h+2)+2*u,v=this._hullCache[10],b=this._hullCache[11],P=this._hullCache[6]-(s-u)*v,S=this._hullCache[7]-(s-u)*b,D=this._vertices;r?this._getAffineTransform(m+l,a,l,800,P+v,S+b,P,S,D[_+2],D[_+3],Surface._helpTransform,y,!0):this._getAffineTransform(m,i,l,800,D[_],D[_+1],D[_+2],D[_+3],P,S,Surface._helpTransform,y,!1),g[p]=1,g[p+1]=y.a,g[p+2]=y.b,g[p+3]=y.c,g[p+4]=y.d,g[p+5]=y.tx,g[p+6]=y.ty}}else if(g[p=7*(2*(s*d+u)+((r=e>this._k*(t-m-l)+f)?1:0))]>0)y.copyFromArray(g,p+1);else{_=2*u+d*(h+2),D=this._vertices;r?this._getAffineTransform(m+l,f+c,l,c,D[_+h+4],D[_+h+5],D[_+h+2],D[_+h+3],D[_+2],D[_+3],Surface._helpTransform,y,!0):this._getAffineTransform(m,f,l,c,D[_],D[_+1],D[_+2],D[_+3],D[_+h+2],D[_+h+3],Surface._helpTransform,y,!1),g[p]=1,g[p+1]=y.a,g[p+2]=y.b,g[p+3]=y.c,g[p+4]=y.d,g[p+5]=y.tx,g[p+6]=y.ty}return y},Surface.prototype.init=function(e,i){if(null===this._boneData){t.prototype.init.call(this,e,i);var a=e.segmentX,r=e.segmentY,n=this._armature.armatureData.parent.intArray[e.geometry.offset+0];this._dX=400/a,this._dY=400/r,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=2*n,this._deformVertices.length=2*n,this._matrixCahce.length=2*(a*r+2*a+2*r)*7,this._hullCache.length=10;for(var s=0;s<2*n;++s)this._deformVertices[s]=0;null!==this._parent&&(0===this._parent.boneData.type?this._bone=this._parent:this._bone=this._parent._bone)}},Surface.prototype.update=function(t){if(t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var i=0,a=this._armature._constraints;i<a.length;i++){(s=a[i])._root===this&&s.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,n=this._armature._constraints;r<n.length;r++){var s;(s=n[r])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var o=0,h=this._matrixCahce.length;o<h;o+=7)this._matrixCahce[o]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var l=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(l),l&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var c=2*this.global.x,u=2*this.global.y,d=Surface._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,d),this._hullCache[0]=d.x,this._hullCache[1]=d.y,this._hullCache[2]=c-d.x,this._hullCache[3]=u-d.y,this.globalTransformMatrix.transformPoint(0,this._dY,d,!0),this._hullCache[4]=d.x,this._hullCache[5]=d.y,this.globalTransformMatrix.transformPoint(200,1e3,d),this._hullCache[6]=d.x,this._hullCache[7]=d.y,this._hullCache[8]=c-d.x,this._hullCache[9]=u-d.y,this.globalTransformMatrix.transformPoint(this._dX,0,d,!0),this._hullCache[10]=d.x,this._hullCache[11]=d.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},Surface}(t.Bone);t.Surface=e}(l||(l={})),function(t){var e=function(t){function DisplayFrame(){var e=null!==t&&t.apply(this,arguments)||this;return e.deformVertices=[],e}return r(DisplayFrame,t),DisplayFrame.toString=function(){return"[class dragonBones.DisplayFrame]"},DisplayFrame.prototype._onClear=function(){this.rawDisplayData=null,this.displayData=null,this.textureData=null,this.display=null,this.deformVertices.length=0},DisplayFrame.prototype.updateDeformVertices=function(){if(null!==this.rawDisplayData&&0===this.deformVertices.length){var t;if(2===this.rawDisplayData.type)t=this.rawDisplayData.geometry;else{if(4!==this.rawDisplayData.type)return;t=this.rawDisplayData.geometry}var e=0;e=null!==t.weight?2*t.weight.count:2*t.data.intArray[t.offset+0],this.deformVertices.length=e;for(var i=0,a=this.deformVertices.length;i<a;++i)this.deformVertices[i]=0}},DisplayFrame.prototype.getGeometryData=function(){if(null!==this.displayData){if(2===this.displayData.type)return this.displayData.geometry;if(4===this.displayData.type)return this.displayData.geometry}if(null!==this.rawDisplayData){if(2===this.rawDisplayData.type)return this.rawDisplayData.geometry;if(4===this.rawDisplayData.type)return this.rawDisplayData.geometry}return null},DisplayFrame.prototype.getBoundingBox=function(){return null!==this.displayData&&3===this.displayData.type?this.displayData.boundingBox:null!==this.rawDisplayData&&3===this.rawDisplayData.type?this.rawDisplayData.boundingBox:null},DisplayFrame.prototype.getTextureData=function(){if(null!==this.displayData){if(0===this.displayData.type)return this.displayData.texture;if(2===this.displayData.type)return this.displayData.texture}if(null!==this.textureData)return this.textureData;if(null!==this.rawDisplayData){if(0===this.rawDisplayData.type)return this.rawDisplayData.texture;if(2===this.rawDisplayData.type)return this.rawDisplayData.texture}return null},DisplayFrame}(t.BaseObject);t.DisplayFrame=e;var i=function(i){function Slot(){var e=null!==i&&i.apply(this,arguments)||this;return e._localMatrix=new t.Matrix,e._colorTransform=new t.ColorTransform,e._displayFrames=[],e._geometryBones=[],e._rawDisplay=null,e._meshDisplay=null,e._display=null,e}return r(Slot,i),Slot.prototype._onClear=function(){i.prototype._onClear.call(this);for(var e=[],a=0,r=this._displayFrames;a<r.length;a++){var n=r[a],s=n.display;s!==this._rawDisplay&&s!==this._meshDisplay&&e.indexOf(s)<0&&e.push(s),n.returnToPool()}for(var o=0,h=e;o<h.length;o++){var l=h[o];l instanceof t.Armature?l.dispose():this._disposeDisplay(l,!0)}null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDataDirty=!1,this._displayDirty=!1,this._geometryDirty=!1,this._textureDirty=!1,this._visibleDirty=!1,this._blendModeDirty=!1,this._zOrderDirty=!1,this._colorDirty=!1,this._verticesDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._zIndex=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayFrames.length=0,this._geometryBones.length=0,this._slotData=null,this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},Slot.prototype._hasDisplay=function(t){for(var e=0,i=this._displayFrames;e<i.length;e++){if(i[e].display===t)return!0}return!1},Slot.prototype._isBonesUpdate=function(){for(var t=0,e=this._geometryBones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},Slot.prototype._updateAlpha=function(){var t=this._alpha*this._parent._globalAlpha;this._globalAlpha!==t&&(this._globalAlpha=t,this._colorDirty=!0)},Slot.prototype._updateDisplayData=function(){var e=this._displayFrame,i=this._geometryData,a=this._textureData,r=null,n=null;if(this._displayFrame=null,this._geometryData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&this._displayIndex<this._displayFrames.length&&(this._displayFrame=this._displayFrames[this._displayIndex],r=this._displayFrame.rawDisplayData,n=this._displayFrame.displayData,this._geometryData=this._displayFrame.getGeometryData(),this._boundingBoxData=this._displayFrame.getBoundingBox(),this._textureData=this._displayFrame.getTextureData()),this._displayFrame!==e||this._geometryData!==i||this._textureData!==a){if(null===this._geometryData&&null!==this._textureData){var s=null!==n&&0===n.type?n:r,o=this._textureData.parent.scale*this._armature._armatureData.scale,h=this._textureData.frame;this._pivotX=s.pivot.x,this._pivotY=s.pivot.y;var l=null!==h?h:this._textureData.region,c=l.width,u=l.height;this._textureData.rotated&&null===h&&(c=l.height,u=l.width),this._pivotX*=c*o,this._pivotY*=u*o,null!==h&&(this._pivotX+=h.x*o,this._pivotY+=h.y*o),null!==r&&s!==r&&(r.transform.toMatrix(Slot._helpMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(0,0,Slot._helpPoint),this._pivotX-=Slot._helpPoint.x,this._pivotY-=Slot._helpPoint.y,s.transform.toMatrix(Slot._helpMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(0,0,Slot._helpPoint),this._pivotX+=Slot._helpPoint.x,this._pivotY+=Slot._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*o-this._pivotY)}else this._pivotX=0,this._pivotY=0;if(this.origin=null!==r?r.transform:null!==n?n.transform:null,null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix),this._geometryData!==i)if(this._geometryDirty=!0,this._verticesDirty=!0,null!==this._geometryData){if(this._geometryBones.length=0,null!==this._geometryData.weight)for(var d=0,p=this._geometryData.weight.bones.length;d<p;++d){var m=this._armature.getBone(this._geometryData.weight.bones[d].name);this._geometryBones.push(m)}}else this._geometryBones.length=0,this._geometryData=null;this._textureDirty=this._textureData!==a,this._transformDirty=!0}},Slot.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,i=this._childArmature;if(null!==this._displayFrame?(this._display=this._displayFrame.display,null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null),(null!==this._display?this._display:this._rawDisplay)!==e&&(this._textureDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._transformDirty=!0,this._onUpdateDisplay(),this._replaceDisplay(e)),this._childArmature!==i&&(null!==i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var a=this._armature.cacheFrameRate;0!==a&&(this._childArmature.cacheFrameRate=a)}if(null!==this._displayFrame){var r=null,n=null!==this._displayFrame.displayData?this._displayFrame.displayData:this._displayFrame.rawDisplayData;if(null!==n&&1===n.type&&(r=n.actions),null!==r&&r.length>0)for(var s=0,o=r;s<o.length;s++){var h=o[s],l=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(h,l,this._armature),l.slot=this,this._armature._bufferAction(l,!1)}else this._childArmature.animation.play()}}},Slot.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},Slot.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return;this._animationDisplayIndex=t}this._displayIndex!==t&&(this._displayIndex=t<this._displayFrames.length?t:this._displayFrames.length-1,this._displayDataDirty=!0,this._displayDirty=this._displayIndex<0||this._display!==this._displayFrames[this._displayIndex].display)},Slot.prototype._setZOrder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},Slot.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0},Slot.prototype.init=function(t,e,i,a){if(null===this._slotData){this._slotData=t,this._colorDirty=!0,this._blendModeDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._zIndex=this._slotData.zIndex,this._alpha=this._slotData.alpha,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=i,this._meshDisplay=a,this._armature=e;var r=this._armature.getBone(this._slotData.parent.name);null!==r&&(this._parent=r),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},Slot.prototype.update=function(t){if(this._displayDataDirty&&(this._updateDisplayData(),this._displayDataDirty=!1),this._displayDirty&&(this._updateDisplay(),this._displayDirty=!1),(this._geometryDirty||this._textureDirty)&&(null!==this._display&&this._display!==this._rawDisplay&&this._display!==this._meshDisplay||this._updateFrame(),this._geometryDirty=!1,this._textureDirty=!1),null!==this._display){if(this._visibleDirty&&(this._updateVisible(),this._visibleDirty=!1),this._blendModeDirty&&(this._updateBlendMode(),this._blendModeDirty=!1),this._colorDirty&&(this._updateColor(),this._colorDirty=!1),this._zOrderDirty&&(this._updateZOrder(),this._zOrderDirty=!1),null!==this._geometryData&&this._display===this._meshDisplay){var e=null!==this._geometryData.weight,i=0!==this._parent._boneData.type;if((this._verticesDirty||e&&this._isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._verticesDirty=!1,this._updateMesh()),e||i)return}if(t>=0&&null!==this._cachedFrameIndices){var a=this._cachedFrameIndices[t];a>=0&&this._cachedFrameIndex===a?this._transformDirty=!1:a>=0?(this._transformDirty=!0,this._cachedFrameIndex=a):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(this._transformDirty){if(this._cachedFrameIndex<0){var r=t>=0;this._updateGlobalTransformMatrix(r),r&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform(),this._transformDirty=!1}}},Slot.prototype.invalidUpdate=function(){this._displayDataDirty=!0,this._displayDirty=!0,this._transformDirty=!0},Slot.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._updateGlobalTransformMatrix(!1),this._transformDirty=!1)},Slot.prototype.replaceRawDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];if(i.rawDisplayData!==t){if(i.deformVertices.length=0,i.rawDisplayData=t,null===i.rawDisplayData){var a=this._armature._armatureData.defaultSkin;if(null!==a){var r=a.getDisplays(this._slotData.name);null!==r&&e<r.length&&(i.rawDisplayData=r[e])}}e===this._displayIndex&&(this._displayDataDirty=!0)}},Slot.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.displayData!==t&&i.rawDisplayData!==t&&(i.displayData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},Slot.prototype.replaceTextureData=function(t,e){if(void 0===e&&(e=-1),e<0)e=this._displayIndex<0?0:this._displayIndex;else if(e>=this._displayFrames.length)return;var i=this._displayFrames[e];i.textureData!==t&&(i.textureData=t,e===this._displayIndex&&(this._displayDataDirty=!0))},Slot.prototype.replaceDisplay=function(e,i){if(void 0===i&&(i=-1),i<0)i=this._displayIndex<0?0:this._displayIndex;else if(i>=this._displayFrames.length)return;var a=this._displayFrames[i];if(a.display!==e){var r=a.display;a.display=e,null===r||r===this._rawDisplay||r===this._meshDisplay||this._hasDisplay(r)||r instanceof t.Armature||this._disposeDisplay(r,!0),null===e||e===this._rawDisplay||e===this._meshDisplay||this._hasDisplay(r)||e instanceof t.Armature||this._initDisplay(e,!0),i===this._displayIndex&&(this._displayDirty=!0)}},Slot.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),Slot._helpMatrix.copyFrom(this.globalTransformMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(t,e,Slot._helpPoint),this._boundingBoxData.containsPoint(Slot._helpPoint.x,Slot._helpPoint.y))},Slot.prototype.intersectsSegment=function(t,e,i,a,r,n,s){if(void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),Slot._helpMatrix.copyFrom(this.globalTransformMatrix),Slot._helpMatrix.invert(),Slot._helpMatrix.transformPoint(t,e,Slot._helpPoint),t=Slot._helpPoint.x,e=Slot._helpPoint.y,Slot._helpMatrix.transformPoint(i,a,Slot._helpPoint),i=Slot._helpPoint.x,a=Slot._helpPoint.y;var o=this._boundingBoxData.intersectsSegment(t,e,i,a,r,n,s);return o>0&&(1===o||2===o?null!==r?(this.globalTransformMatrix.transformPoint(r.x,r.y,r),null!==n&&(n.x=r.x,n.y=r.y)):null!==n&&this.globalTransformMatrix.transformPoint(n.x,n.y,n):(null!==r&&this.globalTransformMatrix.transformPoint(r.x,r.y,r),null!==n&&this.globalTransformMatrix.transformPoint(n.x,n.y,n)),null!==s&&(this.globalTransformMatrix.transformPoint(Math.cos(s.x),Math.sin(s.x),Slot._helpPoint,!0),s.x=Math.atan2(Slot._helpPoint.y,Slot._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(s.y),Math.sin(s.y),Slot._helpPoint,!0),s.y=Math.atan2(Slot._helpPoint.y,Slot._helpPoint.x))),o},Slot.prototype.getDisplayFrameAt=function(t){return this._displayFrames[t]},Object.defineProperty(Slot.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayFrameCount",{get:function(){return this._displayFrames.length},set:function(i){var a=this._displayFrames.length;if(a<i){this._displayFrames.length=i;for(var r=a;r<i;++r)this._displayFrames[r]=t.BaseObject.borrowObject(e)}else if(a>i){for(r=a-1;r<i;--r)this.replaceDisplay(null,r),this._displayFrames[r].returnToPool();this._displayFrames.length=i}},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t),this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"displayList",{get:function(){for(var t=new Array,e=0,i=this._displayFrames;e<i.length;e++){var a=i[e];t.push(a.display)}return t},set:function(t){this.displayFrameCount=t.length;for(var e=0,i=0,a=t;i<a.length;i++){var r=a[i];this.replaceDisplay(r,e++)}},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"display",{get:function(){return this._display},set:function(t){this._display!==t&&(0===this._displayFrames.length&&(this.displayFrameCount=1,this._displayIndex=0),this.replaceDisplay(t,this._displayIndex))},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(Slot.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Slot.prototype.getDisplay=function(){return this._display},Slot.prototype.setDisplay=function(t){this.display=t},Slot}(t.TransformObject);t.Slot=i}(l||(l={})),function(t){var e=function(e){function Constraint(){return null!==e&&e.apply(this,arguments)||this}return r(Constraint,e),Constraint.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(Constraint.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),Constraint._helpMatrix=new t.Matrix,Constraint._helpTransform=new t.Transform,Constraint._helpPoint=new t.Point,Constraint}(t.BaseObject);t.Constraint=e;var i=function(e){function IKConstraint(){return null!==e&&e.apply(this,arguments)||this}return r(IKConstraint,e),IKConstraint.toString=function(){return"[class dragonBones.IKConstraint]"},IKConstraint.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},IKConstraint.prototype._computeA=function(){var e=this._target.global,i=this._root.global,a=this._root.globalTransformMatrix,r=Math.atan2(e.y-i.y,e.x-i.x);i.scaleX<0&&(r+=Math.PI),i.rotation+=t.Transform.normalizeRadian(r-i.rotation)*this._weight,i.toMatrix(a)},IKConstraint.prototype._computeB=function(){var e=this._bone._boneData.length,i=this._root,a=this._target.global,r=i.global,n=this._bone.global,s=this._bone.globalTransformMatrix,o=s.a*e,h=s.b*e,l=o*o+h*h,c=Math.sqrt(l),u=n.x-r.x,d=n.y-r.y,p=u*u+d*d,m=Math.sqrt(p),f=n.rotation,g=r.rotation,y=Math.atan2(d,u),_=(u=a.x-r.x)*u+(d=a.y-r.y)*d,v=Math.sqrt(_),b=0;if(c+m<=v||v+c<=m||v+m<=c)b=Math.atan2(a.y-r.y,a.x-r.x),c+m<=v||m<c&&(b+=Math.PI);else{var P=(p-l+_)/(2*_),S=Math.sqrt(p-P*P*_)/v,D=r.x+u*P,T=r.y+d*P,x=-d*S,C=u*S,O=!1,M=i.parent;if(null!==M){var w=M.globalTransformMatrix;O=w.a*w.d-w.b*w.c<0}O!==this._bendPositive?(n.x=D-x,n.y=T-C):(n.x=D+x,n.y=T+C),b=Math.atan2(n.y-r.y,n.x-r.x)}var A=t.Transform.normalizeRadian(b-y);r.rotation=g+A*this._weight,r.toMatrix(i.globalTransformMatrix);var E=y+A*this._weight;n.x=r.x+Math.cos(E)*m,n.y=r.y+Math.sin(E)*m;var B=Math.atan2(a.y-n.y,a.x-n.x);n.scaleX<0&&(B+=Math.PI),n.rotation=r.rotation+f-g+t.Transform.normalizeRadian(B-A-f)*this._weight,n.toMatrix(s)},IKConstraint.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var i=this._constraintData;this._scaleEnabled=i.scaleEnabled,this._bendPositive=i.bendPositive,this._weight=i.weight,this._root._hasConstraint=!0}},IKConstraint.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},IKConstraint.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},IKConstraint}(e);t.IKConstraint=i;var a=function(e){function PathConstraint(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return r(PathConstraint,e),PathConstraint.toString=function(){return"[class dragonBones.PathConstraint]"},PathConstraint.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},PathConstraint.prototype._updatePathVertices=function(t){var e=this._armature,i=e.armatureData.parent,a=e.armatureData.scale,r=i.intArray,n=i.floatArray,s=t.offset,o=r[s+0],h=r[s+2];this._pathGlobalVertices.length=2*o;var l=t.weight;if(null!==l)for(var c=this._pathSlot._geometryBones,u=l.bones.length,d=l.offset,p=r[d+1],m=d+2+u,f=(T=0,0);T<o;T++){for(var g=0,y=0,_=0,v=r[m++];_<v;_++){var b=c[r[m++]];if(null!==b){b.updateByConstraint();D=b.globalTransformMatrix;var P=n[p++];C=n[p++]*a,O=n[p++]*a;g+=(D.a*C+D.c*O+D.tx)*P,y+=(D.b*C+D.d*O+D.ty)*P}}this._pathGlobalVertices[f++]=g,this._pathGlobalVertices[f++]=y}else{var S=this._pathSlot.parent;S.updateByConstraint();for(var D=S.globalTransformMatrix,T=0,x=h;T<o;T+=2){var C=n[x++]*a,O=n[x++]*a,M=D.a*C+D.c*O+D.tx,w=D.b*C+D.d*O+D.ty;this._pathGlobalVertices[T]=M,this._pathGlobalVertices[T+1]=w}}},PathConstraint.prototype._computeVertices=function(t,e,i,a){for(var r=i,n=t;r<e;r+=2)a[r]=this._pathGlobalVertices[n++],a[r+1]=this._pathGlobalVertices[n++]},PathConstraint.prototype._computeBezierCurve=function(t,e,i,a,r){var n=this._armature.armatureData.parent.intArray[t.geometry.offset+0],s=this._positions,o=this._spaces,h=t.closed,l=Array(),c=2*n,u=c/6,d=-1,p=this.position;s.length=3*e+2;var m=0;if(t.constantSpeed){h?(c+=2,l.length=n,this._computeVertices(2,c-4,0,l),this._computeVertices(0,2,c-4,l),l[c-2]=l[0],l[c-1]=l[1]):(u--,c-=4,l.length=c,this._computeVertices(2,c,0,l));var f=new Array(u);m=0;for(var g,y,_,v,b,P,S,D,T=l[0],x=l[1],C=0,O=0,M=0,w=0,A=0,E=0,B=(H=0,2);H<u;H++,B+=6)C=l[B],O=l[B+1],M=l[B+2],w=l[B+3],b=2*(g=.1875*(T-2*C+M))+(_=.09375*(3*(C-M)-T+(A=l[B+4]))),P=2*(y=.1875*(x-2*O+w))+(v=.09375*(3*(O-w)-x+(E=l[B+5]))),S=.75*(C-T)+g+.16666667*_,D=.75*(O-x)+y+.16666667*v,m+=Math.sqrt(S*S+D*D),S+=b,D+=P,b+=_,P+=v,m+=Math.sqrt(S*S+D*D),S+=b,D+=P,m+=Math.sqrt(S*S+D*D),S+=b+_,D+=P+v,m+=Math.sqrt(S*S+D*D),f[H]=m,T=A,x=E;if(a&&(p*=m),r)for(H=0;H<e;H++)o[H]*=m;for(var I=this._segments,k=0,R=(H=0,W=0,z=0,0);H<e;H++,W+=3){var j=p+=o[H];if(h)(j%=m)<0&&(j+=m),z=0;else{if(j<0)continue;if(j>m)continue}for(;;z++){var L=f[z];if(!(j>L)){if(0===z)j/=L;else j=(j-(U=f[z-1]))/(L-U);break}}if(z!==d){d=z;var F=6*z;for(T=l[F],x=l[F+1],C=l[F+2],O=l[F+3],M=l[F+4],w=l[F+5],b=2*(g=.03*(T-2*C+M))+(_=.006*(3*(C-M)-T+(A=l[F+6]))),P=2*(y=.03*(x-2*O+w))+(v=.006*(3*(O-w)-x+(E=l[F+7]))),S=.3*(C-T)+g+.16666667*_,D=.3*(O-x)+y+.16666667*v,k=Math.sqrt(S*S+D*D),I[0]=k,F=1;F<8;F++)S+=b,D+=P,b+=_,P+=v,k+=Math.sqrt(S*S+D*D),I[F]=k;S+=b,D+=P,k+=Math.sqrt(S*S+D*D),I[8]=k,S+=b+_,D+=P+v,k+=Math.sqrt(S*S+D*D),I[9]=k,R=0}for(j*=k;;R++){var N=I[R];if(!(j>N)){var U;if(0===R)j/=N;else j=R+(j-(U=I[R-1]))/(N-U);break}}this.addCurvePosition(.1*j,T,x,C,O,M,w,A,E,s,W,i)}}else{var V=t.curveLengths;if(m=V[u-=h?1:2],a&&(p*=m),r)for(var H=0;H<e;H++)o[H]*=m;l.length=8;for(var H=0,W=0,z=0;H<e;H++,W+=3){if(p+=o[H],h)(p%=m)<0&&(p+=m),z=0;else{if(p<0)continue;if(p>m)continue}for(var Y=0;;z++){var G=V[z];if(!(p>G)){if(0===z)Y=p/G;else{var X=V[z-1];Y=(p-X)/(G-X)}break}}z!==d&&(d=z,h&&z===u?(this._computeVertices(c-4,4,0,l),this._computeVertices(0,4,4,l)):this._computeVertices(6*z+2,8,0,l)),this.addCurvePosition(Y,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],s,W,i)}}},PathConstraint.prototype.addCurvePosition=function(t,e,i,a,r,n,s,o,h,l,c,u){if(0===t)return l[c]=e,l[c+1]=i,void(l[c+2]=0);if(1===t)return l[c]=o,l[c+1]=h,void(l[c+2]=0);var d=1-t,p=d*d,m=t*t,f=p*d,g=p*t*3,y=d*m*3,_=t*m,v=f*e+g*a+y*n+_*o,b=f*i+g*r+y*s+_*h;l[c]=v,l[c+1]=b,l[c+2]=u?Math.atan2(b-(f*i+g*r+y*s),v-(f*e+g*a+y*n)):0},PathConstraint.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var i=t;this.pathOffset=i.pathDisplayData.geometry.offset,this.position=i.position,this.spacing=i.spacing,this.rotateOffset=i.rotateOffset,this.rotateMix=i.rotateMix,this.translateMix=i.translateMix,this._root=this._armature.getBone(i.root.name),this._target=this._armature.getBone(i.target.name),this._pathSlot=this._armature.getSlot(i.pathSlot.name);for(var a=0,r=i.bones.length;a<r;a++){var n=this._armature.getBone(i.bones[a].name);null!==n&&this._bones.push(n)}2===i.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},PathConstraint.prototype.update=function(){var e=this._pathSlot;if(null!==e._geometryData&&e._geometryData.offset===this.pathOffset){var i=this._constraintData,a=!1;if(this._root._childrenTransformDirty?(this._updatePathVertices(e._geometryData),a=!0):(e._verticesDirty||e._isBonesUpdate())&&(this._updatePathVertices(e._geometryData),e._verticesDirty=!1,a=!0),a||this.dirty){var r=i.positionMode,n=i.spacingMode,s=i.rotateMode,o=this._bones,h=0===n,l=2===s,c=0===s,u=o.length,d=c?u:u+1,p=this.spacing,m=this._spaces;if(m.length=d,l||h){m[0]=0;for(var f=0,g=d-1;f<g;f++){(w=o[f]).updateByConstraint();var y=w._boneData.length,_=y*(A=w.globalTransformMatrix).a,v=y*A.b,b=Math.sqrt(_*_+v*v);l&&(this._boneLengths[f]=b),m[f+1]=(y+p)*b/y}}else for(f=0;f<d;f++)m[f]=p;this._computeBezierCurve(e._displayFrame.rawDisplayData,d,c,1===r,2===n);var P,S=this._positions,D=this.rotateOffset,T=S[0],x=S[1];if(0===D)P=1===s;else if(P=!1,null!==(w=e.parent))D*=(A=w.globalTransformMatrix).a*A.d-A.b*A.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD;for(var C=this.rotateMix,O=this.translateMix,M=(f=0,3);f<u;f++,M+=3){var w,A;(w=o[f]).updateByConstraint(),(A=w.globalTransformMatrix).tx+=(T-A.tx)*O,A.ty+=(x-A.ty)*O;var E=(_=S[M])-T,B=(v=S[M+1])-x;if(l){var I=this._boneLengths[f],k=(Math.sqrt(E*E+B*B)/I-1)*C+1;A.a*=k,A.b*=k}if(T=_,x=v,C>0){var R=A.a,j=A.b,L=A.c,F=A.d,N=void 0,U=void 0,V=void 0;if(N=c?S[M-1]:Math.atan2(B,E),N-=Math.atan2(j,R),P){U=Math.cos(N),V=Math.sin(N);var H=w._boneData.length;T+=(H*(U*R-V*j)-E)*C,x+=(H*(V*R+U*j)-B)*C}else N+=D;N>t.Transform.PI?N-=t.Transform.PI_D:N<-t.Transform.PI&&(N+=t.Transform.PI_D),N*=C,U=Math.cos(N),V=Math.sin(N),A.a=U*R-V*j,A.b=V*R+U*j,A.c=U*L-V*F,A.d=V*L+U*F}w.global.fromMatrix(A)}this.dirty=!1}}},PathConstraint.prototype.invalidUpdate=function(){},PathConstraint}(e);t.PathConstraint=a}(l||(l={})),function(t){var e=function(){function WorldClock(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return WorldClock.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var i=0,a=0,r=this._animatebles.length;i<r;++i){var n=this._animatebles[i];null!==n?(a>0&&(this._animatebles[i-a]=n,this._animatebles[i]=null),n.advanceTime(t)):a++}if(a>0){for(r=this._animatebles.length;i<r;++i){var s=this._animatebles[i];null!==s?this._animatebles[i-a]=s:a++}this._animatebles.length-=a}}},WorldClock.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},WorldClock.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},WorldClock.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},WorldClock.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var i=e[t];null!==i&&(i.clock=null)}},Object.defineProperty(WorldClock.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),WorldClock}();t.WorldClock=e}(l||(l={})),function(t){var e=function(e){function Animation(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._blendStates={},t._animationConfig=null,t}return r(Animation,e),Animation.toString=function(){return"[class dragonBones.Animation]"},Animation.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}for(var i in this._animations)delete this._animations[i];for(var i in this._blendStates){var a=this._blendStates[i];for(var r in a)a[r].returnToPool();delete this._blendStates[i]}null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},Animation.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,i=this._animationStates;e<i.length;e++){null===(l=i[e])._parent&&(l.layer===t.layer&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 2:for(var a=0,r=this._animationStates;a<r.length;a++){null===(l=r[a])._parent&&(l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 3:for(var n=0,s=this._animationStates;n<s.length;n++){null===(l=s[n])._parent&&(l.layer===t.layer&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut))}break;case 4:for(var o=0,h=this._animationStates;o<h.length;o++){var l;null===(l=h[o])._parent&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},Animation.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},Animation.prototype.advanceTime=function(t){for(var e in t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale),this._blendStates){var i=this._blendStates[e];for(var a in i)i[a].reset()}var r=this._animationStates.length;if(1===r)if((g=this._animationStates[0])._fadeState>0&&g._subFadeState>0)this._armature._dragonBones.bufferObject(g),this._animationStates.length=0,this._lastAnimationState=null;else{var n=g.animationData,s=n.cacheFrameRate;if(this._animationDirty&&s>0){this._animationDirty=!1;for(var o=0,h=this._armature.getBones();o<h.length;o++){var l=h[o];l._cachedFrameIndices=n.getBoneCachedFrameIndices(l.name)}for(var c=0,u=this._armature.getSlots();c<u.length;c++){var d=u[c];if(d.displayFrameCount>0){var p=d.getDisplayFrameAt(0).rawDisplayData;if(null!==p&&p.parent===this._armature.armatureData.defaultSkin){d._cachedFrameIndices=n.getSlotCachedFrameIndices(d.name);continue}}d._cachedFrameIndices=null}}g.advanceTime(t,s)}else if(r>1){for(var m=0,f=0;m<r;++m){var g;(g=this._animationStates[m])._fadeState>0&&g._subFadeState>0?(f++,this._armature._dragonBones.bufferObject(g),this._animationDirty=!0,this._lastAnimationState===g&&(this._lastAnimationState=null)):(f>0&&(this._animationStates[m-f]=g),g.advanceTime(t,0)),m===r-1&&f>0&&(this._animationStates.length-=f,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},Animation.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++){e[t].returnToPool()}this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},Animation.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(a=this.getState(t))&&a.stop();else for(var e=0,i=this._animationStates;e<i.length;e++){var a;(a=i[e]).stop()}},Animation.prototype.playConfig=function(e){var i=e.animation;if(!(i in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+i),null;var a=this._animations[i];if(5===e.fadeOutMode)for(var r=0,n=this._animationStates;r<n.length;r++){var s=n[r];if(s._fadeState<1&&s.layer===e.layer&&s.animationData===a)return s}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=a.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/a.scale),a.frameCount>0?(e.position<0?(e.position%=a.duration,e.position=a.duration-e.position):e.position===a.duration?e.position-=1e-6:e.position>a.duration&&(e.position%=a.duration),e.duration>0&&e.position+e.duration>a.duration&&(e.duration=a.duration-e.position),e.playTimes<0&&(e.playTimes=a.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var o=t.BaseObject.borrowObject(t.AnimationState);if(o.init(this._armature,a,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var h=!1,l=0,c=this._animationStates.length;l<c;++l){if(o.layer>this._animationStates[l].layer){h=!0,this._animationStates.splice(l,0,o);break}if(l!==c-1&&o.layer>this._animationStates[l+1].layer){h=!0,this._animationStates.splice(l+1,0,o);break}}h||this._animationStates.push(o)}else this._animationStates.push(o);for(var u=0,d=this._armature.getSlots();u<d.length;u++){var p=d[u].childArmature;null!==p&&p.inheritAnimation&&p.animation.hasAnimation(i)&&null===p.animation.getState(i)&&p.animation.fadeIn(i)}for(var m in a.animationTimelines){var f=this.fadeIn(m,0,1,o.layer,"",5);if(null!==f){var g=a.animationTimelines[m];f.actionEnabled=!1,f.resetToPose=!1,f.stop(),o.addState(f,g);var y=this._animationStates.indexOf(o),_=this._animationStates.indexOf(f);_<y&&(this._animationStates.splice(y,1),this._animationStates.splice(_,0,o))}}return this._lastAnimationState=o,o},Animation.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;null!==i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},Animation.prototype.fadeIn=function(t,e,i,a,r,n){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===a&&(a=0),void 0===r&&(r=null),void 0===n&&(n=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=n,this._animationConfig.playTimes=i,this._animationConfig.layer=a,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var a=t in this._animations?this._animations[t]:null;return null!==a&&(this._animationConfig.position=a.frameCount>0?a.duration*e/a.frameCount:0),this.playConfig(this._animationConfig)},Animation.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var a=t in this._animations?this._animations[t]:null;return null!==a&&(this._animationConfig.position=a.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},Animation.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return null!==i&&i.stop(),i},Animation.prototype.getBlendState=function(e,i,a){e in this._blendStates||(this._blendStates[e]={});var r=this._blendStates[e];i in r||((r[i]=t.BaseObject.borrowObject(t.BlendState)).target=a);return r[i]},Animation.prototype.getState=function(t,e){void 0===e&&(e=-1);for(var i=this._animationStates.length;i--;){var a=this._animationStates[i];if(a.name===t&&(e<0||a.layer===e))return a}return null},Animation.prototype.hasAnimation=function(t){return t in this._animations},Animation.prototype.getStates=function(){return this._animationStates},Object.defineProperty(Animation.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(e[t].isPlaying)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){if(!e[t].isCompleted)return!1}return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),Animation}(t.BaseObject);t.Animation=e}(l||(l={})),function(t){var e=function(e){function AnimationState(){var t=null!==e&&e.apply(this,arguments)||this;return t._boneMask=[],t._boneTimelines=[],t._boneBlendTimelines=[],t._slotTimelines=[],t._slotBlendTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._actionTimeline=null,t._zOrderTimeline=null,t}return r(AnimationState,e),AnimationState.toString=function(){return"[class dragonBones.AnimationState]"},AnimationState.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++){(d=e[t]).returnToPool()}for(var i=0,a=this._boneBlendTimelines;i<a.length;i++){(d=a[i]).returnToPool()}for(var r=0,n=this._slotTimelines;r<n.length;r++){(d=n[r]).returnToPool()}for(var s=0,o=this._slotBlendTimelines;s<o.length;s++){(d=o[s]).returnToPool()}for(var h=0,l=this._constraintTimelines;h<l.length;h++){(d=l[h]).returnToPool()}for(var c=0,u=this._animationTimelines;c<u.length;c++){var d,p=(d=u[c]).target;p._parent===this&&(p._fadeState=1,p._subFadeState=1,p._parent=null),d.returnToPool()}null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additive=!1,this.displayControl=!1,this.resetToPose=!1,this.blendType=0,this.playTimes=1,this.layer=0,this.timeScale=1,this._weight=1,this.parameterX=0,this.parameterY=0,this.positionX=0,this.positionY=0,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._boneMask.length=0,this._boneTimelines.length=0,this._boneBlendTimelines.length=0,this._slotTimelines.length=0,this._slotBlendTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._activeChildA=null,this._activeChildB=null,this._parent=null},AnimationState.prototype._updateTimelines=function(){for(var e=0,i=this._armature._constraints;e<i.length;e++){var a=i[e],r=this._animationData.getConstraintTimelines(a.name);if(null!==r)for(var n=0,s=r;n<s.length;n++){var o=s[n];switch(o.type){case 30:(h=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).target=a,h.init(this._armature,this,o),this._constraintTimelines.push(h)}}else if(this.resetToPose){var h;(h=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).target=a,h.init(this._armature,this,null),this._constraintTimelines.push(h),this._poseTimelines.push(h)}}},AnimationState.prototype._updateBoneAndSlotTimelines=function(){for(var e={},a=0,r=this._boneTimelines;a<r.length;a++){(c=(_=r[a]).target.target.name)in e||(e[c]=[]),e[c].push(_)}for(var n=0,s=this._boneBlendTimelines;n<s.length;n++){(c=(_=s[n]).target.target.name)in e||(e[c]=[]),e[c].push(_)}for(var o=0,h=this._armature.getBones();o<h.length;o++){var l=h[o],c=l.name;if(this.containsBoneMask(c))if(c in e)delete e[c];else{var u=this._animationData.getBoneTimelines(c),d=this._armature.animation.getBlendState(i.BONE_TRANSFORM,l.name,l);if(null!==u)for(var p=0,m=u;p<m.length;p++){switch((I=m[p]).type){case 10:(_=t.BaseObject.borrowObject(t.BoneAllTimelineState)).target=d,_.init(this._armature,this,I),this._boneTimelines.push(_);break;case 11:(_=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).target=d,_.init(this._armature,this,I),this._boneTimelines.push(_);break;case 12:(_=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).target=d,_.init(this._armature,this,I),this._boneTimelines.push(_);break;case 13:(_=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).target=d,_.init(this._armature,this,I),this._boneTimelines.push(_);break;case 60:(_=t.BaseObject.borrowObject(t.AlphaTimelineState)).target=this._armature.animation.getBlendState(i.BONE_ALPHA,l.name,l),_.init(this._armature,this,I),this._boneBlendTimelines.push(_);break;case 50:(_=t.BaseObject.borrowObject(t.SurfaceTimelineState)).target=this._armature.animation.getBlendState(i.SURFACE,l.name,l),_.init(this._armature,this,I),this._boneBlendTimelines.push(_)}}else if(this.resetToPose){if(0===l._boneData.type)(_=t.BaseObject.borrowObject(t.BoneAllTimelineState)).target=d,_.init(this._armature,this,null),this._boneTimelines.push(_),this._poseTimelines.push(_);else(_=t.BaseObject.borrowObject(t.SurfaceTimelineState)).target=this._armature.animation.getBlendState(i.SURFACE,l.name,l),_.init(this._armature,this,null),this._boneBlendTimelines.push(_),this._poseTimelines.push(_)}}}for(var f in e)for(var g=0,y=e[f];g<y.length;g++){var _=y[g];(U=this._boneTimelines.indexOf(_))>=0&&(this._boneTimelines.splice(U,1),_.returnToPool()),(U=this._boneBlendTimelines.indexOf(_))>=0&&(this._boneBlendTimelines.splice(U,1),_.returnToPool())}for(var v={},b=[],P=0,S=this._slotTimelines;P<S.length;P++){(c=(_=S[P]).target.name)in v||(v[c]=[]),v[c].push(_)}for(var D=0,T=this._slotBlendTimelines;D<T.length;D++){(c=(_=T[D]).target.target.name)in v||(v[c]=[]),v[c].push(_)}for(var x=0,C=this._armature.getSlots();x<C.length;x++){var O=C[x],M=O.parent.name;if(this.containsBoneMask(M))if((c=O.name)in v)delete v[c];else{var w=!1,A=!1;if(b.length=0,null!==(u=this._animationData.getSlotTimelines(c)))for(var E=0,B=u;E<B.length;E++){var I;switch((I=B[E]).type){case 20:(_=t.BaseObject.borrowObject(t.SlotDisplayTimelineState)).target=O,_.init(this._armature,this,I),this._slotTimelines.push(_),w=!0;break;case 23:(_=t.BaseObject.borrowObject(t.SlotZIndexTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_Z_INDEX,O.name,O),_.init(this._armature,this,I),this._slotBlendTimelines.push(_);break;case 21:(_=t.BaseObject.borrowObject(t.SlotColorTimelineState)).target=O,_.init(this._armature,this,I),this._slotTimelines.push(_),A=!0;break;case 22:(_=t.BaseObject.borrowObject(t.DeformTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_DEFORM,O.name,O),_.init(this._armature,this,I),null!==_.target?(this._slotBlendTimelines.push(_),b.push(_.geometryOffset)):_.returnToPool();break;case 24:(_=t.BaseObject.borrowObject(t.AlphaTimelineState)).target=this._armature.animation.getBlendState(i.SLOT_ALPHA,O.name,O),_.init(this._armature,this,I),this._slotBlendTimelines.push(_)}}if(this.resetToPose){if(!w)(_=t.BaseObject.borrowObject(t.SlotDisplayTimelineState)).target=O,_.init(this._armature,this,null),this._slotTimelines.push(_),this._poseTimelines.push(_);if(!A)(_=t.BaseObject.borrowObject(t.SlotColorTimelineState)).target=O,_.init(this._armature,this,null),this._slotTimelines.push(_),this._poseTimelines.push(_);for(var k=0,R=O.displayFrameCount;k<R;++k){var j=O.getDisplayFrameAt(k);if(0!==j.deformVertices.length){var L=j.getGeometryData();if(null!==L&&b.indexOf(L.offset)<0)(_=t.BaseObject.borrowObject(t.DeformTimelineState)).geometryOffset=L.offset,_.displayFrame=j,_.target=this._armature.animation.getBlendState(i.SLOT_DEFORM,O.name,O),_.init(this._armature,this,null),this._slotBlendTimelines.push(_),this._poseTimelines.push(_)}}}}}for(var f in v)for(var F=0,N=v[f];F<N.length;F++){var U;_=N[F];(U=this._slotTimelines.indexOf(_))>=0&&(this._slotTimelines.splice(U,1),_.returnToPool()),(U=this._slotBlendTimelines.indexOf(_))>=0&&(this._slotBlendTimelines.splice(U,1),_.returnToPool())}},AnimationState.prototype._advanceFadeTime=function(e){var i=this._fadeState>0;if(this._subFadeState<0&&(this._subFadeState=0,null===this._parent&&this.actionEnabled)){var a=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasDBEventListener(a))(r=t.BaseObject.borrowObject(t.EventObject)).type=a,r.armature=this._armature,r.animationState=this,this._armature._dragonBones.bufferEvent(r)}if((e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0)&&(i||(this._playheadState|=1,this._fadeState=0),null===this._parent&&this.actionEnabled)){var r;a=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasDBEventListener(a))(r=t.BaseObject.borrowObject(t.EventObject)).type=a,r.armature=this._armature,r.animationState=this,this._armature._dragonBones.bufferEvent(r)}},AnimationState.prototype.init=function(e,i,a){if(null===this._armature){if(this._armature=e,this._animationData=i,this.resetToPose=a.resetToPose,this.additive=a.additive,this.displayControl=a.displayControl,this.actionEnabled=a.actionEnabled,this.blendType=i.blendType,this.layer=a.layer,this.playTimes=a.playTimes,this.timeScale=a.timeScale,this.fadeTotalTime=a.fadeInTime,this.autoFadeOutTime=a.autoFadeOutTime,this.name=a.name.length>0?a.name:a.animation,this.group=a.group,this._weight=a.weight,a.pauseFadeIn?this._playheadState=2:this._playheadState=3,a.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==a.position?this.timeScale>=0?this._time=a.position:this._time=a.position-this._duration:this._time=0):(this._position=a.position,this._duration=a.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),a.boneMask.length>0){this._boneMask.length=a.boneMask.length;for(var r=0,n=this._boneMask.length;r<n;++r)this._boneMask[r]=a.boneMask[r]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},AnimationState.prototype.advanceTime=function(t,e){0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines());var i=0!==this._fadeState||0===this._subFadeState,a=0===this._fadeState&&e>0,r=!0,n=!0,s=this._time;if(this._weightResult=this._weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult),this._actionTimeline.playState<=0&&this._actionTimeline.update(s),0!==this._weight){if(a){var o=2*e;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*o)/o}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(s),a){var h=Math.floor(this._actionTimeline.currentTime*e);this._armature._cacheFrameIndex===h?(r=!1,n=!1):(this._armature._cacheFrameIndex=h,this._animationData.cachedFrames[h]?n=!1:this._animationData.cachedFrames[h]=!0)}if(r){var l=!1,c=null;if(n)for(var u=0,d=this._boneTimelines.length;u<d;++u){if((T=this._boneTimelines[u]).playState<=0&&T.update(s),T.target!==c)if(l=(f=T.target).update(this),c=f,1===f.dirty){var p=f.target.animationPose;p.x=0,p.y=0,p.rotation=0,p.skew=0,p.scaleX=1,p.scaleY=1}l&&T.blend(i)}for(u=0,d=this._boneBlendTimelines.length;u<d;++u){(T=this._boneBlendTimelines[u]).playState<=0&&T.update(s),T.target.update(this)&&T.blend(i)}if(this.displayControl)for(u=0,d=this._slotTimelines.length;u<d;++u){if((T=this._slotTimelines[u]).playState<=0){var m=T.target.displayController;null!==m&&m!==this.name&&m!==this.group||T.update(s)}}for(u=0,d=this._slotBlendTimelines.length;u<d;++u){if((T=this._slotBlendTimelines[u]).playState<=0){var f=T.target;T.update(s),f.update(this)&&T.blend(i)}}for(u=0,d=this._constraintTimelines.length;u<d;++u){(T=this._constraintTimelines[u]).playState<=0&&T.update(s)}if(this._animationTimelines.length>0){var g=100,y=100,_=null,v=null;for(u=0,d=this._animationTimelines.length;u<d;++u){if((T=this._animationTimelines[u]).playState<=0&&T.update(s),1===this.blendType){var b=T.target,P=this.parameterX-b.positionX;P>=0?P<g&&(g=P,_=b):-P<y&&(y=-P,v=b)}}null!==_&&(this._activeChildA!==_&&(null!==this._activeChildA&&(this._activeChildA.weight=0),this._activeChildA=_,this._activeChildA.activeTimeline()),this._activeChildB!==v&&(null!==this._activeChildB&&(this._activeChildB.weight=0),this._activeChildB=v),_.weight=y/(g+y),v&&(v.weight=1-_.weight))}}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var S=0,D=this._poseTimelines;S<D.length;S++){var T=D[S],x=this._boneTimelines.indexOf(T);x>=0?(this._boneTimelines.splice(x,1),T.returnToPool()):(x=this._boneBlendTimelines.indexOf(T))>=0?(this._boneBlendTimelines.splice(x,1),T.returnToPool()):(x=this._slotTimelines.indexOf(T))>=0?(this._slotTimelines.splice(x,1),T.returnToPool()):(x=this._slotBlendTimelines.indexOf(T))>=0?(this._slotBlendTimelines.splice(x,1),T.returnToPool()):(x=this._constraintTimelines.indexOf(T))>=0&&(this._constraintTimelines.splice(x,1),T.returnToPool())}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},AnimationState.prototype.play=function(){this._playheadState=3},AnimationState.prototype.stop=function(){this._playheadState&=1},AnimationState.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,a=this._boneTimelines;i<a.length;i++){(m=a[i]).fadeOut()}for(var r=0,n=this._boneBlendTimelines;r<n.length;r++){(m=n[r]).fadeOut()}for(var s=0,o=this._slotTimelines;s<o.length;s++){(m=o[s]).fadeOut()}for(var h=0,l=this._slotBlendTimelines;h<l.length;h++){(m=l[h]).fadeOut()}for(var c=0,u=this._constraintTimelines;c<u.length;c++){(m=u[c]).fadeOut()}for(var d=0,p=this._animationTimelines;d<p.length;d++){var m;(m=p[d]).fadeOut(),m.target.fadeOut(999999,!0)}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},AnimationState.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},AnimationState.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var a=0,r=this._armature.getBones();a<r.length;a++){var n=r[a];this._boneMask.indexOf(n.name)<0&&i.contains(n)&&this._boneMask.push(n.name)}this._timelineDirty=1}},AnimationState.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var a=this._armature.getBone(t);if(null!==a){var r=this._armature.getBones();if(this._boneMask.length>0)for(var n=0,s=r;n<s.length;n++){var o=s[n],h=this._boneMask.indexOf(o.name);h>=0&&a.contains(o)&&this._boneMask.splice(h,1)}else for(var l=0,c=r;l<c.length;l++){(o=c[l])!==a&&(a.contains(o)||this._boneMask.push(o.name))}}}this._timelineDirty=1},AnimationState.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},AnimationState.prototype.addState=function(e,i){if(void 0===i&&(i=null),null!==i)for(var a=0,r=i;a<r.length;a++){var n=r[a];switch(n.type){case 40:if((o=t.BaseObject.borrowObject(t.AnimationProgressTimelineState)).target=e,o.init(this._armature,this,n),this._animationTimelines.push(o),0!==this.blendType){var s=n;e.positionX=s.x,e.positionY=s.y,e.weight=0}e._parent=this,this.resetToPose=!1;break;case 41:(o=t.BaseObject.borrowObject(t.AnimationWeightTimelineState)).target=e,o.init(this._armature,this,n),this._animationTimelines.push(o);break;case 42:var o;(o=t.BaseObject.borrowObject(t.AnimationParametersTimelineState)).target=e,o.init(this._armature,this,n),this._animationTimelines.push(o)}}null===e._parent&&(e._parent=this)},AnimationState.prototype.activeTimeline=function(){for(var t=0,e=this._slotTimelines;t<e.length;t++){var i=e[t];i.dirty=!0,i.currentTime=-1}},Object.defineProperty(AnimationState.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&null===this._parent&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,a=this._boneTimelines;i<a.length;i++){a[i].playState=-1}for(var r=0,n=this._slotTimelines;r<n.length;r++){n[r].playState=-1}}},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"weight",{get:function(){return this._weight},set:function(t){if(this._weight!==t){this._weight=t;for(var e=0,i=this._boneTimelines;e<i.length;e++){i[e].dirty=!0}for(var a=0,r=this._boneBlendTimelines;a<r.length;a++){r[a].dirty=!0}for(var n=0,s=this._slotBlendTimelines;n<s.length;n++){s[n].dirty=!0}}},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationState.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),AnimationState}(t.BaseObject);t.AnimationState=e;var i=function(t){function BlendState(){return null!==t&&t.apply(this,arguments)||this}return r(BlendState,t),BlendState.toString=function(){return"[class dragonBones.BlendState]"},BlendState.prototype._onClear=function(){this.reset(),this.target=null},BlendState.prototype.update=function(t){var e=t.layer,i=t._weightResult;if(this.dirty>0){if(this.leftWeight>0){if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.dirty++,this.layer=e,this.leftWeight=0,this.blendWeight=0,!1;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return i*=this.leftWeight,this.dirty++,this.blendWeight=i,this.layerWeight+=this.blendWeight,!0}return!1}return this.dirty++,this.layer=e,this.leftWeight=1,this.blendWeight=i,this.layerWeight=i,!0},BlendState.prototype.reset=function(){this.dirty=0,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},BlendState.BONE_TRANSFORM="boneTransform",BlendState.BONE_ALPHA="boneAlpha",BlendState.SURFACE="surface",BlendState.SLOT_DEFORM="slotDeform",BlendState.SLOT_ALPHA="slotAlpha",BlendState.SLOT_Z_INDEX="slotZIndex",BlendState}(t.BaseObject);t.BlendState=i}(l||(l={})),function(t){var e=function(t){function TimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(TimelineState,t),TimelineState.prototype._onClear=function(){this.dirty=!1,this.playState=-1,this.currentPlayTimes=0,this.currentTime=-1,this.target=null,this._isTween=!1,this._valueOffset=0,this._frameValueOffset=0,this._frameOffset=0,this._frameRate=0,this._frameCount=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._valueArray=null,this._timelineArray=null,this._frameIndices=null},TimelineState.prototype._setCurrentTime=function(t){var e=this.playState,i=this.currentPlayTimes,a=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var r=this._animationState.playTimes,n=r*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),r>0&&(t>=n||t<=-n)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=r,this.currentTime=t<0?0:1===this.playState?this._duration+1e-6:this._duration):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==i||this.currentTime!==a)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i)&&(this._frameIndex=-1),!0)},TimelineState.prototype.init=function(t,e,i){if(this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState.animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,null!==this._timelineData){var a=this._animationData.parent.parent;this._frameArray=a.frameArray,this._timelineArray=a.timelineArray,this._frameIndices=a.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1]}},TimelineState.prototype.fadeOut=function(){this.dirty=!1},TimelineState.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),i=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==i&&(this._frameIndex=i,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());(this._isTween||this.dirty)&&this._onUpdateFrame()}},TimelineState.prototype.blend=function(t){},TimelineState}(t.BaseObject);t.TimelineState=e;var i=function(t){function TweenTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(TweenTimelineState,t),TweenTimelineState._getEasingValue=function(t,e,i){var a=e;switch(t){case 3:a=Math.pow(e,2);break;case 4:a=1-Math.pow(1-e,2);break;case 5:a=.5*(1-Math.cos(e*Math.PI))}return(a-e)*i+e},TweenTimelineState._getEasingCurveValue=function(t,e,i,a){if(t<=0)return 0;if(t>=1)return 1;var r=i>0,n=i+1,s=Math.floor(t*n),o=0,h=0;return r?(o=0===s?0:e[a+s-1],h=s===n-1?1e4:e[a+s]):(o=e[a+s-1],h=e[a+s]),1e-4*(o+(h-o)*(t*n-s))},TweenTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenEasing=0,this._tweenProgress=0,this._valueScale=1},TweenTimelineState.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._isTween=0!==this._tweenType,this._isTween?2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]):this.dirty=!0,this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this.dirty=!0,this._isTween=!1},TweenTimelineState.prototype._onUpdateFrame=function(){this._isTween&&(this.dirty=!0,this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=TweenTimelineState._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=TweenTimelineState._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing)))},TweenTimelineState}(e);t.TweenTimelineState=i;var a=function(t){function SingleValueTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(SingleValueTimelineState,t),SingleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._difference=0,this._result=0},SingleValueTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,a=this._valueOffset+this._frameValueOffset+this._frameIndex;if(this._isTween){var r=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:a+1;1===e?(this._current=i[a],this._difference=i[r]-this._current):(this._current=i[a]*e,this._difference=i[r]*e-this._current)}else this._result=i[a]*e}else this._result=0},SingleValueTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result=this._current+this._difference*this._tweenProgress)},SingleValueTimelineState}(i);t.SingleValueTimelineState=a;var n=function(t){function DoubleValueTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(DoubleValueTimelineState,t),DoubleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._currentA=0,this._currentB=0,this._differenceA=0,this._differenceB=0,this._resultA=0,this._resultB=0},DoubleValueTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._valueScale,i=this._valueArray,a=this._valueOffset+this._frameValueOffset+2*this._frameIndex;if(this._isTween){var r=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:a+2;1===e?(this._currentA=i[a],this._currentB=i[a+1],this._differenceA=i[r]-this._currentA,this._differenceB=i[r+1]-this._currentB):(this._currentA=i[a]*e,this._currentB=i[a+1]*e,this._differenceA=i[r]*e-this._currentA,this._differenceB=i[r+1]*e-this._currentB)}else this._resultA=i[a]*e,this._resultB=i[a+1]*e}else this._resultA=0,this._resultB=0},DoubleValueTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._resultA=this._currentA+this._differenceA*this._tweenProgress,this._resultB=this._currentB+this._differenceB*this._tweenProgress)},DoubleValueTimelineState}(i);t.DoubleValueTimelineState=n;var s=function(t){function MutilpleValueTimelineState(){var e=null!==t&&t.apply(this,arguments)||this;return e._rd=[],e}return r(MutilpleValueTimelineState,t),MutilpleValueTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._valueCount=0,this._rd.length=0},MutilpleValueTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this._valueCount,i=this._rd;if(null!==this._timelineData){var a=this._valueScale,r=this._valueArray,n=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(this._isTween){var s=this._frameIndex===this._frameCount-1?this._valueOffset+this._frameValueOffset:n+e;if(1===a)for(var o=0;o<e;++o)i[e+o]=r[s+o]-r[n+o];else for(o=0;o<e;++o)i[e+o]=(r[s+o]-r[n+o])*a}else if(1===a)for(o=0;o<e;++o)i[o]=r[n+o];else for(o=0;o<e;++o)i[o]=r[n+o]*a}else for(o=0;o<e;++o)i[o]=0},MutilpleValueTimelineState.prototype._onUpdateFrame=function(){if(t.prototype._onUpdateFrame.call(this),this._isTween){var e=this._valueCount,i=this._valueScale,a=this._tweenProgress,r=this._valueArray,n=this._rd,s=this._valueOffset+this._frameValueOffset+this._frameIndex*e;if(1===i)for(var o=0;o<e;++o)n[o]=r[s+o]+n[e+o]*a;else for(o=0;o<e;++o)n[o]=r[s+o]*i+n[e+o]*a}},MutilpleValueTimelineState}(i);t.MutilpleValueTimelineState=s}(l||(l={})),function(t){var e=function(e){function ActionTimelineState(){return null!==e&&e.apply(this,arguments)||this}return r(ActionTimelineState,e),ActionTimelineState.toString=function(){return"[class dragonBones.ActionTimelineState]"},ActionTimelineState.prototype._onCrossFrame=function(e){var i=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var a=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],r=this._frameArray[a+1],n=this._animationData.parent.actions,s=0;s<r;++s){var o=n[this._frameArray[a+2+s]];if(0===o.type){(h=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[a]/this._frameRate,h.animationState=this._animationState,t.EventObject.actionDataToInstance(o,h,this._armature),this._armature._bufferAction(h,!0)}else{var h,l=10===o.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;if(11===o.type||i.hasDBEventListener(l))(h=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[a]/this._frameRate,h.animationState=this._animationState,t.EventObject.actionDataToInstance(o,h,this._armature),this._armature._dragonBones.bufferEvent(h)}}},ActionTimelineState.prototype._onArriveAtFrame=function(){},ActionTimelineState.prototype._onUpdateFrame=function(){},ActionTimelineState.prototype.update=function(e){var i=this.playState,a=this.currentPlayTimes,r=this.currentTime;if(this._setCurrentTime(e)){var n=null===this._animationState._parent&&this._animationState.actionEnabled,s=this._armature.eventDispatcher;if(i<0){if(this.playState===i)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),n&&s.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var h=this._animationState.timeScale<0,l=null,c=null;if(n&&this.currentPlayTimes!==a&&(s.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((l=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,l.armature=this._armature,l.animationState=this._animationState),this.playState>0&&s.hasDBEventListener(t.EventObject.COMPLETE)&&((c=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,c.armature=this._armature,c.animationState=this._animationState)),this._frameCount>1){var u=this._timelineData,d=Math.floor(this.currentTime*this._frameRate),p=this._frameIndices[u.frameIndicesOffset+d];if(this._frameIndex!==p){var m=this._frameIndex;if(this._frameIndex=p,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[u.offset+5+this._frameIndex],h){if(m<0){var f=Math.floor(r*this._frameRate);m=this._frameIndices[u.frameIndicesOffset+f],this.currentPlayTimes===a&&m===p&&(m=-1)}for(;m>=0;){var g=this._animationData.frameOffset+this._timelineArray[u.offset+5+m],y=this._frameArray[g]/this._frameRate;if(this._position<=y&&y<=this._position+this._duration&&this._onCrossFrame(m),null!==l&&0===m&&(this._armature._dragonBones.bufferEvent(l),l=null),m>0?m--:m=this._frameCount-1,m===p)break}}else{if(m<0){f=Math.floor(r*this._frameRate);m=this._frameIndices[u.frameIndicesOffset+f];g=this._animationData.frameOffset+this._timelineArray[u.offset+5+m],y=this._frameArray[g]/this._frameRate;this.currentPlayTimes===a&&(r<=y?m>0?m--:m=this._frameCount-1:m===p&&(m=-1))}for(;m>=0;){m<this._frameCount-1?m++:m=0;g=this._animationData.frameOffset+this._timelineArray[u.offset+5+m],y=this._frameArray[g]/this._frameRate;if(this._position<=y&&y<=this._position+this._duration&&this._onCrossFrame(m),null!==l&&0===m&&(this._armature._dragonBones.bufferEvent(l),l=null),m===p)break}}}}else if(this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];y=this._frameArray[this._frameOffset]/this._frameRate;this.currentPlayTimes===a?r<=y&&this._onCrossFrame(this._frameIndex):this._position<=y&&(h||null===l||(this._armature._dragonBones.bufferEvent(l),l=null),this._onCrossFrame(this._frameIndex))}null!==l&&this._armature._dragonBones.bufferEvent(l),null!==c&&this._armature._dragonBones.bufferEvent(c)}},ActionTimelineState.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},ActionTimelineState}(t.TimelineState);t.ActionTimelineState=e;var i=function(t){function ZOrderTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(ZOrderTimelineState,t),ZOrderTimelineState.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},ZOrderTimelineState.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},ZOrderTimelineState.prototype._onUpdateFrame=function(){},ZOrderTimelineState}(t.TimelineState);t.ZOrderTimelineState=i;var a=function(e){function BoneAllTimelineState(){return null!==e&&e.apply(this,arguments)||this}return r(BoneAllTimelineState,e),BoneAllTimelineState.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},BoneAllTimelineState.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])),null===this._timelineData&&(this._rd[4]=1,this._rd[5]=1)},BoneAllTimelineState.prototype.init=function(t,i,a){e.prototype.init.call(this,t,i,a),this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=6,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneAllTimelineState.prototype.fadeOut=function(){this.dirty=!1,this._rd[2]=t.Transform.normalizeRadian(this._rd[2]),this._rd[3]=t.Transform.normalizeRadian(this._rd[3])},BoneAllTimelineState.prototype.blend=function(t){var e=this._armature.armatureData.scale,i=this._rd,a=this.target,r=a.target,n=a.blendWeight,s=r.animationPose;a.dirty>1?(s.x+=i[0]*n*e,s.y+=i[1]*n*e,s.rotation+=i[2]*n,s.skew+=i[3]*n,s.scaleX+=(i[4]-1)*n,s.scaleY+=(i[5]-1)*n):(s.x=i[0]*n*e,s.y=i[1]*n*e,s.rotation=i[2]*n,s.skew=i[3]*n,s.scaleX=(i[4]-1)*n+1,s.scaleY=(i[5]-1)*n+1),(t||this.dirty)&&(this.dirty=!1,r._transformDirty=!0)},BoneAllTimelineState}(t.MutilpleValueTimelineState);t.BoneAllTimelineState=a;var n=function(t){function BoneTranslateTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(BoneTranslateTimelineState,t),BoneTranslateTimelineState.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},BoneTranslateTimelineState.prototype.init=function(e,i,a){t.prototype.init.call(this,e,i,a),this._valueOffset=this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneTranslateTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,a=e.blendWeight,r=i.animationPose;e.dirty>1?(r.x+=this._resultA*a,r.y+=this._resultB*a):1!==a?(r.x=this._resultA*a,r.y=this._resultB*a):(r.x=this._resultA,r.y=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneTranslateTimelineState}(t.DoubleValueTimelineState);t.BoneTranslateTimelineState=n;var s=function(e){function BoneRotateTimelineState(){return null!==e&&e.apply(this,arguments)||this}return r(BoneRotateTimelineState,e),BoneRotateTimelineState.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},BoneRotateTimelineState.prototype._onArriveAtFrame=function(){e.prototype._onArriveAtFrame.call(this),this._isTween&&this._frameIndex===this._frameCount-1&&(this._differenceA=t.Transform.normalizeRadian(this._differenceA),this._differenceB=t.Transform.normalizeRadian(this._differenceB))},BoneRotateTimelineState.prototype.init=function(t,i,a){e.prototype.init.call(this,t,i,a),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneRotateTimelineState.prototype.fadeOut=function(){this.dirty=!1,this._resultA=t.Transform.normalizeRadian(this._resultA),this._resultB=t.Transform.normalizeRadian(this._resultB)},BoneRotateTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,a=e.blendWeight,r=i.animationPose;e.dirty>1?(r.rotation+=this._resultA*a,r.skew+=this._resultB*a):1!==a?(r.rotation=this._resultA*a,r.skew=this._resultB*a):(r.rotation=this._resultA,r.skew=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneRotateTimelineState}(t.DoubleValueTimelineState);t.BoneRotateTimelineState=s;var o=function(t){function BoneScaleTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(BoneScaleTimelineState,t),BoneScaleTimelineState.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},BoneScaleTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._resultA=1,this._resultB=1)},BoneScaleTimelineState.prototype.init=function(e,i,a){t.prototype.init.call(this,e,i,a),this._valueOffset=this._animationData.frameFloatOffset,this._valueArray=this._animationData.parent.parent.frameFloatArray},BoneScaleTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,a=e.blendWeight,r=i.animationPose;e.dirty>1?(r.scaleX+=(this._resultA-1)*a,r.scaleY+=(this._resultB-1)*a):1!==a?(r.scaleX=(this._resultA-1)*a+1,r.scaleY=(this._resultB-1)*a+1):(r.scaleX=this._resultA,r.scaleY=this._resultB),(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},BoneScaleTimelineState}(t.DoubleValueTimelineState);t.BoneScaleTimelineState=o;var h=function(t){function SurfaceTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(SurfaceTimelineState,t),SurfaceTimelineState.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},SurfaceTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},SurfaceTimelineState.prototype.init=function(e,i,a){if(t.prototype.init.call(this,e,i,a),null!==this._timelineData){var r=this._animationData.parent.parent,n=r.frameIntArray,s=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=n[s+2],this._deformCount=n[s+1],this._deformOffset=n[s+3],this._sameValueOffset=n[s+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=r.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.target.target._deformVertices.length},SurfaceTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,a=e.blendWeight,r=i._deformVertices,n=this._valueArray;if(null!==n)for(var s=this._valueCount,o=this._deformOffset,h=this._sameValueOffset,l=this._rd,c=0;c<this._deformCount;++c){var u=0;u=c<o?n[h+c]:c<o+s?l[c-o]:n[h+c-s],e.dirty>1?r[c]+=u*a:r[c]=u*a}else if(1===e.dirty)for(c=0;c<this._deformCount;++c)r[c]=0;(t||this.dirty)&&(this.dirty=!1,i._transformDirty=!0)},SurfaceTimelineState}(t.MutilpleValueTimelineState);t.SurfaceTimelineState=h;var l=function(t){function AlphaTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(AlphaTimelineState,t),AlphaTimelineState.toString=function(){return"[class dragonBones.AlphaTimelineState]"},AlphaTimelineState.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),null===this._timelineData&&(this._result=1)},AlphaTimelineState.prototype.init=function(e,i,a){t.prototype.init.call(this,e,i,a),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},AlphaTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,a=e.blendWeight;e.dirty>1?(i._alpha+=this._result*a,i._alpha>1&&(i._alpha=1)):i._alpha=this._result*a,(t||this.dirty)&&(this.dirty=!1,this._armature._alphaDirty=!0)},AlphaTimelineState}(t.SingleValueTimelineState);t.AlphaTimelineState=l;var c=function(t){function SlotDisplayTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(SlotDisplayTimelineState,t),SlotDisplayTimelineState.toString=function(){return"[class dragonBones.SlotDisplayTimelineState]"},SlotDisplayTimelineState.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this.target,e=null!==this._timelineData?this._frameArray[this._frameOffset+1]:t._slotData.displayIndex;t.displayIndex!==e&&t._setDisplayIndex(e,!0)}},SlotDisplayTimelineState.prototype._onUpdateFrame=function(){},SlotDisplayTimelineState}(t.TimelineState);t.SlotDisplayTimelineState=c;var u=function(t){function SlotColorTimelineState(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._difference=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return r(SlotColorTimelineState,t),SlotColorTimelineState.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},SlotColorTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.parent.parent,i=e.colorArray,a=e.frameIntArray,r=this._animationData.frameIntOffset+this._frameValueOffset+this._frameIndex,n=a[r];n<0&&(n+=65536),this._isTween?(this._current[0]=i[n++],this._current[1]=i[n++],this._current[2]=i[n++],this._current[3]=i[n++],this._current[4]=i[n++],this._current[5]=i[n++],this._current[6]=i[n++],this._current[7]=i[n++],(n=this._frameIndex===this._frameCount-1?a[this._animationData.frameIntOffset+this._frameValueOffset]:a[r+1])<0&&(n+=65536),this._difference[0]=i[n++]-this._current[0],this._difference[1]=i[n++]-this._current[1],this._difference[2]=i[n++]-this._current[2],this._difference[3]=i[n++]-this._current[3],this._difference[4]=i[n++]-this._current[4],this._difference[5]=i[n++]-this._current[5],this._difference[6]=i[n++]-this._current[6],this._difference[7]=i[n++]-this._current[7]):(this._result[0]=.01*i[n++],this._result[1]=.01*i[n++],this._result[2]=.01*i[n++],this._result[3]=.01*i[n++],this._result[4]=i[n++],this._result[5]=i[n++],this._result[6]=i[n++],this._result[7]=i[n++])}else{var s=this.target.slotData.color;this._result[0]=s.alphaMultiplier,this._result[1]=s.redMultiplier,this._result[2]=s.greenMultiplier,this._result[3]=s.blueMultiplier,this._result[4]=s.alphaOffset,this._result[5]=s.redOffset,this._result[6]=s.greenOffset,this._result[7]=s.blueOffset}},SlotColorTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._isTween&&(this._result[0]=.01*(this._current[0]+this._difference[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._difference[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._difference[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._difference[3]*this._tweenProgress),this._result[4]=this._current[4]+this._difference[4]*this._tweenProgress,this._result[5]=this._current[5]+this._difference[5]*this._tweenProgress,this._result[6]=this._current[6]+this._difference[6]*this._tweenProgress,this._result[7]=this._current[7]+this._difference[7]*this._tweenProgress)},SlotColorTimelineState.prototype.fadeOut=function(){this._isTween=!1},SlotColorTimelineState.prototype.update=function(e){if(t.prototype.update.call(this,e),this._isTween||this.dirty){var i=this.target,a=i._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(a.alphaMultiplier!==this._result[0]||a.redMultiplier!==this._result[1]||a.greenMultiplier!==this._result[2]||a.blueMultiplier!==this._result[3]||a.alphaOffset!==this._result[4]||a.redOffset!==this._result[5]||a.greenOffset!==this._result[6]||a.blueOffset!==this._result[7]){var r=Math.pow(this._animationState._fadeProgress,4);a.alphaMultiplier+=(this._result[0]-a.alphaMultiplier)*r,a.redMultiplier+=(this._result[1]-a.redMultiplier)*r,a.greenMultiplier+=(this._result[2]-a.greenMultiplier)*r,a.blueMultiplier+=(this._result[3]-a.blueMultiplier)*r,a.alphaOffset+=(this._result[4]-a.alphaOffset)*r,a.redOffset+=(this._result[5]-a.redOffset)*r,a.greenOffset+=(this._result[6]-a.greenOffset)*r,a.blueOffset+=(this._result[7]-a.blueOffset)*r,i._colorDirty=!0}}else this.dirty&&(this.dirty=!1,a.alphaMultiplier===this._result[0]&&a.redMultiplier===this._result[1]&&a.greenMultiplier===this._result[2]&&a.blueMultiplier===this._result[3]&&a.alphaOffset===this._result[4]&&a.redOffset===this._result[5]&&a.greenOffset===this._result[6]&&a.blueOffset===this._result[7]||(a.alphaMultiplier=this._result[0],a.redMultiplier=this._result[1],a.greenMultiplier=this._result[2],a.blueMultiplier=this._result[3],a.alphaOffset=this._result[4],a.redOffset=this._result[5],a.greenOffset=this._result[6],a.blueOffset=this._result[7],i._colorDirty=!0))}},SlotColorTimelineState}(t.TweenTimelineState);t.SlotColorTimelineState=u;var d=function(t){function SlotZIndexTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(SlotZIndexTimelineState,t),SlotZIndexTimelineState.toString=function(){return"[class dragonBones.SlotZIndexTimelineState]"},SlotZIndexTimelineState.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null===this._timelineData){var e=this.target.target;this._result=e.slotData.zIndex}},SlotZIndexTimelineState.prototype.init=function(e,i,a){t.prototype.init.call(this,e,i,a),this._valueOffset=this._animationData.frameIntOffset,this._valueArray=this._animationData.parent.parent.frameIntArray},SlotZIndexTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,a=e.blendWeight;e.dirty>1?i._zIndex+=this._result*a:i._zIndex=this._result*a,(t||this.dirty)&&(this.dirty=!1,this._armature._zIndexDirty=!0)},SlotZIndexTimelineState}(t.SingleValueTimelineState);t.SlotZIndexTimelineState=d;var p=function(t){function DeformTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(DeformTimelineState,t),DeformTimelineState.toString=function(){return"[class dragonBones.DeformTimelineState]"},DeformTimelineState.prototype._onClear=function(){t.prototype._onClear.call(this),this.geometryOffset=0,this.displayFrame=null,this._deformCount=0,this._deformOffset=0,this._sameValueOffset=0},DeformTimelineState.prototype.init=function(e,i,a){if(t.prototype.init.call(this,e,i,a),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3],n=this._animationData.parent.parent,s=n.frameIntArray,o=this.target.target;this.geometryOffset=s[r+0],this.geometryOffset<0&&(this.geometryOffset+=65536);for(var h=0,l=o.displayFrameCount;h<l;++h){var c=o.getDisplayFrameAt(h),u=c.getGeometryData();if(null!==u&&u.offset===this.geometryOffset){this.displayFrame=c,this.displayFrame.updateDeformVertices();break}}if(null===this.displayFrame)return void this.returnToPool();this._valueOffset=this._animationData.frameFloatOffset,this._valueCount=s[r+2],this._deformCount=s[r+1],this._deformOffset=s[r+3],this._sameValueOffset=s[r+4]+this._animationData.frameFloatOffset,this._valueScale=this._armature.armatureData.scale,this._valueArray=n.frameFloatArray,this._rd.length=2*this._valueCount}else this._deformCount=this.displayFrame.deformVertices.length},DeformTimelineState.prototype.blend=function(t){var e=this.target,i=e.target,a=e.blendWeight,r=this.displayFrame.deformVertices,n=this._valueArray;if(null!==n)for(var s=this._valueCount,o=this._deformOffset,h=this._sameValueOffset,l=this._rd,c=0;c<this._deformCount;++c){var u=0;u=c<o?n[h+c]:c<o+s?l[c-o]:n[h+c-s],e.dirty>1?r[c]+=u*a:r[c]=u*a}else if(1===e.dirty)for(c=0;c<this._deformCount;++c)r[c]=0;(t||this.dirty)&&(this.dirty=!1,i._geometryData===this.displayFrame.getGeometryData()&&(i._verticesDirty=!0))},DeformTimelineState}(t.MutilpleValueTimelineState);t.DeformTimelineState=p;var m=function(t){function IKConstraintTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(IKConstraintTimelineState,t),IKConstraintTimelineState.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},IKConstraintTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;if(null!==this._timelineData)e._bendPositive=this._currentA>0,e._weight=this._currentB;else{var i=e._constraintData;e._bendPositive=i.bendPositive,e._weight=i.weight}e.invalidUpdate(),this.dirty=!1},IKConstraintTimelineState.prototype.init=function(e,i,a){t.prototype.init.call(this,e,i,a),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=.01,this._valueArray=this._animationData.parent.parent.frameIntArray},IKConstraintTimelineState}(t.DoubleValueTimelineState);t.IKConstraintTimelineState=m;var f=function(t){function AnimationProgressTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(AnimationProgressTimelineState,t),AnimationProgressTimelineState.toString=function(){return"[class dragonBones.AnimationProgressTimelineState]"},AnimationProgressTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.currentTime=this._result*e.totalTime),this.dirty=!1},AnimationProgressTimelineState.prototype.init=function(e,i,a){t.prototype.init.call(this,e,i,a),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationProgressTimelineState}(t.SingleValueTimelineState);t.AnimationProgressTimelineState=f;var g=function(t){function AnimationWeightTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(AnimationWeightTimelineState,t),AnimationWeightTimelineState.toString=function(){return"[class dragonBones.AnimationWeightTimelineState]"},AnimationWeightTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.weight=this._result),this.dirty=!1},AnimationWeightTimelineState.prototype.init=function(e,i,a){t.prototype.init.call(this,e,i,a),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationWeightTimelineState}(t.SingleValueTimelineState);t.AnimationWeightTimelineState=g;var y=function(t){function AnimationParametersTimelineState(){return null!==t&&t.apply(this,arguments)||this}return r(AnimationParametersTimelineState,t),AnimationParametersTimelineState.toString=function(){return"[class dragonBones.AnimationParametersTimelineState]"},AnimationParametersTimelineState.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.target;null!==e._parent&&(e.parameterX=this._resultA,e.parameterY=this._resultB),this.dirty=!1},AnimationParametersTimelineState.prototype.init=function(e,i,a){t.prototype.init.call(this,e,i,a),this._valueOffset=this._animationData.frameIntOffset,this._valueScale=1e-4,this._valueArray=this._animationData.parent.parent.frameIntArray},AnimationParametersTimelineState}(t.DoubleValueTimelineState);t.AnimationParametersTimelineState=y}(l||(l={})),function(t){var e=function(t){function EventObject(){return null!==t&&t.apply(this,arguments)||this}return r(EventObject,t),EventObject.actionDataToInstance=function(t,e,i){0===t.type?e.type=EventObject.FRAME_EVENT:e.type=10===t.type?EventObject.FRAME_EVENT:EventObject.SOUND_EVENT,e.name=t.name,e.armature=i,e.actionData=t,e.data=t.data,null!==t.bone&&(e.bone=i.getBone(t.bone.name)),null!==t.slot&&(e.slot=i.getSlot(t.slot.name))},EventObject.toString=function(){return"[class dragonBones.EventObject]"},EventObject.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},EventObject.START="start",EventObject.LOOP_COMPLETE="loopComplete",EventObject.COMPLETE="complete",EventObject.FADE_IN="fadeIn",EventObject.FADE_IN_COMPLETE="fadeInComplete",EventObject.FADE_OUT="fadeOut",EventObject.FADE_OUT_COMPLETE="fadeOutComplete",EventObject.FRAME_EVENT="frameEvent",EventObject.SOUND_EVENT="soundEvent",EventObject}(t.BaseObject);t.EventObject=e}(l||(l={})),function(t){var e=function(){function DataParser(){}return DataParser._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},DataParser._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},DataParser._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},DataParser._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},DataParser._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},DataParser._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},DataParser._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},DataParser._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},DataParser._getAnimationBlendType=function(t){switch(t.toLowerCase()){case"none":return 0;case"1d":return 1;default:return 0}},DataParser._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},DataParser.DATA_VERSION_2_3="2.3",DataParser.DATA_VERSION_3_0="3.0",DataParser.DATA_VERSION_4_0="4.0",DataParser.DATA_VERSION_4_5="4.5",DataParser.DATA_VERSION_5_0="5.0",DataParser.DATA_VERSION_5_5="5.5",DataParser.DATA_VERSION_5_6="5.6",DataParser.DATA_VERSION=DataParser.DATA_VERSION_5_6,DataParser.DATA_VERSIONS=[DataParser.DATA_VERSION_4_0,DataParser.DATA_VERSION_4_5,DataParser.DATA_VERSION_5_0,DataParser.DATA_VERSION_5_5,DataParser.DATA_VERSION_5_6],DataParser.TEXTURE_ATLAS="textureAtlas",DataParser.SUB_TEXTURE="SubTexture",DataParser.FORMAT="format",DataParser.IMAGE_PATH="imagePath",DataParser.WIDTH="width",DataParser.HEIGHT="height",DataParser.ROTATED="rotated",DataParser.FRAME_X="frameX",DataParser.FRAME_Y="frameY",DataParser.FRAME_WIDTH="frameWidth",DataParser.FRAME_HEIGHT="frameHeight",DataParser.DRADON_BONES="dragonBones",DataParser.USER_DATA="userData",DataParser.ARMATURE="armature",DataParser.CANVAS="canvas",DataParser.BONE="bone",DataParser.SURFACE="surface",DataParser.SLOT="slot",DataParser.CONSTRAINT="constraint",DataParser.SKIN="skin",DataParser.DISPLAY="display",DataParser.FRAME="frame",DataParser.IK="ik",DataParser.PATH_CONSTRAINT="path",DataParser.ANIMATION="animation",DataParser.TIMELINE="timeline",DataParser.FFD="ffd",DataParser.TRANSLATE_FRAME="translateFrame",DataParser.ROTATE_FRAME="rotateFrame",DataParser.SCALE_FRAME="scaleFrame",DataParser.DISPLAY_FRAME="displayFrame",DataParser.COLOR_FRAME="colorFrame",DataParser.DEFAULT_ACTIONS="defaultActions",DataParser.ACTIONS="actions",DataParser.EVENTS="events",DataParser.INTS="ints",DataParser.FLOATS="floats",DataParser.STRINGS="strings",DataParser.TRANSFORM="transform",DataParser.PIVOT="pivot",DataParser.AABB="aabb",DataParser.COLOR="color",DataParser.VERSION="version",DataParser.COMPATIBLE_VERSION="compatibleVersion",DataParser.FRAME_RATE="frameRate",DataParser.TYPE="type",DataParser.SUB_TYPE="subType",DataParser.NAME="name",DataParser.PARENT="parent",DataParser.TARGET="target",DataParser.STAGE="stage",DataParser.SHARE="share",DataParser.PATH="path",DataParser.LENGTH="length",DataParser.DISPLAY_INDEX="displayIndex",DataParser.Z_ORDER="zOrder",DataParser.Z_INDEX="zIndex",DataParser.BLEND_MODE="blendMode",DataParser.INHERIT_TRANSLATION="inheritTranslation",DataParser.INHERIT_ROTATION="inheritRotation",DataParser.INHERIT_SCALE="inheritScale",DataParser.INHERIT_REFLECTION="inheritReflection",DataParser.INHERIT_ANIMATION="inheritAnimation",DataParser.INHERIT_DEFORM="inheritDeform",DataParser.SEGMENT_X="segmentX",DataParser.SEGMENT_Y="segmentY",DataParser.BEND_POSITIVE="bendPositive",DataParser.CHAIN="chain",DataParser.WEIGHT="weight",DataParser.BLEND_TYPE="blendType",DataParser.FADE_IN_TIME="fadeInTime",DataParser.PLAY_TIMES="playTimes",DataParser.SCALE="scale",DataParser.OFFSET="offset",DataParser.POSITION="position",DataParser.DURATION="duration",DataParser.TWEEN_EASING="tweenEasing",DataParser.TWEEN_ROTATE="tweenRotate",DataParser.TWEEN_SCALE="tweenScale",DataParser.CLOCK_WISE="clockwise",DataParser.CURVE="curve",DataParser.SOUND="sound",DataParser.EVENT="event",DataParser.ACTION="action",DataParser.X="x",DataParser.Y="y",DataParser.SKEW_X="skX",DataParser.SKEW_Y="skY",DataParser.SCALE_X="scX",DataParser.SCALE_Y="scY",DataParser.VALUE="value",DataParser.ROTATE="rotate",DataParser.SKEW="skew",DataParser.ALPHA="alpha",DataParser.ALPHA_OFFSET="aO",DataParser.RED_OFFSET="rO",DataParser.GREEN_OFFSET="gO",DataParser.BLUE_OFFSET="bO",DataParser.ALPHA_MULTIPLIER="aM",DataParser.RED_MULTIPLIER="rM",DataParser.GREEN_MULTIPLIER="gM",DataParser.BLUE_MULTIPLIER="bM",DataParser.UVS="uvs",DataParser.VERTICES="vertices",DataParser.TRIANGLES="triangles",DataParser.WEIGHTS="weights",DataParser.SLOT_POSE="slotPose",DataParser.BONE_POSE="bonePose",DataParser.BONES="bones",DataParser.POSITION_MODE="positionMode",DataParser.SPACING_MODE="spacingMode",DataParser.ROTATE_MODE="rotateMode",DataParser.SPACING="spacing",DataParser.ROTATE_OFFSET="rotateOffset",DataParser.ROTATE_MIX="rotateMix",DataParser.TRANSLATE_MIX="translateMix",DataParser.TARGET_DISPLAY="targetDisplay",DataParser.CLOSED="closed",DataParser.CONSTANT_SPEED="constantSpeed",DataParser.VERTEX_COUNT="vertexCount",DataParser.LENGTHS="lengths",DataParser.GOTO_AND_PLAY="gotoAndPlay",DataParser.DEFAULT_NAME="default",DataParser}();t.DataParser=e}(l||(l={})),function(t){var e=function(e){function ObjectDataParser(){var i=null!==e&&e.apply(this,arguments)||this;return i._rawTextureAtlasIndex=0,i._rawBones=[],i._data=null,i._armature=null,i._bone=null,i._geometry=null,i._slot=null,i._skin=null,i._mesh=null,i._animation=null,i._timeline=null,i._rawTextureAtlases=null,i._frameValueType=0,i._defaultColorOffset=-1,i._prevClockwise=0,i._prevRotation=0,i._frameDefaultValue=0,i._frameValueScale=1,i._helpMatrixA=new t.Matrix,i._helpMatrixB=new t.Matrix,i._helpTransform=new t.Transform,i._helpColorTransform=new t.ColorTransform,i._helpPoint=new t.Point,i._helpArray=[],i._intArray=[],i._floatArray=[],i._frameIntArray=[],i._frameFloatArray=[],i._frameArray=[],i._timelineArray=[],i._colorArray=[],i._cacheRawMeshes=[],i._cacheMeshes=[],i._actionFrames=[],i._weightSlotPose={},i._weightBonePoses={},i._cacheBones={},i._slotChildActions={},i}return r(ObjectDataParser,e),ObjectDataParser._getBoolean=function(t,e,i){if(e in t){var a=t[e],r=typeof a;if("boolean"===r)return a;if("string"!==r)return!!a;switch(a){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},ObjectDataParser._getNumber=function(t,e,i){if(e in t){var a=t[e];return null===a||"NaN"===a?i:+a||0}return i},ObjectDataParser._getString=function(t,e,i){if(e in t){var a=t[e];return"string"===typeof a?a:String(a)}return i},ObjectDataParser.prototype._getCurvePoint=function(t,e,i,a,r,n,s,o,h,l){var c=1-h,u=c*c,d=h*h,p=c*u,m=3*h*u,f=3*c*d,g=h*d;l.x=p*t+m*i+f*r+g*s,l.y=p*e+m*a+f*n+g*o},ObjectDataParser.prototype._samplingEasingCurve=function(t,e){var i=t.length;if(i%3==1){for(var a=-2,r=0,n=e.length;r<n;++r){for(var s=(r+1)/(n+1);(a+6<i?t[a+6]:1)<s;)a+=6;for(var o=a>=0&&a+6<i,h=o?t[a]:0,l=o?t[a+1]:0,c=t[a+2],u=t[a+3],d=t[a+4],p=t[a+5],m=o?t[a+6]:1,f=o?t[a+7]:1,g=0,y=1;y-g>1e-4;){var _=.5*(y+g);this._getCurvePoint(h,l,c,u,d,p,m,f,_,this._helpPoint),s-this._helpPoint.x>0?g=_:y=_}e[r]=this._helpPoint.y}return!0}for(a=0,r=0,n=e.length;r<n;++r){for(s=(r+1)/(n+1);t[a+6]<s;)a+=6;for(h=t[a],l=t[a+1],c=t[a+2],u=t[a+3],d=t[a+4],p=t[a+5],m=t[a+6],f=t[a+7],g=0,y=1;y-g>1e-4;){_=.5*(y+g);this._getCurvePoint(h,l,c,u,d,p,m,f,_,this._helpPoint),s-this._helpPoint.x>0?g=_:y=_}e[r]=this._helpPoint.y}return!1},ObjectDataParser.prototype._parseActionDataInFrame=function(e,i,a,r){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],i,10,a,r),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],i,11,a,r),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],i,0,a,r),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],i,10,a,r),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],i,0,a,r)},ObjectDataParser.prototype._mergeActionFrame=function(t,e,a,r,n){for(var s=this._armature.actions.length,o=this._parseActionData(t,a,r,n),h=0,l=null,c=0,u=o;c<u.length;c++){var d=u[c];this._armature.addAction(d,!1)}0===this._actionFrames.length&&((l=new i).frameStart=0,this._actionFrames.push(l),l=null);for(var p=0,m=this._actionFrames;p<m.length;p++){var f=m[p];if(f.frameStart===e){l=f;break}if(f.frameStart>e)break;h++}null===l&&((l=new i).frameStart=e,this._actionFrames.splice(h,0,l));for(var g=0;g<o.length;++g)l.actions.push(s+g)},ObjectDataParser.prototype._parseArmature=function(e,i){var a=t.BaseObject.borrowObject(t.ArmatureData);if(a.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),a.frameRate=ObjectDataParser._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),a.scale=i,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?a.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):a.type=ObjectDataParser._getNumber(e,t.DataParser.TYPE,0),0===a.frameRate&&(a.frameRate=24),this._armature=a,t.DataParser.CANVAS in e){var r=e[t.DataParser.CANVAS],n=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in r?n.hasBackground=!0:n.hasBackground=!1,n.color=ObjectDataParser._getNumber(r,t.DataParser.COLOR,0),n.x=ObjectDataParser._getNumber(r,t.DataParser.X,0)*a.scale,n.y=ObjectDataParser._getNumber(r,t.DataParser.Y,0)*a.scale,n.width=ObjectDataParser._getNumber(r,t.DataParser.WIDTH,0)*a.scale,n.height=ObjectDataParser._getNumber(r,t.DataParser.HEIGHT,0)*a.scale,a.canvas=n}if(t.DataParser.AABB in e){var s=e[t.DataParser.AABB];a.aabb.x=ObjectDataParser._getNumber(s,t.DataParser.X,0)*a.scale,a.aabb.y=ObjectDataParser._getNumber(s,t.DataParser.Y,0)*a.scale,a.aabb.width=ObjectDataParser._getNumber(s,t.DataParser.WIDTH,0)*a.scale,a.aabb.height=ObjectDataParser._getNumber(s,t.DataParser.HEIGHT,0)*a.scale}if(t.DataParser.BONE in e)for(var o=0,h=e[t.DataParser.BONE];o<h.length;o++){var l=h[o],c=ObjectDataParser._getString(l,t.DataParser.PARENT,""),u=this._parseBone(l);if(c.length>0){var d=a.getBone(c);null!==d?u.parent=d:(c in this._cacheBones||(this._cacheBones[c]=[]),this._cacheBones[c].push(u))}if(u.name in this._cacheBones){for(var p=0,m=this._cacheBones[u.name];p<m.length;p++){m[p].parent=u}delete this._cacheBones[u.name]}a.addBone(u),this._rawBones.push(u)}if(t.DataParser.IK in e)for(var f=0,g=e[t.DataParser.IK];f<g.length;f++){var y=g[f];(O=this._parseIKConstraint(y))&&a.addConstraint(O)}if(a.sortBones(),t.DataParser.SLOT in e)for(var _=0,v=0,b=e[t.DataParser.SLOT];v<b.length;v++){var P=b[v];a.addSlot(this._parseSlot(P,_++))}if(t.DataParser.SKIN in e)for(var S=0,D=e[t.DataParser.SKIN];S<D.length;S++){var T=D[S];a.addSkin(this._parseSkin(T))}if(t.DataParser.PATH_CONSTRAINT in e)for(var x=0,C=e[t.DataParser.PATH_CONSTRAINT];x<C.length;x++){var O,M=C[x];(O=this._parsePathConstraint(M))&&a.addConstraint(O)}for(var w=0,A=this._cacheRawMeshes.length;w<A;++w){var E=this._cacheRawMeshes[w],B=ObjectDataParser._getString(E,t.DataParser.SHARE,"");if(0!==B.length){var I=ObjectDataParser._getString(E,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===I.length&&(I=t.DataParser.DEFAULT_NAME);var k=a.getMesh(I,"",B);if(null!==k)this._cacheMeshes[w].geometry.shareFrom(k.geometry)}}if(t.DataParser.ANIMATION in e)for(var R=0,j=e[t.DataParser.ANIMATION];R<j.length;R++){var L=j[R],F=this._parseAnimation(L);a.addAnimation(F)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var N=0,U=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);N<U.length;N++){var V=U[N];if(a.addAction(V,!0),0===V.type)null!==(F=a.getAnimation(V.name))&&(a.defaultAnimation=F)}if(t.DataParser.ACTIONS in e)for(var H=0,W=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);H<W.length;H++){V=W[H];a.addAction(V,!1)}for(var z in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[z];for(var z in this._weightBonePoses)delete this._weightBonePoses[z];for(var z in this._cacheBones)delete this._cacheBones[z];for(var z in this._slotChildActions)delete this._slotChildActions[z];return a},ObjectDataParser.prototype._parseBone=function(e){if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):ObjectDataParser._getNumber(e,t.DataParser.TYPE,0))){var i=this._armature.scale,a=t.BaseObject.borrowObject(t.BoneData);return a.inheritTranslation=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),a.inheritRotation=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),a.inheritScale=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),a.inheritReflection=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),a.length=ObjectDataParser._getNumber(e,t.DataParser.LENGTH,0)*i,a.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),a.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],a.transform,i),a}var r=t.BaseObject.borrowObject(t.SurfaceData);return r.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),r.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),r.segmentX=ObjectDataParser._getNumber(e,t.DataParser.SEGMENT_X,0),r.segmentY=ObjectDataParser._getNumber(e,t.DataParser.SEGMENT_Y,0),this._parseGeometry(e,r.geometry),r},ObjectDataParser.prototype._parseIKConstraint=function(e){var i=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.BONE,""));if(null===i)return null;var a=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.TARGET,""));if(null===a)return null;var r=ObjectDataParser._getNumber(e,t.DataParser.CHAIN,0),n=t.BaseObject.borrowObject(t.IKConstraintData);return n.scaleEnabled=ObjectDataParser._getBoolean(e,t.DataParser.SCALE,!1),n.bendPositive=ObjectDataParser._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),n.weight=ObjectDataParser._getNumber(e,t.DataParser.WEIGHT,1),n.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),n.type=0,n.target=a,r>0&&null!==i.parent?(n.root=i.parent,n.bone=i):(n.root=i,n.bone=null),n},ObjectDataParser.prototype._parsePathConstraint=function(e){var i=this._armature.getSlot(ObjectDataParser._getString(e,t.DataParser.TARGET,""));if(null===i)return null;var a=this._armature.defaultSkin;if(null===a)return null;var r=a.getDisplay(i.name,ObjectDataParser._getString(e,t.DataParser.TARGET_DISPLAY,i.name));if(null===r||!(r instanceof t.PathDisplayData))return null;var n=e[t.DataParser.BONES];if(null===n||0===n.length)return null;var s=t.BaseObject.borrowObject(t.PathConstraintData);s.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),s.type=1,s.pathSlot=i,s.pathDisplayData=r,s.target=i.parent,s.positionMode=t.DataParser._getPositionMode(ObjectDataParser._getString(e,t.DataParser.POSITION_MODE,"")),s.spacingMode=t.DataParser._getSpacingMode(ObjectDataParser._getString(e,t.DataParser.SPACING_MODE,"")),s.rotateMode=t.DataParser._getRotateMode(ObjectDataParser._getString(e,t.DataParser.ROTATE_MODE,"")),s.position=ObjectDataParser._getNumber(e,t.DataParser.POSITION,0),s.spacing=ObjectDataParser._getNumber(e,t.DataParser.SPACING,0),s.rotateOffset=ObjectDataParser._getNumber(e,t.DataParser.ROTATE_OFFSET,0),s.rotateMix=ObjectDataParser._getNumber(e,t.DataParser.ROTATE_MIX,1),s.translateMix=ObjectDataParser._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var o=0,h=n;o<h.length;o++){var l=h[o],c=this._armature.getBone(l);null!==c&&(s.AddBone(c),null===s.root&&(s.root=c))}return s},ObjectDataParser.prototype._parseSlot=function(e,i){var a=t.BaseObject.borrowObject(t.SlotData);return a.displayIndex=ObjectDataParser._getNumber(e,t.DataParser.DISPLAY_INDEX,0),a.zOrder=i,a.zIndex=ObjectDataParser._getNumber(e,t.DataParser.Z_INDEX,0),a.alpha=ObjectDataParser._getNumber(e,t.DataParser.ALPHA,1),a.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),a.parent=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?a.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):a.blendMode=ObjectDataParser._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(a.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],a.color)):a.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[a.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),a},ObjectDataParser.prototype._parseSkin=function(e){var i=t.BaseObject.borrowObject(t.SkinData);if(i.name=ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var a=e[t.DataParser.SLOT];this._skin=i;for(var r=0,n=a;r<n.length;r++){var s=n[r],o=ObjectDataParser._getString(s,t.DataParser.NAME,""),h=this._armature.getSlot(o);if(null!==h){if(this._slot=h,t.DataParser.DISPLAY in s)for(var l=0,c=s[t.DataParser.DISPLAY];l<c.length;l++){var u=c[l];u?i.addDisplay(o,this._parseDisplay(u)):i.addDisplay(o,null)}this._slot=null}}this._skin=null}return i},ObjectDataParser.prototype._parseDisplay=function(e){var i=ObjectDataParser._getString(e,t.DataParser.NAME,""),a=ObjectDataParser._getString(e,t.DataParser.PATH,""),r=0,n=null;switch(r=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):ObjectDataParser._getNumber(e,t.DataParser.TYPE,r)){case 0:var s=n=t.BaseObject.borrowObject(t.ImageDisplayData);s.name=i,s.path=a.length>0?a:i,this._parsePivot(e,s);break;case 1:var o=n=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(o.name=i,o.path=a.length>0?a:i,o.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var h=0,l=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);h<l.length;h++){var c=l[h];o.addAction(c)}else if(this._slot.name in this._slotChildActions){var u=this._skin.getDisplays(this._slot.name);if(null===u?0===this._slot.displayIndex:this._slot.displayIndex===u.length){for(var d=0,p=this._slotChildActions[this._slot.name];d<p.length;d++){c=p[d];o.addAction(c)}delete this._slotChildActions[this._slot.name]}}break;case 2:var m=n=t.BaseObject.borrowObject(t.MeshDisplayData);m.geometry.inheritDeform=ObjectDataParser._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),m.name=i,m.path=a.length>0?a:i,t.DataParser.SHARE in e?(m.geometry.data=this._data,this._cacheRawMeshes.push(e),this._cacheMeshes.push(m)):this._parseMesh(e,m);break;case 3:var f=this._parseBoundingBox(e);if(null!==f){var g=n=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);g.name=i,g.path=a.length>0?a:i,g.boundingBox=f}break;case 4:var y=e[t.DataParser.LENGTHS],_=n=t.BaseObject.borrowObject(t.PathDisplayData);_.closed=ObjectDataParser._getBoolean(e,t.DataParser.CLOSED,!1),_.constantSpeed=ObjectDataParser._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),_.name=i,_.path=a.length>0?a:i,_.curveLengths.length=y.length;for(var v=0,b=y.length;v<b;++v)_.curveLengths[v]=y[v];this._parsePath(e,_)}return null!==n&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],n.transform,this._armature.scale),n},ObjectDataParser.prototype._parsePath=function(t,e){this._parseGeometry(t,e.geometry)},ObjectDataParser.prototype._parsePivot=function(e,i){if(t.DataParser.PIVOT in e){var a=e[t.DataParser.PIVOT];i.pivot.x=ObjectDataParser._getNumber(a,t.DataParser.X,0),i.pivot.y=ObjectDataParser._getNumber(a,t.DataParser.Y,0)}else i.pivot.x=.5,i.pivot.y=.5},ObjectDataParser.prototype._parseMesh=function(e,i){if(this._parseGeometry(e,i.geometry),t.DataParser.WEIGHTS in e){var a=e[t.DataParser.SLOT_POSE],r=e[t.DataParser.BONE_POSE],n=this._skin.name+"_"+this._slot.name+"_"+i.name;this._weightSlotPose[n]=a,this._weightBonePoses[n]=r}},ObjectDataParser.prototype._parseBoundingBox=function(e){var i=null,a=0;switch(a=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):ObjectDataParser._getNumber(e,t.DataParser.SUB_TYPE,a)){case 0:i=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:i=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(e)}return null!==i&&(i.color=ObjectDataParser._getNumber(e,t.DataParser.COLOR,0),0!==i.type&&1!==i.type||(i.width=ObjectDataParser._getNumber(e,t.DataParser.WIDTH,0),i.height=ObjectDataParser._getNumber(e,t.DataParser.HEIGHT,0))),i},ObjectDataParser.prototype._parsePolygonBoundingBox=function(e){var i=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var a=this._armature.scale,r=e[t.DataParser.VERTICES],n=i.vertices;n.length=r.length;for(var s=0,o=r.length;s<o;s+=2){var h=r[s]*a,l=r[s+1]*a;n[s]=h,n[s+1]=l,0===s?(i.x=h,i.y=l,i.width=h,i.height=l):(h<i.x?i.x=h:h>i.width&&(i.width=h),l<i.y?i.y=l:l>i.height&&(i.height=l))}i.width-=i.x,i.height-=i.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return i},ObjectDataParser.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);if(i.blendType=t.DataParser._getAnimationBlendType(ObjectDataParser._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=ObjectDataParser._getNumber(e,t.DataParser.DURATION,0),i.playTimes=ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME),i.frameIntOffset=this._frameIntArray.length,i.frameFloatOffset=this._frameFloatArray.length,i.frameOffset=this._frameArray.length,this._animation=i,t.DataParser.FRAME in e){var a=e[t.DataParser.FRAME],r=a.length;if(r>0)for(var n=0,s=0;n<r;++n){var o=a[n];this._parseActionDataInFrame(o,s,null,null),s+=ObjectDataParser._getNumber(o,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,0,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var h=0,l=e[t.DataParser.BONE];h<l.length;h++){var c=l[h];this._parseBoneTimeline(c)}if(t.DataParser.SLOT in e)for(var u=0,d=e[t.DataParser.SLOT];u<d.length;u++){c=d[u];this._parseSlotTimeline(c)}if(t.DataParser.FFD in e)for(var p=0,m=e[t.DataParser.FFD];p<m.length;p++){c=m[p];var f=ObjectDataParser._getString(c,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),g=ObjectDataParser._getString(c,t.DataParser.SLOT,""),y=ObjectDataParser._getString(c,t.DataParser.NAME,"");if(0===f.length&&(f=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(g),this._mesh=this._armature.getMesh(f,g,y),null!==this._slot&&null!==this._mesh)null!==(x=this._parseTimeline(c,null,t.DataParser.FRAME,22,2,0,this._parseSlotDeformFrame))&&this._animation.addSlotTimeline(g,x),this._slot=null,this._mesh=null}if(t.DataParser.IK in e)for(var _=0,v=e[t.DataParser.IK];_<v.length;_++){c=v[_];var b=ObjectDataParser._getString(c,t.DataParser.NAME,"");if(null!==this._armature.getConstraint(b))null!==(x=this._parseTimeline(c,null,t.DataParser.FRAME,30,1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(b,x)}if(this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,0,0,this._parseActionFrame),this._actionFrames.length=0),t.DataParser.TIMELINE in e)for(var P=0,S=e[t.DataParser.TIMELINE];P<S.length;P++){c=S[P];var D=ObjectDataParser._getNumber(c,t.DataParser.TYPE,0),T=ObjectDataParser._getString(c,t.DataParser.NAME,""),x=null;switch(D){case 0:break;case 20:case 23:case 60:case 24:case 40:case 41:if(20===D?(this._frameValueType=0,this._frameValueScale=1):(this._frameValueType=1,this._frameValueScale=23===D?1:40===D||41===D?1e4:100),this._frameDefaultValue=60===D||24===D||41===D?1:0,40===D&&0!==i.blendType){var C=x=t.BaseObject.borrowObject(t.AnimationTimelineData);C.x=ObjectDataParser._getNumber(c,t.DataParser.X,0),C.y=ObjectDataParser._getNumber(c,t.DataParser.Y,0)}x=this._parseTimeline(c,null,t.DataParser.FRAME,D,this._frameValueType,1,this._parseSingleValueFrame,x);break;case 11:case 12:case 13:case 30:case 42:30===D||42===D?(this._frameValueType=1,this._frameValueScale=42===D?1e4:100):(this._frameValueScale=12===D?t.Transform.DEG_RAD:1,this._frameValueType=2),this._frameDefaultValue=13===D||30===D?1:0,x=this._parseTimeline(c,null,t.DataParser.FRAME,D,this._frameValueType,2,this._parseDoubleValueFrame);break;case 1:break;case 50:var O=this._armature.getBone(T);if(null===O)continue;this._geometry=O.geometry,x=this._parseTimeline(c,null,t.DataParser.FRAME,D,2,0,this._parseDeformFrame),this._geometry=null;break;case 22:for(var f in this._geometry=null,this._armature.skins){var M=this._armature.skins[f];for(var w in M.displays)for(var A=0,E=M.displays[w];A<E.length;A++){var B=E[A];if(null!==B&&B.name===T){this._geometry=B.geometry;break}}}if(null===this._geometry)continue;x=this._parseTimeline(c,null,t.DataParser.FRAME,D,2,0,this._parseDeformFrame),this._geometry=null;break;case 21:x=this._parseTimeline(c,null,t.DataParser.FRAME,D,1,1,this._parseSlotColorFrame)}if(null!==x)switch(D){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(T,x);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(T,x);break;case 30:this._animation.addConstraintTimeline(T,x);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(T,x)}}return this._animation=null,i},ObjectDataParser.prototype._parseTimeline=function(e,a,r,n,s,o,h,l){if(void 0===l&&(l=null),null!==e&&r.length>0&&r in e&&(a=e[r]),null===a)return null;var c=a.length;if(0===c)return null;var u=this._frameIntArray.length,d=this._frameFloatArray.length,p=this._timelineArray.length;switch(null===l&&(l=t.BaseObject.borrowObject(t.TimelineData)),l.type=n,l.offset=p,this._frameValueType=s,this._timeline=l,this._timelineArray.length+=5+c,null!==e?(this._timelineArray[p+0]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[p+1]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[p+0]=100,this._timelineArray[p+1]=0),this._timelineArray[p+2]=c,this._timelineArray[p+3]=o,this._frameValueType){case 0:this._timelineArray[p+4]=0;break;case 1:this._timelineArray[p+4]=u-this._animation.frameIntOffset;break;case 2:this._timelineArray[p+4]=d-this._animation.frameFloatOffset}if(1===c)l.frameIndicesOffset=-1,this._timelineArray[p+5+0]=h.call(this,a[0],0,0)-this._animation.frameOffset;else{var m=this._animation.frameCount+1,f=this._data.frameIndices,g=f.length;f.length+=m,l.frameIndicesOffset=g;for(var y=0,_=0,v=0,b=0;y<m;++y){if(v+b<=y&&_<c){var P=a[_];v=y,b=_===c-1?this._animation.frameCount-v:P instanceof i?this._actionFrames[_+1].frameStart-v:ObjectDataParser._getNumber(P,t.DataParser.DURATION,1),this._timelineArray[p+5+_]=h.call(this,P,v,b)-this._animation.frameOffset,_++}f[g+y]=_-1}}return this._timeline=null,l},ObjectDataParser.prototype._parseBoneTimeline=function(e){var i=this._armature.getBone(ObjectDataParser._getString(e,t.DataParser.NAME,""));if(null!==i){var a;if(this._bone=i,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e)this._frameDefaultValue=0,this._frameValueScale=1,null!==(a=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,2,2,this._parseDoubleValueFrame))&&this._animation.addBoneTimeline(i.name,a);if(t.DataParser.ROTATE_FRAME in e)this._frameDefaultValue=0,this._frameValueScale=1,null!==(a=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,2,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(i.name,a);if(t.DataParser.SCALE_FRAME in e)this._frameDefaultValue=1,this._frameValueScale=1,null!==(a=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,2,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(i.name,a);if(t.DataParser.FRAME in e)null!==(a=this._parseTimeline(e,null,t.DataParser.FRAME,10,2,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(i.name,a);this._bone=null,this._slot=null}},ObjectDataParser.prototype._parseSlotTimeline=function(e){var i=this._armature.getSlot(ObjectDataParser._getString(e,t.DataParser.NAME,""));if(null!==i){var a=null,r=null;this._slot=i,a=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,0,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,0,0,this._parseSlotDisplayFrame),r=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,1,1,this._parseSlotColorFrame),null!==a&&this._animation.addSlotTimeline(i.name,a),null!==r&&this._animation.addSlotTimeline(i.name,r),this._slot=null}},ObjectDataParser.prototype._parseFrame=function(t,e,i){var a=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[a+0]=e,a},ObjectDataParser.prototype._parseTweenFrame=function(e,i,a){var r=this._parseFrame(e,i,a);if(a>0)if(t.DataParser.CURVE in e){var n=a+1;this._helpArray.length=n;var s=this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray);this._frameArray.length+=2+this._helpArray.length,this._frameArray[r+1]=2,this._frameArray[r+2]=s?n:-n;for(var o=0;o<n;++o)this._frameArray[r+3+o]=Math.round(1e4*this._helpArray[o])}else{var h=-2;t.DataParser.TWEEN_EASING in e&&(h=ObjectDataParser._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===h?(this._frameArray.length+=1,this._frameArray[r+1]=0):0===h?(this._frameArray.length+=1,this._frameArray[r+1]=1):h<0?(this._frameArray.length+=2,this._frameArray[r+1]=3,this._frameArray[r+2]=Math.round(100*-h)):h<=1?(this._frameArray.length+=2,this._frameArray[r+1]=4,this._frameArray[r+2]=Math.round(100*h)):(this._frameArray.length+=2,this._frameArray[r+1]=5,this._frameArray[r+2]=Math.round(100*h-100))}else this._frameArray.length+=1,this._frameArray[r+1]=0;return r},ObjectDataParser.prototype._parseSingleValueFrame=function(e,i,a){var r=0;switch(this._frameValueType){case 0:r=this._parseFrame(e,i,a),this._frameArray.length+=1,this._frameArray[r+1]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue);break;case 1:r=this._parseTweenFrame(e,i,a);var n=this._frameIntArray.length;this._frameIntArray.length+=1,this._frameIntArray[n]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale);break;case 2:r=this._parseTweenFrame(e,i,a);n=this._frameFloatArray.length;this._frameFloatArray.length+=1,this._frameFloatArray[n]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,this._frameDefaultValue)*this._frameValueScale}return r},ObjectDataParser.prototype._parseDoubleValueFrame=function(e,i,a){var r=0;switch(this._frameValueType){case 0:r=this._parseFrame(e,i,a),this._frameArray.length+=2,this._frameArray[r+1]=ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue),this._frameArray[r+2]=ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue);break;case 1:r=this._parseTweenFrame(e,i,a);var n=this._frameIntArray.length;this._frameIntArray.length+=2,this._frameIntArray[n]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale),this._frameIntArray[n+1]=Math.round(ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale);break;case 2:r=this._parseTweenFrame(e,i,a);n=this._frameFloatArray.length;this._frameFloatArray.length+=2,this._frameFloatArray[n]=ObjectDataParser._getNumber(e,t.DataParser.X,this._frameDefaultValue)*this._frameValueScale,this._frameFloatArray[n+1]=ObjectDataParser._getNumber(e,t.DataParser.Y,this._frameDefaultValue)*this._frameValueScale}return r},ObjectDataParser.prototype._parseActionFrame=function(t,e,i){var a=this._frameArray.length,r=t.actions.length;this._frameArray.length+=2+r,this._frameArray[a+0]=e,this._frameArray[a+0+1]=r;for(var n=0;n<r;++n)this._frameArray[a+0+2+n]=t.actions[n];return a},ObjectDataParser.prototype._parseZOrderFrame=function(e,i,a){var r=this._parseFrame(e,i,a);if(t.DataParser.Z_ORDER in e){var n=e[t.DataParser.Z_ORDER];if(n.length>0){for(var s=this._armature.sortedSlots.length,o=new Array(s-n.length/2),h=new Array(s),l=0;l<o.length;++l)o[l]=0;for(var c=0;c<s;++c)h[c]=-1;for(var u=0,d=0,p=0,m=n.length;p<m;p+=2){for(var f=n[p],g=n[p+1];u!==f;)o[d++]=u++;h[u+g]=u++}for(;u<s;)o[d++]=u++;this._frameArray.length+=1+s,this._frameArray[r+1]=s;for(var y=s;y--;)-1===h[y]?this._frameArray[r+2+y]=o[--d]||0:this._frameArray[r+2+y]=h[y]||0;return r}}return this._frameArray.length+=1,this._frameArray[r+1]=0,r},ObjectDataParser.prototype._parseBoneAllFrame=function(e,i,a){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var r=this._helpTransform.rotation;0!==i&&(0===this._prevClockwise?r=this._prevRotation+t.Transform.normalizeRadian(r-this._prevRotation):((this._prevClockwise>0?r>=this._prevRotation:r<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),r=this._prevRotation+r-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=ObjectDataParser._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=r;var n=this._parseTweenFrame(e,i,a),s=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[s++]=this._helpTransform.x,this._frameFloatArray[s++]=this._helpTransform.y,this._frameFloatArray[s++]=r,this._frameFloatArray[s++]=this._helpTransform.skew,this._frameFloatArray[s++]=this._helpTransform.scaleX,this._frameFloatArray[s++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,i,this._bone,this._slot),n},ObjectDataParser.prototype._parseBoneTranslateFrame=function(e,i,a){var r=this._parseTweenFrame(e,i,a),n=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[n++]=ObjectDataParser._getNumber(e,t.DataParser.X,0),this._frameFloatArray[n++]=ObjectDataParser._getNumber(e,t.DataParser.Y,0),r},ObjectDataParser.prototype._parseBoneRotateFrame=function(e,i,a){var r=ObjectDataParser._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==i&&(0===this._prevClockwise?r=this._prevRotation+t.Transform.normalizeRadian(r-this._prevRotation):((this._prevClockwise>0?r>=this._prevRotation:r<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),r=this._prevRotation+r-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=ObjectDataParser._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=r;var n=this._parseTweenFrame(e,i,a),s=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[s++]=r,this._frameFloatArray[s++]=ObjectDataParser._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,n},ObjectDataParser.prototype._parseBoneScaleFrame=function(e,i,a){var r=this._parseTweenFrame(e,i,a),n=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[n++]=ObjectDataParser._getNumber(e,t.DataParser.X,1),this._frameFloatArray[n++]=ObjectDataParser._getNumber(e,t.DataParser.Y,1),r},ObjectDataParser.prototype._parseSlotDisplayFrame=function(e,i,a){var r=this._parseFrame(e,i,a);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[r+1]=ObjectDataParser._getNumber(e,t.DataParser.VALUE,0):this._frameArray[r+1]=ObjectDataParser._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,i,this._slot.parent,this._slot),r},ObjectDataParser.prototype._parseSlotColorFrame=function(e,i,a){var r=this._parseTweenFrame(e,i,a),n=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var s=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var o in s){this._parseColorTransform(s,this._helpColorTransform),n=this._colorArray.length,this._colorArray.length+=8,this._colorArray[n++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._colorArray[n++]=Math.round(100*this._helpColorTransform.redMultiplier),this._colorArray[n++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._colorArray[n++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._colorArray[n++]=Math.round(this._helpColorTransform.alphaOffset),this._colorArray[n++]=Math.round(this._helpColorTransform.redOffset),this._colorArray[n++]=Math.round(this._helpColorTransform.greenOffset),this._colorArray[n++]=Math.round(this._helpColorTransform.blueOffset),n-=8;break}}n<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=n=this._colorArray.length,this._colorArray.length+=8,this._colorArray[n++]=100,this._colorArray[n++]=100,this._colorArray[n++]=100,this._colorArray[n++]=100,this._colorArray[n++]=0,this._colorArray[n++]=0,this._colorArray[n++]=0,this._colorArray[n++]=0),n=this._defaultColorOffset);var h=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[h]=n,r},ObjectDataParser.prototype._parseSlotDeformFrame=function(e,i,a){var r=this._frameFloatArray.length,n=this._parseTweenFrame(e,i,a),s=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,o=ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0),h=this._intArray[this._mesh.geometry.offset+0],l=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,c=this._mesh.geometry.weight,u=0,d=0,p=0,m=0;if(null!==c){var f=this._weightSlotPose[l];this._helpMatrixA.copyFromArray(f,0),this._frameFloatArray.length+=2*c.count,p=c.offset+2+c.bones.length}else this._frameFloatArray.length+=2*h;for(var g=0;g<2*h;g+=2)if(null===s?(u=0,d=0):(u=g<o||g-o>=s.length?0:s[g-o],d=g+1<o||g+1-o>=s.length?0:s[g+1-o]),null!==c){var y=this._weightBonePoses[l],_=this._intArray[p++];this._helpMatrixA.transformPoint(u,d,this._helpPoint,!0),u=this._helpPoint.x,d=this._helpPoint.y;for(var v=0;v<_;++v){var b=this._intArray[p++];this._helpMatrixB.copyFromArray(y,7*b+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(u,d,this._helpPoint,!0),this._frameFloatArray[r+m++]=this._helpPoint.x,this._frameFloatArray[r+m++]=this._helpPoint.y}}else this._frameFloatArray[r+g]=u,this._frameFloatArray[r+g+1]=d;if(0===i){var P=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[P+0]=this._mesh.geometry.offset,this._frameIntArray[P+1]=this._frameFloatArray.length-r,this._frameIntArray[P+2]=this._frameFloatArray.length-r,this._frameIntArray[P+3]=0,this._frameIntArray[P+4]=r-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=P-this._animation.frameIntOffset}return n},ObjectDataParser.prototype._parseIKConstraintFrame=function(e,i,a){var r=this._parseTweenFrame(e,i,a),n=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[n++]=ObjectDataParser._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[n++]=Math.round(100*ObjectDataParser._getNumber(e,t.DataParser.WEIGHT,1)),r},ObjectDataParser.prototype._parseActionData=function(e,i,a,r){var n=new Array;if("string"==typeof e)(l=t.BaseObject.borrowObject(t.ActionData)).type=i,l.name=e,l.bone=a,l.slot=r,n.push(l);else if(e instanceof Array)for(var s=0,o=e;s<o.length;s++){var h=o[s],l=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in h?(l.type=0,l.name=ObjectDataParser._getString(h,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in h&&"string"==typeof h[t.DataParser.TYPE]?l.type=t.DataParser._getActionType(h[t.DataParser.TYPE]):l.type=ObjectDataParser._getNumber(h,t.DataParser.TYPE,i),l.name=ObjectDataParser._getString(h,t.DataParser.NAME,"")),t.DataParser.BONE in h){var c=ObjectDataParser._getString(h,t.DataParser.BONE,"");l.bone=this._armature.getBone(c)}else l.bone=a;if(t.DataParser.SLOT in h){var u=ObjectDataParser._getString(h,t.DataParser.SLOT,"");l.slot=this._armature.getSlot(u)}else l.slot=r;var d=null;if(t.DataParser.INTS in h){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var p=0,m=h[t.DataParser.INTS];p<m.length;p++){var f=m[p];d.addInt(f)}}if(t.DataParser.FLOATS in h){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var g=0,y=h[t.DataParser.FLOATS];g<y.length;g++){f=y[g];d.addFloat(f)}}if(t.DataParser.STRINGS in h){null===d&&(d=t.BaseObject.borrowObject(t.UserData));for(var _=0,v=h[t.DataParser.STRINGS];_<v.length;_++){f=v[_];d.addString(f)}}l.data=d,n.push(l)}return n},ObjectDataParser.prototype._parseDeformFrame=function(e,i,a){var r=this._frameFloatArray.length,n=this._parseTweenFrame(e,i,a),s=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:t.DataParser.VALUE in e?e[t.DataParser.VALUE]:null,o=ObjectDataParser._getNumber(e,t.DataParser.OFFSET,0),h=this._intArray[this._geometry.offset+0],l=0,c=0;if(null!==this._geometry.weight);else{this._frameFloatArray.length+=2*h;for(var u=0;u<2*h;u+=2)null!==s?(l=u<o||u-o>=s.length?0:s[u-o],c=u+1<o||u+1-o>=s.length?0:s[u+1-o]):(l=0,c=0),this._frameFloatArray[r+u]=l,this._frameFloatArray[r+u+1]=c}if(0===i){var d=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[d+0]=this._geometry.offset,this._frameIntArray[d+1]=this._frameFloatArray.length-r,this._frameIntArray[d+2]=this._frameFloatArray.length-r,this._frameIntArray[d+3]=0,this._frameIntArray[d+4]=r-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=d-this._animation.frameIntOffset}return n},ObjectDataParser.prototype._parseTransform=function(e,i,a){i.x=ObjectDataParser._getNumber(e,t.DataParser.X,0)*a,i.y=ObjectDataParser._getNumber(e,t.DataParser.Y,0)*a,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(i.rotation=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(i.rotation=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(ObjectDataParser._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-i.rotation),i.scaleX=ObjectDataParser._getNumber(e,t.DataParser.SCALE_X,1),i.scaleY=ObjectDataParser._getNumber(e,t.DataParser.SCALE_Y,1)},ObjectDataParser.prototype._parseColorTransform=function(e,i){i.alphaMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),i.redMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.RED_MULTIPLIER,100),i.greenMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),i.blueMultiplier=.01*ObjectDataParser._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),i.alphaOffset=ObjectDataParser._getNumber(e,t.DataParser.ALPHA_OFFSET,0),i.redOffset=ObjectDataParser._getNumber(e,t.DataParser.RED_OFFSET,0),i.greenOffset=ObjectDataParser._getNumber(e,t.DataParser.GREEN_OFFSET,0),i.blueOffset=ObjectDataParser._getNumber(e,t.DataParser.BLUE_OFFSET,0)},ObjectDataParser.prototype._parseGeometry=function(e,i){var a=e[t.DataParser.VERTICES],r=Math.floor(a.length/2),n=0,s=this._intArray.length,o=this._floatArray.length;i.offset=s,i.data=this._data,this._intArray.length+=4,this._intArray[s+0]=r,this._intArray[s+2]=o,this._intArray[s+3]=-1,this._floatArray.length+=2*r;for(var h=0,l=2*r;h<l;++h)this._floatArray[o+h]=a[h];if(t.DataParser.TRIANGLES in e){var c=e[t.DataParser.TRIANGLES];n=Math.floor(c.length/3),this._intArray.length+=3*n;for(h=0,l=3*n;h<l;++h)this._intArray[s+4+h]=c[h]}if(this._intArray[s+1]=n,t.DataParser.UVS in e){var u=e[t.DataParser.UVS],d=o+2*r;this._floatArray.length+=2*r;for(h=0,l=2*r;h<l;++h)this._floatArray[d+h]=u[h]}if(t.DataParser.WEIGHTS in e){var p=e[t.DataParser.WEIGHTS],m=Math.floor(p.length-r)/2,f=this._intArray.length,g=this._floatArray.length,y=0,_=this._armature.sortedBones,v=t.BaseObject.borrowObject(t.WeightData);if(v.count=m,v.offset=f,this._intArray.length+=2+y+r+m,this._intArray[f+1]=g,t.DataParser.BONE_POSE in e){var b=e[t.DataParser.SLOT_POSE],P=e[t.DataParser.BONE_POSE],S=new Array;y=Math.floor(P.length/7),S.length=y;for(h=0;h<y;++h){var D=P[7*h],T=this._rawBones[D];v.addBone(T),S[h]=D,this._intArray[f+2+h]=_.indexOf(T)}this._floatArray.length+=3*m,this._helpMatrixA.copyFromArray(b,0);h=0;for(var x=0,C=f+2+y,O=g;h<r;++h){var M=2*h,w=this._intArray[C++]=p[x++],A=this._floatArray[o+M],E=this._floatArray[o+M+1];this._helpMatrixA.transformPoint(A,E,this._helpPoint),A=this._helpPoint.x,E=this._helpPoint.y;for(var B=0;B<w;++B){D=p[x++];var I=S.indexOf(D);this._helpMatrixB.copyFromArray(P,7*I+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(A,E,this._helpPoint),this._intArray[C++]=I,this._floatArray[O++]=p[x++],this._floatArray[O++]=this._helpPoint.x,this._floatArray[O++]=this._helpPoint.y}}}else{var k=e[t.DataParser.BONES];y=k.length;for(h=0;h<y;h++){D=k[h],T=this._rawBones[D];v.addBone(T),this._intArray[f+2+h]=_.indexOf(T)}this._floatArray.length+=3*m;h=0,x=0,O=0,C=f+2+y;for(var R=g;h<m;h++){w=p[x++];this._intArray[C++]=w;for(B=0;B<w;B++){I=p[x++];var j=p[x++];A=a[O++],E=a[O++];this._intArray[C++]=k.indexOf(I),this._floatArray[R++]=j,this._floatArray[R++]=A,this._floatArray[R++]=E}}}i.weight=v}},ObjectDataParser.prototype._parseArray=function(t){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0,this._colorArray.length=0},ObjectDataParser.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0),this._timelineArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._colorArray.push(0);for(var t=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,e=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,a=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,r=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,s=this._colorArray.length*Int16Array.BYTES_PER_ELEMENT,o=new ArrayBuffer(t+e+i+a+r+n+s),h=new Int16Array(o,0,this._intArray.length),l=new Float32Array(o,t,this._floatArray.length),c=new Int16Array(o,t+e,this._frameIntArray.length),u=new Float32Array(o,t+e+i,this._frameFloatArray.length),d=new Int16Array(o,t+e+i+a,this._frameArray.length),p=new Uint16Array(o,t+e+i+a+r,this._timelineArray.length),m=new Int16Array(o,t+e+i+a+r+n,this._colorArray.length),f=0,g=this._intArray.length;f<g;++f)h[f]=this._intArray[f];for(f=0,g=this._floatArray.length;f<g;++f)l[f]=this._floatArray[f];for(f=0,g=this._frameIntArray.length;f<g;++f)c[f]=this._frameIntArray[f];for(f=0,g=this._frameFloatArray.length;f<g;++f)u[f]=this._frameFloatArray[f];for(f=0,g=this._frameArray.length;f<g;++f)d[f]=this._frameArray[f];for(f=0,g=this._timelineArray.length;f<g;++f)p[f]=this._timelineArray[f];for(f=0,g=this._colorArray.length;f<g;++f)m[f]=this._colorArray[f];this._data.binary=o,this._data.intArray=h,this._data.floatArray=l,this._data.frameIntArray=c,this._data.frameFloatArray=u,this._data.frameArray=d,this._data.timelineArray=p,this._data.colorArray=m,this._defaultColorOffset=-1},ObjectDataParser.prototype.parseDragonBonesData=function(e,i){void 0===i&&(i=1),console.assert(null!=e,"Data error.");var a=ObjectDataParser._getString(e,t.DataParser.VERSION,""),r=ObjectDataParser._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(a)>=0||t.DataParser.DATA_VERSIONS.indexOf(r)>=0){var n=t.BaseObject.borrowObject(t.DragonBonesData);if(n.version=a,n.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),n.frameRate=ObjectDataParser._getNumber(e,t.DataParser.FRAME_RATE,24),0===n.frameRate&&(n.frameRate=24),t.DataParser.ARMATURE in e){this._data=n,this._parseArray(e);for(var s=0,o=e[t.DataParser.ARMATURE];s<o.length;s++){var h=o[s];n.addArmature(this._parseArmature(h,i))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?n.stage=n.getArmature(ObjectDataParser._getString(e,t.DataParser.STAGE,"")):n.armatureNames.length>0&&(n.stage=n.getArmature(n.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),n}return console.assert(!1,"Nonsupport data version: "+a+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},ObjectDataParser.prototype.parseTextureAtlasData=function(e,i,a){if(void 0===a&&(a=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var r=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(r,i,a),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(i.width=ObjectDataParser._getNumber(e,t.DataParser.WIDTH,0),i.height=ObjectDataParser._getNumber(e,t.DataParser.HEIGHT,0),i.scale=1===a?1/ObjectDataParser._getNumber(e,t.DataParser.SCALE,1):a,i.name=ObjectDataParser._getString(e,t.DataParser.NAME,""),i.imagePath=ObjectDataParser._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var n=e[t.DataParser.SUB_TEXTURE],s=0,o=n.length;s<o;++s){var h=n[s],l=ObjectDataParser._getNumber(h,t.DataParser.FRAME_WIDTH,-1),c=ObjectDataParser._getNumber(h,t.DataParser.FRAME_HEIGHT,-1),u=i.createTexture();u.rotated=ObjectDataParser._getBoolean(h,t.DataParser.ROTATED,!1),u.name=ObjectDataParser._getString(h,t.DataParser.NAME,""),u.region.x=ObjectDataParser._getNumber(h,t.DataParser.X,0),u.region.y=ObjectDataParser._getNumber(h,t.DataParser.Y,0),u.region.width=ObjectDataParser._getNumber(h,t.DataParser.WIDTH,0),u.region.height=ObjectDataParser._getNumber(h,t.DataParser.HEIGHT,0),l>0&&c>0&&(u.frame=t.TextureData.createRectangle(),u.frame.x=ObjectDataParser._getNumber(h,t.DataParser.FRAME_X,0),u.frame.y=ObjectDataParser._getNumber(h,t.DataParser.FRAME_Y,0),u.frame.width=l,u.frame.height=c),i.addTexture(u)}return!0},ObjectDataParser.getInstance=function(){return null===ObjectDataParser._objectDataParserInstance&&(ObjectDataParser._objectDataParserInstance=new ObjectDataParser),ObjectDataParser._objectDataParserInstance},ObjectDataParser._objectDataParserInstance=null,ObjectDataParser}(t.DataParser);t.ObjectDataParser=e;var i=function i(){this.frameStart=0,this.actions=[]};t.ActionFrame=i}(l||(l={})),function(t){var e=function(e){function BinaryDataParser(){return null!==e&&e.apply(this,arguments)||this}return r(BinaryDataParser,e),BinaryDataParser.prototype._inRange=function(t,e,i){return e<=t&&t<=i},BinaryDataParser.prototype._decodeUTF8=function(t){for(var e,i=0,a="",r=0,n=0,s=0,o=0;t.length>i;){var h=t[i++];if(-1===h)e=0!==n?65533:-1;else if(0===n)this._inRange(h,0,127)?e=h:(this._inRange(h,194,223)?(n=1,o=128,r=h-192):this._inRange(h,224,239)?(n=2,o=2048,r=h-224):this._inRange(h,240,244)&&(n=3,o=65536,r=h-240),r*=Math.pow(64,n),e=null);else if(this._inRange(h,128,191))if(s+=1,r+=(h-128)*Math.pow(64,n-s),s!==n)e=null;else{var l=r,c=o;r=0,n=0,s=0,o=0,e=this._inRange(l,c,1114111)&&!this._inRange(l,55296,57343)?l:h}else r=0,n=0,s=0,o=0,i--,e=h;null!==e&&-1!==e&&(e<=65535?e>0&&(a+=String.fromCharCode(e)):(e-=65536,a+=String.fromCharCode(55296+(e>>10&1023)),a+=String.fromCharCode(56320+(1023&e))))}return a},BinaryDataParser.prototype._parseBinaryTimeline=function(e,i,a){void 0===a&&(a=null);var r=null!==a?a:t.BaseObject.borrowObject(t.TimelineData);r.type=e,r.offset=i,this._timeline=r;var n=this._timelineArrayBuffer[r.offset+2];if(1===n)r.frameIndicesOffset=-1;else{var s,o=this._animation.frameCount+1,h=this._data.frameIndices;s=h.length,h.length+=o,r.frameIndicesOffset=s;for(var l=0,c=0,u=0,d=0;l<o;++l)u+d<=l&&c<n&&(u=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+c]],d=c===n-1?this._animation.frameCount-u:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+c+1]]-u,c++),h[s+l]=c-1}return this._timeline=null,r},BinaryDataParser.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);i.blendType=t.DataParser._getAnimationBlendType(t.ObjectDataParser._getString(e,t.DataParser.BLEND_TYPE,"")),i.frameCount=t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,0),i.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),i.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),i.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.DataParser.DEFAULT_NAME);var a=e[t.DataParser.OFFSET];if(i.frameIntOffset=a[0],i.frameFloatOffset=a[1],i.frameOffset=a[2],this._animation=i,t.DataParser.ACTION in e&&(i.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(i.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var r=e[t.DataParser.BONE];for(var n in r){var s=r[n],o=this._armature.getBone(n);if(null!==o)for(var h=0,l=s.length;h<l;h+=2){var c=s[h],u=s[h+1],d=this._parseBinaryTimeline(c,u);this._animation.addBoneTimeline(o.name,d)}}}if(t.DataParser.SLOT in e){r=e[t.DataParser.SLOT];for(var n in r){s=r[n];var p=this._armature.getSlot(n);if(null!==p)for(h=0,l=s.length;h<l;h+=2){c=s[h],u=s[h+1],d=this._parseBinaryTimeline(c,u);this._animation.addSlotTimeline(p.name,d)}}}if(t.DataParser.CONSTRAINT in e){r=e[t.DataParser.CONSTRAINT];for(var n in r){s=r[n];var m=this._armature.getConstraint(n);if(null!==m)for(h=0,l=s.length;h<l;h+=2){c=s[h],u=s[h+1],d=this._parseBinaryTimeline(c,u);this._animation.addConstraintTimeline(m.name,d)}}}if(t.DataParser.TIMELINE in e)for(var f=0,g=s=e[t.DataParser.TIMELINE];f<g.length;f++){var y=g[f];if((u=t.ObjectDataParser._getNumber(y,t.DataParser.OFFSET,0))>=0){c=t.ObjectDataParser._getNumber(y,t.DataParser.TYPE,0);var _=t.ObjectDataParser._getString(y,t.DataParser.NAME,"");d=null;if(40===c&&0!==i.blendType){var v=d=t.BaseObject.borrowObject(t.AnimationTimelineData);v.x=t.ObjectDataParser._getNumber(y,t.DataParser.X,0),v.y=t.ObjectDataParser._getNumber(y,t.DataParser.Y,0)}switch(d=this._parseBinaryTimeline(c,u,d),c){case 0:case 1:break;case 11:case 12:case 13:case 50:case 60:this._animation.addBoneTimeline(_,d);break;case 20:case 21:case 22:case 23:case 24:this._animation.addSlotTimeline(_,d);break;case 30:this._animation.addConstraintTimeline(_,d);break;case 40:case 41:case 42:this._animation.addAnimationTimeline(_,d)}}}return this._animation=null,i},BinaryDataParser.prototype._parseGeometry=function(e,i){i.offset=e[t.DataParser.OFFSET],i.data=this._data;var a=this._intArrayBuffer[i.offset+3];if(a>=0){var r=t.BaseObject.borrowObject(t.WeightData),n=this._intArrayBuffer[i.offset+0],s=this._intArrayBuffer[a+0];r.offset=a;for(var o=0;o<s;++o){var h=this._intArrayBuffer[a+2+o];r.addBone(this._rawBones[h])}for(var l=a+2+s,c=0,u=(o=0,n);o<u;++o){var d=this._intArrayBuffer[l++];c+=d,l+=d}r.count=c,i.weight=r}},BinaryDataParser.prototype._parseArray=function(e){var i=e[t.DataParser.OFFSET],a=i[1],r=i[3],n=i[5],s=i[7],o=i[9],h=i[11],l=i.length>12?i[13]:0,c=new Int16Array(this._binary,this._binaryOffset+i[0],a/Int16Array.BYTES_PER_ELEMENT),u=new Float32Array(this._binary,this._binaryOffset+i[2],r/Float32Array.BYTES_PER_ELEMENT),d=new Int16Array(this._binary,this._binaryOffset+i[4],n/Int16Array.BYTES_PER_ELEMENT),p=new Float32Array(this._binary,this._binaryOffset+i[6],s/Float32Array.BYTES_PER_ELEMENT),m=new Int16Array(this._binary,this._binaryOffset+i[8],o/Int16Array.BYTES_PER_ELEMENT),f=new Uint16Array(this._binary,this._binaryOffset+i[10],h/Uint16Array.BYTES_PER_ELEMENT),g=l>0?new Int16Array(this._binary,this._binaryOffset+i[12],l/Int16Array.BYTES_PER_ELEMENT):c;this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=c,this._data.floatArray=u,this._data.frameIntArray=d,this._data.frameFloatArray=p,this._data.frameArray=this._frameArrayBuffer=m,this._data.timelineArray=this._timelineArrayBuffer=f,this._data.colorArray=g},BinaryDataParser.prototype.parseDragonBonesData=function(t,i){void 0===i&&(i=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var a=new Uint8Array(t,0,8);if(a[0]!=="D".charCodeAt(0)||a[1]!=="B".charCodeAt(0)||a[2]!=="D".charCodeAt(0)||a[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var r=new Uint32Array(t,8,1)[0],n=new Uint8Array(t,12,r),s=this._decodeUTF8(n),o=JSON.parse(s);return this._binaryOffset=12+r,this._binary=t,e.prototype.parseDragonBonesData.call(this,o,i)},BinaryDataParser.getInstance=function(){return null===BinaryDataParser._binaryDataParserInstance&&(BinaryDataParser._binaryDataParserInstance=new BinaryDataParser),BinaryDataParser._binaryDataParserInstance},BinaryDataParser._binaryDataParserInstance=null,BinaryDataParser}(t.ObjectDataParser);t.BinaryDataParser=e}(l||(l={})),function(t){var e=function(){function BaseFactory(e){void 0===e&&(e=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===BaseFactory._objectParser&&(BaseFactory._objectParser=new t.ObjectDataParser),null===BaseFactory._binaryParser&&(BaseFactory._binaryParser=new t.BinaryDataParser),this._dataParser=null!==e?e:BaseFactory._objectParser}return BaseFactory.prototype._isSupportMesh=function(){return!0},BaseFactory.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,a=this._textureAtlasDataMap[t];i<a.length;i++){if(null!==(h=(o=a[i]).getTexture(e)))return h}if(this.autoSearch)for(var r in this._textureAtlasDataMap)for(var n=0,s=this._textureAtlasDataMap[r];n<s.length;n++){var o,h;if((o=s[n]).autoSearch)if(null!==(h=o.getTexture(e)))return h}return null},BaseFactory.prototype._fillBuildArmaturePackage=function(t,e,i,a,r){var n=null,s=null;if(e.length>0&&e in this._dragonBonesDataMap&&(s=(n=this._dragonBonesDataMap[e]).getArmature(i)),null===s&&(0===e.length||this.autoSearch))for(var o in this._dragonBonesDataMap)if(n=this._dragonBonesDataMap[o],(0===e.length||n.autoSearch)&&null!==(s=n.getArmature(i))){e=o;break}if(null!==s){if(t.dataName=e,t.textureAtlasName=r,t.data=n,t.armature=s,t.skin=null,a.length>0&&(t.skin=s.getSkin(a),null===t.skin&&this.autoSearch))for(var o in this._dragonBonesDataMap){var h=this._dragonBonesDataMap[o].getArmature(a);if(null!==h){t.skin=h.defaultSkin;break}}return null===t.skin&&(t.skin=s.defaultSkin),!0}return!1},BaseFactory.prototype._buildBones=function(e,i){for(var a=0,r=e.armature.sortedBones;a<r.length;a++){var n=r[a];t.BaseObject.borrowObject(0===n.type?t.Bone:t.Surface).init(n,i)}},BaseFactory.prototype._buildSlots=function(t,e){var i=t.skin,a=t.armature.defaultSkin;if(null!==i&&null!==a){var r={};for(var n in a.displays){var s=a.getDisplays(n);r[n]=s}if(i!==a)for(var n in i.displays){s=i.getDisplays(n);r[n]=s}for(var o=0,h=t.armature.sortedSlots;o<h.length;o++){var l=h[o],c=l.name in r?r[l.name]:null,u=this._buildSlot(t,l,e);if(null!==c){u.displayFrameCount=c.length;for(var d=0,p=u.displayFrameCount;d<p;++d){var m=c[d];if(u.replaceRawDisplayData(m,d),null!==m){if(t.textureAtlasName.length>0){var f=this._getTextureData(t.textureAtlasName,m.path);u.replaceTextureData(f,d)}var g=this._getSlotDisplay(t,m,u);u.replaceDisplay(g,d)}else u.replaceDisplay(null)}}u._setDisplayIndex(l.displayIndex,!0)}}},BaseFactory.prototype._buildConstraints=function(e,i){var a=e.armature.constraints;for(var r in a){var n=a[r];switch(n.type){case 0:var s=t.BaseObject.borrowObject(t.IKConstraint);s.init(n,i),i._addConstraint(s);break;case 1:var o=t.BaseObject.borrowObject(t.PathConstraint);o.init(n,i),i._addConstraint(o);break;default:var h=t.BaseObject.borrowObject(t.IKConstraint);h.init(n,i),i._addConstraint(h)}}},BaseFactory.prototype._buildChildArmature=function(t,e,i){return this.buildArmature(i.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},BaseFactory.prototype._getSlotDisplay=function(e,i,a){var r=null!==e?e.dataName:i.parent.parent.parent.name,n=null;switch(i.type){case 0:var s=i;null===s.texture&&(s.texture=this._getTextureData(r,i.path)),n=a.rawDisplay;break;case 2:var o=i;null===o.texture&&(o.texture=this._getTextureData(r,o.path)),n=this._isSupportMesh()?a.meshDisplay:a.rawDisplay;break;case 1:var h=i,l=this._buildChildArmature(e,a,h);if(null!==l){if(l.inheritAnimation=h.inheritAnimation,!l.inheritAnimation){var c=h.actions.length>0?h.actions:l.armatureData.defaultActions;if(c.length>0)for(var u=0,d=c;u<d.length;u++){var p=d[u],m=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(p,m,a.armature),m.slot=a,a.armature._bufferAction(m,!1)}else l.animation.play()}h.armature=l.armatureData}n=l}return n},BaseFactory.prototype.parseDragonBonesData=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=1);for(var a=t instanceof ArrayBuffer?BaseFactory._binaryParser:this._dataParser,r=a.parseDragonBonesData(t,i);;){var n=this._buildTextureAtlasData(null,null);if(!a.parseTextureAtlasData(null,n,i)){n.returnToPool();break}this.addTextureAtlasData(n,e)}return null!==r&&this.addDragonBonesData(r,e),r},BaseFactory.prototype.parseTextureAtlasData=function(t,e,i,a){void 0===i&&(i=null),void 0===a&&(a=1);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,a),this._buildTextureAtlasData(r,e||null),this.addTextureAtlasData(r,i),r},BaseFactory.prototype.updateTextureAtlases=function(t,e){var i=this.getTextureAtlasData(e);if(null!==i)for(var a=0,r=i.length;a<r;++a)a<t.length&&this._buildTextureAtlasData(i[a],t[a])},BaseFactory.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},BaseFactory.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},BaseFactory.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},BaseFactory.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},BaseFactory.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var i=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];i.indexOf(t)<0&&i.push(t)},BaseFactory.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var a=0,r=i;a<r.length;a++){var n=r[a];this._dragonBones.bufferObject(n)}delete this._textureAtlasDataMap[t]}},BaseFactory.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var a=new i;return this._fillBuildArmaturePackage(a,e,t,"","")?a.armature:null},BaseFactory.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=0,a=this._textureAtlasDataMap[e];i<a.length;i++){var r=a[i];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[e]}},BaseFactory.prototype.buildArmature=function(t,e,a,r){void 0===e&&(e=""),void 0===a&&(a=""),void 0===r&&(r="");var n=new i;if(!this._fillBuildArmaturePackage(n,e||"",t,a||"",r||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var s=this._buildArmature(n);return this._buildBones(n,s),this._buildSlots(n,s),this._buildConstraints(n,s),s.invalidUpdate(null,!0),s.advanceTime(0),s},BaseFactory.prototype.replaceDisplay=function(t,e,i){if(void 0===i&&(i=-1),i<0&&(i=t.displayIndex),i<0&&(i=0),t.replaceDisplayData(e,i),null!==e){var a=this._getSlotDisplay(null,e,t);if(0===e.type){var r=t.getDisplayFrameAt(i).rawDisplayData;null!==r&&2===r.type&&(a=t.meshDisplay)}t.replaceDisplay(a,i)}else t.replaceDisplay(null,i)},BaseFactory.prototype.replaceSlotDisplay=function(t,e,i,a,r,n){void 0===n&&(n=-1);var s=this.getArmatureData(e,t||"");if(null===s||null===s.defaultSkin)return!1;var o=s.defaultSkin.getDisplay(i,a);return this.replaceDisplay(r,o,n),!0},BaseFactory.prototype.replaceSlotDisplayList=function(t,e,i,a){var r=this.getArmatureData(e,t||"");if(!r||!r.defaultSkin)return!1;var n=r.defaultSkin.getDisplays(i);if(!n)return!1;a.displayFrameCount=n.length;for(var s=0,o=a.displayFrameCount;s<o;++s){var h=n[s];this.replaceDisplay(a,h,s)}return!0},BaseFactory.prototype.replaceSkin=function(t,e,i,a){void 0===i&&(i=!1),void 0===a&&(a=null);for(var r=!1,n=e.parent.defaultSkin,s=0,o=t.getSlots();s<o.length;s++){var h=o[s];if(!(null!==a&&a.indexOf(h.name)>=0)){var l=e.getDisplays(h.name);if(null!==l||(null!==n&&e!==n&&(l=n.getDisplays(h.name)),null!==l)){h.displayFrameCount=l.length;for(var c=0,u=h.displayFrameCount;c<u;++c){var d=l[c];h.replaceRawDisplayData(d,c),null!==d?h.replaceDisplay(this._getSlotDisplay(null,d,h),c):h.replaceDisplay(null,c)}r=!0}else i&&(h.displayFrameCount=0)}}return r},BaseFactory.prototype.replaceAnimation=function(e,i,a){void 0===a&&(a=!0);var r=i.defaultSkin;if(null===r)return!1;if(a)e.animation.animations=i.animations;else{var n=e.animation.animations,s={};for(var o in n)s[o]=n[o];for(var o in i.animations)s[o]=i.animations[o];e.animation.animations=s}for(var h=0,l=e.getSlots();h<l.length;h++)for(var c=l[h],u=0,d=0,p=c.displayList;d<p.length;d++){var m=p[d];if(m instanceof t.Armature){var f=r.getDisplays(c.name);if(null!==f&&u<f.length){var g=f[u];if(null!==g&&1===g.type){var y=this.getArmatureData(g.path,g.parent.parent.parent.name);y&&this.replaceAnimation(m,y,a)}}}u++}return!0},BaseFactory.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},BaseFactory.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(BaseFactory.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(BaseFactory.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),BaseFactory._objectParser=null,BaseFactory._binaryParser=null,BaseFactory}();t.BaseFactory=e;var i=function i(){this.dataName="",this.textureAtlasName="",this.skin=null};t.BuildArmaturePackage=i}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function EventDispatcher(){return null!==t&&t.apply(this,arguments)||this}return r(EventDispatcher,t),EventDispatcher.prototype.hasDBEventListener=function(t){return this.listenerCount(t)>0},EventDispatcher.prototype.dispatchDBEvent=function(t,e){this.emit(t,e)},EventDispatcher.prototype.addDBEventListener=function(t,e,i){this.on(t,e,i)},EventDispatcher.prototype.removeDBEventListener=function(t,e,i){this.off(t,e,i)},EventDispatcher}(Phaser.Events.EventEmitter);t.EventDispatcher=e}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){t.Skew={getSkewX:function(){return this._skewX||0},setSkewX:function(t){this._skewX=t},getSkewY:function(){return this._skewY||0},setSkewY:function(t){this._skewY=t},setSkew:function(t,e){e=void 0===e?t:e,this._skewX=t,this._skewY=e}},t.extendSkew=function(e){Object.defineProperty(e.prototype,"skewX",{get:t.Skew.getSkewX,set:t.Skew.setSkewX,enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewY",{get:t.Skew.getSkewY,set:t.Skew.setSkewY,enumerable:!0,configurable:!0}),e.prototype.setSkew=t.Skew.setSkew}}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function TransformMatrix(e,i,a,r,n,s){var o=t.call(this,e,i,a,r,n,s)||this;return o.decomposedMatrix.skewX=0,o.decomposedMatrix.skewY=0,o}return r(TransformMatrix,t),TransformMatrix.prototype.decomposeMatrix=function(){var t=this.a,e=this.b,i=this.c,a=this.d,r=-Math.atan2(-i,a),n=Math.atan2(e,t),s=Math.abs(r+n);return s<1e-5||Math.abs(Phaser.Math.PI2-s)<1e-5?(this.decomposedMatrix.rotation=n,t<0&&a>=0&&(this.decomposedMatrix.rotation+=this.decomposedMatrix.rotation<=0?Math.PI:-Math.PI),this.decomposedMatrix.skewX=this.decomposedMatrix.skewY=0):(this.decomposedMatrix.rotation=0,this.decomposedMatrix.skewX=r,this.decomposedMatrix.skewY=n),this.decomposedMatrix.scaleX=Math.sqrt(t*t+e*e),this.decomposedMatrix.scaleY=Math.sqrt(i*i+a*a),this.decomposedMatrix.translateX=this.tx,this.decomposedMatrix.translateY=this.ty,this.decomposedMatrix},TransformMatrix.prototype.applyITRSC=function(t,e,i,a,r,n,s){return this.a=Math.cos(i-s)*a,this.b=Math.sin(i-s)*a,this.c=-Math.sin(i+n)*r,this.d=Math.cos(i+n)*r,this.tx=t,this.ty=e,this},Object.defineProperty(TransformMatrix.prototype,"skewX",{get:function(){return-Math.atan2(-this.c,this.d)},enumerable:!0,configurable:!0}),Object.defineProperty(TransformMatrix.prototype,"skewY",{get:function(){return Math.atan2(this.b,this.a)},enumerable:!0,configurable:!0}),TransformMatrix}(Phaser.GameObjects.Components.TransformMatrix);t.TransformMatrix=e}(t.util||(t.util={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(e){function DisplayContainer(i,a,r,n){var s=e.call(this,i,a,r,n)||this;return s._skewX=0,s._skewY=0,s.tempTransformMatrix=new t.util.TransformMatrix,s}return r(DisplayContainer,e),DisplayContainer.prototype.pointToContainer=function(t,e){if(void 0===e&&(e=new Phaser.Math.Vector2),this.parentContainer)return this.parentContainer.pointToContainer(t,e);var i=this.tempTransformMatrix;return i.applyITRSC(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this._skewX,this._skewY),i.invert(),i.transformPoint(t.x,t.y,e),e},Object.defineProperty(DisplayContainer.prototype,"skewX",{get:function(){return this._skewX},set:function(t){this._skewX=t},enumerable:!0,configurable:!0}),Object.defineProperty(DisplayContainer.prototype,"skewY",{get:function(){return this._skewY},set:function(t){this._skewY=t},enumerable:!0,configurable:!0}),DisplayContainer.prototype.setSkew=function(t,e){return e=void 0===e?t:e,this.skewX=t,this.skewY=e,this},DisplayContainer}(Phaser.GameObjects.Container);e.DisplayContainer=i}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(t){function ArmatureDisplay(e){var i=t.call(this,e)||this;return i.debugDraw=!1,i}return r(ArmatureDisplay,t),ArmatureDisplay.prototype.dbInit=function(t){this._armature=t},ArmatureDisplay.prototype.dbClear=function(){this.removeAllListeners(),this._armature&&this._armature.dispose(),this._armature=null},ArmatureDisplay.prototype.dbUpdate=function(){this.debugDraw},ArmatureDisplay.prototype.dispose=function(e){this.dbClear(),!0===e&&t.prototype.destroy.call(this)},ArmatureDisplay.prototype.destroy=function(){this.dispose(!0)},ArmatureDisplay.prototype.dispatchDBEvent=function(t,e){this.emit(t,e)},ArmatureDisplay.prototype.hasDBEventListener=function(t){return this.listenerCount(t)>0},ArmatureDisplay.prototype.addDBEventListener=function(t,e,i){this.on(t,e,i)},ArmatureDisplay.prototype.removeDBEventListener=function(t,e,i){this.off(t,e,i)},Object.defineProperty(ArmatureDisplay.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(ArmatureDisplay.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),ArmatureDisplay}(t.DisplayContainer);t.ArmatureDisplay=e}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(t){function SlotImage(e,i,a,r,n){var s=t.call(this,e,i,a,r,n)||this;return s.setPipeline("PhaserTextureTintPipeline"),s}return r(SlotImage,t),SlotImage}(Phaser.GameObjects.Image);e.SlotImage=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(t){function SlotSprite(e,i,a,r,n){var s=t.call(this,e,i,a,r,n)||this;return s.setPipeline("PhaserTextureTintPipeline"),s}return r(SlotSprite,t),SlotSprite}(Phaser.GameObjects.Sprite);e.SlotSprite=i,t.util.extendSkew(i)}(t.display||(t.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(e){!function(e){var i=function(i){function Slot(){return null!==i&&i.apply(this,arguments)||this}return r(Slot,i),Slot.toString=function(){return"[class dragonBones.PhaserSlot]"},Slot.prototype._onClear=function(){i.prototype._onClear.call(this),this._textureScale=1,this._renderDisplay&&(this._renderDisplay.destroy(),this._renderDisplay=null)},Slot.prototype._initDisplay=function(t,e){},Slot.prototype._disposeDisplay=function(t,e){},Slot.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display||this._rawDisplay},Slot.prototype._addDisplay=function(){this.armature.display.add(this._renderDisplay)},Slot.prototype._replaceDisplay=function(t){this._renderDisplay.setSkew?(this.armature.display.replace(t,this._renderDisplay),this._renderDisplay.parentContainer=this.armature.display):console.warn("please call dragonBones.phaser.util.extendSkew to mix skew component into your display object,\n                                and set its pipeline to 'PhaserTextureTintPipeline' by calling 'setPiepline' method, more detail please refer to the 'ReplaceSlotDisplay.ts' example")},Slot.prototype._removeDisplay=function(){this._renderDisplay.parentContainer.remove(this._renderDisplay)},Slot.prototype._updateZOrder=function(){this._renderDisplay.depth!==this._zOrder&&this._renderDisplay.setDepth(this._zOrder)},Slot.prototype._updateVisible=function(){this._renderDisplay.setVisible(this._parent.visible&&this._visible)},Slot.prototype._updateBlendMode=function(){var t=Phaser.BlendModes.NORMAL;switch(this._blendMode){case 0:t=Phaser.BlendModes.NORMAL;break;case 1:t=Phaser.BlendModes.ADD;break;case 3:t=Phaser.BlendModes.DARKEN;break;case 4:t=Phaser.BlendModes.DIFFERENCE;break;case 6:t=Phaser.BlendModes.HARD_LIGHT;break;case 9:t=Phaser.BlendModes.LIGHTEN;break;case 10:t=Phaser.BlendModes.MULTIPLY;break;case 11:t=Phaser.BlendModes.OVERLAY;break;case 12:t=Phaser.BlendModes.SCREEN}this._renderDisplay.setBlendMode(t)},Slot.prototype._updateColor=function(){var t=this._colorTransform,i=this._globalAlpha*t.alphaMultiplier+t.alphaOffset;if(this._renderDisplay.setAlpha(i),!(this._renderDisplay instanceof e.DisplayContainer)){var a=255*t.redMultiplier+t.redOffset<<16|255*t.greenMultiplier+t.greenOffset<<8|255*t.blueMultiplier+t.blueOffset;this._renderDisplay.setTint(a)}},Slot.prototype._updateFrame=function(){if(!(this._renderDisplay instanceof e.DisplayContainer)){var i=this._textureData;if(this._displayIndex>=0&&null!==this._display&&null!==i){var a=i.parent;null!==this.armature.replacedTexture&&(null===this.armature._replaceTextureAtlasData?((a=t.BaseObject.borrowObject(e.TextureAtlasData)).copyFrom(i.parent),a.renderTexture=this.armature.replacedTexture,this.armature._replaceTextureAtlasData=a):a=this.armature._replaceTextureAtlasData,i=a.getTexture(i.name));var r=i.renderTexture;if(null!==r)return null!==this._geometryData||(this._renderDisplay.texture=r.texture,this._renderDisplay.frame=r,this._renderDisplay.setDisplayOrigin(this._pivotX,this._pivotY),this._textureScale=i.parent.scale*this.armature.armatureData.scale,this._renderDisplay.setScale(this._textureScale)),void(this._visibleDirty=!0)}else this._renderDisplay.x=0,this._renderDisplay.y=0,this._renderDisplay.setTexture(void 0)}},Slot.prototype._updateMesh=function(){},Slot.prototype._updateTransform=function(){this.updateGlobalTransform();var t=this.global;this._renderDisplay.x=t.x,this._renderDisplay.y=t.y,this._renderDisplay.rotation=t.rotation,this._renderDisplay.setSkew(t.skew,0),this._renderDisplay.setScale(t.scaleX*this._textureScale,t.scaleY*this._textureScale)},Slot.prototype._identityTransform=function(){this._renderDisplay.setPosition(),this._renderDisplay.setRotation(),this._textureScale=1,this._renderDisplay.setScale(this._textureScale),this._renderDisplay.setSkew(0)},Slot}(t.Slot);e.Slot=i}(e.display||(e.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(e){!function(e){var i=function(e){function TextureAtlasData(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderTexture=null,t}return r(TextureAtlasData,e),TextureAtlasData.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"},TextureAtlasData.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this._renderTexture&&this._renderTexture.destroy(),this._renderTexture=null},TextureAtlasData.prototype.createTexture=function(){return t.BaseObject.borrowObject(a)},Object.defineProperty(TextureAtlasData.prototype,"renderTexture",{get:function(){return this._renderTexture},set:function(t){if(t&&this._renderTexture!==t)for(var e in this._renderTexture&&this._renderTexture.destroy(),this._renderTexture=t,this.textures){var i=this.textures[e],a=this._renderTexture.add(e,0,i.region.x,i.region.y,i.region.width,i.region.height);i.rotated&&(a.rotated=!0,a.updateUVsInverted()),i.renderTexture=a}},enumerable:!0,configurable:!0}),TextureAtlasData}(t.TextureAtlasData);e.TextureAtlasData=i;var a=function(t){function TextureData(){var e=null!==t&&t.apply(this,arguments)||this;return e.renderTexture=null,e}return r(TextureData,t),TextureData.toString=function(){return"[class dragonBones.PhaserTextureData]"},TextureData.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.renderTexture&&this.renderTexture.destroy(),this.renderTexture=null},TextureData}(t.TextureData);e.TextureData=a}(e.display||(e.display={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(e){var i=function(e){function TextureTintPipeline(i){var a=e.call(this,i)||this;return a._tempMatrix1=new t.util.TransformMatrix,a._tempMatrix2=new t.util.TransformMatrix,a._tempMatrix3=new t.util.TransformMatrix,a}return r(TextureTintPipeline,e),TextureTintPipeline.prototype.batchSprite=function(t,e,i){this.renderer.setPipeline(this);var a=this._tempMatrix1,r=this._tempMatrix2,n=this._tempMatrix3,s=t.frame,o=s.glTexture,h=s.u0,l=s.v0,c=s.u1,u=s.v1,d=s.x,p=s.y,m=s.width,f=s.height,g=-t.displayOriginX+d,y=-t.displayOriginY+p;if(t.isCropped){var _=t._crop;_.flipX===t.flipX&&_.flipY===t.flipY||s.updateCropUVs(_,t.flipX,t.flipY),h=_.u0,l=_.v0,c=_.u1,u=_.v1,m=_.width,f=_.height,d=_.x,p=_.y,g=-t.displayOriginX+d,y=-t.displayOriginY+p}t.flipX&&(g+=m,m*=-1),t.flipY&&(y+=f,f*=-1);var v=g+m,b=y+f;r.applyITRSC(t.x,t.y,t.rotation,t.scaleX,t.scaleY,t.skewX||0,t.skewY||0),a.copyFrom(e.matrix),i?(a.multiplyWithOffset(i,-e.scrollX*t.scrollFactorX,-e.scrollY*t.scrollFactorY),r.e=t.x,r.f=t.y,a.multiply(r,n)):(r.e-=e.scrollX*t.scrollFactorX,r.f-=e.scrollY*t.scrollFactorY,a.multiply(r,n));var P=n.getX(g,y),S=n.getY(g,y),D=n.getX(g,b),T=n.getY(g,b),x=n.getX(v,b),C=n.getY(v,b),O=n.getX(v,y),M=n.getY(v,y),w=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintTL,e.alpha*t._alphaTL),A=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintTR,e.alpha*t._alphaTR),E=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintBL,e.alpha*t._alphaBL),B=Phaser.Renderer.WebGL.Utils.getTintAppendFloatAlpha(t._tintBR,e.alpha*t._alphaBR);e.roundPixels&&(P|=0,S|=0,D|=0,T|=0,x|=0,C|=0,O|=0,M|=0),this.setTexture2D(o,0);var I=t._isTinted&&t.tintFill;this.batchQuad(P,S,D,T,x,C,O,M,h,l,c,u,w,A,E,B,I)},TextureTintPipeline}(Phaser.Renderer.WebGL.Pipelines.TextureTintPipeline);e.TextureTintPipeline=i}(t.pipeline||(t.pipeline={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){t.FileTypes={IMAGE:"imageFile",JSON:"jsonFile",BINARY:"binaryFile",map:{imageFile:Phaser.Loader.FileTypes.ImageFile,jsonFile:Phaser.Loader.FileTypes.JSONFile,binaryFile:Phaser.Loader.FileTypes.BinaryFile},setType:function(e,i){t.FileTypes.map[e]=i},getType:function(e){return t.FileTypes.map[e]}}}(t.plugin||(t.plugin={}))}(t.phaser||(t.phaser={}))}(l||(l={})),function(t){!function(t){!function(t){var e=function(e){function DragonBonesFile(i,a,r,n,s,o,h,l){var c,u,d,p,m=t.FileTypes.getType(t.FileTypes.BINARY),f=t.FileTypes.getType(t.FileTypes.JSON),g=t.FileTypes.getType(t.FileTypes.IMAGE),createBoneFileByType=function(t,e,i,a){var r="json";if(a&&a.responseType)switch(a.responseType){case"arraybuffer":case"blob":r="bin";break;case"json":case"text":r="json"}return"bin"===r?new m(t,e,i,a):new f(t,e,i,a)};if(Phaser.Utils.Objects.IsPlainObject(a)){var y=a;c=new g(i,{key:p=Phaser.Utils.Objects.GetFastValue(y,"key"),url:Phaser.Utils.Objects.GetFastValue(y,"textureURL"),extension:Phaser.Utils.Objects.GetFastValue(y,"textureExtension","png"),xhrSettings:Phaser.Utils.Objects.GetFastValue(y,"textureXhrSettings")}),u=new f(i,{key:p+"_atlasjson",url:Phaser.Utils.Objects.GetFastValue(y,"atlasURL"),extension:Phaser.Utils.Objects.GetFastValue(y,"atlasExtension","json"),xhrSettings:Phaser.Utils.Objects.GetFastValue(y,"atlasXhrSettings")}),d=createBoneFileByType(i,p,Phaser.Utils.Objects.GetFastValue(y,"boneURL"),Phaser.Utils.Objects.GetFastValue(y,"boneXhrSettings"))}else c=new g(i,p=a,r,o),u=new f(i,p+"_atlasjson",n,h),d=createBoneFileByType(i,p,s,l);return d.cache=i.cacheManager.custom.dragonbone,e.call(this,i,"dragonbone",p,[c,u,d])||this}return r(DragonBonesFile,e),DragonBonesFile.prototype.addToCache=function(){if(this.isReadyToProcess()){var t=this.files[0],e=this.files[1],i=this.files[2];e.addToCache(),i.addToCache(),this.loader.textureManager.addImage(t.key,t.data),this.complete=!0}},DragonBonesFile}(Phaser.Loader.MultiFile);t.DragonBonesFile=e}(t.plugin||(t.plugin={}))}(t.phaser||(t.phaser={}))}(l||(l={})),h=l||(l={}),function(t){var e=function(t){function DragonBonesScenePlugin(e,i){var a=t.call(this,e,i)||this,r=a.game;if(r.cache.addCustom("dragonbone"),a.game.config.renderType===Phaser.WEBGL){var n=a.game.renderer;n.hasPipeline("PhaserTextureTintPipeline")||n.addPipeline("PhaserTextureTintPipeline",new o.pipeline.TextureTintPipeline({game:r,renderer:n}))}return i.registerGameObject("dragonBones",CreateDragonBonesRegisterHandler),i.registerGameObject("armature",CreateArmatureRegisterHandler),i.registerFileType("dragonbone",DragonBoneFileRegisterHandler,e),a}return r(DragonBonesScenePlugin,t),DragonBonesScenePlugin.prototype.createArmature=function(t,e,i,a,r){void 0===r&&(r=1);var n=this.factory.buildArmatureDisplay(t,e,i,a,r);return this.systems.displayList.add(n),this._dbInst.clock.add(n.armature),n},DragonBonesScenePlugin.prototype.createDragonBones=function(t,e){return void 0===e&&(e=1),this.factory.buildDragonBonesData(t,e)},Object.defineProperty(DragonBonesScenePlugin.prototype,"factory",{get:function(){return this._factory||(this._dbInst=new l.DragonBones(new o.util.EventDispatcher),this._factory=new o.Factory(this._dbInst,this.scene)),this._factory},enumerable:!0,configurable:!0}),DragonBonesScenePlugin.prototype.createSlotDisplayPlaceholder=function(){return new o.display.SlotImage(this.scene,0,0)},DragonBonesScenePlugin.prototype.boot=function(){this.systems.events.once("destroy",this.destroy,this),this.start()},DragonBonesScenePlugin.prototype.start=function(){var t=this.systems.events;t.on("update",this.update,this),t.once("shutdown",this.shutdown,this)},DragonBonesScenePlugin.prototype.update=function(t,e){this._dbInst&&this._dbInst.advanceTime(.001*e)},DragonBonesScenePlugin.prototype.shutdown=function(){var t=this.systems.events;t.off("update",this.update,this),t.off("shutdown",this.shutdown,this)},DragonBonesScenePlugin.prototype.destroy=function(){this.shutdown(),this._factory=this._dbInst=null,this.pluginManager=this.game=this.scene=this.systems=null},DragonBonesScenePlugin}(Phaser.Plugins.ScenePlugin);t.DragonBonesScenePlugin=e;var CreateDragonBonesRegisterHandler=function(t,e){return void 0===e&&(e=1),this.scene.dragonbone.createDragonBones(t,e)},CreateArmatureRegisterHandler=function(t,e,i,a){return this.scene.dragonbone.createArmature(t,e,i,a)},DragonBoneFileRegisterHandler=function(e,i,a,r,n,s,o){var h=new t.DragonBonesFile(this,e,i,a,r,n,s,o);return this.addFile(h.files),this}}((o=h.phaser||(h.phaser={})).plugin||(o.plugin={})),function(t){var e=function(e){function Factory(t,i,a){var r=e.call(this,a)||this;return r._scene=i,r._dragonBones=t,r}return r(Factory,e),Factory.prototype._isSupportMesh=function(){return console.warn("Mesh is not supported yet"),!1},Factory.prototype._buildTextureAtlasData=function(e,i){return e?e.renderTexture=i:e=c.BaseObject.borrowObject(t.display.TextureAtlasData),e},Factory.prototype._buildArmature=function(e){var i=c.BaseObject.borrowObject(c.Armature),a=new t.display.ArmatureDisplay(this._scene);return i.init(e.armature,a,a,this._dragonBones),i},Factory.prototype._buildSlot=function(e,i,a){var r=c.BaseObject.borrowObject(t.display.Slot),n=this._scene.dragonbone.createSlotDisplayPlaceholder(),s=n;return r.init(i,a,n,s),r},Factory.prototype.buildArmatureDisplay=function(t,e,i,a,r){var n;return void 0===i&&(i=""),void 0===a&&(a=""),void 0===r&&(r=1),this.buildDragonBonesData(e,r)&&(n=this.buildArmature(t,e,i,a)),n.display},Factory.prototype.buildDragonBonesData=function(t,e){void 0===e&&(e=1);var i=this._dragonBonesDataMap[t];if(!i){var a=this._scene.cache,r=a.custom.dragonbone.get(t);if(r){i=this.parseDragonBonesData(r,t,e);var n=this._scene.textures.get(t),s=a.json.get(t+"_atlasjson");this.parseTextureAtlasData(s,n,n.key,e)}}return i},Factory}(c.BaseFactory);t.Factory=e}((c=l||(l={})).phaser||(c.phaser={}))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){t.exports=function(){return new Worker(i.p+"js/c6bf7d4dd25da69b6fde.networker.js")}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e){const i=Math.PI/180;t.exports=function(t){return t*i}},function(t,e,i){"use strict";function earcut(t,e,i){i=i||2;var a,r,n,s,o,h,l,c=e&&e.length,u=c?e[0]*i:t.length,d=linkedList(t,0,u,i,!0),p=[];if(!d||d.next===d.prev)return p;if(c&&(d=function eliminateHoles(t,e,i,a){var r,n,s,o,h,l=[];for(r=0,n=e.length;r<n;r++)s=e[r]*a,o=r<n-1?e[r+1]*a:t.length,(h=linkedList(t,s,o,a,!1))===h.next&&(h.steiner=!0),l.push(getLeftmost(h));for(l.sort(compareX),r=0;r<l.length;r++)eliminateHole(l[r],i),i=filterPoints(i,i.next);return i}(t,e,d,i)),t.length>80*i){a=n=t[0],r=s=t[1];for(var m=i;m<u;m+=i)(o=t[m])<a&&(a=o),(h=t[m+1])<r&&(r=h),o>n&&(n=o),h>s&&(s=h);l=0!==(l=Math.max(n-a,s-r))?1/l:0}return earcutLinked(d,p,i,a,r,l),p}function linkedList(t,e,i,a,r){var n,s;if(r===signedArea(t,e,i,a)>0)for(n=e;n<i;n+=a)s=insertNode(n,t[n],t[n+1],s);else for(n=i-a;n>=e;n-=a)s=insertNode(n,t[n],t[n+1],s);return s&&equals(s,s.next)&&(removeNode(s),s=s.next),s}function filterPoints(t,e){if(!t)return t;e||(e=t);var i,a=t;do{if(i=!1,a.steiner||!equals(a,a.next)&&0!==area(a.prev,a,a.next))a=a.next;else{if(removeNode(a),(a=e=a.prev)===a.next)break;i=!0}}while(i||a!==e);return e}function earcutLinked(t,e,i,a,r,n,s){if(t){!s&&n&&function indexCurve(t,e,i,a){var r=t;do{null===r.z&&(r.z=zOrder(r.x,r.y,e,i,a)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function sortLinked(t){var e,i,a,r,n,s,o,h,l=1;do{for(i=t,t=null,n=null,s=0;i;){for(s++,a=i,o=0,e=0;e<l&&(o++,a=a.nextZ);e++);for(h=l;o>0||h>0&&a;)0!==o&&(0===h||!a||i.z<=a.z)?(r=i,i=i.nextZ,o--):(r=a,a=a.nextZ,h--),n?n.nextZ=r:t=r,r.prevZ=n,n=r;i=a}n.nextZ=null,l*=2}while(s>1);return t}(r)}(t,a,r,n);for(var o,h,l=t;t.prev!==t.next;)if(o=t.prev,h=t.next,n?isEarHashed(t,a,r,n):isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(h.i/i),removeNode(t),t=h.next,l=h.next;else if((t=h)===l){s?1===s?earcutLinked(t=cureLocalIntersections(t,e,i),e,i,a,r,n,2):2===s&&splitEarcut(t,e,i,a,r,n):earcutLinked(filterPoints(t),e,i,a,r,n,1);break}}}function isEar(t){var e=t.prev,i=t,a=t.next;if(area(e,i,a)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(pointInTriangle(e.x,e.y,i.x,i.y,a.x,a.y,r.x,r.y)&&area(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function isEarHashed(t,e,i,a){var r=t.prev,n=t,s=t.next;if(area(r,n,s)>=0)return!1;for(var o=r.x<n.x?r.x<s.x?r.x:s.x:n.x<s.x?n.x:s.x,h=r.y<n.y?r.y<s.y?r.y:s.y:n.y<s.y?n.y:s.y,l=r.x>n.x?r.x>s.x?r.x:s.x:n.x>s.x?n.x:s.x,c=r.y>n.y?r.y>s.y?r.y:s.y:n.y>s.y?n.y:s.y,u=zOrder(o,h,e,i,a),d=zOrder(l,c,e,i,a),p=t.prevZ,m=t.nextZ;p&&p.z>=u&&m&&m.z<=d;){if(p!==t.prev&&p!==t.next&&pointInTriangle(r.x,r.y,n.x,n.y,s.x,s.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==t.prev&&m!==t.next&&pointInTriangle(r.x,r.y,n.x,n.y,s.x,s.y,m.x,m.y)&&area(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&pointInTriangle(r.x,r.y,n.x,n.y,s.x,s.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&pointInTriangle(r.x,r.y,n.x,n.y,s.x,s.y,m.x,m.y)&&area(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function cureLocalIntersections(t,e,i){var a=t;do{var r=a.prev,n=a.next.next;!equals(r,n)&&intersects(r,a,a.next,n)&&locallyInside(r,n)&&locallyInside(n,r)&&(e.push(r.i/i),e.push(a.i/i),e.push(n.i/i),removeNode(a),removeNode(a.next),a=t=n),a=a.next}while(a!==t);return a}function splitEarcut(t,e,i,a,r,n){var s=t;do{for(var o=s.next.next;o!==s.prev;){if(s.i!==o.i&&isValidDiagonal(s,o)){var h=splitPolygon(s,o);return s=filterPoints(s,s.next),h=filterPoints(h,h.next),earcutLinked(s,e,i,a,r,n),void earcutLinked(h,e,i,a,r,n)}o=o.next}s=s.next}while(s!==t)}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=function findHoleBridge(t,e){var i,a=e,r=t.x,n=t.y,s=-1/0;do{if(n<=a.y&&n>=a.next.y&&a.next.y!==a.y){var o=a.x+(n-a.y)*(a.next.x-a.x)/(a.next.y-a.y);if(o<=r&&o>s){if(s=o,o===r){if(n===a.y)return a;if(n===a.next.y)return a.next}i=a.x<a.next.x?a:a.next}}a=a.next}while(a!==e);if(!i)return null;if(r===s)return i.prev;var h,l=i,c=i.x,u=i.y,d=1/0;a=i.next;for(;a!==l;)r>=a.x&&a.x>=c&&r!==a.x&&pointInTriangle(n<u?r:s,n,c,u,n<u?s:r,n,a.x,a.y)&&((h=Math.abs(n-a.y)/(r-a.x))<d||h===d&&a.x>i.x)&&locallyInside(a,t)&&(i=a,d=h),a=a.next;return i}(t,e)){var i=splitPolygon(e,t);filterPoints(i,i.next)}}function zOrder(t,e,i,a,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){var e=t,i=t;do{e.x<i.x&&(i=e),e=e.next}while(e!==t);return i}function pointInTriangle(t,e,i,a,r,n,s,o){return(r-s)*(e-o)-(t-s)*(n-o)>=0&&(t-s)*(a-o)-(i-s)*(e-o)>=0&&(i-s)*(n-o)-(r-s)*(a-o)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function intersectsPolygon(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&locallyInside(t,e)&&locallyInside(e,t)&&function middleInside(t,e){var i=t,a=!1,r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(a=!a),i=i.next}while(i!==t);return a}(t,e)}function area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,i,a){return!!(equals(t,e)&&equals(i,a)||equals(t,a)&&equals(i,e))||area(t,e,i)>0!=area(t,e,a)>0&&area(i,a,t)>0!=area(i,a,e)>0}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function splitPolygon(t,e){var i=new Node(t.i,t.x,t.y),a=new Node(e.i,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,a.next=i,i.prev=a,n.next=a,a.prev=n,a}function insertNode(t,e,i,a){var r=new Node(t,e,i);return a?(r.next=a.next,r.prev=a,a.next.prev=r,a.next=r):(r.prev=r,r.next=r),r}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,i,a){for(var r=0,n=e,s=i-a;n<i;n+=a)r+=(t[s]-t[n])*(t[n+1]+t[s+1]),s=n;return r}t.exports=earcut,earcut.deviation=function(t,e,i,a){var r=e&&e.length,n=r?e[0]*i:t.length,s=Math.abs(signedArea(t,0,n,i));if(r)for(var o=0,h=e.length;o<h;o++){var l=e[o]*i,c=o<h-1?e[o+1]*i:t.length;s-=Math.abs(signedArea(t,l,c,i))}var u=0;for(o=0;o<a.length;o+=3){var d=a[o]*i,p=a[o+1]*i,m=a[o+2]*i;u+=Math.abs((t[d]-t[m])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[m+1]-t[d+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},earcut.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,r=0;r<t.length;r++){for(var n=0;n<t[r].length;n++)for(var s=0;s<e;s++)i.vertices.push(t[r][n][s]);r>0&&(a+=t[r-1].length,i.holes.push(a))}return i}},function(t,e,i){var a=i(215),r=i(216);t.exports=function(t,e,i,n,s){var o=this.pipeline,h=o._tempMatrix1,l=o._tempMatrix2,c=o._tempMatrix3;t.setPipeline(o),l.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY),h.copyFrom(n.matrix),s?(h.multiplyWithOffset(s,-n.scrollX*e.scrollFactorX,-n.scrollY*e.scrollFactorY),l.e=e.x,l.f=e.y):(l.e-=n.scrollX*e.scrollFactorX,l.f-=n.scrollY*e.scrollFactorY),h.multiply(l,c);var u=e._displayOriginX,d=e._displayOriginY,p=n.alpha*e.alpha;e.isFilled&&a(o,c,e,p,u,d),e.isStroked&&r(o,e,p,u,d)}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,a,r,n,s){for(var o=i.getTintAppendFloatAlphaAndSwap(a.fillColor,a.fillAlpha*r),h=a.pathData,l=a.pathIndexes,c=0;c<l.length;c+=3){var u=2*l[c],d=2*l[c+1],p=2*l[c+2],m=h[u+0]-n,f=h[u+1]-s,g=h[d+0]-n,y=h[d+1]-s,_=h[p+0]-n,v=h[p+1]-s,b=e.getX(m,f),P=e.getY(m,f),S=e.getX(g,y),D=e.getY(g,y),T=e.getX(_,v),x=e.getY(_,v);t.setTexture2D(),t.batchTri(b,P,S,D,T,x,0,0,1,1,o,o,o,t.tintEffect)}}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,a,r,n){var s=t.strokeTint,o=i.getTintAppendFloatAlphaAndSwap(e.strokeColor,e.strokeAlpha*a);s.TL=o,s.TR=o,s.BL=o,s.BR=o;var h=e.pathData,l=h.length-1,c=e.lineWidth,u=c/2,d=h[0]-r,p=h[1]-n;e.closePath||(l-=2);for(var m=2;m<l;m+=2){var f=h[m]-r,g=h[m+1]-n;t.setTexture2D(),t.batchLine(d,p,f,g,u,u,c,m-2,!!e.closePath&&m===l-1),d=f,p=g}}},function(t,e,i){var a=i(218),r=i(219),n=Phaser.Renderer.Canvas.SetTransform;t.exports=function(t,e,i,s,o){var h=t.currentContext;if(n(t,h,e,s,o)){var l=e._displayOriginX,c=e._displayOriginY,u=e.pathData,d=u.length-1,p=u[0]-l,m=u[1]-c;h.beginPath(),h.moveTo(p,m),e.closePath||(d-=2);for(var f=2;f<d;f+=2){var g=u[f]-l,y=u[f+1]-c;h.lineTo(g,y)}h.closePath(),e.isFilled&&(a(h,e),h.fill()),e.isStroked&&(r(h,e),h.stroke()),h.restore()}}},function(t,e){t.exports=function(t,e,i,a){var r=i||e.fillColor,n=a||e.fillAlpha,s=(16711680&r)>>>16,o=(65280&r)>>>8,h=255&r;t.fillStyle="rgba("+s+","+o+","+h+","+n+")"}},function(t,e){t.exports=function(t,e,i,a){var r=i||e.strokeColor,n=a||e.strokeAlpha,s=(16711680&r)>>>16,o=(65280&r)>>>8,h=255&r;t.strokeStyle="rgba("+s+","+o+","+h+","+n+")",t.lineWidth=e.lineWidth}},function(t,e){var i=Phaser.Renderer.WebGL.Utils;t.exports=function(t,e,a,r,n){if(0!==e.width&&0!==e.height){var s=e.frame,o=s.width,h=s.height,l=i.getTintAppendFloatAlpha;this.pipeline.batchTexture(e,s.glTexture,o,h,e.x,e.y,o/e.style.resolution,h/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,o,h,l(e._tintTL,r.alpha*e._alphaTL),l(e._tintTR,r.alpha*e._alphaTR),l(e._tintBL,r.alpha*e._alphaBL),l(e._tintBR,r.alpha*e._alphaBR),e._isTinted&&e.tintFill,0,0,r,n)}}},function(t,e){t.exports=function(t,e,i,a,r){0!==e.width&&0!==e.height&&t.batchSprite(e,e.frame,a,r)}},function(t,e,i){var a={"./ComponentRank/ComponentRankMediator":115,"./ComponentRank/ComponentRankMediator.ts":115,"./ComponentRank/ComponentRankPanel":74,"./ComponentRank/ComponentRankPanel.ts":74,"./ControlF/ControlFMediator":116,"./ControlF/ControlFMediator.ts":116,"./ControlF/ControlFPanel":75,"./ControlF/ControlFPanel.ts":75,"./Notice/NoticeMediator":71,"./Notice/NoticeMediator.ts":71,"./Notice/NoticePanel":72,"./Notice/NoticePanel.ts":72,"./Rank/BasicRankPanel":48,"./Rank/BasicRankPanel.ts":48,"./Rank/RankMediator":117,"./Rank/RankMediator.ts":117,"./Rank/RankPanel":76,"./Rank/RankPanel.ts":76,"./UserMenu/UserMenuMediator":118,"./UserMenu/UserMenuMediator.ts":118,"./UserMenu/UserMenuPanel":77,"./UserMenu/UserMenuPanel.ts":77,"./abstractPanel":119,"./abstractPanel.ts":119,"./alert/alert":78,"./alert/alert.ts":78,"./bag/IListItemRender":120,"./bag/IListItemRender.ts":120,"./bag/bag/bagMediator":58,"./bag/bag/bagMediator.ts":58,"./bag/bag/bagPanel":36,"./bag/bag/bagPanel.ts":36,"./bag/bagHotkey/bagUI.mobile":61,"./bag/bagHotkey/bagUI.mobile.ts":61,"./bag/bagHotkey/bagUI.pc":60,"./bag/bagHotkey/bagUI.pc.ts":60,"./bag/bagHotkey/bagUIMediator":59,"./bag/bagHotkey/bagUIMediator.ts":59,"./bag/basebag":121,"./bag/basebag.ts":121,"./bag/baseitem":122,"./bag/baseitem.ts":122,"./bag/dragDropIcon":46,"./bag/dragDropIcon.ts":46,"./bag/idragable":123,"./bag/idragable.ts":123,"./bag/idropable":124,"./bag/idropable.ts":124,"./bag/item.slot":28,"./bag/item.slot.ts":28,"./bag/storage/storageMediator":125,"./bag/storage/storageMediator.ts":125,"./bag/storage/storagePanel":126,"./bag/storage/storagePanel.ts":126,"./baseMediator":127,"./baseMediator.ts":127,"./chat/chat.mediator":62,"./chat/chat.mediator.ts":62,"./chat/chat.panel":63,"./chat/chat.panel.ts":63,"./chat/message":128,"./chat/message.ts":128,"./components/button":67,"./components/button.ts":67,"./components/check.button":68,"./components/check.button.ts":68,"./components/comboBox":79,"./components/comboBox.ts":79,"./components/dynamic.image":44,"./components/dynamic.image.ts":44,"./components/dynamic.ninepatch":50,"./components/dynamic.ninepatch.ts":50,"./components/panel":12,"./components/panel.ts":12,"./components/scroller":129,"./components/scroller.ts":129,"./layer.manager":70,"./layer.manager.ts":70,"./loadview":130,"./loadview.ts":130,"./shop/ShopPanel":80,"./shop/ShopPanel.ts":80,"./shop/shop.itemSlot":84,"./shop/shop.itemSlot.ts":84,"./shop/shopMediator":131,"./shop/shopMediator.ts":131,"./ui.manager":57,"./ui.manager.ts":57,"./ui.mediatorType":38,"./ui.mediatorType.ts":38};function webpackContext(t){var e=webpackContextResolve(t);return i(e)}function webpackContextResolve(t){if(!i.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}webpackContext.keys=function webpackContextKeys(){return Object.keys(a)},webpackContext.resolve=webpackContextResolve,t.exports=webpackContext,webpackContext.id=222}]]);